# AirBnB 新用户预订预测——使用机器学习

> 原文：<https://towardsdatascience.com/new-airbnb-user-booking-prediction-using-machine-learning-874836bff403?source=collection_archive---------23----------------------->

![](img/0c7da7db727b654dd6db4d4577fd5a2c.png)

Photo credits to Prexels

对任何公司来说，最有价值的信息之一就是了解用户的行为。一个好的战略决策通常基于对客户购买模式和趋势的了解。此外，互联网已经连接了世界，我们的数据被共享，并用于网络上的每一个营销活动。数据已经成为 21 世纪最有价值的商品。

在这篇摘录中，我想使用机器学习来预测 AirBnb 新用户的行为，以分类用户是否会在注册账户的 5 天内进行预订。这个博客解释了这个项目的工作流程和一些决策。尽情享受吧！

你可以在这里找到这个项目报告[。](https://github.com/BentleyOu/Projects/tree/master/AirBnB%20Booking%20Prediction)

我还在 Heroku 上托管了一个 flask 应用程序，请随意查看这里的。

## 问题陈述:

> ***我们能使用机器学习来发现 AirBnB 新用户的洞察力吗？***
> 
> ***我们如何利用用户行为预测来最大化假想营销活动的收益？***

## TL；速度三角形定位法(dead reckoning)

我们从在 Kaggle 上发现的不平衡数据集开始。我们使用 ADASYN 对我们的训练集进行过采样，以输入到基本的逻辑回归模型中。我们决定使用 AUC 分数作为我们的评估指标，因为我们希望根据假设的业务约束优化概率阈值。总之，使用我们的最佳表现模型(CatBoost)，我们应该向至少有 16%的预订概率的用户做广告，以最大化净收入。在这个过程中，我们发现用户通过 web 应用程序和特定的注册流程进行注册会产生更高的整体转化率。

## 这是我的方法:

1.  数据预处理
2.  型号选择
3.  模型评估和度量
4.  要点和建议
5.  烧瓶应用程序

## 数据预处理

为了这个项目，我使用了 Kaggle 上的一个旧数据集。你可以在这里找到数据集。Kaggle 最初的问题陈述是预测新用户的首次旅行目的地。我更感兴趣的是第一次使用 AirBnb 的用户是否会预订。

以下是我使用的一些功能:

*   date_account_created:帐户创建日期
*   timestamp_first_active:第一个活动的时间戳，注意它可以早于 date_account_created 或 date_first_booking，因为用户可以在注册之前进行搜索
*   date_first_booking:首次预订的日期
*   性别
*   年龄
*   注册方法
*   注册流:用户注册的页面
*   语言:国际语言偏好
*   affiliate_channel:什么样的付费营销
*   affiliate_provider:营销的地方，如谷歌，craigslist，其他
*   first_affiliate_tracked:用户在注册之前互动的第一个营销是什么
*   注册应用程序
*   第一设备类型
*   第一个浏览器

由于我们偏离了最初的 Kaggle 问题陈述，我们必须制作自己的输出标签。我决定，我们的积极阶层将是那些在注册 AirBnB 账户后 5 天内进行预订的人，否则他们将被视为处于消极阶层。在 5 天之后，既记账又预订的用户数量显著减少，因此，我使用 5 天作为分类阈值。

在注册后 5 天内**预订**的用户被标记为 1。

**在注册后 5 天内没有预订**的用户被标记为 0。

使用这个定义，我们有大约 40，000 个正类(1)和 111，500 个负类(0)。在实践中，我们的积极阶层代表性不足是相当普遍的。这被称为不平衡数据集。这是一个专门针对欺诈或其他异常检测等问题的问题。克服不平衡数据的常用技术是对训练数据集进行过采样。我们从来不想在我们的验证或测试集上进行过采样。在这个项目中，我使用了 ADASYN，它是*自适应合成采样方法的缩写。*在将数据分成训练集、验证集和测试集之后，我将 ADASYN 应用于训练集。我们现在正在处理 66，880 个阳性和 69，685 个阴性标签。最后，让我们开始建模…

## 模特培训

在应用任何高级机器算法之前，最好总是构建一个普通的基础模型。我使用 SciKit-Learn 的逻辑回归软件包来训练一个基本模型。结果如下:

![](img/e00044f77c93907fec8de193a091dcd2.png)

如您所见，由于分布不平衡，我们的模型在预测负类(0)方面比正类(1)做得更好。对于这个项目，我们希望最大化我们的阳性类(1)的 AUC 分数。我将在下面的评估部分更详细地解释我们为什么选择这个指标。

我继续使用其他分类算法，如朴素贝叶斯、KNN、决策树、RandomForest、XGBoost 和 CatBoost。我根据 AUC 分数挑选了表现最好的 3 个模型，并对所有这些模型进行了参数调整。我将在另一篇文章中详细介绍如何有效地使用 GridSearchCV 来调整不平衡数据集上的参数。以下是参数调整后 AUC 得分最高的前 3 个模型的结果。

![](img/00b425509040eee6de7c52f780991618.png)

在选择具有相似性能的型号时，需要考虑一些事情。我将在下一节“模型评估”中讨论更多细节。

## 模型评估和度量

如上所述，我们主要关注最大化 AUC 分数。AUC 代表曲线下面积。它是在各种概率阈值下模型性能的度量。分类算法的默认概率阈值设置为 0.50。这意味着如果模型输出 0.50 或更大的概率，它将预测正类(1)。相反，如果模型输出 0.50 或更小的概率，它将预测负类(0)。我们在哪里设置阈值是特定于业务案例的约束。在我们定义假设的业务案例之前，让我们看看在模型选择过程中我们可能要考虑的其他事情。

模型的可解释性是选择模型时要考虑的最重要的事情之一。最终，我们希望能够解释我们模型的结果，并对问题提出有见地的建议。在三个模型(logistics、XGBoost、CatBoost)中，Logistics 回归是迄今为止最容易解释的。

模型训练速度可能是另一个需要考虑的因素。如果经常重新训练模型是令人感兴趣的事情，人们可能希望训练速度尽可能快。其他人可能也希望预测速度尽可能快，因为预测速度直接影响客户在 web 上的信息流。在我们的例子中，我们对训练时间更感兴趣，因为我们希望能够随着更多数据的可用而定期更新我们的模型。以下是顶级模特的训练时间:

![](img/87a6b2b6c562fb0569bcf391bcedfb85.png)

同样，逻辑回归在速度上胜出，但 CatBoost 也不算太慢。

最后，但也是最重要的，让我们将这些点与我们假设的 AirBnB 业务问题联系起来。

> 我们如何利用用户行为预测来最大化假想营销活动的收入？

我们的目标是最大限度地提高假想营销活动的收入。让我们来解释一下这个问题的背景。经过一番研究，我得出了一些估计(它们绝不是 100%准确的):

预计 2020 年将有大约 220 万新用户使用 AirBnB。所有首次用户中有 23%预计会进行预订—这是我们样本数据集中的正类样本。当平均预订价格为每晚 160 美元(17%的费用来自预订者，3%来自房东)时，AirBnB 的每次预订收入约为 32 美元。我还估算了每个用户的平均广告成本为 5 美元。不要太在意这些数字是从哪里来的，但要得出合理的结论，有这些业务约束是很重要的。利用这些信息，我们可以预测每个用户的成本和收益。

![](img/d0e28aba6644e2fa1c35896ed7a9aef0.png)

通过了解我们预测的成本和收益，我们可以改变概率阈值来最大化任何广告活动的利润。每个概率阈值将为真阳性、真阴性、假阳性和假阴性的数量产生一组不同的计数。我们要绘制概率阈值与净收入的关系图。

![](img/e8206193c0da4aaeed1999146b37c430.png)

很明显，CatBoost 模型为我们假设的营销活动带来了最高的收入。这与我们的假设一致，即最大的 AUC 分数将产生最好的结果。尽管就训练时间而言，CatBoost 是一种比 logistics regression 慢的算法，但就总收入而言，它比 logistics regression 多 150，000 美元。在下一节中，我将讨论将我们的概率阈值设置为 0.16 的重要性及其意义。

## 要点和建议

如上所述，我们需要将概率阈值设置为 0.16，以达到我们假设的活动的最大收入。这意味着，如果我们的模型预测一个新用户有 16%或更高的机会预订，那么在我们的活动中瞄准这个用户是值得的。

让我们看看我们选择的 CatBoost 模型的特性重要性。

![](img/5f8347e4bdb0e0088abbc0fa3454ea11.png)

使用基于树的模型的缺点是我们失去了可解释性。根据你所处的行业，有时候了解你的模型的解释比模型的表现更重要。从功能重要性来看，我们只知道 signup_flow、signup_method 和 signup_app 是预测预订行为的重要因素。

为了更深入，让我们来看看物流回归模型的系数，它具有很高的可解释性。它似乎与 CatBoost 模型的功能重要性保持一致。这样，我们就可以*对每个功能如何影响用户行为有一些信心*。

![](img/e05d0856e5b007d1f5b8187fbd1e57d0.png)

These coefficients are transformed from log odds

就拿‘sign up _ app _ Web’来说吧。在其他功能保持不变的情况下，通过网络注册的新用户在注册账户 5 天后进行预订的几率是不通过网络注册的用户的 6 倍。AirBnB 的网络体验一定有什么能产生更高的转化率。类似地，同样的分析也适用于注册流程。注册流本质上是用户从最初接触产品到注册页面所看到的页面流。注册流 24、3 和 12 往往表现良好。

## 烧瓶应用程序

如果你能走到这一步，我为你骄傲！下面是 Flask [应用程序](https://fake-airbnb-webapp.herokuapp.com/predict)的一个片段。如果你有兴趣的话，可以自己去看看！我将把如何创建[烧瓶应用程序](https://fake-airbnb-webapp.herokuapp.com/predict)的细节留待以后讨论。我通过 Heroku 在一个免费的托管平台上部署了[应用](https://fake-airbnb-webapp.herokuapp.com/predict)！

关于 CatBoost，我应该说的另一点是，与其他算法不同，CatBoost 将以文字形式接受特性。我们不需要一次性编码分类特征，这有助于简化 Flask 应用程序的后端 python 脚本。

![](img/10acbe4ad199f0a074f0c0a1eb99f853.png)

## 感谢您的阅读！

你可以在这里找到这个项目库。

你也可以在我的 [LinkedIn](https://www.linkedin.com/in/bentleyou/) 上找到这个帖子。