<html>
<head>
<title>To understand LSTM architecture, code a forward pass with just NumPy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">要理解 LSTM 架构，只需用 NumPy 编写一个向前传递的代码</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/the-lstm-reference-card-6163ca98ae87?source=collection_archive---------6-----------------------#2019-05-29">https://towardsdatascience.com/the-lstm-reference-card-6163ca98ae87?source=collection_archive---------6-----------------------#2019-05-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/286741878f2c10ce179b60877dc14a03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*WdIH6CKqW8ucRwG7"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Photo by <a class="ae jd" href="https://unsplash.com/@maartendeckers?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Maarten Deckers</a> on <a class="ae jd" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><div class=""/><p id="43cf" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你像我一样，从简单开始，从头开始，你会学得最好。不管我在 RNNs 上读了多少次 colah 的<a class="ae jd" href="https://colah.github.io/posts/2015-08-Understanding-LSTMs/" rel="noopener ugc nofollow" target="_blank">著名的 LSTM 邮报</a>，或者 Karpathy 的<a class="ae jd" href="http://karpathy.github.io/2015/05/21/rnn-effectiveness/" rel="noopener ugc nofollow" target="_blank">邮报</a>(伟大的资源！)，LSTM 的网络架构看起来过于复杂，门户也很模糊。</p><p id="9a76" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最终，我用 NumPy 写了一个 LSTM 向前传球。我强烈推荐做这个练习，因为您可以检查隐藏和单元格状态、输入和输出，并清楚地看到它们是如何创建的。</p><p id="2fed" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本演练中，我们将:</p><ol class=""><li id="eaa6" class="lb lc jg kf b kg kh kk kl ko ld ks le kw lf la lg lh li lj bi translated">用自己独特的 Python 函数表示每个 LSTM 门</li><li id="7b86" class="lb lc jg kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated">将它们逻辑地链接在一起，以创建具有单个 LSTM 单元的数字网络</li></ol><p id="299a" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这里的要点是:这些函数可以被编辑以包括打印语句，这允许检查您的数据的形状、隐藏状态(短期记忆)以及整个 LSTM 单元格中不同阶段的单元格状态(长期记忆)。这将帮助你理解为什么门存在。</p><p id="07a9" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">其次，为了确认我们做得对，我们将:</p><ol class=""><li id="8137" class="lb lc jg kf b kg kh kk kl ko ld ks le kw lf la lg lh li lj bi translated">使用 PyTorch 建立一个具有单个 LSTM 细胞的小型神经网络</li><li id="ba6c" class="lb lc jg kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated">用相同的随机权重初始化两个网络</li><li id="d2cd" class="lb lc jg kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated">使用两个网络进行 1 次转发，并检查输出是否相同</li></ol><p id="6f9a" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们走吧！</p></div><div class="ab cl lp lq hu lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ij ik il im in"><h2 id="5e79" class="lw lx jg bd ly lz ma dn mb mc md dp me ko mf mg mh ks mi mj mk kw ml mm mn mo bi translated">第 1 部分:创建 NumPy 网络</h2><p id="b809" class="pw-post-body-paragraph kd ke jg kf b kg mp ki kj kk mq km kn ko mr kq kr ks ms ku kv kw mt ky kz la ij bi translated">下面是 LSTM 参考卡。它包含 Python 函数，以及一个重要的图表。在该图中可以找到来自 LSTM 门函数的每个单独操作和变量(输入、权重、状态)的<em class="mu">。它们以颜色编码，以匹配它们所属的门。</em></p><p id="9784" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这些功能的代码可以复制在卡片下面。我强烈建议保存这张参考卡，用它来分析和理解 LSTM 建筑。(可打印的 pdf 版本可从这里下载<a class="ae jd" href="https://www.gregcondit.com/articles/lstm-ref-card" rel="noopener ugc nofollow" target="_blank"/>。)</p><figure class="mw mx my mz gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mv"><img src="../Images/5fab4ba920ebc5173c466c2f2130ab30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1OCrRYMjrlI4J061RD5bqQ.png"/></div></div></figure><p id="c9fc" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">下面是来自上述参考卡的可复制代码—每个门有一个功能:</p><figure class="mw mx my mz gt is"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="9b1f" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">通常，LSTM 为最终的全连接线性图层提供信息。让我们也这样做:</p><figure class="mw mx my mz gt is"><div class="bz fp l di"><div class="na nb l"/></div></figure><h2 id="79f7" class="lw lx jg bd ly lz ma dn mb mc md dp me ko mf mg mh ks mi mj mk kw ml mm mn mo bi translated">第 2 部分:比较 PyTorch LSTM</h2><p id="8e66" class="pw-post-body-paragraph kd ke jg kf b kg mp ki kj kk mq km kn ko mr kq kr ks ms ku kv kw mt ky kz la ij bi translated">用相同的参数创建一个 PyTorch LSTM。PyTorch 将自动为权重分配随机值——我们将提取这些值，并使用它们来初始化我们的 NumPy 网络。</p><figure class="mw mx my mz gt is"><div class="bz fp l di"><div class="na nb l"/></div></figure><figure class="mw mx my mz gt is"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="8377" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">不要不知所措！PyTorch 文档解释了我们需要分解的所有内容:</p><ul class=""><li id="698a" class="lb lc jg kf b kg kh kk kl ko ld ks le kw lf la nc lh li lj bi translated">中每个门的权重依次为:<em class="mu">忽略、忘记、学习、输出</em></li><li id="e40d" class="lb lc jg kf b kg lk kk ll ko lm ks ln kw lo la nc lh li lj bi translated">名称中带有“ih”的键是输入的权重/偏差，或 Wx_ 和 Bx_</li><li id="2e0f" class="lb lc jg kf b kg lk kk ll ko lm ks ln kw lo la nc lh li lj bi translated">名称中带有“hh”的键是隐藏状态的权重/偏差，或 Wh_ 和 Bh_</li></ul><p id="ba2b" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">给定我们选择的参数，我们因此可以提取 NumPy LSTM 的权重，以此方式使用:</p><figure class="mw mx my mz gt is"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="1040" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，我们有两个网络——一个在 PyTorch，一个在 NumPy——使用相同的起始重量。我们将把一些时间序列数据放入其中，以确保它们是相同的。为了对我们的网络进行正向传递，我们将按顺序将数据传递到 LSTM 门，并在每个事件后打印输出:</p><figure class="mw mx my mz gt is"><div class="bz fp l di"><div class="na nb l"/></div></figure><figure class="mw mx my mz gt is"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="5fc9" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">好消息！将相同的数据放入 PyTorch 模型显示，我们返回相同的输出:</p><figure class="mw mx my mz gt is"><div class="bz fp l di"><div class="na nb l"/></div></figure><figure class="mw mx my mz gt is"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="8287" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们还可以验证，在数据通过 LSTM 单元后，两个模型具有相同的隐藏和单元状态:</p><figure class="mw mx my mz gt is"><div class="bz fp l di"><div class="na nb l"/></div></figure><figure class="mw mx my mz gt is"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="4354" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我希望这有助于对 LSTM 网络如何进行预测建立一种直觉！你可以从<a class="ae jd" href="https://gist.github.com/conditg/47eb195eb1d5b80ea299c567c8d0f3bf" rel="noopener ugc nofollow" target="_blank">这个要点</a>开始一次性复制整个代码。</p></div><div class="ab cl lp lq hu lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ij ik il im in"><p id="9ae4" class="pw-post-body-paragraph kd ke jg kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="mu">LSTM 参考卡可从</em> <a class="ae jd" href="https://www.gregcondit.com/articles/lstm-ref-card" rel="noopener ugc nofollow" target="_blank"> <em class="mu">本页</em> </a> <em class="mu">下载，包括可打印版本。感谢 Mike Ricos 合作创建了这个伟大的资源。</em></p></div></div>    
</body>
</html>