<html>
<head>
<title>Deploy Machine Learning Web API using NGINX and Docker on Kubernetes in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在 Python 中的 Kubernetes 上使用 NGINX 和 Docker 部署机器学习 Web API</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/deploy-machine-learning-web-api-using-nginx-and-docker-on-kubernetes-in-python-3abcf5c0026f?source=collection_archive---------14-----------------------#2019-10-21">https://towardsdatascience.com/deploy-machine-learning-web-api-using-nginx-and-docker-on-kubernetes-in-python-3abcf5c0026f?source=collection_archive---------14-----------------------#2019-10-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/3424287018031a1851532f4e426d6bb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*oVf7bHJQR8oJ8Fpc"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">Photo by <a class="ae kf" href="https://unsplash.com/@ffstop?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Fotis Fotopoulos</a> on <a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="a739" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">几天前，我正在谷歌云平台(GCP) Kubernetes 引擎上部署机器学习预测 web API，并浏览了许多技术博客来完成我的任务。因此，我想写一步一步的指南来部署任何机器学习预测 web API，使用 Flask，Gunicorn，NGINX 在 GCP Kubernetes 引擎上的 Docker 中封装。</p><p id="8b62" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">我把这个循序渐进的教程分成了 3 个部分:</strong></p><ol class=""><li id="ba6c" class="le lf it ki b kj kk kn ko kr lg kv lh kz li ld lj lk ll lm bi translated">在第 1 节中，我们将简要讨论 Flask、Gunicorn、NGINX、Docker 和 Kubernetes 等组件，以及项目搭建和在开发机器上的设置。</li><li id="065e" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">在第 2 节中，我们将讨论 Gunicorn、supervisor、NGINX 的设置、Docker 文件的创建和 Docker 映像。</li><li id="46bd" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">在第 3 节中，我们将讨论 Kubernetes 并在 Google Kubernetes 引擎上部署 web API。</li></ol></div><div class="ab cl ls lt hx lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="im in io ip iq"><h1 id="a471" class="lz ma it bd mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw bi translated">第一节:</h1><h1 id="f276" class="lz ma it bd mb mc mx me mf mg my mi mj mk mz mm mn mo na mq mr ms nb mu mv mw bi translated">组件描述</h1><p id="5a97" class="pw-post-body-paragraph kg kh it ki b kj nc kl km kn nd kp kq kr ne kt ku kv nf kx ky kz ng lb lc ld im bi translated">我假设读者对 Python，Flask，Gunicorn，NGINX，Docker，Kubernetes，最后但并非最不重要的机器学习有基本的了解。以下是本教程中使用的组件的基本介绍，有关更多详细信息，请参考嵌入的链接:</p><ul class=""><li id="8517" class="le lf it ki b kj kk kn ko kr lg kv lh kz li ld nh lk ll lm bi translated"><a class="ae kf" href="https://opensource.com/article/18/4/flask" rel="noopener ugc nofollow" target="_blank"> <strong class="ki iu">烧瓶</strong> </a>是用 Python 写的一个微型 web 框架。它被归类为微框架，因为它不需要特殊的工具或库。它没有数据库抽象层、表单验证或任何其他组件，而现有的第三方库提供了通用功能。</li><li id="0138" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld nh lk ll lm bi translated"><a class="ae kf" href="https://www.fullstackpython.com/green-unicorn-gunicorn.html" rel="noopener ugc nofollow" target="_blank"> <strong class="ki iu"> Gunicorn </strong> </a>是众多 WSGI 服务器实现中的一个，是 web 应用部署的常用部分，为世界上一些最大的基于 Python 的 web 应用提供动力，如 Instagram。</li><li id="dbe4" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld nh lk ll lm bi translated"><a class="ae kf" href="https://www.fullstackpython.com/nginx.html" rel="noopener ugc nofollow" target="_blank"> <strong class="ki iu"> NGINX </strong> </a>常用作 web 服务器，为 web 浏览器客户端提供图片、CSS、JavaScript 等静态资产。NGINX 通常还被配置为反向代理，它将适当的传入 HTTP 请求传递给 WSGI 服务器。WSGI 服务器通过运行 Python 代码生成动态内容。当 WSGI 服务器传递它的响应(通常是 HTML、JSON 或 XML 格式)时，反向代理将结果响应给客户机。</li><li id="73cf" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld nh lk ll lm bi translated"><a class="ae kf" href="https://docker-curriculum.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="ki iu"> Docker </strong> </a>是一个开源项目，它通过在 Linux 上提供一个额外的抽象层和操作系统级虚拟化的自动化来自动化容器内软件应用程序的部署。</li><li id="3b84" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld nh lk ll lm bi translated">Kubernetes  是一个开源的容器编排系统，用于自动化部署、扩展和管理容器化的应用程序。它是一个可移植的、可扩展的平台，用于管理容器化的工作负载和服务，促进了声明式配置和自动化。</li></ul></div><div class="ab cl ls lt hx lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="im in io ip iq"><h1 id="234f" class="lz ma it bd mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw bi translated">项目脚手架</h1><figure class="nj nk nl nm gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ni"><img src="../Images/e194fae94e9590992a5e6adf78f8b0ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NjWRDtP0GzZLYajtyX-PxA.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">Project folder structure to create a docker image</figcaption></figure><ul class=""><li id="6698" class="le lf it ki b kj kk kn ko kr lg kv lh kz li ld nh lk ll lm bi translated"><strong class="ki iu"> app 文件夹:</strong>主文件夹包含所有 python 代码，如:</li></ul><p id="469c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">a.机器学习逻辑，例如数据预处理、将保存的模型加载到存储器中以及机器学习模型预测。</p><p id="51c2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">b.requirement.txt 中所有必需的 python 包</p><p id="9b60" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">c.main.py 中的所有 Flask 代码和路由</p><ul class=""><li id="94b4" class="le lf it ki b kj kk kn ko kr lg kv lh kz li ld nh lk ll lm bi translated"><strong class="ki iu"> Dockerfile: </strong>定义了容器内部环境中发生的事情。在此环境中，对网络接口和磁盘驱动器等资源的访问是虚拟化的，与系统的其他部分隔离开来，因此您需要将端口映射到外部世界，并明确要将哪些文件“复制”到该环境中。然而，这样做之后，您可以预期在 docker 文件中定义的应用程序的构建无论在哪里运行都是一样的。</li><li id="08be" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld nh lk ll lm bi translated">这个配置文件将为机器学习 flask 应用程序定义一个服务器块。</li><li id="19c3" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld nh lk ll lm bi translated"><strong class="ki iu"> gunicorn.conf: </strong>这个配置文件将执行命令在后台运行 gunicorn 应用服务器。</li><li id="bfff" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld nh lk ll lm bi translated"><strong class="ki iu"> supervisord.conf: </strong>这个配置文件将照看 Gunicorn 进程，并确保它们在出现问题时重新启动，或者确保这些进程在引导时启动。</li><li id="3f95" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld nh lk ll lm bi translated"><strong class="ki iu"> Makefile: </strong>该 Makefile 将包含所有命令，如创建和运行 docker 映像、创建 Kubernetes 集群和部署 web API。</li></ul></div><div class="ab cl ls lt hx lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="im in io ip iq"><h1 id="3897" class="lz ma it bd mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw bi translated">在开发机器上设置项目</h1><ul class=""><li id="e58e" class="le lf it ki b kj nc kn nd kr nn kv no kz np ld nh lk ll lm bi translated"><strong class="ki iu">在开发机器上安装所需的包:</strong></li></ul><pre class="nj nk nl nm gt nq nr ns nt aw nu bi"><span id="bfbc" class="nv ma it nr b gy nw nx l ny nz">$ sudo apt-get install -y python python-pip python-virtualenv nginx gunicorn supervisor</span></pre><ul class=""><li id="2cdb" class="le lf it ki b kj kk kn ko kr lg kv lh kz li ld nh lk ll lm bi translated"><strong class="ki iu">创建并激活 Python 虚拟环境:</strong></li></ul><p id="038f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Python 虚拟环境帮助我们用所需的 python 包创建特定于应用程序的环境。</p><p id="6b6f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">安装虚拟环境包:</p><pre class="nj nk nl nm gt nq nr ns nt aw nu bi"><span id="ad1d" class="nv ma it nr b gy nw nx l ny nz">$ pip install virtualenv</span></pre><p id="5eea" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">创建虚拟环境:</p><pre class="nj nk nl nm gt nq nr ns nt aw nu bi"><span id="06e6" class="nv ma it nr b gy nw nx l ny nz">$ <!-- -->virtualenv mypython</span></pre><p id="8a70" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">激活 Python 虚拟环境:</p><pre class="nj nk nl nm gt nq nr ns nt aw nu bi"><span id="e946" class="nv ma it nr b gy nw nx l ny nz">$ <!-- -->source mypython/bin/activate</span></pre><ul class=""><li id="ed48" class="le lf it ki b kj kk kn ko kr lg kv lh kz li ld nh lk ll lm bi translated"><strong class="ki iu">打造机器学习预测的 Flask app:</strong></li></ul><p id="c828" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">安装 Flask 和其他依赖项:</p><pre class="nj nk nl nm gt nq nr ns nt aw nu bi"><span id="fa5d" class="nv ma it nr b gy nw nx l ny nz">$ pip install Flask<br/>$ pip install -r requirements.txt</span></pre><p id="6fcb" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">创建机器学习推理代码:</p><p id="b71e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Flask 主要是为应用程序开发服务器创建的。我们可以在开发机器上测试 Flask API。</p><pre class="nj nk nl nm gt nq nr ns nt aw nu bi"><span id="2596" class="nv ma it nr b gy nw nx l ny nz">$ python main.py</span></pre><p id="00e4" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">不建议在生产环境中使用 Flask development server 来处理并发性和安全性。我们将使用 Gunicorn 作为 Python HTTP WSGI 服务器网关接口。</p><figure class="nj nk nl nm gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oa"><img src="../Images/d69a2503bac01bcb897301870f93cabe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RExPAYybK307hQbvobBsyA.png"/></div></div></figure></div><div class="ab cl ls lt hx lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="im in io ip iq"><h1 id="9087" class="lz ma it bd mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw bi translated">第二节</h1><figure class="nj nk nl nm gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ob"><img src="../Images/6b83190a0c7a94d4a0e78c3b5356097a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ShbkxVOiU_S_yeP-N-Cqqg.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">Architecture Diagram</figcaption></figure><ul class=""><li id="912f" class="le lf it ki b kj kk kn ko kr lg kv lh kz li ld nh lk ll lm bi translated"><strong class="ki iu">安装 Gunicorn Python 包:</strong></li></ul><pre class="nj nk nl nm gt nq nr ns nt aw nu bi"><span id="1b20" class="nv ma it nr b gy nw nx l ny nz">$ pip install gunicorn</span></pre><p id="a3b4" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">配置 gunicorn.conf 文件以配置 Gunicorn web 服务器。</p><p id="1df9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们已经将 Gunicorn web 服务器配置为监听端口 5000，并从 app 目录运行 main.py 文件。</p><ul class=""><li id="b615" class="le lf it ki b kj kk kn ko kr lg kv lh kz li ld nh lk ll lm bi translated"><strong class="ki iu">配置 supervisord 为监控进程:</strong></li></ul><p id="461e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Supervisord 允许用户在类似 UNIX 的操作系统上监视和控制几个进程。Supervisor 将负责 Gunicorn 进程，并确保它们在出现任何问题时重新启动，或者确保这些进程在引导时启动。</p><p id="2cb7" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">它将运行 NGINX 反向代理服务器，并在其上保持一个监视器。如果有任何失败，它会自动重启服务器并运行 NGINX 命令。</p><ul class=""><li id="f3e8" class="le lf it ki b kj kk kn ko kr lg kv lh kz li ld nh lk ll lm bi translated"><strong class="ki iu">设置 NGINX 服务器:</strong></li></ul><p id="f171" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">打开一个服务器块，设置 NGINX 监听默认端口<code class="fe oc od oe nr b">80</code>。用户可以设置服务器名称来处理请求。</p><ul class=""><li id="b6d2" class="le lf it ki b kj kk kn ko kr lg kv lh kz li ld nh lk ll lm bi translated"><strong class="ki iu">创建 Dockerfile: </strong></li></ul><p id="6958" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我把 Dockerfile 分成了 5 个部分。让我们简单介绍一下每一部分:</p><ol class=""><li id="189d" class="le lf it ki b kj kk kn ko kr lg kv lh kz li ld lj lk ll lm bi translated"><strong class="ki iu">创建一个 Ubuntu 环境。</strong>安装 Ubuntu，更新必要的包。安装 python、pip、虚拟环境、NGINX、Gunicorn、supervisor。</li><li id="522c" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated"><strong class="ki iu">设置烧瓶应用程序。</strong>做一个目录“/deploy.app”。将所有文件从“app”文件夹复制到“/deploy/app”文件夹。安装所有需要的 python 包。</li><li id="bf9b" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated"><strong class="ki iu">设置 NGINX。</strong>删除默认 NGINX 配置。将烧瓶配置复制到 NGINX 配置。为 NGINX 烧瓶配置创建一个符号链接。</li><li id="8138" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated"><strong class="ki iu">设置主管。</strong>做一个目录“/var/log/supervisor”。将 Gunicorn 和 supervisord 配置复制到新创建的目录中。</li><li id="8691" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">启动监控程序进行监控。</li></ol><ul class=""><li id="cd69" class="le lf it ki b kj kk kn ko kr lg kv lh kz li ld nh lk ll lm bi translated"><strong class="ki iu">构建并运行 docker 映像来测试生产就绪的 ML web API: </strong></li></ul><p id="eb4b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我已经创建了一个 makefile 来运行所有的命令。</p><p id="4a0c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下面的 Makefile 执行两个操作:</p><ol class=""><li id="354f" class="le lf it ki b kj kk kn ko kr lg kv lh kz li ld lj lk ll lm bi translated">创建 docker 图像</li><li id="4e58" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">在端口 80 上运行 docker 映像</li></ol><p id="1008" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">运行 Makefile:</p><pre class="nj nk nl nm gt nq nr ns nt aw nu bi"><span id="24e4" class="nv ma it nr b gy nw nx l ny nz">deploy-local:</span><span id="8a20" class="nv ma it nr b gy of nx l ny nz">#build docker image<br/>docker build -t gcr.io/${project_id}/${image_name}:${version} .</span><span id="d58b" class="nv ma it nr b gy of nx l ny nz">#run docker image<br/>docker run -d --name ${image_name} -p $(port):$(port) gcr.io/${project_id}/${image_name}:${version}</span></pre><ul class=""><li id="d523" class="le lf it ki b kj kk kn ko kr lg kv lh kz li ld nh lk ll lm bi translated">在开发机器上使用 Postman 测试生产就绪的 web API，网址:<a class="ae kf" href="http://127.0.0.1/predict" rel="noopener ugc nofollow" target="_blank">http://127 . 0 . 0 . 1/predict</a></li></ul><p id="f536" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在上一节中，我们已经学习了如何在开发机器上构建和运行 ML web API docker 映像。</p></div><div class="ab cl ls lt hx lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="im in io ip iq"><h1 id="ca4a" class="lz ma it bd mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw bi translated">第三节</h1><p id="e27f" class="pw-post-body-paragraph kg kh it ki b kj nc kl km kn nd kp kq kr ne kt ku kv nf kx ky kz ng lb lc ld im bi translated">在本节中，我们将学习如何在 GCP Kubernetes 引擎上部署这个容器化的 NGINX，并为生产环境公开 API。</p><ol class=""><li id="a158" class="le lf it ki b kj kk kn ko kr lg kv lh kz li ld lj lk ll lm bi translated">构建机器学习应用程序的容器映像，并对其进行标记以便上传</li></ol><pre class="nj nk nl nm gt nq nr ns nt aw nu bi"><span id="aade" class="nv ma it nr b gy nw nx l ny nz">#Set variables value as per your project<br/>$ docker build -t gcr.io/${project_id}/${image_name}:${version} .</span></pre><p id="1609" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">2.使用 gcloud 命令行工具，安装 Kubernetes CLI。Kubectl 用于与 Kubernetes 通信，Kubernetes 是 GKE 集群的集群编排系统</p><pre class="nj nk nl nm gt nq nr ns nt aw nu bi"><span id="2c0e" class="nv ma it nr b gy nw nx l ny nz">$ gcloud components install kubectl</span></pre><p id="b545" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">3.使用 gcloud 命令行工具，安装 Kubernetes CLI。Kubectl 用于与 Kubernetes 通信，Kubernetes 是 GKE 集群的集群编排系统</p><pre class="nj nk nl nm gt nq nr ns nt aw nu bi"><span id="7ba3" class="nv ma it nr b gy nw nx l ny nz">$ gcloud components install kubectl</span></pre><p id="8ea5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">4.配置 Docker 命令行工具以向容器注册表进行身份验证</p><pre class="nj nk nl nm gt nq nr ns nt aw nu bi"><span id="39d3" class="nv ma it nr b gy nw nx l ny nz">$ gcloud auth configure-docker</span></pre><p id="a80f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">5.使用 Docker 命令行工具将图像上传到容器注册中心</p><pre class="nj nk nl nm gt nq nr ns nt aw nu bi"><span id="fce8" class="nv ma it nr b gy nw nx l ny nz">#Set variables value as per your project<br/>$ docker push gcr.io/${project_id}/${image_name}:${version}</span></pre><p id="cb7c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">6.使用 gcloud 命令行工具并设置项目 id</p><pre class="nj nk nl nm gt nq nr ns nt aw nu bi"><span id="314e" class="nv ma it nr b gy nw nx l ny nz">$ gcloud config set project ${project_id}</span></pre><p id="5ff5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">7.使用 gcloud 命令行工具并设置区域</p><pre class="nj nk nl nm gt nq nr ns nt aw nu bi"><span id="ef1b" class="nv ma it nr b gy nw nx l ny nz">$ gcloud config set compute/zone ${zone}</span></pre><p id="9572" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">8.在 GCP 上创建一个名为 ML-API-cluster-nginx 的单节点 Kubernetes 集群</p><pre class="nj nk nl nm gt nq nr ns nt aw nu bi"><span id="19f9" class="nv ma it nr b gy nw nx l ny nz">$ gcloud container ${cluster_name} create machine-learning-api --num-nodes=1</span></pre><p id="4a6f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">9.部署机器学习应用程序，监听端口 80</p><pre class="nj nk nl nm gt nq nr ns nt aw nu bi"><span id="3ee2" class="nv ma it nr b gy nw nx l ny nz">$ kubectl run ${image_name} --image=gcr.io/${project_id}/${image_name}:v1 --port 80</span></pre><p id="fd5e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">10.将机器学习应用程序暴露给来自互联网的流量</p><pre class="nj nk nl nm gt nq nr ns nt aw nu bi"><span id="4578" class="nv ma it nr b gy nw nx l ny nz">$ kubectl expose deployment ${image_name} --type=LoadBalancer --port $(port) --target-port $(port)</span></pre><p id="d3fd" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">使用 curl 命令或 Postman 测试部署的机器学习 Web API。</p><p id="9387" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我希望这能给你一个说明性的指南，用 Python 在 Kubernetes 上使用 NGINX 和 Docker 部署机器学习 Web API。</p><p id="feae" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">来源:</strong></p><ol class=""><li id="b54c" class="le lf it ki b kj kk kn ko kr lg kv lh kz li ld lj lk ll lm bi translated">https://opensource.com/article/18/4/flask<a class="ae kf" href="https://opensource.com/article/18/4/flask" rel="noopener ugc nofollow" target="_blank"/></li><li id="a9e0" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated">【https://www.fullstackpython.com/green-unicorn-gunicorn.html T4】</li><li id="275a" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated"><a class="ae kf" href="https://www.fullstackpython.com/nginx.html" rel="noopener ugc nofollow" target="_blank">https://www.fullstackpython.com/nginx.html</a></li><li id="6860" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated"><a class="ae kf" href="https://docker-curriculum.com/" rel="noopener ugc nofollow" target="_blank">https://docker-curriculum.com/</a></li><li id="3639" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated"><a class="ae kf" href="https://www.digitalocean.com/community/tutorials/an-introduction-to-kubernetes" rel="noopener ugc nofollow" target="_blank">https://www . digital ocean . com/community/tutorials/an-introduction-to-kubernetes</a></li><li id="eb1b" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated"><a class="ae kf" href="https://cloud.google.com/kubernetes-engine/docs/how-to/exposing-apps" rel="noopener ugc nofollow" target="_blank">https://cloud . Google . com/kubernetes-engine/docs/how-to/exposure-apps</a></li><li id="75ff" class="le lf it ki b kj ln kn lo kr lp kv lq kz lr ld lj lk ll lm bi translated"><a class="ae kf" href="https://cloud.google.com/kubernetes-engine/docs/tutorials/hello-app" rel="noopener ugc nofollow" target="_blank">https://cloud . Google . com/kubernetes-engine/docs/tutorials/hello-app</a></li></ol><p id="7d02" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">快乐学习！！！</strong></p></div></div>    
</body>
</html>