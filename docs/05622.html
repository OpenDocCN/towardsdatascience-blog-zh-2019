<html>
<head>
<title>Improving the Stack Overflow search algorithm using Semantic Search and NLP</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">利用语义搜索和自然语言处理改进栈溢出搜索算法</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/improving-the-stack-overflow-search-algorithm-using-semantic-search-and-nlp-a23e20091d4c?source=collection_archive---------7-----------------------#2019-08-18">https://towardsdatascience.com/improving-the-stack-overflow-search-algorithm-using-semantic-search-and-nlp-a23e20091d4c?source=collection_archive---------7-----------------------#2019-08-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/bd7fb40df97c743479510524867018e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ROagAxRi9uL-jeFLy5wQEQ.png"/></div></div></figure><p id="7514" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果你是一个曾经尝试过编写一段代码的人，你肯定会遇到<strong class="kd iu">栈溢出</strong>(这很有名)。对于那些生活在岩石下的人来说，<strong class="kd iu">栈溢出</strong>为程序员提供了一个最大的 QA 平台。用户提出问题/疑问，他们的同伴试图以最有帮助的方式提供解决方案。答案越好，得到的票数就越高，这也提高了用户的声誉。</p><p id="5b1f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">鉴于它的受欢迎程度，可以肯定地说，那里有大量的数据。然而，这种巨大的信息量也使得人们很难找到自己想要的解决方案。对于编程老手和其他有经验的专业人士来说，这并不是什么大问题，因为他们知道获得适当答案所需的正确关键字。然而，对于一个初级程序员来说，这是一个很大的问题。例如，如果他需要学习使用 Python 的<em class="kz">‘如何制作服务器’</em>，他不太可能在搜索框中使用术语<em class="kz">‘Django’</em>或<em class="kz">‘Flask’</em>。因此，这可能会威胁用户使用该平台。</p><p id="20dc" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">因此，一个最佳的搜索引擎是必要的导航通过这个烂摊子。然而，就目前的情况来看，Stack Overflow 的搜索引擎也有一些自身的缺陷。让我举个例子来说明:</p><blockquote class="la lb lc"><p id="eb4c" class="kb kc kz kd b ke kf kg kh ki kj kk kl ld kn ko kp le kr ks kt lf kv kw kx ky im bi translated">假设我是 NodeJS 的初学者，我想运行我的应用程序。因此，我转到 Stack Overflow 并键入以下内容:<em class="it">‘Node—如何运行 Node app . js？’</em>。这是我得到的:</p></blockquote><figure class="lh li lj lk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi lg"><img src="../Images/8da0b247b33586b19bf35aeea86d230e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QmqzNCbNT9uS2bXy-VZCZg.png"/></div></div></figure><blockquote class="la lb lc"><p id="6dfb" class="kb kc kz kd b ke kf kg kh ki kj kk kl ld kn ko kp le kr ks kt lf kv kw kx ky im bi translated"><strong class="kd iu">但是</strong>确实存在<em class="it">节点——如何运行 app.js 的结果:</em></p></blockquote><figure class="lh li lj lk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ll"><img src="../Images/58b49f583095b5778102e28eda848706.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1aFH-vtb-Whyf0QM6oeHWA.png"/></div></div></figure><blockquote class="la lb lc"><p id="b9d2" class="kb kc kz kd b ke kf kg kh ki kj kk kl ld kn ko kp le kr ks kt lf kv kw kx ky im bi translated">理想情况下，它应该返回两个查询的结果，但是没有。</p></blockquote><p id="6217" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">休斯敦，我们有麻烦了 T19】</p><p id="a94e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> <em class="kz">但你问，何必呢？</em> </strong>栈溢出的主要收入来源是通过<strong class="kd iu">广告收入</strong>。因此，他们的目标是最大限度地提高用户参与度，以推动更多的广告，从而赚更多的钱。由于他们的搜索引擎的次优性能，用户将很难通过他们的网站清除他的疑虑，因此将决定使用更复杂的搜索引擎，如谷歌。</p><p id="0195" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">当谷歌建议使用 Stackoverflow 之外的资源时，问题就出现了。对于每一个离开他们网站的用户来说，他们损失了他们本可以赚到的钱。</p><h1 id="bc78" class="lm ln it bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">一个可能的解决方案</h1><p id="bd0c" class="pw-post-body-paragraph kb kc it kd b ke mk kg kh ki ml kk kl km mm ko kp kq mn ks kt ku mo kw kx ky im bi translated">我们的目标是让平台真正理解用户试图搜索的内容，然后基于此返回最相似的结果。</p><p id="c26f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">自 20 世纪问世以来，自然语言处理(NLP)已经走过了漫长的道路。由于快速的处理器和复杂的模型架构，人工智能的这个子领域在过去几年中已经被证明工作得非常好，因此在解决各种语言理解任务方面具有巨大的潜力。</p><figure class="lh li lj lk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mp"><img src="../Images/789f63542f1c9a4176130c711286a420.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ALEVW9iC6isjxjV0iW23sA.png"/></div></div><figcaption class="mq mr gj gh gi ms mt bd b be z dk">Sneak Peek into of the final result</figcaption></figure><p id="a752" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">(要观看动画版本，点击<a class="ae mu" href="https://s3.gifyu.com/images/demo6e6ebf7bfc9642ae.gif" rel="noopener ugc nofollow" target="_blank">这里</a></p><p id="db72" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">该解决方案分为两个子任务:</p><ol class=""><li id="c732" class="mv mw it kd b ke kf ki kj km mx kq my ku mz ky na nb nc nd bi translated"><strong class="kd iu"> <em class="kz">标签预测:</em> </strong>给定用户查询，我们希望预测给定查询最好属于哪些标签</li><li id="15a0" class="mv mw it kd b ke ne ki nf km ng kq nh ku ni ky na nb nc nd bi translated"><strong class="kd iu"> <em class="kz">信息检索:</em> </strong>基于用户查询，返回与用户查询最相似的现有问题</li></ol><p id="2d72" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">给你一个鸟瞰图，解决方案的流程如下:</p><ul class=""><li id="32ca" class="mv mw it kd b ke kf ki kj km mx kq my ku mz ky nj nb nc nd bi translated">从 Google BigQuery 收集 Stackoverflow 问题/答案数据</li><li id="8c52" class="mv mw it kd b ke ne ki nf km ng kq nh ku ni ky nj nb nc nd bi translated">预处理和标准化收集的数据</li><li id="0889" class="mv mw it kd b ke ne ki nf km ng kq nh ku ni ky nj nb nc nd bi translated">仅过滤掉最常见的标签(使用了 500 个标签)</li><li id="117a" class="mv mw it kd b ke ne ki nf km ng kq nh ku ni ky nj nb nc nd bi translated">使用 Word2Vec 训练单词嵌入</li><li id="4855" class="mv mw it kd b ke ne ki nf km ng kq nh ku ni ky nj nb nc nd bi translated">使用 LSTM 模型训练标签分类器(<em class="kz">提示:您不能使用二进制交叉熵损失来训练它。阅读更多了解原因</em></li><li id="a1ef" class="mv mw it kd b ke ne ki nf km ng kq nh ku ni ky nj nb nc nd bi translated">使用经过训练的单词嵌入来为我们数据库中的所有问题创建句子嵌入</li><li id="6b3a" class="mv mw it kd b ke ne ki nf km ng kq nh ku ni ky nj nb nc nd bi translated">将查询与每个句子进行比较，并使用基于余弦距离的度量对语义相似的结果进行排序。</li><li id="d3d4" class="mv mw it kd b ke ne ki nf km ng kq nh ku ni ky nj nb nc nd bi translated">使用 ReactJS 和 Flask 创建 web 应用程序来部署训练好的模型</li></ul><p id="7932" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">对于有流程图癖的人来说，这里有:</p><figure class="lh li lj lk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nk"><img src="../Images/0025b73d08906e3aca80cf9fad9f8390.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xTTQqRgl4UbsBcv5wi6-OA.png"/></div></div><figcaption class="mq mr gj gh gi ms mt bd b be z dk">The Brain</figcaption></figure></div><div class="ab cl nl nm hx nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="im in io ip iq"><figure class="lh li lj lk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ns"><img src="../Images/7b9ebfb9ebad134aa112a43bc0f77e68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cHuNsOwhKJYRUoPsfSQOHA.png"/></div></div><figcaption class="mq mr gj gh gi ms mt bd b be z dk">The web app architecture</figcaption></figure><p id="7469" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">不要太花哨，对吗？如果您熟悉这些概念中的每一个，请随意直接进入代码(它也有很好的文档记录*codegasm*)。</p><div class="nt nu gp gr nv nw"><a href="https://github.com/agrawal-rohit/stackoverflow-semantic-search" rel="noopener  ugc nofollow" target="_blank"><div class="nx ab fo"><div class="ny ab nz cl cj oa"><h2 class="bd iu gy z fp ob fr fs oc fu fw is bi translated">agr awal-rohit/stack overflow-语义搜索</h2><div class="od l"><h3 class="bd b gy z fp ob fr fs oc fu fw dk translated">Team Maverick 的 IBM Hack Challenge Stack overflow 条目为……提供了最大的学习资源之一</h3></div><div class="oe l"><p class="bd b dl z fp ob fr fs oc fu fw dk translated">github.com</p></div></div><div class="of l"><div class="og l oh oi oj of ok jz nw"/></div></div></a></div><p id="9ab4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">宝贝程序员们，请继续阅读:)</p><blockquote class="la lb lc"><p id="7146" class="kb kc kz kd b ke kf kg kh ki kj kk kl ld kn ko kp le kr ks kt lf kv kw kx ky im bi translated"><strong class="kd iu">小旁注:</strong>我不会在文章中解释每一行代码(repo 中的 jupyter 笔记本已经考虑到了这一点)。相反，我会专注于关键的结果和它们背后的直觉</p></blockquote></div><div class="ab cl nl nm hx nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="im in io ip iq"><h2 id="2d60" class="ol ln it bd lo om on dn ls oo op dp lw km oq or ma kq os ot me ku ou ov mi ow bi translated">1.数据收集</h2><p id="2105" class="pw-post-body-paragraph kb kc it kd b ke mk kg kh ki ml kk kl km mm ko kp kq mn ks kt ku mo kw kx ky im bi translated">为了理解数据并从中学习，我需要收集 Stack Overflow 上发布的问题和答案。因此，我需要以下内容:</p><ul class=""><li id="7311" class="mv mw it kd b ke kf ki kj km mx kq my ku mz ky nj nb nc nd bi translated">标题</li><li id="f1e0" class="mv mw it kd b ke ne ki nf km ng kq nh ku ni ky nj nb nc nd bi translated">问题主体</li><li id="46a5" class="mv mw it kd b ke ne ki nf km ng kq nh ku ni ky nj nb nc nd bi translated">这个问题的答案</li><li id="f41d" class="mv mw it kd b ke ne ki nf km ng kq nh ku ni ky nj nb nc nd bi translated">为每个答案投票</li></ul><blockquote class="la lb lc"><p id="5af7" class="kb kc kz kd b ke kf kg kh ki kj kk kl ld kn ko kp le kr ks kt lf kv kw kx ky im bi translated">由于关于堆栈溢出和更好的健全性检查的大量数据，我将数据限制为仅与“Python”相关的问题。然而，整个过程对于其他主题也是可重复的</p></blockquote><p id="863d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> Google BigQuery </strong>数据集包括堆栈溢出内容的档案，包括帖子、投票、标签和徽章。该数据集被更新以反映互联网档案上的堆栈溢出内容，并且也可通过堆栈交换数据浏览器获得。关于数据集的更多信息在<a class="ae mu" href="https://www.kaggle.com/stackoverflow/stackoverflow" rel="noopener ugc nofollow" target="_blank"> Kaggle Stackoverflow 数据集</a>中给出</p><p id="7cf3" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们的任务所需的数据可以通过以下 SQL 查询来收集:</p><pre class="lh li lj lk gt ox oy oz pa aw pb bi"><span id="0019" class="ol ln it oy b gy pc pd l pe pf"><em class="kz">SELECT q.id, q.title, q.body, q.tags, a.body as answers, a.score FROM 'bigquery-public-data.stackoverflow.posts_questions' AS q INNER JOIN 'bigquery-public-data.stackoverflow.posts_answers' AS a ON q.id = a.parent_id WHERE q.tags LIKE '%python%' LIMIT 500000</em></span></pre><figure class="lh li lj lk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi pg"><img src="../Images/ff8cbc808582b2bbb497cddeb6071165.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ed-xs2_cvTtRxXthZcSQvw.png"/></div></div><figcaption class="mq mr gj gh gi ms mt bd b be z dk">Raw Data from Google BigQuery</figcaption></figure><p id="479b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">该查询连接两个表(<em class="kz">stack overflow . posts _ questions</em>和<em class="kz">stack overflow . posts _ answers</em>)并收集与<code class="fe ph pi pj oy b">python</code>相关的 500000 个<em class="kz"> </em>问题所需的数据。因此，每行包含一个问题和一个答案。<em class="kz"> ( </em> <strong class="kd iu"> <em class="kz">注:</em> </strong> <em class="kz">可能存在问题相同但答案唯一的行)。</em></p></div><div class="ab cl nl nm hx nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="im in io ip iq"><h2 id="a3c9" class="ol ln it bd lo om on dn ls oo op dp lw km oq or ma kq os ot me ku ou ov mi ow bi translated">2.数据预处理和标准化</h2><p id="1901" class="pw-post-body-paragraph kb kc it kd b ke mk kg kh ki ml kk kl km mm ko kp kq mn ks kt ku mo kw kx ky im bi translated">数据预处理 101 —检查缺失值:</p><pre class="lh li lj lk gt ox oy oz pa aw pb bi"><span id="0fba" class="ol ln it oy b gy pc pd l pe pf">df.isna().sum()<br/>--------------</span><span id="b379" class="ol ln it oy b gy pk pd l pe pf">id         0<br/>title      0<br/>body       0<br/>tags       0<br/>answers    0<br/>score      0<br/>dtype: int64</span></pre><p id="538c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">正如我之前提到的，我们的数据集可能包含具有相同问题但唯一答案的行。我们希望将所有这些不同的行合并为一行，同时汇总每个答案的投票并合并所有答案。</p><figure class="lh li lj lk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi pl"><img src="../Images/3883b625a5063c21178ab4ef12fbad27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wzPMfS7KcyLwjXEZ1bCQ3g.png"/></div></div><figcaption class="mq mr gj gh gi ms mt bd b be z dk">Data after combing rows with identical questions</figcaption></figure><pre class="lh li lj lk gt ox oy oz pa aw pb bi"><span id="5686" class="ol ln it oy b gy pc pd l pe pf">Max score before:  5440 <br/>Max score after:  9730</span></pre><p id="a3f3" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在我们终于准备好了原始数据，我们可以继续清理和预处理这些原始文本数据了。我实现了基本的文本处理，包括以下步骤:</p><ol class=""><li id="2955" class="mv mw it kd b ke kf ki kj km mx kq my ku mz ky na nb nc nd bi translated">将原始文本转换为令牌</li><li id="7331" class="mv mw it kd b ke ne ki nf km ng kq nh ku ni ky na nb nc nd bi translated">将令牌转换为小写</li><li id="5138" class="mv mw it kd b ke ne ki nf km ng kq nh ku ni ky na nb nc nd bi translated">删除标点符号</li><li id="850d" class="mv mw it kd b ke ne ki nf km ng kq nh ku ni ky na nb nc nd bi translated">删除停用词</li></ol><blockquote class="la lb lc"><p id="dc88" class="kb kc kz kd b ke kf kg kh ki kj kk kl ld kn ko kp le kr ks kt lf kv kw kx ky im bi translated"><strong class="kd iu">注意:</strong>我跳过了删除数字数据，因为我觉得这会删除宝贵的上下文信息。</p><p id="b462" class="kb kc kz kd b ke kf kg kh ki kj kk kl ld kn ko kp le kr ks kt lf kv kw kx ky im bi translated">我还跳过了<strong class="kd iu">‘词干化/词汇化’</strong>这一步，因为我不想改变我们语料库中使用的特定领域术语，以免丢失宝贵的信息</p></blockquote><p id="bb08" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果您仔细观察数据集，您会发现问题和答案的原始文本是与 HTML 标记一起给出的，它最初是用 HTML 标记显示在 StackOverflow 上的。这些通常指的是<code class="fe ph pi pj oy b">p</code>标签<em class="kz">、</em>、<code class="fe ph pi pj oy b"><em class="kz">h1-h6</em></code>、<em class="kz">、</em>标签和<em class="kz">、</em>、<em class="kz">、</em>标签。因为我只需要每篇文章的文本部分，所以我执行了以下步骤:</p><ul class=""><li id="7dfe" class="mv mw it kd b ke kf ki kj km mx kq my ku mz ky nj nb nc nd bi translated">我通过组合标题、问题主体和所有答案(稍后将用于训练 Word2Vec 嵌入)构建了一个名为“post_corpus”的新特性列</li><li id="9b2b" class="mv mw it kd b ke ne ki nf km ng kq nh ku ni ky nj nb nc nd bi translated">我把标题加在问题正文的前面</li><li id="3aa4" class="mv mw it kd b ke ne ki nf km ng kq nh ku ni ky nj nb nc nd bi translated">我跳过了“代码”部分，因为它们没有为我们的任务提供有用的信息</li><li id="3fbe" class="mv mw it kd b ke ne ki nf km ng kq nh ku ni ky nj nb nc nd bi translated">我为每个问题构造了 URL，在问题 id 后面附加了“【https://stackoverflow.com/questions/】T2</li><li id="1826" class="mv mw it kd b ke ne ki nf km ng kq nh ku ni ky nj nb nc nd bi translated">我使用开源的<strong class="kd iu">文本块库</strong>为情感构建了两个特征</li></ul><figure class="lh li lj lk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi pm"><img src="../Images/db0348e8ad4f816a1f8832b7492a6500.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_QGayY0x_r1lbOYMsvk-KA.png"/></div></div><figcaption class="mq mr gj gh gi ms mt bd b be z dk">Preprocessed Data</figcaption></figure><p id="e383" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">每篇文章都有不同数量的标签。为了缩小更精确模型的选择范围，我决定用<strong class="kd iu"> 20 个最常见的标签。</strong>计划仅过滤包含至少一个 most_common_tags 的数据</p><pre class="lh li lj lk gt ox oy oz pa aw pb bi"><span id="9abf" class="ol ln it oy b gy pc pd l pe pf">['python',  'python-3.x',  'django',  'pandas',  'python-2.7',  'numpy',  'list',  'matplotlib',  'dictionary',  'regex',  'dataframe',  'tkinter',  'string',  'csv',  'flask',  'arrays',  'tensorflow',  'json',  'beautifulsoup',  'selenium']</span></pre><p id="4e28" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">好了，最后一个快速枯燥的数据处理步骤，然后我们开始有趣的事情:)</p><ul class=""><li id="e5d5" class="mv mw it kd b ke kf ki kj km mx kq my ku mz ky nj nb nc nd bi translated">我为“processed_title”创建了一个单独的列，因为我想保留原始标题，因为我想在应用程序中提供原始标题</li><li id="2c21" class="mv mw it kd b ke ne ki nf km ng kq nh ku ni ky nj nb nc nd bi translated">我还标准化了数字“分数”</li></ul><figure class="lh li lj lk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi pn"><img src="../Images/6dcbe4b2afa536ccb1e35271149eb845.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sS5iYU6x7HAP8GiXBdQDXg.png"/></div></div><figcaption class="mq mr gj gh gi ms mt bd b be z dk">Preprocessed and Normalized Data</figcaption></figure></div><div class="ab cl nl nm hx nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="im in io ip iq"><h2 id="ccbe" class="ol ln it bd lo om on dn ls oo op dp lw km oq or ma kq os ot me ku ou ov mi ow bi translated">3.仅过滤掉最常见的标签</h2><figure class="lh li lj lk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi po"><img src="../Images/dc642efb67872cd3368c668b68b6248e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vVOn3SFbS3iWa8DKHRLuUQ.png"/></div></div></figure><p id="3faf" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">尽管我们在数据处理步骤中确实过滤掉了许多标签，但是仍然存在许多<strong class="kd iu"> <em class="kz">【杂散】</em> </strong>标签，与其他标签成千上万次的出现相比，这些标签可能只出现一次或两次。这增加了地面真实数据的维度，这对于我们的模型是不期望的。</p><p id="2bd6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">因此，我们根据出现的次数提取前 500 个标签。(<em class="kz">考虑到我们有大约 140，000 个数据点，500 个标签似乎是一个很好的实验数字</em></p><p id="ead5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">最后，我们修改了标签数据，使其只包含这 500 个标签中的一个标签，以获得更好的模型准确性</p></div><div class="ab cl nl nm hx nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="im in io ip iq"><h2 id="c665" class="ol ln it bd lo om on dn ls oo op dp lw km oq or ma kq os ot me ku ou ov mi ow bi translated">4.使用 Word2Vec 训练单词嵌入</h2><p id="63fd" class="pw-post-body-paragraph kb kc it kd b ke mk kg kh ki ml kk kl km mm ko kp kq mn ks kt ku mo kw kx ky im bi translated">为了让我们的模型理解原始文本数据，我们需要对它进行矢量化。单词包和 TF-IDF 是非常常见的矢量化方法。然而，由于我将使用人工神经网络作为我的模型(LSTM)，BOW 和 TFIDF 的稀疏特性会造成问题。<strong class="kd iu">因此，我决定选择单词嵌入</strong>，这是密集的向量表示，因此非常适合我们的神经网络。</p><p id="41fe" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">人们在 StackOverflow 上交谈的方式是非常技术性的，他们使用非常特定的词汇，所以使用预先训练的单词嵌入不是一个好主意(尽管谷歌有很多好的嵌入)，因为他们是在简单的英语文本(如莎士比亚)上训练的，无法理解我们词汇表中单词之间的关系。因此，我决定使用 Word2Vec 从头开始训练一个单词嵌入模型。</p><p id="ab94" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们数据集中的列<code class="fe ph pi pj oy b">post_corpus</code>在这里开始发光。由于 Word2Vec 是一个无监督的模型，只需要一个语料库进行训练，我们需要为它提供尽可能多的文本，以便它理解词汇表。因此，我们使用<code class="fe ph pi pj oy b">post_corpus</code>来训练 Word2Vec，因为它是一篇文章的标题、问题和所有答案的组合。</p><p id="595a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">训练成功后，我们得到以下结果:</p><pre class="lh li lj lk gt ox oy oz pa aw pb bi"><span id="6424" class="ol ln it oy b gy pc pd l pe pf">Terms most similar to "django"<br/>[('flask', 0.5827779173851013), ('project', 0.5168731212615967), ('mezzanine', 0.5122816562652588), ('wagtail', 0.5001770257949829), ('drf', 0.4827461242675781), ('framework', 0.48031285405158997), ('cms', 0.47275760769844055), ('admin', 0.467496395111084), ('database', 0.4659809470176697), ('app', 0.46219539642333984)]<br/>--------------------------------------------------------------------<br/>Terms most similar to "api"<br/>[('apis', 0.6121899485588074), ('webservice', 0.5226354598999023), ('service', 0.49891555309295654), ('framework', 0.4883273243904114), ('postman', 0.47500693798065186), ('webhook', 0.4574393630027771), ('rpc', 0.4385871887207031), ('oauth2', 0.41829735040664673), ('twilio', 0.4138619303703308), ('application', 0.4100519120693207)]<br/>--------------------------------------------------------------------<br/>Terms most similar to "gunicorn"<br/>[('uwsgi', 0.5529206991195679), ('nginx', 0.5103358030319214), ('000080', 0.4971828758716583), ('supervisord', 0.4751521050930023), ('arbiterpy', 0.4701758027076721), ('iis', 0.46567484736442566), ('apache2', 0.45948249101638794), ('web1', 0.45084959268569946), ('fastcgi', 0.43996310234069824), ('supervisor', 0.43604230880737305)]<br/>--------------------------------------------------------------------<br/>Terms most similar to "server"<br/>[('webserver', 0.5781407356262207), ('servers', 0.48877859115600586), ('application', 0.488214373588562), ('app', 0.4767988622188568), ('vps', 0.4679219126701355), ('client', 0.46672070026397705), ('localhost', 0.46468669176101685), ('service', 0.457424521446228), ('apache', 0.4540043771266937), ('nginx', 0.4490607976913452)]</span></pre><p id="c4cb" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">很酷，对吧？</p></div><div class="ab cl nl nm hx nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="im in io ip iq"><h2 id="e4b2" class="ol ln it bd lo om on dn ls oo op dp lw km oq or ma kq os ot me ku ou ov mi ow bi translated">5.使用 LSTM 模型训练标签分类器</h2><p id="6529" class="pw-post-body-paragraph kb kc it kd b ke mk kg kh ki ml kk kl km mm ko kp kq mn ks kt ku mo kw kx ky im bi translated">这一部分处理我们的第一个子任务:</p><p id="37a3" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> <em class="kz">“给定用户查询，我们希望预测给定查询最好属于哪个标签”</em> </strong></p><p id="03ee" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">准备用于训练模型的数据包括:</p><ol class=""><li id="5eef" class="mv mw it kd b ke kf ki kj km mx kq my ku mz ky na nb nc nd bi translated">对地面真实数据进行一次性编码</li><li id="97a1" class="mv mw it kd b ke ne ki nf km ng kq nh ku ni ky na nb nc nd bi translated">分成训练集和测试集</li><li id="5e18" class="mv mw it kd b ke ne ki nf km ng kq nh ku ni ky na nb nc nd bi translated">标记化和填充</li><li id="6df1" class="mv mw it kd b ke ne ki nf km ng kq nh ku ni ky na nb nc nd bi translated">创建嵌入矩阵</li></ol><p id="8aaa" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">(我将在这里包含代码，但是对于每个部分的详细解释，请参考存储库中的<a class="ae mu" href="https://github.com/agrawal-rohit/stackoverflow-semantic-search/blob/master/Tag%20Classifier.ipynb" rel="noopener ugc nofollow" target="_blank"> jupyter 笔记本</a>)</p><p id="b36b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">为解决手头的子任务而创建的模型在嵌入层之后立即使用了 LSTM 层，因为它们在处理顺序数据和文本数据方面很熟练。随后添加密集图层，并去除正则化以构建稳健的模型</p><p id="7ffb" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">秘方——损失函数:</strong>由于我们在这里处理的是多标签分类问题，<strong class="kd iu">我们不能使用二进制交叉熵损失</strong>来训练模型。这是因为二进制交叉熵损失会推动你的模型预测一个或两个包含在地面真相中的标签，而不会因为遗漏了其他标签而惩罚它。</p><p id="452c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">因此，我分别对每个类使用日志损失，然后根据类的数量计算其平均值。</p><figure class="lh li lj lk gt ju gh gi paragraph-image"><div class="gh gi pp"><img src="../Images/081b81df23186b9dcda81bc5343d5568.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*FK1KfN5A2JwkZdcI.png"/></div><figcaption class="mq mr gj gh gi ms mt bd b be z dk">The loss function used</figcaption></figure><figure class="lh li lj lk gt ju gh gi paragraph-image"><div class="gh gi pq"><img src="../Images/ceef0342109f96ca9cad10571b413b72.png" data-original-src="https://miro.medium.com/v2/resize:fit:756/format:webp/1*_wVPbJ4ZYDE2HEsKlBVBeA.png"/></div><figcaption class="mq mr gj gh gi ms mt bd b be z dk">Model Performance</figcaption></figure><p id="c6db" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后，我们可以借助下面的函数获得任何句子的标签:</p><pre class="lh li lj lk gt ox oy oz pa aw pb bi"><span id="c0d0" class="ol ln it oy b gy pc pd l pe pf">Test Case: selecting n1d array nd array numpy<br/>--------------------------------------------------------------------<br/>Predicted: [('arrays', 'numpy', 'python')]<br/>Ground Truth: [('numpy', 'python')]<br/></span><span id="a346" class="ol ln it oy b gy pk pd l pe pf">Test Case: taking info file<br/>--------------------------------------------------------------------<br/>Predicted: [('python',)]<br/>Ground Truth: [('python', 'python-2.6', 'python-2.7')]<br/></span><span id="a347" class="ol ln it oy b gy pk pd l pe pf">Test Case: python find txt continue causing fault<br/>--------------------------------------------------------------------<br/>Predicted: [('python',)]<br/>Ground Truth: [('python', 'python-3.x')]<br/></span><span id="12f9" class="ol ln it oy b gy pk pd l pe pf">Test Case: fabric rsync read error connection reset peer 104<br/>--------------------------------------------------------------------<br/>Predicted: [('django', 'python')]<br/>Ground Truth: [('django', 'python', 'windows')]<br/></span><span id="7fe6" class="ol ln it oy b gy pk pd l pe pf">Test Case: fllter pandas dataframe multiple columns<br/>--------------------------------------------------------------------<br/>Predicted: [('dataframe', 'pandas', 'python')]<br/>Ground Truth: [('pandas', 'python')]</span></pre><p id="ba04" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">目前看来已经足够好了😃。完成这个子任务后，进入下一个任务</p></div><div class="ab cl nl nm hx nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="im in io ip iq"><h2 id="13d2" class="ol ln it bd lo om on dn ls oo op dp lw km oq or ma kq os ot me ku ou ov mi ow bi translated">6.使用经过训练的单词嵌入来为我们数据库中的所有问题创建句子嵌入</h2><p id="6734" class="pw-post-body-paragraph kb kc it kd b ke mk kg kh ki ml kk kl km mm ko kp kq mn ks kt ku mo kw kx ky im bi translated">子任务 2 要求如下:</p><p id="004d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> <em class="kz">“基于用户查询，返回与用户查询最相似的现有问题”</em> </strong></p><p id="7b4f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">要比较两个句子有多相似，我们可以找到它们之间的‘距离’。为了能够计算这样的距离，句子必须属于相同的向量空间。这是通过<strong class="kd iu">句子嵌入</strong>完成的。我也使用过的最流行的距离度量之一是<strong class="kd iu">余弦距离</strong>。余弦距离越小，两个向量之间的相似度越高</p><p id="b8c2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">为了计算整个句子的嵌入，我定义了以下函数，该函数对每个有效标记的嵌入进行平均，并用于计算数据库中所有问题的句子嵌入:</p></div><div class="ab cl nl nm hx nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="im in io ip iq"><h2 id="618f" class="ol ln it bd lo om on dn ls oo op dp lw km oq or ma kq os ot me ku ou ov mi ow bi translated">7.将查询与每个句子进行比较，并使用基于余弦距离的度量对语义相似的结果进行排序</h2><p id="4c7f" class="pw-post-body-paragraph kb kc it kd b ke mk kg kh ki ml kk kl km mm ko kp kq mn ks kt ku mo kw kx ky im bi translated">尽管余弦距离本身就足以为我们提供这个特定任务的良好结果，但我决定定义一个自定义的相似性度量。其给出如下:</p><figure class="lh li lj lk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi pr"><img src="../Images/abed72a043bb6ba478f382bb8c755b71.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vowvsy4uenWafnsGRbAmlA.png"/></div></div></figure><p id="6b64" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="kz">其中</em> <strong class="kd iu"> <em class="kz"> q </em> </strong> <em class="kz"> =用户查询和</em> <strong class="kd iu"> <em class="kz"> t </em> </strong> <em class="kz"> =已有问题</em></p><ul class=""><li id="e5be" class="mv mw it kd b ke kf ki kj km mx kq my ku mz ky nj nb nc nd bi translated">它将余弦距离视为基本度量</li><li id="9195" class="mv mw it kd b ke ne ki nf km ng kq nh ku ni ky nj nb nc nd bi translated">它根据帖子在 StackOverflow 上获得的用户投票来考虑帖子的受欢迎程度</li><li id="783f" class="mv mw it kd b ke ne ki nf km ng kq nh ku ni ky nj nb nc nd bi translated">它考虑了人们所作出的反应的总体情绪。积极的情绪意味着答案是有帮助的，因此是一篇好文章</li></ul><p id="b06f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">运行以下代码片段可以向您展示运行中的算法:</p><p id="227d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">对于用户查询<strong class="kd iu">“组合列表列表”，</strong>我们得到:</p><figure class="lh li lj lk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ps"><img src="../Images/ebb334821a6e67278b8c2d84bfd515ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YUUrJx8w7qrFplWd8S2F_w.png"/></div></div><figcaption class="mq mr gj gh gi ms mt bd b be z dk">Query Results</figcaption></figure></div><div class="ab cl nl nm hx nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="im in io ip iq"><p id="623f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">web 应用程序只是通过用户界面翻译这些结果</p><figure class="lh li lj lk gt ju gh gi paragraph-image"><div class="gh gi pt"><img src="../Images/2320c78cbba3f2ee3d562a41d30ae408.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/1*EcHVQqkaP659W4zah5mjqg.png"/></div></figure><p id="ca04" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在这篇文章中，我不会讨论我是如何创建 web 应用程序的，你可以在资源库中查看代码。如果你有任何疑问或建设性的反馈(讨厌有毒的人可以去吸阿迪..)，欢迎在下方随意留下回应。我很乐意收到你的来信😄</p><p id="b13f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">直到那时，再见~</p><div class="nt nu gp gr nv nw"><a href="https://github.com/agrawal-rohit" rel="noopener  ugc nofollow" target="_blank"><div class="nx ab fo"><div class="ny ab nz cl cj oa"><h2 class="bd iu gy z fp ob fr fs oc fu fw is bi translated">agrawal-rohit —概述</h2><div class="od l"><h3 class="bd b gy z fp ob fr fs oc fu fw dk translated">在 GitHub 上注册您自己的个人资料，这是托管代码、管理项目和与 40…</h3></div><div class="oe l"><p class="bd b dl z fp ob fr fs oc fu fw dk translated">github.com</p></div></div><div class="of l"><div class="pu l oh oi oj of ok jz nw"/></div></div></a></div></div></div>    
</body>
</html>