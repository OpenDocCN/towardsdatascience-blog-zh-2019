# 洛杉矶的鸟类数据探索[第一部分]

> 原文：<https://towardsdatascience.com/bird-data-exploration-in-los-angeles-part-1-fe0292313083?source=collection_archive---------26----------------------->

这是我正在进行的一系列文章的第 1 部分，在这些文章中，我正在试验收集和建模 Bird scooter 数据。在这一部分中，我将介绍我的项目目标，并讨论一个地理区域的鸟类数据收集。请继续关注我在未来几周开发这个项目的其余部分。查看我的代码 [*这里*](https://github.com/jmwebb/scootsim) *。*

# 动机

作为洛杉矶或其周边城市的居民，很难错过微动力运动(电动滑板车、电动自行车等)的影响。)对景观的影响。作为这些产品的狂热用户，以及总体上微移动性的支持者，我长期以来一直对研究这些车辆的用户行为感兴趣。具体来说，我想研究这些车辆如何在特定地区行驶，并研究微型汽车公司如何最大限度地利用它们。

直到最近，我还以为是因为提供这些车辆的公司(伯德、莱姆、优步、Lyft 等。)没有公开的 API，我的研究将受到数据缺乏的限制。然而，我看到了 Conor McLaughlin 的一篇很棒的博客文章([链接此处](http://conormclaughlin.net/2018/08/tracking-the-flow-of-bird-scooters-across-dc/))，展示了如何获取和询问鸟类数据以获得洞察力。

# 介绍

**背景:**在我的简化模型中，公司员工(通常称为“充电者”)有两种类型的机会来干预/影响特定区域的滑板车分销。第一个是在一天开始的时候，踏板车的初始位置被设定。第二种是全天，当充电器拿起滑板车，给它们的电池充电，然后把它们放在某个地方供骑车人使用。

**目标:**我的模型将尝试回答以下问题:

1.  全天最大化使用(从而最大化收入)的踏板车的最佳初始位置是什么？现实世界中看到的摆放是否可以改进？
2.  我们能找到充电器重新分配踏板车位置的最佳“干预点”吗？

**注意事项:**从一开始，我的模型就有一些明显的限制:

1.  我不了解伯德的成本模型，即派出充电器进行干预的成本。因此，我将不得不做出一些假设，以确定干预成为更有利可图的选择的“断点”。
2.  我将离散时间和空间，并可能粗粒度收集数据，以产生可靠的结果。因此，我将无法准确地获取收入(波导的收入模式涉及骑行启动费，随后是每分钟使用费)。这意味着我将使用试探法和平均值来量化收入，这可能不会与每次乘坐获得的收入完全一致。
3.  正如将在收集 Bird 数据一节中讨论的那样，我实际上可以获得的数据受到 Bird API 的限制。由于公司 Bird 可以访问更多自己的数据，我的模型不太可能超过 Bird 数据科学团队使用的优化器。也就是说，我对这个项目的个人目标是获得关于这个数据集的实践经验，并希望实现体面的模型性能。

## 程序概述

我的方法如下:

1.  收集地理数据以建立一个感兴趣的区域:这将是我随着时间的推移监测鸟类分布的区域。
2.  收集搜索区域的鸟类数据:我计划在足够长的时间内频繁地收集给定区域内所有鸟类的数据，以捕捉重要的趋势。
3.  执行探索性数据分析并开始模型开发。
4.  使用收集的数据来预测未来鸟类的位置。
5.  通过使用未来鸟的位置预测来预测一天中鸟群的效用。
6.  确定最佳干预点/初始位置，以最大化车队效用。

# 收集数据

尽管我希望我的模型适用于任意的地理区域，但我希望使用洛杉矶的社区进行初始测试和概念验证开发。因此，我需要做以下事情:

1.  收集感兴趣区域的地理数据
2.  收集这些地区的鸟类踏板车数据

## 收集地理数据

为了搜索一组邻域，我需要 GIS 数据来提供这些邻域边界的坐标。令人欣慰的是，洛杉矶县维护着一个强大的 GIS 数据门户([链接此处](https://egis3.lacounty.gov/dataportal/tag/neighborhoods/))，它提供了一个包含洛杉矶县所有社区的 shapefile。

首先，我使用`geopandas`将洛杉矶县邻域 shapefile 的内容读入一个数据帧。

```
L.A. County GIS dataset type: <class 'geopandas.geodataframe.GeoDataFrame'>
```

正如我们所见，洛杉矶县 shapefile 以`shapely`多边形的形式提供了边界坐标，这对于可视化和地理空间分析非常理想。具体来说，我想关注洛杉矶西边的社区(靠近我的公寓)，所以我过滤了数据帧，并将所有需要的社区合并到一个多边形列表中。

注意，对于每个邻域，在将它们展平到最终的`search_areas`列表之前，我强制所有的多边形变成多重多边形。这是为了解释一些实际上*是*多多边形的邻域几何图形。例如，观察威尼斯的几何图形:

```
Venice geography type: <class 'shapely.geometry.multipolygon.MultiPolygon'>
Number of Venice constituent Polygons: 2
```

对于由不连续部分组成的邻域，洛杉矶县数据集将几何表示为多多边形。我的方法将这些邻域展平，并将所有的邻域/子区域存储在一个列表中。然后，我将邻近区域可视化，以确认 GIS 数据代表了我预期的区域。

![](img/9abf6c875f4f53f131a462b8df3a2273.png)

gmaps visualization of L.A. neighborhoods.

在尝试了一系列不同的绘图/可视化方法后，我选定了`gmaps`，这是一个在 Jupyter 笔记本上显示谷歌地图的插件([https://github.com/pbugnion/gmaps)](https://github.com/pbugnion/gmaps))。它为添加图层/数据点提供了直观的命令，并为额外的上下文提供了开箱即用的关键地图细节显示。唯一的缺点是该工具不是免费的，需要一个谷歌云平台账号。提供的令牌是我自己的，所以请谨慎刷新请求。

## 收集河边数据

另外，我还想探索为我的家乡加州河滨收集地理数据。我从下载河岸城市限制数据开始([链接此处](http://geodata-cityofriverside.opendata.arcgis.com/datasets/71c7ba7926194f6d8969329cac57d308_0?geometry=-118.06%2C33.846%2C-117.182%2C34.045))。

正如我们所见，Riverside 提供的边界数据与洛杉矶不同:作为路径列表(`shapely`linestring)。因此，我使用了`polygonize_full`的方法将片段合并在一起。

![](img/6b1631801655898d4415909c7c7efed1.png)

gmaps visualization of Riverside.

## 收集鸟类数据

接下来，我需要为我的搜索区域捕获鸟的位置数据。

据我所知，Bird 没有公开可用的 API。幸运的是，WoBike 资源库的贡献者([https://github.com/ubahnverleih/WoBike/blob/master/Bird.md](https://github.com/ubahnverleih/WoBike/blob/master/Bird.md))似乎已经找到了一种为 Bird 逆向开发 RESTful API 的方法。他们的方法似乎是通过假冒 iOS 用户登录来获得 API 认证。

使用这个 API，我做了以下工作:

1.  通过模拟 iOS 登录获取身份验证令牌。
2.  搜索特定区域(表示为坐标多边形)并获取单个踏板车的数据

```
'eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJBVVRIIiwidXNlcl9pZCI6IjlhNjVkYjRjLTU4NDctNDU1OS05ZDFmLWIzY2Y5Mjg1ODhmNyIsImRldmljZV9pZCI6IjI5M2ZlYzhjLWE2YTUtMTFlOS05YjViLWEwOTk5YjEwNTM1NSIsImV4cCI6MTU5NDY5MjM4OH0.09T6VCGDt-mWz6oYiGawzl0gJa-a4Fq2Y3qaOqVE8nA'
```

我们已经成功获得了一个 API 令牌！现在，我将测试查找附近鸟类的功能。

成功！我们有附近鸟类的名单。我们将使用`gmaps`做一些快速可视化，以确认鸟的位置是合理的。但是首先，我们将定义几个辅助函数。

![](img/6af9982bfb52240efd55febd5d33f278.png)

gmaps visualization of Birds around test location.

看起来这些鸟大概在圣莫尼卡市中心，这一点得到了证实。正如将在下一节中讨论的，很难确定鸟儿离搜索点的确切距离(即搜索半径)。

## 收集地理区域的鸟类数据

我们现在将把它们放在一起。我们已经确定我们可以捕捉和可视化地理区域和鸟类的位置。使用这两个函数，我们将尝试为一个地理区域(而不是一个搜索点周围)收集鸟类的位置。

虽然 Bird 的“附近的踏板车”API 端点有一个半径参数，但我无法成功使用它。经过一些实验，我观察到无论我为搜索半径指定什么值，都会返回相同的一组鸟(除了将半径设置为 0，这会产生一个空结果)。也许其他用户发现指定半径更成功；然而，鉴于我无法使用它，我构建了一个方法来收集我感兴趣区域内所有鸟类的位置。

下面更详细地提到了所有的底层功能；然而，我将在这里给出我的方法的概述。给定一个搜索区域，我定位包含的鸟类如下:

1.  我在搜索区域内的一个有代表性的点放下一个搜索点，收集附近的鸟。
2.  收集的鸟被添加到集合中。由于每只鸟都有一个(纬度，经度)位置，所以可以在收集到的鸟周围形成一个凸多边形。我们称之为覆盖区域。
3.  当被覆盖的区域仍然包含在搜索区域内时，我们继续搜索。
4.  覆盖区域的顶点现在成为收集附近鸟类的一组新的搜索点。
5.  如果在特定搜索点周围没有发现鸟在搜索区域内，该搜索点被认为是“死胡同”，其搜索结果被丢弃。
6.  然而，如果在特定搜索点周围找到的任何鸟在搜索区域内，其搜索的全部结果都被添加到找到的鸟的集合中，新的覆盖区域(凸多边形)被计算，并且新的搜索点集合由新的覆盖区域的顶点形成。
7.  为了确保多个搜索点不会恢复相同的鸟类，使用重复数据删除将搜索结果限制为仅新的(即，先前未发现的)鸟类。
8.  这个过程一直持续到覆盖区域包含搜索区域或者所有搜索点都成为死胡同。

如果一个搜索区域由多个搜索区域组成(洛杉矶的例子就是这种情况)，那么这个过程在每个组成搜索区域上独立运行，并且对结果进行重复数据删除以保持唯一性。

我们现在将把我们的搜索算法应用到之前可视化的洛杉矶社区。此算法肯定不是获取此数据的最有效方式，因此请等待几分钟来完成此搜索。

现在我们已经验证了我们的搜索算法定位了一些鸟，我们将可视化位置以及搜索区域(显示为红色)和我们的搜索算法覆盖的区域(蓝色)。请注意该算法如何从搜索区域的中间开始搜索，并在每次迭代中逐渐向外扩展。由于发现的鸟的数量，这种可视化可能需要一两分钟。

![](img/6d9f3a752ecdec567dc4c699bfbfe4ac.png)

gmaps visualization of the Bird search algorithm searching over several L.A. neighborhoods. Note how the covered areas (blue) start from the center of the search areas (red) and expand outward with each iteration until all Birds (pink) are found.

这种可视化势不可挡，运行缓慢。我们可以使用`gmaps`热图功能提高可视化速度并简化视图。

![](img/bf4450f5e0b4453fb7d191d79bdaaf3a.png)

好多了！正如我们所观察到的，鸟类的分布因我们观察的区域而异。这些观察还取决于一天中的时间(在本例中，是太平洋标准时间下午 6 点)和一周中的日期(星期日)。大体上，我们看到鸟类最密集地集中在威尼斯和圣莫尼卡的市中心/沿海地区，越是内陆的郊区人口越稀少。

我们现在将收集的数据保存到一个 csv 文件中，这样我们就可以在以后引用它，而不必运行我们的搜索算法。然而，首先我们将附加数据收集时间的时间戳，因为这对于评估我们搜索区域内的鸟类分布如何随时间变化至关重要。

# 后续步骤

在这一部分中，我能够构建一个可靠的算法来捕获数据(位置、电池电量等。)用于特定地理区域内的鸟类滑行车。从这里开始，我的下一步将是设置一个 cron 作业，在一天中以一定的间隔重复执行这个任务。一天的鸟类数据足以进行一些早期探索性数据分析和假设生成。从那里，这个过程将被扩展到捕获几周的数据，从而创建用于全面分析的数据集。