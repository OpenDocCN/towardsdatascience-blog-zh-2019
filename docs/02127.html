<html>
<head>
<title>Restricted cubic splines</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">受限三次样条</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/restricted-cubic-splines-c0617b07b9a5?source=collection_archive---------9-----------------------#2019-04-08">https://towardsdatascience.com/restricted-cubic-splines-c0617b07b9a5?source=collection_archive---------9-----------------------#2019-04-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="effc" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">拟合回归线的一种灵活方法</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/6d2601052fb9a4a0a203d9e034c6a7c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/1*Va4S5_eSoGmMCWBAlUm1aQ.png"/></div></figure><p id="cd52" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated"><em class="lm">样条</em>是一种用于绘制曲线的绘图工具。在统计学中，样条是变换变量的一大类方法。我首先通过线性样条来介绍这个概念，然后用我的方法来介绍我(和许多其他人)推荐的受限三次样条。你应该知道有大量不同的样条，每一种都有其支持者。途径如下:</p><p id="8bd5" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">1.虚拟变量</p><p id="98d2" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">2.无限制线性样条</p><p id="04b1" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">3.受限线性样条</p><p id="c79d" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">4.受限三次样条</p><p id="10d9" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">在<a class="ae ln" href="https://medium.com/@peterflom/what-happens-when-we-categorize-an-independent-variable-in-regression-77d4c5862b6c" rel="noopener">的一篇早期文章中，我向</a>展示了分类(虚拟变量方法)不是一个好方法。它有两个基本问题:关系在每个段内是平坦的，而在段之间是跳跃的。在样条术语中，让一条曲线跳跃被称为“无限制的”。第二步消除了平坦性(但是给我们留下了跳跃的直线)。第三步去掉跳跃(但保留直线)。第 4 步让每个部分的关系曲线。结果是一个非常灵活的曲线，没有跳跃。受限三次样条(RCS)有许多优点，但是它们有一个很大的缺点:结果输出并不总是容易解释。</p><p id="633d" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">样条的两个方面，我们还没有触及的是允许的结的数量以及如何放置它们。已经提出了各种建议，但 Frank Harrell 建议，如果 N &lt; 100，则使用 4 个结，对于较大的数据集，使用 5 个结，对于 k = 4，将它们放置在第 5、35、65 和 95 个百分点，对于 k = 5，将它们放置在第 5、27.5、50、72.5 和 95 个百分点(其中 k 是结的数量)。</p><p id="d57b" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">举例来说，这一切可能会更清楚。为了比较，我将从正弦回归开始(就像我以前的帖子一样)，我们应该遵循上面关于虚拟变量图的结的建议。这会产生:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi lo"><img src="../Images/0c2e2cd11d4304e6e83ae967190fea7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*9m4tEqxTJau6QgC19ileaA.png"/></div></figure><p id="3ad0" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">第一步是允许每条线之间的斜率不为零。有些混乱的代码(该死的吉姆，我是数据分析师，不是程序员！)是:</p><pre class="kj kk kl km gt lp lq lr ls aw lt bi"><span id="057b" class="lu lv it lq b gy lw lx l ly lz">mUnresLin1 &lt;- lm(y~x, subset = (x6int == 1))<br/>  mUnresLin2 &lt;- lm(y~x, subset = (x6int == 2))<br/>  mUnresLin3 &lt;- lm(y~x, subset = (x6int == 3))<br/>  mUnresLin4 &lt;- lm(y~x, subset = (x6int == 4))<br/>  mUnresLin5 &lt;- lm(y~x, subset = (x6int == 5))<br/>  mUnresLin6 &lt;- lm(y~x, subset = (x6int == 6))<br/>  <br/>  <br/>  plot(x[x6int == 1],mUnresLin1$fitted.values, <br/>       las = 1,<br/>       xlab = "x",<br/>       ylab = "y",<br/>       col = "red",<br/>       xlim = c(min(x),max(x)),<br/>       ylim = c(min(y),max(y)))<br/>  <br/>  points(x[x6int == 2],mUnresLin2$fitted.values, <br/>        col = "red")<br/>  <br/>  points(x[x6int == 3],mUnresLin3$fitted.values, <br/>         col = "red")<br/>  <br/>  points(x[x6int == 4],mUnresLin4$fitted.values, <br/>         col = "red")<br/>  <br/>  points(x[x6int == 5],mUnresLin5$fitted.values, <br/>         col = "red")<br/>  <br/>  points(x[x6int == 6],mUnresLin6$fitted.values, <br/>         col = "red")<br/>  <br/>  points(x,y, pch  = 20, cex = .5)</span></pre><p id="f074" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">这产生了</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi lo"><img src="../Images/3c36f0eab4935b735ff61e8bcf1e1f6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*8qzKWqmyARyaXE9rRTx2LQ.png"/></div></figure><p id="0efb" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">这已经是一个重大的改进，但是有跳跃(其中一个相当大)和方向的突然转变，这可能与早期模型中的跳跃一样难以证明。</p><p id="a7f0" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">接下来，我们可以用一个受限的线性样条来强制这些线匹配。这里已经有一个 R 函数，所以代码很简单:</p><pre class="kj kk kl km gt lp lq lr ls aw lt bi"><span id="c97f" class="lu lv it lq b gy lw lx l ly lz">install.packages("lspline")<br/>  library(lspline)<br/><br/>mlinspline &lt;- lm(y ~ lspline(x, quantile(x, c(0, .05, .275, .5, .775, .95, 1),<br/>                             include.lowest = TRUE)))</span><span id="b737" class="lu lv it lq b gy ma lx l ly lz"><br/>plot(x,mlinspline$fitted.values, <br/>     las = 1,<br/>     xlab = "x",<br/>     ylab = "y",<br/>     col = "red",<br/>     xlim = c(min(x),max(x)),<br/>     ylim = c(min(y),max(y)))</span><span id="1a70" class="lu lv it lq b gy ma lx l ly lz">points(x,y, pch  = 20, cex = .5)</span></pre><p id="c623" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">这会产生:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/6731eca3597b4549f9a31405a1301dbb.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/1*fFG8R21ypQDqEbb16NDDhQ.png"/></div></figure><p id="61ed" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">最后一步是让每一段内的线条弯曲。我们可以用受限制的三次样条来做到这一点；同样，有一个 R 包使这变得容易。</p><pre class="kj kk kl km gt lp lq lr ls aw lt bi"><span id="6bc4" class="lu lv it lq b gy lw lx l ly lz">library(Hmisc)<br/>library(rms)</span><span id="8c81" class="lu lv it lq b gy ma lx l ly lz">mRCS &lt;- ols(y~rcs(x, quantile(x, c(0, .05, .275, .5, .775, .95, 1),<br/>                              include.lowest = TRUE)))</span><span id="ec5f" class="lu lv it lq b gy ma lx l ly lz">plot(x,mRCS$fitted.values,<br/>     col = "red",<br/>     xlim = c(min(x),max(x)),<br/>     ylim = c(min(y),max(y)))</span><span id="8744" class="lu lv it lq b gy ma lx l ly lz">points(x,y)</span></pre><p id="e5d1" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">它产生:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi lo"><img src="../Images/bfe19ad343b38398e278578ec8ae9e8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*5xky7cOIB1bx_bVKoyDj2w.png"/></div></figure><p id="fa66" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">这与原始正弦曲线非常匹配。</p></div></div>    
</body>
</html>