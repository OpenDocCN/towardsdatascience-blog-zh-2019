<html>
<head>
<title>Introducing TextBlob</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">介绍 TextBlob</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/having-fun-with-textblob-7e9eed783d3f?source=collection_archive---------6-----------------------#2019-01-09">https://towardsdatascience.com/having-fun-with-textblob-7e9eed783d3f?source=collection_archive---------6-----------------------#2019-01-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/1dce5c09de2c148e43d181d1c9d489cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TwsI-4s6fGMSAi--2t19qA.png"/></div></div></figure><div class=""/><div class=""><h2 id="3515" class="pw-subtitle-paragraph jy ja jb bd b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp dk translated">用于处理文本数据的 Python 库，NLP 框架，情感分析</h2></div><p id="d5c4" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">作为 Python 的 NLP 库，<a class="ae lm" href="https://textblob.readthedocs.io/en/dev/" rel="noopener ugc nofollow" target="_blank"> TextBlob </a>已经有一段时间了，在听说了很多关于它的好东西如<a class="ae lm" href="https://en.wikipedia.org/wiki/Part-of-speech_tagging" rel="noopener ugc nofollow" target="_blank">词性标注</a>和<a class="ae lm" href="https://en.wikipedia.org/wiki/Sentiment_analysis" rel="noopener ugc nofollow" target="_blank">情感分析</a>之后，我决定试一试，因此，这是我第一次使用<a class="ae lm" href="https://textblob.readthedocs.io/en/dev/" rel="noopener ugc nofollow" target="_blank"> TextBlob </a>执行<a class="ae lm" href="https://en.wikipedia.org/wiki/Natural_language_processing" rel="noopener ugc nofollow" target="_blank">自然语言处理</a>任务。</p><p id="0eef" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated"><a class="ae lm" href="https://www.yelp.ca/dataset" rel="noopener ugc nofollow" target="_blank">Yelp 数据集</a>是其业务、评论和用户数据的子集，用于个人、教育和学术目的。作为 JSON 文件，我们将只使用<code class="fe ln lo lp lq b">yelp_academic_dataset_review.json</code>和<code class="fe ln lo lp lq b">yelp_academic_dataset_user.json</code>，并且可以从<a class="ae lm" href="https://www.kaggle.com/yelp-dataset/yelp-dataset" rel="noopener ugc nofollow" target="_blank">这里</a>下载。</p><h1 id="99c6" class="lr ls jb bd lt lu lv lw lx ly lz ma mb kh mc ki md kk me kl mf kn mg ko mh mi bi translated">数据</h1><p id="2b3b" class="pw-post-body-paragraph kq kr jb ks b kt mj kc kv kw mk kf ky kz ml lb lc ld mm lf lg lh mn lj lk ll ij bi translated">数据集是 JSON 格式的，为了能够在 pandas 数据框架中读取，我们首先加载 JSON 数据，然后将半结构化的 JSON 数据规范化为一个平面表，然后使用<code class="fe ln lo lp lq b">to_parquet</code>将该表写入二进制拼花格式。稍后当我们需要它时，我们从文件路径加载一个 parquet 对象，返回一个 pandas 数据帧。</p><p id="78b1" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">下面的过程为我们提供了两个数据表，user 和 review。</p><figure class="mo mp mq mr gt is"><div class="bz fp l di"><div class="ms mt l"/></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk">JSON_parquet.py</figcaption></figure><figure class="mo mp mq mr gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi my"><img src="../Images/752c4a6ad495bd1e31a0e6b8ca12f549.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ewlrZPawoMfm3tna-stGzw.png"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk">user table</figcaption></figure><figure class="mo mp mq mr gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mz"><img src="../Images/c73c390eb8281f3ebbebe0ae6c47929d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tvq5fT-xTVR6acoKtxaOYw.png"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk">review table</figcaption></figure><p id="ec28" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">我们合并用户表和评论表，用后缀来处理相同的列名，去掉零星号。</p><pre class="mo mp mq mr gt na lq nb nc aw nd bi"><span id="3988" class="ne ls jb lq b gy nf ng l nh ni">user_review = (review.merge(user, on='user_id', how='left', suffixes=['', '_user']).drop('user_id', axis=1))</span><span id="aae0" class="ne ls jb lq b gy nj ng l nh ni">user_review = user_review[user_review.stars &gt; 0]</span></pre><h1 id="9fb7" class="lr ls jb bd lt lu lv lw lx ly lz ma mb kh mc ki md kk me kl mf kn mg ko mh mi bi translated">星级分布</h1><pre class="mo mp mq mr gt na lq nb nc aw nd bi"><span id="24aa" class="ne ls jb lq b gy nf ng l nh ni">x=user_review['stars'].value_counts()<br/>x=x.sort_index()<br/>plt.figure(figsize=(10,6))<br/>ax= sns.barplot(x.index, x.values, alpha=0.8)<br/>plt.title("Star Rating Distribution")<br/>plt.ylabel('count')<br/>plt.xlabel('Star Ratings')<br/>rects = ax.patches<br/>labels = x.values<br/>for rect, label in zip(rects, labels):<br/>    height = rect.get_height()<br/>    ax.text(rect.get_x() + rect.get_width()/2, height + 5, label, ha='center', va='bottom')<br/>plt.show();</span></pre><figure class="mo mp mq mr gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nk"><img src="../Images/189b049024ad65db9cdda7fd21c339f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OcjElUrysFRixmZKkGgmGQ.png"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk">Figure 1</figcaption></figure><p id="62d7" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">很高兴知道大多数评论星级相当高，并没有很多可怕的评论。显而易见，企业有一种动机去争取尽可能多的好评。</p><h1 id="f390" class="lr ls jb bd lt lu lv lw lx ly lz ma mb kh mc ki md kk me kl mf kn mg ko mh mi bi translated">每年的评论与每年的星级</h1><pre class="mo mp mq mr gt na lq nb nc aw nd bi"><span id="330e" class="ne ls jb lq b gy nf ng l nh ni">fig, axes = plt.subplots(ncols=2, figsize=(14, 4))<br/>user_review.year.value_counts().sort_index().plot.bar(title='Reviews per Year', ax=axes[0]);<br/>sns.lineplot(x='year', y='stars', data=user_review, ax=axes[1])<br/>axes[1].set_title('Stars per year');</span></pre><figure class="mo mp mq mr gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nl"><img src="../Images/d0f49f3f2ef3a72e7829869409aa8fd1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Bs_vGoqdFqoqhqAj7zhRdg.png"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk">Figure 2</figcaption></figure><pre class="mo mp mq mr gt na lq nb nc aw nd bi"><span id="dfb6" class="ne ls jb lq b gy nf ng l nh ni">user_review.member_yrs.value_counts()</span></pre><figure class="mo mp mq mr gt is gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/662ae36b75e1578a6ec4d4f705d7b0af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1282/format:webp/1*a-Bj1wWYLGepSCSw2uE3_w.png"/></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk">Figure 3</figcaption></figure><p id="1e32" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">Yelp 成立于 2004 年，根据我们的数据，从那时起已经有超过 4000 人成为 Yelp 会员。</p><p id="80ec" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">让我们来看一个示例评论:</p><pre class="mo mp mq mr gt na lq nb nc aw nd bi"><span id="5ab5" class="ne ls jb lq b gy nf ng l nh ni">review_sample = user_review.text.sample(1).iloc[0]<br/>print(review_sample)</span></pre><figure class="mo mp mq mr gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nn"><img src="../Images/d793d1ee3e88c2012d83a8d88ea4c8bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y98gytO457lb7KdiV-ITKw.png"/></div></div></figure><p id="b6b9" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">让我们检查一下这个样本评论的极性。极性范围从-1(最负)到 1(最正)。</p><pre class="mo mp mq mr gt na lq nb nc aw nd bi"><span id="49f1" class="ne ls jb lq b gy nf ng l nh ni">TextBlob(review_sample).sentiment</span></pre><figure class="mo mp mq mr gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi no"><img src="../Images/4b88fa02cd07320938155c579b28d0d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BaUEkxkMkPG-c_Zp5GUZ6g.png"/></div></div></figure><p id="a6f6" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">上述评论的极性约为-0.06，意味着它略有负面，主观性约为 0.56，意味着它相当主观。</p><p id="b57b" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">为了更快地进行，我们将从当前数据中抽取 100 万条评论，并添加一个新的极性列。</p><pre class="mo mp mq mr gt na lq nb nc aw nd bi"><span id="a7f1" class="ne ls jb lq b gy nf ng l nh ni">sample_reviews = user_review[['stars', 'text']].sample(1000000)</span><span id="615e" class="ne ls jb lq b gy nj ng l nh ni">def detect_polarity(text):<br/>    return TextBlob(text).sentiment.polarity</span><span id="2efc" class="ne ls jb lq b gy nj ng l nh ni">sample_reviews['polarity'] = sample_reviews.text.apply(detect_polarity)<br/>sample_reviews.head()</span></pre><figure class="mo mp mq mr gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi np"><img src="../Images/28c1c89ab953b4710a610d8135bca970.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aYI9dYo8yqc0FHNJLjKdqg.png"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk">Figure 4</figcaption></figure><p id="2bad" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">前几行看起来不错，星星和极性彼此一致，意味着星星越高，极性越高，就像它应该的那样。</p><h1 id="080b" class="lr ls jb bd lt lu lv lw lx ly lz ma mb kh mc ki md kk me kl mf kn mg ko mh mi bi translated">极性分布</h1><pre class="mo mp mq mr gt na lq nb nc aw nd bi"><span id="a00e" class="ne ls jb lq b gy nf ng l nh ni">num_bins = 50<br/>plt.figure(figsize=(10,6))<br/>n, bins, patches = plt.hist(sample_reviews.polarity, num_bins, facecolor='blue', alpha=0.5)<br/>plt.xlabel('Polarity')<br/>plt.ylabel('Count')<br/>plt.title('Histogram of polarity')<br/>plt.show();</span></pre><figure class="mo mp mq mr gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nq"><img src="../Images/d6ec6c0ca7c85c2d49f97443f452b4c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0WvQYSMRy5qJdDO9lvHHrw.png"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk">Figure 5</figcaption></figure><p id="b51f" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">大多数极性得分都在零以上，这意味着数据中的大多数评论都是积极情绪，这符合我们之前发现的星级分布。</p><h1 id="6ecb" class="lr ls jb bd lt lu lv lw lx ly lz ma mb kh mc ki md kk me kl mf kn mg ko mh mi bi translated">按星星分组的极性</h1><pre class="mo mp mq mr gt na lq nb nc aw nd bi"><span id="b779" class="ne ls jb lq b gy nf ng l nh ni">plt.figure(figsize=(10,6))<br/>sns.boxenplot(x='stars', y='polarity', data=sample_reviews)<br/>plt.show();</span></pre><figure class="mo mp mq mr gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nr"><img src="../Images/bfa3e45438f56a88967352a16a936c39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S-ShQNDbrVydUfvTzfItkg.png"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk">Figure 6</figcaption></figure><p id="51e0" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">总的来说，这和我们预期的一样好。让我们进行更深入的调查，看看我们是否能找到任何有趣的或异常的东西。</p><p id="8cd1" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated"><strong class="ks jc">极性最低的评论</strong>:</p><pre class="mo mp mq mr gt na lq nb nc aw nd bi"><span id="ea9a" class="ne ls jb lq b gy nf ng l nh ni">sample_reviews[sample_reviews.polarity == -1].text.head()</span></pre><figure class="mo mp mq mr gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi my"><img src="../Images/dbf165a5285634217f38542426259125.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y29jzQFxOdo4-M9DTUy33Q.png"/></div></div></figure><p id="1684" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated"><strong class="ks jc">星级最低的评论:</strong></p><pre class="mo mp mq mr gt na lq nb nc aw nd bi"><span id="af5a" class="ne ls jb lq b gy nf ng l nh ni">sample_reviews[sample_reviews.stars == 1].text.head()</span></pre><figure class="mo mp mq mr gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ns"><img src="../Images/bc69646f9246142d540324155b2017ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rTyj8K5ee6g430SY83yacQ.png"/></div></div></figure><p id="8a1b" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">它们看起来都像我们预期的负面评论。</p><p id="3f4c" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated"><strong class="ks jc">极性最低(负面情绪最多)但有 5 颗星的评论:</strong></p><pre class="mo mp mq mr gt na lq nb nc aw nd bi"><span id="4062" class="ne ls jb lq b gy nf ng l nh ni">sample_reviews[(sample_reviews.stars == 5) &amp; (sample_reviews.polarity == -1)].head(10)</span></pre><figure class="mo mp mq mr gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nt"><img src="../Images/5667ef11e191ccfc0394ecbe193c9c3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Prz6Z5S8hdJjmc9HHEuMrA.png"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk">Figure 7</figcaption></figure><p id="53d8" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated"><strong class="ks jc">具有最高极性(最积极情绪)但只有一星的评论:</strong></p><pre class="mo mp mq mr gt na lq nb nc aw nd bi"><span id="ffb6" class="ne ls jb lq b gy nf ng l nh ni">sample_reviews[(sample_reviews.stars == 1) &amp; (sample_reviews.polarity == 1)].head(10)</span></pre><figure class="mo mp mq mr gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nu"><img src="../Images/e01736553de6e91654c64ce5368554cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cj3cHbYaPWMuvrafQ6uXmQ.png"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk">Figure 8</figcaption></figure><p id="6b75" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">两张桌子看起来都很奇怪。显然，一些极性与其相关评级不一致。这是为什么呢？</p><p id="9f73" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">经过进一步挖掘，发现 TextBlob 会继续寻找可以赋予极性和主观性的单词和短语，并对较长的文本进行平均，例如我们的 Yelp 评论。</p><p id="b4ca" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">想了解 TextBlob 是如何计算极性和主观性的，<a class="ae lm" href="https://planspace.org/20150607-textblob_sentiment/" rel="noopener ugc nofollow" target="_blank">Aaron Schumacher</a>的这篇文章给出了简单而清晰的解释。</p><p id="3952" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">我喜欢学习和玩 TextBlob。我意识到 TextBlob 可以用来完成许多其他的 NLP 任务，比如词性标注、名词短语提取、分类、翻译等等，以后我们还会用到它们。</p><p id="83a1" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated"><a class="ae lm" href="https://github.com/susanli2016/NLP-with-Python/blob/master/TextBlob%20Yelp%20Reviews.ipynb" rel="noopener ugc nofollow" target="_blank"> Jupyter 笔记本</a>可以在<a class="ae lm" href="https://github.com/susanli2016/NLP-with-Python/blob/master/TextBlob%20Yelp%20Reviews.ipynb" rel="noopener ugc nofollow" target="_blank"> Github </a>上找到。享受这周剩下的时光吧！</p><p id="9e1c" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">参考资料:</p><p id="9dde" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated"><a class="ae lm" href="https://textblob.readthedocs.io/en/dev/" rel="noopener ugc nofollow" target="_blank">文本 Blob 文档</a></p><p id="981b" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">书:算法交易的实践机器学习</p></div></div>    
</body>
</html>