<html>
<head>
<title>Time Forecast with TPOT</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">TPOT 时间预报</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/time-forecast-with-tpot-b2d87eaba59c?source=collection_archive---------9-----------------------#2019-01-05">https://towardsdatascience.com/time-forecast-with-tpot-b2d87eaba59c?source=collection_archive---------9-----------------------#2019-01-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/9f957602b8afeb6edca2630c3dc71eee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K9y15G9D3QxKKIDyqV05hg.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Photo credit: Pixabay</figcaption></figure><div class=""/><div class=""><h2 id="9029" class="pw-subtitle-paragraph kc je jf bd b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt dk translated">自动化机器学习管道，找到性能最佳的机器学习模型</h2></div><p id="2a4f" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">我的同事向我推荐了几个很棒的机器学习库，其中一些对我来说是新的。因此，我决定一个一个地尝试。今天是轮到 TPOT 的日子。</p><p id="40a7" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">该数据集是关于<a class="ae lq" href="https://www.kaggle.com/c/mercedes-benz-greener-manufacturing" rel="noopener ugc nofollow" target="_blank">预测戴姆勒梅赛德斯-奔驰汽车测试系统速度的工程师，目的是减少汽车花费在测试上的时间，拥有超过 300 个功能</a>。坦白地说，我对汽车行业没有什么专业知识。无论如何，我会尽我所能做出最好的预测，使用<a class="ae lq" href="https://epistasislab.github.io/tpot/" rel="noopener ugc nofollow" target="_blank"> TPOT </a>，这是一个 Python 自动化机器学习工具，使用遗传编程优化机器学习管道。</p><h1 id="4aad" class="lr ls jf bd lt lu lv lw lx ly lz ma mb kl mc km md ko me kp mf kr mg ks mh mi bi translated">数据</h1><p id="73b8" class="pw-post-body-paragraph ku kv jf kw b kx mj kg kz la mk kj lc ld ml lf lg lh mm lj lk ll mn ln lo lp ij bi translated">这个数据集包含一组匿名的变量，每个变量代表一辆奔驰汽车的定制功能。</p><p id="f815" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">目标特性被标记为“y ”,代表汽车通过每个变量测试所用的时间(秒)。数据集可以在<a class="ae lq" href="https://www.kaggle.com/c/mercedes-benz-greener-manufacturing/data" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="56d3" class="mx ls jf mt b gy my mz l na nb">train = pd.read_csv('mer_train.csv')<br/>print('Train shape: ', train.shape)</span></pre><figure class="mo mp mq mr gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nc"><img src="../Images/e70138aeced8322bb01805f76394d015.png" data-original-src="https://miro.medium.com/v2/resize:fit:858/format:webp/1*IWezkRFmIf0vNwLdfY6s5g.png"/></div></div></figure><p id="c475" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">我们知道我们有什么问题:太多的特性(列)和不够的行。</p><figure class="mo mp mq mr gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nd"><img src="../Images/02dcd4124c904c204810eee5762e4fe2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gB5b9x_RdTdqOKKgY0hJ9w.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 1</figcaption></figure><p id="7f52" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">另外，除了“y”和“ID”，我们不知道那些特征是什么。</p><h1 id="642a" class="lr ls jf bd lt lu lv lw lx ly lz ma mb kl mc km md ko me kp mf kr mg ks mh mi bi translated">目标特征</h1><p id="cf6d" class="pw-post-body-paragraph ku kv jf kw b kx mj kg kz la mk kj lc ld ml lf lg lh mm lj lk ll mn ln lo lp ij bi translated">目标特征“y”是汽车通过每个变量测试所用的时间(秒)。我们来看看它的分布。</p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="0233" class="mx ls jf mt b gy my mz l na nb">plt.figure(figsize = (10, 6))<br/>n, bins, patches = plt.hist(train['y'], 50, facecolor='blue', alpha=0.75)<br/>plt.xlabel('y value in seconds')<br/>plt.ylabel('count')<br/>plt.title('Histogram of y value')<br/>plt.show();</span></pre><figure class="mo mp mq mr gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ne"><img src="../Images/9fd9baba62e53f483f4de801456038a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ntgz59_Axxo2BBmPgCcUQQ.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 2</figcaption></figure><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="bc99" class="mx ls jf mt b gy my mz l na nb">train['y'].describe()</span></pre><figure class="mo mp mq mr gt is gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/35608de61e823128b9c5644c62332904.png" data-original-src="https://miro.medium.com/v2/resize:fit:814/format:webp/1*B4a5_OPv9P37HDsUOgsgkA.png"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 3</figcaption></figure><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="d41a" class="mx ls jf mt b gy my mz l na nb">plt.figure(figsize = (10, 6))<br/>plt.scatter(range(train.shape[0]), np.sort(train['y'].values))<br/>plt.xlabel('index')<br/>plt.ylabel('y')<br/>plt.title("Time Distribution")<br/>plt.show();</span></pre><figure class="mo mp mq mr gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ng"><img src="../Images/972a6586d8ea384143537bda70a9e7ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cuuTG1LWw-WXjbWuwsV8fg.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 4</figcaption></figure><p id="36d2" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">有一个异常值，最大时间为 265 秒。</p><h1 id="74a8" class="lr ls jf bd lt lu lv lw lx ly lz ma mb kl mc km md ko me kp mf kr mg ks mh mi bi translated">功能探索</h1><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="8146" class="mx ls jf mt b gy my mz l na nb">cols = [c for c in train.columns if 'X' in c]<br/>print('Number of features except ID and target feature: {}'.format(len(cols)))<br/>print('Feature types :')<br/>train[cols].dtypes.value_counts()</span></pre><figure class="mo mp mq mr gt is gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/2ad2e43f52a67043434f15cda851bfa0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1388/format:webp/1*5dJVZ2WY9IGnmzF7Ba_5JQ.png"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 5</figcaption></figure><p id="0e52" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">在所有特征中，我们有 8 个分类特征和 368 个整数特征。特性的基数呢？以下想法和剧本来自米克尔·鲍勃·伊里扎尔<a class="ae lq" href="https://www.kaggle.com/anokas/mercedes-eda-xgboost-starter-0-55" rel="noopener ugc nofollow" target="_blank">。</a></p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="513a" class="mx ls jf mt b gy my mz l na nb">counts = [[], [], []]<br/>for c in cols:<br/>    typ = train[c].dtypes<br/>    uniq = len(train[c].unique())<br/>    if uniq == 1:<br/>        counts[0].append(c)<br/>    elif uniq == 2 and typ == np.int64:<br/>        counts[1].append(c)<br/>    else:<br/>        counts[2].append(c)<br/>print('Constant features: {} Binary features: {} Categorical features: {}\n'.format(*[len(c) for c in counts]))<br/>print('Constant features: ', counts[0])<br/>print()<br/>print('Categorical features: ', counts[2])</span></pre><figure class="mo mp mq mr gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ni"><img src="../Images/5df77ee9731923d47538465d2765359a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2h20Isd5K8HZ9uBHmgbQvQ.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 6</figcaption></figure><p id="749a" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">有 12 个特征只包含一个值(0)，这些特征对于监督算法是没有用的，我们稍后将删除它们。</p><p id="48a2" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">我们数据集的其余部分由 356 个二元特征和 8 个分类特征组成。让我们首先探索分类特征。</p><h2 id="9127" class="mx ls jf bd lt nj nk dn lx nl nm dp mb ld nn no md lh np nq mf ll nr ns mh nt bi translated">分类特征</h2><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="6642" class="mx ls jf mt b gy my mz l na nb">for cat in ['X0', 'X1', 'X2', 'X3', 'X4', 'X5', 'X6', 'X8']:<br/>    print("Number of levels in category '{0}': \b {1:2}".format(cat, train[cat].nunique()))</span></pre><figure class="mo mp mq mr gt is gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/8d9ca3f00e61ea1c284db03f6c9261c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1122/format:webp/1*5IgVxymdATub9IV8laaP0A.png"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 7</figcaption></figure><p id="3a83" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg">特征 X0 </strong></p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="69ad" class="mx ls jf mt b gy my mz l na nb">sort_X0 = train.groupby('X0').size()\<br/>                    .sort_values(ascending=False)\<br/>                    .index<br/>plt.figure(figsize=(12,6))<br/>sns.countplot(x='X0', data=train, order = sort_X0)<br/>plt.xlabel('X0')<br/>plt.ylabel('Occurances')<br/>plt.title('Feature X0')<br/>sns.despine();</span></pre><figure class="mo mp mq mr gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nv"><img src="../Images/80a06295b08a1dcbf8df57c6a9845dec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GQ4RxbWYGGsxUDO7qLau0Q.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 8</figcaption></figure><p id="a556" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg"> X0 对目标特征 y </strong></p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="3582" class="mx ls jf mt b gy my mz l na nb">sort_y = train.groupby('X0')['y']\<br/>                    .median()\<br/>                    .sort_values(ascending=False)\<br/>                    .index<br/>plt.figure(figsize = (14, 6))<br/>sns.boxplot(y='y', x='X0', data=train, order=sort_y)<br/>ax = plt.gca()<br/>ax.set_xticklabels(ax.get_xticklabels())<br/>plt.title('X0 vs. y value')<br/>plt.show();</span></pre><figure class="mo mp mq mr gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nw"><img src="../Images/b68890a8c50e99995b6459004c432ec3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D_RgM8b-ivKsXWkV7Fl2zA.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 9</figcaption></figure><p id="cfc2" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg">特征 X1 </strong></p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="241c" class="mx ls jf mt b gy my mz l na nb">sort_X1 = train.groupby('X1').size()\<br/>                    .sort_values(ascending=False)\<br/>                    .index<br/>plt.figure(figsize=(12,6))<br/>sns.countplot(x='X1', data=train, order = sort_X1)<br/>plt.xlabel('X1')<br/>plt.ylabel('Occurances')<br/>plt.title('Feature X1')<br/>sns.despine();</span></pre><figure class="mo mp mq mr gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nx"><img src="../Images/723a78f3486bbd3feb69064b97c80bda.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qExp6ZREgr2IlbY3fwmNzA.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 10</figcaption></figure><p id="28d1" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg"> X1 对目标特征 y </strong></p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="9f02" class="mx ls jf mt b gy my mz l na nb">sort_y = train.groupby('X1')['y']\<br/>                    .median()\<br/>                    .sort_values(ascending=False)\<br/>                    .index<br/>plt.figure(figsize = (10, 6))<br/>sns.boxplot(y='y', x='X1', data=train, order=sort_y)<br/>ax = plt.gca()<br/>ax.set_xticklabels(ax.get_xticklabels())<br/>plt.title('X1 vs. y value')<br/>plt.show();</span></pre><figure class="mo mp mq mr gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ny"><img src="../Images/477a01cbba1aefb141af4653ccb6774d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-FACIPty1xRP_SIP6N8CoQ.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 11</figcaption></figure><p id="1796" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg">特写 X2 </strong></p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="52ff" class="mx ls jf mt b gy my mz l na nb">sort_X2 = train.groupby('X2').size()\<br/>                    .sort_values(ascending=False)\<br/>                    .index<br/>plt.figure(figsize=(12,6))<br/>sns.countplot(x='X2', data=train, order = sort_X2)<br/>plt.xlabel('X2')<br/>plt.ylabel('Occurances')<br/>plt.title('Feature X2')<br/>sns.despine();</span></pre><figure class="mo mp mq mr gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nz"><img src="../Images/813152a3e564f90c1ba55dba0ba633e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Pnv89cw8qNvCMDLOG8yNkg.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 12</figcaption></figure><p id="b9f2" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg"> X2 对目标特征 y </strong></p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="d2d1" class="mx ls jf mt b gy my mz l na nb">sort_y = train.groupby('X2')['y']\<br/>                    .median()\<br/>                    .sort_values(ascending=False)\<br/>                    .index<br/>plt.figure(figsize = (12, 6))<br/>sns.boxplot(y='y', x='X2', data=train, order=sort_y)<br/>ax = plt.gca()<br/>ax.set_xticklabels(ax.get_xticklabels())<br/>plt.title('X2 vs. y value')<br/>plt.show();</span></pre><figure class="mo mp mq mr gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi oa"><img src="../Images/2a1f02de68931e5fe4a9295d235dac78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nqgaxnbSJW6XGn4DD4di_Q.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 13</figcaption></figure><p id="6a6e" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg">特写 X3 </strong></p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="28cf" class="mx ls jf mt b gy my mz l na nb">sort_X3 = train.groupby('X3').size()\<br/>                    .sort_values(ascending=False)\<br/>                    .index<br/>plt.figure(figsize=(12,6))<br/>sns.countplot(x='X3', data=train, order = sort_X3)<br/>plt.xlabel('X3')<br/>plt.ylabel('Occurances')<br/>plt.title('Feature X3')<br/>sns.despine();</span></pre><figure class="mo mp mq mr gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ob"><img src="../Images/3668fdad3300e5b6b71e581565430c95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D15kzB5PRXE2obDBYU9ynw.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 14</figcaption></figure><p id="0a5f" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg"> X3 对目标特征 y </strong></p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="2cc3" class="mx ls jf mt b gy my mz l na nb">sort_y = train.groupby('X3')['y']\<br/>                    .median()\<br/>                    .sort_values(ascending=False)\<br/>                    .index<br/>plt.figure(figsize = (10, 6))<br/>sns.boxplot(y='y', x='X3', data=train, order = sort_y)<br/>ax = plt.gca()<br/>ax.set_xticklabels(ax.get_xticklabels())<br/>plt.title('X3 vs. y value')<br/>plt.show();</span></pre><figure class="mo mp mq mr gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi oc"><img src="../Images/13bd8a4f15f3761561fd5b81b48f5824.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KP_NgaJEDSzh-tGpunek6w.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 15</figcaption></figure><p id="f928" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg">功能 X4 </strong></p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="4e48" class="mx ls jf mt b gy my mz l na nb">sort_X4 = train.groupby('X4').size()\<br/>                    .sort_values(ascending=False)\<br/>                    .index<br/>plt.figure(figsize=(12,6))<br/>sns.countplot(x='X4', data=train, order = sort_X4)<br/>plt.xlabel('X4')<br/>plt.ylabel('Occurances')<br/>plt.title('Feature X4')<br/>sns.despine();</span></pre><figure class="mo mp mq mr gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi od"><img src="../Images/54af1d1abac12dc75b4f153c05a7835a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kqw3F8aAY6-MorPsJ90qdA.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 16</figcaption></figure><p id="135e" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg"> X4 对目标特征 y </strong></p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="fcc7" class="mx ls jf mt b gy my mz l na nb">sort_y = train.groupby('X4')['y']\<br/>                    .median()\<br/>                    .sort_values(ascending=False)\<br/>                    .index<br/>plt.figure(figsize = (10, 6))<br/>sns.boxplot(y='y', x='X4', data=train, order = sort_y)<br/>ax = plt.gca()<br/>ax.set_xticklabels(ax.get_xticklabels())<br/>plt.title('X4 vs. y value')<br/>plt.show();</span></pre><figure class="mo mp mq mr gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi oe"><img src="../Images/03ea096193ada1ea26d139634c3705e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l72KePoLAYf7cEONMkzKEw.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 17</figcaption></figure><p id="ce1b" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg">功能 X5 </strong></p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="77ab" class="mx ls jf mt b gy my mz l na nb">sort_X5 = train.groupby('X5').size()\<br/>                    .sort_values(ascending=False)\<br/>                    .index<br/>plt.figure(figsize=(12,6))<br/>sns.countplot(x='X5', data=train, order = sort_X5)<br/>plt.xlabel('X5')<br/>plt.ylabel('Occurances')<br/>plt.title('Feature X5')<br/>sns.despine();</span></pre><figure class="mo mp mq mr gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi of"><img src="../Images/42dd87cb037dfa3958e0d04ee719eb92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vz6HZpS-tJN1TgK6AAXiRA.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 18</figcaption></figure><p id="f3af" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg"> X5 对目标特征 y </strong></p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="7b64" class="mx ls jf mt b gy my mz l na nb">sort_y = train.groupby('X5')['y']\<br/>                    .median()\<br/>                    .sort_values(ascending=False)\<br/>                    .index<br/>plt.figure(figsize = (12, 6))<br/>sns.boxplot(y='y', x='X5', data=train, order=sort_y)<br/>ax = plt.gca()<br/>ax.set_xticklabels(ax.get_xticklabels())<br/>plt.title('X5 vs. y value')<br/>plt.show();</span></pre><figure class="mo mp mq mr gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi og"><img src="../Images/3450fa00d1ab1ca4ff4913e07aa7f62c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XSXfyDLl47kUlaPR0ombew.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 19</figcaption></figure><p id="ef03" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg">功能 X6 </strong></p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="9985" class="mx ls jf mt b gy my mz l na nb">sort_X6 = train.groupby('X6').size()\<br/>                    .sort_values(ascending=False)\<br/>                    .index<br/>plt.figure(figsize=(12,6))<br/>sns.countplot(x='X6', data=train, order = sort_X6)<br/>plt.xlabel('X6')<br/>plt.ylabel('Occurances')<br/>plt.title('Feature X6')<br/>sns.despine();</span></pre><figure class="mo mp mq mr gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi og"><img src="../Images/bb73c2ebbdd63521ffc765d670ee44dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nO92IFnuHBKuso9D3lUx-A.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 20</figcaption></figure><p id="0b2b" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg"> X6 与目标特征 y 的对比</strong></p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="fd81" class="mx ls jf mt b gy my mz l na nb">sort_y = train.groupby('X6')['y']\<br/>                     .median()\<br/>                     .sort_values(ascending=False)\<br/>                     .index<br/>plt.figure(figsize = (12, 6))<br/>sns.boxplot(y='y', x='X6', data=train, order=sort_y)<br/>ax = plt.gca()<br/>ax.set_xticklabels(ax.get_xticklabels())<br/>plt.title('X6 vs. y value')<br/>plt.show();</span></pre><figure class="mo mp mq mr gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi oh"><img src="../Images/db870b3745e975a9b12f011eb5cd313e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JqYs-1Xb6jfu1ZgRu-bP1A.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 21</figcaption></figure><p id="dd2d" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg">功能 X8 </strong></p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="02e3" class="mx ls jf mt b gy my mz l na nb">sort_X8 = train.groupby('X8').size()\<br/>                    .sort_values(ascending=False)\<br/>                    .index<br/>plt.figure(figsize=(12,6))<br/>sns.countplot(x='X8', data=train, order = sort_X8)<br/>plt.xlabel('X8')<br/>plt.ylabel('Occurances')<br/>plt.title('Feature X8')<br/>sns.despine();</span></pre><figure class="mo mp mq mr gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi oi"><img src="../Images/f55e2838c79cf9f151774ac7468eca1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jnA-xOQcmDdE3pi0u3llzw.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 22</figcaption></figure><p id="c5fb" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg"> X8 对目标特征 y </strong></p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="da73" class="mx ls jf mt b gy my mz l na nb">sort_y = train.groupby('X8')['y']\<br/>                    .median()\<br/>                    .sort_values(ascending=False)\<br/>                    .index<br/>plt.figure(figsize = (12, 6))<br/>sns.boxplot(y='y', x='X8', data=train, order=sort_y)<br/>ax = plt.gca()<br/>ax.set_xticklabels(ax.get_xticklabels())<br/>plt.title('X8 vs. y value')<br/>plt.show();</span></pre><figure class="mo mp mq mr gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi oj"><img src="../Images/78e40df005e490551173ff4b8f58629e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zs3liDuLkSCRGelsWNBY5g.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 23</figcaption></figure><p id="0a9a" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">遗憾的是，我们并没有从上面的 EDA 中学到太多东西，这就是生活。然而，我们确实注意到一些分类特征对“y”有影响，而“X0”似乎影响最大。</p><p id="5646" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">在探索之后，我们现在将使用 Scikit-learn 的 MultiLabelBinarizer 将这些分类特征的级别编码为数字，并将它们视为新特征。</p><figure class="mo mp mq mr gt is"><div class="bz fp l di"><div class="ok ol l"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">encode_cat.py</figcaption></figure><p id="ec54" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">然后，我们丢弃已经编码的恒定特征和分类特征，以及我们的目标特征“y”。</p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="f885" class="mx ls jf mt b gy my mz l na nb">train_new = train.drop(['y','X11', 'X93', 'X107', 'X233', 'X235', 'X268', 'X289', 'X290', 'X293', 'X297', 'X330', 'X347', 'X0', 'X1', 'X2', 'X3', 'X4', 'X5', 'X6', 'X8'], axis=1)</span></pre><p id="1500" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">然后，我们添加编码的特征以形成用于 TPOT 的最终数据集。</p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="6cdd" class="mx ls jf mt b gy my mz l na nb">train_new = np.hstack((train_new.values, X0_trans, X1_trans, X2_trans, X3_trans, X4_trans, X5_trans, X6_trans, X8_trans))</span></pre><p id="6bd5" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">最终数据集以 numpy 数组的形式出现，形状为<em class="om"> (4209，552)。</em></p><h1 id="13ec" class="lr ls jf bd lt lu lv lw lx ly lz ma mb kl mc km md ko me kp mf kr mg ks mh mi bi translated">TPOT</h1><p id="88c2" class="pw-post-body-paragraph ku kv jf kw b kx mj kg kz la mk kj lc ld ml lf lg lh mm lj lk ll mn ln lo lp ij bi translated">是时候构建和安装 TPOT 回归器了。完成后，TPOT 将显示“最佳”模型(在我们的例子中，基于测试数据 MSE)超参数，并将管道输出为可执行的 Python 脚本文件，供以后使用或我们的调查。</p><figure class="mo mp mq mr gt is"><div class="bz fp l di"><div class="ok ol l"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">TPOT_Mercedes_regressor.py</figcaption></figure><figure class="mo mp mq mr gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi on"><img src="../Images/f8aa2c8ac237a3ee203910669e0c98db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rSQ7sMv7eV9ns_jkgnfULg.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 24</figcaption></figure><p id="17cc" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">运行上述代码将发现一个管道作为输出，在测试集上实现 56 均方误差(MSE ):</p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="361c" class="mx ls jf mt b gy my mz l na nb">print("TPOT cross-validation MSE")<br/>print(tpot.score(X_test, y_test))</span></pre><figure class="mo mp mq mr gt is gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/058ce46f4da40c2d5a59124b36bc347e.png" data-original-src="https://miro.medium.com/v2/resize:fit:774/format:webp/1*KVko4rtf8Du2N6QoktCmFg.png"/></div></figure><p id="7fc1" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">你可能已经注意到 MSE 是一个负数，根据<a class="ae lq" href="https://github.com/EpistasisLab/tpot/issues/675" rel="noopener ugc nofollow" target="_blank">这个线程</a>，TPOTRegressor 的<code class="fe op oq or mt b">neg_mean_squared_error</code>代表均方误差的负值。让我们再试一次。</p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="187e" class="mx ls jf mt b gy my mz l na nb">from sklearn.metrics import mean_squared_error<br/>print('MSE:')<br/>print(mean_squared_error(y_test, tpot.predict(X_test)))</span></pre><figure class="mo mp mq mr gt is gh gi paragraph-image"><div class="gh gi os"><img src="../Images/6def1ecd39ba2c325cab4cb50bf5bd3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:646/format:webp/1*dB_B3qV0dU3reers3UdeKw.png"/></div></figure><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="5d93" class="mx ls jf mt b gy my mz l na nb">print('RMSE:')<br/>print(np.sqrt(mean_squared_error(y_test, tpot.predict(X_test))))</span></pre><figure class="mo mp mq mr gt is gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/2591f8d13e103368d67307ac279ef1e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:754/format:webp/1*2vkm0Iy1XDQhfNHKTN_Rtw.png"/></div></figure><p id="9830" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">所以，我们预测的时间和实际时间之间的差异大约是 7.5 秒。那是一个相当好的结果！而产生这一结果的模型是一个在数据集上符合与 KNeighborsRegressor 算法堆叠的 RandomForestRegressor 的模型。</p><p id="08f9" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">最后，我们将导出此管道:</p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="3747" class="mx ls jf mt b gy my mz l na nb">tpot.export('tpot_Mercedes_testing_time_pipeline.py')</span></pre><figure class="mo mp mq mr gt is"><div class="bz fp l di"><div class="ok ol l"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">tpot_Mercedes_testing_time_pipeline.py</figcaption></figure><p id="c4bf" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">我喜欢学习和使用 TPOT，希望你也一样。<a class="ae lq" href="https://github.com/susanli2016/Machine-Learning-with-Python/blob/master/TPOT%20Mercedes.ipynb" rel="noopener ugc nofollow" target="_blank"> Jupyter 笔记本</a>可以在<a class="ae lq" href="https://github.com/susanli2016/Machine-Learning-with-Python/blob/master/TPOT%20Mercedes.ipynb" rel="noopener ugc nofollow" target="_blank"> Github </a>上找到。周末愉快！</p><p id="f02d" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">参考:<a class="ae lq" href="https://github.com/EpistasisLab/tpot/blob/master/tutorials/Portuguese%20Bank%20Marketing/Portuguese%20Bank%20Marketing%20Stratergy.ipynb" rel="noopener ugc nofollow" target="_blank"> TPOT 教程</a></p></div></div>    
</body>
</html>