<html>
<head>
<title>Position monitor detector in Ubuntu(build with opencv on python3)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Ubuntu 中的位置监视器检测器(在 python3 上用 opencv 构建)</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/position-monitor-detector-build-with-opencv-on-python3-3181b2fef414?source=collection_archive---------15-----------------------#2019-09-02">https://towardsdatascience.com/position-monitor-detector-build-with-opencv-on-python3-3181b2fef414?source=collection_archive---------15-----------------------#2019-09-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="88ca" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">因为我近视，我一直在寻找一种方法来控制我的眼睛到显示器的距离</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/487f33316007fc4520ba974bd740a191.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zMufRIq4fExx66Ze2t-uNg.png"/></div></div></figure><p id="a07b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">并且保持适当的距离，因为坐得太近对眼睛不好。在学习了一点 opencv 库之后，我正在思考这个想法的简单实现。</p><p id="d076" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">根据人体工程学提示(从<a class="ae ln" href="https://www.ergotron.com/en-us/ergonomics/ergonomic-equation" rel="noopener ugc nofollow" target="_blank">这里得到</a>):</p><p id="b246" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">调整显示器高度，使屏幕顶部与眼睛齐平或略低于眼睛。当观看屏幕中间时，你的眼睛应该稍微向下看。将显示器放在距离眼睛至少 20 英寸(51 厘米)的地方，大约一臂的距离。</p><p id="405c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">让我们在 Python3 中创建一个程序，它会在我们每次坐得太近时提醒我们(距离&lt;51 cm or 20 inches) to monitor and display a message with warning. So, for face recognition part we will use default classifier from opencv, and tkinter as a way to send message on the screen.</p><p id="21b4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Opencv is an awesome library, which allows you to do various operations on the image/video content such as convert to grayscale, make a mask, cropping, rescaling the image and many-many more.</p><p id="02d0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">After looking at <a class="ae ln" href="https://docs.opencv.org/3.0-beta/doc/py_tutorials/py_objdetect/py_face_detection/py_face_detection.html#face-detection" rel="noopener ugc nofollow" target="_blank">这个来自 opencv docs 的</a>例子，我认为，这是我特别需要的成功目标——进行简单的人脸检测。只是稍微调整一下例子——去掉眼睛分类器，就这样。</p><p id="06a6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">接下来的问题是如何测量人脸到摄像头的距离。稍微搜索了一下，发现了来自<a class="ae ln" href="https://www.pyimagesearch.com/2015/01/19/find-distance-camera-objectmarker-using-python-opencv/" rel="noopener ugc nofollow" target="_blank"> pyimagesearch </a>的超级文章。在这份材料中，你可以发现，测量距离现在可以从物体的高度计算，并从特定的距离知道物体的高度。</p><p id="d7c1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">例如，在距离 1 米处，以像素为单位对象的高度是 100。如果我们运行检测并观察，对象的高度是 50 像素——那么对象大约远两倍。如果是 120 像素，那么这个物体距离我们不到 1 米。因此，我们简单地检查现在的面部高度是否大于从选定距离知道的面部高度——然后发送带有 tkinter 的消息。</p><p id="7e8a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Tkinter 是一个简单的 GUI 工具，它提供了我们所需要的:弹出窗口部件，当且仅当检测到人脸并且人脸离监视器太近时才会出现。仅仅创建一个带有警告文本的文本小部件就足够了。</p><p id="0f88" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">所以，让我们实现所有这些吧！</p><p id="9f3b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">安装 Tkinter:</p><pre class="kg kh ki kj gt lo lp lq lr aw ls bi"><span id="b282" class="lt lu iq lp b gy lv lw l lx ly">sudo apt-get install python3-tk</span></pre><p id="fe0a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">安装其他 python 包:</p><pre class="kg kh ki kj gt lo lp lq lr aw ls bi"><span id="022b" class="lt lu iq lp b gy lv lw l lx ly">pip3 install numpy opencv-python</span></pre><p id="bd14" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">创建 python 脚本:</p><pre class="kg kh ki kj gt lo lp lq lr aw ls bi"><span id="c49a" class="lt lu iq lp b gy lv lw l lx ly">touch distance_detector.py</span></pre><p id="c25d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">用下面的代码填充脚本(给代码添加了很多注释，这样你就可以理解这里发生了什么):</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lz ma l"/></div><figcaption class="mb mc gj gh gi md me bd b be z dk">distance_detector.py</figcaption></figure><p id="ccce" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">快速解释:</p><ol class=""><li id="d842" class="mf mg iq kt b ku kv kx ky la mh le mi li mj lm mk ml mm mn bi translated">使用 argparse 允许从 cmd(9–14)设置距离和已知高度；</li><li id="e054" class="mf mg iq kt b ku mo kx mp la mq le mr li ms lm mk ml mm mn bi translated">函数，它创建 tkinter 消息并返回它(16–27)；</li><li id="cbd3" class="mf mg iq kt b ku mo kx mp la mq le mr li ms lm mk ml mm mn bi translated">从摄像机中捕捉视频，对其进行灰度处理，并进行人脸检测(32–43)；</li><li id="afec" class="mf mg iq kt b ku mo kx mp la mq le mr li ms lm mk ml mm mn bi translated">当未检测到人脸(44–46)或人脸远离时(56–59)—禁用 tkinter 消息。如果不这样做，警告信息不会在一次成功检测后消失；</li><li id="6868" class="mf mg iq kt b ku mo kx mp la mq le mr li ms lm mk ml mm mn bi translated">当检测到人脸时—计算到检测到的人脸的距离(48–52)；</li><li id="ef0a" class="mf mg iq kt b ku mo kx mp la mq le mr li ms lm mk ml mm mn bi translated">如果距离小于选定距离—启用 tkinter 消息(53–55)；</li><li id="e9d6" class="mf mg iq kt b ku mo kx mp la mq le mr li ms lm mk ml mm mn bi translated">在 opencv 窗口中显示有用的信息，按 Q(60–81)后全部关闭。</li></ol><p id="5a9e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在使用之前，我们需要根据你的脸校准它。为此:</p><ol class=""><li id="6bc5" class="mf mg iq kt b ku kv kx ky la mh le mi li mj lm mk ml mm mn bi translated">运行<code class="fe mt mu mv lp b">python3 distance_detector.py</code>；</li><li id="d2fb" class="mf mg iq kt b ku mo kx mp la mq le mr li ms lm mk ml mm mn bi translated">坐在远处的摄像机前，这将限制眼睛；</li><li id="ac4b" class="mf mg iq kt b ku mo kx mp la mq le mr li ms lm mk ml mm mn bi translated">注意<code class="fe mt mu mv lp b">face_height</code>参数并关闭脚本(在窗口中按 Q)；</li><li id="e5c6" class="mf mg iq kt b ku mo kx mp la mq le mr li ms lm mk ml mm mn bi translated">用你的<code class="fe mt mu mv lp b">face_height</code>参数运行<code class="fe mt mu mv lp b">python3 distance_detector.py</code>。</li></ol><p id="011a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">例如，当我从 51 厘米开始坐着时，我的面部高度是 300 像素。在我的情况下，我需要运行<code class="fe mt mu mv lp b">python3 distance_detector.py -f 300 -d 0.51</code>。</p><p id="444d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">它看起来像什么:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mw ma l"/></div><figcaption class="mb mc gj gh gi md me bd b be z dk">Yep, it works!</figcaption></figure><p id="2647" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在本文中，你可以看到，在将想法分解成小块之后，实际实现变得并不困难。是的，您可以添加更多的技术来使检测工作更加准确并提高性能——但作为简单的例子，这应该足够了。</p><p id="90ba" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">附:如果戴眼镜，要注意探测会不太准确。</p><p id="9d5d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">感谢您的关注！祝你有美好的一天=)</p></div></div>    
</body>
</html>