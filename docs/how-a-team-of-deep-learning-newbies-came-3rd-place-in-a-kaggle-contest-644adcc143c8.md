# æ·±åº¦å­¦ä¹ æ–°æ‰‹å›¢é˜Ÿå¦‚ä½•åœ¨ kaggle ç«èµ›ä¸­è·å¾—ç¬¬ä¸‰å

> åŸæ–‡ï¼š<https://towardsdatascience.com/how-a-team-of-deep-learning-newbies-came-3rd-place-in-a-kaggle-contest-644adcc143c8?source=collection_archive---------6----------------------->

## åˆ©ç”¨ fast.ai å¯¹æ²¹æ£•æ—å›¾åƒè¿›è¡Œåˆ†ç±»

![](img/b633615eaeb51bcd102047de4601c72f.png)

Photo by [Alexander Naglestad](https://unsplash.com/@alexandernaglestad?utm_source=medium&utm_medium=referral) on [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral)

æ•°æ®ç§‘å­¦é¢†åŸŸçš„å¦‡å¥³ä¸å…¶åˆä½œä¼™ä¼´å…±åŒå‘èµ·äº† WiDS æ•°æ®é©¬æ‹‰æ¾ã€‚é¢ä¸´çš„æŒ‘æˆ˜æ˜¯åˆ›å»ºä¸€ä¸ªæ¨¡å‹æ¥é¢„æµ‹å«æ˜Ÿå›¾åƒä¸­æ²¹æ£•ç§æ¤å›­çš„å­˜åœ¨ã€‚*è¡Œæ˜Ÿ*å’Œ*å…«å­—*æ…·æ…¨åœ°æä¾›äº†ä¸€ç»„ç”±*è¡Œæ˜Ÿçš„*å«æ˜Ÿæœ€è¿‘æ‹æ‘„çš„å«æ˜Ÿå›¾åƒçš„æ³¨é‡Šæ•°æ®é›†ã€‚æ•°æ®é›†å½±åƒçš„ç©ºé—´åˆ†è¾¨ç‡ä¸º 3 ç±³ï¼Œæ¯ä¸ªå½±åƒéƒ½æ ¹æ®å½±åƒä¸­æ˜¯å¦å­˜åœ¨æ²¹æ£•ç§æ¤å›­è¿›è¡Œæ ‡æ³¨(0 è¡¨ç¤ºæ— ç§æ¤å›­ï¼Œ1 è¡¨ç¤ºæœ‰ç§æ¤å›­)ã€‚ä»»åŠ¡æ˜¯è®­ç»ƒä¸€ä¸ªæ¨¡å‹ï¼Œè¯¥æ¨¡å‹å°†å«æ˜Ÿå›¾åƒä½œä¸ºè¾“å…¥ï¼Œå¹¶è¾“å‡ºå›¾åƒåŒ…å«æ²¹æ£•æ¦ˆç§æ¤å›­çš„å¯èƒ½æ€§é¢„æµ‹ã€‚[ç«èµ›åˆ›å»ºè€…](https://www.widsconference.org/datathon.html)ä¸ºæ¨¡å‹å¼€å‘æä¾›äº†å¸¦æ ‡ç­¾çš„è®­ç»ƒå’Œæµ‹è¯•æ•°æ®é›†ã€‚æ›´å¤š[**æ­¤å¤„**](https://www.kaggle.com/c/widsdatathon2019) é˜…è¯»ã€‚

æˆ‘å’Œæˆ‘çš„é˜Ÿå‹([é˜¿åœè¿ªæ²™åº“å°”](https://medium.com/u/d4284ce02aec?source=post_page-----644adcc143c8--------------------------------)ã€[å“ˆåˆ©ç›](https://www.linkedin.com/in/halimah-oladosu-50680385/)å’Œ[ä¼Šæ¬§é©¬Â·å¥¥ç§‘](https://medium.com/u/2f29addd85ff?source=post_page-----644adcc143c8--------------------------------))åœ¨è¿™æ¬¡æŒ‘æˆ˜ä¸­ä½¿ç”¨äº† [fast.ai](https://www.fast.ai/) æ¡†æ¶ã€‚éå¸¸æ„Ÿè°¢æ‰˜é©¬æ–¯Â·å¡ä½©å‹’ğŸ¤—å¯¹äºä»–åœ¨ [kaggle](https://www.kaggle.com/tcapelle) ä¸Šçš„å…¥é—¨å†…æ ¸ï¼Œå®ƒæä¾›äº†å…³äºå¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜çš„å¦‚æ­¤å¤šçš„è§è§£ï¼Œä¹Ÿä¸º fast.ai å›¢é˜Ÿåˆ›é€ äº†ä¸€ä¸ªä»¤äººæƒŠå¹çš„[æ·±åº¦å­¦ä¹ è¯¾ç¨‹](https://course.fast.ai/)ï¼Œç®€åŒ–äº†è®¸å¤šå›°éš¾çš„æ·±åº¦å­¦ä¹ æ¦‚å¿µã€‚æ·±åº¦å­¦ä¹ çš„åˆå­¦è€…ç°åœ¨å¯ä»¥èµ¢å¾—æ¸¸æˆæ¯”èµ›ğŸ˜ã€‚

## è®©æˆ‘ä»¬å¼€å§‹å§:ä¸€ä¸ªç®€å•æ˜“ç”¨çš„æ·±åº¦å­¦ä¹ æ•™ç¨‹

ä¸è¦æ‹…å¿ƒç†è§£æ‰€æœ‰çš„ä¸œè¥¿ï¼Œè¿™éœ€è¦å¤§é‡çš„ç»ƒä¹ ã€‚è¿™ä¸ªæ•™ç¨‹å°±æ˜¯æƒ³è®©ä½ çœ‹çœ‹ fast.ai å¯¹äºåˆå­¦æ·±åº¦å­¦ä¹ çš„äººæ¥è¯´æœ‰å¤šé…·ã€‚æˆ‘å‡è®¾ä½ äº†è§£ä¸€äº› pythonï¼Œå¹¶ä¸”å¯¹ ML æœ‰æ‰€æ¶‰çŒã€‚å¦‚æœé‚£æ˜¯ä½ ï¼›é‚£æˆ‘ä»¬å°±èµ°ä¸Šæ­£è½¨äº†ã€‚

> è¿™é‡Œæ˜¾ç¤ºçš„æ‰€æœ‰ä»£ç éƒ½å¯ä»¥åœ¨[è°·æ­Œåˆä½œå®éªŒå®¤](https://colab.research.google.com/notebooks/welcome.ipynb)è·å¾—ï¼›ä¸€ä¸ªå…è´¹çš„ Jupyter ç¬”è®°æœ¬ç¯å¢ƒï¼Œä¸éœ€è¦è®¾ç½®ï¼Œå®Œå…¨åœ¨äº‘ä¸­è¿è¡Œã€‚å€ŸåŠ© Colaboratoryï¼Œæ‚¨å¯ä»¥ç¼–å†™å’Œæ‰§è¡Œä»£ç ã€ä¿å­˜å’Œå…±äº«æ‚¨çš„åˆ†æï¼Œä»¥åŠè®¿é—®å¼ºå¤§çš„è®¡ç®—èµ„æºï¼Œæ‰€æœ‰è¿™äº›éƒ½å¯ä»¥ä»æµè§ˆå™¨ä¸­å…è´¹è·å¾—ã€‚ç‚¹å‡»[è¿™é‡Œ](https://colab.research.google.com/drive/1PVaRPY1XZuPLtm01V2XxIWqhLrz3_rgX)è®¿é—®æˆ‘ä»¬å°†è¦ä½¿ç”¨çš„ä»£ç ã€‚

## å¯¼å…¥ fast.ai å’Œæˆ‘ä»¬å°†ä½¿ç”¨çš„å…¶ä»–åº“

Import libraries

## è·å–æ¯”èµ›[æ•°æ®](https://www.kaggle.com/c/widsdatathon2019/data)

ä¸ºäº†å°½å¯èƒ½ç›´æˆªäº†å½“ï¼Œé˜¿åœè¿ªæ²™åº“å°”ä¸Šä¼ äº†æ¯”èµ›æ•°æ®æ–‡ä»¶ç»™ dropbox.comã€‚ä½ å¯ä»¥åœ¨æ¯”èµ›ç½‘é¡µ[è¿™é‡Œ](https://www.kaggle.com/c/widsdatathon2019/data)æ‰¾åˆ°å®ƒä»¬ã€‚ä½ éœ€è¦æ¥å—æ¯”èµ›è§„åˆ™å¹¶åŠ å…¥æ‰èƒ½è®¿é—®æ•°æ®ã€‚

```
# Get the data from dropbox link
!wget [https://www.dropbox.com/s/6kltw0kqynlijxv/widsdatathon2019.zip](https://www.dropbox.com/s/6kltw0kqynlijxv/widsdatathon2019.zip)

# The downloaded competition data is zipped, let us unzip it
!unzip widsdatathon2019.zip# The training and testing data have already been seperated, Unzip them as well
!unzip train_images.zip
!unzip leaderboard_holdout_data.zip
!unzip leaderboard_test_data.zip
```

## çœ‹ç€è¿™äº›æ•°æ®

å½“æˆ‘ä»¬ç€æ‰‹è§£å†³ä¸€ä¸ªé—®é¢˜æ—¶ï¼Œé¦–å…ˆè¦åšçš„æ˜¯çœ‹ä¸€çœ‹ç°æœ‰çš„æ•°æ®ã€‚æˆ‘ä»¬éœ€è¦äº†è§£é—®é¢˜å’Œæ•°æ®æ˜¯ä»€ä¹ˆæ ·çš„ï¼Œç„¶åæ‰èƒ½æ‰¾åˆ°è§£å†³æ–¹æ³•ã€‚æŸ¥çœ‹æ•°æ®æ„å‘³ç€äº†è§£æ•°æ®ç›®å½•çš„ç»“æ„ï¼Œæ ‡ç­¾æ˜¯ä»€ä¹ˆï¼Œä»¥åŠä¸€äº›ç¤ºä¾‹å›¾åƒæ˜¯ä»€ä¹ˆæ ·å­ã€‚

Use the pandas library to read the data

![](img/67c4650676e77addd62a02cbabb30e54.png)

The labels of the data weâ€™ll use to train our models

å¤„ç†å½±åƒåˆ†ç±»æ•°æ®é›†å’Œè¡¨æ ¼æ•°æ®é›†çš„ä¸»è¦åŒºåˆ«åœ¨äºæ ‡æ³¨çš„å­˜å‚¨æ–¹å¼ã€‚è¿™é‡Œçš„æ ‡ç­¾æŒ‡çš„æ˜¯å›¾åƒä¸­çš„å†…å®¹ã€‚åœ¨è¿™ä¸ªç‰¹å®šçš„æ•°æ®é›†ä¸­ï¼Œæ ‡ç­¾å­˜å‚¨åœ¨ CSV æ–‡ä»¶ä¸­ã€‚

è¦äº†è§£æ›´å¤šå…³äºå¦‚ä½•è®¡ç®—**åˆ†æ•°**æ çš„ä¿¡æ¯ï¼Œè¯·ç‚¹å‡» [**æ­¤å¤„**](https://success.figure-eight.com/hc/en-us/articles/201855939-How-to-Calculate-a-Confidence-Score) ã€‚

æˆ‘ä»¬å°†ä½¿ç”¨ seaborn çš„`countplot` å‡½æ•°æ¥æŸ¥çœ‹æˆ‘ä»¬çš„è®­ç»ƒæ•°æ®çš„åˆ†å¸ƒã€‚ä»è¯¥å›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¤§çº¦ 14ï¼Œ300 å¹…å›¾åƒä¸­æ²¡æœ‰æ²¹æ£•æ¦ˆç§æ¤å›­ï¼Œè€Œåªæœ‰ 942 å¹…å›¾åƒä¸­æœ‰ã€‚è¿™è¢«ç§°ä¸º[ä¸å¹³è¡¡æ•°æ®é›†](/deep-learning-unbalanced-training-data-solve-it-like-this-6c528e9efea6)ï¼Œè¿™æ˜¯ä¸€ä¸ªæ·±åº¦å­¦ä¹ é—®é¢˜ï¼Œæˆ‘ä»¬ä¸æ‰“ç®—åœ¨è¿™é‡Œè®¨è®ºï¼›ç›®å‰æˆ‘ä»¬æ­£åœ¨æ…¢æ…¢åœ°èµ°ğŸ‘¶ğŸ½ã€‚

Count of the two classes

![](img/474c4b2c57400277505a6310aea6a5ff.png)

Distribution of the training dataset

# å‡†å¤‡æ•°æ®

æä¾›çš„æµ‹è¯•æ•°æ®ä½äºä¸¤ä¸ªç‹¬ç«‹çš„æ–‡ä»¶å¤¹ä¸­ï¼Œåˆ†åˆ«æ˜¯*æ’è¡Œæ¦œç»´æŒæ•°æ®ã€*å’Œ*æ’è¡Œæ¦œæµ‹è¯•æ•°æ®ã€‚*æˆ‘ä»¬å°†æŠŠä¸¤è€…ç»“åˆèµ·æ¥ï¼Œå› ä¸ºæ¯”èµ›è¦æ±‚æäº¤å¯¹ä¸¤è€…çš„é¢„æµ‹ã€‚æˆ‘ä»¬ç»„åˆäº†`6534`ä¸ªå›¾åƒã€‚

Combine *leaderboard holdout data* and *leaderboard test data*

æˆ‘ä»¬å°†ä½¿ç”¨ fast.ai çš„[æ•°æ®å— API](https://github.com/fastai/fastai/blob/master/docs_src/data_block.ipynb) æ¥æ„å»ºæ•°æ®ï¼Œè¿™æ˜¯ä¸€ç§å°†æ•°æ®é›†å‘ˆç°ç»™æ¨¡å‹çš„ä¾¿æ·æ–¹å¼ã€‚

Creating an ImageList to hold the data

*   æˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ª`ImageList`æ¥ä¿å­˜æˆ‘ä»¬çš„è®­ç»ƒæ•°æ®ï¼Œå¹¶ä½¿ç”¨`from_df`æ–¹æ³•ã€‚æˆ‘ä»¬è¿™æ ·åšæ˜¯å› ä¸ºæˆ‘ä»¬å°†å…³äºè®­ç»ƒé›†çš„ä¿¡æ¯å­˜å‚¨åœ¨ä¸€ä¸ªåä¸º`df`çš„æ•°æ®å¸§ä¸­ã€‚æˆ‘ä»¬å‘Šè¯‰å®ƒåœ¨å“ªé‡Œå¯ä»¥æ‰¾åˆ°æˆ‘ä»¬çš„è®­ç»ƒå›¾åƒï¼Œ`path`ä»¥åŠä¿å­˜å›¾åƒçš„æ–‡ä»¶å¤¹çš„åç§°ï¼Œ`train_images`ã€‚
*   æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨éšæœºæ‹†åˆ†æ¥æ‹†åˆ†æˆ‘ä»¬çš„è®­ç»ƒé›†ã€‚æˆ‘ä»¬å¸Œæœ›ç•™å‡º 20%çš„æ•°æ®æ¥ç›‘æ§æ¨¡å‹åœ¨è®­ç»ƒæœŸé—´çš„è¡¨ç°ã€‚æˆ‘ä»¬é€‰æ‹©äº†ä¸€ä¸ªç§å­ï¼Œä»¥ç¡®ä¿æˆ‘ä»¬å†æ¬¡æ£€æŸ¥æ—¶å¾—åˆ°ç›¸åŒçš„ç»“æœã€‚æˆ‘ä»¬éœ€è¦çŸ¥é“ä»€ä¹ˆå¯è¡Œï¼Œä»€ä¹ˆä¸å¯è¡Œã€‚
*   æˆ‘ä»¬å‘Šè¯‰`ImageList`åœ¨å“ªé‡Œå¯ä»¥æ‰¾åˆ°æˆ‘ä»¬è®­ç»ƒé›†ä¸­æ•°æ®çš„æ ‡ç­¾ï¼Œ`has_oilpalm`å¹¶æ·»åŠ æˆ‘ä»¬åˆšåˆšåˆå¹¶çš„æ•°æ®ä½œä¸ºæµ‹è¯•æ•°æ®ã€‚
*   æœ€åï¼Œæˆ‘ä»¬å¯¹æ•°æ®æ‰§è¡Œè½¬æ¢ã€‚ç”¨`flip_vert = True`ç¿»è½¬å›¾åƒæœ‰åŠ©äºæ¨¡å‹è¯†åˆ«å›¾åƒï¼Œä¸ç®¡å®ƒä»¬çš„æ–¹å‘å¦‚ä½•ã€‚æˆ‘ä»¬å°†ä½¿ç”¨`imagenet_stats`æ¥æ ‡å‡†åŒ–å›¾åƒã€‚ ***æ³¨æ„:è¿™æ˜¯ä¸€ç§è¿ç§»å­¦ä¹ æŠ€å·§ï¼Œä¸ºäº†å°½å¯èƒ½ç®€å•èµ·è§ï¼Œè¿™å°±æ˜¯æˆ‘è¦è¯´çš„ã€‚*ğŸ¤**

# å›¾åƒé¢„è§ˆ

ä»¥ä¸‹æ˜¯æœ‰æˆ–æ²¡æœ‰æ²¹æ£•æ¦ˆç§æ¤å›­çš„å«æ˜Ÿå›¾åƒ:

Show 2 batches of images

![](img/9f08b6be91f8493eadd52c34d72a05bc.png)

Images with oil palms are labeled 1, those without are 0

# è®­ç»ƒæˆ‘ä»¬çš„æ¨¡å‹

ç°åœ¨æˆ‘ä»¬è®­ç»ƒæˆ‘ä»¬çš„æ¨¡å‹ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ª[å·ç§¯ç¥ç»ç½‘ç»œ](http://cs231n.github.io/convolutional-networks/)ä¸»å¹²ï¼Œå¹¶ä½¿ç”¨æ¥è‡ª resnet æ¨¡å‹çš„é¢„è®­ç»ƒæƒé‡ï¼Œè¯¥æ¨¡å‹å·²è¢«è®­ç»ƒç”¨äºå¯¹å„ç§å›¾åƒè¿›è¡Œåˆ†ç±»ã€‚ä¸è¦ç®¡è¿™å…·ä½“æ˜¯ä»€ä¹ˆæ„æ€ã€‚ç›®å‰ï¼Œæˆ‘ä»¬æ­£åœ¨å»ºç«‹ä¸€ä¸ªæ¨¡å‹ï¼Œè¯¥æ¨¡å‹ä»¥å«æ˜Ÿå›¾åƒä¸ºè¾“å…¥ï¼Œè¾“å‡ºä¸¤ä¸ªç±»åˆ«çš„é¢„æµ‹æ¦‚ç‡ã€‚

Convolutional neural network

Find an optimal model learning rate

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨`lr_find()`æ‰¾åˆ°ä¸€ä¸ªç†æƒ³çš„å­¦ä¹ ç‡ï¼Œå¹¶ä½¿ç”¨`recorder.plot()`å°†å…¶å¯è§†åŒ–ã€‚

![](img/716ec73d27cf84a74d77b47ef74fdec2.png)

Find an optimal model learning rate

æˆ‘ä»¬å°†é€‰æ‹©ä¸€ä¸ªæ¥è¿‘æ–œç‡æœ€é™¡çš„å­¦ä¹ ç‡ï¼Œåœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­æ˜¯`1e-2`ã€‚

Train model for 5 cycles with learning rate = 1e-2

æˆ‘ä»¬å°†ä½¿ç”¨`fit_one_cycle`å‡½æ•°ä¸ºæˆ‘ä»¬çš„æ¨¡å‹è®­ç»ƒ 5 ä¸ªæ—¶æœŸ(é€šè¿‡æ‰€æœ‰æ•°æ®çš„ 5 ä¸ªå‘¨æœŸ)ã€‚

![](img/d27e4f8eb9178eb9ed01a7533a97488d.png)

Training and validation losses

æ³¨æ„æ˜¾ç¤ºçš„`metrics`å³`training_loss`å’Œ`valid_loss`ï¼Ÿæˆ‘ä»¬ç”¨å®ƒä»¬æ¥ç›‘æ§æ¨¡å‹éšæ—¶é—´çš„æ”¹è¿›ã€‚

æˆ‘ä»¬æœ€å¥½çš„æ¨¡å‹æ˜¯åœ¨ç¬¬å››çºªå…ƒè·å¾—çš„ã€‚

![](img/ec3479bbc2f184bacbc246baafa40042.png)

The output of training our model; the progression of training and validation losses

å½“ä½ è¿è¡Œè®­ç»ƒå’ŒéªŒè¯æ•°æ®é›†æ—¶ï¼Œfast.ai åœ¨å†…éƒ¨åªæŒ‘é€‰å’Œä¿å­˜ä½ çš„æœ€ä½³æ¨¡å‹ã€‚

# è¯„ä¼°æˆ‘ä»¬çš„æ¨¡å‹

æ ¹æ®é¢„æµ‹æ¦‚ç‡å’Œè§‚å¯Ÿç›®æ ‡`has_oilpalm`ä¹‹é—´çš„æ¥æ”¶å™¨å·¥ä½œç‰¹æ€§æ›²çº¿ä¸‹çš„é¢ç§¯ï¼Œå¯¹æäº¤çš„ç«èµ›è¿›è¡Œè¯„ä¼°ã€‚åœ¨è¿™ä¸ª[å¼€å‘è€…é€Ÿæˆç­](https://developers.google.com/machine-learning/crash-course/classification/roc-and-auc)ã€è¿™ä¸ª[è§†é¢‘](https://www.dataschool.io/roc-curves-and-auc-explained/)æˆ–è¿™ä¸ª [Kaggle å­¦ä¹ è®ºå›](https://www.kaggle.com/learn-forum/53782)å¸–å­ä¸­äº†è§£æ›´å¤šå…³äº AUC çš„ä¿¡æ¯ã€‚Fast.ai é»˜è®¤æƒ…å†µä¸‹æ²¡æœ‰è¿™ä¸ªæŒ‡æ ‡ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†ä½¿ç”¨ scikit-learn åº“ã€‚

Print out validation metrics

ä½¿ç”¨é¢„è®­ç»ƒæ¨¡å‹å’Œ fast.ai çš„å¥½å¤„åœ¨äºï¼Œä½ å¯ä»¥è·å¾—éå¸¸å¥½çš„é¢„æµ‹ç²¾åº¦ï¼Œ`99.44%`åœ¨æˆ‘ä»¬çš„æƒ…å†µä¸‹ï¼Œæ— éœ€åšæœ€å¤šçš„äº‹æƒ…ã€‚

![](img/b6d97ce1ef0f230f5444363d7ffcacad.png)

The metrics for the first stage of training

è®©æˆ‘ä»¬ä¿å­˜æˆ‘ä»¬çš„æ¨¡å‹ï¼Œå¹¶ç»˜åˆ¶ä¸€ä¸ªå…³äºé¢„æµ‹çš„æ··æ·†çŸ©é˜µã€‚

```
learn.save('resnet50-stg1')
```

# ä½¿ç”¨æ··æ·†çŸ©é˜µæŸ¥çœ‹ç»“æœ

Plot confusion matrix

æ··æ·†çŸ©é˜µæ˜¯æŸ¥çœ‹æ¨¡å‹å‡†ç¡®æˆ–ä¸å‡†ç¡®é¢„æµ‹çš„å›¾åƒæ•°é‡çš„å›¾å½¢æ–¹å¼ã€‚

![](img/e533943403f645efc8216ab4c58f0831.png)

Confusion matrix for the first stage of training

ä»è¯¥å›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¯¥æ¨¡å‹å‡†ç¡®é¢„æµ‹äº† 2ï¼Œ863 å¹…å›¾åƒä¸­æ²¡æœ‰æ²¹æ£•æ¦ˆç§æ¤å›­ï¼Œ168 å¹…å›¾åƒä¸­æœ‰æ²¹æ£•æ¦ˆç§æ¤å›­è¢«æ­£ç¡®åˆ†ç±»ã€‚åŒ…å«æ²¹æ£•ç§æ¤å›­çš„ 10 å¹…å›¾åƒè¢«åˆ†ç±»ä¸ºæ²¡æœ‰ï¼Œè€Œä¸åŒ…å«æ²¹æ£•ç§æ¤å›­çš„ 7 å¹…å›¾åƒè¢«åˆ†ç±»ä¸ºæœ‰ã€‚

å¯¹äºä¸€ä¸ªç®€å•çš„æ¨¡å‹ğŸ¥³.æ¥è¯´è¿˜ä¸é”™

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¸ºè¿™ä¸ªè®­ç»ƒè¿­ä»£æ‰¾åˆ°ä¸€ä¸ªç†æƒ³çš„å­¦ä¹ ç‡ã€‚

Find an ideal learning rate

![](img/94feb5c4745dab4e15f23ef07098ef80.png)

We choose a learning rate thatâ€™s between `1e-6` and `1e-4`

ä½¿ç”¨ 7 ä¸ªæ—¶æœŸå†…`1e-6`å’Œ`1e-4`ä¹‹é—´çš„æœ€å¤§å­¦ä¹ é€Ÿç‡æ¥æ‹Ÿåˆæ¨¡å‹ã€‚

Train model for 7 cycles, the learning rate shouldnâ€™t exceed the range of 1e-6 and 1e-4

![](img/3308dbbaaab76df3ad4db1e25b031af3.png)

Training and validation losses

ä»¥å›¾å½¢æ–¹å¼è§‚å¯Ÿè®­ç»ƒæŒ‡æ ‡ï¼Œä»¥åœ¨æ¯ä¸ªè®­ç»ƒå‘¨æœŸåç›‘æ§æ¨¡å‹çš„æ€§èƒ½ã€‚

![](img/4359184c02a2b3af069499fe4f28a5d4.png)

The output of training our model; the progression of training and validation losses

çœå»ç¬¬äºŒé˜¶æ®µçš„æ¨¡å‹è®­ç»ƒã€‚

```
learn.save('resnet50-stg2')
```

Accuracy, error rate and AUC score

æ‰“å°å‡ºæ¨¡å‹çš„ç²¾ç¡®åº¦ã€è¯¯å·®ç‡å’Œæ›²çº¿ä¸‹é¢ç§¯ã€‚

![](img/0aed8e4657276dd6f1f6c878f2498ac4.png)

The metrics for the second stage of training

ä½ ä¼šæ³¨æ„åˆ°æ¨¡å‹çš„ç²¾ç¡®åº¦ä»`99.44%`æé«˜åˆ°`99.48%`ã€‚é”™è¯¯ç‡ä»`0.0056`é™ä½åˆ°`0.0052`ã€‚AUC ä¹Ÿæœ‰æ‰€æ”¹å–„ï¼Œä»`99.82%`åˆ°`99.87%.`

Plot confusion matrix

ä¸æˆ‘ä»¬ç»˜åˆ¶çš„ä¸Šä¸€ä¸ªæ··æ·†çŸ©é˜µç›¸æ¯”ï¼Œä½ ä¼šæ³¨æ„åˆ°è¿™ä¸ªæ¨¡å‹åšå‡ºäº†æ›´å¥½çš„é¢„æµ‹ã€‚

![](img/74a49ac139ba39d95aea771e3c3584f4.png)

Confusion matrix for the second stage of training

ä»¥å‰ 7 å¼ æ²¡æœ‰æ²¹æ£•æ¦ˆç§æ¤å›­çš„å›¾ç‰‡è¢«é”™è¯¯åˆ†ç±»ï¼Œç°åœ¨æˆ‘ä»¬å‡å°‘åˆ° 3 å¼ ã€‚è¿™å°±æ˜¯è¿›æ­¥ã€‚

ä½ ä¼šæ³¨æ„åˆ°æˆ‘ä»¬åœ¨è®­ç»ƒä¸­ä¸€ç›´éµå¾ªä¸€ä¸ªæ¨¡å¼ï¼Œå¹¶åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­è°ƒæ•´äº†ä¸€äº›å‚æ•°ã€‚æˆ‘ä»¬ä¸€ç›´åœ¨åšçš„å«åšè°ƒè°ã€‚å¤§å¤šæ•°æ·±åº¦å­¦ä¹ å®éªŒéƒ½éµå¾ªç±»ä¼¼çš„è¿­ä»£æ¨¡å¼ã€‚

## å›¾åƒè½¬æ¢

æˆ‘ä»¬å°†å¯¹æ•°æ®æ‰§è¡Œæ›´å¤šçš„å›¾åƒè½¬æ¢ã€‚è¿™åº”è¯¥ä¼šæ”¹è¿›æˆ‘ä»¬çš„æ¨¡å‹ã€‚æ¯ä¸ªè½¬æ¢çš„è¯¦ç»†æè¿°å¯ä»¥åœ¨ fast.ai [æ–‡æ¡£](https://docs.fast.ai/vision.transform.html)ä¸­æ‰¾åˆ°:

Applying different transforms to improve our model

*   `max_lighting`:å¦‚æœä¸æ˜¯`None`ï¼Œåˆ™ä»¥æ¦‚ç‡ p_lighting åº”ç”¨ç”± max_lighting æ§åˆ¶çš„éšæœºé—ªç”µå’Œå¯¹æ¯”åº¦å˜åŒ–
*   `max_zoom`:å¦‚æœä¸æ˜¯`1.`æˆ–æ›´å°ï¼Œåˆ™ä»¥æ¦‚ç‡ p_affine åº”ç”¨`1.`å’Œ max_zoom ä¹‹é—´çš„éšæœºç¼©æ”¾
*   `max_warp`:å¦‚æœä¸æ˜¯`None`ï¼Œåˆ™ä»¥æ¦‚ç‡ p_affine åº”ç”¨åœ¨`-max_warp`å’Œ`max_warp`ä¹‹é—´çš„å¤§å°çš„éšæœºå¯¹ç§°æ‰­æ›²

æˆ‘ä»¬åˆæ‰¾åˆ°äº†ä¸€ä¸ªæœ€ä¼˜å­¦ä¹ ç‡ã€‚

Find an ideal learning rate

![](img/6df98bfa697ea88e0b3322ef0fc57809.png)

We chose a learning rate of 1e-6

5 ä¸ªå‘¨æœŸçš„è®­ç»ƒæ¨¡å‹ã€‚

Train for 5 cycles

![](img/1b81a88b093ee913d6f2d5682c574e3e.png)

Training and validation losses

æ¯”è¾ƒåŸ¹è®­æŒ‡æ ‡ï¼Œå¹¶ä¸è¿‡å»çš„æŒ‡æ ‡è¿›è¡Œæ¯”è¾ƒã€‚æˆ‘ä»¬çš„æ¨¡å‹åœ¨è¿™æ¬¡è¿­ä»£ä¸­`0.0169`æ¯”`0.0163`ç¨å·®ã€‚ä¸è¦ç»æœ›ã€‚

![](img/2d4d12bf99b010243010f1abeab336e2.png)

The output of training our model; the best model is at epoch 3

ä¿å­˜æ¨¡å‹åŸ¹è®­çš„ç¬¬ä¸‰é˜¶æ®µï¼Œå¹¶æ‰“å°å‡ºæŒ‡æ ‡ã€‚ä½ ä¼šæ³¨æ„åˆ°ï¼Œæ¨¡å‹çš„ç²¾åº¦ç°åœ¨æ˜¯`99.38%`ï¼Œåœ¨å‰ä¸€é˜¶æ®µæ˜¯`99.48%`ã€‚AUC å¾—åˆ†ä»`99.87%`æé«˜åˆ°`99.91%`ï¼Œè¿™æ˜¯å¯¹ç«äº‰è¿›è¡Œè¯„çº§çš„æŒ‡æ ‡ã€‚

```
learn.save('resnet50-stg3')
```

Accuracy, error rate and AUC score

![](img/00c925b93fc63c543886fee6fd8f2821.png)

The metrics for the third stage of training

# æœ€ç»ˆåŸ¹è®­é˜¶æ®µ

å¦‚æœä½ æ³¨æ„åˆ°æˆ‘ä»¬ä»æœ‰`size = 164`çš„å›¾åƒå¼€å§‹ï¼Œæˆ‘ä»¬é€æ¸å»ºç«‹ï¼Œç›´åˆ°æˆ‘ä»¬åˆ°è¾¾ä¸‹é¢çš„`size = 256`ã€‚æˆ‘ä»¬è¿™æ ·åšæ˜¯ä¸ºäº†åˆ©ç”¨ fast.ai çš„æ¸è¿›å¼å›¾åƒå¤§å°è°ƒæ•´è¿›è¡Œåˆ†ç±»ï¼Œå³åœ¨è®­ç»ƒå¼€å§‹æ—¶ä½¿ç”¨å°å›¾åƒï¼Œå¹¶éšç€è®­ç»ƒçš„è¿›è¡Œé€æ¸å¢åŠ å¤§å°ã€‚è¿™æ ·ï¼Œå½“æ¨¡å‹åœ¨æ—©æœŸéå¸¸ä¸å‡†ç¡®æ—¶ï¼Œå®ƒå¯ä»¥å¿«é€Ÿçœ‹åˆ°å¤§é‡å›¾åƒå¹¶å–å¾—å¿«é€Ÿè¿›å±•ï¼Œç„¶ååœ¨è®­ç»ƒä¸­ï¼Œå®ƒå¯ä»¥çœ‹åˆ°æ›´å¤§çš„å›¾åƒä»¥äº†è§£æ›´ç²¾ç»†çš„åŒºåˆ«ã€‚ç‚¹å‡»[è¿™é‡Œ](https://www.fast.ai/2018/08/10/fastai-diu-imagenet/)é˜…è¯»æ›´å¤šç›¸å…³å†…å®¹ã€‚

Applying different transforms to improve model, increased image sizes to 256

æˆ‘ä»¬åˆæ‰¾åˆ°äº†ä¸€ä¸ªæœ€ä¼˜å­¦ä¹ ç‡ã€‚

Find an ideal learning rate

![](img/3f091fa3e5ab60186ffde7e8109880cc.png)

Find an ideal learning rate

ä½¿ç”¨ 5 ä¸ªæ—¶æœŸçš„å­¦ä¹ ç‡`1e-4`æ‹Ÿåˆæ¨¡å‹ã€‚

Train model for 5 cycles, the learning rate is set to 1e-4

![](img/6b8b57733e6e1ae680aeb1c393b83c93.png)

Training and validation losses

è§‚å¯ŸåŸ¹è®­æŒ‡æ ‡ï¼Œå¹¶ä¸è¿‡å»çš„æŒ‡æ ‡è¿›è¡Œæ¯”è¾ƒã€‚æˆ‘ä»¬çš„æ¨¡å‹åšäº†ä¸€ç‚¹æ”¹è¿›ï¼Œä»`0.0169`åˆ°`0.0168`ã€‚

![](img/fa80b83cf398e4103d8e501f3efcb519.png)

The output of training our model; the best model is at epoch 2

ä¿å­˜æ¨¡å‹è®­ç»ƒçš„æœ€åé˜¶æ®µå¹¶æ‰“å°å‡ºæŒ‡æ ‡ã€‚

```
learn.save('resnet50-stg4')
```

Accuracy, error rate and AUC score

æ­£å¦‚ä½ æ‰€æ³¨æ„åˆ°çš„ï¼Œæ¨¡å‹çš„ç²¾åº¦ç°åœ¨æ˜¯`99.44%`ï¼Œè¿™æ¯”ä¸Šæ¬¡è®­ç»ƒé˜¶æ®µ`99.38%`æœ‰æ‰€æé«˜ã€‚

![](img/10cb7d8aef6c0615a04a1fc4f8474326.png)

The metrics for the fourth stage of training

# å‡†å¤‡ç«èµ›æäº¤æ–‡ä»¶

ç°åœ¨æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„æ¨¡å‹å¯¹å°šæœªçœ‹åˆ°çš„æ•°æ®çš„é¢„æµ‹æœ‰å¤šå¥½ã€‚

Prepare a CSV submission file

# å‘ WiDS Datathon æäº¤ä¸€ä»½ææ–™

æ‚¨ä»ç„¶å¯ä»¥å‚åŠ  WiDS ç«èµ›ï¼Œå¹¶æäº¤ä¸€ä»½è¿Ÿäº¤çš„ææ–™ã€‚ä¸ºæ­¤ï¼Œè¯·ç‚¹å‡»è¿›å…¥ç«èµ›é¡µé¢[ï¼Œç‚¹å‡»**åŠ å…¥ç«èµ›**å¹¶æ¥å—ç«èµ›è§„åˆ™ã€‚ç°åœ¨ä½ å¯ä»¥æäº¤ä¸€ä»½ç”³è¯·ï¼Œçœ‹çœ‹å¦‚æœä½ å‚åŠ çš„è¯ï¼Œä½ çš„æ’åä¼šæ˜¯å¤šå°‘ã€‚](https://www.kaggle.com/c/widsdatathon2019)

![](img/07c1ccb15cf5884080ce31c40336e2b1.png)

Private and Public Scores for the submission I made from our modelâ€™s predictions.

å£°æ˜:æ–‡ç« ä¸­çš„è¯´æ˜ä¸ä¼šåƒæˆ‘ä»¬ä¸€æ ·æŠŠä½ æ”¾åœ¨ç¬¬ä¸‰ä½ï¼Œæˆ‘æƒ³å°½å¯èƒ½ä¿æŒç®€å•ã€‚è¦å¼„æ¸…æ¥šè¿™ä¸€ç‚¹ï¼Œè¯·æŸ¥çœ‹ [Abdishakur](https://medium.com/u/d4284ce02aec?source=post_page-----644adcc143c8--------------------------------) å…³äºå®ƒçš„å¸–å­[è¿™é‡Œ](https://www.kaggle.com/c/widsdatathon2019/discussion/82252)ã€‚

å¥½å¥‡æƒ³äº†è§£æ›´å¤šï¼Ÿçœ‹çœ‹è¿™ä¸ªç”±æ°ç‘ç±³Â·éœåå¾·å’Œ fast.ai å›¢é˜Ÿç­–åˆ’çš„æƒŠäººçš„ 7 éƒ¨åˆ†ç³»åˆ—è®²åº§ã€‚