<html>
<head>
<title>I Bought a New Computer Just To Try Out CUDA, Was it Worth it?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我买了一台新电脑只是为了试用 CUDA，值得吗？</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/i-bought-a-new-computer-just-to-try-out-cuda-was-it-worth-it-958216e755b1?source=collection_archive---------19-----------------------#2019-11-13">https://towardsdatascience.com/i-bought-a-new-computer-just-to-try-out-cuda-was-it-worth-it-958216e755b1?source=collection_archive---------19-----------------------#2019-11-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/5842262dd9b0ab6466002a4cad05b83d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Vz-3Dbzns6uiB0FnQMugAw.jpeg"/></div></div></figure><p id="9304" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi kz translated">我一直对统计计算中图形处理的潜力很感兴趣。我最近一直在使用许多 OpenCL 包，而不是基于 CPU 的股票包，因为我的显卡是由 AMD 制造的，openCL 是他们对希望利用 GPU 的数学能力而不仅仅是图形的程序员做出的唯一足够的贡献。</p><p id="4f64" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">当然，我最感兴趣的是 CUDA，这是一个 Nvidia 专有的并行计算平台。然而，我拥有的最后一个 Nvidia GPU 是 8800GT，我周围所有的卡都是 team red 的，大多数都是旧卡(我是一个硬件迷。)</p><p id="f478" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">因此，在过去的几周里，我不是在搜索，而是在 Letgo、脸书和 Craigslist 上查看了几次我感兴趣的硬件，只有一个要求:</p><blockquote class="li"><p id="a2cf" class="lj lk it bd ll lm ln lo lp lq lr ky dk translated">它需要一个 Nvidia 显卡。</p></blockquote><p id="661a" class="pw-post-body-paragraph kb kc it kd b ke ls kg kh ki lt kk kl km lu ko kp kq lv ks kt ku lw kw kx ky im bi translated">在我搜索的最后一刻，我偶然发现了一个令人震惊的发现。</p><figure class="ly lz ma mb gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi lx"><img src="../Images/e4325d4d4eb0cab2c812469b03b33d07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-w3hhbpGEN1OM3XDL5T3hw.png"/></div></div></figure><p id="7e7c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这台电脑在 Letgo 上的售价只有区区 140 美元，但还是有一些问题。显然，我想知道处理器，但我可以告诉插座是 AM3+,这是一个好消息，无论处理器是什么，都值得用安装在机箱前面的 240 毫米大散热器来冷却。</p><p id="a1db" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">此外，显卡是蓝宝石和蓝色 PCB，蓝色 PCB 很重要，因为蓝宝石不再使用它们，至少据我所知，它们通常与镭龙 HD 系列相关。显然，镭龙高清是没有骰子的 CUDA，是你能从 Nvidia 卡最远。</p><p id="8b96" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然而，不管怎样，这笔交易肯定是诱人的，因为这是一个 140 美元的相当不错的系统！我交叉手指，希望主板会配备 AMD FX 八核处理器或类似的东西(piledriver，而不是推土机。)结果是 AMD FX 830e 八核处理器的主频达到了 3.5 GHz。</p><p id="0b77" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">但还是；显卡。我给卖电脑的人发信息问了几个问题，让他启动 bios 帮我检查一些规格。该系统添加了高达 8gb 的双通道内存、750w 模块化电源、240mm 散热器/AIO、128 GB SSD(不确定读写速度)、一些 Aura 主板和这张 Saphire 卡。</p><p id="4638" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">但为了让交易更甜蜜，他透露，除了他卖给我的规格，另加 20 美元，他会卖给我一个 GTX 1060 ROG strix 图形卡！</p><p id="5642" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">把它带回家后，我把它组装在一起，换了一个装有操作系统的固态硬盘(砰！Os)，引导到 EFI 和一切工作完美。我添加了一些升级，一个 570 Evo SSD，8g 额外的内存和一个 R9 290 来驱动任何额外的显示器，结果看起来有点像这样:</p><figure class="ly lz ma mb gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mc"><img src="../Images/2b2581e25a70759c25ab311b069d8a7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GBWM0nqy687W7eJHbSYV8w.jpeg"/></div></div></figure><blockquote class="li"><p id="52a8" class="lj lk it bd ll lm md me mf mg mh ky dk translated">太美了。</p></blockquote><p id="5ebf" class="pw-post-body-paragraph kb kc it kd b ke ls kg kh ki lt kk kl km lu ko kp kq lv ks kt ku lw kw kx ky im bi translated">现在我们有了硬件，我们需要为软件做同样的事情！</p></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h1 id="e67b" class="mp mq it bd mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm bi translated">让 CUDA 工作起来</h1><p id="68a3" class="pw-post-body-paragraph kb kc it kd b ke nn kg kh ki no kk kl km np ko kp kq nq ks kt ku nr kw kx ky im bi translated">CUDA 的设置实际上是相当广泛的，因为它不像设置你的驱动那么简单。首先，您必须进入您的终端并安装依赖项:</p><pre class="ly lz ma mb gt ns nt nu nv aw nw bi"><span id="c985" class="nx mq it nt b gy ny nz l oa ob">sudo apt-get install freeglut3 freeglut3-dev libxi-dev libxmu-dev</span></pre><p id="2e04" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后你必须去<a class="ae oc" href="https://developer.nvidia.com/cuda-zone" rel="noopener ugc nofollow" target="_blank">“Cuda 专区”</a>给自己找一些二进制文件…或者如果你在 Debian 上，你可以得到回购:</p><pre class="ly lz ma mb gt ns nt nu nv aw nw bi"><span id="8aef" class="nx mq it nt b gy ny nz l oa ob">wget http://developer.download.nvidia.com/compute/cuda/10.1/Prod/local_installers/cuda_10.1.243_418.87.00_linux.run</span></pre><p id="b68b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后我们从 repo 中运行 sh 文件(作为 root 用户):</p><pre class="ly lz ma mb gt ns nt nu nv aw nw bi"><span id="2545" class="nx mq it nt b gy ny nz l oa ob">sudo sh ./cuda_10.1.243_418.87.00_linux.run</span></pre><p id="9dbe" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">还有一种方法可以在 DPKG 上安装 CUDA 环境，但我选择了 SH 版本，因为这通常是我对 Nvidia 等可靠来源的首选途径。当你通过 SH 安装时，你会被问一些问题，我添加了#注释来解释我的回答，这样你就可以决定你是否认为说是合适的。</p><pre class="ly lz ma mb gt ns nt nu nv aw nw bi"><span id="12cf" class="nx mq it nt b gy ny nz l oa ob">You are attempting to install on an unsupported configuration. Do you wish to continue?<br/>(y)es/(n)o [ default is no ]: y</span><span id="aea5" class="nx mq it nt b gy od nz l oa ob"># Obviously, we have to do this to proceed with the CUDA installation.</span><span id="2d3b" class="nx mq it nt b gy od nz l oa ob"><br/>Install NVIDIA Accelerated Graphics Driver for Linux-x86_64 396.26?<br/>(y)es/(n)o/(q)uit: n</span><span id="34eb" class="nx mq it nt b gy od nz l oa ob"># I said no to this, as I use the POP! OS Nvida Driver</span><span id="2743" class="nx mq it nt b gy od nz l oa ob">Install the CUDA 9.2 Toolkit?<br/>(y)es/(n)o/(q)uit: y</span><span id="56f0" class="nx mq it nt b gy od nz l oa ob"># Of course, the whole reason we're here is for the toolkit</span><span id="0a00" class="nx mq it nt b gy od nz l oa ob">Enter Toolkit Location<br/> [ default is /usr/local/cuda-9.2 ]:</span><span id="e3ec" class="nx mq it nt b gy od nz l oa ob"># That location suited me fine.</span><span id="9021" class="nx mq it nt b gy od nz l oa ob">Do you want to install a symbolic link at /usr/local/cuda?<br/>(y)es/(n)o/(q)uit: y</span><span id="5a96" class="nx mq it nt b gy od nz l oa ob"># There's no reason not to, so it's global and usable with everything.</span><span id="d584" class="nx mq it nt b gy od nz l oa ob">Install the CUDA 9.2 Samples?<br/>(y)es/(n)o/(q)uit: y</span><span id="2d54" class="nx mq it nt b gy od nz l oa ob"># I figured why not so I can see the usage in Python, and C as I do a lot of writing there, as well.</span><span id="daf4" class="nx mq it nt b gy od nz l oa ob">Enter CUDA Samples Location<br/> [ default is /home/kinghorn ]: /usr/local/cuda-9.2</span></pre><p id="8c83" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">安装 cuBLAS 修补程序:</p><pre class="ly lz ma mb gt ns nt nu nv aw nw bi"><span id="ad70" class="nx mq it nt b gy ny nz l oa ob">sudo sh cuda_9.2.88.1_linux.run</span></pre><p id="0e66" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">最后但同样重要的是，我们必须将回显路径添加到我们的系统中，我们首先在以下位置创建一个 sh 文件:</p><p id="f6bd" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><code class="fe oe of og nt b">/etc/profile.d/cuda.sh</code></p><p id="3be6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">并将以下内容放入其中:</p><pre class="ly lz ma mb gt ns nt nu nv aw nw bi"><span id="9053" class="nx mq it nt b gy ny nz l oa ob">export PATH=$PATH:/usr/local/cuda/bin<br/>export CUDADIR=/usr/local/cuda</span></pre><p id="ca1a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">另一个 sh 文件位于:</p><pre class="ly lz ma mb gt ns nt nu nv aw nw bi"><span id="f15e" class="nx mq it nt b gy ny nz l oa ob">/etc/ld.so.conf.d/cuda.conf</span></pre><p id="9cb1" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">包含:</p><pre class="ly lz ma mb gt ns nt nu nv aw nw bi"><span id="bc7d" class="nx mq it nt b gy ny nz l oa ob">/usr/local/cuda/lib64</span></pre><p id="66f3" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">当然，我们必须以超级用户的身份编辑它们。然后我们终于可以跑了</p><pre class="ly lz ma mb gt ns nt nu nv aw nw bi"><span id="d42a" class="nx mq it nt b gy ny nz l oa ob">sudo ldconfig</span></pre><p id="0693" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在我们有了 CUDA 设置！我越来越兴奋了！现在让我们进入 Julia 并设置我们的软件包！这应该很容易，但在这里我们将发现如果流行！驱动程序将会兼容。我们需要以下包:</p><pre class="ly lz ma mb gt ns nt nu nv aw nw bi"><span id="b526" class="nx mq it nt b gy ny nz l oa ob">CuArrays<br/>CUDAnative<br/>CUDAdrv</span></pre><p id="8ca0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">为了确保一切正常，我将推进这些路径，然后构建每个包:</p><pre class="ly lz ma mb gt ns nt nu nv aw nw bi"><span id="0268" class="nx mq it nt b gy ny nz l oa ob">ENV["LD_LIBRARY_PATH"] = "/usr/lib/cuda/lib64" <br/>ENV["CUDA_PATH"] = "/usr/lib/cuda" <br/><strong class="nt iu">using</strong> Pkg; Pkg.build("CuArrays")<br/>Pkg.build("CUDAnative")<br/>Pkg.build("CUDAdrv")</span></pre><p id="7268" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在只需启动 Jupyter 并进行测试！</p><pre class="ly lz ma mb gt ns nt nu nv aw nw bi"><span id="5916" class="nx mq it nt b gy ny nz l oa ob">ERROR: LoadError: Available CUDA toolchain does not provide libcudadevrt</span></pre><p id="d9a2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">小崽子，真不幸。看起来我们可能要安装 Nvidia 的驱动程序，我真的希望 POP 的驱动程序可能是驱动程序上的一个分叉工作，但似乎不是这样，或者如果是，它有点太修改了。</p><h1 id="9e87" class="mp mq it bd mr ms oh mu mv mw oi my mz na oj nc nd ne ok ng nh ni ol nk nl nm bi translated">终于开始工作了</h1><p id="075d" class="pw-post-body-paragraph kb kc it kd b ke nn kg kh ki no kk kl km np ko kp kq nq ks kt ku nr kw kx ky im bi translated">在 CUDA 控制面板中做了一些调整，并在我的部分做了一些 bashrc 编辑之后，我的 CUDA 驱动终于可以工作了。那么，在我的 CPU 上，Julia 和修改过的线性回归函数之间的时间比较如何呢？我着手做美国数据科学家最擅长的事情，进行了 20 次测试，得到了两个特征的平均值:</p><blockquote class="li"><p id="cb61" class="lj lk it bd ll lm ln lo lp lq lr ky dk translated">CPU:</p></blockquote><pre class="om on oo op oq ns nt nu nv aw nw bi"><span id="e6f8" class="nx mq it nt b gy ny nz l oa ob">0.2208722 seconds</span></pre><blockquote class="li"><p id="0685" class="lj lk it bd ll lm md me mf mg mh ky dk translated">CUDA:</p></blockquote><pre class="om on oo op oq ns nt nu nv aw nw bi"><span id="8117" class="nx mq it nt b gy ny nz l oa ob">0.052839374 seconds</span></pre><blockquote class="or os ot"><p id="51f4" class="kb kc ou kd b ke kf kg kh ki kj kk kl ov kn ko kp ow kr ks kt ox kv kw kx ky im bi translated">哇！</p></blockquote><p id="e843" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">有了这样的收获，我决定单独使用 OpenCL 进行第三次独立测试，结果令人震惊:</p><pre class="ly lz ma mb gt ns nt nu nv aw nw bi"><span id="1603" class="nx mq it nt b gy ny nz l oa ob">0.10083948593 seconds</span></pre></div><div class="ab cl mi mj hx mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="im in io ip iq"><h1 id="fd25" class="mp mq it bd mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm bi translated">结论</h1><p id="d7af" class="pw-post-body-paragraph kb kc it kd b ke nn kg kh ki no kk kl km np ko kp kq nq ks kt ku nr kw kx ky im bi translated">使用 CUDA 时，深度学习和简单预测建模的性能明显提高。将来，我也想使用一张有张量核的卡片，因为它的速度肯定是无可挑剔的。不管怎样，我对这一切的结果很满意！那么为了使用 CUDA 而购买一台全新的机器值得吗？</p><blockquote class="li"><p id="99e7" class="lj lk it bd ll lm ln lo lp lq lr ky dk translated">不值得。</p></blockquote></div></div>    
</body>
</html>