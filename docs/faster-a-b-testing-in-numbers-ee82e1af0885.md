# æ›´å¿«çš„ A/B æµ‹è¯•ðŸš€â€”ç”¨æ•°å­—è¡¨ç¤º

> åŽŸæ–‡ï¼š<https://towardsdatascience.com/faster-a-b-testing-in-numbers-ee82e1af0885?source=collection_archive---------47----------------------->

## é™¤äº†ä¼ ç»Ÿå‡è®¾æ£€éªŒ(ä¹Ÿç§°ä¸º frequentist)æ–¹æ³•ä¹‹å¤–çš„å…¶ä»–æ–¹æ³•æ­£å˜å¾—è¶Šæ¥è¶Šæ™®éâ€”â€”æˆ‘å‘çŽ°è´å¶æ–¯æ–¹æ³•æ˜¯ä¸€ä¸ªæœ‰æ„ä¹‰çš„æ”¹è¿›ã€‚

![](img/b8f8292703f0ca7b698b8a403f808b25.png)

# ä¼ ç»Ÿçš„æ–¹æ³•ðŸŽ“

å…¸åž‹çš„ A/B æµ‹è¯•æ„å‘³ç€å‡è®¾æµ‹è¯•â€”â€”è¿™æ„å‘³ç€æˆ‘ä»¬æƒ³è¦â€œè¯æ˜Ž A & B æ˜¯æ˜¾è‘—ä¸åŒçš„â€ã€‚æˆ‘ä»¬å¯ä»¥å°†æˆ‘ä»¬çš„æµ‹è¯•ç»“æžœæ’å…¥åˆ°çŽ°æœ‰çš„ A/B æµ‹è¯•è¯„ä¼°å™¨ä¸­ï¼Œä¾‹å¦‚æ¥è‡ª Evan Miller çš„[è¯„ä¼°å™¨ï¼Œå¹¶å¾—åˆ°ç»“æžœã€‚](https://www.evanmiller.org/ab-testing/chi-squared.html)

åœ¨å¤§å¤šæ•°è¿™äº›å·¥å…·ä¸­ï¼Œéƒ¨åˆ†ç»“æžœæ˜¯â€œpâ€å€¼ã€‚é€šå¸¸ï¼Œå¦‚æžœå°äºŽ 5%ï¼Œç»“æžœè¢«è®¤ä¸ºæ˜¯æ˜¾è‘—çš„ã€‚æœ‰è¶£çš„æ˜¯ï¼Œè®¸å¤šäººä¸çŸ¥é“â€œpâ€å€¼çš„å®žé™…å«ä¹‰ï¼Œå¹¶ä¸”ç»å¸¸è¢«è¯¯è§£ã€‚è¿™æ˜¯é—®é¢˜çš„ä¸€éƒ¨åˆ†ï¼Œå› ä¸ºå¦‚æžœä½ ä¸èƒ½è§£è¯»æµ‹è¯•ç»“æžœï¼Œå°±å¾ˆéš¾å¾—å‡ºåˆç†çš„ç»“è®ºã€‚

*â€œpâ€å€¼ä»£è¡¨ A å’Œ B æ¥è‡ªåŒä¸€åˆ†å¸ƒçš„å¯èƒ½æ€§*

# ä¸ºä»€ä¹ˆè¦æ”¹å˜ï¼ŸðŸ˜±

åœ¨æˆ‘çœ‹æ¥ï¼Œå¸¸è§„æ–¹æ³•æœ‰ä¸¤ä¸ªé‡å¤§é—®é¢˜:

1.  ç”±äºŽç†è§£â€œpâ€å€¼å¾ˆéš¾ï¼Œäººä»¬ç»å¸¸å¾—å‡ºé”™è¯¯çš„ç»“è®º
2.  ä¼ ç»Ÿçš„æ–¹æ³•éœ€è¦éžå¸¸å¤§çš„æ ·æœ¬é‡:ç”¨å…¸åž‹çš„å‚æ•°æ¥æ˜¾ç¤º 1%æˆåŠŸçŽ‡çš„è½¬æ¢æ¼æ–—ä¸Š 10%çš„æå‡ï¼Œä½ å¿…é¡»è®© 320 000 ä¸ªç”¨æˆ·çœ‹åˆ°ä½ çš„æµ‹è¯•ï¼

# è´æ°æ•‘æ´é˜Ÿã€‚â›‘

ä¸ºäº†è¯„ä¼°å…¶ä»–å·¥å…·ï¼Œæˆ‘æž„å»ºäº†ä¸€ä¸ªæ¨¡æ‹ŸçŽ¯å¢ƒæ¥æµ‹è¯•å„ç§æ¡†æž¶åŠå…¶å‚æ•°ã€‚ä¸‹é¢æˆ‘å°†åˆ†äº«æˆ‘çš„é«˜çº§å‘çŽ°ï¼Œå¹¶æŽ¨èä¸€äº›ä½ å¯ä»¥ä½¿ç”¨çš„å‚æ•°ï¼Œæˆ‘å‘çŽ°è¿™äº›å‚æ•°éžå¸¸å¥å£®ã€‚

**åœºæ™¯:**å‡è®¾ä½ è®¡åˆ’åœ¨æŽ¥ä¸‹æ¥çš„å‡ å‘¨å†…ä¸€ä¸ªæŽ¥ä¸€ä¸ªåœ°è¿è¡Œ 10 ä¸ª A/B æµ‹è¯•ï¼Œå¦‚æžœä¸€ä¸ªæµ‹è¯•è¢«æŽ¥å—ï¼Œä½ å°†ä¸ºæ‰€æœ‰æœªæ¥çš„ç”¨æˆ·æŽ¨å‡ºè¿™ä¸ªç‰¹æ€§ã€‚ä¸æ˜¯æ‰€æœ‰çš„ A/B æµ‹è¯•éƒ½æ˜¯è‚¯å®šçš„ï¼Œæœ‰æ—¶ä½ ä¸çŸ¥é“ç”¨æˆ·åœ¨å¯»æ‰¾ä»€ä¹ˆâ€”â€”æˆ‘å‡è®¾ä½ æµ‹è¯•çš„æ˜¯æ›´å¥½æˆ–æ›´å·®çš„ç‰ˆæœ¬ã€‚

åœ¨æ¯ä¸ªæ¨¡æ‹Ÿä¸­ï¼Œæˆ‘ç»¼åˆäº†æ¯ä¸ªæµ‹è¯•çš„æ”¹è¿›â€”â€”å› æ­¤ï¼Œå¦‚æžœ 10 ä¸ªæµ‹è¯•ä¸­æœ‰ 3 ä¸ªæµ‹è¯•èŽ·å¾—äº†+3%ã€+7%ã€+2%çš„æ”¹è¿›ï¼Œæˆ‘ä¼šè®¡ç®—:

```
(1.03 * 1.07 * 1.02)-1 = 0.124.. = 12.4%
```

æˆ‘é‡å¤äº† 1000 æ¬¡ä»¥ä¸Šçš„æ¨¡æ‹Ÿï¼Œç„¶åŽå¹³å‡å‡ºå¤åˆç»“æžœ:

![](img/0ad3ddad4a1120e2c0289e41046dca57.png)

æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œæ‰€æœ‰çš„æ¡†æž¶éƒ½æŽ¥å—ç§¯æžçš„æµ‹è¯•ï¼Œå¹¶å…è®¸ä½ å‘æ‰€æœ‰ç”¨æˆ·æŽ¨å‡ºæ”¹è¿›ã€‚ä½†æ˜¯ä½ ä¹Ÿå¯ä»¥çœ‹åˆ°, **Bayes(å®Œæ•´æŒç»­æ—¶é—´)**ç‰ˆæœ¬äº§ç”Ÿäº†æœ€å¤§çš„æå‡(ç»™å®šç›¸åŒçš„ç²¾ç¡® A/B æµ‹è¯•ç»“æžœ)ã€‚è¿™æ€Žä¹ˆå¯èƒ½å‘¢ï¼Ÿ**è´å¶æ–¯**ä¼Šæ©æ–¹æ³•æŽ¥å—å°ç»“æžœçš„è´Ÿæ‹…ä¹Ÿè¾ƒä½Žâ€”â€”å› ä¸ºæ¥è‡ªå¤šä¸ªæµ‹è¯•çš„å°ç»“æžœå¯ä»¥åˆæˆå¤§ç»“æžœï¼Œæ‰€ä»¥**è´å¶æ–¯**ä¼Šæ©æ–¹æ³•èƒœå‡ºã€‚æ‚¨è¿˜å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æžœæ‚¨è¿è¡Œ A/B æµ‹è¯•çš„æ—¶é—´è¾ƒçŸ­ï¼Œé‚£ä¹ˆæ¡†æž¶å°†æ— æ³•åšå‡ºå¦‚åŒæ‹¥æœ‰æ‰€æœ‰æ•°æ®ä¸€æ ·å¥½çš„å†³ç­–ã€‚

ä½†æ˜¯è´å¶æ–¯æ–¹æ³•æœ‰ä»€ä¹ˆç¼ºç‚¹å—ï¼Ÿä¸å¹¸çš„æ˜¯ï¼Œè¿™ä¸€ç‚¹ç»å¸¸è¢«å¿½ç•¥ï¼Œä½†æ˜¯è¦å›žç­”è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬ä¸åº”è¯¥çœ‹å¹³å‡æ¨¡æ‹Ÿç»“æžœï¼Œè€Œåº”è¯¥çœ‹å¤åˆç»“æžœçš„åˆ†å¸ƒã€‚

![](img/370fa79fc647dfb0a88eb34fd0c45aa6.png)

ç™¾åˆ†ä½æ•°æ˜¾ç¤ºï¼Œåœ¨ä¸€å°éƒ¨åˆ†æ¨¡æ‹Ÿä¸­(~1%)æµ‹è¯•æ¡†æž¶çš„é”™è¯¯å†³ç­–ä¼šå¯¼è‡´æ•´ä½“æ€§èƒ½ä¸‹é™ã€‚è™½ç„¶åœ¨æˆ‘ä»¬çš„æ¨¡æ‹Ÿä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™ä¸€äº‹å®žï¼Œä½†åœ¨çŽ°å®žä¸–ç•Œä¸­ï¼Œæ‚¨ä¸ä¼šæ³¨æ„åˆ°æ‚¨æ­£åœ¨æŸå®³æ‚¨çš„ä¸šåŠ¡ï¼ç›¸æ¯”ä¹‹ä¸‹ï¼Œä½ å¯ä»¥çœ‹åˆ°éžå¸¸ä¿å®ˆçš„ä¼ ç»Ÿ(Frequentist)æ–¹æ³•æ²¡æœ‰è¿™ä¸ªé—®é¢˜ã€‚

# å¥½å§ï¼Œé‚£ä¹ˆå“ªä¸ªæ›´å¥½å‘¢ï¼ŸðŸ¤”

æ€»çš„æ¥è¯´ï¼Œæˆ‘æ›´å–œæ¬¢è´å¶æ–¯ä¼Šæ©æ–¹æ³•â€”â€”åªè¦ä½ ä¸æ˜¯è¶…çº§å€’éœ‰ï¼Œä½ å°±å¯ä»¥æœŸå¾…ç”¨è¿™ç§æ–¹æ³•å¾—åˆ°æ›´å¥½çš„ç»“æžœï¼Œä½†åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ ä¹Ÿä¸ä¼šæ¯”ä¼ ç»Ÿæ–¹æ³•å¤±åŽ»å¤ªå¤šã€‚

æ‚¨è¿˜å¿…é¡»è€ƒè™‘æ—¶é—´æ–¹é¢â€”â€”ä¸ºæ‚¨çš„å†³ç­–æ¡†æž¶æä¾›æ›´å°‘çš„æ—¶é—´(å’Œæ•°æ®)å°†ä¼šå¯¼è‡´æ›´ç³Ÿç³•çš„å†³ç­–â€¦â€¦

é™¤äº†:å¦‚æžœæ›´çŸ­çš„æµ‹è¯•æŒç»­æ—¶é—´å¯ä»¥è®©ä½ è¿è¡Œæ›´å¤šçš„æµ‹è¯•ï¼Œè¿™æ˜¯ä¸€ä¸ªå€¼å¾—çš„æƒè¡¡ã€‚

æ¯”æ–¹è¯´ï¼Œå¦‚æžœä½ åœ¨ä¸‰åˆ†ä¹‹ä¸€çš„æ—¶é—´å†…è¿è¡Œä½ çš„æµ‹è¯•ï¼Œå®ƒå…è®¸ä½ åœ¨ç›¸åŒçš„æ—¶é—´å†…è¿è¡Œä¸¤å€çš„æµ‹è¯•ã€‚è¿™å¯¹ç»“æžœæœ‰ä»€ä¹ˆå½±å“ï¼Ÿ

![](img/5e00cd5888aebbe05a628cc2639ede1e.png)

æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œåœ¨ Frequentist æ–¹æ³•ä¸­ç”¨æ›´çŸ­çš„æµ‹è¯•æŒç»­æ—¶é—´è¿è¡Œæ›´å¤šçš„æµ‹è¯•å¹¶æ²¡æœ‰å¤ªå¤§çš„å¸®åŠ©ï¼Œä½†æ˜¯åœ¨ **Bayes** ian çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å‡å°‘äº†å¯èƒ½çš„è´Ÿé¢å½±å“å¹¶æ˜¾è‘—æé«˜äº†æ­£é¢å½±å“ã€‚

# è®©æˆ‘ä»¬åœ¨ 0 æ—¶é—´å†…è¿è¡Œæ— é™é‡çš„æµ‹è¯•ðŸ¦

æˆ‘çš„æ¨¡æ‹Ÿæ˜¾ç¤ºï¼Œåœ¨ **Bayes** ian æ¡†æž¶ä¸­ï¼Œåªè¦è¿è¡ŒåŒç­‰æ•°é‡çš„æµ‹è¯•ï¼Œå°±æœ‰å¯èƒ½å°†æµ‹è¯•æ—¶é—´è¶Šæ¥è¶ŠçŸ­(ä¾‹å¦‚ï¼Œå°†æ—¶é—´å‡å°‘ 10 å€ï¼Œè¿è¡Œ 10 å€çš„æµ‹è¯•)ã€‚å®žé™…ä¸Šï¼Œè¿™æœ‰å‡ ä¸ªé—®é¢˜:

1.  å¦‚æžœæ‚¨æ­£åœ¨è¿è¡Œçš„æµ‹è¯•çš„è´¨é‡å› ä¸ºé¢‘çŽ‡çš„å¢žåŠ è€Œä¸‹é™â€”â€”æ‰€æœ‰çš„èµŒæ³¨éƒ½å°†è¢«å–æ¶ˆ
2.  é€šå¸¸ä½ ä¸èƒ½è¿è¡Œå°½å¯èƒ½å¤šçš„æµ‹è¯•ï¼Œå› ä¸ºæœ‰äººéœ€è¦æž„å»ºå®ƒä»¬â€”â€”åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸ºæµ‹è¯•åˆ†é…å°½å¯èƒ½å¤šçš„æ—¶é—´ä»¥åšå‡ºæœ€å¥½çš„å†³ç­–æ˜¯æœ‰æ„ä¹‰çš„
3.  ä¸€èˆ¬æ¥è¯´ï¼Œä½ åº”è¯¥è¿è¡Œä½ çš„æµ‹è¯•è‡³å°‘ä¸€ä¸ªæ˜ŸæœŸâ€”â€”ç”¨æˆ·åœ¨å‘¨æœ«çš„è¡Œä¸ºå¯èƒ½ä¸Žå·¥ä½œæ—¥æœ‰å¾ˆå¤§çš„ä¸åŒï¼Œä½ çš„æµ‹è¯•åº”è¯¥èƒ½å¤Ÿè€ƒè™‘è¿™äº›æƒ…å†µï¼

# è®©æˆ‘ä»¬ç”¨è´å¶æ–¯åˆ†æžä¸€äº›æµ‹è¯•ðŸ³

æˆ‘å»ºè®®ä½ ä½¿ç”¨ä»¥ä¸‹å‚æ•°æ¥ä¿æŠ¤ä½ çš„ç¼ºç‚¹:

1.  èŽ·èƒœçš„å¯èƒ½æ€§åº”è¯¥å¤§äºŽ 66%
2.  åˆ©æ¶¦åº”å¤§äºŽ 1%

æˆ‘å°†åœ¨ä¸‹é¢æä¾› python ä»£ç ï¼Œä½†æ˜¯æ‚¨ä¹Ÿå¯ä»¥åœ¨å¤§å¤šæ•°å…¶ä»–ç¼–ç¨‹è¯­è¨€ä¸­è¿™æ ·åšï¼è¯¥ä»£ç åªæ˜¯è¿‘ä¼¼çš„ï¼Œè¿è¡Œé€Ÿåº¦ç›¸å½“å¿«ã€‚

```
*# to install dependencies: pip install numpy scipy* **import** numpy **as** _numpy
**from** scipy.stats.distributions **import** beta **as** _beta **def** get_likelihood_of_win(test_result, margin=0.01):
    success = 0
    total = 0 ref_pos = test_result[**'A'**][**'success_cnt'**]
    ref_neg = test_result[**'A'**][**'fail_cnt'**]
    test_pos = test_result[**'B'**][**'success_cnt'**]
    test_neg = test_result[**'B'**][**'fail_cnt'**] conv_rate_base = max(
        (ref_pos/ ref_pos + ref_neg),
        (test_pos/ test_pos + test_neg)
    ) **for** x **in** _numpy.linspace(0, min(conv_rate_base * 2, 1), 100):
        prob = _beta.pdf(x=x, a=ref_pos, b=ref_neg)
        prob_test_wins = 1 - _beta.cdf(
            x=x * (1 + margin), 
            a=test_pos, b=test_neg
        )
        success += prob_test_wins * prob
        total += prob **return** success / total **if** __name__ == **'__main__'**:
    test_result = {
        **'A'**: {
            **'success_cnt'**: 10,
            **'fail_cnt'**: 100,
        },
        **'B'**: {
            **'success_cnt'**: 18,
            **'fail_cnt'**: 100,
        }
    }
    likelihood_of_win = get_likelihood_of_win(
        test_result=test_result, margin=0.01
    )
    accepted = likelihood_of_win > 0.66
    print(accepted, round(likelihood_of_win, 2))
```