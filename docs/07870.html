<html>
<head>
<title>Choosing a Halloween Costume Using the Google Trends API in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Python 中的 Google Trends API 选择万圣节服装</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/choosing-a-halloween-costume-using-the-google-trends-api-in-python-a3206b78a2a2?source=collection_archive---------30-----------------------#2019-10-30">https://towardsdatascience.com/choosing-a-halloween-costume-using-the-google-trends-api-in-python-a3206b78a2a2?source=collection_archive---------30-----------------------#2019-10-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/51f25c5a8861a55149d96a71ad6763fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_CKDJlAzvYYuTSE7e-DEfQ.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">Photo by <a class="ae kf" href="https://www.pexels.com/@pixabay" rel="noopener ugc nofollow" target="_blank">Pixabay</a> on <a class="ae kf" href="https://www.pexels.com/photo/light-landscape-sky-sunset-35888/" rel="noopener ugc nofollow" target="_blank">Pexels</a></figcaption></figure><p id="6bd0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在本帖中，我们将使用开源 python 库 pytrends 来看看今年哪些万圣节服装最受欢迎。</p><p id="cd87" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要开始，请打开命令行并键入:</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="0a5c" class="ln lo it lj b gy lp lq l lr ls">pip install pytrends</span></pre><p id="7afc" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来从 pytrends 导入趋势请求模块:</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="5e5b" class="ln lo it lj b gy lp lq l lr ls">from pytrends.request import TrendReq</span></pre><p id="45ae" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来，我们定义一个 pytrends 实例并构建 pytrends 有效负载，其中我们指定了想要搜索的关键字、时间段和地区。让我们从 2019 年 10 月 1 日到 2019 年 10 月 30 日在纽约用“小丑”建立一个谷歌搜索的有效载荷:</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="941f" class="ln lo it lj b gy lp lq l lr ls">pytrends = TrendReq(hl='en-US', tz=360)<br/>pytrends.build_payload(['Joker'], cat=0, timeframe='2019–10–01 2019–10-30',  gprop='',geo='US-NY')</span></pre><p id="467f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以获取一个数据框架，它给出了一段时间内与我们的关键词相关的搜索次数:</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="f1a9" class="ln lo it lj b gy lp lq l lr ls">df = pytrends.interest_over_time()</span></pre><p id="ad47" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以打印数据帧的前 10 行:</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="9ea3" class="ln lo it lj b gy lp lq l lr ls">print(df.head(10))</span></pre><figure class="le lf lg lh gt ju gh gi paragraph-image"><div class="gh gi lt"><img src="../Images/6c395aeeb5319fc80b6d359f9ec736a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:436/format:webp/1*YQKKt68nE-ZF1XK0ooUchw.png"/></div></figure><p id="8009" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们也可以画出整个时间序列。首先，我们需要将日期列中的日期转换为日期时间值:</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="cf20" class="ln lo it lj b gy lp lq l lr ls">import pandas as pd <br/>df['timestamp'] = df.index<br/>df['timestamp'] = pd.to_datetime(df['timestamp'])</span></pre><p id="4bc1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来，让我们导入“seaborn”并绘制时间序列的线图:</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="4c49" class="ln lo it lj b gy lp lq l lr ls">import seaborn as sns<br/>import matplotlib.pyplot as plt<br/>sns.set()<br/>sns.lineplot(df['timestamp'], df['Joker'])<br/>plt.title("Number of Google Searches for 'Joker' from October 1, 2019 to October 30, 2019")</span></pre><figure class="le lf lg lh gt ju gh gi paragraph-image"><div class="gh gi lu"><img src="../Images/124ce3c26e52433eca07258da751a616.png" data-original-src="https://miro.medium.com/v2/resize:fit:1146/format:webp/1*nmou7uEAT4kXwAcrpzDwYw.png"/></div></figure><p id="98fc" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在让我们看看另一个使用不同关键字搜索的时间序列图。让我们搜索“特朗普万圣节”:</p><figure class="le lf lg lh gt ju gh gi paragraph-image"><div class="gh gi lv"><img src="../Images/2b43c07378bed086f5080c5c3ba1600c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1160/format:webp/1*3Q36hKbfFCzwXc6vkJl6UA.png"/></div></figure><p id="d182" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们还可以定义一个函数，允许我们比较许多关键字的搜索次数:</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="750e" class="ln lo it lj b gy lp lq l lr ls">import seaborn as sns<br/>import matplotlib.pyplot as plt<br/>import pandas as pd</span><span id="3f2a" class="ln lo it lj b gy lw lq l lr ls">def get_plot(key_words):<br/>    pytrends = TrendReq(hl='en-US', tz=360)<br/>    pytrends.build_payload([key_words], cat=0, timeframe='2019-10-01 2019-10-30',  gprop='',geo="US-NY")    <br/>    df = pytrends.interest_over_time()  <br/>    print(df.head(10))<br/>    df['timestamp'] = df.index<br/>    df['timestamp'] = pd.to_datetime(df['timestamp'])<br/>    print(df.head())<br/>    sns.set()<br/>    ax = sns.lineplot(df['timestamp'], df[key_words], label = key_words)<br/>    plt.ylabel("Number of Searchers")<br/>    ax.legend()<br/>    plt.show()</span></pre><p id="7566" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在我们可以用许多不同的关键字调用这个函数。让我们坚持流行文化搜索:</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="d1f0" class="ln lo it lj b gy lp lq l lr ls">get_plot("Kim Kardashian Costume")<br/>get_plot("Taylor Swift Costume")<br/>get_plot("Trump Costume")<br/>get_plot("Joker Costume")</span></pre><figure class="le lf lg lh gt ju gh gi paragraph-image"><div class="gh gi lx"><img src="../Images/2725811e7a85a455ba3d5ae0d4da3536.png" data-original-src="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*sDHAkWis8LUpFyH55VA6Wg.png"/></div></figure><p id="4f7d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们也可以尝试更传统的万圣节服装:</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="0325" class="ln lo it lj b gy lp lq l lr ls">get_plot("Ghost Costume")<br/>get_plot("Woody Costume")<br/>get_plot("Iron Man Costume")<br/>get_plot("Spiderman Costume")</span></pre><figure class="le lf lg lh gt ju gh gi paragraph-image"><div class="gh gi ly"><img src="../Images/2f77cf33fb81bb2c1a606943c97a2e14.png" data-original-src="https://miro.medium.com/v2/resize:fit:1134/format:webp/1*xki4I4OxwkkJVte6UHWaLw.png"/></div></figure><p id="b2a4" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了对我们的结果做出决定，我们可以定义一个函数来返回给定关键字的搜索次数总和:</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="680b" class="ln lo it lj b gy lp lq l lr ls">def get_sum(key_words):<br/>    pytrends = TrendReq(hl='en-US', tz=360)<br/>    pytrends.build_payload([key_words], cat=0, timeframe='2019-10-01 2019-10-30',  gprop='',geo="US-NY")    <br/>    df = pytrends.interest_over_time()  <br/>    print(df.head(10))<br/>    df['timestamp'] = df.index<br/>    df['timestamp'] = pd.to_datetime(df['timestamp'])<br/>    print(df.head())<br/>    return df[key_words].sum()</span></pre><p id="4c7c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以将结果存储在数据帧中并打印表格:</p><pre class="le lf lg lh gt li lj lk ll aw lm bi"><span id="0ca0" class="ln lo it lj b gy lp lq l lr ls">results = pd.DataFrame({"Kim Kardashian Costume":[get_sum("Kim Kardashian Costume")],"Taylor Swift Costume":[get_sum("Taylor Swift Costume"),<br/>           "Trump Costume": [get_sum("Trump Costume")], "Joker Costume": [get_sum("Joker Costume")]})</span><span id="e780" class="ln lo it lj b gy lw lq l lr ls">print(results)</span></pre><figure class="le lf lg lh gt ju gh gi paragraph-image"><div class="gh gi lz"><img src="../Images/e60e947248fa563dbc39549f888b7152.png" data-original-src="https://miro.medium.com/v2/resize:fit:1142/format:webp/1*Bnxcs4WFKtMZvTv8I35JXg.png"/></div></figure><p id="6078" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">看来赢家是小丑服装！你可以自己尝试更多的服装创意。这篇文章中的代码可以在<a class="ae kf" href="https://github.com/spierre91/medium_code" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到。我希望你喜欢！感谢阅读！</p></div></div>    
</body>
</html>