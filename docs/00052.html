<html>
<head>
<title>A Deep Dive Into Data Quality</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">对数据质量的深入探究</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/a-deep-dive-into-data-quality-c1d1ee576046?source=collection_archive---------8-----------------------#2019-01-03">https://towardsdatascience.com/a-deep-dive-into-data-quality-c1d1ee576046?source=collection_archive---------8-----------------------#2019-01-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><h1 id="453d" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated"><strong class="ak">简介:</strong></h1><p id="77fc" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">数据质量通常被视为处理数据的乏味组成部分。具有讽刺意味的是，通常是这个组件占据了我们大部分的时间。数据质量很可能是数据管道中最重要的组成部分，因为如果您的数据缺乏可信度和可靠性，从数据中生成的仪表板和分析将毫无用处。</p><p id="753e" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">数据质量面临的挑战是，没有清晰简单的公式来确定数据是否正确。就像一个没有淡水来源的池塘，数据会很快变得停滞不前。今天正确的数据，一个月后可能就不正确了。幸运的是，在验证数据质量时，有一些基本的技术和方法可以广泛应用。数据质量的一般主题是发现不满足特定需求的离群值和违反业务假设的记录集。</p><h1 id="b446" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated"><strong class="ak">攻略:</strong></h1><p id="776d" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">在处理移动数据时，可以将数据分为三个独立的层:ETL 层、业务层和报告层。ETL 层包含源系统和目标系统之间的数据接收和数据移动的代码(例如，从应用程序数据库到数据仓库)。业务层位于原始数据和最终数据模型之间。最后，报告层包含仪表板，业务用户可以从中查看和交互。在接下来的部分中，我们将介绍适用于每个数据层的技术。</p><p id="03a4" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">下面的例子是用 Postgres SQL 做的。我将使用两个表，一个点击表和一个视图表。点击表表示关于点击网页上的链接的用户的数据。“视图”表表示访问过网页的用户的相关数据。</p><h1 id="c31d" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">ETL 层中的数据质量:</h1><p id="d805" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">数据管道的第一层是 ETL 层。这一层的数据质量检查通常是相似的，与业务需求和不同的行业无关。这里的目标是检查以确保数据在从源系统移动到目标系统时不会丢失或降级。我们检查诸如行计数的差异(显示数据被错误地添加或丢失)、部分加载的数据集(通常有很高的空计数)和重复的记录。</p><h1 id="61df" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">使用 SQL 的示例:</h1><p id="7c08" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated"><strong class="kq iu">行数</strong></p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="4e0c" class="ma jr it lw b gy mb mc l md me">WITH<br/>source_count as (Select count(*) as total_count from source) ,</span><span id="9692" class="ma jr it lw b gy mf mc l md me">target_count as (Select count(*) as total_count from target)</span><span id="45b7" class="ma jr it lw b gy mf mc l md me">SELECT<br/>   CASE WHEN <br/>     (select total_count from source_count) = (select total_count from target_count) <br/>    THEN True <br/>    ELSE False<br/>END as valid_row_count<br/>FROM <br/>  pipe_table_1</span></pre><p id="549b" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">在上面的例子中，我们正在寻找一个场景，其中来自源和目标的计数不匹配。在大多数情况下，两个表中的行数应该保持一致。这是为了确保表之间发生的转换不会意外地更改行数。例如，应用程序上的用户数量应该与应用程序数据库和数据仓库相匹配。也存在行数预计会改变的情况。在这种情况下，目标应该是验证计数是否在预期范围内。另外，需要注意的是，这里使用了<a class="ae mg" href="https://www.essentialsql.com/introduction-common-table-expressions-ctes/" rel="noopener ugc nofollow" target="_blank"> <strong class="kq iu">通用表表达式</strong> </a>来保持 SQL 语句的可读性。</p><p id="7810" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated"><strong class="kq iu">加入验证</strong></p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="2f6c" class="ma jr it lw b gy mb mc l md me">WITH join_count AS (</span><span id="850a" class="ma jr it lw b gy mf mc l md me"> SELECT</span><span id="2fd7" class="ma jr it lw b gy mf mc l md me">    count(*) AS view_count</span><span id="bf85" class="ma jr it lw b gy mf mc l md me"> FROM views</span><span id="4590" class="ma jr it lw b gy mf mc l md me"> LEFT JOIN clicks ON clicks.view_id = views.id</span><span id="4561" class="ma jr it lw b gy mf mc l md me">)</span><span id="e8ad" class="ma jr it lw b gy mf mc l md me">SELECT</span><span id="ebdf" class="ma jr it lw b gy mf mc l md me">CASE <br/>     WHEN (SELECT view_count FROM join_count) = count(1) <br/>     THEN True<br/>     ELSE False<br/>END AS valid_join</span><span id="4a75" class="ma jr it lw b gy mf mc l md me">FROM</span><span id="855b" class="ma jr it lw b gy mf mc l md me">views;</span></pre><p id="91b3" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">在上面的例子中，我们正在检查以确保左连接后的表的行数与原始表的行数相同。这是为了确保在任一表上都没有重复的键(这通常可以由数据库强制执行，但在使用派生表或视图时则不行)。同样，该约束并不总是正确的，因为某些连接预计会导致连接记录中的行增加或减少，在这种情况下，有必要了解值的预期范围。</p><figure class="lr ls lt lu gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi mh"><img src="../Images/0efe92f914eb9a61358da04f6e10cb0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PihuUEmZHPtr3RszcmlKTA.png"/></div></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk">Image from Trifacta</figcaption></figure><h1 id="3d37" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">业务层的数据质量:</h1><p id="26b7" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">数据管道的下一层是业务逻辑层。通常，在将原始/部分转换的数据加载到数据仓库中的临时区域后，会应用该层中的数据质量检查。在通过这些检查并检查到无效行之前，您不希望将数据加载到最终目的地。这里的目标是确保不违反基本的业务理解，并且数据具有业务意义。</p><p id="446c" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">这些业务质量检查还充当辅助检查或安全措施，以确保数据已经从 ETL 层正确地引入到数据库中(因为在 ETL 层中验证每个数据质量度量可能是广泛的和不切实际的)。</p><p id="2001" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">业务层检查通常包括验证数值度量是否在业务需求定义的有效范围内。</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="4872" class="ma jr it lw b gy mb mc l md me">SELECT <br/>   count(*), <br/>   year</span><span id="c38c" class="ma jr it lw b gy mf mc l md me">FROM</span><span id="e929" class="ma jr it lw b gy mf mc l md me">   views a</span><span id="2dc0" class="ma jr it lw b gy mf mc l md me">JOIN date b on a.date _id = b.date_id</span><span id="f854" class="ma jr it lw b gy mf mc l md me">GROUP BY 1,2</span><span id="8505" class="ma jr it lw b gy mf mc l md me">HAVING count(*) &gt; [EXPECTED_RANGE];</span><span id="427b" class="ma jr it lw b gy mf mc l md me">--------------------------------------------------------</span><span id="4136" class="ma jr it lw b gy mf mc l md me">SELECT <br/>   count(*), <br/>   year, <br/>   month</span><span id="45c5" class="ma jr it lw b gy mf mc l md me">FROM Views a</span><span id="257b" class="ma jr it lw b gy mf mc l md me">JOIN date b on a.date _id = b.date_id</span><span id="27c2" class="ma jr it lw b gy mf mc l md me">GROUP BY 1 2,3</span><span id="2b98" class="ma jr it lw b gy mf mc l md me">HAVING count(*) &gt; [EXPECTED_RANGE];</span></pre><p id="eae7" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">一种技术是观察给定度量或测量在不同时间段的变化。在本例中，我们查看不同年份以及不同月份的视图。</p><p id="cda6" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">我们正试图识别用户浏览量的突然意外上升或下降。区分预期变化和意外变化也是必要的。在我们的例子中，我们关注的是电子商务网站的眼球，也称为用户视图。一个预期的趋势是，在假期期间，观看次数会增加。</p><figure class="lr ls lt lu gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi ca"><img src="../Images/da1fb47feb055c27cdc8be0df3070761.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*noAGHymDwWkZE9JucfWkPQ.png"/></div></div></figure><p id="cb55" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">—验证视图数量应始终大于点击数量</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="8b40" class="ma jr it lw b gy mb mc l md me">SELECT</span><span id="b335" class="ma jr it lw b gy mf mc l md me">  CASE WHEN</span><span id="d98a" class="ma jr it lw b gy mf mc l md me">    count(a.num_view) &gt;= count(b.num_clicks)<br/>  THEN True <br/>  ELSE False<br/>  END as click_validation</span><span id="0c6b" class="ma jr it lw b gy mf mc l md me">FROM</span><span id="46c8" class="ma jr it lw b gy mf mc l md me">views a</span><span id="aff0" class="ma jr it lw b gy mf mc l md me">LEFT JOIN clicks b ON b.click_id = a.click_id</span></pre><p id="d80c" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">另一种常见的业务验证是检查值是否遵循特定的边界或特定的业务规则。在我们的例子中，查看页面的用户数量应该总是大于或等于点击链接的用户数量(因为在首先查看页面之前不能点击链接)。由于这些检查严重依赖于业务约束，因此确保业务规则和假设在代码和/或元数据存储库中得到适当记录也很重要。</p><h1 id="a532" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">报告层的数据质量:</h1><p id="513e" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">报告层是数据管道的最后一层。这是最终用户与您的数据进行交互的层。然而，仅仅因为这一层通常是管道的末端，并不意味着数据工程师和数据分析师不应该利用报告层来确保数据质量。</p><p id="a41b" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">一个简单的技巧是绘制不同时间段(年、月、日)的数据点，并直观地检查异常值。直观地捕捉数据质量错误是很常见的，在验证检查中可能不容易捕捉到。</p><figure class="lr ls lt lu gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi mt"><img src="../Images/e820427a055267672c9b8eb5d3605ec7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B-0Rurc5arMXsIiTzQr4fQ.png"/></div></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk">Sample Dashboard</figcaption></figure><p id="1623" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">报告层的另一个优秀用例是创建数据质量仪表板。您可以将多个数据质量检查结合在一起，并在将数据发送给主管/业务用户之前，每天将这些指标/图表发送给您。</p><h1 id="ca56" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated"><strong class="ak">结论:</strong></h1><p id="8917" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">基本上，数据质量验证应该尽可能自动化。验证应该嵌入到数据管道代码中，但是要以一种允许毫不费力地改变它的方式。根据数据和验证的重要程度，您可能希望管道完全失败，或者标记问题，将记录移动到单独的拒绝区域，或者继续处理。</p><p id="4dd3" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">有一些工具，如 Trifacta，将有助于简化和自动化这些数据质量检查。现有的 ETL 工具，比如 Informatica，可能也已经内置了数据质量检查特性。然而，理解如何从头实现数据质量仍然很重要，以确保您实现的数据质量检查是有意义的。</p><p id="182d" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">在设计数据管道时，数据质量应该是一个对开发工作产生重大影响的驱动因素。数据工程师应该对他们的数据有一定的熟悉程度，以便能够改进和调试数据质量问题。值得注意的是，数据质量不应该是单个团队或个人的责任。在我看来，对工程师来说，像熟悉他们正在处理的数据一样熟悉代码是至关重要的。</p><p id="f2f0" class="pw-post-body-paragraph ko kp it kq b kr lm kt ku kv ln kx ky kz lo lb lc ld lp lf lg lh lq lj lk ll im bi translated">本文概述了数据质量、监控数据质量的技术以及积极使用数据质量的策略。如前所述，数据质量是数据系统的重要组成部分。投入时间和资源来处理数据质量非常重要！数据质量应该和单元测试对于软件开发一样重要。</p></div></div>    
</body>
</html>