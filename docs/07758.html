<html>
<head>
<title>Firsthand Experience with Polynote — A Better Notebook for Data Engineers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Polynote 的第一手体验——数据工程师的最佳笔记本</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/trying-polynote-from-netflix-a-better-notebook-for-data-engineers-5107277ff2e5?source=collection_archive---------21-----------------------#2019-10-27">https://towardsdatascience.com/trying-polynote-from-netflix-a-better-notebook-for-data-engineers-5107277ff2e5?source=collection_archive---------21-----------------------#2019-10-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/3440102108887b717638dd4f56bf2f9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eK9GxXL58o7SfE20LHsT0w.png"/></div></div></figure><p id="0582" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">网飞最近宣布了<a class="ae kw" href="https://medium.com/netflix-techblog/open-sourcing-polynote-an-ide-inspired-polyglot-notebook-7f929d3f447" rel="noopener"> Polynote </a>，这对致力于 Spark 和 Scala 的数据工程师来说很有希望。有许多很棒的特性，包括</p><ul class=""><li id="0003" class="kx ky iq ka b kb kc kf kg kj kz kn la kr lb kv lc ld le lf bi translated">Scala 的交互式自动完成和参数提示</li><li id="5473" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv lc ld le lf bi translated">将 Maven 存储库中的依赖项配置为笔记本级别的设置</li><li id="402a" class="kx ky iq ka b kb lg kf lh kj li kn lj kr lk kv lc ld le lf bi translated">Scala 和 Python 代码在同一个笔记本中，变量在它们之间共享(也称为多语言)</li></ul><p id="7522" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们用 Spark 中一个经典的字数统计例子来试试 Polynote。在这个例子中，我们读取了来自<a class="ae kw" href="https://medium.com/netflix-techblog/open-sourcing-polynote-an-ide-inspired-polyglot-notebook-7f929d3f447" rel="noopener">网飞的 Polynote medium post </a>的文本，并用它用 python matlablib 绘制了一个字数统计条形图。代码可以在<a class="ae kw" href="https://github.com/yclim/polynote-examples/blob/master/first%20notebook.ipynb" rel="noopener ugc nofollow" target="_blank">这里找到</a></p></div><div class="ab cl ll lm hu ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ij ik il im in"><h1 id="6fc8" class="ls lt iq bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">装置</h1><p id="a937" class="pw-post-body-paragraph jy jz iq ka b kb mq kd ke kf mr kh ki kj ms kl km kn mt kp kq kr mu kt ku kv ij bi translated">按照它的<a class="ae kw" href="https://polynote.org/docs/01-installation.html" rel="noopener ugc nofollow" target="_blank">指南</a>，安装过程非常简单。另外，我还安装了 matplotlib</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="8b11" class="ne lt iq na b gy nf ng l nh ni">pip3 install matplotlib</span></pre><p id="f993" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你打算尝试它的多语言特性(例如 Scala 和 Python 之间的共享变量)，你需要再包含一个环境变量:</p><pre class="mv mw mx my gt mz na nb nc aw nd bi"><span id="df41" class="ne lt iq na b gy nf ng l nh ni">export PYSPARK_ALLOW_INSECURE_GATEWAY=1</span></pre><p id="7356" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果没有，您将会看到:</p><figure class="mv mw mx my gt jr gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/adda85d934dc25ef4278f594eabfbf47.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*r2KTRBdoQR74EFQ5IZPxaA.png"/></div></figure></div><div class="ab cl ll lm hu ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ij ik il im in"><h1 id="7d04" class="ls lt iq bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">编辑经验</h1><p id="7d87" class="pw-post-body-paragraph jy jz iq ka b kb mq kd ke kf mr kh ki kj ms kl km kn mt kp kq kr mu kt ku kv ij bi translated">使用笔记本级别的“配置和依赖项”设置，可以很容易地配置从 maven 存储库中提取依赖项。让我们包含<a class="ae kw" href="https://github.com/lihaoyi/requests-scala" rel="noopener ugc nofollow" target="_blank">请求——Scala</a>使用 HTTP get 从网飞的<a class="ae kw" href="https://medium.com/netflix-techblog/open-sourcing-polynote-an-ide-inspired-polyglot-notebook-7f929d3f447" rel="noopener">博客</a>获取我们的文本。</p><figure class="mv mw mx my gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nk"><img src="../Images/4e1f288b67aa8613f5c79bf312e444df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K5YhaHMe3jpOd6QfRP-z-A.png"/></div></div></figure><figure class="mv mw mx my gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nl"><img src="../Images/c41a65848f664fa8cc526faa70583aa6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iJPQMTDZovf3Xr3T1Mgd_g.png"/></div></div></figure><p id="ee21" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">数据工程师终于有了一种简单的方法，通过一个集中的 maven 资源库，向笔记本用户共享他们用 Scala 或 Java 编写的代码！</p><p id="1621" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">自动完成功能适用于从 maven 资源库中提取的库:</p><figure class="mv mw mx my gt jr gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/1ab941c3a0c4d60668154a47a55797ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1316/format:webp/1*KJo2gTrY8s4I41nIdLx9MA.png"/></div></figure><p id="8481" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然而，lambda 函数的自动完成似乎还不能工作:</p><figure class="mv mw mx my gt jr gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/17ef506587bb0f940a6886f680c8b9a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:902/format:webp/1*1HU69TMWsa4BgL8LfRKWdA.png"/></div></figure></div><div class="ab cl ll lm hu ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ij ik il im in"><h1 id="585d" class="ls lt iq bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">火花集成</h1><p id="b6d4" class="pw-post-body-paragraph jy jz iq ka b kb mq kd ke kf mr kh ki kj ms kl km kn mt kp kq kr mu kt ku kv ij bi translated">在这个字数统计示例中，我们从 HTTP 获取文本，将其标记化，并保留所有长度超过 4 个字符的标记。</p><figure class="mv mw mx my gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi no"><img src="../Images/91e41776fd2e621917eb424d4b28aab0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SIe_UQ_jCQkjEOKSL9-7zw.png"/></div></div></figure><p id="03da" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Spark 也可以通过“配置和依赖”设置轻松配置:</p><figure class="mv mw mx my gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi np"><img src="../Images/298f2371bd63636a949f32570a91273b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qsF8TYkVeAZ0SVuHugAAoQ.png"/></div></div></figure><p id="e19c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一个小问题是，spark 配置设置中至少需要一个项目，Spark 才能工作，这一点并不明显。</p><figure class="mv mw mx my gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nq"><img src="../Images/9e21b640c4186701e5b8259aa7676c0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s7YntjIOIUfCmXmUxCZPfg.png"/></div></div></figure></div><div class="ab cl ll lm hu ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ij ik il im in"><h1 id="79ad" class="ls lt iq bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">切换到 Python</h1><p id="e3d4" class="pw-post-body-paragraph jy jz iq ka b kb mq kd ke kf mr kh ki kj ms kl km kn mt kp kq kr mu kt ku kv ij bi translated">现在，我们切换到 python，使用 panda 和 matplotlib 绘制条形图，只取前十个单词。</p><figure class="mv mw mx my gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nr"><img src="../Images/de20bd2a0d69468c4bbb4c05a54ecdb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vsgKjJG7gsS3qYouxIoQ6Q.png"/></div></div></figure><p id="6de5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">它神奇地起作用。但是，在使用 python 代码运行 cell 时，有时会弹出此异常:</p><figure class="mv mw mx my gt jr gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/1eafb31032635383972c1e1996e60d00.png" data-original-src="https://miro.medium.com/v2/resize:fit:604/format:webp/1*D9YTGbb-6d9ZI-3q53lePA.png"/></div></figure><p id="1a65" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当这种情况发生时，接口停止工作，唯一的解决方法是终止 Polynote 进程并重新运行它。</p></div><div class="ab cl ll lm hu ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="ij ik il im in"><h1 id="096c" class="ls lt iq bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">好了</h1><p id="ece3" class="pw-post-body-paragraph jy jz iq ka b kb mq kd ke kf mr kh ki kj ms kl km kn mt kp kq kr mu kt ku kv ij bi translated">Polynote 是我迄今为止试过的最好的 Spark 和 Scala 笔记本。有一些小故障，但我相信他们会在任何时间拉平。</p><p id="e6be" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我很高兴看到它如何在现实生活中发挥作用。例如，与 Kerberozied 化的 spark 集群集成，并以集群模式而不是独立模式运行 spark。也许在下一篇博客中会有更多的内容。</p><p id="9250" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">感谢阅读，编码快乐！</p></div></div>    
</body>
</html>