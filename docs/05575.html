<html>
<head>
<title>Combining Pandas DataFrames: The easy way</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">组合熊猫数据帧:简单的方法</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/combining-pandas-dataframes-the-easy-way-41eb0f2c1ebf?source=collection_archive---------6-----------------------#2019-08-16">https://towardsdatascience.com/combining-pandas-dataframes-the-easy-way-41eb0f2c1ebf?source=collection_archive---------6-----------------------#2019-08-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="90a4" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">Cheatsheet 版本:何时使用 Concat，何时使用 Merge</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c44fcbb6a601adca179fbe6fc548cb33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B_0ZwHjGz2YMR9pqXtVljw.png"/></div></div></figure><p id="d8db" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="lq">当我第一次使用 Python 进行数据分析时，我真的不知道什么时候使用追加、连接、合并或连接。一开始，每当我试图合并两个数据框时，我都要用谷歌搜索。因此，我想在这里分享我的经验，并给出一个简单的结合数据框架的介绍。</em></p><h1 id="a0d4" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated"><strong class="ak">拼接合并就够了</strong></h1><p id="d321" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">您可以使用 concat 和 merge 做任何事情，因此不需要在开始时使用 append 和 join。由于在某些情况下代码更短，所以使用追加和连接可以节省一些时间。基本上，您可以用 append 和 join 做的所有事情，也可以用 concat 和 merge 来做。这就是为什么我们将重点放在这两个命令上。</p><p id="391f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果您尝试合并两个数据集，首先要做的是决定是使用 merge 还是 concat。找到正确答案有一个简单的规则。如果数据帧的内容与组合数据帧相关，则必须选择 merge，否则可以选择 concat:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mo"><img src="../Images/83777a7fcb0033fcbccc845faa17be9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8dehK88npq1Mmnl_d1atZg.png"/></div></div></figure><h1 id="3004" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">让我们从 Concat 开始</h1><p id="4a37" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">你可以用上面的图片作为开始的备忘单。假设您在公司的数据科学部门工作，销售部门每月都会向您发送新的销售数据。上个月和本月的数据框架中有两列:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mp"><img src="../Images/c431c127189778c5c4a6186b151dd986.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TSw-6W_uaQpsUe5gRZ11tQ.png"/></div></div><figcaption class="mq mr gj gh gi ms mt bd b be z dk">Fig 1: Df_sales on the left side and df_sales2 on the right side</figcaption></figure><p id="decb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">第一列包含关于经销商的信息，第二列包含去年售出的单位数量。因此，数据集的结构每个月都是相同的，你只需将两个数据框架组合起来。在这种情况下，您需要使用 concat:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/ab23068296f172fdb119b5e53f705546.png" data-original-src="https://miro.medium.com/v2/resize:fit:1140/format:webp/1*skIgBFDlGoAoyg41MK-3vQ.png"/></div><figcaption class="mq mr gj gh gi ms mt bd b be z dk">Fig 2: The first use of concat with axis=0</figcaption></figure><p id="adc6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe mv mw mx my b">Ignore_index=True</code>用于创建新的索引。如果您不考虑它，您将保留原始索引。</p><p id="fcff" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在这种情况下，我们将两个数据帧组合在一起。如果您想并排组合两个数据帧，您必须用<code class="fe mv mw mx my b">axis=1</code>指定命令:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/a68c934568a3eea8d04a5b2b0fb1a007.png" data-original-src="https://miro.medium.com/v2/resize:fit:1196/format:webp/1*X6aU1ndW9Pcuv0a7-aMQAw.png"/></div><figcaption class="mq mr gj gh gi ms mt bd b be z dk">Fig 3: Concat with axis=1</figcaption></figure><h1 id="102c" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated"><strong class="ak">数据帧的内容与合并它们相关——如何使用 Merge </strong></h1><p id="7119" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">在第一个例子中，我们每个月都从销售部门收到具有相同数据结构的文件。现在想象一下，市场研究部门给你发送市场数据进行比较。对于每个经销商 ID，您还会收到市场数据，其中包括竞争对手的销售额:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi na"><img src="../Images/07fa4e5bd543dc8b76f766fb810f6166.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OWb6blF2s-h0MOF332GmHw.png"/></div></div><figcaption class="mq mr gj gh gi ms mt bd b be z dk">Fig 4: The sales data on the left side and the market data on the right side</figcaption></figure><p id="46a2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">但是正如你在上面的图片中所看到的，你没有每个经销商所需要的市场数据。因此，您有三个选项来合并上面的数据:</p><p id="c942" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">1.您只保留两个数据帧的交集(这意味着索引从 0 到 9 的行):</p><p id="efe5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">一号和二号</p><p id="9990" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">2.您保留左侧或右侧数据帧的所有信息，而其他数据帧仅保留匹配信息:</p><p id="3dae" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">1 号、2 号和 3 号或者 1 号、2 号和 4 号</p><p id="03b8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">3.您保留两个数据帧的所有信息:</p><p id="c0c6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">1 号，2 号，3 号和 4 号</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/b46bb27d3403994e88def6e57111bbed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1158/format:webp/1*e2Jr4lvOGKz_QJhXXsOKbA.png"/></div></figure><h1 id="8099" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">选项 1-两个数据帧的交集</h1><p id="1ebe" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">你所在部门的老板要求从总份额中获得经销商销售额的份额。因此，他只需要经销商和市场销售可用的经销商 id。在这种情况下，您只需保留具有相同经销商 id 的数据集部分。您必须使用内部连接来保持两个数据帧的交集:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nc"><img src="../Images/5e0136101527cbfc8fec07757cc739b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h5CEnOPEcQX77Tz1cmWvlg.png"/></div></div><figcaption class="mq mr gj gh gi ms mt bd b be z dk">Fig 5: The intersection of the sales and market data</figcaption></figure><p id="484b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">注意:如果不指定“how”参数，默认选项将是内部联接。</p><h1 id="c078" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">选项 2 —一个数据帧的全部内容和另一个数据帧的匹配部分</h1><p id="2ccc" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">您从两个不同的部门接收数据集。销售部门的一个要求可能是，他们想要回他们的原始数据框架和匹配的市场数据:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nd"><img src="../Images/085a9d746bb0865c86e8665cdfe0f04d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BJAzY4YYI5QmJ2oPWthU9w.png"/></div></div><figcaption class="mq mr gj gh gi ms mt bd b be z dk">Fig 6: The full content of the sales data and the matching part from the market data</figcaption></figure><p id="f9ab" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在这种情况下，您必须执行左连接。只有在市场数据集中找到销售数据中的经销商 ID 时，才需要添加市场数据。</p><h1 id="490d" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">选项 3 —保留两个数据帧的所有信息</h1><p id="8893" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">最后，市场部门希望在不丢失任何信息的情况下将两种数据框架结合起来:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/58bde10e06697765c82a689431e02aad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1234/format:webp/1*7XFiOMy8sEfLkf9v3WWdeQ.png"/></div><figcaption class="mq mr gj gh gi ms mt bd b be z dk">Fig 7: The outer join</figcaption></figure><p id="d948" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在生成的数据帧中，两个基本数据帧中没有一个值丢失。最后，外部连接就像一个左连接和一个右连接的组合。</p><h1 id="c605" class="lr ls it bd lt lu lv lw lx ly lz ma mb jz mc ka md kc me kd mf kf mg kg mh mi bi translated">结论和进一步阅读</h1><p id="0467" class="pw-post-body-paragraph ku kv it kw b kx mj ju kz la mk jx lc ld ml lf lg lh mm lj lk ll mn ln lo lp im bi translated">我希望您喜欢这篇介绍，它有助于阐明 concat 和 merge 命令背后的逻辑。从一开始就有了备忘单，你应该能够决定你必须使用哪个命令。要了解更多信息，我可以推荐以下资源:</p><ol class=""><li id="1c39" class="nf ng it kw b kx ky la lb ld nh lh ni ll nj lp nk nl nm nn bi translated">官方文件</li></ol><div class="no np gp gr nq nr"><a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.merge.html" rel="noopener  ugc nofollow" target="_blank"><div class="ns ab fo"><div class="nt ab nu cl cj nv"><h2 class="bd iu gy z fp nw fr fs nx fu fw is bi translated">熊猫。DataFrame.merge - pandas 0.25.0 文档</h2><div class="ny l"><h3 class="bd b gy z fp nw fr fs nx fu fw dk translated">用数据库样式的联接合并数据框架或命名系列对象。联接是在列或索引上完成的。如果加入…</h3></div><div class="nz l"><p class="bd b dl z fp nw fr fs nx fu fw dk translated">pandas.pydata.org</p></div></div></div></a></div><p id="e1eb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">2.关于 concat 和 merge 区别的 stackoverflow 讨论</p><div class="no np gp gr nq nr"><a href="https://stackoverflow.com/questions/38256104/differences-between-merge-and-concat-in-pandas" rel="noopener  ugc nofollow" target="_blank"><div class="ns ab fo"><div class="nt ab nu cl cj nv"><h2 class="bd iu gy z fp nw fr fs nx fu fw is bi translated">pandas 中 merge()和 concat()的区别</h2><div class="ny l"><h3 class="bd b gy z fp nw fr fs nx fu fw dk translated">感谢贡献一个堆栈溢出的答案！请务必回答问题。提供详细信息并分享…</h3></div><div class="nz l"><p class="bd b dl z fp nw fr fs nx fu fw dk translated">stackoverflow.com</p></div></div><div class="oa l"><div class="ob l oc od oe oa of ks nr"/></div></div></a></div><p id="2458" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">3.关于归并和连接区别的讨论</p><div class="no np gp gr nq nr"><a href="https://stackoverflow.com/questions/22676081/what-is-the-difference-between-join-and-merge-in-pandas/37891437" rel="noopener  ugc nofollow" target="_blank"><div class="ns ab fo"><div class="nt ab nu cl cj nv"><h2 class="bd iu gy z fp nw fr fs nx fu fw is bi translated">熊猫里面的 join 和 merge 有什么区别？</h2><div class="ny l"><h3 class="bd b gy z fp nw fr fs nx fu fw dk translated">假设我有两个这样的数据帧:left = pd。DataFrame({'key1': ['foo '，' bar']，' lval': [1，2]}) right =…</h3></div><div class="nz l"><p class="bd b dl z fp nw fr fs nx fu fw dk translated">stackoverflow.com</p></div></div><div class="oa l"><div class="og l oc od oe oa of ks nr"/></div></div></a></div></div><div class="ab cl oh oi hx oj" role="separator"><span class="ok bw bk ol om on"/><span class="ok bw bk ol om on"/><span class="ok bw bk ol om"/></div><div class="im in io ip iq"><p id="0980" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><a class="ae oo" href="https://medium.com/@droste.benedikt/membership" rel="noopener">如果您喜欢中级和高级数据科学，并且还没有注册，请随时使用我的推荐链接加入社区。</a></p></div></div>    
</body>
</html>