<html>
<head>
<title>Removing Spikes from Raman Spectra with Anomaly Detection: Whitaker-Hayes algorithm in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用异常检测去除拉曼光谱中的尖峰:Python 中的 Whitaker-Hayes 算法</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/removing-spikes-from-raman-spectra-8a9fdda0ac22?source=collection_archive---------11-----------------------#2019-11-19">https://towardsdatascience.com/removing-spikes-from-raman-spectra-8a9fdda0ac22?source=collection_archive---------11-----------------------#2019-11-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div class="gh gi jq"><img src="../Images/1d366247bb29d67b9b3cb8c10b27155f.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/1*TgD0KPshDXQz0NhgrqB8dw.gif"/></div><figcaption class="jx jy gj gh gi jz ka bd b be z dk">Detecting and removing spikes from Raman spectra</figcaption></figure><p id="e599" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">摘要</strong>。在这篇文章中，我想对 D. Whitaker 和 K. Hayes 在《化学计量学和智能实验室系统杂志》上提出的一种去除拉曼光谱中尖峰信号的新方法进行评论。在他们的出版物中，作者使用了一种基于改进的 Z 分数异常值检测的算法来定位这种尖峰，如果存在的话，随后使用简单的移动平均来消除它们。他们不是计算光谱强度的 Z 值，而是计算一次差分光谱的 Z 值。他们还提供了用 r 实现算法的代码。在这里，我用 Python 实现了算法，并展示了如何将它应用于不同的数据集。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><p id="e3bc" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">拉曼光谱是一种广泛使用的分析技术，它提供来自分子和固体的结构和电子信息。它适用于实验室和大规模生产规模，并在许多不同的领域，如物理，化学，生物，医学或工业应用。</p><p id="f741" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">拉曼光谱学中已知的一个典型问题是拉曼光谱有时被尖峰“污染”。尖峰是出现在频谱上随机位置的正的窄带宽峰值。它们起源于高能宇宙射线撞击用于测量拉曼光谱的电荷耦合器件探测器。这些尖峰是有问题的，因为它们可能会妨碍后续分析，特别是在需要多变量数据分析的情况下。因此，处理拉曼光谱数据的第一步是清除尖峰。</p><p id="5932" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">首先，加载所需的 Python 包:</p><pre class="lg lh li lj gt lk ll lm ln aw lo bi"><span id="face" class="lp lq it ll b gy lr ls l lt lu">import numpy as np<br/>import pandas as pd<br/>import matplotlib.pyplot as plt</span></pre><p id="b4d4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">图 1 显示了石墨烯的拉曼光谱。在过去的几年里，石墨烯由于其卓越的物理性能，包括优异的电子、热、光学和机械性能，已经成为非常受欢迎的材料。其特征拉曼光谱由如图所示的几个峰组成。从它们的形状和相关强度，可以获知掺杂、应变或晶界等大量信息。该光谱是被尖峰污染的光谱的明显例子。</p><pre class="lg lh li lj gt lk ll lm ln aw lo bi"><span id="a1bb" class="lp lq it ll b gy lr ls l lt lu"># load the data as data frame<br/>df = pd.read_csv(‘folder_name.../spectrum.txt’, delimiter = ‘\t’)</span><span id="a933" class="lp lq it ll b gy lv ls l lt lu"># Transform the data to a numpy array<br/>wavelength = np.array(df.Wavelength)<br/>intensity = np.array(df.Intensity)</span><span id="92a9" class="lp lq it ll b gy lv ls l lt lu"># Plot the spectrum:<br/>plt.plot(wavelength, intensity)<br/>plt.title(‘Spectrum’, fontsize = 20)<br/>plt.xticks(fontsize = 15)<br/>plt.yticks(fontsize = 15)<br/>plt.xlabel(‘Wavelength (nm)’, fontsize = 20)<br/>plt.ylabel(‘Intensity (a.u.)’, fontsize = 20)<br/>plt.show()</span></pre><figure class="lg lh li lj gt ju gh gi paragraph-image"><div class="gh gi lw"><img src="../Images/c25851bf6494d1a3ee229eeee341f0dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:988/format:webp/1*QsAj9LaOXXAfWW_qrs9RBg.jpeg"/></div><figcaption class="jx jy gj gh gi jz ka bd b be z dk"><strong class="bd lx">Figure 1.</strong> A spike was recorded while measuring the typical Raman spectrum of graphene (characterized by the G and 2D bands).</figcaption></figure><p id="4af5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">基于 Z 分数的拉曼光谱尖峰检测方法</strong></p><p id="0e39" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">尖峰强度通常高于光谱中其他拉曼峰的强度，因此使用基于 z 分数的方法可能是一个好的起点。z 得分以标准差为单位表示一个值离平均值有多远。因此，如果已知总体均值和总体标准差，则原始得分 x(i)的标准得分计算如下:</p><p id="b90c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">z(i) = (x(i)-μ) / σ</p><p id="61d7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">其中<em class="ly"> μ </em>是平均值<em class="ly">，σ </em>是总体 x 的标准偏差(x(i)代表单个拉曼光谱的值)。关于如何使用 Z 分数方法检测异常值的更多详细信息可以在参考文献[3]中找到。</p><p id="a0e6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">让我们计算光谱中点的 z 分数:</p><pre class="lg lh li lj gt lk ll lm ln aw lo bi"><span id="54b2" class="lp lq it ll b gy lr ls l lt lu">def z_score(intensity):<br/> mean_int = np.mean(intensity)<br/> std_int = np.std(intensity)<br/> z_scores = (intensity — mean_int) / std_int<br/> return z_scores</span><span id="6ea0" class="lp lq it ll b gy lv ls l lt lu">intensity_z_score = np.array(z_score(intensity))<br/>plt.plot(wavelength, intensity_z_score)<br/>plt.xticks(fontsize = 15)<br/>plt.yticks(fontsize = 15)<br/>plt.xlabel( ‘Wavelength’ ,fontsize = 20)<br/>plt.ylabel( ‘Z-Score’ ,fontsize = 20)<br/>plt.show()</span></pre><figure class="lg lh li lj gt ju gh gi paragraph-image"><div class="gh gi lz"><img src="../Images/323aef708f8dc9effcac86c9c96dbf03.png" data-original-src="https://miro.medium.com/v2/resize:fit:942/format:webp/1*7u2PCweQYQbWy6vyVOd4wg.png"/></div><figcaption class="jx jy gj gh gi jz ka bd b be z dk"><strong class="bd lx">Figure 2.</strong> Z-scores of the spectrum plotted in figure 1.</figcaption></figure><p id="3a92" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后需要一个阈值来判断一个值是否是异常值。该阈值的典型值为 3.5，由美国质量控制协会提出作为异常值标记规则的基础，而该出版物的作者使用 6。为了应用阈值来排除峰值，必须采用 Z 得分的绝对值:</p><p id="a681" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">|z(i)| = |(x(i)-μ) / σ|</p><p id="699f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">计算为</p><pre class="lg lh li lj gt lk ll lm ln aw lo bi"><span id="6789" class="lp lq it ll b gy lr ls l lt lu">def z_score(intensity):<br/> mean_int = np.mean(intensity)<br/> std_int = np.std(intensity)<br/> z_scores = (intensity — mean_int) / std_int<br/> return z_scores</span><span id="110c" class="lp lq it ll b gy lv ls l lt lu">threshold = 3.5</span><span id="269a" class="lp lq it ll b gy lv ls l lt lu">intensity_z_score = np.array(abs(z_score(intensity)))<br/>plt.plot(wavelength, intensity_z_score)<br/>plt.plot(wavelength, threshold*np.ones(len(wavelength)), label = ‘threshold’)<br/>plt.xticks(fontsize = 15)<br/>plt.yticks(fontsize = 15)<br/>plt.xlabel( ‘Wavelength’ ,fontsize = 20)<br/>plt.ylabel( ‘|Z-Score|’ ,fontsize = 20)<br/>plt.show()</span></pre><figure class="lg lh li lj gt ju gh gi paragraph-image"><div class="gh gi ma"><img src="../Images/75a70fac050aa0a7ddc0a1051c38e7c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:932/format:webp/1*BAVlCFSgx-mwPQGtr0kYVA.png"/></div><figcaption class="jx jy gj gh gi jz ka bd b be z dk"><strong class="bd lx">Figure 2b.</strong> Z-scores of the spectrum plotted in figure 1. The threshold still cuts the 2D Raman peak.</figcaption></figure><p id="47bb" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然而，z 分数非常类似于原始光谱，并且阈值仍然切断主要拉曼峰。让我们使用 3.5 的阈值来绘制检测到的峰值:</p><pre class="lg lh li lj gt lk ll lm ln aw lo bi"><span id="54c4" class="lp lq it ll b gy lr ls l lt lu">threshold = 3.5</span><span id="4449" class="lp lq it ll b gy lv ls l lt lu"># 1 is assigned to spikes, 0 to non-spikes:<br/>spikes = abs(np.array(z_score(intensity))) &gt; threshold</span><span id="ce96" class="lp lq it ll b gy lv ls l lt lu">plt.plot(wavelength, spikes, color = ‘red’)<br/>plt.title(‘Spikes: ‘ + str(np.sum(spikes)), fontsize = 20)<br/>plt.grid()<br/>plt.xticks(fontsize = 15)<br/>plt.yticks(fontsize = 15)<br/>plt.xlabel( ‘Wavelength’ ,fontsize = 20)<br/>plt.ylabel( 'Z-scores &gt; ' + str(threshold) ,fontsize = 20)<br/>plt.show()</span></pre><figure class="lg lh li lj gt ju gh gi paragraph-image"><div class="gh gi mb"><img src="../Images/5ee55f40dedbfec1511e1b555ebc0c9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:974/format:webp/1*C5A8bLvW4i04ZpYc42v-2g.png"/></div><figcaption class="jx jy gj gh gi jz ka bd b be z dk"><strong class="bd lx">Figure 3.</strong>Using modified Z-Scores, 18 spectral point are above the threshold.</figcaption></figure><p id="17bb" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">用于拉曼光谱中尖峰检测的改进的基于 Z 分数的方法</strong></p><p id="5aa9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">第二种选择是利用稳健统计并计算光谱的修正 z 分数。这种改进的 Z 得分方法使用中位数(M)和中位数绝对偏差(MAD ),而不是平均值和标准差:</p><p id="6f79" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">z(i) = 0.6745 (x(i)-M) / MAD</p><p id="b654" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">其中 MAD = median(|x-M|)和|…|代表绝对值。中位数和 MAD 分别是集中趋势和离差的稳健度量。乘数 0.6745 是标准正态分布的第 0.75 个四分位数，MAD 将 to⁴.收敛到该四分位数</p><pre class="lg lh li lj gt lk ll lm ln aw lo bi"><span id="94e3" class="lp lq it ll b gy lr ls l lt lu">def modified_z_score(intensity):<br/> median_int = np.median(intensity)<br/> mad_int = np.median([np.abs(intensity — median_int)])<br/> modified_z_scores = 0.6745 * (intensity — median_int) / mad_int<br/> return modified_z_scores</span><span id="4961" class="lp lq it ll b gy lv ls l lt lu">threshold = 3.5</span><span id="f946" class="lp lq it ll b gy lv ls l lt lu">intensity_modified_z_score = np.array(abs(modified_z_score(intensity)))<br/>plt.plot(wavelength, intensity_modified_z_score)<br/>plt.plot(wavelength, threshold*np.ones(len(wavelength)), label = 'threshold')<br/>plt.xticks(fontsize = 15)<br/>plt.yticks(fontsize = 15)<br/>plt.xlabel('Wavelength (nm)' ,fontsize = 20)<br/>plt.ylabel('|Modified Z-Score|' ,fontsize = 20)<br/>plt.show()</span></pre><figure class="lg lh li lj gt ju gh gi paragraph-image"><div class="gh gi mc"><img src="../Images/9170b4619660903916634a5053b4e1eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:962/format:webp/1*tyIkOZ9TnkVt5NS0XN5xqQ.png"/></div><figcaption class="jx jy gj gh gi jz ka bd b be z dk"><strong class="bd lx">Figure 4. </strong>Modified Z-scores of the spectrum plotted in figure 1. The threshold still cuts the 2D Raman peak.</figcaption></figure><p id="dada" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">仍然可以观察到相同的问题:</p><pre class="lg lh li lj gt lk ll lm ln aw lo bi"><span id="3f7c" class="lp lq it ll b gy lr ls l lt lu"># 1 is assigned to spikes, 0 to non-spikes:<br/>spikes = abs(np.array(modified_z_score(intensity))) &gt; threshold</span><span id="3c80" class="lp lq it ll b gy lv ls l lt lu">plt.plot(wavelength, spikes, color = ‘red’)<br/>plt.title(‘Spikes: ‘ + str(np.sum(spikes)), fontsize = 20)<br/>plt.grid()<br/>plt.xticks(fontsize = 15)<br/>plt.yticks(fontsize = 15)<br/>plt.xlabel( ‘Wavelength’ ,fontsize = 20)<br/>plt.ylabel( 'Modified Z-scores &gt; ' + str(threshold) ,fontsize = 20)<br/>plt.show()</span></pre><figure class="lg lh li lj gt ju gh gi paragraph-image"><div class="gh gi md"><img src="../Images/f05b099b95eae975c6003b466f72363e.png" data-original-src="https://miro.medium.com/v2/resize:fit:982/format:webp/1*XeUgNepxKrBEo3I-f1Yr5w.png"/></div><figcaption class="jx jy gj gh gi jz ka bd b be z dk"><strong class="bd lx">Figure 5. </strong>Using modified Z-Scores, 24 spectral points are above the threshold.</figcaption></figure><p id="e399" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">2D 拉曼峰值仍然被检测为尖峰，因此需要更灵敏的方法。</p><p id="2356" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> Whitaker 和 Hayes 的</strong> <strong class="kd iu">改进的基于 Z 分数的拉曼光谱尖峰检测方法</strong></p><p id="6e95" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">Whitaker 和 Hayes 建议利用尖峰的高强度和小宽度，因此使用连续光谱点之间的差异∇x(i) = x(i)-x(i-1 来计算 z 分数，其中 x(1)，…，x(n)是以等间距波数记录的单个拉曼光谱的值，i = 2，…，n。该步骤消除了线性和缓慢移动的曲线线性趋势，而尖锐的细尖峰将被保留。现在，</p><p id="25e0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">z(i) = 0.6745 (∇x(i)-M) / MAD</p><p id="5890" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">因此只包括一个额外的步骤，其中包括连续值之间的差。</p><pre class="lg lh li lj gt lk ll lm ln aw lo bi"><span id="982f" class="lp lq it ll b gy lr ls l lt lu"># First we calculated ∇x(i):<br/>dist = 0<br/>delta_intensity = [] <br/>for i in np.arange(len(intensity)-1):<br/> dist = intensity[i+1] — intensity[i]<br/> delta_intensity.append(dist)</span><span id="ce17" class="lp lq it ll b gy lv ls l lt lu">delta_int = np.array(delta_intensity)<br/># Alternatively to the for loop one can use: <br/># delta_int = np.diff(intensity)</span><span id="8c75" class="lp lq it ll b gy lv ls l lt lu"><br/>intensity_modified_z_score = np.array(modified_z_score(delta_int))<br/>plt.plot(wavelength[1:], intensity_modified_z_score)<br/>plt.title('Modified Z-Score using ∇x(i)')<br/>plt.xticks(fontsize = 15)<br/>plt.yticks(fontsize = 15)<br/>plt.xlabel('Wavelength (nm)', fontsize = 20)<br/>plt.ylabel('Score', fontsize = 20)<br/>plt.show()</span></pre><figure class="lg lh li lj gt ju gh gi paragraph-image"><div class="gh gi lw"><img src="../Images/1e7b7e91c8073f54bbebd94a32eea31e.png" data-original-src="https://miro.medium.com/v2/resize:fit:988/format:webp/1*d6yetjmD3Gn7bqnvoVeCsQ.png"/></div><figcaption class="jx jy gj gh gi jz ka bd b be z dk"><strong class="bd lx">Figure 6. </strong>Modified Z-scores using ∇x(i) of the spectrum plotted in figure 1.</figcaption></figure><p id="9bac" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">同样，为了应用阈值来排除尖峰，必须采用修改后的 Z 得分的绝对值:</p><p id="b965" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">|z(i)| =|0.6745 (∇x(i)-M) / MAD|</p><p id="fcb9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">导致</p><pre class="lg lh li lj gt lk ll lm ln aw lo bi"><span id="0ff8" class="lp lq it ll b gy lr ls l lt lu">threshold = 3.5</span><span id="c87c" class="lp lq it ll b gy lv ls l lt lu">intensity_modified_z_score = np.array(np.abs(modified_z_score(delta_int)))<br/>plt.plot(wavelength[1:], intensity_modified_z_score)<br/>plt.plot(wavelength[1:], threshold*np.ones(len(wavelength[1:])), label = 'threshold')<br/>plt.title('Modified Z-Score of ∇x(i)', fontsize = 20)<br/>plt.xticks(fontsize = 15)<br/>plt.yticks(fontsize = 15)<br/>plt.xlabel('Wavelength (nm)', fontsize = 20)<br/>plt.ylabel('Score', fontsize = 20)<br/>plt.show()</span></pre><figure class="lg lh li lj gt ju gh gi paragraph-image"><div class="gh gi me"><img src="../Images/20aed186cafd89885f0a505b8890e248.png" data-original-src="https://miro.medium.com/v2/resize:fit:970/format:webp/1*3tbMDde93x1IwDjK-EMv-A.png"/></div><figcaption class="jx jy gj gh gi jz ka bd b be z dk"><strong class="bd lx">Figure 7. </strong>Abosolute value of the modified Z-scores of ∇x(i) of the spectrum plotted in figure 1.</figcaption></figure><p id="d3b0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">同样，检测到的尖峰数量可以计算如下</p><pre class="lg lh li lj gt lk ll lm ln aw lo bi"><span id="de81" class="lp lq it ll b gy lr ls l lt lu"># 1 is assigned to spikes, 0 to non-spikes:<br/>spikes = abs(np.array(modified_z_score(intensity))) &gt; threshold</span><span id="48ec" class="lp lq it ll b gy lv ls l lt lu">plt.plot(wavelength, spikes, color = ‘red’)<br/>plt.title(‘Spikes: ‘ + str(np.sum(spikes)), fontsize = 20)<br/>plt.grid()<br/>plt.xticks(fontsize = 15)<br/>plt.yticks(fontsize = 15)<br/>plt.xlabel( ‘Wavelength’ ,fontsize = 20)<br/>#plt.ylabel( ‘Spike(1) or not(0)?’ ,fontsize = 20)<br/>plt.show()</span></pre><figure class="lg lh li lj gt ju gh gi paragraph-image"><div class="gh gi mf"><img src="../Images/2c28c43509c91313fe8c9c94c8b9ee50.png" data-original-src="https://miro.medium.com/v2/resize:fit:968/format:webp/1*lcxq5eftbDz_Loph7hw_gA.png"/></div><figcaption class="jx jy gj gh gi jz ka bd b be z dk"><strong class="bd lx">Figure 8. </strong>Using modified Z-Scores with ∇x(i), 17 spectral points are above the threshold = 3.5.</figcaption></figure><p id="9fdc" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">对于 3.5 的推荐阈值，分配了许多错误的尖峰。然而，与拉曼峰相比，通过这种方法得到的值比以前高得多。</p><pre class="lg lh li lj gt lk ll lm ln aw lo bi"><span id="542d" class="lp lq it ll b gy lr ls l lt lu">plt.plot(wavelength[1:],<br/>np.array(abs(modified_z_score(delta_int))), color='black', label = '|Modified Z-Score using ∇x(i)|')<br/>plt.plot(wavelength, np.array(abs(modified_z_score(intensity))), label = '|Modified Z-Score|', color = 'red')<br/>plt.plot(wavelength, np.array(abs(z_score(intensity))), label = '|Z-Score|', color = 'blue')<br/>plt.xticks(fontsize = 15)<br/>plt.yticks(fontsize = 15)<br/>plt.xlabel( 'Wavelength' ,fontsize = 20)<br/>plt.ylabel( 'Score' ,fontsize = 20)<br/>plt.legend()<br/>plt.show()</span></pre><figure class="lg lh li lj gt ju gh gi paragraph-image"><div class="gh gi mg"><img src="../Images/cacc88d9dade3771e727a4b0bd42de7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:954/format:webp/1*JF42-i12nt75m8ae11QnpA.png"/></div><figcaption class="jx jy gj gh gi jz ka bd b be z dk"><strong class="bd lx">Figure 9. </strong>Comparison between the three different approaches.</figcaption></figure><p id="c601" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">一般来说，必须根据数据集选择合适的阈值。对于这种情况，阈值= 7 已经足以获得清晰的选择。</p><figure class="lg lh li lj gt ju gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/52599cbfd183bee5041f6dc5c8d29714.png" data-original-src="https://miro.medium.com/v2/resize:fit:950/format:webp/1*SE1F9OYtU9bMm8ZSX7o3kQ.png"/></div><figcaption class="jx jy gj gh gi jz ka bd b be z dk"><strong class="bd lx">Figure 10. </strong>Absolute values of the modified Z-scores with ∇x(i) of the spectrum plotted in figure 1.</figcaption></figure><figure class="lg lh li lj gt ju gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/5a1e2fa4ec9a7b26a12498bf4ab06e8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:926/format:webp/1*92lrc5EKkT6RtwJ9B3CNIg.png"/></div><figcaption class="jx jy gj gh gi jz ka bd b be z dk"><strong class="bd lx">Figure 11. </strong>Using modified Z-Scores with ∇x(i), 3 spectral points are above the threshold = 7.</figcaption></figure><p id="6c8a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">固定拉曼光谱</strong></p><p id="563e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">一旦检测到尖峰信号，下一步就是移除它们并修正光谱。为此，通过计算每个候选波数的近邻的平均值(在 2m+1 个值窗口内)，在每个候选波数处获得插值。</p><pre class="lg lh li lj gt lk ll lm ln aw lo bi"><span id="238f" class="lp lq it ll b gy lr ls l lt lu">def fixer(y,m):<br/> threshold = 7 # binarization threshold. <br/> spikes = abs(np.array(modified_z_score(np.diff(y)))) &gt; threshold<br/> y_out = y.copy() # So we don’t overwrite y</span><span id="95e6" class="lp lq it ll b gy lv ls l lt lu"> for i in np.arange(len(spikes)):<br/>  if spikes[i] != 0: # If we have an spike in position i<br/>   w = np.arange(i-m,i+1+m) # we select 2 m + 1 points around our spike<br/>   w2 = w[spikes[w] == 0] # From such interval, we choose the ones which are not spikes<br/>   y_out[i] = np.mean(y[w2]) # and we average their values<br/> <br/>return y_out</span><span id="2ba8" class="lp lq it ll b gy lv ls l lt lu"># Does it work?<br/>plt.plot(wavelength, intensity, label = 'original data')<br/>plt.plot(wavelength, fixer(intensity,m=3), label = 'fixed spectrum')<br/>plt.title('Despiked spectrum',fontsize = 20)<br/>plt.xticks(fontsize = 15)<br/>plt.yticks(fontsize = 15)<br/>plt.xlabel('Wavelength (nm)' ,fontsize = 20)<br/>plt.ylabel('Intensity (a.u.)' ,fontsize = 20)<br/>plt.legend()<br/>plt.show()</span></pre><figure class="lg lh li lj gt ju gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/0bac4fe07649f605b9c8a542b7434b9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:990/format:webp/1*fIFCd43DQcmoof3VQAIUCA.png"/></div><figcaption class="jx jy gj gh gi jz ka bd b be z dk"><strong class="bd lx">Figure 12. </strong>Original and despiked Raman spectrum using modified Z-Scores with ∇x(i) with the threshold = 7.</figcaption></figure><p id="5e02" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">因此，在计算了∇x 的修改的 z 分数，并且通过设置适当的阈值来进行阈值处理之后，通过应用移动平均滤波器来去除和平滑尖峰。</p><p id="8f1f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">其他例子</strong></p><p id="4e35" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">最后，给出了两个具有不同强度信号的尖峰信号的例子，显示了这种方法的优点。</p><figure class="lg lh li lj gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi mk"><img src="../Images/1489efcee0d7d329b5fa0b68f56b36b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6pGmRJ9ds17VmXLvBdLghQ.png"/></div></div><figcaption class="jx jy gj gh gi jz ka bd b be z dk"><strong class="bd lx">Figure 13.</strong> Examples of two more spectra in the first row of graphs, their Z-scores (blue lines) , modified Z-scores (red lines) and modified Z-scores using ∇x(i) (black lines) in the second row of graphs and thei despiked spectra in the third row, are presented.</figcaption></figure><p id="a779" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">承认。</strong>我要感谢<a class="ae mp" href="https://medium.com/@jluishita" rel="noopener">豪尔赫·路易斯·希塔</a>和<a class="ae mp" href="https://medium.com/@ana.solagurenbeascoa" rel="noopener">安娜·索拉古伦-比斯科</a>花时间校对这些笔记。</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><p id="339f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">[1]惠特克，达伦 a .，和凯文海斯。"消除拉曼光谱尖峰的简单算法."<em class="ly">化学计量学和智能实验室系统</em>179(2018):82–84。</p><p id="1a73" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">[2] Iglewicz 和 D. Hoaglin。" ASQC 质量控制基本参考:统计技术."<em class="ly">如何检测和处理异常值</em>16(1993):1–87。</p><p id="e4fd" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">[3] <a class="ae mp" href="http://colingorrie.github.io/outlier-detection.html" rel="noopener ugc nofollow" target="_blank"> Colin Gorrie 的数据故事:检测离群值的三种方法。http://colingorrie.github.io/outlier-detection.html</a></p><p id="3f0a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">[4]若昂·罗德里格斯。“离群值让我们发疯:单变量离群值检测”。中等。<a class="ae mp" href="https://medium.com/james-blogs/outliers-make-us-go-mad-univariate-outlier-detection-b3a72f1ea8c7" rel="noopener">https://medium . com/James-blogs/outliers-make-us-go-mad-单变量-离群值-检测-b3a72f1ea8c7 </a></p></div></div>    
</body>
</html>