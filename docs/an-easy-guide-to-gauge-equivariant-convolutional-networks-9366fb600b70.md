# 测量等变卷积网络的简易指南

> 原文：<https://towardsdatascience.com/an-easy-guide-to-gauge-equivariant-convolutional-networks-9366fb600b70?source=collection_archive---------4----------------------->

几何深度学习是一个非常令人兴奋的新领域，但它的数学正在慢慢漂移到代数拓扑和理论物理的领域。对于 Cohen 等人的论文“规范等变卷积网络和二十面体 CNN”来说尤其如此。艾尔。([https://arxiv.org/abs/1902.04615](https://arxiv.org/abs/1902.04615))，这正是我想在这篇文章中探讨的。这篇论文使用了规范理论的语言，规范理论是物理学中任何喜欢同时使用“量子”和“场”这两个词的事物的核心。它承诺给规范理论的基础一个直观的理解，我必须说，它提供了并且可能是我迄今为止看到的最好的介绍。但是它仍然是一个困难的课题。

我在这里想做的是给出一个纯粹直观的理解，没有数学。虽然我没有完全遵循文章的结构，但您仍然可以并排打开文章，因为我会尝试突出所有重要的术语。

在下文中，我假设你知道卷积神经网络(CNN)是如何工作的，但不知道它们与流形有什么关系。所以我们走吧！

# 多支管

一个**总管**是一件简单的事情。你看到的每一个二维表面都可以被认为是一个流形。球体的表面，立方体的表面，所有的流形。但是它并不局限于二维，见鬼，它甚至不局限于可以想象的东西。曲线是流形。四维时空是一个流形。它非常笼统，描述了一个空间。但是让我们关注二维表面。最简单的曲面是平面，比如电脑屏幕。当我们用 CNN 做卷积时，我们通常在这些平面图像上做。

比方说，我们想用 CNN 预测天气。对于一个国家来说，这很简单:使用当地的天气数据作为输入，然后喀拉斯喀拉斯嘣，你就有了一个训练好的模型。如果我们想对整个地球的天气进行分类呢？你如何把它放到一张图片上？或许:

![](img/6d5a2743848cff710575df2c229be86f.png)

(Image by Pixabay)

但是有一个问题。左边和右边实际上是同一个点。此外，整个上边缘对应于单个点，下边缘也是如此。整件事都被扭曲了。试过压扁乒乓球吗？是啊，情况不妙。当我们试图应用卷积时，我们会得到奇怪的结果。非物质的事情可能发生在边缘。它可能会在图像的最右侧预测到强烈的东风，但在图像的左侧却没有，即使它们代表的是同一个地点。CNN 就是不明白地球是绕着转的。

或者，我们可以为地球创建多个重叠的**地图**,并让 CNN 对这些地图进行操作。这本地图集也被称为**地图集**。**将 CNN 切换到所有这些单独的地图上，确保在下一张地图上它们重叠的同一点上继续，这样就能让它明白地球是圆的。这是几何深度学习背后的基本思想:直接将深度学习应用于曲面或流形，以保留它们的几何结构。然而，有一个问题。一个大的。**

# 我们去新加坡吧！

现在，让我们暂时忘记天气，拿出指南针。假设你在新加坡。向北，经过泰国，穿过中国，蒙古，到达北极。并且不改变方向，一直往前走。你将穿过加拿大和美国，直到你到达中美洲的某个地方。停在那里，开始横向游过太平洋，不要改变方向！中风几百万次后，你应该会回到新加坡。但是等等。你从来没有改变方向，为什么你要向南看？

让我们重复一遍，但是这一次我们到达北极后向左侧身。我们将在尼格拉附近停下来，开始往回走，同样不改变方向。一旦我们回到新加坡，这一次我们要向西看？奇怪…不相信我？自己试试吧，拿个指南针开始游吧…

这个问题是由于球体的曲率造成的，我们将“四处移动而不改变方向”称为**平行运输**。你看到平行传输非常依赖于球体上的路径。然而，在二维平面上，这无关紧要。你可以走每一条路而不改变方向，并且一旦你回来就有相同的方向。因此，我们说平面是**可平行化的**(一旦你返回，你的方向向量保持平行)，而球体不是。

你可以看到这是我们 CNN 在一个球体上的问题。如果我们在所有地图上以不同的方式移动 CNN，方向似乎会改变。我们需要找到一种方法来确保这种怪异不会影响我们的结果！或者说，至少要知道怎么处理。

# 毛茸茸的球

在找到解决方案之前，我们必须引入更多的数学概念。指南针可以被看作是平面上指向某个方向的向量，主要是指向北方。指针旋转的这个平面与地球表面相切，我们称之为地球在该点的**切向空间**。即使地球是圆的，切空间也是完全平坦的。它就像一个本地**坐标系**，以北方和东方为其**坐标向量**。而且，我们可以在地球上的任何一个地方拿出指南针，每个地方都有自己的切线空间。但是我们也可以定义 40 和 130 为坐标向量。在这种情况下，北和其他方向没有什么特别，选择是任意的。

现在，让我们在切空间中选择任意方向，然后向前一步。我们确保选择最短的路径(**测地线**)并在一个新的点结束。你可能会称之为“前进”，但为了混淆每个人，我们将把这个过程称为**指数图**(它来自于所有这些微小的步骤神奇地类似于指数函数的级数展开……但现在这并不重要)。

让我们再看看我们的指南针。指南针给地球上“每一个”点分配一个矢量的事实被称为**(正切)矢量场**。风也可以被视为一个矢量场，因为它为每个点指定一个方向。我特意把“每”放在引号里，因为当你直接站在磁北极或磁南极时，罗盘指针会出问题。事实上，对于球面上每一个非零的连续向量场都是错误的。我们*必须*在球体上的磁场中有磁极。这种现象被称为毛球定理，因为它类似于无法在不创建旋转的情况下梳理毛球:

![](img/0f04067b6334cf579b1af30e063116e3.png)

(Image from Wikipedia)

向量场不需要和切空间有相同的维数。相反，它们可以在每个点上有自己的任意维数的矢量空间**。这很重要，因为我们还希望能够给地球上的每个点分配 3-D 或 99-D 向量，而不仅仅是 2-D 方向。在场的每个点处的这个向量空间也被称为**纤维**。**

(一种特殊类型的字段是**标量字段**。它只有一个维度，温度可以被视为这样的标量场)

# 测量

各地测量温度的方法不同。在德国，我们用摄氏度。在美国他们使用华氏温度。这种选择被称为**标尺**。是的，这个词来源于测量仪器。现在，当我阅读美国的天气预报时，我必须计算华氏温度在摄氏温度中的含义。我们有不同的**参照系**。这个计算叫做**规范变换**。请注意，实际的温度并没有改变，只是我们用来理解它的值改变了，转换是一个简单的线性函数。

如果我们看向量场，比如风向，事情会变得更复杂。让我们假设有一个国家，Gaugeland，它并不在乎南北，它有自己的方向系统，基于星座或者刺猬害怕时的方向。当这些人描述风时，我们必须执行一个规范转换来理解他们所说的方向。现在，规范变换变成了乘以一个**可逆矩阵**(显然它必须双向进行)。这组矩阵称为****一般线性群**或 **GL** 。**

**对于一个理论上平坦的地球来说，风的规格的选择可以是全球性的。但是在球体上，我们会遇到问题。我们不能定义一个单一的全局量规，而是必须依赖多个量规和地图。从我们在球面上的平行化问题和毛球定理，我们应该有一些直觉，为什么一定是这样。**

**这自然意味着，我们需要多个风地图。然而，我们不再允许所有的 Gaugeland 的诡计，并要求至少他们使用的矢量(风速)的大小必须与我们的相同。我们只允许他们使用不同的方向。因此，每次规范变换都简化为一次旋转。这些变换也形成一个组，即**特殊正交组**或 **SO** ，它是 GL 的一个子组。通过选择不同的**结构群**，我们有效地**减少了**我们规范理论所允许的变换。**

# ****回到深度学习****

**我们回到最初的问题，想对一个风向矢量场进行卷积。这里，风表示输入要素。假设我们想要找到龙卷风的方向作为输出。我们可以在“小块”上执行卷积，从风向中提取这些输出特征。(*注:我不知道这是否有气象意义…输入向量到输出向量...这就是我们需要知道的一切***

**但是“小补丁”是一个非常模糊的描述。在 2-D 平面上，很简单，我们可以把所有的东西都放在一个小球的中心。在某种程度上，这也适用于完美的球体。但是在任意流形上呢？事情变得棘手。看看这个时髦的流形:**

**![](img/383ecaffb0ce56d77df914f7cd8274f8.png)**

**(Image from Wikipedia)**

**它被称为克莱因瓶，我们可以看到，点之间的原始距离是…有问题的。我们可能永远不会需要克莱因瓶来进行深度学习，但我们希望尽可能保持事物的普遍性。**

**我们需要的是一种方法，只包括在流形上附近的卷积中的点。我们确实有办法做到这一点。回想一下，指数地图在我们的流形上做微小的移动来寻找附近的点。所以让我们利用这一点。从中心开始，我们在切线空间允许的每个方向上前进一步，并将该点包含在我们的卷积中。**

**我们现在只需要一些函数来做卷积。所以，我们定义了一个**内核**，它给每个点分配一个矩阵-…等等，不，我们用指数图去切空间的每个方向。这有点奇怪，但当你观察经典二维卷积时，它实际上也是如此。只是没那么明显，因为它在飞机上。**

**这个矩阵乘以一个输入向量并产生一个输出向量。在这里，作者确定了第一个问题。这个矩阵只为中心定义。但是我们将它应用于附近点的场矢量，它们有自己奇怪的属性。在平面上，这不是问题，但是在我们的球体上，它们略有不同，我们不能只应用内核。**

**让我们解决这个问题，将这些点上的向量平行传输回我们的小面片的中心。在这里，我们可以应用我们的矩阵，而不必担心怪异的曲率问题。**

# **规范等方差**

**到目前为止，我们定义的卷积似乎是合理的。我们将我们的内核应用到风数据中，得到了一个很好的结果:龙卷风向东移动*。但不知何故，我们还是得到了与高格兰德不同的结果？他们预测龙卷风正在移动*刺猬-左*？***

***啊，是的:我们需要测量将他们的结果转换到我们的框架中，瞧:他们预测龙卷风将向西移动..。还是错了...***

***发生了什么事？我们忘了使我们的卷积**规范等变**。简而言之，内核的结果必须依赖于所选择的规范和变换。如果没有，我们只会得到奇怪的结果，无法相互关联或比较。***

***但是输出向量可能与输入向量有不同的维度或不同的解释，我们如何将输入向量的规范变换与输出向量的等变“规范变换”联系起来呢？因为结构组只作用于输入，所以想法是找到作用于输出向量的同一个组的一个**表示**。例如，以旋转组作为其结构组的 2-D 输入向量的变换可以由绕单个轴旋转的 3-D 输出向量来表示。当二维向量旋转时，三维输出也绕固定轴旋转。一般来说，可以有许多表示，就像在三维空间中可以有许多不同的旋转轴。关键是，它做一些表示相同动作的事情。***

***有了表象的概念，我们可以使卷积规范等变。我们只需要确保输入向量的规范变换导致输出向量的等变变换(即，相同的变换，但是在适当的表示中)。***

***现在，使用规范等方差，当我们在不同的图上执行卷积时，我们在数值上得到不同的结果，但是它们的结果是一致的。这是我们定义卷积在整个球面上有意义的最好方法。***

# ***二十面体？***

***我们基本上涵盖了论文的第 2 部分。作者现在转向二十面体，它在拓扑学上与球体非常相似，但更好。它们更好，因为我们可以比球体更容易地将它们离散化。***

***就像我们用多张地图覆盖地球一样，让我们用 5 张重叠的地图覆盖二十面体(重叠部分由微小的全白三角形表示):***

***![](img/d7c0cde59d2ef48afdc3a09b5a3b076a.png)***

***(Image from the paper)***

***漂亮，地图甚至是同样的大小。难怪他们选择这个流形。我们也可以把它看作一个图表。请注意，每个节点(即每个交叉点)都是流形上具有输入特征向量的点(在上图中不可见)。每个小三角形有三个角，每个角是这些节点中的一个。我们对它们感兴趣。***

***所以，我们来做卷积吧！***

***首先，我们需要看看我们的指数图是什么样的。在我们的离散流形上，这很简单。我们只是从一个节点开始，向任何方向走一步。在上面的图像中，连接节点的线表示方向。所以，大多数节点都有 **6 个邻居**，除了那些在二十面体角落的节点，它们有 5 个邻居。***

***接下来，我们需要一个内核函数。但是我们懒，不想多此一举。因此，我们将使用来自标准 2D 卷积的 **3 x 3 滤波器**。这些 3×3 滤波器有一个中心点和 8 个邻居。那比我们需要的多。因此，让我们忽略 3 x 3 网格中的右上和左下邻居，将它们设置为 0，并假设它只有 6 个邻居。***

***剩下的就是让这个东西规范等变。好，让我们看看我们的二十面体的结构群。我们已经注意到，我们只能去 6 个不同的方向。如果我们要描述这个结构上的风，我们只有 6 个不同的参照系，每个都旋转 60 度。这也可以被公式化为具有 6 阶的**循环群，或 **C6** 作为其结构群。*****

***最后，我提到我们的地图是重叠的。因此，如果我们想要在有重叠的区域上移动卷积滤波器，我们基本上是使用来自不同映射的值。我们如何利用这些价值呢？在使用它们之前，我们把它们转换成正确的框架。瞧，我们在二十面体上做卷积。***

# ***结论***

***在我看来，这篇论文为几何深度学习领域提供了一个基础性的结果。在进行卷积时，理解规范等变的整体思想和重要性是这里的主要收获。***

***我希望我的非数学解释有助于理解论文中提出的观点。如果你觉得这类东西很有趣，想要核心的数学，一定要看看中原的《几何、拓扑和物理》。***