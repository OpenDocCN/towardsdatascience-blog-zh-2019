<html>
<head>
<title>Intro to Geographical Plotting</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">地理绘图介绍</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/intro-to-geographical-plotting-237f59fec735?source=collection_archive---------8-----------------------#2019-12-04">https://towardsdatascience.com/intro-to-geographical-plotting-237f59fec735?source=collection_archive---------8-----------------------#2019-12-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8dfe" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated"><em class="ki">使用 Python </em>在任意地图上可视化 gT5】eographicT7】数据</h2></div><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/ac11777f2fe8ad4b9a6ab8adb9d7911a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-f7bOZCHCRwQdCJO"/></div></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk">Photo by <a class="ae kz" href="https://unsplash.com/@kelsoknight?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Kelsey Knight</a> on <a class="ae kz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="5a7e" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi lw translated"><span class="l lx ly lz bm ma mb mc md me di">在</span> <em class="mf">数据科学领域，我们经常致力于将数据可视化，这为我们提供了关于数据的清晰模式，并使其易于分析。幸运的是，python 为此提供了强大的数据可视化工具。此外，可视化世界各地或任何特定国家的基于地图的数据会更有趣，这给了我们关于地理数据的很酷的见解。地理地图很重要，因为它们为我们的数据值提供了背景。</em></p><blockquote class="mg mh mi"><p id="3ec5" class="la lb mf lc b ld le ju lf lg lh jx li mj lk ll lm mk lo lp lq ml ls lt lu lv im bi translated">所以，让我们来看看 Python 的<strong class="lc iu">交互式可视化</strong>工具— <code class="fe mm mn mo mp b">plotly</code>。使用 Plotly，我们可以从地理数据中创建美丽的 Choropleth 地图。</p></blockquote><h2 id="7fdc" class="mq mr it bd ms mt mu dn mv mw mx dp my lj mz na nb ln nc nd ne lr nf ng nh ni bi translated">Choropleth 地图:</h2><blockquote class="nj"><p id="4b8f" class="nk nl it bd nm nn no np nq nr ns lv dk translated">Choropleth maps 帮助我们绘制出全球或全国范围的信息。它让我们看到某个变量是如何在一个区域内分布的。在这篇博客中，我们将重点介绍如何使用<code class="fe mm mn mo mp b"><strong class="ak">plotly</strong></code>绘制 choropleth 地图。</p></blockquote><h2 id="fa6a" class="mq mr it bd ms mt nt dn mv mw nu dp my lj nv na nb ln nw nd ne lr nx ng nh ni bi translated"><strong class="ak">阴谋地</strong></h2><blockquote class="nj"><p id="8c5b" class="nk nl it bd nm nn no np nq nr ns lv dk translated">Plotly 是一个开源库，它允许我们创建可用于仪表盘或网站的交互式绘图。Plotly 也是一家<a class="ae kz" href="https://plot.ly/" rel="noopener ugc nofollow" target="_blank">公司</a>，支持在线和离线托管数据可视化。现在让我们使用离线模式，因为它是开源的，并且它使得在我们的 Python Jupyter 笔记本中工作变得容易。</p></blockquote><blockquote class="mg mh mi"><p id="bff9" class="la lb mf lc b ld ny ju lf lg nz jx li mj oa ll lm mk ob lp lq ml oc lt lu lv im bi translated">由于数据格式多样，使用 plotly 进行地理绘图起初有点困难，因此请参考此<a class="ae kz" href="https://images.plot.ly/plotly-documentation/images/python_cheat_sheet.pdf" rel="noopener ugc nofollow" target="_blank">备忘单</a>了解所有类型的<code class="fe mm mn mo mp b">plotly</code>绘图的语法。</p></blockquote><p id="72fd" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">让我们从下面的例子开始理解这个概念…</p><h2 id="21ed" class="mq mr it bd ms mt mu dn mv mw mx dp my lj mz na nb ln nc nd ne lr nf ng nh ni bi translated"><strong class="ak">来自 Kaggle 的数据集:</strong></h2><p id="9d3f" class="pw-post-body-paragraph la lb it lc b ld od ju lf lg oe jx li lj of ll lm ln og lp lq lr oh lt lu lv im bi translated">让我们找出全球以及全国范围内的星巴克门店，并使用 choropleth 地图将这些数据可视化。数据集(directory.csv)可以从<a class="ae kz" href="https://www.kaggle.com/starbucks/store-locations" rel="noopener ugc nofollow" target="_blank">这里</a>下载。<em class="mf">该数据集包括截至 2017 年 2 月目前正在运营的每家星巴克门店的记录。</em></p><p id="08d2" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated"><strong class="lc iu">我们将经历以下步骤:</strong></p><ol class=""><li id="cfcb" class="oi oj it lc b ld le lg lh lj ok ln ol lr om lv on oo op oq bi translated">导入所有的库，并将我们的 Jupyter 笔记本设置为脱机模式。</li><li id="c800" class="oi oj it lc b ld or lg os lj ot ln ou lr ov lv on oo op oq bi translated">使用 pandas 将星巴克数据提取到 Dataframe。</li><li id="7f2b" class="oi oj it lc b ld or lg os lj ot ln ou lr ov lv on oo op oq bi translated">为“美国国家”创建“<strong class="lc iu">数据</strong>和“<strong class="lc iu">布局</strong>对象，并绘制 choropleth 地图。</li><li id="b0ef" class="oi oj it lc b ld or lg os lj ot ln ou lr ov lv on oo op oq bi translated">为“全球”创建“<strong class="lc iu">数据</strong>和“<strong class="lc iu">布局</strong>对象，并绘制 choropleth 地图。</li></ol><p id="7734" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">让我们先把<code class="fe mm mn mo mp b">plotly</code>安装到 Jupyter 笔记本上</p><pre class="kk kl km kn gt ow mp ox oy aw oz bi"><span id="41bf" class="mq mr it mp b gy pa pb l pc pd">pip install plotly</span></pre><p id="281a" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated"><strong class="lc iu">第一步:</strong></p><pre class="kk kl km kn gt ow mp ox oy aw oz bi"><span id="dc86" class="mq mr it mp b gy pa pb l pc pd">import plotly.plotly as py <br/>import plotly.graph_objs as go #importing graphical objects<br/>from plotly.offline import download_plotlyjs, init_notebook_mode, plot, iplot</span></pre><p id="6ad6" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated"><code class="fe mm mn mo mp b">download_plotlyjs</code>允许 plotly 在离线模式下工作。<br/> <code class="fe mm mn mo mp b">init_notebook_mode</code>将 Javascript 连接到我们的笔记本。</p><p id="35be" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">第二步:</p><pre class="kk kl km kn gt ow mp ox oy aw oz bi"><span id="3bdb" class="mq mr it mp b gy pa pb l pc pd">import pandas as pd<br/>df = pd.read_csv('directory.csv')</span></pre><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi pe"><img src="../Images/e4abab02820cf0c4c17a7ec561d35ac1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C0KASSn0EYEjptnwQvXa6A.png"/></div></div></figure><p id="ce9b" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在进入第 3 步之前，让我们快速执行以下任务:</p><p id="d682" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">☑从上述数据集中获取子集数据(美国国家数据),并将其分配给新的数据框。<br/> ☑向数据集添加了一个新列——“商店计数”，以获得每个州的商店总数。</p><pre class="kk kl km kn gt ow mp ox oy aw oz bi"><span id="7ae0" class="mq mr it mp b gy pa pb l pc pd">df_US = df[df['Country'] == 'US']</span></pre><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi pf"><img src="../Images/25d0ec66f0a54fa2f1367afd8df6cc1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zm-B_MJECelIBWIEsBRr6Q.png"/></div></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk">13608 entries for ‘US’ country</figcaption></figure><p id="0e1c" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">现在，要向数据框架添加新列“商店数量”，我们可以在“州/省”列上使用<code class="fe mm mn mo mp b">groupby()</code>,如下所示</p><pre class="kk kl km kn gt ow mp ox oy aw oz bi"><span id="cde2" class="mq mr it mp b gy pa pb l pc pd">df_US['Store Count'] = df_US['Store Number'].groupby(df_US['State/Province']).transform('count')</span></pre><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi pg"><img src="../Images/00fa2f9d32e19b33f5d21497d2dde8a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uFGCDuBJxMXO7xnpwAz39Q.png"/></div></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk">State ‘AK’ has a total of 49 stores</figcaption></figure><pre class="kk kl km kn gt ow mp ox oy aw oz bi"><span id="d507" class="mq mr it mp b gy pa pb l pc pd">df_US[df_US['State/Province'] == 'CA'][['State/Province','Store Count']].head(1)  # to check num of stores in 'California'</span></pre><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi ph"><img src="../Images/2ac87e8438766839a318c1a021ff4fc1.png" data-original-src="https://miro.medium.com/v2/resize:fit:772/format:webp/1*HGD_nCLJCOcc-_M4YiUeLQ.png"/></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk">‘CA’ has a total of 2821 stores</figcaption></figure><p id="76a2" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated"><strong class="lc iu">第三步:</strong>绘制<strong class="lc iu"> ' </strong>美国国家地图</p><p id="9de3" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">让我们定义我们的'<strong class="lc iu">数据</strong>和'<strong class="lc iu">布局</strong>对象如下:</p><pre class="kk kl km kn gt ow mp ox oy aw oz bi"><span id="398d" class="mq mr it mp b gy pa pb l pc pd"><strong class="mp iu">data</strong> = dict(type='choropleth',<br/>            locations = df_US['State/Province'],<br/>            locationmode = 'USA-states',<br/>            colorscale = 'Reds',<br/>            text = df_US['Brand'],<br/>            z = df_US['Store Count'],<br/>            colorbar = {'title':"Stores Count"}<br/>            )</span></pre><p id="e50e" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated"><code class="fe mm mn mo mp b">type</code>:定义地图的类型(choropleth) <br/> <code class="fe mm mn mo mp b">locations</code>:所有州的名称<br/> <code class="fe mm mn mo mp b">locationmode</code>:通过给出国家名称<br/> <code class="fe mm mn mo mp b">colorscale</code>来指定位置:显示彩色地图。<em class="mf">(更多色阶请参考下文)</em> <br/> <code class="fe mm mn mo mp b">text</code>:悬停在地图上时显示每个状态元素<br/> <code class="fe mm mn mo mp b">z</code>的文本:显示每个状态元素<br/> <code class="fe mm mn mo mp b">colorbar</code>的“商店计数”的整数值:【右侧栏标题】</p><blockquote class="nj"><p id="9b32" class="nk nl it bd nm nn no np nq nr ns lv dk translated">colorscales: <br/> ['灰色'，' YlGnBu '，'绿色'，' YlOrRd '，'蓝色'，' RdBu '，<br/>'红色'，'蓝色'，'野餐'，'彩虹'，'波特兰'，'喷气机'，【T41 '，'热'，'黑体'，'地球'，'电'，'绿色'，'公民']</p></blockquote><pre class="pi pj pk pl pm ow mp ox oy aw oz bi"><span id="34a3" class="mq mr it mp b gy pa pb l pc pd"><strong class="mp iu">layout</strong> = dict(title = 'Starbucks locations in USA Map',<br/>              geo = dict(scope='usa')<br/>             )</span></pre><p id="0686" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">现在，我们可以使用<code class="fe mm mn mo mp b">go.Figure()</code>方法为地图创建一个对象，然后使用<code class="fe mm mn mo mp b">iplot()</code>方法生成绘图</p><pre class="kk kl km kn gt ow mp ox oy aw oz bi"><span id="c02d" class="mq mr it mp b gy pa pb l pc pd">choromap = go.Figure(data = [data],layout = layout)<br/>iplot(choromap)</span></pre><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi pn"><img src="../Images/faaf9cb99ce17b5dce25dd9f186b52d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*iUmYxBwAP2mWZD--FRaoBg.gif"/></div></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk">Interactive Choropleth map for ‘US’ country[Image by Author]</figcaption></figure><p id="6a08" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">酷！我们的“美国”国家 choropleth 地图已经生成，从上面我们可以看到，当鼠标悬停在地图上的每个元素上时，每个州都会显示文本、商店数量和州名，数据越集中在一个特定区域，地图上的颜色就越深。这里的“加州”有更多的商店(2821)，所以颜色很深。</p><p id="a575" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">类似于 Choropleth 地图，我们有另一个很酷的交互式地图，叫做“散点图”。</p><blockquote class="mg mh mi"><p id="793b" class="la lb mf lc b ld le ju lf lg lh jx li mj lk ll lm mk lo lp lq ml ls lt lu lv im bi translated"><strong class="lc iu">“散点图”</strong>提供地图上的每个数据点(表示为标记点)以及由 x(经度)和 y(纬度)列表示的位置。</p></blockquote><p id="1162" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated"><em class="mf">我们可以使用数据集中的列“经度”和“纬度”来生成散点图。</em></p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi po"><img src="../Images/54fa018079afe78d6f092c7b54f89140.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pfh_28IjIo8xQvwxCsbCqQ.png"/></div></div></figure><p id="5e44" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">让我们使用下面的代码创建一个散点图。</p><pre class="kk kl km kn gt ow mp ox oy aw oz bi"><span id="5047" class="mq mr it mp b gy pa pb l pc pd"><strong class="mp iu">data</strong> = go.Scattergeo(<br/>        lon = df_US['Longitude'],<br/>        lat = df_US['Latitude'],<br/>        text = df_US['text'],<br/>        mode = 'markers',<br/>        marker = dict(symbol = 'star',size=5,colorscale = 'Reds'<br/>                      ),<br/>        marker_color = df_US['Store Count'],<br/>        )<br/><strong class="mp iu">layout</strong> = dict(title = 'Starbucks locations in USA Map',<br/>              geo_scope = 'usa'<br/>             )<br/>choromap = go.Figure(data = [data],layout = layout)<br/>iplot(choromap)</span></pre><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi pp"><img src="../Images/492d7faabf41b5b40e9e1750d43ad8e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NGSXFmqD8Z291QHDE-nkyQ.png"/></div></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk">‘Star’ markers represent store locations for each state[Image by Author]</figcaption></figure><p id="8e0a" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated"><strong class="lc iu">第四步:</strong>绘制<strong class="lc iu"> ' </strong>世界地图</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi pq"><img src="../Images/86895426219376b8d78e94efdfae0b84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rTIGUg_t3Oz0TS6sUV157g.png"/></div></div></figure><p id="5081" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">像我们之前做的那样，添加了一个新列“商店数量”。此外，我还在数据集“国家代码”中添加了一列，其中包含 ISO 3(3 位数)代码。</p><p id="95b5" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">下面是创建 choropleth 世界地图的代码...</p><pre class="kk kl km kn gt ow mp ox oy aw oz bi"><span id="5a9f" class="mq mr it mp b gy pa pb l pc pd"><strong class="mp iu">data</strong> = dict(<br/>        type = 'choropleth',<br/>        locations = df['CountryCode'],<br/>        z = df['Store Count'],<br/>        text = df['Brand'],<br/>        colorbar = {'title' : 'Starbucks Stores - World Wide'},<br/>      )<br/><strong class="mp iu">layout</strong> = dict(<br/>    title = 'Stores Count',<br/>    geo = dict(<br/>            showframe = False,<br/>            projection = {'type':'natural earth'}<br/>    )<br/>)<br/>choromap = go.Figure(data = [data],layout = layout)<br/>iplot(choromap)</span></pre><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi pr"><img src="../Images/f24838316dcd5a7b770d277e53284ea9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KL1ZF6rO_ZWYurWGtJ7wjg.png"/></div></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk">Sample screenshots represent stores count in India and Australia[Image by Author]</figcaption></figure></div><div class="ab cl ps pt hx pu" role="separator"><span class="pv bw bk pw px py"/><span class="pv bw bk pw px py"/><span class="pv bw bk pw px"/></div><div class="im in io ip iq"><p id="c7bd" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我们的地理数据可视化部分到此结束。请查看<code class="fe mm mn mo mp b">plotly</code>地图<a class="ae kz" href="https://plot.ly/python/maps/" rel="noopener ugc nofollow" target="_blank">官方页面</a>查看更多有趣的剧情类型。</p><p id="f42f" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我希望这篇文章对你有用，请在下面的评论区分享你的评论/反馈。谢谢大家！！</p></div></div>    
</body>
</html>