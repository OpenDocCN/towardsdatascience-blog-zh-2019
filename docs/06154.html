<html>
<head>
<title>Bar Chart Race in Python with Matplotlib</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 Matplotlib 实现 Python 中的条形图竞赛</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/bar-chart-race-in-python-with-matplotlib-8e687a5c8a41?source=collection_archive---------1-----------------------#2019-09-06">https://towardsdatascience.com/bar-chart-race-in-python-with-matplotlib-8e687a5c8a41?source=collection_archive---------1-----------------------#2019-09-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8bfe" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated"><em class="ki">~在大约不到 50 行的代码中</em></h2></div><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/d17c10815399e7829990140b4f82ac6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*74tnx8EfAsL-ZQ7yD5erJQ.gif"/></div></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk">Bar Chart Race animation showing the 10 biggest cities in the world</figcaption></figure><p id="7877" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="lv">原载于</em><a class="ae lw" href="https://pratapvardhan.com/blog/bar-chart-race-python-matplotlib/" rel="noopener ugc nofollow" target="_blank"><em class="lv">pratapvardhan.com</em></a></p><p id="1c74" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">条形图比赛已经有一段时间了。今年，他们席卷了社交媒体。它始于马特·纳瓦拉的推特，这条推特被点击了 1000 万次。然后，<a class="ae lw" href="https://twitter.com/jburnmurdoch/status/1107552367795412992" rel="noopener ugc nofollow" target="_blank"> John Burn-Murdoch </a>使用 d3.js 创建了可复制的<a class="ae lw" href="https://observablehq.com/@johnburnmurdoch/bar-chart-race-the-most-populous-cities-in-the-world" rel="noopener ugc nofollow" target="_blank">笔记本</a>，其他人开始创建他们的种族。然后，fluorescent studio 发布了面向非程序员的<a class="ae lw" href="https://app.flourish.studio/@flourish/bar-chart-race" rel="noopener ugc nofollow" target="_blank">赛程图</a>。从那以后，数百场比赛在互联网上被分享。</p><h1 id="fda1" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">与 Matplotlib 竞赛</h1><p id="2fce" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li mr lk ll lm ms lo lp lq mt ls lt lu im bi translated">我想知道——用 Jupyter 和 Matplotlib 用 Python 重新制作 JBM 的<a class="ae lw" href="https://twitter.com/jburnmurdoch/status/1107552367795412992" rel="noopener ugc nofollow" target="_blank">版本</a>有多容易？事实证明，在不到 50 行代码中，您可以使用 Matplotlib 在 Python 中合理地重新创建可重用的条形图比赛。</p><p id="93ec" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是我们想要创造的。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/d17c10815399e7829990140b4f82ac6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*74tnx8EfAsL-ZQ7yD5erJQ.gif"/></div></div></figure><h1 id="c0ce" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">让我们编码</h1><p id="c235" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li mr lk ll lm ms lo lp lq mt ls lt lu im bi translated">现在，您已经看到了输出，我们将逐步构建它。</p><p id="e9d2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">的默认风格是为许多常见的情况设计的，但对我们的审美来说绝不是最佳的。因此，我们的大部分代码将进入样式(轴，文本，颜色，刻度等)</p><p id="7af6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在您的<code class="fe mu mv mw mx b">Jupyter</code>笔记本中，导入相关库。</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="8ebb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">用<code class="fe mu mv mw mx b">pandas</code>阅读<a class="ae lw" href="https://gist.githubusercontent.com/johnburnmurdoch/4199dbe55095c3e13de8d5b2e5e5307a/raw/fa018b25c24b7b5f47fd0568937ff6c04e384786/city_populations" rel="noopener ugc nofollow" target="_blank">城市人口数据集</a>。我们只需要 4 列来与<code class="fe mu mv mw mx b">'name', 'group', 'year', 'value'</code>一起工作。典型地，一个<code class="fe mu mv mw mx b">name</code>映射到一个<code class="fe mu mv mw mx b">group</code>(城市到洲/国家)，每个<code class="fe mu mv mw mx b">year</code>有一个<code class="fe mu mv mw mx b">value</code>。</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="my mz l"/></div></figure><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi na"><img src="../Images/3bdad412ca74a9fc25e277ac6809b489.png" data-original-src="https://miro.medium.com/v2/resize:fit:416/format:webp/1*Le-8ycvOC2brPmaOd5bR_Q.png"/></div></div></figure><h1 id="e46f" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">数据转换</h1><p id="8581" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li mr lk ll lm ms lo lp lq mt ls lt lu im bi translated">我们很有兴趣看到前 10 名<code class="fe mu mv mw mx b">value</code>是给定的<code class="fe mu mv mw mx b">year</code>。使用熊猫变换，我们将得到最高的<code class="fe mu mv mw mx b">10</code>值。</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="my mz l"/></div></figure><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/8b089cce8bbaf1327eee9ffc4b86a6ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:598/format:webp/1*au-abtsivdvTu8S0sH6mnA.png"/></div></figure><h1 id="8b68" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">基本图表</h1><p id="50f8" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li mr lk ll lm ms lo lp lq mt ls lt lu im bi translated">现在，让我们绘制一个基本的条形图。我们首先创建一个图形和一个轴。然后，我们使用<code class="fe mu mv mw mx b">ax.barh(x, y)</code>绘制水平条形图。</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="my mz l"/></div></figure><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nc"><img src="../Images/dfdb60e8690972b98eeac8fd6654cef1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dbWqF43CK7B5SxIhrJ1hkQ.png"/></div></div></figure><p id="9e5d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意，最高的横条在底部。我们需要扭转这种局面。</p><h1 id="e355" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">颜色，标签</h1><p id="e685" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li mr lk ll lm ms lo lp lq mt ls lt lu im bi translated">接下来，让我们基于组添加值、组标签和颜色。我们将使用<code class="fe mu mv mw mx b">colors</code>和<code class="fe mu mv mw mx b">group_lk</code>来给条形添加颜色。</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="bf4c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe mu mv mw mx b">group_lk</code>是<code class="fe mu mv mw mx b">name</code>和<code class="fe mu mv mw mx b">group</code>值之间的映射。</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="my mz l"/></div></figure><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nd"><img src="../Images/b28d9efdc4ee166ae9f8476cb0cd493a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WY2J2sq4kt6VrjojMv_zOA.png"/></div></div></figure><p id="b6f5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们只剩下设计图表的样式了。</p><h1 id="8743" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">波兰式</h1><p id="7cc2" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li mr lk ll lm ms lo lp lq mt ls lt lu im bi translated">为了方便起见，让我们将代码移到<code class="fe mu mv mw mx b">draw_barchart</code>函数中。</p><p id="0045" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们需要以下项目的风格:</p><ul class=""><li id="18f0" class="ne nf it lb b lc ld lf lg li ng lm nh lq ni lu nj nk nl nm bi translated">文本:更新字体大小、颜色、方向</li><li id="8b48" class="ne nf it lb b lc nn lf no li np lm nq lq nr lu nj nk nl nm bi translated">轴:移动 X 轴到顶部，添加颜色和字幕</li><li id="30cd" class="ne nf it lb b lc nn lf no li np lm nq lq nr lu nj nk nl nm bi translated">网格:在横条后添加线条</li><li id="c8f9" class="ne nf it lb b lc nn lf no li np lm nq lq nr lu nj nk nl nm bi translated">格式:逗号分隔的值和轴标记</li><li id="9c3e" class="ne nf it lb b lc nn lf no li np lm nq lq nr lu nj nk nl nm bi translated">添加标题、致谢名单、装订线空间</li><li id="c836" class="ne nf it lb b lc nn lf no li np lm nq lq nr lu nj nk nl nm bi translated">移除:方框、y 轴标签</li></ul><p id="6440" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将为此再添加十几行代码。</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="my mz l"/></div></figure><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi ns"><img src="../Images/4de83fe2713a02cf922f421568fe2de8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SAZ3ZzGRgkIjTHXRfmqfyg.png"/></div></div></figure><p id="1f4b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们现在有一个相同的图表。</p><h1 id="5b36" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">动画种族</h1><p id="98ca" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li mr lk ll lm ms lo lp lq mt ls lt lu im bi translated">为了制作比赛的动画，我们将使用<code class="fe mu mv mw mx b">matplotlib.animation</code>中的<code class="fe mu mv mw mx b"><a class="ae lw" href="https://matplotlib.org/3.1.1/api/_as_gen/matplotlib.animation.FuncAnimation.html" rel="noopener ugc nofollow" target="_blank">FuncAnimation</a></code>。<code class="fe mu mv mw mx b"><a class="ae lw" href="https://matplotlib.org/3.1.1/api/_as_gen/matplotlib.animation.FuncAnimation.html" rel="noopener ugc nofollow" target="_blank">FuncAnimatio</a></code>通过反复调用一个函数(在画布上绘制)来创建动画。在我们的例子中，这个函数将是<code class="fe mu mv mw mx b">draw_barchart</code>。我们也使用<code class="fe mu mv mw mx b">frames</code>，这个参数接受你想要运行<code class="fe mu mv mw mx b">draw_barchart</code>的值——我们将从<code class="fe mu mv mw mx b">year</code> 1968 运行到 2018。</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="my mz l"/></div></figure><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/d17c10815399e7829990140b4f82ac6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*74tnx8EfAsL-ZQ7yD5erJQ.gif"/></div></div></figure><p id="8285" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们有了它，用 matplotlib 在笔记本中进行条形图竞赛。</p><p id="c926" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以将<code class="fe mu mv mw mx b">animator</code>对象保存为视频/gif 或在笔记本中播放。</p><h1 id="a423" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">奖金:xkcd 式！</h1><p id="f1ae" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li mr lk ll lm ms lo lp lq mt ls lt lu im bi translated">将 matplotlib 图转换成 xkcd 风格的图非常容易。您可以使用<code class="fe mu mv mw mx b">plt.xkcd</code>简单地打开<code class="fe mu mv mw mx b">xkcd</code>草图风格绘图模式。</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="my mz l"/></div></figure><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nt"><img src="../Images/b33a1607afedd98bd4701fb8d01c3e11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D1PY_oxcKSBwLrHJzyBlmA.png"/></div></div></figure><p id="6d3c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里是动画 xkcd 风格的条形图比赛。</p><h1 id="96bb" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">自己动手</h1><p id="bd92" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li mr lk ll lm ms lo lp lq mt ls lt lu im bi translated">比赛动画的完整代码在这里<a class="ae lw" href="https://github.com/pratapvardhan/notebooks/blob/master/barchart-race-matplotlib.ipynb" rel="noopener ugc nofollow" target="_blank"/>，你也可以在谷歌实验室上玩它<a class="ae lw" href="https://colab.research.google.com/github/pratapvardhan/notebooks/blob/master/barchart-race-matplotlib.ipynb" rel="noopener ugc nofollow" target="_blank">。尝试更改数据集、颜色并分享您的比赛。</a></p><p id="6041" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Matplotlib 是一个巨大的库——能够调整绘图的每个方面是非常强大的，但对于高度定制的图表来说，这可能很复杂/耗时。至少，对于这些条形图比赛，这是相当快！</p></div></div>    
</body>
</html>