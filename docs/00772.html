<html>
<head>
<title>Missing value visualization with tidyverse in R</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">R 中 tidyverse 的值可视化缺失</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/missing-value-visualization-with-tidyverse-in-r-a9b0fefd2246?source=collection_archive---------11-----------------------#2019-02-05">https://towardsdatascience.com/missing-value-visualization-with-tidyverse-in-r-a9b0fefd2246?source=collection_archive---------11-----------------------#2019-02-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="45f9" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">关于如何使用 ggplot2、dplyr、tidyr 查找和可视化缺失数据的简短实用指南</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/3e080cd306b1d45cff29dc015c192fd9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*OXbrDwF5ifOtGPbO.jpg"/></div></div></figure><p id="dde1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在<a class="ae ln" href="https://en.wikipedia.org/wiki/Exploratory_data_analysis" rel="noopener ugc nofollow" target="_blank">探索性数据分析(EDA) </a>期间，寻找缺失值是一项重要任务。它们会影响机器学习模型的质量，需要在训练模型之前进行清理。通过检测缺失值，您还可以评估数据检索过程的质量。这个简短的实用指南将向您展示如何找到缺失的价值，并通过 tidyverse 生态系统将它们可视化。<a class="ae ln" href="https://www.tidyverse.org/" rel="noopener ugc nofollow" target="_blank"> tidyverse </a>是数据科学的 R 包集合。在他们的主页上写道“…所有的包共享一个潜在的设计哲学、语法和数据结构。”</p><h1 id="4013" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">数据集</h1><p id="42fa" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">该数据集是从一个电子商务网站上刮下来的，包含产品数据。您可以通过评估缺失值来检查数据检索的质量。具有大量缺失值的要素可能表明该要素的提取逻辑存在问题，或者数据由于其他原因而缺失。</p><pre class="kg kh ki kj gt ml mm mn mo aw mp bi"><span id="d2cc" class="mq lp iq mm b gy mr ms l mt mu">df %&gt;% <br/>   head(10)</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/a9850e6235406f738515729a665deb45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1008/format:webp/0*a-YhtzKsTJfOndFZ.png"/></div></figure><p id="77ab" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">数据集包含 11 个变量，共 2172 行。</p><h1 id="2d7b" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">缺少值的表</h1><p id="db04" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">您可以对数据集中每个要素的缺失值进行计数:</p><pre class="kg kh ki kj gt ml mm mn mo aw mp bi"><span id="3eba" class="mq lp iq mm b gy mr ms l mt mu">missing.values &lt;- df %&gt;%<br/>    gather(key = "key", value = "val") %&gt;%<br/>    mutate(is.missing = is.na(val)) %&gt;%<br/>    group_by(key, is.missing) %&gt;%<br/>    summarise(num.missing = n()) %&gt;%<br/>    filter(is.missing==T) %&gt;%<br/>    select(-is.missing) %&gt;%<br/>    arrange(desc(num.missing))</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/d1fd2caadba4438f7eaeca96298b9127.png" data-original-src="https://miro.medium.com/v2/resize:fit:1008/format:webp/0*lqTLWKh2egC3NMu3.png"/></div></figure><p id="0040" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">您可以使用 tidyr 的 gather 函数将列折叠成键值对。然后，创建一个新的逻辑特征，在缺少值的情况下该特征成立。您对键和新逻辑特征进行分组以进行计数。然后过滤逻辑特征以获得缺少值的计数。您跳过不需要的行，并根据缺少的值的数量进行排序。</p><h1 id="c174" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">可视化丢失的数据</h1><p id="bdf8" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated"><strong class="kt ir">表格</strong>及其行和列由我们的语言系统读取。这个系统非常慢。</p><p id="a4f2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir">图形</strong>与我们的视觉系统互动，比语言系统快得多。这就是为什么在大多数情况下你应该使用图表而不是表格的原因。</p><p id="377d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">您可以在 ggplot2 中用一个简单的条形图直观显示上面的聚合数据集:</p><pre class="kg kh ki kj gt ml mm mn mo aw mp bi"><span id="c453" class="mq lp iq mm b gy mr ms l mt mu">missing.values %&gt;%<br/>  ggplot() +<br/>    geom_bar(aes(x=key, y=num.missing), stat = 'identity') +<br/>    labs(x='variable', y="number of missing values", <br/>         title='Number of missing values') +<br/>    theme(axis.text.x = element_text(angle = 45, hjust = 1))</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/35563c020a604758363f4386a028129b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1008/format:webp/0*PzuROcMHv_HU2EB1.png"/></div></figure><p id="de67" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">您可以通过计算每个要素缺失值的百分比来改进该图。这样更有意义。通过交换轴可以改善视觉外观，使特征名称更具可读性。根据长度对条进行排序是另一个改进。正确的轴标签总是必须的。使用红色作为缺失值(=坏)的视觉提示是因为红色代表危险，你必须采取行动。</p><pre class="kg kh ki kj gt ml mm mn mo aw mp bi"><span id="0171" class="mq lp iq mm b gy mr ms l mt mu">missing.values &lt;- df %&gt;%<br/>  gather(key = "key", value = "val") %&gt;%<br/>  mutate(isna = is.na(val)) %&gt;%<br/>  group_by(key) %&gt;%<br/>  mutate(total = n()) %&gt;%<br/>  group_by(key, total, isna) %&gt;%<br/>  summarise(num.isna = n()) %&gt;%<br/>  mutate(pct = num.isna / total * 100)<br/></span><span id="ba52" class="mq lp iq mm b gy mw ms l mt mu">levels &lt;- (missing.values  %&gt;% filter(isna == T) %&gt;%     <br/>           arrange(desc(pct)))$key</span><span id="24e0" class="mq lp iq mm b gy mw ms l mt mu">percentage.plot &lt;- missing.values %&gt;%<br/>      ggplot() +<br/>        geom_bar(aes(x = reorder(key, desc(pct)), <br/>                     y = pct, fill=isna), <br/>                  stat = 'identity', alpha=0.8) +<br/>        scale_x_discrete(limits = levels) +<br/>        scale_fill_manual(name = "", <br/>                          values = c('steelblue', 'tomato3'), <br/>                          labels = c("Present", "Missing")) +<br/>        coord_flip() +<br/>        labs(title = "Percentage of missing values", <br/>             x = 'Variable', y = "% of missing values")</span><span id="bdaf" class="mq lp iq mm b gy mw ms l mt mu">percentage.plot</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/cd2577077199612a61fa4c43e7a7f466.png" data-original-src="https://miro.medium.com/v2/resize:fit:1008/format:webp/0*rjyYKOKJYHvQFD9X.png"/></div></figure><p id="f855" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在这个图中，您以与前面类似的方式汇总数据:不是计数，而是计算百分比。然后将数据链接到 ggplot 可视化部分。</p><p id="f5ab" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">该图显示您在产品尺寸(dim_x，dim_y，dim_z)的特征的抓取过程中遇到了问题:几乎 100%的值都丢失了。您可以看到 sales.rank、sales 和 reviews.count 有相同数量的缺失值。这些值似乎相互关联。</p><p id="8b4d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">您可以通过绘制数据集中的每一行来以另一种方式显示缺失值，以获得进一步的见解。</p><pre class="kg kh ki kj gt ml mm mn mo aw mp bi"><span id="1ece" class="mq lp iq mm b gy mr ms l mt mu">row.plot &lt;- df %&gt;%<br/>  mutate(id = row_number()) %&gt;%<br/>  gather(-id, key = "key", value = "val") %&gt;%<br/>  mutate(isna = is.na(val)) %&gt;%<br/>  ggplot(aes(key, id, fill = isna)) +<br/>    geom_raster(alpha=0.8) +<br/>    scale_fill_manual(name = "",<br/>        values = c('steelblue', 'tomato3'),<br/>        labels = c("Present", "Missing")) +<br/>    scale_x_discrete(limits = levels) +<br/>    labs(x = "Variable",<br/>           y = "Row Number", title = "Missing values in rows") +<br/>    coord_flip()</span><span id="10d4" class="mq lp iq mm b gy mw ms l mt mu">row.plot</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mx"><img src="../Images/5f867063ff7001bb65755282e3e52c37.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*BXVPytk_PiSa7Sv4.png"/></div></div></figure><p id="5d7d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这个图可以让你发现我们的条形图中找不到的模式。您可以看到不同要素的缺失值之间的联系。</p><p id="e529" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">特性 sales_rank 和 sales 的缺失值实际上是相互关联的。这是你所期望的。在条形图中，您可以看到 reviews_count 具有大约相同百分比的缺失值。您可能会期望与销售和销售排名相关联。我们的第二个图显示没有关联，因为值在不同的行中丢失。</p><p id="cfd7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">您可以用 gridExtra 包将这两种可视化合二为一。</p><pre class="kg kh ki kj gt ml mm mn mo aw mp bi"><span id="2e7e" class="mq lp iq mm b gy mr ms l mt mu">grid.arrange(percentage.plot, row.plot, ncol = 2)</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mx"><img src="../Images/9c117440c21eab726da8ff657752baef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*WWOJwPmMRXgMok7g.png"/></div></div></figure><h1 id="ff4b" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">结论</h1><p id="3e34" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">您以两种方式可视化了数据集中的缺失值，这为您提供了关于数据集中缺失值的不同见解。这样，您可以找到数据抓取器逻辑中的弱点。您可以看到 ggplot2 中的图形语法和 dplyr 中的数据操作语法是非常强大的概念。</p><p id="b87b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">2019 年 2 月 5 日由延斯·劳弗撰写</p><p id="e5c1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">随意分享！</p></div><div class="ab cl my mz hu na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="ij ik il im in"><p id="0f4f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><em class="nf">原载于 2019 年 2 月 5 日</em><a class="ae ln" href="http://jenslaufer.com/data/analysis/visualize_missing_values_with_ggplot.html" rel="noopener ugc nofollow" target="_blank"><em class="nf">【jenslaufer.com】</em></a><em class="nf">。</em></p></div></div>    
</body>
</html>