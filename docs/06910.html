<html>
<head>
<title>Non-maximum Suppression (NMS)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">非最大抑制(NMS)</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/non-maximum-suppression-nms-93ce178e177c?source=collection_archive---------2-----------------------#2019-10-01">https://towardsdatascience.com/non-maximum-suppression-nms-93ce178e177c?source=collection_archive---------2-----------------------#2019-10-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="cf67" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">一种过滤物体探测器预测的技术。</h2></div><p id="1cd5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">典型的对象检测流水线具有一个用于生成分类建议的<a class="ae le" rel="noopener" target="_blank" href="/region-proposal-network-a-detailed-view-1305c7875853">组件</a>。提议只不过是感兴趣对象的候选区域。大多数方法在特征图上采用滑动窗口，并根据在该窗口中计算的特征来分配前景/背景分数。邻域窗口在某种程度上具有相似的分数，并且被认为是候选区域。这导致了数百个提议。由于建议生成方法应该具有高召回率，所以我们在这一阶段保持宽松的约束。然而，通过分类网络处理这么多建议是很麻烦的。这就产生了一种基于某种标准(我们很快就会看到)过滤建议的技术，称为非最大抑制。</p><p id="8ed2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu"> NMS: </strong></p><p id="a88f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">输入:</strong>建议框 B 的列表，对应的置信度得分 S 和重叠阈值 n</p><p id="4a55" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">输出:</strong>过滤后的建议列表</p><p id="beb0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">算法:</strong></p><ol class=""><li id="8069" class="lf lg it kk b kl km ko kp kr lh kv li kz lj ld lk ll lm ln bi translated">选择具有最高置信度得分的提议，将其从 B 中移除，并将其添加到最终提议列表 D 中(最初 D 为空)。</li><li id="79ea" class="lf lg it kk b kl lo ko lp kr lq kv lr kz ls ld lk ll lm ln bi translated">现在，将该提议与所有提议进行比较，计算该提议与所有其他提议的 IOU(交集/并集)。如果 IOU 大于阈值 N，则从 b 中删除该建议。</li><li id="91de" class="lf lg it kk b kl lo ko lp kr lq kv lr kz ls ld lk ll lm ln bi translated">再次从 B 中的剩余提议中取出置信度最高的提议，并将其从 B 中移除，然后将其添加到 d 中。</li><li id="de7b" class="lf lg it kk b kl lo ko lp kr lq kv lr kz ls ld lk ll lm ln bi translated">再次用 B 中的所有建议计算该建议的 IOU，并排除 IOU 高于阈值的方框。</li><li id="611f" class="lf lg it kk b kl lo ko lp kr lq kv lr kz ls ld lk ll lm ln bi translated">重复这个过程，直到 b 中不再有建议。</li></ol><p id="4d19" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">IOU 计算实际上用于衡量两个方案之间的重叠部分。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi lt"><img src="../Images/ac422e106ef0eeb4c9592d6f406ee148.png" data-original-src="https://miro.medium.com/v2/resize:fit:844/format:webp/1*9vgYblWTjP0Np7q_PUmlrw.png"/></div><figcaption class="mb mc gj gh gi md me bd b be z dk">Intersection over Union</figcaption></figure><p id="7582" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下面是 NMS 的伪代码。为了更好地理解它，我添加了一些评论。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi mf"><img src="../Images/10890d5b561f38bba1592fc7a1a3d745.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iVUDd4fYhL5evD1M5156DA.png"/></div></div><figcaption class="mb mc gj gh gi md me bd b be z dk">Non-Max Suppression Algorithm</figcaption></figure><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi mk"><img src="../Images/9219837a5719ac8bb42dce1eca218efd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6d_D0ySg-kOvfrzIRwHIiA.png"/></div></div></figure><p id="2057" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在如果你观察上面的算法，整个过滤过程依赖于单个阈值。因此，阈值的选择是模型性能的关键。然而，设置这个阈值是棘手的。让我们看看这个场景。</p><p id="91b6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">假设重叠阈值 N 是 0.5。如果有一个建议的 IOU 为 0.51，并且具有良好的置信度得分，则该框将被移除，即使其置信度高于许多其他 IOU 较少的框。正因为如此，如果有两个物体并排，其中一个就会被消除。具有 0.49 IOU 的提议仍然被保留，即使其置信度非常低。当然，这是任何基于阈值的技术的已知问题。现在我们该如何处理？下面是这种情况的一个例子。仅保留 0.9 的建议，其他建议将被删除。这降低了模型的精度。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi ml"><img src="../Images/03ccff3518723e7a5c43bfc4e448115f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cNHc0xK78TFvtnzbMiOKJQ.jpeg"/></div></div></figure><p id="0945" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">处理这种情况的简单而有效的方法是使用软 NMS。思路很简单——<strong class="kk iu">“不是完全剔除 IOU 高、可信度高的提案，而是降低与 IOU 值成正比的提案的可信度”</strong>。现在让我们把这个想法应用到上面的例子中。不是完全删除得分为 0.8 的建议，而是保留这些建议，但降低其得分，如下图所示。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi ml"><img src="../Images/f6758b4c6874e6fcaa897efe4955db1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bIaMnqfddudCLUekjG9qvw.jpeg"/></div></div><figcaption class="mb mc gj gh gi md me bd b be z dk">Soft-NMS</figcaption></figure><p id="ed43" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">正如我前面提到的，两份建议书的 0.4 分都是根据借据价值计算的。分数计算如下</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi mm"><img src="../Images/ee0fdfe03b55875f95f27a727e4b458a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B6LRkITWF9HWRWtzCJzAew.png"/></div></div><figcaption class="mb mc gj gh gi md me bd b be z dk">si — score of proposal i, bi — box corresponding to proposal i, M — box corresponding to maximum confidence, Nt — IOU threshold</figcaption></figure><p id="97ab" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">因此，这只是 NMS 算法实现中的一行变化，它在很大程度上提高了精度。下图显示了两种算法(NMS 和软 NMS)，这是我从软 NMS 论文。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi mn"><img src="../Images/24f9d72da493c604809b5c73063cf5c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1324/format:webp/1*G6-phMqZbwgozsFwe5FDUw.png"/></div></div></figure><p id="789f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这些技术对于过滤单个模型的预测很有效，如果您有来自多个模型的预测呢？加权盒融合是一种结合目标检测模型预测的新方法。查看我的文章以了解更多信息。</p><div class="mo mp gp gr mq mr"><a rel="noopener follow" target="_blank" href="/weighted-boxes-fusion-86fad2c6be16"><div class="ms ab fo"><div class="mt ab mu cl cj mv"><h2 class="bd iu gy z fp mw fr fs mx fu fw is bi translated">加权盒融合</h2><div class="my l"><h3 class="bd b gy z fp mw fr fs mx fu fw dk translated">一种组合来自集合目标检测模型的盒子的方法</h3></div><div class="mz l"><p class="bd b dl z fp mw fr fs mx fu fw dk translated">towardsdatascience.com</p></div></div><div class="na l"><div class="nb l nc nd ne na nf lz mr"/></div></div></a></div><p id="d5fc" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我在下面的参考资料中给出了 NMS 和软 NMS 实现的 github 链接。这就是这篇文章的全部内容，非常感谢你和我在一起。</p><p id="f8fe" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">参考文献:</strong></p><ol class=""><li id="d1d5" class="lf lg it kk b kl km ko kp kr lh kv li kz lj ld lk ll lm ln bi translated">【https://arxiv.org/pdf/1704.04503.pdf T4】</li><li id="baa9" class="lf lg it kk b kl lo ko lp kr lq kv lr kz ls ld lk ll lm ln bi translated"><a class="ae le" href="https://github.com/rbgirshick/fast-rcnn/blob/master/lib/utils/nms.py" rel="noopener ugc nofollow" target="_blank">https://github . com/rbgirshick/fast-rcnn/blob/master/lib/utils/NMS . py</a></li><li id="693c" class="lf lg it kk b kl lo ko lp kr lq kv lr kz ls ld lk ll lm ln bi translated"><a class="ae le" href="https://github.com/bharatsingh430/soft-nms" rel="noopener ugc nofollow" target="_blank">https://github.com/bharatsingh430/soft-nms</a></li><li id="4a61" class="lf lg it kk b kl lo ko lp kr lq kv lr kz ls ld lk ll lm ln bi translated"><a class="ae le" href="https://github.com/DocF/Soft-NMS" rel="noopener ugc nofollow" target="_blank">https://github.com/DocF/Soft-NMS</a>—Python 实现。</li></ol></div><div class="ab cl ng nh hx ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="im in io ip iq"><p id="77a1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae le" href="https://master-ml.ck.page/0b50556bfa" rel="noopener ugc nofollow" target="_blank">订阅 FOCUS</a>——我的每周简讯，获取人工智能的最新更新和最新进展，以及来自机器学习媒体的精选故事。</p></div></div>    
</body>
</html>