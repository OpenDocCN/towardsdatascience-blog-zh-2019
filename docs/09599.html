<html>
<head>
<title>Web App development for Data Scientists</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">面向数据科学家的 Web 应用程序开发</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/web-app-development-for-data-scientists-48e445e54d7b?source=collection_archive---------15-----------------------#2019-12-17">https://towardsdatascience.com/web-app-development-for-data-scientists-48e445e54d7b?source=collection_archive---------15-----------------------#2019-12-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="9e89" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="http://towardsdatascience.com/tagged/data-science-sprints/" rel="noopener" target="_blank">数据科学冲刺</a></h2><div class=""/><div class=""><h2 id="b880" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">两周搭建全栈数据科学项目学习自然语言处理，Flask 和 ML 模型部署！</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/ca2767b2df1c1289bc39ef861c24fb13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*KmXs_TQHJ5m4x55iDfwcew.gif"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk">The end product that we’ll be building in this article</figcaption></figure><p id="c7c3" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">我知道你们中的一些人可能在想:<em class="md">为什么一个数据科学家应该关心构建一个 web 应用程序？</em>这个问题的答案非常简单:虽然分析数据集、发现模式和构建模型都是数据科学家的重要技能，但交流思想和为模型构建交互层同样重要。如果你正在考虑制造一个面向消费者的产品，或者甚至开始你自己的生意，这可能是特别重要的。</p><blockquote class="me"><p id="3105" class="mf mg it bd mh mi mj mk ml mm mn mc dk translated">唯一比优秀的数据科学家更有价值的人，是同时了解工程和部署的优秀数据科学家。</p></blockquote><p id="2eb3" class="pw-post-body-paragraph lh li it lj b lk mo kd lm ln mp kg lp lq mq ls lt lu mr lw lx ly ms ma mb mc im bi translated">我这个项目的目标是建立一个基本的情感分析机器学习模型+web 应用程序，并在两周内部署它，以学习三种新技术——自然语言处理(NLP)、flask 和增量/持续学习。在本文中，我将介绍如何构建 flask web 应用程序来帮助用户与情感分析模型进行交互。你可以使用你自己的模型，或者随意利用这个<a class="ae mt" href="https://github.com/hr23232323/nlp_medium_p1" rel="noopener ugc nofollow" target="_blank">库</a>来找一个我之前建的。<strong class="lj jd">我这篇文章的所有代码都可以在我的</strong><a class="ae mt" href="https://github.com/hr23232323/nlp_medium_p2" rel="noopener ugc nofollow" target="_blank"><strong class="lj jd">Github</strong></a><strong class="lj jd">上找到，所以请随意跟随</strong>。</p><h1 id="9d8e" class="mu mv it bd mw mx my mz na nb nc nd ne ki nf kj ng kl nh km ni ko nj kp nk nl bi translated">2 分钟内完成网络应用复习！</h1><p id="3506" class="pw-post-body-paragraph lh li it lj b lk nm kd lm ln nn kg lp lq no ls lt lu np lw lx ly nq ma mb mc im bi translated">Web 应用程序可以像您希望的那样简单或复杂。尽管复杂应用程序的架构可能会让最优秀的开发人员感到困惑，但简单的 web 应用程序并不复杂。简而言之，它包括以下几个部分:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nr"><img src="../Images/d98e42771656c1bb02d1cc4f603d912a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ABeqEW-wCzO7Gbbx9a5FNw.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk">Basic Web application layout</figcaption></figure><ol class=""><li id="fc24" class="ns nt it lj b lk ll ln lo lq nu lu nv ly nw mc nx ny nz oa bi translated">HTML 页面:这些是你的用户可以与之交互的不同网页。许多简单的应用程序利用一个单一的网页，因此命名为单页应用程序(SPA)。</li><li id="71c7" class="ns nt it lj b lk ob ln oc lq od lu oe ly of mc nx ny nz oa bi translated"><strong class="lj jd">层叠样式表(CSS) </strong> : CSS 是一种样式表语言，用于改变 HTML 页面的外观。从文本颜色到背景的一切都用 CSS 描述。</li><li id="c00f" class="ns nt it lj b lk ob ln oc lq od lu oe ly of mc nx ny nz oa bi translated">JavaScript:这是一种面向对象的编程语言，已经占领了 web 开发社区。Javascript 主要用于在网页上引入复杂的功能，如交互性、请求处理等。</li><li id="33e7" class="ns nt it lj b lk ob ln oc lq od lu oe ly of mc nx ny nz oa bi translated">web 服务器:这是 Web 应用程序中最令人困惑的部分。web 服务器可以由硬件和/或软件组成，其工作是向用户“提供”资源。因此，当用户想要查看网页时，浏览器通过 HTTP 向 web 服务器请求资源并接收响应。对于我们的项目，我们将使用 flask 服务器进行开发。</li></ol><p id="1ce0" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">现在你已经知道了 web 应用程序的不同部分，让我向你介绍一下 Flask，它将是我们将要使用的 web 应用程序框架。</p><h1 id="d1b8" class="mu mv it bd mw mx my mz na nb nc nd ne ki nf kj ng kl nh km ni ko nj kp nk nl bi translated">假人用烧瓶</h1><p id="83d6" class="pw-post-body-paragraph lh li it lj b lk nm kd lm ln nn kg lp lq no ls lt lu np lw lx ly nq ma mb mc im bi translated">Flask 是一个轻量级的非常通用的 web 应用程序框架。它在构建时考虑了灵活性和速度，这使得它非常适合几乎没有后端需求的小型应用程序。让 Flask 成为数据科学家工具箱中特别有用的工具的是，它是用 Python 构建的；许多数据科学家对此已经驾轻就熟。那么 Flask 是做什么的？</p><p id="4680" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">Flask 负责 web 应用程序中涉及的大量环境和项目设置。这实质上意味着，作为开发人员，您可以专注于您的应用程序，而 Flask 则负责 HTTP、路由、资产等。我保证，随着本文的深入，所有这些都会变得更容易理解。</p><p id="d480" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">我们的烧瓶应用程序将由以下部分组成:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nr"><img src="../Images/d01fba7571b513b56d14e77531286b95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_jHgN5PGqOPdNV0HlGia-Q.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk">Flask app layout; notice how the components mentioned in the basic web app section fall into place here</figcaption></figure><p id="c784" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">根据上面的图表，您可以清楚地看到我们的应用程序的不同功能部分。<code class="fe og oh oi oj b">app.py</code>文件将作为主服务器逻辑，帮助服务文件和运行任何需要的 ML 逻辑。<code class="fe og oh oi oj b">static</code>文件夹将包含我们的应用程序所需的任何资产，从图像到我们挑选的模型。最后，<code class="fe og oh oi oj b">template</code>文件夹将包含我们应用程序中使用的单个 HTML 网页。</p><p id="9af6" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">既然你已经知道了 web 应用程序的组成以及我们为什么要使用 flask，那么让我们来谈谈我们将如何实现这一切。</p><h1 id="836f" class="mu mv it bd mw mx my mz na nb nc nd ne ki nf kj ng kl nh km ni ko nj kp nk nl bi translated">开发生命周期</h1><p id="4356" class="pw-post-body-paragraph lh li it lj b lk nm kd lm ln nn kg lp lq no ls lt lu np lw lx ly nq ma mb mc im bi translated">在这个项目中，我试着遵循以下思维模式:</p><blockquote class="me"><p id="83db" class="mf mg it bd mh mi mj mk ml mm mn mc dk translated">我想以一种快速构建/学习的模式来完成这一切，重点是功能性，而不是美观性。</p></blockquote><p id="9025" class="pw-post-body-paragraph lh li it lj b lk mo kd lm ln mp kg lp lq mq ls lt lu mr lw lx ly ms ma mb mc im bi translated">鉴于此，我想分享一下我所遵循的应用程序开发生命周期。这将帮助你理解如何将功能看得比其他任何东西都重要，并快速构建原型。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ok"><img src="../Images/8ed2dc55a16834d0ed47b005eba00dd6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hPSM8e6NnB6PKN77q98qNQ.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk">Development Life Cycle used for this project</figcaption></figure><p id="10a3" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">正如你所看到的，主要的功能将被反复构建。这将帮助我们在不断添加功能的同时，始终拥有一个可用的应用程序。我们将在需求收集阶段概述应用程序中所需的特性。然后，我们将为整个应用程序设计 UI/UX，以避免在开发后期担心美观问题。之后，我们将优先考虑功能，并在 24 小时内完成。最后，我将把这个应用程序部署到一个 AWS EC2 实例中，这将在另一篇文章中全面介绍。我们开始吧！</p><h1 id="3fe5" class="mu mv it bd mw mx my mz na nb nc nd ne ki nf kj ng kl nh km ni ko nj kp nk nl bi translated">需求收集</h1><p id="86a2" class="pw-post-body-paragraph lh li it lj b lk nm kd lm ln nn kg lp lq no ls lt lu np lw lx ly nq ma mb mc im bi translated">我们的项目涉及用户与机器学习模型的交互，所以我们必须真正理解这些交互将如何发生。我们有一个<a class="ae mt" href="https://github.com/hr23232323/nlp_medium_p1/blob/master/nlp_model.ipynb" rel="noopener ugc nofollow" target="_blank"> NLP 分类器</a>，它可以预测用户对某个主题的感受是积极还是消极。因此，我们需要一个<strong class="lj jd">输入字段，用户可以在这里输入评论/想法</strong>和一个<strong class="lj jd">输出位置，预测将在这里显示</strong>。此外，我们还构建了一个<a class="ae mt" href="https://github.com/hr23232323/nlp_medium_p1/blob/master/incremental_learning.ipynb" rel="noopener ugc nofollow" target="_blank">功能</a>来增量训练我们的模型。所以，<strong class="lj jd">我们需要为用户提供一种提供反馈的方式(正确/不正确的预测)</strong>。这些都是我们基本应用程序中的交互。</p><p id="9af2" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">考虑到我们的应用程序的简单性，将其构建为单页面应用程序是有意义的。因此，我们 it 的另一个要求是<strong class="lj jd">输入、输出和反馈功能都需要在同一个页面</strong>。这将有助于保持我们的项目精简和最小化，并减少开发时间。</p><h1 id="847c" class="mu mv it bd mw mx my mz na nb nc nd ne ki nf kj ng kl nh km ni ko nj kp nk nl bi translated">UI 设计</h1><p id="eccd" class="pw-post-body-paragraph lh li it lj b lk nm kd lm ln nn kg lp lq no ls lt lu np lw lx ly nq ma mb mc im bi translated">我喜欢在写任何代码之前在一张纸上画出 UI 设计，因为我们可以更快地做出改变，修补整个部分，并为快速构建提供具体的设计。此外，我还认为，在不同的屏幕上使用不同的功能，有助于将所有内容整合到一个页面应用程序(SPA)中，而不会遗漏任何部分。我的 UI/UX 设计进展可以在这里看到。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ol"><img src="../Images/75963ebddbaffd9153defecd02b0d2db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TjAw7GZWqgECQLJvwsKOcw.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk">Design #1</figcaption></figure><p id="68cc" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">我从三个不同的屏幕(设计#1)开始，每个屏幕都有自己的功能。第一个屏幕是用户可以输入信息并点击预测的地方。第二种情况是用户可以看到输出，并可以选择将其标记为正确或不正确的预测。最后，最后一个屏幕将是一个确认屏幕，这样用户就知道他的反馈被采纳了，并可以选择重新开始。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ol"><img src="../Images/aeb038522f4065696c08533792281efe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FzlCa4djN89vAGVvlA3dtQ.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk">Design #2</figcaption></figure><p id="d919" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">这三个屏风是我的第一个水疗设计(设计#2)的模型。这是一个带有占位符的静态设计，其中各个部分(输出、反馈按钮等。)会在需要时变得活跃。我认为它是活跃的，因为没有一个元素会在任何时候隐藏；他们总是可见的。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ol"><img src="../Images/d78756739dfb234093eb72ee6610f9d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X57FI9Q6WDUi9YBkRFfpGA.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk">Design #3 (Final)</figcaption></figure><p id="7867" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">我的最终设计是静态 SPA 的动态版本(设计#3)，其中输出和反馈元素最初是隐藏的(左侧屏幕)，然后在用户单击预测按钮时出现(右侧屏幕)。我对这个设计非常满意，并且很乐意在这一点上继续进行实际的开发。</p><h1 id="c1b5" class="mu mv it bd mw mx my mz na nb nc nd ne ki nf kj ng kl nh km ni ko nj kp nk nl bi translated">迭代开发</h1><p id="beb4" class="pw-post-body-paragraph lh li it lj b lk nm kd lm ln nn kg lp lq no ls lt lu np lw lx ly nq ma mb mc im bi translated">在开始开发之前，我为完成这个项目所需的特性创建了一个优先级队列。它们可以在下面(按顺序)看到:</p><ol class=""><li id="3d31" class="ns nt it lj b lk ll ln lo lq nu lu nv ly nw mc nx ny nz oa bi translated">为整个应用程序构建静态用户界面(普通的 HTML+CSS)</li><li id="5c55" class="ns nt it lj b lk ob ln oc lq od lu oe ly of mc nx ny nz oa bi translated">捕捉用户的输入，通过我们的模型运行它，并提出一个预测，显示在前端</li><li id="92f9" class="ns nt it lj b lk ob ln oc lq od lu oe ly of mc nx ny nz oa bi translated">获取用户反馈，并使用之前构建的增量学习功能适当地教授模型</li><li id="6a0e" class="ns nt it lj b lk ob ln oc lq od lu oe ly of mc nx ny nz oa bi translated">将 UI 从静态改为动态:在启动时隐藏不必要的元素，并在需要时显示它们</li></ol><p id="43ec" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">在每次迭代结束时，我将拥有一个功能有限的工作应用程序。这将有助于快速测试和调试新功能。让我来分享一下我的代码和每个特性的进展。</p><h2 id="7065" class="om mv it bd mw on oo dn na op oq dp ne lq or os ng lu ot ou ni ly ov ow nk iz bi translated">迭代 1:静态用户界面</h2><p id="e4eb" class="pw-post-body-paragraph lh li it lj b lk nm kd lm ln nn kg lp lq no ls lt lu np lw lx ly nq ma mb mc im bi translated">构建一个静态用户界面相当简单。如果你以前从未为网络开发过，我强烈推荐你查看<a class="ae mt" href="https://developer.mozilla.org/en-US/" rel="noopener ugc nofollow" target="_blank"> MDN 网络文档</a>来解决你的所有问题。鉴于我们的应用程序的简单性，我们的 HTML 代码是最少的，虽然我不想浪费您的时间来深入描述这一点，但我将从高层次来介绍它。我们的 UI 被分成两个主要的<code class="fe og oh oi oj b">&lt;div&gt;</code>标签:一个用于包含指令、输入文本框和预测按钮的上半部分，另一个用于包含预测输出和反馈按钮的下半部分。与这个项目相关的大多数 HTML 对于以前做过 web 开发的人来说应该是有意义的，但是我想指出一个重要的 flask 特定代码:</p><pre class="ks kt ku kv gt ox oj oy oz aw pa bi"><span id="e4c2" class="om mv it oj b gy pb pc l pd pe">&lt;form id="input-form" class="input-form" <br/>   action="<strong class="oj jd">{{ url_for('predict')}}</strong>" method="post"&gt;<br/>     ..<br/>     ..<br/>     ..<br/>&lt;/form&gt;</span></pre><p id="866a" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">表单标签中的<code class="fe og oh oi oj b">{{url_for(‘predict’)}}</code>属性是一个指向“预测”路线的 flask 方法。这个关联帮助我们从表单中捕获用户输入，并在我们的模型可用的<code class="fe og oh oi oj b">app.py</code>文件中处理它。当我们在下一节介绍 flask 时，您将看到这一点。</p><p id="0b40" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">最后，为了设计这个 HTML 页面，我主要使用 CSS 的 flexbox 显示模式来创建一个最小的布局。因此，尽管还没有任何按钮起作用，图像也没有改变，但我在这次迭代结束时的静态布局如下所示:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pf"><img src="../Images/dc8d2c20f4b9463271c6d008fd6f584e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K2fddqk0AYZ4U6TE1Ty8jA.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk">Static UI after iteration 1. None of the buttons work yet :)</figcaption></figure><p id="1b0b" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">鉴于读者的兴趣，我不会在本文中涉及 CSS，但是如果你感兴趣，你可以在这里找到我所有的代码<a class="ae mt" href="https://github.com/hr23232323/nlp_medium_p2" rel="noopener ugc nofollow" target="_blank"><strong class="lj jd"/></a>。</p><h2 id="f3d3" class="om mv it bd mw on oo dn na op oq dp ne lq or os ng lu ot ou ni ly ov ow nk iz bi translated">迭代 2:捕获输入并在前端显示预测</h2><p id="d14b" class="pw-post-body-paragraph lh li it lj b lk nm kd lm ln nn kg lp lq no ls lt lu np lw lx ly nq ma mb mc im bi translated">在上一节的最后，我们只有一个 HTML 和 CSS 文件。现在，我们将开始使用<code class="fe og oh oi oj b">app.py</code>文件来构建我们的应用程序的逻辑，并且从直接显示 HTML 页面转移到使用 Flask 服务器来服务它。要开始使用 Flask 服务 HTML 页面，我们只需要几行代码:</p><pre class="ks kt ku kv gt ox oj oy oz aw pa bi"><span id="3689" class="om mv it oj b gy pb pc l pd pe">from flask import Flask, render_template, request</span><span id="16f0" class="om mv it oj b gy pg pc l pd pe">app = Flask(__name__, template_folder='../templates', static_folder='../static')</span><span id="f58e" class="om mv it oj b gy pg pc l pd pe">@app.route('/')<br/>def home():<br/>    return render_template('index.html', image_filename="img/happy.webp", display_mode="none")</span><span id="3bd3" class="om mv it oj b gy pg pc l pd pe">@app.route('/predict', methods=['POST'])<br/>def predict():<br/>    return render_template('index.html', image_filename="img/happy.webp", display_mode="none")</span><span id="8501" class="om mv it oj b gy pg pc l pd pe">@app.route('/save_pred', methods=['POST'])<br/>def save_pred():<br/>    return render_template('index.html', image_filename="img/happy.webp", display_mode="none")</span><span id="0b1e" class="om mv it oj b gy pg pc l pd pe">if __name__ == "__main__":<br/>    app.run(debug=True)</span></pre><p id="43c1" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">注意:Flask 不要求显式地提到 template_folder 和 static_folder，但是我喜欢这样做，以防我弄乱了名称/路径。此外，此时，我们的项目文件夹结构应该如下所示:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi ph"><img src="../Images/a394eba1d3ae3d80c496954b5d4220cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:718/format:webp/1*GbL0ln64F3rDgFXGZE6vdA.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk">Project folder structure</figcaption></figure><p id="e000" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">这样，我们所有的资产(图像、模型等。)在同一个主文件夹<code class="fe og oh oi oj b">static</code>的不同子文件夹中，我们的 HTML 页面在<code class="fe og oh oi oj b">templates</code>文件夹中，我们的<code class="fe og oh oi oj b">app.py</code>文件在<code class="fe og oh oi oj b">python</code>文件夹中。</p><p id="08dc" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">此时，我们已经准备好使用 Flask 服务器运行我们的应用程序。为此:使用命令行导航到 python 文件夹，并运行命令<code class="fe og oh oi oj b">python app.py</code>。请记住，此时您应该已经使用 pip 安装了 Flask。更多关于那个<a class="ae mt" href="https://flask.palletsprojects.com/en/1.1.x/installation/" rel="noopener ugc nofollow" target="_blank">的信息在这里</a>。恭喜，您的应用程序已经启动并运行了！现在让我们添加预测逻辑。</p><p id="8573" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">注意我们是如何为<code class="fe og oh oi oj b">predict</code>和<code class="fe og oh oi oj b">save_pred</code>路线放置占位符的。这样做是为了确保 Flask 应用程序部署无误。为了让我们的 predict 函数工作，我们需要从 textbox 中捕获用户的输入，使用我们的 NLP 矢量器(<code class="fe og oh oi oj b">input_transformer.pkl</code>)将它转换成一个单词袋矢量，并通过我们的分类器(<code class="fe og oh oi oj b">review_sentiment.pkl</code>)运行它。还要注意，我将使用全局变量来存储模型输入和输出，以便在预测和增量学习函数中保持它们。此功能的代码如下所示:</p><pre class="ks kt ku kv gt ox oj oy oz aw pa bi"><span id="3df5" class="om mv it oj b gy pb pc l pd pe"># module needed to load models<br/>from sklearn.externals import joblib</span><span id="f17e" class="om mv it oj b gy pg pc l pd pe"># load models pickeled earlier<br/>input_transformer = joblib.load(open('../static/models/input_transformer.pkl', 'rb'))<br/>model = joblib.load(open('../static/models/review_sentiment.pkl', 'rb'))</span><span id="d5d2" class="om mv it oj b gy pg pc l pd pe"># Global variables for persistence across methods (and requests)<br/>model_input=""<br/>model_output=""</span><span id="0c3d" class="om mv it oj b gy pg pc l pd pe">@app.route('/predict', methods=['POST'])<br/>def predict():</span><span id="b13d" class="om mv it oj b gy pg pc l pd pe">    # retrieve global variables to store input and output<br/>    global model_input<br/>    global model_output<br/>    <br/>    # get text from the incoming request (submitted on predict button click)<br/>    text = request.form['input_text']<br/>    <br/>    # convert text to model input vector<br/>    final_features = input_transformer.transform([text])<br/>    <br/>    # use classifier's predict method to get prediction<br/>    prediction = model.predict(final_features)<br/>    <br/>    # store model input and output<br/>    model_input = text<br/>    model_output = prediction[0]</span><span id="b75f" class="om mv it oj b gy pg pc l pd pe">    return model_output</span></pre><p id="3b3d" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">你有它！现在，我们的应用程序可以将用户输入的文本转换成向量，可以通过我们预先训练的模型进行分类。</p><h2 id="f91e" class="om mv it bd mw on oo dn na op oq dp ne lq or os ng lu ot ou ni ly ov ow nk iz bi translated">迭代 3:增量学习</h2><p id="deed" class="pw-post-body-paragraph lh li it lj b lk nm kd lm ln nn kg lp lq no ls lt lu np lw lx ly nq ma mb mc im bi translated">我们采取的步骤如下:使用全局变量对输入文本进行矢量化，获得用户点击的按钮(正确/不正确)，基于用户的按钮选择断言“正确”预测，递增地训练模型直到它重新学习，更新模型 pickle。这方面的代码如下所示:</p><pre class="ks kt ku kv gt ox oj oy oz aw pa bi"><span id="0f80" class="om mv it oj b gy pb pc l pd pe"><a class="ae mt" href="http://twitter.com/app" rel="noopener ugc nofollow" target="_blank">@app</a>.route('/save_pred', methods=['POST'])<br/>def save_pred():<br/>    # retrieve global variables<br/>    global model_input<br/>    global model_output</span><span id="8868" class="om mv it oj b gy pg pc l pd pe">    # vectorize user input<br/>    final_features = input_transformer.transform([model_input])<br/>    <br/>    # get user's button choice (correct/incorrect)<br/>    save_type = request.form["save_type"]<br/>    <br/>    # modify global variable if user selected "incorrect"<br/>    if(save_type == 'incorrect'):<br/>        if(model_output == 'p'):<br/>            model_output = 'n'<br/>        elif(model_output == 'n'):<br/>            model_output = 'p'<br/>        else:<br/>            print("Error: Model output was neither N nor P")</span><span id="ce7f" class="om mv it oj b gy pg pc l pd pe">    # Strengthen weight of particular connection<br/>    max_iter = 100<br/>    counter = 0<br/>    for i in range (0,max_iter):<br/>        model.partial_fit(final_features, [model_output])<br/>        if(model.predict(final_features) == [model_output]):<br/>            counter = i<br/>            break<br/>    <br/>    # Save trained model pickle<br/>    joblib.dump(model, '../../review_sentiment.pkl')<br/>       </span><span id="c9db" class="om mv it oj b gy pg pc l pd pe">    # return placeholder (will be updated later)<br/>    return ""</span></pre><p id="7cef" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">虽然上面的代码实现了我们需要的所有功能，但是一旦重新训练完成，它没有向用户提供任何类型的反馈。为了解决这个问题，我们将添加一个返回文本变量来返回"<em class="md">权重已更改，谢谢您的指正！</em>"或"<em class="md">砝码被强化，谢谢你教我！</em>“根据情况。此外，我还认为捕获模型被重新训练的数据以防止误用该功能是非常重要的。几行代码可以帮助我们将输入、校正后的输出以及重新训练所需的周期数存储在 csv 文件中:</p><pre class="ks kt ku kv gt ox oj oy oz aw pa bi"><span id="baae" class="om mv it oj b gy pb pc l pd pe">fields = [model_input, model_output, counter]<br/>    with open('user_teaching_data.csv', 'a') as file:<br/>        writer = csv.writer(file)<br/>        writer.writerow(fields)</span></pre><p id="a440" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated"><strong class="lj jd">迭代 4:动态内容</strong></p><p id="3fc6" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">随着我们的静态应用程序的完成，这次迭代的目的是让它变得动态和更加用户友好。你一定注意到了，所有的元素在我们的应用程序中都是可见的，而且页面每次都会重新加载。虽然这没什么大不了的，但是我们可以很容易地使用 jQuery 和 AJAX 来避免重载，并根据需要隐藏元素。这将有助于给我们的应用程序一个完美的外观，也有助于积极的用户体验。深入研究 jQuery 或 Ajax 超出了本文的范围，但是如果您感兴趣，我强烈建议您查看我的<a class="ae mt" href="https://github.com/hr23232323/nlp_medium_p2/blob/master/static/scripts/script.js" rel="noopener ugc nofollow" target="_blank"> <strong class="lj jd">代码</strong> </a>，以及这篇关于 AJAX 的<a class="ae mt" href="https://medium.com/free-code-camp/ajax-basics-explained-by-working-at-a-fast-food-restaurant-88d95f5fcb7a" rel="noopener">精彩文章。</a></p><p id="e57c" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">在这次迭代结束时，我们的应用程序按预期工作:它接受用户信息，显示我们的 NLP 模型的结果，允许用户重新训练我们的模型，并以最简单优雅的方式完成所有这些工作。我们的全功能 web 应用程序演示可以在下面再次看到:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/ca2767b2df1c1289bc39ef861c24fb13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*KmXs_TQHJ5m4x55iDfwcew.gif"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk">Final working demo for web application</figcaption></figure><p id="894a" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">恭喜我们的两周挑战进行到这一步！希望到目前为止，您不仅能够构建 NLP 模型，还具备了构建 web 应用程序以使这些模型具有交互性的必要技能。</p><h1 id="307c" class="mu mv it bd mw mx my mz na nb nc nd ne ki nf kj ng kl nh km ni ko nj kp nk nl bi translated">包裹</h1><p id="9859" class="pw-post-body-paragraph lh li it lj b lk nm kd lm ln nn kg lp lq no ls lt lu np lw lx ly nq ma mb mc im bi translated">到目前为止，我们已经完成了许多很酷的事情:我们采用了以前训练过的数据科学模型，并围绕它构建了一个功能齐全的 web 应用程序。我们花了大约六天的时间来构建我们的 web 应用程序，把重点放在功能而不是美观上。这种心态让我们能够在大约 10 天内构建我们的模型和 web 应用程序。</p><p id="6f2a" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">两周的时间还剩四天，<strong class="lj jd">我们将解决我们最大的挑战:使用普通 EC2 实例</strong>在 AWS 上进行建模和应用程序部署。我将写另一篇帖子来指导您完成部署过程，所以请随时关注<a class="ae mt" href="https://towardsdatascience.com/tagged/data-science-sprints" rel="noopener" target="_blank">我的专栏《走向数据科学</a>》以获得发布时的通知！</p><p id="cd3f" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">我希望你喜欢读这篇文章，就像我喜欢把它放在一起一样。如果您有任何问题、反馈或意见，请随时通过<a class="ae mt" href="https://www.linkedin.com/in/harshrana1997/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>或我的<a class="ae mt" href="http://www.harshrana.com/" rel="noopener ugc nofollow" target="_blank">网站</a>与我联系。</p></div></div>    
</body>
</html>