# 使用包装器登录 Python

> 原文：<https://towardsdatascience.com/using-wrappers-to-log-in-python-ccffe4c46b54?source=collection_archive---------7----------------------->

使用 Python 进行日志记录可能会很乏味，尤其是在使用它进行调试的时候。我本人并不喜欢 Conda 或 Pycharm(或任何其他花哨的 IDE)，但对于那些喜欢的人来说，当你必须将代码投入生产时，你总是会遇到调试/控制的问题。添加大量代码来查看发生了什么，浪费了大量宝贵的时间，而 Python 调试器(pdb)至少提供了很少的帮助。

但更重要的是，大多数时候，作为开发人员，我们需要向代码中添加日志，所以**日志记录很可能不是我们可以选择退出**的选项。

出于这个原因，我决定发表这篇文章，在这篇文章中，我将向你展示一个非常**简单、省时和强大的方法来记录你的 Python 脚本**。您可以将细节推断到其他语言，只要它们有包装器和记录器(我可能会在将来的另一篇文章中讨论这些)。

主要概念相当简单:您希望在每次进入或退出函数时进行记录。您希望大多数函数都是这样，至少上层函数是这样，这样，如果代码在某个点中断，您就知道它在哪里中断以及中断的原因。每当您想要记录函数的进入或退出(或任何其他重要事件)时，问题就来了。但是每个问题都有一个解决方案，在这种情况下，解决方案是包装。

首先我将展示包装在 Python 中是如何工作的，然后是日志记录，然后我将把两者结合起来展示一个简单的例子。最后，我将展示一个更复杂的例子来描述这个相当简单的概念的威力。

# 包装材料

![](img/bb32f08cb745010c6bdbf379ac620d00.png)

Photo by [freestocks.org](https://unsplash.com/@freestocks?utm_source=medium&utm_medium=referral) on [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral)

对于那些不知道什么是包装的人。包装一个函数意味着无论什么时候调用这个函数，都要做一些事情。这就是你在包装器中定义的东西。包装器的示例:

从[这里得到](https://wiki.python.org/moin/FunctionWrappers)。

在这种情况下，作为 wrap 函数中的参数接收的 pre 和 post 变量是您将在被包装的函数之前和之后调用的函数。例如，如果您正在包装函数 bake_pie()，并将函数 before_baking 和 after_baking 作为参数传递给包装器，代码将执行函数 before_baking()，然后是 bake_pie()，最后是 after_baking()。

包装器函数的通常形式是这样的:

如您所见，函数进入和退出的参数是另一个函数(您正在包装的函数)及其参数。

让我们继续日志记录！

# 记录

日志记录就像打印一样，只是打印到一个文件中，有许多控制选项和时间显示。它主要用于了解服务器上的应用程序正在发生什么，或者在部署时进行调试。Python 中的基本日志配置如下所示:

如您所见，您可以声明想要写入的文件名、想要的调试级别(以便只将某些消息写入文件)以及关于消息格式的一些其他配置。我不会详细讨论日志，因为已经有很多关于日志的文章了，说实话这并不有趣！

# 使用包装器记录日志

所以现在我们有了包装器和记录器，只是把它们加起来的问题。我们需要做的是在进入()和退出()函数中加入日志记录功能，以显示当我们遍历代码的不同函数时，日志文件中发生了什么。一个基本的例子可能是这样的:

我们在进入和退出函数中添加了日志消息。

剩下的最后一件事是将包装器“标签”添加到我们想要包装的函数中。这个标签通常被称为 anotation，它只是一个“@”符号，后面跟一个包装器的名字，就在你的函数上面:

如果我们把所有的部分放在一起，看起来会是这样的:

Logging with wrappers 101

例如，如果您使用 bake_pie(3)执行函数 bake_pie，您将得到下一个日志文件:

> 2019–03–08 09:38:47800 调试进入 bake_pie
> 2019–03–08 09:38:47800 调试退出 bake _ pie

你可以添加注释@wrap(进入，退出)到任何其他函数，它也会这样做，这就是它的强大之处，**所有的功能只需添加一行简单的代码**。

# 使用包装器的奇特日志记录

![](img/5d77714593479f59b2eb2fb8b1e53746.png)

Photo by [Jordane Mathieu](https://unsplash.com/@mat_graphik?utm_source=medium&utm_medium=referral) on [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral)

当然，你还可以做更有趣的事情。为了展示其中的一些，这里还有一个例子:

我已经改变了“pre”函数中的参数，所以它现在通过*args 接收它所包装的函数的参数。

现在，我们更改重要的部分，pre 函数本身，以便它给出关于它正在记录的函数的更详细的信息:

如您所见，我们现在记录了以下内容:

*   函数名
*   函数文档字符串
*   它在文件中的位置(行号)和文件名
*   传递给函数的第一个参数(如果有)

所有具有不同日志级别(调试、信息和警告)的日志

这是运行 bake_pie(3)将写入日志文件的内容:

> 2019–03–08 10:15:44919 DEBUG 进入 bake _ pie
> 2019–03–08 10:15:44919 INFO 烘烤一定量的馅饼
> 2019–03–08 10:15:44919 INFO 函数在 log gin _ with _ wrappers . py
> 2019–03–08 10:15:44919 警告

要检查一些**很酷的内置**你可以在这里显示 go [。你肯定会为包装器添加大量逻辑而疯狂，以便获得必要的最佳日志记录信息…](https://docs.python.org/3/library/inspect.html)

我希望这篇文章能帮助你减少花在日志记录上的时间和质量。

快乐日志:)