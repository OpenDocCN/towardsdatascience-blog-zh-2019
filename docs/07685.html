<html>
<head>
<title>Histogram Equalization — a simple way to improve the contrast of your image</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">直方图均衡化——提高图像对比度的简单方法</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/histogram-equalization-a-simple-way-to-improve-the-contrast-of-your-image-bcd66596d815?source=collection_archive---------4-----------------------#2019-10-25">https://towardsdatascience.com/histogram-equalization-a-simple-way-to-improve-the-contrast-of-your-image-bcd66596d815?source=collection_archive---------4-----------------------#2019-10-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="4ec1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我在石溪大学的计算机视觉课上从 Shilkrot 教授那里学到了直方图均衡化。这是一个非常简单的概念，只需要几行代码就可以实现。</p><p id="9d79" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你认为图像的直方图表示是什么样的？就像左边的红色区域？是啊！</p><div class="kl km kn ko gt ab cb"><figure class="kp kq kr ks kt ku kv paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><img src="../Images/23eb25ad3a2ab2367c9f3a5ecfedf224.png" data-original-src="https://miro.medium.com/v2/resize:fit:652/format:webp/1*NZkRKaGnJiUMnfqDkgq3cQ.jpeg"/></div></figure><figure class="kp kq lc ks kt ku kv paragraph-image"><img src="../Images/64076278029bc3d1f76e8a65aa8ca2c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:782/format:webp/1*2Xost--ol5K-nlRSbSBIvw.png"/><figcaption class="ld le gj gh gi lf lg bd b be z dk lh di li lj">(a) input image and its histogram</figcaption></figure></div><p id="51ad" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们从上面的图中看到，直方图位于(a)中较亮的区域。但是，如果我们需要亮度的均匀分布，我们将需要一个变换函数，将较亮区域中的输入像素映射到整个区域中的输出像素。这就是<strong class="jp ir">直方图均衡</strong>所做的。它增强了图像的对比度。直方图均衡化的结果图像可以在(b)的右侧看到。</p><div class="kl km kn ko gt ab cb"><figure class="kp kq lk ks kt ku kv paragraph-image"><img src="../Images/ec567efe00b8416e41b2ce0d58435e95.png" data-original-src="https://miro.medium.com/v2/resize:fit:768/format:webp/1*m1Y3p6T2mqa09Owqasz3bw.png"/></figure><figure class="kp kq ll ks kt ku kv paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><img src="../Images/d5458d09408f0e32b84555f598d41458.png" data-original-src="https://miro.medium.com/v2/resize:fit:660/format:webp/1*8_gDo7SJp--gF3A5oeKg7g.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk lm di ln lj">(b) resulting image post histogram equalization technique</figcaption></figure></div><pre class="kl km kn ko gt lo lp lq lr aw ls bi"><span id="dbc0" class="lt lu iq lp b gy lv lw l lx ly">## code to plot histogram in python</span><span id="4835" class="lt lu iq lp b gy lz lw l lx ly">import numpy as np<br/>import cv2<br/>from matplotlib import pyplot as plt</span><span id="f72b" class="lt lu iq lp b gy lz lw l lx ly">img = cv2.imread('Chatth_Puja_Bihar_India.jpeg',0)<br/>hist,bins = np.histogram(img.flatten(),256,[0,256])<br/>plt.hist(img.flatten(),256,[0,256], color = 'r')<br/>plt.xlim([0,256])<br/>plt.show()</span></pre><p id="6200" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以在 OpenCV 中使用函数<strong class="jp ir"> cv2.equalizeHist() </strong>来做到这一点。如果它的输入只是灰度图像，那么输出就是我们的直方图均衡化图像。如果是彩色(RGB)图像，我们可以分离所有三种不同的流——红色、绿色、蓝色；在这些通道上分别调用<strong class="jp ir"> cv2.equalizeHist() </strong>，最后合并回来，如下面的代码所示。为了更好地理解，我还通过 numpy 数组提供了代码。</p><pre class="kl km kn ko gt lo lp lq lr aw ls bi"><span id="3c47" class="lt lu iq lp b gy lv lw l lx ly">def histogram_equalization(img_in):</span><span id="189d" class="lt lu iq lp b gy lz lw l lx ly"># segregate color streams<br/>    b,g,r = cv2.split(img_in)<br/>    h_b, bin_b = np.histogram(b.flatten(), 256, [0, 256])<br/>    h_g, bin_g = np.histogram(g.flatten(), 256, [0, 256])<br/>    h_r, bin_r = np.histogram(r.flatten(), 256, [0, 256])</span><span id="5e2e" class="lt lu iq lp b gy lz lw l lx ly"># calculate cdf    <br/>    cdf_b = np.cumsum(h_b)  <br/>    cdf_g = np.cumsum(h_g)<br/>    cdf_r = np.cumsum(h_r)<br/>    <br/># mask all pixels with value=0 and replace it with mean of the pixel values <br/>    cdf_m_b = np.ma.masked_equal(cdf_b,0)<br/>    cdf_m_b = (cdf_m_b - cdf_m_b.min())*255/(cdf_m_b.max()-cdf_m_b.min())<br/>    cdf_final_b = np.ma.filled(cdf_m_b,0).astype('uint8')<br/>  <br/>    cdf_m_g = np.ma.masked_equal(cdf_g,0)<br/>    cdf_m_g = (cdf_m_g - cdf_m_g.min())*255/(cdf_m_g.max()-cdf_m_g.min())<br/>    cdf_final_g = np.ma.filled(cdf_m_g,0).astype('uint8')</span><span id="2430" class="lt lu iq lp b gy lz lw l lx ly">cdf_m_r = np.ma.masked_equal(cdf_r,0)<br/>    cdf_m_r = (cdf_m_r - cdf_m_r.min())*255/(cdf_m_r.max()-cdf_m_r.min())<br/>    cdf_final_r = np.ma.filled(cdf_m_r,0).astype('uint8')</span><span id="4ef8" class="lt lu iq lp b gy lz lw l lx ly"># merge the images in the three channels</span><span id="a84b" class="lt lu iq lp b gy lz lw l lx ly">    img_b = cdf_final_b[b]<br/>    img_g = cdf_final_g[g]<br/>    img_r = cdf_final_r[r]<br/>  <br/>    img_out = cv2.merge((img_b, img_g, img_r))</span><span id="a01c" class="lt lu iq lp b gy lz lw l lx ly"># validation<br/>    equ_b = cv2.equalizeHist(b)<br/>    equ_g = cv2.equalizeHist(g)<br/>    equ_r = cv2.equalizeHist(r)<br/>    equ = cv2.merge((equ_b, equ_g, equ_r))<br/>    #print(equ)<br/>    #cv2.imwrite('output_name.png', equ)</span><span id="e94f" class="lt lu iq lp b gy lz lw l lx ly">return img_out</span></pre><h1 id="234f" class="ma lu iq bd mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw bi translated">应用程序</h1><ol class=""><li id="b917" class="mx my iq jp b jq mz ju na jy nb kc nc kg nd kk ne nf ng nh bi translated">您可以使用直方图均衡化来改善任何低对比度图像的亮度。</li><li id="f0e1" class="mx my iq jp b jq ni ju nj jy nk kc nl kg nm kk ne nf ng nh bi translated">在人脸识别技术中，在训练人脸数据之前，对人脸图像进行直方图均衡化，使它们具有相同的光照条件。</li></ol><h1 id="bd67" class="ma lu iq bd mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw bi translated">奖金</h1><p id="4591" class="pw-post-body-paragraph jn jo iq jp b jq mz js jt ju na jw jx jy nn ka kb kc no ke kf kg np ki kj kk ij bi translated">首先，使用下面的代码将图像转换为灰色和黑白。</p><pre class="kl km kn ko gt lo lp lq lr aw ls bi"><span id="66db" class="lt lu iq lp b gy lv lw l lx ly">import cv2<br/>  <br/>originalImage = cv2.imread('avalon_lake.jpeg')<br/>grayImage = cv2.cvtColor(originalImage, cv2.COLOR_BGR2GRAY)<br/>(thresh, blackAndWhiteImage) = cv2.threshold(grayImage, 127, 255, cv2.THRESH_BINARY)</span><span id="4d9c" class="lt lu iq lp b gy lz lw l lx ly">cv2.imwrite('blackAndWhiteImage.png', blackAndWhiteImage)<br/>cv2.imwrite('grayImage.png', grayImage)</span></pre><div class="kl km kn ko gt ab cb"><figure class="kp kq nq ks kt ku kv paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><img src="../Images/3dc4a5f33c2ac0214d920ac697c0245f.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*tztKbNXdF8s5Ei5xLlaeFA.jpeg"/></div></figure><figure class="kp kq nq ks kt ku kv paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><img src="../Images/a6b5c555bdcb030ee2679d73c9853e36.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*-GPrAzb7Cd6GuPQU2AyZfA.png"/></div></figure><figure class="kp kq nq ks kt ku kv paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><img src="../Images/5ca304ac11d85fdbd4ec8656727d3664.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*PcwKPpRkw4Z4RDm6f0JMlg.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk nr di ns lj">Original -&gt; Gray -&gt; BW</figcaption></figure></div></div></div>    
</body>
</html>