<html>
<head>
<title>SQL Server Index Analysis and Optimization</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SQL Server 索引分析和优化</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/sql-server-index-analysis-and-optimization-1edd84d9da?source=collection_archive---------9-----------------------#2019-07-15">https://towardsdatascience.com/sql-server-index-analysis-and-optimization-1edd84d9da?source=collection_archive---------9-----------------------#2019-07-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="4d38" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">熟悉 SQL Server 数据库中索引分析和优化的关键方面</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/fc154109c048e7a9679f104ceae57a8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3vcs0xbN249WT-8GcnoEiw.jpeg"/></div></div></figure><p id="2bfa" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">经常需要优化索引和统计数据，以便优化器更快地搜索必要的数据和更好地构建查询执行计划。</p><p id="7120" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">以下工作领域可以理解为索引优化:</p><ul class=""><li id="7207" class="lq lr it kw b kx ky la lb ld ls lh lt ll lu lp lv lw lx ly bi translated">缺失索引的创建</li><li id="c49b" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">重叠索引的删除</li><li id="6484" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">删除未使用的索引</li><li id="fd74" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">更改现有索引，以适应随时间变化的操作条件(键列的结构、包含列的结构以及索引本身的属性)</li><li id="3b30" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">在随时间变化的操作条件下，删除那些维护成本明显大于其优化收益的指标</li><li id="b33a" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">索引重组和重建。</li></ul><h1 id="5d4a" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated"><strong class="ak"> SQL Server 索引分析</strong></h1><p id="b0bc" class="pw-post-body-paragraph ku kv it kw b kx mw ju kz la mx jx lc ld my lf lg lh mz lj lk ll na ln lo lp im bi translated">借助以下查询，可以分析数据库中的索引碎片级别:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="ca35" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">将返回以下列:</p><ol class=""><li id="7602" class="lq lr it kw b kx ky la lb ld ls lh lt ll lu lp nd lw lx ly bi translated"><strong class="kw iu">数据库</strong> —数据库名称</li><li id="91bb" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp nd lw lx ly bi translated"><strong class="kw iu">模式</strong> —模式对象(表，视图)</li><li id="3371" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp nd lw lx ly bi translated"><strong class="kw iu"> tb </strong> —索引所在的表/视图</li><li id="9b84" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp nd lw lx ly bi translated"><strong class="kw iu"> idx </strong> —索引 ID</li><li id="766d" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp nd lw lx ly bi translated"><strong class="kw iu">数据库标识</strong> —数据库标识</li><li id="4392" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp nd lw lx ly bi translated"><strong class="kw iu">索引名称</strong> —索引名称</li><li id="84f9" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp nd lw lx ly bi translated"><strong class="kw iu">指标类型 desc </strong> —指标类型描述</li><li id="a7b0" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp nd lw lx ly bi translated"><strong class="kw iu"> object_id </strong> —索引所在的对象 id(表、视图)</li><li id="5637" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp nd lw lx ly bi translated"><strong class="kw iu"> frag_num </strong> —分配单元最后一级的片段数</li><li id="00dc" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp nd lw lx ly bi translated"><strong class="kw iu"> frag </strong> —所有页面使用的可用磁盘空间的平均百分比</li><li id="cc61" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp nd lw lx ly bi translated"><strong class="kw iu"> frag_page </strong> —在分配单元 IN_ROW_DATA 的最后一级的一个片段中的平均页数</li><li id="5d15" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp nd lw lx ly bi translated"><strong class="kw iu">页</strong> —索引页或数据的总数</li></ol><p id="3414" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这显示了大小不小于 1 个区(8 页)且碎片超过 10%的索引的碎片级别。它只适用于带有聚集索引的表，并且只考虑根索引。该查询使用两种系统视图:</p><ol class=""><li id="9667" class="lq lr it kw b kx ky la lb ld ls lh lt ll lu lp nd lw lx ly bi translated"><a class="ae ne" href="https://docs.microsoft.com/en-us/sql/relational-databases/system-dynamic-management-views/sys-dm-db-index-physical-stats-transact-sql?view=sql-server-2017" rel="noopener ugc nofollow" target="_blank"><strong class="kw iu">sys . DM _ db _ index _ physical _ stats</strong></a>—返回 SQL Server 中指定表或视图的数据和索引的大小和碎片信息。</li><li id="2a78" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp nd lw lx ly bi translated"><a class="ae ne" href="https://docs.microsoft.com/en-us/sql/relational-databases/system-catalog-views/sys-indexes-transact-sql?view=sql-server-2017" rel="noopener ugc nofollow" target="_blank"><strong class="kw iu">sys . indexes</strong></a>—包含表对象(如表、视图或表值函数)的每个索引或堆的一行。</li></ol><p id="303b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">接下来，让我们考虑何时推荐索引优化以及如何执行索引优化。</p><h1 id="3793" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated"><strong class="ak"> SQL Server 索引优化</strong></h1><p id="ee27" class="pw-post-body-paragraph ku kv it kw b kx mw ju kz la mx jx lc ld my lf lg lh mz lj lk ll na ln lo lp im bi translated">在上一个查询中，有两个指标特别重要:</p><ol class=""><li id="6fc1" class="lq lr it kw b kx ky la lb ld ls lh lt ll lu lp nd lw lx ly bi translated">frag —索引碎片的级别，以百分比表示</li><li id="a1c4" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp nd lw lx ly bi translated">页面-索引总页数的大小</li></ol><p id="502c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">有不同的方法来解释索引碎片的级别和索引优化方法。本文将考虑其中之一。</p><p id="f8f1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在以下情况下，需要优化索引:</p><ul class=""><li id="056e" class="lq lr it kw b kx ky la lb ld ls lh lt ll lu lp lv lw lx ly bi translated">其大小超过 8 页，碎片化程度超过 30%。</li><li id="8c1f" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">它的大小超过 64 页，碎片程度超过 25%。</li><li id="a2f7" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">它的大小超过 1 000 页，碎片程度超过 20%。</li><li id="d138" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">它的大小超过 10 000 页，碎片程度超过 15%。</li><li id="bd2b" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">它的大小超过 100，00 0 页，碎片程度超过 10%。</li></ul><p id="9798" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">有两种方法可用于索引优化:</p><p id="2759" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu"> 1。</strong> <strong class="kw iu">指标重组</strong></p><p id="71c4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">索引重组需要最少的系统资源。在重组过程中，表和视图中的聚集索引和非聚集索引的叶级通过叶级页的物理重组进行碎片整理。因此，它们按照叶节点的逻辑顺序排列(从左到右)。此外，重组会压缩索引页。它们的压缩是根据填充因子的当前值执行的。<br/>您可以借助以下命令执行索引重组:</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="f000" class="nk mf it ng b gy nl nm l nn no">ALTER INDEX &lt; index_name&gt; ON &lt;schema&gt;.&lt;table&gt; REORGANIZE;</span></pre><p id="2573" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu"> 2。索引重建</strong></p><p id="e963" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">重建会删除旧索引并创建新索引。这消除了碎片，通过将页压缩到指定或现有的填充因子来恢复磁盘空间，对连续页中的索引行进行重新排序，并更新新的索引统计信息。<br/>您可以借助以下命令执行索引重建:</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="16bc" class="nk mf it ng b gy nl nm l nn no">ALTER INDEX &lt; index_name&gt; ON &lt;schema&gt;.&lt;table&gt; REBUILD;</span></pre><p id="6f7f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果您的 MS SQL Server 版本支持，索引重建可以在线完成:</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="2063" class="nk mf it ng b gy nl nm l nn no">ALTER INDEX &lt;index_name&gt; ON &lt;schema&gt;.&lt;table&gt; REBUILD WITH(ONLINE=ON);</span></pre><p id="d869" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">更多关于改变索引命令的信息可以在<a class="ae ne" href="https://docs.microsoft.com/en-us/sql/t-sql/statements/alter-index-transact-sql?view=sql-server-2017" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="f657" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">有许多免费和收费的索引优化工具。例如，<a class="ae ne" href="https://www.linkedin.com/in/sergeysyrovatchenko/" rel="noopener ugc nofollow" target="_blank">Sergey syrovacthenko</a>正在开发一个相当强大且免费的<a class="ae ne" href="https://github.com/sergeysyrovatchenko/SQLIndexManager" rel="noopener ugc nofollow" target="_blank">工具</a>用于优化索引。<br/>该工具的优点如下:</p><ul class=""><li id="8d04" class="lq lr it kw b kx ky la lb ld ls lh lt ll lu lp lv lw lx ly bi translated">获取碎片索引的优化算法</li><li id="c143" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">能够在一个流程中同时服务多个数据库</li><li id="059b" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">基于所选设置为索引自动选择操作</li><li id="1e73" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">支持全局搜索和高级过滤，以实现更好的分析</li><li id="9704" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">许多关于索引的设置和有用信息</li><li id="e16d" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">索引维护脚本的自动生成</li><li id="c0fd" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">支持堆和列索引维护</li><li id="b850" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">能够启用索引压缩和统计数据更新，而不是重建</li><li id="128e" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp lv lw lx ly bi translated">支持 SQL Server 2008 和更高版本的所有版本，以及 Azure SQL 数据库。</li></ul><p id="886c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">关于该工具的详细讨论可以在这里找到<a class="ae ne" href="https://www.sql.ru/forum/1312218-1/sql-index-manager-besplatnaya-utilita-po-obsluzhivaniu-indeksov-dlya-sql-server-i-azure" rel="noopener ugc nofollow" target="_blank">。</a></p><h1 id="10ce" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated"><strong class="ak">统计分析和优化</strong></h1><p id="d25a" class="pw-post-body-paragraph ku kv it kw b kx mw ju kz la mx jx lc ld my lf lg lh mz lj lk ll na ln lo lp im bi translated">让我们考虑一种确定过时统计数据的方法:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="6899" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在给出的方法中，过时统计数据由以下指标确定:</p><ol class=""><li id="6075" class="lq lr it kw b kx ky la lb ld ls lh lt ll lu lp nd lw lx ly bi translated">如果数据发生了重大变化。</li><li id="2286" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp nd lw lx ly bi translated">如果统计数据很长时间没有更新。</li><li id="419e" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp nd lw lx ly bi translated">如果对象大小小于指定的最大值或未指定该最大值。</li><li id="844b" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp nd lw lx ly bi translated">如果区段中的行数小于指定的最大值或未指定此最大值。</li></ol><p id="a401" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">查询中使用了以下系统视图:</p><ol class=""><li id="6fa9" class="lq lr it kw b kx ky la lb ld ls lh lt ll lu lp nd lw lx ly bi translated"><a class="ae ne" href="https://docs.microsoft.com/en-us/sql/relational-databases/system-dynamic-management-views/sys-dm-db-partition-stats-transact-sql?view=sql-server-2017" rel="noopener ugc nofollow" target="_blank"><strong class="kw iu">sys . DM _ db _ partition _ stats</strong></a>—返回当前数据库所有部分的页数和行数信息。</li><li id="179a" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp nd lw lx ly bi translated"><a class="ae ne" href="https://docs.microsoft.com/en-us/sql/relational-databases/system-catalog-views/sys-objects-transact-sql?view=sql-server-2017" rel="noopener ugc nofollow" target="_blank"> <strong class="kw iu"> sys.objects </strong> </a> —数据库对象。</li><li id="1e12" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp nd lw lx ly bi translated"><a class="ae ne" href="https://docs.microsoft.com/en-us/sql/relational-databases/system-catalog-views/sys-stats-transact-sql?view=sql-server-2017" rel="noopener ugc nofollow" target="_blank"> <strong class="kw iu"> sys.stats </strong> </a> —表、索引和索引视图的统计信息。</li><li id="96fc" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp nd lw lx ly bi translated"><a class="ae ne" href="https://docs.microsoft.com/en-us/sql/relational-databases/system-catalog-views/sys-indexes-transact-sql?view=sql-server-2017" rel="noopener ugc nofollow" target="_blank"> <strong class="kw iu">系统索引</strong> </a> —索引。</li><li id="9200" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp nd lw lx ly bi translated"><a class="ae ne" href="https://docs.microsoft.com/en-us/sql/relational-databases/system-dynamic-management-views/sys-dm-db-stats-properties-transact-sql?view=sql-server-2017" rel="noopener ugc nofollow" target="_blank"><strong class="kw iu">sys . DM _ db _ stats _ properties</strong></a>—从当前 SQL Server 数据库返回指定数据库对象(表或索引视图)的统计属性。</li><li id="34c2" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp nd lw lx ly bi translated"><a class="ae ne" href="https://docs.microsoft.com/en-us/sql/relational-databases/system-catalog-views/sys-stats-columns-transact-sql?view=sql-server-2017" rel="noopener ugc nofollow" target="_blank"><strong class="kw iu">【sys . stats _ columns】</strong></a>—sys . stats 统计数据中的每一列对应一行。</li><li id="7a88" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp nd lw lx ly bi translated"><a class="ae ne" href="https://docs.microsoft.com/en-us/sql/relational-databases/system-catalog-views/sys-columns-transact-sql?view=sql-server-2017" rel="noopener ugc nofollow" target="_blank"> <strong class="kw iu"> sys.columns </strong> </a> —所有带列对象的列。</li><li id="c829" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp nd lw lx ly bi translated"><a class="ae ne" href="https://docs.microsoft.com/en-us/sql/relational-databases/system-catalog-views/sys-types-transact-sql?view=sql-server-2017" rel="noopener ugc nofollow" target="_blank"><strong class="kw iu"/></a>—数据类型。</li></ol><p id="9b98" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">使用以下命令可以进一步优化统计信息:</p><pre class="kj kk kl km gt nf ng nh ni aw nj bi"><span id="b38e" class="nk mf it ng b gy nl nm l nn no">IF (EXISTS(SELECT TOP(1) 1 FROM sys.stats AS s WHERE s.[object_id]=&lt;object_id&gt; AND s.[stats_id]=&lt;stats_id&gt;))</span><span id="0f8f" class="nk mf it ng b gy np nm l nn no">UPDATE STATISTICS &lt;SchemaName&gt;.&lt;ObjectName&gt; (&lt;StatName&gt;) WITH FULLSCAN;</span></pre><p id="9d15" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">关于更新统计命令的更多信息可在<a class="ae ne" href="https://docs.microsoft.com/en-us/sql/t-sql/statements/update-statistics-transact-sql?view=sql-server-2017" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="d6f8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">db forge Studio for SQL Server 中的索引分析和优化示例</strong></p><p id="48b6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在<a class="ae ne" href="https://www.devart.com/dbforge/sql/studio/features.html?utm_source=towardsdatascience.com&amp;utm_medium=referral&amp;utm_campaign=articlesqlindex" rel="noopener ugc nofollow" target="_blank">db forge Studio for SQL Server</a>中，可以分析和优化索引碎片的级别。产品<a class="ae ne" href="https://www.devart.com/dbforge/sql/index-manager/?utm_source=towardsdatascience.com&amp;utm_medium=referral&amp;utm_campaign=articlesqlindex" rel="noopener ugc nofollow" target="_blank"> dbForge 索引管理器</a>也有这个功能。</p><p id="eb48" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在这个例子中，我们将考虑为 MS SQL Server DBMS 服务的<a class="ae ne" href="https://github.com/jobgemws/Projects-MS-SQL-Server-DBA/tree/master/SRV" rel="noopener ugc nofollow" target="_blank"> SRV 数据库</a>。</p><p id="4e0f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这个 SRV 数据库是出于任何目的免费分发的。打开 studio 后，单击“管理”选项卡上的“管理索引碎片”按钮:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/8974f4712af166784b4653ad86cc9a5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_cNEWati6f0NA5PjH-khSQ.jpeg"/></div></div><figcaption class="nr ns gj gh gi nt nu bd b be z dk"><em class="nv">“Manage Index Fragmentation…” selection on the “Administration” tab.</em></figcaption></figure><p id="a92c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在打开的窗口中，选择服务器并单击“选项”来配置设置:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/651e8c257c1d5cf14366327a97bde41b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7-xkJ0Vc2L_2kzU_rh_heA.jpeg"/></div></div><figcaption class="nr ns gj gh gi nt nu bd b be z dk"><em class="nv">Server selection and settings configuration.</em></figcaption></figure><p id="e6b8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在出现的选项窗口中，设定所需的参数:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/85166a6c44c6d6b16ef70f94906a674b.png" data-original-src="https://miro.medium.com/v2/resize:fit:878/format:webp/1*q2Ga_iZbnaUK8XAW-2m1-w.jpeg"/></div><figcaption class="nr ns gj gh gi nt nu bd b be z dk"><em class="nv">Indexes optimization options.</em></figcaption></figure><p id="4f1d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">通过点击左下角的按钮“保存命令行…”可以将设置结果保存为 bat 文件。你可以通过点击右下角的按钮“恢复默认值”来重置为默认设置。</p><p id="90b0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">接下来，单击“确定”。</p><p id="0cb6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在选择您需要的数据库:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/09056238e7d5f6dde09ec9361ae945b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yDo-CKVfKV4EY4iS2OPmsw.jpeg"/></div></div><figcaption class="nr ns gj gh gi nt nu bd b be z dk"><em class="nv">Database selection.</em></figcaption></figure><p id="a8bc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">之后，分析就开始了。您也可以通过点击“重新分析”按钮来更新分析。</p><p id="798c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">分析完成后，选择所需的优化索引:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/bd7417048a5038b2f69cd39fcf7b2cd1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LHmLL9EPL6rTf4-C-dYtAw.jpeg"/></div></div><figcaption class="nr ns gj gh gi nt nu bd b be z dk"><em class="nv">Selection of indexes for optimization.</em></figcaption></figure><p id="3d62" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">请注意，可以通过单击“导出到 CSV …”按钮将分析结果下载为 CSV 文件。</p><p id="b8ef" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">此外，可以通过多种方式进行优化:</p><ol class=""><li id="dcac" class="lq lr it kw b kx ky la lb ld ls lh lt ll lu lp nd lw lx ly bi translated">在新的 studio 窗口中生成脚本(在“脚本更改”菜单中选择“到新的 SQL 窗口”)。</li><li id="308d" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp nd lw lx ly bi translated">将脚本生成到剪贴板(在“脚本更改”菜单中选择“到剪贴板”)。</li><li id="314f" class="lq lr it kw b kx lz la ma ld mb lh mc ll md lp nd lw lx ly bi translated">直接运行优化(单击“修复”按钮)。</li></ol><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/8dc8b7466918262fbe2ba29a8eb6af1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ce28a167waMBszUF_pQHLw.jpeg"/></div></div></figure><p id="fd92" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们选择第三种方法—单击“修复”按钮。</p><p id="0a3a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">优化过程完成后，您需要再次单击“重新分析”按钮:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/bbb4beb041033d45c81f210204020a55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jg8e-mZhHfGy-fk7d82Cog.jpeg"/></div></div><figcaption class="nr ns gj gh gi nt nu bd b be z dk"><em class="nv">Analysis after indexes optimization.</em></figcaption></figure><h1 id="a910" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated"><strong class="ak">结论</strong></h1><p id="3f4a" class="pw-post-body-paragraph ku kv it kw b kx mw ju kz la mx jx lc ld my lf lg lh mz lj lk ll na ln lo lp im bi translated">对指标碎片化程度和随后优化的统计数据过时程度进行了分析。从上面的例子中还可以清楚地看到，<a class="ae ne" href="https://www.devart.com/dbforge/sql/studio/features.html?utm_source=towardsdatascience.com&amp;utm_medium=referral&amp;utm_campaign=articlesqlindex" rel="noopener ugc nofollow" target="_blank"> dbForge 索引管理器工具</a>允许您快速分析索引碎片的级别，并生成数据库索引优化脚本。</p></div></div>    
</body>
</html>