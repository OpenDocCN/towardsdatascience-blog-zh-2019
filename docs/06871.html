<html>
<head>
<title>Create An API To Deploy Machine Learning Models Using Flask and Heroku</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Flask 和 Heroku 创建一个 API 来部署机器学习模型</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/create-an-api-to-deploy-machine-learning-models-using-flask-and-heroku-67a011800c50?source=collection_archive---------4-----------------------#2019-09-30">https://towardsdatascience.com/create-an-api-to-deploy-machine-learning-models-using-flask-and-heroku-67a011800c50?source=collection_archive---------4-----------------------#2019-09-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/30036332da6a4ce1564b2685161ad33a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*htZ1upSuWKd_PHJMy_3LYw.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk"><em class="kf">Photo by </em><a class="ae kg" href="https://unsplash.com/@ihs_photo?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"><em class="kf">Ian Simmonds</em></a><em class="kf"> on </em><a class="ae kg" href="https://unsplash.com/s/photos/ship?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"><em class="kf">Unsplash</em></a></figcaption></figure><p id="e2b1" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">机器学习模型是基于可用数据进行预测的强大工具。为了使这些模型有用，需要部署它们，以便其他人可以通过 API(应用程序编程接口)轻松访问它们来进行预测。这可以使用<a class="ae kg" href="https://flask.palletsprojects.com/en/1.1.x/" rel="noopener ugc nofollow" target="_blank"> Flask </a>和<a class="ae kg" href="https://www.heroku.com" rel="noopener ugc nofollow" target="_blank"> Heroku </a>来完成——Flask 是一个微型 web 框架，不需要特定的工具或库来创建 web 应用程序，Heroku 是一个可以托管 web 应用程序的云平台。</p><p id="24a8" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">要使用 Flask 和 Heroku 成功部署机器学习模型，您需要以下文件:model.pkl、app.py、requirements.txt 和一个 Procfile。本文将介绍如何创建这些所需的文件，并最终在 Heroku 上部署应用程序。该员额的主要部分如下:</p><ul class=""><li id="b74a" class="lf lg it kj b kk kl ko kp ks lh kw li la lj le lk ll lm ln bi translated">创建 GitHub 存储库(可选)</li><li id="eb0e" class="lf lg it kj b kk lo ko lp ks lq kw lr la ls le lk ll lm ln bi translated">使用大量数据创建和筛选模型</li><li id="1e0d" class="lf lg it kj b kk lo ko lp ks lq kw lr la ls le lk ll lm ln bi translated">创建烧瓶应用程序</li><li id="3727" class="lf lg it kj b kk lo ko lp ks lq kw lr la ls le lk ll lm ln bi translated">本地测试烧瓶应用程序(可选)</li><li id="57f7" class="lf lg it kj b kk lo ko lp ks lq kw lr la ls le lk ll lm ln bi translated">部署到 Heroku</li><li id="44f9" class="lf lg it kj b kk lo ko lp ks lq kw lr la ls le lk ll lm ln bi translated">测试工作应用程序</li></ul><p id="ad95" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">根据您在流程中所处的阶段，您可以随意跳过其中任何一项！</p></div><div class="ab cl lt lu hx lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="im in io ip iq"><h1 id="b48c" class="ma mb it bd mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx bi translated">创建 Github 存储库(可选)</h1><p id="b4e1" class="pw-post-body-paragraph kh ki it kj b kk my km kn ko mz kq kr ks na ku kv kw nb ky kz la nc lc ld le im bi translated">为了便于以后在 Heroku 上部署，您需要为这个项目创建一个 github 存储库，并克隆它以供本地使用。要创建新的存储库，请单击右上角的个人资料图标，单击“存储库”，然后单击“新建”。为您的存储库命名，使用自述文件初始化存储库，并添加一个许可证，如下例所示:</p><figure class="ne nf ng nh gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nd"><img src="../Images/fad9d19dc048ea377916954efb611f36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TyQU_VFiBkYAAl6DwsQqhA.png"/></div></div></figure><p id="6af9" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">要克隆存储库，请转到存储库页面，单击“克隆或下载”并复制链接。在终端中，转到要克隆存储库的文件夹，并键入命令:</p><pre class="ne nf ng nh gt ni nj nk nl aw nm bi"><span id="59f5" class="nn mb it nj b gy no np l nq nr">git clone link_to_repository</span></pre><p id="3d9b" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">运行此命令会将存储库克隆到您的本地计算机上，您可以检查以确保文件夹是在正确的位置创建的。既然回购已经设置好了，我们就可以创建机器学习模型并对其进行处理了。</p><h1 id="9424" class="ma mb it bd mc md ns mf mg mh nt mj mk ml nu mn mo mp nv mr ms mt nw mv mw mx bi translated">创建和筛选机器学习模型</h1><p id="8509" class="pw-post-body-paragraph kh ki it kj b kk my km kn ko mz kq kr ks na ku kv kw nb ky kz la nc lc ld le im bi translated">首先，让我们使用 Titanic 数据集创建一个简单的逻辑回归模型。根据阶级、年龄、兄弟姐妹数量和票价等信息，该模型将预测是否有人在泰坦尼克号上幸存。如果你想了解我的例子，你可以在这里找到数据集<a class="ae kg" href="https://github.com/elizabethts/deploy-mlm-flask-heroku/blob/master/titanic.csv" rel="noopener ugc nofollow" target="_blank">的 csv 文件。在您的工作目录中创建一个 Jupyter 笔记本，并通过运行以下代码创建模型:</a></p><pre class="ne nf ng nh gt ni nj nk nl aw nm bi"><span id="7286" class="nn mb it nj b gy no np l nq nr">import pandas as pd<br/>from sklearn.linear_model import LogisticRegression</span><span id="2085" class="nn mb it nj b gy nx np l nq nr"># create df<br/>train = pd.read_csv('titanic.csv') # change file path</span><span id="25a5" class="nn mb it nj b gy nx np l nq nr"># drop null values<br/>train.dropna(inplace=True)</span><span id="c392" class="nn mb it nj b gy nx np l nq nr"># features and target<br/>target = 'Survived'<br/>features = ['Pclass', 'Age', 'SibSp', 'Fare']</span><span id="733e" class="nn mb it nj b gy nx np l nq nr"># X matrix, y vector<br/>X = train[features]<br/>y = train[target]</span><span id="c06c" class="nn mb it nj b gy nx np l nq nr"># model <br/>model = LogisticRegression()<br/>model.fit(X, y)<br/>model.score(X, y)</span></pre><p id="0c3a" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">上面的代码从 csv 数据创建了一个 pandas dataframe，删除了空值，定义了模型的特征和目标，将数据拆分为一个只包含特征的矩阵和一个包含目标的向量，并拟合逻辑回归模型，然后对其进行评分。</p><p id="8b35" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">这就创建了一个模型，它可以以大约 70%的准确率预测泰坦尼克号乘客的存活率，然后可以使用:</p><pre class="ne nf ng nh gt ni nj nk nl aw nm bi"><span id="dc0d" class="nn mb it nj b gy no np l nq nr">import pickle<br/>pickle.dump(model, open(‘model.pkl’, ‘wb’))</span></pre><p id="84af" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">pickle 文件可以在 Jupyter 笔记本的同一个目录中找到。</p><h1 id="3ac3" class="ma mb it bd mc md ns mf mg mh nt mj mk ml nu mn mo mp nv mr ms mt nw mv mw mx bi translated">编写烧瓶应用程序</h1><p id="c747" class="pw-post-body-paragraph kh ki it kj b kk my km kn ko mz kq kr ks na ku kv kw nb ky kz la nc lc ld le im bi translated">打开您的 IDE(我使用 PyCharm)并创建一个新的。工作目录中的 py 文件名为<code class="fe ny nz oa nj b">app.py</code></p><figure class="ne nf ng nh gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ob"><img src="../Images/0b84ba9c053d1d2244e2917d1c3d80b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*en3UejWtruI8cTTXbeYdww.png"/></div></div></figure><p id="665e" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">flask 应用程序的代码可以在下面找到(python v3.7 版)。</p><pre class="ne nf ng nh gt ni nj nk nl aw nm bi"><span id="fbdd" class="nn mb it nj b gy no np l nq nr"><strong class="nj iu">import </strong>pandas <strong class="nj iu">as </strong>pd<br/><strong class="nj iu">from </strong>flask <strong class="nj iu">import </strong>Flask, jsonify, request<br/><strong class="nj iu">import </strong>pickle<br/><br/><em class="oc"># load model<br/></em>model = pickle.load(open(<strong class="nj iu">'model.pkl'</strong>,<strong class="nj iu">'rb'</strong>))<br/><br/><em class="oc"># app<br/></em>app = Flask(__name__)<br/><br/><em class="oc"># routes<br/></em>@app.route(<strong class="nj iu">'/'</strong>, methods=[<strong class="nj iu">'POST'</strong>])<br/><br/><strong class="nj iu">def </strong>predict():<br/>    <em class="oc"># get data<br/>    </em>data = request.get_json(force=<strong class="nj iu">True</strong>)<br/><br/>    <em class="oc"># convert data into dataframe<br/>    </em>data.update((x, [y]) <strong class="nj iu">for </strong>x, y <strong class="nj iu">in </strong>data.items())<br/>    data_df = pd.DataFrame.from_dict(data)<br/><br/>    <em class="oc"># predictions<br/>    </em>result = model.predict(data_df)<br/><br/>    <em class="oc"># send back to browser<br/>    </em>output = {<strong class="nj iu">'results'</strong>: int(result[0])}<br/><br/>    <em class="oc"># return data<br/>    </em><strong class="nj iu">return </strong>jsonify(results=output)<br/><br/><strong class="nj iu">if </strong>__name__ == <strong class="nj iu">'__main__'</strong>:<br/>    app.run(port = 5000, debug=<strong class="nj iu">True</strong>)</span></pre><p id="cba9" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated"><strong class="kj iu">代码的结构如下:</strong></p><ul class=""><li id="6f29" class="lf lg it kj b kk kl ko kp ks lh kw li la lj le lk ll lm ln bi translated"><strong class="kj iu">装载酸洗模型</strong></li><li id="9da3" class="lf lg it kj b kk lo ko lp ks lq kw lr la ls le lk ll lm ln bi translated"><strong class="kj iu">命名烧瓶 app </strong></li><li id="4799" class="lf lg it kj b kk lo ko lp ks lq kw lr la ls le lk ll lm ln bi translated"><strong class="kj iu">创建一个接收 JSON 输入的路由，使用训练好的模型进行预测，并以 JSON 格式返回预测，可以通过 API 端点访问。</strong></li></ul><p id="75b2" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">在路由内部，我将 JSON 数据转换为 pandas dataframe 对象，因为我发现这适用于大多数(不是所有！)您希望用来进行预测的模型类型。您可以选择使用您喜欢的方法来转换输入，只要它与您的模型的<code class="fe ny nz oa nj b">.predict()</code>方法一起工作。输入的顺序必须与用于训练模型的数据帧中的列顺序相匹配，否则在尝试进行预测时会出现错误。如果您正在接收的输入顺序不正确，您可以在创建数据帧后轻松地对其进行重新排序。</p><p id="a118" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated"><strong class="kj iu">这里的要点是，您需要将从请求中获得的 JSON 数据转换成模型可以用来进行预测的数据结构。如何到达那里取决于你自己。</strong></p><p id="cfa4" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">一旦将它粘贴到 app.py 文件中，您就可以从命令行运行 flask 应用程序(或者如果您使用 PyCharm，只需运行代码)。要从命令行运行应用程序，请使用:</p><pre class="ne nf ng nh gt ni nj nk nl aw nm bi"><span id="34c0" class="nn mb it nj b gy no np l nq nr">python app.py</span></pre><p id="42c4" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">如果操作正确，您将看到类似这样的内容:</p><figure class="ne nf ng nh gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi od"><img src="../Images/f35510440f5e674a587a6c2ab288af44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PR2lkCp8_tATkYIJAnVeaA.png"/></div></div></figure><blockquote class="oe of og"><p id="dbe1" class="kh ki oc kj b kk kl km kn ko kp kq kr oh kt ku kv oi kx ky kz oj lb lc ld le im bi translated">错误提示:如果这是您第一次创建 flask 应用程序，您可能会得到一个错误提示，提示您需要将 flask 安装到 python 环境中。使用<code class="fe ny nz oa nj b">!pip install flask</code>并重试。</p></blockquote><p id="9e45" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">当你的 flask 应用程序启动并运行时，点击蓝色链接，你应该会看到这个——这很正常:</p><figure class="ne nf ng nh gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ok"><img src="../Images/1e2d15f9279b706ad42e45ef6f95c3cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cUoMWCv7q79-a4S2OXLT0A.png"/></div></div></figure><h2 id="9504" class="nn mb it bd mc ol om dn mg on oo dp mk ks op oq mo kw or os ms la ot ou mw ov bi translated">可选的，<em class="kf">但是你真的应该</em>:测试应用程序是否工作</h2><p id="5367" class="pw-post-body-paragraph kh ki it kj b kk my km kn ko mz kq kr ks na ku kv kw nb ky kz la nc lc ld le im bi translated">将<code class="fe ny nz oa nj b">requests</code>和<code class="fe ny nz oa nj b">json</code>导入到你的 Jupyter 笔记本中，然后用你的本地服务器创建一个变量，如果它与下面的不同:</p><pre class="ne nf ng nh gt ni nj nk nl aw nm bi"><span id="8d99" class="nn mb it nj b gy no np l nq nr"># local url<br/>url = '<a class="ae kg" href="http://127.0.0.1:5000'" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:5000'</a> # change to your url</span></pre><p id="ec97" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">创建示例数据并转换为 JSON:</p><pre class="ne nf ng nh gt ni nj nk nl aw nm bi"><span id="775a" class="nn mb it nj b gy no np l nq nr"># sample data<br/>data = {'Pclass': 3<br/>      , 'Age': 2<br/>      , 'SibSp': 1<br/>      , 'Fare': 50}</span><span id="21c8" class="nn mb it nj b gy nx np l nq nr">data = json.dumps(data)</span></pre><p id="7f6e" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">使用<code class="fe ny nz oa nj b">requests.post(url, data)</code>发布样本数据并检查响应代码。您希望获得 200 的响应代码，以确保应用程序正常工作:</p><figure class="ne nf ng nh gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ow"><img src="../Images/b208ac416c3766cd49d98f4e4a782737.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UtxTNEWkqg4miQtiR8e0uQ.png"/></div></div></figure><p id="0e8e" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">然后您可以打印请求的 JSON 来查看模型的预测:</p><figure class="ne nf ng nh gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ox"><img src="../Images/a40d64650e2dcaa192b4bae1773e60c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CnaA0GH4PIevdvdIkMueYA.png"/></div></div></figure><p id="ebd9" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">模型预测值为 1，这意味着乘客生还🙌</p><p id="e742" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">完成测试后，按 ctrl+c 关闭 flask 应用程序。</p><h1 id="e9a4" class="ma mb it bd mc md ns mf mg mh nt mj mk ml nu mn mo mp nv mr ms mt nw mv mw mx bi translated">创建 Procfile</h1><p id="cacc" class="pw-post-body-paragraph kh ki it kj b kk my km kn ko mz kq kr ks na ku kv kw nb ky kz la nc lc ld le im bi translated">Procfile 指定了 Heroku 应用程序在启动时执行的命令。要创建一个，在工作目录中打开一个名为 Procfile(没有扩展名)的新文件，并粘贴以下内容。</p><pre class="ne nf ng nh gt ni nj nk nl aw nm bi"><span id="43ff" class="nn mb it nj b gy no np l nq nr">web: gunicorn app:app</span></pre><p id="3cdf" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">仅此而已。保存并关闭。✅</p><h1 id="077d" class="ma mb it bd mc md ns mf mg mh nt mj mk ml nu mn mo mp nv mr ms mt nw mv mw mx bi translated">创建需求. txt</h1><p id="ded2" class="pw-post-body-paragraph kh ki it kj b kk my km kn ko mz kq kr ks na ku kv kw nb ky kz la nc lc ld le im bi translated">requirements.txt 文件将包含 flask 应用程序的所有依赖项。要创建 requirements.txt，请在终端的工作目录下运行以下命令:</p><pre class="ne nf ng nh gt ni nj nk nl aw nm bi"><span id="c06e" class="nn mb it nj b gy no np l nq nr">pip freeze &gt; requirements.txt</span></pre><p id="05fe" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">如果您不是在一个新的环境中工作，这个文件将包含您当前环境中的所有需求。如果您稍后在部署应用程序时遇到错误，您可以删除导致错误的需求。</p><p id="db7a" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">对于这个项目，requirements.txt 至少应该包含:</p><pre class="ne nf ng nh gt ni nj nk nl aw nm bi"><span id="882f" class="nn mb it nj b gy no np l nq nr"><strong class="nj iu">Flask</strong>==<strong class="nj iu">1.1.1<br/>gunicorn</strong>==<strong class="nj iu">19.9.0<br/>pandas</strong>==<strong class="nj iu">0.25.0<br/>requests</strong>==<strong class="nj iu">2.22.0<br/>scikit-learn</strong>==<strong class="nj iu">0.21.2<br/>scipy</strong>==<strong class="nj iu">1.3.1</strong></span></pre><h2 id="40c8" class="nn mb it bd mc ol om dn mg on oo dp mk ks op oq mo kw or os ms la ot ou mw ov bi translated">可选项:将文件提交到 GitHub</h2><p id="7847" class="pw-post-body-paragraph kh ki it kj b kk my km kn ko mz kq kr ks na ku kv kw nb ky kz la nc lc ld le im bi translated">运行以下命令将文件提交给 git:</p><pre class="ne nf ng nh gt ni nj nk nl aw nm bi"><span id="47fa" class="nn mb it nj b gy no np l nq nr"># add all files from the working directory<br/>git add .</span></pre><p id="fff7" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">然后提交您的信息:</p><pre class="ne nf ng nh gt ni nj nk nl aw nm bi"><span id="0a1d" class="nn mb it nj b gy no np l nq nr">git commit -m 'add flask files'</span></pre><p id="5e27" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">最后，使用下面的命令将更改推送到 Github。可能会要求您输入您的 github 用户名和密码。如果您设置了 2FA，您将需要您的密钥作为密码。</p><pre class="ne nf ng nh gt ni nj nk nl aw nm bi"><span id="4854" class="nn mb it nj b gy no np l nq nr">git push origin master</span></pre><p id="e0a5" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">至少，您的 Github repo 现在应该包含:</p><ul class=""><li id="a4bd" class="lf lg it kj b kk kl ko kp ks lh kw li la lj le lk ll lm ln bi translated">app.py</li><li id="4951" class="lf lg it kj b kk lo ko lp ks lq kw lr la ls le lk ll lm ln bi translated">model.pkl</li><li id="3544" class="lf lg it kj b kk lo ko lp ks lq kw lr la ls le lk ll lm ln bi translated">Procfile</li><li id="9528" class="lf lg it kj b kk lo ko lp ks lq kw lr la ls le lk ll lm ln bi translated">requirements.txt</li></ul><p id="9f54" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated"><strong class="kj iu">注意:所有这些文件都应该在工作目录级别，而不是在另一个文件夹中</strong></p><h1 id="7151" class="ma mb it bd mc md ns mf mg mh nt mj mk ml nu mn mo mp nv mr ms mt nw mv mw mx bi translated">部署到 Heroku</h1><p id="0410" class="pw-post-body-paragraph kh ki it kj b kk my km kn ko mz kq kr ks na ku kv kw nb ky kz la nc lc ld le im bi translated">如果您还没有，请在<a class="ae kg" href="https://www.heroku.com" rel="noopener ugc nofollow" target="_blank">www.heroku.com</a>创建一个免费账户。</p><p id="ce64" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">只需选择名称并点击“创建应用”即可创建新应用。这个名称并不重要，但它必须是唯一的。</p><figure class="ne nf ng nh gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nd"><img src="../Images/515a49fb7383b619bd277840f9d15794.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sxdv_ZekwYGOkk9CUImq9Q.png"/></div></div></figure><p id="1ba8" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">对于部署应用程序的方式，您有几个选项。我试过 Heroku CLI 和 GitHub，我个人更喜欢 GitHub…但是我会把两个都展示出来，所以挑一个你想看的。</p><h2 id="2617" class="nn mb it bd mc ol om dn mg on oo dp mk ks op oq mo kw or os ms la ot ou mw ov bi translated">使用 Github 部署</h2><p id="8d23" class="pw-post-body-paragraph kh ki it kj b kk my km kn ko mz kq kr ks na ku kv kw nb ky kz la nc lc ld le im bi translated">点击下面的 github 图标，连接您的 github 帐户:</p><figure class="ne nf ng nh gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oy"><img src="../Images/9a82e423c10faa2f60f108494e458a1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JphSgDlMHO4c73YLQ4xHBw.png"/></div></div></figure><p id="4ba1" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">搜索正确的存储库，然后单击连接:</p><figure class="ne nf ng nh gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oz"><img src="../Images/be25af5ec43a468c513e2c892165d0c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uUJqgZf0Mc1AZ5V0rCLwKQ.png"/></div></div></figure><p id="64e7" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">然后滚动到页面底部，单击“部署分支”</p><figure class="ne nf ng nh gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ox"><img src="../Images/68bdab299446511f2f341a5bfa5b4ffd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*gQD7pJ0nLnowtA3oS8RIoQ.gif"/></div></div></figure><p id="6fab" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">如果一切正常，您应该会看到这条消息🎉🎉</p><figure class="ne nf ng nh gt ju gh gi paragraph-image"><div class="gh gi pa"><img src="../Images/278abb0e4dba454a38d90e6da165f164.png" data-original-src="https://miro.medium.com/v2/resize:fit:1196/format:webp/1*YiSPT9zgtLmeuNELUqvHng.png"/></div></figure><p id="b41e" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">如果出现问题，请检查您的 requirements.txt，删除给你带来问题的依赖项，然后重试\_(ツ)_/</p><h2 id="adba" class="nn mb it bd mc ol om dn mg on oo dp mk ks op oq mo kw or os ms la ot ou mw ov bi translated">使用 Heroku CLI 部署</h2><p id="4019" class="pw-post-body-paragraph kh ki it kj b kk my km kn ko mz kq kr ks na ku kv kw nb ky kz la nc lc ld le im bi translated">在 Heroku CLI 部分，您将看到部署时需要遵循的说明。将每个命令粘贴到您的终端中，并按照任何提示进行操作，如登录。注意任何需要修改的命令，比如<code class="fe ny nz oa nj b">cd my-project/</code>——其中<code class="fe ny nz oa nj b">my-project/</code>实际上应该是您的项目目录。git remote 应该准确地设置为 Heroku 中的应用程序名称。</p><figure class="ne nf ng nh gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi pb"><img src="../Images/f5563426d2069523137855bab1a67e16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zQnGKH7e3Sh_TGwUkqrJGA.png"/></div></div></figure><p id="7029" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">如果您成功地遵循了这些说明，您应该在 overview 页面上看到 build successful🎉🎉</p><p id="90b4" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">如果没有，您可以通过从命令行运行<code class="fe ny nz oa nj b">heroku logs --tail</code>来检查出了什么问题。</p><h1 id="ae72" class="ma mb it bd mc md ns mf mg mh nt mj mk ml nu mn mo mp nv mr ms mt nw mv mw mx bi translated">测试部署的模型并生成预测</h1><p id="2f22" class="pw-post-body-paragraph kh ki it kj b kk my km kn ko mz kq kr ks na ku kv kw nb ky kz la nc lc ld le im bi translated">如果你已经测试了你的 flask 应用程序，这些说明将会非常相似，除了现在使用 Heroku 应用程序的 url。</p><p id="3b9b" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">在你的 Jupyter 笔记本中导入<code class="fe ny nz oa nj b">requests</code>和<code class="fe ny nz oa nj b">json</code>，然后创建一个变量来存储 Heroku 应用的 url(你可以在 Heroku 上点击应用页面右上角的“打开应用”来找到这个)。然后创建一些示例数据，并将其转换为 JSON:</p><pre class="ne nf ng nh gt ni nj nk nl aw nm bi"><span id="a7fd" class="nn mb it nj b gy no np l nq nr"># heroku url<br/>heroku_url = '<a class="ae kg" href="https://titanic-flask-model.herokuapp.com'" rel="noopener ugc nofollow" target="_blank">https://titanic-flask-model.herokuapp.com'</a> # change to your app name</span><span id="3e94" class="nn mb it nj b gy nx np l nq nr"># sample data<br/>data = {  'Pclass': 3<br/>             , 'Age': 2<br/>             , 'SibSp': 1<br/>             , 'Fare': 50}</span><span id="a9a0" class="nn mb it nj b gy nx np l nq nr">data = json.dumps(data)</span></pre><p id="6685" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">使用以下代码检查响应代码。响应代码 200 表示一切运行正常。</p><pre class="ne nf ng nh gt ni nj nk nl aw nm bi"><span id="8c82" class="nn mb it nj b gy no np l nq nr">send_request = requests.post(heroku_url, data)<br/>print(send_request)</span></pre><p id="c776" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated"><code class="fe ny nz oa nj b">Output: &lt;Response [200]&gt;</code></p><p id="9b1a" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">最后，看看这个模型的预测:</p><pre class="ne nf ng nh gt ni nj nk nl aw nm bi"><span id="e9e3" class="nn mb it nj b gy no np l nq nr">print(send_request.json())</span></pre><p id="cff9" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated"><code class="fe ny nz oa nj b">Output: {‘results’: {‘results’: 1}}</code></p><p id="9d74" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">如果使用不同的样本数据，输出结果会有所不同。在这种情况下，结果为 1 意味着模型预测乘客幸存，更重要的是 API 起作用了！</p><figure class="ne nf ng nh gt ju"><div class="bz fp l di"><div class="pc pd l"/></div></figure><p id="29d4" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">现在，人们可以通过 Heroku URL 访问您的 API 端点，并使用您的模型在现实世界中进行预测🌐</p><p id="8c5f" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">这里是<a class="ae kg" href="https://github.com/elizabethts/deploy-mlm-flask-heroku" rel="noopener ugc nofollow" target="_blank"> github repo </a>，包含部署这个 API 所需的所有文件和代码。</p><p id="541a" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">在 twitter <a class="ae kg" href="http://www.twitter.com/elizabethets" rel="noopener ugc nofollow" target="_blank"> @elizabethets </a>上找到我或者在<a class="ae kg" href="https://www.linkedin.com/in/elizabethts/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上联系我！</p><p id="7da4" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">来源:</p><div class="pe pf gp gr pg ph"><a href="https://flask.palletsprojects.com/en/1.1.x/" rel="noopener  ugc nofollow" target="_blank"><div class="pi ab fo"><div class="pj ab pk cl cj pl"><h2 class="bd iu gy z fp pm fr fs pn fu fw is bi translated">欢迎使用 Flask - Flask 文档(1.1.x)</h2><div class="po l"><h3 class="bd b gy z fp pm fr fs pn fu fw dk translated">欢迎阅读 Flask 的文档。开始安装，然后了解快速入门概述。有…</h3></div><div class="pp l"><p class="bd b dl z fp pm fr fs pn fu fw dk translated">flask.palletsprojects.com</p></div></div><div class="pq l"><div class="pr l ps pt pu pq pv jz ph"/></div></div></a></div><div class="pe pf gp gr pg ph"><a href="https://heroku.com/" rel="noopener  ugc nofollow" target="_blank"><div class="pi ab fo"><div class="pj ab pk cl cj pl"><h2 class="bd iu gy z fp pm fr fs pn fu fw is bi translated">云应用平台| Heroku</h2><div class="po l"><h3 class="bd b gy z fp pm fr fs pn fu fw dk translated">无论您是在构建简单的原型还是关键业务产品，Heroku 的全托管平台都能为您提供…</h3></div><div class="pp l"><p class="bd b dl z fp pm fr fs pn fu fw dk translated">heroku.com</p></div></div><div class="pq l"><div class="pw l ps pt pu pq pv jz ph"/></div></div></a></div><div class="pe pf gp gr pg ph"><a href="https://devcenter.heroku.com/articles/procfile" rel="noopener  ugc nofollow" target="_blank"><div class="pi ab fo"><div class="pj ab pk cl cj pl"><h2 class="bd iu gy z fp pm fr fs pn fu fw is bi translated">Procfile</h2><div class="po l"><h3 class="bd b gy z fp pm fr fs pn fu fw dk translated">Heroku 应用程序包括一个 Procfile，它指定了应用程序在启动时执行的命令。你可以用一个…</h3></div><div class="pp l"><p class="bd b dl z fp pm fr fs pn fu fw dk translated">devcenter.heroku.com</p></div></div><div class="pq l"><div class="px l ps pt pu pq pv jz ph"/></div></div></a></div></div></div>    
</body>
</html>