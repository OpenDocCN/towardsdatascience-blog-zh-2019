<html>
<head>
<title>10 Python Pandas tips to make data analysis faster</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">让数据分析更快的 10 个 Python 熊猫技巧</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/10-python-pandas-tricks-to-make-data-analysis-more-enjoyable-cb8f55af8c30?source=collection_archive---------5-----------------------#2019-04-23">https://towardsdatascience.com/10-python-pandas-tricks-to-make-data-analysis-more-enjoyable-cb8f55af8c30?source=collection_archive---------5-----------------------#2019-04-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/42797167e30156f5a272b3e411367944.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ucjlZMfWcq4e3atUtQltaA.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/photos/COnonhVjy58?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Vashishtha Jogi</a> on <a class="ae kc" href="https://unsplash.com/search/photos/lake?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h2 id="c477" class="kd ke iq bd kf kg kh dn ki kj kk dp kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">1.式样</h2><p id="7a38" class="pw-post-body-paragraph kz la iq lb b lc ld le lf lg lh li lj km lk ll lm kq ln lo lp ku lq lr ls lt ij bi translated">在 Jupyter 笔记本上做<code class="fe lu lv lw lx b">.head()</code>的时候，你有没有抱怨过表格输出看起来很无聊？有没有办法不显示索引(尤其是已经有 ID 列的时候)？有办法解决这些问题。</p><p id="a3c2" class="pw-post-body-paragraph kz la iq lb b lc ly le lf lg lz li lj km ma ll lm kq mb lo lp ku mc lr ls lt ij bi translated"><strong class="lb ir"> A .突出显示数据帧中的所有负值。</strong>(示例修改自<a class="ae kc" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/style.html" rel="noopener ugc nofollow" target="_blank">https://pandas . pydata . org/pandas-docs/stable/user _ guide/style . html</a>)</p><pre class="md me mf mg gt mh lx mi mj aw mk bi"><span id="1a4c" class="kd ke iq lx b gy ml mm l mn mo">import pandas as pd<br/>def color_negative_red(val):<br/>    color = 'red' if val &lt; 0 else 'black'<br/> return 'color: %s' % color</span><span id="296c" class="kd ke iq lx b gy mp mm l mn mo">df = pd.DataFrame(dict(col_1=[1.53,-2.5,3.53], <br/>                       col_2=[-4.1,5.9,0])<br/>                 )<br/>df.style.applymap(color_negative_red)</span></pre><figure class="md me mf mg gt jr gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/4b6263b6ac676e9d39ec7163d9d9a5fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:232/format:webp/1*5bo6KYcrLL-M94WCAkh0cQ.png"/></div></figure><p id="7919" class="pw-post-body-paragraph kz la iq lb b lc ly le lf lg lz li lj km ma ll lm kq mb lo lp ku mc lr ls lt ij bi translated"><strong class="lb ir"> B .隐藏索引。</strong>试试<code class="fe lu lv lw lx b">df.head().style.hide_index()</code>！<br/> <strong class="lb ir"> C .添加悬停效果。</strong>(示例修改自<a class="ae kc" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.io.formats.style.Styler.set_table_styles.html" rel="noopener ugc nofollow" target="_blank">https://pandas . pydata . org/pandas-docs/stable/reference/API/pandas . io . formats . style . styler . set _ table _ styles . html</a>)</p><pre class="md me mf mg gt mh lx mi mj aw mk bi"><span id="feea" class="kd ke iq lx b gy ml mm l mn mo">df = pd.DataFrame(np.random.randn(5, 3))<br/>df.style.set_table_styles(<br/>[{'selector': 'tr:hover',<br/>  'props': [('background-color', 'yellow')]}]<br/>)</span></pre><figure class="md me mf mg gt jr gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/39abec3aaf8c94f7704c12777ba4329a.png" data-original-src="https://miro.medium.com/v2/resize:fit:502/format:webp/1*QJljhjp-loj8ZChihhK7EA.png"/></div></figure><p id="14e1" class="pw-post-body-paragraph kz la iq lb b lc ly le lf lg lz li lj km ma ll lm kq mb lo lp ku mc lr ls lt ij bi translated"><strong class="lb ir"> D .更多 CSS 样式。你可以使用 CSS 来改变表格的外观。</strong></p><pre class="md me mf mg gt mh lx mi mj aw mk bi"><span id="a882" class="kd ke iq lx b gy ml mm l mn mo">df = pd.DataFrame(<br/>dict(departure=['SFO', 'SFO', 'LAX', 'LAX', 'JFK', 'SFO'],<br/>     arrival=['ORD', 'DFW', 'DFW', 'ATL', 'ATL', 'ORD'],<br/>     airlines=['Delta','JetBlue','Delta',’AA','SouthWest',  <br/>               'Delta']),<br/>columns=['airlines', 'departure','arrival'])</span><span id="4ca2" class="kd ke iq lx b gy mp mm l mn mo">df.style.set_table_styles(<br/>[{'selector': 'tr:nth-of-type(odd)',<br/>  'props': [('background', '#eee')]}, <br/> {'selector': 'tr:nth-of-type(even)',<br/>  'props': [('background', 'white')]},<br/> {'selector': 'th',<br/>  'props': [('background', '#606060'), <br/>            ('color', 'white'),<br/>            ('font-family', 'verdana')]},<br/> {'selector': 'td',<br/>  'props': [('font-family', 'verdana')]},<br/>]<br/>).hide_index()</span></pre><figure class="md me mf mg gt jr gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/e3c22e062af3dc591b14adee465db2db.png" data-original-src="https://miro.medium.com/v2/resize:fit:502/format:webp/1*cCPVfB6_nbh6WT99DMgduA.png"/></div></figure><h2 id="3db9" class="kd ke iq bd kf kg kh dn ki kj kk dp kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">2.熊猫选项</h2><p id="3d1a" class="pw-post-body-paragraph kz la iq lb b lc ld le lf lg lh li lj km lk ll lm kq ln lo lp ku lq lr ls lt ij bi translated">读者在使用<code class="fe lu lv lw lx b">.head(n)</code>检查数据帧时可能会遇到以下问题:<br/> (1)数据帧中的列/行太多，中间的一些列/行被省略。<br/> (2)包含长文本的列被截断。<br/> (3)包含浮动的列显示的数字太多/太少。</p><p id="552c" class="pw-post-body-paragraph kz la iq lb b lc ly le lf lg lz li lj km ma ll lm kq mb lo lp ku mc lr ls lt ij bi translated">人们可以设定</p><pre class="md me mf mg gt mh lx mi mj aw mk bi"><span id="1c82" class="kd ke iq lx b gy ml mm l mn mo">import pandas as pd <br/>pd.options.display.max_columns = 50  # None -&gt; No Restrictions<br/>pd.options.display.max_rows = 200    # None -&gt; Be careful with this <br/>pd.options.display.max_colwidth = 100<br/>pd.options.display.precision = 3</span></pre><p id="8228" class="pw-post-body-paragraph kz la iq lb b lc ly le lf lg lz li lj km ma ll lm kq mb lo lp ku mc lr ls lt ij bi translated">来解决这些问题。</p><h2 id="be01" class="kd ke iq bd kf kg kh dn ki kj kk dp kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">3.使用多个聚合进行分组</h2><p id="49f7" class="pw-post-body-paragraph kz la iq lb b lc ld le lf lg lh li lj km lk ll lm kq ln lo lp ku lq lr ls lt ij bi translated">在 SQL 中，我们可以像这样进行聚合</p><pre class="md me mf mg gt mh lx mi mj aw mk bi"><span id="c182" class="kd ke iq lx b gy ml mm l mn mo">SELECT A, B, max(A), avg(A), sum(B), min(B), count(*)<br/>FROM table<br/>GROUP BY A, B</span></pre><p id="9121" class="pw-post-body-paragraph kz la iq lb b lc ly le lf lg lz li lj km ma ll lm kq mb lo lp ku mc lr ls lt ij bi translated">在熊猫身上，这可以通过<code class="fe lu lv lw lx b">.groupby()</code>和<code class="fe lu lv lw lx b">.agg()</code>来实现:</p><pre class="md me mf mg gt mh lx mi mj aw mk bi"><span id="0a5d" class="kd ke iq lx b gy ml mm l mn mo">import pandas as pd<br/>import numpy as np <br/>df = pd.DataFrame(dict(A=['coke', 'sprite', 'coke', 'sprite',<br/>                          'sprite', 'coke', 'coke'],<br/>                       B=['alpha','gamma', 'alpha', 'beta',<br/>                          'gamma', 'beta', 'beta'],<br/>                       col_1=[1,2,3,4,5,6,7],<br/>                       col_2=[1,6,2,4,7,9,3]))</span><span id="0f7f" class="kd ke iq lx b gy mp mm l mn mo">tbl = df.groupby(['A','B']).agg({'col_1': ['max', np.mean],<br/>                                 'col_2': ['sum','min','count']})</span><span id="2a2a" class="kd ke iq lx b gy mp mm l mn mo"># 'count' will always be the count for number of rows in each group.</span></pre><p id="69f3" class="pw-post-body-paragraph kz la iq lb b lc ly le lf lg lz li lj km ma ll lm kq mb lo lp ku mc lr ls lt ij bi translated">结果会是这样的:</p><figure class="md me mf mg gt jr gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/96f98ee2b8f0df1a6df65184ba69d07a.png" data-original-src="https://miro.medium.com/v2/resize:fit:652/format:webp/1*KVE7ixZmoTuG42El5SSh7A.png"/></div></figure><p id="c2a6" class="pw-post-body-paragraph kz la iq lb b lc ly le lf lg lz li lj km ma ll lm kq mb lo lp ku mc lr ls lt ij bi translated">行和列都是多索引的。将其更改为没有多索引的数据帧的快速解决方案是</p><pre class="md me mf mg gt mh lx mi mj aw mk bi"><span id="9f9d" class="kd ke iq lx b gy ml mm l mn mo">tbl = tbl.reset_index()<br/>tbl.columns = ['A', 'B', 'col_1_max', 'col_2_sum', 'col_2_min', 'count']</span></pre><p id="ed5b" class="pw-post-body-paragraph kz la iq lb b lc ly le lf lg lz li lj km ma ll lm kq mb lo lp ku mc lr ls lt ij bi translated">如果您想让列重命名过程自动化，您可以执行<code class="fe lu lv lw lx b">tbl.columns.get_level_values(0)</code>和<code class="fe lu lv lw lx b">tbl.columns.get_level_values(1)</code>来提取每个级别中的索引并组合它们。</p><h2 id="2c97" class="kd ke iq bd kf kg kh dn ki kj kk dp kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">4.列切片</h2><p id="82f5" class="pw-post-body-paragraph kz la iq lb b lc ld le lf lg lh li lj km lk ll lm kq ln lo lp ku lq lr ls lt ij bi translated">你们中的一些人可能对此已经很熟悉了，但是我仍然发现它在处理包含大量列的数据帧时非常有用。</p><pre class="md me mf mg gt mh lx mi mj aw mk bi"><span id="6b8f" class="kd ke iq lx b gy ml mm l mn mo">df.iloc[:,2:5].head()             # select the 2nd to the 4th column<br/>df.loc[:,'column_x':].head()   <br/># select all columns starting from 'column_x'</span></pre><h2 id="37e3" class="kd ke iq bd kf kg kh dn ki kj kk dp kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">5.向每个组添加行 ID /随机行 ID</h2><p id="702d" class="pw-post-body-paragraph kz la iq lb b lc ld le lf lg lh li lj km lk ll lm kq ln lo lp ku lq lr ls lt ij bi translated">要通过 A、B 为每个组添加行 ID /随机行 ID，可以首先将 ID /随机 ID 附加到所有行:</p><pre class="md me mf mg gt mh lx mi mj aw mk bi"><span id="f9cc" class="kd ke iq lx b gy ml mm l mn mo">import numpy as np<br/># df: target dataframe </span><span id="7048" class="kd ke iq lx b gy mp mm l mn mo">np.random.seed(0)   # set random seed<br/>df['random_ID_all'] = np.random.permutation(df.shape[0])<br/>df['ID_all'] = [i for i in range(1, df.shape[0]+1)]</span></pre><p id="7358" class="pw-post-body-paragraph kz la iq lb b lc ly le lf lg lz li lj km ma ll lm kq mb lo lp ku mc lr ls lt ij bi translated">要为每个组添加一个随机 ID(通过 A、B)，可以这样做</p><pre class="md me mf mg gt mh lx mi mj aw mk bi"><span id="4579" class="kd ke iq lx b gy ml mm l mn mo">df['ID'] = df.groupby(['A', 'B'])['ID_all'].rank(method='first', ascending=True).astype(int)</span><span id="6a9f" class="kd ke iq lx b gy mp mm l mn mo">df['random_ID'] = df.groupby(['A', 'B'])['random_ID_all'].rank(method='first', ascending=True).astype(int)</span></pre><p id="4653" class="pw-post-body-paragraph kz la iq lb b lc ly le lf lg lz li lj km ma ll lm kq mb lo lp ku mc lr ls lt ij bi translated">得到</p><figure class="md me mf mg gt jr gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/63a2e92ae8cc46aa6c380065e90ba4b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:662/format:webp/1*Z1elLpesz3V6ZM-C-v3VHA.png"/></div></figure><h2 id="e0f2" class="kd ke iq bd kf kg kh dn ki kj kk dp kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">6.列出组中所有唯一的值</h2><p id="c41d" class="pw-post-body-paragraph kz la iq lb b lc ld le lf lg lh li lj km lk ll lm kq ln lo lp ku lq lr ls lt ij bi translated">有时，在执行 group by 后，我们希望将目标列中的值聚合为唯一值的列表，而不是 max、min 等。这是怎么做的。</p><pre class="md me mf mg gt mh lx mi mj aw mk bi"><span id="4a96" class="kd ke iq lx b gy ml mm l mn mo">df = pd.DataFrame(dict(A=['A','A','A','A','A','B','B','B','B'],<br/>                       B=[1,1,1,2,2,1,1,1,2],<br/>                       C=['CA','NY','CA','FL','FL',     <br/>                          'WA','FL','NY','WA']))</span><span id="3ed3" class="kd ke iq lx b gy mp mm l mn mo">tbl = df[['A', 'B', 'C']].drop_duplicates()\<br/>                         .groupby(['A','B'])['C']\<br/>                         .apply(list)\<br/>                         .reset_index()</span><span id="c623" class="kd ke iq lx b gy mp mm l mn mo"># list to string (separated by commas) <br/>tbl['C'] = tbl.apply(lambda x: (','.join([str(s) for s in x['C']])), axis = 1)</span></pre><figure class="md me mf mg gt jr gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/549db7ac8ba00f41b97deeb4efcbf097.png" data-original-src="https://miro.medium.com/v2/resize:fit:280/format:webp/1*4efJCJxBpjhaYnQ4tTAfoQ.png"/></div></figure><p id="df03" class="pw-post-body-paragraph kz la iq lb b lc ly le lf lg lz li lj km ma ll lm kq mb lo lp ku mc lr ls lt ij bi translated">如果您想保存结果，不要忘记将分隔符更改为逗号以外的任何内容。</p><h2 id="47a0" class="kd ke iq bd kf kg kh dn ki kj kk dp kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">7.将行总计和列总计添加到数字数据框架中</h2><p id="373b" class="pw-post-body-paragraph kz la iq lb b lc ld le lf lg lh li lj km lk ll lm kq ln lo lp ku lq lr ls lt ij bi translated">这是另一种常见的数据操作。你需要的只是<code class="fe lu lv lw lx b">.apply()</code>。</p><pre class="md me mf mg gt mh lx mi mj aw mk bi"><span id="c51a" class="kd ke iq lx b gy ml mm l mn mo">df = pd.DataFrame(dict(A=[2,6,3],<br/>                       B=[2,2,6], <br/>                       C=[3,2,3]))</span><span id="31d1" class="kd ke iq lx b gy mp mm l mn mo">df['col_total']     = df.apply(lambda x: x.sum(), axis=1)<br/>df.loc['row_total'] = df.apply(lambda x: x.sum())</span></pre><figure class="md me mf mg gt jr gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/d856c93bc8e250bb0d8f5ad52ce13b62.png" data-original-src="https://miro.medium.com/v2/resize:fit:450/format:webp/1*Y_ZDUlCwPfLdEXBZGXKPnQ.png"/></div></figure><h2 id="9cd6" class="kd ke iq bd kf kg kh dn ki kj kk dp kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">8.检查内存使用情况</h2><p id="ae57" class="pw-post-body-paragraph kz la iq lb b lc ld le lf lg lh li lj km lk ll lm kq ln lo lp ku lq lr ls lt ij bi translated"><code class="fe lu lv lw lx b">.memory_usage(deep=True)</code>可用于 Pandas 数据帧，查看每一列使用的内存量(以字节为单位)。这在构建机器学习模型时很有用，因为在训练中可能需要大量内存。</p><h2 id="4c01" class="kd ke iq bd kf kg kh dn ki kj kk dp kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">9.累积和</h2><p id="481d" class="pw-post-body-paragraph kz la iq lb b lc ld le lf lg lh li lj km lk ll lm kq ln lo lp ku lq lr ls lt ij bi translated">有时，当您生成一些统计结果时，需要累积和。干脆做<code class="fe lu lv lw lx b">df['cumulative_sum'] = df['target_column'].cumsum()</code>。</p><h2 id="8098" class="kd ke iq bd kf kg kh dn ki kj kk dp kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">10.交叉表</h2><p id="4ae6" class="pw-post-body-paragraph kz la iq lb b lc ld le lf lg lh li lj km lk ll lm kq ln lo lp ku lq lr ls lt ij bi translated">当您需要统计由 3 个以上特征组成的组的频率时，<code class="fe lu lv lw lx b">pd.crosstab()</code>可以让您的工作变得更加轻松。</p><figure class="md me mf mg gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/b7a6dc8b8ead8aeb3c0602e200e4304c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HudH3sdzlrnempURsvWbwg.png"/></div></div></figure><p id="b2e7" class="pw-post-body-paragraph kz la iq lb b lc ly le lf lg lz li lj km ma ll lm kq mb lo lp ku mc lr ls lt ij bi translated">感谢阅读！如果你发现了错误/更好的解决方案，请在下面评论。</p></div></div>    
</body>
</html>