<html>
<head>
<title>Face Detection, Recognition and Emotion Detection in 8 lines of code!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">8 行代码实现人脸检测、识别和情感检测！</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/face-detection-recognition-and-emotion-detection-in-8-lines-of-code-b2ce32d4d5de?source=collection_archive---------2-----------------------#2019-04-03">https://towardsdatascience.com/face-detection-recognition-and-emotion-detection-in-8-lines-of-code-b2ce32d4d5de?source=collection_archive---------2-----------------------#2019-04-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="334b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated"><em class="ki">用数据做酷事！</em></h2></div><h1 id="326c" class="kj kk it bd kl km kn ko kp kq kr ks kt jz ku ka kv kc kw kd kx kf ky kg kz la bi translated">介绍</h1><p id="2cec" class="pw-post-body-paragraph lb lc it ld b le lf ju lg lh li jx lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">人类一直具有识别和区分人脸的先天能力。现在计算机也能做到这一点。这打开了大量的应用。人脸检测和识别可以用来提高访问和安全性，就像最新的苹果 Iphone 一样(见下面的 gif)，允许在没有物理卡的情况下处理支付——Iphone 也是这样做的！，实现罪犯识别，并允许个性化的医疗保健和其他服务。人脸检测和识别是一个深入研究的课题，网上有大量的资源。我们已经尝试了多个开源项目，以找到最容易实现同时又准确的项目。我们还创建了一个管道，用于在图像加载后对任何输入图像进行检测、识别和情感理解，只需 8 行代码！我们的代码在<a class="ae lx" href="https://github.com/priya-dwivedi/face_and_emotion_detection" rel="noopener ugc nofollow" target="_blank"> Github </a>上开源。</p><figure class="lz ma mb mc gt md gh gi paragraph-image"><div class="gh gi ly"><img src="../Images/fd67fcf4bd6c71e0eaedc51236ac48a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/1*YF4KdQE-RadFtNa6n66wdg.gif"/></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk">Facial Biometric</figcaption></figure><p id="9694" class="pw-post-body-paragraph lb lc it ld b le mk ju lg lh ml jx lj lk mm lm ln lo mn lq lr ls mo lu lv lw im bi translated">本博客分为三个部分:</p><ol class=""><li id="74ef" class="mp mq it ld b le mk lh ml lk mr lo ms ls mt lw mu mv mw mx bi translated">面部检测—检测任何输入图像或帧中面部位置的能力。输出是检测到的面的边界框坐标</li><li id="d540" class="mp mq it ld b le my lh mz lk na lo nb ls nc lw mu mv mw mx bi translated">面部识别—将多张脸放在一起比较，以识别哪些脸属于同一个人。这是通过比较人脸嵌入向量来完成的</li><li id="9eda" class="mp mq it ld b le my lh mz lk na lo nb ls nc lw mu mv mw mx bi translated">情绪检测——将脸上的情绪分为快乐、愤怒、悲伤、中性、惊讶、厌恶或恐惧</li></ol><p id="0a1f" class="pw-post-body-paragraph lb lc it ld b le mk ju lg lh ml jx lj lk mm lm ln lo mn lq lr ls mo lu lv lw im bi translated">所以让我们开始吧！</p><h1 id="58d5" class="kj kk it bd kl km kn ko kp kq kr ks kt jz ku ka kv kc kw kd kx kf ky kg kz la bi translated">面部检测</h1><p id="04a3" class="pw-post-body-paragraph lb lc it ld b le lf ju lg lh li jx lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">面部检测是我们管道的第一部分。我们使用了 python 库<a class="ae lx" href="https://github.com/ageitgey/face_recognition" rel="noopener ugc nofollow" target="_blank">人脸识别</a>，我们发现它易于安装，并且在检测人脸时非常准确。该库扫描输入图像，并返回所有检测到的面的边界框坐标，如下所示:</p><figure class="lz ma mb mc gt md gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/3e60a66f2dfdf34c1d23d05985ae2592.png" data-original-src="https://miro.medium.com/v2/resize:fit:1016/format:webp/1*RHqRCDvrhc0pIrIzUBau7Q.png"/></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk">Face Detection</figcaption></figure><p id="37d4" class="pw-post-body-paragraph lb lc it ld b le mk ju lg lh ml jx lj lk mm lm ln lo mn lq lr ls mo lu lv lw im bi translated">下面的代码片段展示了如何使用 face_recognition 库来检测人脸。</p><pre class="lz ma mb mc gt ne nf ng nh aw ni bi"><span id="ddb3" class="nj kk it nf b gy nk nl l nm nn">face_locations = face_recognition.face_locations(image)<br/>top, right, bottom, left = face_locations[0]<br/>face_image = image[top:bottom, left:right]</span></pre><p id="d997" class="pw-post-body-paragraph lb lc it ld b le mk ju lg lh ml jx lj lk mm lm ln lo mn lq lr ls mo lu lv lw im bi translated">安装和使用面部识别的完整说明也在<a class="ae lx" href="https://github.com/priya-dwivedi/face_and_emotion_detection" rel="noopener ugc nofollow" target="_blank"> Github </a>上</p><h1 id="a346" class="kj kk it bd kl km kn ko kp kq kr ks kt jz ku ka kv kc kw kd kx kf ky kg kz la bi translated">面部识别</h1><p id="a6ee" class="pw-post-body-paragraph lb lc it ld b le lf ju lg lh li jx lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">面部识别验证两张脸是否相同。面部识别在安全、生物计量、娱乐、个人安全等方面的应用非常广泛。用于人脸检测的同一个 python 库<a class="ae lx" href="https://github.com/ageitgey/face_recognition" rel="noopener ugc nofollow" target="_blank"> face_recognition </a>也可以用于人脸识别。我们的测试表明它具有良好的性能。给定两张匹配的脸，它们可以相互匹配，给出真或假的结果。面部识别涉及的步骤有</p><ul class=""><li id="7c95" class="mp mq it ld b le mk lh ml lk mr lo ms ls mt lw no mv mw mx bi translated">在图像中查找人脸</li><li id="eae3" class="mp mq it ld b le my lh mz lk na lo nb ls nc lw no mv mw mx bi translated">分析面部特征</li><li id="4fe4" class="mp mq it ld b le my lh mz lk na lo nb ls nc lw no mv mw mx bi translated">比较两个输入面的特征</li><li id="e919" class="mp mq it ld b le my lh mz lk na lo nb ls nc lw no mv mw mx bi translated">如果匹配则返回真，否则返回假。</li></ul><p id="c805" class="pw-post-body-paragraph lb lc it ld b le mk ju lg lh ml jx lj lk mm lm ln lo mn lq lr ls mo lu lv lw im bi translated">下面是实现这一点的代码片段。我们为两个人脸创建人脸编码向量，然后使用内置函数来比较向量之间的距离。</p><pre class="lz ma mb mc gt ne nf ng nh aw ni bi"><span id="4035" class="nj kk it nf b gy nk nl l nm nn">encoding_1 = face_recognition.face_encodings(image1)[0]<br/><br/>encoding_2 = face_recognition.face_encodings(image1)[0]<br/><br/>results = face_recognition.compare_faces([encoding_1], encoding_2,tolerance=0.50)</span></pre><p id="ac3e" class="pw-post-body-paragraph lb lc it ld b le mk ju lg lh ml jx lj lk mm lm ln lo mn lq lr ls mo lu lv lw im bi translated">让我们在下面两张图片上测试模型:</p><figure class="lz ma mb mc gt md gh gi paragraph-image"><div class="gh gi np"><img src="../Images/e132974cb95867f0ff642af116cba749.png" data-original-src="https://miro.medium.com/v2/resize:fit:370/format:webp/1*09yPmkvnd0-lGjOrOixuBQ.png"/></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk">Face 1</figcaption></figure><figure class="lz ma mb mc gt md gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/e2fc195d791bbb0f2268484a377de0e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:390/format:webp/1*8rPXN6enhKx4PsOTQVHYgA.png"/></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk">Face 2</figcaption></figure><p id="49c1" class="pw-post-body-paragraph lb lc it ld b le mk ju lg lh ml jx lj lk mm lm ln lo mn lq lr ls mo lu lv lw im bi translated">如右图所示，我们有两张不同姿势的莱昂纳多·迪卡普里奥的脸。在第一张照片中，脸部也不是正面照。当我们使用上面共享的代码运行识别时，人脸识别能够理解这两张脸是同一个人！</p><h1 id="b47c" class="kj kk it bd kl km kn ko kp kq kr ks kt jz ku ka kv kc kw kd kx kf ky kg kz la bi translated">情感检测</h1><figure class="lz ma mb mc gt md gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/1dee54f9a924812fc3abf2b199dc7208.png" data-original-src="https://miro.medium.com/v2/resize:fit:868/format:webp/1*6xp-IY-M8lEEEN0UuUBq0w.jpeg"/></div></figure><p id="e226" class="pw-post-body-paragraph lb lc it ld b le mk ju lg lh ml jx lj lk mm lm ln lo mn lq lr ls mo lu lv lw im bi translated">人类习惯于从面部情绪中获取非语言暗示。现在计算机也越来越擅长阅读情感。那么我们如何在图像中检测情绪呢？我们使用了来自<a class="ae lx" href="https://www.kaggle.com/" rel="noopener ugc nofollow" target="_blank"> Kaggle </a>的开源数据集——<a class="ae lx" href="https://github.com/npinto/fer2013" rel="noopener ugc nofollow" target="_blank">人脸情绪识别(FER </a>)并构建了一个 CNN 来检测情绪。情绪可以分为 7 类——快乐、悲伤、恐惧、厌恶、愤怒、中性和惊讶。</p><p id="9752" class="pw-post-body-paragraph lb lc it ld b le mk ju lg lh ml jx lj lk mm lm ln lo mn lq lr ls mo lu lv lw im bi translated">模型——我们在 Keras 中构建了一个 6 层卷积神经网络(CNN ),并使用图像增强来提高模型性能。我们尝试了许多不同的模型，并在这个<a class="ae lx" href="https://github.com/priya-dwivedi/face_and_emotion_detection/blob/master/src/EmotionDetector_v2.ipynb" rel="noopener ugc nofollow" target="_blank">链接</a>上开源了我们的最佳实现。</p><p id="bf15" class="pw-post-body-paragraph lb lc it ld b le mk ju lg lh ml jx lj lk mm lm ln lo mn lq lr ls mo lu lv lw im bi translated">您可以加载预训练的模型，并使用下面的两行代码在映像上运行它:</p><pre class="lz ma mb mc gt ne nf ng nh aw ni bi"><span id="e32e" class="nj kk it nf b gy nk nl l nm nn">model = load_model("./emotion_detector_models/model.hdf5")<br/>predicted_class = np.argmax(model.predict(face_image)</span></pre><h1 id="a618" class="kj kk it bd kl km kn ko kp kq kr ks kt jz ku ka kv kc kw kd kx kf ky kg kz la bi translated">结论</h1><p id="c6b5" class="pw-post-body-paragraph lb lc it ld b le lf ju lg lh li jx lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">这篇博客演示了在你的应用程序中实现面部检测和识别模型是多么容易。面部检测可以是许多定制解决方案的起点。我希望你自己尝试一下我们的<a class="ae lx" href="https://github.com/priya-dwivedi/face_and_emotion_detection" rel="noopener ugc nofollow" target="_blank">开源代码</a>。</p><p id="2487" class="pw-post-body-paragraph lb lc it ld b le mk ju lg lh ml jx lj lk mm lm ln lo mn lq lr ls mo lu lv lw im bi translated">我有自己的深度学习咨询公司，喜欢研究有趣的问题。我已经帮助许多初创公司部署了基于人工智能的创新解决方案。请到 http://deeplearninganalytics.org/<a class="ae lx" href="http://deeplearninganalytics.org/" rel="noopener ugc nofollow" target="_blank">来看看我们。如果你有一个我们可以合作的项目，那么请通过我的网站或在<strong class="ld iu">info@deeplearninganalytics.org</strong>联系我</a></p><p id="9712" class="pw-post-body-paragraph lb lc it ld b le mk ju lg lh ml jx lj lk mm lm ln lo mn lq lr ls mo lu lv lw im bi translated">你也可以在<a class="ae lx" href="https://medium.com/@priya.dwivedi" rel="noopener">https://medium.com/@priya.dwivedi</a>看到我的其他作品</p><p id="3185" class="pw-post-body-paragraph lb lc it ld b le mk ju lg lh ml jx lj lk mm lm ln lo mn lq lr ls mo lu lv lw im bi translated"><strong class="ld iu">参考文献:</strong></p><ul class=""><li id="7e76" class="mp mq it ld b le mk lh ml lk mr lo ms ls mt lw no mv mw mx bi translated"><a class="ae lx" href="https://github.com/ageitgey/face_recognition" rel="noopener ugc nofollow" target="_blank">人脸识别库</a></li><li id="33c2" class="mp mq it ld b le my lh mz lk na lo nb ls nc lw no mv mw mx bi translated"><a class="ae lx" href="https://arxiv.org/abs/1503.03832" rel="noopener ugc nofollow" target="_blank"> FaceNet </a> —用于了解面部识别模型是如何构建的</li><li id="7fcb" class="mp mq it ld b le my lh mz lk na lo nb ls nc lw no mv mw mx bi translated"><a class="ae lx" href="https://www.kaggle.com/c/challenges-in-representation-learning-facial-expression-recognition-challenge/data" rel="noopener ugc nofollow" target="_blank">情绪检测数据集</a></li><li id="1de0" class="mp mq it ld b le my lh mz lk na lo nb ls nc lw no mv mw mx bi translated"><a class="ae lx" href="https://www.udemy.com/master-deep-learning-computer-visiontm-cnn-ssd-yolo-gans/" rel="noopener ugc nofollow" target="_blank">好课程</a>了解我们用于情感检测模型的计算机视觉应用</li></ul></div></div>    
</body>
</html>