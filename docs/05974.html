<html>
<head>
<title>Importance Sampling Introduction</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">重要性抽样介绍</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/importance-sampling-introduction-e76b2c32e744?source=collection_archive---------1-----------------------#2019-08-31">https://towardsdatascience.com/importance-sampling-introduction-e76b2c32e744?source=collection_archive---------1-----------------------#2019-08-31</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="eb36" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">估计不同分布的期望值</h2></div><p id="094c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">重要抽样是一种近似方法，而不是抽样方法。它来源于一个小小的数学变换，能够以另一种方式表述问题。在这篇文章中，我们将:</p><ol class=""><li id="adb1" class="lb lc iq kh b ki kj kl km ko ld ks le kw lf la lg lh li lj bi translated">学习重要性抽样的概念</li><li id="ffc1" class="lb lc iq kh b ki lk kl ll ko lm ks ln kw lo la lg lh li lj bi translated">通过实施流程获得更深入的理解</li><li id="eb62" class="lb lc iq kh b ki lk kl ll ko lm ks ln kw lo la lg lh li lj bi translated">比较不同抽样分布的结果</li></ol><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi lp"><img src="../Images/154cff4de630170d1d8ce2fe731c5981.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E-cQ8RGpTb6oyL1ZQZSYPA.jpeg"/></div></div></figure><h1 id="5186" class="mb mc iq bd md me mf mg mh mi mj mk ml jw mm jx mn jz mo ka mp kc mq kd mr ms bi translated">什么是重要性抽样？</h1><p id="444d" class="pw-post-body-paragraph kf kg iq kh b ki mt jr kk kl mu ju kn ko mv kq kr ks mw ku kv kw mx ky kz la ij bi translated">考虑一个场景，你试图计算函数<code class="fe my mz na nb b">f(x)</code>的期望值，其中<code class="fe my mz na nb b">x ~ p(x)</code>服从某种分布。我们对<code class="fe my mz na nb b">E(f(x))</code>有如下估计:</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/9142634edef3e6f942b5877cdd556573.png" data-original-src="https://miro.medium.com/v2/resize:fit:1392/format:webp/1*KQgXU48ea2aqPP7O96ReKg.png"/></div></figure><p id="c407" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">蒙特卡罗抽样方法是简单地从分布<code class="fe my mz na nb b">p(x)</code>中抽取<code class="fe my mz na nb b">x</code>样本，并取所有样本的平均值，从而得到期望值的估计值。那么问题来了，如果<code class="fe my mz na nb b">p(x)</code>很难采样呢？我们能够根据一些已知的和容易抽样的分布来估计期望值吗？</p><p id="d986" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">答案是肯定的。它来自一个简单的公式转换:</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi nd"><img src="../Images/d6ba247a9975a45bf256e0dd1f5b8cf0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1BN9eJjaQn_8x26z_e5BOA.png"/></div></div></figure><p id="e532" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">其中<code class="fe my mz na nb b">x</code>是从分布<code class="fe my mz na nb b">q(x)</code>中取样的，且<code class="fe my mz na nb b">q(x)</code>不应为 0。通过这种方式，估计期望能够从另一个分布中抽样<code class="fe my mz na nb b">q(x)</code>，<code class="fe my mz na nb b">p(x)/q(x)</code>被称为抽样比率或抽样权重，它作为一个校正权重来抵消从不同分布中抽样的概率。</p><p id="377d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们需要讨论的另一件事是估计的方差:</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/1ccca24f5c6a78c8966faae98ba7ff24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1088/format:webp/1*5CtqawruOvAwmurq4r4tCA.png"/></div></figure><p id="20ec" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">其中在这种情况下，<code class="fe my mz na nb b">X</code>是<code class="fe my mz na nb b">f(x)p(x)/q(x)</code>，所以如果<code class="fe my mz na nb b">p(x)/q(x)</code>很大，这将导致很大的方差，这是我们肯定希望避免的。另一方面，也可以选择适当的<code class="fe my mz na nb b">q(x)</code>来产生更小的变化。我们来举个例子。</p><h1 id="5b55" class="mb mc iq bd md me mf mg mh mi mj mk ml jw mm jx mn jz mo ka mp kc mq kd mr ms bi translated">示范</h1><p id="fdca" class="pw-post-body-paragraph kf kg iq kh b ki mt jr kk kl mu ju kn ko mv kq kr ks mw ku kv kw mx ky kz la ij bi translated">首先，让我们定义函数<code class="fe my mz na nb b">f(x)</code>和样本分布:</p><figure class="lq lr ls lt gt lu"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="8919" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe my mz na nb b">f(x)</code>的曲线看起来像:</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi nh"><img src="../Images/9b21decb3f2a7659e3cb62541ffe5f34.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lvKKr-7LFnOwp2ZPXwcXdw.png"/></div></div></figure><p id="7585" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们来定义<code class="fe my mz na nb b">p(x)</code>和<code class="fe my mz na nb b">q(x)</code>的分布:</p><figure class="lq lr ls lt gt lu"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="83ad" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了简单起见，这里<code class="fe my mz na nb b">p(x)</code>和<code class="fe my mz na nb b">q(x)</code>都是正态分布，你可以试着定义一些很难采样的<code class="fe my mz na nb b">p(x)</code>。在我们的第一个演示中，让我们设置两个分布，它们具有相似的平均值(3 和 3.5)和相同的 sigma 1:</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi ni"><img src="../Images/fe2dbe99b0d3ba2f56973486dd314a6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HclnWfZrh7Nzuj2_aHkPCQ.png"/></div></div></figure><p id="665f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在我们能够计算从分布<code class="fe my mz na nb b">p(x)</code>中采样的真实值</p><figure class="lq lr ls lt gt lu"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="d9ca" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们得到的估计值是 0.954。现在让我们从<code class="fe my mz na nb b">q(x)</code>中取样，看看它的表现如何:</p><figure class="lq lr ls lt gt lu"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="66e2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">请注意，这里的<code class="fe my mz na nb b">x_i</code>是从近似分布<code class="fe my mz na nb b">q(x)</code>中抽取的，我们得到的估计值为 0.949，方差为 0.304。请注意，我们能够通过从不同的分布中取样来获得估计值！</p><h2 id="61f1" class="nj mc iq bd md nk nl dn mh nm nn dp ml ko no np mn ks nq nr mp kw ns nt mr nu bi translated">比较</h2><p id="6ed9" class="pw-post-body-paragraph kf kg iq kh b ki mt jr kk kl mu ju kn ko mv kq kr ks mw ku kv kw mx ky kz la ij bi translated">分布<code class="fe my mz na nb b">q(x)</code>可能与<code class="fe my mz na nb b">p(x)</code>过于相似，以至于你可能会怀疑重要性抽样的能力，现在让我们试试另一个分布:</p><figure class="lq lr ls lt gt lu"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="8b93" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">带直方图:</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi nv"><img src="../Images/731c4158c2ef4ecbfab15e54ef14497e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hKQcryMc6fbcS7r-g0sriQ.png"/></div></div></figure><p id="2f2b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这里我们将<code class="fe my mz na nb b">n</code>设置为 5000，当分布不同时，通常我们需要更多的样本来逼近该值。这次我们得到的估计值是 0.995，但是方差是 83.36。</p><p id="d714" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">原因来自<code class="fe my mz na nb b">p(x)/q(x)</code>，因为两个分布相差太大可能会导致该值的巨大差异，从而增加方差。经验法则是定义<code class="fe my mz na nb b">q(x)</code>，其中<code class="fe my mz na nb b">p(x)|f(x)|</code>较大。(<a class="ae nw" href="https://github.com/MJeremy2017/Machine-Learning-Algorithm-Implemention" rel="noopener ugc nofollow" target="_blank">全面实施</a>)</p><p id="a052" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">参考:</strong></p><p id="f159" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">[1]<a class="ae nw" href="https://www.youtube.com/watch?v=3Mw6ivkDVZc" rel="noopener ugc nofollow" target="_blank">https://www.youtube.com/watch?v=3Mw6ivkDVZc</a></p><p id="dd87" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">[2]<a class="ae nw" href="https://astrostatistics.psu.edu/su14/lectures/cisewski_is.pdf" rel="noopener ugc nofollow" target="_blank">https://astro statistics . PSU . edu/su14/lectures/cisewski _ is . pdf</a></p></div></div>    
</body>
</html>