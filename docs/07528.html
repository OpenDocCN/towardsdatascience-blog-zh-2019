<html>
<head>
<title>How to generate lat and long coordinates from an address column using Pandas and Googlemaps API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用 Pandas 和 Googlemaps API 从地址栏生成经度和纬度坐标</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-generate-lat-and-long-coordinates-from-an-address-column-using-pandas-and-googlemaps-api-d66b2720248d?source=collection_archive---------4-----------------------#2019-10-21">https://towardsdatascience.com/how-to-generate-lat-and-long-coordinates-from-an-address-column-using-pandas-and-googlemaps-api-d66b2720248d?source=collection_archive---------4-----------------------#2019-10-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/b4dac255b0e5689fb8234136a82a1956.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*wR4OaCd1NgVRc9yw"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">Photo by <a class="ae kf" href="https://unsplash.com/@paulamayphotography?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Paula May</a> on <a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="fe36" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果您想使用地址数据中的地理坐标绘制地图，Google 提供了一个名为 Geocoding 的 API，允许您将地址转换为地理坐标，反之亦然。</p><h1 id="e640" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">什么是地理编码？</h1><p id="8e73" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated"><strong class="ki iu">地理编码</strong>是将地址(如“1600 amphetica Parkway，Mountain View，CA”)转换为地理坐标(如纬度 37.423021 和经度-122.083739)的过程，您可以使用地理坐标在地图上放置标记，或定位地图。如果你想深入了解，请点击这里阅读更多<a class="ae kf" href="https://developers.google.com/maps/documentation/geocoding/intro" rel="noopener ugc nofollow" target="_blank">。</a></p><h2 id="8421" class="mh lf it bd lg mi mj dn lk mk ml dp lo kr mm mn ls kv mo mp lw kz mq mr ma ms bi translated"><strong class="ak">谷歌云地理编码 API 定价</strong>:</h2><p id="2508" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">Google 为这个 API 提供每月 200 美元的免费积分(基于您拥有的帐户类型)，所以请确保您了解自己运行这个 API 可能会产生的成本。</p><ul class=""><li id="2ef4" class="mt mu it ki b kj kk kn ko kr mv kv mw kz mx ld my mz na nb bi translated"><a class="ae kf" href="https://developers.google.com/maps/billing/gmp-billing?_ga=2.240776579.-1811664684.1567421291&amp;_gac=1.220397996.1571643267.EAIaIQobChMIyKSVsuus5QIVEOJ3Ch2hoQDUEAAYASAAEgJY7_D_BwE#geocoding" rel="noopener ugc nofollow" target="_blank">定价详情 1 </a></li><li id="e467" class="mt mu it ki b kj nc kn nd kr ne kv nf kz ng ld my mz na nb bi translated"><a class="ae kf" href="https://cloud.google.com/maps-platform/pricing/sheet/" rel="noopener ugc nofollow" target="_blank">定价详情 2 </a></li></ul><h1 id="8fae" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">我们开始吧</h1><p id="24b4" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">我使用 Jupyter notebook 来运行本教程中的脚本。</p><p id="7ff4" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">首先，您需要导入<a class="ae kf" href="https://pypi.org/project/googlemaps/" rel="noopener ugc nofollow" target="_blank"> GoogleMaps </a>和<a class="ae kf" href="https://pypi.org/project/pandas/" rel="noopener ugc nofollow" target="_blank"> Pandas </a>包。如果您还没有安装，请确保已经使用<a class="ae kf" href="https://pip.pypa.io/en/stable/installing/" rel="noopener ugc nofollow" target="_blank"> pip </a>将这些软件包安装到您的环境中。</p><pre class="nh ni nj nk gt nl nm nn no aw np bi"><span id="8e4b" class="mh lf it nm b gy nq nr l ns nt">from googlemaps import Client as GoogleMaps<br/>import pandas as pd </span></pre><h1 id="58d9" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">创建您的 API 密钥</h1><p id="2a32" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">现在，您需要在 Google Cloud Platform 帐户的凭证部分创建一个 API 密匙。这很简单。</p><ul class=""><li id="62b5" class="mt mu it ki b kj kk kn ko kr mv kv mw kz mx ld my mz na nb bi translated">在你的控制台搜索栏中输入<strong class="ki iu"> <em class="nu"> API &amp;服务</em> </strong>。</li><li id="485d" class="mt mu it ki b kj nc kn nd kr ne kv nf kz ng ld my mz na nb bi translated">点击<strong class="ki iu"> <em class="nu">启用 API 和服务</em> </strong></li><li id="3838" class="mt mu it ki b kj nc kn nd kr ne kv nf kz ng ld my mz na nb bi translated">搜索<strong class="ki iu"> <em class="nu">地理编码 API </em> </strong>并确保其已启用</li><li id="8d9f" class="mt mu it ki b kj nc kn nd kr ne kv nf kz ng ld my mz na nb bi translated">现在点击<strong class="ki iu"> <em class="nu">凭证</em> </strong> &gt; <strong class="ki iu"> <em class="nu">创建凭证</em> </strong>并创建一个新的 API 密钥</li></ul><p id="3f3d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在 Python 中创建新的 GoogleMaps 对象时，您将使用这个 API 键。</p><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nv"><img src="../Images/7ed458f4c1d9d6b6b911e1cd2e6c14f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YSSsZ4i70w4BTj7iB6ZZbw.png"/></div></div></figure><p id="75e7" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在回到 Jupyter notebook，使用刚刚生成的 API 键创建一个 GoogleMaps 对象。</p><pre class="nh ni nj nk gt nl nm nn no aw np bi"><span id="c340" class="mh lf it nm b gy nq nr l ns nt">gmaps = GoogleMaps('YOUR_API_KEY')</span></pre><p id="fb29" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下一步是导入 csv 文件，该文件包含一列您想要转换的完整地址。</p><pre class="nh ni nj nk gt nl nm nn no aw np bi"><span id="4220" class="mh lf it nm b gy nq nr l ns nt">addresses = pd.read_csv("YOUR_CSV_FILE.csv")<br/>addresses.head()</span></pre><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/73197f848f61b12ac8dbda051ee81b55.png" data-original-src="https://miro.medium.com/v2/resize:fit:734/format:webp/1*jYe4F1TY6NVGKmEpwQozaw.png"/></div></figure><p id="5081" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">添加两个空列来保存经度和纬度数据。</p><pre class="nh ni nj nk gt nl nm nn no aw np bi"><span id="2cf5" class="mh lf it nm b gy nq nr l ns nt">addresses['long'] = ""<br/>addresses['lat'] = ""</span></pre><h1 id="b30b" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">地理编码响应</h1><p id="b0ff" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">运行<strong class="ki iu"><em class="nu">Google maps . geocode</em></strong>命令返回一个 JSON 对象，看起来像<a class="ae kf" href="https://developers.google.com/maps/documentation/geocoding/intro#GeocodingResponses" rel="noopener ugc nofollow" target="_blank"> this </a>。如果需要，您还可以利用更多的属性。然而，如前所述，我们将只关注经度和纬度地理坐标，它在 JSON 响应中有一个“geometry”和“location”的<em class="nu">键。<br/> <em class="nu"> -几何形状&gt;位置&gt;横向<br/> -几何形状&gt;位置&gt; lng </em></em></p><h1 id="e58b" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">生成经度和纬度坐标</h1><p id="5e6e" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">现在是时候遍历数据帧，为每个地址记录插入“lng”和“lat”。</p><pre class="nh ni nj nk gt nl nm nn no aw np bi"><span id="962e" class="mh lf it nm b gy nq nr l ns nt">for x in range(len(addresses)):<br/>    try:<br/>        time.sleep(1) #to add delay in case of large DFs<br/>        geocode_result = gmaps.geocode(addresses['FullAddress'][x])<br/>        addresses['lat'][x] = geocode_result[0]['geometry']['location'] ['lat']<br/>        addresses['long'][x] = geocode_result[0]['geometry']['location']['lng']<br/>    except IndexError:<br/>        print("Address was wrong...")<br/>    except Exception as e:<br/>        print("Unexpected error occurred.", e )</span><span id="16dc" class="mh lf it nm b gy nx nr l ns nt">addresses.head()</span></pre><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ny"><img src="../Images/1307a0b9abc8e248e8ed8704cfc00b10.png" data-original-src="https://miro.medium.com/v2/resize:fit:968/format:webp/1*bHS0RTIIahyS6l-3hllFbg.png"/></div></div></figure><p id="89cc" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">有了生成的坐标，您可以像这样绘制地图视图。</p><figure class="nh ni nj nk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nz"><img src="../Images/4b1c8823d238992a4864a12696de4167.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UIQLKGHIh3oE6x3mLfQuRA.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">source: <a class="ae kf" href="https://blog.exploratory.io/geocoding-us-zip-code-data-with-dplyr-and-zipcode-package-7f539c3702b0" rel="noopener ugc nofollow" target="_blank">https://blog.exploratory.io/geocoding-us-zip-code-data-with-dplyr-and-zipcode-package-7f539c3702b0</a></figcaption></figure><p id="eb1c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最后，如果需要，将您的结果导出到 csv。</p><pre class="nh ni nj nk gt nl nm nn no aw np bi"><span id="54fd" class="mh lf it nm b gy nq nr l ns nt">addresses.to_csv('address_coords.csv')</span></pre><p id="6716" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">就是这样！希望这对你有帮助。如果你有任何问题或建议，请告诉我。</p><blockquote class="oa"><p id="a6d1" class="ob oc it bd od oe of og oh oi oj ld dk translated">你可以<a class="ae kf" href="https://medium.com/@tobisam/membership" rel="noopener">成为中等会员</a>享受更多这样的故事。</p></blockquote></div></div>    
</body>
</html>