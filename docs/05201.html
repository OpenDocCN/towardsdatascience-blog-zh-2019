<html>
<head>
<title>From XML to Excel for Data Analysis</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从 XML 到 Excel 进行数据分析</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/from-xml-to-excel-for-data-analysis-ac0c0c765b7d?source=collection_archive---------5-----------------------#2019-08-04">https://towardsdatascience.com/from-xml-to-excel-for-data-analysis-ac0c0c765b7d?source=collection_archive---------5-----------------------#2019-08-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="38be" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">Python 中处理 XML 的介绍</h2></div><p id="f0f7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">根据您的角色和公司，有时您可能需要使用 XML。在本文中，我们将探讨如何利用 Python 来帮助您以一种使您能够进行分析的方式提取和形成数据。</p><p id="cf5a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">XML 代表<em class="le">可扩展标记语言</em>，它是一种主要用于存储和传输数据的语言。这种语言被设计成机器可读和人类可读的形式。这种语言的批评者通常会建议用 JSON 作为替代，这意味着更快的处理速度。</p><p id="4b6c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">XML 语言由标签、元素和属性组成。理解这些术语以及我们如何使用它们的最好方法是通过例子的使用。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi lf"><img src="../Images/32367912729199717f1586572acf0fe5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*6Lt6vRYdIv4pogrF"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk">Photo by <a class="ae lv" href="https://unsplash.com/@fabioha?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">fabio</a> on <a class="ae lv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="f32e" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">Python 中的 XML</h1><p id="ea4d" class="pw-post-body-paragraph ki kj it kk b kl mo ju kn ko mp jx kq kr mq kt ku kv mr kx ky kz ms lb lc ld im bi translated">当谈到用 Python 处理 XML 时，最流行的库被恰当地命名为 XML。你可以在这里查阅相关文档<a class="ae lv" href="https://docs.python.org/3/library/xml.html" rel="noopener ugc nofollow" target="_blank">。如果您访问文档页面，您会发现有几个子模块可用于处理 XML，但出于我们的目的，我们将只使用</a><a class="ae lv" href="https://docs.python.org/3.7/library/xml.etree.elementtree.html" rel="noopener ugc nofollow" target="_blank"><em class="le">XML . etree . element tree</em></a>。</p><h1 id="3b1c" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">XML 速成班</h1><p id="a6a0" class="pw-post-body-paragraph ki kj it kk b kl mo ju kn ko mp jx kq kr mq kt ku kv mr kx ky kz ms lb lc ld im bi translated">首先，让我们复习一下 XML 知识。让我们看看以下情况:</p><pre class="lg lh li lj gt mt mu mv mw aw mx bi"><span id="827f" class="my lx it mu b gy mz na l nb nc">&lt;catalog&gt;<br/> &lt;product description="Cardigan Sweater"&gt;<br/>  &lt;catalog_item gender="Men's"&gt;<br/>   &lt;item_number&gt;QWZ5671&lt;/item_number&gt;<br/>   &lt;price&gt;39.95&lt;/price&gt;<br/>  &lt;/catalog_item&gt;<br/> &lt;/product&gt;<br/>&lt;catalog&gt;</span></pre><p id="0d92" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在上面的示例中，我们注意到以下情况:</p><ul class=""><li id="0991" class="nd ne it kk b kl km ko kp kr nf kv ng kz nh ld ni nj nk nl bi translated">根元素是 catalog，并且只能存在一个</li><li id="8ea9" class="nd ne it kk b kl nm ko nn kr no kv np kz nq ld ni nj nk nl bi translated">所有标签都区分大小写，并且所有元素都需要有一个结束标签(比如价格)</li><li id="57f0" class="nd ne it kk b kl nm ko nn kr no kv np kz nq ld ni nj nk nl bi translated">产品是子元素，目录是子元素，项目编号和价格是子元素。</li></ul><h1 id="0da0" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">Python 和 XML</h1><p id="fd74" class="pw-post-body-paragraph ki kj it kk b kl mo ju kn ko mp jx kq kr mq kt ku kv mr kx ky kz ms lb lc ld im bi translated">对于我们的例子，我将使用这个样本 XML 文件；唯一的区别是我重复了 product 子元素两次。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/ffc243ccfb43becee6bec5b1a769859f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Tn-WbZsYjSZuODZ2.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk">Screenshot depicting a part of the sample XML</figcaption></figure><p id="6cb7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们需要做的第一件事是导入库并将 XML 文件读入我们的应用程序:</p><pre class="lg lh li lj gt mt mu mv mw aw mx bi"><span id="bc7b" class="my lx it mu b gy mz na l nb nc">import xml.etree.ElementTree as ET<br/>#Example XML files:<br/>#   sample2 from:  <a class="ae lv" href="https://www.service-architecture.com/articles/object-oriented-databases/xml_file_for_complex_data.html" rel="noopener ugc nofollow" target="_blank">https://www.service-architecture.com/articles/object-oriented-databases/xml_file_for_complex_data.html</a><br/>tree = ET.parse(r'C:\xml\sample2.xml')<br/>root = tree.getroot()<br/>tag = root.tag<br/>att = root.attrib</span><span id="3fab" class="my lx it mu b gy ns na l nb nc">print(root,'\n',tag,'\n',att)</span></pre><p id="f1e0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">它返回以下内容:</p><pre class="lg lh li lj gt mt mu mv mw aw mx bi"><span id="7a0a" class="my lx it mu b gy mz na l nb nc">&lt;Element 'catalog' at 0x0093FC60&gt;<br/> catalog<br/> {}</span></pre><p id="6419" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">因此，我们可以看到如何识别没有属性的根节点。然后，让我们在 XML 树上再往下一层，使用:</p><pre class="lg lh li lj gt mt mu mv mw aw mx bi"><span id="c9a5" class="my lx it mu b gy mz na l nb nc">for child in root:<br/>    print(child.tag, child.attrib)</span></pre><p id="63e0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">它返回:</p><pre class="lg lh li lj gt mt mu mv mw aw mx bi"><span id="60f2" class="my lx it mu b gy mz na l nb nc">product {'description': 'Cardigan Sweater', 'product_image': 'cardigan.jpg'}<br/>product {'description': 'Cardigan Sweater', 'product_image': 'cardigan.jpg'}</span></pre><p id="5481" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">太好了。我们现在可以识别标签及其属性。如果我们想提取值呢？让我们再深入两层，在那里我们有这样的例子(例如，在<em class="le"> &lt;价格&gt; </em>元素):</p><pre class="lg lh li lj gt mt mu mv mw aw mx bi"><span id="62b4" class="my lx it mu b gy mz na l nb nc">for child in root:<br/>    #print(child.tag, child.attrib)<br/>    for subchild in child:<br/>        #print(subchild.tag, subchild.attrib, subchild.text)<br/>        for subsubchild in subchild:<br/>            print(subsubchild.tag, subsubchild.attrib, subsubchild.text)</span></pre><p id="31a8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">给了我们:</p><pre class="lg lh li lj gt mt mu mv mw aw mx bi"><span id="91eb" class="my lx it mu b gy mz na l nb nc">item_number {} QWZ5671<br/>price {} 39.95<br/>size {'description': 'Medium'}size {'description': 'Large'}</span></pre><p id="2f3e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">有了上面的知识，您现在应该能够轻松地浏览 XML 树并提取您想要的任何信息。这个对你帮助不大；但是，当您试图对 XML 树中的数据进行分析时。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi nt"><img src="../Images/1c76a47149c07682b7f87a2e7238f3d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*QlCY8plHXFIOz7EB"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk">Photo by <a class="ae lv" href="https://unsplash.com/@markusspiske?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Markus Spiske</a> on <a class="ae lv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="2721" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">将数据展平为 CSV 格式，以便快速分析</h1><p id="805f" class="pw-post-body-paragraph ki kj it kk b kl mo ju kn ko mp jx kq kr mq kt ku kv mr kx ky kz ms lb lc ld im bi translated">在某些情况下，您只需要表格格式的数据，这样您就可以快速得出一些结论。也许您正试图查看特定标记的唯一值，或者您只是试图更好地理解数据。也许你想以你的利益相关者更熟悉的方式展示数据——比 excel 更熟悉的方式。</p><p id="0b62" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">因此，我们接下来要使用的是 xml.etree.ElementTree python 库的<em class="le"> iter() </em>方法。这个方法将允许我们迭代每个 XML 元素:</p><pre class="lg lh li lj gt mt mu mv mw aw mx bi"><span id="5ff3" class="my lx it mu b gy mz na l nb nc">for elem in root.iter():<br/>    print(elem.tag, elem.attrib, elem.text)</span></pre><p id="ae5d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如您所料，它会返回如下列表:</p><pre class="lg lh li lj gt mt mu mv mw aw mx bi"><span id="743b" class="my lx it mu b gy mz na l nb nc">catalog {}product {'description': 'Cardigan Sweater', 'product_image': 'cardigan.jpg'}catalog_item {'gender': "Men's"}item_number {} QWZ5671<br/>price {} 39.95<br/>size {'description': 'Medium'}</span></pre><p id="328a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">假设我们想为每个<em class="le">产品(即</em>第一级子产品)创建一行，我们可以使用以下脚本:</p><pre class="lg lh li lj gt mt mu mv mw aw mx bi"><span id="ee54" class="my lx it mu b gy mz na l nb nc">import xml.etree.ElementTree as ET</span><span id="14f7" class="my lx it mu b gy ns na l nb nc">tree = ET.parse(r'pathToXML')<br/>root = tree.getroot()<br/>tag = root.tag<br/>att = root.attrib</span><span id="66be" class="my lx it mu b gy ns na l nb nc">#Flatten XML to CSV<br/>for child in root:<br/>    mainlevel = child.tag<br/>    xmltocsv = ''<br/>    for elem in root.iter():<br/>        if elem.tag == root.tag:<br/>            continue<br/>        if elem.tag == mainlevel:<br/>            xmltocsv = xmltocsv + '\n'<br/>        xmltocsv = xmltocsv + str(elem.tag).rstrip() + str(elem.attrib).rstrip() + ';' + str(elem.text).rstrip() + ';'</span><span id="dc1b" class="my lx it mu b gy ns na l nb nc">print(xmltocsv)</span></pre><p id="2975" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以用 Excel 打开哪个文件:</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/4f7123ac0e301dc3fe95539884409d85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ITYstDShziJ6k9Y9.png"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk">Part of the data as shown in Excel</figcaption></figure><p id="b60d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这里值得注意的是，对于要对齐的数据(每行之间)，假设每个子节点都有所有 XML 属性。如果不是这样，那么可能需要对数据进行一些清理。</p><p id="e586" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我希望你觉得这是有用的。</p></div><div class="ab cl nu nv hx nw" role="separator"><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz"/></div><div class="im in io ip iq"><p id="8dec" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果您喜欢这篇文章，您可能也会喜欢:</p><div class="ob oc gp gr od oe"><a rel="noopener follow" target="_blank" href="/how-to-extract-text-from-images-with-python-db9b87fe432b"><div class="of ab fo"><div class="og ab oh cl cj oi"><h2 class="bd iu gy z fp oj fr fs ok fu fw is bi translated">如何用 Python 从图像中提取文本</h2><div class="ol l"><h3 class="bd b gy z fp oj fr fs ok fu fw dk translated">学习用 3 行代码从图像中提取文本</h3></div><div class="om l"><p class="bd b dl z fp oj fr fs ok fu fw dk translated">towardsdatascience.com</p></div></div><div class="on l"><div class="oo l op oq or on os lp oe"/></div></div></a></div><div class="ob oc gp gr od oe"><a rel="noopener follow" target="_blank" href="/how-to-extract-text-from-pdf-245482a96de7"><div class="of ab fo"><div class="og ab oh cl cj oi"><h2 class="bd iu gy z fp oj fr fs ok fu fw is bi translated">如何从 PDF 中提取文本</h2><div class="ol l"><h3 class="bd b gy z fp oj fr fs ok fu fw dk translated">学习使用 Python 从 pdf 中提取文本</h3></div><div class="om l"><p class="bd b dl z fp oj fr fs ok fu fw dk translated">towardsdatascience.com</p></div></div><div class="on l"><div class="ot l op oq or on os lp oe"/></div></div></a></div></div></div>    
</body>
</html>