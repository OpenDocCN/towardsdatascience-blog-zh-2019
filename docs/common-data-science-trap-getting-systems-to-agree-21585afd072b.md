# 通用数据科学陷阱项目—让系统达成一致

> 原文：<https://towardsdatascience.com/common-data-science-trap-getting-systems-to-agree-21585afd072b?source=collection_archive---------33----------------------->

## 当心！他们不会同意的！问题是到什么程度

![](img/9451b1f53859203bcf85cdc50d0ff69f.png)

I see you. (Photo: Randy Au)

如今，在数据科学领域工作，不与多个数据系统打交道几乎是不可能的，因为这些数据系统所涵盖的内容可能会有重叠。

也许你有一个网站，同时使用谷歌分析和内部定制跟踪系统来收集分析。也许你有一个系统跟踪网络像素点击，另一个系统使用 JavaScript 指纹。或者您有自己的分析系统，但正在与第三方交换意见。

每当有多个系统时，要问的一个最基本的问题是来自一个系统的数字是否与来自另一个系统的数字一致。你可能会认为协调系统很容易做到。

但事实并非如此。

除非经过特别设计，否则系统几乎永远不会一致。他们甚至可能不会同意。在你陷入一个会让你抓狂的为期 3 周的项目之前，后退一步，明白你面临的是什么。

# 定义冲突

有时，从完全相同的底层数据集中提取数据*的两个报告不一致。这归结为对某事物定义的不同。你的“活跃用户”指标包括机器人吗？或者可能排除没有购买的用户，或者只统计过去 28 天而不是 30 天的用户？*

因为有许多方法来分析数据集，所以必须非常清楚度量标准在测量什么。每个人都必须注意不要在不同的定义中使用同一个术语。当与不同团队的人一起工作时，尤其如此，这些人可能彼此之间没有密切的联系，并且可能已经独立地开发了他们自己的一套定义。

协调这些通常意味着查看数据处理管道并检查用于提取数据的逻辑。有时在那些实现中有一些你需要修复的错误，而其他时候一旦定义被调和，事情就完全匹配了。

虽然许多人会说这个问题可以通过一个合适的**数据字典**来解决/避免，但是在实践中，除非你有一个非常强大的保持字典更新的过程，否则它只会对最普遍和最稳定的指标有效。快速变化的事物如果没有很好的实施，往往会变得陈旧。

# 实现冲突

大多数系统不会以与另一个系统完全相同的**方式**来衡量事物。即使概念上的定义是一样的，细节也非常重要。

例如，通过查看服务器请求日志来跟踪点击量的系统不适合要求客户端运行 JavaScript 代码的系统。客户端可能无法运行 JavaScript。

在这种情况下，服务器日志的点击数会比 JavaScript 多……除非你做的是一个单页设计，在没有直接页面重载的情况下更新页面，但是当逻辑重载发生时会触发一个跟踪事件。然后它可以根据你的用户转向另一个方向，

这种事情可能会变得复杂，当您细化到越来越小的“缺失”计数集时，您必须更深入地挖掘越来越小的实现细节。这就是为什么如果你想处理数据，你必须非常熟悉你的技术堆栈。它永远不会“干净”,因为你是收集它的人。总有一些你没有收集到或者无法收集到的东西。

# 消灭虫子

bug 难免会发生。它们也不需要同时发生在两个独立的系统上。即使它影响了两者，它也可能是有偏见的，不会以同样的方式影响事物。这类问题应该是暂时的，因为当 bug 被引入，然后当它被修复时，协议会有很大的变化。

但是有时这些错误几年都不会被发现，发现它的唯一方法是因为你在比较两个系统的指标，无论你做什么，它们都不一致。

# 两位将军的问题已经把你解决了

对于彼此远离的系统，在某种意义上，它们通过潜在有损耗的信道进行交互，由于系统之间的传输损耗，系统可以简单地不一致。这可能是由于网络故障或系统故障(崩溃、错误等)。

[](https://en.wikipedia.org/wiki/Two_Generals%27_Problem) [## 两位将军的问题

### 在计算中，两个将军的问题是一个思想实验，旨在说明陷阱和设计挑战…

en.wikipedia.org](https://en.wikipedia.org/wiki/Two_Generals%27_Problem) 

这个问题的简短解释是，有两个将军必须攻击他们之间的一个城市，只有当他们同时攻击时，他们才能成功。他们必须派一名信使到敌人领地对面的另一名将军那里，并规定攻击时间，但这名信使可能会被俘虏。类似地，也可以捕获返回的“消息已接收”消息。

即使双方都派出了无限的信使，也没有算法能保证两位将军的问题得到解决。唯一的解决办法是制定协议，增加双方就某件事达成一致的可能性，同时平衡发送的信使数量。

但是等等，你问。我们没有 TCP 吗？这还没解决吗？不完全是。TCP 协议(以及类似的其他通信协议)确实有适当的机制来减轻有损信道的影响，因为它能够重新发送丢失的数据包等。但是，从根本上说，所有的东西都不可能同时完全了解系统的状态。TCP 连接可能在任何时候中断。

我敢肯定，你认为我们的各种数据系统有针对这类问题的安全措施，一致性保证等等。那么，请仔细阅读这些细节，因为它们与软件中的细节有关，并且非常具体。他们也无法防范软件之外发生的事情，比如猫啃网线。

更实际的说法是，假设您的站点在加载`track_hit_locally()`和`track_hit_remotely()`时进行了两次函数调用。两者相继开火，但一个与本地网络上的机器对话，而另一个与地球另一端的机器对话。随着时间的推移，随着随机互联网中断和系统错误的堆积，这两个计数通常会开始不一致，除非有特定的机制来保持它们同步。即使这样，同步机制也可能失败。

更糟糕的是，当您在比较您无法控制的系统时，您没有机制来审计和插入丢失的数据。因此，这些系统将不得不存在分歧。问题只是这种分歧是否在可接受的范围内。

# 利益冲突和欺诈

数据不会说谎，除非有人有动机让它说谎。然后，通常不会很难。有时系统会因为与技术或数学无关的邪恶原因而不一致。

最近一个著名的例子是[脸书夸大他们的视频指标](https://adage.com/article/digital/facebook-agrees-pay-advertisers-40-million-over-inflated-video-stats/2205101)，有效地促使营销人员向平台投入资源(和金钱)。

另一个例子是 2008 年金融危机期间我在广告技术领域的黑暗日子。我工作的三流商店是在互联网广告的黑暗角落工作的，在那里点击通过多层广告网络，然后到达一个主要的广告客户。

点击量(这意味着点击费世界的实际收入)**定期**从一个网络到下一个网络有大约 10-15%的差异。原因包括“由于专有的反欺诈技术，点击无效”和随机系统错误。有时这是有效的欺诈检测，但有些百分比只是削减了百分之几的额外利润，基本上没有支付下游出版商，同时保留了上游广告商的钱。

问题是**每个人**都这样做，在广告网络链上上下下。因此，人们不同意只是例行公事，只要不太过分，每个人都只是点头微笑。

幸运的是，我已经发誓从 2009 年开始不再做广告，所以这个故事已经有十年了。如果世界上还有这样的事情发生，我不会感到惊讶，但是谢天谢地，我对整个情况一无所知。

所以要小心，有时候数字加不起来是因为有人不想让它们加起来。鉴于所有其他来源的差异以及谁控制着数据源，证明这一点是完全不可能的。

# 处理冲突

系统之间的计数可能会有各种不同，您能做些什么呢？

## 要清晰和一致

度量的定义和实现总是任意的构造，人们必须随着时间的推移通过重复使用来记住它们。诀窍是在你的用法上要清晰和一致。不要不断地重新定义事物，不要有相互竞争的实现。有时，一个有长期使用历史的稍微有缺陷的指标可能比一个更准确的指标更容易推理。

这并不是说您永远不应该改进您的度量方法，而是说它必须以一种每个用户都可以遵循的方式来完成。理想情况下，改进建立在现有知识的基础上，这样人们就不必重新学习材料。

## 不要追逐收益递减

80/20 法则适用于数据误差源。通常，一小部分问题会导致大部分差异。所以当你在一个项目中追踪问题时，记住你的努力会有递减的回报。

确保您的指标彼此相差不超过 10%对您来说有多大价值？1%以内要多少？0.1%?确切的约定值多少钱？

你想要的东西越接近，你就要花费越多的时间和资源来追踪问题并纠正/预防它们。对于许多应用程序来说，有一点小小的分歧可能是好的。你可能希望涉及金钱的事情更加紧密，但即使是金钱，如果误差足够小，会计团队也可能愿意接受一定程度的误差。

然后，一些系统绝对需要一致，在这种情况下，你需要绕过它，并支付高昂的成本。这将包括保持系统冗余和高度可用，能够记录和重放事务，定期一致性检查和审计等。

## 有条不紊

寻找差异需要很多时间。绕圈子真的很容易，因为有太多的细节需要记住。

根据我的经验，最好的处理方法是这样做:

1.  估计差异
2.  扫描数据并检查是否有明显的片段丢失，有时明显的模式很容易识别
3.  询问系统所有者的意见，他们可能知道一些你不知道的事情
4.  开始分割数据块。你能让系统匹配特定的子集吗？比如，所有付费用户，或者 12 月的每个人等等。如果你找到匹配的，记下来。
5.  当你想不出匹配的细分市场时，后退一步，看看是否有什么模式和漏洞。
6.  如果失败了，开始挖掘逻辑，理解发生了什么，用你的领域知识去发现哪里可能出错
7.  当你找到差异的来源时，**回头看看它占**差异的多少。有时候这就足够让你满意了。