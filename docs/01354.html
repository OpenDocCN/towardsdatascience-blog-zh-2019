<html>
<head>
<title>Building a Flask API to Automatically Extract Named Entities Using SpaCy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 SpaCy 构建 Flask API 来自动提取命名实体</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/building-a-flask-api-to-automatically-extract-named-entities-using-spacy-2fd3f54ebbc6?source=collection_archive---------12-----------------------#2019-03-04">https://towardsdatascience.com/building-a-flask-api-to-automatically-extract-named-entities-using-spacy-2fd3f54ebbc6?source=collection_archive---------12-----------------------#2019-03-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/60eca6a0e20fd04ad6503a34a39274b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sf3cyWTC0bMEA3hDqfwmMQ.jpeg"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Photo credit: Pixabay</figcaption></figure><div class=""/><div class=""><h2 id="e787" class="pw-subtitle-paragraph kc je jf bd b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt dk translated">如何使用 spaCy 中的命名实体识别模块来识别文本中的人、组织或位置，然后使用 Flask 部署 Python API</h2></div><p id="037b" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">如果数据是结构化的，那么今天大量的非结构化文本数据提供了丰富的信息来源。命名实体识别(NER )(也称为命名实体提取)是从半结构化和非结构化文本来源构建知识的第一步。</p><p id="bc08" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">只有在 NER 之后，我们才能至少揭示出这些信息包含了什么人和什么内容。因此，数据科学团队将能够在语料库中看到人员、公司、地点等所有名称的结构化表示，这可以作为进一步分析和调查的出发点。</p><p id="6fc3" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">在<a class="ae lq" rel="noopener" target="_blank" href="/named-entity-recognition-with-nltk-and-spacy-8c4a7d88e7da">之前的文章</a>中，我们已经学习并练习了<a class="ae lq" rel="noopener" target="_blank" href="/named-entity-recognition-with-nltk-and-spacy-8c4a7d88e7da">如何使用 NLTK 和 spaCy </a>构建命名实体识别器。为了更进一步，创建一些有用的东西，本文将介绍如何使用 spaCy 开发和部署一个简单的命名实体提取器，并使用 python 中的 Flask API 为其提供服务<em class="lr">。</em></p><h1 id="f66b" class="ls lt jf bd lu lv lw lx ly lz ma mb mc kl md km me ko mf kp mg kr mh ks mi mj bi translated">烧瓶 API</h1><p id="af4a" class="pw-post-body-paragraph ku kv jf kw b kx mk kg kz la ml kj lc ld mm lf lg lh mn lj lk ll mo ln lo lp ij bi translated">我们的目标是构建一个 API，我们提供文本，例如，一篇纽约时报的文章(或任何文章)作为输入，然后我们的命名实体提取器将识别和提取四种类型的实体:组织、个人、位置和金钱。基本架构如下所示:</p><figure class="mq mr ms mt gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mp"><img src="../Images/6cee6d7011c09b33de34d364a362f5ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F85X-bnJRqTaXVMyTdoUwA.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 1</figcaption></figure><p id="bcfd" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">为了构建 API，我们需要创建两个文件:</p><ol class=""><li id="fcab" class="mu mv jf kw b kx ky la lb ld mw lh mx ll my lp mz na nb nc bi translated"><code class="fe nd ne nf ng b">index.html</code>处理 API 的模板。</li><li id="684b" class="mu mv jf kw b kx nh la ni ld nj lh nk ll nl lp mz na nb nc bi translated"><code class="fe nd ne nf ng b">app.py</code>处理请求并返回输出文件。</li></ol><p id="89b8" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">最终的产品会是这样的:</p><figure class="mq mr ms mt gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nm"><img src="../Images/b2dfa395d0d5c2375ee27d2850e92c0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wcozZJ0tPb82zktdHoaV9w.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 2</figcaption></figure><p id="b180" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">让我们开始构建 API，并逐步创建两个文件。我们的项目文件夹结构如下所示:</p><ul class=""><li id="e62d" class="mu mv jf kw b kx ky la lb ld mw lh mx ll my lp nn na nb nc bi translated">我们的项目位于<strong class="kw jg"> <em class="lr">命名-实体-提取器</em> </strong>文件夹中。</li></ul><figure class="mq mr ms mt gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi no"><img src="../Images/d7c62001d88c9665aaf2d08f9479901c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ocav7L_QHvSesCwbDTu9uw.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 3</figcaption></figure><ul class=""><li id="e039" class="mu mv jf kw b kx ky la lb ld mw lh mx ll my lp nn na nb nc bi translated"><code class="fe nd ne nf ng b">templates</code>目录与创建它的 app.py 在同一个文件夹中。</li></ul><figure class="mq mr ms mt gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi np"><img src="../Images/376bf6af03534f8c5e83be8b5ac69467.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o-Er7mrtfkYKnO7mITtrOg.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 4</figcaption></figure><ul class=""><li id="7f5c" class="mu mv jf kw b kx ky la lb ld mw lh mx ll my lp nn na nb nc bi translated">index.html 位于 templates 文件夹中。</li></ul><h2 id="b7b7" class="nq lt jf bd lu nr ns dn ly nt nu dp mc ld nv nw me lh nx ny mg ll nz oa mi ob bi translated">index.html</h2><ul class=""><li id="598e" class="mu mv jf kw b kx mk la ml ld oc lh od ll oe lp nn na nb nc bi translated">我们将我们的应用程序命名为“命名实体提取器”</li><li id="76b2" class="mu mv jf kw b kx nh la ni ld nj lh nk ll nl lp nn na nb nc bi translated">使用<a class="ae lq" href="https://www.bootstrapcdn.com/" rel="noopener ugc nofollow" target="_blank"> BootstrapCDN </a>，在所有其他样式表加载我们的 CSS 之前，将<a class="ae lq" href="https://getbootstrap.com/docs/4.1/getting-started/introduction/" rel="noopener ugc nofollow" target="_blank">样式表</a> <code class="fe nd ne nf ng b">&lt;link&gt;</code>复制粘贴到我们的<code class="fe nd ne nf ng b">&lt;head&gt;</code>中。</li><li id="9d0c" class="mu mv jf kw b kx nh la ni ld nj lh nk ll nl lp nn na nb nc bi translated">从<a class="ae lq" href="https://getbootstrap.com/docs/4.3/examples/jumbotron/#" rel="noopener ugc nofollow" target="_blank">获得 Bootstrap 的导航标题，一个简单信息网站</a>的模板。它包括一个称为<a class="ae lq" href="https://getbootstrap.com/docs/4.0/components/jumbotron/" rel="noopener ugc nofollow" target="_blank">大屏幕</a>的大标注和三个支持内容。</li><li id="5aca" class="mu mv jf kw b kx nh la ni ld nj lh nk ll nl lp nn na nb nc bi translated">从模板的<a class="ae lq" href="http://view-source:https://getbootstrap.com/docs/4.3/examples/jumbotron/" rel="noopener ugc nofollow" target="_blank">源代码</a>中复制粘贴<a class="ae lq" href="https://getbootstrap.com/docs/4.0/components/navbar/" rel="noopener ugc nofollow" target="_blank">导航栏</a>代码。</li><li id="02c1" class="mu mv jf kw b kx nh la ni ld nj lh nk ll nl lp nn na nb nc bi translated">Bootstrap 需要一个容器元素来包装站点内容并存放我们的网格系统。</li><li id="20fa" class="mu mv jf kw b kx nh la ni ld nj lh nk ll nl lp nn na nb nc bi translated">在我们的例子中，对于第一个容器，我们将创建一个带有两个输入字段的垂直表单，一个“Clear”按钮和一个“Submit”按钮。</li><li id="c356" class="mu mv jf kw b kx nh la ni ld nj lh nk ll nl lp nn na nb nc bi translated">文本表单控件是用<code class="fe nd ne nf ng b">form-control</code>类设计的。</li><li id="b11e" class="mu mv jf kw b kx nh la ni ld nj lh nk ll nl lp nn na nb nc bi translated">我们给我们的用户四个任务选项(又名命名实体提取任务)供选择，它们是:<strong class="kw jg"> <em class="lr">组织</em> </strong>，<strong class="kw jg"> <em class="lr">人</em> </strong>，<strong class="kw jg"> <em class="lr">地缘</em> </strong> &amp; <strong class="kw jg"> <em class="lr">金钱</em> </strong>。</li><li id="327b" class="mu mv jf kw b kx nh la ni ld nj lh nk ll nl lp nn na nb nc bi translated">第二个容器为我们的用户操作提供上下文反馈消息，这是命名实体提取的结果。</li><li id="1ddb" class="mu mv jf kw b kx nh la ni ld nj lh nk ll nl lp nn na nb nc bi translated">我们不仅希望向用户打印出命名实体提取结果，还希望打印出每次命名实体提取的结果数量。</li><li id="2d71" class="mu mv jf kw b kx nh la ni ld nj lh nk ll nl lp nn na nb nc bi translated">复制粘贴 html 页面末尾附近的<code class="fe nd ne nf ng b">&lt;script&gt;</code>中的<a class="ae lq" href="https://getbootstrap.com/docs/4.1/getting-started/introduction/" rel="noopener ugc nofollow" target="_blank"> JavaScript </a>，就在结束的<code class="fe nd ne nf ng b">&lt;/body&gt;</code>标签之前，</li></ul><figure class="mq mr ms mt gt is"><div class="bz fp l di"><div class="of og l"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">index.html</figcaption></figure><h2 id="04e6" class="nq lt jf bd lu nr ns dn ly nt nu dp mc ld nv nw me lh nx ny mg ll nz oa mi ob bi translated">app.py</h2><p id="f506" class="pw-post-body-paragraph ku kv jf kw b kx mk kg kz la ml kj lc ld mm lf lg lh mn lj lk ll mo ln lo lp ij bi translated">我们的<code class="fe nd ne nf ng b">app.py</code>文件相当简单易懂。它包含将由 Python 解释器执行以运行 Flask web 应用程序的主要代码，还包含用于识别命名实体的空间代码。</p><ul class=""><li id="131c" class="mu mv jf kw b kx ky la lb ld mw lh mx ll my lp nn na nb nc bi translated">我们将应用程序作为一个单独的模块运行；因此，我们用参数<code class="fe nd ne nf ng b">__name__</code>初始化了一个新的 Flask 实例，让 Flask 知道它可以在它所在的同一个目录中找到 HTML 模板文件夹(<code class="fe nd ne nf ng b">templates</code>)。</li><li id="2b17" class="mu mv jf kw b kx nh la ni ld nj lh nk ll nl lp nn na nb nc bi translated">我们使用 route decorator ( <code class="fe nd ne nf ng b">@app.route('/')</code>)来指定应该触发<code class="fe nd ne nf ng b">index</code>函数执行的 URL。</li><li id="4147" class="mu mv jf kw b kx nh la ni ld nj lh nk ll nl lp nn na nb nc bi translated">我们的<code class="fe nd ne nf ng b">index</code>函数只是呈现了位于<code class="fe nd ne nf ng b">templates</code>文件夹中的<code class="fe nd ne nf ng b">index.html</code> HTML 文件。</li><li id="e0eb" class="mu mv jf kw b kx nh la ni ld nj lh nk ll nl lp nn na nb nc bi translated">在<code class="fe nd ne nf ng b">process</code>函数中，我们将 nlp 应用于用户将要输入的原始文本，并从原始文本中提取预先确定的命名实体(<strong class="kw jg"> <em class="lr">组织</em> </strong>，<strong class="kw jg"> <em class="lr">人</em> </strong>，<strong class="kw jg"> <em class="lr">地缘</em> </strong> &amp; <strong class="kw jg"> <em class="lr">金钱</em> </strong>)。</li><li id="c850" class="mu mv jf kw b kx nh la ni ld nj lh nk ll nl lp nn na nb nc bi translated">我们使用<code class="fe nd ne nf ng b">POST</code>方法在消息体中将表单数据传输到服务器。最后，通过在<code class="fe nd ne nf ng b">app.run</code>方法中设置<code class="fe nd ne nf ng b">debug=True</code>参数，我们进一步激活了 Flask 的调试器。</li><li id="e33a" class="mu mv jf kw b kx nh la ni ld nj lh nk ll nl lp nn na nb nc bi translated">我们使用<code class="fe nd ne nf ng b">run</code>函数仅在 Python 解释器直接执行该脚本时在服务器上运行应用程序，这是通过使用带有<code class="fe nd ne nf ng b"> __name__ == '__main__'</code>的<code class="fe nd ne nf ng b">if</code>语句来确保的。</li></ul><figure class="mq mr ms mt gt is"><div class="bz fp l di"><div class="of og l"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">app.py</figcaption></figure><p id="233a" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">我们快到了！</p><h1 id="3de0" class="ls lt jf bd lu lv lw lx ly lz ma mb mc kl md km me ko mf kp mg kr mh ks mi mj bi translated">尝试我们的 API</h1><ul class=""><li id="924d" class="mu mv jf kw b kx mk la ml ld oc lh od ll oe lp nn na nb nc bi translated">启动<strong class="kw jg">命令提示<em class="lr">命令</em>。</strong></li><li id="a4c8" class="mu mv jf kw b kx nh la ni ld nj lh nk ll nl lp nn na nb nc bi translated">导航到我们的<strong class="kw jg"> <em class="lr">命名实体-提取器</em> </strong>文件夹。</li></ul><figure class="mq mr ms mt gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi oh"><img src="../Images/2f97f6ae64d3089dde1cfe3df4fe2e1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LwJ7IwucfsSJGW0EeGeb1g.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 5</figcaption></figure><ul class=""><li id="3575" class="mu mv jf kw b kx ky la lb ld mw lh mx ll my lp nn na nb nc bi translated">打开您的 Web 浏览器，将“<a class="ae lq" href="http://127.0.0.1:5000/" rel="noopener ugc nofollow" target="_blank"> http://127.0.0.1:5000/ </a>”复制粘贴到地址栏中，我们将看到以下表单:</li></ul><figure class="mq mr ms mt gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi oi"><img src="../Images/a0bdd29b1b661d6df37e87fbc14ddb50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1C41S0ZbATgKSMThlAeiWw.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 6</figcaption></figure><ul class=""><li id="9f39" class="mu mv jf kw b kx ky la lb ld mw lh mx ll my lp nn na nb nc bi translated">我复制粘贴了纽约时报的一篇文章的几段，这是一个加拿大的故事:</li></ul><figure class="mq mr ms mt gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi oj"><img src="../Images/274dea60f9915c968704fd0f248d6ad5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5rXHoJEHyJ7qDY3pR_LH0Q.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 7</figcaption></figure><ul class=""><li id="4ba8" class="mu mv jf kw b kx ky la lb ld mw lh mx ll my lp nn na nb nc bi translated">在“选择任务”下选择“<strong class="kw jg"> <em class="lr">组织</em> </strong>，然后点击“提交”，这是我们得到的结果:</li></ul><figure class="mq mr ms mt gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ok"><img src="../Images/01eeb4bbef6253b6dca6a4610a09f28e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HQRA4-fqu2AvGlSx4R2IEw.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 8</figcaption></figure><ul class=""><li id="59b3" class="mu mv jf kw b kx ky la lb ld mw lh mx ll my lp nn na nb nc bi translated">很好。让我们试试<strong class="kw jg"> <em class="lr">人</em> </strong>实体:</li></ul><figure class="mq mr ms mt gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ol"><img src="../Images/41443dc63b29e48f02cefe2bb6573ee4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*10oqzVu4e54yj1FriPJaSg.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 9</figcaption></figure><ul class=""><li id="79a0" class="mu mv jf kw b kx ky la lb ld mw lh mx ll my lp nn na nb nc bi translated"><strong class="kw jg"><em class="lr"/></strong>“实体:</li></ul><figure class="mq mr ms mt gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi om"><img src="../Images/4a76b8c9d62d8c00bac90a76d4ccb650.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pFZGKdABDrFomefJkUU9IA.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 10</figcaption></figure><ul class=""><li id="41c5" class="mu mv jf kw b kx ky la lb ld mw lh mx ll my lp nn na nb nc bi translated"><strong class="kw jg"> <em class="lr">金钱</em> </strong>实体:</li></ul><figure class="mq mr ms mt gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi on"><img src="../Images/abb3aab8ed7522689498119d8d475318.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Md0R0sZ5xSJXoPUWUWQ0JA.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 11</figcaption></figure><p id="1f42" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">我们完了！</p><p id="09c5" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">如果你按照上面的步骤做到了，那么恭喜你！您已经零成本地创建了一个简单而有效的命名实体提取器！回头看，我们只需要创建两个文件。我们所需要的是开源库和学习如何使用它们来创建这两个文件。</p><p id="fdfb" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">通过构建这样一个应用程序，你学到了新的技能，并利用这些技能创造出有用的东西。</p><p id="769e" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">完整的源代码可以从这个<a class="ae lq" href="https://github.com/susanli2016/Named-Entity-Extractor" rel="noopener ugc nofollow" target="_blank">库</a>获得。周一快乐！</p><p id="28ec" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">参考:</p><figure class="mq mr ms mt gt is"><div class="bz fp l di"><div class="oo og l"/></div></figure></div></div>    
</body>
</html>