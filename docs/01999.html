<html>
<head>
<title>Animated charts: visualizing “changes” in R</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">动画图表:可视化 R 中的“变化”</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/animated-charts-visualizing-changes-in-r-fee659fbabe5?source=collection_archive---------19-----------------------#2019-04-02">https://towardsdatascience.com/animated-charts-visualizing-changes-in-r-fee659fbabe5?source=collection_archive---------19-----------------------#2019-04-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="6360" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><a class="ae ko" href="https://www.makeovermonday.co.uk/data/" rel="noopener ugc nofollow" target="_blank">改头换面周一</a>发布了一项来自<a class="ae ko" href="https://data.worldbank.org/indicator/SP.ADO.TFRT" rel="noopener ugc nofollow" target="_blank">世界银行的关于世界发展指标的每周数据挑战:<strong class="js iu">青少年生育率(每千名 15-19 岁女性的出生率)</strong> </a>三月份。有了这个数据集，首先我想看看这些数字是如何随时间变化的，以及在收入群体方面是否存在模式。本文反映了数据操作的过程以及图表是如何从静态发展到动态的。</p><h2 id="8529" class="kp kq it bd kr ks kt dn ku kv kw dp kx kb ky kz la kf lb lc ld kj le lf lg lh bi translated">线条的变化</h2><p id="a8d1" class="pw-post-body-paragraph jq jr it js b jt li jv jw jx lj jz ka kb lk kd ke kf ll kh ki kj lm kl km kn im bi translated">当谈到随时间的变化时，折线图是查看结果的快速而清晰的解决方案。</p><pre class="ln lo lp lq gt lr ls lt lu aw lv bi"><span id="6f5e" class="kp kq it ls b gy lw lx l ly lz">setting &lt;- ggplot(final, aes(Year, Rate, group = Country))</span><span id="1884" class="kp kq it ls b gy ma lx l ly lz">setting+ <br/> geom_line(alpha = 0.5, aes(color = factor(Income_group))) +<br/> scale_colour_manual(values = c(high, upmiddle, lowmiddle, low)) + <br/> facet_grid(~Income_group) + <br/> theme_minimal()</span></pre><figure class="ln lo lp lq gt mc gh gi paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="gh gi mb"><img src="../Images/83620fffc4fb4b41e3853d57146bea87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k3XtZDul0j58t-owWCVg8Q.png"/></div></div></figure><p id="74da" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">正如我所料，几乎每个国家的青少年生育率都在下降。不同收入群体之间的差异在于，高收入国家的青少年生育率在 20 世纪 90 年代下降得相当快；而低收入国家的失业率下降缓慢。情况正在好转，只是在世界的某些地方没有那么快。</p><h2 id="9e96" class="kp kq it bd kr ks kt dn ku kv kw dp kx kb ky kz la kf lb lc ld kj le lf lg lh bi translated">视觉上强调“变化”</h2><p id="c635" class="pw-post-body-paragraph jq jr it js b jt li jv jw jx lj jz ka kb lk kd ke kf ll kh ki kj lm kl km kn im bi translated">根据上面的观察，我在想如何将收入群体的快速和缓慢变化可视化。我以 10 年为间隔提取了 1960 年至 2016 年的数据集，并创建了直方图来查看逐年的变化。</p><pre class="ln lo lp lq gt lr ls lt lu aw lv bi"><span id="8c5e" class="kp kq it ls b gy lw lx l ly lz"># extract data for some years<br/>data.someyears &lt;- final %&gt;% <br/> filter(Year %in% c(2016, 2010, 2000, 1990, 1980, 1970, 1960))</span><span id="de71" class="kp kq it ls b gy ma lx l ly lz">ggplot(data.someyears, aes(Rate, fill = factor(Income_group))) +<br/> geom_histogram() +<br/> scale_fill_manual(values = c(high, upmiddle, lowmiddle, low)) +<br/> facet_grid( ~Year) +<br/> theme_minimal() +<br/> coord_flip()</span></pre><figure class="ln lo lp lq gt mc gh gi paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="gh gi mj"><img src="../Images/d7ffb74ea05ddbdc319c0e3cd98f7bb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z5of11wNCo18jWJnuYaPsg.png"/></div></div></figure><p id="32b7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如直方图所示，随着时间的推移，越来越多的国家青少年生育率下降。高收入国家从高税率到低税率有显著的变化；低收入国家只取得一点点进步。然而，从 8 个独立的数据片段中想象这种运动并不容易。</p><h2 id="af53" class="kp kq it bd kr ks kt dn ku kv kw dp kx kb ky kz la kf lb lc ld kj le lf lg lh bi translated">制作动画图表</h2><p id="131b" class="pw-post-body-paragraph jq jr it js b jt li jv jw jx lj jz ka kb lk kd ke kf ll kh ki kj lm kl km kn im bi translated">这一系列直方图让我想起了制作动画图表的想法，这样我们就可以直接“看到”变化。我找到了一篇关于使用 gganimate 库在 R 中制作动画的<a class="ae ko" href="https://www.datanovia.com/en/blog/gganimate-how-to-create-plots-with-beautiful-animation-in-r/" rel="noopener ugc nofollow" target="_blank">有用文章。</a></p><pre class="ln lo lp lq gt lr ls lt lu aw lv bi"><span id="ccf1" class="kp kq it ls b gy lw lx l ly lz">movinghist &lt;- ggplot(final, aes(Rate, fill = factor(Income_group))) +<br/> geom_histogram() +<br/> scale_fill_manual(values = c(high, upmiddle, lowmiddle, low)) +<br/> theme_minimal() +<br/> coord_flip() +<br/> #animation setting<br/> labs(<br/> title = ‘Year: {frame_time}’,<br/> y = ‘Number of countries’, <br/> x = ‘Adolescent Fertility Rate (births per 1000 woman between 15–19)’<br/> ) +<br/> transition_time(as.integer(Year)) + #show the Year as integer<br/> ease_aes(‘linear’)</span><span id="aea4" class="kp kq it ls b gy ma lx l ly lz">animate(movinghist, width = 600, height = 600)</span></pre><figure class="ln lo lp lq gt mc gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/22da4fb4181402abb027e57be57dc7f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*O-TC2djyvYAGzN-_jjIgRA.gif"/></div></figure><p id="c309" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">动画很有帮助。我们可以看到不同收入群体的国家如何降低青少年生育率。</p><p id="045c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">除了按组可视化变化，我还进一步可视化了单个国家的变化。这样，<strong class="js iu">每个国家都有自己的地方，一个圆点就是一年的青少年生育率。由于有这么多国家，我一次制作了一个收入群体的动画图表。</strong></p><p id="c8f7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">下面是一组的结果:</p><figure class="ln lo lp lq gt mc gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/4bc17816eabc12e19c8d08df894e25ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*6548-pOeVysSk9mom3K7iA.gif"/></div></figure><p id="a088" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">移动的点显示了有趣的行为。一些国家的利率有升有降。有些有明显的下降。如果用彩色编码，图表会提供更多的信息。因此，我计算了每年数字的变化，用绿色表示减少(因为越少越好)，红色表示增加，灰色表示没有变化<em class="mm">(1960 年也是没有变化)</em></p><pre class="ln lo lp lq gt lr ls lt lu aw lv bi"><span id="432d" class="kp kq it ls b gy lw lx l ly lz">movingdots &lt;- ggplot(filter(final, Income_group == ‘High income’), aes(Country, Rate, color = factor(Status))) +<br/> geom_point(alpha = 0.7, size = 2) +<br/> scale_color_manual(values = c(down, up, same)) +<br/> facet_grid(~Income_group, scales = ‘free’) +<br/> theme_minimal() +<br/> theme(axis.text.x = element_text(angle = 60, hjust = 1)) +<br/> #animation setting<br/> labs(<br/> title = ‘Year: {frame_time}’,<br/> x = ‘Country’, <br/> y = ‘Adolescent Fertility Rate (births per 1000 woman between 15–19)’<br/> ) +<br/> transition_time(as.integer(Year)) + #show the Year as integer<br/> shadow_mark(alpha = 0.3, size = 0.5) +<br/> ease_aes(‘linear’)</span><span id="7f50" class="kp kq it ls b gy ma lx l ly lz">animate(movingdots, width= 1800, height=600)</span></pre><figure class="ln lo lp lq gt mc gh gi paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="gh gi mn"><img src="../Images/da8d53e1ec237d88c83e485961a5904e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*CJON3ccSmfQ20ztqhPIVrg.gif"/></div></div></figure><p id="2c85" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我有点沉迷于这些点，继续看它们。</p><p id="be68" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">请随时与我分享反馈。</p></div></div>    
</body>
</html>