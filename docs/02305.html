<html>
<head>
<title>Deep embedding’s for categorical variables (Cat2Vec)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">分类变量的深度嵌入(Cat2Vec)</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/deep-embeddings-for-categorical-variables-cat2vec-b05c8ab63ac0?source=collection_archive---------3-----------------------#2019-04-16">https://towardsdatascience.com/deep-embeddings-for-categorical-variables-cat2vec-b05c8ab63ac0?source=collection_archive---------3-----------------------#2019-04-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="b67e" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">对表格数据使用深度学习</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/312b804009e00af633dd02995f85c9f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/format:webp/1*swQ2gwFGri4u4c6pdN6jDA.png"/></div></figure><p id="e4fa" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">在这篇博客中，我将带你了解在 keras 上使用深度学习网络创建分类变量嵌入的步骤。这个概念最初是由杰瑞米·霍华德在他的 fastai 课程中提出的。更多<a class="ae lj" href="https://www.fast.ai/2018/04/29/categorical-embeddings/" rel="noopener ugc nofollow" target="_blank">详情</a>请看链接。</p><h2 id="6e6d" class="lk ll iq bd lm ln lo dn lp lq lr dp ls kw lt lu lv la lw lx ly le lz ma mb mc bi translated">传统嵌入</h2><p id="806d" class="pw-post-body-paragraph kn ko iq kp b kq md jr ks kt me ju kv kw mf ky kz la mg lc ld le mh lg lh li ij bi translated">在我们使用的大多数数据源中，我们会遇到两种主要类型的变量:</p><ol class=""><li id="2801" class="mi mj iq kp b kq kr kt ku kw mk la ml le mm li mn mo mp mq bi translated"><strong class="kp ir">连续变量:</strong>通常是整数或十进制数，有无限多的可能值，如计算机存储单元，如 1GB、2GB 等..</li><li id="ad3c" class="mi mj iq kp b kq mr kt ms kw mt la mu le mv li mn mo mp mq bi translated"><strong class="kp ir">分类变量:</strong>这些是离散变量，用于根据某些特征分割数据。例如计算机存储器的类型，即 RAM 存储器、内部硬盘、外部硬盘等。</li></ol><p id="b31d" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">当我们建立一个最大似然模型的时候，在我们能够在算法中使用它之前，我们需要转换分类变量。所应用的转换对模型的性能有很大的影响，尤其是当数据具有大量高基数的分类要素时。应用的一些常见转换示例包括:</p><p id="6501" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><strong class="kp ir"> One-Hot encoding: </strong>这里我们将每个类别值转换成一个新列，并为该列分配一个<code class="fe mw mx my mz b">1</code>或<code class="fe mw mx my mz b">0</code> (True/False)值。</p><p id="65c1" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><strong class="kp ir">二进制编码</strong>:这创建了比一个热点更少的特性，同时保留了列中值的一些唯一性。它可以很好地处理高维有序数据。</p><p id="1472" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">然而，这些通常的变换并不能捕捉分类变量之间的关系。有关不同类型的<a class="ae lj" href="https://www.datacamp.com/community/tutorials/categorical-data" rel="noopener ugc nofollow" target="_blank">编码方法</a>的更多信息，请参见以下链接。</p><h1 id="a7ec" class="na ll iq bd lm nb nc nd lp ne nf ng ls jw nh jx lv jz ni ka ly kc nj kd mb nk bi translated">数据</h1><p id="c9fc" class="pw-post-body-paragraph kn ko iq kp b kq md jr ks kt me ju kv kw mf ky kz la mg lc ld le mh lg lh li ij bi translated">为了演示深度嵌入的应用，让我们以 Kaggle 的<a class="ae lj" href="https://www.kaggle.com/contactprad/bike-share-daily-data" rel="noopener ugc nofollow" target="_blank">自行车共享</a>数据为例。这里的也链接到 git 回购。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="nm nn di no bf np"><div class="gh gi nl"><img src="../Images/ce26a2a57adeefd6afcaea9ff57e624a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bWw2YKMezrrMj3iyoiuxOg.png"/></div></div><figcaption class="nq nr gj gh gi ns nt bd b be z dk">Data — Bike Sharing</figcaption></figure><p id="e2dc" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">正如我们所看到的，数据集中有许多列。为了演示这个概念，我们将只使用来自<strong class="kp ir"> </strong>数据的<strong class="kp ir"> date_dt、cnt </strong>和<strong class="kp ir"> mnth </strong>列。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/22a03f76e341f93a28e6ed2ab89f1f2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:384/format:webp/1*__AiZezZ2WUSQdMzGvwTrg.png"/></div><figcaption class="nq nr gj gh gi ns nt bd b be z dk">Selected Columns</figcaption></figure><p id="47ad" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">传统的<strong class="kp ir">一键编码</strong>会产生 12 列，每个月一列。然而，在这种类型的嵌入中，一周中的每一天都具有同等的重要性，并且每个月之间没有关系。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/8c6d228c1908ea6a7859f2dcac494815.png" data-original-src="https://miro.medium.com/v2/resize:fit:584/format:webp/1*NgtEUGgyXeKbR4XBG_-d7w.png"/></div><figcaption class="nq nr gj gh gi ns nt bd b be z dk">One hot encoding of the mnth column</figcaption></figure><p id="b74f" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">我们可以在下图中看到每个月的季节性模式。正如我们所见，第 4 到 9 个月是高峰期。0 月、1 月、10 月和 11 月是自行车租赁需求较低的月份。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="nm nn di no bf np"><div class="gh gi nw"><img src="../Images/67d36fbd8746110cce7a7b429d8f14ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Iv6J51_P8uLOqf6PoxmP8A.png"/></div></div><figcaption class="nq nr gj gh gi ns nt bd b be z dk">Monthly Seasonality</figcaption></figure><p id="e6f9" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">此外，当我们用不同的颜色表示每个月的日使用量时，我们可以看到每个月内的一些周模式。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="nm nn di no bf np"><div class="gh gi nx"><img src="../Images/5051cff19b245193e8be1acb9558f3dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u2phW5bA9vG4h0ht8Qn4pA.png"/></div></div><figcaption class="nq nr gj gh gi ns nt bd b be z dk">Daily usage trends</figcaption></figure><p id="651f" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">理想情况下，我们期望通过使用嵌入来捕获这种关系。在下一节中，我们将使用构建在 keras 之上的深层网络来研究这些嵌入的生成。</p><h2 id="6b22" class="lk ll iq bd lm ln lo dn lp lq lr dp ls kw lt lu lv la lw lx ly le lz ma mb mc bi translated"><strong class="ak">深度编码</strong></h2><p id="98ee" class="pw-post-body-paragraph kn ko iq kp b kq md jr ks kt me ju kv kw mf ky kz la mg lc ld le mh lg lh li ij bi translated">代码如下所示。我们将建立一个具有密集层网络和“relu”激活功能的感知器网络。</p><p id="ffee" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">网络的输入，即'<strong class="kp ir"> x </strong>'变量是月份号。这是一年中每个月的数字表示，范围从 0 到 11。因此，input_dim 被设置为 12。</p><p id="fe75" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">网络的输出，即'<strong class="kp ir"> y </strong>'是' cnt '的缩放列。然而，可以增加“y”以包括其他连续变量。这里我们使用一个连续变量，我们将输出密集层的最后一个数字设置为 1。我们将为 50 个迭代或时期训练模型。</p><pre class="kg kh ki kj gt ny mz nz oa aw ob bi"><span id="d477" class="lk ll iq mz b gy oc od l oe of">embedding_size = 3</span><span id="4126" class="lk ll iq mz b gy og od l oe of">model = models.Sequential()<br/>model.add(Embedding(input_dim = 12, output_dim = embedding_size, input_length = 1, name="embedding"))<br/>model.add(Flatten())<br/>model.add(Dense(50, activation="relu"))<br/>model.add(Dense(15, activation="relu"))<br/>model.add(Dense(1))<br/>model.compile(loss = "mse", optimizer = "adam", metrics=["accuracy"])<br/>model.fit(x = data_small_df['mnth'].as_matrix(), y=data_small_df['cnt_Scaled'].as_matrix() , epochs = 50, batch_size = 4)</span></pre><h2 id="0496" class="lk ll iq bd lm ln lo dn lp lq lr dp ls kw lt lu lv la lw lx ly le lz ma mb mc bi translated">网络参数</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/59f07b91e1a4106a0f5543d7b9a76011.png" data-original-src="https://miro.medium.com/v2/resize:fit:1262/format:webp/1*png48G-xkG5UZPcgArUVyA.png"/></div><figcaption class="nq nr gj gh gi ns nt bd b be z dk">Model Summary</figcaption></figure><p id="3dc7" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><strong class="kp ir">嵌入层:</strong>我们在这里指定分类变量的嵌入大小。在本例中，我使用了<strong class="kp ir">3</strong><strong class="kp ir">，</strong>如果我们增加这个值，它将捕获分类变量之间关系的更多细节。杰瑞米·霍华德建议采用以下方法来选择嵌入尺寸:</p><pre class="kg kh ki kj gt ny mz nz oa aw ob bi"><span id="a0a3" class="lk ll iq mz b gy oc od l oe of"># m is the no of categories per feature</span><span id="a0de" class="lk ll iq mz b gy og od l oe of">embedding_size = min(50, m+1/ 2)</span></pre><p id="820b" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">我们使用一个具有均方误差损失函数的“adam”优化器。Adam 优于 sgd(随机梯度下降),因为它的自适应学习速率更快更优化。你可以在这里找到关于不同类型优化器<a class="ae lj" href="https://machinelearningmastery.com/adam-optimization-algorithm-for-deep-learning/" rel="noopener ugc nofollow" target="_blank">的更多细节。</a></p><h2 id="1645" class="lk ll iq bd lm ln lo dn lp lq lr dp ls kw lt lu lv la lw lx ly le lz ma mb mc bi translated"><strong class="ak">结果</strong></h2><p id="d69f" class="pw-post-body-paragraph kn ko iq kp b kq md jr ks kt me ju kv kw mf ky kz la mg lc ld le mh lg lh li ij bi translated">每个月的最终嵌入结果如下。这里“0”代表一月，“11”代表十二月。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/1c0b9755e5987a2e99498f14fdbceeb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:654/format:webp/1*n8pWCtwF87nco7joKKk-0w.png"/></div><figcaption class="nq nr gj gh gi ns nt bd b be z dk">Embedding Table</figcaption></figure><p id="ae0f" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">当我们用一个 3D 图将它可视化时，我们可以清楚地看到月份之间的关系。具有相似“计数”的月份更接近地分组在一起，例如，第 4 个月到第 9 个月彼此非常相似。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="nm nn di no bf np"><div class="gh gi oj"><img src="../Images/2dc7d78ce7b1a084453bba098ff1706b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iclS8GD-jKHbr2BRQ2fxmA.png"/></div></div><figcaption class="nq nr gj gh gi ns nt bd b be z dk">Embeddings — Months of the year</figcaption></figure><h2 id="48ef" class="lk ll iq bd lm ln lo dn lp lq lr dp ls kw lt lu lv la lw lx ly le lz ma mb mc bi translated"><strong class="ak">结论</strong></h2><p id="b68f" class="pw-post-body-paragraph kn ko iq kp b kq md jr ks kt me ju kv kw mf ky kz la mg lc ld le mh lg lh li ij bi translated">总之，我们已经看到，通过使用 Cat2Vec(类别变量到向量),我们可以使用低维嵌入来表示高基数类别变量，同时保留每个类别之间的关系。</p><p id="b156" class="pw-post-body-paragraph kn ko iq kp b kq kr jr ks kt ku ju kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">在接下来的几篇博客中，我们将探讨如何使用这些嵌入来构建具有更好性能的监督和非监督机器学习模型。</p></div></div>    
</body>
</html>