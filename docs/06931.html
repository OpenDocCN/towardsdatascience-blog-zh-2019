<html>
<head>
<title>Web Scraping and Visualizing Chess Data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">网络抓取和可视化象棋数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/web-scraping-and-visualizing-chess-data-af75f8f92354?source=collection_archive---------23-----------------------#2019-10-01">https://towardsdatascience.com/web-scraping-and-visualizing-chess-data-af75f8f92354?source=collection_archive---------23-----------------------#2019-10-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><h1 id="9578" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">动机</h1><p id="2159" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">我一直在学习 web 抓取和数据可视化，主要是通过这个网站上发表的文章，虽然我已经找到了几十篇文章，对 web 抓取进行了快速介绍，但很少有人能超越这一点。我希望就如何在一个站点的 html 源代码中查找数据，如何抓取多个页面并收集数据，以及一旦一个人实际上拥有了她想要的数据后该做什么提供一些建议。</p><h1 id="207c" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">话题</h1><p id="8cc7" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">我从 2018 年 11 月开始下棋，从那时起，我已经玩了 1，566 场不同速度的游戏，平均每天约 5 场。我使用 chess.com 的应用程序玩游戏，该应用程序除了维护每场游戏的完整历史记录之外，还跟踪每个用户的一些基本统计数据。</p><figure class="ln lo lp lq gt lr gh gi paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="gh gi lm"><img src="../Images/081a8254735fa52aab4c2a8d6c2e155d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZX1ty4d9iclvKGc27xm9wA.png"/></div></div><figcaption class="ly lz gj gh gi ma mb bd b be z dk">Screenshot of Chess.com’s stats page</figcaption></figure><p id="0a2e" class="pw-post-body-paragraph ko kp it kq b kr mc kt ku kv md kx ky kz me lb lc ld mf lf lg lh mg lj lk ll im bi translated">虽然 chess.com 在 UX 做了令人难以置信的工作，但统计数据页面还有待改进。因为我一直在寻找项目来练习/学习更多关于网页抓取和数据可视化的知识，所以我决定收集我过去游戏的统计数据，并将收集到的一些见解可视化。</p><h1 id="7b79" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">网站结构</h1><p id="ae40" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">“存档”页面允许用户查看她过去的所有游戏，如果她想回顾或分析它们的话。从 web 抓取的角度来看，可以看到关于每个游戏的各种信息整齐地存储在各行中，包括:</p><p id="d5f5" class="pw-post-body-paragraph ko kp it kq b kr mc kt ku kv md kx ky kz me lb lc ld mf lf lg lh mg lj lk ll im bi translated">所玩游戏的类型<br/>用户的棋子颜色、名称、elo 和国家<br/>对手的棋子颜色、名称、elo 和国家<br/>游戏结果(赢或输)<br/>游戏中的棋步数<br/>游戏日期</p><figure class="ln lo lp lq gt lr gh gi paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="gh gi mh"><img src="../Images/9adc827e22b73d7daccab002f79cf7eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*90vsLfa3ogSRBkaYqsV9Nw.png"/></div></div><figcaption class="ly lz gj gh gi ma mb bd b be z dk">Screenshot of Chess.com’s game archive</figcaption></figure><p id="9dec" class="pw-post-body-paragraph ko kp it kq b kr mc kt ku kv md kx ky kz me lb lc ld mf lf lg lh mg lj lk ll im bi translated">首先要做的是检查页面(右键单击→检查)以查看其底层 HTML 源代码。点击左上角的选择器工具，然后点击游戏图标，就可以直接指向网站这部分的代码。</p><figure class="ln lo lp lq gt lr gh gi paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="gh gi mi"><img src="../Images/8b29485527d5031ad588ace9f25c482a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WyMY5X4FtwyfLlB0EgBwEw.png"/></div></div></figure><p id="c0e5" class="pw-post-body-paragraph ko kp it kq b kr mc kt ku kv md kx ky kz me lb lc ld mf lf lg lh mg lj lk ll im bi translated">为了收集这些数据，我使用 Requests 库来获取站点的 HTML 代码，使用 BeautifulSoup 库来解析这些代码并获得我想要的数据。大致的想法如下所示:</p><pre class="ln lo lp lq gt mj mk ml mm aw mn bi"><span id="fb6a" class="mo jr it mk b gy mp mq l mr ms">page = requests.get('<a class="ae mt" href="https://www.chess.com/games/archive/eono619" rel="noopener ugc nofollow" target="_blank">https://www.chess.com/games/archive/eono619</a>')<br/>text = page.text</span><span id="bb9f" class="mo jr it mk b gy mu mq l mr ms">b = BeautifulSoup(text, 'html.parser')</span><span id="d517" class="mo jr it mk b gy mu mq l mr ms">content = b.find('span', attrs={'class': re.compile("archive-games-game-time")})</span><span id="2119" class="mo jr it mk b gy mu mq l mr ms">content.getText().strip()</span></pre><p id="df72" class="pw-post-body-paragraph ko kp it kq b kr mc kt ku kv md kx ky kz me lb lc ld mf lf lg lh mg lj lk ll im bi translated">在这段代码中，我:<br/> 1。抓取带有请求的页面<br/> 2。从它创建一个美丽的组对象<br/> 3。使用对象的。find()方法通过输入标签(' span ')和属性来查找包含我想要的数据的 html 代码。这就产生了下面这个有点乱的字符串:"&lt;span class = " archive-games-game-time "&gt;5 分钟&lt; /span &gt; " <br/> 4。最后用。getText()方法并用 string 方法清理它。条状()</p><p id="02dd" class="pw-post-body-paragraph ko kp it kq b kr mc kt ku kv md kx ky kz me lb lc ld mf lf lg lh mg lj lk ll im bi translated">每个数据点都有自己独特的 HTML 标签和属性，但这是从网页中提取数据的通用格式。因为我想要页面上的所有游戏，而不仅仅是一个，所以我使用 BeautifulSoup。findAll()方法获取页面上具有该标签和属性的所有元素。对于我想要的每个数据点，我创建了一个类似上面的助手函数，它为给定的页面提取所有这些数据点。</p><pre class="ln lo lp lq gt mj mk ml mm aw mn bi"><span id="bb57" class="mo jr it mk b gy mp mq l mr ms">def pull_speed(Bsoup):<br/>    times = []<br/>    for i in b.findAll('span', attrs={'class': re.compile("archive-games-game-time")}):<br/>        times.append((i.getText().strip()))<br/>    <br/>    return times</span></pre><p id="0204" class="pw-post-body-paragraph ko kp it kq b kr mc kt ku kv md kx ky kz me lb lc ld mf lf lg lh mg lj lk ll im bi translated">为了浏览多个页面，我转到了网址:</p><p id="0db6" class="pw-post-body-paragraph ko kp it kq b kr mc kt ku kv md kx ky kz me lb lc ld mf lf lg lh mg lj lk ll im bi translated"><a class="ae mt" href="https://www.chess.com/games/archive/eono619?gameOwner=my_game&amp;gameTypes%5B0%5D=chess960&amp;gameTypes%5B1%5D=daily&amp;gameType=live&amp;page=2" rel="noopener ugc nofollow" target="_blank">https://www . chess . com/games/archive/eono 619？gameOwner=my_game &amp;游戏类型%5B0%5D=chess960 &amp;游戏类型% 5b 1% 5D =每日&amp;游戏类型=直播&amp;T1】page = 2T3】</a></p><p id="8d38" class="pw-post-body-paragraph ko kp it kq b kr mc kt ku kv md kx ky kz me lb lc ld mf lf lg lh mg lj lk ll im bi translated">通过更改最后一个参数中的页码，我可以遍历页面。我的总体抓取代码初始化空列表来存储结果，遍历每个页面并调用助手函数来抓取我想要的数据，然后收集 pandas dataframe 中的所有内容进行分析。</p><figure class="ln lo lp lq gt lr"><div class="bz fp l di"><div class="mv mw l"/></div><figcaption class="ly lz gj gh gi ma mb bd b be z dk">Full notebook and data on my GitHub (<a class="ae mt" href="https://github.com/eonofrey/chess_scrape_2" rel="noopener ugc nofollow" target="_blank">https://github.com/eonofrey/chess_scrape_2</a>)</figcaption></figure><p id="d743" class="pw-post-body-paragraph ko kp it kq b kr mc kt ku kv md kx ky kz me lb lc ld mf lf lg lh mg lj lk ll im bi translated">最后，我的数据帧有 9 列 1566 行，包含了我深入游戏所需的一切。</p><h1 id="0ed6" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">可视化</h1><p id="54d3" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">我做的第一个图只是看看我的 elo 如何随着时间的推移沿着 30 天移动平均线前进，以消除一些粒状数据固有的波动。很明显有一个上升的趋势，这让我很高兴看到，因为这表明我确实在学习这个游戏，尽管偶尔会遇到困难。</p><figure class="ln lo lp lq gt lr"><div class="bz fp l di"><div class="mv mw l"/></div></figure><figure class="ln lo lp lq gt lr gh gi paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="gh gi mx"><img src="../Images/fed427724aa02c2103782d340b3ca763.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mAVNWEKnELEsKLTq2N3HNA.png"/></div></div></figure><p id="c341" class="pw-post-body-paragraph ko kp it kq b kr mc kt ku kv md kx ky kz me lb lc ld mf lf lg lh mg lj lk ll im bi translated">接下来，我使用 Seaborn 的 countplots 查看了与我对战的不同国家，这是一个非常有用的函数，它绘制了传递给它的变量的计数。</p><figure class="ln lo lp lq gt lr"><div class="bz fp l di"><div class="mv mw l"/></div></figure><figure class="ln lo lp lq gt lr gh gi paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="gh gi mx"><img src="../Images/f08bb518de3dc665200eeb397fffd89c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NWgMrEjTGNUBqkLoXkUhfQ.png"/></div></div></figure><p id="644e" class="pw-post-body-paragraph ko kp it kq b kr mc kt ku kv md kx ky kz me lb lc ld mf lf lg lh mg lj lk ll im bi translated">不幸的是，我在每个国家玩过的游戏列表有一个很长的尾巴，但是当我将 order 参数传递给 countplot 函数时，我只能传递我的数据帧中的一部分(order = speed _ games[' opposite _ country ']。【value _ counts().iloc[1:25] 。index)来解决这个问题。在这里，我只列出了前 25 个值，并排除了美国，因为它在这张图表中占了很大一部分。</p><figure class="ln lo lp lq gt lr"><div class="bz fp l di"><div class="mv mw l"/></div></figure><figure class="ln lo lp lq gt lr gh gi paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="gh gi mx"><img src="../Images/4ba24058e2590612d8ed47a07e02e8bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uh0RKAA4la6C6bGP3eNGhQ.png"/></div></div></figure><p id="935b" class="pw-post-body-paragraph ko kp it kq b kr mc kt ku kv md kx ky kz me lb lc ld mf lf lg lh mg lj lk ll im bi translated">在此之后，我决定通过对不同的字段进行分组并查看各种汇总统计数据来稍微处理一下我的数据框架。我发现两种最好的方法是。重新取样()和。group_by()方法。在这里，我按月和周对数据进行分组，以获得每个时间段玩游戏的数量，并添加一条水平线来显示每个频率下玩游戏的平均数量。</p><figure class="ln lo lp lq gt lr"><div class="bz fp l di"><div class="mv mw l"/></div></figure><figure class="ln lo lp lq gt lr gh gi paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="gh gi my"><img src="../Images/6d5c12342758311c545ddae50d66577d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wIceQeWQxbGKzf-QU2Q8xw.png"/></div></div></figure><p id="3859" class="pw-post-body-paragraph ko kp it kq b kr mc kt ku kv md kx ky kz me lb lc ld mf lf lg lh mg lj lk ll im bi translated">为了想象我和不同国家的玩家打得有多好，我需要做更多的预处理。我首先将数据按国家分组，得到游戏的数量以及结果的平均值(1 =赢，0 =输)，这相当于一个胜率。然后，我将国家栏上的两个数据框连接起来，这样我就可以将我的图表限制在我至少打过 15 场比赛的国家。</p><figure class="ln lo lp lq gt lr"><div class="bz fp l di"><div class="mv mw l"/></div></figure><figure class="ln lo lp lq gt lr gh gi paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="gh gi mx"><img src="../Images/4c301df7f2235efb248c4b367c63b30e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NdJU-FCOisuU0DTeCsLBag.png"/></div></div></figure><p id="6ac7" class="pw-post-body-paragraph ko kp it kq b kr mc kt ku kv md kx ky kz me lb lc ld mf lf lg lh mg lj lk ll im bi translated">接下来，我调查了我的胜率是否随着一周的不同而变化。有趣的是，我似乎在周末打得更好。</p><figure class="ln lo lp lq gt lr"><div class="bz fp l di"><div class="mv mw l"/></div></figure><figure class="ln lo lp lq gt lr gh gi paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="gh gi my"><img src="../Images/db39843499af10357eb0dfe196f01303.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rIkx57yjvv_qm9Y9yQUlMw.png"/></div></div></figure><p id="b673" class="pw-post-body-paragraph ko kp it kq b kr mc kt ku kv md kx ky kz me lb lc ld mf lf lg lh mg lj lk ll im bi translated">最后，我调查了每种颜色的胜率。由于白棋先走，所以比黑棋略占优势，预计赢的几率更大。我的数据支持这一点，显示我用白棋比用黑棋多赢了大约 4%。</p><p id="37d3" class="pw-post-body-paragraph ko kp it kq b kr mc kt ku kv md kx ky kz me lb lc ld mf lf lg lh mg lj lk ll im bi translated">我还研究了我赢的游戏和输的游戏的平均移动次数。有趣的是，我赢的游戏比我输的游戏平均多走两步。</p><figure class="ln lo lp lq gt lr"><div class="bz fp l di"><div class="mv mw l"/></div></figure><figure class="ln lo lp lq gt lr gh gi paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="gh gi mz"><img src="../Images/d62daa303adf0e941b7fce52bb59ffb6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QiwjorsPX2gqtmB_vxIjLg.png"/></div></div></figure><p id="d537" class="pw-post-body-paragraph ko kp it kq b kr mc kt ku kv md kx ky kz me lb lc ld mf lf lg lh mg lj lk ll im bi translated">我本可以探究这些数据的某些方面，但是为了保持简洁，我将在这里删减这篇文章。通过开展这个项目，我提高了我的网络抓取和数据可视化技能，甚至最终获得了一些关于我的象棋比赛的见解，这是一个额外的好处。我最终的希望是，有人能使用这里的课程/代码片段来帮助他们完成自己的项目。对于那些感兴趣的人，我的完整脚本和数据集可以在我的 GitHub 页面<a class="ae mt" href="https://github.com/eonofrey/chess_scrape_2" rel="noopener ugc nofollow" target="_blank">https://github.com/eonofrey/chess_scrape_2</a>找到。要获得所有媒体文章的完整访问权限，请点击<a class="ae mt" href="https://eonofrey.medium.com/membership" rel="noopener">此处</a>！</p></div></div>    
</body>
</html>