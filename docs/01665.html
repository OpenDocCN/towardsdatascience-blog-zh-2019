<html>
<head>
<title>How to stop training a neural-network using callback?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何停止使用回调训练神经网络？</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/neural-network-with-tensorflow-how-to-stop-training-using-callback-5c8d575c18a9?source=collection_archive---------14-----------------------#2019-03-18">https://towardsdatascience.com/neural-network-with-tensorflow-how-to-stop-training-using-callback-5c8d575c18a9?source=collection_archive---------14-----------------------#2019-03-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/dc9fc48f4ddb2fbc9bf7f6d77414369f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*hkW4TaUwjN-3v81a"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Photo by <a class="ae jd" href="https://unsplash.com/@samuelzeller?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Samuel Zeller</a> on <a class="ae jd" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><div class=""/><div class=""><h2 id="8e7e" class="pw-subtitle-paragraph kd jf jg bd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dk translated">Tensorflow 和 Keras 的有用工具</h2></div><h1 id="8542" class="kv kw jg bd kx ky kz la lb lc ld le lf km lg kn lh kp li kq lj ks lk kt ll lm bi translated">介绍</h1><p id="491b" class="pw-post-body-paragraph ln lo jg lp b lq lr kh ls lt lu kk lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">通常，当训练一个非常深的神经网络时，一旦训练精度达到某个期望的阈值，我们就想停止训练。因此，我们可以实现我们想要的(最优模型权重)并避免资源浪费(时间和计算能力)。</p><p id="7515" class="pw-post-body-paragraph ln lo jg lp b lq mj kh ls lt mk kk lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">在这个简短的教程中，让我们学习如何在 Tensorflow 和 Keras 中实现这一点，使用<strong class="lp jh">回调</strong>方法，<strong class="lp jh">4 个简单的步骤</strong>。</p><h1 id="ccc9" class="kv kw jg bd kx ky kz la lb lc ld le lf km lg kn lh kp li kq lj ks lk kt ll lm bi translated">深潜</h1><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="b5df" class="mx kw jg mt b gy my mz l na nb"># Import tensorflow<br/>import tensorflow as tf</span></pre><ol class=""><li id="8386" class="nc nd jg lp b lq mj lt mk lw ne ma nf me ng mi nh ni nj nk bi translated">首先，设置精度阈值，直到您想要训练您的模型。</li></ol><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="c3f5" class="mx kw jg mt b gy my mz l na nb">ACCURACY_THRESHOLD = 0.95</span></pre><p id="c912" class="pw-post-body-paragraph ln lo jg lp b lq mj kh ls lt mk kk lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">2.现在实现回调类和函数，在精度达到 ACCURACY_THRESHOLD 时停止训练。</p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="849c" class="mx kw jg mt b gy my mz l na nb"># Implement callback function to stop training<br/># when accuracy reaches e.g. ACCURACY_THRESHOLD = 0.95</span><span id="1bf3" class="mx kw jg mt b gy nl mz l na nb">class myCallback(tf.keras.callbacks.Callback): <br/>    def on_epoch_end(self, epoch, logs={}): <br/>        if(logs.get('acc') &gt; ACCURACY_THRESHOLD):   <br/>        print("\nReached %2.2f%% accuracy, so stopping training!!" %(ACCURACY_THRESHOLD*100))   <br/>        self.model.stop_training = True</span></pre><p id="3c3e" class="pw-post-body-paragraph ln lo jg lp b lq mj kh ls lt mk kk lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">这到底是怎么回事？我们正在通过扩展<em class="nm">TF . keras . callbacks . callback</em>来创建新的类，并实现<em class="nm"> on_epoch_end() </em>方法。这在每个时期结束时调用。接下来，我们获取该时期结束时的精度值，如果它大于我们的阈值，我们将模型的 stop_training 设置为 True。</p><p id="e5aa" class="pw-post-body-paragraph ln lo jg lp b lq mj kh ls lt mk kk lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">3.实例化一个<em class="nm"> myCallback </em>类的对象。</p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="eb65" class="mx kw jg mt b gy my mz l na nb">callbacks = myCallback()</span></pre><p id="4f59" class="pw-post-body-paragraph ln lo jg lp b lq mj kh ls lt mk kk lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">接下来，按照 TensorFlow 或 Keras 的正常步骤建立一个 DNN 或 Conv 网络模型。当使用<em class="nm"> fit() </em>方法训练模型时，将使用我们在上面构建的回调。</p><p id="7a87" class="pw-post-body-paragraph ln lo jg lp b lq mj kh ls lt mk kk lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">4.只需将一个参数作为<strong class="lp jh">callbacks =[&lt;my callback 类的新实例化对象&gt; ] </strong>传递给 fit()方法。</p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="2eed" class="mx kw jg mt b gy my mz l na nb">model.fit(x_train, y_train, epochs=20, callbacks=[callbacks])</span></pre><p id="940b" class="pw-post-body-paragraph ln lo jg lp b lq mj kh ls lt mk kk lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">仅此而已！训练时，一旦精度达到在 ACCURACY_THRESHOLD 中设置的值，训练将会停止。</p><p id="859e" class="pw-post-body-paragraph ln lo jg lp b lq mj kh ls lt mk kk lv lw ml ly lz ma mm mc md me mn mg mh mi ij bi translated">为了将所有这些联系在一起，这里有一个完整的代码片段。</p><figure class="mo mp mq mr gt is"><div class="bz fp l di"><div class="nn no l"/></div></figure><h1 id="bb41" class="kv kw jg bd kx ky kz la lb lc ld le lf km lg kn lh kp li kq lj ks lk kt ll lm bi translated">结论</h1><p id="cbe8" class="pw-post-body-paragraph ln lo jg lp b lq lr kh ls lt lu kk lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">凭借我们的想象力，这种方法可以以各种创造性的方式使用，特别是当我们想要运行快速 POC 来测试和验证多个 DNN 架构时。你还能想到什么有趣的用法？请在下面的评论区分享你的想法。</p></div></div>    
</body>
</html>