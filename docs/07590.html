<html>
<head>
<title>Deploying a Production Druid Cluster in Google Cloud Platform</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在 Google 云平台中部署一个生产 Druid 集群</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/deploying-a-production-druid-cluster-in-google-cloud-platform-43a7f1e15336?source=collection_archive---------28-----------------------#2019-10-22">https://towardsdatascience.com/deploying-a-production-druid-cluster-in-google-cloud-platform-43a7f1e15336?source=collection_archive---------28-----------------------#2019-10-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="4783" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">本文的目的是通过使用 GCP 来指导 Apache Druid 集群的设置过程</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/25b314f8e7d131b76d93841603f76497.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*UA2Dsf4Ch-Tlkq0j.png"/></div></div></figure><h1 id="804e" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">阿帕奇德鲁伊(孵化中)</h1><p id="521b" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">Druid 是一个开源的分析数据存储，设计用于商业智能(<a class="ae md" href="http://en.wikipedia.org/wiki/Online_analytical_processing" rel="noopener ugc nofollow" target="_blank"> OLAP </a>)对事件数据的查询。Druid 提供了低延迟(实时)数据接收、灵活的数据探索和快速的数据聚合。</p><h2 id="2663" class="me lb it bd lc mf mg dn lg mh mi dp lk kb mj mk lo kf ml mm ls kj mn mo lw mp bi translated">可扩展的架构</h2><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mq"><img src="../Images/2e6bcfa8b5f728cfce6227752e74efba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_sdh-DA2gC4fQ9Ov2pjqmQ.png"/></div></div></figure><h2 id="161e" class="me lb it bd lc mf mg dn lg mh mi dp lk kb mj mk lo kf ml mm ls kj mn mo lw mp bi translated">要求</h2><ul class=""><li id="b037" class="mr ms it js b jt ly jx lz kb mt kf mu kj mv kn mw mx my mz bi translated">对于基本 Druid 集群:每个节点 8 个 8vCPUS、30GB RAM 和 200GB 磁盘大小(例如 custom-6–30720 或 n1-standard-8)。</li><li id="722c" class="mr ms it js b jt na jx nb kb nc kf nd kj ne kn mw mx my mz bi translated">启用谷歌云存储</li><li id="d48a" class="mr ms it js b jt na jx nb kb nc kf nd kj ne kn mw mx my mz bi translated">激活 MySQL 实例或云 SQL</li></ul><h1 id="d163" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">安装</h1><p id="a33d" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">用你的 GCP 帐户登录，用 SO Debian 创建三个虚拟机。</p><h2 id="29d9" class="me lb it bd lc mf mg dn lg mh mi dp lk kb mj mk lo kf ml mm ls kj mn mo lw mp bi translated">下载德鲁伊:</h2><p id="df23" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">为每个节点运行</p><pre class="kp kq kr ks gt nf ng nh ni aw nj bi"><span id="f33a" class="me lb it ng b gy nk nl l nm nn">wget https://www-us.apache.org/dist/incubator/druid/0.15.1-incubating/apache-druid-0.15.1-incubating-bin.tar.gz<br/>tar -xzf apache-druid-0.15.1-incubating-bin.tar.gz</span><span id="a0eb" class="me lb it ng b gy no nl l nm nn">export $PATH_GCP = /path/druid/</span></pre><h2 id="dd11" class="me lb it bd lc mf mg dn lg mh mi dp lk kb mj mk lo kf ml mm ls kj mn mo lw mp bi translated">安装组件</h2><p id="e116" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">使用 SSH 输入每个节点并运行:</p><pre class="kp kq kr ks gt nf ng nh ni aw nj bi"><span id="5cb5" class="me lb it ng b gy nk nl l nm nn">#Update libraries <br/>sudo apt-get update</span><span id="3e80" class="me lb it ng b gy no nl l nm nn">#Install Java JDK <br/>sudo apt install default-jdk -y </span><span id="b529" class="me lb it ng b gy no nl l nm nn">#Install Perl <br/>sudo apt-get install perl -y </span><span id="f487" class="me lb it ng b gy no nl l nm nn">#Donwload MySQL JAR <br/>sudo apt install libmysql-java </span><span id="bbd6" class="me lb it ng b gy no nl l nm nn">#Install MySQL server <br/>sudo apt-get install mysql-server -y </span><span id="6e52" class="me lb it ng b gy no nl l nm nn">#Move MySQL JAR to Druid folder <br/>cp /usr/share/java/mysql-connector-java-5.1.42.jar $PATH_GCP/apache-druid-0.15.1-incubating/extensions/mysql-metadata-storage</span></pre><h2 id="79e0" class="me lb it bd lc mf mg dn lg mh mi dp lk kb mj mk lo kf ml mm ls kj mn mo lw mp bi translated">安装动物园管理员</h2><p id="51d1" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">Zookeeper 可能安装在一个独立的节点上，尽管在这种情况下，我们打算安装在主节点上。使用 SSH 登录并运行以下脚本。</p><pre class="kp kq kr ks gt nf ng nh ni aw nj bi"><span id="5f26" class="me lb it ng b gy nk nl l nm nn">#Download<br/>wget https://www-eu.apache.org/dist/zookeeper/zookeeper-3.4.14/zookeeper-3.4.14.tar.gz tar -zxf zookeeper-3.4.14.tar.gz </span><span id="6d3c" class="me lb it ng b gy no nl l nm nn">#create folder and move<br/>sudo mkdir -p /usr/local/zookeeper<br/>sudo mv zookeeper-3.4.14 /usr/local/zookeeper</span><span id="3846" class="me lb it ng b gy no nl l nm nn">#create folder<br/>sudo mkdir -p /var/lib/zookeeper </span><span id="f8a8" class="me lb it ng b gy no nl l nm nn">#create config file <br/>vi /usr/local/zookeeper/conf/zoo.cfg  </span><span id="38b4" class="me lb it ng b gy no nl l nm nn">#add properties inside config file<br/>tickTime=2000 <br/>dataDir=/var/lib/zookeeper clientPort=2181</span></pre><h2 id="7de1" class="me lb it bd lc mf mg dn lg mh mi dp lk kb mj mk lo kf ml mm ls kj mn mo lw mp bi translated">编辑公共运行时属性</h2><p id="56c3" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">编辑位于路由:<code class="fe np nq nr ng b">apache-druid-0.15.1-incubating/conf/druid/cluster/_common/common.runtime.properties</code>中的文件，为每个节点复制建议的更改。</p><p id="2dee" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用<code class="fe np nq nr ng b">sudo vi</code>编辑文件</p><pre class="kp kq kr ks gt nf ng nh ni aw nj bi"><span id="a1dd" class="me lb it ng b gy nk nl l nm nn">sudo vi apache-druid-0.15.1-incubating/conf/druid/cluster/_common/common.runtime.properties</span></pre><p id="fbda" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">以下改动按顺序写。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ns nt l"/></div></figure><h2 id="8937" class="me lb it bd lc mf mg dn lg mh mi dp lk kb mj mk lo kf ml mm ls kj mn mo lw mp bi translated">启用基本安全性</h2><p id="08b9" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">如果需要设置一个基本的身份验证系统，请在每个节点的公共文件中添加这些属性。这样做之后，您将拥有一个密码为<code class="fe np nq nr ng b">[PASSWORD_1]</code>的<code class="fe np nq nr ng b">admin</code>用户，可以访问集群中的所有网段。</p><p id="4fb1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在文件中添加以下属性:<em class="nu">Apache-druid-0 . 15 . 1-孵化器/conf/druid/cluster/_ common/common . runtime . properties</em></p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ns nt l"/></div></figure></div><div class="ab cl nv nw hx nx" role="separator"><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa ob"/><span class="ny bw bk nz oa"/></div><div class="im in io ip iq"><h1 id="ce07" class="la lb it bd lc ld oc lf lg lh od lj lk ll oe ln lo lp of lr ls lt og lv lw lx bi translated">运行 Apache Druid</h1><h2 id="da18" class="me lb it bd lc mf mg dn lg mh mi dp lk kb mj mk lo kf ml mm ls kj mn mo lw mp bi translated">启动动物园管理员</h2><p id="1ecf" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">在您下载的节点中运行</p><pre class="kp kq kr ks gt nf ng nh ni aw nj bi"><span id="3819" class="me lb it ng b gy nk nl l nm nn">sudo /usr/local/zookeeper/bin/zkServer.sh start</span></pre><h2 id="20e6" class="me lb it bd lc mf mg dn lg mh mi dp lk kb mj mk lo kf ml mm ls kj mn mo lw mp bi translated">启动主机</h2><pre class="kp kq kr ks gt nf ng nh ni aw nj bi"><span id="caf0" class="me lb it ng b gy nk nl l nm nn">export PATH_GCP=[PATH_GCP]<br/>sudo nohup $PATH_GCP/apache-druid-0.15.1-incubating/bin/start-cluster-master-no-zk-server &amp;</span><span id="5339" class="me lb it ng b gy no nl l nm nn">#See log<br/>tail -f $PATH_GCP/apache-druid-0.15.1-incubating/var/sv/coordinator-overlord.log</span></pre><h2 id="4492" class="me lb it bd lc mf mg dn lg mh mi dp lk kb mj mk lo kf ml mm ls kj mn mo lw mp bi translated">启动数据服务器</h2><pre class="kp kq kr ks gt nf ng nh ni aw nj bi"><span id="5566" class="me lb it ng b gy nk nl l nm nn">export PATH_GCP=[PATH_GCP]<br/>sudo $PATH_GCP/apache-druid-0.15.1-incubating/bin/start-cluster-data-server</span><span id="ba22" class="me lb it ng b gy no nl l nm nn">tail -f $PATH_GCP/apache-druid-0.15.1-incubating/var/sv/historical.log</span></pre><h2 id="4004" class="me lb it bd lc mf mg dn lg mh mi dp lk kb mj mk lo kf ml mm ls kj mn mo lw mp bi translated">启动查询服务器</h2><pre class="kp kq kr ks gt nf ng nh ni aw nj bi"><span id="8e34" class="me lb it ng b gy nk nl l nm nn">export PATH_GCP=[PATH_GCP]<br/>sudo $PATH_GCP/apache-druid-0.15.1-incubating/bin/start-cluster-query-server</span><span id="5086" class="me lb it ng b gy no nl l nm nn">tail -f $PATH_GCP/apache-druid-0.15.1-incubating/var/sv/broker.log</span></pre><h1 id="a2ce" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">访问 Druid UI</h1><p id="0254" class="pw-post-body-paragraph jq jr it js b jt ly jv jw jx lz jz ka kb ma kd ke kf mb kh ki kj mc kl km kn im bi translated">在访问您的本地机器之前，您需要打开端口:8888、8081、8082 和 8083。作为一种快捷方式，您可以在项目云 shell 中运行此代码。</p><pre class="kp kq kr ks gt nf ng nh ni aw nj bi"><span id="075e" class="me lb it ng b gy nk nl l nm nn">export LOCAL_IP=[LOCAL_IP]<br/>gcloud compute --project=$PROJECT_ID firewall-rules create druid-port --direction=INGRESS --priority=1000 --network=default --action=ALLOW --rules=all --source-ranges=$LOCAL_IP</span></pre><p id="296d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，你可以和德鲁伊一起工作。在我的下一篇文章中，我将展示一个如何使用它的真实案例。如果你需要关于德鲁伊的介绍，你可以在这里看到我的合作伙伴的文章<a class="oh oi ep" href="https://medium.com/u/6ab1ede31d8e?source=post_page-----43a7f1e15336--------------------------------" rel="noopener" target="_blank">安东尼奥·卡川</a>:<a class="ae md" rel="noopener" target="_blank" href="/a-gentle-introduction-to-apache-druid-in-google-cloud-platform-c1e087c87bf1">https://towards data science . com/a-gentle-introduction-to-Apache-druid-in-Google-cloud-platform-c1e 087 c 87 BF 1</a></p><p id="f4c2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">PS 如果您有任何问题，或者想要澄清一些事情，您可以在<a class="ae md" href="https://www.linkedin.com/in/jmendezgal/" rel="noopener ugc nofollow" target="_blank"> LinkedIn 上找到我。</a></p><p id="7a30" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">PS2:你可以在我的<a class="ae md" href="https://gist.github.com/jmendezgal" rel="noopener ugc nofollow" target="_blank"> github </a>里看到代码</p><p id="8537" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">PS3:如果你想了解更多关于数据工程的知识，请关注:【https://datahacks.ai/】T4</p></div></div>    
</body>
</html>