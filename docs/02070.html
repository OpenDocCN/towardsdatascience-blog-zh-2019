<html>
<head>
<title>Nine Postgres concepts to simplify your life 🐘</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">简化你生活的九个 Postgres 概念🐘</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/nine-postgres-concepts-to-simplify-your-life-a0aa8c9bd87d?source=collection_archive---------15-----------------------#2019-04-05">https://towardsdatascience.com/nine-postgres-concepts-to-simplify-your-life-a0aa8c9bd87d?source=collection_archive---------15-----------------------#2019-04-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="01e0" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">我不喜欢无意义的介绍，所以我们直接开始吧。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/620ee876827d2f5d1663da549da4527c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Eob3_r53xs9qEAql99-ngQ.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">“If we have data, let’s look at data. If all we have are opinions, let’s go with mine.”</figcaption></figure><h2 id="61fd" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">1.从文本语料库中生成 n 元语法</h2><p id="4e84" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">与使用另一种脚本语言相比，查询文本语料库并立即获得 n 元语法要简单得多。结果数据可以被存储用于多种目的，包括但不限于:关键短语识别、自动完成提示、自动纠正提示。这个集合还可以使用上下文 word2vec 模型创建单词和短语向量。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">A way of generating n-grams in Postgres</figcaption></figure><p id="d3a4" class="pw-post-body-paragraph lu lv it lw b lx mp ju lz ma mq jx mc lh mr me mf ll ms mh mi lp mt mk ml mm im bi translated">这里，<ordered record="" set="" of="" words="">是按单词出现的顺序排列的单词记录集(直接获得或通过一些操作获得)。看起来是这样的:</ordered></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Example Record Set of ordered words</figcaption></figure></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h2 id="3f2a" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">2.高效地从表中删除重复项</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nb mo l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">I know not why I use so many GIFs</figcaption></figure><p id="626b" class="pw-post-body-paragraph lu lv it lw b lx mp ju lz ma mq jx mc lh mr me mf ll ms mh mi lp mt mk ml mm im bi translated">考虑到多个约束，下面的查询非常适合从表中删除重复项。这里，考虑列 var1 和列 var2 相同的所有行，保留一个副本，其余的被删除。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Efficiently delete duplicates rows from a table with a set of specific constraints.</figcaption></figure></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h2 id="1120" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">3.忽略冲突的快速更新</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nb mo l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">You think throwing an error in my face will stop me from updating you, you scum of a table?</figcaption></figure><p id="54dc" class="pw-post-body-paragraph lu lv it lw b lx mp ju lz ma mq jx mc lh mr me mf ll ms mh mi lp mt mk ml mm im bi translated">通常，更新表中的行值会导致与现有行的冲突。一些流氓条目阻止简单直接的更新查询运行到最后。为了解决这个问题，一个简单的程序可以逐行更新表格，忽略与约束冲突的条目，这很有意思。您可以选择记录这些行，以便在异常处理中进一步处理。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Handle update conflicts smarter.</figcaption></figure><p id="94c7" class="pw-post-body-paragraph lu lv it lw b lx mp ju lz ma mq jx mc lh mr me mf ll ms mh mi lp mt mk ml mm im bi translated">另一种处理方法是移除冲突约束，正常更新表，处理冲突行(例如移除重复项)并重新添加约束。这不是推荐的方法。</p></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h2 id="f85b" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">4.复制带有现有约束的表</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nb mo l"/></div></figure><p id="dddb" class="pw-post-body-paragraph lu lv it lw b lx mp ju lz ma mq jx mc lh mr me mf ll ms mh mi lp mt mk ml mm im bi translated">复制表时，约束有时是必不可少的，可以包括如下内容:</p><pre class="kj kk kl km gt nd ne nf ng aw nh bi"><span id="35d5" class="ky kz it ne b gy ni nj l nk nl">CREATE TABLE <em class="nc">table_copy</em> (LIKE <em class="nc">_table</em> INCLUDING ALL);</span><span id="16de" class="ky kz it ne b gy nm nj l nk nl">INSERT INTO <em class="nc">table_copy</em> SELECT * from <em class="nc">_table</em>;</span></pre></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h2 id="074a" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">5.处理行锁</h2><p id="d3c5" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">很容易出现这样的情况:多个进程持有对公共关系的锁，从而导致死锁情况。过时的查询或断开的连接是过时的，可以这样查询:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Get a list of queries and their details that hold locks over relations in a dB.</figcaption></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nn mo l"/></div></figure><p id="aee5" class="pw-post-body-paragraph lu lv it lw b lx mp ju lz ma mq jx mc lh mr me mf ll ms mh mi lp mt mk ml mm im bi translated">可以使用以下查询终止阻塞和/或被阻塞的语句:</p><pre class="kj kk kl km gt nd ne nf ng aw nh bi"><span id="26ae" class="ky kz it ne b gy ni nj l nk nl">SELECT pg_terminate_backend(<em class="nc">pid</em>)</span></pre></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h2 id="aeb8" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">6.查询 JSON 和 JSONB 列</h2><p id="c69e" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">很容易忘记 JSON(/B)及其数组可以像在脚本语言中一样被查询。将下面的<em class="nc"> jsonb </em>结构视为关系中的一个单元格:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="0324" class="pw-post-body-paragraph lu lv it lw b lx mp ju lz ma mq jx mc lh mr me mf ll ms mh mi lp mt mk ml mm im bi translated">以下所有查询都是可能的:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div></figure></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h2 id="61d6" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">7.高效的文本搜索和构建自动完成/自动更正模块！</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Correct those typos and complete those sentences by using the power of tri-gram search.</figcaption></figure><p id="6ad3" class="pw-post-body-paragraph lu lv it lw b lx mp ju lz ma mq jx mc lh mr me mf ll ms mh mi lp mt mk ml mm im bi translated">我建议你在开始搜索任务之前阅读这篇博客文章:</p><ul class=""><li id="b5e2" class="no np it lw b lx mp ma mq lh nq ll nr lp ns mm nt nu nv nw bi translated"><a class="ae nx" href="http://patshaughnessy.net/2014/11/11/discovering-the-computer-science-behind-postgres-indexes" rel="noopener ugc nofollow" target="_blank"> <strong class="lw iu">发现 Postgres 指数背后的计算机科学</strong> </a></li></ul><p id="21e3" class="pw-post-body-paragraph lu lv it lw b lx mp ju lz ma mq jx mc lh mr me mf ll ms mh mi lp mt mk ml mm im bi translated">在另一篇<a class="ae nx" rel="noopener" target="_blank" href="/implementing-auto-complete-with-postgres-and-python-e03d34824079">文章</a>中，我描述了提取名词块的基本步骤，将它们存储在数据库中，查询它们并对结果进行排序。本文根据包含的名词块短语搜索数据点。这个可以扩展到全文搜索！</p></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h2 id="32c6" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">8.分组依据，每组多行</h2><p id="a375" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">像 grouping 这样的聚合运算符为每个分组元素返回一个分组行。为了获得每个组的多行，下面的查询创造了奇迹。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div></figure></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h2 id="e19d" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">9.有价值的信息</h2><p id="9f64" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">我发现以下三个概念在日常查询中有巨大的价值。</p><h2 id="9d81" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">A.无效的</h2><pre class="kj kk kl km gt nd ne nf ng aw nh bi"><span id="bde5" class="ky kz it ne b gy ni nj l nk nl">SELECT null <strong class="ne iu">IS</strong> null; <br/>--true</span><span id="16dc" class="ky kz it ne b gy nm nj l nk nl">SELECT null <strong class="ne iu">IS DISTINCT FROM</strong> null;<br/>--false</span><span id="2f86" class="ky kz it ne b gy nm nj l nk nl">SELECT null <strong class="ne iu">=</strong> null; <br/>--null</span><span id="34fa" class="ky kz it ne b gy nm nj l nk nl">SELECT null and null; <br/>--null</span><span id="b807" class="ky kz it ne b gy nm nj l nk nl">SELECT null <strong class="ne iu">isnull</strong>; <br/>--true</span><span id="f2c9" class="ky kz it ne b gy nm nj l nk nl">SELECT null notnull; <br/>--false</span><span id="8c61" class="ky kz it ne b gy nm nj l nk nl">SELECT true or null; <br/>--true</span><span id="3cbc" class="ky kz it ne b gy nm nj l nk nl">SELECT true and null; <br/>--null</span><span id="9587" class="ky kz it ne b gy nm nj l nk nl">SELECT null is <strong class="ne iu">unknown</strong>; <br/>--true</span></pre><h2 id="e135" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">B.对称的</h2><pre class="kj kk kl km gt nd ne nf ng aw nh bi"><span id="7a62" class="ky kz it ne b gy ni nj l nk nl">SELECT 2 BETWEEN 1 and 5; <br/>--true</span><span id="f8e1" class="ky kz it ne b gy nm nj l nk nl">SELECT 2 BETWEEN 5 and 1; <br/>--false</span><span id="7378" class="ky kz it ne b gy nm nj l nk nl">SELECT 2 BETWEEN SYMMETRIC 5 and 1; <br/>--true</span></pre><h2 id="4b3d" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">C.PgAdmin 具有查询的自动补全功能</h2><p id="5dd8" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">鲜为人知的功能。从文档中:</p><blockquote class="ny nz oa"><p id="010c" class="lu lv nc lw b lx mp ju lz ma mq jx mc ob mr me mf oc ms mh mi od mt mk ml mm im bi translated"><em class="it">要使用自动完成功能，请键入您的查询；当您希望查询编辑器建议查询中可能出现的下一个对象名称或命令时，请按下</em><strong class="lw iu"><em class="it">Control+空格键</em> </strong> <em class="it">组合键。例如，键入“*SELECT * FROM*”(不带引号，但有一个尾随空格)，然后按 Control+Space 组合键从自动完成选项的弹出菜单中进行选择。</em></p></blockquote><h2 id="9526" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">D.睡眠</h2><pre class="kj kk kl km gt nd ne nf ng aw nh bi"><span id="2d82" class="ky kz it ne b gy ni nj l nk nl">SELECT pg_sleep(5);<br/>--sleeps for 5 seconds indeed!</span></pre><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nb mo l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">See you in the next one!</figcaption></figure></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><h2 id="1f1a" class="ky kz it bd la lb lc dn ld le lf dp lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">注意事项:</h2><p id="ebd7" class="pw-post-body-paragraph lu lv it lw b lx ly ju lz ma mb jx mc lh md me mf ll mg mh mi lp mj mk ml mm im bi translated">我喜欢阅读的一个很棒的博客可以在这里找到。</p></div></div>    
</body>
</html>