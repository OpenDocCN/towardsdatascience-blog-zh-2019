<html>
<head>
<title>Difference Between NFD, NFC, NFKD, and NFKC Explained with Python Code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 Python 代码解释 NFD、NFC、NFKD 和 NFKC 之间的区别</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/difference-between-nfd-nfc-nfkd-and-nfkc-explained-with-python-code-e2631f96ae6c?source=collection_archive---------6-----------------------#2019-11-14">https://towardsdatascience.com/difference-between-nfd-nfc-nfkd-and-nfkc-explained-with-python-code-e2631f96ae6c?source=collection_archive---------6-----------------------#2019-11-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="50bb" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">Unicode 规范化形式之间的区别</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/1c466ed5d2afb4226c03efa740dcd868.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0BDFnrW_J2zDIL4-GpzE6g.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Photo by <a class="ae ky" href="https://unsplash.com/@joelfilip?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Joel Filipe</a> on <a class="ae ky" href="https://unsplash.com/s/photos/form?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="14a8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最近我在做一个日文的 NLP 任务，其中一个问题是将特殊字符转换成标准格式。所以我做了一些调查，为有同样需求的人写了这篇文章。</p><p id="be22" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">日语包含不同形式的字符，例如，拉丁语有两种形式，全角形式和半角形式。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/4d9e1c2a9745e9d692e1b1f77006b60e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NfSs0OH8TyaKQCx9EmL4pQ.png"/></div></div></figure><p id="a906" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上面的例子中，我们可以看到全幅形式是非常丑陋的，也很难利用后续的处理。所以我们需要把它转换成规范化的形式。</p><h1 id="d3b5" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">TL；速度三角形定位法(dead reckoning)</h1><p id="5ab3" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">使用<code class="fe mt mu mv mw b">NFKC</code>方法。</p><pre class="kj kk kl km gt mx mw my mz aw na bi"><span id="d7cc" class="nb lx it mw b gy nc nd l ne nf">&gt;&gt;&gt; from unicodedata import normalize<br/>&gt;&gt;&gt; s = "株式会社ＫＡＤＯＫＡＷＡ Ｆｕｔｕｒｅ Ｐｕｂｌｉｓｈｉｎｇ"<br/>&gt;&gt;&gt; normalize('NFKC', s)<br/>株式会社 KADOKAWA Future Publishing</span></pre><h1 id="e71c" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">Unicode 规范化形式</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/ba99a7d350cf108a9586743b0466f1f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_irZeGalg3lwm2pQoHtUFw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">from <a class="ae ky" href="https://www.wikiwand.com/en/Unicode_equivalence#/Normal_forms" rel="noopener ugc nofollow" target="_blank">Wikipedia</a></figcaption></figure><p id="23ba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">有 4 种 Unicode 规范化形式。这篇<a class="ae ky" href="https://unicode.org/reports/tr15/#Norm_Forms" rel="noopener ugc nofollow" target="_blank">文章</a>给出了非常详细的解释。但我会用一种简单易懂的方式解释其中的区别。</p><p id="cfe3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们可以看到下面的<a class="ae ky" href="https://maku77.github.io/js/string/normalize.html" rel="noopener ugc nofollow" target="_blank">结果</a>以获得直观的理解。</p><pre class="kj kk kl km gt mx mw my mz aw na bi"><span id="7ef1" class="nb lx it mw b gy nc nd l ne nf">ｱｲｳｴｵ ==(NFC)==&gt; ｱｲｳｴｵ<br/>ｱｲｳｴｵ ==(NFD)==&gt; ｱｲｳｴｵ<br/>ｱｲｳｴｵ ==(NFKC)==&gt; アイウエオ<br/>ｱｲｳｴｵ ==(NFKD)==&gt; アイウエオ<br/>パピプペポ ==(NFC)==&gt; パピプペポ<br/>パピプペポ ==(NFD)==&gt; パピプペポ<br/>パピプペポ ==(NFKC)==&gt; パピプペポ<br/>パピプペポ ==(NFKD)==&gt; パピプペポ<br/>ﾊﾟﾋﾟﾌﾟﾍﾟﾎﾟ ==(NFC)==&gt; ﾊﾟﾋﾟﾌﾟﾍﾟﾎﾟ<br/>ﾊﾟﾋﾟﾌﾟﾍﾟﾎﾟ ==(NFD)==&gt; ﾊﾟﾋﾟﾌﾟﾍﾟﾎﾟ<br/>ﾊﾟﾋﾟﾌﾟﾍﾟﾎﾟ ==(NFKC)==&gt; パピプペポ<br/>ﾊﾟﾋﾟﾌﾟﾍﾟﾎﾟ ==(NFKD)==&gt; パピプペポ<br/>ａｂｃＡＢＣ ==(NFC)==&gt; ａｂｃＡＢＣ<br/>ａｂｃＡＢＣ ==(NFD)==&gt; ａｂｃＡＢＣ<br/>ａｂｃＡＢＣ ==(NFKC)==&gt; abcABC<br/>ａｂｃＡＢＣ ==(NFKD)==&gt; abcABC<br/>１２３ ==(NFC)==&gt; １２３<br/>１２３ ==(NFD)==&gt; １２３<br/>１２３ ==(NFKC)==&gt; 123<br/>１２３ ==(NFKD)==&gt; 123<br/>＋－．～）｝ ==(NFC)==&gt; ＋－．～）｝<br/>＋－．～）｝ ==(NFD)==&gt; ＋－．～）｝<br/>＋－．～）｝ ==(NFKC)==&gt; +-.~)}<br/>＋－．～）｝ ==(NFKD)==&gt; +-.~)}</span></pre><p id="b252" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这 4 种形式有两种分类方法。</p><pre class="kj kk kl km gt mx mw my mz aw na bi"><span id="c0eb" class="nb lx it mw b gy nc nd l ne nf"># 1 original form changed or not<br/>- A(not changed): NFC &amp; NFD<br/>- B(changed): <!-- -->NFKC &amp; NFKD</span><span id="ad80" class="nb lx it mw b gy nh nd l ne nf"># 2 the length of original length changed or not<br/>- A(not changed): <!-- -->NFC &amp; NFKC<br/>- B(changed): <!-- -->NFD &amp; NFKD</span></pre><h1 id="b0c9" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">1 .是否改变了原来的形式</h1><pre class="kj kk kl km gt mx mw my mz aw na bi"><span id="b3df" class="nb lx it mw b gy nc nd l ne nf">ａｂｃＡＢＣ ==(NFC)==&gt; ａｂｃＡＢＣ<br/>ａｂｃＡＢＣ ==(NFD)==&gt; ａｂｃＡＢＣ<br/>ａｂｃＡＢＣ ==(NFKC)==&gt; abcABC<br/>ａｂｃＡＢＣ ==(NFKD)==&gt; abcABC</span><span id="7e40" class="nb lx it mw b gy nh nd l ne nf"># 1 original form changed or not<br/>- A(not changed): NFC &amp; NFD<br/>- B(changed): <!-- -->NFKC &amp; NFKD</span></pre><p id="8a62" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第一种分类方法是基于原始形式是否改变。更具体地说，A 组不包含<code class="fe mt mu mv mw b">K</code>，但是 B 组包含<code class="fe mt mu mv mw b">K</code>。<code class="fe mt mu mv mw b">K</code>是什么意思？</p><pre class="kj kk kl km gt mx mw my mz aw na bi"><span id="d1ac" class="nb lx it mw b gy nc nd l ne nf">D = Decomposition <br/>C = Composition<br/>K = Compatibility</span></pre><p id="f93a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe mt mu mv mw b">K</code>意为兼容，用来与原始形态相区别。因为<code class="fe mt mu mv mw b">K</code>改变了原来的形式，所以长度也改变了。</p><pre class="kj kk kl km gt mx mw my mz aw na bi"><span id="a7dc" class="nb lx it mw b gy nc nd l ne nf">&gt;&gt;&gt; s= '…'<br/>&gt;&gt;&gt; normalize('NFKC', s)<br/>'...'</span><span id="fe28" class="nb lx it mw b gy nh nd l ne nf">&gt;&gt;&gt; len(s)<br/>1<br/>&gt;&gt;&gt; len(normalize('NFC', s))<br/>1<br/>&gt;&gt;&gt; len(normalize('NFKC', s))<br/>3<br/>&gt;&gt;&gt; len(normalize('NFD', s))<br/>1<br/>&gt;&gt;&gt; len(normalize('NFKD', s))<br/>3</span></pre><h1 id="6d4a" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">2 原始形式的长度是否改变</h1><pre class="kj kk kl km gt mx mw my mz aw na bi"><span id="6b0a" class="nb lx it mw b gy nc nd l ne nf">パピプペポ ==(NFC)==&gt; パピプペポ<br/>パピプペポ ==(NFD)==&gt; パピプペポ<br/>パピプペポ ==(NFKC)==&gt; パピプペポ<br/>パピプペポ ==(NFKD)==&gt; パピプペポ</span><span id="2d4e" class="nb lx it mw b gy nh nd l ne nf"># 2 the length of original length changed or not<br/>- A(not changed): <!-- -->NFC &amp; NFKC<br/>- B(changed): <!-- -->NFD &amp; NFKD</span></pre><p id="05f0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第二种分类方法是基于原始格式的长度是否改变。一组包含<code class="fe mt mu mv mw b">C</code>(构图)，不会改变长度。b 组包含<code class="fe mt mu mv mw b">D</code>(分解)，会改变长度。</p><p id="4a79" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可能想知道为什么长度是变化的？请看下面的测试。</p><pre class="kj kk kl km gt mx mw my mz aw na bi"><span id="3ee4" class="nb lx it mw b gy nc nd l ne nf">&gt;&gt;&gt; from unicodedata import normalize<br/>&gt;&gt;&gt; s = "パピプペポ"<br/>&gt;&gt;&gt; len(s)<br/>5<br/>&gt;&gt;&gt; len(normalize('NFC', s))<br/>5<br/>&gt;&gt;&gt; len(normalize('NFKC', s))<br/>5<br/>&gt;&gt;&gt; len(normalize('NFD', s))<br/>10<br/>&gt;&gt;&gt; len(normalize('NFKD', s))<br/>10</span></pre><p id="3267" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以发现“分解”法使长度加倍。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/c77d6e32708b76594abd0a24669161e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OVjp4HjFXUFSSyv7xAGaTg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">from <a class="ae ky" href="http://nomenclator.la.coocan.jp/unicode/normalization.htm" rel="noopener ugc nofollow" target="_blank">Unicode 正規化とは</a></figcaption></figure><p id="43ef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是因为<code class="fe mt mu mv mw b">NFD &amp; NFKD</code>将每个 Unicode 字符分解成两个 Unicode 字符。比如<code class="fe mt mu mv mw b">ポ(U+30DD) = ホ(U+30DB) + Dot(U+309A)</code>。所以长度从 5 变到 10。<code class="fe mt mu mv mw b">NFC &amp; NFKC</code>将分开的 Unicode 字符组合在一起，因此长度不变。</p><h1 id="c64b" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">Python 实现</h1><p id="7f76" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">您可以使用 unicodedata 库获得不同的表单。</p><pre class="kj kk kl km gt mx mw my mz aw na bi"><span id="e669" class="nb lx it mw b gy nc nd l ne nf">&gt;&gt;&gt; from unicodedata import normalize<br/>&gt;&gt;&gt; s = "パピプペポ"<br/>&gt;&gt;&gt; len(s)<br/>5<br/>&gt;&gt;&gt; len(normalize('NFC', s))<br/>5<br/>&gt;&gt;&gt; len(normalize('NFKC', s))<br/>5<br/>&gt;&gt;&gt; len(normalize('NFD', s))<br/>10<br/>&gt;&gt;&gt; len(normalize('NFKD', s))<br/>10</span></pre><p id="10aa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">长度</p><h1 id="c395" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">拿走</h1><p id="ad0c" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">通常，我们可以使用<code class="fe mt mu mv mw b">NFKC or NFKD</code>中的任何一个来获得规范化形式。只有当你的 NLP 任务对长度敏感时，长度才不会带来麻烦。我一般用<code class="fe mt mu mv mw b">NFKC</code>的方法。</p><blockquote class="nj nk nl"><p id="50ba" class="kz la nm lb b lc ld ju le lf lg jx lh nn lj lk ll no ln lo lp np lr ls lt lu im bi translated"><strong class="lb iu"> <em class="it">查看我的其他帖子</em> </strong> <a class="ae ky" href="https://medium.com/@bramblexu" rel="noopener"> <strong class="lb iu"> <em class="it">中等</em> </strong> </a> <strong class="lb iu"> <em class="it">同</em> </strong> <a class="ae ky" href="https://bramblexu.com/posts/eb7bd472/" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu"> <em class="it">一分类查看</em> </strong> </a> <strong class="lb iu"> <em class="it">！<br/>GitHub:</em></strong><a class="ae ky" href="https://github.com/BrambleXu" rel="noopener ugc nofollow" target="_blank"><strong class="lb iu"><em class="it">bramble Xu</em></strong></a><strong class="lb iu"><em class="it"><br/>LinkedIn:</em></strong><a class="ae ky" href="https://www.linkedin.com/in/xu-liang-99356891/" rel="noopener ugc nofollow" target="_blank"><strong class="lb iu"><em class="it">徐亮</em> </strong> </a> <strong class="lb iu"> <em class="it"> <br/>博客:</em></strong><a class="ae ky" href="https://bramblexu.com" rel="noopener ugc nofollow" target="_blank"><strong class="lb iu"><em class="it">bramble Xu</em></strong></a></p></blockquote><h1 id="b9a6" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">参考</h1><ul class=""><li id="2821" class="nq nr it lb b lc mo lf mp li ns lm nt lq nu lu nv nw nx ny bi translated"><a class="ae ky" href="https://unicode.org/reports/tr15/#Norm_Forms" rel="noopener ugc nofollow" target="_blank">https://unicode.org/reports/tr15/#Norm_Forms</a></li><li id="9df3" class="nq nr it lb b lc nz lf oa li ob lm oc lq od lu nv nw nx ny bi translated"><a class="ae ky" href="https://www.wikiwand.com/en/Unicode_equivalence#/Normal_forms" rel="noopener ugc nofollow" target="_blank">https://www . wiki wand . com/en/Unicode _ equivalence #/Normal _ forms</a></li><li id="7788" class="nq nr it lb b lc nz lf oa li ob lm oc lq od lu nv nw nx ny bi translated"><a class="ae ky" href="http://nomenclator.la.coocan.jp/unicode/normalization.htm" rel="noopener ugc nofollow" target="_blank">http://nomenclator.la.coocan.jp/unicode/normalization.htm</a></li><li id="24b4" class="nq nr it lb b lc nz lf oa li ob lm oc lq od lu nv nw nx ny bi translated"><a class="ae ky" href="https://maku77.github.io/js/string/normalize.html" rel="noopener ugc nofollow" target="_blank">https://maku77.github.io/js/string/normalize.html</a></li><li id="7828" class="nq nr it lb b lc nz lf oa li ob lm oc lq od lu nv nw nx ny bi translated"><a class="ae ky" href="http://tech.albert2005.co.jp/501/" rel="noopener ugc nofollow" target="_blank">http://tech.albert2005.co.jp/501/</a></li></ul></div></div>    
</body>
</html>