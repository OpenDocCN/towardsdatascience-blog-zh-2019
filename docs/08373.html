<html>
<head>
<title>Using Python to Connect to a GraphQL API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Python 连接到 GraphQL API</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/connecting-to-a-graphql-api-using-python-246dda927840?source=collection_archive---------2-----------------------#2019-11-14">https://towardsdatascience.com/connecting-to-a-graphql-api-using-python-246dda927840?source=collection_archive---------2-----------------------#2019-11-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/2b9669a315a2df1b3a5c244fcadd1150.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Y0seiYx14Hsundxf"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">Photo by <a class="ae kf" href="https://unsplash.com/@perrygrone?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Perry Grone</a> on <a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="07b2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们自动化并消除误差，尝试一步一步地消除前端。</p><p id="12f5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu"><em class="le">graph QL 到底是什么？<br/> </em> </strong> <a class="ae kf" href="https://graphql.org/" rel="noopener ugc nofollow" target="_blank"> GraphQL </a>用最简单的话来说就是一种<strong class="ki iu"> <em class="le">查询语言</em> </strong>用于前端。我们发送一个请求并取回某些数据。GraphQL 也足够先进，可以对称为突变的数据进行更改。但这需要一篇全新的文章来解释。</p><p id="0d03" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">所以我想直接连接到 GraphQL 的主要原因是因为我们有一个 web 应用程序，我们必须手动一个接一个地填写字段。如果我们知道这是重复的，那就不是最有效地利用我的时间。</p><p id="9c63" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我使用的老方法是通过<a class="ae kf" href="https://www.seleniumhq.org/" rel="noopener ugc nofollow" target="_blank"> Selenium </a>，每当前端工程师做出一些改变时，这也会导致错误。所以我做了一些研究，决定为什么不直接通过 GraphQL 发送数据。我仍然从 SalesForce 获取数据，我有一篇文章向您展示如何做到这一点<a class="ae kf" rel="noopener" target="_blank" href="/using-python-to-get-salesforce-data-97bb5a7ef2cf">这里</a>。然后我会处理所有的数据并发送给 GraphQL 端点。</p><p id="b503" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">但是我有点跑题了，让我们用 Python 连接到 GraphQL 并取回一些数据吧！</p><p id="865c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu"> <em class="le">入门</em> </strong> <br/>假设你已经安装了 Python 你需要的主要模块有:<br/> 1 .<code class="fe lf lg lh li b">requests </code>(用于连接 GraphQL) <br/> 2。<code class="fe lf lg lh li b">json</code>(用于解析 GraphQL 数据)<br/> 3 .<code class="fe lf lg lh li b">pandas</code>(用于我们数据的可见性)</p><p id="c7f5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们将这些模块导入到新的 Python 脚本中。</p><pre class="lj lk ll lm gt ln li lo lp aw lq bi"><span id="ce53" class="lr ls it li b gy lt lu l lv lw">import requests<br/>import json<br/>import pandas as pd</span></pre><p id="ab75" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">出于教程的目的，我们将连接到一个不需要认证的 GraphQL 端点。我们将连接到一个<a class="ae kf" href="https://rickandmortyapi.com/about" rel="noopener ugc nofollow" target="_blank"> Rick 和 Morty GraphQL API </a>！</p><p id="efa0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们从一些简单的东西开始，一个<a class="ae kf" href="https://rickandmortyapi.com/documentation/#character" rel="noopener ugc nofollow" target="_blank">角色数据集</a>就可以了。我想从他们每个人那里得到的信息是名字，地位，物种，类型和性别。我们可以将这个 GraphQL 查询设置为字符串，并将其设置为变量，如下所示:</p><pre class="lj lk ll lm gt ln li lo lp aw lq bi"><span id="c3a5" class="lr ls it li b gy lt lu l lv lw">query = """query {<br/>    characters {<br/>    results {<br/>      name<br/>      status<br/>      species<br/>      type<br/>      gender<br/>    }<br/>  }<br/>}"""</span></pre><p id="acae" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">做这个的人让我们很容易联系到一起。我们每天最多收到 10000 个请求，所以请谨慎使用。接下来的几行代码我们设置 URL，向他们发送请求，也就是查询。如果成功，我们应该得到一个字符串格式的<code class="fe lf lg lh li b">200</code>和<code class="fe lf lg lh li b">text</code>的<code class="fe lf lg lh li b">status_code</code>。</p><pre class="lj lk ll lm gt ln li lo lp aw lq bi"><span id="5030" class="lr ls it li b gy lt lu l lv lw">url = '<a class="ae kf" href="https://rickandmortyapi.com/graphql/'" rel="noopener ugc nofollow" target="_blank">https://rickandmortyapi.com/graphql/'</a><br/>r = requests.post(url, json={'query': query})<br/>print(r.status_code)<br/>print(r.text)</span></pre><figure class="lj lk ll lm gt ju gh gi paragraph-image"><div class="gh gi lx"><img src="../Images/2f6493c49744dbb8b1ad2147fa3f099e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1384/format:webp/1*SVYUM9NgJt9sLLEybxqcUQ.png"/></div></figure><p id="5cc1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe lf lg lh li b">r.text</code>是一个字符串的格式。这就是模块<code class="fe lf lg lh li b">json</code>出现的地方。让我们将这个字符串转换成 JSON 格式，这样我们就可以将它移动到 DataFrame 中。</p><pre class="lj lk ll lm gt ln li lo lp aw lq bi"><span id="183d" class="lr ls it li b gy lt lu l lv lw">json_data = json.loads(r.text)</span></pre><p id="57fa" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们只想要名字，地位，物种，类型和性别。因此，在我们将它推入数据帧之前，因为它是一个嵌套的 JSON，所以我们想进一步进入嵌套。现在我们可以把它发送出去翻译成数据帧。我们可以用下面的代码做到这一点:</p><pre class="lj lk ll lm gt ln li lo lp aw lq bi"><span id="f98b" class="lr ls it li b gy lt lu l lv lw">df_data = json_data[‘data’][‘characters’][‘results’]<br/>df = pd.DataFrame(df_data)</span></pre><p id="9434" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们的数据帧现在应该是这样的。</p><figure class="lj lk ll lm gt ju gh gi paragraph-image"><div class="gh gi ly"><img src="../Images/548596add271a9871703478b0af715a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:982/format:webp/1*ZMPtzakFYs1_fO6LUA5-Jw.png"/></div></figure><p id="791a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，它已经被转移到一个熊猫数据框架的可能性是无限的！</p></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><p id="acb3" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">访问我的代码<a class="ae kf" href="https://www.patreon.com/melvfnz" rel="noopener ugc nofollow" target="_blank">这里</a>！</p><p id="d52a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我这里还有家教和职业指导<a class="ae kf" href="https://square.site/book/8M6SR06V2RQRB/mentor-melv" rel="noopener ugc nofollow" target="_blank"/>！</p><p id="0f8d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你们有任何问题、评论或顾虑，请不要忘记通过 LinkedIn 与我联系！</p></div></div>    
</body>
</html>