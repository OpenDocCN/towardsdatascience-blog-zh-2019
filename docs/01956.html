<html>
<head>
<title>Invisible clouds of particulate matter move across Europe</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">看不见的颗粒物质云穿越欧洲</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/invisible-clouds-of-particulate-matter-move-across-europe-6b39e2d57511?source=collection_archive---------21-----------------------#2019-03-31">https://towardsdatascience.com/invisible-clouds-of-particulate-matter-move-across-europe-6b39e2d57511?source=collection_archive---------21-----------------------#2019-03-31</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="981c" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">这些 PM10 和 PM2.5 的云是从哪里来的？</h2></div><p id="cb11" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在之前的帖子中，我解释了我如何设置我的室外空气质量传感器，以及它如何产生作为公民科学项目一部分的开放数据。(<a class="ae le" href="https://medium.com/@ignazw/air-quality-measurements-fcc32d59dca7" rel="noopener">https://medium . com/@ ignazw/air-quality-measurements-FCC 32d 59 DCA 7</a>)</p><p id="d496" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是公开数据，任何人都可以分析。在这篇文章中，我将向你展示如何使用 Luftdaten.info 网站来寻找大规模的空气污染模式。</p><h2 id="7f60" class="lf lg it bd lh li lj dn lk ll lm dp ln kr lo lp lq kv lr ls lt kz lu lv lw lx bi translated">情况</h2><p id="dea7" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">Luftdaten.info 在地图上显示了世界各地所有传感器测量的快照(【http://deutschland.maps.luftdaten.info/#6/51.165/10.455】T2)。大多数传感器在欧洲，所以我将限制我对欧洲的看法。</p><figure class="me mf mg mh gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi md"><img src="../Images/6133062c0afd80325e72893530f9d323.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lF8yIkan8bchonUonbPy3g.png"/></div></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk">Sample image from Luftdaten.info</figcaption></figure><p id="a6ef" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">大约每五分钟拍摄一次快照，并更新地图。我想知道如果我们把这些快照拍成延时电影会是什么样子。我们能找到什么模式吗？</p><h2 id="0b8d" class="lf lg it bd lh li lj dn lk ll lm dp ln kr lo lp lq kv lr ls lt kz lu lv lw lx bi translated">获取数据</h2><p id="bde4" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">为了制作延时电影，我们需要捕捉每个快照。Luftdaten.info 上没有维护旧地图，所以我们必须自己收集。</p><p id="88a3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">捕获快照需要每五分钟向 web 服务器执行一次 HTTP 请求。我在运行于 raspberry pi 3 上的一个小脚本的帮助下做到了这一点。我想为每张快照拍摄两张照片:一张是欧洲大部分地区的概览，另一张是我居住的比利时的更详细的照片。</p><p id="c9c6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在 raspberry pi 上，我在无头模式下使用 chromium web 浏览器，即没有显示。</p><pre class="me mf mg mh gt mt mu mv mw aw mx bi"><span id="1d8b" class="lf lg it mu b gy my mz l na nb">#!/bin/bash<br/>chromium-browser --headless --disable-gpu \<br/>  --screenshot --window-size=1920x1080 \<br/>  http://deutschland.maps.luftdaten.info/#7/50.958/8.218<br/>mv screenshot.png ./data/new/de`date +”%Y%m%d%H%M%S”`.png</span></pre><p id="b008" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您可能需要在您的系统上安装或升级 chromium 浏览器。我用的是 72 版的浏览器。确保您运行它是无头的，并禁用 gpu 使用(以避免不必要的库加载到内存中)。</p><p id="73d6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">luftdaten.info 网站使用 javascript 呈现地图，但 chromium 浏览器默认执行 javascript。你截取一张截图，然后定义图片的大小。默认的图片名为“screenshot.png ”,因此可以将其重命名为一个独特的名称，比如拍摄的时间。</p><p id="fff9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后编辑 crontab 以每五分钟运行一次该脚本。</p><p id="0c66" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这种大小的一个图像的大小超过 3 MB，因此您需要确保它不会填满您的磁盘。我每天运行一个脚本，将所有图像复制到外部存储空间，我可以从那里提取图像以备将来使用。</p><p id="0a9d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我在 MacOS X 上做进一步的处理，包括给截图加注释，并把它变成电影。</p><p id="14b4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我在每个截图上标注了拍摄的时间和数据。我用的是 ImageMagick 包，通过自制软件安装。</p><pre class="me mf mg mh gt mt mu mv mw aw mx bi"><span id="6451" class="lf lg it mu b gy my mz l na nb">#!/bin/bash<br/>for f in $(ls ./images/raw/*.png)<br/>do<br/>fn=${f##*/}<br/>anno=${fn%.png}<br/>magick ./images/raw/$fn -pointsize 72 -gravity southwest \<br/>  -annotate +150+50 $anno ./images/annotated/$fn<br/>mv ./images/raw/$fn ./images/tmp/$fn<br/>done</span></pre><p id="1ac1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这个脚本读取我在一个目录中准备的所有文件名，并且是 Pi 上收集的图像的副本。它在文件名中包含截图的日期和时间。</p><p id="1ca4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对于每个文件，我从文件名中获取日期和时间，并将其设置为图像上的注释。+150+50 定义了距离边缘的像素数。在这个位置，它非常易读。</p><p id="5152" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我将注释后的原始图像移动到一个临时目录，在确定处理正常后，我可以删除它。</p><p id="2c9e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下一步是用带注释的图像制作一部电影。为此，我使用 ffmpeg 包，您可能需要像安装 ImageMagick 一样安装它。</p><p id="f30c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">以下脚本创建了电影。</p><pre class="me mf mg mh gt mt mu mv mw aw mx bi"><span id="e0af" class="lf lg it mu b gy my mz l na nb">#! /bin/bash<br/># create movie for Germany<br/>ffmpeg -f image2 -pattern_type glob -framerate 5 \<br/>  -i ‘images/annotated/de*.png’ -s 1920x1080 -f mp4 <br/>  -vcodec libx264 -pix_fmt yuv420p germany.mp4</span></pre><p id="52a8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">f 标志定义了图像格式。如果您想使用 globbing 来收集图像列表，您需要定义 globbing。你需要在 fps 中设置帧率，然后是实际的输入文件。接下来是输出电影的大小、格式和编解码器。像素格式定义是为了确保 quicktime 也可以播放电影。最后，您命名输出文件。</p><p id="631b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">就这么简单。一旦准备好一些脚本，就很容易多次重新运行。</p><h2 id="117e" class="lf lg it bd lh li lj dn lk ll lm dp ln kr lo lp lq kv lr ls lt kz lu lv lw lx bi translated">延时电影</h2><p id="734c" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">这里有两部时间跨度为 2019 年 3 月 25 日至 31 日的延时电影。一个片段展示了欧洲的大部分，另一个片段放大了比利时。</p><figure class="me mf mg mh gt mi"><div class="bz fp l di"><div class="nc nd l"/></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk">PM clouds over Europe</figcaption></figure><figure class="me mf mg mh gt mi"><div class="bz fp l di"><div class="nc nd l"/></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk">PM clouds over Belgium</figcaption></figure><h2 id="d57c" class="lf lg it bd lh li lj dn lk ll lm dp ln kr lo lp lq kv lr ls lt kz lu lv lw lx bi translated">对结果的讨论</h2><p id="8dd1" class="pw-post-body-paragraph ki kj it kk b kl ly ju kn ko lz jx kq kr ma kt ku kv mb kx ky kz mc lb lc ld im bi translated">欧洲电影表明，高水平的 PM 是由于大规模的 PM 云在欧洲移动。毫无疑问和天气有关系，但是这些颗粒都是从哪里来的呢？</p><p id="398e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">比利时电影聚焦布鲁塞尔。你可能会认为 PM 水平与交通高峰时间相关，但这在电影中并不清楚，需要进一步研究。也没有显示出与乡村露天壁炉的相关性。如果这种相关性存在，它们也远低于整个欧洲 PM 云的宏观运动水平。</p><p id="598d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">没想到这种行为<em class="ne">先验</em>。我们似乎都把责任归咎于交通，毫无疑问，这是原因之一，但更重要的事情正在发生。我们将在以后的文章中深入探讨这个问题。</p><p id="5385" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">公民科学很酷！</p></div></div>    
</body>
</html>