<html>
<head>
<title>Teaching a Xenophobic AI Health Inspector, and the Ethics of Machine Learning</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">教一个排外的人工智能健康检查员，和机器学习的伦理</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/teaching-a-xenophobic-ai-health-inspector-and-the-ethics-of-machine-learning-b644d72376f?source=collection_archive---------36-----------------------#2019-08-09">https://towardsdatascience.com/teaching-a-xenophobic-ai-health-inspector-and-the-ethics-of-machine-learning-b644d72376f?source=collection_archive---------36-----------------------#2019-08-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="70ec" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">基于德克萨斯州奥斯丁的健康检查分数，并受到这篇关于纽约州水塔检查的媒体文章的启发。</h2></div><p id="5f0f" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">前言:我并不反对我在这篇文章中作为例子的任何一家餐馆，我积极地在所有这些餐馆吃饭。</p><p id="b281" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">请继续阅读这些预测的来源！</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="lh li l"/></div></figure><h1 id="5439" class="lj lk iq bd ll lm ln lo lp lq lr ls lt jw lu jx lv jz lw ka lx kc ly kd lz ma bi translated">介绍</h1><p id="9bfd" class="pw-post-body-paragraph kg kh iq ki b kj mb jr kl km mc ju ko kp md kr ks kt me kv kw kx mf kz la lb ij bi translated">我是一名奥斯汀人，一名 UT Austin 的学生，一名脸书的实习生，一名有抱负的数据科学家。</p><p id="c886" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">关于数据科学项目，我已经意识到的一件事是底层数据的重要性。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="gh gi mg"><img src="../Images/411abec0707d3f13a18e09c944dd74b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*VuhcsCzFpYdfVt5V.jpg"/></div></div><figcaption class="mn mo gj gh gi mp mq bd b be z dk">Score average by ZIP Code + Individual Scores</figcaption></figure><p id="f879" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">使用对你来说重要的数据既能给你领域的专业知识来发现有洞察力的结果，又能增加你在项目上工作的动力。</p><p id="f9a9" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">这个数据集与我密切相关，因为我在许多这样的餐馆吃过饭，有些得分较高，有些得分较低。</p><h1 id="63ec" class="lj lk iq bd ll lm ln lo lp lq lr ls lt jw lu jx lv jz lw ka lx kc ly kd lz ma bi translated">假设</h1><p id="60c0" class="pw-post-body-paragraph kg kh iq ki b kj mb jr kl km mc ju ko kp md kr ks kt me kv kw kx mf kz la lb ij bi translated">我认为训练一个机器学习模型来预测仅仅基于<strong class="ki ir">餐馆名称</strong>的<strong class="ki ir">健康检查分数</strong>会很有趣。我有一种感觉，由此产生的模式最终将是一个排外的模式，比如认为中国餐馆很脏。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/a17caf87f255fb3f0627557e2948cb8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/0*PSzAFwLP8SJAutrx.jpg"/></div><figcaption class="mn mo gj gh gi mp mq bd b be z dk">Spicy Fish Fillet at Asia Cafe, <strong class="bd ms">Average Score: 76.75</strong></figcaption></figure><p id="be72" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">在奥斯汀我最喜欢的餐馆中，我敢肯定一些低端餐馆的卫生检查分数会低于理想水平。我相信我的“直觉”(字面和隐喻)，无论如何都会去那里吃。</p><h1 id="3593" class="lj lk iq bd ll lm ln lo lp lq lr ls lt jw lu jx lv jz lw ka lx kc ly kd lz ma bi translated">数据探索</h1><p id="089e" class="pw-post-body-paragraph kg kh iq ki b kj mb jr kl km mc ju ko kp md kr ks kt me kv kw kx mf kz la lb ij bi translated">为了确定我想如何对问题建模，我从探索和理解数据集开始。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="gh gi mt"><img src="../Images/059b76907b8443b01a9f4eff72b117cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*UhI2j3UdQT8vApCK.png"/></div></div><figcaption class="mn mo gj gh gi mp mq bd b be z dk">df.head()</figcaption></figure><p id="1837" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">其特点是:</p><pre class="lc ld le lf gt mu mv mw mx aw my bi"><span id="4451" class="mz lk iq mv b gy na nb l nc nd">'Restaurant Name', <br/>'Zip Code', <br/>'Inspection Date', <br/>'Score', <br/>'Address',<br/>'Facility ID', <br/>'Process Description'</span></pre><p id="0059" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated"><strong class="ki ir">设施 ID </strong>、<strong class="ki ir">地址</strong>和<strong class="ki ir">餐厅名称</strong>对于每个餐厅应该是唯一的。</p><p id="5f67" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">我对差评餐厅的<strong class="ki ir">餐厅名称</strong>感兴趣，我将“差评”设为 85 分及以下，并生成了一些<strong class="ki ir">单词云</strong>。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="gh gi ne"><img src="../Images/8289275b161c97ccce7592a9fd593aa2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3275ms2IwMWiMkCG8TN2LA.png"/></div></div></figure><p id="e19d" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">根据我的经验，这听起来不错。在这一点上，我开始意识到教授一个模型的伦理含义，即名称中带有“taqueria”的餐馆比名称中带有“pizza”的餐馆的健康检查分数更差。我后来在<strong class="ki ir">建模</strong>部分捕捉到了这个想法，并对其进行了讨论。</p><p id="fef0" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">每个餐厅可能都有过几次检查。随着时间的推移，我对变化不感兴趣，所以我取消了<strong class="ki ir">检查日期</strong>，用<strong class="ki ir">平均分数</strong>代替了<strong class="ki ir">分数</strong>。</p><pre class="lc ld le lf gt mu mv mw mx aw my bi"><span id="ed28" class="mz lk iq mv b gy na nb l nc nd">groupby = df.groupby("Facility ID")['Score']</span><span id="6693" class="mz lk iq mv b gy nf nb l nc nd">means = groupby.mean()</span><span id="359d" class="mz lk iq mv b gy nf nb l nc nd">df_mean = df_mean.join(means, on="Facility ID", how="right")</span><span id="4b2c" class="mz lk iq mv b gy nf nb l nc nd">df_mean.drop(columns=["Scorel"], inplace=True)</span><span id="20b2" class="mz lk iq mv b gy nf nb l nc nd">df_mean.rename({"ScoreR": "Average Score"},)</span><span id="5b5f" class="mz lk iq mv b gy nf nb l nc nd">df_mean.drop(['Inspection Date'])</span></pre><p id="6310" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated"><strong class="ki ir">地址</strong>有 3 行</p><pre class="lc ld le lf gt mu mv mw mx aw my bi"><span id="e5a9" class="mz lk iq mv b gy na nb l nc nd">6500 S US 183 HWY<br/>AUSTIN, TX 78744<br/>(30.164092387667438, -97.69352171343812)</span></pre><p id="d3da" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">第一行是街道地址，<br/>第二行是德克萨斯州奥斯汀的邮政编码，<br/>第三行是字符串格式的<strong class="ki ir">(纬度，经度)</strong>。</p><p id="a3db" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">我想把坐标提取到浮点数中，用于我的可视化。如果我真的关心我们的模型的性能，我也可以提取街道名称作为一个特征，因为街道名称可以给我们提供关于邻居的上下文。</p><pre class="lc ld le lf gt mu mv mw mx aw my bi"><span id="6cd2" class="mz lk iq mv b gy na nb l nc nd">def extract_lat(x):<br/>    lst = x.<strong class="mv ir">split</strong>('\n')<br/>    <br/>    string = lst[2]<br/>    #substring cuts off the leading and tailing brackets<br/>    string = <strong class="mv ir">string[1:-1]</strong><br/>    #split to the lat and long  <br/>    pair = string.<strong class="mv ir">split(',')</strong><br/>        <br/>    return <strong class="mv ir">float(pair[0])</strong><br/>    <br/>def extract_long(x):<br/>    ... similar<br/>    return <strong class="mv ir">float(pair[1])</strong></span><span id="98c8" class="mz lk iq mv b gy nf nb l nc nd">lat = df3['Address'].<strong class="mv ir">apply(extract_lat</strong>)</span><span id="62ff" class="mz lk iq mv b gy nf nb l nc nd">long = df3['Address'].<strong class="mv ir">apply(extract_long</strong>)</span><span id="7a15" class="mz lk iq mv b gy nf nb l nc nd">df3['lat'] = lat<br/>df3['long'] = long</span></pre><p id="8efe" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated"><strong class="ki ir">邮政编码</strong>是一个有趣的分类变量，我稍后也可以在可视化中使用它。</p><pre class="lc ld le lf gt mu mv mw mx aw my bi"><span id="3de2" class="mz lk iq mv b gy na nb l nc nd">['78744' '78758' '78727' '78617' '78701' '78745' '78751' '78757'   '78750' '78756' '78753' '78748' '78705' '78746' '78704' '78721' '78613' '78738' '78741' '78702' '78739' '78724' '78759' '78734' '78723' '78703' '78735' '78729' '78728' '78731' '78752' '78749' '78754' '78669' '78722' '78660' '78732' '78725' '78653' '78730' '78641' '78747' '78726' '78719' '78652' '78733' '78717' '78736' '78620' '78737' '78654' '78742' '78610' '78621' '78615']</span></pre><p id="817a" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">然后我开始观察这些特征的分布:</p><p id="2310" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">我看了检查分数直方图，很多 100 分(耶)，左尾(恶)。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="gh gi ng"><img src="../Images/19bd3eda98fdf89e3e52c464ccc4d686.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rOh-nC6__GdBflaI5I4jQQ.png"/></div></div><figcaption class="mn mo gj gh gi mp mq bd b be z dk">Histogram of scores</figcaption></figure><p id="961c" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">另一件有趣的事情是查看每个<strong class="ki ir">邮政编码</strong>的分布情况，是否有些邮政编码比其他的更脏？I <strong class="ki ir">根据<strong class="ki ir">邮政编码</strong>聚合</strong>，并为每个邮政编码绘制一个图表</p><pre class="lc ld le lf gt mu mv mw mx aw my bi"><span id="c0bb" class="mz lk iq mv b gy na nb l nc nd">for _, row in df_agg.iterrows():<br/>    if row['total_facilities'] &gt; 10:<br/>        zipcode = row['Zip Code']</span><span id="2cc4" class="mz lk iq mv b gy nf nb l nc nd">        df_zip = df_mean[df_mean['Zip Code'] == zipcode]<br/>        <br/>        sns.distplot(df_zip['Average Score'])</span></pre><p id="77ca" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">大多数分布看起来像是<strong class="ki ir"> 78704 </strong>分布，<strong class="ki ir"> 78719 </strong>看起来更像是<strong class="ki ir">双峰</strong>分布，这是令人不安和有趣的。</p><div class="lc ld le lf gt ab cb"><figure class="nh lg ni nj nk nl nm paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><img src="../Images/1c2a991cd84fe6e2e66e875706f1dc30.png" data-original-src="https://miro.medium.com/v2/resize:fit:994/format:webp/1*3Z2sbGHNCeUvP60vU07b2g.png"/></div></figure><figure class="nh lg nn nj nk nl nm paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><img src="../Images/0fc04303dfa5c55924f54365beb6f76b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1008/format:webp/1*yPiH2SBmja04De9pAuAo0Q.png"/></div></figure></div><h2 id="7801" class="mz lk iq bd ll no np dn lp nq nr dp lt kp ns nt lv kt nu nv lx kx nw nx lz ny bi translated">地图</h2><p id="fdf6" class="pw-post-body-paragraph kg kh iq ki b kj mb jr kl km mc ju ko kp md kr ks kt me kv kw kx mf kz la lb ij bi translated">好了，玩够了<strong class="ki ir"> seaborn </strong>和<strong class="ki ir"> matplotlib </strong>。这些信息本质上是地理上的，所以构建一些地图是非常有意义的，我使用<strong class="ki ir">叶子</strong>和<strong class="ki ir"> plotly-Express </strong>来实现这些可视化。完整的笔记本将被链接，所以我跳过一些细节。</p><p id="4403" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">首先，让我们看看地图上所有的分数。我用<strong class="ki ir"> plotly-express </strong>来做这个。</p><pre class="lc ld le lf gt mu mv mw mx aw my bi"><span id="a20f" class="mz lk iq mv b gy na nb l nc nd">px.<strong class="mv ir">scatter_mapbox</strong>(df3, lat="lat", lon="long",<br/>                  <strong class="mv ir">color="Score</strong>",hover_data=['Score'], zoom=14)</span></pre><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/69ac38b7da9b919ae3951e6063125b1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2sl_grxP8x5vH95Xq2Y5xg.png"/></div></figure><p id="6c46" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">接下来，看看<strong class="ki ir">每个邮编的平均得分</strong>结合<strong class="ki ir">个人得分</strong>不是很有趣吗？我为此使用了<strong class="ki ir">叶子</strong>，因为<strong class="ki ir"> Plotly-express </strong>不支持<strong class="ki ir"> geoJSON </strong>(邮政编码形状)。</p><p id="7c98" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">我使用了一个<strong class="ki ir"> groupby </strong>和<strong class="ki ir"> agg </strong>来计算每个邮政编码的平均得分。</p><p id="56ed" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">我找到了一个德克萨斯州的邮政编码<strong class="ki ir"> geoJSON </strong>，我用它和叶子根据平均分数给每个邮政编码着色。</p><p id="f121" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">我想在地图上标出每家餐馆。与 plotly-express 不同，follow 不会渲染超过 1000 个标记，所以我不得不使用<strong class="ki ir"> MarkerClusters。</strong></p><p id="417c" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">这就是结果。</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="oa li l"/></div><figcaption class="mn mo gj gh gi mp mq bd b be z dk">FFFFFolium’s nauseating cluster animation, sorry!</figcaption></figure><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="gh gi mg"><img src="../Images/411abec0707d3f13a18e09c944dd74b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*VuhcsCzFpYdfVt5V.jpg"/></div></div><figcaption class="mn mo gj gh gi mp mq bd b be z dk">Score average by ZIP Code + Individual Scores</figcaption></figure><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="gh gi ob"><img src="../Images/7ed679b115e4e7522aa7b9becaa93d33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*xFov8RQFwqOZ6xDD.jpg"/></div></div></figure><p id="1318" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">Mopac，Lamar 和 I 35 走廊似乎很脏。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="gh gi oc"><img src="../Images/1951e8108fa94c92ce78df2c3d93cc19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*J9xeugq0yVeXjjR5.jpg"/></div></div></figure><p id="cd87" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">第六街和市中心也是如此。</p><h1 id="1af0" class="lj lk iq bd ll lm ln lo lp lq lr ls lt jw lu jx lv jz lw ka lx kc ly kd lz ma bi translated">建模</h1><p id="97df" class="pw-post-body-paragraph kg kh iq ki b kj mb jr kl km mc ju ko kp md kr ks kt me kv kw kx mf kz la lb ij bi translated">现在我对数据有了更多的了解，我应该有更多的背景来开始建模。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="gh gi od"><img src="../Images/006a13245bfdb5f210209043bb657843.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*YyagbV6aCmhmDw0t.png"/></div></div><figcaption class="mn mo gj gh gi mp mq bd b be z dk">My Xenophobic model at work! I wouldn’t want to eat a at a “Mexican Chinese Meat Butcher Seafood Buffet” either</figcaption></figure><p id="4e40" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">我想尝试做的是建立一个模型，让<strong class="ki ir">只根据<strong class="ki ir">餐馆名称</strong>预测</strong>检查分数<strong class="ki ir"/>。我有一种感觉，即“民族”餐馆与较差的健康检查分数相关，我想说服一个模特了解这一点。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/4c36d591687de4c14d331f6c0b47d332.png" data-original-src="https://miro.medium.com/v2/resize:fit:1100/format:webp/0*0R2IpyDx_CMU1Of0.jpg"/></div><figcaption class="mn mo gj gh gi mp mq bd b be z dk">How do I get a model to know this is a mexican restaurant?</figcaption></figure><h2 id="f74e" class="mz lk iq bd ll no np dn lp nq nr dp lt kp ns nt lv kt nu nv lx kx nw nx lz ny bi translated">自然语言处理</h2><p id="d356" class="pw-post-body-paragraph kg kh iq ki b kj mb jr kl km mc ju ko kp md kr ks kt me kv kw kx mf kz la lb ij bi translated">NLP 意味着以人类能够理解的方式来表达语言的含义。</p><p id="1fa9" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">餐馆名称包含关于它们是什么类型的餐馆的信息,“taqueria”是与“四川”餐馆不同类型的餐馆，等等。</p><p id="eab6" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">我可以使用<strong class="ki ir"> TF-IDF </strong>将这些信息传递到模型中。</p><p id="e9c3" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">TF-IDF 考虑了我们的数据集中所有单词的词汇，并且根据该单词在整个数据集中的频率来衡量该单词在每行数据中的存在。</p><p id="78fb" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">如果“cafe”这个词很常见，而“carniceria”这个词不常见，TF-IDF 会认为“carniceria”比“cafe”有更多的含义</p><p id="c5bc" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">应用到我们的问题，我敢打赌，一些餐馆听起来像他们有更差的食品检查分数比其他人。</p><p id="206b" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">凭直觉，<strong class="ki ir"> TF-IDF </strong>会找到一家名为<strong class="ki ir"> <em class="of">【墨西哥中式肉店海鲜自助餐】</em> </strong>的餐厅，比<strong class="ki ir"> <em class="of">【咖啡厅】</em> </strong>包含更多的信息。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="gh gi og"><img src="../Images/2eb26ab21d120d50f99d8a8499758927.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*BuyFBWaIBBQ2LsF6.jpg"/></div></div><figcaption class="mn mo gj gh gi mp mq bd b be z dk">One of the dingiest looking restaurants I have ever been in, but the food is great. <strong class="bd ms">Score: 89</strong></figcaption></figure><h2 id="5191" class="mz lk iq bd ll no np dn lp nq nr dp lt kp ns nt lv kt nu nv lx kx nw nx lz ny bi translated">预处理:</h2><p id="1e51" class="pw-post-body-paragraph kg kh iq ki b kj mb jr kl km mc ju ko kp md kr ks kt me kv kw kx mf kz la lb ij bi translated">餐馆名称对于文本字符串来说非常短。我必须小心地预处理我们的数据，明智地选择我们的技术来充分利用数据。</p><p id="8a32" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">n-gram 是由 n 个单词组成的短语，“taco”是 1-gram，“taco joint”是 2-gram。</p><p id="dd3b" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">考虑到作为文本形式的数据的餐馆名称很短，我将 TF-IDF 限制为 n-grams==1，就像只使用像“taco”和“joint”这样的单词一样。</p><p id="b1da" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">我可以做的另一种形式的预处理是从我们的餐厅名称中删除数字和符号，“棒约翰的#928”变成了“棒约翰”。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/5f88ff27bbb07a17fe181cc9b6d83254.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*XhLHlTh8k1UGqjbV.jpg"/></div><figcaption class="mn mo gj gh gi mp mq bd b be z dk">Food from Asters</figcaption></figure><h2 id="71f2" class="mz lk iq bd ll no np dn lp nq nr dp lt kp ns nt lv kt nu nv lx kx nw nx lz ny bi translated">建模:</h2><p id="509b" class="pw-post-body-paragraph kg kh iq ki b kj mb jr kl km mc ju ko kp md kr ks kt me kv kw kx mf kz la lb ij bi translated">我使用了 XGBoost，一个非常通用的模型。</p><p id="84a1" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">我还得决定如何表达这个问题。</p><p id="1236" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated"><strong class="ki ir">回归:<br/> </strong>如果我将问题表述为回归，我可以将目标变量设置为分数。<strong class="ki ir">“给定一个餐厅名称，预测它的卫生检查分数”</strong></p><p id="975b" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">或者，我可以通过为一个令人讨厌的分数设置一个阈值，比如低于 85 分，来把这个问题表述为分类。<strong class="ki ir">“给定一家餐馆的名字，预测它在卫生检查中得到“坏分数”的几率”</strong></p><p id="d9b2" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">我选择了 85 分而不是 70 分(不及格)，因为不及格的分数很少，我不想要极度不平衡的班级。</p><pre class="lc ld le lf gt mu mv mw mx aw my bi"><span id="ffee" class="mz lk iq mv b gy na nb l nc nd"># Get the tfidf vectors</span><span id="3fe9" class="mz lk iq mv b gy nf nb l nc nd">tfidf_vec = <strong class="mv ir">TfidfVectorizer</strong>(stop_words='english', norm='l2', ngram_range=(1,1))</span><span id="81d8" class="mz lk iq mv b gy nf nb l nc nd">tfidf_vec.<strong class="mv ir">fit_transform</strong>(X['restaurant_name'].values.tolist())</span><span id="0c42" class="mz lk iq mv b gy nf nb l nc nd">train_tfidf = tfidf_vec.<strong class="mv ir">transform</strong>(X['restaurant_name'].values.tolist())</span><span id="3ac6" class="mz lk iq mv b gy nf nb l nc nd">regressor = xgb.XGBRegressor()<br/>regressor.<strong class="mv ir">fit</strong>(train_tfidf, df4['score'])</span><span id="7546" class="mz lk iq mv b gy nf nb l nc nd">classifier = xgb.XGBClassifier()<br/>classifier.<strong class="mv ir">fit</strong>(train_tfidf, df4['score'] &lt; 85)</span><span id="aba2" class="mz lk iq mv b gy nf nb l nc nd">eli5.<strong class="mv ir">show_weights</strong>(classifier, vec=tfidf_vec)</span></pre><p id="8864" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated"><strong class="ki ir">来自分类器的权重，这些是与低于 85 的“坏分数”相关的单词</strong></p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/8fddf8139cffcc34694a374301da4f5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1120/format:webp/0*7adH9081sNNFaFd2.png"/></div></figure><p id="7767" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">TF-IDF 和 XGboost 的好处是，该模型非常容易理解，您可以很容易地看到与低于 85 的“糟糕分数”直接相关的单词，结果与预期的一样，并且与早期的单词云相似。</p><p id="43b8" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">我使用全部数据进行训练，所以让我们用一些任意数据来测试模型。</p><p id="30a0" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">回归器根据输入字符串预测得分。以下是我发现的一些有趣的预测结果。</p><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="lh li l"/></div></figure><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="gh gi oi"><img src="../Images/c29aaaf069f98723342f867db9ab74ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*RS9jdLIRkLXCjMCD.jpg"/></div></div><figcaption class="mn mo gj gh gi mp mq bd b be z dk">$4 for 3 Breakfast Tacos, La Tapatia, <strong class="bd ms">Score: 87.5,</strong> I have been coming here for years</figcaption></figure><p id="8803" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">显然，奥斯汀的一些餐馆往往比其他餐馆更脏，我一直通过查看数据和我们的模型来怀疑这一点。</p><h1 id="e315" class="lj lk iq bd ll lm ln lo lp lq lr ls lt jw lu jx lv jz lw ka lx kc ly kd lz ma bi translated">伦理学</h1><p id="c78b" class="pw-post-body-paragraph kg kh iq ki b kj mb jr kl km mc ju ko kp md kr ks kt me kv kw kx mf kz la lb ij bi translated">这整个数据集有很多有趣的伦理考量。</p><p id="f77e" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated"><strong class="ki ir">准确性与社会危害:</strong> <br/>好吧，也许一些餐厅往往不如其他餐厅干净，这是否意味着我可以允许人类或人工智能健康检查员针对这些类型的餐厅？</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="gh gi oj"><img src="../Images/232be6581e7e859670c7375c3d6a5600.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*WDEZ9OQzbkOx5FeY.jpg"/></div></div></figure><p id="fe62" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">准确性和不公平地针对某些人群之间的权衡。</p><p id="a57d" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">有人可能会说防止顾客生病很重要。</p><p id="3907" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">另一个人可能会争辩说，针对特定类型的餐馆是荒谬的，因为“数据就是这么说的”</p><p id="97ed" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">最佳解决方案取决于它是什么类型的问题。</p><p id="7bbb" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">在招聘时，模特不可能被允许使用“种族”或“性别”，因为这些是 EEOC 明确保护的。</p><p id="788d" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">在广告定位中，使用那些相同的特征可能更容易被接受，因为不同的人口统计仅仅具有不同的消费模式</p><p id="1dd3" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated"><strong class="ki ir">数据中的人为偏差<br/> </strong>训练数据由人类健康检查员生成。如果那些人类健康检查员讨厌中国餐馆，这个模型也会学会同样的憎恨。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="gh gi ok"><img src="../Images/5a686fa5cd7634440f669d168f25e238.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*bYUtcucleB4W1cwP.jpg"/></div></div></figure><p id="b23a" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">根据我的经验，我有相对较好的信心认为这些数据接近事实，但这种探索仍然表明了盲目训练模型的危险，因为“数据说什么，数据就说什么！”。</p><p id="6047" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">一个模型会学习它被训练的数据中的任何东西。</p><p id="a041" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated"><strong class="ki ir">数据科学家的人类偏见:</strong> <br/>我试图通过让一个模型认为中国餐馆很恶心来证明这一点。在我找到一个能证明我观点的模型后，我停了下来。这样，我在文章中展示的模型也代表了我的偏见。</p><p id="22d9" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">我在寻找一种利用数据来证明我的观点的方法，当我找到这样做的方法时，我就停止了。试图提出另一个观点的人可能也会让数据支持他们的观点。</p><p id="e85f" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated"><strong class="ki ir">模型复杂度成本:</strong> <br/>在我们的例子中，我应用的 TF-IDF 技术相对简单易懂，我们可以看到哪些词与目标变量相关。</p><p id="ac84" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">但是如果我使用更先进的技术呢？</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/9c539e4a09df54cb5b3c084c9fc3c032.png" data-original-src="https://miro.medium.com/v2/resize:fit:650/format:webp/0*a4GV1zUrJXTmZHRd.png"/></div></figure><p id="7853" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">如果我用 word2vec + LSTM RNNs 举例呢。更复杂的模型，如具有单词嵌入的 RNN，能够理解数百个单词之外的文本内容中单词之间的关系，并且具有类似于人类记忆的长期和短期记忆。</p><p id="6542" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">对于如此复杂的模型，要“诊断”为什么模型会预测某些预测结果要困难得多。</p><p id="b3de" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">像谷歌这样的公司肯定也有成千上万的功能和模型，它们不仅理解功能，还理解这些功能之间复杂的交互和关系，什么人可能理解这样一个模型的工作方式？</p><p id="73fd" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">如果我们不明白为什么模型是准确的，我们还能相信准确的模型吗？</p><h1 id="bd2f" class="lj lk iq bd ll lm ln lo lp lq lr ls lt jw lu jx lv jz lw ka lx kc ly kd lz ma bi translated">结论</h1><p id="8927" class="pw-post-body-paragraph kg kh iq ki b kj mb jr kl km mc ju ko kp md kr ks kt me kv kw kx mf kz la lb ij bi translated">该数据集中有 22，000 个检查，5，000 个被检查的独特企业，以及大约 50 个邮政编码。</p><p id="877d" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">我的模型只使用 TF-IDF 和餐馆名称进行预测。</p><p id="c348" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">如果有人希望构建一个更关注模型准确性的模型，数据集中还包含一些其他重要的功能。</p><p id="3445" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">其他一些很棒的特性是邮政编码作为一个分类特性。</p><p id="1e54" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">以(北、南、东、西)作为分类或文本特征的街道名称，包含位置的邻域级别上下文。</p><p id="d976" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">过程描述有“常规”、“跟进至低分”和“第二次跟进至低分”，必须有某种方法来教导一个模型，该模型在较差的检查之后分数通常会上升。我在这次探索中没有使用时间序列，但肯定有办法。</p><p id="635f" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">日期，也许卫生检查员周一更暴躁？</p><p id="cecd" class="pw-post-body-paragraph kg kh iq ki b kj kk jr kl km kn ju ko kp kq kr ks kt ku kv kw kx ky kz la lb ij bi translated">这就是我对一个数据集的分析，这个数据集既与我个人密切相关，也与我毫不相关(外出就餐时，我“相信自己的直觉”)。</p></div></div>    
</body>
</html>