# ä½¿ç”¨ tf æž„å»ºæ·±åº¦å›¾åƒæœç´¢å¼•æ“Žã€‚å…‹æ‹‰æ–¯

> åŽŸæ–‡ï¼š<https://towardsdatascience.com/building-a-deep-image-search-engine-using-tf-keras-6760beedbad?source=collection_archive---------17----------------------->

![](img/2e1b107972b99ac0074d02a80a7cbbf4.png)

Photo by [Kayla Farmer](https://unsplash.com/@imagesbykayla?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) on [Unsplash](https://unsplash.com/s/photos/search?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)

# åŠ¨æœº:

æƒ³è±¡ä¸€ä¸‹ï¼Œæœ‰å‡ åä¸‡åˆ°å‡ ç™¾ä¸‡å¼ å›¾åƒçš„æ•°æ®é›†åˆï¼Œå´æ²¡æœ‰æè¿°æ¯å¼ å›¾åƒå†…å®¹çš„ä»»ä½•å…ƒæ•°æ®ã€‚æˆ‘ä»¬å¦‚ä½•å»ºç«‹ä¸€ä¸ªç³»ç»Ÿï¼Œèƒ½å¤Ÿæ‰¾åˆ°è¿™äº›å›¾åƒçš„å­é›†ï¼Œæœ€å¥½åœ°å›žç­”ç”¨æˆ·çš„æœç´¢æŸ¥è¯¢ï¼Ÿæˆ‘ä»¬åŸºæœ¬ä¸Šéœ€è¦çš„æ˜¯ä¸€ä¸ªæœç´¢å¼•æ“Žï¼Œå®ƒèƒ½å¤Ÿæ ¹æ®å›¾åƒç»“æžœä¸Žæœç´¢æŸ¥è¯¢çš„å¯¹åº”ç¨‹åº¦å¯¹å›¾åƒç»“æžœè¿›è¡ŒæŽ’åºï¼Œæœç´¢æŸ¥è¯¢å¯ä»¥ç”¨è‡ªç„¶è¯­è¨€æˆ–å¦ä¸€ç§æŸ¥è¯¢å›¾åƒæ¥è¡¨è¾¾ã€‚
æˆ‘ä»¬å°†åœ¨æœ¬æ–‡ä¸­è§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•æ˜¯é€šè¿‡è®­ç»ƒä¸€ä¸ªæ·±åº¦ç¥žç»æ¨¡åž‹ï¼Œè¯¥æ¨¡åž‹å­¦ä¹ ä»»ä½•è¾“å…¥å›¾åƒå’Œæ–‡æœ¬çš„å›ºå®šé•¿åº¦è¡¨ç¤º(æˆ–åµŒå…¥),å¹¶ä½¿è¿™äº›è¡¨ç¤ºåœ¨æ¬§å‡ é‡Œå¾—ç©ºé—´ä¸­æŽ¥è¿‘ï¼Œå¦‚æžœæ–‡æœ¬-å›¾åƒæˆ–å›¾åƒ-å›¾åƒå¯¹â€œç›¸ä¼¼â€çš„è¯ã€‚

# æ•°æ®é›†:

æˆ‘æ‰¾ä¸åˆ°ä¸€ä¸ªè¶³å¤Ÿå¤§çš„æœç´¢ç»“æžœæŽ’åæ•°æ®é›†ï¼Œä½†æˆ‘èƒ½å¤Ÿå¾—åˆ°è¿™ä¸ªæ•°æ®é›†:ã€http://jmcauley.ucsd.edu/data/amazon/ã€‘T2ï¼Œå®ƒå°†ç”µå­å•†åŠ¡é¡¹ç›®å›¾ç‰‡é“¾æŽ¥åˆ°å®ƒä»¬çš„æ ‡é¢˜å’Œæè¿°ã€‚æˆ‘ä»¬å°†ä½¿ç”¨è¿™äº›å…ƒæ•°æ®ä½œä¸ºç›‘ç£æºæ¥å­¦ä¹ æœ‰æ„ä¹‰çš„è”åˆæ–‡æœ¬-å›¾åƒè¡¨ç¤ºã€‚ä¸ºäº†ç®¡ç†è®¡ç®—å’Œå­˜å‚¨æˆæœ¬ï¼Œå®žéªŒä»…é™äºŽæ—¶è£…(æœè£…ã€éž‹å­å’Œç å®)å’Œ 500ï¼Œ000 å¼ å›¾åƒã€‚

# é—®é¢˜è®¾ç½®:

æˆ‘ä»¬æ‹¥æœ‰çš„æ•°æ®é›†å°†æ¯å¼ å›¾ç‰‡ä¸Žç”¨è‡ªç„¶è¯­è¨€ä¹¦å†™çš„æè¿°è”ç³»èµ·æ¥ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªä»»åŠ¡ï¼Œåœ¨è¿™ä¸ªä»»åŠ¡ä¸­ï¼Œæˆ‘ä»¬å¸Œæœ›å­¦ä¹ ä¸€ä¸ªè¿žæŽ¥çš„ã€å›ºå®šé•¿åº¦çš„å›¾åƒå’Œæ–‡æœ¬è¡¨ç¤ºï¼Œä»¥ä¾¿æ¯ä¸ªå›¾åƒè¡¨ç¤ºéƒ½æŽ¥è¿‘å…¶æè¿°çš„è¡¨ç¤ºã€‚

![](img/735c3276f917115883f1e39acbf7f7ff.png)

# åž‹å·:

è¯¥æ¨¡åž‹é‡‡ç”¨ 3 ä¸ªè¾“å…¥:å›¾åƒ(å³é”šç‚¹)ã€å›¾åƒæ ‡é¢˜+æè¿°(æ­£é¢ç¤ºä¾‹)ï¼Œç¬¬ä¸‰ä¸ªè¾“å…¥æ˜¯ä¸€äº›éšæœºé‡‡æ ·çš„æ–‡æœ¬(è´Ÿé¢ç¤ºä¾‹)ã€‚
ç„¶åŽæˆ‘ä»¬å®šä¹‰ä¸¤ä¸ªå­æ¨¡åž‹:

*   å›¾åƒç¼–ç å™¨:Resnet50 åœ¨ ImageNet+GlobalMaxpooling2D ä¸Šé¢„å…ˆè®­ç»ƒ
*   æ–‡æœ¬ç¼–ç å™¨:GRU+GlobalMaxpooling1D

å›¾åƒå­æ¨¡åž‹äº§ç”Ÿé”šç‚¹çš„åµŒå…¥ **E_a** ï¼Œæ–‡æœ¬å­æ¨¡åž‹è¾“å‡ºæ­£é¢æ ‡é¢˜+æè¿°çš„åµŒå…¥ **E_p** å’Œè´Ÿé¢æ–‡æœ¬çš„åµŒå…¥ **E_n** ã€‚

ç„¶åŽï¼Œæˆ‘ä»¬é€šè¿‡ä¼˜åŒ–ä»¥ä¸‹ä¸‰é‡æŸå¤±è¿›è¡Œè®­ç»ƒ:

**L = max( d(E_aï¼ŒE_p)-d(E_aï¼ŒE_n)+alphaï¼Œ0)**

å…¶ä¸­ d æ˜¯æ¬§å‡ é‡Œå¾·è·ç¦»ï¼ŒÎ±æ˜¯åœ¨è¯¥å®žéªŒä¸­ç­‰äºŽ 0.4 çš„è¶…å‚æ•°ã€‚

åŸºæœ¬ä¸Šè¿™ä¸ªæŸå¤±å…è®¸åšçš„å°±æ˜¯æŠŠ **d(E_aï¼ŒE_p)** åšå°ï¼ŒæŠŠ **d(E_aï¼ŒE_n)** åšå¤§ï¼Œè¿™æ ·æ¯ä¸€ä¸ªå›¾åƒåµŒå…¥éƒ½æ˜¯é è¿‘å…¶æè¿°çš„åµŒå…¥è€Œè¿œç¦»éšæœºæ–‡æœ¬çš„åµŒå…¥ã€‚

# å¯è§†åŒ–ç»“æžœ:

ä¸€æ—¦æˆ‘ä»¬å­¦ä¹ äº†å›¾åƒåµŒå…¥æ¨¡åž‹å’Œæ–‡æœ¬åµŒå…¥æ¨¡åž‹ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ä½¿ç”¨ tsne([https://sci kit-learn . org/stable/modules/generated/sk learn . manifold . tsne . html](https://scikit-learn.org/stable/modules/generated/sklearn.manifold.TSNE.html))å°†å®ƒä»¬æŠ•å½±åˆ°äºŒç»´ç©ºé—´æ¥å¯è§†åŒ–å®ƒä»¬ã€‚

![](img/7aed64faef99cd370383a7f0ca11fddf.png)

Test Images and their corresponding text description are linked by green lines

ä»Žå›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œä¸€èˆ¬æ¥è¯´ï¼Œåœ¨åµŒå…¥ç©ºé—´ä¸­ï¼Œå›¾åƒä¸Žå…¶å¯¹åº”çš„æè¿°æ˜¯æŽ¥è¿‘çš„ã€‚è¿™æ­£æ˜¯æˆ‘ä»¬æ‰€æœŸæœ›çš„è®­ç»ƒæŸå¤±ã€‚

# æ–‡æœ¬å›¾åƒæœç´¢:

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨å‡ ä¸ªæ–‡æœ¬æŸ¥è¯¢çš„ä¾‹å­åœ¨ä¸€ç»„ 70ï¼Œ000 å¼ å›¾åƒä¸­æœç´¢æœ€ä½³åŒ¹é…ã€‚æˆ‘ä»¬ä¸ºæŸ¥è¯¢è®¡ç®—æ–‡æœ¬åµŒå…¥ï¼Œç„¶åŽä¸ºé›†åˆä¸­çš„æ¯ä¸ªå›¾åƒè®¡ç®—åµŒå…¥ã€‚æˆ‘ä»¬æœ€ç»ˆé€‰æ‹©åµŒå…¥ç©ºé—´ä¸­æœ€æŽ¥è¿‘æŸ¥è¯¢çš„å‰ 9 ä¸ªå›¾åƒã€‚

![](img/49e5f62254e1d402f3c72782396f54ce.png)![](img/87093f58d293e243f54c5d1981447ba1.png)

è¿™äº›ä¾‹å­è¡¨æ˜Žï¼ŒåµŒå…¥æ¨¡åž‹èƒ½å¤Ÿå­¦ä¹ å›¾åƒçš„æœ‰ç”¨è¡¨ç¤ºå’Œç®€å•å•è¯ç»„åˆçš„åµŒå…¥ã€‚

# å›¾åƒ-å›¾åƒæœç´¢:

è¿™é‡Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªå›¾åƒä½œä¸ºæŸ¥è¯¢ï¼Œç„¶åŽåœ¨ 70ï¼Œ000 ä¸ªå›¾åƒçš„æ•°æ®åº“ä¸­æœç´¢ä¸Žå…¶æœ€ç›¸ä¼¼çš„ä¾‹å­ã€‚ä½¿ç”¨æ¬§å‡ é‡Œå¾·è·ç¦»ï¼Œé€šè¿‡æ¯å¯¹å›¾åƒåœ¨åµŒå…¥ç©ºé—´ä¸­çš„æŽ¥è¿‘ç¨‹åº¦æ¥ç¡®å®šæŽ’åã€‚

![](img/805dc50583d38681ab326025906e96e7.png)![](img/82f64f30d5d1199cf97284d0a8156c37.png)

ç»“æžœè¡¨æ˜Žï¼Œæ‰€ç”Ÿæˆçš„åµŒå…¥æ˜¯å›¾åƒçš„é«˜çº§è¡¨ç¤ºï¼Œå…¶æ•æ‰äº†æ‰€è¡¨ç¤ºçš„å¯¹è±¡çš„æœ€é‡è¦çš„ç‰¹å¾ï¼Œè€Œä¸å—æ–¹å‘ã€ç…§æ˜Žæˆ–å¾®å°çš„å±€éƒ¨ç»†èŠ‚çš„è¿‡å¤šå½±å“ï¼Œå¹¶ä¸”æ²¡æœ‰è¢«æ˜Žç¡®åœ°è®­ç»ƒæ¥è¿™æ ·åšã€‚

# ç»“è®º:

åœ¨è¿™ä¸ªé¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬è‡´åŠ›äºŽæœºå™¨å­¦ä¹ æ¨¡å—ï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿå»ºç«‹ä¸€ä¸ªåŸºäºŽå…³é”®å­—å’Œå›¾åƒçš„æœç´¢å¼•æ“Žï¼Œåº”ç”¨äºŽå›¾åƒé›†åˆã€‚åŸºæœ¬æ€æƒ³æ˜¯ä¸ºæ–‡æœ¬å’Œå›¾åƒå­¦ä¹ ä¸€ä¸ªæœ‰æ„ä¹‰çš„è”åˆåµŒå…¥å‡½æ•°ï¼Œç„¶åŽä½¿ç”¨åµŒå…¥ç©ºé—´ä¸­é¡¹ç›®ä¹‹é—´çš„è·ç¦»å¯¹æœç´¢ç»“æžœè¿›è¡ŒæŽ’åºã€‚

**å‚è€ƒæ–‡çŒ®:**

*   [é€šè¿‡æŽ’åå¤§è§„æ¨¡åœ¨çº¿å­¦ä¹ å›¾åƒç›¸ä¼¼åº¦](http://www.jmlr.org/papers/volume11/chechik10a/chechik10a.pdf)
*   [èµ·ä¼:ç”¨ä¸€ç±»ååŒè¿‡æ»¤å¯¹æµè¡Œè¶‹åŠ¿çš„è§†è§‰æ¼”å˜å»ºæ¨¡](https://cseweb.ucsd.edu/~jmcauley/pdfs/www16a.pdf)
*   [https://github . com/KinWaiCheuk/Triplet-net-keras/blob/master/Triplet % 20NN % 20 test % 20 on % 20 minist . ipynb](https://github.com/KinWaiCheuk/Triplet-net-keras/blob/master/Triplet%20NN%20Test%20on%20MNIST.ipynb)

**ä»£ç :** é‡çŽ°ç»“æžœðŸ”=>[https://github.com/CVxTz/image_search_engine](https://github.com/CVxTz/image_search_engine)