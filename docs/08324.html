<html>
<head>
<title>Writing a custom script to voice control your wifi smartplug</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">编写自定义脚本来语音控制您的 wifi 智能插件</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/writing-a-custom-script-to-voice-control-your-wifi-smartplug-cd512282ebd5?source=collection_archive---------38-----------------------#2019-11-12">https://towardsdatascience.com/writing-a-custom-script-to-voice-control-your-wifi-smartplug-cd512282ebd5?source=collection_archive---------38-----------------------#2019-11-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="3286" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">今天我们将使用一个<a class="ae kl" href="https://www.tp-link.com/uk/home-networking/smart-plug/hs100/" rel="noopener ugc nofollow" target="_blank"> TP-LINK HS100 </a>智能插头，直接从我们自己的电脑上控制它。(我个人用我的电脑关掉我电脑桌前所有的灯、扬声器和显示器。)</p><p id="e12c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">TP LINK 已经为 iOS 和 Android 提供了一个移动应用程序<a class="ae kl" href="https://apps.apple.com/us/app/kasa-smart/id1034035493" rel="noopener ugc nofollow" target="_blank">“Kasa Smart</a>”,但当我试图直接从我的电脑上进行操作时遇到了麻烦，因此我决定开发自己的程序。</p><p id="8cb8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">先决条件(我用的是 Macbook):</p><ul class=""><li id="7146" class="km kn iq jp b jq jr ju jv jy ko kc kp kg kq kk kr ks kt ku bi translated">一个 API 调试器(我用的是<a class="ae kl" href="https://insomnia.rest/" rel="noopener ugc nofollow" target="_blank">失眠</a></li><li id="9bd2" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk kr ks kt ku bi translated">TP-LINK HS100</li><li id="4e81" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk kr ks kt ku bi translated">您已经在智能手机上的 Kasa smart 应用程序中设置了您的设备</li><li id="f950" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk kr ks kt ku bi translated">可以用来编写 shell 脚本的东西(默认的文本编辑打开就可以了)</li></ul><p id="6326" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，我们需要从失眠症向设备发送一个 API 请求，以获取设备信息。因为我们想要提交一个请求，所以我们选择“Post”作为方法，选择“<a class="ae kl" href="https://wap.tplinkcloud.com" rel="noopener ugc nofollow" target="_blank">https://wap.tplinkcloud.com</a>”作为我们想要发送请求的 URL。</p><p id="90c5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于要批准的请求，我们还必须添加我们的自定义参数，即“appType”、“cloudUsername”、“cloudPassword”和“terminalUUID”。apptype 将取决于您的操作系统，我的是“Kasa_iPhone”，cloudUsername &amp; cloudPassword 将是用于登录移动应用程序的凭据，最后，terminalUUID 是一个自定义的 UUID，您可以自己指定(我建议使用这样的在线生成器:<a class="ae kl" href="https://www.uuidgenerator.net/" rel="noopener ugc nofollow" target="_blank">https://www.uuidgenerator.net/</a>，并记下您的 UUID)。</p><p id="c5d0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面是我最终请求的照片，其中删除了敏感信息:</p><figure class="lb lc ld le gt lf gh gi paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="gh gi la"><img src="../Images/6efa0be17b021ea8c5e7a917a128df97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-jxA6ijM-5zoSoAWLTpsCw.png"/></div></div><figcaption class="lm ln gj gh gi lo lp bd b be z dk">Our first post request, just fill in your personal information</figcaption></figure><p id="7aae" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">完成后，我们可以点击右上角的“发送”,如果所有信息都正确，您应该会收到如下内容:</p><figure class="lb lc ld le gt lf gh gi paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="gh gi lq"><img src="../Images/fd5e816215b284fa9aa6a91ebb82ab90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BbVWx9_WyLZDAqmC3WH09w.png"/></div></div><figcaption class="lm ln gj gh gi lo lp bd b be z dk">Our response from the POST request</figcaption></figure><p id="67fc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里我们感兴趣的是“token”参数，它是我们检索设备信息的安全令牌。所以，复制/写下你的令牌，保存起来以备后用。</p><p id="3ffe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们有了设备令牌，我们可以发送另一个更完整的 Post 请求来接收关于设备的完整信息。与另一个请求类似，我们将发送一个 post 请求到之前相同的地址，将我们的令牌参数添加到 URL。它应该看起来像这样<a class="ae kl" href="https://wap.tplinkcloud.com?token=196aeb02-B4uSpUgDHG5STPdgSP6pYY0" rel="noopener ugc nofollow" target="_blank">https://wap.tplinkcloud.com？token =<strong class="jp ir">XXXXXXXX-X</strong></a><strong class="jp ir">xxxxxxxxxxxxxxxxxxxxxxxxxxxxx</strong>其中所有这些 X 都是您之前的个人令牌。包括</p><blockquote class="lr ls lt"><p id="5cc5" class="jn jo lu jp b jq jr js jt ju jv jw jx lv jz ka kb lw kd ke kf lx kh ki kj kk ij bi translated">{"method":"getDeviceList"}</p></blockquote><p id="1eb0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在消息体中，我们准备发送。它应该类似于下面这样(去掉了我的令牌):</p><figure class="lb lc ld le gt lf gh gi paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="gh gi ly"><img src="../Images/8d7c0821b582a198e7025867b384da47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Uwl1Jy1q1y-ptNg_4puMtA.png"/></div></div></figure><p id="ef1b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您做了所有正确的事情，您应该会收到一个没有错误的响应，应该是这样的:</p><figure class="lb lc ld le gt lf gh gi paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="gh gi lz"><img src="../Images/46b7182afef5a9107758f9f29a26e88b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZabCoDYzkk46E3ucI4ZXeA.png"/></div></div><figcaption class="lm ln gj gh gi lo lp bd b be z dk">Response from the request with sensitive information removed.</figcaption></figure><p id="73be" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里需要注意的是,“status”属性告诉我们智能插头的当前状态,“1”表示智能插头打开,“0”表示智能插头关闭。然而，我们感兴趣的，我需要你记下来的是“设备 Id”。</p><p id="261d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们已经有了关于设备的所有必要信息，我们准备创建我们的脚本来打开/关闭 smartplug。</p><p id="3428" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">打开你最喜欢的文本编辑器(我只是使用 mac 默认的文本编辑器)，插入这段代码:</p><blockquote class="lr ls lt"><p id="9421" class="jn jo lu jp b jq jr js jt ju jv jw jx lv jz ka kb lw kd ke kf lx kh ki kj kk ij bi translated">curl—request POST "<a class="ae kl" href="https://wap.tplinkcloud.com?token=196aeb02-B4uSpUgDHG5STPdgSP6pYY0" rel="noopener ugc nofollow" target="_blank">https://wap.tplinkcloud.com？token =<strong class="jp ir">X</strong></a><strong class="jp ir">XXXX</strong>" \<br/>—data ' { " method ":" pass through "，" params ":{ " device id ":<strong class="jp ir">XXXX</strong>，" request data ":{ \ " system \ ":{ \ " set _ relay _ state \ ":{ \ " state \ ":0 } } " } ' \<br/>—header " Content-Type:application/JSON "</p></blockquote><p id="1b50" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">删除粗体 X 并插入您自己的参数。这个脚本将向您的特定设备发送一个请求，要求它将状态设置为您指定的任何状态。</p><p id="c3b4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如前所述，这个脚本用于关闭设备；“0”表示设备关闭,“1”表示设备打开，因此在上面的代码中将“状态”从 0 更改为 1，表示您想要打开设备。</p><p id="a9d3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将文件保存为“外壳文件”(文件扩展名为。命令，这样“终端”会自动打开并运行该脚本。).因此，将该文件命名为“desk_off.command”并保存它。创建另一个文件，从“desk_off.command”文件中复制代码，并将状态从 0 更改为 1，并将其命名为“desk_on.command”。</p><p id="7fe7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您应该有两个文件；一个用于打开智能插头，一个用于关闭智能插头。尝试运行这两个文件，检查是否一切正常，如果不正常，返回到前面的步骤，以确保您没有遗漏任何内容。</p><p id="6f37" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们准备好启动这些基于语音命令的脚本。打开“系统偏好设置”,进入“辅助功能”选项卡&gt;“语音控制”&gt;“命令”,然后按左下角的小“+”符号来添加新命令。在这里，您可以选择您应该说什么来触发动作，如果它应该能够在使用特定应用程序时触发，最后，在“执行”选项卡下，选择“打开 finder 项目…”并选择脚本。应该是这样的:</p><figure class="lb lc ld le gt lf gh gi paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="gh gi ma"><img src="../Images/3158e5e467392168b72a2050e332f7b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*soJ1bBdbF477XXOtrZCGaw.png"/></div></div></figure><p id="81e9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在试着说出你的命令并测试它是否有效:)</p></div></div>    
</body>
</html>