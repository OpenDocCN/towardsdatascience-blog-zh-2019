<html>
<head>
<title>One Word of Code to Stop Using Pandas So Slowly</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">一个字的代码停止使用熊猫这么慢</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/one-word-of-code-to-stop-using-pandas-so-slowly-793e0a81343c?source=collection_archive---------2-----------------------#2019-11-02">https://towardsdatascience.com/one-word-of-code-to-stop-using-pandas-so-slowly-793e0a81343c?source=collection_archive---------2-----------------------#2019-11-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="de8b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">那将永远改变你的生活</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/61668fef2836032608ea1723b9e0a884.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*KbSJ_7-kXqQPof-g"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Photo by <a class="ae ky" href="https://unsplash.com/@lanceanderson?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Lance Anderson</a> on <a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="ec16" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您已经将所有数据加载到 Panda 的数据框架中，准备进行一些探索性分析，但是首先，您需要创建一些附加的要素。很自然地，你转向<a class="ae ky" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.apply.html" rel="noopener ugc nofollow" target="_blank">应用</a>功能。Apply 很棒，因为它使得对所有数据行使用函数变得很容易。您设置好一切，运行您的代码，然后…</p><blockquote class="lv"><p id="7d87" class="lw lx it bd ly lz ma mb mc md me lu dk translated">美国驻 T2 大使馆</p></blockquote><p id="c38d" class="pw-post-body-paragraph kz la it lb b lc mf ju le lf mg jx lh li mh lk ll lm mi lo lp lq mj ls lt lu im bi translated">事实证明，处理一个大型数据集的每一行都需要一段时间。<strong class="lb iu">谢天谢地，有一个非常简单的解决方案可以为您节省大量时间。</strong></p><h1 id="199f" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">下前支索</h1><p id="68dd" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">Swifter 是一个库，它“以最快的方式将任何函数应用到 pandas 数据帧或系列中。”要理解这一点，我们需要先讨论几个原则。</p><h2 id="2bbf" class="nh ml it bd mm ni nj dn mq nk nl dp mu li nm nn mw lm no np my lq nq nr na ns bi translated">…向量化…</h2><p id="9da0" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">对于这个用例，我们将把矢量化定义为使用 Numpy 来表示整个数组的计算，而不是它们的元素。</p><p id="a3db" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，假设您有两个数组:</p><pre class="kj kk kl km gt nt nu nv nw aw nx bi"><span id="1b83" class="nh ml it nu b gy ny nz l oa ob">array_1 = np.array([1,2,3,4,5])<br/>array_2 = np.array([6,7,8,9,10])</span></pre><p id="796f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您希望创建一个新数组，它是两个数组的和，结果是:</p><pre class="kj kk kl km gt nt nu nv nw aw nx bi"><span id="2a04" class="nh ml it nu b gy ny nz l oa ob">result = [7,9,11,13,15]</span></pre><p id="61b8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以用 Python 中的 for 循环对这些数组求和，但这非常慢。相反，Numpy 允许您直接在数组上操作，这样速度明显更快(尤其是对于大型数组)</p><pre class="kj kk kl km gt nt nu nv nw aw nx bi"><span id="d5e9" class="nh ml it nu b gy ny nz l oa ob">result = array_1 + array_2</span></pre><p id="a8bf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">关键的一点是，只要有可能，就要使用矢量化运算。</p><h2 id="3db6" class="nh ml it bd mm ni nj dn mq nk nl dp mu li nm nn mw lm no np my lq nq nr na ns bi translated">并行处理</h2><p id="fc36" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">几乎所有的计算机都有多个处理器。这意味着你可以很容易地通过利用它们来加速你的代码。由于 apply 只是将一个函数应用于数据帧的每一行，因此很容易实现并行化。您可以将数据帧分成多个数据块，将每个数据块提供给处理器，然后在最后将这些数据块组合成一个数据帧。</p><h1 id="37dc" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">魔力</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/7e10ed0ba5d135ee9dcebb97581d34bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:776/format:webp/1*FUhv0f_JCrhKIi35yYLrGg.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Source: <a class="ae ky" href="https://github.com/jmcarpenter2/swifter" rel="noopener ugc nofollow" target="_blank">https://github.com/jmcarpenter2/swifter</a></figcaption></figure><p id="137d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">斯威夫特做的是</p><ol class=""><li id="7360" class="od oe it lb b lc ld lf lg li of lm og lq oh lu oi oj ok ol bi translated">检查你的函数是否可以矢量化，如果可以，就使用矢量化计算。</li><li id="f7d3" class="od oe it lb b lc om lf on li oo lm op lq oq lu oi oj ok ol bi translated">如果无法实现矢量化，请检查是使用<a class="ae ky" href="https://dask.org/" rel="noopener ugc nofollow" target="_blank"> Dask </a>进行并行处理还是仅使用 vanilla Pandas apply(仅使用单核)最有意义。对于小型数据集，并行处理的开销会使处理速度变慢。</li></ol><p id="8fd9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这在上图中得到了很好的展示。您可以看到，无论数据大小如何，使用矢量化几乎总是更好。如果这是不可能的，你可以从 vanilla Pandas 获得最好的速度，直到你的数据足够大。一旦超过大小阈值，并行处理最有意义。</p><p id="58d8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以看到“swiftapply”行是 swifter 会做的事情，它会自动为您选择最佳选项。</p><p id="3b19" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你怎么利用你问的这种魔力？简单。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="or os l"/></div></figure><p id="c1ab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如上所示，只需在应用程序前添加更快的调用，现在只需一个单词，您就可以比以往任何时候都更快地运行您的熊猫应用程序。</p><p id="1edf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，你可以花更少的时间盯着进度条，花更多的时间做科学。这改变了生活。不过，你可能没那么多时间进行剑战了。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/9068b0269649ff26066ce625cd4e83d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:826/format:webp/1*J-1MC3QGbIuwq4tb-yr-iA.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Source: <a class="ae ky" href="https://xkcd.com/303/" rel="noopener ugc nofollow" target="_blank">https://xkcd.com/303/</a></figcaption></figure></div><div class="ab cl ou ov hx ow" role="separator"><span class="ox bw bk oy oz pa"/><span class="ox bw bk oy oz pa"/><span class="ox bw bk oy oz"/></div><div class="im in io ip iq"><p id="ad2e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://datascienceleadership.substack.com/" rel="noopener ugc nofollow" target="_blank">免费获得掌握数据科学的 11 种极其有用的资源</a></p></div></div>    
</body>
</html>