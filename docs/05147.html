<html>
<head>
<title>Data science you need to know — diagnosing linear regressions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">你需要知道的数据科学-诊断线性回归</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/data-science-you-need-to-know-linear-regression-2b6d966bc4a8?source=collection_archive---------16-----------------------#2019-08-01">https://towardsdatascience.com/data-science-you-need-to-know-linear-regression-2b6d966bc4a8?source=collection_archive---------16-----------------------#2019-08-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="5732" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="ko">这是我的“你需要了解的数据科学系列”的一部分，探索数据科学中经常被忽视的方面。</em> <a class="ae kp" rel="noopener" target="_blank" href="/introduction-to-statistics-e9d72d818745"> <em class="ko">第一部</em> </a> <em class="ko">和</em> <a class="ae kp" rel="noopener" target="_blank" href="/data-science-you-need-to-know-a-b-testing-f2f12aff619a"> <em class="ko">第二部</em> </a> <em class="ko">推荐阅读。第 3 部分即将推出！</em></p><p id="bbb2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在本帖中，我们将介绍大多数学生最先学习的机器学习算法之一，线性回归。</p><p id="d5d2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你会看到很多跨越数据分析和数据科学的线性回归，不幸的是，很多都很弱。这通常有两个原因:</p><ul class=""><li id="c6ed" class="kq kr it js b jt ju jx jy kb ks kf kt kj ku kn kv kw kx ky bi translated">回归模型严重违反了一个或多个关键的统计假设</li><li id="0219" class="kq kr it js b jt kz jx la kb lb kf lc kj ld kn kv kw kx ky bi translated">回归没有提供详细的诊断，因此无法评估其稳健性(以及其结论)</li></ul><p id="829e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这篇文章中，我们将学习如何避免这些问题，以及如何有效地评估和评论已发布的回归模型。我们将从 A/B 测试评估的角度来处理这个问题，但是同样的原则也适用于<em class="ko">生产化的</em>回归模型(即后端的模型)。</p></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><h1 id="2c9f" class="ll lm it bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">理论:回归独立数据</h1><p id="cb51" class="pw-post-body-paragraph jq jr it js b jt mj jv jw jx mk jz ka kb ml kd ke kf mm kh ki kj mn kl km kn im bi translated">在我们建立回归模型之前，重要的是要彻底研究数据(例如通过配对图和密度图)并理解我们的 A/B 测试的统计能力(参见<a class="ae kp" rel="noopener" target="_blank" href="/introduction-to-statistics-e9d72d818745"> <em class="ko">第 1 部分</em> </a> <em class="ko">和</em> <a class="ae kp" rel="noopener" target="_blank" href="/data-science-you-need-to-know-a-b-testing-f2f12aff619a"> <em class="ko">第 2 部分</em> </a> <em class="ko">)。</em></p><p id="2a19" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">一旦我们探索了数据，我们就可以开始建立一个线性模型。用于线性回归的 R/Python 代码的简单性可能具有欺骗性。虽然你可以通过简单的<code class="fe mo mp mq mr b">lm(x,y),</code>产生结果，但你需要了解这些结果是否可靠。</p><p id="b826" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">线性回归有一组与其相关的<strong class="js iu">假设</strong>和<strong class="js iu">警告</strong>，在我们解释回归结果之前，需要对其进行检查。如果我们违反这些假设，那么代码<em class="ko">仍将运行</em>，您仍将获得系数、p 值和预测(等等)，但它们很可能<em class="ko">毫无意义！</em></p><blockquote class="ms"><p id="4317" class="mt mu it bd mv mw mx my mz na nb kn dk translated"><em class="nc">一点数据科学可能是一件危险的事情！</em></p></blockquote><h1 id="59bf" class="ll lm it bd ln lo nd lq lr ls ne lu lv lw nf ly lz ma ng mc md me nh mg mh mi bi translated">好模型的标准</h1><p id="e741" class="pw-post-body-paragraph jq jr it js b jt mj jv jw jx mk jz ka kb ml kd ke kf mm kh ki kj mn kl km kn im bi translated">在我们着手模型构建之前，最好在头脑中有一个好模型的定义。我们将根据以下标准定义一个好的模型:</p><ul class=""><li id="8062" class="kq kr it js b jt ju jx jy kb ks kf kt kj ku kn kv kw kx ky bi translated">模型能够解释/预测 Y 值的全范围</li><li id="a7cb" class="kq kr it js b jt kz jx la kb lb kf lc kj ld kn kv kw kx ky bi translated">模型可以准确地提供置信区间，以告知我们对不确定性(和重要性)的理解</li><li id="0e9a" class="kq kr it js b jt kz jx la kb lb kf lc kj ld kn kv kw kx ky bi translated">异常值不会扭曲模型</li></ul><p id="86bc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们可以通过满足以下线性回归标准来满足这些要求:</p><ul class=""><li id="4444" class="kq kr it js b jt ju jx jy kb ks kf kt kj ku kn kv kw kx ky bi translated">X 和 Y 之间的关系是线性的，或者可以是线性的。</li><li id="9367" class="kq kr it js b jt kz jx la kb lb kf lc kj ld kn kv kw kx ky bi translated">误差与 X 无关(也称为同质性)</li><li id="75f5" class="kq kr it js b jt kz jx la kb lb kf lc kj ld kn kv kw kx ky bi translated">变量大多彼此不相关</li><li id="ac1e" class="kq kr it js b jt kz jx la kb lb kf lc kj ld kn kv kw kx ky bi translated">残差呈正态分布</li></ul><p id="8205" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">因此，为了构建一个好的模型，我们需要理解和评估上面概述的基本假设。我们将通过一系列的图来实现这一点，这些图检查了许多东西，但也许最重要的是模型的<strong class="js iu">残差</strong>:</p><ul class=""><li id="4bb5" class="kq kr it js b jt ju jx jy kb ks kf kt kj ku kn kv kw kx ky bi translated"><strong class="js iu">残差</strong>是模型预测值和实际观测值之间的差值。</li></ul><p id="8c7d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们将首先通过一个表现良好的回归来探索这些图，以了解这些图在最佳情况下的样子，然后这些图如何对异方差和非线性做出反应。</p><h1 id="b33a" class="ll lm it bd ln lo nd lq lr ls ne lu lv lw ni ly lz ma nj mc md me nk mg mh mi bi translated">理论:表现良好的回归</h1><p id="aa85" class="pw-post-body-paragraph jq jr it js b jt mj jv jw jx mk jz ka kb ml kd ke kf mm kh ki kj mn kl km kn im bi translated">首先，一个表现良好的回归模型。我们将(希望)记住直线的定义:</p><blockquote class="nl nm nn"><p id="d428" class="jq jr ko js b jt ju jv jw jx jy jz ka no kc kd ke np kg kh ki nq kk kl km kn im bi translated">Y=β。X+c</p></blockquote><p id="09de" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">其中，β是系数矩阵，X 是常数矩阵，c 是截距。</p><p id="c281" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们将使用这个等式来理解回归，并添加一个<em class="ko"> e </em>项来表示我们观察值周围的独立误差。运行回归时，我们的目标是确定:</p><blockquote class="nl nm nn"><p id="e94c" class="jq jr ko js b jt ju jv jw jx jy jz ka no kc kd ke np kg kh ki nq kk kl km kn im bi translated">Y=β。X+c+e</p></blockquote><p id="f8dc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这样我们就可以<em class="ko">精确地</em>确定系数<em class="ko"> β </em>的大小(因此我们的处理效果)和<em class="ko"> e </em>(因此我们可以确定其显著性)。</p><p id="50b6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们用一个实例来演示回归是如何工作的。首先，让我们定义我们的关系(目的是从回归结果中恢复这些值):</p><ul class=""><li id="965d" class="kq kr it js b jt ju jx jy kb ks kf kt kj ku kn kv kw kx ky bi translated">截距= 10</li><li id="90e7" class="kq kr it js b jt kz jx la kb lb kf lc kj ld kn kv kw kx ky bi">β = 2</li><li id="cf5b" class="kq kr it js b jt kz jx la kb lb kf lc kj ld kn kv kw kx ky bi translated">误差项= 3</li></ul><p id="f52b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，我们将基于该等式模拟 200 个独立值:</p><pre class="nr ns nt nu gt nv mr nw nx aw ny bi"><span id="18e8" class="nz lm it mr b gy oa ob l oc od">set.seed(111)<br/>ex1 &lt;- data.frame("Xvals"=runif(1:200, min=1,max=10) )<br/>ex1$Yvals = 10 + 2*ex1$Xvals + rnorm(200,0,3) <em class="ko"># y = \beta . X +c +e</em><br/><br/>head(ex1[c("Xvals","Yvals")])</span></pre><p id="8077" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">屈服:</p><pre class="nr ns nt nu gt nv mr nw nx aw ny bi"><span id="14e7" class="nz lm it mr b gy oa ob l oc od">##      Xvals    Yvals<br/>## 1 6.336832 24.47252<br/>## 2 7.538330 21.59567<br/>## 3 4.333798 19.98488<br/>## 4 5.634314 21.88319<br/>## 5 4.398969 16.70039<br/>## 6 4.765036 16.75019</span></pre><p id="926b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在让我们将 Xvals 回归到 Yvals，来问:“Xvals 和 Yvals 之间有什么关联？”。</p><pre class="nr ns nt nu gt nv mr nw nx aw ny bi"><span id="2b64" class="nz lm it mr b gy oa ob l oc od">exreg1 &lt;- lm(Yvals~Xvals, data=ex1)</span></pre><p id="1d78" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">由于我们的回归相对简单，只有一个独立变量，我们可以很容易地用一个简单的图来显示结果:</p><figure class="nr ns nt nu gt of gh gi paragraph-image"><div role="button" tabindex="0" class="og oh di oi bf oj"><div class="gh gi oe"><img src="../Images/4a2fc62189364f17e10544591d9ffd57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d7Vr1mA9RDqHIgst5HRXcA.png"/></div></div></figure><p id="223c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们可以看到黑线很好地描述了<code class="fe mo mp mq mr b">Xvals</code>和<code class="fe mo mp mq mr b">Yvals</code>之间的关系。还要注意，蓝点距离回归线相对等距离；这是我们在回归分析中非常关心的事情。从每个点(蓝色)到模型(黑线)的距离称为<em class="ko">残差</em>，我们将这些收集在一起(pl。<em class="ko">残差</em>)来了解我们的模型性能(下图)。</p><p id="85a3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在分析模型残差之前，让我们快速检查一下回归总结:</p><figure class="nr ns nt nu gt of gh gi paragraph-image"><div role="button" tabindex="0" class="og oh di oi bf oj"><div class="gh gi om"><img src="../Images/01f78a4aa9555cd29f2cd2ee15499348.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_G6MLa77vj9FI500OJtVMA.png"/></div></div></figure><p id="7bf6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在继续之前，让我们回顾一下这些术语的含义:</p><ul class=""><li id="9eab" class="kq kr it js b jt ju jx jy kb ks kf kt kj ku kn kv kw kx ky bi translated"><strong class="js iu"> P 值</strong>:<a class="ae kp" href="http://blog.minitab.com/blog/adventures-in-statistics-2/how-to-interpret-regression-analysis-results-p-values-and-coefficients" rel="noopener ugc nofollow" target="_blank">P 值</a>来源于检验零假设<em class="ko">系数= 0 </em>。如果 p 值低于某个阈值(通常为 0.05)，那么我们<em class="ko">拒绝零假设</em>并将结果称为“显著”。注意，统计学中的显著性是指“可靠”之类的意思。因此，系数可能非常小，但仍具有统计学意义(可靠)。</li><li id="81c0" class="kq kr it js b jt kz jx la kb lb kf lc kj ld kn kv kw kx ky bi translated"><strong class="js iu">系数</strong>:当所有其他预测因子保持不变时，每个<a class="ae kp" href="http://support.minitab.com/en-us/minitab-express/1/help-and-how-to/modeling-statistics/regression/supporting-topics/regression-models/what-is-a-regression-coefficient/" rel="noopener ugc nofollow" target="_blank">系数</a>估计 X 中每单位增加的平均响应的变化。</li><li id="e09d" class="kq kr it js b jt kz jx la kb lb kf lc kj ld kn kv kw kx ky bi translated"><strong class="js iu">常数</strong>:我们方程中的截距项。</li><li id="ca4e" class="kq kr it js b jt kz jx la kb lb kf lc kj ld kn kv kw kx ky bi translated"><strong class="js iu">观察值</strong>:数据帧中的行数。</li><li id="d0af" class="kq kr it js b jt kz jx la kb lb kf lc kj ld kn kv kw kx ky bi translated">R^2 <a class="ae kp" href="http://blog.minitab.com/blog/adventures-in-statistics-2/regression-analysis-how-do-i-interpret-r-squared-and-assess-the-goodness-of-fit" rel="noopener ugc nofollow" target="_blank"> R 平方</a>是数据与拟合回归线接近程度的统计度量。它也被称为决定系数，或多元回归的多重决定系数。r 平方=解释偏差/总偏差。r 平方不能确定系数估计和预测是否有偏差，这就是为什么您必须评估残差图。r 平方并不表示回归模型是否合适。对于好的模型，可以使用低 R 平方值，对于不符合数据的模型，可以使用高 R 平方值！</li><li id="4d4b" class="kq kr it js b jt kz jx la kb lb kf lc kj ld kn kv kw kx ky bi translated"><strong class="js iu">调整后的 r^2</strong><a class="ae kp" href="http://blog.minitab.com/blog/adventures-in-statistics-2/multiple-regession-analysis-use-adjusted-r-squared-and-predicted-r-squared-to-include-the-correct-number-of-variables" rel="noopener ugc nofollow" target="_blank">调整后的 r 平方</a>比较包含不同数量预测因子的回归模型的解释能力。调整后的 R-squared 是 R-squared 的修改版本，已针对模型中的预测因子数量进行了调整。只有当新项对模型的改善程度超过偶然情况下的预期时，调整后的 R 平方才会增加。当预测者偶然对模型的改进小于预期时，它会减少。调整后的 R 平方可以是负值，但通常不是。它总是低于 R 的平方。</li><li id="b5e2" class="kq kr it js b jt kz jx la kb lb kf lc kj ld kn kv kw kx ky bi translated"><strong class="js iu"> F 统计量</strong>变量的加入是否整体上改善了回归模型？F 统计报告了零假设，即<em class="ko">我们当前的模型与仅截距模型</em>无法区分。拒绝这一假设(p &lt; 0.05)表明包含变量是有帮助的。</li></ul><p id="aa22" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们可以看到，我们很好地恢复了截距和系数项(加上一些与误差项成比例的置信区间):</p><ul class=""><li id="bae9" class="kq kr it js b jt ju jx jy kb ks kf kt kj ku kn kv kw kx ky bi translated"><em class="ko">截距</em> = 9.79</li><li id="8b35" class="kq kr it js b jt kz jx la kb lb kf lc kj ld kn kv kw kx ky bi">β = 2.07</li></ul><p id="109a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">接下来，让我们检查诊断图，以评估模型如何满足我们上面陈述的假设:</p><figure class="nr ns nt nu gt of gh gi paragraph-image"><div role="button" tabindex="0" class="og oh di oi bf oj"><div class="gh gi oe"><img src="../Images/aae3cb64652755977fbc42c8d9db8611.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RQx1CltvuKyH3b1oT5_E8A.png"/></div></div></figure><p id="c686" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们一个接一个地分析这些情节:</p><figure class="nr ns nt nu gt of gh gi paragraph-image"><div role="button" tabindex="0" class="og oh di oi bf oj"><div class="gh gi oe"><img src="../Images/49b03b1de788514640bc2717113399ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aSuBRL7UE9b1RFstWOdxbQ.png"/></div></div></figure><ul class=""><li id="2486" class="kq kr it js b jt ju jx jy kb ks kf kt kj ku kn kv kw kx ky bi translated">该图显示了模型残差与拟合值。理想情况下，我们希望残差在 0 处的黑色虚线周围均匀分布。红线表示平均残值，理想情况下位于 0.0 黑线上</li><li id="39f0" class="kq kr it js b jt kz jx la kb lb kf lc kj ld kn kv kw kx ky bi translated">不平坦的红线表示我们的数据可能是非线性的(使用上面的“Xvals vs Yvals”图，思考这是为什么)。</li><li id="f85b" class="kq kr it js b jt kz jx la kb lb kf lc kj ld kn kv kw kx ky bi translated">在 0.0 线周围具有不均匀或不对称散布的点代表异方差或非线性(再次思考为什么会这样)。</li></ul><figure class="nr ns nt nu gt of gh gi paragraph-image"><div role="button" tabindex="0" class="og oh di oi bf oj"><div class="gh gi oe"><img src="../Images/45ca17136bcf5f44d884b07c5970b03e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-U5LTXrOO9ZqpONYh-05Mw.png"/></div></div></figure><ul class=""><li id="ea2f" class="kq kr it js b jt ju jx jy kb ks kf kt kj ku kn kv kw kx ky bi translated">这是残差的 QQ 图。趋势偏离对角线(代表完全正态)表明我们的残差是非正态的(更多信息参见<a class="ae kp" href="https://michael-bar.github.io/AMP-lessons/AMP-1-distributions.html#" rel="noopener ugc nofollow" target="_blank"> AMP 第 1 课</a>)。我们在这里看不到残差的任何趋势(高低 X 处的分散较小且不明显，因为它不构成趋势)。</li></ul><figure class="nr ns nt nu gt of gh gi paragraph-image"><div role="button" tabindex="0" class="og oh di oi bf oj"><div class="gh gi oe"><img src="../Images/d4d370d1ee53dbfc22c5c48d1e3f5b19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-ClTz2JQNVQXGxuzj7sWhg.png"/></div></div></figure><ul class=""><li id="e8cc" class="kq kr it js b jt ju jx jy kb ks kf kt kj ku kn kv kw kx ky bi translated">比例-位置图显示了作为拟合值函数的标准化残差的平方根。这类似于我们上面的残差与拟合图，应该以类似的方式解释。</li></ul><figure class="nr ns nt nu gt of gh gi paragraph-image"><div role="button" tabindex="0" class="og oh di oi bf oj"><div class="gh gi oe"><img src="../Images/c52c4b50768466dd350287b7cd60203b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LWumkI37YKNwtE4ieV2Sig.png"/></div></div></figure><ul class=""><li id="f0e0" class="kq kr it js b jt ju jx jy kb ks kf kt kj ku kn kv kw kx ky bi translated">最后，杠杆图测量每个点对我们最终产出的影响与该点的剩余。本质上，这个图表将帮助我们发现对我们的模型有巨大影响的数据点。如果一些点具有高杠杆<em class="ko">和</em>高(绝对)残值，那么它们将比其他数据点更多地扭曲我们的模型。库克距离(虚线)是一个结合了剩余规模和杠杆的度量。</li><li id="0ef3" class="kq kr it js b jt kz jx la kb lb kf lc kj ld kn kv kw kx ky bi translated">请注意，我们在上面没有看到任何库克的距离线，因为我们的库克值太小了(这是一件好事！)</li></ul><p id="7cd5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">总的来说，这些图看起来很合理，我很高兴我们满足了线性模型的要求。</p><p id="abb4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">总之，这种回归看起来非常有效:</p><ul class=""><li id="45a9" class="kq kr it js b jt ju jx jy kb ks kf kt kj ku kn kv kw kx ky bi translated">残差与拟合图显示了一条平坦的直线，并且在残差中没有明显的模式</li><li id="a7c1" class="kq kr it js b jt kz jx la kb lb kf lc kj ld kn kv kw kx ky bi translated">残差的 QQ 图看起来也很合理。虽然我们可以从虚线上看到一些偏差，但这些并不是我所说的“趋势偏差”。我们可以对残差进行夏皮罗检验来证实这一点(p= 0.2613)，但一般来说，我建议简单地检查 QQ 图，而不是重复进行假设检验。</li><li id="54d3" class="kq kr it js b jt kz jx la kb lb kf lc kj ld kn kv kw kx ky bi translated">我们的比例-位置图同样是平坦的，没有模式</li><li id="511b" class="kq kr it js b jt kz jx la kb lb kf lc kj ld kn kv kw kx ky bi translated">我们的残差与杠杆图没有显示任何明显的异常值。</li></ul></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><h1 id="605d" class="ll lm it bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">理论:非线性关系</h1><p id="3ddb" class="pw-post-body-paragraph jq jr it js b jt mj jv jw jx mk jz ka kb ml kd ke kf mm kh ki kj mn kl km kn im bi translated">现在让我们来看一个表现不佳的回归，具体来说，我们将检查由非线性关系产生的诊断图，并将它们与上面的图进行比较:</p><figure class="nr ns nt nu gt of gh gi paragraph-image"><div role="button" tabindex="0" class="og oh di oi bf oj"><div class="gh gi oe"><img src="../Images/670e931c94e8b152b3bf1277cda4ea1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8wkvaeUsI8ZVn8yrle5xog.png"/></div></div></figure><p id="b383" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">嗯，很明显，我们已经尝试用线性模型来拟合非线性关系了！因此，这个模型是无用的(记住我们在本节开始时对好模型的定义)。请注意，虽然我们可以清楚地看到我们的模型很糟糕(即，在给定一组 x 的情况下，它在预测 Ys 方面做得不好)，但我们仍然能够实现 0.856 的巨大 R 平方。不要盲目追随 R-squared 而被遗忘！</p><p id="42dc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们看看诊断图:</p><figure class="nr ns nt nu gt of gh gi paragraph-image"><div role="button" tabindex="0" class="og oh di oi bf oj"><div class="gh gi oe"><img src="../Images/2862e1f6958c2dd221dc1fd67e257475.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pzcK6K_PPDsZm-0yWd90Og.png"/></div></div></figure><p id="9559" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">将这些图与表现良好的回归图进行比较，以了解它们在非理想条件下如何变化。同样，花一些时间尝试理解这些图与上面简单的 X-Y 图的关系。</p><p id="86ef" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">例如:</p><ul class=""><li id="4e8b" class="kq kr it js b jt ju jx jy kb ks kf kt kj ku kn kv kw kx ky bi translated">我们可以注意到，在残差与拟合图中，我们的残差与零相交两次，我们的回归线也与非线性数据点趋势相交两次。</li><li id="f19f" class="kq kr it js b jt kz jx la kb lb kf lc kj ld kn kv kw kx ky bi translated">同样，我们的比例位置图</li><li id="6f45" class="kq kr it js b jt kz jx la kb lb kf lc kj ld kn kv kw kx ky bi translated">还要注意我们的残差与杠杆图，我们清楚地看到了一个更高杠杆和更高残差的趋势(因为我们的数据点离我们的趋势线越来越远)</li></ul><p id="8e54" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果我们更仔细地检查我们的 QQplot:</p><figure class="nr ns nt nu gt of gh gi paragraph-image"><div role="button" tabindex="0" class="og oh di oi bf oj"><div class="gh gi oe"><img src="../Images/44d7255178e94c053f8cba2fd7779066.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NGqbrCS1_1Va2M8Qna-W3g.png"/></div></div></figure><ul class=""><li id="1f98" class="kq kr it js b jt ju jx jy kb ks kf kt kj ku kn kv kw kx ky bi translated">我们会注意到，我们的残差图总结了我们在 Xvar、Yvar 图中看到的内容。在 X 的极值处，我们倾向于偏离拟合线。</li></ul><p id="edd6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">花一些时间检查这些图中的关系，以提高你快速诊断违反了哪个线性模型假设的能力。</strong></p><h1 id="d636" class="ll lm it bd ln lo nd lq lr ls ne lu lv lw ni ly lz ma nj mc md me nk mg mh mi bi translated">理论:表现不佳的回归，异方差数据</h1><p id="81e9" class="pw-post-body-paragraph jq jr it js b jt mj jv jw jx mk jz ka kb ml kd ke kf mm kh ki kj mn kl km kn im bi translated">最后，让我们看看极端异方差是什么样子的(记住:异方差是当我们的误差项依赖于 X 时):</p><figure class="nr ns nt nu gt of gh gi paragraph-image"><div role="button" tabindex="0" class="og oh di oi bf oj"><div class="gh gi oe"><img src="../Images/2c0300d2731bbd17b1748df4e868e2f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a5bBaHsYqBN1A4gYhXvD8w.png"/></div></div></figure><p id="81cb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">注意锥形数据表明异方差。</p><figure class="nr ns nt nu gt of gh gi paragraph-image"><div role="button" tabindex="0" class="og oh di oi bf oj"><div class="gh gi oe"><img src="../Images/771075e886903c6254a2e9b233af1d72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XoyWx98zNwiYAuI0MRAB0Q.png"/></div></div></figure><p id="07f2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">同样，将其与我们表现良好的回归进行比较，以了解异方差数据如何出现在回归图中(提示:仔细检查残差与拟合图，以及尺度位置图)。</p><p id="92dd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">记住——在一个多因素的真实回归分析中，你不会有一个简单的 Xvar-Yvar 回归图来轻松地诊断你的模型，所以你需要习惯于单独使用这些诊断！</strong></p><p id="e60b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最后，我想介绍一个图，它不是由 R 自动生成的，但是在回归诊断中非常有用。在此图中，我们将绘制拟合值与真实(观察)值的对比图，以了解模型的表现，让我们为上述回归示例绘制这些图表:</p><figure class="nr ns nt nu gt of gh gi paragraph-image"><div role="button" tabindex="0" class="og oh di oi bf oj"><div class="gh gi oe"><img src="../Images/1d8ca085b998fe84b44a32e977f32b53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S4qIFNquf0vtmHLEIuT0iQ.png"/></div></div></figure><p id="a056" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">花些时间检查和理解这些图，以及这些模型如何与我们上面概述的标准进行比较:</p><ul class=""><li id="b5da" class="kq kr it js b jt ju jx jy kb ks kf kt kj ku kn kv kw kx ky bi translated">模型能够解释低 Y 值和高 Y 值</li><li id="50ba" class="kq kr it js b jt kz jx la kb lb kf lc kj ld kn kv kw kx ky bi translated">模型可以准确地提供置信区间，以告知我们对可变性(和显著性)的理解</li><li id="95d1" class="kq kr it js b jt kz jx la kb lb kf lc kj ld kn kv kw kx ky bi translated">异常值不会扭曲模型</li><li id="985e" class="kq kr it js b jt kz jx la kb lb kf lc kj ld kn kv kw kx ky bi translated">给定一组 x，我们的模型可以准确地预测 Ys</li></ul></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><h1 id="7aca" class="ll lm it bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">理论:数据转换</h1><p id="1296" class="pw-post-body-paragraph jq jr it js b jt mj jv jw jx mk jz ka kb ml kd ke kf mm kh ki kj mn kl km kn im bi translated">改进回归诊断图的方法之一是转换数据。一般来说，要么 X 变量，要么 Y 变量都会被转换。我们将在这里集中讨论 Y 变量转换，因为它们更常用。</p><p id="c736" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">常见的 y 变换包括:</p><ul class=""><li id="a203" class="kq kr it js b jt ju jx jy kb ks kf kt kj ku kn kv kw kx ky bi translated">ln 或 log10 转换</li><li id="c15c" class="kq kr it js b jt kz jx la kb lb kf lc kj ld kn kv kw kx ky bi translated">简单的幂变换(平方根或平方)</li></ul><p id="6fa6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">通常假设，当 y 变量被转换时，我们可以简单地对模型系数进行反向转换(即，应用反函数)以使其可解释。</p><p id="1be9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">这是不对的！用以更复杂的方式改变系数来转换 y 变量！</strong></p><p id="2105" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">通常，对 y 变换数据的系数进行反向变换需要求解复杂的微分方程(这里有一个明显的例外，将在本课的后面讲述)，并且不像反向变换那样简单。让我们通过返回到我们表现良好的回归来证明这一点:</p><figure class="nr ns nt nu gt of gh gi paragraph-image"><div role="button" tabindex="0" class="og oh di oi bf oj"><div class="gh gi on"><img src="../Images/27dddaa71a83f1143008a08f22e5c808.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8Hv_helCGzWade6D5MZWgQ.png"/></div></div></figure><p id="16b0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">还记得我们计算 Y 使得 Y=10+2βX+eY=10+2βX+e(其中 e 是我们的误差项)。我们可以看到这种回归很好地将这个反馈给了我们。</p><p id="873d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">相反，让我们回归 Y 的平方根，我们可以看到我们的诊断图看起来仍然合理:</p><figure class="nr ns nt nu gt of gh gi paragraph-image"><div role="button" tabindex="0" class="og oh di oi bf oj"><div class="gh gi oe"><img src="../Images/40f12a3346bbcf3277267096f75b686a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sDeDwyyLekkTsq5_m-3HZA.png"/></div></div></figure><p id="97eb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们的系数是:</p><figure class="nr ns nt nu gt of gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/324883946f9fa18aead8c726b8a4a24c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1284/format:webp/1*E0mCp7uA-Kdzzjqt5j8x_g.png"/></div></figure><p id="1336" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这次我们得到的截距是 3.079，β是 0.253。如果我们平方这些(平方是平方根的倒数)，那么我们得到:</p><ul class=""><li id="830f" class="kq kr it js b jt ju jx jy kb ks kf kt kj ku kn kv kw kx ky bi translated">截距= 9.48</li><li id="5bf3" class="kq kr it js b jt kz jx la kb lb kf lc kj ld kn kv kw kx ky bi translated">Xvals = 0.064</li></ul><p id="5629" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">显然，这些与原始公式或原始回归都没有关系！</p><p id="5c27" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果变换变量是必要的，那么选择一个保留一些物理意义的变换是明智的。例如求面积的平方根(这将产生长度)。转换的一个重要危险是在数据中引入新的责难，例如，将“客户支出(美元)的变化”平方会使<em class="ko">所有</em>数据为正，从而使模型解释变得不可能。</p><p id="f107" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这些转换的一个显著的例外是自然对数(在 r: <code class="fe mo mp mq mr b">log()</code>中)。当 Y 数据进行对数变换时，系数可以解释为 x 增加一个单位时 Y 的预期变化百分比。</p><h2 id="a0f1" class="nz lm it bd ln op oq dn lr or os dp lv kb ot ou lz kf ov ow md kj ox oy mh oz bi translated">摘要</h2><ul class=""><li id="0aa5" class="kq kr it js b jt mj jx mk kb pa kf pb kj pc kn kv kw kx ky bi translated">不要盲目的变换和反变换数据！</li><li id="596e" class="kq kr it js b jt kz jx la kb lb kf lc kj ld kn kv kw kx ky bi translated">转换后的数据通常会产生无法解释的系数(没有求解适当的方程)</li><li id="16c3" class="kq kr it js b jt kz jx la kb lb kf lc kj ld kn kv kw kx ky bi translated">自然对数转换是这个规则的一个重要例外。ln 变换产生系数，其中 X 增加一个单位，y 增加β÷100β÷100。</li></ul><h1 id="46c8" class="ll lm it bd ln lo nd lq lr ls ne lu lv lw ni ly lz ma nj mc md me nk mg mh mi bi translated">帖子摘要:</h1><ul class=""><li id="8492" class="kq kr it js b jt mj jx mk kb pa kf pb kj pc kn kv kw kx ky bi translated">回归有一些假设，必须满足这些假设才能产生有意义的结果和良好的预测。</li><li id="ae0a" class="kq kr it js b jt kz jx la kb lb kf lc kj ld kn kv kw kx ky bi translated">诊断图将允许您评估您的模型满足这些假设的程度。</li><li id="7cc9" class="kq kr it js b jt kz jx la kb lb kf lc kj ld kn kv kw kx ky bi translated">数据的转换需要仔细考虑。</li><li id="c6d2" class="kq kr it js b jt kz jx la kb lb kf lc kj ld kn kv kw kx ky bi translated">始终为您创建的任何模型提供诊断图！您可以将这些内容放在文档/演示文稿末尾的附录中。</li></ul></div></div>    
</body>
</html>