<html>
<head>
<title>Why UMAP is Superior over tSNE</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为什么 UMAP 优于多伦多</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/why-umap-is-superior-over-tsne-faa039c28e99?source=collection_archive---------5-----------------------#2019-12-31">https://towardsdatascience.com/why-umap-is-superior-over-tsne-faa039c28e99?source=collection_archive---------5-----------------------#2019-12-31</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="c6ba" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsdatascience.com/tagged/stats-ml-life-sciences" rel="noopener" target="_blank">生命科学的数理统计和机器学习</a></h2><div class=""/><div class=""><h2 id="9e44" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">初始化真的很重要吗？</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/d11714fdd1d5e861083af99ee863fe05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aup0pbVzE5aOLRTSuGeWCQ.png"/></div></div></figure><p id="db8b" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">这是来自<a class="ae lz" href="https://towardsdatascience.com/tagged/stats-ml-life-sciences?source=post_page---------------------------" rel="noopener" target="_blank"> <strong class="lf jd">生命科学的数理统计和机器学习</strong> </a>专栏的第十四篇帖子，在这里我试图以简单的方式解释<strong class="lf jd"/>一些在生物信息学、生物医学、遗传学等领域使用的神秘分析技术。在我之前的文章<a class="ae lz" rel="noopener" target="_blank" href="/how-exactly-umap-works-13e3040e1668"> <strong class="lf jd">中，UMAP 到底是如何工作的</strong> </a>和<a class="ae lz" rel="noopener" target="_blank" href="/how-to-program-umap-from-scratch-e6eff67f55fe"> <strong class="lf jd">如何从头开始为 UMAP 编程</strong> </a>中，我解释了<strong class="lf jd">tSNE 的局限性</strong>以及<strong class="lf jd"> UMAP 克服它们的方式</strong>。从我收到的反馈来看，这些帖子的主要信息似乎没有得到足够的强调。所以在这里我想再次强调一下 tSNE 的<strong class="lf jd">关键问题，即<strong class="lf jd"> Kullback-Leibler (KL)散度</strong>，并检验一下<a class="ae lz" href="https://www.biorxiv.org/content/10.1101/2019.12.19.877522v1.full.pdf" rel="noopener ugc nofollow" target="_blank">最近关于<strong class="lf jd">初始化</strong>影响 tSNE 和 UMAP 降维的假设</a>。</strong></p><h1 id="7ec3" class="ma mb it bd mc md me mf mg mh mi mj mk ki ml kj mm kl mn km mo ko mp kp mq mr bi translated">KL-散度作为 tSNE 问题的根源</h1><p id="1f2c" class="pw-post-body-paragraph ld le it lf b lg ms kd li lj mt kg ll lm mu lo lp lq mv ls lt lu mw lw lx ly im bi translated">如果你试图理解 tSNE 和 UMAP 之间的区别，你在阅读<a class="ae lz" href="https://arxiv.org/abs/1802.03426" rel="noopener ugc nofollow" target="_blank"> UMAP 论文</a>时注意到的第一件事是，UMAP 使用<strong class="lf jd">图拉普拉斯</strong>进行初始化，而 tSNE 默认实现<strong class="lf jd">随机初始化</strong>。因此，如果你是一个好侦探，你会忍不住说，正是非随机初始化使 UMAP 优于 tSNE。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi mx"><img src="../Images/32983fee9afe4098e1c1bad1d00ab746.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HJE0jaKO6w8UZk0MZC9KnA.png"/></div></div></figure><p id="d954" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">我们将检查下面几个真实世界单细胞 RNAseq (scRNAseq)数据集的初始化假设。然而，首先我想简单回顾一下为什么优化 KL-divergence 会使 tSNE <strong class="lf jd">在执行降维时无法保持全局距离</strong>。通过简单地<strong class="lf jd">绘制</strong>tSNE(KL-散度)和<strong class="lf jd"> UMAP(交叉熵(CE)) </strong>的成本函数，下面，我们可以观察到，在高维度的点之间的<strong class="lf jd">大距离</strong>，X，低维度的点之间的距离 Y<strong class="lf jd">在 KL 损失的意义上不能保证大</strong>。相比之下，在 Y 很小的情况下，X 很大会导致巨大的交叉熵(CE)损失。因此，UMAP 对成本函数的<strong class="lf jd">更明智的选择确实确保了高维空间中彼此远离的点在低维空间中仍然远离。</strong></p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi my"><img src="../Images/fd3ed16e19babac3e50739eda2352231.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yggWUCWHDjAdhb6VQ_Rejg.png"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk">Kullback-Leibler (KL) divergence cost function of tSNE, X is the distance between points in high dimensions, Y is the distance between points in low dimensions</figcaption></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nd"><img src="../Images/420a8dbd09b382d864d61d419629e922.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3XAahUxR6Eo8SqJb3ZtSzA.png"/></div></div><figcaption class="mz na gj gh gi nb nc bd b be z dk">Cross-Entropy (CE) cost function of UMAP, X is the distance between points in high dimensions, Y is the distance between points in low dimensions</figcaption></figure><p id="00e2" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">我在之前的文章中详细解释了 tSNE 和 UMAP 在成本函数上的主要差异<a class="ae lz" rel="noopener" target="_blank" href="/how-exactly-umap-works-13e3040e1668">UMAP 到底是如何工作的</a>。tSNE 更好地保持全局距离的唯一方法是远远超出推荐的(从 5 到 50)困惑值范围。然而，这是<strong class="lf jd">计算上昂贵的</strong>，并且仍然不能保证全局距离保持，因为你永远不能确定在下面的等式中观察距离 X 处的点的概率的困惑度或者<strong class="lf jd"> <em class="ne"> σ </em>参数</strong>，<strong class="lf jd">比 X </strong>更快地达到无穷大。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/ef5f4120e7a5bb21bb57c817a11d78eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:902/format:webp/1*svrNVnpkRuCUBfYfwfQs-A.png"/></div></figure><p id="70f6" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">再次检查<a class="ae lz" rel="noopener" target="_blank" href="/how-exactly-umap-works-13e3040e1668">UMAP 到底是如何工作的</a>以获得详细信息。如果你真的想对一个数据集进行大规模的复杂测试，比如 100 万个单元，其中大规模的复杂测试对于解析全局结构变得特别重要，并且你想达到 500-1000 的复杂测试，你最好至少有 1TB 的 RAM，并且耐心等待几天。我之前在《单细胞生物学的深度学习》一文中描述了达到大型困惑的计算挑战，在该文中，我从未能够在具有 512 TB RAM 的 HPC 集群节点上对 1.3M 细胞数据集达到困惑= 500。在这里我想再次强调</p><blockquote class="ng"><p id="9c6c" class="nh ni it bd nj nk nl nm nn no np ly dk translated">只要 tSNE 使用 KL-divergence 作为代价函数，它就不能在全局距离保持上与 UMAP 竞争</p></blockquote><p id="83fd" class="pw-post-body-paragraph ld le it lf b lg nq kd li lj nr kg ll lm ns lo lp lq nt ls lt lu nu lw lx ly im bi translated">然而，如果 tSNE 使用另一个更智能的成本函数，它就不再是 tSNE 了，不是吗？</p><h1 id="d355" class="ma mb it bd mc md me mf mg mh mi mj mk ki ml kj mm kl mn km mo ko mp kp mq mr bi translated">tSNE:不同的初始化场景</h1><p id="52b0" class="pw-post-body-paragraph ld le it lf b lg ms kd li lj mt kg ll lm mu lo lp lq mv ls lt lu mw lw lx ly im bi translated">这里，我们将检查随机、主成分分析(PCA)和拉普拉斯特征映射(即，图拉普拉斯)初始化是否以及如何影响 tSNE 维数缩减图。为此，我将利用我以前的帖子<a class="ae lz" rel="noopener" target="_blank" href="/how-to-cluster-in-high-dimensions-4ef693bacc6">如何在高维空间中聚类</a>和<a class="ae lz" rel="noopener" target="_blank" href="/how-to-tune-hyperparameters-of-tsne-7c0596a18868">如何调整 tSNE 的超参数</a>中的几个 scRNAseq 数据集，在这些帖子中，我展示了选择最佳困惑、主成分(PC)数量的一些规则，以及适用于<strong class="lf jd">特定 scRNAseq 数据集</strong>的聚类算法。这里，我们将循环读取 scRNAseq 数据集，计算 PCA 和拉普拉斯特征映射，如下所示</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="6069" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">并使用上述前两篇文章中确定的聚类结果(单元格着色)和最佳超参数(<strong class="lf jd"> optPerp </strong>和<strong class="lf jd"> optPC </strong>)来计算不同初始化场景的 tSNE 图。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="8f53" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">为随机、PCA 和拉普拉斯特征映射初始化的几个 scRNAseq 数据集计算的 tSNE 降维图如下所示。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nx"><img src="../Images/13a25cfac2dfdd8040d77b41394ae3e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X0QE5lWkNFDfAORJFTPJew.png"/></div></div></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ny"><img src="../Images/5639d7ffbc54e9377108b542ccc3f4c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nzqL2gWMmAJ8bHzQ-UdMgQ.png"/></div></div></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nx"><img src="../Images/34f689b3ebabfcd33a92184060f4efac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m-iWQNuo8YBCP4VYNhHJNQ.png"/></div></div></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nz"><img src="../Images/1e3ee50f1e75f7d21fae5fd386025073.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hCzupZIpVWv7-I9htMZmDA.png"/></div></div></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oa"><img src="../Images/9b3c0c3a7df82abba7fd02a36ca3e291.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rPffRb-pNbz3GR_epJ1xxA.png"/></div></div></figure><p id="bc4f" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">我个人没有观察到不同初始化场景之间的 tSNE 降维图有太大的差异。然而，考虑到上面描述的 KL-divergence 的<strong class="lf jd">单调</strong>函数形式，我期望<strong class="lf jd">给定足够的时间/迭代用于训练</strong>，tSNE 算法应该对初始化条件不敏感。换句话说，如果你从 PCA 初始化开始，并且<strong class="lf jd">过早地中断 tSNE</strong>，它将仍然类似于 PCA，因此保留了许多全局结构。然而，如果你继续训练 tSNE，<strong class="lf jd">KL-divergence</strong>对全局距离保持的损害将越来越明显，并最终克服“良好”初始化的积极影响。</p><h1 id="5984" class="ma mb it bd mc md me mf mg mh mi mj mk ki ml kj mm kl mn km mo ko mp kp mq mr bi translated">UMAP:不同的初始化场景</h1><p id="f8af" class="pw-post-body-paragraph ld le it lf b lg ms kd li lj mt kg ll lm mu lo lp lq mv ls lt lu mw lw lx ly im bi translated">在这里，我们将在 scRNAseq 数据集上重复相同的循环，但针对不同的初始化场景绘制 UMAP 降维图。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nv nw l"/></div></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ob"><img src="../Images/d2f9d15f165995c843e12af8621a7f49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Gqn3Lxfm594XwS0vnpACQQ.png"/></div></div></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oc"><img src="../Images/5a9df0a38cbcdfc44fe269361d9a0eb6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_7DloF5DcLgnNH0gp9AlWA.png"/></div></div></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi od"><img src="../Images/07e236fc95f802dbae445a21934fa43c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WCK9o5wNZQvDS2D2diSkjQ.png"/></div></div></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi od"><img src="../Images/341184eec529e0ec3563fee9032d78b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rHeAGxbZ-LD9jW6yXDbZmA.png"/></div></div></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oe"><img src="../Images/a59ad5592ce4357002ddcf0087b08012.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_x2NmLgTM7wq6NwbApJi2Q.png"/></div></div></figure><p id="9f41" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">同样，不同初始化场景的 UMAP 降维图的差异<strong class="lf jd">不明显</strong>。我们可以观察到，有时 UMAP 情节会导致<strong class="lf jd">【太多空白】</strong>。然而，这实际上对于集群来说是极好的。几乎任何聚类算法都能够将分离良好的密集数据点“滴”识别为聚类。因此，在 2D UMAP 图上使用基于密度的聚类算法，如<strong class="lf jd"> HDBSCAN，似乎很简单。在数据的<strong class="lf jd">固有</strong>维度不是 2 的情况下，仍然可以直接利用多个重要的 UMAP 分量来进行基于图的聚类，这对于高维数据是最鲁棒的。<strong class="lf jd">对重要 UMAP 成分</strong>上的</strong> scRNAseq 数据<strong class="lf jd">进行聚类<strong class="lf jd">因此应该比在大多数 scRNAseq 分析管道中实现的<a class="ae lz" href="https://satijalab.org/seurat/" rel="noopener ugc nofollow" target="_blank">当前对多个<strong class="lf jd">重要主要成分(PC)</strong>进行的</a>黄金标准聚类<a class="ae lz" href="https://satijalab.org/seurat/" rel="noopener ugc nofollow" target="_blank">更能提供</a></strong>信息。相比之下，在<strong class="lf jd">数量的 tSNE 组件</strong>上进行聚类是一项非常具有挑战性的计算任务。</strong></p><h1 id="9d99" class="ma mb it bd mc md me mf mg mh mi mj mk ki ml kj mm kl mn km mo ko mp kp mq mr bi translated">最终意见</h1><p id="8530" class="pw-post-body-paragraph ld le it lf b lg ms kd li lj mt kg ll lm mu lo lp lq mv ls lt lu mw lw lx ly im bi translated">我从之前的帖子<a class="ae lz" rel="noopener" target="_blank" href="/how-exactly-umap-works-13e3040e1668">UMAP 到底是如何工作的</a>和<a class="ae lz" rel="noopener" target="_blank" href="/how-to-program-umap-from-scratch-e6eff67f55fe">如何从零开始为 UMAP 编程</a>中收到了很多反馈，我想简单地回答几个最常见的问题。</p><ul class=""><li id="4a91" class="of og it lf b lg lh lj lk lm oh lq oi lu oj ly ok ol om on bi translated">有什么大不了的？UMAP 和 tSNE 对我们来说同样有效</li></ul><p id="fd1a" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">事实上，2D 可视化的质量在 tSNE 和 UMAP 之间是相当的。然而，这两者背后的数学是非常不同的。虽然 tSNE 纯粹是为了可视化的目的，但 UMAP 远不止于此。对于 scRNAseq 社区来说，最重要的可能是在 UMAP 组件上集群是很好的，而在 tSNE 上却不是这样。</p><ul class=""><li id="ab2b" class="of og it lf b lg lh lj lk lm oh lq oi lu oj ly ok ol om on bi translated"><strong class="lf jd">我们通常在高性能计算集群上运行 UMAP 和 tSNE，并没有看到你所说的计算挑战</strong></li></ul><p id="8ab9" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">事实上，有经验的数据科学家不会看到运行 tSNE 或 UMAP 有多大区别，这对于具有生物学背景的人来说不是这样，他们代表了 scRNAseq 社区的大多数。虽然 UMAP 可以在笔记本电脑上运行相当大的数据集，但您通常需要大量的 RAM 和 CPU，因此需要一个 HPC 集群来在这些数据集上运行 tSNE。</p><ul class=""><li id="ec9c" class="of og it lf b lg lh lj lk lm oh lq oi lu oj ly ok ol om on bi translated"><strong class="lf jd"> tSNE 实际上可以在大困惑时保持全局距离</strong></li></ul><p id="cfdc" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">理论上，是的。在实践中，对于大型数据集来说，达到大的困惑是不可行的。产生单个 tSNE 图可能需要几天和几吨 RAM，这使得基本上不可能对 tSNE 算法应用重采样过程。</p><ul class=""><li id="78e9" class="of og it lf b lg lh lj lk lm oh lq oi lu oj ly ok ol om on bi translated">你为什么对 tSNE 这么不公平？</li></ul><p id="527c" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">实际上，我是 tSNE 的忠实粉丝，认为它是一种最先进的技术，革新了数据科学的许多领域。然而，tSNE 需要应对不断增长的数据量和对更智能分析的需求，这目前受到 tSNE 算法的非常核心的假设(例如 KL-divergence)的约束。类似于为什么进化更喜欢适应度更好的个体，新数据需要适应度/成本函数更好的更灵活、更智能的降维算法，即 UMAP。</p><h1 id="73d8" class="ma mb it bd mc md me mf mg mh mi mj mk ki ml kj mm kl mn km mo ko mp kp mq mr bi translated">摘要</h1><p id="91fd" class="pw-post-body-paragraph ld le it lf b lg ms kd li lj mt kg ll lm mu lo lp lq mv ls lt lu mw lw lx ly im bi translated">在这篇文章中，我们了解到<strong class="lf jd"> KL 散度是 tSNE 算法保持全局距离的主要障碍</strong>。基于对几个 scRNAseq 数据集的检查，<strong class="lf jd">我们无法确认 tSNE 和 UMAP 降维受不同初始化场景的影响</strong>。</p><p id="6456" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">在下面的评论中让我知道生命科学中的哪些分析技术对你来说是特别神秘的，我会在以后的文章中介绍它们。检查我的<a class="ae lz" href="https://github.com/NikolayOskolkov/HowToInitializeUMAPtSNE" rel="noopener ugc nofollow" target="_blank"> github </a>上的帖子中的代码。在 Medium <a class="oo op ep" href="https://medium.com/u/8570b484f56c?source=post_page-----faa039c28e99--------------------------------" rel="noopener" target="_blank">关注我，在 Twitter @NikolayOskolkov 关注我，在 Linkedin </a>关注我。下一次，我将转向进化生物学，并展示如何利用古代 DNA 来估算种群数量，敬请关注。</p></div></div>    
</body>
</html>