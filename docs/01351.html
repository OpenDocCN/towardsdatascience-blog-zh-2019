<html>
<head>
<title>Extracting faces using OpenCV Face Detection Neural Network</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">利用 OpenCV 人脸检测神经网络提取人脸</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/extracting-faces-using-opencv-face-detection-neural-network-475c5cd0c260?source=collection_archive---------9-----------------------#2019-03-04">https://towardsdatascience.com/extracting-faces-using-opencv-face-detection-neural-network-475c5cd0c260?source=collection_archive---------9-----------------------#2019-03-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/c1e309b84e413bb3b7dc0e277bfbd64e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*25MtyqPCQCSceRx7"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@zoner?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Maxim Dužij</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="b599" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最近，我偶然发现了 https://www.pyimagesearch.com/的网站，那里有一些关于 OpenCV 的很棒的教程。在通读它的众多文章时，我发现 OpenCV 有自己的人脸检测神经网络，准确率非常高。</p><p id="d7a5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以我决定用 OpenCV 的这个神经网络做一个项目，从图像中提取人脸。每当有人处理人脸并需要从大量图像中提取人脸时，这样的过程就会很方便。</p><p id="6b48" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">完整的项目可以作为<a class="ae kc" href="https://github.com/kb22/Create-Face-Data-from-Images" rel="noopener ugc nofollow" target="_blank"> GitHub 库</a>获得。为了这篇文章，我从我的 Instagram 账户上拍了一张照片。</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lb"><img src="../Images/4042f6dcffb4561b9b53146f1c8f8b9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vnewG2OYRUij_b_zm5uNrQ.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Image used for extracting face</figcaption></figure><h1 id="91e3" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">目标</h1><p id="3648" class="pw-post-body-paragraph kd ke iq kf b kg me ki kj kk mf km kn ko mg kq kr ks mh ku kv kw mi ky kz la ij bi translated">这个项目有两个基本要素。<strong class="kf ir">包围人脸的方框:</strong>在图像中识别的所有人脸周围显示白色方框。Python 文件是<em class="mj">data _ generator . py</em>T19】2。<strong class="kf ir">提取的人脸:</strong>从一个文件夹中的所有图像中提取人脸，并将每个人脸保存到一个目标文件夹中，以创建一个方便的数据集。Python 文件是<em class="mj"> face_extractor.py </em></p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/3a2e0a298ad508ba6f404615e7ae1bb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:720/1*Ryd9J1YsNbQPgJkuG6jhSQ.gif"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Face detection and extraction</figcaption></figure><p id="fc78" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">首先，让我们执行这两个部分的共同步骤，即导入库、加载人脸检测模型、创建输出目录、读取图像和检测人脸。</p><h1 id="ac25" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">项目</h1><h2 id="2ec3" class="ml lh iq bd li mm mn dn lm mo mp dp lq ko mq mr lu ks ms mt ly kw mu mv mc mw bi translated">导入库</h2><p id="a089" class="pw-post-body-paragraph kd ke iq kf b kg me ki kj kk mf km kn ko mg kq kr ks mh ku kv kw mi ky kz la ij bi translated">我导入<code class="fe mx my mz na b">os</code>来访问目录中的各种文件。然后，<code class="fe mx my mz na b">cv2</code>将用于处理图像。<code class="fe mx my mz na b">numpy</code>有助于轻松处理多维数组。</p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="nb nc l"/></div></figure><h2 id="2bf2" class="ml lh iq bd li mm mn dn lm mo mp dp lq ko mq mr lu ks ms mt ly kw mu mv mc mw bi translated">定义路径和负载模型</h2><p id="8da8" class="pw-post-body-paragraph kd ke iq kf b kg me ki kj kk mf km kn ko mg kq kr ks mh ku kv kw mi ky kz la ij bi translated">OpenCV repo 本身提供了模型的<code class="fe mx my mz na b">prototxt</code>和<code class="fe mx my mz na b">caffemodel</code>。我使用了相同的方法，并将它们放在我的项目中的<code class="fe mx my mz na b">model_data</code>目录中。<code class="fe mx my mz na b">prototxt</code>文件包括网络的文本描述，而<code class="fe mx my mz na b">caffemodel</code>包括权重。我读取了这两个文件，并使用<code class="fe mx my mz na b">cv2</code>加载了我的<code class="fe mx my mz na b">model</code>。</p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="nb nc l"/></div></figure><h2 id="7ba5" class="ml lh iq bd li mm mn dn lm mo mp dp lq ko mq mr lu ks ms mt ly kw mu mv mc mw bi translated">创建目录</h2><p id="98c4" class="pw-post-body-paragraph kd ke iq kf b kg me ki kj kk mf km kn ko mg kq kr ks mh ku kv kw mi ky kz la ij bi translated">如果存储结果图像的目录不存在，我将创建一个目录。输出文件夹为<strong class="kf ir">更新 _ 图像</strong>。</p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="23bc" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在提取人脸时，我会将人脸保存到目录<strong class="kf ir"> faces </strong>中。如果它不存在，我将创建它。</p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="nb nc l"/></div></figure><h2 id="f04c" class="ml lh iq bd li mm mn dn lm mo mp dp lq ko mq mr lu ks ms mt ly kw mu mv mc mw bi translated">读取图像</h2><p id="1fc4" class="pw-post-body-paragraph kd ke iq kf b kg me ki kj kk mf km kn ko mg kq kr ks mh ku kv kw mi ky kz la ij bi translated">我遍历了<strong class="kf ir">图像</strong>文件夹中的所有图像。提取扩展名后，我检查文件是否属于类型<code class="fe mx my mz na b">.png</code>或<code class="fe mx my mz na b">.jpg</code>，并且只对这些文件进行操作。</p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="nb nc l"/></div></figure><h2 id="e3bd" class="ml lh iq bd li mm mn dn lm mo mp dp lq ko mq mr lu ks ms mt ly kw mu mv mc mw bi translated">检测人脸</h2><p id="45b1" class="pw-post-body-paragraph kd ke iq kf b kg me ki kj kk mf km kn ko mg kq kr ks mh ku kv kw mi ky kz la ij bi translated">使用<code class="fe mx my mz na b">cv2.imread</code>，我读取图像，并使用<code class="fe mx my mz na b">cv2.dnn.blobFromImage</code>创建一个斑点。然后，我将这个斑点输入到模型中，并使用<code class="fe mx my mz na b">model.forward()</code>从页面中获取检测结果。</p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="51e8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">通用步骤现在已经完成。对于第一个任务，我将在人脸周围绘制白色矩形，并将它们保存在<strong class="kf ir"> updated_images </strong>目录中。对于第二个任务，我将把提取的人脸保存在<strong class="kf ir"> faces </strong>目录中。</p><h2 id="2d0d" class="ml lh iq bd li mm mn dn lm mo mp dp lq ko mq mr lu ks ms mt ly kw mu mv mc mw bi translated">1.在面周围创建方框</h2><p id="ca34" class="pw-post-body-paragraph kd ke iq kf b kg me ki kj kk mf km kn ko mg kq kr ks mh ku kv kw mi ky kz la ij bi translated">我一个接一个地迭代图像中检测到的所有人脸，并提取它们的起点和终点。然后，提取检测的置信度。如果算法有超过 50%的把握检测到的是人脸，我会在它周围显示一个矩形。</p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="c8b6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，使用<code class="fe mx my mz na b">cv2.imwrite</code>，我将图像保存到同名的<code class="fe mx my mz na b">updated_images</code>文件夹中。</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lb"><img src="../Images/2136550fcccc0dd316fa6b1ef248be97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OOIj2LNRHEFD5bT-FyNbqQ.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Image with white rectangle around face</figcaption></figure><h2 id="3a56" class="ml lh iq bd li mm mn dn lm mo mp dp lq ko mq mr lu ks ms mt ly kw mu mv mc mw bi translated">2.提取人脸</h2><p id="2992" class="pw-post-body-paragraph kd ke iq kf b kg me ki kj kk mf km kn ko mg kq kr ks mh ku kv kw mi ky kz la ij bi translated">如上所述，我迭代所有人脸，计算检测的置信度，如果超过 50%，我提取人脸。注意这条线<code class="fe mx my mz na b">frame = image[startY:endY, startX:endX]</code>。它从图像中提取人脸。</p><figure class="lc ld le lf gt jr"><div class="bz fp l di"><div class="nb nc l"/></div></figure><p id="6566" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，我将这个新图像转储到<code class="fe mx my mz na b">faces</code>文件夹中，名称为 face number，后跟<code class="fe mx my mz na b">_</code>，然后是文件名。如果我们从名为<code class="fe mx my mz na b">sampleImage.png</code>的图像中提取第一张人脸，人脸文件的名称将为<code class="fe mx my mz na b">0_sampleImage.png</code>。对于每个面，我递增<code class="fe mx my mz na b">count</code>并在完成执行后，将计数打印到控制台。</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/7a3632d9c1f5adb52227db3ddee536a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:508/format:webp/1*82mRzl-khwb2hBzFi9P4vQ.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Extracted face</figcaption></figure><p id="9c54" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">终于，项目准备好了。您可以输入尽可能多的图像，并生成可用于后续项目的数据集。</p><h1 id="5c09" class="lg lh iq bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">结论</h1><p id="a98a" class="pw-post-body-paragraph kd ke iq kf b kg me ki kj kk mf km kn ko mg kq kr ks mh ku kv kw mi ky kz la ij bi translated">在本文中，我讨论了使用 OpenCV 人脸检测神经网络来检测图像中的人脸，用白色矩形标记它们，并将人脸提取到单独的图像中。</p></div><div class="ab cl ne nf hu ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="ij ik il im in"><p id="1078" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一如既往，我很想听听你的想法和建议。</p></div></div>    
</body>
</html>