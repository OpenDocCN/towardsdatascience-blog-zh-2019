<html>
<head>
<title>A quick run-through of Holt-Winters, Seasonal ARIMA and FB Prophet</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">快速浏览霍尔特-温特斯，季节性 ARIMA 和 FB 先知</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/a-quick-run-through-of-holt-winters-sarima-and-fb-prophet-c6370c6f32f1?source=collection_archive---------15-----------------------#2019-06-27">https://towardsdatascience.com/a-quick-run-through-of-holt-winters-sarima-and-fb-prophet-c6370c6f32f1?source=collection_archive---------15-----------------------#2019-06-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/c496075eaa70a2a6c60b6f64c202fa99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3iQhCF0Qe8ispQQm4nkzDw.png"/></div></div></figure><div class="kb kc gp gr kd ke"><a href="https://github.com/gianfelton/Comparing-Holt-Winters-SARIMA-and-FBProphet/blob/master/Holt%20Winters%2C%20SARIMA%20and%20FBProphet.ipynb" rel="noopener  ugc nofollow" target="_blank"><div class="kf ab fo"><div class="kg ab kh cl cj ki"><h2 class="bd iu gy z fp kj fr fs kk fu fw is bi translated">詹费尔顿/比兴-霍尔特-温特斯-萨里玛-和-FBProphet</h2><div class="kl l"><h3 class="bd b gy z fp kj fr fs kk fu fw dk translated">这是一个比较 Holt-Winters，SARIMA 和 FBProphet 输出的简单笔记本。关于参数的信息…</h3></div><div class="km l"><p class="bd b dl z fp kj fr fs kk fu fw dk translated">github.com</p></div></div><div class="kn l"><div class="ko l kp kq kr kn ks jz ke"/></div></div></a></div><p id="b92b" class="pw-post-body-paragraph kt ku it kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">上面的链接将带你到笔记本，下面的代码是从那里获得的。</p><p id="87d2" class="pw-post-body-paragraph kt ku it kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">这篇文章的目的是展示霍尔特温特斯，萨里玛和 FB 先知的快速运行。我跳过了任何关于参数调整的内容，因为这可能是多篇文章。</p><p id="c93f" class="pw-post-body-paragraph kt ku it kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">首先，让我们获得 Holt Winters 的导入，以及数据集。</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="0ff9" class="ma mb it lw b gy mc md l me mf"><strong class="lw iu">import</strong> <strong class="lw iu">numpy</strong> <strong class="lw iu">as</strong> <strong class="lw iu">np</strong><br/><strong class="lw iu">import</strong> <strong class="lw iu">pandas</strong> <strong class="lw iu">as</strong> <strong class="lw iu">pd</strong><br/><strong class="lw iu">import</strong> <strong class="lw iu">matplotlib.pyplot</strong> <strong class="lw iu">as</strong> <strong class="lw iu">plt</strong><br/><strong class="lw iu">from</strong> <strong class="lw iu">statsmodels.tsa.holtwinters</strong> <strong class="lw iu">import</strong> ExponentialSmoothing<br/>%matplotlib inline<br/><strong class="lw iu">import</strong> <strong class="lw iu">warnings</strong><br/>warnings.filterwarnings("ignore")<br/><br/>dataset = pd.read_csv('AirPassengers.csv')</span></pre><p id="3418" class="pw-post-body-paragraph kt ku it kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">数据集可以在本文开头的链接中找到。这是航空乘客的数据，在网上很容易找到。</p><p id="14ff" class="pw-post-body-paragraph kt ku it kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">看前两行就能对形状有个概念。</p><figure class="lr ls lt lu gt ju gh gi paragraph-image"><div class="gh gi mg"><img src="../Images/63597cd08b7db8226b5978b284fde95e.png" data-original-src="https://miro.medium.com/v2/resize:fit:664/format:webp/1*KmMyigH9FaD881ykeodghQ.png"/></div></figure><p id="d716" class="pw-post-body-paragraph kt ku it kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">对于我们的分析，我们需要将 Month 列放入索引中。</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="f65f" class="ma mb it lw b gy mc md l me mf">dataset['Month'] = pd.to_datetime(dataset['Month'])<br/>dataset.set_index('Month', inplace=<strong class="lw iu">True</strong>)</span></pre><p id="88bf" class="pw-post-body-paragraph kt ku it kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">这会让我们得到这个:</p><figure class="lr ls lt lu gt ju gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/02fec34a5c3b920089c1a2dd797be1fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:688/format:webp/1*eEP-0MeUcKFYAfOT_prOjA.png"/></div></figure><p id="b545" class="pw-post-body-paragraph kt ku it kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">我们需要做的下一件事是设置索引频率，并将数据集分为训练和测试。</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="581b" class="ma mb it lw b gy mc md l me mf">dataset.index.freq = 'MS'<br/>train, test = dataset.iloc[:131, 0], dataset.iloc[131:, 0]</span></pre><p id="92ad" class="pw-post-body-paragraph kt ku it kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">在这里，我们可以用训练数据创建和拟合模型。</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="92c0" class="ma mb it lw b gy mc md l me mf">model = ExponentialSmoothing(train, <br/>                             trend='add', <br/>                             damped=<strong class="lw iu">False</strong>, <br/>                             seasonal='add', <br/>                             seasonal_periods=12).fit()</span></pre><p id="1884" class="pw-post-body-paragraph kt ku it kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">模型准备好了，我们现在可以做预测了。</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="6988" class="ma mb it lw b gy mc md l me mf">holt_pred = model.predict(start=test.index[0], end=test.index[-1])</span></pre><p id="3c0d" class="pw-post-body-paragraph kt ku it kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">为了查看我们的预测，我们可以将它与训练和测试数据一起绘制出来。</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="b91d" class="ma mb it lw b gy mc md l me mf">plt.figure(figsize=(22, 10))<br/>plt.plot(train.index, train, label='Train')<br/>plt.plot(test.index, test, label='Test', color='r')<br/>plt.plot(holt_pred.index, holt_pred, label='Holt-Winters', color='k')<br/>plt.legend(loc='best', fontsize='xx-large')<br/>plt.xticks(fontsize=18)<br/>plt.yticks(fontsize=16)<br/>plt.show()</span></pre><figure class="lr ls lt lu gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mi"><img src="../Images/be6d72c826aa1fe4f69c2ab5c6f56c96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dXyc4QRcNBhvCYEk_ZFN6w.png"/></div></div></figure><p id="567a" class="pw-post-body-paragraph kt ku it kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">接下来，我们来试试萨里玛。</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="3a96" class="ma mb it lw b gy mc md l me mf"><strong class="lw iu">import</strong> <strong class="lw iu">statsmodels.api</strong> <strong class="lw iu">as</strong> <strong class="lw iu">sm</strong><br/><strong class="lw iu">import</strong> <strong class="lw iu">itertools</strong><br/><strong class="lw iu">import</strong> <strong class="lw iu">warnings</strong><br/>warnings.filterwarnings("ignore")</span></pre><p id="a184" class="pw-post-body-paragraph kt ku it kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">通常情况下，我们会区分和绘制 ACF 和 PACF，以确定我们的条款。一个人应该做这些事情，但我们将跳过这个帖子。下面是对 SARIMA 订单和 seasonal_order 进行参数搜索的函数。</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="907a" class="ma mb it lw b gy mc md l me mf"><strong class="lw iu">def</strong> find_best_sarima(train, eval_metric):<br/>    <br/>    p = d = q = range(0, 2)<br/>    pdq = list(itertools.product(p, d, q))<br/>    seasonal_pdq = [(x[0], x[1], x[2], 12) <strong class="lw iu">for</strong> x <strong class="lw iu">in</strong> list(itertools.product(p, d, q))]<br/><br/>    counter = 0<br/>    myDict = {}<br/>    <br/>    <strong class="lw iu">for</strong> param <strong class="lw iu">in</strong> pdq:<br/>        <strong class="lw iu">for</strong> param_seasonal <strong class="lw iu">in</strong> seasonal_pdq:<br/>            <strong class="lw iu">try</strong>:<br/>                counter += 1<br/>                mod = sm.tsa.statespace.SARIMAX(train,<br/>                                                order=param,<br/>                                                seasonal_order=param_seasonal,<br/>                                                enforce_stationarity=<strong class="lw iu">False</strong>,<br/>                                                enforce_invertibility=<strong class="lw iu">False</strong>)<br/><br/>                results = mod.fit()<br/>                myDict[counter] = [results.aic, results.bic, param, param_seasonal]<br/><br/>            <strong class="lw iu">except</strong>:<br/>                <strong class="lw iu">continue</strong><br/>                <br/>    dict_to_df = pd.DataFrame.from_dict(myDict,orient='index')<br/>    <br/>    <strong class="lw iu">if</strong> eval_metric == 'aic':<br/>        best_run = dict_to_df[dict_to_df[0] == dict_to_df[0].min()].index.values<br/>        best_run = best_run[0]<br/>    <strong class="lw iu">elif</strong> eval_metric == 'bic':<br/>        best_run = dict_to_df[dict_to_df[1] == dict_to_df[1].min()].index.values<br/>        best_run = best_run[0]<br/>            <br/>    model = sm.tsa.statespace.SARIMAX(train,<br/>                                      order=myDict[best_run][2],<br/>                                      seasonal_order=myDict[best_run][3],<br/>                                      enforce_stationarity=<strong class="lw iu">False</strong>,<br/>                                      enforce_invertibility=<strong class="lw iu">False</strong>).fit()<br/>    <br/>    best_model = {'model':model, <br/>                  'aic':model.aic,<br/>                  'bic':model.bic,<br/>                  'order':myDict[best_run][2], <br/>                  'seasonal_order':myDict[best_run][3]}<br/>    <br/>    <strong class="lw iu">return</strong> best_model</span></pre><p id="60c3" class="pw-post-body-paragraph kt ku it kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">输出是一个带有我们的拟合模型的字典，以及 aic、bic、订单元组和季节性订单元组。我们可以调用这个函数来检索我们的模型。</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="0ed8" class="ma mb it lw b gy mc md l me mf">best = find_best_sarima(train, 'aic')</span></pre><p id="e7ea" class="pw-post-body-paragraph kt ku it kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">模型准备好了，我们现在可以做预测了。</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="671b" class="ma mb it lw b gy mc md l me mf">sarima_pred = best['model'].predict(start=test.index[0], end=test.index[-1], dynamic=<strong class="lw iu">True</strong>)</span></pre><p id="567e" class="pw-post-body-paragraph kt ku it kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">为了查看我们的预测，我们可以将它与训练和测试数据一起绘制出来。</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="3be7" class="ma mb it lw b gy mc md l me mf">plt.figure(figsize=(22, 10))<br/>plt.plot(train.index, train, label='Train')<br/>plt.plot(test.index, test, label='Test', color='r')<br/>plt.plot(sarima_pred.index, sarima_pred, label='SARIMA', color='k')<br/>plt.legend(loc='best', fontsize='xx-large')<br/>plt.show()</span></pre><figure class="lr ls lt lu gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mj"><img src="../Images/b9c93f78cfa322c1f2a0f6659c0906e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EGoYAZB9lSriG3IscT71Dw.png"/></div></div></figure><p id="86fc" class="pw-post-body-paragraph kt ku it kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">考验脸书先知的时候到了</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="430c" class="ma mb it lw b gy mc md l me mf"><strong class="lw iu">from</strong> <strong class="lw iu">fbprophet</strong> <strong class="lw iu">import</strong> Prophet<br/><strong class="lw iu">import</strong> <strong class="lw iu">logging</strong><br/>logging.getLogger().setLevel(logging.ERROR)</span></pre><p id="823f" class="pw-post-body-paragraph kt ku it kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">与 Holt Winters 和 SARIMA 不同，我们需要月份列作为列，而不是索引。</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="53b6" class="ma mb it lw b gy mc md l me mf">df = dataset.reset_index()<br/>df.columns = ['ds', 'y']</span></pre><p id="08a9" class="pw-post-body-paragraph kt ku it kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">我们的预测规模将设定为过去 12 个月。在那之前，我们的训练数据就是一切。</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="51b9" class="ma mb it lw b gy mc md l me mf">prediction_size = 12<br/>train_df = df[:-prediction_size]</span></pre><p id="9e7a" class="pw-post-body-paragraph kt ku it kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">现在，我们可以创建模型并使其适合训练数据。</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="9381" class="ma mb it lw b gy mc md l me mf">m = Prophet(seasonality_mode='multiplicative')<br/>m.fit(train_df)</span></pre><p id="6def" class="pw-post-body-paragraph kt ku it kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">我们希望从预测中得到的是一个数据框架。值得研究一下你从中能得到什么。这是相当有用的数据。</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="3f1d" class="ma mb it lw b gy mc md l me mf">future = m.make_future_dataframe(periods=prediction_size, freq='M')<br/>forecast = m.predict(future)</span></pre><p id="4859" class="pw-post-body-paragraph kt ku it kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">现在我们可以绘制数据了。</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="fce2" class="ma mb it lw b gy mc md l me mf">single_plot = m.plot(forecast)</span></pre><figure class="lr ls lt lu gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mk"><img src="../Images/894960d39e2abdefb68cfbf81336faf2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WyHbY1O2bQgZLs4LTbq8EQ.png"/></div></div></figure><p id="3f0c" class="pw-post-body-paragraph kt ku it kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">现在让我们用我们的训练和测试来绘制预测。</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="2e59" class="ma mb it lw b gy mc md l me mf">plt.figure(figsize=(22, 10))<br/>plt.plot(train.index, train, label='Train')<br/>plt.plot(test.index, test, label='Test', color='r')<br/>plt.plot(forecast['ds'][131:], forecast['yhat'][131:], label='Prophet', color='k')<br/>plt.legend(loc='best', fontsize='xx-large')<br/>plt.show()</span></pre><figure class="lr ls lt lu gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mj"><img src="../Images/d52ce4689a56e6bcb9155d85334be5fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t8K-n8WZC9pRh9peJFLGUA.png"/></div></div></figure><p id="d2ea" class="pw-post-body-paragraph kt ku it kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">现在让我们放大到测试阶段，看看它们是如何叠加的。</p><pre class="lr ls lt lu gt lv lw lx ly aw lz bi"><span id="2267" class="ma mb it lw b gy mc md l me mf">plt.figure(figsize=(22, 10))<br/>plt.plot(holt_pred.index, holt_pred, label='Holt-Winters', color='b')<br/>plt.plot(sarima_pred.index, sarima_pred, label='SARIMA', color='y')<br/>plt.plot(forecast['ds'][131:], forecast['yhat'][131:], label='Prophet', color='k')<br/>plt.plot(test.index, test, label='Test', color='r')<br/>plt.legend(loc='best', fontsize='xx-large')<br/>plt.xticks(fontsize=18)<br/>plt.yticks(fontsize=16)<br/>plt.show()</span></pre><figure class="lr ls lt lu gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ml"><img src="../Images/eb1948776c324c21395bda24f46e23e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fHF0mLMbtzJxzEQCiQK6DA.png"/></div></div></figure><p id="93a5" class="pw-post-body-paragraph kt ku it kv b kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">当然，任何这些模型都可能发生许多不同的参数调整。我只是想针对同一个数据集快速浏览一下。谢谢你。</p></div></div>    
</body>
</html>