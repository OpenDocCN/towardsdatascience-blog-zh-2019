<html>
<head>
<title>Technical Indicators and GRU/LSTM for Time-Series Prediction</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">时间序列预测的技术指标和 GRU/LSTM</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/forecasting-with-technical-indicators-and-gru-lstm-rnn-multivariate-time-series-a3244dcbc38b?source=collection_archive---------5-----------------------#2019-11-20">https://towardsdatascience.com/forecasting-with-technical-indicators-and-gru-lstm-rnn-multivariate-time-series-a3244dcbc38b?source=collection_archive---------5-----------------------#2019-11-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="8d6c" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><strong class="ak"> <em class="jb">【门控循环单元】【GRU】</em></strong><strong class="ak"><em class="jb">【长短期记忆】【LSTM】</em></strong></h2><div class=""/><div class=""><h2 id="623f" class="pw-subtitle-paragraph ka jd it bd b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr dk translated">多元时间序列预测模型</h2></div><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi ks"><img src="../Images/088c895ba93145c72ddf56b8f4e25bd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AoR9fXH8-ZrDJdD1yfZ8VQ.png"/></div></div><figcaption class="le lf gj gh gi lg lh bd b be z dk">Image by author</figcaption></figure><p id="ac07" class="pw-post-body-paragraph li lj it lk b ll lm ke ln lo lp kh lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi me translated">技术指标有很多，主要被股票交易者使用。大多数指标都有用户定义的变量，允许交易者调整关键输入，如回望期，它告诉我们将使用多少历史数据来进行计算，以满足他们的需求。我们将使用一些指标在现有数据集中创建特征。应用这些特征，我们将会看到我们是否能预测一只特定股票的未来价格。</p><p id="e6bb" class="pw-post-body-paragraph li lj it lk b ll lm ke ln lo lp kh lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我在这里曾经用<strong class="lk je"><em class="mn">【GRU】</em></strong>和<strong class="lk je"><em class="mn">【LSTM】</em></strong>的门控循环单元来比较它们的表现。LSTM 在基于序列的长期依赖任务上已经建立良好，GRU 是机器学习领域的一个补充。它是<strong class="lk je"><em class="mn">【RNN】</em></strong>递归神经网络的即兴版本。我发现这篇<a class="ae mo" href="https://arxiv.org/pdf/1412.3555v1.pdf" rel="noopener ugc nofollow" target="_blank"> <strong class="lk je">文章</strong> </a>挺有意思的，想多了解一下这两种网络架构。虽然它们在 NLP(自然语言文本处理)领域很受欢迎，但在这里，我已经在数字金融市场数据上试验了它们的性能。</p><p id="1465" class="pw-post-body-paragraph li lj it lk b ll lm ke ln lo lp kh lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">GRU 和 LSTM 之间有一些相似之处和不同之处。</p><h2 id="e430" class="mp mq it bd mr ms mt dn mu mv mw dp mx lr my mz na lv nb nc nd lz ne nf ng iz bi translated">相似之处:</h2><ul class=""><li id="bbef" class="nh ni it lk b ll nj lo nk lr nl lv nm lz nn md no np nq nr bi translated">两个网络都具有从 t 到 t + 1 的附加分量；新内容被添加到现有内容的顶部。</li><li id="a2b9" class="nh ni it lk b ll ns lo nt lr nu lv nv lz nw md no np nq nr bi translated">两者都解决了渐变消失和爆炸的问题</li><li id="e5de" class="nh ni it lk b ll ns lo nt lr nu lv nv lz nw md no np nq nr bi translated">GRU 的更新门和 LSTM 的遗忘门取现有状态和新计算的状态之间的线性和</li></ul><h2 id="cc09" class="mp mq it bd mr ms mt dn mu mv mw dp mx lr my mz na lv nb nc nd lz ne nf ng iz bi translated">差异:</h2><ul class=""><li id="469a" class="nh ni it lk b ll nj lo nk lr nl lv nm lz nn md no np nq nr bi translated">GRU 有两个门，重置和更新门，相比之下，LSTM 有三个门，输入，忘记和输出。GRU 没有输出门，GRU 的更新门做 LSTM 的输入和遗忘门的工作。</li><li id="185f" class="nh ni it lk b ll ns lo nt lr nu lv nv lz nw md no np nq nr bi translated">考虑到更少的参数和需要更少的数据来概括，GRU 在计算上更有效。</li><li id="fe65" class="nh ni it lk b ll ns lo nt lr nu lv nv lz nw md no np nq nr bi translated">LSTM 有一个内部存储状态单元，而 GRU 没有单独的存储单元</li><li id="faad" class="nh ni it lk b ll ns lo nt lr nu lv nv lz nw md no np nq nr bi translated">GRU 没有任何机制来控制其状态或内存内容暴露的程度，而是每次都暴露整个状态或内存内容。LSTM 可以控制想要暴露多少内存内容。</li></ul><p id="fb79" class="pw-post-body-paragraph li lj it lk b ll lm ke ln lo lp kh lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">你可以访问这篇<a class="ae mo" href="https://medium.com/datadriveninvestor/multivariate-time-series-using-gated-recurrent-unit-gru-1039099e545a" rel="noopener">文章</a>来获得更多关于 GRU 和 LSTM 网络架构的理论观点。我将在这里用一个简单的例子解释特征创建和应用 RNN。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/6b6018e1a4beeeb72df3caf8847b5e4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1316/format:webp/1*g-rOJORrSytExWmWRVvpAw.png"/></div></figure><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi ny"><img src="../Images/47bff4847d955450cbef556083bd4bd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LCvydKy9f1Ov3wITtXtO5A.png"/></div></div></figure><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi nz"><img src="../Images/f98c1a18329aedd3979257ec12fe8b18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U2imrLmsrojI7nStro3Gww.png"/></div></div></figure><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi oa"><img src="../Images/59d6b93bc104a09f05ae78b744f81f6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jDYIOawpZ2x5T-Y59bnwLQ.png"/></div></div></figure><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/fc0ece4d87221d81a777d83fd9fd6084.png" data-original-src="https://miro.medium.com/v2/resize:fit:1034/format:webp/1*WI9QJOqygkITLqxidpNGOA.png"/></div></figure><p id="e08f" class="pw-post-body-paragraph li lj it lk b ll lm ke ln lo lp kh lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我创建了 2 个数据副本(tek_ind_1 &amp; tek_ind_2)来添加不同技术指标组的列。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/549c156cd4cf4653e7112a642e5f9163.png" data-original-src="https://miro.medium.com/v2/resize:fit:692/format:webp/1*70b_mn1d1Nnx0tLv8ciY8A.png"/></div></figure><h2 id="074b" class="mp mq it bd mr ms mt dn mu mv mw dp mx lr my mz na lv nb nc nd lz ne nf ng iz bi translated">tek_ind_1 数据帧:</h2><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi od"><img src="../Images/27605255d4858e9e96d90476f0f57cf3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ieWR5HT0IadaLImrzeLKeQ.png"/></div></div></figure><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi oe"><img src="../Images/fde7b2891f8de078d3d2aee6fddad40e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*av0-K-i7n6-f0gEGzzzfJw.png"/></div></div></figure><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div class="gh gi of"><img src="../Images/397211cae5f371ded3616c1e9b2b2bd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1026/format:webp/1*u5vIkhe4xrOizyqbRsRLJQ.png"/></div></figure><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi og"><img src="../Images/7f4612e3fe8828ed02daaf15e6193ca2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YRFHYub94omDYAKbUfIJSQ.png"/></div></div></figure><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/54156806e67757cac615a6b12ac64a26.png" data-original-src="https://miro.medium.com/v2/resize:fit:838/format:webp/1*djCjceauNEY_rHYtRVQIOw.png"/></div></figure><h2 id="004a" class="mp mq it bd mr ms mt dn mu mv mw dp mx lr my mz na lv nb nc nd lz ne nf ng iz bi translated">tek_ind_2 数据帧:</h2><p id="1b66" class="pw-post-body-paragraph li lj it lk b ll nj ke ln lo nk kh lq lr oi lt lu lv oj lx ly lz ok mb mc md im bi translated">随机振荡器的计算(%K 和%D)</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi ol"><img src="../Images/cba649dad4c4a19af4712eeec115f6b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Hx1eiSMCjoCS2TogvKzlpg.png"/></div></div></figure><h2 id="2b57" class="mp mq it bd mr ms mt dn mu mv mw dp mx lr my mz na lv nb nc nd lz ne nf ng iz bi translated">CCI =(典型价格 ma) / (0.015 *平均偏差):</h2><ul class=""><li id="c7fd" class="nh ni it lk b ll nj lo nk lr nl lv nm lz nn md no np nq nr bi translated">典型价格=(高+低+收盘)/ 3</li><li id="391d" class="nh ni it lk b ll ns lo nt lr nu lv nv lz nw md no np nq nr bi translated">p =周期数(通常为 20)</li><li id="7878" class="nh ni it lk b ll ns lo nt lr nu lv nv lz nw md no np nq nr bi translated">ma =移动平均值</li><li id="d46d" class="nh ni it lk b ll ns lo nt lr nu lv nv lz nw md no np nq nr bi translated">移动平均=典型价格/ p</li><li id="d24d" class="nh ni it lk b ll ns lo nt lr nu lv nv lz nw md no np nq nr bi translated">平均偏差=(典型价格-毫安)/ p</li></ul><h2 id="015c" class="mp mq it bd mr ms mt dn mu mv mw dp mx lr my mz na lv nb nc nd lz ne nf ng iz bi translated">市云的计算:</h2><ul class=""><li id="3216" class="nh ni it lk b ll nj lo nk lr nl lv nm lz nn md no np nq nr bi translated">转折线=(最高价+最低价)/ 2，过去 9 天</li><li id="1185" class="nh ni it lk b ll ns lo nt lr nu lv nv lz nw md no np nq nr bi translated">标准线=(最高价+最低价)/ 2，过去 26 天</li><li id="4cb7" class="nh ni it lk b ll ns lo nt lr nu lv nv lz nw md no np nq nr bi translated">领先跨度 1 =(标准线+转折线)/ 2，提前 26 天绘制</li><li id="ada9" class="nh ni it lk b ll ns lo nt lr nu lv nv lz nw md no np nq nr bi translated">领先跨度 2 =(最高价+最低价)/ 2，过去 52 天，在今天之前 26 天绘制</li><li id="f7bd" class="nh ni it lk b ll ns lo nt lr nu lv nv lz nw md no np nq nr bi translated">云=跨度 1 和跨度 2 之间的阴影区域</li></ul><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi om"><img src="../Images/dec11396c590a8c6b7ed5f0f46ece244.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xJV9KrAw65ER_n-LNCmZKw.png"/></div></div></figure><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi on"><img src="../Images/a8403b831472882009ff60e08629aead.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JTnmyhaec7VV3Pqcuy1QUA.png"/></div></div></figure><h2 id="b759" class="mp mq it bd mr ms mt dn mu mv mw dp mx lr my mz na lv nb nc nd lz ne nf ng iz bi translated">傅立叶变换:</h2><p id="739d" class="pw-post-body-paragraph li lj it lk b ll nj ke ln lo nk kh lq lr oi lt lu lv oj lx ly lz ok mb mc md im bi translated">对于已知具有季节性或每日模式的数据，我们希望使用傅立叶分析进行预测。这就像是外推和去噪的结合。我们希望重复多个时期的观察数据。并且还想通过找到观测数据中的主导频率分量来找到模式。我们将计算信号的傅立叶变换和频谱密度。</p><ul class=""><li id="93a0" class="nh ni it lk b ll lm lo lp lr oo lv op lz oq md no np nq nr bi translated">第一步是使用 fft()函数计算信号的 FFT</li><li id="e27e" class="nh ni it lk b ll ns lo nt lr nu lv nv lz nw md no np nq nr bi translated">一旦获得 FFT，我们需要取其绝对值的平方，以便获得功率谱密度(PSD)</li></ul><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div class="gh gi or"><img src="../Images/2c16ac081f7066d74e4b13cf6fcc9aee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1258/format:webp/1*zE91APuslYqhJF5qkmKG6Q.png"/></div></figure><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi os"><img src="../Images/0692d6eed8ca483e336d518708889fa9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qto3kdp8LOCH_9_gAKYSGQ.png"/></div></div></figure><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi ot"><img src="../Images/970aac76ea83b6b15300b2d74b8b8ddf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_IbvxHNKqIsJAh6HjBxSEA.png"/></div></div></figure><p id="64da" class="pw-post-body-paragraph li lj it lk b ll lm ke ln lo lp kh lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果我们与 10、50、200 日均线图进行比较，我们可以看到傅立叶变换通过去噪更好地平滑了数据。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/d893cd0edd3427d033081399e618a2fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:818/format:webp/1*2T5nV628Oa0JmKvslZiL9w.png"/></div></figure><h2 id="735f" class="mp mq it bd mr ms mt dn mu mv mw dp mx lr my mz na lv nb nc nd lz ne nf ng iz bi translated">RNN 的数据准备:</h2><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi ov"><img src="../Images/419c940c140973056ed57b9bcd4d423e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8HvNNUm28zxFcAbdJAAhwg.png"/></div></div></figure><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi ow"><img src="../Images/e4669ed391206e96c604a327d0c10e11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bN0MR3yL1R884Csg4tC3WQ.png"/></div></div></figure><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div class="gh gi ox"><img src="../Images/4b2b345bba39cff12aeac93af08bb159.png" data-original-src="https://miro.medium.com/v2/resize:fit:1066/format:webp/1*mIUMPxE9X_wncvDgvn57Cg.png"/></div></figure><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi oy"><img src="../Images/28708b57adf3030e1345db1da235ba8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p4tiWAmxImtYbZl2ZWZPKg.png"/></div></div></figure><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div class="gh gi oz"><img src="../Images/69d76cc92183bedf8acd4acf6b3873cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:858/format:webp/1*d2jKkIllijDadwe3OCeJYg.png"/></div></figure><p id="2252" class="pw-post-body-paragraph li lj it lk b ll lm ke ln lo lp kh lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们看到数据点从-100 到 756.77 不等；我们需要对 RNN 网络的数据进行扩展和标准化。这将在我们分割训练/测试数据集后完成。</p><p id="8376" class="pw-post-body-paragraph li lj it lk b ll lm ke ln lo lp kh lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在，让我们定义一个函数来创建时间序列数据集。我已经指定了回看间隔(60 个时间步)和预测列。RNN 的作品基于时间步骤。如果我们制作 60 个时间步长，这意味着，为了制作未来预测，我们的 RNN 将观察之前的 60 个时间步长，每次预测输出时，它将检查之前的 60 个时间步长。因此，我们需要相应地创建数据结构。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div class="gh gi pa"><img src="../Images/fe35c1c9d552b4836404861b93df260f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1120/format:webp/1*uQIkmxsVV-Jk0DKgaHRXNg.png"/></div></figure><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi pb"><img src="../Images/064d114a69dd6082e5167813f157e95b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u6-r3oeI7Ah05pIHctAltA.png"/></div></div></figure><p id="f23f" class="pw-post-body-paragraph li lj it lk b ll lm ke ln lo lp kh lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">上面是转换数据集的前 4 行。我们可以看到 22 个输入变量(输入序列)和 1 个输出变量(收盘价)。如果我们检查数据的新形状，我们可以看到 60 个时间步长的差异。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div class="gh gi pc"><img src="../Images/9d3c842d053f09b7888d1732ce706608.png" data-original-src="https://miro.medium.com/v2/resize:fit:1302/format:webp/1*bql_5gCHNHTJrDVbOkUf5A.png"/></div></figure><p id="c9ea" class="pw-post-body-paragraph li lj it lk b ll lm ke ln lo lp kh lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这里，我们将数据集分为训练集和测试集。然后将训练集和测试集分成输入变量和输出变量。最后，输入被整形为 LSTMs 所期望的 3D 格式，即<em class="mn">【样本、时间步长、特征】。</em>我们将对 90%的数据进行模型拟合，然后对剩余的数据进行评估。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div class="gh gi pd"><img src="../Images/265fad732263964665e5ade16872ab80.png" data-original-src="https://miro.medium.com/v2/resize:fit:746/format:webp/1*qt8fW7gUxInkUYS7yW9E7g.png"/></div></figure><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div class="gh gi pe"><img src="../Images/8e84f2d06fbb4d5213fff72606822791.png" data-original-src="https://miro.medium.com/v2/resize:fit:686/format:webp/1*V3olbnMf6SCYfP9tbhi9qQ.png"/></div></figure><h1 id="6c86" class="pf mq it bd mr pg ph pi mu pj pk pl mx kj pm kk na km pn kn nd kp po kq ng pp bi translated">训练/测试分割:</h1><p id="e020" class="pw-post-body-paragraph li lj it lk b ll nj ke ln lo nk kh lq lr oi lt lu lv oj lx ly lz ok mb mc md im bi translated">值序列对于时间序列数据至关重要。因此，我们使用如下的系统方法将训练和测试中的数据分开。此外，需要标准化来拟合用于神经网络架构学习的数据。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi pq"><img src="../Images/df09c7522b4079ee965a20d51401e2b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j1h81Q2TrlV3VO8W9S4XxA.png"/></div></div></figure><h2 id="b2a6" class="mp mq it bd mr ms mt dn mu mv mw dp mx lr my mz na lv nb nc nd lz ne nf ng iz bi translated">为 LSTM 塑造数据:</h2><p id="c349" class="pw-post-body-paragraph li lj it lk b ll nj ke ln lo nk kh lq lr oi lt lu lv oj lx ly lz ok mb mc md im bi translated">在这里，我采取了 60 天的回顾期，模型将通过过去 60 个时间步骤来预测未来价格。</p><h2 id="46d0" class="mp mq it bd mr ms mt dn mu mv mw dp mx lr my mz na lv nb nc nd lz ne nf ng iz bi translated">塑造训练数据:</h2><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi pr"><img src="../Images/0137fdfb083e7c1860167f1eb80388a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3WTZK02X0-vuoZCmZ67Xeg.png"/></div></div></figure><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div class="gh gi ps"><img src="../Images/b410a32439835baaed2926a0c4dd9e61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1234/format:webp/1*ehkKK8dPJLNUqHXzWO_Hkw.png"/></div></figure><h2 id="5e1b" class="mp mq it bd mr ms mt dn mu mv mw dp mx lr my mz na lv nb nc nd lz ne nf ng iz bi translated">LSTM 模式:</h2><p id="49e7" class="pw-post-body-paragraph li lj it lk b ll nj ke ln lo nk kh lq lr oi lt lu lv oj lx ly lz ok mb mc md im bi translated">我们现在创建的 LSTM 模型有三个 LSTM 层和一个密集层。我定义了 LSTM，第一个隐层有 75 个神经元，第二和第三层有 30 个神经元；输出层中的 1 个神经元用于预测价格。输入形状将是具有 22 个特征的 60 个时间步长。</p><p id="e2a1" class="pw-post-body-paragraph li lj it lk b ll lm ke ln lo lp kh lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">该模型是用平均绝对误差(MAE)损失函数和有效的随机梯度下降的 Adam 版本编译的。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi pt"><img src="../Images/fb8984d960b35623232ab0aff7a12d04.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vCDtpMm-X0qMNmHlNK03tg.png"/></div></div></figure><h2 id="c93f" class="mp mq it bd mr ms mt dn mu mv mw dp mx lr my mz na lv nb nc nd lz ne nf ng iz bi translated">准备测试数据:</h2><p id="62bf" class="pw-post-body-paragraph li lj it lk b ll nj ke ln lo nk kh lq lr oi lt lu lv oj lx ly lz ok mb mc md im bi translated">一旦模型适合训练数据，我们希望看到模型在样本外数据上的技巧。与我们在训练集中所做的一样，我们将准备测试集，并且我们需要从训练数据中提取回望值。回看是用作预测下一个时间段<em class="mn">(本例中为 60)的输入变量的先前时间步数。</em></p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div class="gh gi pu"><img src="../Images/aba67b8f87123ef0e54dd69fbcfdb654.png" data-original-src="https://miro.medium.com/v2/resize:fit:684/format:webp/1*WKSMB1z_6knciZrThGDexw.png"/></div></figure><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div class="gh gi pv"><img src="../Images/b30e60c23bdc1ea03cd59d7c081e6dd4.png" data-original-src="https://miro.medium.com/v2/resize:fit:776/format:webp/1*cbFajZefJhs2ui_ciFXpbQ.png"/></div></figure><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi pw"><img src="../Images/6533f3725ac1b42325a6791a8af9ba65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W1hhMvvcMWYMdxNOrpZ43A.png"/></div></div></figure><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div class="gh gi px"><img src="../Images/ea41cf53b5f67a4fa09d58c16f226e8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1166/format:webp/1*D3vhnXtfHsCcYvJfw39UiQ.png"/></div></figure><p id="263a" class="pw-post-body-paragraph li lj it lk b ll lm ke ln lo lp kh lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">该模型拟合了 20 个训练时期，批次大小为 32。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi py"><img src="../Images/4ffee02da8d6803401cf038154aedfe1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BoxveFzKE7rpG3UD8b-HSg.png"/></div></div></figure><h2 id="dc1b" class="mp mq it bd mr ms mt dn mu mv mw dp mx lr my mz na lv nb nc nd lz ne nf ng iz bi translated">GRU:</h2><p id="8721" class="pw-post-body-paragraph li lj it lk b ll nj ke ln lo nk kh lq lr oi lt lu lv oj lx ly lz ok mb mc md im bi translated">GRU 网络是使用与 LSTM 相同的参数和配置创建的。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi pz"><img src="../Images/c8ad8c85d98f85de7814e3800a1dc524.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*luFRtViq9d9EqHgQXTicew.png"/></div></div></figure><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi ow"><img src="../Images/165e156d27829a1eac2043c4add2ea4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l8ipQJJXhuoki4lqHSg_NA.png"/></div></div></figure><p id="49b9" class="pw-post-body-paragraph li lj it lk b ll lm ke ln lo lp kh lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这里，LSTM 和 GRU 有相同的架构，但是 LSTM 的参数数量是 49，771，而 GRU 的 GRU 是 37，741。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div class="gh gi qa"><img src="../Images/c9aeab9855cc14861b46e58f7845e6db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1306/format:webp/1*lVs1zJrmcRS-eBu_62gS8Q.png"/></div></figure><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div class="gh gi qb"><img src="../Images/c5197d5d5712405bb87121fcbc90f638.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/format:webp/1*aumWqYU6zkW7B_E1IzWd0A.png"/></div></figure><p id="d2e5" class="pw-post-body-paragraph li lj it lk b ll lm ke ln lo lp kh lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">正如我们已经讨论过的差异，GRU 有两个门，而 LSTM 有三个门。GRU 的参数较少，计算效率比 LSTM 高。</p><h2 id="1341" class="mp mq it bd mr ms mt dn mu mv mw dp mx lr my mz na lv nb nc nd lz ne nf ng iz bi translated"><strong class="ak">诊断图:</strong></h2><p id="b387" class="pw-post-body-paragraph li lj it lk b ll nj ke ln lo nk kh lq lr oi lt lu lv oj lx ly lz ok mb mc md im bi translated">LSTM 和 GRU 模型的训练历史被用于诊断模型的行为。为了方便起见，我创建了一个单独的情节。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi qc"><img src="../Images/31247781b90960a901a992382d7052d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yLosKMnFQYShBv8I1hjqgw.png"/></div></div></figure><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi qd"><img src="../Images/4483645eeba6cd68ca6b1628939b0f28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MCZLVrfBvG_Xl9z5iL_I6A.png"/></div></div></figure><p id="de5f" class="pw-post-body-paragraph li lj it lk b ll lm ke ln lo lp kh lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们可以看到，在这两种情况下，训练损失都大大低于验证损失，表明模型可能对训练数据拟合不足。可以通过增加可以试验的时期来提高性能。</p><h2 id="b255" class="mp mq it bd mr ms mt dn mu mv mw dp mx lr my mz na lv nb nc nd lz ne nf ng iz bi translated">LSTM 预测:</h2><p id="b5a8" class="pw-post-body-paragraph li lj it lk b ll nj ke ln lo nk kh lq lr oi lt lu lv oj lx ly lz ok mb mc md im bi translated">这给了我们按比例缩小的预测值；我们反转标度，需要将这些值调整到正常标度。让我们找出数据的缩放级别。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div class="gh gi qe"><img src="../Images/4b735600dbc7c181d925eec84ee04ad3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1322/format:webp/1*1Adv0HFox20IPGjqZzz_Yw.png"/></div></figure><p id="3fdf" class="pw-post-body-paragraph li lj it lk b ll lm ke ln lo lp kh lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这里，第一个值是开盘价；为了达到正常比例，我们将该值除以 1，如下所示。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div class="gh gi qf"><img src="../Images/b7a261e7dff79046bf81255dca6a4cc0.png" data-original-src="https://miro.medium.com/v2/resize:fit:726/format:webp/1*m011QIlPjOBxtmxjBGV_jA.png"/></div></figure><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div class="gh gi qg"><img src="../Images/9a79570d76e5f9b20d45f1058a67e2c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:660/format:webp/1*LCW5GPEYGwT95FJdcdEOGw.png"/></div></figure><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div class="gh gi pu"><img src="../Images/e7616025ea9661fc2678ad6ccab5e5f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:684/format:webp/1*M2dx5qrjIoWxwX6yfAzFJw.png"/></div></figure><h2 id="9e9e" class="mp mq it bd mr ms mt dn mu mv mw dp mx lr my mz na lv nb nc nd lz ne nf ng iz bi translated">评估模型:</h2><p id="c0dc" class="pw-post-body-paragraph li lj it lk b ll nj ke ln lo nk kh lq lr oi lt lu lv oj lx ly lz ok mb mc md im bi translated">现在，我们可以预测整个测试数据集，将预测与测试数据集相结合，并反转缩放比例。根据原始比例的预测值和实际值，我们可以计算模型的误差分数(均方根误差-RMSE)。RMSE 给出的误差单位与变量本身的单位相同。</p><p id="726f" class="pw-post-body-paragraph li lj it lk b ll lm ke ln lo lp kh lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">可以通过取观察值和预测值的平均值并将它们彼此相除来计算精度。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div class="gh gi qh"><img src="../Images/a247760031846b397f43015891ff1347.png" data-original-src="https://miro.medium.com/v2/resize:fit:1160/format:webp/1*EDePobqg4mbJibkiqYM1XQ.png"/></div></figure><p id="493c" class="pw-post-body-paragraph li lj it lk b ll lm ke ln lo lp kh lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们可以在 GRU 模型上做类似的练习。</p><p id="9423" class="pw-post-body-paragraph li lj it lk b ll lm ke ln lo lp kh lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">此外，可以通过添加更多的时间变量来提高模型的性能，例如添加周(星期几，星期号)、月(月号)和年列、时滞等。以及调整超参数和时期。</p><h1 id="cf65" class="pf mq it bd mr pg ph pi mu pj pk pl mx kj pm kk na km pn kn nd kp po kq ng pp bi translated">结论:</h1><p id="044f" class="pw-post-body-paragraph li lj it lk b ll nj ke ln lo nk kh lq lr oi lt lu lv oj lx ly lz ok mb mc md im bi translated">GRU 和 LSTM 的关键区别在于，GRU 有两个门(<em class="mn">复位</em>和<em class="mn">更新</em>门)，而 LSTM 有三个门(即<em class="mn">输入</em>、<em class="mn">输出</em>和<em class="mn">忘记</em>门)。GRU 网络更简单，因此更容易修改，例如在网络有额外输入的情况下增加新的门。一般来说代码更少。但是，如果序列很大或者准确性非常关键，我会推荐 LSTM</p><p id="83c4" class="pw-post-body-paragraph li lj it lk b ll lm ke ln lo lp kh lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk je"> <em class="mn">我这里可以连接</em></strong><a class="ae mo" href="https://www.linkedin.com/in/saritmaitra/" rel="noopener ugc nofollow" target="_blank"><strong class="lk je"><em class="mn"/></strong></a><strong class="lk je"><em class="mn">。</em> </strong></p></div></div>    
</body>
</html>