# åˆå­¦è€…çš„è®¡ç®—æœºè§†è§‰:ç¬¬ 4 éƒ¨åˆ†

> åŸæ–‡ï¼š<https://towardsdatascience.com/computer-vision-for-beginners-part-4-64a8d9856208?source=collection_archive---------7----------------------->

## è½®å»“æ£€æµ‹å’Œä¸€ç‚¹ç‚¹ä¹è¶£

![](img/dc50edce52955af3bce6e706ba8e2f92.png)

æœ‰å¾ˆå¤šæ–¹æ³•å¯ä»¥è®©ä½ æœ‰æ•ˆåœ°å­¦ä¹ è¿›æ­¥ã€‚å¯¹æˆ‘æ¥è¯´ï¼ŒæŠŠå­¦ä¹ å’Œä¸€ç‚¹ç‚¹ä¹è¶£ç»“åˆèµ·æ¥æ˜¯æœ€å¥½çš„ç­–ç•¥ã€‚åœ¨è¿™ä¸€ç³»åˆ—æ•™ç¨‹ä¸­ï¼Œè®¸å¤šå›¾åƒè¢«ç”¨æ¥æ¼”ç¤ºå›¾åƒå¤„ç†æ¦‚å¿µã€‚ä½ å¯èƒ½ä¼šæ„Ÿå…´è¶£åœ°æ³¨æ„åˆ°ï¼Œäººä»¬å–œæ¬¢æˆ‘ä»¥ä¸€ç§æœ‰è¶£çš„æ–¹å¼å°†è¿™ä¸ªæ¦‚å¿µåº”ç”¨åˆ°å›¾åƒä¸­çš„éƒ¨åˆ†ã€‚æˆ‘å»ºè®®ä½ æŠŠå¨±ä¹å’Œå­¦ä¹ ç»“åˆèµ·æ¥ã€‚

è¿™æ˜¯ OpenCV åˆå­¦è€…æ•™ç¨‹çš„æœ€åä¸€éƒ¨åˆ†ï¼Œå®Œæ•´ç³»åˆ—å¦‚ä¸‹:

1.  [ç†è§£é¢œè‰²æ¨¡å‹å¹¶åœ¨å›¾åƒä¸Šç»˜åˆ¶å›¾å½¢](/computer-vision-for-beginners-part-1-7cca775f58ef)
2.  [ä½¿ç”¨è¿‡æ»¤å’Œæ¸å˜è¿›è¡Œå›¾åƒå¤„ç†çš„åŸºç¡€çŸ¥è¯†](/computer-vision-for-beginners-part-2-29b3f9151874)
3.  [ä»ç‰¹å¾æ£€æµ‹åˆ°äººè„¸æ£€æµ‹](/computer-vision-for-beginners-part-3-79de62dbeef7)
4.  *è½®å»“æ£€æµ‹åˆæœ‰äº†ä¸€ç‚¹ä¹è¶£*

*ä»ç¬¬ä¸€ä¸ªç³»åˆ—ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†å¦‚ä½•åœ¨å›¾åƒä¸Šç»˜åˆ¶å›¾å½¢ã€‚æˆ‘ä»¬è¿˜è®¨è®ºäº†å¦‚ä½•ä½¿ç”¨å„ç§é€‰é¡¹åº”ç”¨æ¨¡ç³Šå’Œé˜ˆå€¼å¤„ç†ã€‚åœ¨ç¬¬ä¸‰éƒ¨åˆ†ï¼Œæˆ‘ä»¬è®¨è®ºäº†å‡ ç§æ£€æµ‹ç®—æ³•ï¼ŒåŒ…æ‹¬è¾¹ç¼˜æ£€æµ‹ã€‚è¿˜æœ‰å¦ä¸€ç§æ£€æµ‹æŠ€æœ¯å«åšè½®å»“æ£€æµ‹ï¼Œå®ƒåœ¨ç‰©ä½“æ£€æµ‹ä¸­æ˜¯å¿…ä¸å¯å°‘çš„ã€‚åœ¨é‚£ä¹‹åï¼Œæˆ‘ä»¬ä¼šç”¨ä¸€ç‚¹ç©è’™ç‰ˆçš„ä¹è¶£æ¥ç»“æŸè¿™ä¸ªç³»åˆ—ã€‚*

*æœ¬æ–‡å‡è®¾æ‚¨å·²ç»éµå¾ªäº†å‰é¢çš„æ­¥éª¤ï¼Œæˆ–è€…æ‚¨å·²ç»çŸ¥é“è¿™äº›æ¦‚å¿µã€‚ä½†å¦‚æœä¸æ˜¯è¿™æ ·ï¼Œè¯·æŸ¥çœ‹æœ¬ç³»åˆ—å‰é¢çš„éƒ¨åˆ†ã€‚æœ¬æ•™ç¨‹çš„å®Œæ•´ä»£ç ä¸€å¦‚æ—¢å¾€åœ°åœ¨[**Github**](https://github.com/jjone36/vision_4_beginners/blob/master/part4_contour_mapping.ipynb)**ä¸Šæä¾›ã€‚***

# ***è½®å»“æ£€æµ‹***

***ä½ å¯èƒ½å·²ç»ç†Ÿæ‚‰äº†â€œè½®å»“â€è¿™ä¸ªè¯ã€‚åœ¨ä»¥å‰çš„å¸–å­ä¸­ï¼Œæˆ‘å·²ç»å¤šæ¬¡ä½¿ç”¨è¿™ä¸ªæœ¯è¯­ã€‚ [**è½®å»“çº¿**](https://en.wikipedia.org/wiki/Contour_line) è¡¨ç¤ºä»£è¡¨ç›¸åŒå€¼æˆ–ç›¸åŒå¼ºåº¦çš„è¾¹ç•Œçš„æ›²çº¿ã€‚ç­‰é«˜çº¿å›¾æ˜¯æˆ‘ä»¬èƒ½æƒ³åˆ°çš„æœ€ç®€å•çš„ä¾‹å­ã€‚***

***ä½†æ˜¯ä½ å¯èƒ½ä¼šé—®ã€‚è¾¹ç¼˜å’Œè½®å»“æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿè¿™ä¸¤ä¸ªæœ¯è¯­ç»å¸¸äº’æ¢ä½¿ç”¨ï¼Œæ‰€ä»¥å¯èƒ½ä¼šæœ‰ç‚¹æ··æ·†ã€‚ç®€å•åœ°è¯´ï¼Œè¾¹ç¼˜çš„æ¦‚å¿µæ˜¯åœ¨å±€éƒ¨èŒƒå›´å†…ï¼Œè€Œè½®å»“çš„æ¦‚å¿µæ˜¯åœ¨å›¾å½¢çš„æ•´ä½“è¾¹ç•Œä¸Šã€‚è¾¹æ˜¯å…¶å€¼ä¸å…¶ç›¸é‚»ç‚¹ç›¸æ¯”å‘ç”Ÿæ˜¾è‘—å˜åŒ–çš„ç‚¹ã€‚å¦ä¸€æ–¹é¢ï¼Œè½®å»“æ˜¯ä»è¾¹ç¼˜è·å¾—çš„å°é—­æ›²çº¿ï¼Œæç»˜äº†å›¾å½¢çš„è¾¹ç•Œã€‚è¿™é‡Œ å¯ä»¥æ‰¾åˆ°è¿›ä¸€æ­¥çš„è§£é‡Š [**ã€‚**](https://stackoverflow.com/questions/17103735/difference-between-edge-detection-and-image-contours)***

```
***# Load the image
img = cv2.imread('images/pine_apple.jpg')
img = cv2.cvtColor(img, cv2.COLOR_BGR2RGB)
plt.imshow(img)***
```

***![](img/5dc8700a24d2b1349c6a78afbe542806.png)***

***æ‰€ä»¥æˆ‘ä»¬è¦åšçš„æ˜¯æ£€æµ‹è¿™ä¸ªè èçš„è½®å»“ã€‚åœ¨åº”ç”¨æ£€æµ‹ç®—æ³•ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å°†å›¾åƒè½¬æ¢æˆç°åº¦å¹¶åº”ç”¨å¦‚ä¸‹çš„é˜ˆå€¼å¤„ç†ã€‚æ‰€æœ‰è¿™äº›æ­¥éª¤éƒ½æ˜¯æˆ‘ä»¬åœ¨ä¸Šä¸€ç³»åˆ—æ–‡ç« ä¸­è®¨è®ºè¿‡çš„ã€‚***

```
***# Blurring for removing the noise 
img_blur = cv2.bilateralFilter(img, d = 7, 
                               sigmaSpace = 75, sigmaColor =75)# Convert to grayscale 
img_gray = cv2.cvtColor(img_blur, cv2.COLOR_RGB2GRAY)# Apply the thresholding
a = img_gray.max()  
_, thresh = cv2.threshold(img_gray, a/2+60, a,cv2.THRESH_BINARY_INV)
plt.imshow(thresh, cmap = 'gray')***
```

***![](img/9c4e4615021ca0bdb913be801738cafc.png)***

***è½®å»“æ£€æµ‹å¯ä»¥é€šè¿‡ OpenCV ä¸­çš„å‡½æ•°`cv2.findContours()`æ¥å®ç°ï¼Œè¿™é‡Œæœ‰ä¸¤ä¸ªé‡è¦çš„å‚æ•°ã€‚`mode`æ˜¯å¯»æ‰¾è½®å»“çš„æ–¹æ³•ï¼Œ`method`æ˜¯æ£€æµ‹çš„è¿‘ä¼¼æ–¹æ³•ã€‚æˆ‘è¦æ±‚ä½ ä» [**æ–‡æ¡£**](https://docs.opencv.org/2.4/modules/imgproc/doc/structural_analysis_and_shape_descriptors.html#findcontours) ä¸­æ‰¾åˆ°å…¶ä»–ä¿¡æ¯ã€‚***

```
***# Find the contour of the figure 
image, contours, hierarchy = cv2.findContours(image = thresh, 
                                   **mode = cv2.RETR_TREE, 
                                   method = cv2.CHAIN_APPROX_SIMPLE**)***
```

***æ¨¡å¼`cv2.RETR_TREE`æ‰¾åˆ°æ‰€æœ‰æœ‰å¸Œæœ›çš„è½®å»“çº¿ï¼Œå¹¶é‡å»ºåµŒå¥—è½®å»“çš„å®Œæ•´å±‚æ¬¡ã€‚æ–¹æ³•`cv2.CHAIN_APPROX_SIMPLE`åªè¿”å›ç»˜åˆ¶ç­‰é«˜çº¿æ‰€éœ€çš„ç«¯ç‚¹ã€‚æ­£å¦‚ä½ åœ¨ä¸Šé¢çœ‹åˆ°çš„ï¼Œè¿™ä¸ªå‡½æ•°ç»™å‡ºäº†å›¾åƒï¼Œæ£€æµ‹åˆ°çš„è½®å»“å’Œå®ƒä»¬çš„å±‚æ¬¡ä½œä¸ºè¾“å‡ºã€‚***

***è¿”å›çš„ç­‰é«˜çº¿æ˜¯ç”±ç­‰é«˜çº¿ç»„æˆçš„ç‚¹çš„åˆ—è¡¨ã€‚ä¸ºäº†ç”»å‡ºå›¾å½¢çš„å¤–éƒ¨çº¿æ¡ï¼Œæˆ‘ä»¬å°†æŒ‰é¢ç§¯å¯¹è½®å»“è¿›è¡Œæ’åºã€‚é€‰ä¸­è½®å»“çº¿åï¼Œ`cv2.drawContours()`å°†æç»˜å‡ºè¾¹ç•Œçº¿å’Œå¦‚ä¸‹æ‰€ç¤ºçš„ç‚¹ã€‚***

```
***# Sort the contours 
contours = sorted(contours, key = cv2.contourArea, reverse = True)# Draw the contour 
img_copy = img.copy()
final = **cv2.drawContours(**img_copy, contours, contourIdx = -1, 
                         color = (255, 0, 0), thickness = 2**)**
plt.imshow(img_copy)***
```

***![](img/16295535909082ec48d5af7473c8b11e.png)***

***å¾ˆç®€å•å§ï¼Ÿè™½ç„¶åº•éƒ¨ä¹ŸåŠ äº†é˜´å½±ï¼Œä½†æ˜¯ç»“å±€è¿˜æ˜¯è›®æ»¡æ„çš„ã€‚***

# ***å…³äºè½®å»“çš„æ›´å¤šä¿¡æ¯***

***æˆ‘ä»¬å¯ä»¥å¯¹è½®å»“åšæ›´å¤šçš„äº‹æƒ…ã€‚å€ŸåŠ©äºå›¾åƒçŸ©çš„æ¦‚å¿µï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°å›¾åƒçš„è´¨å¿ƒæˆ–è®¡ç®—è¾¹ç•Œåœºçš„é¢ç§¯ã€‚ä¸€ç¬é—´åœ¨è¿™é‡Œæ„å‘³ç€ä»€ä¹ˆï¼Ÿå•è¯*â€˜momentâ€™*åœ¨é€šå¸¸ç”¨æ³•ä¸­æ˜¯ä¸€å°æ®µæ—¶é—´ã€‚ä½†åœ¨ç‰©ç†å­¦æœ¯è¯­ä¸­ï¼Œä¸€ä¸ª [**çŸ©**](https://en.wikipedia.org/wiki/Moment_(physics)) æ˜¯è·ç¦»å’Œå¦ä¸€ä¸ªç‰©ç†é‡çš„ä¹˜ç§¯ï¼Œæ„å‘³ç€ä¸€ä¸ªç‰©ç†é‡æ˜¯å¦‚ä½•åˆ†å¸ƒæˆ–å®šä½çš„ã€‚æ‰€ä»¥åœ¨è®¡ç®—æœºè§†è§‰ä¸­ï¼Œ [**å›¾åƒçŸ©**](https://en.wikipedia.org/wiki/Image_moment) å°±æ˜¯å›¾åƒåƒç´ å¼ºåº¦æ˜¯å¦‚ä½•æ ¹æ®ä½ç½®åˆ†å¸ƒçš„ã€‚å®ƒæ˜¯å›¾åƒåƒç´ å¼ºåº¦çš„åŠ æƒå¹³å‡å€¼ï¼Œæˆ‘ä»¬å¯ä»¥ä»å›¾åƒçŸ©ä¸­è·å¾—è´¨å¿ƒæˆ–ç©ºé—´ä¿¡æ¯ã€‚***

***![](img/4a3bcb093ad76c6f4caf223dcb2269b0.png)***

***æœ‰ä¸‰ç§ç±»å‹çš„çŸ©-ç©ºé—´çŸ©ã€ä¸­å¿ƒçŸ©å’Œä¸­å¿ƒå½’ä¸€åŒ–çŸ©ã€‚æˆ‘ä»¬å¯ä»¥ç”¨ OpenCV ä¸­çš„å‡½æ•°`cv2.moments()`å¾—åˆ°å›¾åƒçš„çŸ©ï¼Œå®ƒè¿”å› 24 ä¸ªä¸åŒçš„çŸ©ã€‚å¦‚æœæ‚¨æ‰“å°å¦‚ä¸‹æ‰€ç¤ºçš„è¾“å‡º`M`ï¼Œå®ƒå°†ä»¥å­—å…¸æ ¼å¼è¿”å› 24 ä¸ªæ—¶åˆ»ã€‚***

```
***# The first order of the contours
c_0 = contours[0]# image moment
M = cv2.moments(c_0)
print(M.keys())***
```

***æˆ‘æƒ³åœ¨è¿™é‡ŒæŠŠé‡ç‚¹æ”¾åœ¨å›¾åƒæ—¶åˆ»çš„å®ç°ä¸Šã€‚å¦‚æœä½ æœ‰å…´è¶£ï¼Œå¯ä»¥åœ¨æœ¬æ–‡æœ«å°¾æ‰¾åˆ°é¢å¤–çš„é˜…è¯»èµ„æºã€‚***

***ä¸ºäº†å¾—åˆ°è½®å»“çš„é¢ç§¯ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°å‡½æ•°`cv2.contourArea()`ã€‚ä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸åœ¨è¿™é‡Œå°è¯•å‡ ç§è½®å»“ï¼Ÿå¦‚æœæ‚¨è¾“å…¥ç¬¬ä¸€ä¸ªã€ç¬¬äºŒä¸ªå’Œç¬¬ä¸‰ä¸ªè½®å»“ï¼Œæ‚¨å°†å¾—åˆ°å¦‚ä¸‹æ‰€ç¤ºçš„é€’å‡å€¼ã€‚è¿™è¡¨æ˜è½®å»“æ£€æµ‹ç®—æ³•å½¢æˆäº†æ£€æµ‹åˆ°çš„è¾¹ç•Œçš„å±‚æ¬¡ã€‚***

```
***# The area of contours 
print("1st Contour Area : ", cv2.contourArea(contours[0])) # 37544.5
print("2nd Contour Area : ", cv2.contourArea(contours[1])) # 75.0
print("3rd Contour Area : ", cv2.contourArea(contours[2])) # 54.0***
```

***è½®å»“çš„å¼§é•¿å¯ä»¥é€šè¿‡å‡½æ•°`cv2.arcLength()`å¾—åˆ°ã€‚å‚æ•°`closed`æŒ‡ç¤ºæ›²çº¿æ˜¯å¦åº”è¯¥é—­åˆã€‚***

```
***# The arc length of contours 
print(cv2.arcLength(contours[0], closed = True))      # 2473.3190
print(cv2.arcLength(contours[0], closed = False))   # 2472.3190***
```

***ç°åœ¨è®©æˆ‘ä»¬è¯•ç€ç”»å‡ºè èçš„è´¨å¿ƒå’Œæå€¼ç‚¹ã€‚æˆ‘ä»¬å¯ä»¥ç”¨ä¸‹é¢çš„å…¬å¼å¾—åˆ°è´¨å¿ƒç‚¹ã€‚***

```
***# The centroid point
cx = int(M['m10'] / M['m00'])
cy = int(M['m01'] / M['m00'])***
```

***æå€¼æ˜¯å·¦è¾¹å’Œå³è¾¹ã€é¡¶éƒ¨å’Œåº•éƒ¨çš„ç«¯ç‚¹ã€‚å¹¶ä¸”æˆ‘ä»¬å¯ä»¥æŠŠ x å’Œ y åæ ‡åˆ†åˆ«æ’åˆ—å¦‚ä¸‹ã€‚***

```
***# The extreme points
l_m = tuple(**c_0[c_0[:, :, 0]**.argmin()][0])
r_m = tuple(**c_0[c_0[:, :, 0]**.argmax()][0])
t_m = tuple(**c_0[c_0[:, :, 1]**.argmin()][0])
b_m = tuple(**c_0[c_0[:, :, 1]**.argmax()][0])pst = [l_m, r_m, t_m, b_m]
xcor = [p[0] for p in pst]
ycor = [p[1] for p in pst]***
```

***ç°åœ¨è®©æˆ‘ä»¬åœ¨å›¾åƒä¸Šç»˜åˆ¶æ‰€æœ‰è¿™äº›ç‚¹ã€‚***

```
***# Plot the points
plt.figure(figsize = (10, 16))
plt.subplot(1, 2, 1)
plt.imshow(image, cmap = 'gray')
plt.scatter([cx], [cy], c = 'b', s = 50)plt.subplot(1, 2, 2)
plt.imshow(image, cmap = 'gray')
plt.scatter(xcor, ycor, c = 'b', s = 50)***
```

***![](img/7718843ba2c16eaa83b2d5d1ac8015cf.png)***

# ***å…¶ä»–è½®å»“å½¢çŠ¶***

***é™¤äº†ç´§è‡´è½®å»“ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ç”»å‡ºä¸€ä¸ªå›¾å½¢çš„å‡¸è½®å»“æˆ–çŸ©å½¢è½®å»“çº¿ã€‚è®©æˆ‘ä»¬å…ˆå°è¯•ä¸€ä¸ªç›´çš„çŸ©å½¢ã€‚æœ‰äº†å¤–éƒ¨è½®å»“çº¿ï¼Œæˆ‘ä»¬å°†å›´ç»•å¯¹è±¡ç»˜åˆ¶çŸ©å½¢ã€‚å‡½æ•°`cv2.boundingRect()`è¿”å›è¾¹ç•Œæ¡†çš„ 4 ä¸ªç‚¹ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚***

```
***# The first order of the contours
c_0 = contours[0]# Get the 4 points of the bounding rectangle
x, y, w, h = cv2.boundingRect(c_0)# Draw a straight rectangle with the points
img_copy = img.copy()
img_box = cv2.rectangle(img_copy, (x, y), (x+w, y+h), color = (255, 0, 0), thickness = 2)***
```

***æ³¨æ„ï¼Œè¿™ä¸ªç›´çŸ©å½¢ä¸æ˜¯å…¶ä»–å¯èƒ½è¾¹ç•Œä¸­çš„æœ€å°å€¼ã€‚æˆ‘ä»¬å¯ä»¥ç”¨å‡½æ•°`cv2.minAreaRect()`æå–é¢ç§¯æœ€å°çš„çŸ©å½¢ï¼Œè¯¥å‡½æ•°æ‰¾åˆ°ä¸€ä¸ªåŒ…å«è¾“å…¥ 2D ç‚¹é›†çš„æ—‹è½¬çŸ©å½¢ã€‚ä¹‹åï¼Œæˆ‘ä»¬å¾—åˆ°è¿™ä¸ªçŸ©å½¢çš„å››ä¸ªè§’ï¼Œå¹¶æŠŠå®ƒä»¬æ”¾åœ¨`contour`å‚æ•°ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚***

```
***# Get the 4 points of the bounding rectangle with the minimum area
rect = cv2.minAreaRect(c_0)
box = cv2.boxPoints(rect)
box = box.astype('int')# Draw a contour with the points 
img_copy = img.copy()
img_box_2 = cv2.drawContours(img_copy, **contours = [box]**, 
                             contourIdx = -1, 
                             color = (255, 0, 0), thickness = 2)***
```

***ç°åœ¨è®©æˆ‘ä»¬æ£€æŸ¥ç»“æœå¹¶æ¯”è¾ƒä¸¤ä¸ªä¸åŒçš„è½®å»“æ¡†ã€‚***

```
***plt.figure(figsize = (10, 16))
plt.subplot(1, 2, 1); plt.imshow(img_box)
plt.subplot(1, 2, 2); plt.imshow(img_box_2)***
```

***![](img/1eb3179c9df4a7c1a1d12f849d53772b.png)***

***æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨`cv2.convexHull()`åŠŸèƒ½ç»˜åˆ¶ä¸€ä¸ªå‡¸å½¢è½®å»“ã€‚è¿™éœ€è¦ä¸€ç»„ç‚¹ï¼Œå¹¶ä»ç»™å®šçš„é›†åˆä¸­è¿”å›å‡¸åŒ…ã€‚åœ¨`cv2.drawContours()`ä¸­è¾“å…¥è¿™ä¸ªè¿”å›çš„ç‚¹ä¸º`contours`ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°å¦‚ä¸‹çš„å‡¸è½®å»“ã€‚***

```
***# Detect the convex contour
hull = cv2.convexHull(c_0)img_copy = img.copy()
img_hull = cv2.drawContours(img_copy, **contours = [hull]**, 
                            contourIdx = 0, 
                            color = (255, 0, 0), thickness = 2)
plt.imshow(img_hull)***
```

***![](img/f32978faf7e9a32d1a8c9153a59dd255.png)***

***åœ¨è½®å»“æ£€æµ‹ä¸­æœ‰å¤ªå¤šçš„äº‹æƒ…è¦æ¶‰åŠã€‚æˆ‘é¼“åŠ±ä½ æŸ¥çœ‹æ–‡æ¡£[](https://docs.opencv.org/3.4.6/d3/d05/tutorial_py_table_of_contents_contours.html)**å¹¶è‡ªå·±æ¢ç´¢æ›´å¤šé€‰é¡¹ã€‚*****

# *****æ©è”½å¸¦æ¥çš„ä¸€ç‚¹ä¹è¶£*****

*****ä½œä¸ºè¿™ä¸ªç³»åˆ—çš„æœ€åä¸€ä¸ªç»ƒä¹ ï¼Œæˆ‘æƒ³åšä¸€äº›æœ‰è¶£çš„å›¾åƒé®ç½©ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡å›¾åƒåŠ æ³•æˆ–ä½è¿ç®—ç­‰ç®—æœ¯è¿ç®—å°†ä¸¤å¹…ä¸åŒçš„å›¾åƒç›¸åŠ ã€‚æ‰€ä»¥æˆ‘ä»¬æœ€åçš„ä»»åŠ¡æ˜¯æŠŠæˆ‘ä»¬çš„è èå…ˆç”Ÿç³»åœ¨ä¸€ä¸ªç”·äººçš„å·¦è‚©ä¸Šã€‚*****

```
*****# Import the large image
backpacker = cv2.imread('images/backpacker.jpg')
backpacker = cv2.cvtColor(backpacker, cv2.COLOR_BGR2RGB)
plt.imshow(backpacker)*****
```

*****![](img/cde113c815829d68a27d3c03ba962fc2.png)*****

*****æˆ‘ä»¬å°†ä»å¤§å›¾å’Œå°å›¾ä¸­å‰ªåˆ‡å‡ºæ„Ÿå…´è¶£çš„åŒºåŸŸ(è‚©éƒ¨),å¦‚ä¸‹æ‰€ç¤ºã€‚æ³¨æ„ï¼Œè¿™é‡Œä¸¤ä¸ªå›¾åƒçš„å¤§å°(å›¾åƒçš„é«˜åº¦å’Œå®½åº¦)åº”è¯¥æ˜¯ç›¸åŒçš„ã€‚*****

```
*****# Crop the small image and the roi
roi = backpacker[750:1150, 300:500]
img_2 = img[40:440, 80:280]plt.figure(figsize = (6, 6))
plt.subplot(1, 3, 1); plt.imshow(roi)
plt.subplot(1, 3, 3); plt.imshow(img_2)*****
```

*****![](img/5559ecf55ef243c01cff82da56638df4.png)*****

*****ä¸‹ä¸€æ­¥æ˜¯ä¸ºæ¯å¼ å›¾ç‰‡åˆ¶ä½œè’™ç‰ˆã€‚æˆ‘ä»¬è¦ç”¨æ©ç å®ç°ä½è¿ç®—ï¼Œæ©ç åº”è¯¥æ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶å›¾åƒã€‚é€šè¿‡å¯¹å°å›¾åƒ`img_2`è¿›è¡Œé˜ˆå€¼å¤„ç†ï¼Œæˆ‘ä»¬åˆ›å»ºäº†è’™ç‰ˆã€‚ç„¶åç”¨`cv2.bitwise_not()`ï¼Œæˆ‘ä»¬åˆ¶ä½œå¦ä¸€ä¸ªå’Œç¬¬ä¸€ä¸ªå®Œå…¨ç›¸åçš„é¢å…·ã€‚*****

```
*****# Creating the mask for the roi and small image
img_gray = cv2.cvtColor(img_2, cv2.COLOR_RGB2GRAY)
_, mask = cv2.threshold(img_gray, 254/2+100, 255, cv2.THRESH_BINARY)
mask_inv = cv2.bitwise_not(mask)plt.figure(figsize = (6, 6))
plt.subplot(1, 3, 1); plt.imshow(mask, cmap = 'gray')
plt.subplot(1, 3, 3); plt.imshow(mask_inv, cmap = 'gray')*****
```

*****![](img/abef8c38f9169660ce5d68cd25de7bd1.png)*****

*****å¦‚æœæˆ‘ä»¬å®ç°å‡½æ•°`cv2.bitwise_and()`å’Œé®ç½©ï¼Œå®ƒä»¬å°†åªé€šè¿‡å›¾åƒçš„ç™½è‰²åŒºåŸŸã€‚å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬å°†ç¬¬ä¸€ä¸ªè’™ç‰ˆåº”ç”¨äº`roi`å›¾åƒï¼Œæˆ‘ä»¬å¯ä»¥ä»å®ƒè®¾ç½®èƒŒæ™¯å›¾åƒã€‚åŒæ ·çš„ï¼Œå¦‚æœæˆ‘ä»¬å°†ç¬¬äºŒä¸ªåº”ç”¨åˆ°`img_2`å›¾åƒï¼Œæˆ‘ä»¬å¯ä»¥ç”¨æ°´æœåˆ¶ä½œå‰æ™¯å›¾åƒã€‚*****

```
*****# Masking 
img_bg = cv2.bitwise_and(roi, roi, mask = mask)
img_fg = cv2.bitwise_and(img_2, img_2, mask = mask_inv)
dst = cv2.add(img_fg, img_bg)plt.figure(figsize = (10, 6))
plt.subplot(1, 3, 1); plt.imshow(img_bg)
plt.subplot(1, 3, 2); plt.imshow(img_fg)
plt.subplot(1, 3, 3); plt.imshow(dst)*****
```

*****![](img/eda3880407ec9dbd5d4565247ebe7f41.png)*****

*****è€ƒè™‘åˆ°åº•éƒ¨çš„é˜´å½±ï¼Œç»“æœæœ‰ç‚¹æ··ä¹±ï¼Œä½†è®©æˆ‘ä»¬ä¿æŒå®ƒã€‚å¦‚æœä½ æƒ³äº†è§£ä½è¿ç®—æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œè¯¦ç»†çš„è§£é‡Šå¯ä»¥åœ¨ [**è¿™é‡Œ**](https://stackoverflow.com/questions/44333605/what-does-bitwise-and-operator-exactly-do-in-opencv) æ‰¾åˆ°ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å‡†å¤‡å°†è¿™ä¸ªç»„åˆå›¾åƒé™„åŠ åˆ°åŸå§‹å›¾åƒä¸Šã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•åœ°è¿™æ ·åšï¼Œå°†`dst`å›¾åƒæ”¾åœ¨`roi`ä½ç½®ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚*****

```
*****# Final output
backpacker[750:1150, 300:500] = dst
display(backpacker)*****
```

*****![](img/04f7e7ea23db6bc85752314f35a33b8b.png)*****

*****ğŸ˜„ğŸ‘‹ç¥ä½ å’ŒèƒŒåŒ…å®¢è¿‡å¾—æ„‰å¿«ï¼*****

# *****æ‘˜è¦*****

*****ä»ç¬¬ 1 éƒ¨åˆ†åˆ°ç¬¬ 4 éƒ¨åˆ†ï¼Œæˆ‘ä»¬å·²ç»å­¦ä¹ äº†å¾ˆå¤šå…³äºå›¾åƒå¤„ç†å’Œè®¡ç®—æœºè§†è§‰çš„åŸºç¡€çŸ¥è¯†ã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œä½ å–œæ¬¢è¿™äº›æ•™ç¨‹å—ï¼Ÿæˆ‘å¸Œæœ›åœ¨é˜…è¯»æœ¬ç³»åˆ—æ–‡ç« çš„åŒæ—¶ï¼Œæ‚¨å¯¹è¿™äº›æŠ€å·§æœ‰äº†ä¿¡å¿ƒã€‚*****

*****å¦‚æœæ‚¨å®Œå…¨æ˜¯å›¾åƒå¤„ç†çš„åˆå­¦è€…ï¼Œæœ€åˆä¸ç†Ÿæ‚‰ OpenCV å‡½æ•°çš„æœ¯è¯­å’Œç”¨æ³•æ˜¯æ­£å¸¸çš„ã€‚æœ€å¥½çš„ç»ƒä¹ æ–¹æ³•æ˜¯è‡ªå·±å®ç°æ‰€æœ‰è¿™äº›ã€‚é€‰æ‹©ä½ å–œæ¬¢çš„ä»»ä½•ç±»å‹çš„å›¾ç‰‡ï¼Œå¹¶ä»ä¸­è·å¾—ä¹è¶£ã€‚æ”¹å˜é¢œè‰²æ¨¡å¼ï¼Œæ—‹è½¬å’Œè°ƒæ•´å›¾åƒå¤§å°ï¼Œé®ç½©å¹¶ç²˜è´´åˆ°ä¸åŒçš„å›¾åƒä¸Šã€‚æˆ–è€…ä½ ä¹Ÿå¯ä»¥åº”ç”¨è¾¹ç¼˜ã€æ‹è§’å’Œè½®å»“çš„æ£€æµ‹æŠ€æœ¯ã€‚è™½ç„¶é€šè¿‡ç»„åˆå‡ ä¸ªé¢„å¤„ç†å’Œå°è¯•ä¸åŒçš„å‚æ•°æ¥è·å¾—ä¹è¶£ï¼Œä½†æ‚¨å¯ä»¥åœ¨æ²¡æœ‰æ„è¯†åˆ°çš„æƒ…å†µä¸‹æ›´å¿«åœ°ä¹ æƒ¯ OpenCV åº“ã€‚*****

# *****èµ„æº*****

*   *****[ç»´åŸºç™¾ç§‘ä¸Šçš„å›¾ç‰‡ç¬é—´](https://en.wikipedia.org/wiki/Image_moment)*****
*   *****[uda city ä¸Šçš„å½±åƒæ—¶åˆ»è¯¾ç¨‹](https://www.youtube.com/watch?v=AAbUfZD_09s&t=71s)*****
*   *****[ä½¿ç”¨ Hu çŸ©çš„å½¢çŠ¶åŒ¹é…(C++/Python)](https://www.learnopencv.com/shape-matching-using-hu-moments-c-python/)*****
*   *****[ä½¿ç”¨ OpenCV (C++/Python)æ‰¾åˆ°æ–‘ç‚¹çš„ä¸­å¿ƒ(è´¨å¿ƒ)](https://www.learnopencv.com/find-center-of-blob-centroid-using-opencv-cpp-python/)*****

*****æœ‰ä½ æƒ³æ”¹æ­£çš„é”™è¯¯å—ï¼Ÿè¯·ä¸æˆ‘ä»¬åˆ†äº«æ‚¨çš„è§è§£ã€‚æˆ‘æ€»æ˜¯ä¹äºäº¤è°ˆï¼Œæ‰€ä»¥è¯·åœ¨ä¸‹é¢ç•™ä¸‹è¯„è®ºï¼Œåˆ†äº«ä½ çš„æƒ³æ³•ã€‚æˆ‘è¿˜åœ¨ [**LinkedIn**](https://www.linkedin.com/in/jiwon-jeong/) ä¸Šåˆ†äº«æœ‰è¶£å’Œæœ‰ç”¨çš„èµ„æºï¼Œæ¬¢è¿éšæ—¶å…³æ³¨å¹¶è”ç³»æˆ‘ã€‚ä¸‹æ¬¡æˆ‘ä¼šå¸¦æ¥å¦ä¸€ä¸ªæœ‰è¶£çš„æ•…äº‹ã€‚ä¸€å¦‚æ—¢å¾€ï¼Œæ•¬è¯·å…³æ³¨ï¼ğŸ˜*****