<html>
<head>
<title>How to create plots with beautiful animation using gganimate.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用 gganimate 创建动画精美的剧情？</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-create-plots-with-beautiful-animation-using-gganimate-912f4279b073?source=collection_archive---------14-----------------------#2019-07-22">https://towardsdatascience.com/how-to-create-plots-with-beautiful-animation-using-gganimate-912f4279b073?source=collection_archive---------14-----------------------#2019-07-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/e0fa710e3440c8ea9682fa1a4e230f1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*t1dFLWRii-oeKSY_DbuU9A.gif"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">Total suicide rates per country</figcaption></figure></div><div class="ab cl kf kg hx kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="im in io ip iq"><p id="31c8" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated"><strong class="ko iu">引言。</strong></p><p id="cc67" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">可视化最重要的事情是当它迫使我们意识到一些我们不知道的事情。视觉上吸引人的图表很容易吸引我们的注意力。将数据动画化就像将生命吸入尘埃，这是一种创造的行为。你是如何创作出富有洞察力的吸引人的动画的？</p><p id="e812" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">在这篇文章中，我们将学习如何使用 R 包来创建漂亮的动画，<a class="ae lk" href="https://gganimate.com/" rel="noopener ugc nofollow" target="_blank"> gganimate </a>。</p><pre class="ll lm ln lo gt lp lq lr ls aw lt bi"><span id="30b1" class="lu lv it lq b gy lw lx l ly lz"><strong class="lq iu">#stable version of the package can be installed using </strong><em class="ma">install.packages(“gganimate”)</em> </span><span id="be5d" class="lu lv it lq b gy mb lx l ly lz"><strong class="lq iu">#latest development version can be obtained by</strong> <em class="ma">devtools::install_github(“thomasp85/gganimate”)</em>.</span></pre><p id="884b" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated"><strong class="ko iu">数据。</strong></p><p id="e09f" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">自杀率数据是从不同来源(世卫组织、联合国开发计划署、世界银行)汇编后从 Kaggle 获得的。该数据比较了 1985 年至 2016 年每个国家的社会经济信息和自杀率。灵感来自于不同国家的自杀预防策略。</p><p id="309b" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated"><strong class="ko iu">数据角力。</strong></p><p id="a2bd" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">我们将使用下面的代码来清理数据，并且只对我们将要处理的列进行子集化。</p><pre class="ll lm ln lo gt lp lq lr ls aw lt bi"><span id="910f" class="lu lv it lq b gy lw lx l ly lz"><strong class="lq iu">#loading required libraries</strong><br/>library(tidyverse)<br/>library(reshape2)<br/>library(ggthemes)<br/>library(gganimate)<br/>library(gifski)</span><span id="a516" class="lu lv it lq b gy mb lx l ly lz"><strong class="lq iu">#loading dataset</strong><br/>suicide_data&lt;-read.csv("./ARTICLES/suicide rates/master.csv",header = TRUE,stringsAsFactors = FALSE)</span><span id="6925" class="lu lv it lq b gy mb lx l ly lz"><strong class="lq iu">#selecting columns to work with</strong><br/>suicide_sub&lt;-suicide_data %&gt;% select("ï..country","year" ,"sex","suicides_no")  %&gt;% rename("country"="ï..country" )</span><span id="4b93" class="lu lv it lq b gy mb lx l ly lz"><strong class="lq iu">#function to sum the total suicide per country</strong><br/>n&lt;-unique(suicide_sub$country)<br/>country&lt;-function(x){<br/>  suicide2&lt;-suicide_sub %&gt;% filter(country==x)<br/>  sum(suicide2$suicides_no)<br/>}</span><span id="e8a5" class="lu lv it lq b gy mb lx l ly lz"><strong class="lq iu">#return a list with all total deaths per country</strong><br/>country_total&lt;-sapply(n,function(x) country(x))</span><span id="2017" class="lu lv it lq b gy mb lx l ly lz"><strong class="lq iu">#creating a dataframe with top 10 total suicides per country</strong><br/>df&lt;-do.call(rbind,Map(data.frame,Country=n,Total_Suicides=country_total))<br/>df2&lt;-df %&gt;% arrange(desc(Total_Suicides))<br/>df3&lt;-head(df2,n=10)<br/>write.csv(df3,"./ARTICLES/suicide rates/total_suicide.csv")</span><span id="fc54" class="lu lv it lq b gy mb lx l ly lz"><strong class="lq iu">#plotting the top 10 countries leading in the total suicide rates</strong><br/>ggplot(df3,aes(reorder(Country,Total_Suicides),Total_Suicides,fill=as.factor(Country)))+<br/>    geom_col()+<br/>    coord_flip(clip = "off", expand = FALSE)+<br/>    guides( fill = FALSE) +<br/>    labs(title="TOTAL SUICIDE DEATHS PER COUNTRY FROM 1985-2016", <br/>         y="Total Suicides Per Country", x="Country")+<br/>    scale_y_continuous(labels = scales::comma) +<br/>     geom_text(aes(label = paste(Total_Suicides,"")), hjust = 1)</span></pre><figure class="ll lm ln lo gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mc"><img src="../Images/1e07deaafd8d540878bd90900e1adca5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H11qoxoHyux2ytnZfiK85g.png"/></div></div></figure><pre class="ll lm ln lo gt lp lq lr ls aw lt bi"><span id="6a0f" class="lu lv it lq b gy lw lx l ly lz"><strong class="lq iu">#subset initial data with top 10 countries</strong><br/>top_suicide&lt;-suicide_sub%&gt;%filter(country==c(“Russian Federation”,”United States”,”Japan”,”France”,”Ukraine”,”Germany”,”Republic of Korea”,”Brazil”,”Poland”,”United Kingdom”))</span><span id="1e7a" class="lu lv it lq b gy mb lx l ly lz"><strong class="lq iu">#filtering years with consistent data</strong><br/>top_suicide2&lt;-top_suicide %&gt;% filter(year %in%c(1990:2014)) <br/>top_suicide2$sex&lt;-as.factor(top_suicide2$sex)</span><span id="7afe" class="lu lv it lq b gy mb lx l ly lz"><strong class="lq iu">#summing the total male &amp; female suicides per country for each year</strong><br/>sm3&lt;-aggregate(suicides_no~country+year,top_suicide2,sum)</span><span id="b939" class="lu lv it lq b gy mb lx l ly lz"><strong class="lq iu">#* 1 ensures we have non-integer ranks while sliding</strong><br/>sm4&lt;-sm3 %&gt;% group_by(year) %&gt;% mutate(rank = min_rank(-suicides_no) * 1) %&gt;%<br/> ungroup()</span></pre><p id="c0ad" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated"><strong class="ko iu">构建静态地块。</strong></p><p id="65b5" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">我们的数据现在已经可以绘图了。我们不打算深入使用 ggplot 的更多细节。使用 ggplot 的综合指南可在<a class="ae lk" href="https://github.com/hadley/ggplot2-book" rel="noopener ugc nofollow" target="_blank">这里</a>获得。</p><pre class="ll lm ln lo gt lp lq lr ls aw lt bi"><span id="6d87" class="lu lv it lq b gy lw lx l ly lz"><strong class="lq iu">#plotting static plot</strong><br/>static_plot&lt;-ggplot(sm4,aes(rank,group=country,fill=as.factor(country),color=as.factor(country))) +<br/> geom_tile(aes(y = suicides_no/2,<br/> height = suicides_no,<br/> width = 0.9), alpha = 0.8, color = NA) +<br/> geom_text(aes(y = 0, label = paste(country, “ “)), vjust = 0.2, hjust = 1) +<br/> geom_text(aes(y=suicides_no,label = paste(“ “,suicides_no)), hjust=0)+<br/> coord_flip(clip = “off”, expand = TRUE) +<br/> scale_y_continuous(labels = scales::comma) +<br/> scale_x_reverse() +<br/> guides(color = FALSE, fill = FALSE) +<br/> theme_minimal() +<br/> theme(<br/> plot.title=element_text(size=25, hjust=0.5, face=”bold”, colour=”grey”, vjust=-1),<br/> plot.subtitle=element_text(size=18, hjust=0.5, face=”italic”, color=”grey”),<br/> plot.caption =element_text(size=8, hjust=0.5, face=”italic”, color=”grey”),<br/> axis.ticks.y = element_blank(), <br/> axis.text.y = element_blank(), <br/> plot.margin = margin(1,1,1,4, “cm”)<br/> )</span></pre><p id="58d9" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated"><strong class="ko iu">动画。</strong></p><p id="912d" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated"><strong class="ko iu">gg animate 的关键特性是什么？</strong></p><p id="c2f3" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">1.<strong class="ko iu"> transition_ *: </strong>此函数定义数据应该如何分布，以及它如何随时间的推移与自身相关联。</p><p id="8967" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">a.<strong class="ko iu"> transition_reveal: </strong>这允许你让数据逐渐消失。</p><p id="ab32" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">b.<strong class="ko iu">转换时间:</strong>状态之间的转换长度被设置为对应于它们之间的实际时间差。</p><p id="1e24" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">c.<strong class="ko iu"> transition_state: </strong>用于通过分类变量或离散变量来激活图形。</p><p id="08ab" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">2.<strong class="ko iu"> view_ *: </strong>用于定义轴应该如何随动画变化。</p><p id="69fc" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">a.<strong class="ko iu">view _ follow(fixed _ y = TRUE):</strong>这意味着当动画运行时，y 轴是固定的。</p><p id="fee5" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">b.<strong class="ko iu">view _ follow(fixed _ x = TRUE)</strong>:当动画运行时，x 轴是固定的。</p><p id="54a3" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">3.<strong class="ko iu"> ease_aes(): </strong>它描述了在动画制作过程中应该如何缓和不同的美感。</p><p id="a61f" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">a.<strong class="ko iu"> ease_aes("立方进制出")</strong></p><p id="d99f" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">b.<strong class="ko iu"> ease_aes("正弦输入输出")</strong></p><p id="0b22" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">4.<strong class="ko iu"> enter_*/exit_ *: </strong>用于确定在动画过程中，新数据如何出现，旧数据如何消失。</p><p id="050d" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">a.<strong class="ko iu">进入 _ 淡出/退出 _ 收缩</strong></p><p id="ee35" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">5.<strong class="ko iu"> State_length: </strong>这是指状态暂停的相对长度。</p><p id="aa58" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">6.<strong class="ko iu">过渡 _ 长度:</strong>这是动画的相对长度。</p><pre class="ll lm ln lo gt lp lq lr ls aw lt bi"><span id="b9a5" class="lu lv it lq b gy lw lx l ly lz"><strong class="lq iu">#creating final animation</strong><br/>plt&lt;-static_plot + transition_states(states = year, transition_length = 4, state_length = 1) + <br/> ease_aes(‘cubic-in-out’) +<br/> #view_follow(fixed_x = TRUE) +<br/> labs(title = ‘Total Suicides per Year : {closest_state}’, <br/> subtitle = “Top 10 Countries”,<br/> caption = “Data Source: World Bank Data”,<br/> x=”Countries”,y=”Total Suicides per year”)</span></pre><p id="876b" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">7.<strong class="ko iu">渲染。</strong></p><p id="eaac" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">这是一种输出最终结果的计算。使用的参数包括:</p><p id="c831" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated"><strong class="ko iu"> nframes: </strong>设置要使用的帧数(默认为 100)。</p><p id="73d2" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated"><strong class="ko iu">每秒帧数(fps): </strong>这是每秒每帧花费的时间(默认为 10)</p><p id="7013" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated"><strong class="ko iu">渲染器:</strong>设置将每一帧合成动画的功能。(默认为 gifski_renderer())。</p><p id="d035" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">如果我们想结束循环，我们使用:<strong class="ko iu"><em class="ma">renderer = gif ski _ renderer(loop = FALSE)</em></strong>为了将动画情节保存为视频，我们使用<strong class="ko iu"><em class="ma">renderer = ffmpeg _ renderer()</em></strong></p><p id="fe2d" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">8.<strong class="ko iu">持续时间</strong>这是帧制作动画所需的总时间，即持续时间=30</p><p id="260b" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">9.<strong class="ko iu">布局。</strong></p><p id="4690" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">我们可以通过指定大小来改变绘图的高度和宽度</p><p id="8696" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">我们将动画输出保存到一个名为<strong class="ko iu"> <em class="ma"> final_animation 的对象中。</em> </strong></p><pre class="ll lm ln lo gt lp lq lr ls aw lt bi"><span id="1c3e" class="lu lv it lq b gy lw lx l ly lz"><strong class="lq iu">#rendering the animation for gif</strong><br/>final_animation&lt;-animate(plt,100,fps = 20,duration = 30, width = 950, height = 750, renderer = gifski_renderer())</span><span id="5da6" class="lu lv it lq b gy mb lx l ly lz"><strong class="lq iu">#rendering the animation for mp4<br/></strong>animate(plt,100,fps = 20,duration = 30, width = 950, height = 750, renderer = ffmpeg_renderer())</span></pre><p id="d63d" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">10。保存动画。</p><p id="3a08" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">为了保存我们的动画，我们将使用带有参数的函数<strong class="ko iu"> <em class="ma"> anim_save() </em> </strong>:</p><p id="b257" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated"><strong class="ko iu">动画</strong>——这是我们动画剧情的最终输出。</p><p id="b6c3" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">路径-我们想要保存动画的地方。</p><pre class="ll lm ln lo gt lp lq lr ls aw lt bi"><span id="2898" class="lu lv it lq b gy lw lx l ly lz"><strong class="lq iu">#saving the animation</strong><br/>anim_save(“./ARTICLES/suicide rates/suicide_animate.gif”,animation=final_animation)</span></pre><p id="a024" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated"><strong class="ko iu">输出。</strong></p><figure class="ll lm ln lo gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/e0fa710e3440c8ea9682fa1a4e230f1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*t1dFLWRii-oeKSY_DbuU9A.gif"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">Final animation output.</figcaption></figure><p id="fb37" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated"><strong class="ko iu">结论。</strong></p><p id="f85e" class="pw-post-body-paragraph km kn it ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj im bi translated">我们已经能够用动画软件包来显示每个国家的自杀率。你可以调整代码，以有效地动画任何数据集，并纳入自己的演示文稿，博客或网站。要获得更多关于创建动画的见解，你可以查看这篇<a class="ae lk" href="https://stackoverflow.com/questions/53162821/animated-sorted-bar-chart-with-bars-overtaking-each-other/53163549" rel="noopener ugc nofollow" target="_blank"> StackOverflow </a>指南或<a class="ae lk" rel="noopener" target="_blank" href="/how-to-do-that-animated-race-bar-chart-57f3a8ff27a8">关于数据科学</a>的文章。随意评论，分享，点赞。更多讨论，你可以通过<a class="ae lk" href="https://www.linkedin.com/in/brianmwangi/" rel="noopener ugc nofollow" target="_blank"> Linkedln </a>联系我。</p></div></div>    
</body>
</html>