<html>
<head>
<title>Build a Simple ChatBot with Python and Google Search</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 Python 和 Google Search 构建一个简单的聊天机器人</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/build-a-simple-chatbot-with-python-and-google-search-c000aa3f73f0?source=collection_archive---------1-----------------------#2019-09-01">https://towardsdatascience.com/build-a-simple-chatbot-with-python-and-google-search-c000aa3f73f0?source=collection_archive---------1-----------------------#2019-09-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/fe16e211abeaa02212f646517ffdbb56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2dfK1SVSJNNxuGm-sEYzbw.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">Build a Simple Python ChatBot from Scratch Using Google Search</figcaption></figure><p id="e26c" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">今天我们要构建一个 Python 3 聊天机器人 API 和 web 界面。聊天机器人很难构建，因为有无限多的输入。正因为如此，一个能够不断给出好答案的聊天机器人需要大量的知识。</p><p id="4ecf" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">开发人员通常会将机器学习算法、NLP 和预定义答案的语料库应用到他们的聊天机器人系统设计中。我们将保持我们的代码基本，所以我们将绕过为我们的聊天机器人创建一个复杂的“大脑”。</p><p id="e354" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">我们不会建立一个人工智能大脑，而是使用一个免费的和已经建立的大脑:谷歌搜索。</p><p id="4bb9" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">我们的聊天机器人将对用户的查询执行 Google 搜索，从第一个结果中抓取文本，并用该页面文本的第一句话回复用户。</p><p id="ab4c" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">我们开始吧！顺便说一下，所有提到的代码都在<a class="ae ld" href="https://github.com/lmzach09/Python_ChatBot_Google" rel="noopener ugc nofollow" target="_blank"> Python ChatBot GitHub 库</a>中。</p><h1 id="5b3d" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">用 Python 在 Google 中查询聊天机器人回复</h1><p id="6a68" class="pw-post-body-paragraph kf kg it kh b ki mc kk kl km md ko kp kq me ks kt ku mf kw kx ky mg la lb lc im bi translated">为了用 omniscience(无限知识)编写简单的聊天机器人，我们将在 Python API 中进行 Google 搜索。幸运的是，有一个<a class="ae ld" href="https://pypi.org/project/google/" rel="noopener ugc nofollow" target="_blank"> Google search Python 库</a>，我们可以用 pip 安装它。</p><p id="4311" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">在本地安装了 Google 库之后，您可以像这样编写 Python 代码:</p><figure class="mh mi mj mk gt ju"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="1eb4" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">一旦我们从搜索结果中获得了一个 URL 列表，我们就可以使用<a class="ae ld" href="https://pypi.org/project/requests/" rel="noopener ugc nofollow" target="_blank"> Python 请求库</a>对该网页进行 GET 请求。我们也可以通过使用来自<a class="ae ld" href="https://pypi.org/project/lxml/" rel="noopener ugc nofollow" target="_blank"> lxml </a>的<code class="fe mn mo mp mq b">html</code>和<a class="ae ld" href="https://pypi.org/project/beautifulsoup4/" rel="noopener ugc nofollow" target="_blank"> BeautifulSoup </a>来解析 HTML。</p><figure class="mh mi mj mk gt ju"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="7bc2" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">这个项目的所有 Python 依赖项都可以在 GitHub 存储库的<code class="fe mn mo mp mq b"><a class="ae ld" href="https://github.com/lmzach09/Python_ChatBot_Google/blob/master/requirements.txt" rel="noopener ugc nofollow" target="_blank">requirements.txt</a></code> <a class="ae ld" href="https://github.com/lmzach09/Python_ChatBot_Google/blob/master/requirements.txt" rel="noopener ugc nofollow" target="_blank">文件中找到。</a></p><p id="e37c" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">这是一个完整的文件，我们的 HTTP 服务器可以将它作为一个依赖项导入。我制作了一个方法，它可以进行 Google 搜索，获取网页上的第一个<code class="fe mn mo mp mq b">&lt;p&gt;</code>，并以字符串形式返回其内容。如果搜索以任何方式失败，聊天机器人将回复“对不起，我想不出答案。”</p><figure class="mh mi mj mk gt ju"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="9413" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">现在我们可以接受用户输入并进行谷歌搜索。我们将对搜索的第一个结果发出一个 HTTP GET 请求。然后我们解析返回的 HTML，分离出该页面上第一个<code class="fe mn mo mp mq b">&lt;p&gt;</code>中的第一句话。这是我们聊天机器人的回复算法，不需要机器学习。</p><h1 id="cb5e" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">一个简单聊天机器人的 Python API</h1><p id="ba55" class="pw-post-body-paragraph kf kg it kh b ki mc kk kl km md ko kp kq me ks kt ku mf kw kx ky mg la lb lc im bi translated">接下来，我们需要建立一个服务器应用程序，这将是我们的聊天机器人查询的 API。它将响应 HTTP 请求。首先，这些请求将来自一个简单的 HTML 页面，我们稍后会制作这个页面。</p><figure class="mh mi mj mk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mr"><img src="../Images/1b2d93bff1a9fc8d4b48f3e89fd51062.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cX-2tAV1Erqt8ti6cosFCA.png"/></div></div></figure><p id="80fd" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">首先，我们将导入 Python 3 HTTP 服务器和 socket 服务器库，以及我们之前创建的 Google 搜索文件。</p><figure class="mh mi mj mk gt ju"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="1090" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">我们的 API 将在端口 8080 上提供服务，我们将从项目的父目录中名为<code class="fe mn mo mp mq b">public</code>的文件夹中提供网页资产。接下来，我们将为 GET 和 POST 请求创建自己的处理程序。</p><p id="df80" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">HTTP GET 请求将尝试从<code class="fe mn mo mp mq b">public</code>文件夹中返回相应的文件。这些将是我们 web 浏览器界面的 HTML、CSS 和 JavaScript 文件。帖子请求将用于聊天机器人查询。</p><figure class="mh mi mj mk gt ju"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="001f" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">最后，我们将启动服务器并使用我们的处理程序。这是整个文件，包括上面的代码片段。</p><figure class="mh mi mj mk gt ju"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="9447" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">我们可以使用 CURL 来测试带有 POST 请求的聊天机器人 API。</p><pre class="mh mi mj mk gt ms mq mt mu aw mv bi"><span id="e9af" class="mw lf it mq b gy mx my l mz na">curl -d "how old is samuel l jackson" <a class="ae ld" href="http://localhost:8080" rel="noopener ugc nofollow" target="_blank">http://localhost:8080</a></span></pre><figure class="mh mi mj mk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nb"><img src="../Images/3a3085d1dda2577a1a74b680df11b2bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PB1ZABp-yz-QHyi4MOvuRg.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">Screenshot of POST request output of the ChatBot API</figcaption></figure><p id="e8b9" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">接下来我们将制作一个可以查询这个 API 的 HTML 页面。最终，我们将拥有一个端到端的聊天机器人，提供复杂的答案。</p><h1 id="2c12" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">构建聊天机器人网页</h1><p id="f72f" class="pw-post-body-paragraph kf kg it kh b ki mc kk kl km md ko kp kq me ks kt ku mf kw kx ky mg la lb lc im bi translated">我们的网页将非常简单。它将包含一个机器人的图片，一个文本输入字段和一个提交按钮。每当用户提交一个输入，chatbot API 就会通过 POST 请求到达。从 API 返回的文本答案将被填入网页。</p><p id="b206" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">这是 HTML 页面。将此作为<code class="fe mn mo mp mq b">index.html</code>保存在我们之前提到的<code class="fe mn mo mp mq b">public</code>文件夹中。机器人的图像文件也在完整的<a class="ae ld" href="https://github.com/lmzach09/Python_ChatBot_Google" rel="noopener ugc nofollow" target="_blank"> Python ChatBot GitHub 库</a>中。</p><figure class="mh mi mj mk gt ju"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="1a7b" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">接下来，我们将为这个网页做一些快速的样式。将这个 CSS 文件也保存在<code class="fe mn mo mp mq b">public</code>文件夹中。它已经在 HTML 文件的<code class="fe mn mo mp mq b">&lt;head&gt;</code>部分被引用。</p><figure class="mh mi mj mk gt ju"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="639b" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">现在，您应该有一个简单的聊天机器人网页可供用户输入。以下是截图:</p><figure class="mh mi mj mk gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nc"><img src="../Images/a29dcf5905e934e8d2ad78b597212182.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wAaot5372QAaPq-OK0QWsg.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">ChatBot Web Page Screenshot</figcaption></figure><p id="79ca" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">网页还没有完全为用户准备好。它需要 JavaScript。</p><p id="799a" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">我们将编写一些 JS 来检测用户按下回车键并点击提交按钮。当这些事件中的任何一个发生时，我们将获得用户输入字段中的文本，并将其作为我们的 Python 服务器的 POST 主体。</p><p id="c129" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">我们将使用<code class="fe mn mo mp mq b">fetch</code>方法向 Python API 服务器发出 HTTP POST 请求。现代网络浏览器现在默认包含了获取 API 。</p><p id="23b9" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">这是我们与 3 个 HTML 元素交互的简单 JavaScript。将此作为<code class="fe mn mo mp mq b">app.js</code>保存在<a class="ae ld" href="https://github.com/lmzach09/Python_ChatBot_Google/tree/master/public" rel="noopener ugc nofollow" target="_blank">公共文件夹</a>中。</p><figure class="mh mi mj mk gt ju"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="63a1" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">我们几乎准备好将我们的 Python 聊天机器人投入生产了。</p><h1 id="b0cd" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">运行我们从头开始制作的简单 Python 聊天机器人</h1><p id="3244" class="pw-post-body-paragraph kf kg it kh b ki mc kk kl km md ko kp kq me ks kt ku mf kw kx ky mg la lb lc im bi translated">现在我们已经写完了所有的代码，在运行全栈 Python 聊天机器人之前，我们还有一个步骤。如果还没有，在项目的父目录中创建一个<code class="fe mn mo mp mq b">requirements.txt</code> <a class="ae ld" href="https://github.com/lmzach09/Python_ChatBot_Google/blob/master/requirements.txt" rel="noopener ugc nofollow" target="_blank">文件，与 2 个 Python 文件放在一起。该文件是一个 Python 范例，用于轻松安装项目的依赖项。</a></p><figure class="mh mi mj mk gt ju"><div class="bz fp l di"><div class="ml mm l"/></div></figure><p id="1d17" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">使用命令行转到 ChatBot 项目的父目录。运行 Python 库安装命令。</p><pre class="mh mi mj mk gt ms mq mt mu aw mv bi"><span id="0707" class="mw lf it mq b gy mx my l mz na">pip install -r requirements.txt</span></pre><p id="c8f7" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">您的机器现在拥有运行聊天机器人所需的所有库！让我们运行全栈应用程序。</p><pre class="mh mi mj mk gt ms mq mt mu aw mv bi"><span id="83c4" class="mw lf it mq b gy mx my l mz na">python server.py</span></pre><p id="5a63" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">接下来打开你的网络浏览器，进入<a class="ae ld" href="http://localhost:8080/" rel="noopener ugc nofollow" target="_blank"> http://localhost:8080/ </a>。如果你看到聊天机器人的图像，它正在工作。</p><p id="0dcb" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">尝试一些输入！</p><blockquote class="nd ne nf"><p id="9938" class="kf kg ng kh b ki kj kk kl km kn ko kp nh kr ks kt ni kv kw kx nj kz la lb lc im bi translated">谁扮演了钢铁侠</p><p id="2316" class="kf kg ng kh b ki kj kk kl km kn ko kp nh kr ks kt ni kv kw kx nj kz la lb lc im bi translated">塞缪尔·杰克逊多大了</p><p id="1e87" class="kf kg ng kh b ki kj kk kl km kn ko kp nh kr ks kt ni kv kw kx nj kz la lb lc im bi translated">火星上的天气怎么样</p></blockquote><p id="061c" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">你可以看到，我们的聊天机器人回复并不完美，但对于几分钟的工作来说已经很不错了。</p><p id="10f0" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">我会继续用 Python 探索 AI 和机器学习，我会分享我的发现。<a class="ae ld" href="https://medium.com/@lelandzach" rel="noopener">查看我的媒体页面</a>的 JavaScript、<a class="ae ld" href="https://medium.com/@lelandzach/dart-isolate-2-way-communication-89e75d973f34" rel="noopener"> Dart </a>和 Python 指南。</p></div></div>    
</body>
</html>