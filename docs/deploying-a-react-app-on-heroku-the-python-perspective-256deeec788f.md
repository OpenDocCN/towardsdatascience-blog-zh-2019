# åœ¨ Heroku ä¸Šéƒ¨ç½² React åº”ç”¨ç¨‹åº:Python è§†è§’

> åŸæ–‡ï¼š<https://towardsdatascience.com/deploying-a-react-app-on-heroku-the-python-perspective-256deeec788f?source=collection_archive---------14----------------------->

## å¦‚ä½•éƒ¨ç½²ä¸ Flask åç«¯é…å¯¹çš„ React å‰ç«¯

![](img/7677413a1633f7c86df36feeca8feff5.png)

Heroku æ¥è‡ª Python èƒŒæ™¯ï¼Œæ˜¯ä¸€ä¸ªéå¸¸é€‚åˆéƒ¨ç½²çš„åœ°æ–¹ã€‚æˆ‘æœ‰å„ç§å„æ ·çš„é™æ€å’ŒåŸºäº Flask çš„ç½‘ç«™ï¼Œè¿™äº›ç½‘ç«™é…ç½®èµ·æ¥å¾ˆç®€å•ï¼Œå¹¶ä¸”å¾ˆå®¹æ˜“ä¸ Github é›†æˆï¼Œä»¥å®ç°å¹³ç¨³çš„æŒç»­éƒ¨ç½²ã€‚è¿™ç¯‡æ–‡ç« æ˜¯*è€Œä¸æ˜¯*å…³äºä½¿ç”¨çƒ§ç“¶éƒ¨ç½²çš„â€”â€”[Heroku æŒ‡å—](https://devcenter.heroku.com/articles/deploying-python)å¯¹æ­¤å¾ˆæœ‰å¸®åŠ©ï¼Œä½ å¯ä»¥åœ¨è¿™é‡Œ[å’Œè¿™é‡Œ](https://github.com/archydeberker/ski-monitor)å’Œ[çœ‹åˆ°ä¸€äº›ä¾‹å­ã€‚](https://github.com/archydeberker/burnsbot)

åœ¨æˆ‘æœ€è¿‘çš„é¡¹ç›®ä¸­ï¼Œæˆ‘å­¦ä¹ äº† Javascriptâ€”â€”ç‰¹åˆ«æ˜¯ï¼Œ [React](https://reactjs.org/tutorial/tutorial.html) (å¦‚æœä½ æƒ³åšåŒæ ·çš„äº‹æƒ…ï¼Œæˆ‘å‘ç° [Flavio Copes](https://flaviocopes.com) åšå®¢å¾ˆæœ‰å¸®åŠ©)ã€‚è¿™å¸¦æ¥äº†ä¸€ç³»åˆ—ä»¤äººçœ¼èŠ±ç¼­ä¹±çš„æ–°å•è¯è¦å­¦ä¹ ï¼Œè®¸å¤šä¸åŒçš„æ–¹æ³•æ¥åšåŒæ ·çš„äº‹æƒ…(ä¸ Python çš„æ³•åˆ™ç›¸å)ï¼Œä»¥åŠè®©æˆ‘è¿·æƒ‘ä¸è§£çš„å¼‚æ­¥èŒƒä¾‹ã€‚

æˆ‘æ­£åœ¨ç”¨ Flask åç«¯æ„å»ºä¸€ä¸ª React åº”ç”¨ç¨‹åºã€‚åœ¨é»‘è¿›äº†æœ¬åœ°çœ‹èµ·æ¥åˆç†çš„ä¸œè¥¿å¹¶éƒ¨ç½²äº†åç«¯ä¹‹åï¼Œæˆ‘å¼€å§‹å’Œæˆ‘ä¿¡ä»»çš„æœ‹å‹ Heroku ä¸€èµ·éƒ¨ç½² React éƒ¨åˆ†ã€‚è¿™å°±æ˜¯éº»çƒ¦å¼€å§‹çš„åœ°æ–¹ã€‚

# **æˆ‘ç”¨ä»€ä¹ˆæ¥æœåŠ¡ä¸€ä¸ª React appï¼Ÿ**

æˆ‘æ˜¯æ•°æ®ç§‘å­¦å®¶ï¼Œä¸æ˜¯å¼€å‘äººå‘˜ï¼Œæ‰€ä»¥æˆ‘å’ŒæœåŠ¡å™¨çš„å…³ç³»æ˜¯åŠŸåˆ©çš„ã€‚Flask ç»™äº†æˆ‘ä¸€ä¸ªè½»é‡çº§çš„ Python æœåŠ¡å™¨ï¼Œå¦‚æœæˆ‘è¯¯ä»¥ä¸ºæˆ‘çš„ç½‘ç«™ä¼šæœ‰å¤§æµé‡ï¼Œæˆ‘å¯ä»¥å‡çº§åˆ°`gunicorn`ã€‚å½“æˆ‘éƒ¨ç½²åˆ° Heroku æ—¶ï¼Œæˆ‘å¯ä»¥ä½¿ç”¨ä¸€ä¸ª`[Procfile](https://devcenter.heroku.com/articles/procfile)`æ¥å‘Šè¯‰ Heroku è¿è¡Œä»€ä¹ˆå‘½ä»¤æ¥æœåŠ¡æˆ‘çš„åº”ç”¨ç¨‹åºâ€”â€”é€šå¸¸æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œç¨‹åºã€‚å¹¸è¿çš„æ˜¯ï¼Œæˆ‘ç”¨æ¥åœ¨æœ¬åœ°è¿è¡Œæˆ‘çš„åº”ç”¨ç¨‹åºçš„å‘½ä»¤å’Œ Heroku ä½¿ç”¨çš„å‘½ä»¤æ˜¯ç›¸åŒçš„:

```
python app.py
```

ä½†æ˜¯ React çš„ç­‰ä»·è¯æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ

å½“æ‚¨åœ¨æœ¬åœ°å¼€å‘æ—¶ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ç±»ä¼¼ä»¥ä¸‹çš„å†…å®¹:

```
npm run start
```

æ¥è¿è¡Œæ‚¨çš„å¼€å‘æœåŠ¡å™¨ï¼Œä½†æ˜¯ç¨å¾®æœç´¢ä¸€ä¸‹å°±ä¼šå‘ç°æ²¡æœ‰äººç”¨å®ƒæ¥ä¸ºç”Ÿäº§æœåŠ¡ã€‚ç›¸åï¼Œæœ‰å¾ˆå¤šå…³äºæ‰€è°“çš„`Express.js`çš„è®¨è®ºã€‚

## **express . js åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ**

Express å°†è‡ªå·±æè¿°ä¸ºâ€œNode.js çš„å¿«é€Ÿã€éä¸ªæ€§åŒ–ã€æç®€ä¸»ä¹‰çš„ç½‘ç»œæ¡†æ¶â€ã€‚æ‰€æœ‰è¿™äº›å¬èµ·æ¥å¯¹æˆ‘æ¥è¯´éƒ½å¾ˆå¥½ï¼Œä½†æˆ‘çœŸçš„ä¸åœ¨ä¹â€”â€”æˆ‘åªæ˜¯æƒ³è¦ä¸€äº›å…è®¸å…¶ä»–äººçœ‹åˆ°æˆ‘åœ¨æœ¬åœ°è¿è¡Œ`npm run start` æ—¶çœ‹åˆ°çš„ä¸œè¥¿ã€‚

äº‹å®è¯æ˜ï¼Œå¯¹æ­¤ä½¿ç”¨ Express æ˜¯å®Œå…¨æ²¡æœ‰å¿…è¦çš„ï¼Œå°½ç®¡æœ‰è®¸å¤šå…³äºå®ƒçš„åšå®¢æ–‡ç« ã€‚

å›°æƒ‘çš„äº§ç”Ÿæ˜¯å› ä¸ºå¾ˆå¤šäººä¹Ÿå¯¹åŸºäº Javascript éƒ¨ç½²åç«¯æ„Ÿå…´è¶£ï¼Œæ‰€ä»¥å¾ˆå¤šå…³äºéƒ¨ç½² JS çš„æ™®é€šå»ºè®®éƒ½æ˜¯åŸºäºå¯ä»¥æœåŠ¡å‰ç«¯å’Œåç«¯èµ„äº§çš„æœåŠ¡å™¨ã€‚ä½†æ˜¯ä½ ï¼Œæˆ‘çš„æœ‹å‹ï¼Œå·²ç»æœ‰äº†ä¸€ä¸ªåç«¯ï¼Œç”±å¯ä¿¡çš„ Flask æä¾›æœåŠ¡:æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åšæŒä¸€äº›æ›´ç®€å•çš„ä¸œè¥¿ã€‚

## **æœåŠ¡ä¸€ä¸ªååº”å‰ç«¯**

React ä¸­å¤§å¤šæ•°æ—…ç¨‹çš„å®é™…èµ·ç‚¹`create-react-app`å»ºè®®ï¼Œå¦‚æœä½ åœ¨æä¾›ä¸€ä¸ªâ€œé™æ€åº”ç”¨â€ï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸€ä¸ªå«åš`serve`çš„ä¸œè¥¿ï¼Œè¿™ç›¸å½“äºä¸€ä¸ªä¸¤è¡Œç¨‹åº:

```
npm install -g serve
serve -s build
```

è¿™å¯¹æˆ‘æ¥è¯´å¬èµ·æ¥ç›¸å½“ä¸é”™ï¼Œé™¤äº†æˆ‘ä¸ç¡®å®šæˆ‘æ˜¯å¦åœ¨æœåŠ¡ä¸€ä¸ªâ€œé™æ€åº”ç”¨ç¨‹åºâ€ï¼Œåœ¨æˆ‘çœ‹æ¥è¿™æ˜¯ç”±å‡ ä¸ª HTML é¡µé¢ç»„æˆçš„ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªæ‰€æœ‰äººéƒ½åœ¨å”±æ­Œæ‰€æœ‰äººéƒ½åœ¨è·³èˆçš„ React åº”ç”¨ç¨‹åºï¼Œåœ¨å•†åº—é‡Œåˆ°å¤„éƒ½æœ‰æ—‹è½¬çš„å°å‘æ˜å’Œè·³è·ƒçš„æ¨¡æ€ã€‚

ä½†æ˜¯ä»”ç»†æƒ³æƒ³ï¼Œæˆ‘çš„åº”ç”¨ç¨‹åºç¡®å®æ˜¯é™æ€çš„ã€‚å¦‚æœä½ åœ¨ Flask ä¸­åˆ›å»ºä¸€ä¸ªåç«¯ï¼Œè€Œä½ çš„ React åº”ç”¨ä»…ä»…æ˜¯ä¸€ä¸ªå‰ç«¯ï¼Œé‚£ä¹ˆä½ çš„åº”ç”¨æ˜¯é™æ€çš„ã€‚ä»éƒ¨ç½²çš„è§’åº¦æ¥çœ‹ï¼Œè¿™æ˜¯ä¸ªå¥½æ¶ˆæ¯ã€‚

æ—ç™½:`serve`æ˜¯æ¥è‡ª [ZEIT](https://zeit.co) çš„ä¸€ä¸ªåº“ï¼Œä»–ä»¬å®é™…ä¸Šæœ‰ä¸€ä¸ª Heroku çš„ç«äº‰å¯¹æ‰‹å«`now`ï¼Œå®ƒå·²ç»è·å¾—äº†ä¸€äº›éå¸¸æœ‰åˆ©çš„[å†™](https://www.google.com/search?client=safari&rls=en&q=NOW+vs.+heroku&ie=UTF-8&oe=UTF-8)å†™ [ups](https://www.benstanfield.io/projects/deploy.html) ï¼Œå¯èƒ½å€¼å¾—ä»”ç»†çœ‹çœ‹ã€‚

## **æœ€åä¸€å…¬é‡Œ**

éœ€è¦ä¸€äº›å°çš„ä¿®æ­£æ¥è®©è¿™ä¸ª**åœ¨æœ¬åœ°**å·¥ä½œ:

1.  `serve`å°†æœåŠ¡äºå·²ç»æ„å»ºçš„ä»»ä½•ä¸œè¥¿ï¼Œè€Œä¸æ˜¯æ‚¨çš„å¼€å‘ä»£ç ï¼Œæ‰€ä»¥è¯·ç¡®ä¿æ‚¨å·²ç»è¿è¡Œäº†`npm run build`æ¥å°†æ‚¨çš„ Javascript ç¼–è¯‘æˆéƒ¨ç½²ç‰ˆæœ¬ã€‚å¦‚æœæ‚¨åƒæˆ‘ä¸€æ ·æ¥è‡ª Python èƒŒæ™¯ï¼Œæ‚¨ä¼šå¿˜è®°è¿™æ ·åšï¼Œå¹¶ä¸”æƒ³çŸ¥é“å½“æ‚¨åœ¨æœ¬åœ°æµ‹è¯•ç³»ç»Ÿæ—¶ï¼Œä¸ºä»€ä¹ˆå¯¹ä»£ç çš„æ›´æ”¹æ²¡æœ‰åæ˜ åœ¨æ‚¨çš„æµè§ˆå™¨ä¸­ã€‚
2.  å¦‚æœæ‚¨ä½¿ç”¨`npm`éµå¾ªäº† [create-react-app](https://create-react-app.dev) æ¡†æ¶ï¼Œæ‚¨å¯èƒ½å·²ç»å‘æ‚¨çš„`package.json`æ·»åŠ äº†ä¸€ä¸ª`proxy`å­—æ®µï¼Œè¿™å…è®¸æ‚¨é€šè¿‡ç±»ä¼¼`/api/v1`çš„è·¯å¾„è®¿é—®æ‚¨çš„ APIï¼Œè€Œä¸æ˜¯æ˜¾å¼åœ°æŒ‡å®šä¸»æœºã€‚è™½ç„¶[æ˜¾ç„¶åœ¨`serve`ä¸­æœ‰ä¸€äº›åŠŸèƒ½](https://github.com/zeit/serve/issues/315)æ¥å¤åˆ¶å®ƒï¼Œä½†æˆ‘æ— æ³•è®©å®ƒå·¥ä½œï¼Œæ‰€ä»¥æˆ‘åªæ˜¯å®šä¹‰äº†ä¸€ä¸ªç¯å¢ƒå˜é‡å¹¶ä½¿ç”¨å®ƒ([è§æœ¬æŒ‡å—](https://medium.com/@trekinbami/using-environment-variables-in-react-6b0a99d83cf5))ã€‚

æœ€åï¼Œè®© Heroku**çš„ä¸œè¥¿é£èµ·æ¥**(å¦‚æœä½ ä¸ç†Ÿæ‚‰ Heroku çš„ Github å·¥ä½œæµç¨‹ï¼Œæˆ‘çœŸçš„æ¨èä½ ï¼Œ[çœ‹çœ‹ä»–ä»¬çš„å¿«é€Ÿå…¥é—¨](https://devcenter.heroku.com/articles/git)):

1.  æ¥è‡ª`create-react-app`çš„æ–‡æ¡£å°†`serve`ä¸`npm install -g serve`ä¸€èµ·å®‰è£…ï¼Œä½†æ˜¯æ‚¨å®é™…ä¸Šæƒ³è¦ä½¿ç”¨`npm install serve --save`å°†å…¶æ·»åŠ åˆ°æ‚¨çš„ç”Ÿäº§ä¾èµ–é¡¹ä¸­(æˆ‘èŠ±äº†ä¸€æ®µæ—¶é—´è¯•å›¾å¼„æ¸…æ¥šä¸ºä»€ä¹ˆ Heroku ä¼šå› ä¸ºç¼ºå°‘`serve`ä¾èµ–é¡¹è€Œå´©æºƒ)ã€‚
2.  ä¸€æ—¦ Heroku æ„è¯†åˆ°ä½ å·²ç»è·å¾—äº†ä¸€ä¸ª NPM åº”ç”¨ç¨‹åº(ç”±æ£€æµ‹åˆ°ä¸€ä¸ª`package.json`è§¦å‘)ï¼Œå®ƒå°†å°è¯•ç”¨`npm run build`æ„å»ºä½ çš„åº”ç”¨ç¨‹åºï¼Œç„¶åç”¨`npm run start`è¿è¡Œå®ƒã€‚ä¸ºäº†è®©åè€…å·¥ä½œï¼Œæ‚¨éœ€è¦å°†é»˜è®¤çš„`create-react-app`ä»

```
â€œscriptsâ€: {â€œstartâ€: â€œreact-scripts startâ€, ...
```

åˆ°

```
â€œscriptsâ€: {â€œdevâ€: â€œreact-scripts startâ€, â€œstartâ€: â€œserve -s buildâ€,
```

ç„¶åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨`npm run dev`åœ¨æœ¬åœ°è¿è¡Œæ‚¨çš„å¼€å‘æœåŠ¡å™¨ï¼Œä½†æ˜¯ Heroku å°†èƒ½å¤Ÿåœ¨è°ƒç”¨`npm run start`æ—¶è¿è¡Œæ‚¨çš„ç”Ÿäº§æœåŠ¡å™¨ã€‚

æœ€åï¼Œå¦‚æœä½ æŒ‰ç…§æˆ‘çš„å»ºè®®ç”¨`ENV`æ¥è®¾ç½®ä½ çš„åç«¯ URLï¼Œç¡®ä¿é€šè¿‡`Settings > Config Vars`åœ¨ Heroku ä¸­è®¾ç½® envã€‚

ç†è®ºä¸Šå°±æ˜¯è¿™æ ·ï¼ä½ å¯ä»¥åœ¨ [this repo](https://github.com/archydeberker/wildly-monitor/tree/deploy-static) çš„ React åº”ç”¨ä¸­çœ‹åˆ°è¿™æ˜¯ä»€ä¹ˆæ ·å­ã€‚å¦‚æœæ‚¨å¯¹æ­¤å·¥ä½œæµç¨‹æœ‰ä»»ä½•é—®é¢˜ï¼Œæˆ–è€…æ‚¨æ‰¾åˆ°äº†åœ¨ Heroku ä¸Šéƒ¨ç½² React åº”ç”¨ç¨‹åºçš„æ›´ç®€å•æ–¹æ³•ï¼Œè¯·å‘Šè¯‰æˆ‘ğŸ¤–ğŸ‰ğŸ‘¯â€â™€ï¸