<html>
<head>
<title>Illustrating Predictive Models with the ROC Curve</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 ROC 曲线说明预测模型</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/illustrating-predictive-models-with-the-roc-curve-67e7b3aa8914?source=collection_archive---------11-----------------------#2019-06-30">https://towardsdatascience.com/illustrating-predictive-models-with-the-roc-curve-67e7b3aa8914?source=collection_archive---------11-----------------------#2019-06-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/dff3d2ea2fa13bc031430255c41f061e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*brnaZvg49_WDFwJFFt3CuQ.png"/></div></div></figure><p id="608e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">数据科学是一个在过去几年中真正成长起来的术语，似乎每个人都想加入进来。最有吸引力的目标之一是利用数据资产的力量来创建能够预测各种结果的机器学习模型。有了一个定义良好的模型，人们可以确定能够预测结果的最具影响力的因素，为战略假设开发有价值的洞察力，甚至可以通过友好的用户界面将模型的逻辑实现到软件应用程序中。</p><p id="0a4f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然而，在这种神奇的事情发生之前，我们需要知道这个模型所创造的预测是否是好的！例如，如果我们的电子邮件程序的垃圾邮件分类器只能检测到 50%的不受欢迎的电子邮件或请求，我们都会非常愤怒。在这篇文章中，我将介绍如何使用每个数据科学家都应该熟悉的经典工具来评估预测模型:<strong class="ka ir">接收器工作特性(ROC)曲线</strong>。</p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h2 id="6a9a" class="ld le iq bd lf lg lh dn li lj lk dp ll kj lm ln lo kn lp lq lr kr ls lt lu lv bi translated">说明性的例子:预测冠心病</h2><p id="4ad1" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">我在这篇文章中使用的数据集来自 Bom 等人的“靶向蛋白质组学对疑似冠心病患者冠状动脉斑块形态的预测价值”，公众可以通过 https://data.mendeley.com/datasets/gdfvxvr7f2/1<a class="ae mb" href="https://data.mendeley.com/datasets/gdfvxvr7f2/1" rel="noopener ugc nofollow" target="_blank">获得。</a></p><p id="8168" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这项研究检查了两种不同的结果，我在这篇文章中重点关注的是没有冠状动脉疾病(CAD)。作者评估了蛋白质组生物标志物检测有症状患者是否存在 CAD 的预测能力。识别一组能够区分非冠心病患者和需要立即干预的患者的蛋白质将提供更准确和成本有效的非侵入性诊断测试。</p><p id="4bbe" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这个数据集是测试几个数据科学主题的绝佳来源。对于少量的观察值，很容易处理，但是它也包含了大量的变量，增加了复杂性。一个可行的“金标准”的结果(使用冠状动脉计算机断层血管造影，或 CCTA)是用来测试预测。在这篇文章中，我将主要关注单个模型的 ROC 曲线的构建，但在后面的文章中，我可能会深入到更高级的主题。</p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="6983" class="mc le iq bd lf md me mf li mg mh mi ll mj mk ml lo mm mn mo lr mp mq mr lu ms bi translated">预测精度测量概述</h1><p id="b6cf" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">在开始创建曲线之前，了解一些评估预测准确性的常用指标很重要。</p><p id="57c8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">正类:</strong>我将把正类定义为我试图检测的结果类。在这种情况下，就是 CAD 的<strong class="ka ir"> <em class="mt">缺席</em>。虽然我意识到这可能会导致诊断测试领域中术语“阳性”和“阴性”的混淆，但是以这种方式定义阳性类更适用于其他情况。</strong></p><p id="e36f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这种情况下，处理有症状患者的默认方法是让他们接受进一步的测试和程序。通过充分检测没有冠心病的患者，我们将不再需要不必要的、更具侵入性的手术。</p><p id="e731" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一般准确性:简单来说，有多少受试者被正确分类？</p><p id="a699" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">灵敏度:</strong>正确识别的真阳性的比例。在这种情况下，由诊断工具正确识别的健康患者的比例。这有时被称为“召回”</p><ul class=""><li id="db3d" class="mu mv iq ka b kb kc kf kg kj mw kn mx kr my kv mz na nb nc bi translated">SN =真阳性/(真阳性+假阴性)</li><li id="3c07" class="mu mv iq ka b kb nd kf ne kj nf kn ng kr nh kv mz na nb nc bi translated">逆(1-灵敏度)= <strong class="ka ir">假阴性率</strong>。该工具未检测到的健康患者被错误地识别为患有 CAD。假阴性也被称为第二类错误。</li></ul><p id="b927" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">特异性:</strong>正确识别的真阴性的比例。在这种情况下，诊断工具正确识别的 CAD 患者的比例。</p><ul class=""><li id="37fa" class="mu mv iq ka b kb kc kf kg kj mw kn mx kr my kv mz na nb nc bi translated">SP =真阴性/(真阴性+假阳性)</li><li id="1943" class="mu mv iq ka b kb nd kf ne kj nf kn ng kr nh kv mz na nb nc bi translated">逆(1-特异性)= <strong class="ka ir">假阳性率</strong>。冠心病患者被错误地认定为无冠心病。假阳性也称为 I 型错误。</li></ul><p id="0538" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">阳性预测值:</strong>工具报告的阳性结果的比例，实际上是阳性的。对于诊断工具报告没有 CAD 的患者组，PPV 是实际上没有该疾病的患者的比例。这有时被称为“精度”</p><ul class=""><li id="8557" class="mu mv iq ka b kb kc kf kg kj mw kn mx kr my kv mz na nb nc bi translated">PPV =真阳性/(真阳性+假阳性)</li></ul><p id="8722" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">阴性预测值:</strong>工具报告的阴性比例，实际上是阴性的。对于诊断工具报告存在 CAD 的患者组，NPV 是实际上没有 CAD 的患者的比例。</p><ul class=""><li id="eae2" class="mu mv iq ka b kb kc kf kg kj mw kn mx kr my kv mz na nb nc bi translated">NPV =真阴性/(真阴性+假阴性)</li></ul><p id="0274" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你在试图整理所有这些指标时头疼，不要担心。很容易混淆这些术语，尤其是在第一次学习它们的时候。我发现在一个 2x2 的表格中可视化事物是最容易的。</p><figure class="nj nk nl nm gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ni"><img src="../Images/a857d7951f935347523ca91597118e07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VyH0_41xjhkCPmOhh7_O8g.png"/></div></div><figcaption class="nn no gj gh gi np nq bd b be z dk">Confusion Matrix for a Binary Class ( positive = absence of CAD, negative = CAD)</figcaption></figure></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="b2cb" class="mc le iq bd lf md me mf li mg mh mi ll mj mk ml lo mm mn mo lr mp mq mr lu ms bi translated">曲线的剖析</h1><p id="fcdc" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">ROC 曲线的好处在于，它是一个易于解释的图形工具，可以应用于您创建的任何预测模型。以下是曲线的基础:</p><h2 id="4a43" class="ld le iq bd lf lg lh dn li lj lk dp ll kj lm ln lo kn lp lq lr kr ls lt lu lv bi translated">坐标轴:灵敏度和假阳性率</h2><p id="3ebf" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">首先，我们需要为情节创造空间。ROC 曲线是通过绘制灵敏度对 1-特异性(或假阳性率)的曲线建立的。</p><figure class="nj nk nl nm gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nr"><img src="../Images/0f35b052d752591681ad9f53bad3d963.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ukk6V0o3qzMbFiO1qHv33w.png"/></div></div></figure><h2 id="c72a" class="ld le iq bd lf lg lh dn li lj lk dp ll kj lm ln lo kn lp lq lr kr ls lt lu lv bi translated">预测概率</h2><p id="8b20" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">现在我们需要一些东西来绘制。回想一下，预测模型会将每个观察值分配到最可能的类别(在这种情况下，没有 CAD 对有 CAD)。模型实际上做的是计算属于特定类别的概率。临界值在 0 和 1 之间选择，如果计算出的概率超过该阈值，则该观察值被分配给该类。</p><figure class="nj nk nl nm gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ns"><img src="../Images/1e04eb62b1c50f3f6a347faa9ae82c79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M2W5aJzhJyKr-fSShzJw0g.png"/></div></div></figure><p id="d0e7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可能会发现，在大多数包中，默认的截止值被设置为 0.5，其逻辑是，在二进制类中，人们会将一个观察值分配给一个最有可能的类。然而，正如我们将会看到的，最好在考虑到敏感性和特异性之间的权衡之后选择临界值。</p><p id="1aed" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">ROC 曲线是通过绘制所有可能的临界值生成的，临界值是分配给每个观察值的概率。选择不同的临界值将改变预测工具的灵敏度和特异性，因此，可以使用相关的灵敏度和 1-特异性作为坐标，在图的空间中绘制每个截止概率。最靠近左上角的点(SN = 1，FPR = 0)在精度指标之间提供了最大的平衡。</p><h2 id="d385" class="ld le iq bd lf lg lh dn li lj lk dp ll kj lm ln lo kn lp lq lr kr ls lt lu lv bi translated">曲线下面积</h2><p id="eb29" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">AUC 是一种类似于二元模型的一致性或 c 统计量的指标。这是正类中的观察比负类中的观察具有更大预测概率的概率。</p><figure class="nj nk nl nm gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ns"><img src="../Images/3ad0f553f2e53496fd85a96f86f18f4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-bvqKvwxdFp_rFHQzggwpw.png"/></div></div></figure><p id="27ae" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果 AUC = 1，这意味着模型有完美的预测。如果 AUC = 0.5，这将意味着模型不能区分类别。它在逻辑回归中的表现也类似于 r-square，因为增加更多的预测因子将增加 AUC。因此，在分析中包括交叉验证或对外部数据的验证非常重要。</p><p id="75b0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">AUC 可用于评估不同的预测模型。</p><h2 id="481e" class="ld le iq bd lf lg lh dn li lj lk dp ll kj lm ln lo kn lp lq lr kr ls lt lu lv bi translated">参考线</h2><p id="f0f6" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">通常画一条参考线是个好主意，在 ROC 图上 AUC = 0.5。这提供了与曲线进行比较的基线视觉。</p><figure class="nj nk nl nm gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nr"><img src="../Images/0f569701f3f225031b761308d7a2a4d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wAYv0oNc8h7K6u7wLmQDCw.png"/></div></div></figure></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><h1 id="9cdc" class="mc le iq bd lf md me mf li mg mh mi ll mj mk ml lo mm mn mo lr mp mq mr lu ms bi translated">生成 ROC 曲线</h1><p id="bccf" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">虽然可以使用几个不同的程序来开发预测模型和 ROC 曲线，但是我在 r。</p><p id="a487" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">分析这个数据集的完整代码可以在我的 Github 上找到:</strong></p><div class="nt nu gp gr nv nw"><a href="https://github.com/dslans/predicting-cad" rel="noopener  ugc nofollow" target="_blank"><div class="nx ab fo"><div class="ny ab nz cl cj oa"><h2 class="bd ir gy z fp ob fr fs oc fu fw ip bi translated">dslans 预测-cad</h2><div class="od l"><h3 class="bd b gy z fp ob fr fs oc fu fw dk translated">靶向蛋白质组学数据集的数据分析预测有症状患者的冠状动脉疾病…</h3></div><div class="oe l"><p class="bd b dl z fp ob fr fs oc fu fw dk translated">github.com</p></div></div><div class="of l"><div class="og l oh oi oj of ok jw nw"/></div></div></a></div><p id="98bc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了预测结果，我使用<strong class="ka ir"> xgboost </strong>创建了一个分类模型，将蛋白质生物标志物作为预测器，并使用一种替代方法来预测数据集中的结果。使用预测的概率，我可以形成我上面展示的 ROC 曲线。</p><p id="c5c2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="mt">注意:该程序还被设置为使用 k-fold 交叉验证，或者可以被更新为利用外部验证，比如对训练集和测试集进行 70/30 的分割(尽管我会想要更多的数据)。</em></p><figure class="nj nk nl nm gt jr"><div class="bz fp l di"><div class="ol om l"/></div></figure><figure class="nj nk nl nm gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nr"><img src="../Images/0f569701f3f225031b761308d7a2a4d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wAYv0oNc8h7K6u7wLmQDCw.png"/></div></div></figure><h2 id="07ec" class="ld le iq bd lf lg lh dn li lj lk dp ll kj lm ln lo kn lp lq lr kr ls lt lu lv bi translated">解读曲线</h2><p id="74f8" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated">AUC 为 0.738，实际上刚好低于作者用他们的机器学习方法发现的值(堆叠可能提高了分类器的准确性)。然而，我更关心的是选择一个合适的截止值，并权衡该工具的成本和收益。</p><p id="52e5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">该模型的总体准确性还不错，但当假阳性结果出现时，就会发生这种情况，患有 CAD 的患者会被送回家，而不是通过必要的程序？我们一致认为这不是一件好事。</p><p id="6de1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了安全起见，让诊断工具的假阳性率尽可能小可能是个好主意。在生成混淆矩阵时，很容易选择一个概率截止值来保持较低的假阳性率。这将作为谁被贴上无 CAD 标签的决定标准。</p><figure class="nj nk nl nm gt jr"><div class="bz fp l di"><div class="ol om l"/></div></figure><p id="8d8b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">通过选择保持 90%特异性(10%假阳性率)的概率截止值，分类工具能够检测 42%没有 CAD 的患者(灵敏度= 0.42)。在这种情况下，这实际上是一个非常好的结果，因为现状是让所有有症状的患者接受更具侵入性的诊断程序。尽管 42%的敏感度听起来很低，但在这个特定的场景中，这是一个有希望的结果。</p><p id="4b08" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在开发用于在有症状的患者中预测 CAD 状态的分类器时，最重要的是在保持低假阳性率的同时实现尽可能高的灵敏度。</p><figure class="nj nk nl nm gt jr gh gi paragraph-image"><div class="gh gi on"><img src="../Images/1647c2a435e97ff544adef4e0a7faed7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1328/format:webp/1*jElT-rlN6p1Xb_bccKg9PQ.png"/></div></figure><p id="a196" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">ROC 曲线的美妙之处在于，您可以从一张图片中看到所有这些性能指标。将曲线与竞争模型进行比较是选择合适的分类或诊断工具的快速简便的方法。</p></div><div class="ab cl kw kx hu ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="ij ik il im in"><p id="4ad0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我只探索了使用 ROC 曲线和二元分类工具，但是它可以很容易地扩展到多类场景。在同一个图形上，可以绘制出对应于每个特定类别的概率的多条曲线。</p><p id="5da6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在撰写本文时，我详细介绍了如何构建 ROC 曲线，目的是增加对预测准确性度量的理解，以及如何评估您可能正在构建的这些数据科学分类工具。</p><h2 id="040f" class="ld le iq bd lf lg lh dn li lj lk dp ll kj lm ln lo kn lp lq lr kr ls lt lu lv bi translated">参考</h2><p id="7678" class="pw-post-body-paragraph jy jz iq ka b kb lw kd ke kf lx kh ki kj ly kl km kn lz kp kq kr ma kt ku kv ij bi translated"><em class="mt"> Bom MJ，Levin E，Driessen RS，等。靶向蛋白质组学对疑似冠心病患者冠状动脉斑块形态的预测价值。EBioMedicine。；39:109–117.doi:10.1016/j . ebiom . 2018 . 12 . 033</em></p></div></div>    
</body>
</html>