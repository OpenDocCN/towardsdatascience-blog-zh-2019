<html>
<head>
<title>An Illustrated Guide to the Poisson Regression Model</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">泊松回归模型图解指南</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/an-illustrated-guide-to-the-poisson-regression-model-50cccba15958?source=collection_archive---------0-----------------------#2019-09-22">https://towardsdatascience.com/an-illustrated-guide-to-the-poisson-regression-model-50cccba15958?source=collection_archive---------0-----------------------#2019-09-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/c24b016656eace7cf789dc18c0b996c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WYZrqmgD2f7UYNl40mxhfg.png"/></div></div></figure><div class=""/><div class=""><h2 id="7a41" class="pw-subtitle-paragraph kb jd je bd b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks dk translated">和使用 Python 的泊松回归教程</h2></div><p id="b7bc" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">在本文中，我们将讨论以下主题:</p><ol class=""><li id="be5c" class="lp lq je kv b kw kx kz la lc lr lg ls lk lt lo lu lv lw lx bi translated"><strong class="kv jf">基于计数的数据的特征:</strong>计数数据集是世界上最常见的一些数据。我们将看看是什么使基于计数的数据不同。</li><li id="c76e" class="lp lq je kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated"><strong class="kv jf">预测数量的回归模型:</strong>我们来详细看看<strong class="kv jf">泊松回归模型</strong>。<strong class="kv jf">负二项式(NB)回归模型</strong>是另一种常用的基于计数的数据模型。我将在以后的文章中讨论这个问题。</li><li id="3e36" class="lp lq je kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated"><strong class="kv jf">关于泊松回归的 Python 教程:</strong>我将带你一步步学习如何使用<strong class="kv jf"> statsmodels </strong>的<strong class="kv jf"> GLM 类</strong>在 Python 中创建泊松回归模型，以及如何在真实世界数据集上训练它。</li></ol></div><div class="ab cl md me hx mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="im in io ip iq"><h2 id="e8f8" class="mk ml je bd mm mn mo dn mp mq mr dp ms lc mt mu mv lg mw mx my lk mz na nb nc bi translated">在我们开始之前，有几个要点…</h2><ul class=""><li id="75aa" class="lp lq je kv b kw nd kz ne lc nf lg ng lk nh lo ni lv lw lx bi translated">对于关于泊松回归的<strong class="kv jf"> Python 教程</strong>，<strong class="kv jf">向下滚动</strong>到本文的最后几节。</li><li id="7fb8" class="lp lq je kv b kw ly kz lz lc ma lg mb lk mc lo ni lv lw lx bi translated">Python 代码的<strong class="kv jf"> Github 要点</strong>是这里的<a class="ae nj" href="https://gist.github.com/sachinsdate/d5535d5489178e6271f4c0c7a444da1e" rel="noopener ugc nofollow" target="_blank"><strong class="kv jf"/></a>。</li><li id="c315" class="lp lq je kv b kw ly kz lz lc ma lg mb lk mc lo ni lv lw lx bi translated">本文中使用的一个<strong class="kv jf">骑自行车者计数的真实世界数据集</strong>是这里的<a class="ae nj" href="https://gist.github.com/sachinsdate/c17931a3f000492c1c42cf78bf4ce9fe" rel="noopener ugc nofollow" target="_blank"><strong class="kv jf"/></a>。</li><li id="deeb" class="lp lq je kv b kw ly kz lz lc ma lg mb lk mc lo ni lv lw lx bi translated">关于<strong class="kv jf">随机变量、泊松过程和模拟泊松过程的 Python 程序</strong>，点击这里:<br/> <a class="ae nj" rel="noopener" target="_blank" href="/the-poisson-process-everything-you-need-to-know-322aa0ab9e9a"> <em class="nk">泊松过程:你需要知道的一切</em> </a></li></ul><p id="94a0" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">现在让我们开始吧！</p></div><div class="ab cl md me hx mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="im in io ip iq"><h2 id="cb7b" class="mk ml je bd mm mn mo dn mp mq mr dp ms lc mt mu mv lg mw mx my lk mz na nb nc bi translated">什么是基于计数的数据？</h2><p id="88fa" class="pw-post-body-paragraph kt ku je kv b kw nd kf ky kz ne ki lb lc nl le lf lg nm li lj lk nn lm ln lo im bi translated">基于计数的数据包含以特定速率发生的事件。发生率可能会随着时间的推移或从一次观察到下一次观察而变化。以下是一些基于计数的数据示例:</p><figure class="np nq nr ns gt iv gh gi paragraph-image"><div class="gh gi no"><img src="../Images/64f9fda29143204139afe105d39492a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:762/format:webp/1*4sguqPtvCtoFhO-1_Gqf1g.png"/></div><figcaption class="nt nu gj gh gi nv nw bd b be z dk">Data source: Wikipedia: <a class="ae nj" href="https://en.wikipedia.org/wiki/List_of_potentially_habitable_exoplanets" rel="noopener ugc nofollow" target="_blank">potentially habitable exoplanets</a> (Image by <a class="ae nj" href="https://sachin-date.medium.com/" rel="noopener">Author</a>)</figcaption></figure><ul class=""><li id="ea73" class="lp lq je kv b kw kx kz la lc lr lg ls lk lt lo ni lv lw lx bi translated">每小时通过十字路口的车辆数量，</li><li id="2048" class="lp lq je kv b kw ly kz lz lc ma lg mb lk mc lo ni lv lw lx bi translated">每月去诊所看病的人数，</li><li id="0aa8" class="lp lq je kv b kw ly kz lz lc ma lg mb lk mc lo ni lv lw lx bi translated">每月发现的类地行星数量。</li></ul><p id="1af4" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated"><strong class="kv jf">计数数据集具有以下特征:</strong></p><ul class=""><li id="48cb" class="lp lq je kv b kw kx kz la lc lr lg ls lk lt lo ni lv lw lx bi translated"><strong class="kv jf">整数数据:</strong>数据由非负整数组成:[0… ∞]普通最小二乘回归等回归技术可能不适合对这类数据建模，因为 OLSR 最适合处理实数，如-656.0、-0.00000345、13786.1 等。</li><li id="7eda" class="lp lq je kv b kw ly kz lz lc ma lg mb lk mc lo ni lv lw lx bi translated"><strong class="kv jf">偏斜分布:</strong>数据可能包含大量的数据点，但只有几个值，从而使频率分布相当偏斜。例如，参见上面的直方图。</li><li id="cdd2" class="lp lq je kv b kw ly kz lz lc ma lg mb lk mc lo ni lv lw lx bi translated"><strong class="kv jf">稀疏性:</strong>数据可能反映了伽马射线爆发等罕见事件的发生，从而使数据变得稀疏。</li><li id="9094" class="lp lq je kv b kw ly kz lz lc ma lg mb lk mc lo ni lv lw lx bi translated"><strong class="kv jf">发生率:</strong>为了建立模型，可以假设有某个事件发生率<strong class="kv jf"> λ </strong>驱动这种数据的产生。事件率可能随时间漂移。</li></ul></div><div class="ab cl md me hx mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="im in io ip iq"><h2 id="7754" class="mk ml je bd mm mn mo dn mp mq mr dp ms lc mt mu mv lg mw mx my lk mz na nb nc bi translated">真实世界的计数数据集</h2><p id="d3f2" class="pw-post-body-paragraph kt ku je kv b kw nd kf ky kz ne ki lb lc nl le lf lg nm li lj lk nn lm ln lo im bi translated">下表包含了骑自行车的人在纽约市各种桥梁上行驶的次数。从 2017 年 4 月 1 日到 2017 年 10 月 31 日每天测量计数。</p><figure class="np nq nr ns gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nx"><img src="../Images/d667cffa06d9cb2612aa9ddbb118b1a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SFjy4noz_eaiEw0Vz9DLmg.png"/></div></div><figcaption class="nt nu gj gh gi nv nw bd b be z dk">Source: <a class="ae nj" href="https://data.cityofnewyork.us/Transportation/Bicycle-Counts-for-East-River-Bridges/gua4-p9wg" rel="noopener ugc nofollow" target="_blank">Bicycle Counts for East River Bridges</a> (Data source: NYC OpenData) (Image by <a class="ae nj" href="https://sachin-date.medium.com/" rel="noopener">Author</a>)</figcaption></figure><p id="53db" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">这是布鲁克林大桥上骑自行车的人数的时间顺序图:</p><figure class="np nq nr ns gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/c24b016656eace7cf789dc18c0b996c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WYZrqmgD2f7UYNl40mxhfg.png"/></div></div><figcaption class="nt nu gj gh gi nv nw bd b be z dk">Background image: <a class="ae nj" href="https://en.wikipedia.org/wiki/Brooklyn_Bridge#/media/File:Brooklyn_Bridge_Postdlf.jpg" rel="noopener ugc nofollow" target="_blank">The Brooklyn bridge as seen from Manhattan island</a></figcaption></figure></div><div class="ab cl md me hx mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="im in io ip iq"><h2 id="8f85" class="mk ml je bd mm mn mo dn mp mq mr dp ms lc mt mu mv lg mw mx my lk mz na nb nc bi translated">计数的回归模型</h2><p id="3d82" class="pw-post-body-paragraph kt ku je kv b kw nd kf ky kz ne ki lb lc nl le lf lg nm li lj lk nn lm ln lo im bi translated"><strong class="kv jf">泊松回归模型</strong>和<strong class="kv jf">负二项式回归模型</strong>是开发计数回归模型的两种流行技术。其他可能性有<a class="ae nj" href="https://en.wikipedia.org/wiki/Ordered_logit" rel="noopener ugc nofollow" target="_blank">有序 Logit </a>、<a class="ae nj" href="https://en.wikipedia.org/wiki/Ordered_probit" rel="noopener ugc nofollow" target="_blank">有序 Probit </a>和<a class="ae nj" href="https://en.wikipedia.org/wiki/Non-linear_least_squares" rel="noopener ugc nofollow" target="_blank">非线性最小二乘</a>模型。</p><h2 id="f87a" class="mk ml je bd mm mn mo dn mp mq mr dp ms lc mt mu mv lg mw mx my lk mz na nb nc bi translated"><strong class="ak">回归策略</strong></h2><p id="8434" class="pw-post-body-paragraph kt ku je kv b kw nd kf ky kz ne ki lb lc nl le lf lg nm li lj lk nn lm ln lo im bi translated">从泊松回归模型开始，并将其用作更复杂或约束更少的模型的“控制”是一个很好的实践。在他们的《计数数据的回归分析》一书中，卡梅隆和特里维迪说:</p><blockquote class="ny"><p id="0e0f" class="nz oa je bd ob oc od oe of og oh lo dk translated">"合理的做法是估计泊松和负二项模型."</p></blockquote><p id="b221" class="pw-post-body-paragraph kt ku je kv b kw oi kf ky kz oj ki lb lc ok le lf lg ol li lj lk om lm ln lo im bi translated">在本文中，我们将使用泊松回归模型来回归布鲁克林大桥上观察到的骑自行车的人数。</p></div><div class="ab cl md me hx mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="im in io ip iq"><h2 id="2bb0" class="mk ml je bd mm mn mo dn mp mq mr dp ms lc mt mu mv lg mw mx my lk mz na nb nc bi translated">介绍泊松模型</h2><p id="201e" class="pw-post-body-paragraph kt ku je kv b kw nd kf ky kz ne ki lb lc nl le lf lg nm li lj lk nn lm ln lo im bi translated">泊松分布具有如下的概率函数。</p><figure class="np nq nr ns gt iv gh gi paragraph-image"><div class="gh gi on"><img src="../Images/78487fa066b2ef1e987e75f3344e3b37.png" data-original-src="https://miro.medium.com/v2/resize:fit:1048/format:webp/1*nPldr72r5lcw5EQ9ijzO7w.png"/></div><figcaption class="nt nu gj gh gi nv nw bd b be z dk">Probability of seeing <strong class="bd oo"><em class="op">k</em></strong> events in time <strong class="bd oo">t</strong>, given <strong class="bd oo">λ </strong>events occurring per unit time (Image by <a class="ae nj" href="https://sachin-date.medium.com/" rel="noopener">Author</a>)</figcaption></figure><p id="e150" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">泊松分布的期望值(平均值)为<strong class="kv jf"> <em class="nk"> λ。</em> </strong>因此，在没有其他信息的情况下，人们应该期望在任何单位时间间隔内看到<strong class="kv jf"> <em class="nk"> λ </em> </strong>事件，例如 1 小时、1 天等。对于任何区间<strong class="kv jf"> <em class="nk"> t </em> </strong>，人们都会期望看到<strong class="kv jf"> <em class="nk"> λt </em> </strong>事件<strong class="kv jf"> <em class="nk">。</em>T47】</strong></p></div><div class="ab cl md me hx mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="im in io ip iq"><h2 id="e444" class="mk ml je bd mm mn mo dn mp mq mr dp ms lc mt mu mv lg mw mx my lk mz na nb nc bi translated">一个泊松回归模式<em class="op"> l 为</em> <strong class="ak"> <em class="op">常数λ </em> </strong></h2><p id="3156" class="pw-post-body-paragraph kt ku je kv b kw nd kf ky kz ne ki lb lc nl le lf lg nm li lj lk nn lm ln lo im bi translated">如果事件速率<strong class="kv jf"><em class="nk">【λ】</em></strong><em class="nk"/>是恒定的，则可以简单地使用修改的均值模型来预测事件的未来计数。<strong class="kv jf"> </strong>在这种情况下，可以将计数的所有预测值设置为该常量值<strong class="kv jf"> <em class="nk"> λ </em> </strong>。</p><p id="df2e" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">下图说明了常量<strong class="kv jf"> <em class="nk"> λ </em> </strong>的场景:</p><figure class="np nq nr ns gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oq"><img src="../Images/c3eb0cdc64e91b9fd826ff6e26d11fd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iA9klg3Nwbt8g-t5tPIazg.png"/></div></div><figcaption class="nt nu gj gh gi nv nw bd b be z dk">Actual and predicted counts for a constant rate model (Image by <a class="ae nj" href="https://sachin-date.medium.com/" rel="noopener">Author</a>)</figcaption></figure><p id="91a5" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">以下 Python 代码用于使用泊松过程生成蓝点(过去时间步的实际计数)，其中<strong class="kv jf"> <em class="nk"> λ=5 </em> </strong>。橙色点(预测)都被设置为相同的值<strong class="kv jf"> 5。</strong></p><figure class="np nq nr ns gt iv"><div class="bz fp l di"><div class="or os l"/></div><figcaption class="nt nu gj gh gi nv nw bd b be z dk">A Python program to generate event counts using a Poisson process</figcaption></figure></div><div class="ab cl md me hx mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="im in io ip iq"><h2 id="40f2" class="mk ml je bd mm mn mo dn mp mq mr dp ms lc mt mu mv lg mw mx my lk mz na nb nc bi translated"><strong class="ak">非常数λ </strong>的泊松回归模型</h2><p id="b242" class="pw-post-body-paragraph kt ku je kv b kw nd kf ky kz ne ki lb lc nl le lf lg nm li lj lk nn lm ln lo im bi translated">现在我们到了有趣的部分。让我们检查一个更常见的情况，其中<strong class="kv jf"> λ </strong>可以从一个观察值变化到下一个观察值。在这种情况下，我们假设<strong class="kv jf"> λ </strong>的值受<strong class="kv jf">解释变量</strong>、<strong class="kv jf">的向量影响，这些变量也被称为预测变量、回归变量</strong>或<strong class="kv jf">回归变量</strong>。我们称这个回归变量矩阵为<strong class="kv jf"> X </strong>。</p><blockquote class="ot ou ov"><p id="b979" class="kt ku nk kv b kw kx kf ky kz la ki lb ow ld le lf ox lh li lj oy ll lm ln lo im bi translated">回归模型的工作是将观察到的计数<strong class="kv jf"> y </strong>拟合到回归值矩阵<strong class="kv jf"> X </strong>。</p></blockquote><p id="8d42" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">在纽约市自行车统计数据集中，回归变量是<em class="nk">日期</em>、<em class="nk">星期几</em>、<em class="nk">高温</em>、<em class="nk">低温</em>和<em class="nk">降水量</em>。我们还可以引入额外的回归变量，如从<em class="nk">日期</em>派生的<em class="nk">月</em>日和<em class="nk">月</em>日，并且我们可以自由删除现有的回归变量，如<em class="nk">日期</em>。</p><figure class="np nq nr ns gt iv gh gi paragraph-image"><div class="gh gi oz"><img src="../Images/ce1802576b5d9c71f7e947594d68b036.png" data-original-src="https://miro.medium.com/v2/resize:fit:1150/format:webp/1*UhMpgywlMk2iAeL1qQj-rw.png"/></div><figcaption class="nt nu gj gh gi nv nw bd b be z dk">(Image by <a class="ae nj" href="https://sachin-date.medium.com/" rel="noopener">Author</a>)</figcaption></figure><p id="97d9" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated"><strong class="kv jf"> <em class="nk"> y </em> </strong>到<strong class="kv jf"> X </strong>的拟合通过固定回归系数<strong class="kv jf"> β的向量值来实现。</strong></p><p id="5db3" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">在泊松回归模型中，事件计数<strong class="kv jf"> <em class="nk"> y </em> </strong>被假设为泊松分布，这意味着观察到<strong class="kv jf"> <em class="nk"> y </em> </strong>的概率是事件速率向量<strong class="kv jf"> λ的函数。</strong></p><blockquote class="ot ou ov"><p id="be20" class="kt ku nk kv b kw kx kf ky kz la ki lb ow ld le lf ox lh li lj oy ll lm ln lo im bi translated">泊松回归模型的工作是通过一个链接函数将观察到的计数<strong class="kv jf"> y </strong>拟合到回归矩阵<strong class="kv jf"> X </strong>，该链接函数将速率向量<strong class="kv jf"> λ </strong>表示为 1)回归系数<strong class="kv jf"> β </strong>和 2)回归矩阵<strong class="kv jf">X</strong>的函数</p></blockquote><p id="2703" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">下图说明了泊松回归模型的结构。</p><figure class="np nq nr ns gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pa"><img src="../Images/822dd00684e41aba4d4a1b030e7f33ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WERbI7cG1vgLTbva8_q1pQ.png"/></div></div><figcaption class="nt nu gj gh gi nv nw bd b be z dk"><strong class="bd oo">Scan from left to right</strong>: The structure of the Poisson regression model (Image by <a class="ae nj" href="https://sachin-date.medium.com/" rel="noopener">Author</a>)</figcaption></figure><p id="9a70" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">有什么好的链接功能<strong class="kv jf"> <em class="nk"> f </em> </strong>(。)连接<strong class="kv jf"> λ </strong>和<strong class="kv jf"> X </strong>？事实证明，以下指数链接函数非常有效:</p><figure class="np nq nr ns gt iv gh gi paragraph-image"><div class="gh gi pb"><img src="../Images/85401f7f0216512a7e1ccd7c66afb9e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:848/format:webp/1*8jua137XJoCobdnvFv7sTg.png"/></div><figcaption class="nt nu gj gh gi nv nw bd b be z dk">The exponential link function of the Poisson regression model (Image by <a class="ae nj" href="https://sachin-date.medium.com/" rel="noopener">Author</a>)</figcaption></figure><p id="c9ea" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">即使当回归变量<strong class="kv jf"> X </strong>或回归系数<strong class="kv jf"> β </strong>为负值时，该链接函数也会保持<strong class="kv jf"> λ </strong>为非负值。这是基于计数的数据的要求。</p><p id="476f" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">一般来说，我们有:</p><figure class="np nq nr ns gt iv gh gi paragraph-image"><div class="gh gi pc"><img src="../Images/12d992c28954e14f1789d745e32e282a.png" data-original-src="https://miro.medium.com/v2/resize:fit:874/format:webp/1*fJJjzUPoNRmOm-1YbWursw.png"/></div><figcaption class="nt nu gj gh gi nv nw bd b be z dk">The exponential link function of the Poisson regression model (Image by <a class="ae nj" href="https://sachin-date.medium.com/" rel="noopener">Author</a>)</figcaption></figure></div><div class="ab cl md me hx mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="im in io ip iq"><h2 id="7788" class="mk ml je bd mm mn mo dn mp mq mr dp ms lc mt mu mv lg mw mx my lk mz na nb nc bi translated">泊松回归模型的形式规范</h2><p id="1a88" class="pw-post-body-paragraph kt ku je kv b kw nd kf ky kz ne ki lb lc nl le lf lg nm li lj lk nn lm ln lo im bi translated">基于计数的数据的泊松回归模型的完整规格如下所示:</p><p id="f959" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">对于回归变量<strong class="kv jf"> <em class="nk"> x_i </em> </strong>行对应的<em class="nk"> y_i </em>表示的数据集中第<em class="nk">个</em>个观察值，观察计数<em class="nk"> y_i </em>的概率为泊松分布，其分布如下:</p><figure class="np nq nr ns gt iv gh gi paragraph-image"><div class="gh gi pd"><img src="../Images/23c3c2884d985836f99d5b11c7dba765.png" data-original-src="https://miro.medium.com/v2/resize:fit:1136/format:webp/1*HlxLyr8wAIx7NKMSPbbF5w.png"/></div><figcaption class="nt nu gj gh gi nv nw bd b be z dk">Probability of observing count y_i given <strong class="bd oo">x_i</strong><em class="op"> (as per the Poisson PMF formula) </em>(Image by <a class="ae nj" href="https://sachin-date.medium.com/" rel="noopener">Author</a>)</figcaption></figure><p id="468b" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">其中第 I 个样本的平均速率<em class="nk"> λ_i </em>由前面所示的指数链接函数给出。我们在这里重现它:</p><figure class="np nq nr ns gt iv gh gi paragraph-image"><div class="gh gi pb"><img src="../Images/aa2ae1ca53f9efc4e8f38bcfaf343083.png" data-original-src="https://miro.medium.com/v2/resize:fit:848/format:webp/1*y7n1zNRRQGkJlv30i65JRA.png"/></div><figcaption class="nt nu gj gh gi nv nw bd b be z dk">The exponential link function of the Poisson regression model (Image by <a class="ae nj" href="https://sachin-date.medium.com/" rel="noopener">Author</a>)</figcaption></figure><p id="3366" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">一旦模型在数据集上完全训练完毕，回归系数<strong class="kv jf"><em class="nk"/></strong>已知，模型就可以进行预测了。为了预测与已经观察到的回归量<strong class="kv jf"> <em class="nk"> x_p </em> </strong>的输入行相对应的事件计数<em class="nk"> y_p </em>，使用以下公式:</p><figure class="np nq nr ns gt iv gh gi paragraph-image"><div class="gh gi pe"><img src="../Images/89586926dd837db69f3bfab2acbe7cbb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1070/format:webp/1*bI_QNdsVVqbKu_UpKfd8QA.png"/></div><figcaption class="nt nu gj gh gi nv nw bd b be z dk">The prediction equation for the Poisson regression model (Image by <a class="ae nj" href="https://sachin-date.medium.com/" rel="noopener">Author</a>)</figcaption></figure><p id="e76d" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">所有这些都依赖于我们成功训练模型的能力，这样回归系数向量<strong class="kv jf"><em class="nk">【β】</em></strong>就是已知的<strong class="kv jf"> <em class="nk">。</em> </strong></p><p id="5f2b" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">让我们看看这种培训是如何进行的。</p></div><div class="ab cl md me hx mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="im in io ip iq"><h2 id="454c" class="mk ml je bd mm mn mo dn mp mq mr dp ms lc mt mu mv lg mw mx my lk mz na nb nc bi translated">定型泊松回归模型</h2><p id="0022" class="pw-post-body-paragraph kt ku je kv b kw nd kf ky kz ne ki lb lc nl le lf lg nm li lj lk nn lm ln lo im bi translated">训练泊松回归模型包括寻找回归系数<strong class="kv jf"> β </strong>的值，这将使观察计数的向量<strong class="kv jf"> y </strong>最有可能。</p><p id="b431" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">识别系数<strong class="kv jf"> β </strong>的技术称为<strong class="kv jf"> M </strong>最大值<strong class="kv jf"> L </strong>似然比<strong class="kv jf"> E </strong>估计(MLE)。</p><p id="b8ec" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">让我们来熟悉一下<strong class="kv jf"> MLE 的技巧。</strong></p><h2 id="ce56" class="mk ml je bd mm mn mo dn mp mq mr dp ms lc mt mu mv lg mw mx my lk mz na nb nc bi translated">理解最大似然估计</h2><p id="b080" class="pw-post-body-paragraph kt ku je kv b kw nd kf ky kz ne ki lb lc nl le lf lg nm li lj lk nn lm ln lo im bi translated">我将使用自行车计数数据集来说明<strong class="kv jf"> MLE </strong>技术。看看这个数据集的前几行:</p><figure class="np nq nr ns gt iv gh gi paragraph-image"><div class="gh gi pf"><img src="../Images/95c536d617064b107418f9c02676c90c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1118/format:webp/1*71_wr9hgeBOTOPci2XSa3A.png"/></div><figcaption class="nt nu gj gh gi nv nw bd b be z dk">Daily counts of bicyclists on the Brooklyn bridge (Image by <a class="ae nj" href="https://sachin-date.medium.com/" rel="noopener">Author</a>)</figcaption></figure><p id="4d86" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">我们的假设是，红框中显示的骑自行车的人数来自泊松过程。因此我们可以说它们的发生概率是由泊松 PMF 给出的。以下是前 4 次发生的概率:</p><figure class="np nq nr ns gt iv gh gi paragraph-image"><div class="gh gi pg"><img src="../Images/92eec870eabd07924e55a8fbcde04cd9.png" data-original-src="https://miro.medium.com/v2/resize:fit:760/format:webp/1*pwrptFm5XqV__onDdTV0qA.png"/></div><figcaption class="nt nu gj gh gi nv nw bd b be z dk">Probabilities of observing the bicyclist counts for the first few occurrences given corresponding regression vectors (Image by <a class="ae nj" href="https://sachin-date.medium.com/" rel="noopener">Author</a>)</figcaption></figure><p id="1b6e" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">我们可以类似地计算在训练集中观察到的所有<strong class="kv jf"> <em class="nk"> n </em> </strong>计数的概率。</p><p id="71d3" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">注意，在上述公式<em class="nk">中，λ_1、λ_2、λ_3、…、λ_n </em>是使用如下链接函数计算的:</p><figure class="np nq nr ns gt iv gh gi paragraph-image"><div class="gh gi ph"><img src="../Images/fb26a3e1dcbfd01fc66b27243721bb8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:390/format:webp/1*ZWtkDVeSF1Y8oRDo_RMvRg.png"/></div><figcaption class="nt nu gj gh gi nv nw bd b be z dk">The event rates corresponding to the counts for the first few days (Image by <a class="ae nj" href="https://sachin-date.medium.com/" rel="noopener">Author</a>)</figcaption></figure><p id="10d1" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">其中<strong class="kv jf"><em class="nk">x1，x2，x3，x4</em></strong>为回归矩阵的前 4 行。</p><p id="409b" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">训练集中整组<em class="nk"> n </em>个计数<em class="nk"> y_1，y_2，…，y_n </em>出现的概率就是单个计数出现的联合概率。</p><p id="8d43" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">计数<strong class="kv jf"> <em class="nk"> y </em> </strong>为泊松分布，<em class="nk"> y_1，y_2，…，y_n </em>为独立随机变量，对应给出<strong class="kv jf"> <em class="nk"> x_1，x_2，…，x_n </em> </strong>。因此，<em class="nk"> y_1，y_2，…，y_n </em>出现的联合概率可以表示为单个概率的简单乘积。下面是整个训练集的联合概率:</p><figure class="np nq nr ns gt iv gh gi paragraph-image"><div class="gh gi pi"><img src="../Images/d34d82e77a054447b676739d52fdf15f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1348/format:webp/1*3LVuGcI7X4iHNwbhJpNygw.png"/></div><figcaption class="nt nu gj gh gi nv nw bd b be z dk">The <strong class="bd oo">likelihood function</strong> L(<strong class="bd oo"><em class="op">β)</em></strong><em class="op"> expressed as a joint probability mass function </em>(Image by <a class="ae nj" href="https://sachin-date.medium.com/" rel="noopener">Author</a>)</figcaption></figure><p id="12c2" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">让我们回忆一下，<em class="nk"> λ_1，λ_2，λ_3，…，λ_n </em>通过回归系数<strong class="kv jf"> <em class="nk"> β链接到回归向量<strong class="kv jf"> <em class="nk"> x_1，x_2，x_3，…，x_n </em>。</strong></em> </strong></p><p id="5d70" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated"><strong class="kv jf"> <em class="nk"> β </em> </strong>的什么值会使给定的一组观察计数<strong class="kv jf"> <em class="nk"> y </em> </strong>最有可能？上式所示的联合概率达到最大值的是<strong class="kv jf"> <em class="nk"> β </em> </strong>的值。换句话说，就是联合概率函数 w.r.t. <strong class="kv jf"> <em class="nk"> β </em> </strong>的变化率为<strong class="kv jf"> 0 的<strong class="kv jf"> <em class="nk"> β </em> </strong>的值。</strong>换一种说法，就是对联合概率方程 w.r.t. <strong class="kv jf"> <em class="nk"> β </em> </strong>进行微分并将这个微分方程设为<strong class="kv jf"> 0 所得到的方程的解。</strong></p><p id="5bb9" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">联合概率方程的<strong class="kv jf">对数</strong>比原方程更容易微分。对数方程的解产生相同的最优值<strong class="kv jf"><em class="nk"/></strong>。</p><p id="a48a" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">这个对数方程被称为<strong class="kv jf">对数似然函数</strong>。对于泊松回归，对数似然函数由以下等式给出:</p><figure class="np nq nr ns gt iv gh gi paragraph-image"><div class="gh gi pj"><img src="../Images/06af3412228191f3bcdc0d0cb14dfc45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1078/format:webp/1*YTDvgLxhBv_cXYK8I70ffA.png"/></div><figcaption class="nt nu gj gh gi nv nw bd b be z dk">log-likelihood function for the Poisson regression model (Image by <a class="ae nj" href="https://sachin-date.medium.com/" rel="noopener">Author</a>)</figcaption></figure><p id="38ba" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">将<em class="nk"> λ_i </em>替换为<em class="nk">exp</em>(<strong class="kv jf">x _ I</strong>*<strong class="kv jf"><em class="nk">β)</em></strong>)后，取前面所示的联合概率函数两边的自然对数，即可得到上述等式。</p><p id="ad01" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">如前所述，我们对这个对数似然方程 w.r.t. <strong class="kv jf"> <em class="nk"> β </em> </strong>进行微分，并将其设置为零。这个操作给出了下面的等式:</p><figure class="np nq nr ns gt iv gh gi paragraph-image"><div class="gh gi pj"><img src="../Images/f29d7dada69c7dcc05f50ca0600e5dbc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1078/format:webp/1*joRq2Bgz1dn6y_maUCzOrw.png"/></div><figcaption class="nt nu gj gh gi nv nw bd b be z dk">The Poisson MLE for <strong class="bd oo"><em class="op">β</em></strong><em class="op"> is the solution to this equation </em>(Image by <a class="ae nj" href="https://sachin-date.medium.com/" rel="noopener">Author</a>)</figcaption></figure><p id="51c7" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">解回归系数<strong class="kv jf"><em class="nk"/></strong>的这个方程将产生<strong class="kv jf"> <em class="nk"> β的<strong class="kv jf">最大似然估计</strong> <strong class="kv jf"> (MLE) </strong>。</em>T11】</strong></p><p id="4f1e" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">为了求解上述方程，可以使用迭代方法，例如<a class="ae nj" href="https://en.wikipedia.org/wiki/Iteratively_reweighted_least_squares" rel="noopener ugc nofollow" target="_blank">迭代加权最小二乘法(IRLS) </a>。实际上，人们不能手工解这个方程。相反，您可以使用统计软件，如 Python <strong class="kv jf"> statsmodels </strong>包，它会在对数据集训练泊松回归模型时为您完成所有计算。</p></div><div class="ab cl md me hx mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="im in io ip iq"><h2 id="a913" class="mk ml je bd mm mn mo dn mp mq mr dp ms lc mt mu mv lg mw mx my lk mz na nb nc bi translated">执行泊松回归的步骤摘要</h2><p id="1c64" class="pw-post-body-paragraph kt ku je kv b kw nd kf ky kz ne ki lb lc nl le lf lg nm li lj lk nn lm ln lo im bi translated">总之，下面是对基于计数的数据集执行泊松回归的步骤:</p><ol class=""><li id="fdbc" class="lp lq je kv b kw kx kz la lc lr lg ls lk lt lo lu lv lw lx bi translated">首先，确保您的数据集包含计数。一种方法是，它只包含非负的整数值，这些值表示某个时间间隔内某个事件发生的次数。在骑自行车的人数数据集中，它是每天骑自行车穿过布鲁克林大桥的人数。</li><li id="80c7" class="lp lq je kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated">找出(或猜测)会影响观察计数的回归变量。在自行车计数数据集中，回归变量为<em class="nk">星期几、最低温度、最高温度、降水量</em>等。</li><li id="494b" class="lp lq je kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated">创建一个你的回归模型将要训练的训练数据集，和一个应该放在一边的测试数据集。<em class="nk">不</em>根据测试数据训练模型。</li><li id="b5c4" class="lp lq je kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated">使用合适的统计软件，如<strong class="kv jf"> Python statsmodels 包</strong>，对训练数据集配置和拟合泊松回归模型。</li><li id="e189" class="lp lq je kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated">通过在测试数据集上运行模型来测试模型的性能，以便生成预测的计数。将它们与测试数据集中的实际计数进行比较。</li><li id="c173" class="lp lq je kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated">使用拟合优度来确定您的模型在定型数据集上的定型程度。</li></ol></div><div class="ab cl md me hx mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="im in io ip iq"><h2 id="914f" class="mk ml je bd mm mn mo dn mp mq mr dp ms lc mt mu mv lg mw mx my lk mz na nb nc bi translated">如何在 Python 中进行泊松回归</h2><p id="6657" class="pw-post-body-paragraph kt ku je kv b kw nd kf ky kz ne ki lb lc nl le lf lg nm li lj lk nn lm ln lo im bi translated">让我们把所学的东西付诸实践。Python <strong class="kv jf"> statmodels </strong>包对泊松回归有很好的支持。</p><p id="cd12" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">让我们使用布鲁克林大桥自行车计数数据集。您可以从<a class="ae nj" href="https://gist.github.com/sachinsdate/c17931a3f000492c1c42cf78bf4ce9fe" rel="noopener ugc nofollow" target="_blank"> <strong class="kv jf">这里的</strong> </a> <strong class="kv jf">中提取数据集。</strong></p><p id="8906" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">我们的目标是为观察到的骑自行车的人数建立一个泊松回归模型<strong class="kv jf"> <em class="nk"> y. </em> </strong>我们将使用训练好的模型来预测布鲁克林大桥上的骑自行车的人的每日人数，这是模型在训练期间没有看到的。</p><figure class="np nq nr ns gt iv gh gi paragraph-image"><div class="gh gi pk"><img src="../Images/a30ccb2f615b634a497e44593ca43455.png" data-original-src="https://miro.medium.com/v2/resize:fit:1184/format:webp/1*IYojRwcgOImlJnJ34HZFdQ.png"/></div><figcaption class="nt nu gj gh gi nv nw bd b be z dk">Daily count of bicyclists on the Brooklyn bridge (Image by <a class="ae nj" href="https://sachin-date.medium.com/" rel="noopener">Author</a>)</figcaption></figure><p id="0b2c" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">我们将从导入所有需要的包开始。</p><pre class="np nq nr ns gt pl pm pn po aw pp bi"><span id="fdb8" class="mk ml je pm b gy pq pr l ps pt">import pandas as pd<br/>from patsy import dmatrices<br/>import numpy as np<br/>import statsmodels.api as sm<br/>import matplotlib.pyplot as plt</span></pre><p id="8142" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">为计数数据集创建一个熊猫数据框架。</p><pre class="np nq nr ns gt pl pm pn po aw pp bi"><span id="3662" class="mk ml je pm b gy pq pr l ps pt">df = pd.read_csv('nyc_bb_bicyclist_counts.csv', header=0, infer_datetime_format=True, parse_dates=[0], index_col=[0])</span></pre><p id="e8c9" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">我们将向矩阵<strong class="kv jf"> X </strong>添加一些派生的回归变量。</p><pre class="np nq nr ns gt pl pm pn po aw pp bi"><span id="c110" class="mk ml je pm b gy pq pr l ps pt">ds = df.index.to_series()</span><span id="35b6" class="mk ml je pm b gy pu pr l ps pt">df['MONTH'] = ds.dt.month</span><span id="6198" class="mk ml je pm b gy pu pr l ps pt">df['DAY_OF_WEEK'] = ds.dt.dayofweek</span><span id="f0b1" class="mk ml je pm b gy pu pr l ps pt">df['DAY'] = ds.dt.day</span></pre><p id="2427" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">我们将不使用<em class="nk">日期</em>变量作为回归变量，因为它包含一个绝对日期值，但是我们不需要做任何特殊的事情来删除<em class="nk">日期</em>，因为它已经作为熊猫数据帧的索引被使用。因此它在<strong class="kv jf"> X </strong>矩阵中对我们不可用。</p><p id="b4e0" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">让我们创建训练和测试数据集。</p><pre class="np nq nr ns gt pl pm pn po aw pp bi"><span id="bc60" class="mk ml je pm b gy pq pr l ps pt">mask = np.random.rand(len(df)) &lt; 0.8</span><span id="549f" class="mk ml je pm b gy pu pr l ps pt">df_train = df[mask]</span><span id="f945" class="mk ml je pm b gy pu pr l ps pt">df_test = df[~mask]</span><span id="9992" class="mk ml je pm b gy pu pr l ps pt">print('Training data set length='+str(len(df_train)))</span><span id="4cf7" class="mk ml je pm b gy pu pr l ps pt">print('Testing data set length='+str(len(df_test)))</span></pre><p id="1f7f" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">用 patsy 符号设置回归表达式。我们告诉 patsy，BB_COUNT 是我们的因变量，它取决于回归变量:DAY、DAY_OF_WEEK、MONTH、HIGH_T、LOW_T 和 PRECIP。</p><pre class="np nq nr ns gt pl pm pn po aw pp bi"><span id="999d" class="mk ml je pm b gy pq pr l ps pt">expr = """BB_COUNT ~ DAY  + DAY_OF_WEEK + MONTH + HIGH_T + LOW_T + PRECIP"""</span></pre><p id="75c5" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">为训练和测试数据集设置<strong class="kv jf"> X </strong>和<strong class="kv jf"> y </strong>矩阵。patsy 让这变得非常简单。</p><pre class="np nq nr ns gt pl pm pn po aw pp bi"><span id="5029" class="mk ml je pm b gy pq pr l ps pt">y_train, X_train = dmatrices(expr, df_train, return_type='dataframe')</span><span id="815d" class="mk ml je pm b gy pu pr l ps pt">y_test, X_test = dmatrices(expr, df_test, return_type='dataframe')</span></pre><p id="3992" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">使用 statsmodels GLM 类，对定型数据集定型泊松回归模型。</p><pre class="np nq nr ns gt pl pm pn po aw pp bi"><span id="a320" class="mk ml je pm b gy pq pr l ps pt">poisson_training_results = sm.GLM(y_train, X_train, family=sm.families.Poisson()).fit()</span></pre><p id="eefa" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">打印培训总结。</p><pre class="np nq nr ns gt pl pm pn po aw pp bi"><span id="9969" class="mk ml je pm b gy pq pr l ps pt">print(poisson_training_results.summary())</span></pre><p id="6a7c" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">这会打印出以下内容:</p><figure class="np nq nr ns gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pv"><img src="../Images/1a9f1fed8735afbb7240c83a3c5e7213.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WImv5liThI0JgrRKQILN2Q.png"/></div></div><figcaption class="nt nu gj gh gi nv nw bd b be z dk">Training summary for the Poisson regression model (Image by <a class="ae nj" href="https://sachin-date.medium.com/" rel="noopener">Author</a>)</figcaption></figure><p id="46a4" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">那么我们的模型表现如何呢？让我们对测试数据集做一些<strong class="kv jf">预测</strong>。</p><pre class="np nq nr ns gt pl pm pn po aw pp bi"><span id="97d2" class="mk ml je pm b gy pq pr l ps pt">poisson_predictions = poisson_training_results.get_prediction(X_test)</span><span id="cfcf" class="mk ml je pm b gy pu pr l ps pt">#.summary_frame() returns a pandas DataFrame<br/>predictions_summary_frame = poisson_predictions.summary_frame()</span><span id="46b1" class="mk ml je pm b gy pu pr l ps pt">print(predictions_summary_frame)</span></pre><p id="8f63" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">以下是输出的前几行:</p><figure class="np nq nr ns gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pw"><img src="../Images/e4acbf9ab269b0de5ca48688030ba318.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Hjiwl52N08u_v8MRq9rzIQ.png"/></div></div><figcaption class="nt nu gj gh gi nv nw bd b be z dk">First few rows of output from <strong class="bd oo">poisson_predictions.summary_frame() </strong>(Image by <a class="ae nj" href="https://sachin-date.medium.com/" rel="noopener">Author</a>)</figcaption></figure><p id="4ee7" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">让我们绘制测试数据的预测计数与实际计数的对比图。</p><pre class="np nq nr ns gt pl pm pn po aw pp bi"><span id="cbfa" class="mk ml je pm b gy pq pr l ps pt">predicted_counts=predictions_summary_frame['mean']</span><span id="1e96" class="mk ml je pm b gy pu pr l ps pt">actual_counts = y_test['BB_COUNT']</span><span id="ba41" class="mk ml je pm b gy pu pr l ps pt">fig = plt.figure()</span><span id="9973" class="mk ml je pm b gy pu pr l ps pt">fig.suptitle('Predicted versus actual bicyclist counts on the Brooklyn bridge')</span><span id="117a" class="mk ml je pm b gy pu pr l ps pt">predicted, = plt.plot(X_test.index, predicted_counts, 'go-', label='Predicted counts')</span><span id="c648" class="mk ml je pm b gy pu pr l ps pt">actual, = plt.plot(X_test.index, actual_counts, 'ro-', label='Actual counts')</span><span id="11b6" class="mk ml je pm b gy pu pr l ps pt">plt.legend(handles=[predicted, actual])</span><span id="1487" class="mk ml je pm b gy pu pr l ps pt">plt.show()</span></pre><p id="1411" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">以下是输出结果:</p><figure class="np nq nr ns gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi px"><img src="../Images/eeaa8597ee0f956256fb3898e1aea848.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cxbTOC3pJtiiBO0S8y971A.png"/></div></div><figcaption class="nt nu gj gh gi nv nw bd b be z dk">Predicted versus actual bicyclist counts on the Brooklyn bridge (Image by <a class="ae nj" href="https://sachin-date.medium.com/" rel="noopener">Author</a>)</figcaption></figure><p id="1b45" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">该模型似乎或多或少地跟踪实际计数的趋势，尽管<strong class="kv jf">在许多情况下，其预测值与实际值相差甚远</strong>。</p><p id="f848" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">让我们绘制实际计数与预测计数的对比图。</p><pre class="np nq nr ns gt pl pm pn po aw pp bi"><span id="a2bb" class="mk ml je pm b gy pq pr l ps pt">plt.clf()</span><span id="e8e4" class="mk ml je pm b gy pu pr l ps pt">fig = plt.figure()</span><span id="32e6" class="mk ml je pm b gy pu pr l ps pt">fig.suptitle('Scatter plot of Actual versus Predicted counts')</span><span id="a2f8" class="mk ml je pm b gy pu pr l ps pt">plt.scatter(x=predicted_counts, y=actual_counts, marker='.')</span><span id="04c0" class="mk ml je pm b gy pu pr l ps pt">plt.xlabel('Predicted counts')</span><span id="647f" class="mk ml je pm b gy pu pr l ps pt">plt.ylabel('Actual counts')</span><span id="d465" class="mk ml je pm b gy pu pr l ps pt">plt.show()</span></pre><p id="a9b8" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">剧情是这样的:</p><figure class="np nq nr ns gt iv gh gi paragraph-image"><div class="gh gi py"><img src="../Images/f5553cdaecf3fd305d9bffaeb9e51b91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1232/format:webp/1*XrNc3gcbkO5K8sPB-oKpsA.png"/></div><figcaption class="nt nu gj gh gi nv nw bd b be z dk">Scatter plot of Actual versus Predicted counts (Image by <a class="ae nj" href="https://sachin-date.medium.com/" rel="noopener">Author</a>)</figcaption></figure></div><div class="ab cl md me hx mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="im in io ip iq"><p id="5aac" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated"><strong class="kv jf">这里是使用 Python 进行泊松回归的完整源代码:</strong></p><figure class="np nq nr ns gt iv"><div class="bz fp l di"><div class="or os l"/></div></figure></div><div class="ab cl md me hx mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="im in io ip iq"><h2 id="4510" class="mk ml je bd mm mn mo dn mp mq mr dp ms lc mt mu mv lg mw mx my lk mz na nb nc bi translated">泊松回归模型的拟合优度</h2><p id="c61e" class="pw-post-body-paragraph kt ku je kv b kw nd kf ky kz ne ki lb lc nl le lf lg nm li lj lk nn lm ln lo im bi translated">记住泊松分布的期望值(即均值)和方差都是<em class="nk"> λ。大多数真实世界的数据都违反了这个相当严格的条件。</em></p><blockquote class="ny"><p id="9886" class="nz oa je bd ob oc od oe of og oh lo dk translated">泊松回归模型失败的一个常见原因是数据不满足泊松分布强加的<em class="op">均值=方差</em>标准。</p></blockquote><p id="cc59" class="pw-post-body-paragraph kt ku je kv b kw oi kf ky kz oj ki lb lc ok le lf lg ol li lj lk om lm ln lo im bi translated"><a class="ae nj" href="https://www.statsmodels.org/devel/generated/statsmodels.genmod.generalized_linear_model.GLMResults.html" rel="noopener ugc nofollow" target="_blank">stats models<em class="nk">glm result</em>s</a>类上的<em class="nk"> summary() </em>方法显示了一些有用的拟合优度统计数据，可帮助您评估泊松回归模型是否能够成功拟合训练数据。让我们看看他们的价值观:</p><figure class="np nq nr ns gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pz"><img src="../Images/6faf8d41a77378b16e4f6320565443f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uIuUFv6mGpj_Y3MToUX02w.png"/></div></div><figcaption class="nt nu gj gh gi nv nw bd b be z dk">Training summary for the Poisson regression model (Image by <a class="ae nj" href="https://sachin-date.medium.com/" rel="noopener">Author</a>)</figcaption></figure><p id="5e09" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">偏差和皮尔逊卡方的报告值非常大。给定这些值，很好的拟合实际上是不可能的。为了在某个置信水平(比如 95% (p=0.05))下定量确定拟合优度，我们在<em class="nk"> χ2 </em>表中查找 p=0.05 和残差自由度=163 的值。(测向残差=无观测值<em class="nk">减去</em>测向模型】。我们将该卡方值与观察到的统计数据进行比较，在这种情况下，是 GLMResults 中报告的偏差或皮尔逊卡方值。我们发现，在 p=0.05 且 DF 残差= 163 时，来自<a class="ae nj" href="https://www.medcalc.org/manual/chi-square-table.php" rel="noopener ugc nofollow" target="_blank">标准卡方表</a>的卡方值为 193.791，远小于报告的统计值 23030 和 23300。因此，根据该测试，尽管泊松回归模型显示出对测试数据集的‘好的’<em class="nk">视觉</em>拟合，但它对训练数据的拟合相当差。</p></div><div class="ab cl md me hx mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="im in io ip iq"><h2 id="f0f9" class="mk ml je bd mm mn mo dn mp mq mr dp ms lc mt mu mv lg mw mx my lk mz na nb nc bi translated">结论和下一步措施</h2><p id="d326" class="pw-post-body-paragraph kt ku je kv b kw nd kf ky kz ne ki lb lc nl le lf lg nm li lj lk nn lm ln lo im bi translated">对于基于计数的数据，泊松回归模型是一个有用的起点。然后可以将其性能与其他基于计数的流行模型进行比较，例如:</p><ol class=""><li id="f7a8" class="lp lq je kv b kw kx kz la lc lr lg ls lk lt lo lu lv lw lx bi translated">一个<a class="ae nj" rel="noopener" target="_blank" href="/an-illustrated-guide-to-the-zero-inflated-poisson-model-b22833343057"> <strong class="kv jf">零膨胀泊松模型</strong> </a>如果您怀疑您的数据包含过多的零，即比常规泊松模型所能解释的多得多的零。</li><li id="f9f5" class="lp lq je kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated"><a class="ae nj" rel="noopener" target="_blank" href="/negative-binomial-regression-f99031bb25b4"> <strong class="kv jf">负二项回归模型</strong> </a>对数据不做<em class="nk">均值=方差</em>假设。</li><li id="a9e7" class="lp lq je kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated"><a class="ae nj" rel="noopener" target="_blank" href="/generalized-poisson-regression-for-real-world-datasets-d1ff32607d79"> <strong class="kv jf">广义泊松回归模型</strong> </a>同样适用于过度分散或分散不足的数据集。</li></ol><p id="a6df" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated">快乐造型！</p></div><div class="ab cl md me hx mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="im in io ip iq"><p id="2ef4" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated"><em class="nk">感谢阅读！我写关于数据科学的主题，重点是回归和时间序列分析。</em></p><p id="8555" class="pw-post-body-paragraph kt ku je kv b kw kx kf ky kz la ki lb lc ld le lf lg lh li lj lk ll lm ln lo im bi translated"><em class="nk">如果你喜欢这篇文章，请关注我的</em><a class="ae nj" href="https://timeseriesreasoning.medium.com" rel="noopener"><strong class="kv jf"><em class="nk">Sachin Date</em></strong></a><em class="nk">获取关于回归和时间序列分析主题的提示、操作方法和编程建议。</em></p></div></div>    
</body>
</html>