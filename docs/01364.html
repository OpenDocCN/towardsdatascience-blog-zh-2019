<html>
<head>
<title>Strategies for Productionizing our Machine Learning Models</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">生产机器学习模型的策略</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/strategies-for-productionizing-our-machine-learning-models-53399a3199da?source=collection_archive---------22-----------------------#2019-03-04">https://towardsdatascience.com/strategies-for-productionizing-our-machine-learning-models-53399a3199da?source=collection_archive---------22-----------------------#2019-03-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="4510" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">让我们的最佳模式更快见天日，帮助企业更好地做出决策</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/ef15bf1461e1d611d78c229da6bb2a8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cNmECa-_RIRXQRfofXILuQ.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Photo by <a class="ae ky" href="https://unsplash.com/@sadswim?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">ian dooley</a> on <a class="ae ky" href="/s/photos/launch?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="6823" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，您已经编写了您最好的机器学习代码，并且现在已经将模型调至最佳精度。</p><p id="71ae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">现在怎么办？</strong></p><p id="029e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您将如何部署您的模型，以便业务能够真正利用该模型并做出更好的决策？</p><p id="c1b2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是我上一篇讨论<a class="ae ky" href="https://medium.com/@nikkisharma536/data-engineering-part-2-productionizing-big-data-etl-with-apache-airflow-4104a9178aea" rel="noopener">生产大数据 ETL </a>的文章的后续。在这篇文章中，我将讨论生产我们的机器学习模型的不同策略。</p><h1 id="5cf6" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">典型的培训工作流程</h1><p id="9a67" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">我们都熟悉机器学习，以及如何找到最佳模型。这是我们工作流程的样子-</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ms"><img src="../Images/fb3dc58add73bf7c9524ba048b879699.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*OirCQ5-ua0GLQjte.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Typical EDA and Training workflow</figcaption></figure><p id="8c8b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">作为一名数据科学家，我们通常将数据分为训练和测试数据，并用训练数据训练模型，然后我们预测测试数据，并根据误差指标或准确性微调我们的模型。</p><p id="dd4d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在此活动结束时，我们将获得具有最佳准确度分数的最佳模型。</p><h1 id="aab1" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">典型部署工作流</h1><p id="e86f" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">通常，一旦我们找到了最佳模型，我们会想把它保存在某个地方。保存模型很重要，因为我们在训练阶段经过大量努力和时间后实现了这一模型。我们希望重用该模型，并为新数据的预测阶段加载该模型。</p><p id="fc24" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是典型部署工作流的样子——</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mt"><img src="../Images/853753dcdfa5ae5938cf475ada2e2eec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*DOa3QqYGHia7zd3q.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Typical Prediction workflow</figcaption></figure><p id="0761" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这个工作流中，我们需要一些机制来加载我们保存的模型，并通过新到达的数据运行它。此阶段的输出是输入数据的预测数据/标签。</p><p id="40f5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">企业可能希望将这些数据保存在某个地方，或者根据实时预测数据采取一些措施。</p><h1 id="939d" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">部署策略</h1><p id="b2a0" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">有各种策略来部署我们的机器学习模型。策略的选择完全取决于我们计划如何消耗输出预测的业务需求。</p><h2 id="610d" class="mu lw it bd lx mv mw dn mb mx my dp mf li mz na mh lm nb nc mj lq nd ne ml nf bi translated">批量预测</h2><p id="24e9" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">这种预测策略通常在一天中的特定时间运行预测，或者以固定的时间间隔在一天中运行多次。当我们不需要等待实时决策并且可以按时间批量输入数据时，这种策略非常有用。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/1b9021abad1b90440b88425428c6817f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*IChIABrnMGlPvsB7.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Batch Prediction strategy</figcaption></figure><p id="8a4b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">主要步骤如下</p><ul class=""><li id="b3a4" class="nh ni it lb b lc ld lf lg li nj lm nk lq nl lu nm nn no np bi translated">代码以固定的时间/间隔运行</li><li id="699f" class="nh ni it lb b lc nq lf nr li ns lm nt lq nu lu nm nn no np bi translated">代码从保存的位置加载模型</li><li id="6170" class="nh ni it lb b lc nq lf nr li ns lm nt lq nu lu nm nn no np bi translated">代码读取一批输入数据</li><li id="0ba1" class="nh ni it lb b lc nq lf nr li ns lm nt lq nu lu nm nn no np bi translated">输入数据是我们想要预测的新的和未标记的数据</li><li id="80f3" class="nh ni it lb b lc nq lf nr li ns lm nt lq nu lu nm nn no np bi translated">输入数据可能包含分组在一起的多个用户/实体的数据</li><li id="9900" class="nh ni it lb b lc nq lf nr li ns lm nt lq nu lu nm nn no np bi translated">代码对<em class="nv">输入批次</em>运行模型预测，并产生一个<em class="nv">预测批次</em></li><li id="42c2" class="nh ni it lb b lc nq lf nr li ns lm nt lq nu lu nm nn no np bi translated">预测批次包含输入数据中每条记录的预测标签</li><li id="0006" class="nh ni it lb b lc nq lf nr li ns lm nt lq nu lu nm nn no np bi translated">预测的数据然后被保存在一些新的位置</li></ul><p id="19a9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">随着批预测管道继续运行，新的预测数据将继续追加到该位置。这些数据可用于分析和决策。</p><h2 id="a64b" class="mu lw it bd lx mv mw dn mb mx my dp mf li mz na mh lm nb nc mj lq nd ne ml nf bi translated">流式/实时预测</h2><p id="6a60" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">当必须立即做出决定时，这种策略非常有用。通常有一个应用程序需要根据用户的交互/行为/属性动态地做出一些决定。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/d0833baed53add6f8fd6ed272bf8b8b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*cRahd1BJtKycCmAx.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Streaming / Realtime prediction strategy</figcaption></figure><p id="bbfb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">主要步骤如下</p><ul class=""><li id="fed3" class="nh ni it lb b lc ld lf lg li nj lm nk lq nl lu nm nn no np bi translated">我们有一个包装代码的 web 服务</li><li id="c33a" class="nh ni it lb b lc nq lf nr li ns lm nt lq nu lu nm nn no np bi translated">web 服务公开 Rest 端点以获取预测</li><li id="5bfe" class="nh ni it lb b lc nq lf nr li ns lm nt lq nu lu nm nn no np bi translated">消费者应用程序进行 web 服务调用，并以 Json 格式发送输入数据</li><li id="5c36" class="nh ni it lb b lc nq lf nr li ns lm nt lq nu lu nm nn no np bi translated">输入数据包含预测所需的所有特征。它通常只有一条记录，而不是一批</li><li id="998a" class="nh ni it lb b lc nq lf nr li ns lm nt lq nu lu nm nn no np bi translated">代码从保存的位置加载模型</li><li id="95b9" class="nh ni it lb b lc nq lf nr li ns lm nt lq nu lu nm nn no np bi translated">当调用 web 服务端点时，代码获取输入数据</li><li id="3a94" class="nh ni it lb b lc nq lf nr li ns lm nt lq nu lu nm nn no np bi translated">代码对<em class="nv">输入数据</em>运行模型预测，并产生<em class="nv">预测数据</em></li><li id="1b7b" class="nh ni it lb b lc nq lf nr li ns lm nt lq nu lu nm nn no np bi translated">预测数据被返回给消费者应用程序</li><li id="7d26" class="nh ni it lb b lc nq lf nr li ns lm nt lq nu lu nm nn no np bi translated">消费者应用程序可以决定如何使用预测数据来获得更好的用户体验</li></ul><h2 id="a020" class="mu lw it bd lx mv mw dn mb mx my dp mf li mz na mh lm nb nc mj lq nd ne ml nf bi translated">通过 SQL 进行即席预测</h2><p id="3c66" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">这是最近在业内流行的一种新趋势。这种方法将 ML 模型公开为 SQL 函数。这种方法将新的输入数据视为表格，并允许通过将 ML 模型作为函数运行来对数据进行特别分析。输出也以表格形式显示，如果需要，可以保存下来供将来使用。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/07b9342b0fb0a5f103bb4ede522d46c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Q-GQpkGav-bjCBwf.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Ad-hoc / SQL based prediction strategy</figcaption></figure><p id="9e08" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">主要步骤如下</p><ul class=""><li id="c25e" class="nh ni it lb b lc ld lf lg li nj lm nk lq nl lu nm nn no np bi translated">ML 模型被包装在 SQL UDF 中</li><li id="0fa3" class="nh ni it lb b lc nq lf nr li ns lm nt lq nu lu nm nn no np bi translated">有一个理解 UDF 的 SQL 执行引擎(如 Spark 或 Google Big Table)</li><li id="6bbc" class="nh ni it lb b lc nq lf nr li ns lm nt lq nu lu nm nn no np bi translated">SQL 执行引擎在 UDF 中加载代码</li><li id="9ed8" class="nh ni it lb b lc nq lf nr li ns lm nt lq nu lu nm nn no np bi translated">用户向执行引擎发出 SQL 查询，在 SQL 查询中选择特征表</li><li id="abe6" class="nh ni it lb b lc nq lf nr li ns lm nt lq nu lu nm nn no np bi translated">执行引擎通过 UDF 运行输入要素来计算预测</li><li id="e721" class="nh ni it lb b lc nq lf nr li ns lm nt lq nu lu nm nn no np bi translated">预测数据被返回给用户</li><li id="83eb" class="nh ni it lb b lc nq lf nr li ns lm nt lq nu lu nm nn no np bi translated">用户可以将预测数据保存为新表</li></ul><h1 id="3c30" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">实施思路</h1><p id="334a" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">业内有各种方法解决这个问题。</p><h2 id="61d7" class="mu lw it bd lx mv mw dn mb mx my dp mf li mz na mh lm nb nc mj lq nd ne ml nf bi translated">气流调度程序</h2><p id="900c" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">气流调度程序非常适合<em class="nv">批量预测策略。</em>它可以将最大似然训练和最大似然预测作为独立的作业在不同的时间间隔运行。气流还提供了过去所有跑步的可视性。所有预测运行都可以记录预测详细信息，以供将来分析。</p><h2 id="564e" class="mu lw it bd lx mv mw dn mb mx my dp mf li mz na mh lm nb nc mj lq nd ne ml nf bi translated">码头集装箱</h2><p id="49d5" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">这是 Kaggle 在比赛中采用的方法之一。我们可以为训练和预测工作旋转 Docker 容器。容器可用于批量和实时预测策略。</p><h2 id="d430" class="mu lw it bd lx mv mw dn mb mx my dp mf li mz na mh lm nb nc mj lq nd ne ml nf bi translated">亚马逊 SageMaker</h2><p id="1d80" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">这是最流行的部署策略之一。最好的部分是它由亚马逊管理，我们不需要模型部署的基础设施。</p><p id="c65f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以在 Jupyter 笔记本中提供我们的 ML 代码。部署在 sagemaker 上的每个 ML 模型都有一个惟一的部署端点，可以用于预测。</p><blockquote class="ny nz oa"><p id="6adc" class="kz la nv lb b lc ld ju le lf lg jx lh ob lj lk ll oc ln lo lp od lr ls lt lu im bi translated">这里有一个关于 SageMaker 入门的很棒的教程</p></blockquote><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/f0a3f93ed502d0dcc344cc521c55b13e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/0*RG9vxnzX4w1N4pqS.gif"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Amazon Sage maker — Web Interface</figcaption></figure><h2 id="0d7e" class="mu lw it bd lx mv mw dn mb mx my dp mf li mz na mh lm nb nc mj lq nd ne ml nf bi translated">谷歌大查询 ML</h2><p id="2fdf" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">谷歌已经开始在 BigQuery 之上提供机器学习功能。它允许我们在现有的 BigQuery 表之上使用 ML 模型作为 SQL 函数。</p><blockquote class="ny nz oa"><p id="eb46" class="kz la nv lb b lc ld ju le lf lg jx lh ob lj lk ll oc ln lo lp od lr ls lt lu im bi translated">这里有一个关于<a class="ae ky" href="https://cloud.google.com/bigquery/docs/bigqueryml" rel="noopener ugc nofollow" target="_blank">开始使用 BigQuery ML </a>的很棒的教程</p></blockquote><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/6e2e08b7a336152c25573cad73eaf2bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*IKPMEPE3me2JjPAT.GIF"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Big Query ML — SQL predictions</figcaption></figure><h2 id="a6a3" class="mu lw it bd lx mv mw dn mb mx my dp mf li mz na mh lm nb nc mj lq nd ne ml nf bi translated">毫升流量</h2><p id="a2a2" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">ML flow 是 Databricks 的一项新举措。ML flow 是开源，并为用户提供模型跟踪和服务的能力。ML flow 对于培训生命周期来说也是很棒的，因为它提供了一个 web 界面来显示模型在多次运行中的性能和准确性。ML flow 还允许我们将多次运行作为单个实验的一部分进行分组。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/6dd32268b2b72b3174a388c17e5ac069.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*fk8YhT5zBKa6swZv.gif"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">ML Flow — Model tracking and serving</figcaption></figure><p id="ac69" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ML flow 的伟大之处在于，我们不必为保存和加载模型而编码。ML flow 为我们提供了 Python 库来加载和保存模型。</p><p id="c785" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ML flow 的另一个优点是，一旦模型与 ML flow 一起保存，就可以通过上面提到的三种策略中的任何一种进行部署。</p><blockquote class="ny nz oa"><p id="7539" class="kz la nv lb b lc ld ju le lf lg jx lh ob lj lk ll oc ln lo lp od lr ls lt lu im bi translated">这里有一个关于<a class="ae ky" href="https://www.mlflow.org/docs/latest/tutorial.html" rel="noopener ugc nofollow" target="_blank">开始使用 ML flow </a>的很棒的教程</p></blockquote><p id="188a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个帖子到此为止。在下一篇文章中，我计划写一篇关于 ML flow 或 SageMaker 的深度文章。敬请关注。</p></div><div class="ab cl oh oi hx oj" role="separator"><span class="ok bw bk ol om on"/><span class="ok bw bk ol om on"/><span class="ok bw bk ol om"/></div><div class="im in io ip iq"><p id="0c17" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="nv">原载于 2019 年 3 月 4 日</em><a class="ae ky" href="https://confusedcoders.com/data-science/machine-learning/strategies-for-productionizing-our-machine-learning-models" rel="noopener ugc nofollow" target="_blank"><em class="nv">confusedcoders.com</em></a><em class="nv">。</em></p></div></div>    
</body>
</html>