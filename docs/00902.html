<html>
<head>
<title>Transform Grayscale Images to RGB Using Python’s Matplotlib</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Python 的 Matplotlib 将灰度图像转换为 RGB</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/transform-grayscale-images-to-rgb-using-pythons-matplotlib-6a0625d992dd?source=collection_archive---------12-----------------------#2019-02-11">https://towardsdatascience.com/transform-grayscale-images-to-rgb-using-pythons-matplotlib-6a0625d992dd?source=collection_archive---------12-----------------------#2019-02-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="4c9b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">了解图像数据结构，同时为计算机视觉和深度学习管道添加两个维度</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/91f1ca8a232f86082995748dbe475a05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Kgua5M0EKHcIsR_Jb2jPRw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">R, G, &amp; B — Arabic numeral ‘3’</figcaption></figure><p id="2ae3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">数据预处理对于计算机视觉应用至关重要，将灰度图像正确转换为当前深度学习框架所期望的 RGB 格式是一项必不可少的技术。那是什么意思？</p><h2 id="8be6" class="lu lv it bd lw lx ly dn lz ma mb dp mc lh md me mf ll mg mh mi lp mj mk ml mm bi translated">理解彩色图像结构</h2><p id="2951" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">大多数彩色照片由三个互锁的数组组成，每个数组负责红色、绿色或蓝色值(因此是 RGB ),每个数组中的整数值代表一个像素值。同时，黑白或灰度照片只有一个通道，从一个阵列中读取。</p><p id="b3cf" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">使用 matplotlib 库，我们来看一幅彩色(RGB)图像:</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="2967" class="lu lv it mt b gy mx my l mz na">img = plt.imread('whales/547b59eec.jpg')<br/>plt.imshow(img)<br/>print(img.shape)<br/>(525, 1050, 3)</span></pre><p id="3493" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">matplotlib.plot.shape 调用的输出告诉我们，图像的高度为 525 像素，宽度为 1050 像素，有三个这样大小的数组(通道)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nb"><img src="../Images/b1080d2f44e3b2ba731bd19cf48060f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WH5BePCG9mt4s-g0dQvcoA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">A whale image, from a recent kaggle competition</figcaption></figure><p id="fbbe" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe nc nd ne mt b">img</code>对象是&lt;类‘numpy . ndarray’&gt;，所以让我们看看每一层的形状和值:</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="4236" class="lu lv it mt b gy mx my l mz na">#values<br/>print(img[524][1049][2])<br/>198</span><span id="758b" class="lu lv it mt b gy nf my l mz na">print(img[524][1049])<br/>[155 177 198]</span><span id="bdcc" class="lu lv it mt b gy nf my l mz na">print(img[524])<br/>[[ 68 107 140]<br/> [ 76 115 148]<br/> [ 76 115 148]<br/> [ 75 114 147]<br/> ...<br/> [171 196 216]<br/> [171 193 214]<br/> [171 193 214]<br/> [155 177 198]]</span></pre><p id="f002" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">好了，上面的打印命令告诉我们这个由 1050 列(宽)和 525 行(高)组成的图像是什么？</p><p id="2e49" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">首先，我们看最后一个像素的值，在最后一列的最后一行和最后一个通道:198。这告诉我们该文件很可能使用 0 到 255 之间的值。</p><p id="9703" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">接下来，我们查看所有三个通道中该像素的值:[155，177，198]。这些是该像素的红色、绿色和蓝色值。</p><p id="c6b1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为了好玩，我们可以跨所有层和所有行查看最后一行的值。</p><h2 id="9d30" class="lu lv it bd lw lx ly dn lz ma mb dp mc lh md me mf ll mg mh mi lp mj mk ml mm bi translated">了解灰度图像结构</h2><p id="e847" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">灰度图像只有一个通道！就是这样！</p><h2 id="c6c8" class="lu lv it bd lw lx ly dn lz ma mb dp mc lh md me mf ll mg mh mi lp mj mk ml mm bi translated">问题是</h2><p id="4f58" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">引用 Pytorch 文档:<em class="ng">所有预训练的模型都期望输入图像以相同的方式标准化，即小批量的 3 通道 RGB 形状图像(3 x H x W)...</em></p><p id="8f61" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因此，试图通过许多依赖于从标准商品模型(如 Resnet18 或-34)进行转移学习的计算机视觉/深度学习管道来摄取灰度将导致各种错误。</p><h2 id="ec5f" class="lu lv it bd lw lx ly dn lz ma mb dp mc lh md me mf ll mg mh mi lp mj mk ml mm bi translated">解决方案</h2><p id="38a6" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">给灰度添加两个额外的通道！有很多方法可以做到这一点，所以我的方法如下:将第一层复制到一个新的 3D 阵列的新层中，从而生成一个彩色图像(黑白的，所以它仍然是 B&amp;W)。</p><p id="8df0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我将使用来自<em class="ng">阿拉伯手写数字数据集</em>的一个正方形图像作为例子。形状为<code class="fe nc nd ne mt b">(28, 28)</code>，确认为单通道图像。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/e0f0e865c37b6828ae09778bdf8cbf07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1044/format:webp/1*rjGYKiJGNWlUUgikburBXw.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">matplotlib defaults grayscales as above</figcaption></figure><p id="cc77" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因为我想把它输入到一个基于 Resnet34 的模型中，所以我需要三个通道。</p><p id="c529" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">显而易见(但不太正确)的方法是添加两个相同大小的零数组:</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="9531" class="lu lv it mt b gy mx my l mz na">dim = np.zeros((28,28))</span><span id="0996" class="lu lv it mt b gy nf my l mz na">R = np.stack((O,dim, dim), axis=2)</span></pre><p id="3428" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><code class="fe nc nd ne mt b">O</code>是我们最初的阵列。我们可以很容易地将两个相同形状的零阵列相加，但我们将得到一个红色为主的图像:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/17987c037c91786699dc5264b8c68b57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1020/format:webp/1*I5qq9WwPsXejgD30CjQkKA.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">three channels, all values in channel 1</figcaption></figure><p id="83b9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">哎呦！我们希望在所有渠道中填充相同的值。不过，在此之前，让我们看看，如果我们将原始数组滚动通过每种非完全 RGB 的可能性，会发生什么:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/91f1ca8a232f86082995748dbe475a05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Kgua5M0EKHcIsR_Jb2jPRw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">R, G, B</figcaption></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/6736b436316a10296c029c3c9dcb874a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*el-kc5weiBeF8gb5hZQBig.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">RG, RB, GB</figcaption></figure><p id="53c3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">好了，这是 RGB:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/5e3f469224b8a8dc8f8522c029a79de9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1016/format:webp/1*XdbYFvdtGUX3ffhA-qYmsg.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Finally!</figcaption></figure><p id="cfdf" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">仅此而已。</p><h2 id="c33d" class="lu lv it bd lw lx ly dn lz ma mb dp mc lh md me mf ll mg mh mi lp mj mk ml mm bi translated">也</h2><p id="cbbb" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">附加代码在我的 github 上:<a class="ae nl" href="http://www.github.com/matthewarthur" rel="noopener ugc nofollow" target="_blank">www.github.com/matthewarthur</a>。我的 LinkedIn 是 https://www.linkedin.com/in/matt-a-8208aaa/的<a class="ae nl" href="https://www.linkedin.com/in/matt-a-8208aaa/" rel="noopener ugc nofollow" target="_blank"/>。打个招呼。</p><h2 id="f9fa" class="lu lv it bd lw lx ly dn lz ma mb dp mc lh md me mf ll mg mh mi lp mj mk ml mm bi translated">笔记</h2><p id="618b" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">[1]https://pytorch.org/docs/stable/torchvision/models.html<a class="ae nl" href="https://pytorch.org/docs/stable/torchvision/models.html" rel="noopener ugc nofollow" target="_blank"/></p><p id="fa39" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">[2]<a class="ae nl" href="https://www.cs.virginia.edu/~vicente/recognition/notebooks/image_processing_lab.html" rel="noopener ugc nofollow" target="_blank">https://www . cs . Virginia . edu/~ Vicente/recognition/notebooks/image _ processing _ lab . html</a></p><p id="943a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">[3]numpy 中的索引在这里详细介绍:<a class="ae nl" href="https://docs.scipy.org/doc/numpy-1.10.0/user/basics.indexing.html" rel="noopener ugc nofollow" target="_blank">https://docs . scipy . org/doc/numpy-1 . 10 . 0/user/basics . Indexing . html</a></p></div></div>    
</body>
</html>