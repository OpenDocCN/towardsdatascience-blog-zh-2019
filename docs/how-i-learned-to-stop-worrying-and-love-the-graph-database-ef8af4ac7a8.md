# 我是如何学会不再担心并爱上图形数据库的

> 原文：<https://towardsdatascience.com/how-i-learned-to-stop-worrying-and-love-the-graph-database-ef8af4ac7a8?source=collection_archive---------4----------------------->

## 形象化

## 有时，关系模型不能解决这个问题

1970 年，为 IBM 工作的英国计算机科学家 Edgar F. Codd 有一个想法，这个想法至今仍然指导着我们的工作方式。这个想法就是“关系模型”，在这种模型下，数据将被存储在具有特殊指定列的表中，这些列用于将一个表中的值与另一个表中的值相关联。

![](img/97bc6bd1f9c0d33370e8ac7fe1ddafea.png)

Edgar F. Codd (1923–2003). Father of the relational database.

Codd 为他的模型制定了 12 条规则。虽然今天的大多数数据库并没有遵循所有这些标准，但是 Codd 模型仍然在很大程度上规定了数据的建模方式。它非常结构化和数学化，遵循它的人总是使用“元组”、“关系代数”和“第三范式”这样的术语。

如果你在 20 世纪接受过正式的计算机科学培训，你可能已经记住了 Codd 的模型。如果你和我一样，这不是一个愉快的回忆。我的教授在教室的墙上挂了一张 Codd 的照片，像《1984》中的老大哥一样怒视着我们。

但是 Codd 模型是有效的。它增加了数据建模的严谨性，确保了一个干净的行列结构，非常适合 Tableau 这样的可视化工具。所以在我继续之前，向 Codd 博士致敬。

也就是说，至少有一个领域不是很好。

当我们试图理解各种数据点之间的联系时，尤其是那些可能在同一列中的数据点，这个模型就崩溃了。例如，专栏中谁是把关者和影响者？回答这个问题的 SQL 可能会非常复杂。

进入图形数据库，基本上把 Codd 的模型扔出了窗外。

以 Neo4j 等产品为代表的图形数据库基本上是一个连接数据库。这项技术使得脸书或 LinkedIn 这样的社交网站能够在用户之间建立联系。当亚马逊向你推荐一种产品时，是因为图表显示了你和购买该产品的其他人之间的联系。

在这篇文章中，我研究了如何将图形数据库的能力应用于比脸书和 LinkedIn 处理的项目规模更小的数据分析项目。我还研究了一些可视化图形数据库输出的工具。

我其实不太喜欢“图形数据库”这个术语。对于外行人来说，这听起来像是一个设计用来制作条形图或类似东西的数据库。但这是已经决定的名字，所以我会用它。不过，在本文中，我将把从图形数据库创建的可视化称为“网络”。我觉得更有描述性。

在我继续之前，我应该指出两点:

1.  虽然这里的例子将集中在 Neo4j 和相对较小的一组可视化工具上，但我并不轻视他们的竞争对手。只是 Neo4j，Tableau 等少数几个是我最了解的工具。
2.  这里给出的数据模型和例子非常简单。你不应该认为它们是图形数据库能够处理的复杂性的极限。

## 图形数据库基础

为了理解图形数据库，您必须暂时将表、行、列和外键放在一边，考虑以下四个对象:

1.  节点，大致相当于数据库中的一行。
2.  关系(也称为边)，即节点之间的连接。
3.  标签，将具有相似属性的节点和边组合在一起。您可能会设想一组节点在一个标签下组合在一起，类似于关系数据库中的一个表。
4.  属性，它们是与节点和边相关联的名称/值对。

假设我们想要创建一个图表数据库，其中包含人们以及他们首选的数据可视化工具。一个非常简单的实现可能是这样的:

“雷·罗宾逊”将会是聚集在“T2”标签“人”下的多个**节点**中的一个。他可能有**属性**，比如他的“城市”或“公司”。

Ray 将通过标签为“TOOLS】的**关系**连接到其他节点，这些节点分组在标签为**的**下，用于他使用的各种产品，例如 Tableau 和 Neo4j。

每个产品**节点**都有一个属性，指示它是什么类型的工具，比如“图形数据库”或“可视化”。

![](img/323b695601a621681fc42ba1ceef4184.png)

A simple graph data model

这样，您就有了一个简单的数据模型，它提供了一些在关系数据库中不容易实现的强大查询功能。

想象上面的模型有数千个“Person”节点，每个节点都连接到每个人使用的产品和类型的节点。例如，用户基于与他们有联系的其他用户的偏好而采用某个产品的可能性有多大？

这里需要注意的是，图形数据库不需要像关系数据库那样对数据类型和结构进行严格控制。

例如，一个节点可能与另一个节点具有不同的属性集。节点之间的关系也是如此。并且可以随时添加新的属性和标签。

至于数据类型，不用担心。如果您一直在用整数值填充某个属性，突然决定将它用于文本字符串，那么您的图形数据库不会阻止您。

对于我们这些从 Oracle、Postgres 的 SQL Server 等关系数据库开始职业生涯的人来说，这是一个很难理解的概念。这显然会带来一些风险。您可能很快就会把数据模型搞得一团糟。

但对于试图确定原因、结果和关系的分析师来说，图表模型往往更胜一筹。

简单说说图数据库属于哪一类:

一些人认为，除了文档和键值数据库之外，图形数据库只是另一种类型的“NoSQL”技术。这有一定的逻辑，因为图形数据库不使用 SQL，尽管它们有自己的查询语言。

但是许多图形倡导者认为，图形数据库的独特功能使它们自成一类。我不想在这里解决这个争论。

有了这个(非常)简短的图表解释器，让我们来看一些例子。

## 一个没有数据库的图形数据库:Gephi

体验可视化图形数据的最简单方法是使用一种工具，严格地说，它根本不是数据库。

Gephi([https://gephi.org/](https://gephi.org/))是一款免费的开源软件，最初由法国贡比涅科技大学的学生开发，现在由非营利的 ge phi 联盟支持和管理。

这是一个 Java 驱动的桌面应用程序，可以在 Windows、Mac OS 和 Linux 上运行，只要你有 Java 7 或 8、足够的内存和专用显卡。

Gephi 是本文中最有趣也最令人沮丧的工具。有趣的是，它允许您开始处理图形数据，而无需设置、配置和学习图形数据库的细节。我们稍后会谈到令人沮丧的部分。

![](img/78f19f2fbee31f9c005058429d93cdc0.png)

The Gephi user interface

为了展示 Gephi 的能力，我使用了一组在杰弗里·爱泼斯坦(Jeffrey Epstein)自杀后三天从 Twitter 上捕捉到的数据。爱泼斯坦被判虐待年轻女孩，与唐纳德·特朗普(Donald Trump)和比尔·克林顿(Bill Clinton)等许多名人有联系。

爱泼斯坦的自杀是一个保证让阴谋论者兴奋的故事，它没有让人失望。几乎立刻，推特上就出现了关于克林顿可能与爱泼斯坦之死有关的猜测，并以#克林顿身体计数为标签进行传播。

没过多久，#ClintonBodyCount 的故事就进入了主流媒体，主流媒体经常使用 Twitter 作为吸引大量公众关注的故事的预警系统。

事实上，在这三天里，只有 48，571 条#克林顿身体计数的推文，按照推特的标准，这并不算多。尽管受到媒体的关注，但这个数字本身就提出了一个问题，即#克林顿体重指数到底有多重要。

但更有趣的是，当数据被可视化为一个带有 Gephi 的网络时，我们发现了什么。

尽管#ClintonBodyCount 的故事受到了所有的关注，但下面的 Gephi 可视化显示，它是由一小群有影响的人推动的，他们的 Twitter 个人资料(“喜剧演员”…“# QA non 研究员”…“红，白和 F You 的主持人”)表明他们几乎不在美国政治讨论的主流中。

![](img/e0557384b3fe15d8801defbc6d5cab53.png)

Gephi visualization of the #ClintonBodyCount network.

Gephi 分析中最重要的一步是将您的数据放入两个电子表格或。Gephi 可以导入和读取的 csv 文件。

第一个称为“节点”文件，基本上是您希望可视化的原始数据。

第二个称为“边”文件，定义节点之间的关系。下面显示的是 edges 文件，它需要数据争论。我用 Tableau Desktop 和 Tableau Prep Builder 创建的。

但是这真的取决于你习惯使用什么工具。如果你熟悉 VLOOKUP 这样的函数，Excel 可能会工作得很好。

您还可以运行一些查询并从任何关系数据库输出文件，或者用 R 或 Python 创建一个列表。

![](img/66bc6c87b699f681c63a244b22c4571d.png)

Gephi “edges” file for the #ClintonBodyCounty analysis

edges 文件有两个必需的列:“Source”，这是启动某种操作的节点；以及“目标”，它是接收由源列发起的动作的节点。

对于#ClintonBodyCount 分析，逻辑是这样的:

1)发送推文的任何用户都列在源列中。

2)在源列中被用户提及(“@提及”)或转发(“转发”)的任何用户都在目标列中列出。

目标专栏中的用户被提及或转发的次数越多，他或她在#ClintonBodyCount 网络中的影响力就越大。

第三列“权重”在 Gephi edges 文件中是可选的。它表示源节点和目标节点之间的连接强度。在本例中，我通过将“@ reference”和“retweet”列中的值相加来计算。

当节点和边文件被加载到 Gephi 时，有趣的事情就开始了。你首先会看到一个巨大的、难以理解的方块，显示所有的连接。但是通过使用 Gephi 中包含的各种布局算法和统计函数，您将能够将您的可视化处理成类似上面显示的#ClintonBodyCount 图形。

我用来形象化#ClintonBodyCount 网络的统计数据被称为模块性，它衡量网络中社区的强度。

您还可以从 Gephi 导出您的作品，并使用您选择的图形工具增强外观。我使用了 Affinity Designer，这是一个可以在 Mac OS 应用商店买到的图形程序。

这就是 Gephi 的乐趣。现在，关于令人沮丧的部分说几句:

1.  Gephi 崩溃了。很多。由于它不能自动保存你的工作，崩溃会让你付出很多努力。我发现经常存钱很有用。由于没有 Cmd-Z 或类似的函数来回滚您的更改，我还发现在保存时创建新版本很有用。
2.  这是一个内存和 CPU 猪。我通过关闭一切可以关闭的东西(浏览器、电子邮件客户端等)获得了最好的结果。)并让 Gephi 攫取它想要的所有系统资源。
3.  它的许多最佳特性都是由独立开发者创建的插件的结果。当一个新版本的 Gephi 出来时，你喜欢的插件可能需要一段时间才能赶上。

所有这些听起来都很原始。尽管如此，对于一个不花你一分钱，也不需要后端数据库的工具来说，它有一些令人印象深刻的功能，这些功能是你在 Tableau 等传统可视化工具中找不到的。

## Gephi 资源

要了解更多，网上有很多教程。请确保您正在查看的版本与您的 Gephi 版本一致。最新版本是 0.9.2。

肯塔基大学图书馆制作的关于 Gephi 的最好的视频教程之一，可以在:[https://www.youtube.com/watch?v=2FqM4gKeNO4](https://www.youtube.com/watch?v=2FqM4gKeNO4)找到

此外，Paul Oldham 有一个很棒的教程，是关于使用 Gephi 来可视化专利网络的，在:【https://www.pauloldham.net/gephi_patent_network/

## 现在是一个实际的图形数据库:Neo4j

维护数十亿字节企业和政府数据的数据库管理员仍然对图形数据库持相当大的怀疑态度。可以公平地说，在可预见的未来，关系数据库将统治世界。

在图形世界中，似乎最受关注的公司是 Neo4j(【https://neo4j.com/】)公司，该公司 12 年前在瑞典发布了第一个开源图形数据库。如今，它的总部设在加州圣马特奥，客户包括瑞银、易贝和沃尔玛等公司。其政府客户名单包括美国陆军和美国宇航局。

![](img/f061917682f0891380f55326a39feb7b.png)

The Neo4j desktop (left) and data browser (right).

为了研究 Neo4j 的能力，我选择了由美国司法部维护的外国代理人注册法案(FARA)数据集。FARA 法律实质上要求在美国代表外国政府工作的“代理人”(即游说者)向联邦政府注册。

未能注册者(保罗·马纳福特，下来吧！)可以被起诉，送进监狱。但是起诉很少。所以首先要知道的是数据集可能不完整。

为了让数据更有趣，我加入了由透明国际维护的清廉指数。根据政府和商业专家的观点，该指数根据公众感知的腐败程度对各国进行排名，并在 https://www.transparency.org/cpi2018 做了充分的解释。

合并后的数据会生成一个数据集，显示美国哪些代理代表了被认为腐败最严重和最不严重的县。使用传统的行列数据结构，您可以对数据做一些非常有趣的事情。

例如，这是 Tableau 中的一个可视化图，显示了根据感知的腐败程度进行颜色编码的国家。点击一个国家，用户可以看到谁在美国代表这些国家。我突出显示了俄罗斯。

![](img/e772facc70af4a22674d4c8e6d6bee24.png)

Foreign agents visualization with Tableau.

如果这就是你想要的，那很好。但如果你想调查这些国家和代理商之间的联系网络，你最好的选择是像 Neo4j 这样的图形数据库。这意味着将数据从行列格式迁移到图形数据库所需的节点和边中。

为图表建模数据是一个非常深奥的课题。如果你愿意的话，你可以在 https://neo4j.com/developer/data-modeling/的 Neo4j 建模教程中读到更多关于它的内容。

但我会首先为您的数据建立一组类别，然后考虑每个数据点属于哪个类别。对于 FARA 的数据，很明显有三个类别:

1.  Country，它包括关于某个特定国家的所有数据。
2.  外国委托人，包括特定外国的企业或政府机构等实体。
3.  代理人，他们是在美国注册代表外国委托人的说客。

您可以从将节点加载到 Neo4j。csv 文件，使用简单的“从文件加载 CSV…”脚本，这在 https://neo4j.com/developer/guide-import-csv/的[的 Neo4j 文档中有详细说明。这非常类似于将数据加载到关系数据库的表中。](https://neo4j.com/developer/guide-import-csv/)

这样，您就有了三种类型的节点，每种节点都在各自的标签下分组。很明显，您的数据模型需要两种不同的关系:一种将每个国家连接到基于那里的外国委托人，另一种将外国委托人连接到他们的注册代理。

您可以通过执行图中每个关系所显示的命令来创建这些关系，如下所示。

![](img/f2f72f2b6b0461170f7e824ced9b777d.png)

Neo4j data model for the Foreign Agents Registration (FARA) database, including Cypher code to build relationships.

Neo4j 有一个全功能的查询和命令语言“Cypher ”,它本质上是 SQL 的图形数据库版本。我发现它相对直观，容易学习。有关赛弗的详细信息可在 https://neo4j.com/developer/cypher-basics-i/[获得。](https://neo4j.com/developer/cypher-basics-i/)

Cypher 的主要优点是，它允许您只用几行代码就可以完成许多行嵌套 SQL 所需要的工作。

例如，假设您想要创建代表俄罗斯企业和政府机构的代理之间的连接的网络样式视图。上面的可视化表格向您展示了如何处理行和列数据。

但是如果您的数据在一个图模型中，几行 Cypher 就可以创建一个完整的以网络为中心的视图，如下所示。

![](img/f47d536c72d2bf6f7eb77867f69bfdff.png)

Graph of agents representing Russian interests in the U.S., with the query that produced it.

虽然 Tableau 可以通过一个 API 与 Neo4j 集成，但它不能提供这种数据视图。数据以行列格式返回到 Tableau。因此，除非您愿意经历许多变通办法，否则您仍然无法获得数据的真正网络视图。

Neo4j 数据浏览器很不错，尤其是对于一个免费社区版 Neo4j 自带的工具来说。但相对来说是骨瘦如柴。你在上面看到的是你能承受的极限。

## 批准

Neo4j 的企业版附带了一个功能更加全面的可视化工具，名为 Bloom。Enterprise Neo4j 还可以容纳其他网络可视化工具，如 Linkurious([https://linkurio.us/](https://linkurio.us/))和 Keylines([https://cambridge-intelligence.com/keylines/](https://cambridge-intelligence.com/keylines/))，这两个工具都是商业许可的。

这就把我们带到了定价问题上。如果您的组织对 Neo4j 的企业版感兴趣，并且符合该公司对初创公司的定义(【https://neo4j.com/startup-program/?ref=subscription】)，您可以免费设置 Neo4j 的有限部署。

如果你不是一家初创公司，但仍然需要企业版，价格会变得有点模糊。该公司不公布其定价模式，而是要求潜在客户联系其报价。一位代表告诉我，“配置选项很复杂，定价取决于具体情况。”。

旧的“逐案”定价模式绝不是你想从企业软件公司听到的。但 Neo4j 有一个很棒的产品，显然可以蒙混过关。如果你跟他们追求企业牌照，得到了答案，我很想听听。

## GraphXR

一个有趣的新可视化工具是 graph xr[https://www.kineviz.com/](https://www.kineviz.com/)，它可以很容易地与免费的社区版 Neo4j 集成。安装后，GraphXR 只是作为 Neo4j 桌面上另一个可用的数据浏览器出现。

您可以在 GraphXR 浏览器中输入与 Neo4j 中相同种类的 Cypher 查询。但结果更有活力，坦率地说，近乎迷幻。例如，编写以下 Cypher 查询以返回在美国代表中国利益的代理的图表:

MATCH(c:Country)-:BASE->(f:foreign principal)-由 - > (a:Agent)代表

*其中 c.Country = "中国"*

*在 Neo4j 中，结果将类似于我们已经看到的俄罗斯网络。但是在 GraphXR 中，它看起来是这样的:*

*![](img/ad42da4fafecc4998cbf05a4e63178e0.png)*

*GraphXR visualization of agents representing Chinese interest in the U.S.*

*GraphXR 提供了一些控件来调整可视化的外观。例如，您可以调整节点的大小和颜色。您还可以放大和缩小您的可视化，移动节点，甚至旋转它，以从不同的角度查看它。*

*然而，背景颜色仅限于一个选项:黑色。我还发现节点的标签有点模糊不清。在这个时候，似乎没有办法改变这一点。*

*有趣的是，GraphXR 还支持使用 Oculus Rift 耳机的虚拟现实可视化。我不确定我是否完全理解这个商业案例，但我希望有一天能看到它。显然，虚拟现实数据可视化的美好新世界即将到来。*

## *批准*

*上面的可视化是用 GraphXR 的“Explorer”版本创建的，该版本是免费的，可以作为 Neo4j 桌面的插件运行。它有三个项目的限制。*

*下一步是“分析师”版，它有 30 个项目的限制，每年花费 1320 美元。*

*最后，还有“企业”版，它允许无限*

*项目。可以通过 GraphXR 了解价格。*

## *最后*

*我认为可以肯定地说，我们在这方面存在能力差距。一方面，我们有传统的可视化工具，如 Tableau，它内置了强大的分析功能，以及对可视化几乎每个方面的粒度控制。*

*但是它们的能力在很大程度上受到我们都知道的行列数据模型的限制。对于试图理解个人和组织之间关系的分析师来说，这并不理想。*

*像 Neo4j 这样的图形数据库解决了这个问题，但是在可视化网络方面有所欠缺。对可视化“外观和感觉”的控制往往是非常初级的。*

*像 Linkurious 和 Keylines 这样的商业网络可视化工具解决了这个问题，但代价是只为 Neo4j 这样的图形数据库授权一个额外的产品。对于小企业和自由职业分析师来说，这可能会让人望而却步。*

*国际组织实施 Neo4j/Linkurious 的示例*

*在 https://offshoreleaks.icij.org/stories/wilbur-louis-ross-jr 可以看到调查记者联盟(ICIJ)。*

*对于 Tableau 及其竞争对手来说，理想的解决方案是将图形数据库可视化添加到他们现有的功能中。Tableau 目前有一个 Web 数据连接器，允许它向 Neo4j 提交用 Cypher 编写的查询。*

*你可以在 https://neo4j.com/blog/neo4j-tableau-integration/的[了解更多信息。但是数据是以表格格式返回到 Tableau 的，所以我们仍然没有能力生成网络可视化。](https://neo4j.com/blog/neo4j-tableau-integration/)*

*我怀疑我们没有从 Tableau 这样的工具中看到这种能力的原因是:a)对它的需求还不存在；b)开发它需要大量的工作。*

*但就像老歌里说的“我可以做梦，不是吗？”*