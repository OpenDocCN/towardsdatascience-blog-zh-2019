<html>
<head>
<title>Cloud Run: Dataset Summaries via HTTP Request</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">云运行:通过 HTTP 请求的数据集摘要</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/cloud-run-dataset-summaries-via-http-request-9b5fe24fe9c1?source=collection_archive---------38-----------------------#2019-07-08">https://towardsdatascience.com/cloud-run-dataset-summaries-via-http-request-9b5fe24fe9c1?source=collection_archive---------38-----------------------#2019-07-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0341" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用熊猫轮廓</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/3e4e27985c3f0a68c52829ea321bdec3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JPJ2bq3Fb3Kmeq-gTMBoDA.png"/></div></div></figure><p id="15a4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">Google Cloud Run 为运行无状态容器提供了一个托管平台。随着计算基础架构得到管理，它可以自动扩展以响应用户流量的增加。云运行服务通过 HTTP 请求或异步事件(如发布/订阅消息)接收 web 流量。这个项目使用 Cloud Run 来运行一个无状态容器，该容器使用 Pandas profiling 来显示结构化 CSV 数据集的汇总统计信息。CSV 文件通过 HTTP 请求传递给容器。<strong class="kw iu">首先，启动 Google Cloud Shell 实例，通过运行:</strong> <code class="fe lq lr ls lt b">git clone <a class="ae lu" href="https://github.com/dvdbisong/google-cloud-run.git." rel="noopener ugc nofollow" target="_blank">https://github.com/dvdbisong/google-cloud-run.git</a></code> <a class="ae lu" href="https://github.com/dvdbisong/google-cloud-run.git." rel="noopener ugc nofollow" target="_blank"> <strong class="kw iu">来拉资源库。</strong> </a></p><h1 id="e82a" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">目录</h1><ul class=""><li id="aa81" class="mn mo it kw b kx mp la mq ld mr lh ms ll mt lp mu mv mw mx bi translated"><a class="ae lu" href="https://medium.com/p/9b5fe24fe9c1#0341" rel="noopener">云运行:使用 Pandas Profiling 的数据摘要</a></li><li id="b132" class="mn mo it kw b kx my la mz ld na lh nb ll nc lp mu mv mw mx bi translated"><a class="ae lu" href="https://medium.com/p/9b5fe24fe9c1#15b2" rel="noopener">申请代码</a></li><li id="08bb" class="mn mo it kw b kx my la mz ld na lh nb ll nc lp mu mv mw mx bi translated"><a class="ae lu" href="https://medium.com/p/9b5fe24fe9c1#a1b8" rel="noopener">创建容器图像</a></li><li id="3df5" class="mn mo it kw b kx my la mz ld na lh nb ll nc lp mu mv mw mx bi translated"><a class="ae lu" href="https://medium.com/p/9b5fe24fe9c1#b782" rel="noopener">使用云构建构建映像，并上传到容器注册表</a></li><li id="cbdd" class="mn mo it kw b kx my la mz ld na lh nb ll nc lp mu mv mw mx bi translated"><a class="ae lu" href="https://medium.com/p/9b5fe24fe9c1#6fc6" rel="noopener">使用云运行部署容器</a></li><li id="18d3" class="mn mo it kw b kx my la mz ld na lh nb ll nc lp mu mv mw mx bi translated"><a class="ae lu" href="https://medium.com/p/9b5fe24fe9c1#3913" rel="noopener">在谷歌云存储上公开数据集</a></li><li id="b31f" class="mn mo it kw b kx my la mz ld na lh nb ll nc lp mu mv mw mx bi translated"><a class="ae lu" href="https://medium.com/p/9b5fe24fe9c1#5344" rel="noopener">检索数据集摘要</a></li><li id="dec9" class="mn mo it kw b kx my la mz ld na lh nb ll nc lp mu mv mw mx bi translated"><a class="ae lu" href="https://medium.com/p/9b5fe24fe9c1#f4b2" rel="noopener">结论</a></li></ul><h1 id="15b2" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">应用程序代码</h1><p id="93e7" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld nd lf lg lh ne lj lk ll nf ln lo lp im bi translated">文件<code class="fe lq lr ls lt b">app.py</code>中的应用程序代码包含使用 Flask web 框架编写的 Python 代码，该框架通过路径<code class="fe lq lr ls lt b">/profile</code>在端口 8080 上通过 HTTP 接收结构化的(格式良好的)CSV 文档，并返回包含数据集摘要分析的网页。数据集汇总统计数据是用<code class="fe lq lr ls lt b">pandas-profiling</code>包生成的。代码在<code class="fe lq lr ls lt b">pandas-profile</code>目录下，可以在<strong class="kw iu">谷歌代码编辑器(云壳的一个组件)上查看。</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/8fca8cf3a82b8c0c177df335efc3b11a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lQI-xOt8FHO-F8H4hlnnfA.png"/></div></div><figcaption class="nh ni gj gh gi nj nk bd b be z dk">View the app.py file on Google Code Editor (Cloud Shell).</figcaption></figure><h1 id="a1b8" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">创建容器图像</h1><p id="9941" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld nd lf lg lh ne lj lk ll nf ln lo lp im bi translated">docker 文件概述了创建容器映像的方法。对于这个项目，我们将基于官方 Python 映像构建 docker 文件。Dockerfile 指定了构建映像时要安装在容器上的相关包。<strong class="kw iu">使用谷歌代码编辑器，</strong>导航至<code class="fe lq lr ls lt b">pandas-profile</code>查看 docker 文件。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/5d314228b9ef12b1c8b0207c80f970b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eFyif8Q66dlMhfP5AoR52Q.png"/></div></div><figcaption class="nh ni gj gh gi nj nk bd b be z dk">View the Dockerfile on Google Code Editor (Cloud Shell).</figcaption></figure><p id="0129" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">为了完整起见，下表总结了 docker 文件中使用的命令。</p><pre class="kj kk kl km gt nm lt nn no aw np bi"><span id="6a49" class="nq lw it lt b gy nr ns l nt nu">+------------+-----------------------------------------------------+<br/>| <strong class="lt iu">Command</strong>    | <strong class="lt iu">Description                                         </strong>|<br/>+------------+-----------------------------------------------------+<br/>| <strong class="lt iu">FROM</strong>       | The base Docker image for the Dockerfile.           |<br/>| <strong class="lt iu">RUN</strong>        | It execute commands on top of the current image as  |                              |              new layers.                                         |<br/>| <strong class="lt iu">COPY</strong>       | Copies files from the local machine to the          |<br/>|              container filesystem.                               |<br/>| <strong class="lt iu">CMD</strong>        | Specifies the command to execute when running the   |   |              container. This command is overridden if another    |   |              command is specified at runtime.                    |<br/>| <strong class="lt iu">WORKDIR</strong>    | Set working directory of the container.             |<br/>| <strong class="lt iu">ENV</strong>        | Set Environment variable as a key-value pair that   | |              will be available in the container after building.  |<br/>+------------+-----------------------------------------------------+</span></pre><h1 id="b782" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">使用云构建构建映像，并上传到容器注册中心</h1><p id="e910" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld nd lf lg lh ne lj lk ll nf ln lo lp im bi translated">Cloud Build 是一项 GCP 服务，用于自动化代码工件的部署，作为 CI/CD 管道的一部分。这里，Cloud Build 用于构建 Docker 映像，作为一系列构建步骤，完成的映像被推送到 Google 容器注册表。以下代码使用云构建构建映像，并将映像上传到容器注册。从目录<code class="fe lq lr ls lt b">pandas-profile</code>运行这段代码。</p><p id="de0e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe lq lr ls lt b">gcloud builds submit --tag gcr.io/ekabasandbox/dataset-profile</code></p><p id="d272" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">其中，<br/> - <code class="fe lq lr ls lt b">ekabasandbox</code>为 GCP 项目 ID，<br/> - <code class="fe lq lr ls lt b">dataset-profile</code>为图像名称。<br/>确保根据需要修改这些参数。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/c0b1b669ee18c39510e5964d3b3c1a61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZgUBL8Y63ecsFaAGkFItYA.png"/></div></div><figcaption class="nh ni gj gh gi nj nk bd b be z dk">Building Image with Cloud Build.</figcaption></figure><p id="b536" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">要查看 Google 容器注册表上的图像，请运行以下代码:</p><p id="f895" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe lq lr ls lt b">gcloud container images list</code></p><h1 id="6fc6" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">使用云运行部署容器</h1><p id="7c55" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld nd lf lg lh ne lj lk ll nf ln lo lp im bi translated">下一步将把映像部署到 Cloud Run 并运行容器。使用下面的代码部署到云运行。选择部署托管云运行计算的区域(最好是<code class="fe lq lr ls lt b">us-central1</code>)。当提示输入服务名时，接受缺省值，并响应<code class="fe lq lr ls lt b">y</code>以允许未经身份验证的调用。</p><p id="db86" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe lq lr ls lt b">gcloud beta run deploy --image gcr.io/ekabasandbox/dataset-profile --platform managed --memory 2Gi</code></p><p id="f0a2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">当容器被部署时，我们得到消息:</p><p id="ef2a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><code class="fe lq lr ls lt b">Service [<strong class="kw iu">dataset-profile</strong>] has been deployed and is serving traffic at <a class="ae lu" href="https://dataset-profile-4fa5lgaxpq-uc.a.run.app/" rel="noopener ugc nofollow" target="_blank"><strong class="kw iu">https://dataset-profile-4fa5lgaxpq-uc.a.run.app</strong></a></code></p><p id="7de4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">打开服务 URL 以查看部署的容器。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/4ae0984be0e066736655bd85843b856f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fPwBWeLGmLrJp9x_7M3Kcg.png"/></div></div><figcaption class="nh ni gj gh gi nj nk bd b be z dk">Home Page of Deployed Application Container.</figcaption></figure><h1 id="3913" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">在 Google 云存储上公开数据集</h1><p id="5e1c" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld nd lf lg lh ne lj lk ll nf ln lo lp im bi translated">我们将作为 HTTP 请求传递给 Cloud Run 上的应用程序的数据集存储在 Google 云存储中。对于此项目，通过编辑对象权限使数据集可公开访问。添加一个新的名称设置为<code class="fe lq lr ls lt b">allUsers</code>的<code class="fe lq lr ls lt b">User</code>实体。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/3480a6dcad46b860673a1096297cdeb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CBkvsQDOH4V-tjkWHQzTjw.png"/></div></div><figcaption class="nh ni gj gh gi nj nk bd b be z dk">Make Dataset on GCS publicly available.</figcaption></figure><h1 id="5344" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">检索数据集摘要</h1><p id="11c6" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld nd lf lg lh ne lj lk ll nf ln lo lp im bi translated">要使用<code class="fe lq lr ls lt b">pandas profiling</code>检索数据集摘要，将公共数据集 URL 从 Google 云存储传递到路径<code class="fe lq lr ls lt b">/profile</code>并获取变量<code class="fe lq lr ls lt b">data</code>。放在一起我们就有了 URL <code class="fe lq lr ls lt b"><a class="ae lu" href="https://dataset-profile-4fa5lgaxpq-uc.a.run.app/profile?data=https://storage.googleapis.com/ekaba-test-data/crypto-markets-1.csv" rel="noopener ugc nofollow" target="_blank">https://dataset-profile-4fa5lgaxpq-uc.a.run.app/profile?data=https://storage.googleapis.com/ekaba-test-data/crypto-markets-1.csv</a></code>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/247451c46d9f381df15e5cf07fa17dcf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OZ7btSoC7xthuNLZTUzK8w.png"/></div></div><figcaption class="nh ni gj gh gi nj nk bd b be z dk">Dataset Summary with Pandas Profile.</figcaption></figure><h1 id="f4b2" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">结论</h1><p id="95ae" class="pw-post-body-paragraph ku kv it kw b kx mp ju kz la mq jx lc ld nd lf lg lh ne lj lk ll nf ln lo lp im bi translated">本文提供了在 Cloud Run 上构建和部署无状态容器化应用程序的演练。在本例中，我们使用 Python <code class="fe lq lr ls lt b">pandas-profiling</code>包实现了一个简单的应用程序，为结构化 CSV 数据集生成探索性数据分析输出。像这样的应用程序使得用最少的努力理解更多关于数据集的信息变得非常容易。最后，确保删除云运行服务，以及云容器注册表中不再需要的图像。</p></div></div>    
</body>
</html>