<html>
<head>
<title>Pandarallel — A simple and efficient tool to parallelize your pandas computation on all your CPUs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">pandarallel——一个简单有效的工具，可以在所有 CPU 上并行处理 pandas 计算</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/pandaral-lel-a-simple-and-efficient-tool-to-parallelize-your-pandas-operations-on-all-your-cpus-bb5ff2a409ae?source=collection_archive---------5-----------------------#2019-04-02">https://towardsdatascience.com/pandaral-lel-a-simple-and-efficient-tool-to-parallelize-your-pandas-operations-on-all-your-cpus-bb5ff2a409ae?source=collection_archive---------5-----------------------#2019-04-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0d04" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何仅用一行代码显著加快熊猫的计算速度？</h2></div><p id="4372" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">完整的<strong class="kk iu"> Pandaral lel </strong>存储库和文档可在此<a class="ae le" href="https://github.com/nalepae/pandarallel" rel="noopener ugc nofollow" target="_blank"> GitHub 页面</a>上获得。</p><p id="bba5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">本文中介绍的库只在 Linux &amp; MacOS 上受支持。</p></div><div class="ab cl lf lg hx lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="im in io ip iq"><h1 id="0e65" class="lm ln it bd lo lp lq lr ls lt lu lv lw jz lx ka ly kc lz kd ma kf mb kg mc md bi translated">什么问题困扰着我们？</h1><p id="6f04" class="pw-post-body-paragraph ki kj it kk b kl me ju kn ko mf jx kq kr mg kt ku kv mh kx ky kz mi lb lc ld im bi translated">用<a class="ae le" href="https://github.com/pandas-dev/pandas" rel="noopener ugc nofollow" target="_blank">熊猫</a>，当你运行下面一行:</p><figure class="mj mk ml mm gt mn"><div class="bz fp l di"><div class="mo mp l"/></div></figure><p id="4445" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您会得到以下 CPU 使用率:</p><figure class="mj mk ml mm gt mn gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/0b072e509d4861921a720a15729d2fed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1398/1*72cCDhz-xyWJLZ7t1_NQJA.gif"/></div><figcaption class="mt mu gj gh gi mv mw bd b be z dk">Standard Pandas apply — Only 1 CPU is used.</figcaption></figure><p id="89b4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">即使你的计算机有几个 CPU，也只有一个完全专用于你的计算。</p><p id="2562" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们希望<strong class="kk iu">用一种简单的方法</strong>得到类似这样的结果，而不是 CPU 的使用量:</p><figure class="mj mk ml mm gt mn gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/1f5bf1984bb8058d82eff09f28bf481d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1398/1*hewtDiUsL0nZqJJHlmosOA.gif"/></div><figcaption class="mt mu gj gh gi mv mw bd b be z dk">Parallel Pandas apply — All CPUs are used.</figcaption></figure><h1 id="5b3b" class="lm ln it bd lo lp mx lr ls lt my lv lw jz mz ka ly kc na kd ma kf nb kg mc md bi translated">Pandaral lel 如何帮助解决这个问题？</h1><p id="df93" class="pw-post-body-paragraph ki kj it kk b kl me ju kn ko mf jx kq kr mg kt ku kv mh kx ky kz mi lb lc ld im bi translated">Pandaral lel 的想法是将你的熊猫计算分布到你计算机上所有可用的 CPU 上，以获得显著的速度提升。</p><h2 id="af8e" class="nc ln it bd lo nd ne dn ls nf ng dp lw kr nh ni ly kv nj nk ma kz nl nm mc nn bi translated">安装:</h2><figure class="mj mk ml mm gt mn"><div class="bz fp l di"><div class="mo mp l"/></div></figure><p id="aade" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在 Windows 上，<strong class="kk iu"> Pandaral lel </strong>只有在 Python 会话(<code class="fe no np nq nr b">python</code>、<code class="fe no np nq nr b">ipython</code>、<code class="fe no np nq nr b">jupyter notebook</code>、<code class="fe no np nq nr b">jupyter lab</code>)时才起作用，...)从<a class="ae le" href="https://docs.microsoft.com/en-us/windows/wsl/install-win10" rel="noopener ugc nofollow" target="_blank">Linux 的 Windows 子系统(WSL) </a>执行。</p><p id="1655" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在 Linux &amp; macOS 上，不需要做什么特别的事情。</p><h2 id="2594" class="nc ln it bd lo nd ne dn ls nf ng dp lw kr nh ni ly kv nj nk ma kz nl nm mc nn bi translated">导入和初始化:</h2><figure class="mj mk ml mm gt mn"><div class="bz fp l di"><div class="mo mp l"/></div></figure><h2 id="210d" class="nc ln it bd lo nd ne dn ls nf ng dp lw kr nh ni ly kv nj nk ma kz nl nm mc nn bi translated">用法:</h2><p id="349c" class="pw-post-body-paragraph ki kj it kk b kl me ju kn ko mf jx kq kr mg kt ku kv mh kx ky kz mi lb lc ld im bi translated">有一个简单的用例，有一个熊猫数据帧<code class="fe no np nq nr b">df</code>和一个应用函数<code class="fe no np nq nr b">func</code>，只需用<code class="fe no np nq nr b">parallel_apply</code>替换经典的<code class="fe no np nq nr b">apply</code>。</p><figure class="mj mk ml mm gt mn"><div class="bz fp l di"><div class="mo mp l"/></div></figure><p id="2e74" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你完了！</p><p id="a20e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="ns">注意，如果不想并行化计算，仍然可以使用经典的</em> <code class="fe no np nq nr b"><em class="ns">apply</em></code> <em class="ns">方法。</em></p><p id="87b7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您也可以通过在<code class="fe no np nq nr b">initialize</code>函数中传递<code class="fe no np nq nr b">progress_bar=True</code>来显示每个工作 CPU 的进度条。</p><figure class="mj mk ml mm gt mn gh gi paragraph-image"><div role="button" tabindex="0" class="nt nu di nv bf nw"><div class="gh gi gj"><img src="../Images/892fd3fd8c54b38fdb69e97bae06dd67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*2JMAri0TzN6Ftn2hzeTJSg.gif"/></div></div><figcaption class="mt mu gj gh gi mv mw bd b be z dk">Parallel apply with a progress bar</figcaption></figure><p id="fd48" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">还有一个更复杂的用例，有一个 pandas 数据帧<code class="fe no np nq nr b">df</code>，这个数据帧的两列<code class="fe no np nq nr b">column1</code>和<code class="fe no np nq nr b">column2</code>，以及一个要应用的函数<code class="fe no np nq nr b">func</code>:</p><figure class="mj mk ml mm gt mn"><div class="bz fp l di"><div class="mo mp l"/></div></figure></div><div class="ab cl lf lg hx lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="im in io ip iq"><h1 id="729e" class="lm ln it bd lo lp lq lr ls lt lu lv lw jz lx ka ly kc lz kd ma kf mb kg mc md bi translated">基准</h1><p id="b833" class="pw-post-body-paragraph ki kj it kk b kl me ju kn ko mf jx kq kr mg kt ku kv mh kx ky kz mi lb lc ld im bi translated">对于四个可用的示例<a class="ae le" href="https://github.com/nalepae/pandarallel/blob/master/docs/examples.ipynb" rel="noopener ugc nofollow" target="_blank">此处</a>，在以下配置上:</p><ul class=""><li id="02ba" class="nx ny it kk b kl km ko kp kr nz kv oa kz ob ld oc od oe of bi translated">操作系统:Linux Ubuntu 16.04</li><li id="a01a" class="nx ny it kk b kl og ko oh kr oi kv oj kz ok ld oc od oe of bi translated">硬件:英特尔酷睿 i7 处理器，3.40 GHz，4 核</li></ul><figure class="mj mk ml mm gt mn gh gi paragraph-image"><div role="button" tabindex="0" class="nt nu di nv bf nw"><div class="gh gi ol"><img src="../Images/486f2046e7d5a8f69de39863de0486c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Mnn9MFY13mPiUgzU5yGscA.png"/></div></div><figcaption class="mt mu gj gh gi mv mw bd b be z dk">Standard vs. Parallel on 4 cores (lower is better)</figcaption></figure><p id="a828" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">除了<code class="fe no np nq nr b">df.groupby.col_name.rolling.apply</code>的速度只提升了 3.2 倍，平均速度提升了大概 4 倍，也就是所用电脑上的核心数量。</p></div><div class="ab cl lf lg hx lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="im in io ip iq"><h1 id="6635" class="lm ln it bd lo lp lq lr ls lt lu lv lw jz lx ka ly kc lz kd ma kf mb kg mc md bi translated"><strong class="ak">它是如何在引擎盖下工作的？</strong></h1><p id="3969" class="pw-post-body-paragraph ki kj it kk b kl me ju kn ko mf jx kq kr mg kt ku kv mh kx ky kz mi lb lc ld im bi translated">当<code class="fe no np nq nr b">parallel_apply</code>被调用时，<strong class="kk iu"> Pandaral lel: </strong></p><ul class=""><li id="08c8" class="nx ny it kk b kl km ko kp kr nz kv oa kz ob ld oc od oe of bi translated">实例化一个<a class="ae le" href="https://arrow.apache.org/docs/python/plasma.html" rel="noopener ugc nofollow" target="_blank"> Pyarrow 等离子共享内存</a>，然后</li><li id="277b" class="nx ny it kk b kl og ko oh kr oi kv oj kz ok ld oc od oe of bi translated">为每个 CPU 创建一个子进程，并要求每个 CPU 处理数据帧的一个子部分，然后</li><li id="4e75" class="nx ny it kk b kl og ko oh kr oi kv oj kz ok ld oc od oe of bi translated">组合父流程中的所有结果</li></ul><p id="98b6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">与其他进程间通信介质相比，使用共享内存的主要优点是没有串行化/解串行化，这可能会非常耗费 CPU。</p></div><div class="ab cl lf lg hx lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="im in io ip iq"><p id="b6ac" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果您发现此工具有用，但如果缺少某个功能，请在此处写下新的功能请求<a class="ae le" href="https://github.com/nalepae/pandarallel/issues" rel="noopener ugc nofollow" target="_blank">。</a></p></div></div>    
</body>
</html>