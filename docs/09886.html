<html>
<head>
<title>Introduction to Git Data Extraction and Analysis in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python 中 Git 数据提取和分析简介</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/introduction-to-git-data-extraction-and-analysis-in-python-e7e2bf9b4606?source=collection_archive---------10-----------------------#2019-12-27">https://towardsdatascience.com/introduction-to-git-data-extraction-and-analysis-in-python-e7e2bf9b4606?source=collection_archive---------10-----------------------#2019-12-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="ca96" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">从 Github REST API 中提取 Git 数据并在 Pandas 和 Plotly 中执行数据分析</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/5bf176f1fd6fcbd83ed865e69f17ee9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*sgPx2LWGu6EF2LcX"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Photo by <a class="ae ky" href="https://unsplash.com/@coloradocolby?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Colby Thomas</a> on <a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="b40a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">软件行业有没有人没用过或者至少听说过 Git？</p><p id="3970" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Git 是一个革命性的工具，如今在软件团队中无处不在。本文的目的并不是介绍 git，有大量的资源可以指导您完成这个过程。它的目的是分析 git 相关数据，以便从这些数据中获得重要的见解。</p><p id="46a7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在整篇文章中，我们将使用 Github REST API 提取 Git 相关数据，然后利用 Python 的顶级数据分析库<strong class="lb iu"> <em class="lv">【熊猫】</em> </strong>以及广受欢迎的交互式数据可视化库<strong class="lb iu"> <em class="lv"> Plotly </em> </strong>来分析这些数据。我们将以<a class="ae ky" href="https://github.com/apache/spark" rel="noopener ugc nofollow" target="_blank"> Apache Spark </a>的存储库为例。</p><h1 id="44a0" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">Git 数据提取</h1><p id="97f6" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">Git 存储库通常存储在源代码托管设施中。其中最流行的是 Github 和 Bitbucket，但是也有很多其他的，比如 Gitea、GitLab 等等。在本文中，我们将重点关注 Github，但是其他托管设施的数据提取过程应该也是类似的。</p><p id="b006" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Github 提供了一个 REST API，其中包含了所有 git 相关资源的端点。为了能够使用 Github APIs，我们需要在 Github Profile 页面的开发者设置中生成一个访问令牌。做完那件事后，我们应该都准备好了。我们启动 Jupyter 笔记本，首先导入必要的库:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="a330" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将配置参数存储在一个单独的文件中，即 Github 用户名和我们之前生成的访问令牌。与 Github 交互的推荐方式是使用 API 创建一个会话，如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="7ddd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="lv">哪些与 git 相关的实体可以提供关于 git 存储库进展的有价值的信息？</em></p><p id="ba26" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">提交</strong>是首先想到的，但也有其他的，如分支、拉请求、问题、贡献者列表等。假设我们需要检索给定 git 存储库的提交列表。我们搜索<a class="ae ky" href="https://developer.github.com/v3/" rel="noopener ugc nofollow" target="_blank"> Github API 文档</a>并找到相应的 API 端点:</p><pre class="kj kk kl km gt mz my na nb aw nc bi"><span id="f569" class="nd lx it my b gy ne nf l ng nh">GET /repos/:owner/:repo/commits</span></pre><p id="aea6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里我们需要提供所有者和存储库名称作为输入参数。我们可以像这样用 Python 调用上面的 API 端点:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="8ecf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe mv mw mx my b">commits </code>变量包含从 Github API 返回的响应。然后我们使用 json 包的<code class="fe mv mw mx my b">json() </code>方法来反序列化上面的响应对象。然而，这个 API 调用只返回 30 个结果，这对应于默认情况下通过单个 Github API 响应返回的结果数。我们可以为 API 请求提供一个额外的参数，<code class="fe mv mw mx my b">per_page</code>,这允许我们将返回结果的数量增加到 100 个，但是我们试图从中提取数据的 Apache Spark 存储库有大约 26K 个提交！</p><p id="d2b2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">别担心。Github 的家伙们提供了一个分页参数，称为<code class="fe mv mw mx my b">page</code>，它与<code class="fe mv mw mx my b">per_page</code>参数相结合，使我们能够提取任何 git 库的所有提交。现在，我们的 API 请求应该如下所示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="b929" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以将提交提取过程封装在一个函数中，该函数将所有者和存储库名称作为参数，并返回一个提交列表:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="54b4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了控制遍历过程，在每次迭代中，我们检查响应头中的<code class="fe mv mw mx my b">Link</code>参数是否包含<code class="fe mv mw mx my b">rel="Next"</code>属性值，这告诉我们存在一个连续的页面，我们可以继续迭代；否则我们就此打住。为了更多地了解这种方法，你可以阅读 Github 文档中的<a class="ae ky" href="https://developer.github.com/v3/guides/traversing-with-pagination/" rel="noopener ugc nofollow" target="_blank">分页遍历</a>指南。</p><p id="a752" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">提取了列表中的提交后，我们现在可以从字典列表中生成 Pandas 数据帧，因此我们定义了以下函数来处理该任务:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="0c57" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe mv mw mx my b">json_normalize</code>函数很好地做到了这一点，它将一个半结构化的 JSON(字典列表)规范化为一个平面表。我们现在通过为 Apache Spark git 存储库传递必要的参数来调用上面创建的函数:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="8ba0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对其他资源的提取执行相同的过程，所以我跳过这一部分，您可以在本文的 Github 资源库中浏览。我还添加了将结果存储在 CSV 文件或 SQLAlchemy 支持的数据库中的可能性，以便我们可以访问这些数据以供以后分析。</p></div><div class="ab cl ni nj hx nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="im in io ip iq"><h1 id="2f91" class="lw lx it bd ly lz np mb mc md nq mf mg jz nr ka mi kc ns kd mk kf nt kg mm mn bi translated">数据预处理</h1><p id="7183" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">因此，我们将提交和分支以及其他资源存储在内存中(如果您愿意，也可以存储在 CSV 文件中)。下一步是预处理这些数据。</p><p id="f0cb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">检查提交数据帧的结构，我们得到以下结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/fa7e2611d0f73f74f769ca71cd78eedc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KTTbie4_zplhKN5linPCfA.png"/></div></div></figure><p id="31c0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将删除这些列中的大部分，更重要的是，我们将生成一些数据分析过程所需的与时间相关的列。以下代码将提交日期字段转换为日期时间字段，并利用<code class="fe mv mw mx my b">dt </code>访问器对象获取熊猫系列的类似日期时间的属性:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="7594" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">删除不必要的列后，我们的<code class="fe mv mw mx my b">commits.head </code>方法返回:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/479b63f34815454959667811634b8a8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zjq9_pAjloiUzG-U9pUPpQ.png"/></div></div></figure></div><div class="ab cl ni nj hx nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="im in io ip iq"><h1 id="518f" class="lw lx it bd ly lz np mb mc md nq mf mg jz nr ka mi kc ns kd mk kf nt kg mm mn bi translated">Git 数据分析</h1><p id="e16c" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">现在，我们转向数据科学领域的精彩部分——数据分析和数据可视化。Spark 资源库的贡献者总数是多少？</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/f7dbbf806c0cca31c615a32bb5a884e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:786/format:webp/1*5RazTP7pMbmQvrXzTBfFIw.png"/></div></figure><p id="4416" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一个很好的洞察是一天中每个小时提交的分布情况。我们可以计算这个度量，因为我们已经为存储库的每次提交生成了一天中的某个小时。熊猫的代码是:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="3b96" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在是时候可视化一些数据了。Plotly Python 库(<a class="ae ky" href="https://plot.ly/python/" rel="noopener ugc nofollow" target="_blank"> plotly.py </a>)是一个交互式、<a class="ae ky" href="https://github.com/plotly/plotly.py" rel="noopener ugc nofollow" target="_blank">开源</a>绘图库，支持 40 多种独特的图表类型，涵盖了广泛的统计、金融、地理、科学和三维用例。作为一个<a class="ae ky" href="https://en.wikipedia.org/wiki/Declarative_programming" rel="noopener ugc nofollow" target="_blank">声明式编程</a>库，Plotly 允许我们编写代码来描述<em class="lv">我们想要制作什么</em>，而不是<em class="lv">如何制作</em>。这大大减少了构建图表所花费的时间，并使我们更加专注于展示和解释结果。</p><p id="1c3c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">标准 plotly 导入以及离线运行的设置如下:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="aba7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">回到我们有趣的每小时提交量指标，生成条形图所需的代码如下:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/6f46e79c33f21f3bd228acc0b9a74c9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NUEzhzvPVbeZ1biV674u4g.png"/></div></div></figure><p id="b44f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从图表中，我们注意到大部分的贡献都是在晚上提交的:)。在一天的工作时间里，活动较少。</p><p id="779b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">随着时间的推移，Spark 存储库进展如何？这些年来它的活动是什么？让我们创建一个时序图并检查它。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/f614f67b8b74422071845cec1d40140d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EbptwEVDmvn2FmNfsLGlxw.png"/></div></div></figure><p id="3e28" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">事实证明，Spark repository 在 2015 年至 2016 年期间出现了活动高峰。但是我们能证明这个假设吗？当然可以！我们将计算每年的<em class="lv">日均提交数量，以验证 2015 年和 2016 年是否是 Spark 存储库最活跃的年份。</em></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/3445ac51e7719f03ca855ffadfc7b2b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a6m1Euetg4Ma3qWZyrG4Dg.png"/></div></div></figure><p id="2b16" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面的图表清楚地显示，存储库在 2015 年达到顶点，此后一直下降到 2017 年。从那时起，我们看到每年的日均提交数量保持稳定，并且直到撰写本文时，这种趋势一直存在。</p><p id="d141" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">谁是 Spark 存储库的主要贡献者？让我们找出它。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/f6d0dc7bd35e91bb24bd90a8a3cb83af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xqxSI2XrUXLU9ih1PwXzbA.png"/></div></div></figure><p id="b47a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">作为一个非常活跃的存储库，Spark 也有很多开放的拉取请求。通常，拉请求由一些预定义的关键字标记。下面的条形图显示了每个标签的拉取请求数:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mt mu l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/540e8a400160915a16cab74f55ff8fee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uFpgfSwr92zkKLcicWGgXA.png"/></div></div></figure><p id="9c6a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">很明显，最活跃的贡献者正在从事与 SQL 相关的功能。最后，Spark 是一个数据框架，允许对数 Pb 的数据进行类似 SQL 的操作。</p></div><div class="ab cl ni nj hx nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="im in io ip iq"><h1 id="b657" class="lw lx it bd ly lz np mb mc md nq mf mg jz nr ka mi kc ns kd mk kf nt kg mm mn bi translated">恭喜</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/54d2a72e257103d8db241f70f5eb2c73.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*B0z6-Snv7rfX3TJ-"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Photo by <a class="ae ky" href="https://unsplash.com/@ianstauffer?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Ian Stauffer</a> on <a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="1395" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您已到达这篇文章的结尾。在本指南中，我们学习了以下重要概念:</p><ul class=""><li id="532b" class="nz oa it lb b lc ld lf lg li ob lm oc lq od lu oe of og oh bi translated">通过 Github API 在 Python 中提取数据</li><li id="3d80" class="nz oa it lb b lc oi lf oj li ok lm ol lq om lu oe of og oh bi translated">预处理 git 数据</li><li id="1bf6" class="nz oa it lb b lc oi lf oj li ok lm ol lq om lu oe of og oh bi translated">使用 Pandas 和 Plotly 执行交互式分析和数据可视化</li></ul><p id="6479" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是我们在这篇文章中运行的所有内容的完整代码:</p><div class="on oo gp gr op oq"><a href="https://github.com/xhentilokaraj/git-statistics" rel="noopener  ugc nofollow" target="_blank"><div class="or ab fo"><div class="os ab ot cl cj ou"><h2 class="bd iu gy z fp ov fr fs ow fu fw is bi translated">xhentilokaraj/git-统计</h2><div class="ox l"><h3 class="bd b gy z fp ov fr fs ow fu fw dk translated">这是一个基于 git 库生成统计数据的迷你项目。已经有把 Github 当版本了…</h3></div><div class="oy l"><p class="bd b dl z fp ov fr fs ow fu fw dk translated">github.com</p></div></div><div class="oz l"><div class="pa l pb pc pd oz pe ks oq"/></div></div></a></div><p id="f27c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> <em class="lv">感谢</em> </strong> <em class="lv">的阅读！如果你想与我取得联系，请随时通过 xhentilokaraj@gmail.com 或我的</em> <a class="ae ky" href="https://al.linkedin.com/in/xhentilo-karaj-66227aa7" rel="noopener ugc nofollow" target="_blank"> <em class="lv"> LinkedIn 个人资料</em> </a> <em class="lv">联系我。</em></p></div></div>    
</body>
</html>