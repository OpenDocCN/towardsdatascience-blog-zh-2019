<html>
<head>
<title>Extracting data from various sheets with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 Python 从各种工作表中提取数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/replacing-sheets-with-python-f1608e58d2ca?source=collection_archive---------6-----------------------#2019-08-25">https://towardsdatascience.com/replacing-sheets-with-python-f1608e58d2ca?source=collection_archive---------6-----------------------#2019-08-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a80f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">或者如何学习统一 Google 工作表、Excel 和 CSV 文件——代码指南</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/5abcdffaa034393bd82ae3949fd9a2d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2YFXvI0cxM0VgNxyVK4eXg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Widespread tabular data storage file formats — CSV, Microsoft Excel, Google Sheets</figcaption></figure><p id="2d3f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Python 通常被称为粘合语言。这是因为随着时间的推移，开发了大量的接口库和特性——这是由它的广泛使用和令人惊叹的、广泛的开源社区推动的。这些库和特性提供了对不同文件格式以及数据源(数据库、网页和 API)的直接访问。</p><p id="ae27" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这个故事着重于数据的提取部分。下周的故事将更深入地分析综合数据，以获得有意义和令人兴奋的见解。</p><div class="lu lv gp gr lw lx"><a rel="noopener follow" target="_blank" href="/how-to-explore-and-visualize-a-dataset-with-python-7da5024900ef"><div class="ly ab fo"><div class="lz ab ma cl cj mb"><h2 class="bd iu gy z fp mc fr fs md fu fw is bi translated">如何使用 Python 浏览和可视化数据集</h2><div class="me l"><h3 class="bd b gy z fp mc fr fs md fu fw dk translated">了解如何使用 Seaborn 快速生成漂亮而有见地的图表</h3></div><div class="mf l"><p class="bd b dl z fp mc fr fs md fu fw dk translated">towardsdatascience.com</p></div></div><div class="mg l"><div class="mh l mi mj mk mg ml ks lx"/></div></div></a></div><p id="23c5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">但是不要让这阻止你自己分析数据。</p><h2 id="c4a7" class="mm mn it bd mo mp mq dn mr ms mt dp mu lh mv mw mx ll my mz na lp nb nc nd ne bi translated">您将学到的内容:</h2><ul class=""><li id="4c35" class="nf ng it la b lb nh le ni lh nj ll nk lp nl lt nm nn no np bi translated">从 Google Sheets 中提取数据</li><li id="cfed" class="nf ng it la b lb nq le nr lh ns ll nt lp nu lt nm nn no np bi translated">从 CSV 文件中提取数据</li><li id="1c59" class="nf ng it la b lb nq le nr lh ns ll nt lp nu lt nm nn no np bi translated">从 Excel 文件中提取数据</li></ul><h2 id="1271" class="mm mn it bd mo mp mq dn mr ms mt dp mu lh mv mw mx ll my mz na lp nb nc nd ne bi translated">这篇文章是写给谁的:</h2><ul class=""><li id="764a" class="nf ng it la b lb nh le ni lh nj ll nk lp nl lt nm nn no np bi translated">Python 初学者</li><li id="f832" class="nf ng it la b lb nq le nr lh ns ll nt lp nu lt nm nn no np bi translated">不得不经常争论数据的人</li></ul><p id="d96c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">由于本文旨在作为一篇代码文章，您应该设置您的开发环境(我推荐 Jupyter Notebook/Lab)并开始一个新的笔记本。你可以在这里找到源代码和文件<a class="ae nv" href="https://github.com/FBosler/Medium-Data-Extraction" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="b1cc" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你不知道如何使用 Jupyter/Python。请查看该指南:</p><div class="lu lv gp gr lw lx"><a rel="noopener follow" target="_blank" href="/get-started-with-python-e50dc8c96589"><div class="ly ab fo"><div class="lz ab ma cl cj mb"><h2 class="bd iu gy z fp mc fr fs md fu fw is bi translated">所以你想成为一名数据科学家？</h2><div class="me l"><h3 class="bd b gy z fp mc fr fs md fu fw dk translated">到底是什么阻止了你？下面是如何开始！</h3></div><div class="mf l"><p class="bd b dl z fp mc fr fs md fu fw dk translated">towardsdatascience.com</p></div></div><div class="mg l"><div class="nw l mi mj mk mg ml ks lx"/></div></div></a></div></div><div class="ab cl nx ny hx nz" role="separator"><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc"/></div><div class="im in io ip iq"><h1 id="c8ac" class="oe mn it bd mo of og oh mr oi oj ok mu jz ol ka mx kc om kd na kf on kg nd oo bi translated">情况:</h1><p id="fea7" class="pw-post-body-paragraph ky kz it la b lb nh ju ld le ni jx lg lh op lj lk ll oq ln lo lp or lr ls lt im bi translated">在今天的故事中，我将带你进入一个虚构但可能非常熟悉的场景。你要结合各种来源的数据来创建一个报告或运行一些分析。</p><p id="7a11" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">免责声明:下面的例子和使用的数据完全是虚构的</strong></p><p id="cd6e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你的任务是找出如何提高你的销售团队的业绩。在我们假设的情况下，潜在客户有相当自发的需求。当这种情况发生时，您的销售团队会在系统中输入一个订单线索<strong class="la iu"> </strong>。然后，您的销售代表会尝试在订单线索被发现时安排一次会议。有时在之前，有时在之后。你的销售代表有一个费用预算，并且总是把会议和他们付钱的一顿饭结合在一起。销售代表报销他们的费用，并将发票交给会计团队处理。在潜在客户决定是否接受你的报价后，勤奋的销售代表会跟踪订单线索是否转化为销售。</p><p id="7897" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">对于您的分析，您可以访问以下三个数据源:</p><ul class=""><li id="26c4" class="nf ng it la b lb lc le lf lh os ll ot lp ou lt nm nn no np bi translated">100，000 条订单线索(谷歌表单)</li><li id="151a" class="nf ng it la b lb nq le nr lh ns ll nt lp nu lt nm nn no np bi translated">约 50.000 份餐费发票(Excel 文件)</li><li id="fc4a" class="nf ng it la b lb nq le nr lh ns ll nt lp nu lt nm nn no np bi translated">公司和负责这些公司的销售代表的列表(CVS 文件)</li></ul></div><div class="ab cl nx ny hx nz" role="separator"><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc"/></div><div class="im in io ip iq"><h1 id="efc4" class="oe mn it bd mo of og oh mr oi oj ok mu jz ol ka mx kc om kd na kf on kg nd oo bi translated">获取 Google Sheets 数据:</h1><p id="1180" class="pw-post-body-paragraph ky kz it la b lb nh ju ld le ni jx lg lh op lj lk ll oq ln lo lp or lr ls lt im bi translated">访问 Google Sheets 是三者中最复杂的，因为它要求您设置一些使用 Google Sheets API 的凭证。理论上，您可以抓取一个公开可用的 Google Sheet(即，提取 HTML 源代码)，但是您必须使用 Beautiful Soup 之类的工具进行大量的数据操作，才能将 HTML 转储转换成有用的东西。我确实试过这个，但是结果很乱，不值得努力。那就 API 吧。此外，我们将使用<a class="ae nv" href="https://gspread.readthedocs.io/en/latest/oauth2.html" rel="noopener ugc nofollow" target="_blank"> gspread </a>更加无缝地转换成熊猫数据帧。</p><h2 id="bf2c" class="mm mn it bd mo mp mq dn mr ms mt dp mu lh mv mw mx ll my mz na lp nb nc nd ne bi translated">获取 OAuth2 凭据</h2><p id="dc3f" class="pw-post-body-paragraph ky kz it la b lb nh ju ld le ni jx lg lh op lj lk ll oq ln lo lp or lr ls lt im bi translated"><strong class="la iu">前往</strong> <a class="ae nv" href="https://console.developers.google.com/project" rel="noopener ugc nofollow" target="_blank"> <strong class="la iu">谷歌开发者控制台</strong> </a> <strong class="la iu">并创建一个新项目</strong>(或者选择一个已有的)。单击“创建项目”按钮。如果你的公司使用谷歌邮件，你可能想换成你的私人账户，以避免潜在的权限冲突。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/f7e1a84c647ad39332c97f8c1e03b23c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Fr-io07CYWVte07uQwP_Cg.png"/></div></div></figure><p id="3d55" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">为你的项目选择一个名字</strong>(名字不重要，我称之为矿媒数据提取)</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ow"><img src="../Images/63b600029e3ff5ac65e3ee2d36ae2b1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*fD4dIcoxxJiqx6E_cwDmWQ.png"/></div></figure><p id="4562" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">点击 API&amp;服务</strong>并前往库</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ox"><img src="../Images/9a02cd24677e410f7fd62e452d54f372.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kzJaL4-s-MXFkaBi_uyWXg.png"/></div></div></figure><p id="a983" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">启用 Google Sheets API。</strong>点击结果，在下一页点击启用 API。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oy"><img src="../Images/e46b8d978b3cf1698e2991dc3fd54e55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KeZg_3qIWWgvq26ns1MbBw.png"/></div></div></figure><p id="d07d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">创建服务账户&amp;密钥文件。</strong>服务账户是用于具有有限访问权限的编程访问的专用账户。服务帐户可以而且应该由 project 设置，并具有尽可能具体的权限以及手头任务所必需的权限。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oz"><img src="../Images/0e5a6fb75e95bc89bf82824647f30772.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4dtKnVGnyyCXSmrFeOg2Bg.png"/></div></div></figure><p id="f243" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">创建一个 JSON(另一种文件格式)密钥文件。对于角色，选择“项目-&gt;查看器”</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pa"><img src="../Images/564c562520d483955e4ff8d521e53f0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*OG6VhBjv6G_TwxUad7ZXEw.png"/></div></figure><p id="55ad" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果在上一步中没有设置角色，现在就设置。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pb"><img src="../Images/464af93111fa5a03974436f28db9c2cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1292/format:webp/1*W5F2z2tQm_KSQrjoT2rA9w.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Note: Setting “Viewer” is somewhat restrictive. If you want to create google sheets programmatically, you’ll have to choose a different setting</figcaption></figure><p id="0907" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您的私有 JSON 密钥文件将可以下载或者自动下载。我建议将该文件重命名为“medium _ Data _ Extraction _ key . JSON ”,并将该文件移动到您的 Jupyter 笔记本的文件夹中，因为这将使下面的示例无缝工作。JSON 文件包含您最近创建的服务帐户的凭证。</p><p id="3866" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">完美。你差不多完成了。</strong></p><h2 id="4ec0" class="mm mn it bd mo mp mq dn mr ms mt dp mu lh mv mw mx ll my mz na lp nb nc nd ne bi translated">下载数据</h2><p id="bdc6" class="pw-post-body-paragraph ky kz it la b lb nh ju ld le ni jx lg lh op lj lk ll oq ln lo lp or lr ls lt im bi translated">首先，您必须通过在笔记本中运行以下命令来下载并安装附加的软件包。</p><pre class="kj kk kl km gt pc pd pe pf aw pg bi"><span id="53ee" class="mm mn it pd b gy ph pi l pj pk">!pip install gspread<br/>!pip install oauth2client</span></pre><p id="c6e6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">其次，您必须确保将之前创建的 JSON 密钥文件移动到运行 Jupyter 笔记本的文件夹中，如果它还不在那里的话。或者，您可以指定一个不同的 GOOGLE_KEY_FILE 路径。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pl pm l"/></div></figure><p id="36b5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">WORKBOOK_KEY 是我为本次会议准备的 Google 工作表的工作簿 id。</p><pre class="kj kk kl km gt pc pd pe pf aw pg bi"><span id="0e2e" class="mm mn it pd b gy ph pi l pj pk">WORKBOOK_KEY = '10HX66PbcGDvx6QKM8DC9_zCGp1TD_CZhovGUbtu_M6Y'</span></pre><p id="6ec9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">该表是公开的。如果您想下载不同的数据，您需要更改 WORKBOOK_KEY。id 通常可以在问题 URL 的 Google 工作表的最后两个反斜杠之间找到。</p></div><div class="ab cl nx ny hx nz" role="separator"><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc"/></div><div class="im in io ip iq"><h1 id="250d" class="oe mn it bd mo of og oh mr oi oj ok mu jz ol ka mx kc om kd na kf on kg nd oo bi translated">获取 CSV 数据</h1><p id="2965" class="pw-post-body-paragraph ky kz it la b lb nh ju ld le ni jx lg lh op lj lk ll oq ln lo lp or lr ls lt im bi translated">我们既可以通过传统方式从<a class="ae nv" href="https://github.com/FBosler/Medium-Data-Extraction" rel="noopener ugc nofollow" target="_blank"> repo </a>下载 CSV 数据，也可以使用下面的代码片段。同样，您可能需要像这样安装缺失的请求包(在您的笔记本中运行):</p><pre class="kj kk kl km gt pc pd pe pf aw pg bi"><span id="3e72" class="mm mn it pd b gy ph pi l pj pk">!pip install requests</span></pre><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pl pm l"/></div></figure><p id="d799" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">CSV 数据的美妙之处在于 Python / Pandas 可以开箱即用地处理它。对于 Excel，还需要额外的库。</p></div><div class="ab cl nx ny hx nz" role="separator"><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc"/></div><div class="im in io ip iq"><h1 id="d75d" class="oe mn it bd mo of og oh mr oi oj ok mu jz ol ka mx kc om kd na kf on kg nd oo bi translated">获取 Excel 数据</h1><p id="89f5" class="pw-post-body-paragraph ky kz it la b lb nh ju ld le ni jx lg lh op lj lk ll oq ln lo lp or lr ls lt im bi translated">在我们开始之前，你很可能必须安装<a class="ae nv" href="https://openpyxl.readthedocs.io/en/stable/#" rel="noopener ugc nofollow" target="_blank"> openpyxl </a>和<a class="ae nv" href="https://pypi.org/project/xlrd/" rel="noopener ugc nofollow" target="_blank"> xlrd </a>，这使得你的熊猫也能打开 Excel 表格。</p><pre class="kj kk kl km gt pc pd pe pf aw pg bi"><span id="725f" class="mm mn it pd b gy ph pi l pj pk">!pip install openpyxl<br/>!pip install xlrd</span></pre><p id="06ea" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">完成之后，我们以同样的方式获得 Excel 数据，并将其加载到另一个数据框架中。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pl pm l"/></div></figure><p id="56fd" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">搞定！</strong>您已经创建了三个不同的 Pandas 数据框，并且可以在同一个 Jupyter 笔记本中访问它们:</p><ul class=""><li id="d749" class="nf ng it la b lb lc le lf lh os ll ot lp ou lt nm nn no np bi translated">销售 _ 数据</li><li id="4e3c" class="nf ng it la b lb nq le nr lh ns ll nt lp nu lt nm nn no np bi translated">销售 _ 团队</li><li id="aaa1" class="nf ng it la b lb nq le nr lh ns ll nt lp nu lt nm nn no np bi translated">发票</li></ul><p id="dc05" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">请继续关注下周的文章，届时我们将探讨如何组合这些数据框架并分析数据。</p></div></div>    
</body>
</html>