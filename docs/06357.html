<html>
<head>
<title>Mastering the art of web scraping with Selenium and Python [Part 2/2]</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Selenium 和 Python 掌握 web 抓取的艺术[第 2/2 部分]</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/mastering-the-art-of-web-scraping-with-selenium-and-python-part-2-2-66ee4f3b5f44?source=collection_archive---------19-----------------------#2019-09-12">https://towardsdatascience.com/mastering-the-art-of-web-scraping-with-selenium-and-python-part-2-2-66ee4f3b5f44?source=collection_archive---------19-----------------------#2019-09-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="e2c6" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">Selenium 是与网站进行高级交互的强大工具:登录、点击…让我们用它来抓取网页</h2></div><p id="5b26" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">好吧，让我们做一些简单的事情:<strong class="kh ir">收集 Spotify 上所有可用的艺术家</strong>。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi lb"><img src="../Images/422abbb7b726cce8e9b05ce41eb1ce9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*LH8Yd2UzRHU7ZHw5DA1Zwg.gif"/></div></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk">That’s a robot scrolling through Spotify’s catalog of artists</figcaption></figure><p id="df58" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">⚠️Obviously，我需要在这里放一个免责声明⚠️ <br/> <em class="lr">不要用这种方法倒卖你收集的数据，这些都是公司私有的。特别是，不要转售 Spotify 数据或对其做任何非法的事情。</em></p><p id="9a28" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第二点备注:既然 Spotify 有一个<a class="ae ls" href="https://developer.spotify.com/documentation/web-api/" rel="noopener ugc nofollow" target="_blank"> API </a>，那么从网站获取数据就有点蠢了。然而，这是一个很好的练习<em class="lr">和</em>你通常可以从网络抓取中获得比使用受限 API 更多(但更慢)的东西(虽然不确定 Spotify 是否如此)。</p><p id="4a52" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您错过了关于 Selenium 和 Python 的第一篇文章，请点击这里:</p><div class="lt lu gp gr lv lw"><a rel="noopener follow" target="_blank" href="/mastering-the-art-of-web-scraping-with-selenium-and-python-part-1-2-90a216199873"><div class="lx ab fo"><div class="ly ab lz cl cj ma"><h2 class="bd ir gy z fp mb fr fs mc fu fw ip bi translated">使用 Selenium 和 Python 掌握 web 抓取艺术(第 1/2 部分)</h2><div class="md l"><h3 class="bd b gy z fp mb fr fs mc fu fw dk translated">Selenium 是与网站进行高级交互的强大工具:登录、点击…让我们用它来抓取网页</h3></div><div class="me l"><p class="bd b dl z fp mb fr fs mc fu fw dk translated">towardsdatascience.com</p></div></div><div class="mf l"><div class="mg l mh mi mj mf mk ll lw"/></div></div></a></div><h1 id="b75b" class="ml mm iq bd mn mo mp mq mr ms mt mu mv jw mw jx mx jz my ka mz kc na kd nb nc bi translated">首先，了解网站是如何运作的</h1><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi nd"><img src="../Images/466834857330e29d566f6789004528d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yDYFTvnJ6hcoNnrb7hQbcQ.png"/></div></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk">Spotify’s page when “a” was typed in the search bar</figcaption></figure><ol class=""><li id="eb7e" class="ne nf iq kh b ki kj kl km ko ng ks nh kw ni la nj nk nl nm bi translated">您需要登录才能看到艺术家</li><li id="7e8e" class="ne nf iq kh b ki nn kl no ko np ks nq kw nr la nj nk nl nm bi translated">搜索时不会显示所有艺术家——否则你的浏览器会因加载的大量数据而崩溃……所以你需要发挥创造力，在避免浏览器溢出的同时获得比显示更多的内容</li><li id="9301" class="ne nf iq kh b ki nn kl no ko np ks nq kw nr la nj nk nl nm bi translated">你需要以某种方式召集所有的艺术家。同样，这里需要一些创造力</li></ol><h2 id="5c20" class="ns mm iq bd mn nt nu dn mr nv nw dp mv ko nx ny mx ks nz oa mz kw ob oc nb od bi translated">研究 html</h2><p id="53df" class="pw-post-body-paragraph kf kg iq kh b ki oe jr kk kl of ju kn ko og kq kr ks oh ku kv kw oi ky kz la ij bi translated">打开 Chrome 开发者工具，深入研究 html。艺术家的名字和相关联的 url 位于一个“div”标记中，该标记具有一个等于“Search__content”的类</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi oj"><img src="../Images/cbc8335bea9f9ea48def2bc4f70f1a5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bCLoKdskK0_e5wfL5JfjNw.png"/></div></div></figure><p id="1297" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在您需要向下滚动，因为只显示了 50 位艺术家。我花了相当多的时间在这里，因为滚动不是在整个窗口，而是在艺术家标签。想法是:取最后一个加载的艺术家并滚动到它。</p><h2 id="3d3e" class="ns mm iq bd mn nt nu dn mr nv nw dp mv ko nx ny mx ks nz oa mz kw ob oc nb od bi translated">最后，回顾任务</h2><p id="5574" class="pw-post-body-paragraph kf kg iq kh b ki oe jr kk kl of ju kn ko og kq kr ks oh ku kv kw oi ky kz la ij bi ok translated">如前一篇文章所见，登录部分很简单。</p><p id="bac1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">正常</strong></p><p id="3fb6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi ok translated">搜索部分应该不是最难的:只需在搜索栏中写些东西，然后按回车键。有一个关于搜索完成后向下滚动的问题，以及你需要向下滚动多少次。<br/><strong class="kh ir">~还好好歹</strong></p><p id="a056" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi ok translated">彻底搜索似乎是最棘手的部分。我们不知道我们是否会得到 Spotify 上艺术家的完整列表，没有什么会告诉我们我们已经达到了 Spotify 上艺术家的最大数量。从<a class="ae ls" href="https://www.quora.com/What-are-the-total-number-of-artists-on-Spotify" rel="noopener ugc nofollow" target="_blank">这个</a>，看起来有 100 万到 100 万 2M 艺术家。<br/><strong class="kh ir">~好吧总之</strong></p><p id="3378" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们言归正传。</p><h1 id="fd23" class="ml mm iq bd mn mo mp mq mr ms mt mu mv jw mw jx mx jz my ka mz kc na kd nb nc bi translated">然后设计你的网页抓取方案</h1><h2 id="df20" class="ns mm iq bd mn nt nu dn mr nv nw dp mv ko nx ny mx ks nz oa mz kw ob oc nb od bi translated">Bot 指南</h2><p id="2d4c" class="pw-post-body-paragraph kf kg iq kh b ki oe jr kk kl of ju kn ko og kq kr ks oh ku kv kw oi ky kz la ij bi translated">我们将为我们的网页抓取机器人设定两条准则:</p><ol class=""><li id="3b53" class="ne nf iq kh b ki kj kl km ko ng ks nh kw ni la nj nk nl nm bi translated">它将滚动 4̶0̶ 100 次[ <em class="lr">更新:尝试了 40 次，但得到了太多的重复，搜索后改为 100 次</em></li><li id="d436" class="ne nf iq kh b ki nn kl no ko np ks nq kw nr la nj nk nl nm bi translated">它将在目录中搜索两个字母的所有可能组合</li></ol><p id="c2b4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以估计大约 26x26 个搜索，大约 50 个结果/滚动导致<br/> 26 x 26 x 50 x 100 = 3 380 000 最大独特艺术家。注意，我们可能会有很多副本。</p><h2 id="3734" class="ns mm iq bd mn nt nu dn mr nv nw dp mv ko nx ny mx ks nz oa mz kw ob oc nb od bi translated">并行运行</h2><p id="3551" class="pw-post-body-paragraph kf kg iq kh b ki oe jr kk kl of ju kn ko og kq kr ks oh ku kv kw oi ky kz la ij bi translated">您想要做的另一件事是将流程设置为并行执行。您不希望等待一个 python 脚本来完成所有工作，而是希望有多个 python 脚本来完成这项工作。</p><p id="7259" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这种情况下，我们可以设置<em class="lr"> 2̵6̵ </em> 4bots [ <em class="lr">更新:试过 26 我的电脑死机了，还注意到打开 5 个以上窗口后页面停止刷新；我把它改成了 4 个机器人</em>，每个机器人从一个不同的字母开始，第二个字母尝试 26 个字母。例:<em class="lr">机器人 1 会尝试‘aa’，‘ab’，‘AC’，…，‘az’。</em>注意，26 个[ <em class="lr"> 4 </em> ] Chrome 会话将运行我的 Mac(我可怜的 Mac…)。不确定 Spotify 是否会自动检测同一个用户的多个活动会话并断开我的连接[ <em class="lr">更新:它不关心多个会话</em> ]。生活是有风险的，有时候你只能盲目去相信。</p><h2 id="f483" class="ns mm iq bd mn nt nu dn mr nv nw dp mv ko nx ny mx ks nz oa mz kw ob oc nb od bi translated">实时监控</h2><p id="00fb" class="pw-post-body-paragraph kf kg iq kh b ki oe jr kk kl of ju kn ko og kq kr ks oh ku kv kw oi ky kz la ij bi translated">在创建和运行脚本之前，您还需要实时监控流程的进展情况。我不知道如何做到这一点，但我可以想到看到所有机器人的进度条，他们完成的预期剩余时间，当前收集的艺术家数量…因此，多一个 Python 脚本将进行实时监控。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi ot"><img src="../Images/daae5b77d1f85b5a6fb6b27cc649f7ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i3W0XLcpTZlngR9KUSx-PQ.png"/></div></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk">The Jupyter Notebook is monitoring in real-time the 5 web scraping bots. Note they have really different speed.</figcaption></figure><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi ou"><img src="../Images/d620b942a973252bde047b3d354157da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4Tw4HxGgSOKUPZn5Xs4mcw.png"/></div></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk">The number of artists found gets updated in real-time as well as the number of duplicates</figcaption></figure><p id="02c0" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">还要估计一下需要的时间。滚动 1 次后，您将等待 1 秒钟加载结果。所以~2 分钟/搜。26 次搜索 x 2 分钟 x 6 次运行(4 个机器人同时运行)，因此我可以在最乐观的情况下预计整个网页抓取方案将在 3 小时内完成。</p><h1 id="c7ab" class="ml mm iq bd mn mo mp mq mr ms mt mu mv jw mw jx mx jz my ka mz kc na kd nb nc bi translated">让表演开始吧</h1><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="ov ow l"/></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk"><a class="ae ls" href="https://gist.github.com/FelixChop/952d5988ba70102db9e3e140b3893d39" rel="noopener ugc nofollow" target="_blank">1 Python script to search some artists, scroll down and save the list in a txt file</a></figcaption></figure><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="ov ow l"/></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk"><a class="ae ls" href="https://gist.github.com/FelixChop/fffaffeff37153a6858e5ba7920ac973" rel="noopener ugc nofollow" target="_blank">Launcher of multiple bots</a></figcaption></figure><figure class="lc ld le lf gt lg"><div class="bz fp l di"><div class="ov ow l"/></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk"><a class="ae ls" href="https://gist.github.com/FelixChop/b3993a33d99634d2a3880c2b97e66356" rel="noopener ugc nofollow" target="_blank">Jupyter Notebook to monitor everything</a></figcaption></figure><p id="9416" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我不得不承认我没有完成练习。我的电脑声音比机场还大，我知道我有足够的时间完成它，但无论如何，你得到的想法。</p><p id="b16c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在 2 个小时内，我得到了 38174 个独特的艺术家，其中有 AC/DC，克里斯蒂娜·阿奎莱拉，暴力反抗机器，但没有蕾哈娜或阿姆。</p></div></div>    
</body>
</html>