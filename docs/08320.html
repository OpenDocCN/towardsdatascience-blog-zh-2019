<html>
<head>
<title>Preprocessing: Calculate the Distance Between Longitude and Latitude Points with a Function</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">预处理:用函数计算经纬度点之间的距离</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/preprocessing-calculate-the-distance-between-longitude-and-latitude-points-with-a-function-8f748a2eab88?source=collection_archive---------34-----------------------#2019-11-12">https://towardsdatascience.com/preprocessing-calculate-the-distance-between-longitude-and-latitude-points-with-a-function-8f748a2eab88?source=collection_archive---------34-----------------------#2019-11-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div class="gh gi ir"><img src="../Images/9180f728f1be2ae7f44248c31379b5e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:948/format:webp/1*T2plqQFNrazTkhIOSjxlig.jpeg"/></div></figure><div class=""/><p id="f969" class="pw-post-body-paragraph jx jy ja jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">作为关注一些独特的预处理技术的系列文章的一部分，本系列的第一篇文章将关注处理纬度/经度信息。这种类型的数据对于绘制可视化地图和其他地理定位目的非常重要。</p><figure class="kw kx ky kz gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi kv"><img src="../Images/1212cfc391241d18a9b800ad3b7aedf4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fFgcnGp--kdT9_Fc59boRw.jpeg"/></div></div></figure><p id="0da8" class="pw-post-body-paragraph jx jy ja jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">纬度是指定地球表面南北点的地理位置。经度提供了东西点。写出来的时候，先写纬度，后写逗号，再写经度。赤道代表纬度的零点，本初子午线代表经度的零点。</p><p id="797b" class="pw-post-body-paragraph jx jy ja jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">有时，当您有几个点的地理位置时，计算距离可能有助于要素工程数据。我将使用 2018 年奥斯汀犯罪数据集，该数据集可在<a class="ae le" href="https://data.austintexas.gov/Public-Safety/Crime-Reports-2018/vmn9-3bvu" rel="noopener ugc nofollow" target="_blank">https://data . Austin Texas . gov/Public-Safety/Crime-Reports-2018/vmn 9-3bvu</a>找到。关于地理位置数据，该数据集包含纬度、经度的独立特征和名为 location 的组合纬度/经度特征。</p><figure class="kw kx ky kz gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi lf"><img src="../Images/b91b7fd5d82c6a50d2662460e10286db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pGos-nIl8qHDkOe9ziY4sA.jpeg"/></div></div></figure><p id="a38e" class="pw-post-body-paragraph jx jy ja jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">这些地理位置确定了犯罪发生的地点。大多数代表地址，有些是小巷，停车场等。所以使用地理定位很重要，可以参考。</p><p id="3e51" class="pw-post-body-paragraph jx jy ja jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">奥斯汀有四个警察局。总指挥部和三个分站(北、东、西)。奥斯汀警察局还提供了一个以这些车站的位置为特征的数据集。在该数据集中，站的名称，以及单独的经度和纬度点(分别标记为 X 和 Y)。</p><figure class="kw kx ky kz gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi lg"><img src="../Images/7e3467705239efbf83194525f56f8e0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vnurv2H25S34SSQxOnAsEw.jpeg"/></div></div></figure><p id="56f9" class="pw-post-body-paragraph jx jy ja jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">该计划旨在描绘出每个犯罪现场到每个警察局的距离。幸运的是，地理位置数据是分离的，因为它节省了分离数据的几个步骤。如果您遇到这种情况，且您有一个类似于上面位置特性的组合地理位置(例如:(30.1876534，-97.475630))，您可以很容易地分离这些数据，首先使用 python strip()方法删除括号，然后使用 split()方法分离值，因为如果列中有任何字符，它们将被视为对象。</p><pre class="kw kx ky kz gt lh li lj lk aw ll bi"><span id="a206" class="lm ln ja li b gy lo lp l lq lr">df[‘Location] = df.Location.strip(‘()’) #will remove the parentheses (can use regex if necessary to remove additional text,etc)</span><span id="af8e" class="lm ln ja li b gy ls lp l lq lr">df[[‘Longitude’,’Latitude’]] = df.str.strip(‘,’, expand = True)</span></pre><p id="6026" class="pw-post-body-paragraph jx jy ja jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">本文将不讨论计算这种转换的公式的细节，但是在运行函数时，下面的函数将以纬度和经度为起点，将距离(以英里为单位)转换为 DataFrame 列。</p><pre class="kw kx ky kz gt lh li lj lk aw ll bi"><span id="5485" class="lm ln ja li b gy lo lp l lq lr">‘’’Distance equation for long,lat data used via stackoverflow from user Michael0x2a. Updated to a function that converts to mileage’’’</span><span id="a6ad" class="lm ln ja li b gy ls lp l lq lr"># constant values, if need to change end lat, long points, change the lat2, lon2 information</span><span id="71f8" class="lm ln ja li b gy ls lp l lq lr">lat2 = np.array(clean.Latitude) #identifies iterable latitude column<br/>lon2 = np.array(clean.Longitude) #identifies iterable longitude column</span><span id="30c5" class="lm ln ja li b gy ls lp l lq lr">latr = np.array(list(map(lambda x: np.radians(x), lat2)))<br/>lonr = np.array(list(map(lambda x: np.radians(x), lon2)))</span><span id="4913" class="lm ln ja li b gy ls lp l lq lr">def distance(lat1,lon1):<br/>    lat1 = np.radians(lat1)<br/>    lon1 = np.radians(lon1)<br/>    dlon = np.array(list(map(lambda x: (x — lon1), lonr)))<br/>    dlat = np.array(list(map(lambda x: (x — lat1), latr)))<br/>    a = np.sin(dlat/2)**2 + np.cos(lat1) * np.cos(lat2) * np.sin(dlon/2)**2<br/>    c = 2 * np.arctan2(np.sqrt(a), np.sqrt(1 — a))<br/>    # 6373.0 represents earth radius in kilometers<br/>    kilo = 6373.0 * c<br/>    miles = kilo * 0.62137119<br/>    return miles</span></pre><p id="13e9" class="pw-post-body-paragraph jx jy ja jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">要运行该函数，请确保将新功能设置为变量:</p><pre class="kw kx ky kz gt lh li lj lk aw ll bi"><span id="5227" class="lm ln ja li b gy lo lp l lq lr">clean[‘Main Distance’] = distance(30.267574,-97.735070)</span></pre><p id="98f4" class="pw-post-body-paragraph jx jy ja jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">如果你需要以公里为单位的距离，只需删除英里转换线，并确保返回千。</p></div></div>    
</body>
</html>