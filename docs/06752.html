<html>
<head>
<title>How to calculate Travel time for any location in the world</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何计算世界上任何地点的旅行时间</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-calculate-travel-time-for-any-location-in-the-world-56ce639511f?source=collection_archive---------10-----------------------#2019-09-26">https://towardsdatascience.com/how-to-calculate-travel-time-for-any-location-in-the-world-56ce639511f?source=collection_archive---------10-----------------------#2019-09-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/51970358d0021e81d6518847ae1ca610.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*x-68Wq-C5MiRZgsH7r3z2Q.gif"/></div></div><figcaption class="jc jd gj gh gi je jf bd b be z dk">Isochrone map from London, Source: Esri UK</figcaption></figure><div class=""/><div class=""><h2 id="59f3" class="pw-subtitle-paragraph kf jh ji bd b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw dk translated">关于如何在 Python 中执行等时线(从一点到另一点的旅行时间)的指南。</h2></div><p id="f32b" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">不同的交通方式(如骑自行车、步行或驾车)需要不同的到达时间。但是你有没有想过，“从现在的位置往任何方向走 10 分钟能到达哪里？”</p><p id="192d" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">这就是等时线(旅行时间图)的本质。等时线(希腊文<em class="lt"> isos </em>的意思是‘相等’，<em class="lt"> chrónos </em>的意思是‘时间’)，指的是旅行时间相等的线。</p><p id="8673" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">例如，送货公司可以使用等时线来确定 30 分钟车程内可到达的送货区域。或者，使用最大通勤时间和交通方式偏好，从你的工作场所找到一个理想的新家。</p><p id="a5eb" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">在本教程中，我将向您展示如何在 Python 中执行等时线(旅行时间图)。我们将为街道网络使用<a class="ae lu" href="https://github.com/gboeing/osmnx" rel="noopener ugc nofollow" target="_blank"> OSMnx </a> Python 库。这篇文章的代码可以作为<a class="ae lu" href="https://mybinder.org" rel="noopener ugc nofollow" target="_blank"> Mybinder </a> Notebook 获得。不需要安装任何东西就可以在网上运行和试验它。</p><p id="7fa3" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">如果想在本地电脑上运行，需要用 pip 安装这三个库:<a class="ae lu" href="https://github.com/networkx/networkx" rel="noopener ugc nofollow" target="_blank"> networkx </a>，Osmnx，和<a class="ae lu" href="https://github.com/geopandas/geopandas" rel="noopener ugc nofollow" target="_blank"> Geopandas </a>。</p><p id="f6aa" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">让我们先从建设街道网络开始。</p><h2 id="40c2" class="lv lw ji bd lx ly lz dn ma mb mc dp md lg me mf mg lk mh mi mj lo mk ml mm mn bi translated">网络图</h2><p id="8727" class="pw-post-body-paragraph kx ky ji kz b la mo kj lc ld mp km lf lg mq li lj lk mr lm ln lo ms lq lr ls im bi translated">首先，我们需要获得我们想要的位置的数据。所以，让我们先下载并可视化一个地方的街道网络数据。在本教程中，我将以瑞典斯德哥尔摩为例。随意挑选任何其他地点。</p><p id="9559" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">首先，让我们导入库。</p><pre class="mt mu mv mw gt mx my mz na aw nb bi"><span id="11bc" class="lv lw ji my b gy nc nd l ne nf"># 1. Import libraries<br/>import geopandas as gpd<br/>from shapely.geometry import Point, LineString, Polygon<br/>import networkx as nx<br/>import osmnx as ox<br/>import matplotlib.pyplot as plt<br/>from descartes import PolygonPatch<br/>from IPython.display import IFrame<br/>ox.config(log_console=True, use_cache=True)</span></pre><p id="0a68" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">现在我们需要为我们想要创建的网络图设置参数。你需要一个地址或坐标(纬度和经度)。如果你提供一个名字或者一个地址，Osmnx 会进行地理编码并返回该地区的网络图。</p><p id="8f17" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">让我们为斯德哥尔摩市创建一个网络图。在下面的代码片段 1 和 2 中，我们首先创建两个变量来保存位置和运输方式。</p><figure class="mt mu mv mw gt iv"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="abc0" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">一旦我们有了这些变量，我们就可以创建一个图表。OSMNx 有不同的创建图形的方式；在这个例子中，我们从一个地址创建了一个网络图。您可以通过调整代码片段 3 中的 distance 参数来增加或减少返回的网络图的面积。</p><p id="8c40" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">最后一个片段(#4)显示了如何绘制图形，该图形可视化了带有边和节点的区域的街道网络。</p><figure class="mt mu mv mw gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ni"><img src="../Images/373dea27cd796f84d67295c78a753cf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2xZSQ_cfw-QxzjhJloDW3g.png"/></div></div><figcaption class="jc jd gj gh gi je jf bd b be z dk">Network graph plotted</figcaption></figure><p id="2478" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">该图包含斯德哥尔摩街道网络的节点和边，并提供了距离(1500)。如果你想要一个有这些图形网络的背景地图，OSMNX 有一个创建叶子地图的功能。</p><figure class="mt mu mv mw gt iv"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="75a9" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">下面是带背景底图的叶图。</p><figure class="mt mu mv mw gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nj"><img src="../Images/f1613788337ec6e4a5ad9dccb6b17d48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OQ_aXCWxbHn2XcD6abpYfw.png"/></div></div></figure><p id="7333" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">让我们试试另一个例子。因为这是一个重复的任务，所以我创建了一个函数，它还可以接受其他参数，如交通方式、距离和位置类型。</p><figure class="mt mu mv mw gt iv"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="9975" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">现在，我们可以从任何地址/坐标得到一个网络。让我们使用坐标(纬度和经度)作为我们的位置来测试这个函数。这次我们提供来自伦敦的坐标。</p><figure class="mt mu mv mw gt iv"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="78d4" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">在从上述代码中的坐标创建了一个图形之后，我们还绘制了这个图形。这是伦敦图形网络的输出图。</p><figure class="mt mu mv mw gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nj"><img src="../Images/57678f2eec328ecfb2014cf0e49a2290.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nFjopsLiqtcwbf9inECO9g.png"/></div></div><figcaption class="jc jd gj gh gi je jf bd b be z dk">London</figcaption></figure><p id="3a46" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">接下来，我们将根据网络图创建行程时间图(等时线)。</p><h2 id="7038" class="lv lw ji bd lx ly lz dn ma mb mc dp md lg me mf mg lk mh mi mj lo mk ml mm mn bi translated">等时线(旅行时间)</h2><p id="b056" class="pw-post-body-paragraph kx ky ji kz b la mo kj lc ld mp km lf lg mq li lj lk mr lm ln lo ms lq lr ls im bi translated">首先，我们用交通方式建立兴趣点和图形网络。让我们为更大的网络斯德哥尔摩创建一个距离为 7k 的步行图。</p><figure class="mt mu mv mw gt iv"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="b157" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">一旦我们创建了遍历图，下一步就是从图中创建节点(代码片段#2)。在代码片段 3 中，我们指定了我们感兴趣的点——时间旅行开始的地方。最后，我们将图从纬度/经度投影到合适的 UTM 投影。</p><p id="054b" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">接下来，我们将确定行程时间和行驶速度。</p><figure class="mt mu mv mw gt iv"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="6af9" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">我们希望旅行分为 5 类，从 5 分钟到 1 小时不等。我们还指定平均步行速度为千米每小时(4.5)，然后转换为米每分钟。</p><p id="b4dc" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">现在我们已经设置了行程和行驶速度，我们可以为五个行程类别创建行驶时间(等时线)。</p><figure class="mt mu mv mw gt iv"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="0d81" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">第一段代码为不同的旅行时间提供了不同的颜色。然后在第二个代码片段中，我们遍历行程时间及其颜色，用适当的颜色填充节点。</p><p id="a388" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">最后，我们用图形网络来绘制色点。这是输出。</p><figure class="mt mu mv mw gt iv gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/4e0d50ed5db41575bc250e72c4bc7470.png" data-original-src="https://miro.medium.com/v2/resize:fit:1164/format:webp/1*fKw6XIESqf5-mheiEeWVkQ.png"/></div></figure><p id="7379" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">这些点根据它们的行驶时间被涂上颜色，例如，在 60 分钟内，你可以到达在外围涂上浅红色的点。然而，这些彩色的图形节点并不在多边形中，但是我们可以像这样很容易地从这些点创建多边形。</p><figure class="mt mu mv mw gt iv"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="a819" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">一旦我们创建了等时多边形，我们就可以使用 plot_graph 函数和笛卡尔库中的 PlygonPatch 来绘制它们。</p><figure class="mt mu mv mw gt iv"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="683a" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">下面绘制的网络图更直观地显示了行驶时间的区域。</p><figure class="mt mu mv mw gt iv gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/8303489d2a77864ab1c9c0c7ca5df182.png" data-original-src="https://miro.medium.com/v2/resize:fit:1132/format:webp/1*zjRO_Tmfcke2GvFJpmefTw.png"/></div><figcaption class="jc jd gj gh gi je jf bd b be z dk">Isochrones</figcaption></figure><p id="a2d5" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">注意:OSMNx 没有用 follow 底图绘制等时线的固有功能。我怀疑这是由于地理投影。请记住，在运行等时线过程之前，我们已经对图表进行了投影。</p><p id="0a1c" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">但是，您可以使用 Geopandas 从 isochrone_polys 创建地理数据框架，并通过提供适当的通用横轴墨卡托(UTM)投影区将其导出。</p><p id="4787" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">我还包含了如何使用正确的 UTM 投影将等时线多边形导出到 shapefile 的代码。</p><h2 id="1a8e" class="lv lw ji bd lx ly lz dn ma mb mc dp md lg me mf mg lk mh mi mj lo mk ml mm mn bi translated">结论</h2><p id="5669" class="pw-post-body-paragraph kx ky ji kz b la mo kj lc ld mp km lf lg mq li lj lk mr lm ln lo ms lq lr ls im bi translated">在本教程中，我们介绍了如何使用 Python 执行旅行时间。尝试不同的位置，并测试您所在区域的旅行时间(等时线)情况。这个 Binder 容器中提供了代码，您可以运行并试验它。</p><div class="is it gp gr iu nm"><a href="https://mybinder.org/v2/gh/shakasom/isochronewithosmnx/master" rel="noopener  ugc nofollow" target="_blank"><div class="nn ab fo"><div class="no ab np cl cj nq"><h2 class="bd jj gy z fp nr fr fs ns fu fw jh bi translated">GitHub:shaka som/isochronewithosmnx/master</h2><div class="nt l"><h3 class="bd b gy z fp nr fr fs ns fu fw dk translated">单击运行此交互式环境。来自活页夹项目:可复制、可共享、交互式计算…</h3></div><div class="nu l"><p class="bd b dl z fp nr fr fs ns fu fw dk translated">mybinder.org</p></div></div><div class="nv l"><div class="nw l nx ny nz nv oa ja nm"/></div></div></a></div></div></div>    
</body>
</html>