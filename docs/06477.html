<html>
<head>
<title>Stop Using Mean to Fill Missing Data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">停止使用均值来填充缺失数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/stop-using-mean-to-fill-missing-data-678c0d396e22?source=collection_archive---------7-----------------------#2019-09-17">https://towardsdatascience.com/stop-using-mean-to-fill-missing-data-678c0d396e22?source=collection_archive---------7-----------------------#2019-09-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="cf99" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">均值插补是我用过的第一种处理缺失数据的“高级”方法。在某种程度上，这是用 0 或常数(例如-999)填充缺失值的一大步(请不要这样做)。</p><p id="73dc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然而，这仍然不是一个最佳的方法，今天的帖子会告诉你为什么。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi kp"><img src="../Images/7610547cdb7eae29ec8ff3c386c843a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OJJlWVdRf7jtzix8"/></div></div><figcaption class="lb lc gj gh gi ld le bd b be z dk">Photo by <a class="ae lf" href="https://unsplash.com/@pietrozj?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Pietro Jeng</a> on <a class="ae lf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="4993" class="lg lh it bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">数据集</h1><p id="ea9a" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn im bi translated">对于本文，我选择使用<a class="ae lf" href="https://github.com/datasciencedojo/datasets/blob/master/titanic.csv" rel="noopener ugc nofollow" target="_blank">泰坦尼克号数据集</a>，主要是因为它广为人知，并且<strong class="js iu"> <em class="ko">年龄</em> </strong>列包含一些缺失的值。首先，让我们导入所有需要的东西，并做一些基本的数据清理。以下是进口货:</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="mj mk l"/></div><figcaption class="lb lc gj gh gi ld le bd b be z dk">Imports — <a class="ae lf" href="https://gist.github.com/dradecic/bd084cb0c27bd76ed848dccabc9ed9b4" rel="noopener ugc nofollow" target="_blank">https://gist.github.com/dradecic/bd084cb0c27bd76ed848dccabc9ed9b4</a></figcaption></figure><p id="ad1b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当您检查数据集的头部时，您将得到以下内容:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi ml"><img src="../Images/8a4f5f170899764a0bdb88437d19d0ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gr47EYk4LwZwF6CTCRzq1g.png"/></div></div><figcaption class="lb lc gj gh gi ld le bd b be z dk">Titanic Head</figcaption></figure><p id="e60e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">关于数据清理，应该完成以下工作:</p><ol class=""><li id="d698" class="mm mn it js b jt ju jx jy kb mo kf mp kj mq kn mr ms mt mu bi translated"><strong class="js iu"> <em class="ko"> PassengerId </em> </strong>和<strong class="js iu"> <em class="ko"> Ticket </em> </strong>应该被丢弃——第一个只是一个任意的整数值，第二个对于每个乘客都是不同的。</li><li id="3e9d" class="mm mn it js b jt mv jx mw kb mx kf my kj mz kn mr ms mt mu bi translated"><strong class="js iu"> <em class="ko">性别</em> </strong>列的值应重新映射为 0 和 1，而不是“男性”和“女性”</li><li id="7299" class="mm mn it js b jt mv jx mw kb mx kf my kj mz kn mr ms mt mu bi translated">从<strong class="js iu"> <em class="ko">姓名</em> </strong>中提取人物头衔，如先生、夫人、小姐…，如果头衔常见(先生、小姐…)，则进一步转换为 0 和 1-0。)，如果不是，则为 1(博士、牧师、上尉)。最后，<strong class="js iu"> <em class="ko">名称</em> </strong>应该去掉</li><li id="cc76" class="mm mn it js b jt mv jx mw kb mx kf my kj mz kn mr ms mt mu bi translated"><strong class="js iu"> <em class="ko">舱</em> </strong>应替换为<strong class="js iu"> <em class="ko">舱 _ 已知</em> </strong> —如果值为<em class="ko"> NaN </em>，否则为 1</li><li id="ddd5" class="mm mn it js b jt mv jx mw kb mx kf my kj mz kn mr ms mt mu bi translated">虚拟列应该从<strong class="js iu"> <em class="ko">开始创建</em> </strong> <em class="ko"> </em>并且第一个虚拟列应该被删除以避免共线性问题</li></ol><p id="2ba6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">下面是实现这一点的一小段代码:</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="mj mk l"/></div><figcaption class="lb lc gj gh gi ld le bd b be z dk">Data Cleaning — <a class="ae lf" href="https://gist.github.com/dradecic/74a77c38c4986b490d111331ee74c3ca" rel="noopener ugc nofollow" target="_blank">https://gist.github.com/dradecic/74a77c38c4986b490d111331ee74c3ca</a></figcaption></figure></div><div class="ab cl na nb hx nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="im in io ip iq"><h1 id="999f" class="lg lh it bd li lj nh ll lm ln ni lp lq lr nj lt lu lv nk lx ly lz nl mb mc md bi translated">平均插补</h1><p id="7e7e" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn im bi translated">数据集现在是干净的，但是在<strong class="js iu"> <em class="ko">年龄</em> </strong>列中仍然包含丢失的值:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi nm"><img src="../Images/79de4809c4f05c24107587c690e9d1fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:356/format:webp/1*4rTNq90rTIDmwXot9kKK7w.png"/></div></div><figcaption class="lb lc gj gh gi ld le bd b be z dk">Missing values</figcaption></figure><p id="c0b8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">因为我不想弄乱原始数据集，所以我会做一个副本并做上标记，所以很明显这里会做均值插补。然后，我将创建一个新属性—<strong class="js iu"><em class="ko">Age _ Mean _ Filled</em></strong>—顾名思义，它将包含<strong class="js iu"> <em class="ko"> Age </em> </strong>属性的平均估算值:</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="mj mk l"/></div><figcaption class="lb lc gj gh gi ld le bd b be z dk">Mean Imputation — <a class="ae lf" href="https://gist.github.com/dradecic/f7cde4d83cd2fc800a63e59b718039b2" rel="noopener ugc nofollow" target="_blank">https://gist.github.com/dradecic/f7cde4d83cd2fc800a63e59b718039b2</a></figcaption></figure><p id="0c2e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">从统计学角度来说，均值插补对数据集的影响如下:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi nn"><img src="../Images/d49e48593f89d6c18e3851d685839fe1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hcNOYH0toIK9Si8UZBjg8w.jpeg"/></div></div><figcaption class="lb lc gj gh gi ld le bd b be z dk">Mean Imputation Changes</figcaption></figure><p id="4274" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">是的，意思是一样的，很明显，但是看一下<em class="ko">第 25 位</em>、<em class="ko">第 50 位</em>、<em class="ko">第 75 位</em>百分位。另外，查看<strong class="js iu">标准差</strong>的变化。结论是显而易见的——均值插补对属性可变性有影响。</p><p id="cb33" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们看看这些分布是什么样子的:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi no"><img src="../Images/2d809570ec089649de1575e2f89936b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-sWevk05w2kI41ZmIeSUwA.png"/></div></div><figcaption class="lb lc gj gh gi ld le bd b be z dk">Mean Imputation Distribution Check</figcaption></figure><p id="88a4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">左侧和右侧都很接近，但是显著的差异在中间——如你所见。</p><p id="b27e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在的问题是——如何解决这个问题？</p></div><div class="ab cl na nb hx nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="im in io ip iq"><h1 id="ac25" class="lg lh it bd li lj nh ll lm ln ni lp lq lr nj lt lu lv nk lx ly lz nl mb mc md bi translated">介绍老鼠</h1><p id="6bae" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn im bi translated">MICE，或<em class="ko">链式方程多元插补</em>(多么难忘的术语)，是一种插补方法，通过多次填充缺失数据来工作。链式方程方法还有一个好处，就是能够有效地处理不同的数据类型，比如连续数据和二进制数据。</p><p id="ca8f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">引用 statsmodels.org 的<a class="ae lf" href="https://www.statsmodels.org/" rel="noopener ugc nofollow" target="_blank">，</a></p><blockquote class="np nq nr"><p id="07fd" class="jq jr ko js b jt ju jv jw jx jy jz ka ns kc kd ke nt kg kh ki nu kk kl km kn im bi translated">基本思想是将每个有缺失值的变量视为回归中的因变量，剩余变量中的一些或全部作为其预测变量。MICE 程序通过这些模型循环，依次拟合每个模型，然后使用一种称为“预测平均匹配”(PMM)的程序，从拟合模型确定的预测分布中产生随机抽取。这些随机抽取成为一个估算数据集的估算值。[1]</p></blockquote><p id="9459" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">根据国家生物技术信息中心的说法，以下是使用老鼠的一些主要优势:</p><blockquote class="np nq nr"><p id="a142" class="jq jr ko js b jt ju jv jw jx jy jz ka ns kc kd ke nt kg kh ki nu kk kl km kn im bi translated">多重插补比其他缺失数据方法有许多优势。多重插补涉及多次填充缺失值，创建多个“完整”数据集。如<a class="ae lf" href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3074241/#R30" rel="noopener ugc nofollow" target="_blank">斯查费和格拉汉姆(2002) </a>所述，缺失值是基于给定个体的观察值和其他参与者数据中观察到的关系进行估算的，假设观察变量包含在插补模型中。[2]</p></blockquote><p id="5b7d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">好了，说够了，让我们做一些编码！要开始，您需要通过<em class="ko"> pip </em>安装<strong class="js iu"> <em class="ko"> impyute </em> </strong>库:</p><pre class="kq kr ks kt gt nv nw nx ny aw nz bi"><span id="2017" class="oa lh it nw b gy ob oc l od oe">pip install impyute</span></pre><p id="8318" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你习惯于均值估算，你可能会认为其他任何事情都要复杂得多，至少在实现方面是如此。在这种情况下，你就大错特错了。</p><p id="f5ad" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">由于<strong class="js iu"> <em class="ko"> impyute </em> </strong>库的简单性，MICE 的实现不能再简单了。你需要在数组中传递纯值，所以默认情况下<strong class="js iu"> Pandas DataFrame </strong>不会剪切它。很幸运，你可以直接叫<strong class="js iu"> <em class="ko">。值</em>和</strong>就设置好了:</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="mj mk l"/></div><figcaption class="lb lc gj gh gi ld le bd b be z dk">MICE Imputation — <a class="ae lf" href="https://gist.github.com/dradecic/6b567e42dd9890f9e6dae125a70a433f" rel="noopener ugc nofollow" target="_blank">https://gist.github.com/dradecic/6b567e42dd9890f9e6dae125a70a433f</a></figcaption></figure><p id="9d2d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这很快。</p><p id="7225" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">快速调用<strong class="js iu">到<em class="ko">。描述()</em> </strong>对<strong class="js iu"> <em class="ko">小鼠 _ 年龄</em> </strong>会产生以下结果:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi of"><img src="../Images/0ee5d3d6b9a26868b1d465233c4961a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:300/format:webp/1*GbUHYJCCuU6utS3xtmCb_w.png"/></div><figcaption class="lb lc gj gh gi ld le bd b be z dk">MICE default</figcaption></figure><p id="4f38" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">请注意最小值。现在是零下 7 度。因为这个属性代表年龄，所以有负值是没有意义的。这可以通过一些基本的<strong class="js iu">列表理解</strong>很容易地解决:</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="mj mk l"/></div><figcaption class="lb lc gj gh gi ld le bd b be z dk">Negatives — <a class="ae lf" href="https://gist.github.com/dradecic/8e8a4c5df08369abb6b3246f25cd5cfc" rel="noopener ugc nofollow" target="_blank">https://gist.github.com/dradecic/8e8a4c5df08369abb6b3246f25cd5cfc</a></figcaption></figure><p id="0bb6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你现在检查原始的<strong class="js iu"> <em class="ko">年龄</em> </strong>的统计数据，和老鼠估算的一，你会看到数值更接近:</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi og"><img src="../Images/4e47303abeb07c699fa524edbddc6acf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1392/format:webp/1*6I3SrcwLd5z5CWqO6eUE9Q.jpeg"/></div><figcaption class="lb lc gj gh gi ld le bd b be z dk">MICE Imputation Changes</figcaption></figure><p id="ae88" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">快速分布图证实了这些说法。小鼠估算值的分布更接近原始分布。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi oh"><img src="../Images/92bfc4890371bd8e5232b9e772755055.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bZRrVROBIwE_8m8wm43srQ.png"/></div></div><figcaption class="lb lc gj gh gi ld le bd b be z dk">MICE Imputation Distribution Check</figcaption></figure></div><div class="ab cl na nb hx nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="im in io ip iq"><h1 id="99f4" class="lg lh it bd li lj nh ll lm ln ni lp lq lr nj lt lu lv nk lx ly lz nl mb mc md bi translated">最后的话</h1><p id="9954" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn im bi translated">你现在知道你的库存里有什么新技能了。我的建议是，你可以试着在你已经处理过的数据集上使用它，但是用均值插补或者其他方法代替。</p><p id="15f8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你在那里开发了一个预测模型，看看准确性如何比较。如果能因此挤出点额外的精准度就太好了。</p><p id="a13f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">感谢阅读。</p><p id="e725" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">直到下一次…</p></div><div class="ab cl na nb hx nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="im in io ip iq"><p id="26a0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="ko">喜欢这篇文章吗？成为</em> <a class="ae lf" href="https://medium.com/@radecicdario/membership" rel="noopener"> <em class="ko">中等会员</em> </a> <em class="ko">继续无限制学习。如果你使用下面的链接，我会收到你的一部分会员费，不需要你额外付费。</em></p><div class="oi oj gp gr ok ol"><a href="https://medium.com/@radecicdario/membership" rel="noopener follow" target="_blank"><div class="om ab fo"><div class="on ab oo cl cj op"><h2 class="bd iu gy z fp oq fr fs or fu fw is bi translated">通过我的推荐链接加入 Medium-Dario rade ci</h2><div class="os l"><h3 class="bd b gy z fp oq fr fs or fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="ot l"><p class="bd b dl z fp oq fr fs or fu fw dk translated">medium.com</p></div></div><div class="ou l"><div class="ov l ow ox oy ou oz kz ol"/></div></div></a></div></div><div class="ab cl na nb hx nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="im in io ip iq"><h1 id="ecb1" class="lg lh it bd li lj nh ll lm ln ni lp lq lr nj lt lu lv nk lx ly lz nl mb mc md bi translated">参考</h1><p id="9fda" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn im bi translated">[1]—<a class="ae lf" href="https://www.statsmodels.org/stable/imputation.html" rel="noopener ugc nofollow" target="_blank">https://www.statsmodels.org/stable/imputation.html</a></p><p id="4bfb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">[2]—<a class="ae lf" href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3074241/" rel="noopener ugc nofollow" target="_blank">https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3074241/</a></p></div></div>    
</body>
</html>