<html>
<head>
<title>Data Visualization with Python Folium Maps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Python follow Maps 实现数据可视化</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/data-visualization-with-python-folium-maps-a74231de9ef7?source=collection_archive---------8-----------------------#2019-02-17">https://towardsdatascience.com/data-visualization-with-python-folium-maps-a74231de9ef7?source=collection_archive---------8-----------------------#2019-02-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div class="gh gi io"><img src="../Images/20e8528aa742a8182396bd04cde59f02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aE-WppsMKA386UzT-UF-nA.jpeg"/></div></figure><div class=""/><p id="2c64" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi ks translated">关于数据科学，我最喜欢的事情之一是数据可视化。我喜欢创建和利用视觉辅助工具来支持我的数据中的故事和趋势。python follow library 是我利用地理空间可视化分析能力的有用资源。换句话说，地图！</p><p id="8386" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">地图允许我在一个可视化视图中跨多个维度分析我的数据。在最近的一个项目中，我分析了 293 个美国城市，以确定哪些城市适合试点自行车和踏板车共享计划。通过使用 OLS 回归，我确定，在其他特征中，一个城市的拥堵程度(通过在交通中花费的驾驶时间百分比来衡量，从 INRIX.com 获得)与一个城市的“骑行能力”(通过 walkscore.com 的自行车评分来衡量)正相关且显著。虽然这一结果似乎有悖常理，但有理由认为，在更拥堵的城市，人们有骑自行车出行的动机(想想:“我不想坐在车流中，所以我要戴上头盔，骑着自行车去上班”)。</p><p id="8f60" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">那么，我如何将“骑行能力”和拥堵之间的关系形象化呢？一个简单的 seaborn regplot 显示了自行车分数和交通流量之间的正线性相关性(通过交通中所花费的驾驶时间的百分比来衡量)。</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="5f5d" class="lk ll ix lg b gy lm ln l lo lp">sns.set(style = 'white')<br/>sns.regplot(data=df, x="traffic_index", y="bike_score", ci = None)<br/>plt.xlabel('Percentage of driving time spent in traffic', size = 16)<br/>plt.ylabel('Bike score', size = 16)<br/>plt.title("City bike score and overall traffic level", size = 20, weight = 'bold')</span></pre><figure class="lb lc ld le gt is gh gi paragraph-image"><div class="gh gi lq"><img src="../Images/ed983ea614666ee17b7fb434a442cac2.png" data-original-src="https://miro.medium.com/v2/resize:fit:864/format:webp/1*FJohrsNStYMAUJahMPx3-g.jpeg"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk">More bike-friendly cities are also more congested</figcaption></figure><p id="a182" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">但是如果我想在这两个维度上可视化城市的地理空间分布呢？嗯……使用地理空间分析，我可以创建一个地图，显示交通流量和自行车得分较高的城市。更好的是，改变地图标记的颜色和大小等属性意味着我可以使用一个图形来可视化所有三个维度。</p><p id="6dcb" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">为了创建这个地图，我首先安装了 Python 的 follow 库。</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="0a33" class="lk ll ix lg b gy lm ln l lo lp">!conda install -c conda-forge folium=0.5.0 --yes <br/>import folium <br/>import webbrowser</span></pre><p id="d502" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我想展示的第一个维度是地理定位。我根据简单的谷歌搜索“美国经纬度”的结果设置了地图的经纬度。然后，我定义我的地图(巧妙地命名为 traffic_map)在这些坐标上初始化。默认缩放设置为 5(我不得不摆弄这个参数，直到我找到一个好的显示)。</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="593b" class="lk ll ix lg b gy lm ln l lo lp">latitude = 37.0902<br/>longitude = -95.7129</span><span id="f6bf" class="lk ll ix lg b gy lv ln l lo lp">traffic_map = folium.Map(location=[latitude, longitude], zoom_start=5)</span></pre><p id="0712" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">第二个维度是交通拥堵。我将我的流量变量(“流量指数”)分成四分位数:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="08d9" class="lk ll ix lg b gy lm ln l lo lp">df['traffic_index_quartile'] = pd.qcut(df['traffic_index'], 4, labels=False)</span></pre><p id="7da8" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">接下来，我为我的马克笔的颜色创建了一个字典。我决定了从浅蓝色(0)到红色(3)的一系列原色。我希望最高的四分之一(即最拥挤的城市)用醒目的红色突出，最低的四分之一(即最不拥挤和最不可行的候选城市)或多或少地消失在基本地图中。</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="8633" class="lk ll ix lg b gy lm ln l lo lp">colordict = {0: 'lightblue', 1: 'lightgreen', 2: 'orange', 3: 'red'}</span></pre><p id="badb" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw iy">边注:</strong>我从这个栈溢出帖子中找到了可行的颜色名称:<br/><a class="ae lw" href="https://stackoverflow.com/questions/36202514/foilum-map-module-trying-to-get-more-options-for-marker-colors" rel="noopener ugc nofollow" target="_blank">https://Stack Overflow . com/questions/36202514/foil um-map-module-trying-to-get-more-options-for-marker-colors</a>。我已经尝试了列出的大多数颜色，它们都准确地显示了它们的名字，除了“浅红色”，它要么导致错误，要么显示为黑色。</p><p id="3975" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我的地图上的第三个也是最后一个维度是城市“骑行能力”。为了可视化这个维度，我将城市标记的大小设置为城市 bikescore 的 0.15 倍(这是我必须反复试验直到它“看起来”正确为止的另一个参数)。</p><p id="c824" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">最终地图的完整代码如下:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="2eb6" class="lk ll ix lg b gy lm ln l lo lp">for lat, lon, traffic_q, traffic, bike, city in zip(df['latitude'], df['longitude'], df['traffic_index_quartile'], df['traffic_index'], df['bike_score'], df['city']):<br/>    folium.CircleMarker(<br/>        [lat, lon],<br/>        radius=.15*bike,<br/>        popup = ('City: ' + str(city).capitalize() + '&lt;br&gt;'<br/>                 'Bike score: ' + str(bike) + '&lt;br&gt;'<br/>                 'Traffic level: ' + str(traffic) +'%'<br/>                ),<br/>        color='b',<br/>        key_on = traffic_q,<br/>        threshold_scale=[0,1,2,3],<br/>        fill_color=colordict[traffic_q],<br/>        fill=True,<br/>        fill_opacity=0.7<br/>        ).add_to(traffic_map)</span><span id="da45" class="lk ll ix lg b gy lv ln l lo lp">traffic_map</span></pre><figure class="lb lc ld le gt is gh gi paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="gh gi lx"><img src="../Images/451991ac5a5376fecb99e38bd9c1df00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EJaBi5KsJAWBJa02Un3ejg.png"/></div></div></figure><p id="1b99" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">通过这种地理空间数据可视化，我们可以快速看到关于城市和自行车的两个事实。首先，“骑行能力”与交通拥堵正相关。其次，高交通流量和“骑行能力”(即大红色标记)的城市更有可能出现在美国东北部、加利福尼亚州和太平洋西北地区(有几个明显的例外)。</p><p id="d2ff" class="pw-post-body-paragraph ju jv ix jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><em class="mc">在这里</em>  <em class="mc">查看我关于完整项目</em> <a class="ae lw" rel="noopener" target="_blank" href="/predicting-bikeability-in-u-s-cities-67da4ff8376"> <em class="mc">的帖子。欢迎在评论中留下反馈或想法！</em></a></p></div></div>    
</body>
</html>