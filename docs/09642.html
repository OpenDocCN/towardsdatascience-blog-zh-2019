<html>
<head>
<title>Securing API Keys with Environment Variables Using Anaconda</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Anaconda 保护带有环境变量的 API 密钥</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/securing-api-keys-with-environment-variables-using-anaconda-d30a7c48b1fd?source=collection_archive---------10-----------------------#2019-12-18">https://towardsdatascience.com/securing-api-keys-with-environment-variables-using-anaconda-d30a7c48b1fd?source=collection_archive---------10-----------------------#2019-12-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="1919" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何在公共论坛分享项目时保证私人信息的安全？</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/ed308cc421a02d54d62b5961bce55ca2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OA5zTmLJ0ptlPzfmz33Rug.png"/></div></div></figure><p id="c3b4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果您正在阅读本文，我假设您已经熟悉 API、令牌、私钥和公钥。您的私钥和公钥作为一种身份验证的形式，通过开发人员的 API 来识别您的身份并跟踪您的活动。这意味着，如果有人得到了你的密钥，他们就可以冒充你访问 API 中的数据，这可能会产生一些可怕的后果。</p><p id="df16" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">大多数崭露头角的数据科学家面临的挑战是，他们希望在公共论坛上推广他们的项目工作。如果这些项目中的任何一个使用 API，个人将不得不把他们的密钥加载到他们的笔记本中。换句话说，公开笔记本意味着危及 API 密钥的安全。</p><p id="259d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这个问题有几种常见的解决方案:第一种是用类似于<code class="fe lr ls lt lu b">******</code>或<code class="fe lr ls lt lu b">YOUR_PRIVATE_KEY_HERE</code>的东西来替换这个键。这在一定程度上是可行的，但是这种方法容易出现人为错误。对于单个项目的多次提交，每次都必须删除并重新添加令牌。当您按下 commit 并忘记清除密钥时，它就被破坏了。这不是会不会发生的问题，而是什么时候发生的问题。另一种选择是将 API 密钥保存到一个单独的 JSON 文件中，读取私钥，并在推送到 GitHub 时排除该文件。虽然这稍微好一点，但这里的问题是，其他想要探索您的工作的人必须对分叉的存储库进行编辑才能运行代码。此外，这并不能完全消除人为错误的可能性。</p><p id="8917" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果有一种方法可以将密钥和令牌保存到我们的系统文件中，以便在需要时调用，这不是很好吗？如果其他人可以使用相同的代码从他们自己的系统中调用他们自己的密钥和令牌，那不是更好吗？事实证明，有一个办法:环境变量！</p><h1 id="2de9" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">什么是环境变量？</h1><p id="c7e9" class="pw-post-body-paragraph ku kv it kw b kx mn ju kz la mo jx lc ld mp lf lg lh mq lj lk ll mr ln lo lp im bi translated">环境变量顾名思义:保存在本地环境中的变量，可以在任何项目中调用。因为它们不是存储库本身的一部分，所以没有必要限制推送到 GitHub 的信息。在下面的例子中，一个私有 API 密匙已经被保存为一个名为<code class="fe lr ls lt lu b">PRIVATE_API_KEY</code>的环境变量。稍后我们将看看如何创建变量本身。</p><pre class="kj kk kl km gt ms lu mt mu aw mv bi"><span id="1299" class="mw lw it lu b gy mx my l mz na">import os</span><span id="81e2" class="mw lw it lu b gy nb my l mz na">api_key = os.environ.get("PRIVATE_API_KEY")</span></pre><p id="5cb8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">正如我们所见，这看起来非常干净简单。每当我们需要使用密钥时，我们所要做的就是调用<code class="fe lr ls lt lu b">api_key</code>变量。更有经验的数据科学家在审查这段代码时应该会立即意识到需要使用他们自己的私钥，并将它们保存在他们自己的环境中。一旦完成，程序应该可以正常运行，不会出现任何问题。</p><p id="e77a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这里需要注意的是，审查者需要使用相同的变量名保存 API 键。如果这个人已经使用不同的变量名将相关的键保存到了他们的环境中，他们可能会选择修改代码而不是他们的环境。如果 API 开发人员在他们的文档中为这些键提供推荐的命名约定，将会使这个过程更加优雅。但那是另一天的话题。</p><h1 id="a77a" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">创建环境变量</h1><p id="826c" class="pw-post-body-paragraph ku kv it kw b kx mn ju kz la mo jx lc ld mp lf lg lh mq lj lk ll mr ln lo lp im bi translated">在这篇文章中，我们不打算讨论跨项目管理环境的最佳实践。相反，我假设您已经在合适的环境中工作，并且知道如何使用 Anaconda 在它们之间切换。如果你不熟悉这个，我推荐你看看这个视频，作为这篇文章的基础。</p><p id="2641" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">创建这些变量的总体过程如下:</p><ol class=""><li id="344d" class="nc nd it kw b kx ky la lb ld ne lh nf ll ng lp nh ni nj nk bi translated">导航到存储包和详细信息的环境路径。</li><li id="22a2" class="nc nd it kw b kx nl la nm ld nn lh no ll np lp nh ni nj nk bi translated">创建文件和目录，用于在调用时激活变量，并在使用完变量后停用变量。</li><li id="c636" class="nc nd it kw b kx nl la nm ld nn lh no ll np lp nh ni nj nk bi translated">将变量添加到相关文件中。</li></ol><p id="b2c1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我将向您展示如何在 macOS、Linux 和 Windows 中处理所有这三个步骤。所有的指令都直接改编自 Anaconda 文档<a class="ae lq" href="https://docs.conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html#windows" rel="noopener ugc nofollow" target="_blank">。</a></p><h2 id="bdd0" class="mw lw it bd lx nq nr dn mb ns nt dp mf ld nu nv mh lh nw nx mj ll ny nz ml oa bi translated">macOS 和 Linux</h2><p id="55a5" class="pw-post-body-paragraph ku kv it kw b kx mn ju kz la mo jx lc ld mp lf lg lh mq lj lk ll mr ln lo lp im bi translated">以下命令可用于使用终端处理步骤 1 和 2:</p><pre class="kj kk kl km gt ms lu mt mu aw mv bi"><span id="3533" class="mw lw it lu b gy mx my l mz na">cd $CONDA_PREFIX<br/>mkdir -p ./etc/conda/activate.d<br/>mkdir -p ./etc/conda/deactivate.d<br/>touch ./etc/conda/activate.d/env_vars.sh<br/>touch ./etc/conda/deactivate.d/env_vars.sh</span></pre><p id="b98e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">因此，我们现在有两个名为<code class="fe lr ls lt lu b">env_vars.sh</code>的文件，它们分别存储在不同的目录中。我们需要在您选择的文本编辑器中打开这些文件来创建变量。对于<code class="fe lr ls lt lu b">activate.d</code>目录中的文件，我们将添加以下内容:</p><pre class="kj kk kl km gt ms lu mt mu aw mv bi"><span id="3a2f" class="mw lw it lu b gy mx my l mz na"><em class="ob">#!/bin/sh</em><br/><br/>export PRIVATE_API_KEY='YOUR_PRIVATE_KEY_HERE'</span></pre><p id="99a2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">对于 deactivate.d 目录中的文件，我们添加以下内容:</p><pre class="kj kk kl km gt ms lu mt mu aw mv bi"><span id="10c3" class="mw lw it lu b gy mx my l mz na"><em class="ob">#!/bin/sh</em><br/><br/>unset MY_KEY</span></pre><p id="e65d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">第一行<code class="fe lr ls lt lu b">#!/bin/sh</code>让操作系统知道这些文件是 shell 脚本，以确保<code class="fe lr ls lt lu b">export</code>和<code class="fe lr ls lt lu b">unset</code>命令被正确执行。</p><p id="2adf" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">一旦这些文件被保存并关闭，在终端输入<code class="fe lr ls lt lu b">conda activate analytics</code>将<code class="fe lr ls lt lu b">YOUR_PRIATE_KEY_HERE</code>保存到环境变量<code class="fe lr ls lt lu b">PRIVATE_API_KEY</code>。使用完这些变量后，可以使用<code class="fe lr ls lt lu b">conda deactivate</code>将它们从环境中删除。</p><h2 id="9668" class="mw lw it bd lx nq nr dn mb ns nt dp mf ld nu nv mh lh nw nx mj ll ny nz ml oa bi translated">Windows 操作系统</h2><p id="485c" class="pw-post-body-paragraph ku kv it kw b kx mn ju kz la mo jx lc ld mp lf lg lh mq lj lk ll mr ln lo lp im bi translated">使用命令 shell，可以使用以下命令来处理步骤 1 和 2:</p><pre class="kj kk kl km gt ms lu mt mu aw mv bi"><span id="fa1a" class="mw lw it lu b gy mx my l mz na">cd %CONDA_PREFIX%<br/>mkdir .\etc\conda\activate.d<br/>mkdir .\etc\conda\deactivate.d<br/>type NUL &gt; .\etc\conda\activate.d\env_vars.bat<br/>type NUL &gt; .\etc\conda\deactivate.d\env_vars.bat</span></pre><p id="c38f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">因此，我们现在有两个名为<code class="fe lr ls lt lu b">env_vars.bat</code>的文件，它们分别存储在不同的目录中。我们需要在您选择的文本编辑器中打开这些文件来创建变量。对于<code class="fe lr ls lt lu b">activate.d</code>目录中的文件，我们将添加以下内容:</p><pre class="kj kk kl km gt ms lu mt mu aw mv bi"><span id="54f8" class="mw lw it lu b gy mx my l mz na">set PRIVATE_API_KEY='YOUR_PRIVATE_KEY_HERE'</span></pre><p id="dec4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">对于 deactivate.d 目录中的文件，我们添加以下内容:</p><pre class="kj kk kl km gt ms lu mt mu aw mv bi"><span id="3164" class="mw lw it lu b gy mx my l mz na">unset PRIVATE_API_KEY=</span></pre><p id="2e27" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">一旦保存并关闭这些文件，在终端中输入<code class="fe lr ls lt lu b">conda activate analytics</code>将<code class="fe lr ls lt lu b">YOUR_PRIATE_KEY_HERE</code>保存到环境变量<code class="fe lr ls lt lu b">PRIVATE_API_KEY</code>。使用完这些变量后，可以使用<code class="fe lr ls lt lu b">conda deactivate</code>将它们从环境中删除。</p><h1 id="9252" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">结论</h1><p id="7a88" class="pw-post-body-paragraph ku kv it kw b kx mn ju kz la mo jx lc ld mp lf lg lh mq lj lk ll mr ln lo lp im bi translated">正如您所看到的，虽然将 API 键保存为环境变量需要几个步骤，但这本身并不困难或复杂。一旦就位，这些变量就可以快速而容易地访问，并且当您使用完它们时，只需一个命令就可以停用它们。这比每次你想对 GitHub 进行更新或提交新的提交时添加和删除键要有效得多。在向外界展示您的项目时，它会为您提供更多安全保障。</p></div></div>    
</body>
</html>