# 用 Numpy 加速 Python 代码的一个简单技巧

> 原文：<https://towardsdatascience.com/one-simple-trick-for-speeding-up-your-python-code-with-numpy-1afc846db418?source=collection_archive---------5----------------------->

![](img/d2a33a541b6dc90899aab16ec3ad7f1e.png)

> 想获得灵感？快来加入我的 [**超级行情快讯**](https://www.superquotes.co/?utm_source=mediumtech&utm_medium=web&utm_campaign=sharing) 。😎

Python 是巨大的。

在过去的几年中，Python 的受欢迎程度迅速增长。其中很大一部分是数据科学、机器学习和人工智能的兴起，所有这些都有高级 Python 库可以使用！

当使用 Python 处理这些类型的工作时，通常需要处理非常大的数据集。这些大型数据集被直接读入内存，并作为 Python 数组、列表或字典进行存储和处理。

处理如此庞大的数组可能非常耗时；真的，这就是问题的本质。你有数千、数百万甚至数十亿个数据点。在处理这些点中的一个点时，每增加一微秒都会大大降低您处理大规模数据的速度。

# 缓慢的方式

处理大型数据集的缓慢方法是使用原始 Python。我们可以用一个非常简单的例子来证明这一点。

下面的代码将 1.0000001 的值乘以自身，500 万次！

我家里有一个相当不错的 CPU，英特尔 i7-8700k 加上 32GB 的 3000MHz 内存。然而，将这 500 万个数据点相乘需要 0.21367 秒。如果我将`num_multiplies`的值改为 10 亿次，这个过程需要 43.24129 秒！

让我们试试另一个数组。

我们将构建一个大小为 1000x1000 的 Numpy 数组，每个数组的值为 1，并再次尝试将每个元素乘以一个浮点数 1.0000001。代码如下所示。

在同一台机器上，在常规浮点循环中将这些数组值乘以 1.0000001 需要 1.28507 秒。

# 什么是矢量化？

Numpy 被设计成对矩阵运算有效。更具体地说，Numpy 中的大多数处理都是*矢量化*。

矢量化包括表示数学运算，例如我们在这里使用的乘法，它发生在整个数组上，而不是它们的单个元素上(如我们的 for 循环)。

借助向量化，底层代码被并行化，因此操作可以一次在多个数组元素上运行，而不是一次遍历一个元素。只要你正在应用的操作不依赖于任何其他的数组元素，也就是一个“状态”，那么矢量化将会给你带来很好的速度提升。

在 Python 数组、列表或字典上循环可能会很慢。因此，Numpy 中的矢量化操作被映射到高度优化的 C 代码，这使得它们比标准 Python 代码快得多。

# 最快的方法

下面是做事情的快速方法——按照设计*使用*的方式使用 Numpy。

在寻求加快速度时，我们可以遵循以下几点:

*   如果数组上有一个 for 循环，我们很有可能用一些内置的 Numpy 函数来替换它
*   如果我们看到任何类型的数学，我们很有可能用一些内置的 Numpy 函数来代替它

这两点实际上都集中在用优化的、矢量化的低级 C 代码替换非矢量化的 Python 代码。

看看我们之前的第一个例子的快速版本，这次有 10 亿次乘法。

我们做了一些非常简单的事情:我们看到我们有一个 for 循环，在这个循环中我们多次重复相同的数学运算。这应该立即触发我们应该去寻找一个 Numpy 函数来代替它。

我们找到了一个——`power`函数，它简单地将某个幂应用于输入值。这段代码运行速度惊人，只需 7.6293-6 秒，这是一个

这与将值乘以 Numpy 数组的想法非常相似。我们看到我们正在使用一个双 for 循环，应该立即意识到应该有一个更快的方法。

方便的是，如果我们直接乘以 1.0000001 标量，Numpy 将自动对我们的代码进行矢量化。所以，我们可以用同样的方式来写我们的乘法，就像我们乘以一个 Python 列表一样。

下面的代码演示了这一点，运行时间为 0.003618 秒，速度提高了 355 倍！

# 喜欢学习？

在 [twitter](https://twitter.com/GeorgeSeif94) 上关注我，我会在那里发布所有最新最棒的人工智能、技术和科学！也在 LinkedIn 上与我联系！