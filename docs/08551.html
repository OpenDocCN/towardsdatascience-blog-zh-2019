<html>
<head>
<title>Running Apache Kafka on Windows 10</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在 Windows 10 上运行 Apache Kafka</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/running-zookeeper-kafka-on-windows-10-14fc70dcc771?source=collection_archive---------2-----------------------#2019-11-19">https://towardsdatascience.com/running-zookeeper-kafka-on-windows-10-14fc70dcc771?source=collection_archive---------2-----------------------#2019-11-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/14f44feeaa03e4672d5668309b949451.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qcXZ4IxE0fLOpUTmzM5XpA.png"/></div></div></figure><div class=""/><blockquote class="kb kc kd"><p id="57f8" class="ke kf kg kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">卡夫卡的成长呈爆炸式增长。超过三分之一的财富 500 强公司使用卡夫卡。这些公司包括顶级旅游公司、银行、十大保险公司中的八家、十大电信公司中的九家，等等。LinkedIn、微软和网飞每天用 Kafka 处理四个逗号的消息(10 亿条)。</p><p id="a368" class="ke kf kg kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><strong class="kh jf"> Kafka 用于实时数据流，收集大数据，或进行实时分析(或两者兼有)</strong>。Kafka 与内存中的微服务一起使用，以提供耐用性，并可用于向<a class="ae ld" href="https://dzone.com/articles/complex-event-processing-for-stream-analytics" rel="noopener ugc nofollow" target="_blank"> CEP </a>(复杂事件流系统)和 IoT/IFTTT 风格的自动化系统提供事件。— DZone</p></blockquote><p id="d628" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">网上有很多关于这个话题的文章，但是很多都是断章取义的，或者只是从不能在 Windows 上运行的文章中复制粘贴而来的。虽然这是一个简单的安装有一些问题。</p><p id="1606" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">这篇文章将帮助你远离陷阱，在 Windows 10 平台上培养 Kafka。</p></div><div class="ab cl lh li hx lj" role="separator"><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm"/></div><div class="im in io ip iq"><p id="6f9c" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">Kafka 依赖 Zookeeper 作为其分布式消息传递核心。所以 zookeeper 服务器需要先启动并运行，这样 Kafka 服务器才能连接到它。</p><p id="a2bd" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">在你下载 Zookeeper 和 Kafka 之前，确保你的系统已经安装了 7-zip。(处理 tar 和 gz 文件的伟大工具。)</p><p id="1347" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">在本文中，首先，我们将确保我们有一些必要的工具。然后我们将安装、配置和运行 Zookeeper。之后，我们将安装、配置和运行 Kafka。</p><p id="ea0e" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">所以，让我们开始吧。</p><h1 id="af3d" class="lo lp je bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">安装工具</h1><p id="f164" class="pw-post-body-paragraph ke kf je kh b ki mm kk kl km mn ko kp le mo ks kt lf mp kw kx lg mq la lb lc im bi translated">《动物园管理员》和《卡夫卡》是用 Java 写的，所以你需要 JDK。许多网站会告诉你只安装 JRE。不用麻烦了。只需安装 JDK。这是 JRE 附带的。然后设置 HOME 和 PATH 变量。但首先，7 比 0。</p><h2 id="ac32" class="mr lp je bd lq ms mt dn lu mu mv dp ly le mw mx mc lf my mz mg lg na nb mk nc bi translated">安装 7-zip</h2><p id="3e05" class="pw-post-body-paragraph ke kf je kh b ki mm kk kl km mn ko kp le mo ks kt lf mp kw kx lg mq la lb lc im bi translated">你可以在这里找到 7-zip—</p><div class="is it gp gr iu nd"><a href="https://www.7-zip.org/download.html" rel="noopener  ugc nofollow" target="_blank"><div class="ne ab fo"><div class="nf ab ng cl cj nh"><h2 class="bd jf gy z fp ni fr fs nj fu fw jd bi translated">[计] 下载</h2><div class="nk l"><h3 class="bd b gy z fp ni fr fs nj fu fw dk translated">英文中文更简单。中国传统。世界语法语德语印度尼西亚语日语葡萄牙语巴西西班牙语泰语…</h3></div><div class="nl l"><p class="bd b dl z fp ni fr fs nj fu fw dk translated">www.7-zip.org</p></div></div><div class="nm l"><div class="nn l no np nq nm nr ja nd"/></div></div></a></div><p id="cb73" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">当您安装 7-zip 时，请确保将其添加到您的右键菜单快捷方式中。这会让你的生活更轻松。</p><h2 id="4645" class="mr lp je bd lq ms mt dn lu mu mv dp ly le mw mx mc lf my mz mg lg na nb mk nc bi translated">安装 JDK</h2><p id="ffcd" class="pw-post-body-paragraph ke kf je kh b ki mm kk kl km mn ko kp le mo ks kt lf mp kw kx lg mq la lb lc im bi translated">它过去是免费的，现在仍然是免费的，只是现在你需要在 Oracle 创建一个帐户才能下载它。这是链接-</p><div class="is it gp gr iu nd"><a href="https://www.oracle.com/technetwork/java/javase/downloads/index.html" rel="noopener  ugc nofollow" target="_blank"><div class="ne ab fo"><div class="nf ab ng cl cj nh"><h2 class="bd jf gy z fp ni fr fs nj fu fw jd bi translated">Java SE 下载</h2><div class="nk l"><h3 class="bd b gy z fp ni fr fs nj fu fw dk translated">Java SE 13.0.1 是 Java SE 平台的最新版本了解更多信息寻找 Oracle OpenJDK 版本？甲骨文…</h3></div><div class="nl l"><p class="bd b dl z fp ni fr fs nj fu fw dk translated">www.oracle.com</p></div></div><div class="nm l"><div class="ns l no np nq nm nr ja nd"/></div></div></a></div><p id="51e5" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">JDK 将首先安装自己，然后它会问你要安装 JRE 的位置。</p><p id="b4c0" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">默认安装位置是“C:\Program Files\…”</p><p id="266c" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">通常把 Java 放在那里是没问题的，但是最好不要放在你的 Kafka 系统中。卡夫卡是为 Linux 设计的。我不会用包含空格的 Windows 目录名来推它。</p><p id="3719" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">我把我的 JDK 和 JRE 放在一个没有空格的路径中。我的安装位置是 C:\Java</p><h2 id="65fb" class="mr lp je bd lq ms mt dn lu mu mv dp ly le mw mx mc lf my mz mg lg na nb mk nc bi translated">设置路径</h2><p id="bf49" class="pw-post-body-paragraph ke kf je kh b ki mm kk kl km mn ko kp le mo ks kt lf mp kw kx lg mq la lb lc im bi translated">我们需要为所有的安装设置路径。因此，我们将在本文中多次讨论这个问题。我们将设置两种路径变量——用户变量和系统变量。在用户变量中，我们将添加安装位置的路径，在系统变量中，我们将设置 bin 目录的路径。</p><p id="3543" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">在 Windows 搜索栏中键入“Environment”。它会出现一个选项来编辑控制面板中的系统变量。点击它，你就会进入系统属性。点击右下角写着环境变量…的按钮。</p><h2 id="36cc" class="mr lp je bd lq ms mt dn lu mu mv dp ly le mw mx mc lf my mz mg lg na nb mk nc bi translated">用户变量</h2><p id="b532" class="pw-post-body-paragraph ke kf je kh b ki mm kk kl km mn ko kp le mo ks kt lf mp kw kx lg mq la lb lc im bi translated">在顶部框中的用户变量下，单击 New 并添加 JAVA_HOME 和 JRE_HOME。对于 JAVA_HOME 的值，单击浏览目录按钮并导航到安装 JDK 的位置。我用的是 C:\Java\jdk1.8.0_221\</p><p id="6f41" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">对于 JRE_HOME 的值，单击 Browse Directories 按钮并导航到安装 JRE 的位置。对我来说，那就是 C:\Java\jre1.8.0_221\</p><h2 id="3963" class="mr lp je bd lq ms mt dn lu mu mv dp ly le mw mx mc lf my mz mg lg na nb mk nc bi translated">系统变量</h2><p id="b77b" class="pw-post-body-paragraph ke kf je kh b ki mm kk kl km mn ko kp le mo ks kt lf mp kw kx lg mq la lb lc im bi translated">在系统变量框中，双击路径并在末尾添加以下两个条目</p><p id="eb79" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">%JAVA_HOME%\bin</p><p id="0e7c" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">%JRE_HOME%\bin</p><h2 id="ab49" class="mr lp je bd lq ms mt dn lu mu mv dp ly le mw mx mc lf my mz mg lg na nb mk nc bi translated">试验</h2><p id="b465" class="pw-post-body-paragraph ke kf je kh b ki mm kk kl km mn ko kp le mo ks kt lf mp kw kx lg mq la lb lc im bi translated">如果设置正确，可以在任何目录下打开命令提示符。(一种快速的方法是使用 windows 文件资源管理器转到任何目录，然后在文件资源管理器的地址栏中键入“cmd”(不带引号)。它会在那个位置打开一个提示。)</p><p id="ec0f" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">导航到一个不同于 Java 安装的目录，这样您就可以真正知道您的路径变量是否在工作。</p><p id="9500" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">java 类型-版本</p><p id="3ca9" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">你应该看看这个-</p><pre class="nt nu nv nw gt nx ny nz oa aw ob bi"><span id="08f2" class="mr lp je ny b gy oc od l oe of">C:\&gt;java -version<br/>java version “1.8.0_221”<br/>Java(TM) SE Runtime Environment (build 1.8.0_221-b11)<br/>Java HotSpot(TM) 64-Bit Server VM (build 25.221-b11, mixed mode)</span></pre><p id="ff7b" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">如果您得到类似于<em class="kg"> java 不被识别为内部或外部命令，</em>那么您的路径设置不正确。为了确保这不是安装本身的问题，您可以转到 JDK 的 bin 目录并键入上面的命令。如果它在那里工作，但在其他地方不工作，这意味着系统找不到它。</p><p id="6e85" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">对于在命令提示符下键入的每个命令，您的计算机都会在路径变量列表中查找匹配项。这就是为什么像这样的错误通常是路径问题。</p><h1 id="cbca" class="lo lp je bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">安装动物园管理员</h1><p id="739b" class="pw-post-body-paragraph ke kf je kh b ki mm kk kl km mn ko kp le mo ks kt lf mp kw kx lg mq la lb lc im bi translated">下载 Zookeeper 二进制文件。这里有一个可以下载的镜像</p><p id="36cf" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">确保下载名称中包含 bin 的文件，而不是另一个文件。如果你下载了非 bin 文件，那么当你试图启动服务器时，你会得到一个错误。</p><pre class="nt nu nv nw gt nx ny nz oa aw ob bi"><span id="402c" class="mr lp je ny b gy oc od l oe of"><a class="ae ld" href="http://apache-mirror.8birdsvideo.com/zookeeper/stable/" rel="noopener ugc nofollow" target="_blank">http://apache-mirror.8birdsvideo.com/zookeeper/stable/</a></span></pre><p id="f74e" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">右键单击该文件，并使用 7-zip 在同一位置提取它。这将提取 tar 文件，但它仍然不是真正的文件，所以您将该文件提取到哪里并不重要。</p><p id="40b5" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">对于下一步，位置很重要:</p><p id="2ba0" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">右键单击 tar 文件，将其解压缩到名称中没有空格的目录。我把我的目录放在 C:\Apache\ <br/>中，所以我得到了一个类似这样的目录。所以</p><pre class="nt nu nv nw gt nx ny nz oa aw ob bi"><span id="1a60" class="mr lp je ny b gy oc od l oe of">C:\Apache\apache-zookeeper-3.5.6-bin</span></pre><p id="84a8" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">截至本文撰写之时，zookeeper 的稳定版是 3.5.6。你的可能不一样。</p><p id="c092" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">请注意名称后面的-bin。如果你没有看到这个，那么你已经下载并提取了错误的文件。回到镜子前。这很重要，否则当你启动 Zookeeper 服务器时，你会得到一个类似这样的错误</p><pre class="nt nu nv nw gt nx ny nz oa aw ob bi"><span id="b1b8" class="mr lp je ny b gy oc od l oe of">Error: Could not find or load main class org.apache.zookeeper.server.quorum.QuorumPeerMain</span></pre><h2 id="f566" class="mr lp je bd lq ms mt dn lu mu mv dp ly le mw mx mc lf my mz mg lg na nb mk nc bi translated">配置 Zookeeper</h2><p id="34c2" class="pw-post-body-paragraph ke kf je kh b ki mm kk kl km mn ko kp le mo ks kt lf mp kw kx lg mq la lb lc im bi translated">所有的配置都发生在一个文件中——配置文件，它在 conf 目录中。</p><p id="6cc6" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">转到 zookeeper 安装的 conf 目录。对我来说，它在</p><pre class="nt nu nv nw gt nx ny nz oa aw ob bi"><span id="4fd0" class="mr lp je ny b gy oc od l oe of">C:\Apache\apache-zookeeper-3.5.6-bin\conf</span></pre><p id="7ce6" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">将 zoo_sample.cfg 文件重命名为 zoo.cfg</p><p id="707c" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">用文本编辑器打开它。</p><p id="d136" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">在这个文件中，您将看到一个名为 dataDir 的条目，其值为/tmp。它基本上告诉你该做什么</p><pre class="nt nu nv nw gt nx ny nz oa aw ob bi"><span id="d639" class="mr lp je ny b gy oc od l oe of"># the directory where the snapshot is stored. <br/># do not use /tmp for storage, /tmp here is just<br/># example sakes.</span></pre><p id="b91f" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">大多数网上的文章都告诉你用类似 dataDir=:\zookeeper-3.5.6\data 这样的东西来替换这一行</p><p id="a45c" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">如果你这样做，你会遇到这样的错误-</p><pre class="nt nu nv nw gt nx ny nz oa aw ob bi"><span id="10f6" class="mr lp je ny b gy oc od l oe of">ERROR— Unable to access datadir, exiting abnormally<br/>Unable to create data directory :zookeeper-3.5.6data\version-2<br/>Unable to access datadir, exiting abnormally</span></pre><p id="d589" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">为了避免这个错误，请将您的日志指向比 bin 目录高一级的路径，如下所示</p><pre class="nt nu nv nw gt nx ny nz oa aw ob bi"><span id="f53f" class="mr lp je ny b gy oc od l oe of">dataDir=../logs</span></pre><p id="802a" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">(它可以是更高一级，也可以在同一目录中。您也可以键入从根目录 C:\\)开始的绝对 windows 路径</p><p id="a1dc" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">这将在你的 zookeeper 安装目录中创建一个日志目录，当你运行服务器时，它将存储快照。</p><p id="c10e" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">配置完成。让我们设置路径变量，这样系统可以从任何地方找到它。</p><h2 id="e60c" class="mr lp je bd lq ms mt dn lu mu mv dp ly le mw mx mc lf my mz mg lg na nb mk nc bi translated">设置路径</h2><p id="e283" class="pw-post-body-paragraph ke kf je kh b ki mm kk kl km mn ko kp le mo ks kt lf mp kw kx lg mq la lb lc im bi translated">像以前一样，开始在 Windows 搜索栏中键入 Environment。它会出现一个选项来编辑控制面板中的系统变量。点击它，你就会进入系统属性。点击右下角写着环境变量…的按钮。</p><h2 id="e912" class="mr lp je bd lq ms mt dn lu mu mv dp ly le mw mx mc lf my mz mg lg na nb mk nc bi translated">用户变量</h2><p id="5117" class="pw-post-body-paragraph ke kf je kh b ki mm kk kl km mn ko kp le mo ks kt lf mp kw kx lg mq la lb lc im bi translated">在顶框的用户变量下，点击 New 并添加 ZOOKEEPER_HOME。对于该值，单击浏览目录按钮并导航到 Zookeeper 的安装位置。对我来说，那就是 C:\ Apache \ Apache-zookeeper-3 . 5 . 6-bin</p><h2 id="db8d" class="mr lp je bd lq ms mt dn lu mu mv dp ly le mw mx mc lf my mz mg lg na nb mk nc bi translated">系统变量</h2><p id="07fb" class="pw-post-body-paragraph ke kf je kh b ki mm kk kl km mn ko kp le mo ks kt lf mp kw kx lg mq la lb lc im bi translated">在系统变量框中，双击路径并在末尾添加以下内容</p><p id="0378" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">%ZOOKEEPER_HOME%\bin</p><h2 id="fe73" class="mr lp je bd lq ms mt dn lu mu mv dp ly le mw mx mc lf my mz mg lg na nb mk nc bi translated">启动 Zookeeper 服务器</h2><p id="8506" class="pw-post-body-paragraph ke kf je kh b ki mm kk kl km mn ko kp le mo ks kt lf mp kw kx lg mq la lb lc im bi translated">在 zookeeper bin 目录下打开命令提示符，输入</p><p id="e01c" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">zkserver</p><p id="6a55" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">它会开始发出一大堆信息。下面是一些有趣的例子。(为了视觉上的清晰，我已经清理了多余的词语)。它们看起来像这样</p><p id="90ce" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">2019–11–19 11:17:17986[myid:]—信息-&gt; <em class="kg">获取信息</em></p><p id="ce7a" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">2019–11–19 11:17:17986[myid:]—WARN-&gt;<em class="kg">获取警告</em></p><blockquote class="kb kc kd"><p id="7354" class="ke kf kg kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">myid 为空，因为我的 dataDir 中没有 myid 文件。Zookeeper 通过 id 跟踪集群中的每台机器。要给机器分配一个 id，只需输入一个包含一个数字的文件名 myid(没有任何扩展名)。我在单一服务器模式下运行 Zookeeper 进行开发，因此没有必要设置 id。但是，如果我创建一个编号为 5 的文件(可以是任意的，但是如果集群中有多台机器，则需要是唯一的)，那么命令行应该是这样的</p><p id="e546" class="ke kf kg kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">2019–11–19 12:05:21400<strong class="kh jf">[myid:5]</strong>—INFO[main:FileSnap @ 83]—读取快照..\ logs \版本 2\snapshot.a6</p></blockquote><pre class="nt nu nv nw gt nx ny nz oa aw ob bi"><span id="332b" class="mr lp je ny b gy oc od l oe of">Server environment:os.name=Windows 10<br/>Server environment:os.arch=amd64<br/>Server environment:os.version=10.0<br/>Server environment:user.name=Bivas Biswas<br/>Server environment:user.home=C:\Users\Bivas Biswas<br/>Server environment:user.dir=C:\Apache\apache-zookeeper-3.5.6-bin\bin<br/>Server environment:os.memory.free=946MB<br/>Server environment:os.memory.max=14491MB<br/>Server environment:os.memory.total=977MB<br/>minSessionTimeout set to 4000<br/>maxSessionTimeout set to 40000<br/>Created server with tickTime 2000 minSessionTimeout 4000 maxSessionTimeout 40000 datadir ..\logs\version-2 snapdir ..\logs\version-2<br/>Logging initialized <a class="ae ld" href="http://twitter.com/5029ms" rel="noopener ugc nofollow" target="_blank">@5029ms</a> to org.eclipse.jetty.util.log.Slf4jL</span></pre><p id="5d5c" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">最后一行中对 log4j 的引用是对 zookeeper 使用的日志基础设施的引用。您还会注意到，它正在将快照记录到我们之前在配置文件中指定的日志目录中。</p><pre class="nt nu nv nw gt nx ny nz oa aw ob bi"><span id="ee66" class="mr lp je ny b gy oc od l oe of">Snapshotting: 0x0 to C:Apachezookeeper-3.5.6-binlogs\version-2\snapshot.0</span></pre><p id="b13a" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">经过几秒钟的数据喷涌，它应该来到这些黄金线</p><pre class="nt nu nv nw gt nx ny nz oa aw ob bi"><span id="55ef" class="mr lp je ny b gy oc od l oe of"><br/>Started AdminServer on address 0.0.0.0, port 8080 and command URL /commands<br/>Using org.apache.zookeeper.server.NIOServerCnxnFactory as server connection factory<br/>Configuring NIO connection handler with 10s sessionless connection timeout, 3 selector thread(s), 40 worker threads, and 64 kB direct buffers.<br/>binding to port 0.0.0.0/0.0.0.0:2181</span></pre><p id="e270" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">现在 Zookeeper 服务器运行在 localhost:2181 上。端口 8080 上的 AdminServer 是新增的。我们可以使用浏览器上的端口来监控 zookeeper。</p><p id="0c7f" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">但是，你不能去运行 zookeeper 的 2181 端口。Zookeeper 是 Kafka 用来作为 Kafka 集群的核心内核的。如果您在浏览器上导航到该端口，这将向它发送一些它不期望的 TCP 流量，您将使服务器崩溃。这是你将得到的—</p><pre class="nt nu nv nw gt nx ny nz oa aw ob bi"><span id="0c3c" class="mr lp je ny b gy oc od l oe of"><br/>Exception causing close of session 0x0: Len error 1195725856</span></pre><p id="3060" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">所以，就这样了。你的 Zookeeper 可以在 Windows 10 上运行，而不需要使用 docker composer 或 Linux VM。</p><h1 id="4a35" class="lo lp je bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">下一个——卡夫卡</h1><p id="bc90" class="pw-post-body-paragraph ke kf je kh b ki mm kk kl km mn ko kp le mo ks kt lf mp kw kx lg mq la lb lc im bi translated">卡夫卡是一个信息经纪人。它可以让你创建你认为像聊天室的话题。您在该主题上发布一条消息，订阅该主题的人将会收到该消息。接受者被称为消费者。信息张贴者被称为生产者。</p><p id="1c17" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">Kafka 还有另外两种能力。一个是流处理 API，它基本上接收这些消息，并在接收者收到之前将它们转换为不同的值。这在实时数据流中实时发生。</p><p id="ee5f" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">另一个是连接器 API，让 Kafka 连接到数据库或存储系统来存储数据。然后，这些数据可用于 Hadoop、Map Reduce 等集群的进一步处理。除了向消费者实时传递消息之外，这种情况也会发生。</p><p id="0b4c" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">如今，卡夫卡是一个一体化的解决方案。以前，你需要一个像 Apache Storm 这样的流处理框架来转换流，但是有了 Kafka 的原生流 API，我们就不像以前那样需要 Storm 了。这取决于您的使用案例和对您有意义的拓扑，但最好有选择。</p><h2 id="d3aa" class="mr lp je bd lq ms mt dn lu mu mv dp ly le mw mx mc lf my mz mg lg na nb mk nc bi translated">安装卡夫卡</h2><p id="6190" class="pw-post-body-paragraph ke kf je kh b ki mm kk kl km mn ko kp le mo ks kt lf mp kw kx lg mq la lb lc im bi translated">从这里下载卡夫卡-</p><pre class="nt nu nv nw gt nx ny nz oa aw ob bi"><span id="e356" class="mr lp je ny b gy oc od l oe of">http://kafka.apache.org/downloads.html</span></pre><p id="3ff5" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">获取二进制下载。在这一部分，你可能会看到多个标有 Scala x.xxx 的版本。如果你使用 Scala 作为客户端，那么就获取与你的 Scala 版本相匹配的版本。我使用 NodeJS 作为我的客户端，所以我得到哪个并不重要。在撰写本文时，Apache 推荐<a class="ae ld" href="https://www.apache.org/dyn/closer.cgi?path=/kafka/2.3.1/kafka_2.12-2.3.1.tgz" rel="noopener ugc nofollow" target="_blank">Kafka _ 2.12–2 . 3 . 1 . tgz</a>所以这是我得到的版本。</p><p id="8cef" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">使用 7-zip 将 tgz 解压缩到一个 tar 文件中。然后使用 7-zip 将 tar 文件解压到一个路径中没有空格的位置。我用 C:\Apache，所以解压后，我的卡夫卡住在这里——</p><pre class="nt nu nv nw gt nx ny nz oa aw ob bi"><span id="077f" class="mr lp je ny b gy oc od l oe of">C:\Apache\kafka_2.12–2.3.1</span></pre><p id="5574" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">这篇文章越来越长，所以我打算把它分成两部分。接下来，我们将了解如何设置和配置 Kafka 服务器。</p><h2 id="94e6" class="mr lp je bd lq ms mt dn lu mu mv dp ly le mw mx mc lf my mz mg lg na nb mk nc bi translated">配置 Kafka</h2><p id="8f66" class="pw-post-body-paragraph ke kf je kh b ki mm kk kl km mn ko kp le mo ks kt lf mp kw kx lg mq la lb lc im bi translated">我们不会为 Kafka 设置任何环境变量。卡夫卡是寻找动物园管理员和 JDK 的人。甚至生产者和消费者都生活在卡夫卡生态系统中。它们不是在你的电脑上寻找卡夫卡的独立应用程序。简而言之，没有环境变量可以乱来。</p><p id="ecbb" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">但是，需要设置配置文件。</p><p id="12c7" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">转到您的 Kafka 配置目录。对我来说是在</p><pre class="nt nu nv nw gt nx ny nz oa aw ob bi"><span id="e19f" class="mr lp je ny b gy oc od l oe of">C:\Apache\kafka_2.12–2.3.1\config</span></pre><p id="a6b5" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">我们可以从一个示例 server.properties 文件开始。</p><p id="8a00" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">对于一个经纪人，我们只需要建立这一个文件。如果我们需要多个代理，那么为每个代理复制一次这个文件。例如，如果您需要两个消息代理，那么您最终会得到 server.b1.properties 和 server.b2.properties。</p><p id="1ac9" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">在每个文件中，您将更改以下内容—</p><ul class=""><li id="805e" class="og oh je kh b ki kj km kn le oi lf oj lg ok lc ol om on oo bi translated">经纪人 id</li></ul><pre class="nt nu nv nw gt nx ny nz oa aw ob bi"><span id="7ad4" class="mr lp je ny b gy oc od l oe of"># The id of the broker. This must be set to a unique integer for each broker.</span><span id="813e" class="mr lp je ny b gy op od l oe of">broker.id=0</span></pre><p id="0816" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">如果您只使用 1 个代理，则将其保留为 0。没什么好改变的。如果您有另一个代理，那么更改其他文件中的 id，使它们是唯一的。</p><pre class="nt nu nv nw gt nx ny nz oa aw ob bi"><span id="b4c5" class="mr lp je ny b gy oc od l oe of"># The id of the broker. This must be set to a unique integer for each broker.</span><span id="e409" class="mr lp je ny b gy op od l oe of">broker.id=1</span></pre><ul class=""><li id="0dc1" class="og oh je kh b ki kj km kn le oi lf oj lg ok lc ol om on oo bi translated">更改日志目录。我坚持我的绝对路线。您可以在这里使用任何 Windows 风格的路径</li></ul><pre class="nt nu nv nw gt nx ny nz oa aw ob bi"><span id="fe46" class="mr lp je ny b gy oc od l oe of"># A comma separated list of directories under which to store log files</span><span id="2bb4" class="mr lp je ny b gy op od l oe of">log.dirs=C:\Apache\kafka_2.12–2.3.1\logs</span></pre><ul class=""><li id="d698" class="og oh je kh b ki kj km kn le oi lf oj lg ok lc ol om on oo bi translated">复制因素就像硬盘上的 RAID。它将数据从一个代理复制到另一个代理，以实现冗余和容错。对于开发，我将把它保持在 1</li></ul><p id="3ba6" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">浏览该文件中的字段。您会注意到超时值、分区值和默认 Zookeeper 端口号，如果出现问题，这些都将在以后的调试中派上用场。</p><p id="125a" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">默认情况下，Apache Kafka 将在端口<strong class="kh jf"> 9092 </strong>上运行，Apache Zookeeper 将在端口<strong class="kh jf"> 2181 上运行。</strong></p><p id="09ef" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">至此，我们完成了卡夫卡的配置。让我们启动服务器。</p><h2 id="0942" class="mr lp je bd lq ms mt dn lu mu mv dp ly le mw mx mc lf my mz mg lg na nb mk nc bi translated">运行卡夫卡</h2><p id="cab2" class="pw-post-body-paragraph ke kf je kh b ki mm kk kl km mn ko kp le mo ks kt lf mp kw kx lg mq la lb lc im bi translated">确保 Zookeeper 服务器仍在运行。</p><p id="0d52" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">导航到 Kafka 安装目录中的 bin 目录。在那里你会看到一个 windows 目录，进入那里。这是所有令人敬畏的 windows 实用程序存储的地方。对我来说，就是这里-</p><p id="c169" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">打开一个新的终端窗口</p><pre class="nt nu nv nw gt nx ny nz oa aw ob bi"><span id="9ae6" class="mr lp je ny b gy oc od l oe of">C:\Apache\kafka_2.12–2.3.1\bin\windows</span></pre><p id="6270" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">(如果您忘记进入 windows 目录，而只是从 bin 目录启动，下面的命令将只是在 Visual Studio 代码中打开 shell 文件，而不是运行批处理文件)</p><pre class="nt nu nv nw gt nx ny nz oa aw ob bi"><span id="5d75" class="mr lp je ny b gy oc od l oe of">kafka-server-start.bat C:\Apache\kafka_2.12–2.3.1\config\server.properties</span></pre><p id="1323" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">你会看到这样的结果-</p><pre class="nt nu nv nw gt nx ny nz oa aw ob bi"><span id="5153" class="mr lp je ny b gy oc od l oe of">Client environment:java.compiler=&lt;NA&gt; (org.apache.zookeeper.ZooKeeper)<br/>Windows 10 (org.apache.zookeeper.ZooKeeper)<br/>Client environment:os.arch=amd64 (org.apache.zookeeper.ZooKeeper)<br/>Client environment:os.version=10.0 (org.apache.zookeeper.ZooKeeper)<br/>Client environment:user.name=Bivas Biswas <br/>Client environment:user.home=C:\Users\Bivas Biswas </span><span id="5e4e" class="mr lp je ny b gy op od l oe of">Client environment:user.dir=C:\Apache\kafka_2.12–2.3.1\bin\windows (org.apache.zookeeper.ZooKeeper)<br/>Initiating client connection, connectString=localhost:2181 sessionTimeout=6000 watcher=kafka.zookeeper.ZooKeeperClient$ZooKeeperClientWatcher$@57c758ac (org.apache.zookeeper.ZooKeeper)<br/>[ZooKeeperClient Kafka server] Waiting until connected. (kafka.zookeeper.ZooKeeperClient)</span></pre><p id="793f" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">此时，如果服务器等待 Zookeeper 响应超时，请转到运行 Zookeeper 的命令终端，然后按 enter 键。有时候如果《动物园管理员》空闲一段时间，我见过卡夫卡超时。</p><p id="b1a6" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">如果一切顺利，您将看到来自组协调器的一些元数据转储和偏移消息，看起来像这样，带有闪烁的等待光标</p><pre class="nt nu nv nw gt nx ny nz oa aw ob bi"><span id="6730" class="mr lp je ny b gy oc od l oe of">[GroupCoordinator 0]: Preparing to rebalance group console-consumer-83701 in state PreparingRebalance with old generation 1 (__consumer_offsets-10) (reason: removing member consumer-1–9bf4ef2d-97af-4e59–964e-5bb57b457289 on heartbeat expiration) (kafka.coordinator.group.GroupCoordinator)</span><span id="15d9" class="mr lp je ny b gy op od l oe of">[GroupCoordinator 0]: Group console-consumer-83701 with generation 2 is now empty (__consumer_offsets-10) (kafka.coordinator.group.GroupCoordinator)</span></pre><p id="bb39" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">你会在动物园管理员终端看到一些活动。它可能会拍摄新的快照并启动新的日志文件。此时，您的卡夫卡已经启动并运行。</p><h1 id="f874" class="lo lp je bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">包扎</h1><p id="4f2a" class="pw-post-body-paragraph ke kf je kh b ki mm kk kl km mn ko kp le mo ks kt lf mp kw kx lg mq la lb lc im bi translated">动物园管理员需要记住的几件事——</p><p id="f79e" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">我们设置为日志目录的 dataDir 将很快被快照填满。</p><p id="3e6f" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">在我的测试中，用一个主题运行 Kafka 不到 15 分钟，产生了两个 65MB 的快照文件。这些快照是事务性日志文件，每次检测到节点发生变化时都会写入这些文件。</p><p id="112f" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">当 Zookeeper 将几个日志文件合并成一个更大的文件时，它会创建副本，但不会清理旧文件。所以自己清理这个目录。您可以使用 bin 目录中的 zkTxnLogToolkit 来配置日志保留策略。</p><p id="29d2" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">如果您在 AWS 上部署 EC2 实例，并且使用 t2.micro 的免费层，服务器不会启动。</p><p id="524e" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">这是因为 zookeeper 和 Kafka 的默认堆大小约为 1 GB，而 t2.micro 上的内存为 1GB，因此它会抱怨内存空间不足。</p><p id="675b" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">为了避免这个错误，请在具有 4GB 内存的 t3.medium 实例上运行 Kafka，而不是在配置文件中减少堆大小。</p><p id="0898" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">没有什么比跟随一篇文章更令人沮丧的了，这篇文章的步骤并不像它所说的那样有效。这就是我开始写这篇文章的原因，当时我浏览了大量的破碎的文章并修复了错误。</p><p id="cf5c" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">如果您在这些步骤中遇到任何错误，请告诉我。如果你有困难，请在下面留言，我会尽快回复你。</p><p id="c7fc" class="pw-post-body-paragraph ke kf je kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">快乐流媒体！</p></div></div>    
</body>
</html>