<html>
<head>
<title>Time Series Analysis 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">时间序列分析 1</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/time-series-analysis-1-9f4360f43110?source=collection_archive---------8-----------------------#2019-03-08">https://towardsdatascience.com/time-series-analysis-1-9f4360f43110?source=collection_archive---------8-----------------------#2019-03-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/fb8656c62495585df86c93a895e25d19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TJX2Hyz7pr0KuPorMRDeMA.png"/></div></div></figure><p id="0fdd" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">时间序列数据的分析是任何数据科学家工作不可或缺的一部分，在量化交易领域更是如此。金融数据是时间序列数据中最令人费解的，而且经常看起来不稳定。然而，在这几篇文章中，我将建立一个分析这种时间序列的框架，首先使用成熟的理论，然后深入研究更奇特的现代方法，如机器学习。所以让我们开始吧！</p><h2 id="dfc8" class="kz la it bd lb lc ld dn le lf lg dp lh km li lj lk kq ll lm ln ku lo lp lq lr bi translated">ARIMA 模型</h2><p id="2118" class="pw-post-body-paragraph kb kc it kd b ke ls kg kh ki lt kk kl km lu ko kp kq lv ks kt ku lw kw kx ky im bi translated">我们要讨论的第一个模型是 ARIMA 模型。它代表自回归综合移动平均模型。是的，有很多需要理解。然而，它本质上只是结合了两个更简单的模型，自回归模型和移动平均模型，这两个模型我们将在下面详细说明。在此之前，我们需要建立平稳性的概念，因为它对于能够准确地建模和预测时间序列至关重要。</p><h2 id="5e84" class="kz la it bd lb lc ld dn le lf lg dp lh km li lj lk kq ll lm ln ku lo lp lq lr bi translated">平稳性</h2><p id="570d" class="pw-post-body-paragraph kb kc it kd b ke ls kg kh ki lt kk kl km lu ko kp kq lv ks kt ku lw kw kx ky im bi translated">平稳性的概念来源于随机过程，有时这些随机过程的结果就是白噪声。以下是平稳性的广义定义:</p><blockquote class="lx ly lz"><p id="cfe4" class="kb kc ma kd b ke kf kg kh ki kj kk kl mb kn ko kp mc kr ks kt md kv kw kx ky im bi translated">平稳时间序列是其统计特性(如均值和标准差)不依赖于时间的时间序列。</p></blockquote><p id="bb18" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">对于那些有统计学和随机学经验的人来说，下面是一个更正式的定义</p><p id="ba4c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">设{Xt}是一个随机过程，并且</p><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div class="gh gi me"><img src="../Images/416f7e6db58f374cdf20903519a87b46.png" data-original-src="https://miro.medium.com/v2/resize:fit:476/format:webp/1*5R3sIb8OL04Y5O-cPUfcNQ.png"/></div></figure><p id="7aaa" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">是{Xt}的无条件联合分布的累积分布函数。那么，{Xt}是严格平稳的，当且仅当，</p><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/dd3b902cddefaaa121410f3d1b1183d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:876/format:webp/1*67mveHEQpKIiR3kAqq9MCQ.png"/></div></figure><p id="1b71" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然而，在大多数应用程序中，我们不会使用随机方法手动检查平稳性。我们使用的测试，如迪基-富勒和扩大迪基-富勒测试。</p><p id="4c08" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">还有一个较弱的平稳性概念，在大多数情况下足以满足。这种弱平稳性被定义为时间序列的期望值和协方差不随时间变化。</p><h2 id="201b" class="kz la it bd lb lc ld dn le lf lg dp lh km li lj lk kq ll lm ln ku lo lp lq lr bi translated">自回归模型</h2><p id="1b06" class="pw-post-body-paragraph kb kc it kd b ke ls kg kh ki lt kk kl km lu ko kp kq lv ks kt ku lw kw kx ky im bi translated">自回归模型在概念上很简单:它使用滞后值作为当前/下一时间步的简单线性回归模型的回归量。形式上，它是:</p><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/3374d7eadd6c26f7ab24bcab70f5a258.png" data-original-src="https://miro.medium.com/v2/resize:fit:634/format:webp/1*h3e8gWvJzRG7lsw_3yMJNw.png"/></div></figure><p id="d907" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">其中:</p><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/5e7a5e870316f25f0b48dd792570a53f.png" data-original-src="https://miro.medium.com/v2/resize:fit:234/format:webp/1*PWLroqP3JEuj_1J8oqWPiQ.png"/></div></figure><p id="201c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">AR 模型可能类似于普通的最小二乘(OLS)回归，其中先前的时间步长是回归量，当前的 x 值是预测变量。我认为我们应该花一点时间来理解 OLS 回归和 AR 模型之间的区别。考虑下面的 OLS 问题:</p><p id="0aaa" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">您有数据 X 和 Y，并希望找到以下形式的回归公式的 OLS 估计:</p><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/821f23f9f40db64921982cc0dd6af57c.png" data-original-src="https://miro.medium.com/v2/resize:fit:244/format:webp/1*aGWdujuD-n0cmuyJCRMdbA.png"/></div></figure><p id="a80e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">OLS 的目标是找到一个最小化误差平方和的β估计值。换句话说，找到的最小值</p><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/8518a60b1288f2e8af545599954eac6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:428/format:webp/1*VlcE98nWGDidLKx4IhEcHQ.png"/></div></figure><p id="5cab" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">展开它，对方程求导，我们可以找到驻点，结果是</p><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/6b0fc683eb509799b2774c885c87c6cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:354/format:webp/1*u0W8vc29E8RGdrppj_CWwg.png"/></div></figure><p id="0d5b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这是对 OLS 估计的解决办法。然而，将这种方法应用于 AR 模型的关键问题是，数据 X 和 Y 不是在好的矩阵中，并且每次我们处理数据时很难将它们整合到这样的矩阵中。因此，我们使用另一种方法来寻找 AR 模型中滞后变量的系数。在我们研究寻找系数的方法之前，我们先来看看 ARIMA 模型的其他部分。</p><h2 id="060e" class="kz la it bd lb lc ld dn le lf lg dp lh km li lj lk kq ll lm ln ku lo lp lq lr bi translated">移动平均模型</h2><p id="9429" class="pw-post-body-paragraph kb kc it kd b ke ls kg kh ki lt kk kl km lu ko kp kq lv ks kt ku lw kw kx ky im bi translated">移动平均模型考虑了以前的误差项，并使用它来模拟时间序列的当前值。形式上，</p><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/da8e5962bed692a1b67eaf843fd38a6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:540/format:webp/1*GjZHbHjD258cexIYrbVQnw.png"/></div></figure><p id="d84d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">MA 模型看起来与 ar 模型非常相似。然而，有几个关键的区别需要注意:</p><ol class=""><li id="b2f9" class="mq mr it kd b ke kf ki kj km ms kq mt ku mu ky mv mw mx my bi translated">MA 模型中的误差项直接影响时间序列的当前值，而在 AR 模型中，来自先前时间步长的误差项只是隐含地存在。</li><li id="d880" class="mq mr it kd b ke mz ki na km nb kq nc ku nd ky mv mw mx my bi translated">MA 模型中的误差项只影响未来 q 步的时间序列，而 AR 模型中的误差项影响未来无限时间的时间序列。</li></ol><p id="6153" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这种关键的差异给了我们一个自然的扩展模型。这正是 ARMA 模型。ARMA 模型和 ARIMA 模型的区别在于积分。就时间序列而言，整合是指使时间序列成为平稳时间序列所需的差异程度。因此，如果我们有一个时间序列 y，我们把它差 d 倍，并把它叫做 x，我们只需要把上面的两个模型一起应用，就可以得到下面的 ARIMA 模型:</p><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/9e0dea35d7bfc743845e4b218f28d88b.png" data-original-src="https://miro.medium.com/v2/resize:fit:976/format:webp/1*nVTpiiMGeKBZXvrWeOZJbg.png"/></div></figure><p id="469f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">既然我们理解了 ARIMA 模型，我们可以继续探索如何估计系数。</p><h2 id="fdd1" class="kz la it bd lb lc ld dn le lf lg dp lh km li lj lk kq ll lm ln ku lo lp lq lr bi translated">估计系数</h2><p id="ef3c" class="pw-post-body-paragraph kb kc it kd b ke ls kg kh ki lt kk kl km lu ko kp kq lv ks kt ku lw kw kx ky im bi translated">有几种方法可以计算模型的系数，我们来看看其中的两种。第一种方法是使用一组称为 Yule-Walker 方程的方程。尤尔-沃克方程源于统计学中的矩方法。我们将首先考虑 AR 模型，因此考虑 AR(p)模型的自协方差:</p><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/cc3c4fe27e07c5ca750716e9afdc97bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:602/format:webp/1*5ZTyh-_yaZw1hYMoyLw8fA.png"/></div></figure><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/68848cc129e6bb1db7819658c227074a.png" data-original-src="https://miro.medium.com/v2/resize:fit:922/format:webp/1*4lfG3Zj_4Zcg-4MUsMYZTQ.png"/></div></figure><p id="ff88" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们可以将它写成矩阵形式，得到:</p><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/652636af80b8dec140a1a0fcee0e9354.png" data-original-src="https://miro.medium.com/v2/resize:fit:316/format:webp/1*gXvIL_iS-e_s4oHnjFVrxw.png"/></div></figure><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/0d66520eef5ec3f48353b228400a3444.png" data-original-src="https://miro.medium.com/v2/resize:fit:164/format:webp/1*GxTUU2SzoQXd2q_FNtBobw.png"/></div></figure><p id="6a89" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在我们可以用样本自协方差替换总体自协方差来获得系数:</p><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/fc75c81c750e6ac3226ba16deea4eed0.png" data-original-src="https://miro.medium.com/v2/resize:fit:430/format:webp/1*KoxPQFiYwjfD2nnl51ITNg.png"/></div></figure><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/1eecf06796099be686775728bb2c2824.png" data-original-src="https://miro.medium.com/v2/resize:fit:186/format:webp/1*vjCPj_7m-JvvMt-BIN6oZQ.png"/></div></figure><p id="67ad" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">使用相关矩阵也可以得到同样的结果，但我将把它留给读者做练习。</p><p id="1bbf" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">注意:Yule-Walker 方程是线性方程，但是 MA 模型实际上是非线性的，因为前面的误差项不能容易地观察到以形成可以求解的矩阵。</p><p id="bc59" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">接下来，更常用的估计系数的方法是最大似然估计(MLE)。MLE 是统计分布中估计参数的一种常用方法。MLE 背后的核心原则是最大化可能性的概念(它可以简单地是概率的乘积，但通常是总概率的对数)。关于 MLE 的介绍，请查看我关于<a class="ae nl" rel="noopener" target="_blank" href="/maximum-likelihood-estimation-how-it-works-and-implementing-in-python-b0eb2efb360f"> MLE </a>的另一篇文章。结果表明，如果 ARMA 是高斯型的，则存在 MLE 的解析表示:</p><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/d0b43138a89dc24b35c8876c6f1e6318.png" data-original-src="https://miro.medium.com/v2/resize:fit:804/format:webp/1*UcqexltTittJJgYEzBUG1A.png"/></div></figure><p id="ef92" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">最大化这个，我们将获得参数的估计。</p><h2 id="4fa4" class="kz la it bd lb lc ld dn le lf lg dp lh km li lj lk kq ll lm ln ku lo lp lq lr bi translated">选择模型</h2><p id="9989" class="pw-post-body-paragraph kb kc it kd b ke ls kg kh ki lt kk kl km lu ko kp kq lv ks kt ku lw kw kx ky im bi translated">现在我们已经知道了模型的工作原理和拟合方式，在使用模型时需要做出一个重要的决定:选择参数 p 和 q 的值。p 和 q 的值不仅会极大地影响模型所需的计算能力，还会影响构建模型时使用的信息量。决定这些值的常用方法是考虑一些信息标准，并选择具有最佳信息的参数。换句话说，计算 Akaike 信息标准或贝叶斯信息标准，然后选择最小化信息标准的参数值。</p><h2 id="b699" class="kz la it bd lb lc ld dn le lf lg dp lh km li lj lk kq ll lm ln ku lo lp lq lr bi translated">在 Python 中实现</h2><p id="6106" class="pw-post-body-paragraph kb kc it kd b ke ls kg kh ki lt kk kl km lu ko kp kq lv ks kt ku lw kw kx ky im bi translated">现在我们可以尝试用 python 实现 ARMA 模型。库 statsmodels 已经实现了 ARMA 模型，因此我们将只使用它。下面的代码将产生预测英国 GDP 的 ARMA 模型。</p><pre class="mf mg mh mi gt nn no np nq aw nr bi"><span id="31aa" class="kz la it no b gy ns nt l nu nv">import statsmodels.api as sm<br/>import matplotlib.pyplot as plt<br/>import pandas as pd<br/>import numpy as np</span><span id="e9f6" class="kz la it no b gy nw nt l nu nv">dta = pd.read_csv("mgdp.csv", index_col=None)<br/>dta = dta.iloc[:, 1]<br/>res = sm.tsa.ARIMA(dta, (20, 1, 6)).fit()<br/>fig, ax = plt.subplots()<br/>ax = dta.iloc[:].plot(ax=ax)<br/>res.plot_predict(50, 100, dynamic=True, ax=ax,<br/>                 plot_insample=False)<br/>plt.show()</span></pre><p id="1cff" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">以下是估计值:</p><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/b4230e0ab6e1abcd5e23cea45d635095.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*AEBtNarNnNMn85YyV46B0w.png"/></div></figure><p id="6975" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">显然，一个简单的 ARIMA 模型不会是最佳的，尤其是当正确的参数没有确定。这只是说明 ARIMA 模型预测能力的一个例子。我鼓励读者尝试使用 statsmodel ARIMA 函数来产生更好的结果。</p><h2 id="a8ef" class="kz la it bd lb lc ld dn le lf lg dp lh km li lj lk kq ll lm ln ku lo lp lq lr bi translated">结论</h2><p id="5dca" class="pw-post-body-paragraph kb kc it kd b ke ls kg kh ki lt kk kl km lu ko kp kq lv ks kt ku lw kw kx ky im bi translated">时间序列分析是一个庞大的课题，有许多分析方法。本文是许多探索时间序列模型的文章中的第一篇。概括地说，我们首先定义了平稳性的概念，然后探讨了 AR 和 MA 模型以及它们是如何形成的。随后，我们深入研究了模型的实际参数是如何确定的，研究了 Yule-Walker 方程和 MLE 估计。最后，我们以预测英国 GDP 增长为例说明了 ARIMA 模型的工作原理</p></div></div>    
</body>
</html>