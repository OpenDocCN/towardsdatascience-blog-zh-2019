<html>
<head>
<title>Community detection of survey responses based on Pearson correlation coefficient with Neo4j</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于 Pearson 相关系数和 Neo4j 的调查响应社区检测</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/community-detection-of-survey-responses-based-on-pearson-correlation-coefficient-with-neo4j-a522e2264c1c?source=collection_archive---------9-----------------------#2019-02-06">https://towardsdatascience.com/community-detection-of-survey-responses-based-on-pearson-correlation-coefficient-with-neo4j-a522e2264c1c?source=collection_archive---------9-----------------------#2019-02-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="f583" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">就在几天前，新版本的<a class="ae kl" href="https://github.com/neo4j-contrib/neo4j-graph-algorithms" rel="noopener ugc nofollow" target="_blank"> Neo4j 图形算法插件</a>发布了。新版本带来了新的算法，皮尔逊相关算法就是其中之一。</p><p id="8b52" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了演示如何在<a class="ae kl" href="https://neo4j.com/" rel="noopener ugc nofollow" target="_blank"> Neo4j </a>中使用皮尔逊相关算法，我们将使用由<a class="ae kl" href="https://www.kaggle.com/miroslavsabo" rel="noopener ugc nofollow" target="_blank"> Miroslav Sabo </a>提供的来自<a class="ae kl" href="https://www.kaggle.com/miroslavsabo/young-people-survey/home" rel="noopener ugc nofollow" target="_blank">年轻人调查</a>ka ggle 数据集的数据。它包含了 1010 份填写好的调查结果，问题从音乐偏好、爱好兴趣到恐惧症。</p><p id="36d4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在评分场景中使用 Pearson correlation 的好处在于，它在将每个分数与用户的平均分数进行比较时，考虑了投票者通常更倾向于给出更高或更低分数的情况。</p><h1 id="53da" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">导入</h1><p id="6af5" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">下载<a class="ae kl" href="https://www.kaggle.com/miroslavsabo/young-people-survey" rel="noopener ugc nofollow" target="_blank">数据集</a>并复制到<code class="fe lp lq lr ls b">$Neo4j/import</code>文件夹。<strong class="jp ir"> responses.csv </strong>文件中的每一行都代表一份填写了 150 个问题的调查。我们将它作为单个节点存储在 Neo4j 中。</p><pre class="lt lu lv lw gt lx ls ly lz aw ma bi"><span id="7ccb" class="mb kn iq ls b gy mc md l me mf">LOAD CSV WITH HEADERS FROM "file:///responses.csv" as row<br/>CREATE (p:Person)<br/>SET p += row</span></pre><h1 id="4291" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">预处理</h1><p id="c934" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">大多数答案从一到五不等，其中五被定义为“完全同意”，一被定义为“完全不同意”。它们在 csv 文件中显示为字符串，我们必须首先将它们转换为整数。</p><pre class="lt lu lv lw gt lx ls ly lz aw ma bi"><span id="fdc4" class="mb kn iq ls b gy mc md l me mf">MATCH (p:Person)<br/>UNWIND keys(p) as key<br/>WITH p,key where not key in ['Gender',<br/>                'Left - right handed',<br/>                'Lying','Alcohol',<br/>                'Education','Smoking',<br/>                'House - block of flats',<br/>                'Village - town','Punctuality',<br/>                'Internet usage']<br/>CALL apoc.create.setProperty(p, key, toInteger(p[key])) YIELD node<br/>RETURN distinct 'done'</span></pre><h1 id="d324" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">类别属性</h1><p id="870c" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">有些答案是绝对的。一个例子是酒精问题，可能的答案是“从不”、“社交饮酒者”和“喝很多”。</p><p id="abef" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因为我们想把它们中的一些转换成向量，所以让我们检查它们所有可能的答案。</p><pre class="lt lu lv lw gt lx ls ly lz aw ma bi"><span id="0096" class="mb kn iq ls b gy mc md l me mf">MATCH (p:Person)<br/>UNWIND ['Gender',<br/>        'Left - right handed',<br/>        'Lying','Alcohol',<br/>        'Education','Smoking',<br/>        'House - block of flats',<br/>        'Village - town','Punctuality',<br/>        'Internet usage'] as property<br/>RETURN property,collect(distinct(p[property])) as unique_values</span></pre><p id="c7d1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">结果</p><figure class="lt lu lv lw gt mg"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="c958" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们对性别、网络和酒精答案进行矢量化。我们将在 1 到 5 之间进行缩放，以匹配整数答案范围。</p><h2 id="d9cb" class="mb kn iq bd ko mj mk dn ks ml mm dp kw jy mn mo la kc mp mq le kg mr ms li mt bi translated">性别编码</h2><pre class="lt lu lv lw gt lx ls ly lz aw ma bi"><span id="9041" class="mb kn iq ls b gy mc md l me mf">MATCH (p:Person)<br/>WITH p, CASE p['Gender'] WHEN 'female' THEN 1<br/>                         WHEN 'male' THEN 5<br/>                         ELSE 3<br/>                         END as gender<br/>SET p.Gender_vec = gender</span></pre><h2 id="3537" class="mb kn iq bd ko mj mk dn ks ml mm dp kw jy mn mo la kc mp mq le kg mr ms li mt bi translated">互联网编码</h2><pre class="lt lu lv lw gt lx ls ly lz aw ma bi"><span id="54c9" class="mb kn iq ls b gy mc md l me mf">MATCH (p:Person)<br/>WITH p, CASE p['Internet usage'] WHEN 'no time at all' THEN 1<br/>                        WHEN 'less than an hour a day' THEN 2<br/>                        WHEN 'few hours a day' THEN 4<br/>                        WHEN 'most of the day' THEN 5 <br/>                        END as internet<br/>SET p.Internet_vec = internet</span></pre><h2 id="d37c" class="mb kn iq bd ko mj mk dn ks ml mm dp kw jy mn mo la kc mp mq le kg mr ms li mt bi translated">酒精编码</h2><pre class="lt lu lv lw gt lx ls ly lz aw ma bi"><span id="1586" class="mb kn iq ls b gy mc md l me mf">MATCH (p:Person)<br/>WITH p, CASE p['Alcohol'] WHEN 'never' THEN 1<br/>                          WHEN 'social drinker' THEN 3<br/>                          WHEN 'drink a lot' THEN 5<br/>                          ELSE 3 END as alcohol<br/>SET p.Alcohol_vec = alcohol</span></pre><h1 id="31eb" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">降维</h1><p id="8375" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">我们的数据集中有 150 个答案可以用作特征。这是对特征进行一些基本降维的好机会。</p><p id="cbce" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我看到了一篇由<a class="ae kl" href="https://www.analyticsvidhya.com/blog/author/pulkits/" rel="noopener ugc nofollow" target="_blank">普尔基特·夏尔马</a>写的关于<a class="ae kl" href="https://www.analyticsvidhya.com/blog/2018/08/dimensionality-reduction-techniques-python/" rel="noopener ugc nofollow" target="_blank">降维技术</a>的文章。它描述了 12 种降维技术，在本文中，我们将使用前两种，即<strong class="jp ir">低方差滤波器</strong>和<strong class="jp ir">高相关性滤波器</strong>。</p><h1 id="8aa4" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">低方差滤波器</h1><blockquote class="mu mv mw"><p id="569b" class="jn jo mx jp b jq jr js jt ju jv jw jx my jz ka kb mz kd ke kf na kh ki kj kk ij bi translated"><em class="iq">考虑我们数据集中的一个变量，其中所有观察值都相同，比如说 1。如果我们使用这个变量，你认为它能改进我们将要建立的模型吗？答案是否定的，因为这个变量的方差为零。</em></p></blockquote><p id="1fda" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://www.analyticsvidhya.com/blog/2018/08/dimensionality-reduction-techniques-python/" rel="noopener ugc nofollow" target="_blank"> <em class="mx">来源</em> </a></p><p id="a6af" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们将使用标准差度量，它就是方差的平方根。</p><pre class="lt lu lv lw gt lx ls ly lz aw ma bi"><span id="4e7e" class="mb kn iq ls b gy mc md l me mf">MATCH (p:Person)<br/>WITH p LIMIT 1<br/>WITH filter(x in keys(p) where not x in ['Gender','Left - right handed','Lying','Alcohol','Education','Smoking','House - block of flats','Village - town','Punctuality','Internet usage']) as all_keys<br/>UNWIND all_keys as key<br/>MATCH (p:Person)<br/>RETURN key,avg(p[key]) as average,stdev(p[key]) as std <br/>ORDER BY std ASC LIMIT 10</span></pre><p id="32ce" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">结果</p><figure class="lt lu lv lw gt mg"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="2652" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以观察到，每个人都喜欢听音乐，看电影，和朋友一起玩。</p><p id="82e8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">由于方差较低，我们将在进一步分析中排除以下问题:</p><ul class=""><li id="5450" class="nb nc iq jp b jq jr ju jv jy nd kc ne kg nf kk ng nh ni nj bi translated">“个性”</li><li id="6f0b" class="nb nc iq jp b jq nk ju nl jy nm kc nn kg no kk ng nh ni nj bi translated">“音乐”</li><li id="5fad" class="nb nc iq jp b jq nk ju nl jy nm kc nn kg no kk ng nh ni nj bi translated">“梦”</li><li id="6f82" class="nb nc iq jp b jq nk ju nl jy nm kc nn kg no kk ng nh ni nj bi translated">“电影”</li><li id="fd24" class="nb nc iq jp b jq nk ju nl jy nm kc nn kg no kk ng nh ni nj bi translated">“与朋友同乐”</li><li id="8d8d" class="nb nc iq jp b jq nk ju nl jy nm kc nn kg no kk ng nh ni nj bi translated">“喜剧”</li></ul><h1 id="d9f4" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">高相关滤波器</h1><blockquote class="mu mv mw"><p id="be17" class="jn jo mx jp b jq jr js jt ju jv jw jx my jz ka kb mz kd ke kf na kh ki kj kk ij bi translated"><em class="iq">两个变量之间的高度相关性意味着它们具有相似的趋势，并且可能携带相似的信息。这可能会大大降低某些模型的性能(例如，线性和逻辑回归模型)。</em></p></blockquote><p id="b898" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://www.analyticsvidhya.com/blog/2018/08/dimensionality-reduction-techniques-python/" rel="noopener ugc nofollow" target="_blank"> <em class="mx">来源</em> </a></p><p id="4c83" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这项任务中，我们将使用皮尔逊相关系数。Pearson 相关性针对不同的位置和特征比例进行调整，因此任何类型的线性缩放(归一化)都是不必要的。</p><p id="e8a6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">找出性别特征的 10 大相关性。</p><pre class="lt lu lv lw gt lx ls ly lz aw ma bi"><span id="7f82" class="mb kn iq ls b gy mc md l me mf">MATCH (p:Person)<br/>WITH p LIMIT 1<br/>WITH filter(x in keys(p) where not x in ['Gender','Left - right handed','Lying','Alcohol','Education','Smoking','House - block of flats','Village - town','Punctuality','Internet usage','Personality','Music','Dreams','Movies','Fun with friends','Comedy']) as all_keys<br/>MATCH (p1:Person)<br/>UNWIND ['Gender_vec'] as key_1<br/>UNWIND all_keys as key_2<br/>WITH key_1,key_2, collect(coalesce(p1[key_1],0)) as vector_1,collect(coalesce(p1[key_2] ,0)) as vector_2<br/>WHERE key_1 &lt;&gt; key_2<br/>RETURN key_1,key_2, algo.similarity.pearson(vector_1, vector_2) as pearson<br/>ORDER BY pearson DESC limit 10</span></pre><p id="aa1a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">结果</p><figure class="lt lu lv lw gt mg"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="a012" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">与性别最相关的特征是体重，这是有道理的。该列表还包括其他一些刻板的性别差异，如对汽车、行动和个人电脑的偏好。</p><p id="0fd4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在让我们计算所有特征之间的皮尔逊相关。</p><pre class="lt lu lv lw gt lx ls ly lz aw ma bi"><span id="d0c6" class="mb kn iq ls b gy mc md l me mf">MATCH (p:Person)<br/>WITH p LIMIT 1<br/>WITH filter(x in keys(p) where not x in ['Gender','Left - right handed','Lying','Alcohol','Education','Smoking','House - block of flats','Village - town','Punctuality','Internet usage','Personality','Music','Dreams','Movies','Fun with friends','Comedy']) as all_keys<br/>MATCH (p1:Person)<br/>UNWIND all_keys as key_1<br/>UNWIND all_keys as key_2<br/>WITH key_1,key_2,p1<br/>WHERE key_1 &gt; key_2<br/>WITH key_1,key_2, collect(coalesce(p1[key_1],0)) as vector_1,collect(coalesce(p1[key_2],0)) as vector_2<br/>RETURN key_1,key_2, algo.similarity.pearson(vector_1, vector_2) as pearson<br/>ORDER BY pearson DESC limit 10</span></pre><p id="4499" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">结果</p><figure class="lt lu lv lw gt mg"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="0edd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">结果显示没有什么令人惊讶的。我唯一感兴趣的是蛇和老鼠之间的关系。</p><p id="ddec" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">由于高度相关，我们将从进一步分析中排除以下问题:</p><ul class=""><li id="0d8d" class="nb nc iq jp b jq jr ju jv jy nd kc ne kg nf kk ng nh ni nj bi translated">“医学”</li><li id="3352" class="nb nc iq jp b jq nk ju nl jy nm kc nn kg no kk ng nh ni nj bi translated">“化学”</li><li id="2943" class="nb nc iq jp b jq nk ju nl jy nm kc nn kg no kk ng nh ni nj bi translated">“购物中心”</li><li id="0701" class="nb nc iq jp b jq nk ju nl jy nm kc nn kg no kk ng nh ni nj bi translated">“物理学”</li><li id="aac9" class="nb nc iq jp b jq nk ju nl jy nm kc nn kg no kk ng nh ni nj bi translated">“歌剧”</li><li id="7e74" class="nb nc iq jp b jq nk ju nl jy nm kc nn kg no kk ng nh ni nj bi translated">"动画"</li></ul><h1 id="98cf" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">皮尔逊相似算法</h1><p id="49f1" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">既然我们已经完成了预处理步骤，我们将基于我们没有排除的节点的特征(答案)的皮尔逊相关性来推断节点之间的相似性网络。</p><p id="687a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这一步中，我们需要将我们在分析中使用的所有特征在 1 到 5 之间进行归一化，因为现在，我们将在单个向量中拟合节点的所有特征，并计算它们之间的相关性。</p><h1 id="a443" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">最小-最大归一化</h1><p id="5697" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">其中三个特征在一到五之间没有标准化。这些是</p><ul class=""><li id="c3c0" class="nb nc iq jp b jq jr ju jv jy nd kc ne kg nf kk ng nh ni nj bi translated">'高度'</li><li id="7564" class="nb nc iq jp b jq nk ju nl jy nm kc nn kg no kk ng nh ni nj bi translated">"兄弟姐妹的数量"</li><li id="b28c" class="nb nc iq jp b jq nk ju nl jy nm kc nn kg no kk ng nh ni nj bi translated">'重量'</li></ul><p id="3179" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将高度属性正常化到 1 到 5 之间。另外两个我们就不用了。</p><pre class="lt lu lv lw gt lx ls ly lz aw ma bi"><span id="8913" class="mb kn iq ls b gy mc md l me mf">MATCH (p:Person)<br/>//get the the max and min value<br/>WITH max(p.`Height`) as max,min(p.`Height`) as min<br/>MATCH (p1:Person)<br/>//normalize<br/>SET p1.Height_nor = 5.0 *(p1.`Height` - min) / (max - min)</span></pre><h1 id="23a2" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">相似网络</h1><p id="c925" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">我们获取所有特征并推断相似性网络。我们总是希望使用 similarityCutoff 参数和可选的 topK 参数，以防止最终得到一个完整的图，其中所有节点都相互连接。这里我们用<strong class="jp ir"> similarityCutoff: 0.75 </strong>和<strong class="jp ir"> topK: 5 </strong>。在<a class="ae kl" href="https://neo4j.com/docs/graph-algorithms/current/algorithms/similarity-pearson/" rel="noopener ugc nofollow" target="_blank">文档</a>中找到更多信息。</p><pre class="lt lu lv lw gt lx ls ly lz aw ma bi"><span id="29b3" class="mb kn iq ls b gy mc md l me mf">MATCH (p:Person)<br/>WITH p LIMIT 1<br/>WITH filter(x in keys(p) where not x in ['Gender','Left - right handed','Lying','Alcohol','Education','Smoking','House - block of flats','Village - town','Punctuality','Internet usage','Personality','Music','Dreams','Movies','Fun with friends','Comedy','Medicine','Chemistry','Shopping centres','Physics','Opera','Animated','Height','Weight','Number of siblings']) as all_keys<br/>MATCH (p1:Person)<br/>UNWIND all_keys as key<br/>WITH {item:id(p1), weights: collect(coalesce(p1[key],3))} as personData<br/>WITH collect(personData) as data<br/>CALL algo.similarity.pearson(data, {similarityCutoff: 0.75,topK:5,write:true})<br/>YIELD nodes, similarityPairs<br/>RETURN nodes, similarityPairs</span></pre><h2 id="d320" class="mb kn iq bd ko mj mk dn ks ml mm dp kw jy mn mo la kc mp mq le kg mr ms li mt bi translated">结果</h2><ul class=""><li id="997d" class="nb nc iq jp b jq lk ju ll jy np kc nq kg nr kk ng nh ni nj bi translated">节点:1010</li><li id="6805" class="nb nc iq jp b jq nk ju nl jy nm kc nn kg no kk ng nh ni nj bi translated">相似性比例:4254</li></ul><h1 id="946f" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">社区检测</h1><p id="0bea" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">既然我们已经在我们的图中推断出了一个相似性网络，我们将尝试在<a class="ae kl" href="https://neo4j.com/docs/graph-algorithms/current/algorithms/louvain/" rel="noopener ugc nofollow" target="_blank">卢万算法</a>的帮助下找到相似人的社区。</p><pre class="lt lu lv lw gt lx ls ly lz aw ma bi"><span id="ba04" class="mb kn iq ls b gy mc md l me mf">CALL algo.louvain('Person','SIMILAR')<br/>YIELD nodes,communityCount</span></pre><p id="7c5e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">结果</p><ul class=""><li id="2aab" class="nb nc iq jp b jq jr ju jv jy nd kc ne kg nf kk ng nh ni nj bi translated">节点:1010</li><li id="6313" class="nb nc iq jp b jq nk ju nl jy nm kc nn kg no kk ng nh ni nj bi translated">社区人数:105 人</li></ul><h1 id="7e89" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">Apoc.group.nodes</h1><p id="d419" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">为了快速浏览 Neo4j 浏览器中的社区检测结果，我们可以使用<strong class="jp ir"> apoc.group.nodes </strong>。我们定义想要包含的标签，并根据某个属性进行分组。在配置部分，我们定义我们想要执行的聚合，并在可视化中返回。在<a class="ae kl" href="https://neo4j-contrib.github.io/neo4j-apoc-procedures/#_node_grouping" rel="noopener ugc nofollow" target="_blank">文档</a>中找到更多信息。</p><pre class="lt lu lv lw gt lx ls ly lz aw ma bi"><span id="7659" class="mb kn iq ls b gy mc md l me mf">CALL apoc.nodes.group(['Person'],['community'], <br/>[{`*`:'count', Age:['avg','std'],Alcohol_vec:['avg']}, {`*`:'count'} ])<br/>YIELD nodes, relationships<br/>UNWIND nodes as node <br/>UNWIND relationships as rel<br/>RETURN node, rel;</span></pre><p id="903f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">结果</p><figure class="lt lu lv lw gt mg gh gi paragraph-image"><div role="button" tabindex="0" class="nt nu di nv bf nw"><div class="gh gi ns"><img src="../Images/dee8a79719e3333dac8c692c141f2144.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*JKqtH-BNHhcY760tN5zNXA.gif"/></div></div></figure><h1 id="3b12" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">社区偏好</h1><p id="ab05" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">为了更好地了解我们的社区，我们将检查他们的平均前 3 名和后 3 名偏好。</p><pre class="lt lu lv lw gt lx ls ly lz aw ma bi"><span id="8c65" class="mb kn iq ls b gy mc md l me mf">MATCH (p:Person)<br/>WITH p LIMIT 1<br/>WITH filter(x in keys(p) where not x in ['Gender','Left - right handed','Lying','Alcohol','Education','Smoking','House - block of flats','Village - town','Punctuality','Internet usage','Personality','Music','Dreams','Movies','Fun with friends','Height','Number of siblings','Weight','Medicine', 'Chemistry', 'Shopping centres', 'Physics', 'Opera','Age','community','Comedy','Gender_vec','Internet','Height_nor']) as all_keys<br/>MATCH (p1:Person)<br/>UNWIND all_keys as key<br/>WITH p1.community as community,<br/>     count(*) as size,<br/>     SUM(CASE WHEN p1.Gender = 'male' THEN 1 ELSE 0 END) as males,<br/>     key,<br/>     avg(p1[key]) as average,<br/>     stdev(p1[key]) as std<br/>ORDER BY average DESC<br/>WITH community,<br/>     size,<br/>     toFloat(males) / size as male_percentage,<br/>     collect(key) as all_avg<br/>ORDER BY size DESC limit 10<br/>RETURN community,size,male_percentage, <br/>       all_avg[..3] as top_3,<br/>       all_avg[-3..] as bottom_3</span></pre><p id="0cbd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">结果</p><figure class="lt lu lv lw gt mg"><div class="bz fp l di"><div class="mh mi l"/></div></figure><p id="49b4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">结果相当有趣。仅从男性比例来看，可以肯定地说，这些社区几乎都是基于性别的。</p><p id="ec6e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最大的群体是 220 名女士，她们强烈赞同“对动物的同情”、“浪漫”和有趣的“借来的东西”，但不同意“金属”、“西方”和“写作”。第二大群体，大部分是男性，同意“学校作弊”，“行动”和“个人电脑”。他们也不同意“写作”。有道理，因为调查是由来自斯洛伐克的学生填写的。</p><h1 id="edf8" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">Gephi 可视化</h1><p id="ea68" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">让我们以<a class="ae kl" href="https://gephi.org/" rel="noopener ugc nofollow" target="_blank"> Gephi </a>中我们的社区的一个很好的可视化来结束。您需要在 Gephi 中启用流插件，然后我们可以使用<a class="ae kl" href="https://neo4j-contrib.github.io/neo4j-apoc-procedures/" rel="noopener ugc nofollow" target="_blank"> APOC </a>过程<strong class="jp ir"> apoc.gephi.add </strong>从 Neo4j 中导出图形。</p><pre class="lt lu lv lw gt lx ls ly lz aw ma bi"><span id="c4f1" class="mb kn iq ls b gy mc md l me mf">MATCH path = (:Person)-[:SIMILAR]-&gt;(:Person)<br/>CALL apoc.gephi.add(null,'workspace1',path,'weight',['community']) yield nodes<br/>return distinct 'done'</span></pre><p id="293f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在 Gephi 中做了一点调整后，我想出了这个可视化。与 apoc.group.nodes 可视化类似，我们可以观察到，最大的社区彼此之间联系紧密。</p><figure class="lt lu lv lw gt mg gh gi paragraph-image"><div role="button" tabindex="0" class="nt nu di nv bf nw"><div class="gh gi nz"><img src="../Images/8fde002b057e8118d1a041bf5383480f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PQXl6hjaDJZnnfKFWt5X-g.png"/></div></div></figure><p id="b4bf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">马克·尼达姆和艾米·e·霍德勒合著的《图形算法:Apache Spark 和 Neo4j 中的实际例子》现在就注册吧。</p><figure class="lt lu lv lw gt mg gh gi paragraph-image"><a href="https://neo4j.com/graph-algorithms-book/?utm_source=tbgraph"><div class="gh gi oa"><img src="../Images/1e2b8e07327dd76b49874c24a8ca2d6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*FaMy0XypPFe9Z_vw.png"/></div></a></figure></div></div>    
</body>
</html>