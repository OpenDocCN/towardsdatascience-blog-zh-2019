<html>
<head>
<title>Supervised Machine Learning: Model Validation, a Step by Step Approach</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">监督机器学习:模型验证，一步一步的方法</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/supervised-machine-learning-model-validation-a-step-by-step-approach-771109ae0253?source=collection_archive---------3-----------------------#2019-02-07">https://towardsdatascience.com/supervised-machine-learning-model-validation-a-step-by-step-approach-771109ae0253?source=collection_archive---------3-----------------------#2019-02-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="52f5" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">模型验证是在测试数据集上评估已训练模型的过程。这提供了训练模型的泛化能力。在这里，我提供了一个逐步的方法来在几分钟内完成模型验证的第一次迭代。</h2></div><blockquote class="kf kg kh"><p id="2213" class="ki kj kk kl b km kn jr ko kp kq ju kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">应用监督机器学习模型的基本方法是:</p><p id="5f65" class="ki kj kk kl b km kn jr ko kp kq ju kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">选择一类模型</p><p id="2692" class="ki kj kk kl b km kn jr ko kp kq ju kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">选择模型超参数</p><p id="1f95" class="ki kj kk kl b km kn jr ko kp kq ju kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">使模型符合训练数据</p><p id="a935" class="ki kj kk kl b km kn jr ko kp kq ju kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">使用模型预测新数据的标签</p><p id="38fe" class="ki kj kk kl b km kn jr ko kp kq ju kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">摘自<strong class="kl ir">杰克·范德普拉斯</strong>撰写的<a class="ae lf" href="http://shop.oreilly.com/product/0636920034919.do" rel="noopener ugc nofollow" target="_blank"> Python 数据科学手册</a></p></blockquote><p id="2c7b" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lg kt ku kv lh kx ky kz li lb lc ld le ij bi translated">Jake VanderPlas 用四个简单明了的步骤给出了模型验证的过程。在我们开始他的第一步之前，还需要一个完整的过程。比如从数据中获取我们需要的所有信息，以便对选择类模型做出良好的判断。还提供收尾工作，以确认之后的结果。我将深入讨论这些步骤，并进一步分解。</p><ul class=""><li id="669c" class="lj lk iq kl b km kn kp kq lg ll lh lm li ln le lo lp lq lr bi translated">数据清理和争论。</li><li id="e4db" class="lj lk iq kl b km ls kp lt lg lu lh lv li lw le lo lp lq lr bi translated">将数据分为训练数据集和测试数据集。</li><li id="1727" class="lj lk iq kl b km ls kp lt lg lu lh lv li lw le lo lp lq lr bi translated">定义模型优化的指标。</li><li id="dd24" class="lj lk iq kl b km ls kp lt lg lu lh lv li lw le lo lp lq lr bi translated">快速获得初始指标评估。</li><li id="e098" class="lj lk iq kl b km ls kp lt lg lu lh lv li lw le lo lp lq lr bi translated">优化指标的特征工程。(<em class="kk">第一遍跳过这个)。</em></li><li id="66f0" class="lj lk iq kl b km ls kp lt lg lu lh lv li lw le lo lp lq lr bi translated">数据预处理。</li><li id="6f68" class="lj lk iq kl b km ls kp lt lg lu lh lv li lw le lo lp lq lr bi translated">特征选择。</li><li id="25ad" class="lj lk iq kl b km ls kp lt lg lu lh lv li lw le lo lp lq lr bi translated">型号选择。</li><li id="e1fc" class="lj lk iq kl b km ls kp lt lg lu lh lv li lw le lo lp lq lr bi translated">模型验证。</li><li id="7d95" class="lj lk iq kl b km ls kp lt lg lu lh lv li lw le lo lp lq lr bi translated">解读结果。</li><li id="8b01" class="lj lk iq kl b km ls kp lt lg lu lh lv li lw le lo lp lq lr bi translated">获得最佳模型，并对照测试数据集进行检查。</li></ul><p id="0afd" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lg kt ku kv lh kx ky kz li lb lc ld le ij bi translated">我将使用来自<strong class="kl ir"> UCI 机器学习库</strong>的数据集。数据集来自台湾新竹市的<a class="ae lf" href="https://archive.ics.uci.edu/ml/datasets/Blood+Transfusion+Service+Center" rel="noopener ugc nofollow" target="_blank"> <em class="kk">输血服务中心</em> </a>。这是一个分类问题。这背后的思想也延伸到回归问题。</p><h2 id="8d54" class="lx ly iq bd lz ma mb dn mc md me dp mf lg mg mh mi lh mj mk ml li mm mn mo mp bi translated">数据清理和争论。</h2><p id="0dd7" class="pw-post-body-paragraph ki kj iq kl b km mq jr ko kp mr ju kr lg ms ku kv lh mt ky kz li mu lc ld le ij bi translated">输血服务中心数据集是一个干净的数据集。对于大多数其他数据集来说，情况并非如此。因此，这是检查和清理数据的步骤，例如处理丢失的值…</p><figure class="mv mw mx my gt mz"><div class="bz fp l di"><div class="na nb l"/></div></figure><h2 id="a21e" class="lx ly iq bd lz ma mb dn mc md me dp mf lg mg mh mi lh mj mk ml li mm mn mo mp bi translated">将数据分为训练数据集和测试数据集。</h2><p id="c8e0" class="pw-post-body-paragraph ki kj iq kl b km mq jr ko kp mr ju kr lg ms ku kv lh mt ky kz li mu lc ld le ij bi translated">有许多方法可以获得用于模型验证的训练和测试数据集，例如:</p><ul class=""><li id="f1f5" class="lj lk iq kl b km kn kp kq lg ll lh lm li ln le lo lp lq lr bi translated">获取训练、验证和测试数据集的三向保持方法。</li><li id="edc0" class="lj lk iq kl b km ls kp lt lg lu lh lv li lw le lo lp lq lr bi translated">独立测试数据集的 k 重交叉验证。</li><li id="a11a" class="lj lk iq kl b km ls kp lt lg lu lh lv li lw le lo lp lq lr bi translated">独立测试数据集的留一交叉验证。</li></ul><p id="48f6" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lg kt ku kv lh kx ky kz li lb lc ld le ij bi translated"><strong class="kl ir">塞巴斯蒂安·拉什卡的</strong> <a class="ae lf" href="https://sebastianraschka.com/blog/2018/model-evaluation-selection-part4.html" rel="noopener ugc nofollow" target="_blank"> <em class="kk">博客</em> </a>对于确定这一点有很好的借鉴作用。</p><figure class="mv mw mx my gt mz gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nc"><img src="../Images/26af5b5ab2f688b62170d5bac2701f2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DTAwbphxm4HooF6NNu0JVQ.jpeg"/></div></div></figure><p id="dce1" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lg kt ku kv lh kx ky kz li lb lc ld le ij bi translated">我将利用独立测试数据集进行<strong class="kl ir">五重交叉验证。所以把数据分成训练和测试数据集。</strong></p><figure class="mv mw mx my gt mz"><div class="bz fp l di"><div class="na nb l"/></div></figure><h2 id="bbc6" class="lx ly iq bd lz ma mb dn mc md me dp mf lg mg mh mi lh mj mk ml li mm mn mo mp bi translated">定义模型优化的指标。</h2><p id="92c5" class="pw-post-body-paragraph ki kj iq kl b km mq jr ko kp mr ju kr lg ms ku kv lh mt ky kz li mu lc ld le ij bi translated">分类和回归问题中使用的度量标准各不相同。分类问题使用准确性、精确度和召回率等指标...回归问题使用平均绝对误差、R2 分数等指标...</p><p id="7175" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lg kt ku kv lh kx ky kz li lb lc ld le ij bi translated"><a class="ae lf" href="https://scikit-learn.org/stable/modules/classes.html#classification-metrics" rel="noopener ugc nofollow" target="_blank"><em class="kk">scikit 中的分类指标——学习</em> </a></p><p id="2b15" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lg kt ku kv lh kx ky kz li lb lc ld le ij bi translated"><a class="ae lf" href="https://scikit-learn.org/stable/modules/classes.html#regression-metrics" rel="noopener ugc nofollow" target="_blank">sci kit 中的<em class="kk">回归指标-学习</em>T7】</a></p><p id="9c3e" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lg kt ku kv lh kx ky kz li lb lc ld le ij bi translated">既然这是一个分类问题，我这里就用<strong class="kl ir">准确率评分</strong>。</p><h2 id="28cc" class="lx ly iq bd lz ma mb dn mc md me dp mf lg mg mh mi lh mj mk ml li mm mn mo mp bi translated">快速获得初始指标评估。</h2><p id="ef78" class="pw-post-body-paragraph ki kj iq kl b km mq jr ko kp mr ju kr lg ms ku kv lh mt ky kz li mu lc ld le ij bi translated">这个步骤背后的主要思想是获得正在优化的度量的基线估计。该基线将作为模型验证的进一步步骤的参考。有几种方法可以得到分类问题的基线估计。我使用多数类进行预测。基线准确度分数约为<strong class="kl ir"> 77% </strong>。</p><figure class="mv mw mx my gt mz"><div class="bz fp l di"><div class="na nb l"/></div></figure><h2 id="aa7d" class="lx ly iq bd lz ma mb dn mc md me dp mf lg mg mh mi lh mj mk ml li mm mn mo mp bi translated">优化指标的特征工程。</h2><blockquote class="kf kg kh"><p id="df24" class="ki kj kk kl b km kn jr ko kp kq ju kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">特征工程是使用数据的领域知识来创建使机器学习算法工作的特征的过程。特征工程是机器学习应用的基础，既困难又昂贵。</p><p id="4dd0" class="ki kj kk kl b km kn jr ko kp kq ju kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">来自<a class="ae lf" href="https://en.wikipedia.org/wiki/Feature_engineering" rel="noopener ugc nofollow" target="_blank">维基百科</a></p></blockquote><p id="0465" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lg kt ku kv lh kx ky kz li lb lc ld le ij bi translated">这意味着识别独立特征和从属特征之间的关系。这是借助于图表，如对图或相关矩阵。然后，我们可以将识别的关系添加为多项式或交互特征。</p><blockquote class="kf kg kh"><p id="b16e" class="ki kj kk kl b km kn jr ko kp kq ju kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">特征工程步骤是连续迭代的入口点。这是一个关键步骤，与模型验证相比，它在预测中起着更大的作用。</p></blockquote><p id="0873" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lg kt ku kv lh kx ky kz li lb lc ld le ij bi translated">作为快速解决方案，我们可以使用 sci-kit learn  中的<a class="ae lf" href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.PolynomialFeatures.html#sklearn-preprocessing-polynomialfeatures" rel="noopener ugc nofollow" target="_blank"> <em class="kk">多项式特性添加一些多项式特性。</em></a></p><p id="d59d" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lg kt ku kv lh kx ky kz li lb lc ld le ij bi translated">手头问题的领域知识将对特征工程有很大的用处。这本身就是一个更大的主题，需要投入大量的时间和资源。</p><h2 id="c172" class="lx ly iq bd lz ma mb dn mc md me dp mf lg mg mh mi lh mj mk ml li mm mn mo mp bi translated">数据预处理。</h2><p id="5e65" class="pw-post-body-paragraph ki kj iq kl b km mq jr ko kp mr ju kr lg ms ku kv lh mt ky kz li mu lc ld le ij bi translated">数据预处理将特征转换成更适合评估者的格式。一般来说，机器学习模型更喜欢数据集的标准化。在我们的例子中，我将使用<strong class="kl ir">鲁棒定标器</strong>。</p><p id="89d2" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lg kt ku kv lh kx ky kz li lb lc ld le ij bi translated">详细信息请参考 sci-kit learn 的<a class="ae lf" href="https://scikit-learn.org/stable/modules/preprocessing.html#preprocessing-data" rel="noopener ugc nofollow" target="_blank"> <em class="kk">预处理数据</em> </a>部分。</p><h2 id="64c5" class="lx ly iq bd lz ma mb dn mc md me dp mf lg mg mh mi lh mj mk ml li mm mn mo mp bi translated">特征选择。</h2><p id="b063" class="pw-post-body-paragraph ki kj iq kl b km mq jr ko kp mr ju kr lg ms ku kv lh mt ky kz li mu lc ld le ij bi translated">数据集的特征选择或维度缩减有助于</p><ul class=""><li id="c36b" class="lj lk iq kl b km kn kp kq lg ll lh lm li ln le lo lp lq lr bi translated">要么提高模型的准确度</li></ul><p id="3f9b" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lg kt ku kv lh kx ky kz li lb lc ld le ij bi translated">或者</p><ul class=""><li id="d699" class="lj lk iq kl b km kn kp kq lg ll lh lm li ln le lo lp lq lr bi translated">来提高它们在高维数据集上的性能。</li></ul><p id="c8b7" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lg kt ku kv lh kx ky kz li lb lc ld le ij bi translated">我会用<strong class="kl ir"> SelectKBest </strong>，单变量特征选择法。用于分类和回归问题的评分函数会有所不同。</p><p id="bc3b" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lg kt ku kv lh kx ky kz li lb lc ld le ij bi translated">详细信息请参考 sci-kit learn 的<a class="ae lf" href="https://scikit-learn.org/stable/modules/feature_selection.html#feature-selection" rel="noopener ugc nofollow" target="_blank"> <em class="kk">功能选择</em> </a>章节。</p><h2 id="4ac5" class="lx ly iq bd lz ma mb dn mc md me dp mf lg mg mh mi lh mj mk ml li mm mn mo mp bi translated">型号选择。</h2><p id="a76b" class="pw-post-body-paragraph ki kj iq kl b km mq jr ko kp mr ju kr lg ms ku kv lh mt ky kz li mu lc ld le ij bi translated">由于我们正在处理分类问题，我将使用<strong class="kl ir">逻辑回归</strong>模型。对于回归问题，我们可以使用<strong class="kl ir">线性回归</strong>或<strong class="kl ir">岭</strong>模型。模型的选择取决于手头的问题。根据数据的复杂性，我们可以使用简单的线性模型或高级模型。</p><p id="9141" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lg kt ku kv lh kx ky kz li lb lc ld le ij bi translated">有关详细信息，请参考 sci-kit learn 的<a class="ae lf" href="https://scikit-learn.org/stable/modules/classes.html#module-sklearn.linear_model" rel="noopener ugc nofollow" target="_blank"> <em class="kk">广义线性模型</em> </a>部分。</p><p id="1dd3" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lg kt ku kv lh kx ky kz li lb lc ld le ij bi translated">使用 sci-kit learn 的<a class="ae lf" href="https://scikit-learn.org/stable/modules/classes.html#module-sklearn.pipeline" rel="noopener ugc nofollow" target="_blank"> <em class="kk">管道</em> </a>，有一种优雅的方式可以将以上三个步骤结合起来。<strong class="kl ir">流水线</strong>在最终模型之前应用一系列转换。</p><figure class="mv mw mx my gt mz"><div class="bz fp l di"><div class="na nb l"/></div></figure><h2 id="2a32" class="lx ly iq bd lz ma mb dn mc md me dp mf lg mg mh mi lh mj mk ml li mm mn mo mp bi translated">模型验证。</h2><p id="817d" class="pw-post-body-paragraph ki kj iq kl b km mq jr ko kp mr ju kr lg ms ku kv lh mt ky kz li mu lc ld le ij bi translated">超参数是模型本身不知道的参数。超参数作为参数传递给管道中步骤的构造函数。基于交叉验证分数，可以获取最佳的可能参数。</p><p id="d740" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lg kt ku kv lh kx ky kz li lb lc ld le ij bi translated">对于超参数调整<strong class="kl ir">，GridSearchCV </strong>是选项之一。它对模型的指定参数值执行穷举搜索。这里，我们使用<strong class="kl ir"> param_grid </strong>将超参数传递给管道中的步骤。<strong class="kl ir"> cv </strong>设置为<strong class="kl ir"> 5 </strong>，因为我们要进行 5 重交叉验证。<strong class="kl ir">评分</strong>被设置为<strong class="kl ir">准确度</strong>，因为我们想要预测模型的准确度。</p><p id="4a25" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lg kt ku kv lh kx ky kz li lb lc ld le ij bi translated">有关详细信息，请参考 sci-kit learn 的<a class="ae lf" href="https://scikit-learn.org/stable/modules/grid_search.html#tuning-the-hyper-parameters-of-an-estimator" rel="noopener ugc nofollow" target="_blank"> <em class="kk">调整估计器的超参数</em> </a> <strong class="kl ir"> </strong>部分。</p><figure class="mv mw mx my gt mz"><div class="bz fp l di"><div class="na nb l"/></div></figure><h2 id="a04c" class="lx ly iq bd lz ma mb dn mc md me dp mf lg mg mh mi lh mj mk ml li mm mn mo mp bi translated">解读结果。</h2><p id="2fa8" class="pw-post-body-paragraph ki kj iq kl b km mq jr ko kp mr ju kr lg ms ku kv lh mt ky kz li mu lc ld le ij bi translated">GridSearchCV 返回一些重要信息，如:</p><ul class=""><li id="8d55" class="lj lk iq kl b km kn kp kq lg ll lh lm li ln le lo lp lq lr bi translated"><strong class="kl ir"> best_estimator_ </strong>，给出最高分的评估者。利用这一点，我们可以获得关于所选特征的信息。</li><li id="c496" class="lj lk iq kl b km ls kp lt lg lu lh lv li lw le lo lp lq lr bi translated"><strong class="kl ir"> best_score_，</strong>表示 best_estimator 的交叉验证分数。对于我们的问题集，我们在第一次迭代中得到了最好的分数<strong class="kl ir"> 78% </strong>。这看起来不多，但我们已经打破了我们的基线准确性得分。</li><li id="edc9" class="lj lk iq kl b km ls kp lt lg lu lh lv li lw le lo lp lq lr bi translated"><strong class="kl ir"> best_params_ </strong>，给出保持数据最佳结果的参数设置。对于传递给模型的超参数，以下设置给出了最佳结果。</li></ul><ol class=""><li id="130a" class="lj lk iq kl b km kn kp kq lg ll lh lm li ln le nj lp lq lr bi translated">逻辑回归 __C': 1.0</li><li id="0fd3" class="lj lk iq kl b km ls kp lt lg lu lh lv li lw le nj lp lq lr bi translated">' logistic regression _ _ class _ weight ':无</li><li id="b789" class="lj lk iq kl b km ls kp lt lg lu lh lv li lw le nj lp lq lr bi translated">selectkbest__k': 4</li></ol><figure class="mv mw mx my gt mz"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="e900" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lg kt ku kv lh kx ky kz li lb lc ld le ij bi translated">这就结束了模型验证的第一次迭代。现在，我们可以返回并重复从特征工程步骤开始的过程。在每次迭代结束时，我们可以检查准确性分数的变化。重复该过程，直到达到期望的准确度分数或选择的度量。</p><h2 id="73f4" class="lx ly iq bd lz ma mb dn mc md me dp mf lg mg mh mi lh mj mk ml li mm mn mo mp bi translated">获得最佳模型，并对照测试数据集进行检查。</h2><p id="c732" class="pw-post-body-paragraph ki kj iq kl b km mq jr ko kp mr ju kr lg ms ku kv lh mt ky kz li mu lc ld le ij bi translated">选择最终模型后，使用测试数据集检查其性能。在这里，我们在测试数据集上获得了 75%的准确率分数。</p><figure class="mv mw mx my gt mz"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="ae95" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lg kt ku kv lh kx ky kz li lb lc ld le ij bi translated">注意这个博客是为了提供一个关于监督机器学习模型验证的快速介绍。这里的想法是不要在第一次迭代中获得最佳的度量分数。使用这种方法来设置基线指标得分。提高我们每次迭代的模型验证分数。</p><p id="ef2e" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lg kt ku kv lh kx ky kz li lb lc ld le ij bi translated">在此 获取完整笔记本<a class="ae lf" href="https://github.com/ShreyasJothish/blognotebooks/blob/master/model_validation.ipynb" rel="noopener ugc nofollow" target="_blank"> <em class="kk">。</em></a></p><p id="9aca" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lg kt ku kv lh kx ky kz li lb lc ld le ij bi translated">你可能会觉得我的其他博客很有趣。一定要去看看。</p><p id="53ea" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lg kt ku kv lh kx ky kz li lb lc ld le ij bi translated"><a class="ae lf" rel="noopener" target="_blank" href="/analyse-retweet-ratio-to-determine-social-influence-d83bda0559d"> <em class="kk">分析转发率，确定社会影响力。</em>T15】</a></p><p id="881c" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr lg kt ku kv lh kx ky kz li lb lc ld le ij bi translated"><a class="ae lf" rel="noopener" target="_blank" href="/why-are-we-letting-trumps-tweet-affect-our-mood-7f9baafae3a7"> <em class="kk">为什么我们要让特朗普的推文影响我们的心情？</em>T19】</a></p></div></div>    
</body>
</html>