<html>
<head>
<title>Creating a Smart Scale with TensorFlow</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 TensorFlow 创建智能秤</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/creating-a-smart-scale-with-tensorflow-cf62a834b670?source=collection_archive---------30-----------------------#2019-02-11">https://towardsdatascience.com/creating-a-smart-scale-with-tensorflow-cf62a834b670?source=collection_archive---------30-----------------------#2019-02-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="6004" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">想要尝试机器学习，同时构建一些有用的东西吗？这里有一个有趣的周末项目，使用 TensorFlow 从你的体重秤图片中自动读取你的体重，并绘制出一段时间的图表。您将学习到<a class="ae ko" href="https://github.com/tensorflow/models/tree/master/research/object_detection" rel="noopener ugc nofollow" target="_blank"> TensorFlow 对象检测 API </a>的基础知识，并能够将其应用于这个和其他图像分析项目。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi kp"><img src="../Images/26aa95f8c773ae950c6b7030dd8633b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-HUhdB0GNqS6HR6eNUerVw.png"/></div></div><figcaption class="lb lc gj gh gi ld le bd b be z dk">Weight over time as automatically detected using TensorFlow from analyzing pictures (the line is more jagged on the right side because there are more data points)</figcaption></figure><p id="fc4a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这篇文章故意写得很短，这样你可以很快得到一个很好的概述，同时提供包含更多细节的其他材料的链接。就这样，让我们开始吧！</p><h1 id="c100" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">获取您的秤的图像</h1><p id="5daa" class="pw-post-body-paragraph jq jr it js b jt md jv jw jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn im bi translated">首先，与任何机器学习项目一样，数据是关键。每次你站在你的体重秤上，拍一张清楚显示你体重的照片。为了获得最佳效果，可以在不同的光线条件下拍照，也可以在房子的不同区域拍照。100 张图片应该可以作为一个相当好的训练集。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi mi"><img src="../Images/486e38a66bfad75ae73008fb7b582527.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-wWhENai323NCrTqA4VlIA.png"/></div></div></figure><p id="79a1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你的照片被备份到 Google 相册，那么你可以使用一个脚本，比如<a class="ae ko" href="https://github.com/xiaowen/weightcheck/blob/master/scale/dlphotos.py" rel="noopener ugc nofollow" target="_blank">这个</a>来下载它们。</p><h1 id="ed67" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">标记您的图像</h1><p id="9c84" class="pw-post-body-paragraph jq jr it js b jt md jv jw jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn im bi translated">接下来，用一个工具给你的图片加标签，比如<a class="ae ko" href="https://github.com/tzutalin/labelImg" rel="noopener ugc nofollow" target="_blank"> labelImg </a>。他们的 docker 映像很容易设置，只需几个简单的命令<a class="ae ko" href="https://github.com/xiaowen/weightcheck/blob/master/labelImg.sh" rel="noopener ugc nofollow" target="_blank">就可以使用。我在整个刻度周围添加了一个名为“刻度”的标签，在圆形显示屏周围添加了另一个名为“读数”的标签。labelImg 将创建 XML 文件，每个图像一个，看起来像</a><a class="ae ko" href="https://gist.github.com/xiaowen/6d9bcfa802668d6b0daf0d83d33eb6d6" rel="noopener ugc nofollow" target="_blank">这个</a>。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/38732f25eccd14c277e3e69aec3aae5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1160/format:webp/1*RHx0KkSGSv3p4VwVN6KPaQ.png"/></div><figcaption class="lb lc gj gh gi ld le bd b be z dk">Image of a scale with bounding boxes drawn around the scale and also around the display</figcaption></figure><h1 id="b064" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">训练一个神经网络来检测你的秤</h1><p id="005e" class="pw-post-body-paragraph jq jr it js b jt md jv jw jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn im bi translated">一旦你有了数据，你就可以训练神经网络来检测你的图像的比例。概括地说，步骤如下:</p><ol class=""><li id="464f" class="mk ml it js b jt ju jx jy kb mm kf mn kj mo kn mp mq mr ms bi translated"><a class="ae ko" href="https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/installation.md" rel="noopener ugc nofollow" target="_blank">安装</a>tensor flow 对象检测 API</li><li id="50d1" class="mk ml it js b jt mt jx mu kb mv kf mw kj mx kn mp mq mr ms bi translated"><a class="ae ko" href="https://cloud.google.com/sdk/install" rel="noopener ugc nofollow" target="_blank">安装</a>用于向<a class="ae ko" href="https://cloud.google.com/ml-engine/" rel="noopener ugc nofollow" target="_blank">谷歌云机器学习(ML)引擎</a>提交作业的<code class="fe my mz na nb b">gcloud</code>命令行工具。</li><li id="0373" class="mk ml it js b jt mt jx mu kb mv kf mw kj mx kn mp mq mr ms bi translated"><a class="ae ko" href="https://cloud.google.com/storage/docs/creating-buckets" rel="noopener ugc nofollow" target="_blank">创建</a>一个谷歌云平台存储桶。您的训练数据将存储在这里。</li><li id="1f0a" class="mk ml it js b jt mt jx mu kb mv kf mw kj mx kn mp mq mr ms bi translated">上传预先训练的模型，开始你的训练。TensorFlow 为<a class="ae ko" href="https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/detection_model_zoo.md" rel="noopener ugc nofollow" target="_blank">模型动物园</a>提供了一些常见的模型。<code class="fe my mz na nb b">ssd_mobilenet_v1_coco</code>是一个流行的选择，它在简单模型的速度和准确性之间取得了良好的平衡。</li><li id="0b7b" class="mk ml it js b jt mt jx mu kb mv kf mw kj mx kn mp mq mr ms bi translated"><a class="ae ko" href="https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/preparing_inputs.md" rel="noopener ugc nofollow" target="_blank">准备</a>您的自定义输入数据并上传到您的云存储桶。</li><li id="4d83" class="mk ml it js b jt mt jx mu kb mv kf mw kj mx kn mp mq mr ms bi translated">将张量流对象检测源代码捆绑到 ML 引擎上运行。</li><li id="035a" class="mk ml it js b jt mt jx mu kb mv kf mw kj mx kn mp mq mr ms bi translated"><a class="ae ko" href="https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/configuring_jobs.md" rel="noopener ugc nofollow" target="_blank">更新</a>物体检测配置文件。你可以通过最小的改变来重用<a class="ae ko" href="https://github.com/xiaowen/weightcheck/blob/master/scale/objdetect.config" rel="noopener ugc nofollow" target="_blank">矿</a>。</li><li id="cba6" class="mk ml it js b jt mt jx mu kb mv kf mw kj mx kn mp mq mr ms bi translated"><a class="ae ko" href="https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/running_on_cloud.md" rel="noopener ugc nofollow" target="_blank">向 ML 引擎提交</a>培训作业。请注意，ML 引擎需要几分钟时间来启动作业。</li><li id="f0a5" class="mk ml it js b jt mt jx mu kb mv kf mw kj mx kn mp mq mr ms bi translated">当您的训练作业运行时，它每十分钟将其状态写入您的存储桶。您可以使用<a class="ae ko" href="https://www.tensorflow.org/guide/summaries_and_tensorboard" rel="noopener ugc nofollow" target="_blank"> TensorBoard </a>对其进行监控，并寻找曲线的收敛性。如果在单个 GPU 上运行，这个作业可能需要几个小时才能收敛。</li><li id="6c37" class="mk ml it js b jt mt jx mu kb mv kf mw kj mx kn mp mq mr ms bi translated">当你的模型被充分训练后，下载并<a class="ae ko" href="https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/exporting_models.md" rel="noopener ugc nofollow" target="_blank">导出</a>它。</li><li id="2093" class="mk ml it js b jt mt jx mu kb mv kf mw kj mx kn mp mq mr ms bi translated">使用您导出的模型来执行一些推理。您可以使用 TensorFlow 的演示版<a class="ae ko" href="https://github.com/tensorflow/models/blob/master/research/object_detection/object_detection_tutorial.ipynb" rel="noopener ugc nofollow" target="_blank"> Jupyter 笔记本</a>检查您的结果。</li></ol><p id="1643" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这里<a class="ae ko" href="https://github.com/xiaowen/weightcheck/blob/master/setup.sh" rel="noopener ugc nofollow" target="_blank">记录了我为每个步骤运行的确切命令</a>，包括我为帮助完成任务而编写的脚本，所以请在那里查看详细信息。也可以参考<a class="ae ko" href="https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/running_pets.md" rel="noopener ugc nofollow" target="_blank">官方快速入门指南</a>了解更多。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi nc"><img src="../Images/40916a656136d1c9b35f1972cfea54ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s5xJYBwGE9pibyHy0jqlkA.png"/></div></div><figcaption class="lb lc gj gh gi ld le bd b be z dk">Screenshots of TensorBoard; left: loss curve converging; right: inferred output shown side-by-side with the hand-annotated bounding boxes</figcaption></figure><h1 id="b106" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">训练一个神经网络来读取显示器</h1><p id="7e5d" class="pw-post-body-paragraph jq jr it js b jt md jv jw jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn im bi translated">现在你已经训练了一个神经网络来检测你的体重，下一步是训练一个从体重计上读取你的体重。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi nd"><img src="../Images/2ff3bdbecb65aa4e8b3334bcf76cc23a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cIKl7IePAt_hesFGlsbrEA.png"/></div></div></figure><p id="ce57" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">幸运的是，这个过程几乎和你已经做过的一样。概括地说，步骤如下:</p><ol class=""><li id="c9e4" class="mk ml it js b jt ju jx jy kb mm kf mn kj mo kn mp mq mr ms bi translated">使用该标度的训练模型来自动裁剪出显示器的图像。你可以试试这个任务的<a class="ae ko" href="https://github.com/xiaowen/weightcheck/blob/master/scale2reading.py" rel="noopener ugc nofollow" target="_blank">我的脚本</a>。</li><li id="8d69" class="mk ml it js b jt mt jx mu kb mv kf mw kj mx kn mp mq mr ms bi translated">标记这些图像中的每个数字，以教会神经网络识别它们。我为每个数字(0–9)和“%”使用了一个标签。我的标签图传递给物体检测代码是<a class="ae ko" href="https://github.com/xiaowen/weightcheck/blob/master/reading/labels.pbtxt" rel="noopener ugc nofollow" target="_blank">这里是</a>。</li><li id="36a8" class="mk ml it js b jt mt jx mu kb mv kf mw kj mx kn mp mq mr ms bi translated">使用与上述相同的步骤来训练神经网络识别数字。由于训练数据的差异，使用稍微修改的<a class="ae ko" href="https://github.com/xiaowen/weightcheck/blob/master/reading/pipeline.config" rel="noopener ugc nofollow" target="_blank">物体检测配置文件</a>和<a class="ae ko" href="https://github.com/xiaowen/weightcheck/blob/master/reading/labels.pbtxt" rel="noopener ugc nofollow" target="_blank">标签图</a>。</li></ol><h1 id="8cb5" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">把它放在一起</h1><p id="da35" class="pw-post-body-paragraph jq jr it js b jt md jv jw jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn im bi translated">如果你已经做到了这一步，恭喜你！你已经训练了一个模型来识别你的体重，然后再做一次来读取你的体重。现在，您可以将它放在一起，自动分析您拍摄的所有照片，读取您的体重，并使用简单的 HTML 文件(如<a class="ae ko" href="https://github.com/xiaowen/weightcheck/blob/master/reading/viz.html" rel="noopener ugc nofollow" target="_blank"> this </a>)绘制其随时间变化的趋势。</p><p id="68b2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">精明的读者可能会想，为什么我要运行两次，而不是只训练一个模型来识别比例和数字。原因是我不认为单一模型在我的数据上是有效的。对象检测管道通常用于训练大小为 300x300 或类似大小的图像。它当然可以在更大的图像上训练，但这可能需要更长的时间来收敛。当我的图像大幅缩小时，圆形显示变得不可读。因此，我首先训练一个神经网络来找到圆形显示(我仍然在<a class="ae ko" href="https://github.com/xiaowen/weightcheck/blob/master/scale/pipeline.config" rel="noopener ugc nofollow" target="_blank">我的配置</a>中将训练图像的大小增加到 600x600)。利用这一点，我们可以从图像中自动提取出圆形显示，在我的数据中，它恰巧是大约 300x300，现在可以使用这些提取的图像在其原始分辨率下训练另一个神经网络来识别数字。</p><p id="3bae" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你可能还想知道为什么我不简单地使用现有的 OCR 工具包来读取刻度上的数字。我试了试<a class="ae ko" href="https://en.wikipedia.org/wiki/Tesseract_(software)" rel="noopener ugc nofollow" target="_blank"> Tesseract </a>，但是它不能识别任何文本，即使在一些预处理之后。我预计，最终，在这个数据集上训练的神经网络无论如何都会胜过传统的 OCR 软件。</p><p id="d7ef" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最后，我希望这有助于您了解 TensorFlow 的对象检测，并启发您自己构建一些很酷的项目。请在评论区留下你的想法和反馈。</p><p id="4e78" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">感谢阅读！</p></div></div>    
</body>
</html>