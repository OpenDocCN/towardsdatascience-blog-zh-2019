<html>
<head>
<title>Reading Stock Charts with Convolutional Neural Networks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用卷积神经网络读取股票图表</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/reading-charts-with-convolutional-neural-networks-cbaabdd5f478?source=collection_archive---------8-----------------------#2019-06-03">https://towardsdatascience.com/reading-charts-with-convolutional-neural-networks-cbaabdd5f478?source=collection_archive---------8-----------------------#2019-06-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/a1f95a907d4068c448593e1ea1f10eff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BosZkRsQXQ4boUyHfPgkVQ.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">Source: trendspider.com</figcaption></figure><h1 id="c7e5" class="kf kg it bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">介绍</h1><blockquote class="ld le lf"><p id="7ef3" class="lg lh li lj b lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">"历史不会重演，但它经常会重复。"马克·吐温</p></blockquote><p id="7d92" class="pw-post-body-paragraph lg lh it lj b lk ll lm ln lo lp lq lr mf lt lu lv mg lx ly lz mh mb mc md me im bi translated">在了解了卷积神经网络(CNN)在图像识别方面的强大功能后，我想知道算法是否能比人类图表分析师更好地阅读股票市场图表，人类图表分析师的工作是发现图表模式并从中获利。我们知道<a class="ae mi" href="https://www.eetimes.com/document.asp?doc_id=1325712#" rel="noopener ugc nofollow" target="_blank">CNN 比人类更擅长</a>对 ImageNet 图片进行分类，但是他们能比其他市场参与者更好地阅读和发现模式吗？</p><p id="88ce" class="pw-post-body-paragraph lg lh it lj b lk ll lm ln lo lp lq lr mf lt lu lv mg lx ly lz mh mb mc md me im bi translated">以下是我为适应 CNN 的股票价格预测所做的细微差别和调整。你可以在这里找到我凌乱的 jupyter/colab 笔记本<a class="ae mi" href="https://github.com/neoyipeng2018/cnn" rel="noopener ugc nofollow" target="_blank"/>。</p><h1 id="af0c" class="kf kg it bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">1.选择正确的市场/数据集</h1><p id="eb1b" class="pw-post-body-paragraph lg lh it lj b lk mj lm ln lo mk lq lr mf ml lu lv mg mm ly lz mh mn mc md me im bi translated">我认为合乎逻辑的是，技术分析<a class="ae mi" href="https://mathinvestor.org/2017/09/charts-and-technical-analysis-do-they-work/" rel="noopener ugc nofollow" target="_blank">在量化基金交易的市场中不会起作用</a>——任何从有趣的图表模式或【插入复杂的声音术语】中可能获得的收益都已经被任何体面的量化者榨干了，但我很想知道，在量化者由于能力有限而不去的地方，是否仍然存在简单的低效率。因此，我寻找全球顶级交易所之外但仍可进入的市场——华沙证券交易所就是这样一个例子。</p><h1 id="11cf" class="kf kg it bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">2.时间序列的训练-测试分裂的危险</h1><p id="c065" class="pw-post-body-paragraph lg lh it lj b lk mj lm ln lo mk lq lr mf ml lu lv mg mm ly lz mh mn mc md me im bi translated">使用<a class="ae mi" href="https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.train_test_split.html" rel="noopener ugc nofollow" target="_blank">标准 ML 包</a>分割数据集很容易，但必须小心处理时间序列，否则会发生数据泄漏，并产生乐观的样本内结果，而非样本外结果。如果你的随机训练测试分割让你的模型学会如何填补下面的空白，你实际上是在用未来预测过去！</p><figure class="mp mq mr ms gt ju gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/ef83e727cd388a89e0a96926cb93e20d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1234/format:webp/1*OcNBaw8OZu9CWU2WoDX8mA.png"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">Source: <a class="ae mi" href="https://www.fast.ai/2017/11/13/validation-sets/" rel="noopener ugc nofollow" target="_blank">fast.ai</a></figcaption></figure><p id="e9b3" class="pw-post-body-paragraph lg lh it lj b lk ll lm ln lo lp lq lr mf lt lu lv mg lx ly lz mh mb mc md me im bi translated">我遵循了 Rachel Thomas 的<a class="ae mi" href="https://www.fast.ai/2017/11/13/validation-sets/" rel="noopener ugc nofollow" target="_blank">建议</a>，以一种不会让模型预测过去的方式分割数据——关于选择验证集时的其他细微差别，请阅读她的<a class="ae mi" href="https://www.fast.ai/2017/11/13/validation-sets/" rel="noopener ugc nofollow" target="_blank">帖子</a>。</p><h1 id="68cd" class="kf kg it bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated"><strong class="ak"> 3。使用循环图成像时间序列</strong></h1><p id="6ab2" class="pw-post-body-paragraph lg lh it lj b lk mj lm ln lo mk lq lr mf ml lu lv mg mm ly lz mh mn mc md me im bi translated">向 CNN 提供信息的最直接方式是使用标准的价格/交易量图表，如下所示:</p><figure class="mp mq mr ms gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mt"><img src="../Images/8736c8f82e371b1e1789239e16e38fc9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MlBbbDOO8muWgY-BrFXQuw.png"/></div></div></figure><p id="fe34" class="pw-post-body-paragraph lg lh it lj b lk ll lm ln lo lp lq lr mf lt lu lv mg lx ly lz mh mb mc md me im bi translated">然而，由于 CNN 从数据中处理和学习洞察力的方式可能与人类不同，因此以不同的形式表示时间序列可能是有用的。此外，由于图像有 3 个通道，所以可以用不同的度量来包装每个通道，以便为我们的算法提供更多信息。这个有用的<a class="ae mi" href="https://pyts.readthedocs.io/en/latest/auto_examples/index.html#imaging-time-series" rel="noopener ugc nofollow" target="_blank">库</a>有几个函数实现了时间序列的 SOTA 图像表示。</p><p id="29ae" class="pw-post-body-paragraph lg lh it lj b lk ll lm ln lo lp lq lr mf lt lu lv mg lx ly lz mh mb mc md me im bi translated">一种这样的转换是 Gramian Angular Fields (GAFs)，它将时间序列转换到一个“<em class="li">极坐标系统，而不是典型的笛卡尔坐标。</em>【0】。另一种这样的表现是循环图，这种图<em class="li">“显示了重要的和容易解释的关于时间尺度的信息，否则是很难得到的”。</em>【1】<em class="li"/>下面是一些变换后的图表，看起来蛮不一样的吧？你可以在这一页的末尾看到我实验的最终结果。</p><figure class="mp mq mr ms gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mu"><img src="../Images/94ae52db3051fb2ebbfad704c990be82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gjQruOe-3Bu2ijGCJ-YCoQ.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">Recurrence Plot transformations</figcaption></figure><h1 id="89d1" class="kf kg it bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">4.分数微分——平衡内存和稳定性</h1><blockquote class="ld le lf"><p id="a1d7" class="lg lh li lj b lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated">平稳性是 ML 算法的高性能的必要的非充分条件。问题是，在平稳性和记忆性之间有一个权衡。我们总是可以通过微分使一个序列更加平稳，但这将以擦除一些记忆为代价，这将挫败 ML 算法的预测目的。”<strong class="lj iu">马科斯·洛佩斯·德·普拉多【2】</strong></p></blockquote><figure class="mp mq mr ms gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mv"><img src="../Images/09d27aafe777f4cde14486147039d2ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3NWHv7CAUbFwfRTsqTGYZQ.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">Figure 1: Memory vs Time [2]</figcaption></figure><p id="2995" class="pw-post-body-paragraph lg lh it lj b lk ll lm ln lo lp lq lr mf lt lu lv mg lx ly lz mh mb mc md me im bi translated">使用价格系列时的一个标准工程特征是退货系列。Lopez[2]写道，return 系列的问题是丧失记忆。图 1 本质上显示了相对于时间保存的内存。对于返回序列，即“整数 1”微分，在第一个周期后，序列的记忆会失去对过去值的记忆。但是我们可以看到，对于分数微分值，历史值的记忆仍然存在，这有助于预测。</p><p id="40b5" class="pw-post-body-paragraph lg lh it lj b lk ll lm ln lo lp lq lr mf lt lu lv mg lx ly lz mh mb mc md me im bi translated">然后，诀窍是找到一个分数，其中微分小于 1，但仍达到平稳性——一个<a class="ae mi" href="https://www.statsmodels.org/dev/generated/statsmodels.tsa.stattools.adfuller.html" rel="noopener ugc nofollow" target="_blank"> ADF 测试</a>可以检查给定分数是否达到平稳性。</p><h1 id="5452" class="kf kg it bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">5.平移不变性的可选性</h1><p id="2a9b" class="pw-post-body-paragraph lg lh it lj b lk mj lm ln lo mk lq lr mf ml lu lv mg mm ly lz mh mn mc md me im bi translated">CNN 如此擅长对图像进行分类的一个关键原因是<a class="ae mi" href="https://stats.stackexchange.com/questions/208936/what-is-translation-invariance-in-computer-vision-and-convolutional-neural-netwo" rel="noopener ugc nofollow" target="_blank">平移不变性</a>，即输出对输入的微小变化不变。如果你试图对一只不总是在同一个地方的猫进行分类，它仍然可以识别这只猫。</p><figure class="mp mq mr ms gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mw"><img src="../Images/a188fd15435bc121567e96885cff3656.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bo8FgbRFVCd-z-B3EI4uGA.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">Source: What is wrong with Convolutional neural networks</figcaption></figure><p id="88c8" class="pw-post-body-paragraph lg lh it lj b lk ll lm ln lo lp lq lr mf lt lu lv mg lx ly lz mh mb mc md me im bi translated">但是对于时间序列，时间上较早的尖峰与预测时间之前的尖峰具有不同的含义，因此如果平移不变性有用的话，我们可能希望抛弃它——使用<a class="ae mi" href="https://eng.uber.com/coordconv/" rel="noopener ugc nofollow" target="_blank"> Coordconv </a> [3]可以实现这种可选性。一个 Coordconv 层包括 2 层 I 和 j 坐标，让 CNN 知道每个像素的位置。如果算法决定坐标是有用的，权重将反映这一点，因此使用 Coordconv 只有好处！作者发现，将 Coordconv 添加到各种 CNN 任务中几乎总能提高性能。</p><figure class="mp mq mr ms gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mx"><img src="../Images/ffc9187f438b4c0e2688ca1040acb6e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pIEM1jy1IctEsJp8A8ZYrw.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">Source: An intriguing failing of convolutional neural networks and the CoordConv solution [3]</figcaption></figure><h1 id="2269" class="kf kg it bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">结果和进一步的工作</h1><p id="b71c" class="pw-post-body-paragraph lg lh it lj b lk mj lm ln lo mk lq lr mf ml lu lv mg mm ly lz mh mn mc md me im bi translated">我使用 CNN 通过将时间序列数据表示为图像来预测时间序列。CNN 有一个相对简单的二元分类任务——决定第二天的收盘价是否为正。</p><p id="0d8e" class="pw-post-body-paragraph lg lh it lj b lk ll lm ln lo lp lq lr mf lt lu lv mg lx ly lz mh mb mc md me im bi translated">我关注的是精确度，因为我们赌假阳性会赔钱。使用 GAF 成像的分数微分序列(d=0.3)，最好的评分是<strong class="lj iu"> 64 </strong> %。我跑得最好的笔记本是这里的<a class="ae mi" href="https://github.com/neoyipeng2018/cnn/blob/master/WSE_0_3D_Open_Close_Volume_GAF.ipynb" rel="noopener ugc nofollow" target="_blank"/>。</p><figure class="mp mq mr ms gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi my"><img src="../Images/072ca46d5eb700f4cfb846d66173a403.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bNGxEe6frVSBouhwudsdWA.png"/></div></div></figure><p id="e1a5" class="pw-post-body-paragraph lg lh it lj b lk ll lm ln lo lp lq lr mf lt lu lv mg lx ly lz mh mb mc md me im bi translated">接下来，我将着眼于改进 CNN 架构，以更好地捕捉时间关系，即波网！兴奋地去理解和测试它。</p><h1 id="ce32" class="kf kg it bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">特别提及:fast.ai</h1><p id="fe70" class="pw-post-body-paragraph lg lh it lj b lk mj lm ln lo mk lq lr mf ml lu lv mg mm ly lz mh mn mc md me im bi translated">我从我的人工智能硕士那里学到了很多东西，但我也学到了同样多的东西，如果不是从<a class="ae mi" href="https://www.fast.ai/" rel="noopener ugc nofollow" target="_blank"> fast.ai </a>那里学到更多关于<em class="li">实用</em>深度/机器学习的话。<a class="ae mi" href="https://docs.fast.ai/" rel="noopener ugc nofollow" target="_blank"> fast.ai 库</a>挤满了最先进的深度学习技术，这些技术可以加快训练速度，它们的默认设置会产生惊人的结果，从而使用户可以专注于实验的其他部分。论坛也非常活跃，上面的大多数想法都来自<a class="ae mi" href="https://forums.fast.ai/t/time-series-sequential-data-study-group/29686" rel="noopener ugc nofollow" target="_blank">这个帖子</a>中的人。</p><h1 id="d4b1" class="kf kg it bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">参考</h1><p id="a826" class="pw-post-body-paragraph lg lh it lj b lk mj lm ln lo mk lq lr mf ml lu lv mg mm ly lz mh mn mc md me im bi translated">[0] Z. Wang 和 T. Oates，“使用平铺卷积神经网络将时间序列编码为用于视觉检查和分类的图像。”AAAI 研讨会(2015 年)。</p><p id="e088" class="pw-post-body-paragraph lg lh it lj b lk ll lm ln lo lp lq lr mf lt lu lv mg lx ly lz mh mb mc md me im bi translated">[1] J.-P Eckmann 和 S. Oliffson Kamphorst 和 D Ruelle，“动力系统的递归图”。欧洲物理学通讯(1987 年)。</p><p id="e02a" class="pw-post-body-paragraph lg lh it lj b lk ll lm ln lo lp lq lr mf lt lu lv mg lx ly lz mh mb mc md me im bi translated">[2]马科斯·洛佩兹·德·普拉多，“金融机器学习的<a class="ae mi" href="https://www.amazon.com/Advances-Financial-Machine-Learning-Marcos/dp/1119482089" rel="noopener ugc nofollow" target="_blank">进展</a>”。2018</p><p id="8c8c" class="pw-post-body-paragraph lg lh it lj b lk ll lm ln lo lp lq lr mf lt lu lv mg lx ly lz mh mb mc md me im bi translated">[3] <a class="ae mi" href="https://eng.uber.com/author/rosanne-liu/" rel="noopener ugc nofollow" target="_blank">罗莎妮·刘</a>、<a class="ae mi" href="https://eng.uber.com/author/joel-lehman/" rel="noopener ugc nofollow" target="_blank">乔尔·雷曼</a>、<a class="ae mi" href="https://eng.uber.com/author/piero-molino/" rel="noopener ugc nofollow" target="_blank">皮耶罗·莫里诺</a>、<a class="ae mi" href="https://eng.uber.com/author/felipe-petroski-such/" rel="noopener ugc nofollow" target="_blank">费利佩·彼得罗夫斯基这样的</a>、<a class="ae mi" href="https://eng.uber.com/author/eric-frank/" rel="noopener ugc nofollow" target="_blank">埃里克·弗兰克</a>、<a class="ae mi" href="https://eng.uber.com/author/alex-sergeev/" rel="noopener ugc nofollow" target="_blank">亚历克斯·谢尔盖耶夫</a>、<a class="ae mi" href="https://eng.uber.com/author/jason-yosinski/" rel="noopener ugc nofollow" target="_blank">杰森·约辛斯基</a>、【卷积神经网络和 CoordConv 解决方案的一个耐人寻味的失败】。2018.</p></div></div>    
</body>
</html>