<html>
<head>
<title>Dog Breed Classification using CNNs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于 CNN 的犬种分类</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/dog-breed-classification-using-cnns-f042fbe0f333?source=collection_archive---------13-----------------------#2019-02-10">https://towardsdatascience.com/dog-breed-classification-using-cnns-f042fbe0f333?source=collection_archive---------13-----------------------#2019-02-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="3a8d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在今天的帖子中，我将向你展示如何制作一个非常有趣的应用程序，来检测一张照片中是人还是狗。此外，在图像中检测到狗的情况下，它会以很高的准确度告诉我们狗的品种。</p><p id="1675" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">可以通过这个 github <a class="ae ko" href="https://github.com/denizn/Dog-Breed-Classifier" rel="noopener ugc nofollow" target="_blank">链接</a>访问相关的存储库，在那里可以找到关于下载数据集和先决条件的说明。</p><p id="87e8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在构建我们的分类器时，我们将遵循以下步骤:</p><ul class=""><li id="a458" class="kp kq it js b jt ju jx jy kb kr kf ks kj kt kn ku kv kw kx bi translated">步骤 0:导入数据集</li><li id="7575" class="kp kq it js b jt ky jx kz kb la kf lb kj lc kn ku kv kw kx bi translated">第一步:探测人类</li><li id="3134" class="kp kq it js b jt ky jx kz kb la kf lb kj lc kn ku kv kw kx bi translated">第二步:探测狗</li><li id="5d60" class="kp kq it js b jt ky jx kz kb la kf lb kj lc kn ku kv kw kx bi translated">第三步:创建一个 CNN 来分类狗的品种</li><li id="2260" class="kp kq it js b jt ky jx kz kb la kf lb kj lc kn ku kv kw kx bi translated">第四步:训练 CNN 对狗的品种进行分类(从头开始)</li><li id="edce" class="kp kq it js b jt ky jx kz kb la kf lb kj lc kn ku kv kw kx bi translated">第五步:训练 CNN 对狗的品种进行分类(通过迁移学习)</li></ul><p id="d9cd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">第 0 步:导入数据集</strong></p><p id="6fc6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们的第一步将是加载分为训练、验证和测试文件夹的数据集。</p><p id="fe25" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们想把我们训练数据集中的狗分成 133 个不同的品种。</p><p id="97ea" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">正如我们在下面的代码片段中看到的，我们将使用 6680 张狗的图片来训练我们将要使用的模型。我们将使用 835 验证图像来微调我们的参数，并在 836 测试图像上测试最终模型的准确性。当然，测试数据集将是模型以前没有见过的图像。</p><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi ld"><img src="../Images/a5726ad25b6ca393e56595a85509fd8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NSxqCH_qlGIWd1xXVIPbFg.png"/></div></div><figcaption class="lp lq gj gh gi lr ls bd b be z dk">Snippet 1 : Loading the Dataset</figcaption></figure><p id="39c1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">第一步:探测人类</strong></p><p id="ac9a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为了检测人，我们首先将三通道 RGB 图像(红绿蓝)转换成灰度。一个名为“<a class="ae ko" href="https://www.programcreek.com/python/example/79435/cv2.CascadeClassifier" rel="noopener ugc nofollow" target="_blank"> detectMultiScale </a>”的<a class="ae ko" href="https://opencv.org/" rel="noopener ugc nofollow" target="_blank"> OpenCV </a>函数对灰度图像起作用，并给我们一个检测人脸的“盒子”的坐标。稍后，我们可以使用它在我们正在绘制的图像上绘制一个蓝色的矩形，如下所示。</p><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi lt"><img src="../Images/78734d6304ad48dd78d8e2f8d9892c38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*17gi2vITdLR2Mk7N45woZw.png"/></div></div><figcaption class="lp lq gj gh gi lr ls bd b be z dk">Snippet 2 : Detecting humans</figcaption></figure><p id="b3f3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">第二步:检测狗<br/> </strong>我们将使用 Keras 中的 resnet50 预训练模型来检测图像中的狗。这里的第一步是转换的 RGB 编码。jpg 图像到 BGR，然后根据从庞大的 Imagenet 数据库中获得的平均值和标准偏差对三个通道进行归一化。幸运的是，这是由 Keras 中 applications.resnet50 模块中的 preprocess_input 完成的。</p><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi lu"><img src="../Images/0bcc8a817a9eab312f56a396c63f4f11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h-HmQ2Pz02jWsNVDQF6zuw.png"/></div></div><figcaption class="lp lq gj gh gi lr ls bd b be z dk">Snippet 3: Resnet50</figcaption></figure><p id="03aa" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用我们从 keras.applications 库导入的 ResNet50 模型，我们可以将图像分类到标签中。在 resnet 库中，任何编码为 151 到 268 的标签实际上都是“狗”。如果是这种情况，下面的函数将给出一个真布尔值，否则为假。</p><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi lv"><img src="../Images/3601c18db209b97bea3cc9acefcec332.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZEp_EV4eg1a87sI4B1FC0A.png"/></div></div><figcaption class="lp lq gj gh gi lr ls bd b be z dk">Snippet 4: Dog Detector</figcaption></figure><p id="f6ed" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">第三步:创建 CNN 对狗的品种进行分类</strong></p><p id="4559" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们将使用下面的基本序列模型，并设计我们的 CNN 网络。</p><p id="10eb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我使用了三个卷积层，每个卷积层后面都有一个 MaxPooling2D，以降低堆叠模型的复杂性。</p><p id="9b84" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最后，我们将使用 global_average_pooling 将 Max Pooling 图层中的每个要素地图转换为标量。</p><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi lw"><img src="../Images/3d215e31fe00bedfc425bc3c3a8c9d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-1JabMAj-kXvTr2yz87eEQ.png"/></div></div><figcaption class="lp lq gj gh gi lr ls bd b be z dk">Snippet 5: Building the CNN Model</figcaption></figure><p id="cc29" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">第四步:训练 CNN 对狗的品种进行分类(从头开始)</strong></p><p id="3f7b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们开始训练我们创建的模型，我们看到我们的验证损失不断降低，我们的准确性降低了 5 个时期，表明我们的模型正在学习。</p><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi lt"><img src="../Images/d4c65b19e1d86063711334e83a9e7f55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MnWX5gtqnVrZEuEfneq-EA.png"/></div></div><figcaption class="lp lq gj gh gi lr ls bd b be z dk">Snippet 6: Training the Model with 5 Epochs</figcaption></figure><p id="2dfe" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在 20 个历元时，有可能达到大约 4.5%的精度吗？当我们在这个数据集上运行 250 个历元时，我们能够达到%40+的准确度，即使有强大的 GPU 支持，这也需要相当长的时间，这就是为什么我们将使用迁移学习作为下一步。</p><p id="c908" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">第五步:训练 CNN 对狗的品种进行分类(通过迁移学习)</strong></p><p id="9ccc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">接下来，我们将使用预提取的“瓶颈特征”，这些特征是应用于我们的训练、测试和验证数据集的预训练库的输出。</p><p id="e632" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们将使用 Resnet50 库输出作为我们模型的输入，并使用这些瓶颈特性训练我们的模型。</p><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi lv"><img src="../Images/a828256b57f1417d063d82e50eb860e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j90tQlwjSinhbrL38SU16w.png"/></div></div><figcaption class="lp lq gj gh gi lr ls bd b be z dk">Snippet 7: Loading bottleneck features</figcaption></figure><p id="6512" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们通过添加一个全局平均池层来创建一个简单的模型，该层将之前的每个特征映射总结为一个标量。密集层创建 133 个不同的输出，每个输出对应一个所需的标签。然后，softmax 激活将这些转换成概率。</p><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi lx"><img src="../Images/80fc592c51044087a8002e2e8718f1e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Mz3zHEh_6UbuhYUlaNvxZQ.png"/></div></div><figcaption class="lp lq gj gh gi lr ls bd b be z dk">Snippet 8: Define, compile and train the model</figcaption></figure><p id="7405" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后，我们现场测试我们的算法，看看它是否能正确预测加载图像路径中的狗的品种。我们将一张威尔士施普林格犬的图片加载到模型中，正如你在下面看到的，神经网络正确地对我们使用的样本狗图片进行了分类。</p><figure class="le lf lg lh gt li gh gi paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="gh gi ly"><img src="../Images/fd8f37dde5ada9be4caf2c2d7e527c80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5OdjWFMhyd46LzJAV5C5AA.png"/></div></div><figcaption class="lp lq gj gh gi lr ls bd b be z dk">Snippet 9: Predict using the model</figcaption></figure><p id="5ead" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最后一部分连接了我们之前构建的所有函数，将有助于确定所提供的图像是人还是狗，或者两者都不是。</p><figure class="le lf lg lh gt li gh gi paragraph-image"><div class="gh gi lz"><img src="../Images/f0e4f6c1a2e7ceaded90ec50fb920252.png" data-original-src="https://miro.medium.com/v2/resize:fit:944/format:webp/1*KV4r9m00iXWveggfwrz76Q.png"/></div><figcaption class="lp lq gj gh gi lr ls bd b be z dk">Snippet 10: Final algorithm</figcaption></figure></div></div>    
</body>
</html>