<html>
<head>
<title>Starting with SQL in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从 Python 中的 SQL 开始</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/starting-with-sql-in-python-948e529586f2?source=collection_archive---------1-----------------------#2019-12-24">https://towardsdatascience.com/starting-with-sql-in-python-948e529586f2?source=collection_archive---------1-----------------------#2019-12-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="4fce" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">这是用 Python 在 Jupyter 笔记本中启动和运行 SQL 的介绍。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/9d8f819557acde00a3597986f612a21a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*oRAHQaMcHbTCcoNh"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Photo by <a class="ae ky" href="https://unsplash.com/@cgower?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Christopher Gower</a> on <a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="f692" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用 Python 运行 SQL 查询的一个快速简单的方法是使用<a class="ae ky" href="https://www.sqlite.org/index.html" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu"> SQLite </strong> </a>。SQLite 是一个利用 SQL 数据库引擎的库。它的执行速度相对较快，并已被证明是高度可靠的。<a class="ae ky" href="https://pynative.com/python-sqlite/" rel="noopener ugc nofollow" target="_blank"> SQLite 是测试环境中最常用的数据库引擎。</a></p><p id="9738" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是简单的入门步骤。</p><h1 id="f664" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">步骤 1 —导入 SQLite 和 Pandas</h1><p id="d6ba" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">首先，我们需要将 SQLite 导入到 Jupyter 笔记本中。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="7885" class="mx lw it mt b gy my mz l na nb">import <strong class="mt iu">sqlite3<br/></strong>import pandas as pd</span></pre><h1 id="25e6" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">步骤 2 —连接数据库</h1><p id="a119" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">使用<strong class="lb iu"> connect() </strong>函数允许您在自己的环境中创建一个数据库。这有助于用户命名他们的数据库，以便稍后在 Python 中调用。connect()函数在您使用数据库时保持连接。</p><p id="f026" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">需要注意的重要一点是，当您连接到数据库时，其他用户将无法同时访问它。这就是为什么当你完成时，关闭()连接是必要的(我将在最后讨论关闭连接)。</p><p id="ff41" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于这个例子，我将引用一个名为“factbook.db”的中情局数据库。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="8303" class="mx lw it mt b gy my mz l na nb">sql_connect = sqlite3.<strong class="mt iu">connect</strong>('factbook.db')</span></pre><h1 id="acdc" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">步骤 3 —光标对象</h1><p id="2e6c" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated"><strong class="lb iu"> cursor() </strong>函数用于帮助执行我们的 SQL 查询。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="b122" class="mx lw it mt b gy my mz l na nb">cursor = sql_connect.<strong class="mt iu">cursor</strong>()</span></pre><p id="a3cf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用 cursor()返回与我们要查询的数据库相对应的游标实例是很重要的。</p><h1 id="39c3" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">步骤 4 —编写查询</h1><p id="a0f4" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">使用 SQLite 和 Python，SQL 查询将需要通过一个<a class="ae ky" href="https://www.geeksforgeeks.org/python-strings/" rel="noopener ugc nofollow" target="_blank">字符串</a>传递。虽然这不是必需的，但我认为将查询保存到变量中是一种好的做法，这样以后就可以引用它，而不必重写整个查询。</p><p id="c365" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的 factbook.db 文件中的表叫做<em class="nc">事实</em>。</p><ol class=""><li id="c25a" class="nd ne it lb b lc ld lf lg li nf lm ng lq nh lu ni nj nk nl bi translated">将 SQL 查询保存为字符串</li></ol><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="1f55" class="mx lw it mt b gy my mz l na nb">query = "SELECT * FROM factbook;"</span></pre><p id="e65e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">2.使用前面的游标变量执行查询。这会将结果转换为元组，并将其存储为局部变量。为了得到所有的结果，我们使用<em class="nc"> fetchall()。</em></p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="2069" class="mx lw it mt b gy my mz l na nb">results = cursor.execute(query).<strong class="mt iu">fetchall</strong>()</span></pre><h1 id="953d" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">步骤 5-运行查询</h1><p id="b313" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">为了运行我们之前保存的关于 pandas 的查询，我们执行以下操作。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="2a43" class="mx lw it mt b gy my mz l na nb">pd.<strong class="mt iu">read_sql_query</strong>(query,sql_connect)</span></pre><p id="fcd1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">输出</strong>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/90fda313d57cb49e6b348d60192c4e29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1118/format:webp/1*vsGGDrZJdGEDby6Ntht8oQ.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">A snippet of the output from our query</figcaption></figure><h1 id="7ac5" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">步骤 6 —关闭您的连接</h1><p id="6f4a" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">请记住，完成后关闭连接是非常重要的。关闭连接将授予其他人访问数据库的权限。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="0d5e" class="mx lw it mt b gy my mz l na nb">sql_connect.<strong class="mt iu">close</strong>()</span></pre><p id="ba45" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里有一个很好的 SQLite 思维过程的模板。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="c006" class="mx lw it mt b gy my mz l na nb">1. connection open<br/>    2. transaction started<br/>        3. statement executes<br/>    4. transaction done<br/>5. connection closed</span></pre><h1 id="ec21" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">第 7 步——奖励(为什么使用 Python 和 SQL？)</h1><p id="44f3" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">如果你像我一样，那么你可能想知道为什么在 Python 中运行 SQL 查询，而在 PostgreSQL 或 MySQL 中运行它们似乎更容易。</p><p id="9357" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Python 有大量的库(例如，Pandas、StatsModel 和 SciPy)用于可测量的科学分析。这些库同样致力于不断完善抽象，因此你不必手工计算所有的基本数学。此外，您可以迅速获得结果，因此您可以迭代地利用 Python 来调查您的信息。(<a class="ae ky" href="https://www.janbasktraining.com/blog/use-sql-with-python/" rel="noopener ugc nofollow" target="_blank"> Janbansk 训练</a>)</p><p id="0958" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是用 Python 和 SQL 查询绘制直方图的片段。</p><pre class="kj kk kl km gt ms mt mu mv aw mw bi"><span id="608a" class="mx lw it mt b gy my mz l na nb">import matplotlib.pyplot as plt<br/>import seaborn as sns<br/>%matplotlib inline</span><span id="f74f" class="mx lw it mt b gy nn mz l na nb">fig = plt.figure(figsize=(10,10))<br/>ax = fig.add_subplot(111)</span><span id="584e" class="mx lw it mt b gy nn mz l na nb"><strong class="mt iu">query = '''<br/>SELECT population, population_growth, birth_rate, death_rate<br/>FROM factbook<br/>WHERE population != (SELECT MAX(population) FROM facts)<br/>AND population != (SELECT MIN(population) FROM facts);<br/>'''</strong></span><span id="beb7" class="mx lw it mt b gy nn mz l na nb">pd.read_sql_query(query, sql_connect).hist(ax=ax)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/328c34bfaa515c08436cbe362e51f109.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PC7EZxgLPRbYRI9bYS6U1Q.png"/></div></div></figure><h1 id="1f05" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">资源:</h1><ul class=""><li id="cc04" class="nd ne it lb b lc mn lf mo li np lm nq lq nr lu ns nj nk nl bi translated"><a class="ae ky" href="https://github.com/jasonmchlee/statistical-analysis/tree/master/CIA%20Factbook" rel="noopener ugc nofollow" target="_blank"> Github 资源库</a></li></ul></div></div>    
</body>
</html>