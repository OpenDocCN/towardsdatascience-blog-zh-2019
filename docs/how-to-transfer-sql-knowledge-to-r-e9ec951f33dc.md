# 如何将 SQL 知识转移到 R

> 原文：<https://towardsdatascience.com/how-to-transfer-sql-knowledge-to-r-e9ec951f33dc?source=collection_archive---------17----------------------->

![](img/84e2a34eb3f75db1a20c7b070415d125.png)

## 使用替代语法操作数据

为什么要在 R 的上下文中使用 SQL 语法呢？也许你学过一些生物信息学课程，但后来转向 Python，回到 r 的语法时有些犹豫。也许你想扩展你的数据科学工具包，并且迫切需要编码创可贴来让你远离 Stackoverflow。也许您已经编写了 SQL 查询，但是想要使用 [ggplot2](https://ggplot2.tidyverse.org/) 来可视化结果。在数据结构经常令人困惑的环境中，SQL 语法可以简化 R 中的数据帧操作，这样就可以将更多的时间花在可视化上，而不是花在争论数据上。这里的代码可以在我的 [GitHub](https://github.com/aaronfrederick/R-SQL-Syntax) 上完整找到。

R 中的 [sqldf](https://cran.r-project.org/web/packages/sqldf/README.html) 包是一个对分析师友好的神奇工具。通过简单地在字符串中编写一个 SQL 查询，该函数根据该查询输出一个新的数据帧。在下面的代码块中，我将使用 sqldf 函数和适当的 R 语法来分享一些基本的重构工具。使用 R 的动机是 ggplot2 包允许我们只用几行代码就能创建视觉上吸引人的静态图。它是学术出版的最佳选择，并且得到了很好的支持和记录。我将可视化数据帧操作的结果，以显示包的有效性和查询的结果。下面是我用来设置数据的代码:

使用的数据集由 1990 年至 2018 年的篮球工资组成。数据帧包括球员的名字、他们的薪水、赛季开始年份、赛季结束年份、他们球队的三个字母缩写以及完整的球队名称。下图显示了所有按团队进行颜色编码的薪水(*，因为纯黑色散点图一点也不好玩！*)。

![](img/ea9580a37baa9e5f85db181f16dc65de.png)

现在，我的家人最喜欢的球队是圣安东尼奥马刺队，所以我只看到马刺队过去 28 年的薪水是至关重要的。使用下面的 SQL 风格的查询，我将获取那个子集并绘制它。

![](img/a8d3559686b96634bb2d2ee374582d61.png)

使用 r 中的 subset 函数可以达到同样的效果。下面的代码和图表显示了与上面完全相同的数据。

![](img/50ba2e476d7415a6ee88abe9eef330bf.png)

这两个图的唯一区别是轴标签。因为我在 SQL 查询中重命名了列标题，所以它们在绘图中自动大写。简单地使用 subset 函数需要在 plot 函数中添加一行代码来更改轴标签。

SQL 语法的另一个用例是聚合函数。如果我们想要跟踪一段时间内的平均工资，我们可以使用这个 SQL 查询或 r 中的聚合函数。聚合方法中的 FUN 参数指定在聚合数据时要应用哪个函数，在本例中，它对值进行平均。我将在下面的要点中包括查询符号和聚合符号——我保证图形是相同的！

![](img/c16f702e500be8c063e7b91d86f90983.png)

最后，我们将把这两个概念放在一起！要显示过去 28 年中平均工资最高的 10 个团队，我们需要几行 SQL:按团队分组平均工资，然后按降序列出前 10 名。一个相对基本的查询，尤其是与 R 语法的对应查询相比。在 R 中，我们必须使用 mean 函数按组进行聚合，然后重置列名，最后在数据帧被第二列重新排序后获取数据帧的头部。SQL 可读性更强，更直观，特别是对于不是 R 专家的人来说。下面的代码和图表显示了这些等效操作的结果。

![](img/85bc2f0dd82b6840264dbb705bfbe7f2.png)

希望这对于任何有 SQL 背景、试图进入 R 进行探索性分析的人都有帮助；语法比原生的 R 函数更简单易懂。如果你喜欢这篇文章或我的其他文章，[我很乐意连接](https://www.linkedin.com/in/aarondfrederick/)！我还要感谢 [Jonathan Balaban](https://medium.com/u/664d460a5ffa?source=post_page-----e9ec951f33dc--------------------------------) ，我写 r 的原因