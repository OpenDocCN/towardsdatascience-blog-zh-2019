# 分析在线活动和睡眠模式

> 原文：<https://towardsdatascience.com/analyzing-online-activity-and-sleep-patterns-10c997591e76?source=collection_archive---------15----------------------->

## 让数据科学变得有趣

## 分析你的脸书朋友的网上活动和睡眠模式

社交网络上有大量公开的信息，有时我们甚至会忘记它们的存在。像我们的脸书朋友在[的在线活动](https://medium.com/p/31a2d8fc0c6d)这样的小信息能让我们推断出他们什么时候睡觉，或者他们什么时候在脸书最活跃。

在本帖中，我们将学习分析*脸书好友*的在线活动，并找出使用统计和睡眠模式。该员额由两部分组成。

1.  展示在线活动和睡眠模式
2.  使用 Python 分析在线活动和睡眠模式(带代码)

在第一部分，我将向你展示一些我用我脸书朋友的数据制作的有趣的图表，在第二部分，我将向你解释如何用 Python 创建一些展示的图表。

*本帖完整代码的 Jupyter 笔记本可以在* [*这里*](https://github.com/AliRaza3997/fb_friends_status) *找到。*

# 1.展示在线活动和睡眠模式

从一个人的脸书朋友的在线状态数据中可以得出一系列有趣的见解。在这一节中，我将向你展示一些有趣的见解，这些见解来自我通过爬行脸书收集的两周数据。

首先，我非常有兴趣找出我的朋友们在一天中的不同时间以及一周中的不同日子使用脸书/Messenger 的模式。

给定一个时间戳列表和相应的当时在线的朋友列表，我们不仅可以找出一天中最多和最少数量的朋友在线的*高峰时间，还可以对 ***睡眠模式*** 有一个相当好的估计。*

> *这些统计数据也提醒我们，我们在网上留下了多少公共信息和痕迹，以及它们是如何被以不同方式利用的。*

*虽然数据收集非常简单，但是与收集的数据样本及其预处理相关的一些要点值得一提，如下所示:*

1.  *在 ***两周*** 的过程中，每周 7 天，每天 24 小时，每 4-5 分钟收集一次样本。仅仅两个星期的短时间跨度可能导致有偏差的数据集，但是正如我们将在后面看到的，它给了我们一个很好的模式估计。*
2.  *我的大多数朋友都是穆斯林，数据也是在神圣的斋月收集的，在不同的时区(包括欧洲、美国、亚洲和非洲)都有朋友。这可能会导致睡眠模式与平时不同。*
3.  *当比较朋友的相对在线活动时，使用了每个朋友的**当地时区**例如，当地时间晚上 8:00(GMT+2)斯德哥尔摩的一个朋友的在线状态与当地时间晚上 8:00(GMT-4)纽约州的另一个朋友的在线状态进行比较。*
4.  *因为我的大多数朋友都来自巴基斯坦，默认时区被假定为 GMT+5，对于我碰巧记得的朋友，我相应地调整了他们的时区。然而，由于时区设置错误，汇总数据中可能存在一些不准确性(约 5-10%)。*

*背景信息已经够多了，现在让我们来看看第一周和第二周在线朋友的平均数量。图 1 描绘了一天中不同时间线上朋友的数量。*

*![](img/c9d33451fe1a47000473d70f76c77f4c.png)*

*Figure 1: Average number of online friends over the day for two different weeks*

*   *这两周的曲线高度略有不同，但这两周曲线**模式**在一天不同时间的变化非常一致。*
*   ***两周后曲线的峰值**非常一致。*

*如果您想知道如何创建这些图表，请继续，您可以在本文的下一部分中了解到这一点。*

*从图 1 中可以明显看出，一周的数据通常是对模式的足够好的估计，我们可以继续绘制一周中不同日子的在线朋友数量图。*

*![](img/4415550579d46295dcda5b335ff6fc13.png)*

*Figure 2: Number of online friends over the day for whole week*

*让我们列出图 2 中的一些观察结果:*

1.  *一天中在线朋友数量的模式在一周中不同的日子里惊人地一致，高度几乎没有变化。*
2.  *当地时间下午 5:00 为每个好友记录了最多的在线好友数量。*
3.  *凌晨 4:00 记录的在线好友数量最低(可能是因为大多数好友都在睡觉)。*

*我们还可以绘制一个条形图，显示一周中不同日子的平均在线时间。*

*![](img/7c93ecda19411d6c5d21bbe33f7ca543.png)*

*Fig 3: Average number of hours spent online for each day of the week*

*   *朋友们平均每天在脸书呆 3.5 个小时。*
*   *周六和周一被发现是一周中最忙的一天，同时也是上网时间最多的一天。*

*如本节开头所述，出于某些原因，每个用户都被视为基于其当地时间在线。但是，如果我们想知道一天中最大限度地扩大帖子覆盖范围和浏览量的最佳时间，这可能会产生误导性的统计数据。*

*让我们根据我的时区(恰好是中欧时间)调整每个朋友的时区，然后绘制一天中在线朋友的数量图，以确定一天中发布新帖子的最佳时间。*

*![](img/00785df22edf92079aae0d3b98a24772.png)*

*Figure 4: Number of online friends over the day for whole week (relative to my local time)*

*到目前为止，我们只使用了用户的汇总数据，但是个人朋友的在线活动呢？我们能从中获得什么样的见解？*

*假设**用户倾向于把查看脸书作为晚上的最后一件事，也是早上的第一件事**，我们可以发现在脸书上不活跃的一些非常一致的模式，这表明用户正在睡觉。*

*让我们画出我的一个朋友的睡眠模式。从图 5 中可以观察到，我的朋友从午夜 12:00 到早上 9:00 平均每天睡眠 6.5 小时，非常规律。*

*![](img/cca5ca9308c73485fa862f2da59b111a.png)*

*Figure 5: Sleep times of a particular user over days*

> *仅通过可视化一天中用户在线/离线的时间，就可以很好地估计用户的睡眠模式。*

*很有趣，不是吗？嗯，这是 ***迷人的*** 同时也是 ***令人担忧的*** ，让我们意识到这么小的一条信息能透露多少关于我们日常生活的信息。*

*这些都是通过分析*脸书朋友*的在线活动得出的见解。如果您有兴趣了解如何使用 Python 创建本节中呈现的图表，可以继续阅读下一节。否则，你可能会有兴趣阅读**【即将推出】分析社交网络图。***

# *使用 Python 可视化脸书朋友的在线活动*

## ***先决条件**:*

1.  *Python 3.5*
2.  *[钟摆](https://pypi.org/project/pendulum/)*
3.  *[Matplotlib](https://pypi.org/project/matplotlib/)*
4.  *Numpy*

*为了简单和隐私起见，我不会在这里展示我朋友的真实数据。在本教程中，我们将使用具有相同结构的样本[虚拟数据](https://github.com/AliRaza3997/fb_friends_status/blob/master/online_friends.json)。*

*让我们看看数据集的结构。收集的数据集是一个简单的字典列表，其中包含*“在线朋友列表”*和*“时间戳”*(当列表被获取时)*，作为 JSON 存储在一个文件中。**

```
*[
    {
        "timestamp": "2019-05-14T08:12:52.313921+02:00",
        "friends": [
            "John Doe",
            "John Roe"
        ]
    },
    {
        "timestamp": "2019-05-14T08:13:49.449888+02:00",
        "friends": [
            "Jane Roe",
            "Jane Doe"
        ]
    },
    ...
    ...
]*
```

## ***加载数据***

*让我们加载样本数据并执行一些初始处理:*

*上面的代码将为我们提供“时间戳”，这是一个(friend_name，times)对的 Python 字典，其中 times 是一个列表，其中的[*pendulum . datetime*](https://pendulum.eustace.io/docs/)对象表示特定朋友在线时记录的时间戳。*

*下一步是将 dict 转换成嵌套的 dict，每个朋友的时间戳按天分组。下面的代码可以做到这一点:*

*上述代码执行以下操作:*

1.  *它按照唯一的日期对每个朋友的 pendulum.datetime 对象列表进行分组，并将其转换为(day，times)对的字典，其中 times 是按时间顺序排列的时间戳列表。*
2.  *创建一个名为“activities”的嵌套有序字典，其中包含一个嵌套字典对(day，times)。*

*结果是以下格式的嵌套字典:*

```
*{
    "Jane Roe": {
        "We 15/05/19": [DateTime,...,],
        "Th 16/05/19": [DateTime,...,]
    },
    "Jane Doe": {
        "We 15/05/19": [DateTime,...,],
        "Th 16/05/19": [DateTime,...,]
    },
    ...
}*
```

*给定上面的字典，我们想要做的是创建一个二进制地图来表示每个朋友每天的在线状态。就这么办吧。*

*如果您觉得它看起来吓人，请不要担心，我还在代码片段后提供了代码摘要。*

*上面的代码实质上是将每个朋友每天的时间戳列表转换成一个二进制映射，1 表示在线，0 表示离线，时间间隔为 5 分钟，时间间隔为一天 24 小时。它执行以下操作:*

1.  *一天创建 289 个垃圾箱。每个时间戳被放入适当的容器中(但是不计算频率)。*
2.  *创建一个名为 online_maps 的 shape (4，2，289)的 Numpy 数组，因为有 4 个朋友和 2 天。创建阵列的日期按时间顺序排列。*

> *为了熟悉箱的概念，假设我们将一天分成 24 个部分/间隔，即箱，每小时一个部分。如果用户在从午夜 12:00 到凌晨 1:00 的任何时间在线，我们将把第一个 bin 的值设置为 1，否则为 0。对所有 24 个时间间隔执行此操作将产生一个整数列表(我们称之为二进制映射，因为每个整数的值为 0 或 1 ),表示一天中每个小时用户在线或离线的状态。*

*我们现在有一个非常好的数据格式，即每个朋友几天的活动地图。让我们使用格式化的数据绘制一些图表。*

# *绘图活动状态*

*我们可以画出一个朋友在不同日子不同时间的在线活动。下面的代码描绘了数据中第一个朋友的活动。*

*这将绘制下图，其中蓝色竖线表示在线，不在线表示离线。*

*![](img/8c09bbe95509df014ebbe9eedee57c76.png)*

*Figure 6: Online status of a friend across different days of the week*

*有趣到目前为止？*

*让我们绘制另一个图表，在这个图表中，我们可以看到一天中不同时间的在线好友总数。*

## *在线好友的数量*

*通过计算 online_maps 数组第一维的总和，我们可以得到一天中在线的朋友数量，即朋友数量:*

```
*>>> online_count = np.sum(online_maps, axis=0)
>>> print(online_count.shape)
(2, 289)*
```

*下面的代码绘制了一个折线图，显示不同日子在线的朋友数量。为了视觉效果，我们也将高斯平滑应用于每条曲线。*

*运行上面的代码会产生下面的图:*

*![](img/314d67d721017948d499ff45710f7653.png)*

*Figure 7: No. of online friends of different hours of multiple days in the week*

*利用这组简单的信息，我们还可以做更多的事情(其中一些我将在本系列的后面部分讨论)，但是本教程应该可以帮助您从基础开始。*本帖完整代码的 Jupyter 笔记本可以在这里*[](https://github.com/AliRaza3997/fb_friends_status)**找到。***

**我希望这篇文章对你的工作和研究有所帮助。如果你有任何问题，欢迎在下面写评论。**

**阅读相关故事:**

1.  **[抓取你脸书朋友的数据](https://medium.com/p/31a2d8fc0c6d)**
2.  **分析在线活动和睡眠模式**
3.  ****【即将推出】:**分析我的社交网络图**