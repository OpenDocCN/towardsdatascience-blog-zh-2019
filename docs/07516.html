<html>
<head>
<title>Detecting Lesions in Multiple Sclerosis Patients with Deep Learning</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">利用深度学习检测多发性硬化患者的病变</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/detecting-brain-lesions-in-multiple-sclerosis-patients-with-deep-learning-dc7e32950d1f?source=collection_archive---------16-----------------------#2019-10-20">https://towardsdatascience.com/detecting-brain-lesions-in-multiple-sclerosis-patients-with-deep-learning-dc7e32950d1f?source=collection_archive---------16-----------------------#2019-10-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="7419" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsdatascience.com/tagged/clinical-data-science" rel="noopener" target="_blank">临床数据科学</a></h2><div class=""/><div class=""><h2 id="084d" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">医学图像分析中的卷积神经网络导论。</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/bd3b551e6bb2b4ce2ee51e4a86a6a0dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*GWjdbdmdxGrJf0ZI"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk">Photo by <a class="ae lh" href="https://unsplash.com/@nci?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">National Cancer Institute</a> on <a class="ae lh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="01f5" class="li lj it bd lk ll lm ln lo lp lq lr ls ki lt kj lu kl lv km lw ko lx kp ly lz bi translated">介绍</h1><h2 id="da70" class="ma lj it bd lk mb mc dn lo md me dp ls mf mg mh lu mi mj mk lw ml mm mn ly iz bi translated">深度学习的应用</h2><p id="b442" class="pw-post-body-paragraph mo mp it mq b mr ms kd mt mu mv kg mw mf mx my mz mi na nb nc ml nd ne nf ng im bi translated"><a class="ae lh" href="https://en.wikipedia.org/wiki/Deep_learning" rel="noopener ugc nofollow" target="_blank"> <strong class="mq jd">深度学习</strong> </a>是基于<a class="ae lh" href="https://en.wikipedia.org/wiki/Artificial_neural_network" rel="noopener ugc nofollow" target="_blank"> <strong class="mq jd">人工神经网络</strong> </a>的<a class="ae lh" href="https://en.wikipedia.org/wiki/Machine_learning" rel="noopener ugc nofollow" target="_blank"> <strong class="mq jd">机器学习</strong> </a>方法的更广泛家族的一部分。深度学习最有前景的应用之一是<strong class="mq jd">图像分析</strong>，例如用于图像分割或分类。尽管分割为每个类别(即，每个像素属于 K 个类别中的一个)产生每个像素的概率分布(也称为掩模)，但是分类为整个图像产生概率分布(即，每个图像属于 K 个类别中的一个)。如今，软件解决方案几乎随处可见，例如在<a class="ae lh" href="https://en.wikipedia.org/wiki/Medical_imaging" rel="noopener ugc nofollow" target="_blank"> <strong class="mq jd">医学成像</strong> </a>中。在测试新药的临床研究中，人们感兴趣的是检查新药是否能改变组织的状况，例如减少炎症<a class="ae lh" href="https://en.wikipedia.org/wiki/Inflammation" rel="noopener ugc nofollow" target="_blank"/>。这些都可以通过医学图像来监控，这些医学图像是通过成像技术创建的，如<a class="ae lh" href="https://en.wikipedia.org/wiki/Medical_ultrasound" rel="noopener ugc nofollow" target="_blank"><strong class="mq jd"/></a><a class="ae lh" href="https://en.wikipedia.org/wiki/X-ray" rel="noopener ugc nofollow" target="_blank"><strong class="mq jd">X 射线</strong></a><a class="ae lh" href="https://en.wikipedia.org/wiki/CT_scan" rel="noopener ugc nofollow" target="_blank"><strong class="mq jd">计算机断层摄影(CT) </strong> </a>，甚至是常规的光学显微镜。然而，对生成的图像进行分割或分类是困难的，即使对于专家来说，这也是一项耗时且昂贵的任务；问题是这是否可以自动化以节省时间和金钱。这篇文章旨在为基于深度学习的医学图像分析提供一些直觉(重点是使用来自前<a class="ae lh" href="https://smart-stats-tools.org/lesion-challenge" rel="noopener ugc nofollow" target="_blank">挑战</a>的数据在多发性硬化症<strong class="mq jd"> </strong>患者中进行病灶分割)。</p><h2 id="d82d" class="ma lj it bd lk mb mc dn lo md me dp ls mf mg mh lu mi mj mk lw ml mm mn ly iz bi translated">多发性硬化</h2><p id="16d6" class="pw-post-body-paragraph mo mp it mq b mr ms kd mt mu mv kg mw mf mx my mz mi na nb nc ml nd ne nf ng im bi translated"><a class="ae lh" href="https://en.wikipedia.org/wiki/Multiple_sclerosis" rel="noopener ugc nofollow" target="_blank"><strong class="mq jd"/></a>多发性硬化(MS)是一种<a class="ae lh" href="https://en.wikipedia.org/wiki/Demyelinating_disease" rel="noopener ugc nofollow" target="_blank">脱髓鞘疾病</a>，其大脑和脊髓中神经细胞的绝缘套受损。MS 的三个主要特征是中枢神经系统<a class="ae lh" href="https://en.wikipedia.org/wiki/Lesion" rel="noopener ugc nofollow" target="_blank"> <strong class="mq jd">病变</strong> </a>的形成(也叫斑块)、炎症、神经元<a class="ae lh" href="https://en.wikipedia.org/wiki/Myelin_sheath" rel="noopener ugc nofollow" target="_blank">髓鞘</a>的破坏。这种损伤破坏了部分神经系统的交流能力，因为<a class="ae lh" href="https://en.wikipedia.org/wiki/Transduction_(physiology)" rel="noopener ugc nofollow" target="_blank">信号转导</a>被扭曲。<a class="ae lh" href="https://en.wikipedia.org/wiki/Magnetic_resonance_imaging" rel="noopener ugc nofollow" target="_blank"> <strong class="mq jd">磁共振成像</strong> </a> <strong class="mq jd"> (MRI) </strong>大脑和脊柱可能出现脱髓鞘区域(病变或斑块)。虽然原因尚不清楚，但潜在的机制被认为是免疫系统的破坏或产生髓鞘的细胞的失败。对此提出的原因包括遗传和环境因素，如由病毒感染引发。这种疾病的名称是指在神经系统中形成的疤痕(巩膜——更好的说法是斑块或病变)。尽管目前还没有治愈多发性硬化症的方法，但几种疗法已经被证明是有帮助的。治疗的主要目的是恢复发作后的功能，防止新的发作，并防止残疾。当磁共振成像上出现两个以上的病变时，一般建议在首次发作后开始药物治疗。正在进行的研究正在寻找更有效、方便和可耐受的复发-缓解型 MS 治疗方法，为进展型亚型创造疗法，神经保护策略和有效的对症治疗(但为了评估新疗法的疗效，廉价和标准化的疾病进展检查将是有帮助的)。</p><h2 id="b3b9" class="ma lj it bd lk mb mc dn lo md me dp ls mf mg mh lu mi mj mk lw ml mm mn ly iz bi translated">医学成像</h2><p id="ea88" class="pw-post-body-paragraph mo mp it mq b mr ms kd mt mu mv kg mw mf mx my mz mi na nb nc ml nd ne nf ng im bi translated">如上所述的医学成像技术通常基于不可见光，即人眼可见光谱之外的光(380-750 纳米)。例如，<a class="ae lh" href="https://en.m.wikipedia.org/wiki/Physics_of_magnetic_resonance_imaging#MRI_scanner" rel="noopener ugc nofollow" target="_blank">核磁共振扫描仪</a>利用<a class="ae lh" href="https://en.m.wikipedia.org/wiki/Radio_wave" rel="noopener ugc nofollow" target="_blank">无线电波</a>(波长 1 毫米到 10 公里)生成人体器官的图像。与 MRI 相反，CT 和常规 X 射线成像使用波长为 250 pm 至 10 nm 的光(称为 X 射线，因此得名)。(注意，X 射线能量丰富，会造成细胞损伤，玩的时候要小心。)其他诊断方法如<a class="ae lh" href="https://en.wikipedia.org/wiki/Electroencephalography" rel="noopener ugc nofollow" target="_blank"> <strong class="mq jd">脑电图</strong> </a> <strong class="mq jd"> </strong>不产生经典图像作为主要输出，而是产生纯电信号(技术上，每种数字诊断方法都在某个点产生电信号，但在成像中，它们通过<a class="ae lh" href="https://en.wikipedia.org/wiki/Fourier_transform" rel="noopener ugc nofollow" target="_blank"> <strong class="mq jd">傅立叶变换</strong> </a>映射以产生图像)。x 射线成像和超声波生成 2D 图像，而 CT 和 MRI 生成图像体(3D 图像)，这使得它们更难以分析以发现病变组织，例如大脑中的病变组织。然而，单个切片的行为类似于常规图像。下面是不同成像模式/设置(例如<strong class="mq jd">质子密度(PD) </strong>、<strong class="mq jd">液体衰减反转恢复(FLAIR) </strong>等)下的大脑样本 MRI 切片(<a class="ae lh" href="https://en.wikipedia.org/wiki/Neuroimaging" rel="noopener ugc nofollow" target="_blank"> <strong class="mq jd">神经成像</strong> </a>)。)显示。</p><div class="ks kt ku kv gt ab cb"><figure class="nh kw ni nj nk nl nm paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><img src="../Images/36dcfdd5827e0daa1662ccb84d0122f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:674/format:webp/1*4g7Famlubl1gQA_YIK_KkQ.png"/></div></figure><figure class="nh kw nn nj nk nl nm paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><img src="../Images/783c054516d8996049c6b79fb76879c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:664/format:webp/1*3mzb119zFS7KpuEnHnhxSA.png"/></div></figure><figure class="nh kw nn nj nk nl nm paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><img src="../Images/ad8d15ae8d0b6246c211b5d91b06a332.png" data-original-src="https://miro.medium.com/v2/resize:fit:664/format:webp/1*w6ZY0NWfevBn9uQs3SxZVg.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk no di np nq">Example of different MRI imaging methods (top left to bottom right: <strong class="bd nr">FLAIR</strong>,<strong class="bd nr"> MPRAGE</strong>, <strong class="bd nr">PD</strong>, <strong class="bd nr">T2</strong>) with a sample <strong class="bd nr">Gaussian-filtered</strong> version of a T2 weighted image, and a <strong class="bd nr">mask/label</strong> with white lesion pixels. (images by author)</figcaption></figure></div><p id="2fe2" class="pw-post-body-paragraph mo mp it mq b mr ns kd mt mu nt kg mw mf nu my mz mi nv nb nc ml nw ne nf ng im bi translated">上图(右图)显示了多发性硬化症患者的三个病变区域。一个<strong class="mq jd">病变</strong>是通常由多发性硬化症等疾病引起的机体组织的任何损伤或异常变化。为了检查针对多发性硬化症的治疗效果，必须随着时间的推移观察这些区域，以评估治疗是否可以实现任何身体改善，例如通过<strong class="mq jd">测量图像体积</strong>中病变的总体积。请注意蒙版中的黑色像素比白色像素多得多。黑白图像被表示为秩二<a class="ae lh" href="https://en.wikipedia.org/wiki/Tensor" rel="noopener ugc nofollow" target="_blank"> <strong class="mq jd">张量</strong> </a>(在术语<a class="ae lh" href="https://en.wikipedia.org/wiki/Matrix_(mathematics)" rel="noopener ugc nofollow" target="_blank"> <strong class="mq jd">矩阵</strong> </a>下更为人所知)，其中每个条目表示一个<a class="ae lh" href="https://en.wikipedia.org/wiki/Pixel" rel="noopener ugc nofollow" target="_blank"> <strong class="mq jd">像素</strong> </a>的强度。<strong class="mq jd"> </strong>值的范围从 0 到 255，因为其表示形式为<a class="ae lh" href="https://en.wikipedia.org/wiki/8-bit" rel="noopener ugc nofollow" target="_blank"> 8 位</a>，但是在输入网络之前，条目被归一化到范围[0，1]——值越高，像素越亮。彩色图像是三阶张量，其中一维在不同颜色通道上迭代(例如<a class="ae lh" href="https://en.wikipedia.org/wiki/RGB_color_space" rel="noopener ugc nofollow" target="_blank"> <strong class="mq jd"> RGB 颜色空间</strong> </a>)。类似地，3D 彩色图像体积是秩 4 张量。然而，颜色通道可以包含不同的成像模式(PD、T2 等。)或者甚至是所述模式的高斯滤波图像。MR 图像体积的尺寸为:</p><pre class="ks kt ku kv gt nx ny nz oa aw ob bi"><span id="7295" class="ma lj it ny b gy oc od l oe of">[nx_voxels, ny_voxels, nz_voxels, n_channels]</span></pre><p id="ac6f" class="pw-post-body-paragraph mo mp it mq b mr ns kd mt mu nt kg mw mf nu my mz mi nv nb nc ml nw ne nf ng im bi translated"><a class="ae lh" href="https://en.wikipedia.org/wiki/Voxel" rel="noopener ugc nofollow" target="_blank"> <strong class="mq jd">体素</strong> </a>是一个图像体的<a class="ae lh" href="https://en.wikipedia.org/wiki/Pixel" rel="noopener ugc nofollow" target="_blank"> <strong class="mq jd">像素</strong> </a>的类似物。典型的 MR 图像大约有 200 个<em class="og"> x </em> 200 个<em class="og"> x </em> 200 个体素。这产生每个通道总共 8.000.000 个体素。假设有 4 个通道(针对 4 种不同模式)，则得出 32.000.000(！)体素。包含所有类的所有掩码的输出具有维度:</p><pre class="ks kt ku kv gt nx ny nz oa aw ob bi"><span id="37ea" class="ma lj it ny b gy oc od l oe of">[nx_voxels, ny_voxels, nz_voxels, n_classes]</span></pre><h1 id="9e87" class="li lj it bd lk ll lm ln lo lp lq lr ls ki lt kj lu kl lv km lw ko lx kp ly lz bi translated">映象分析</h1><h2 id="e2a9" class="ma lj it bd lk mb mc dn lo md me dp ls mf mg mh lu mi mj mk lw ml mm mn ly iz bi translated">卷积神经网络</h2><p id="a021" class="pw-post-body-paragraph mo mp it mq b mr ms kd mt mu mv kg mw mf mx my mz mi na nb nc ml nd ne nf ng im bi translated">通过<a class="ae lh" href="https://en.wikipedia.org/wiki/Convolutional_neural_network" rel="noopener ugc nofollow" target="_blank"><strong class="mq jd"/></a><strong class="mq jd"/>卷积神经网络已经建立了图像分析的黄金标准，并且发现<em class="og">良好的</em>网络架构已经成为最近研究的主要目的。CNN 由<a class="ae lh" href="https://en.wikipedia.org/wiki/Convolutional_neural_network#Convolutional_layer" rel="noopener ugc nofollow" target="_blank"> <strong class="mq jd">卷积层</strong> </a>组成，这些卷积层由<a class="ae lh" href="https://en.wikipedia.org/wiki/Convolution" rel="noopener ugc nofollow" target="_blank"> <strong class="mq jd">内核</strong> </a>(也称为<strong class="mq jd">滤波器</strong>)定义，对于 2D 图像来说是二阶张量，对于填充了权重的 3D 图像来说是三阶张量。卷积是一种映射，它通过悬停在输入上并使用所有通道的核条目对图像张量条目进行加权来生成新图像。这些新图像被称为<strong class="mq jd">特征地图</strong>。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oh"><img src="../Images/bbf1b20bc7ea40fd0a053b7560d9387e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*h8jw0b87RJdDmqi6P6fw9Q.gif"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk">Convolution operation on a 7x7x3 image (three input channels) with two 3x3 filters (<a class="ae lh" href="https://github.com/cs231n/cs231n.github.io" rel="noopener ugc nofollow" target="_blank">source</a>). <strong class="bd nr">Note how every input channel has different weights for each filter</strong>.</figcaption></figure><p id="eefd" class="pw-post-body-paragraph mo mp it mq b mr ns kd mt mu nt kg mw mf nu my mz mi nv nb nc ml nw ne nf ng im bi translated">通常，在 CNN 的单个层中使用许多过滤器，这些过滤器是在训练(推断)阶段<strong class="mq jd">学习</strong>的，即以感兴趣的区域比不相关的区域更明显的方式设置权重。在一个卷积层之后，一些<strong class="mq jd">激活函数</strong> ( <a class="ae lh" href="https://en.wikipedia.org/wiki/Sigmoid_function" rel="noopener ugc nofollow" target="_blank"> sigmoid </a>，<a class="ae lh" href="https://en.wikipedia.org/wiki/Rectifier_(neural_networks)" rel="noopener ugc nofollow" target="_blank"> rectifier </a>)被应用于特征图，其后面还可以跟随一个<a class="ae lh" href="https://en.wikipedia.org/wiki/Convolutional_neural_network#Pooling_layer" rel="noopener ugc nofollow" target="_blank"> <strong class="mq jd">汇集层</strong> </a>。在 CNN 中，计算卷积层(有时是汇集层)与激活函数的顺序映射，这放大了网络过程中的某些模式，因为每个操作的输出又是一个特征图。</p><pre class="ks kt ku kv gt nx ny nz oa aw ob bi"><span id="d081" class="ma lj it ny b gy oc od l oe of"><strong class="ny jd">### convolutional layer (vertical line detector)</strong></span><span id="5c32" class="ma lj it ny b gy oi od l oe of"><strong class="ny jd">from</strong> scipy.signal <strong class="ny jd">import</strong> convolve2d<br/>kernel = np.array([<br/>[1,0,-1],<br/>[1,0,-1],<br/>[1,0,-1]])</span><span id="eeda" class="ma lj it ny b gy oi od l oe of">feature_map = convolve2d(image, kernel, mode='same')</span><span id="821c" class="ma lj it ny b gy oi od l oe of"><strong class="ny jd">### pooling layer</strong></span><span id="beec" class="ma lj it ny b gy oi od l oe of"><strong class="ny jd">def</strong> pool2d(X, pool_size, mode='max'):<br/>   p_h, p_w = pool_size<br/>   Y = np.zeros((X.shape[0] - p_h + 1, X.shape[1] - p_w + 1))<br/>   <strong class="ny jd">for</strong> i <strong class="ny jd">in</strong> range(Y.shape[0]):<br/>       <strong class="ny jd">for</strong> j <strong class="ny jd">in</strong> range(Y.shape[1]):<br/>           <strong class="ny jd">if</strong> mode == 'max':<br/>               Y[i, j] = X[i: i + p_h, j: j + p_w].max()<br/>           <strong class="ny jd">elif</strong> mode == 'avg':<br/>               Y[i, j] = X[i: i + p_h, j: j + p_w].mean()<br/>   <strong class="ny jd">return</strong> Y</span><span id="fe6c" class="ma lj it ny b gy oi od l oe of">pool_size = (3, 3)<br/>pooled_image = pool2d(feature_map, pool_size, mode='max')</span></pre><p id="ef6d" class="pw-post-body-paragraph mo mp it mq b mr ns kd mt mu nt kg mw mf nu my mz mi nv nb nc ml nw ne nf ng im bi translated">下面，一个 3 <em class="og"> x </em> 3 卷积和一个用于<strong class="mq jd">垂直边缘检测</strong>的<strong class="mq jd">步距</strong>为 1(上面的例子)以及一个 3 <em class="og"> x </em> 3 最大池被可视化。请注意垂直线在滤镜贴图中是如何变得更加明显的(分隔形状的垂直边缘比其他边缘更清晰，即不那么模糊)。此外，池化操作会使图像变得更粗糙。</p><div class="ks kt ku kv gt ab cb"><figure class="nh kw oj nj nk nl nm paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><img src="../Images/229493f02e178631f0d9ab98b1922465.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*bYZxas3XUnQdLZDKhQhOvA.png"/></div></figure><figure class="nh kw oj nj nk nl nm paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><img src="../Images/4e3e5414545c1e9209c6f5e763f2038d.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*xhUPNiJt3ETFQt9Y5q80ag.png"/></div></figure><figure class="nh kw oj nj nk nl nm paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><img src="../Images/936bd7bd6b3c02d022a3ad0eda60965e.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*XYaoW1EC_E7CA-oNBN_dLQ.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk ok di ol nq"><strong class="bd nr">Left</strong>: Original MR image. <strong class="bd nr">Mid</strong>: Convolved image. <strong class="bd nr">Right</strong>: Convolved and maximum-pooled image. (images by author)</figcaption></figure></div><p id="a0eb" class="pw-post-body-paragraph mo mp it mq b mr ns kd mt mu nt kg mw mf nu my mz mi nv nb nc ml nw ne nf ng im bi translated">从上面的图像来看，病变无论如何都很难被发现，因为它们与周围的区域融合在一起。必须以某种方式设计滤波器(在训练阶段学习),使得损伤是特征图中的明显纹理。您也可以认为，使用其他 MR 成像模式<strong class="mq jd"> </strong>可以改善结果，但最终需要不同模式的组合和额外的高斯滤波版本来唯一识别病变。不同的图像模式堆叠在一起，充当输入中的单独通道。因此，卷积层的一般形状为:</p><pre class="ks kt ku kv gt nx ny nz oa aw ob bi"><span id="3921" class="ma lj it ny b gy oc od l oe of">[nx_filter, ny_filter, nz_filter, n_input_channels, n_filters]</span></pre><p id="342e" class="pw-post-body-paragraph mo mp it mq b mr ns kd mt mu nt kg mw mf nu my mz mi nv nb nc ml nw ne nf ng im bi translated">因此，单个卷积层的参数数量为:</p><pre class="ks kt ku kv gt nx ny nz oa aw ob bi"><span id="d8ef" class="ma lj it ny b gy oc od l oe of"><strong class="ny jd">### parameters for kernels/filters</strong><br/>p_f = n_in * (nx_f * ny_f * nz_f) * n_f</span><span id="7ce6" class="ma lj it ny b gy oi od l oe of"><strong class="ny jd">### parameters for biases (each filter has one bias term)</strong><br/>p_b = n_f</span><span id="62ef" class="ma lj it ny b gy oi od l oe of"><strong class="ny jd">### total number of parameters</strong><br/>p_total = p_f + p_b</span></pre><p id="43a6" class="pw-post-body-paragraph mo mp it mq b mr ns kd mt mu nt kg mw mf nu my mz mi nv nb nc ml nw ne nf ng im bi translated">假设有 3 个输入通道和 16 个形状滤波器(5 <em class="og"> x </em> 5 <em class="og"> x </em> 5)，该层的参数总数为:</p><pre class="ks kt ku kv gt nx ny nz oa aw ob bi"><span id="dc24" class="ma lj it ny b gy oc od l oe of">p_total = 3 * 16 * (5 * 5 * 5) + 16 = <strong class="ny jd">6016</strong></span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi om"><img src="../Images/2129b62f35e9a76736ac0005f92eb161.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-6shGHkafU20uQ7AtNFRgw.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk">An example of <strong class="bd nr">selective random sampling</strong>. (image by author)</figcaption></figure><p id="8ace" class="pw-post-body-paragraph mo mp it mq b mr ns kd mt mu nt kg mw mf nu my mz mi nv nb nc ml nw ne nf ng im bi translated">注意，对于体积图像，使用三维过滤器。如上所述，体积由几百万个体素组成，这使得当前处理整个体积是不可行的，并且必须使用子样本来代替(例如 80 <em class="og"> x </em> 80 <em class="og"> x </em> 80 个体素)。它在边界区域提供较少的上下文，这将导致较差的性能，但是它需要较少的计算能力。但是，最好以随机方式执行；由于类别的不平衡，通过<strong class="mq jd">选择性随机采样</strong>控制子体积中的类别分布很重要，即偶尔丢弃没有损伤的子体积。</p><h2 id="9053" class="ma lj it bd lk mb mc dn lo md me dp ls mf mg mh lu mi mj mk lw ml mm mn ly iz bi translated">模型架构</h2><p id="787b" class="pw-post-body-paragraph mo mp it mq b mr ms kd mt mu mv kg mw mf mx my mz mi na nb nc ml nd ne nf ng im bi translated">根据问题(例如，是否执行分类或分割)和图像维度(2D 或 3D)，有不同的 CNN 架构(也称为拓扑)；<a class="ae lh" href="https://en.wikipedia.org/wiki/U-Net" rel="noopener ugc nofollow" target="_blank"> <strong class="mq jd"> U-Net </strong> </a>，<a class="ae lh" href="https://arxiv.org/abs/1606.06650" rel="noopener ugc nofollow" target="_blank"> <strong class="mq jd"> 3D-U-Net </strong> </a>，<a class="ae lh" href="https://arxiv.org/abs/1606.04797" rel="noopener ugc nofollow" target="_blank"> <strong class="mq jd"> V-Net </strong> </a>是分割任务中比较知名的，而<a class="ae lh" href="https://arxiv.org/abs/1512.03385" rel="noopener ugc nofollow" target="_blank"> <strong class="mq jd"> ResNet </strong> </a>在分类任务中被证明是高性能的。它们由数百万个(10+以上)可训练参数组成。当前<a class="ae lh" href="https://smart-stats-tools.org/lesion-challenge" rel="noopener ugc nofollow" target="_blank">病灶分割的最高分</a>在 91.7–93.4%的范围内。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi on"><img src="../Images/4860387c9858f92067a1c60791fb7982.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xIkVFhw7WDICNUDSsfkFSQ.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk">Scheme of the <strong class="bd nr">V-Net </strong>for volumetric image segmentation (<a class="ae lh" href="https://github.com/gtancev/V-Net/blob/master/VNetDiagram.png" rel="noopener ugc nofollow" target="_blank">source</a>).</figcaption></figure><p id="51b0" class="pw-post-body-paragraph mo mp it mq b mr ns kd mt mu nt kg mw mf nu my mz mi nv nb nc ml nw ne nf ng im bi translated">V-Net 由具有规则卷积的部分组成，在这种情况下也称为<em class="og">向下</em>卷积，其生成特征图。在网络的另一部分，<em class="og"> up </em>卷积(也称为转置卷积)则相反。一个<em class="og">上</em>卷积是一个<em class="og">下</em>卷积的逆运算(卷积)——点击阅读更多关于<a class="ae lh" href="https://medium.com/activating-robotic-minds/up-sampling-with-transposed-convolution-9ae4f2df52d0" rel="noopener">的内容。在网络的末端，1 <em class="og"> x </em> 1 <em class="og"> x </em> 1 卷积移除剩余通道，并根据类别数量使用<strong class="mq jd"> sigmoid </strong>或<strong class="mq jd"> softmax </strong>激活函数为每个像素/体素分配类别标签。</a></p><div class="ks kt ku kv gt ab cb"><figure class="nh kw oj nj nk nl nm paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><img src="../Images/097ffb4ba4d2513b032694be0d25f22c.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*_H2ymVIP5_7vE95FIKPWCw.png"/></div></figure><figure class="nh kw oj nj nk nl nm paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><img src="../Images/276f6d126e783efa5af07d845d0a77f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*GToYD1UGRB8s32c_vUhM2g.png"/></div></figure><figure class="nh kw oj nj nk nl nm paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><img src="../Images/9f0d30563e2bad9d2f603e44c47a7ee8.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*ULfWqFTcl893EfehThDoqg.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk ok di ol nq"><strong class="bd nr">Left</strong>: Original T2-weighted image. <strong class="bd nr">Mid</strong>: Original mask. <strong class="bd nr">Right</strong>: Prediction. (images by author)</figcaption></figure></div><p id="f328" class="pw-post-body-paragraph mo mp it mq b mr ns kd mt mu nt kg mw mf nu my mz mi nv nb nc ml nw ne nf ng im bi translated">如上所述，肿瘤分割是<strong class="mq jd">不平衡数据集问题</strong>的一个例子，这使得开发适当的解决方案更加困难。在这种情况下，模型通常会将数据集中样本较少的类错误分类，在这里它将是一个病变像素。这个问题可以通过在<strong class="mq jd">损失函数</strong>的计算中给每个类的贡献分配权重来解决，该损失函数通常被公式化为(二元)<strong class="mq jd"> </strong> <a class="ae lh" href="https://en.wikipedia.org/wiki/Cross_entropy" rel="noopener ugc nofollow" target="_blank"> <strong class="mq jd">交叉熵</strong> </a>。校正不平衡的其他损失函数是可能的，例如<a class="ae lh" href="https://en.wikipedia.org/wiki/S%C3%B8rensen%E2%80%93Dice_coefficient" rel="noopener ugc nofollow" target="_blank"> <strong class="mq jd">骰子损失</strong> </a>。</p><pre class="ks kt ku kv gt nx ny nz oa aw ob bi"><span id="8cfb" class="ma lj it ny b gy oc od l oe of"><strong class="ny jd">### dice loss</strong></span><span id="c140" class="ma lj it ny b gy oi od l oe of"><strong class="ny jd">def</strong> dice_loss(output, target, axis=[1, 2, 3], smooth=1e-5):<br/>   inse = tf.reduce_sum(tf.multiply(output, target), axis=axis)<br/>   l = tf.reduce_sum(tf.multiply(output, output), axis=axis)<br/>   r = tf.reduce_sum(tf.multiply(target, target), axis=axis)<br/>   dice = (tf.constant(2.0) * tf.cast(inse, dtype=tf.float32) +<br/>   tf.constant(smooth)) / (tf.cast(l + r, dtype=tf.float32) +<br/>   tf.constant(smooth))                           <br/>   dice = tf.reduce_mean(dice)                           <br/>   <strong class="ny jd">return</strong> tf.constant(1.0) - dice</span></pre><p id="a7a9" class="pw-post-body-paragraph mo mp it mq b mr ns kd mt mu nt kg mw mf nu my mz mi nv nb nc ml nw ne nf ng im bi translated">除了纯卷积神经网络之外，还有受视频图像分割启发的发展。视频由在时域中相关的图像(也称为帧)组成，即单个帧在可能的许多时间步长上相互依赖。为了处理任何种类的序列数据(文本、音频、时间序列)，使用<a class="ae lh" href="https://en.wikipedia.org/wiki/Recurrent_neural_network" rel="noopener ugc nofollow" target="_blank"><strong class="mq jd"/></a>递归神经网络，例如作为<a class="ae lh" href="https://en.wikipedia.org/wiki/Long_short-term_memory" rel="noopener ugc nofollow" target="_blank">长短期记忆(LSTM) </a>单元，或<a class="ae lh" href="https://en.wikipedia.org/wiki/Gated_recurrent_unit" rel="noopener ugc nofollow" target="_blank">门控递归单元(GRU) </a>。通过将 MR 体积中的三维之一视为时间坐标，卷积<a class="ae lh" href="https://arxiv.org/abs/1506.07452" rel="noopener ugc nofollow" target="_blank"> LSTM </a>和<a class="ae lh" href="https://www.researchgate.net/publication/313074651_Multi-dimensional_Gated_Recurrent_Units_for_the_Segmentation_of_Biomedical_3D-Data" rel="noopener ugc nofollow" target="_blank"> GRU </a>实现已经被开发用于医学图像分析。</p><h2 id="7df4" class="ma lj it bd lk mb mc dn lo md me dp ls mf mg mh lu mi mj mk lw ml mm mn ly iz bi translated"><strong class="ak">数据扩充和规则化</strong></h2><p id="2aff" class="pw-post-body-paragraph mo mp it mq b mr ms kd mt mu mv kg mw mf mx my mz mi na nb nc ml nd ne nf ng im bi translated">虽然探索网络架构的空间很重要，但通过在模型中集成(即时)<a class="ae lh" rel="noopener" target="_blank" href="/data-augmentation-for-deep-learning-4fe21d1a4eb9"> <strong class="mq jd">数据增强</strong> </a>和<a class="ae lh" href="https://en.wikipedia.org/wiki/Regularization_%28mathematics%29" rel="noopener ugc nofollow" target="_blank"> <strong class="mq jd">正则化</strong> </a>技术，也可以实现更好的性能，这减少了方差并避免了过拟合(<a class="ae lh" href="https://en.wikipedia.org/wiki/Bias%E2%80%93variance_tradeoff" rel="noopener ugc nofollow" target="_blank"> <strong class="mq jd">偏差-方差权衡</strong> </a>)。数据扩充和正则化方法的目标是避免过度拟合，并开发一个概括良好的模型，即以高准确度/精确度/召回率预测以前没有见过的数据。一方面，可以通过从数据集中采样并对其应用变形、缩放或旋转等变换来创建合成数据；加上选择性随机采样，标记的训练数据量可以增加(如果你需要一个实现了这些特性的<strong class="mq jd">类</strong>，我可以把你带到我的 GitHub。<a class="ae lh" href="https://github.com/gtancev/Image-Data-Sampler" rel="noopener ugc nofollow" target="_blank"><strong class="mq jd"> </strong>另一方面，</a><a class="ae lh" href="http://proceedings.mlr.press/v28/wan13.html" rel="noopener ugc nofollow" target="_blank"><strong class="mq jd">drop connect</strong></a><strong class="mq jd"/>(是<a class="ae lh" href="https://patents.google.com/patent/US9406017B2/en" rel="noopener ugc nofollow" target="_blank"> <strong class="mq jd"> DropOut </strong> </a>)有助于单个神经元的不相关。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oo"><img src="../Images/be58ac913f3bc8206daea2255fe88317.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ct_N-CQPYMD145ob"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk">Photo by <a class="ae lh" href="https://unsplash.com/@ayahya09?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Ali Yahya</a> on <a class="ae lh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure></div></div>    
</body>
</html>