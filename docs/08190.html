<html>
<head>
<title>Exploring the full-text search index in Neo4j on a movies dataset</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在电影数据集上探索 Neo4j 中的全文搜索索引</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/exploring-the-full-text-search-index-in-neo4j-on-a-movies-dataset-3cddca69db7a?source=collection_archive---------11-----------------------#2019-11-09">https://towardsdatascience.com/exploring-the-full-text-search-index-in-neo4j-on-a-movies-dataset-3cddca69db7a?source=collection_archive---------11-----------------------#2019-11-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="937f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://neo4j.com/docs/operations-manual/current/performance/index-configuration/fulltext-search/" rel="noopener ugc nofollow" target="_blank">全文搜索索引</a>是在 Neo4j 版本 3.5 中引入的，由 Apache Lucene 支持索引。这篇博文的议程是介绍基本的 Lucene 查询语言，并描述如何在 Neo4j 中使用它。正如您将看到的，我们还可以将 Lucene 和 Cypher 结合起来操作结果。</p><p id="88ca" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我这篇博文的大部分灵感来自<a class="ae kl" href="https://twitter.com/ikwattro" rel="noopener ugc nofollow" target="_blank">克里斯托夫·威廉森</a>，他是<a class="ae kl" href="https://graphaware.com/" rel="noopener ugc nofollow" target="_blank"> Graphaware 团队</a>的一员。他很好地描述了 FTS 对像我这样的新手的使用，谢谢！</p><ul class=""><li id="d4e9" class="km kn iq jp b jq jr ju jv jy ko kc kp kg kq kk kr ks kt ku bi translated">博客:<a class="ae kl" href="https://graphaware.com/neo4j/2019/01/11/neo4j-full-text-search-deep-dive.html" rel="noopener ugc nofollow" target="_blank">深入 Neo4j 3.5 全文搜索</a></li><li id="221c" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk kr ks kt ku bi translated">网上研讨会:<a class="ae kl" href="https://www.youtube.com/watch?v=TFXoYQBHl4Q&amp;list=PL9Hl4pk2FsvUbsmdPrqTRF_DWvUb4z5AK&amp;index=24" rel="noopener ugc nofollow" target="_blank">生存还是毁灭。全文搜索提示和技巧。</a></li></ul><p id="d601" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们将使用 kaggle 上的<a class="ae kl" href="https://www.kaggle.com/Cornell-University/movie-dialog-corpus" rel="noopener ugc nofollow" target="_blank">电影对话语料库</a>数据集。它有丰富的元数据，因为它包含了 617 部不同电影中角色之间的所有对话。我有几篇使用该数据集的博客文章，但是首先，我们将只使用关于电影的数据来探索全文搜索索引功能。</p><h1 id="6ca0" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">图形模型</h1><figure class="lz ma mb mc gt md gh gi paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="gh gi ly"><img src="../Images/e6d3579dc0b1e6e1e85514789bf380df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O7p7Rac05iQ4rioYXR3ryQ.png"/></div></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk">Made using apcjones.com/arrows/</figcaption></figure><p id="0159" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们的图表中有两个标签(电影、电影标签)。它们通过 HAS_TAG 关系进行连接。电影可以有额外的属性，如发行年份、IMDB 评级和 IMDB 上的投票数。</p><p id="0279" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">创建约束</strong></p><p id="21f8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了优化导入和以后的查询，我们为电影和电影标签定义了唯一的约束。</p><pre class="lz ma mb mc gt mo mp mq mr aw ms bi"><span id="9837" class="mt lb iq mp b gy mu mv l mw mx">CREATE CONSTRAINT ON (m:Movie) ASSERT m.id IS UNIQUE;<br/>CREATE CONSTRAINT ON (m:MovieTag) ASSERT m.id IS UNIQUE;</span></pre><h2 id="59ac" class="mt lb iq bd lc my mz dn lg na nb dp lk jy nc nd lo kc ne nf ls kg ng nh lw ni bi translated">导入</h2><p id="b1de" class="pw-post-body-paragraph jn jo iq jp b jq nj js jt ju nk jw jx jy nl ka kb kc nm ke kf kg nn ki kj kk ij bi translated">在运行导入查询之前，将<em class="no">movie _ titles _ metadata . tsv</em>文件复制到<em class="no"> $Neo4j/import </em>文件夹中。</p><pre class="lz ma mb mc gt mo mp mq mr aw ms bi"><span id="fd9f" class="mt lb iq mp b gy mu mv l mw mx">LOAD CSV FROM "file:///movie_titles_metadata.tsv" as row FIELDTERMINATOR "\t"<br/>MERGE (m:Movie{id:row[0]})<br/>SET m.title = row[1],<br/>    m.release_year = toInteger(row[2]),<br/>    m.imdb_rating = toFloat(row[3]),<br/>    m.no_votes = toInteger(row[4])<br/>WITH m, apoc.convert.fromJsonList(<br/>          replace(row[5]," ",",")) as tags<br/>UNWIND tags as tag<br/>MERGE (mt:MovieTag{id:tag})<br/>MERGE (m)-[:HAS_TAG]-&gt;(mt)</span></pre><h1 id="db66" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">全文搜索索引</h1><p id="0eb6" class="pw-post-body-paragraph jn jo iq jp b jq nj js jt ju nk jw jx jy nl ka kb kc nm ke kf kg nn ki kj kk ij bi translated">简单来说，lucene 索引管道由两个步骤组成。第一步是“分析器”步骤，它负责文本的预处理。第二步，“索引器”将“分析器”的结果存储到索引中。</p><figure class="lz ma mb mc gt md gh gi paragraph-image"><div class="gh gi np"><img src="../Images/fd354d21619900cbcb9f201ba5614100.png" data-original-src="https://miro.medium.com/v2/resize:fit:1066/format:webp/1*latzBI-KPjAbNxc4n9dkPQ.jpeg"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk">Image from <a class="ae kl" href="https://www.tutorialspoint.com/lucene/lucene_indexing_process.htm" rel="noopener ugc nofollow" target="_blank">https://www.tutorialspoint.com/lucene/lucene_indexing_process.htm</a></figcaption></figure><p id="e769" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这篇博文中，我们将使用 Neo4j 中默认的“标准”分析器。它对非字母进行标记，并过滤掉英语停用词和标点符号。不做词干分析，但注意将可能的产品名称、URL 和电子邮件地址作为单个术语。</p><p id="5d3f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可以查看其他可用的分析仪。</p><pre class="lz ma mb mc gt mo mp mq mr aw ms bi"><span id="c41d" class="mt lb iq mp b gy mu mv l mw mx">CALL db.index.fulltext.listAvailableAnalyzers;</span></pre><h2 id="6404" class="mt lb iq bd lc my mz dn lg na nb dp lk jy nc nd lo kc ne nf ls kg ng nh lw ni bi translated">创建全文搜索索引</h2><p id="a9b8" class="pw-post-body-paragraph jn jo iq jp b jq nj js jt ju nk jw jx jy nl ka kb kc nm ke kf kg nn ki kj kk ij bi translated">首先，我们必须将所有包含数字的属性转换成字符串，因为我们不能索引整数或浮点数。索引过程会自动忽略数字。</p><p id="a924" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">IMDB 评级属性是一个只有一个小数点的数字。要将其转换为字符串，我们将首先将其乘以 10，然后将其转换为字符串。例如，评分 6.1 将被保存为“61”。</p><pre class="lz ma mb mc gt mo mp mq mr aw ms bi"><span id="e1fc" class="mt lb iq mp b gy mu mv l mw mx">MATCH (m:Movie)<br/>SET m.string_rating = toString(toInteger(m.imdb_rating * 10)),<br/>    m.string_release_year = toString(m.release_year)</span></pre><p id="80da" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当使用范围查询时，我们必须小心，因为排序是按照词汇顺序(字母顺序)进行的。在我们的例子中，所有的评级都在“00”到“99”之间，所以应该没有问题。例如，如果范围跨越到“150”，我们就会遇到一个问题，因为默认情况下，在“50”和“150”之间查找间隔将不起作用。在<a class="ae kl" href="https://brettscott.wordpress.com/2011/11/19/lucene-number-range-search-integers-floats/" rel="noopener ugc nofollow" target="_blank"> Lucene range 的博客文章</a>中描述了解决方法。为了允许在具有不同位数的数字之间进行范围搜索，我们需要对这些值进行预处理，在它们前面加上零，以确保所有的值都具有相同的位数。</p><p id="53d0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这个例子中，我们将所有的数字预处理为七位数。</p><pre class="lz ma mb mc gt mo mp mq mr aw ms bi"><span id="b4e8" class="mt lb iq mp b gy mu mv l mw mx">WITH 7 as total_length<br/>MATCH (m:Movie)<br/>WHERE exists (m.imdb_rating)<br/>WITH m, total_length, <br/>        toString(toInteger(m.imdb_rating * 10)) as string_rating<br/>WITH m, total_length — length(string_rating) as zeros, string_rating<br/>WITH m, apoc.text.join([x in range(1,zeros) | “0”],””) +    <br/>                                  string_rating as final_rating<br/>SET m.range_rating = final_rating</span></pre><p id="a3ff" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们创建“MovieIndex”索引，它包含带有标签 Movie 和四个指定属性的节点。第一个参数是索引的名称。第二个参数定义节点的标签，第三个参数定义我们想要索引的属性。</p><pre class="lz ma mb mc gt mo mp mq mr aw ms bi"><span id="b51b" class="mt lb iq mp b gy mu mv l mw mx">CALL db.index.fulltext.createNodeIndex(<br/>"MovieIndex",["Movie"],["title","string_rating","range_rating","string_release_year"])</span></pre><h2 id="9728" class="mt lb iq bd lc my mz dn lg na nb dp lk jy nc nd lo kc ne nf ls kg ng nh lw ni bi translated">Lucene 查询</h2><p id="fbc9" class="pw-post-body-paragraph jn jo iq jp b jq nj js jt ju nk jw jx jy nl ka kb kc nm ke kf kg nn ki kj kk ij bi translated">让我们看看一些基本的 lucene 查询操作符。</p><p id="89dc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">具体属性</strong></p><p id="3521" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">搜索标题中带有“梦”字的电影。</p><pre class="lz ma mb mc gt mo mp mq mr aw ms bi"><span id="1ce7" class="mt lb iq mp b gy mu mv l mw mx">CALL db.index.fulltext.queryNodes("MovieIndex", "title:dream") YIELD node, score<br/>RETURN node.title as title, score</span></pre><p id="ac46" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">结果</p><figure class="lz ma mb mc gt md"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="7ff7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">逻辑运算符</strong></p><p id="4202" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有两种逻辑运算符可用，“或”和“与”。</p><p id="9ce5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">搜索 1999 年或 2000 年发行的电影。</p><pre class="lz ma mb mc gt mo mp mq mr aw ms bi"><span id="6195" class="mt lb iq mp b gy mu mv l mw mx">CALL db.index.fulltext.queryNodes("MovieIndex", <br/>     "string_release_year:1999 or 2000") YIELD node, score<br/>RETURN node.title as title, score<br/>LIMIT 5</span></pre><p id="853b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">结果</p><figure class="lz ma mb mc gt md"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="4eec" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">单字符通配符</strong></p><p id="4495" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">单字符通配符操作符<code class="fe ns nt nu mp b">?</code>查找与被替换的单个字符匹配的术语。</p><pre class="lz ma mb mc gt mo mp mq mr aw ms bi"><span id="e28c" class="mt lb iq mp b gy mu mv l mw mx">CALL db.index.fulltext.queryNodes("MovieIndex", "title:th?") YIELD node, score<br/>RETURN node.title as title, score</span></pre><p id="6f79" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">结果</p><figure class="lz ma mb mc gt md"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="5895" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">需要注意的一点是,“黑客帝国”电影不会显示在结果中，因为标准分析器删除了像“the”这样的停用词。</p><p id="7fe4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">多字符通配符</strong></p><p id="436d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">多字符通配符运算符查找零个或多个字符。也可以像<code class="fe ns nt nu mp b">dre*am</code>一样把运算符放在词条中间。为了防止极其缓慢的通配符查询，术语不应该以通配符<code class="fe ns nt nu mp b">*dream</code>开头。</p><pre class="lz ma mb mc gt mo mp mq mr aw ms bi"><span id="417d" class="mt lb iq mp b gy mu mv l mw mx">CALL db.index.fulltext.queryNodes("MovieIndex", "title:drea*") YIELD node, score<br/>RETURN node.title as title, score</span></pre><p id="6267" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">结果</p><figure class="lz ma mb mc gt md"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="4e6f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">模糊搜索</strong></p><p id="eb31" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">模糊搜索通过使用数学公式来计算两个单词之间的相似度。计算相似性的常用方法是 Levenshtein 距离。</p><pre class="lz ma mb mc gt mo mp mq mr aw ms bi"><span id="16ce" class="mt lb iq mp b gy mu mv l mw mx">CALL db.index.fulltext.queryNodes("MovieIndex", "title:dream~") YIELD node, score<br/>RETURN node.title as title, score<br/>LIMIT 5</span></pre><p id="6bf6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">结果</p><figure class="lz ma mb mc gt md"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="9d0e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">范围查询</strong></p><p id="3e9d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Lucene 区分了具有包含或排除端点的范围操作符。</p><p id="01fe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">操作员:</p><p id="5e94" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">{} -&gt;不包括边缘</p><p id="1ad8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">[] -&gt;包括边缘</p><pre class="lz ma mb mc gt mo mp mq mr aw ms bi"><span id="d10d" class="mt lb iq mp b gy mu mv l mw mx">CALL db.index.fulltext.queryNodes("MovieIndex", "string_rating:[50 TO 99}") YIELD node, score<br/>RETURN node.title as title,score<br/>LIMIT 5</span></pre><p id="4326" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">结果</p><figure class="lz ma mb mc gt md"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="75da" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了说明为什么我们在进行范围搜索时需要相同位数的数字，让我们尝试下面的查询。</p><pre class="lz ma mb mc gt mo mp mq mr aw ms bi"><span id="222b" class="mt lb iq mp b gy mu mv l mw mx">CALL db.index.fulltext.queryNodes("MovieIndex", "string_rating:[50 TO 100]") YIELD node, score<br/>RETURN node.title as title,score</span></pre><p id="0219" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">直觉上你会认为它工作得很好，但是由于词汇排序的原因，情况并非如此。我们用来解决这个问题的变通方法是 range_rating 属性，其中的值以零为前缀，以允许在不同数量级的数字之间进行字母排序。</p><pre class="lz ma mb mc gt mo mp mq mr aw ms bi"><span id="657a" class="mt lb iq mp b gy mu mv l mw mx">CALL db.index.fulltext.queryNodes(“MovieIndex”, “range_rating:[0000050 TO 0000150]”) YIELD node, score<br/>RETURN node.title as title,score<br/>LIMIT 5</span></pre><p id="d129" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">结果</p><figure class="lz ma mb mc gt md"><div class="bz fp l di"><div class="nq nr l"/></div></figure><h2 id="80cb" class="mt lb iq bd lc my mz dn lg na nb dp lk jy nc nd lo kc ne nf ls kg ng nh lw ni bi translated">提高分数</h2><p id="a3e7" class="pw-post-body-paragraph jn jo iq jp b jq nj js jt ju nk jw jx jy nl ka kb kc nm ke kf kg nn ki kj kk ij bi translated">Lucene 查询语言还支持使用脱字符(^) <strong class="jp ir"> </strong>操作符提升结果的分数。</p><p id="897a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">提升 string_rating 介于 50 和 99 之间的结果。</p><pre class="lz ma mb mc gt mo mp mq mr aw ms bi"><span id="69e6" class="mt lb iq mp b gy mu mv l mw mx">CALL db.index.fulltext.queryNodes("MovieIndex", "title:dream string_rating:[50 TO 99]^2") YIELD node, score<br/>RETURN node.title as title,score<br/>LIMIT 5</span></pre><p id="1492" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">结果</p><figure class="lz ma mb mc gt md"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="1533" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">时间衰变</strong></p><p id="c946" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我在 Christophe Willemsen 的<a class="ae kl" href="https://www.youtube.com/watch?v=TFXoYQBHl4Q&amp;list=PL9Hl4pk2FsvUbsmdPrqTRF_DWvUb4z5AK&amp;index=24" rel="noopener ugc nofollow" target="_blank"> Nodes 2019 网络研讨会上看到一个 lucene time decay 查询，我想复制它。基本上，我们结合许多增强参数来实现时间衰减效果。为了说明这意味着什么，我们将使用<code class="fe ns nt nu mp b">apoc.text.join()</code>来生成九个助推参数。</a></p><pre class="lz ma mb mc gt mo mp mq mr aw ms bi"><span id="fc41" class="mt lb iq mp b gy mu mv l mw mx">RETURN apoc.text.join([<br/> x in range(0,8) | <br/> "string_release_date:" + toString((date().year - x)) + "^" + toString(10-x)<br/>]," ")</span></pre><p id="1422" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">结果</p><pre class="lz ma mb mc gt mo mp mq mr aw ms bi"><span id="aeb1" class="mt lb iq mp b gy mu mv l mw mx">string_release_date:2019^10 string_release_date:2018^9 string_release_date:2017^8 string_release_date:2016^7 string_release_date:2015^6 string_release_date:2014^5 string_release_date:2013^4 string_release_date:2012^3 string_release_date:2011^2</span></pre><p id="bc5f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可以看到，2019 年上映的电影将增加 10 倍，2018 年的电影将增加 9 倍，以此类推。</p><p id="b415" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">总结这篇博文，让我们在一个查询中结合评分提升和时间衰减效果。为了让你知道以后你可以用 cypher 处理结果，让我们添加一个过滤器，只返回惊悚片。</p><pre class="lz ma mb mc gt mo mp mq mr aw ms bi"><span id="5059" class="mt lb iq mp b gy mu mv l mw mx">WITH apoc.text.join([x in range(0,10) | <br/>"string_release_date:" + toString((date().year — x)) + "^" +   <br/>  toString(10-x)]," ") as time_decay<br/>CALL db.index.fulltext.queryNodes("MovieIndex", "title:dream string_rating:[50 TO 99]^2 "+ time_decay) YIELD node, score<br/>// filter only thrillers<br/>MATCH (node)-[:HAS_TAG]-&gt;(:MovieTag{id:'thriller'})<br/>RETURN node.title as title,score<br/>LIMIT 5</span></pre><p id="1aa0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">结果</p><figure class="lz ma mb mc gt md"><div class="bz fp l di"><div class="nq nr l"/></div></figure><h1 id="563e" class="la lb iq bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">结论</h1><p id="2a46" class="pw-post-body-paragraph jn jo iq jp b jq nj js jt ju nk jw jx jy nl ka kb kc nm ke kf kg nn ki kj kk ij bi translated">全文搜索是一个非常受欢迎的特性，它可以帮助我们开发更好更快的 Neo4j 应用程序，还可以解决其他问题。如果您有任何问题或反馈，请加入<a class="ae kl" href="https://community.neo4j.com/" rel="noopener ugc nofollow" target="_blank"> Neo4j 社区论坛</a>。</p><p id="4452" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="no">所有代码在</em><a class="ae kl" href="https://github.com/tomasonjo/blogs/tree/master/Explore_full_text_search" rel="noopener ugc nofollow" target="_blank"><em class="no">Github</em></a><em class="no">上都有。</em></p></div></div>    
</body>
</html>