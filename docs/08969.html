<html>
<head>
<title>A simple trick for exploratory data analysis</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">探索性数据分析的一个简单技巧</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/a-simple-trick-for-exploratory-data-analysis-35f2fa05764b?source=collection_archive---------27-----------------------#2019-11-29">https://towardsdatascience.com/a-simple-trick-for-exploratory-data-analysis-35f2fa05764b?source=collection_archive---------27-----------------------#2019-11-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="8256" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您很难理解您的数据，您可以尝试使用这些超级基础的数据分析工具，例如 python、SQL 和 excel 数据透视表。最终的结果是类似仪表板的表格，使您能够通过切片和切块来挖掘可操作的洞察力。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/f697520bf1472e0673d993dd5731a582.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iaNFcnspW5gizmSa5awteA.png"/></div></div></figure><h2 id="8f3d" class="kx ky iq bd kz la lb dn lc ld le dp lf jy lg lh li kc lj lk ll kg lm ln lo lp bi translated">那么首先要做什么呢？当然，<strong class="ak">获取数据。</strong></h2><p id="979d" class="pw-post-body-paragraph jn jo iq jp b jq lq js jt ju lr jw jx jy ls ka kb kc lt ke kf kg lu ki kj kk ij bi translated">本文中使用的数据源是来自<strong class="jp ir"> UCI 机器学习库的一个银行机构的直接营销活动(大约#41K 记录)。<br/> </strong>然后，用 pandas 把 CSV 文件读入 DataFrame。<br/>~<a class="ae lv" href="https://archive.ics.uci.edu/ml/datasets/Bank+Marketing" rel="noopener ugc nofollow" target="_blank">https://archive.ics.uci.edu/ml/datasets/Bank+Marketing</a></p><pre class="km kn ko kp gt lw lx ly lz aw ma bi"><span id="3274" class="kx ky iq lx b gy mb mc l md me">import pandas as pd<br/>bank_cust_df = pd.read_csv('../dat/bank-additional-full.csv', sep = ',')<br/>bank_cust_df.head(10)</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mf"><img src="../Images/c36c6b1a53e918ed8987367c6fb88d7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2uzdRFCGCVk8vmatO26O2Q.jpeg"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk">First 10 rows of <strong class="bd mk">bank_cust_df</strong></figcaption></figure><p id="d8b0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">根据数据集描述，我们知道银行客户数据与基于电话的电话营销活动有关，并且与定期存款的<em class="ml">预订</em> <em class="ml">的结果有关。(出于演示目的，我将仅使用人口统计相关数据，并跳过下面展示中的数据清理步骤。)</em></p><pre class="km kn ko kp gt lw lx ly lz aw ma bi"><span id="3312" class="kx ky iq lx b gy mb mc l md me">+---------------+--------------------------------------------+<br/>| Features Name | Features Description                       |<br/>+---------------+--------------------------------------------+<br/>| age           | numeric                                    |<br/>| job           | type of job (blue-collar, entrepreneur...) |<br/>| marital       | marital status (married, singe...)         |<br/>| education     | education (high school,university...)      |<br/>| default       | has credit in default? (Y/N)               |<br/>| housing       | has housing loan? (Y/N)                    |<br/>| loan          | has personal loan? (Y/N)                   |<br/><strong class="lx ir">| y             | has subscribed a term deposit?  (Y/N)      |</strong><br/>+---------------+--------------------------------------------+</span></pre><p id="798d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，我们需要隔离必要的列，并了解数据的样子。</p><h2 id="b649" class="kx ky iq bd kz la lb dn lc ld le dp lf jy lg lh li kc lj lk ll kg lm ln lo lp bi translated"><strong class="ak">使用 SQL 将数据汇总成汇总格式</strong></h2><pre class="km kn ko kp gt lw lx ly lz aw ma bi"><span id="f464" class="kx ky iq lx b gy mb mc l md me"># pandasql needed to run SQL with the pandas DataFrame<br/># <a class="ae lv" href="https://pypi.org/project/pandasql/" rel="noopener ugc nofollow" target="_blank">https://pypi.org/project/pandasql/</a></span><span id="79af" class="kx ky iq lx b gy mm mc l md me">from pandasql import sqldf<br/>pysqldf = lambda q: sqldf(q, globals())</span></pre><p id="fd00" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">聚合字段的基本思想是创建您想要浏览的字段的汇总表。例如，下面的代码将婚姻状况和教育与婚姻状况计数相加。</p><pre class="km kn ko kp gt lw lx ly lz aw ma bi"><span id="7978" class="kx ky iq lx b gy mb mc l md me">sql = """<br/>select <br/>--==================<br/>-- Category Features<br/>--==================<br/>job<br/>,education<br/>,count(*) as cnt<br/>--=============================<br/>-- Summarized Category Features<br/>--=============================<br/>,sum(case when marital = "divorced" then 1 else 0 end) as m_divorced<br/>,sum(case when marital = "married" then 1 else 0 end) as m_married<br/>,sum(case when marital = "single" then 1 else 0 end) as m_single<br/>,sum(case when marital = "unknown" then 1 else 0 end) as m_unknown<br/>from bank_cust_df<br/>--===============================================<br/>-- in this case, there are 2 columns to summarize<br/>--===============================================<br/>group by 1,2<br/>;<br/>"""<br/>agg_df = pysqldf(sql)<br/>agg_df.head(20)</span></pre><p id="8f9f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，您将得到一个汇总表<strong class="jp ir"> agg_df </strong>，如下所示，包含工作和教育的所有可能组合。通过每种组合，您还可以拥有不同婚姻状况的客户数量。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mn"><img src="../Images/134ed41144b1bb61b482501df89d9c80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gTP2G7NYaptK-oY7IXJvgA.jpeg"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk">Example on aggregated table</figcaption></figure><p id="294a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面的<strong class="jp ir">全代码</strong>生成整个汇总表:</p><pre class="km kn ko kp gt lw lx ly lz aw ma bi"><span id="bb89" class="kx ky iq lx b gy mb mc l md me">sql = """<br/>select <br/>y as subscribed<br/>,case when age &lt;= 18 then "Below 18"<br/>      when age &lt;= 25 then "19 - 25"<br/>      when age &lt;= 35 then "26 - 35"<br/>      when age &lt;= 45 then "36 - 45"<br/>      when age &lt;= 55 then "46 - 55"<br/>      when age &gt;  55 then "55 +" end as age_group<br/>,job<br/>,education<br/>,marital<br/>,housing<br/>,loan</span><span id="1f7d" class="kx ky iq lx b gy mm mc l md me">,count(*) as cnt</span><span id="d8f6" class="kx ky iq lx b gy mm mc l md me">,sum(case when y = "yes" then 1 else 0 end) as subscribed_y<br/>,sum(case when y = "no" then 1 else 0 end) as subscribed_n</span><span id="22e2" class="kx ky iq lx b gy mm mc l md me">,sum(case when age &lt;= 18 then 1 else 0 end) as age_18<br/>,sum(case when age &lt;= 25 then 1 else 0 end) as age_25<br/>,sum(case when age &lt;= 35 then 1 else 0 end) as age_35<br/>,sum(case when age &lt;= 45 then 1 else 0 end) as age_45<br/>,sum(case when age &lt;= 55 then 1 else 0 end) as age_55<br/>,sum(case when age &gt; 55 then 1 else 0 end) as age_ge_55</span><span id="c459" class="kx ky iq lx b gy mm mc l md me">,sum(case when job = "admin." then 1 else 0 end) as job_ad<br/>,sum(case when job = "blue-collar" then 1 else 0 end) as job_blue<br/>,sum(case when job = "entrepreneur" then 1 else 0 end) as job_entre<br/>,sum(case when job = "housemaid" then 1 else 0 end) as job_house<br/>,sum(case when job = "management" then 1 else 0 end) as job_mgt<br/>,sum(case when job = "retired" then 1 else 0 end) as job_reti<br/>,sum(case when job = "self-employed" then 1 else 0 end) as job_self<br/>,sum(case when job = "services" then 1 else 0 end) as job_serv<br/>,sum(case when job = "student" then 1 else 0 end) as job_std<br/>,sum(case when job = "technician" then 1 else 0 end) as job_tech<br/>,sum(case when job = "unemployed" then 1 else 0 end) as job_unem<br/>,sum(case when job = "unknown" then 1 else 0 end) as job_un</span><span id="ba91" class="kx ky iq lx b gy mm mc l md me">,sum(case when marital = "divorced" then 1 else 0 end) as m_divorced<br/>,sum(case when marital = "married" then 1 else 0 end) as m_married<br/>,sum(case when marital = "single" then 1 else 0 end) as m_single<br/>,sum(case when marital = "unknown" then 1 else 0 end) as m_un</span><span id="3843" class="kx ky iq lx b gy mm mc l md me">,sum(case when education = "basic.4y" then 1 else 0 end) as edu_4y<br/>,sum(case when education = "basic.6y" then 1 else 0 end) as edu_6y<br/>,sum(case when education = "basic.9y" then 1 else 0 end) as edu_9y<br/>,sum(case when education = "high.school" then 1 else 0 end) as edu_high<br/>,sum(case when education = "illiterate" then 1 else 0 end) as edu_illi<br/>,sum(case when education = "professional.course" then 1 else 0 end) as edu_pro<br/>,sum(case when education = "university.degree" then 1 else 0 end) as edu_ud<br/>,sum(case when education = "unknown" then 1 else 0 end) as edu_un</span><span id="35fc" class="kx ky iq lx b gy mm mc l md me">,sum(case when housing = "yes" then 1 else 0 end) as housing_y<br/>,sum(case when housing = "no" then 1 else 0 end) as housing_n<br/>,sum(case when housing = "unknown" then 1 else 0 end) as housing_un</span><span id="f5aa" class="kx ky iq lx b gy mm mc l md me">,sum(case when loan = "yes" then 1 else 0 end) as loan_y<br/>,sum(case when loan = "no" then 1 else 0 end) as loan_n<br/>,sum(case when loan = "unknown" then 1 else 0 end) as loan_un<br/>from bank_cust_df<br/>group by 1,2,3,4,5,6,7<br/>;<br/>"""</span><span id="751e" class="kx ky iq lx b gy mm mc l md me">agg_df = pysqldf(sql)<br/>agg_df.head(20)</span></pre><p id="bbf7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">结果聚集表具有#3，980 条记录，共 45 列(45 列中的 7 列是特征列；其他为汇总栏)。创建这样的聚合表的一个优点是防止敏感的客户数据泄露，因为所有数据都已经汇总。</p><h2 id="e644" class="kx ky iq bd kz la lb dn lc ld le dp lf jy lg lh li kc lj lk ll kg lm ln lo lp bi translated">通过创建简单的 excel 数据透视仪表板实现数据可视化</h2><p id="c9cc" class="pw-post-body-paragraph jn jo iq jp b jq lq js jt ju lr jw jx jy ls ka kb kc lt ke kf kg lu ki kj kk ij bi translated">接下来，将聚合表导出到 CSV。不直接导出到 excel 文件的原因是为了防止记录超出 Excel 限制(根据版本不同，是#65，536 还是# 1，048，576)。</p><pre class="km kn ko kp gt lw lx ly lz aw ma bi"><span id="2d1d" class="kx ky iq lx b gy mb mc l md me"># Export the csv file to out folder<br/>agg_df.to_csv('..\out\summ.csv',index=False)</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mo"><img src="../Images/3c2bcdd8280f2950640e9f54b32b6c00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8tJj3LXHMaPAUhO0ewTzgQ.png"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk">Exported summ.csv open in excel</figcaption></figure><p id="b636" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">再创建一个名为 summary.xlsx 的 excel 文件，使用 excel 内置函数(Data &gt; From Text/CSV)添加与 summ.csv 的数据连接。数据导入后，使用导入的数据作为数据源创建数据透视表。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mp"><img src="../Images/d76811e8068b48114237a215b5b92941.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YOOYV-B8rv5YjOW-YBPyPw.png"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk">import summ.csv</figcaption></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mq"><img src="../Images/da2832f41ccafffc853626806122a717.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jFopMZAja7Oei7rgdI3oaA.png"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk">Load the data with comma as the delimiter</figcaption></figure><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/a9d19bc1989c04124d86286ddb9cbbc0.png" data-original-src="https://miro.medium.com/v2/resize:fit:770/format:webp/1*9vRd34iqk4BEnmUPu_nBVg.png"/></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk">Using summ table as a data source</figcaption></figure><p id="4e3e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">根据特性类型放置字段，<br/> -特性列&gt;过滤区<br/> -汇总列&gt;值区<br/> -订阅的&gt;列<br/>-σ值&gt;行</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/b482b1e933d902a62e4e17e4a9ba5d50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1114/format:webp/1*QHgM1v0suaRiQp9fNd1blw.png"/></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk">Pivot Table fields setting</figcaption></figure><p id="1a17" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，将该字段重命名为有意义的标题，并对其应用条件格式，这样就完成了一个带有特色过滤器的清晰的仪表板，并且可以更容易地显示客户数据的分布。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mt"><img src="../Images/223f8f942be9b23f9efca87df433d077.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fc97MNUEI_DrkBwyA8dJwg.png"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk">Dashboard-like table</figcaption></figure><h2 id="9e8f" class="kx ky iq bd kz la lb dn lc ld le dp lf jy lg lh li kc lj lk ll kg lm ln lo lp bi translated">浏览数据的最简单方法</h2><p id="1f5b" class="pw-post-body-paragraph jn jo iq jp b jq lq js jt ju lr jw jx jy ls ka kb kc lt ke kf kg lu ki kj kk ij bi translated">现在，您可以创建一个简单的仪表板表，以便更好地了解您的数据，而无需任何花哨的分析工具。</p><p id="8ab8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，如果您拥有的数据少于 100 万行，我建议您在您的任务中充分利用上面的探索方法。接下来你要做的只是简单地切片和切块，并搜索任何特殊的模式和见解。</p></div></div>    
</body>
</html>