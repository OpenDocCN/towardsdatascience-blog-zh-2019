<html>
<head>
<title>Installing OpenCV in PiZero W</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在 PiZero W 中安装 OpenCV</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/installing-opencv-in-pizero-w-8e46bd42a3d3?source=collection_archive---------4-----------------------#2019-08-09">https://towardsdatascience.com/installing-opencv-in-pizero-w-8e46bd42a3d3?source=collection_archive---------4-----------------------#2019-08-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="b3cb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们大多数人在 Pi 中安装 openCV 时都遇到过问题。在这篇博客中，我将一步一步地告诉你如何在你的 pi-zero W 中安装 opencv。</p><p id="0ab5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">虽然 Pi Zero 对于高级视频处理来说不够快，但它仍然是一个很好的工具，可以用来学习计算机视觉和 OpenCV 的基础知识。我建议你晚上继续关注这个博客，因为仅仅编译 OpenCV 就需要 12 个多小时。</p><p id="2be8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们开始…</p><h1 id="322e" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated"><strong class="ak">要求:</strong></h1><p id="5d9d" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">1&gt; pi 零 W 硬件</p><p id="51d8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2&gt; SD 卡(最低 16 GB)</p><p id="5290" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">3 &gt;任何安装在你的 pi zero 上的 Raspbian 操作系统(我用过 Raspbian Buster)</p><p id="2806" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">假设您有给定的需求，让我们开始设置。</p><h1 id="31e1" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated"><strong class="ak">第一步:文件系统扩展:</strong></h1><p id="c1f9" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">很少再需要扩展文件系统，因为 NOOBs 和 Raspbian 的独立安装都会在第一次启动时自动扩展文件系统。但是，为了确保系统已扩展，请运行以下命令:</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="888f" class="ly kn iq lu b gy lz ma l mb mc">pi@raspberrypi:~ $ <!-- -->raspi-config --expand-rootfs</span></pre><h1 id="844a" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated"><strong class="ak">第二步:增加交换空间</strong></h1><p id="d0a9" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated"><strong class="jp ir">交换空间</strong>是硬盘驱动器(HDD)的一部分，用于虚拟内存。有一个<strong class="jp ir">交换文件</strong>允许你的计算机操作系统假装你有比实际更多的内存。这将增加 openCV 的编译过程。否则你会以内存耗尽的错误结束。</p><p id="6b64" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要增加交换大小，请使用以下命令打开 pi zero 的交换文件:</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="a4fd" class="ly kn iq lu b gy lz ma l mb mc">pi@raspberrypi:~ $ sudo nano /etc/dphys-swapfile</span></pre><p id="c8df" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">转到交换大小，并将其从 100 更改为 2048。如下图所示。</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="b769" class="ly kn iq lu b gy lz ma l mb mc">.<br/>.<br/>.<br/># where we want the swapfile to be, this is the default<br/>#CONF_SWAPFILE=/var/swap</span><span id="a171" class="ly kn iq lu b gy md ma l mb mc"># set size to absolute value, leaving empty (default) then uses computed value<br/>#   you most likely don't want this, unless you have an special disk situation<br/>#CONF_SWAPSIZE=100<br/>CONF_SWAPSIZE=2048<br/>.<br/>.<br/>.</span></pre><p id="aa57" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">重启你的系统。</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="2008" class="ly kn iq lu b gy lz ma l mb mc">pi@raspberrypi:~ $ sudo reboot</span></pre><h1 id="9db4" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated"><strong class="ak">步骤 3:安装依赖关系:</strong></h1><p id="bab2" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">首先让我们更新和升级现有的软件包:</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="dac2" class="ly kn iq lu b gy lz ma l mb mc">pi@raspberrypi:~ $ sudo apt-get update<br/>pi@raspberrypi:~ $ sudo apt-get upgrade</span></pre><p id="2f52" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您使用 Raspbian Buster，请运行以下命令:</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="e3e3" class="ly kn iq lu b gy lz ma l mb mc">pi@raspberrypi:~ $sudo apt update<br/>pi@raspberrypi:~ $sudo apt upgrade</span></pre><p id="c687" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">出现提示时，输入“Y”。</p><p id="964e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">安装开发人员工具:</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="5de5" class="ly kn iq lu b gy lz ma l mb mc">pi@raspberrypi:~ $ sudo apt-get install build-essential cmake pkg-config</span></pre><p id="51fd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">安装 IO 包:</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="8a5a" class="ly kn iq lu b gy lz ma l mb mc">pi@raspberrypi:~ $ sudo apt-get install libjpeg-dev libtiff5-dev libjasper-dev libpng12-dev</span></pre><p id="2e84" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以及一些视频 I/O 包(尽管您不太可能使用 Raspberry Pi Zero 进行大量视频处理):</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="1b43" class="ly kn iq lu b gy lz ma l mb mc">pi@raspberrypi:~ $ sudo apt-get install libavcodec-dev libavformat-dev libswscale-dev libv4l-dev</span><span id="09ca" class="ly kn iq lu b gy md ma l mb mc">pi@raspberrypi:~ $ sudo apt-get install libxvidcore-dev libx264-dev</span></pre><p id="addf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们需要为 OpenCV 的 GUI 界面安装 GTK 开发库:</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="012f" class="ly kn iq lu b gy lz ma l mb mc">pi@raspberrypi:~ $ sudo apt-get install libgtk2.0-dev</span></pre><p id="bfe9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">OpenCV 利用的常规优化包:</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="4ffd" class="ly kn iq lu b gy lz ma l mb mc">pi@raspberrypi:~ $sudo apt-get install libatlas-base-dev gfortran</span></pre><h1 id="781b" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">步骤 4:获取 OpenCV 源代码</h1><p id="113e" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">所以现在我们有了所有的依赖关系。让我们从 opencv github 中拉出 OpenCV 的发布。</p><p id="4333" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请注意，我已经发布了 3.4.1 版本。您也可以尝试其他版本。只需替换发布版本号。</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="c460" class="ly kn iq lu b gy lz ma l mb mc">pi@raspberrypi:~ $cd ~</span><span id="c207" class="ly kn iq lu b gy md ma l mb mc">pi@raspberrypi:~ $ wget -O opencv.zip <a class="ae me" href="https://github.com/Itseez/opencv/archive/3.0.0.zip" rel="noopener ugc nofollow" target="_blank">https://github.com/Itseez/opencv/archive/3.4.1.zip</a></span><span id="cb56" class="ly kn iq lu b gy md ma l mb mc">pi@raspberrypi:~ $unzip opencv.zip</span></pre><p id="48ab" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们一起抓取 opencv Contrib，因为 SIFT 和 SURF 已经从 opencv 的默认安装中移除:</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="b567" class="ly kn iq lu b gy lz ma l mb mc">pi@raspberrypi:~ $ wget -O opencv_contrib.zip <a class="ae me" href="https://github.com/Itseez/opencv_contrib/archive/3.0.0.zip" rel="noopener ugc nofollow" target="_blank">https://github.com/Itseez/opencv_contrib/archive/3.4.1.zip</a></span><span id="65fd" class="ly kn iq lu b gy md ma l mb mc">pi@raspberrypi:~ $ unzip opencv_contrib.zip</span></pre><p id="be92" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦两个存储库都被下载并在您的系统中展开，最好将它们删除以释放一些空间。</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="dbe4" class="ly kn iq lu b gy lz ma l mb mc">pi@raspberrypi:~ $ rm opencv.zip opencv_contrib.zip</span></pre><h1 id="70ce" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">步骤 5:设置 Python</h1><p id="65c7" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">如果您的系统中已经安装了 python2.7，您可以跳过这一步，否则请安装 Python 2.7 头文件，以便我们可以编译 OpenCV + Python 绑定:</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="961c" class="ly kn iq lu b gy lz ma l mb mc">pi@raspberrypi:~ $ sudo apt-get install python2.7-dev</span></pre><p id="17d8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">之后安装 pip，一个 python 包管理器。</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="5da5" class="ly kn iq lu b gy lz ma l mb mc">pi@raspberrypi:~ $ wget <a class="ae me" href="https://bootstrap.pypa.io/get-pip.py" rel="noopener ugc nofollow" target="_blank">https://bootstrap.pypa.io/get-pip.py</a></span><span id="ba15" class="ly kn iq lu b gy md ma l mb mc">pi@raspberrypi:~ $ sudo python get-pip.py</span></pre><p id="e54f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">构建 Python + OpenCV 绑定的唯一要求是安装了<a class="ae me" href="http://www.numpy.org/" rel="noopener ugc nofollow" target="_blank"> NumPy </a>，所以使用 pip 安装 NumPy:</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="a5b0" class="ly kn iq lu b gy lz ma l mb mc">pi@raspberrypi:~ $ pip install numpy</span></pre><h1 id="2839" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">步骤 6:为 Raspberry Pi Zero 编译并安装 OpenCV</h1><p id="8395" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">现在我们准备编译和安装 OpenCV。</p><p id="dadb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">构建文件:</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="6dfa" class="ly kn iq lu b gy lz ma l mb mc">pi@raspberrypi:~ $ cd ~/opencv-3.4.1/</span><span id="387c" class="ly kn iq lu b gy md ma l mb mc">pi@raspberrypi:~ $ mkdir build</span><span id="d7d6" class="ly kn iq lu b gy md ma l mb mc">pi@raspberrypi:~ $ cd build</span><span id="3f19" class="ly kn iq lu b gy md ma l mb mc">pi@raspberrypi:~ $ cmake -D CMAKE_BUILD_TYPE=RELEASE \</span><span id="06e4" class="ly kn iq lu b gy md ma l mb mc">    -D CMAKE_INSTALL_PREFIX=/usr/local \</span><span id="16b0" class="ly kn iq lu b gy md ma l mb mc">    -D INSTALL_C_EXAMPLES=ON \</span><span id="161f" class="ly kn iq lu b gy md ma l mb mc">    -D INSTALL_PYTHON_EXAMPLES=ON \</span><span id="23b2" class="ly kn iq lu b gy md ma l mb mc">    -D OPENCV_EXTRA_MODULES_PATH=~/opencv_contrib-3.0.0/modules \</span><span id="0509" class="ly kn iq lu b gy md ma l mb mc">    -D BUILD_EXAMPLES=ON ..</span></pre><p id="c1d6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在是编译的时候了。请记住，自行编译可能需要 9 个多小时，有时您可能会认为系统已经冻结。但是不要失去耐心，让系统工作，直到你看不到任何错误。</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="f8ea" class="ly kn iq lu b gy lz ma l mb mc">pi@raspberrypi:~$ make</span></pre><p id="9879" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">假设您的文件编译成功，没有任何错误，现在将使用以下命令安装 opencv。</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="2475" class="ly kn iq lu b gy lz ma l mb mc">pi@raspberrypi:~$ sudo make install</span><span id="53fa" class="ly kn iq lu b gy md ma l mb mc">pi@raspberrypi:~$ sudo ldconfig</span></pre><h1 id="74f1" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">步骤 7:完成安装</h1><p id="4af1" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">检查 cv2.so 文件的路径:</p><p id="56d0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">查找/-name“cv2 . so”</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="d4af" class="ly kn iq lu b gy lz ma l mb mc">pi@raspberrypi:~$ /usr/local/python/cv2/python-2.7/cv2.so</span></pre><p id="7432" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在您所要做的就是将 cv2.so 文件(绑定文件)符号链接到 python lib 的站点包中。</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="6878" class="ly kn iq lu b gy lz ma l mb mc">pi@raspberrypi:~$ cd /usr/local/lib/python2.7/site-packages</span></pre><p id="cbe2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">运行以下命令:ln-s[cv2 . so 文件的路径] cv2.so。在我的例子中，如下所示:</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="40d3" class="ly kn iq lu b gy lz ma l mb mc">pi@raspberrypi:~$/usr/local/lib/python2.7/site-packages $ ln -s /usr/local/python/cv2/python-2.7/cv2.so cv2.so</span></pre><h1 id="7d5f" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">步骤 8:验证您的 OpenCV 安装</h1><p id="19ec" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated">现在是时候验证我们的 openCV 安装了。</p><p id="8e21" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">启动 Python shell 并导入 OpenCV 绑定:</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="7c61" class="ly kn iq lu b gy lz ma l mb mc">pi@raspberrypi:<!-- -->/usr/local/lib/python2.7/site-packages<!-- -->$ python</span><span id="4387" class="ly kn iq lu b gy md ma l mb mc">import cv2</span><span id="2458" class="ly kn iq lu b gy md ma l mb mc">&gt;&gt;&gt; cv2.__version__</span><span id="f353" class="ly kn iq lu b gy md ma l mb mc">3.4.1’</span></pre><p id="a7db" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在你已经在你的系统上安装了一个新的 openCV。现在导出 python 可以从任何地方访问它的路径。</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="6982" class="ly kn iq lu b gy lz ma l mb mc">pi@raspberrypi:~$ <!-- -->export PYTHONPATH=/usr/local/lib/python2.7/site-packages:$PYTHONPATH</span></pre><p id="16d1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，您可以删除 opencv-3.4.1 和 opencv_contrib-3.4.1 目录，释放文件系统上的大量空间:</p><p id="8361" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是在运行这个命令之前要小心！在清空这些目录之前，确保 OpenCV 已经正确安装在你的系统上，否则你将不得不重新开始(漫长的，12 个多小时)编译<em class="kl">！</em></p></div><div class="ab cl mf mg hu mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="ij ik il im in"><p id="7700" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你遇到任何错误，请在评论区告诉我。</p><p id="39b2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您想要 python3 的 OpenCV，那么您可以简单地使用 sym-link 将绑定文件指向您的 python3 站点包并导出路径</p></div></div>    
</body>
</html>