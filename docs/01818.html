<html>
<head>
<title>Transforming BigQuery JSON API responses recursively</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">递归转换 BigQuery JSON API 响应</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/transforming-bigquery-json-api-responses-recursively-5c462f5b01?source=collection_archive---------31-----------------------#2019-03-25">https://towardsdatascience.com/transforming-bigquery-json-api-responses-recursively-5c462f5b01?source=collection_archive---------31-----------------------#2019-03-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a2e2" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">从字段/值行嵌套构建键值对</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/ab9a33c2890029eec1c55d2c9d969189.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VNu9dfxo8kVsAl2FrcxEEg.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">La Sagrada Familia, Barcelona, by <strong class="bd ky">Paolo Nicolello.</strong></figcaption></figure><p id="f948" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">跟我一起说:“嵌套的 JSON 很难用！”。我说的对吗？当然可以！既然我们已经说清楚了，我只想说我完全相信 JSON。它是合乎逻辑的，是通用的，大多数语言都用它来创建快速访问的散列映射风格的数据结构。所有人的胜利！</p><p id="fc1a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">直到你筑巢。</p><p id="9fab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一群相信嵌套 JSON 的好处的人和那些相信扁平 JSON 是他们选择 API 有效负载幸福的圣杯的人。这场无声的战斗如此激烈，以至于许多扁平化技术充斥着黑客的宝库，如<a class="ae lv" rel="noopener" target="_blank" href="/flattening-json-objects-in-python-f5343c794b10"> <em class="lw">递归方式</em> </a>和<a class="ae lv" href="https://github.com/ebendutoit/json_flattener" rel="noopener ugc nofollow" target="_blank"> <em class="lw">非递归方式</em> </a>等方法。</p></div><div class="ab cl lx ly hx lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="im in io ip iq"><h1 id="01d0" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">递归地飞越巢穴</h1><p id="0c2f" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li my lk ll lm mz lo lp lq na ls lt lu im bi translated">看过电影<a class="ae lv" href="https://www.imdb.com/title/tt1375666/" rel="noopener ugc nofollow" target="_blank">盗梦空间</a>？这是个好东西。时间线中的时间线。当一切恢复时，你会看到事情是如何组合在一起的。以类似的方式，递归在代码中占用的空间很小，但是可以处理巨大的计算(理解为“嵌套”)复杂性。</p><p id="791d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">好了，够了，让我们开始吧！</p><h1 id="f891" class="me mf it bd mg mh nb mj mk ml nc mn mo jz nd ka mq kc ne kd ms kf nf kg mu mv bi translated">BigQuery 的查询 API 返回 JSON</h1><p id="abdb" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li my lk ll lm mz lo lp lq na ls lt lu im bi translated">这是 Google BigQuery 在执行查询后的 API 响应示例:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">BigQuery’s query API result looks like this</figcaption></figure><p id="e920" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">该模式向您展示了数据是如何构造的，并且各行用字段的<strong class="lb iu">“f”和值</strong>的<strong class="lb iu">“v”来表示哪些值适合该模式。</strong></p><p id="54ce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，看起来像这样的 JSON 不是更容易阅读和操作吗？</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Transformed BigQuery result into something more manageable</figcaption></figure><p id="5d0b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你同意，那么你会得到很好的照顾。</p><h1 id="e796" class="me mf it bd mg mh nb mj mk ml nc mn mo jz nd ka mq kc ne kd ms kf nf kg mu mv bi translated">解决方案</h1><p id="dd13" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li my lk ll lm mz lo lp lq na ls lt lu im bi translated">下面是进行这种转换的<strong class="lb iu"> <em class="lw"> node.js </em> </strong>代码。请随意使用它，根据您的需求进行调整，通常会让您的生活更简单，让您的数据更快乐。该功能的界面是:</p><pre class="kj kk kl km gt ni nj nk nl aw nm bi"><span id="083b" class="nn mf it nj b gy no np l nq nr">convertBQToMySQLResults(schema, rows)</span></pre><p id="1b7d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以像这样传递 BigQuery 结果:</p><pre class="kj kk kl km gt ni nj nk nl aw nm bi"><span id="e7b2" class="nn mf it nj b gy no np l nq nr">// apiResponse is the payload you receive from a BigQuery query API // response</span><span id="2165" class="nn mf it nj b gy ns np l nq nr">convertBQToMySQLResults(apiResponse.schema.fields, apiResponse.rows)</span></pre><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure></div><div class="ab cl lx ly hx lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="im in io ip iq"><h1 id="0415" class="me mf it bd mg mh mi mj mk ml mm mn mo jz mp ka mq kc mr kd ms kf mt kg mu mv bi translated">JsFiddle 演示</h1><p id="b361" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li my lk ll lm mz lo lp lq na ls lt lu im bi translated">下面是一个 JsFiddle 代码演示:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nt nh l"/></div></figure><h1 id="6dd9" class="me mf it bd mg mh nb mj mk ml nc mn mo jz nd ka mq kc ne kd ms kf nf kg mu mv bi translated">概括起来</h1><p id="862e" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li my lk ll lm mz lo lp lq na ls lt lu im bi translated">JSON 的很多转换都存在。递归解决方案不是最容易调试的，但是它们有最简单的代码足迹。用调试器单步调试代码是以“慢动作”方式查看此类算法的首选方式。本文提供了一种将源自 Google BigQuery 的复杂嵌套 JSON 简化为您可以自己操作和使用的东西的方法。试试吧！快乐转换！</p></div></div>    
</body>
</html>