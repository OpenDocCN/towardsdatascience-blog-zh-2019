<html>
<head>
<title>Deploy Your Machine Learning Model as a REST API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将您的机器学习模型部署为 REST API</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/deploy-your-machine-learning-model-as-a-rest-api-4fe96bf8ddcc?source=collection_archive---------9-----------------------#2019-11-13">https://towardsdatascience.com/deploy-your-machine-learning-model-as-a-rest-api-4fe96bf8ddcc?source=collection_archive---------9-----------------------#2019-11-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="4325" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">部署机器学习模型对初学者来说可能听起来有些吓人，甚至对那些有一些经验的人来说也是如此。这就是为什么我决定花一整篇文章来谈论它。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d5e82c3b5c6097c2e968e800e03a1800.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*R722L8BJ-JGBhOxs"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Photo by <a class="ae ky" href="https://unsplash.com/@franckinjapan?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Franck V.</a> on <a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="733f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">读完这篇文章后，你将能够部署机器学习模型，并根据你想要的任何编程语言进行预测。没错，你可以坚持使用 Python，或者你可以通过 Java 或 Kotlin 直接在你的 Android 应用中进行预测。此外，您可以在您的 web 应用程序中直接使用该模型——选项是无限的。为了简单起见，我将使用<a class="ae ky" href="https://www.getpostman.com/" rel="noopener ugc nofollow" target="_blank">邮递员</a>。</p><p id="7533" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，我不会解释如何将模型放在一个活动的服务器上，因为选项是无穷无尽的，这可能是另一个帖子的好主意。该模型将在您的<strong class="lb iu">本地主机</strong>上运行，所以不，您将无法从不同的网络访问它(<em class="lv">但是可以随意谷歌如何将模型部署到 AWS 或类似的东西</em>)。</p><p id="bfed" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我已经创建了下面的<strong class="lb iu">目录结构</strong>:</p><p id="3136" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="lv">ML-展开</em></p><ul class=""><li id="ead1" class="lw lx it lb b lc ld lf lg li ly lm lz lq ma lu mb mc md me bi translated"><em class="lv"> model / Train.py </em></li><li id="24db" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated"><em class="lv"> app.py </em></li></ul><p id="5209" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在如果你已经通过<strong class="lb iu"> Anaconda </strong>安装了你的 Python，那么你可能已经预装了所有的库，除了<strong class="lb iu"> <em class="lv"> Flask </em> </strong>。因此，启动终端并执行以下命令:</p><pre class="kj kk kl km gt mk ml mm mn aw mo bi"><span id="0fa3" class="mp mq it ml b gy mr ms l mt mu">pip install Flask<br/>pip install Flask-RESTful</span></pre><p id="4f8c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> <em class="lv">进展顺利吗？</em> </strong>好。现在让我们开始研究一些好东西吧。</p></div><div class="ab cl mv mw hx mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="im in io ip iq"><h1 id="0289" class="nc mq it bd nd ne nf ng nh ni nj nk nl jz nm ka nn kc no kd np kf nq kg nr ns bi translated">制作一个基本的预测脚本</h1><p id="bbc9" class="pw-post-body-paragraph kz la it lb b lc nt ju le lf nu jx lh li nv lk ll lm nw lo lp lq nx ls lt lu im bi translated">如果您正在按照目录结构进行操作，现在应该打开<strong class="lb iu"><em class="lv">model/train . py</em></strong>文件。目标是载入<strong class="lb iu"> <em class="lv"> Iris </em> </strong>数据集，并使用简单的<strong class="lb iu">决策树分类器</strong>来训练模型。一旦训练完成，我将使用<strong class="lb iu"> <em class="lv"> joblib </em> </strong>库来保存模型，并且我还将向用户报告准确度分数。</p><p id="288b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里没有什么复杂的，因为机器学习不是本文的重点，只有模型部署。以下是完整的脚本:</p><pre class="kj kk kl km gt mk ml mm mn aw mo bi"><span id="b8fb" class="mp mq it ml b gy mr ms l mt mu">from sklearn import datasets<br/>from sklearn.tree import DecisionTreeClassifier<br/>from sklearn.model_selection import train_test_split<br/>from sklearn.metrics import accuracy_score<br/>from sklearn.externals import joblib<br/><br/><br/>def train_model():<br/>    iris_df = datasets.load_iris()<br/><br/>    x = iris_df.data<br/>    y = iris_df.target<br/><br/>    X_train, X_test, y_train, y_test = train_test_split(x, y, test_size=0.25)<br/>    dt = DecisionTreeClassifier().fit(X_train, y_train)<br/>    preds = dt.predict(X_test)<br/><br/>    accuracy = accuracy_score(y_test, preds)<br/>    joblib.dump(dt, 'iris-model.model')<br/>    print('Model Training Finished.\n\tAccuracy obtained: {}'.format(accuracy))</span></pre></div><div class="ab cl mv mw hx mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="im in io ip iq"><h1 id="7e2b" class="nc mq it bd nd ne nf ng nh ni nj nk nl jz nm ka nn kc no kd np kf nq kg nr ns bi translated">部署</h1><p id="9087" class="pw-post-body-paragraph kz la it lb b lc nt ju le lf nu jx lh li nv lk ll lm nw lo lp lq nx ls lt lu im bi translated">现在你已经准备好打开<strong class="lb iu"> <em class="lv"> app.py </em> </strong>文件并进行一些导入。你需要<strong class="lb iu"> <em class="lv"> os </em> </strong>模块，一些来自<strong class="lb iu"> <em class="lv"> Flask </em> </strong>和<strong class="lb iu"><em class="lv">Flask-RESTful</em></strong>的东西，10 秒钟前创建的模型训练脚本，以及<strong class="lb iu"> <em class="lv"> joblib </em> </strong>来加载训练好的模型:</p><pre class="kj kk kl km gt mk ml mm mn aw mo bi"><span id="3b48" class="mp mq it ml b gy mr ms l mt mu">import os<br/>from flask import Flask, jsonify, request<br/>from flask_restful import Api, Resource<br/>from model.Train import train_model<br/>from sklearn.externals import joblib</span></pre><p id="224e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在你应该从<strong class="lb iu"> <em class="lv"> Flask-RESTful </em> </strong>中创建一个<strong class="lb iu"> <em class="lv"> Flask </em> </strong>和<strong class="lb iu"> <em class="lv"> Api </em> </strong>的实例。没什么复杂的:</p><pre class="kj kk kl km gt mk ml mm mn aw mo bi"><span id="4edd" class="mp mq it ml b gy mr ms l mt mu">app = Flask(__name__)<br/>api = Api(app)</span></pre><p id="ae21" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来要做的是检查模型是否已经训练好了。在<strong class="lb iu"> <em class="lv"> Train.py </em> </strong>中，您已经声明了模型将被保存在文件<strong class="lb iu"><em class="lv">iris-model . model</em></strong>中，如果该文件不存在，则应该先对模型进行训练。一旦训练完毕，你就可以通过<strong class="lb iu"> <em class="lv"> joblib </em> </strong>加载它:</p><pre class="kj kk kl km gt mk ml mm mn aw mo bi"><span id="1b12" class="mp mq it ml b gy mr ms l mt mu">if not os.path.isfile('iris-model.model'):<br/>    train_model()<br/><br/>model = joblib.load('iris-model.model')</span></pre><p id="1177" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，您需要声明一个用于进行预测的类。<strong class="lb iu"><em class="lv">Flask-RESTful</em></strong>使用这个编码约定，所以你的类需要从<strong class="lb iu"><em class="lv">Flask-RESTful Resource</em></strong>模块继承。在类内部，可以声明<strong class="lb iu"> <em class="lv"> get() </em> </strong>，<strong class="lb iu"> <em class="lv"> post() </em> </strong>，或者其他任何处理数据的方法。</p><p id="1b0d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将使用<strong class="lb iu"> <em class="lv"> post() </em> </strong>，因此数据不会直接通过 URL 传递。您需要从用户输入中获取属性(<em class="lv">根据用户输入的属性值进行预测</em>)。然后，可以调用<strong class="lb iu"> <em class="lv">。</em>预测()</strong>加载模型的功能。仅仅因为这个数据集的目标变量是以(<em class="lv"> 0，1，2 </em>)的形式而不是(<em class="lv"> 'Iris-setosa '，' Iris-versicolor '，' Iris-virginica' </em>)的形式，您还需要解决这个问题。最后，您可以返回预测的 JSON 表示:</p><pre class="kj kk kl km gt mk ml mm mn aw mo bi"><span id="a3f7" class="mp mq it ml b gy mr ms l mt mu">class MakePrediction(Resource):<br/>    @staticmethod<br/>    def post():<br/>        posted_data = request.get_json()<br/>        sepal_length = posted_data['sepal_length']<br/>        sepal_width = posted_data['sepal_width']<br/>        petal_length = posted_data['petal_length']<br/>        petal_width = posted_data['petal_width']<br/><br/>        prediction = model.predict([[sepal_length, sepal_width, petal_length, petal_width]])[0]<br/>        if prediction == 0:<br/>            predicted_class = 'Iris-setosa'<br/>        elif prediction == 1:<br/>            predicted_class = 'Iris-versicolor'<br/>        else:<br/>            predicted_class = 'Iris-virginica'<br/><br/>        return jsonify({<br/>            'Prediction': predicted_class<br/>        })</span></pre><p id="2145" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们就要到了，坚持住！您还需要声明一个路由，这是 URL 中用于处理请求的部分:</p><pre class="kj kk kl km gt mk ml mm mn aw mo bi"><span id="e093" class="mp mq it ml b gy mr ms l mt mu">api.add_resource(MakePrediction, '/predict')</span></pre><p id="7071" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最后，告诉 Python 让<strong class="lb iu">在调试模式下运行应用</strong>:</p><pre class="kj kk kl km gt mk ml mm mn aw mo bi"><span id="ce18" class="mp mq it ml b gy mr ms l mt mu">if __name__ == '__main__':<br/>    app.run(debug=True)</span></pre><p id="439c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">仅此而已。您已经准备好启动模型并进行预测，无论是通过 Postman 还是其他工具。</p><p id="c0e1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以防你遗漏了什么，这里有完整的<strong class="lb iu"> <em class="lv"> app.py </em> </strong>文件:</p><pre class="kj kk kl km gt mk ml mm mn aw mo bi"><span id="2c29" class="mp mq it ml b gy mr ms l mt mu">import os<br/>from flask import Flask, jsonify, request<br/>from flask_restful import Api, Resource<br/>from model.Train import train_model<br/>from sklearn.externals import joblib<br/><br/>app = Flask(__name__)<br/>api = Api(app)<br/><br/>if not os.path.isfile('iris-model.model'):<br/>    train_model()<br/><br/>model = joblib.load('iris-model.model')<br/><br/><br/>class MakePrediction(Resource):<br/>    @staticmethod<br/>    def post():<br/>        posted_data = request.get_json()<br/>        sepal_length = posted_data['sepal_length']<br/>        sepal_width = posted_data['sepal_width']<br/>        petal_length = posted_data['petal_length']<br/>        petal_width = posted_data['petal_width']<br/><br/>        prediction = model.predict([[sepal_length, sepal_width, petal_length, petal_width]])[0]<br/>        if prediction == 0:<br/>            predicted_class = 'Iris-setosa'<br/>        elif prediction == 1:<br/>            predicted_class = 'Iris-versicolor'<br/>        else:<br/>            predicted_class = 'Iris-virginica'<br/><br/>        return jsonify({<br/>            'Prediction': predicted_class<br/>        })<br/><br/><br/>api.add_resource(MakePrediction, '/predict')<br/><br/><br/>if __name__ == '__main__':<br/>    app.run(debug=True)</span></pre><p id="5d71" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> <em class="lv">好了，准备好了吗？</em> </strong></p><p id="20f6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">太好了。导航到根目录(<em class="lv">其中</em><strong class="lb iu"><em class="lv">app . py</em></strong><em class="lv"/>)，启动终端并执行以下操作:</p><pre class="kj kk kl km gt mk ml mm mn aw mo bi"><span id="01db" class="mp mq it ml b gy mr ms l mt mu">python app.py</span></pre><p id="414a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">大约一秒钟后，您会得到一个输出，显示应用程序正在本地主机上运行。</p><p id="e827" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在我将打开<strong class="lb iu">邮递员</strong>并执行以下操作:</p><ul class=""><li id="2d67" class="lw lx it lb b lc ld lf lg li ly lm lz lq ma lu mb mc md me bi translated">将方法更改为 POST</li><li id="0119" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">输入 localhost:5000/predict 作为 URL</li><li id="7745" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">在 Body 选项卡中，选择 JSON</li><li id="c129" class="lw lx it lb b lc mf lf mg li mh lm mi lq mj lu mb mc md me bi translated">输入一些 JSON 进行预测</li></ul><p id="b662" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，您可以点击发送:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/190da5a2f9d32339add449cc77caeb5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a89yPLoWTfRZpwsIylahsw.jpeg"/></div></div></figure><p id="1874" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">瞧啊。几乎立刻你就能从你的模型中得到预测。</p></div><div class="ab cl mv mw hx mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="im in io ip iq"><h1 id="bf26" class="nc mq it bd nd ne nf ng nh ni nj nk nl jz nm ka nn kc no kd np kf nq kg nr ns bi translated">最后的话</h1><p id="da2b" class="pw-post-body-paragraph kz la it lb b lc nt ju le lf nu jx lh li nv lk ll lm nw lo lp lq nx ls lt lu im bi translated">我希望你已经设法看完了这篇文章。如果你只是复制粘贴所有的东西，只要你安装了所有必要的库，你就可以开始了。</p><p id="9b93" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我强烈建议将这些新获得的知识用于您自己的数据集和您自己的业务问题。如果你在用 Python 之外的其他语言编写应用程序，并且只是将 Python 用于数据和机器学习相关的东西，这就很方便了。</p><p id="d406" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢阅读，保重。</p></div><div class="ab cl mv mw hx mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="im in io ip iq"><p id="9366" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">喜欢这篇文章吗？成为 <a class="ae ky" href="https://medium.com/@radecicdario/membership" rel="noopener"> <em class="lv">中等会员</em> </a> <em class="lv">继续无限制学习。如果你使用下面的链接，我会收到你的一部分会员费，不需要你额外付费。</em></p><div class="nz oa gp gr ob oc"><a href="https://medium.com/@radecicdario/membership" rel="noopener follow" target="_blank"><div class="od ab fo"><div class="oe ab of cl cj og"><h2 class="bd iu gy z fp oh fr fs oi fu fw is bi translated">通过我的推荐链接加入 Medium-Dario rade ci</h2><div class="oj l"><h3 class="bd b gy z fp oh fr fs oi fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="ok l"><p class="bd b dl z fp oh fr fs oi fu fw dk translated">medium.com</p></div></div><div class="ol l"><div class="om l on oo op ol oq ks oc"/></div></div></a></div></div></div>    
</body>
</html>