<html>
<head>
<title>Breaking Down Mean Average Precision (mAP)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">分解平均精度(mAP)</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/breaking-down-mean-average-precision-map-ae462f623a52?source=collection_archive---------1-----------------------#2019-03-24">https://towardsdatascience.com/breaking-down-mean-average-precision-map-ae462f623a52?source=collection_archive---------1-----------------------#2019-03-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="1b4f" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">数据科学工具包的另一个指标</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/66462efbcdd88fad7a77091fefcc94d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OOD94B3vflKRs8yIBwWgQQ.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo by <a class="ae kv" href="https://unsplash.com/@byadonia?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Şahin Yeşilyaprak</a> on <a class="ae kv" href="/s/photos/mean-average-precision?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="4bc3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你遇到过<a class="ae kv" href="http://host.robots.ox.ac.uk/pascal/VOC/index.html" rel="noopener ugc nofollow" target="_blank"> PASCAL 视觉对象类(VOC) </a>和<a class="ae kv" href="http://cocodataset.org/#home" rel="noopener ugc nofollow" target="_blank"> MS 上下文中的公共对象(COCO) </a>挑战，或者涉足过涉及信息检索和重新识别(ReID)的项目，那么你可能会非常熟悉一种叫做 mAP 的度量标准。</p><p id="eb20" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">平均精度(mAP)或有时简称为 AP 是一种流行的度量标准，用于测量执行文档/信息检索和对象检测任务的模型的性能。</p><p id="ec58" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一组查询的平均精度(mAP)由<a class="ae kv" href="https://en.wikipedia.org/wiki/Evaluation_measures_(information_retrieval)#Mean_average_precision" rel="noopener ugc nofollow" target="_blank">维基百科</a>定义如下:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ls"><img src="../Images/a8ea5b53ce7be31d3b7c99334a6a3b1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:490/format:webp/1*0uDpXRwQU90HAQA1LkQMRQ.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Mean average precision formula given provided by Wikipedia</figcaption></figure><p id="1c45" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">其中<em class="lt"> Q </em>是集合中查询的数量，AveP(q)是给定查询 Q 的平均精度(AP)。</p><p id="307c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">该公式本质上告诉我们的是，对于给定的查询 q，我们计算其相应的 AP，然后所有这些 AP 得分的平均值将为我们提供一个称为 mAP 的数字，它量化了我们的模型在执行查询方面的表现。</p><p id="53b5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个定义让在这个领域刚刚起步的人(比如我)感到困惑。我有一些问题，比如这组查询是什么？还有 AP 是什么意思？只是精度的平均值吗？</p><p id="3cb6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">本文希望解决这些问题，并为目标检测和信息检索任务计算 mAP。本文还将探讨为什么 mAP 是信息检索和对象检测任务的一个合适且常用的度量。</p><h1 id="d439" class="lu lv iq bd lw lx ly lz ma mb mc md me jw mf jx mg jz mh ka mi kc mj kd mk ml bi translated">概述</h1><ol class=""><li id="72ab" class="mm mn iq ky b kz mo lc mp lf mq lj mr ln ms lr mt mu mv mw bi translated"><a class="ae kv" href="#bde1" rel="noopener ugc nofollow">初级读本</a></li><li id="5f4e" class="mm mn iq ky b kz mx lc my lf mz lj na ln nb lr mt mu mv mw bi translated"><a class="ae kv" href="#f9ce" rel="noopener ugc nofollow">用于信息检索的 AP 和 mAP</a></li><li id="3fb7" class="mm mn iq ky b kz mx lc my lf mz lj na ln nb lr mt mu mv mw bi translated"><a class="ae kv" href="#1a59" rel="noopener ugc nofollow">用于对象检测的 AP 和 mAP</a></li></ol><h1 id="bde1" class="lu lv iq bd lw lx ly lz ma mb mc md me jw mf jx mg jz mh ka mi kc mj kd mk ml bi translated">1.底漆</h1><p id="7fde" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf nc lh li lj nd ll lm ln ne lp lq lr ij bi translated">查准率和查全率是两个常用的度量标准，用来判断给定分类模型的性能。为了理解 mAP，我们需要首先回顾一下精度和召回率。</p><h2 id="b1cd" class="nf lv iq bd lw ng nh dn ma ni nj dp me lf nk nl mg lj nm nn mi ln no np mk nq bi translated">越是“有名”的精确和回忆</h2><p id="ab1a" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf nc lh li lj nd ll lm ln ne lp lq lr ij bi translated">在统计学和数据科学领域，分类中给定类别的<strong class="ky ir">精度，即所谓的阳性预测值</strong>，是指真阳性(TP)与预测阳性总数的比值。公式给出如下:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/792c1fa03ee2ba825d3a5de689b09985.png" data-original-src="https://miro.medium.com/v2/resize:fit:318/format:webp/1*jiqAWT_Yzi_1LRD74dz-9Q.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Precision formula of a given class in classification</figcaption></figure><p id="138b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">类似地，<strong class="ky ir">召回，也称为分类中给定类别的真阳性率或灵敏度，</strong>被定义为 TP 与真实阳性总数的比率。公式给出如下:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/a6e63791061a196899951faa35c1e1eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:370/format:webp/1*ikwX1H72KPj1fUBppUWrpA.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Recall formula of a given class in classification</figcaption></figure><p id="b996" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">仅仅通过查看公式，我们就可以推测，对于一个给定的分类模型，在它的精确度和召回性能之间存在一个折衷。如果我们使用神经网络，这种权衡可以通过模型的最终层 softmax 阈值来调整。</p><p id="d678" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了提高我们的精度，我们需要减少 FP 的数量，这样会降低我们的召回率。同样，减少 FN 的数量会增加我们的回忆，降低我们的精确度。对于信息检索和对象检测的情况，我们经常希望我们的精度很高(我们预测的阳性是 TP)。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/a0a8dd5a734655d83a34cdbac25f92cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:700/format:webp/0*WcR6weG1ORhMcJOl.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">(<a class="ae kv" href="https://en.wikipedia.org/wiki/Precision_and_recall" rel="noopener ugc nofollow" target="_blank">source</a>)</figcaption></figure><p id="84b9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">精确度和召回率通常与其他指标一起使用，如准确性、F1 分数、特异性、真阴性率(TNR)、接收器操作特性(ROC)、提升和增益。</p><h2 id="b343" class="nf lv iq bd lw ng nh dn ma ni nj dp me lf nk nl mg lj nm nn mi ln no np mk nq bi translated">不太“出名”的精确度和召回率</h2><p id="cfd1" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf nc lh li lj nd ll lm ln ne lp lq lr ij bi translated">但是，说到信息检索，定义就<strong class="ky ir">不同</strong>了。</p><p id="ee14" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">根据 Wiki 的定义，<strong class="ky ir">精度定义为与用户查询相关的检索文档与检索文档的比率</strong>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/4f33a7adba73546ce8d4e510ca949d10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1146/format:webp/1*rHehemm-D_OMPRDN2zJ-ZA.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Precision formula for information retrieval given by Wiki</figcaption></figure><p id="a92b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">保持术语类似于上面定义的公式，相关文件可以被视为一个 TP。</p><p id="3937" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">默认情况下，precision 会考虑所有检索到的文档，但是，也可以在给定数量的检索到的文档上评估 precision，这通常称为截止等级，在这种情况下，仅通过仅考虑其最顶层的查询来评估模型。这种测量称为 k 处的<em class="lt">精度或</em> P@K</p><p id="f52c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们用一个例子来更好地理解这个公式。</p><h2 id="926b" class="nf lv iq bd lw ng nh dn ma ni nj dp me lf nk nl mg lj nm nn mi ln no np mk nq bi translated">定义典型的信息检索任务</h2><p id="fc8d" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf nc lh li lj nd ll lm ln ne lp lq lr ij bi translated">信息检索中的典型任务是用户向数据库提供查询，并检索与该查询非常相似的信息。现在让我们用一个带有三个真实值(GTP)的例子来计算精度。</p><p id="af4b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="lt">附加术语:基本事实阳性是被标记为阳性的数据。换句话说，相关文件。</em></p><p id="9952" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们将定义以下变量:</p><ul class=""><li id="b52f" class="mm mn iq ky b kz la lc ld lf nv lj nw ln nx lr ny mu mv mw bi translated">q 成为用户查询</li><li id="6300" class="mm mn iq ky b kz mx lc my lf mz lj na ln nb lr ny mu mv mw bi translated">g 是数据库中的一组标记数据</li><li id="68aa" class="mm mn iq ky b kz mx lc my lf mz lj na ln nb lr ny mu mv mw bi translated">d(i，j)是一个得分函数，以显示对象 I 与 j 有多相似</li><li id="f33a" class="mm mn iq ky b kz mx lc my lf mz lj na ln nb lr ny mu mv mw bi translated">其中 G 的有序集合根据得分函数 d(，)</li><li id="5784" class="mm mn iq ky b kz mx lc my lf mz lj na ln nb lr ny mu mv mw bi translated">k 是 G '的指数</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nz"><img src="../Images/b5ba43dc5f4ee707ef15cb2d317d4fa8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OdcEzsFJ3C-slus0OOBcwg.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">User querying G with a document Q</figcaption></figure><p id="e05c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在用 Q 计算了每个文档的 d(，)之后，我们可以对 G 进行排序并得到 G’。</p><p id="74a2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">假设模型返回以下 G '</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oa"><img src="../Images/f1cc8e36d8125407ad2d3da04cb35024.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6iqevWZQH3Jqr6TQWkj21Q.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Model returned sorted query results G’</figcaption></figure><p id="ea84" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用上面的精度公式，我们得到以下结果:</p><p id="9276" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">P@1 = 1/1 = 1</p><p id="418d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">P@2 = 1/2 = 0.5</p><p id="0d39" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">P@3 = 1/3 = 0.33</p><p id="bc4a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">P@4 = 2/4 = 0.5</p><p id="6ad0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">P@5 = 3/5 = 0.6</p><p id="fcd9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">P@n = 3/n</p></div><div class="ab cl ob oc hu od" role="separator"><span class="oe bw bk of og oh"/><span class="oe bw bk of og oh"/><span class="oe bw bk of og"/></div><div class="ij ik il im in"><p id="7c34" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">类似地，Wiki 定义的<strong class="ky ir">召回公式被给出为与用户查询相关的检索文档与相关文档</strong>的比率。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/d75791ccd617a19c08dfc4b632e1b744.png" data-original-src="https://miro.medium.com/v2/resize:fit:1064/format:webp/1*OxT1NnGepMDtssqp6iVLsw.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Recall formula for information retrieval given by Wiki</figcaption></figure><p id="386a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这种情况下，召回率不如运行返回查询的所有文档将导致微不足道的 100%召回率有用，因此召回率本身通常不被用作度量。</p><p id="3a02" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="#d439" rel="noopener ugc nofollow">回到大纲</a></p><h1 id="f9ce" class="lu lv iq bd lw lx ly lz ma mb mc md me jw mf jx mg jz mh ka mi kc mj kd mk ml bi translated">2.信息检索的平均精度和映射</h1><p id="c992" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf nc lh li lj nd ll lm ln ne lp lq lr ij bi translated">熟悉 precision@k 之后，我们现在可以继续计算平均精度。这将使我们更好地衡量我们的模型对查询结果 G '进行排序的能力。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/3fe98a9dc1005a419e989f945f391a74.png" data-original-src="https://miro.medium.com/v2/resize:fit:504/0*S5iua0fuLzHhdfPb"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">AP@n formula</figcaption></figure><p id="9d4e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">其中，GTP 指的是基本事实正的总数，n 指的是你感兴趣的文档的总数，P@k 指的是精度@k，而 rel@k 是相关性函数。相关性函数是指示函数，如果排名 k 的文档是相关的，则该指示函数等于 1，否则等于 0。</p><p id="3ca9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">回想一下精度的定义，我们现在将使用它来计算 G '中每个文档的 AP。使用上面所示的相同例子，</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ok"><img src="../Images/fe2b6ff33f3ea796041251c22fcae9e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nvVX0Hcp2ldZomsAYe_HAg.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Calculation of AP for a given query, Q, with a GTP=3</figcaption></figure><p id="950f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个查询的总 AP 是 0.7。需要注意的一点是，因为我们知道只有三个 GTP，所以 AP@5 等于总 AP。</p><p id="c9c8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于另一个查询 Q，如果返回的 G '排序如下，我们可以得到完美的 AP 1:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ok"><img src="../Images/f1f0d129c3d53f2fc02a3c5a8fac0720.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fPWfLU-3eBCbLZgSQaHJUw.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Calculation of a perfect AP for a given query, Q, with a GTP=3</figcaption></figure></div><div class="ab cl ob oc hu od" role="separator"><span class="oe bw bk of og oh"/><span class="oe bw bk of og oh"/><span class="oe bw bk of og"/></div><div class="ij ik il im in"><p id="973b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这种情况下，AP 所做的是惩罚那些不能用 TPs 引导集合来排序 G '的模型。它提供了一个数字，能够根据得分函数 d(，)量化排序的优劣。通过将精度之和除以总 GTP 而不是除以 G '的长度，可以更好地表示只有几个 GTP 的查询。</p><h2 id="0ece" class="nf lv iq bd lw ng nh dn ma ni nj dp me lf nk nl mg lj nm nn mi ln no np mk nq bi translated">计算地图</h2><p id="7d16" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf nc lh li lj nd ll lm ln ne lp lq lr ij bi translated">对于每个查询 Q，我们可以计算相应的 AP。用户可以对这个带标签的数据库进行任意多的查询。地图只是用户进行的所有查询的平均值。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/1bca00f62884a0fd35274b7bcecbd12c.png" data-original-src="https://miro.medium.com/v2/resize:fit:402/format:webp/1*2U59KTw4gBF8pfUm2l53_g.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">mAP formula for information retrieval</figcaption></figure><p id="616f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="lt">注意:这和维基百科的公式一样，只是写法不同。</em></p><p id="58dc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="#d439" rel="noopener ugc nofollow">回到大纲</a></p><h1 id="1a59" class="lu lv iq bd lw lx ly lz ma mb mc md me jw mf jx mg jz mh ka mi kc mj kd mk ml bi translated">3.目标检测的平均精度和 mAP</h1><h2 id="9514" class="nf lv iq bd lw ng nh dn ma ni nj dp me lf nk nl mg lj nm nn mi ln no np mk nq bi translated">计算 AP(传统 IoU = 0.5)</h2><h2 id="f286" class="nf lv iq bd lw ng nh dn ma ni nj dp me lf nk nl mg lj nm nn mi ln no np mk nq bi translated">并集上的交集</h2><p id="56c7" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf nc lh li lj nd ll lm ln ne lp lq lr ij bi translated">为了计算物体检测的 AP，我们首先需要理解 IoU。IoU 由预测边界框和地面真实边界框的交集面积和并集面积的比率给出。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi om"><img src="../Images/4468f245c37a1464b001ce5666f925ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/0*mWSuiTMa6WyZUmyq.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">(<a class="ae kv" href="https://www.pyimagesearch.com/2016/11/07/intersection-over-union-iou-for-object-detection/" rel="noopener ugc nofollow" target="_blank">source</a>)</figcaption></figure><p id="9766" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">IoU 将用于确定预测的边界框(BB)是 TP、FP 还是 FN。由于假设每个图像中都有一个对象，因此不评估 TN。让我们考虑下面的图像:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi on"><img src="../Images/d377cb94b717b8ef2f2c0104ff01b7d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:892/format:webp/1*clVtJ9fRCzrmqxEOKwCGNQ.jpeg"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Image with a man and horse labeled with ground truth bounding boxes (<a class="ae kv" href="https://www.walmart.com/ip/LAMINATED-POSTER-Countryside-Horse-Mountains-Atlas-Man-Poster-Print-11-x-17/868208111" rel="noopener ugc nofollow" target="_blank">source</a>)</figcaption></figure><p id="c32b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">该图像包含一个人和一匹马，以及它们对应的地面真实边界框。让我们暂时忽略马。我们在这个图像上运行我们的对象检测模型，并且接收到这个人的预测边界框。传统上，如果 IoU &gt; 0.5，我们将预测定义为 TP。可能的情况如下所述:</p><h2 id="acb3" class="nf lv iq bd lw ng nh dn ma ni nj dp me lf nk nl mg lj nm nn mi ln no np mk nq bi translated">真正(IoU &gt; 0.5)</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/b11de795599ab9c139fcdd20aab9282d.png" data-original-src="https://miro.medium.com/v2/resize:fit:456/format:webp/1*_efRgjUBc8AUj8XSB59hzg.jpeg"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">IoU of predicted BB (yellow) and GT BB (blue) &gt; 0.5 with the correct classification</figcaption></figure><h2 id="41fa" class="nf lv iq bd lw ng nh dn ma ni nj dp me lf nk nl mg lj nm nn mi ln no np mk nq bi translated">假阳性</h2><p id="553a" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf nc lh li lj nd ll lm ln ne lp lq lr ij bi translated">在两种可能的情况下，BB 将被视为 FP:</p><ul class=""><li id="7e9d" class="mm mn iq ky b kz la lc ld lf nv lj nw ln nx lr ny mu mv mw bi translated">IoU &lt; 0.5</li><li id="2266" class="mm mn iq ky b kz mx lc my lf mz lj na ln nb lr ny mu mv mw bi translated">重复 BB</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi op"><img src="../Images/6986db7ca715c75c040935484e8dd3e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3Q4EfaCeCP2XWKTLk-hp6A.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Illustrating the different scenarios a predicted BB (yellow) would be considered as FP</figcaption></figure><h2 id="ccfa" class="nf lv iq bd lw ng nh dn ma ni nj dp me lf nk nl mg lj nm nn mi ln no np mk nq bi translated">假阴性</h2><p id="38b2" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf nc lh li lj nd ll lm ln ne lp lq lr ij bi translated">当我们的目标检测模型错过了目标，那么它将被认为是一个假阴性。两种可能的情况如下:</p><ul class=""><li id="24e8" class="mm mn iq ky b kz la lc ld lf nv lj nw ln nx lr ny mu mv mw bi translated">根本没有检测的时候。</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/a45983047355e8d6d19402881db98fa5.png" data-original-src="https://miro.medium.com/v2/resize:fit:404/format:webp/1*XPBq1HdtcPZiPP63D1nu3w.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">No detection at all</figcaption></figure><ul class=""><li id="78a9" class="mm mn iq ky b kz la lc ld lf nv lj nw ln nx lr ny mu mv mw bi translated">当预测 BB 的 IoU &gt; 0.5 但分类错误时，预测 BB 将为 FN。</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/f920517c532bd382e961b64019d91b05.png" data-original-src="https://miro.medium.com/v2/resize:fit:456/format:webp/1*cwX2KyTmCd0tR5P0mZbQdw.jpeg"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">FN BB as the predicted class is a horse instead of a person</figcaption></figure><h2 id="745c" class="nf lv iq bd lw ng nh dn ma ni nj dp me lf nk nl mg lj nm nn mi ln no np mk nq bi translated">精确度/召回曲线(PR 曲线)</h2><p id="9a6c" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf nc lh li lj nd ll lm ln ne lp lq lr ij bi translated">正式定义了 TP、FP 和 FN 之后，我们现在可以计算测试集中给定类的检测精度和召回率。每个 BB 都有其置信度，通常由其 softmax 层给出，并用于对输出进行排序。请注意，这与信息检索的情况非常相似，只是我们没有使用相似性函数 d(，)来提供排名，而是使用模型预测的 BB 的置信度。</p><h2 id="d07b" class="nf lv iq bd lw ng nh dn ma ni nj dp me lf nk nl mg lj nm nn mi ln no np mk nq bi translated">插值精度</h2><p id="53be" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf nc lh li lj nd ll lm ln ne lp lq lr ij bi translated">在绘制 PR 曲线之前，我们首先需要知道[ <a class="ae kv" href="http://host.robots.ox.ac.uk/pascal/VOC/pubs/everingham10.pdf" rel="noopener ugc nofollow" target="_blank"> 1 </a>中引入的插值精度。插值精度 p_interp 是在每个召回级别<em class="lt"> r </em>上计算的，取该<em class="lt">r</em>的最大测量精度。公式如下:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi or"><img src="../Images/64673758b84931d35f84e38688cfb56a.png" data-original-src="https://miro.medium.com/v2/resize:fit:338/format:webp/1*NpA3oCQA5AlKnJT7DlMhcQ.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Interpolated Precision for a given Recall Value (r)</figcaption></figure><p id="9ed8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">其中 p(r)是召回 r 时的测量精度。</p><p id="1870" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">他们内插 PR 曲线的目的是减少由检测等级的微小变化引起的“摆动”的影响。</p><p id="6abf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这样一来，我们现在可以开始绘制 PR 曲线了。考虑一个具有 3 TP 和 4 FP 的 person 类的例子。我们通过上面定义的公式计算相应的精度、召回率和插值精度。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi os"><img src="../Images/92b94425f58172d34f96a50d1a35d471.png" data-original-src="https://miro.medium.com/v2/resize:fit:1270/format:webp/1*iV6bXUverNLvLI5uo2TlXA.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Calculation table for plotting PR curve with an example of 3 TP and 4 FP. Rows correspond to BB with person classification ordered by their respective softmax confidence</figcaption></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ot"><img src="../Images/b354ef095f0d8f44e1a927d78be96319.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Uhs5RacJtH3og8tvH5rctQ.png"/></div></div></figure><p id="3306" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后通过 PR 曲线下的面积计算 AP。这是通过将召回平均分为 11 个部分来实现的:{0，0.1，0.2，…，0.9，1}。我们得到以下结果:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/0cd7d7bb9252a9d564b77918ccc20882.png" data-original-src="https://miro.medium.com/v2/resize:fit:994/0*snOGkTye-01z6KWR"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Calculation of AP for the above example</figcaption></figure><p id="5636" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">再举一个例子，我想让你参考乔纳森·惠<a class="ae kv" href="https://medium.com/@jonathan_hui" rel="noopener">的这篇</a><a class="ae kv" href="https://medium.com/@jonathan_hui/map-mean-average-precision-for-object-detection-45c121a31173" rel="noopener">写得很好的文章【2】</a>。</p><h2 id="1930" class="nf lv iq bd lw ng nh dn ma ni nj dp me lf nk nl mg lj nm nn mi ln no np mk nq bi translated">计算地图</h2><p id="3ea1" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf nc lh li lj nd ll lm ln ne lp lq lr ij bi translated">用于对象检测的 mAP 是为所有类别计算的 AP 的平均值。还需要注意的是，对于一些论文，它们交替使用 AP 和 mAP。</p></div><div class="ab cl ob oc hu od" role="separator"><span class="oe bw bk of og oh"/><span class="oe bw bk of og oh"/><span class="oe bw bk of og"/></div><div class="ij ik il im in"><h2 id="cb8a" class="nf lv iq bd lw ng nh dn ma ni nj dp me lf nk nl mg lj nm nn mi ln no np mk nq bi translated">计算 AP 的其他方法</h2><p id="be07" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf nc lh li lj nd ll lm ln ne lp lq lr ij bi translated">参考[ <a class="ae kv" href="http://cocodataset.org/#detection-eval" rel="noopener ugc nofollow" target="_blank"> 5 </a> ]，COCO 提供了六种计算 AP 的新方法。</p><p id="12ba" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这些方法中的三种在<strong class="ky ir">不同的 iou:</strong>处对 BB 进行阈值处理</p><ul class=""><li id="5ee9" class="mm mn iq ky b kz la lc ld lf nv lj nw ln nx lr ny mu mv mw bi translated">AP:IoU = 0.50 时的 AP:0.05:0.95(主要挑战指标)</li><li id="c464" class="mm mn iq ky b kz mx lc my lf mz lj na ln nb lr ny mu mv mw bi translated">AP@IoU=0.5(如上所述的传统计算方法)</li><li id="1fe0" class="mm mn iq ky b kz mx lc my lf mz lj na ln nb lr ny mu mv mw bi translated">AP @ IoU = 0.75(BBs 的 IoU 需要&gt; 0.75)</li></ul><p id="2f8e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于主 AP，0.5:0.05:0.95 意味着从 IoU = 0.5 开始，步长为 0.05，增加到 IoU = 0.95。这将导致在十个不同的 iou 上 AP 阈值的计算。进行平均以提供奖励定位更好的检测器的单个数字。</p><p id="3bbd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">其余三种方法是跨尺度计算<strong class="ky ir">AP:</strong></p><ul class=""><li id="b3b8" class="mm mn iq ky b kz la lc ld lf nv lj nw ln nx lr ny mu mv mw bi translated">小型物体的 AP^small: AP:面积&lt; 32² px</li><li id="7d9e" class="mm mn iq ky b kz mx lc my lf mz lj na ln nb lr ny mu mv mw bi translated">AP^medium: AP for medium objects: 32² &lt; area &lt; 96² px</li><li id="7260" class="mm mn iq ky b kz mx lc my lf mz lj na ln nb lr ny mu mv mw bi translated">AP^large: AP for large objects: area &gt; 96 像素</li></ul><p id="5625" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这将允许更好地区分模型，因为一些数据集比其他数据集具有更多的小对象。</p><p id="4523" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="#d439" rel="noopener ugc nofollow">回到大纲</a></p></div><div class="ab cl ob oc hu od" role="separator"><span class="oe bw bk of og oh"/><span class="oe bw bk of og oh"/><span class="oe bw bk of og"/></div><div class="ij ik il im in"><p id="7da1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="lt">发现错误？随意评论！</em></p><p id="e6be" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="lt">特别感谢</em><a class="ae kv" href="https://towardsdatascience.com/@raimibinkarim" rel="noopener" target="_blank"><em class="lt"/></a><em class="lt"/><a class="ae kv" href="https://medium.com/@derekchia" rel="noopener"><em class="lt">德里克</em> </a> <em class="lt">和</em> <a class="ae kv" href="https://medium.com/@polars" rel="noopener"> <em class="lt">韦杰</em> </a> <em class="lt">对本文的校对和反馈。</em></p></div><div class="ab cl ob oc hu od" role="separator"><span class="oe bw bk of og oh"/><span class="oe bw bk of og oh"/><span class="oe bw bk of og"/></div><div class="ij ik il im in"><p id="988c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="lt">随时通过</em><a class="ae kv" href="https://twitter.com/rahjaytee" rel="noopener ugc nofollow" target="_blank"><em class="lt">Twitter</em></a><em class="lt"/><a class="ae kv" href="https://www.linkedin.com/in/renjietan/" rel="noopener ugc nofollow" target="_blank"><em class="lt">LinkedIn</em></a><em class="lt">与我联系！</em></p><p id="0c65" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="lt">如果你对我参与过的其他项目感兴趣，可以随时访问我的</em><a class="ae kv" href="https://github.com/notha99y" rel="noopener ugc nofollow" target="_blank"><em class="lt">Github</em></a><em class="lt">！</em></p><p id="399d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="lt">对于我的其他作品:</em></p><ol class=""><li id="9b65" class="mm mn iq ky b kz la lc ld lf nv lj nw ln nx lr mt mu mv mw bi translated"><a class="ae kv" rel="noopener" target="_blank" href="/a-starter-pack-to-exploratory-data-analysis-with-python-pandas-seaborn-and-scikit-learn-a77889485baf">使用 Python、pandas、seaborn 和 scikit-learn 进行探索性数据分析的入门包</a></li><li id="d8f4" class="mm mn iq ky b kz mx lc my lf mz lj na ln nb lr mt mu mv mw bi translated"><a class="ae kv" rel="noopener" target="_blank" href="/6-steps-to-quickly-train-a-human-action-classifier-with-validation-accuracy-of-over-80-655fcb8781c5">我如何通过 6 个简单的步骤将人体动作分类器提高到 80%的验证准确率</a></li></ol><h1 id="3198" class="lu lv iq bd lw lx ly lz ma mb mc md me jw mf jx mg jz mh ka mi kc mj kd mk ml bi translated">参考资料:</h1><ol class=""><li id="8d53" class="mm mn iq ky b kz mo lc mp lf mq lj mr ln ms lr mt mu mv mw bi translated">由 Mark Everingham、Luc Van Gool、Christopher K. I. Williams、John Winn 和 Andrew Zisserman 发起的 PASCAL 视觉对象类(VOC)挑战</li><li id="209e" class="mm mn iq ky b kz mx lc my lf mz lj na ln nb lr mt mu mv mw bi translated"><a class="ae kv" href="https://medium.com/@jonathan_hui/map-mean-average-precision-for-object-detection-45c121a31173" rel="noopener">https://medium . com/@ Jonathan _ hui/map-mean-average-precision-for-object-detection-45c 121 a 31173</a></li><li id="65f2" class="mm mn iq ky b kz mx lc my lf mz lj na ln nb lr mt mu mv mw bi translated"><a class="ae kv" href="https://makarandtapaswi.wordpress.com/2012/07/02/intuition-behind-average-precision-and-map/" rel="noopener ugc nofollow" target="_blank">https://makarandtapaswi . WordPress . com/2012/07/02/intuition-behind-average-precision-and-map/</a></li><li id="70d4" class="mm mn iq ky b kz mx lc my lf mz lj na ln nb lr mt mu mv mw bi translated"><a class="ae kv" href="https://en.wikipedia.org/wiki/Evaluation_measures_(information_retrieval)#Mean_average_precision" rel="noopener ugc nofollow" target="_blank">https://en . Wikipedia . org/wiki/Evaluation _ measures _(information _ retrieval)# Mean _ average _ precision</a></li><li id="49f7" class="mm mn iq ky b kz mx lc my lf mz lj na ln nb lr mt mu mv mw bi translated"><a class="ae kv" href="http://cocodataset.org/#detection-eval" rel="noopener ugc nofollow" target="_blank">http://cocodataset.org/#detection-eval</a></li><li id="73f5" class="mm mn iq ky b kz mx lc my lf mz lj na ln nb lr mt mu mv mw bi translated"><a class="ae kv" href="https://tarangshah.com/blog/2018-01-27/what-is-map-understanding-the-statistic-of-choice-for-comparing-object-detection-models/" rel="noopener ugc nofollow" target="_blank">https://tarangshah . com/blog/2018-01-27/what-is-map-understanding-the-statistic-of-choice-for-comparisng-object-detection-models/</a></li></ol></div></div>    
</body>
</html>