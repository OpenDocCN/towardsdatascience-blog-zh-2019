<html>
<head>
<title>Annotated Heatmaps of a Correlation Matrix in 5 Simple Steps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">5 个简单步骤中的关联矩阵注释热图</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/annotated-heatmaps-in-5-simple-steps-cc2a0660a27d?source=collection_archive---------6-----------------------#2019-05-31">https://towardsdatascience.com/annotated-heatmaps-in-5-simple-steps-cc2a0660a27d?source=collection_archive---------6-----------------------#2019-05-31</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div class="gh gi jq"><img src="../Images/6fbb19a9ee62082dec7ad137f2eae162.png" data-original-src="https://miro.medium.com/v2/resize:fit:1332/format:webp/1*EuqHC0-iQpNW6yNMJdpbnA.png"/></div></figure><p id="bdd6" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">热图是数据的图形表示，其中数据值用颜色表示。也就是说，它使用颜色向读者传达一个价值。当您拥有大量数据时，这是一个很好的工具，可以帮助受众了解最重要的领域。</p><p id="973d" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">在本文中，我将指导您通过 5 个简单的步骤创建自己的带注释的关联矩阵热图。</p><ol class=""><li id="da81" class="kv kw it jz b ka kb ke kf ki kx km ky kq kz ku la lb lc ld bi translated">输入数据</li><li id="9243" class="kv kw it jz b ka le ke lf ki lg km lh kq li ku la lb lc ld bi translated">创建相关矩阵</li><li id="edb9" class="kv kw it jz b ka le ke lf ki lg km lh kq li ku la lb lc ld bi translated">设置遮罩以隐藏上面的三角形</li><li id="e306" class="kv kw it jz b ka le ke lf ki lg km lh kq li ku la lb lc ld bi translated">在 Seaborn 创建热图</li><li id="6469" class="kv kw it jz b ka le ke lf ki lg km lh kq li ku la lb lc ld bi translated">导出热图</li></ol><p id="379c" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">您可以在我的 Jupyter 笔记本中找到这篇文章的代码，该笔记本位于<a class="ae lj" href="https://github.com/julia-git/Annotated_Heatmap" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><h2 id="a60b" class="lk ll it bd lm ln lo dn lp lq lr dp ls ki lt lu lv km lw lx ly kq lz ma mb mc bi translated">1)导入数据</h2><p id="1a87" class="pw-post-body-paragraph jx jy it jz b ka md kc kd ke me kg kh ki mf kk kl km mg ko kp kq mh ks kt ku im bi translated"><code class="fe mi mj mk ml b">df = pd.read_csv(“Highway1.csv”, index_col = 0)</code></p><figure class="mn mo mp mq gt ju gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/7009c8aa33164cece65a982ad8c0d64c.png" data-original-src="https://miro.medium.com/v2/resize:fit:778/format:webp/1*JL0upleXpQUHaxte3y90YQ.png"/></div></figure><p id="39d2" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">该高速公路事故数据集包含汽车事故率(以每百万英里事故数表示)以及几个设计变量。关于数据集的更多信息可以在<a class="ae lj" href="https://vincentarelbundock.github.io/Rdatasets/doc/carData/Highway1.html" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><h2 id="869b" class="lk ll it bd lm ln lo dn lp lq lr dp ls ki lt lu lv km lw lx ly kq lz ma mb mc bi translated">2)创建相关矩阵</h2><p id="2bf7" class="pw-post-body-paragraph jx jy it jz b ka md kc kd ke me kg kh ki mf kk kl km mg ko kp kq mh ks kt ku im bi translated"><code class="fe mi mj mk ml b">corr_matrix = df.corr()</code></p><figure class="mn mo mp mq gt ju gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/da9fa3f65a1e5c3add9cd8762bef4392.png" data-original-src="https://miro.medium.com/v2/resize:fit:1196/format:webp/1*CP6114sLR6JzBu_DKoJOdQ.png"/></div></figure><p id="fed7" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">我们用<code class="fe mi mj mk ml b">.corr</code>创建相关矩阵。注意，htype 列没有出现在这个矩阵中，因为它不是数字。我们需要虚拟化 htype 来计算相关性。</p><pre class="mn mo mp mq gt ms ml mt mu aw mv bi"><span id="dcd6" class="lk ll it ml b gy mw mx l my mz">df_dummy = pd.get_dummies(df.htype)<br/>df = pd.concat([df, df_dummy], axis = 1)</span></pre><figure class="mn mo mp mq gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="nb nc di nd bf ne"><div class="gh gi na"><img src="../Images/1cc385e1f90bf987bb9263cca93ffb6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x58c2zKXknwwU_weC2R2BQ.png"/></div></div></figure><p id="e37f" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">此外，请注意，相关矩阵的上半部分三角形与下半部分三角形对称。因此，我们的热图不需要显示整个矩阵。我们将在下一步隐藏上面的三角形。</p><h2 id="bca8" class="lk ll it bd lm ln lo dn lp lq lr dp ls ki lt lu lv km lw lx ly kq lz ma mb mc bi translated">3)设置蒙版隐藏上面的三角形</h2><pre class="mn mo mp mq gt ms ml mt mu aw mv bi"><span id="0784" class="lk ll it ml b gy mw mx l my mz">mask = np.zeros_like(corr_matrix, dtype=np.bool)<br/>mask[np.triu_indices_from(mask)]= True</span></pre><p id="833d" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">我们来分解一下上面的代码。<code class="fe mi mj mk ml b">np.zeros_like()</code>返回与给定数组具有相同形状和类型的零数组。通过传入相关矩阵，我们得到一个如下的零数组。</p><figure class="mn mo mp mq gt ju gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/04b95e7e36d990f5761308a87b879c67.png" data-original-src="https://miro.medium.com/v2/resize:fit:684/format:webp/1*_BvzwUuggbChZHkiSXzW8w.png"/></div></figure><p id="49dd" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated"><code class="fe mi mj mk ml b">dtype=np.bool</code>参数覆盖了数据类型，所以我们的数组是一个布尔数组。</p><figure class="mn mo mp mq gt ju gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/e0f1f4c92ee93da8b8e4486e44167871.png" data-original-src="https://miro.medium.com/v2/resize:fit:882/format:webp/1*MaZDEKQ45JhP5LcPqcmG5w.png"/></div></figure><p id="d467" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated"><code class="fe mi mj mk ml b">np.triu_indices_from(mask)</code>返回数组上部三角形的索引。</p><figure class="mn mo mp mq gt ju gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/dc89531105f1bf5d4dd8ca0e2c427193.png" data-original-src="https://miro.medium.com/v2/resize:fit:942/format:webp/1*d9mL2tzfe9UKTnEv2X7A5g.png"/></div></figure><p id="f23f" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">现在，我们将上面的三角形设置为真。</p><p id="6dd0" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated"><code class="fe mi mj mk ml b">mask[np.triu_indices_from(mask)]= True</code></p><figure class="mn mo mp mq gt ju gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/21bddb12d4c89f167ea3fcde7339ef3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:888/format:webp/1*SVHpTWGIIGeNgedn3BPnGw.png"/></div></figure><p id="1d93" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">现在，我们有了一个可以用来生成热图的遮罩。</p><h2 id="34fc" class="lk ll it bd lm ln lo dn lp lq lr dp ls ki lt lu lv km lw lx ly kq lz ma mb mc bi translated">4)在 Seaborn 创建热图</h2><pre class="mn mo mp mq gt ms ml mt mu aw mv bi"><span id="92cb" class="lk ll it ml b gy mw mx l my mz">f, ax = plt.subplots(figsize=(11, 15)) </span><span id="177d" class="lk ll it ml b gy nj mx l my mz">heatmap = sns.heatmap(corr_matrix, <br/>                      mask = mask,<br/>                      square = True,<br/>                      linewidths = .5,<br/>                      cmap = ’coolwarm’,<br/>                      cbar_kws = {'shrink': .4, <br/>                                ‘ticks’ : [-1, -.5, 0, 0.5, 1]},<br/>                      vmin = -1, <br/>                      vmax = 1,<br/>                      annot = True,<br/>                      annot_kws = {“size”: 12})</span><span id="5ec3" class="lk ll it ml b gy nj mx l my mz">#add the column names as labels<br/>ax.set_yticklabels(corr_matrix.columns, rotation = 0)<br/>ax.set_xticklabels(corr_matrix.columns)</span><span id="f22b" class="lk ll it ml b gy nj mx l my mz">sns.set_style({'xtick.bottom': True}, {'ytick.left': True})</span></pre><figure class="mn mo mp mq gt ju gh gi paragraph-image"><div class="gh gi jq"><img src="../Images/6fbb19a9ee62082dec7ad137f2eae162.png" data-original-src="https://miro.medium.com/v2/resize:fit:1332/format:webp/1*EuqHC0-iQpNW6yNMJdpbnA.png"/></div></figure><p id="3ac5" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">为了创建我们的热图，我们传递步骤 3 中的关联矩阵和步骤 4 中创建的掩码，以及定制参数，使我们的热图看起来更好。如果您有兴趣了解每一行是做什么的，这里有参数的描述。</p><pre class="mn mo mp mq gt ms ml mt mu aw mv bi"><span id="a565" class="lk ll it ml b gy mw mx l my mz">#Makes each cell square-shaped.<br/>square = True,<br/>#Set width of the lines that will divide each cell to .5<br/>linewidths = .5,<br/>#Map data values to the coolwarm color space<br/>cmap = 'coolwarm',<br/>#Shrink the legend size and label tick marks at [-1, -.5, 0, 0.5, 1]<br/>cbar_kws = {'shrink': .4, ‘ticks’ : [-1, -.5, 0, 0.5, 1]},<br/>#Set min value for color bar<br/>vmin = -1, <br/>#Set max value for color bar<br/>vmax = 1,<br/>#Turn on annotations for the correlation values<br/>annot = True,<br/>#Set annotations to size 12<br/>annot_kws = {“size”: 12})<br/>#Add column names to the x labels <br/>ax.set_xticklabels(corr_matrix.columns)<br/>#Add column names to the y labels and rotate text to 0 degrees<br/>ax.set_yticklabels(corr_matrix.columns, rotation = 0)<br/>#Show tickmarks on bottom and left of heatmap<br/>sns.set_style({'xtick.bottom': True}, {'ytick.left': True})</span></pre><h2 id="62af" class="lk ll it bd lm ln lo dn lp lq lr dp ls ki lt lu lv km lw lx ly kq lz ma mb mc bi translated">5)导出热图</h2><p id="a8cf" class="pw-post-body-paragraph jx jy it jz b ka md kc kd ke me kg kh ki mf kk kl km mg ko kp kq mh ks kt ku im bi translated">现在您已经有了热图，让我们将其导出。</p><p id="38fd" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated"><code class="fe mi mj mk ml b">heatmap.get_figure().savefig(‘heatmap.png’, bbox_inches=’tight’)</code></p><p id="acf8" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">如果你发现你有一个非常大的热图不能正确导出，使用<code class="fe mi mj mk ml b">bbox_inches = ‘tight’</code>来防止你的图像被切掉。</p></div><div class="ab cl nk nl hx nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="im in io ip iq"><p id="405f" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">感谢阅读！请在下面的评论中分享你用数据制作的热图。</p></div></div>    
</body>
</html>