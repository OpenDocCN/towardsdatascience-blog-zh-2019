<html>
<head>
<title>Text Feature Extraction With Scikit-Learn Pipeline</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">åŸºäº Scikit-Learn æµæ°´çº¿çš„æ–‡æœ¬ç‰¹å¾æå–</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://towardsdatascience.com/the-triune-pipeline-for-three-major-transformers-in-nlp-18c14e20530?source=collection_archive---------15-----------------------#2019-12-13">https://towardsdatascience.com/the-triune-pipeline-for-three-major-transformers-in-nlp-18c14e20530?source=collection_archive---------15-----------------------#2019-12-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0dec" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">ä½¿ç”¨ 2020 å¹´åˆé€‰è¾©è®ºè®°å½•</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/3aabb13249559774b4e08a1ecb6a88e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*603D9vvsE8abqjzHqP46Rw.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Image <a class="ae ky" href="https://www.looper.com/122484/best-worst-movies-blockbuster-franchises/" rel="noopener ugc nofollow" target="_blank">Source</a></figcaption></figure><h1 id="868a" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">è¿™ç¯‡æ–‡ç« çš„ç›®çš„æ˜¯åŒé‡çš„ã€‚</h1><p id="cd3c" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated"><strong class="lt iu">é¦–å…ˆ</strong>ï¼Œå¦‚æˆ‘æ‰€æ‰¿è¯ºçš„ï¼Œæˆ‘å°†è·Ÿè¿›ä¹‹å‰çš„<a class="ae ky" rel="noopener" target="_blank" href="/which-presidential-candidate-talks-like-that-b2b16060ff8b?source=friends_link&amp;sk=521c1d6609bdfb96e41fa2439d5b18d1">å¸–å­</a>ï¼Œåœ¨é‚£ç¯‡å¸–å­ä¸­ï¼Œæˆ‘æ¯”è¾ƒäº† 2020 å¹´ 21 ä½æ°‘ä¸»å…šåˆé€‰æ€»ç»Ÿå€™é€‰äººçš„æ¼”è®²ç‰¹æ€§ã€‚æˆ‘ç¡®å®šäº†ä¸€ç³»åˆ—è¯­è¨€ç‰¹å¾ï¼Œè¿™äº›ç‰¹å¾å°†åœ¨æè¿°å±‚é¢ä¸ŠåŒºåˆ†æˆ‘ä»¬çš„æ€»ç»Ÿå€™é€‰äººã€‚</p><p id="bc00" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘æƒ³ä½¿ç”¨è¿™äº›ç‰¹å¾æ¥å»ºç«‹ä¸€ä¸ªåˆ†ç±»æ¨¡å‹ï¼Œå¯ä»¥é¢„æµ‹è°å°†æœ‰èµ„æ ¼å‚åŠ  12 æœˆ 19 æ—¥çš„è¾©è®ºã€‚å½“ç„¶ï¼Œæˆ‘ä»¬ç°åœ¨çŸ¥é“è°æœ‰èµ„æ ¼å‚åŠ è¾©è®ºï¼Œä½†æˆ‘æƒ³è¿™é¡¹ä»»åŠ¡èƒŒåçš„çœŸæ­£åŠ¨æœºæ˜¯æ›´å…¨é¢åœ°äº†è§£ä¸€ä¸ªäººä»¥æŸç§æ–¹å¼è¯´è¯(åœ¨è¾©è®ºèˆå°ä¸Š)å¯¹äºä½œä¸ºæ€»ç»Ÿå€™é€‰äººè¢«è®¤çœŸå¯¹å¾…(å¹¶è¢«å…è®¸è¿›å…¥ä¸‹ä¸€è½®)æœ‰å¤šé‡è¦ã€‚</p><p id="a6c1" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu">ç¬¬äºŒä¸ª</strong>(ä¹Ÿæ˜¯æ›´é‡è¦çš„ä¸€ä¸ª)<strong class="lt iu"> </strong>åœ¨æ„å»ºè¿™ä¸ªæ¨¡å‹çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘æƒ³åˆ†äº«ä¸€äº›æˆ‘æœ€è¿‘åœ¨ scikit-learn çš„ä¸–ç•Œä¸­éå¸¸é«˜å…´åœ°å‘ç°çš„äº‹æƒ…:<code class="fe ms mt mu mv b">Pipeline</code>(æˆ‘çŸ¥é“æˆ‘å·²ç»è¿Ÿåˆ°äº†ã€‚:)<strong class="lt iu">è¿™ä¸ªéå¸¸å¼ºå¤§çš„ç±»ä½¿æˆ‘çš„æ•´ä¸ª ML å·¥ä½œæµç¨‹â€”â€”ä»é¢„å¤„ç†åˆ°è¯„ä¼°â€”â€”å˜å¾—æ›´åŠ å®¹æ˜“å¤„ç†ã€æ›´åŠ å¥å£®ï¼Œå¹¶ä¸”æ›´å°‘å—åˆ°çŒœæµ‹çš„å½±å“</strong>ï¼Œå°¤å…¶æ˜¯åœ¨è¶…å‚æ•°è°ƒä¼˜é˜¶æ®µã€‚æ­£å¦‚æˆ‘çš„ä¸€ä½åŒäº‹æ‰€è¯´ï¼Œå®ƒçœŸçš„åº”è¯¥æˆä¸ºæ¯ä¸€ä¸ªåŸºäº sklearn çš„ ML é¡¹ç›®çš„ä¸€éƒ¨åˆ†ï¼ä¸‹é¢æ˜¯å®ƒçš„åŠŸèƒ½æè¿°:</p><blockquote class="mw mx my"><p id="0e4e" class="lr ls mz lt b lu mn ju lw lx mo jx lz na mp mc md nb mq mg mh nc mr mk ml mm im bi translated">é¡ºåºåº”ç”¨ä¸€åˆ—<strong class="lt iu">å˜æ¢</strong>å’Œä¸€ä¸ª<strong class="lt iu">æœ€ç»ˆ</strong> <strong class="lt iu">ä¼°è®¡å™¨</strong>ã€‚ç®¡é“çš„ä¸­é—´æ­¥éª¤å¿…é¡»æ˜¯â€œè½¬æ¢â€ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä»¬å¿…é¡»å®ç° fit å’Œ transform æ–¹æ³•ã€‚æœ€ç»ˆçš„ä¼°è®¡å™¨åªéœ€è¦å®ç° fitã€‚<em class="it"/><a class="ae ky" href="https://scikit-learn.org/stable/modules/generated/sklearn.pipeline.Pipeline.html" rel="noopener ugc nofollow" target="_blank"><em class="it">1</em></a><em class="it"/></p></blockquote><p id="0768" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">å¦‚æœä½ æƒ³è¦æ›´å¤šçš„èƒŒæ™¯ä¿¡æ¯å’Œæ·±å…¥æè¿°æ€§åˆ†æçš„ç»“æœï¼Œè¯·å‚è€ƒæˆ‘ä¹‹å‰çš„æ–‡ç« ï¼Œä½†æ˜¯åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†ç›´æ¥åˆ©ç”¨æ–‡ç« æ¥æ„å»ºæ‰€è°“çš„ä¸‰ä½ä¸€ä½“ç®¡é“ğŸ”±ï¼Œå…¶ç»„ä»¶ç®¡é“å¯ä»¥å°†åŸå§‹æ–‡æœ¬è½¬æ¢ä¸º NLP ä»»åŠ¡çš„ä¸‰ä¸ªä¸»è¦ç‰¹å¾æ„å»ºå—:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nd"><img src="../Images/364ec0920ae3f9f55f6172dc386026cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uIbG5UaFrkFFmq18qcTfug.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Three types of feature representation in NLP</figcaption></figure><p id="c3b4" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">æ ¹æ®æ‚¨æ­£åœ¨å¤„ç†çš„ç‰¹å®šä»»åŠ¡æˆ–æ¨¡å‹ï¼Œç»´æ©å›¾ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªç‰¹å¾ç±»å‹å¯èƒ½å¯¹æ‚¨çš„æ¨¡å‹çš„æ€§èƒ½ç‰¹åˆ«é‡è¦ï¼Œä¾‹å¦‚ï¼Œå•è¯åµŒå…¥ä¼´éšç€ä¸€äº›è‡ªå®šä¹‰è¯­è¨€ç‰¹å¾çš„å­é›†ã€‚è¦äº†è§£å“ªäº›é‡å æˆ–ä¸é‡å çš„è¦ç´ é›†æ˜¯æœ€é‡è¦çš„ï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½®ä¸€ä¸ªè®­ç»ƒæµæ¥æµ‹è¯•æ¯ç§è¦ç´ ç±»å‹çš„å½±å“ã€‚è¿™å°±æ˜¯<code class="fe ms mt mu mv b">Pipeline</code>æ¥æ‹¯æ•‘æˆ‘ä»¬çš„åœ°æ–¹ã€‚</p></div><div class="ab cl ne nf hx ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="im in io ip iq"><h1 id="5268" class="kz la it bd lb lc nl le lf lg nm li lj jz nn ka ll kc no kd ln kf np kg lp lq bi translated">ä½†é¦–å…ˆè¦åšçš„æ˜¯ã€‚</h1><p id="58cb" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">ä½¿ç”¨å‰ä¸€ç¯‡<a class="ae ky" rel="noopener" target="_blank" href="/which-presidential-candidate-talks-like-that-b2b16060ff8b">æ–‡ç« </a>ä¸­å‡†å¤‡å¥½çš„æ•°æ®å¸§ï¼Œæˆ‘ä»¬æƒ³ä¸ºç›®æ ‡å˜é‡<code class="fe ms mt mu mv b">qualified</code>æ·»åŠ ä¸€åˆ—(1 æˆ– 0 è¡¨ç¤ºæ˜¯æˆ–å¦)ï¼Œå®ƒè¡¨ç¤ºè°æœ‰èµ„æ ¼å‚åŠ  12 æœˆçš„è¾©è®ºã€‚å…«åå€™é€‰äººæœ‰èµ„æ ¼å‚åŠ è¾©è®º(åŒ…æ‹¬é€€å‡ºçš„å“ˆé‡Œæ–¯):</p><pre class="kj kk kl km gt nq mv nr ns aw nt bi"><span id="14be" class="nu la it mv b gy nv nw l nx ny">import numpy as np<br/>import pandas as pd</span><span id="884a" class="nu la it mv b gy nz nw l nx ny"><strong class="mv iu">QUALIFIED_CANDIDATES</strong> = ["BIDEN", "WARREN", "SANDERS", "BUTTIGIEG", "HARRIS", "KLOBUCHAR", "STEYER", "YANG"]</span><span id="e8a2" class="nu la it mv b gy nz nw l nx ny">CANDIDATE_TO_TARGET = {}<br/>[CANDIDATE_TO_TARGET.update({c: 1}) if c in QUALIFIED_CANDIDATES else CANDIDATE_TO_TARGET.update({c: 0}) for c in ALL_CANDIDATE_NAMES]</span><span id="8371" class="nu la it mv b gy nz nw l nx ny"># add the target variable column <br/>qualified = df['speaker'].apply(lambda x: CANDIDATE_TO_TARGET[x] if x in CANDIDATE_TO_TARGET else np.NaN)<br/>df['qualified'] = qualified</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/7f3bd2a7d03d4e0245d9544a46801444.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gzjeJxTjXjWb9Afk-hyWuQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">A dataframe containing the features and target variable (not all features shown)</figcaption></figure><p id="c62e" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">ç„¶åï¼Œæˆ‘ä»¬å°†æ•°æ®é›†åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†:</p><pre class="kj kk kl km gt nq mv nr ns aw nt bi"><span id="e5da" class="nu la it mv b gy nv nw l nx ny">from sklearn.model_selection import train_test_split</span><span id="79aa" class="nu la it mv b gy nz nw l nx ny">train_df, test_df = train_test_split(df, test_size=0.1)</span><span id="11af" class="nu la it mv b gy nz nw l nx ny">train_data = train_df["segment"]<br/>train_target = train_df["qualified"]</span><span id="4071" class="nu la it mv b gy nz nw l nx ny">test_data = test_df["segment"]<br/>test_target = test_df["qualified"]</span></pre><p id="a351" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">ç°åœ¨æˆ‘ä»¬å‡†å¤‡å¥½äº†æœ‰è¶£çš„éƒ¨åˆ†ï¼</p></div><div class="ab cl ne nf hx ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="im in io ip iq"><h1 id="72ee" class="kz la it bd lb lc nl le lf lg nm li lj jz nn ka ll kc no kd ln kf np kg lp lq bi translated">è®¾ç½®ä¸‰ä½ä¸€ä½“ç®¡é“ã€‚</h1><p id="f921" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated"><code class="fe ms mt mu mv b"><strong class="lt iu">Pipeline</strong></code> <strong class="lt iu">æä¾›äº†ä¸€ç§æ–¹ä¾¿ç›´è§‚çš„æ–¹å¼æ¥æ„å»ºæˆ‘ä»¬çš„ ML æµç¨‹ï¼Œå…¶ç‰¹å¾åœ¨äºä¸€ç³»åˆ—å¯é¢„æµ‹çš„æ ¸å¿ƒä»»åŠ¡</strong>ï¼ŒåŒ…æ‹¬é¢„å¤„ç†ã€ç‰¹å¾é€‰æ‹©ã€æ ‡å‡†åŒ–/è§„èŒƒåŒ–å’Œåˆ†ç±»ã€‚<code class="fe ms mt mu mv b">Pipeline</code>é€šè¿‡è¿ç»­è°ƒç”¨æ¯ä¸ªä¼°ç®—å™¨ä¸Šçš„<code class="fe ms mt mu mv b">fit</code>ï¼Œå°†<code class="fe ms mt mu mv b">transform</code>åº”ç”¨åˆ°è¾“å…¥ï¼Œå¹¶å°†è½¬æ¢åçš„è¾“å…¥ä¼ é€’åˆ°ä¸‹ä¸€æ­¥ï¼Œæ¥è‡ªåŠ¨åŒ–æ‹Ÿåˆ/è½¬æ¢è¿‡ç¨‹çš„å¤šä¸ªå®ä¾‹ã€‚è¿™æ„å‘³ç€<code class="fe ms mt mu mv b">Pipeline</code>ä¸­çš„æ¯ä¸ªä¼°è®¡å™¨(é™¤äº†æœ€åä¸€ä¸ª)éƒ½å¿…é¡»æœ‰ä¸€ä¸ª<code class="fe ms mt mu mv b">transform</code>æ–¹æ³•[ <a class="ae ky" href="https://scikit-learn.org/stable/modules/compose.html#notes" rel="noopener ugc nofollow" target="_blank"> 2 </a> ]ï¼Œå°±åƒè¿™ä¸ªå‹å¥½çš„ sklearn transformer <code class="fe ms mt mu mv b">TfidfVectorizer</code>:</p><pre class="kj kk kl km gt nq mv nr ns aw nt bi"><span id="faaa" class="nu la it mv b gy nv nw l nx ny">class TfidfVectorizer(CountVectorizer):<br/>    ...</span><span id="fd90" class="nu la it mv b gy nz nw l nx ny">    def fit(self, raw_documents, y=None):<br/>        <em class="mz"># Learn vocabulary and idf from training set.</em></span><span id="32f7" class="nu la it mv b gy nz nw l nx ny"><em class="mz">        </em>self._check_params()<br/>        X = super().fit_transform(raw_documents)<br/>        self._tfidf.fit(X)<br/>        return self    </span><span id="e428" class="nu la it mv b gy nz nw l nx ny">    def <strong class="mv iu">transform</strong>(self, raw_documents, copy=True):<br/>        <em class="mz"># Transform documents to document-term matrix.</em></span><span id="2016" class="nu la it mv b gy nz nw l nx ny"><em class="mz">        </em>check_is_fitted(self, '_tfidf', 'The tfidf vector is not fitted')<br/><br/>        X = super().transform(raw_documents)<br/>        return self._tfidf.transform(X, copy=False)</span></pre><p id="ed0b" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><code class="fe ms mt mu mv b">Pipeline</code>ä¸­çš„æœ€åä¸€ä¸ªä¼°è®¡å™¨ä¸ä¸€å®šæ˜¯è½¬æ¢å™¨(å³æœ‰ä¸€ä¸ª<code class="fe ms mt mu mv b">transform</code>æ–¹æ³•)ï¼Œä½†å¯ä»¥æ˜¯(é€šå¸¸æ˜¯)ä¸€ä¸ªåˆ†ç±»å™¨ï¼Œåƒ<code class="fe ms mt mu mv b">SVC</code>ã€‚è¿™ç§ç»“æ„å°†å…è®¸æ‚¨åœ¨æ•´ä¸ªå®‰è£…å¥½çš„ç®¡é“ä¸Šè°ƒç”¨<code class="fe ms mt mu mv b">predict</code>ã€‚</p></div><div class="ab cl ne nf hx ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="im in io ip iq"><h2 id="1d5b" class="nu la it bd lb ob oc dn lf od oe dp lj ma of og ll me oh oi ln mi oj ok lp ol bi translated">ç®¡é“ I:ä½¿ç”¨ tfidf çŸ¢é‡å™¨çš„å•è¯åŒ…</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/6b5e27980c2ebeff4a51aab2de9fc9b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LR51lPVUqpKSsRaCX1QWiA.jpeg"/></div></div></figure><p id="8dc6" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">ä»¥æˆ‘ä»¬çš„è¾©è®ºè®°å½•æ–‡æœ¬ä¸ºä¾‹ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„<code class="fe ms mt mu mv b">Pipeline</code>å¯¹è±¡ï¼Œè¯¥å¯¹è±¡(1)å°†è¾“å…¥æ•°æ®è½¬æ¢ä¸º TF-IDF ç‰¹å¾çŸ©é˜µï¼Œä»¥åŠ(2)ä½¿ç”¨éšæœºæ£®æ—åˆ†ç±»å™¨å¯¹æµ‹è¯•æ•°æ®è¿›è¡Œåˆ†ç±»:</p><pre class="kj kk kl km gt nq mv nr ns aw nt bi"><span id="3162" class="nu la it mv b gy nv nw l nx ny"><strong class="mv iu">bow_pipeline</strong> = Pipeline(<br/>    steps=[<br/>        ("tfidf", TfidfVectorizer()),<br/>        ("classifier", RandomForestClassifier()),<br/>    ]<br/>)</span><span id="1e1c" class="nu la it mv b gy nz nw l nx ny">bow_pipeline.fit(train_data, train_target)<br/>y_pred = bow_pipeline.predict(test_data)<br/>cr = classification_report(test_target, y_pred)</span></pre><p id="f8f2" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">ç„¶åæˆ‘ä»¬å¯ä»¥åœ¨æ•´ä¸ªç®¡é“ä¸Šè°ƒç”¨<code class="fe ms mt mu mv b">fit</code>,åœ¨æµ‹è¯•æ•°æ®ä¸Šè°ƒç”¨<code class="fe ms mt mu mv b">predict</code>ã€‚æ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼Œé™¤äº†æä¾›æœ‰åºçš„ä¼°è®¡é‡ä¹‹å¤–ï¼Œæ²¡æœ‰ä»€ä¹ˆåˆ«çš„äº†ã€‚å½“ç„¶ï¼Œæ‚¨å¯ä»¥é€šè¿‡åœ¨<code class="fe ms mt mu mv b">â€œclassifierâ€</code>æ­¥éª¤ä¹‹å‰æ·»åŠ ä¸€ä¸ªè§„èŒƒåŒ–æˆ–æ ‡å‡†åŒ–æ­¥éª¤æ¥æ‰©å±•ç®¡é“ã€‚(æ‚¨å°†åœ¨ä¸‹ä¸€ä¸ªç®¡é“ä¸­çœ‹åˆ°ä¸€ä¸ªé™ç»´æ­¥éª¤çš„ç¤ºä¾‹ã€‚)</p><p id="f1a7" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">åœ¨ä¸‹é¢çš„åˆ†ç±»æŠ¥å‘Šä¸­ï¼Œ<code class="fe ms mt mu mv b">0</code>ä»£è¡¨â€œæ²¡æœ‰èµ„æ ¼å‚åŠ  12 æœˆçš„è¾©è®ºâ€ï¼Œ<code class="fe ms mt mu mv b">1</code>ä»£è¡¨â€œæœ‰èµ„æ ¼â€ã€‚æˆ‘ä»¬çœ‹åˆ°ï¼Œä»…ä½¿ç”¨è¾©è®ºè®°å½•æ•°æ®â€” <strong class="lt iu">è€Œä¸äº†è§£å€™é€‰äººçš„å…¶ä»–ä¿¡æ¯</strong>(ä¾‹å¦‚ä»–ä»¬çš„æŠ•ç¥¨çŠ¶å†µã€æ€§åˆ«ã€å—æ¬¢è¿ç¨‹åº¦å’Œæ”¿æ²»ç»éªŒæ°´å¹³)â€”æˆ‘ä»¬èƒ½å¤Ÿä»¥ 70%çš„å‡†ç¡®ç‡é¢„æµ‹è°å°†å‚åŠ æˆ–ä¸å‚åŠ ä¸‹ä¸€åœºè¾©è®ºã€‚ä»–ä»¬åœ¨è¾©è®ºèˆå°ä¸Šè¯´çš„è¯çœŸçš„å¾ˆé‡è¦ï¼Œä¸ä»–ä»¬å¦‚ä½•è¯´æ— å…³(ç¬¬ä¸‰æ¡ç®¡é“å°†åœ¨ä¸‹é¢è®¨è®º)ï¼Œä¹Ÿä¸ä»–ä»¬æ˜¯è°æ— å…³ã€‚</p><pre class="kj kk kl km gt nq mv nr ns aw nt bi"><span id="f1fb" class="nu la it mv b gy nv nw l nx ny"># tf-idf features only</span><span id="21d3" class="nu la it mv b gy nz nw l nx ny">              precision    recall  f1-score   support<br/><br/>           0       0.66      0.54      0.59       165<br/>           1       0.72      0.81      0.76       242<br/><br/>    accuracy                           <strong class="mv iu">0.70 </strong>      407<br/>   macro avg       0.69      0.67      0.68       407<br/>weighted avg       0.70      0.70      0.69       407</span></pre></div><div class="ab cl ne nf hx ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="im in io ip iq"><h2 id="6e76" class="nu la it bd lb ob oc dn lf od oe dp lj ma of og ll me oh oi ln mi oj ok lp ol bi translated">ç®¡é“ II:ä½¿ç”¨å®šåˆ¶è½¬æ¢å™¨çš„å•è¯åµŒå…¥</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/69250de520e798c5821319b5ace4fda6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kuyuep7nvlpSBZG9CvqtIw.jpeg"/></div></div></figure><p id="af68" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">ç¬¬äºŒä¸ªç®¡é“éœ€è¦åˆ›å»ºä¸€ä¸ª<strong class="lt iu">è‡ªå®šä¹‰è½¬æ¢å™¨</strong>ï¼Œå®ƒåŸºäºå•è¯åµŒå…¥å°†æ–‡æœ¬è½¬æ¢æˆæ•°å­—å‘é‡ã€‚æœ‰å‡ ç§æ–¹æ³•å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ï¼ŒåŒ…æ‹¬ä»<a class="ae ky" href="https://nlp.stanford.edu/projects/glove/" rel="noopener ugc nofollow" target="_blank">è¿™é‡Œ</a>ä¸‹è½½é¢„å…ˆè®­ç»ƒå¥½çš„æ‰‹å¥—å•è¯å‘é‡ï¼Œå¹¶ç¼–å†™ä¸€ä¸ªè‡ªå®šä¹‰å‡½æ•°æ¥åŠ è½½æ¨¡å‹ï¼Œå¦‚ä¸‹æ‰€ç¤º:</p><pre class="kj kk kl km gt nq mv nr ns aw nt bi"><span id="8bf9" class="nu la it mv b gy nv nw l nx ny">path_to_word_vectors = "/Users/jlee/glove.6B.50d.txt"</span><span id="7292" class="nu la it mv b gy nz nw l nx ny">def load_glove(path_to_word_vectors):<br/>    f = open(path_to_word_vectors, "r")<br/>    word2vec = {}<br/>    for line in f:<br/>        split_line = line.split()<br/>        word = split_line[0]<br/>        embedding = np.array([float(val) for val in split_line[1:]])<br/>        model[word] = embedding<br/>    return word2vec</span><span id="9598" class="nu la it mv b gy nz nw l nx ny">word2vec = load_glove(path_to_word_vectors)</span></pre><p id="2670" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">æˆ–è€…ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ spaCy çš„å†…ç½®å•è¯å‘é‡æ¨¡å‹ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„<code class="fe ms mt mu mv b">.vector</code>å±æ€§è®¿é—®ã€‚ä¸‹é¢æˆ‘åŠ è½½äº†<code class="fe ms mt mu mv b">"en_core_web_md"</code>æ¨¡å‹ï¼Œå®ƒæä¾›äº† 685k ä¸ªé”®å’Œ 20k ä¸ªå”¯ä¸€å‘é‡(300 ç»´)ã€‚è¿™ä¸ªæ¨¡å‹è¢«å­˜å‚¨ä¸º<code class="fe ms mt mu mv b">SpacyVectorTransformer</code>çš„ä¸€ä¸ªå±æ€§ï¼Œè¿™æ˜¯ä¸€ä¸ªè¿”å›å‘é‡å¹³å‡å€¼çš„å®šåˆ¶è½¬æ¢å™¨ã€‚</p><pre class="kj kk kl km gt nq mv nr ns aw nt bi"><span id="898a" class="nu la it mv b gy nv nw l nx ny">import spacy <br/>from sklearn.base import BaseEstimator, TransformerMixin</span><span id="5956" class="nu la it mv b gy nz nw l nx ny">nlp = spacy.load("en_core_web_md")  # this model will give you 300D</span><span id="8285" class="nu la it mv b gy nz nw l nx ny">class <strong class="mv iu">SpacyVectorTransformer</strong>(BaseEstimator, TransformerMixin):<br/>    def __init__(self, nlp):<br/>        self.nlp = nlp<br/>        self.dim = 300<br/><br/>    def fit(self, X, y):<br/>        return self<br/><br/>    def transform(self, X):<br/>        # Doc.vector defaults to an <strong class="mv iu">average</strong> of the token vectors.<br/>        # https://spacy.io/api/doc#vector<br/>        return [self.nlp(text).vector for text in X]</span></pre><p id="b6ec" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">ä¸€æ—¦æˆ‘ä»¬å¾—åˆ° 300 ç»´çš„å¹³å‡åµŒå…¥ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©ä½¿ç”¨<code class="fe ms mt mu mv b">TrancatedSVD</code>æ¥é™ä½è¿™äº›ç‰¹å¾çš„ç»´æ•°ã€‚</p><pre class="kj kk kl km gt nq mv nr ns aw nt bi"><span id="e757" class="nu la it mv b gy nv nw l nx ny"><strong class="mv iu">embeddings_pipeline</strong> = Pipeline(<br/>    steps=[<br/>        ("mean_embeddings", SpacyVectorTransformer(nlp)),<br/>        ("reduce_dim", TruncatedSVD(50)),<br/>        ("classifier", RandomForestClassifier()),<br/>    ]<br/>)</span><span id="8465" class="nu la it mv b gy nz nw l nx ny">embeddings_pipeline.fit(train_data, train_target)<br/>y_pred = embeddings_pipeline.predict(test_data)<br/>cr = classification_report(test_target, y_pred)</span></pre><p id="cf97" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">ç»“æœæ˜¯:</p><pre class="kj kk kl km gt nq mv nr ns aw nt bi"><span id="4ffa" class="nu la it mv b gy nv nw l nx ny"># embeddings only </span><span id="7704" class="nu la it mv b gy nz nw l nx ny">              precision    recall  f1-score   support<br/><br/>           0       0.56      0.61      0.58       165<br/>           1       0.72      0.67      0.69       242<br/><br/>    accuracy                           <strong class="mv iu">0.65 </strong>      407<br/>   macro avg       0.64      0.64      0.64       407<br/>weighted avg       0.65      0.65      0.65       407</span></pre><p id="556f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">æˆ‘ä»¬çœ‹åˆ°ç»“æœä¸å¦‚æ›´ç®€å•çš„ TF-IDF æ¨¡å‹çš„ç»“æœå¥½ã€‚</p></div><div class="ab cl ne nf hx ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="im in io ip iq"><h2 id="f9f2" class="nu la it bd lb ob oc dn lf od oe dp lj ma of og ll me oh oi ln mi oj ok lp ol bi translated">ç®¡é“ä¸‰:å®šåˆ¶è¯­è¨€åŠŸèƒ½ç®¡é“</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/3449350b24d2747a08414d7693790d5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u9CNBZQ2msUTuOtZPv1JQw.jpeg"/></div></div></figure><p id="7173" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">æ‰€è°“â€œè‡ªå®šä¹‰è¯­è¨€ç‰¹å¾â€ï¼Œæˆ‘æŒ‡çš„æ˜¯é‚£ç§ä½ å¯ä»¥é€šè¿‡å¯¹ä½ çš„æ•°æ®åº”ç”¨ä¸€äº›è§„åˆ™æ¥æ‰‹åŠ¨æå–çš„ç‰¹å¾ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä½¿ç”¨ç©ºé—´ä¾èµ–è§£æå™¨æå–ç‰¹æ€§<code class="fe ms mt mu mv b">number of words before the main verb</code>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="on oo l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">An example of a custom rule-extracted linguistic feature</figcaption></figure><p id="5aba" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">æ›´å¤šåŸºäºè§„åˆ™çš„å®šåˆ¶è¯­è¨€ç‰¹æ€§çš„ä¾‹å­å¯ä»¥åœ¨ä»¥ä¸‹ä¸¤ç¯‡æ–‡ç« ä¸­æ‰¾åˆ°:</p><div class="op oq gp gr or os"><a rel="noopener follow" target="_blank" href="/linguistic-rule-writing-for-nlp-ml-64d9af824ee8"><div class="ot ab fo"><div class="ou ab ov cl cj ow"><h2 class="bd iu gy z fp ox fr fs oy fu fw is bi translated">ä¸ºè‡ªç„¶è¯­è¨€å¤„ç†ç¼–å†™è¯­è¨€è§„åˆ™</h2><div class="oz l"><h3 class="bd b gy z fp ox fr fs oy fu fw dk translated">ç”¨ spaCy æå–é—®é¢˜ç±»å‹çš„æŒ‡å—</h3></div><div class="pa l"><p class="bd b dl z fp ox fr fs oy fu fw dk translated">towardsdatascience.com</p></div></div><div class="pb l"><div class="pc l pd pe pf pb pg ks os"/></div></div></a></div><div class="op oq gp gr or os"><a rel="noopener follow" target="_blank" href="/which-presidential-candidate-talks-like-that-b2b16060ff8b"><div class="ot ab fo"><div class="ou ab ov cl cj ow"><h2 class="bd iu gy z fp ox fr fs oy fu fw is bi translated">è¶…è¶Šæ¼”è®²æ—¶é—´:æ°‘ä¸»å…šæ€»ç»Ÿè¾©è®ºåˆ†æ</h2><div class="oz l"><h3 class="bd b gy z fp ox fr fs oy fu fw dk translated">ä½¿ç”¨çœŸå®ä¸–ç•Œæ•°æ®è¿›è¡Œé¢„æµ‹å»ºæ¨¡çš„æ•°æ®å‡†å¤‡å’Œç‰¹å¾å·¥ç¨‹</h3></div><div class="pa l"><p class="bd b dl z fp ox fr fs oy fu fw dk translated">towardsdatascience.com</p></div></div><div class="pb l"><div class="ph l pd pe pf pb pg ks os"/></div></div></a></div><p id="7a23" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">ç¬¬ä¸‰ä¸ªç®¡é“éœ€è¦ä¸€ä¸ªå®šåˆ¶çš„è½¬æ¢å™¨ï¼Œå°±åƒä¸Šä¸€ä¸ªä¸€æ ·ï¼›<code class="fe ms mt mu mv b">CustomLinguisticFeatureTransformer</code>é‡‡ç”¨ä¸€ä¸ª<code class="fe ms mt mu mv b">fit</code>æ–¹æ³•(å®ƒè¿”å›è‡ªèº«)å’Œä¸€ä¸ª<code class="fe ms mt mu mv b">transform</code>æ–¹æ³•ã€‚åè€…è¿”å›<code class="fe ms mt mu mv b">featurize</code>çš„è¾“å‡ºï¼Œè¿™æ˜¯æˆ‘åˆ›å»ºçš„å¦ä¸€ä¸ªåä¸º<code class="fe ms mt mu mv b">SegmentFeaturizer</code>çš„ç±»çš„æ–¹æ³•ã€‚</p><pre class="kj kk kl km gt nq mv nr ns aw nt bi"><span id="f255" class="nu la it mv b gy nv nw l nx ny">segment_featurizer = SegmentFeaturizer()  # more on this below</span><span id="5c8f" class="nu la it mv b gy nz nw l nx ny">class <!-- -->CustomLinguisticFeatureTransformer<!-- -->(BaseEstimator, TransformerMixin):<br/>    def __init__(self):<br/>        pass</span><span id="9d72" class="nu la it mv b gy nz nw l nx ny">    def fit(self, x, y=None):<br/>        return self</span><span id="7a1f" class="nu la it mv b gy nz nw l nx ny">    def transform(self, data):<br/>        return <strong class="mv iu">segment_featurizer.featurize</strong>(data)</span></pre><p id="48bf" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><code class="fe ms mt mu mv b">SegmentFeaturizer</code>å®šä¹‰ç”¨äºæå–ä¸€ç»„è¯­è¨€ç‰¹å¾çš„æ–¹æ³•ã€‚ä¸‹é¢æ˜¯å®ƒçš„åŸºæœ¬ç»“æ„ï¼Œå…¶ä¸­ä¸€äº›ç‰¹å¾æå–å‡½æ•°åé¢æ˜¯è¿”å›ç‰¹å¾å­—å…¸åˆ—è¡¨çš„ä¸»<code class="fe ms mt mu mv b">featurize</code>å‡½æ•°:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="on oo l"/></div></figure><p id="ef7a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">(è¦äº†è§£æ›´å¤šå…³äº<code class="fe ms mt mu mv b">featurize</code>çš„ä¿¡æ¯ï¼Œè¯·çœ‹è¿™ç¯‡<a class="ae ky" rel="noopener" target="_blank" href="/how-to-build-a-reusable-nlp-code-pipeline-with-scikit-learn-with-an-emphasis-on-feature-504f8aa14699?source=friends_link&amp;sk=135abfa127e7094b1a17963b254ab678">å¸–å­</a>ã€‚)ç„¶åï¼Œ<code class="fe ms mt mu mv b">transform</code>çš„è¾“å‡ºä½œä¸ºæµæ°´çº¿çš„ä¸‹ä¸€ä¸ªéƒ¨ä»¶ï¼Œå³<code class="fe ms mt mu mv b">DictVectorizer</code>çš„è¾“å…¥ã€‚å®Œæ•´çš„ç®¡é“å¦‚ä¸‹:</p><pre class="kj kk kl km gt nq mv nr ns aw nt bi"><span id="84c6" class="nu la it mv b gy nv nw l nx ny">manual_pipeline = Pipeline(<br/>    steps=[<br/>        ("stats", <!-- -->CustomLinguisticFeatureTransformer<!-- -->()),<br/>        ("dict_vect", DictVectorizer()),<br/>        ("classifier", RandomForestClassifier()),<br/>    ]<br/>)</span><span id="9740" class="nu la it mv b gy nz nw l nx ny">manual_pipeline.fit(train_data, train_target)<br/>y_pred = manual_pipeline.predict(test_data)<br/>cr = classification_report(test_target, y_pred)</span></pre><p id="4c27" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">ç»“æœ:</p><pre class="kj kk kl km gt nq mv nr ns aw nt bi"><span id="a34c" class="nu la it mv b gy nv nw l nx ny"># manual linguistic features only</span><span id="416d" class="nu la it mv b gy nz nw l nx ny">              precision    recall  f1-score   support<br/><br/>           0       0.62      0.56      0.59       165<br/>           1       0.72      0.77      0.74       242<br/><br/>    accuracy                           <strong class="mv iu">0.68</strong>       407<br/>   macro avg       0.67      0.66      0.67       407<br/>weighted avg       0.68      0.68      0.68       407</span></pre><p id="23ad" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">ä¸å¦‚è¯è¢‹æ¨¡å‹å¥½ï¼Œä½†æ¯”å¹³å‡åµŒå…¥è¦å¥½ã€‚ä¸‹é¢æ˜¯ä¸‰ä¸ªç®¡é“æŒ‡æ ‡çš„å¯¹æ¯”æ±‡æ€»è¡¨:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pi"><img src="../Images/f4a937a5cbfb6acb40733e8fd8e29909.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wPuQ3d5Wb-AmO9yfjEbrMw.png"/></div></div></figure><p id="1960" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">(æ˜¾ç¤ºäº†<a class="ae ky" href="https://scikit-learn.org/stable/modules/model_evaluation.html#from-binary-to-multiclass-and-multilabel" rel="noopener ugc nofollow" target="_blank">å®</a>çš„ç²¾ç¡®åº¦ã€å¬å›ç‡å’Œ f åˆ†æ•°çš„å¹³å‡å€¼ã€‚)</p></div><div class="ab cl ne nf hx ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="im in io ip iq"><h1 id="846a" class="kz la it bd lb lc nl le lf lg nm li lj jz nn ka ll kc no kd ln kf np kg lp lq bi translated">åœ¨ä¸€èµ·æ›´å¥½ã€‚</h1><p id="a1b3" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">å·²ç»çœ‹åˆ°å•è¯è¢‹ç®¡é“å’Œè‡ªå®šä¹‰è¯­è¨€ç‰¹å¾ç®¡é“ç‹¬ç«‹åœ°äº§ç”Ÿæœ€ä½³ç»“æœï¼Œæˆ‘æƒ³çŸ¥é“å¦‚æœæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç»“åˆä¸¤è€…ç‰¹å¾çš„æ–°ç®¡é“ä¼šæœ‰ä»€ä¹ˆæ•ˆæœã€‚å¹¸è¿çš„æ˜¯ï¼Œæœ‰ä¸€ä¸ªç®€å•çš„æ–¹æ³•å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ï¼</p><h2 id="3c0e" class="nu la it bd lb ob oc dn lf od oe dp lj ma of og ll me oh oi ln mi oj ok lp ol bi translated">ç®¡é“å››:ç»„åˆåŠŸèƒ½</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/2dd27f55ded849d6cdb8e56fbe4b36da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fPOH7W8nInFhjnVC5y7WQg.jpeg"/></div></div></figure><p id="fb90" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">ç»„åˆç‰¹å¾é›†ç”±<code class="fe ms mt mu mv b"><strong class="lt iu">FeatureUnion</strong></code>å®Œæˆ:</p><blockquote class="mw mx my"><p id="fea0" class="lr ls mz lt b lu mn ju lw lx mo jx lz na mp mc md nb mq mg mh nc mr mk ml mm im bi translated"><a class="ae ky" href="https://scikit-learn.org/0.16/modules/generated/sklearn.pipeline.FeatureUnion.html#sklearn.pipeline.FeatureUnion" rel="noopener ugc nofollow" target="_blank"> FeatureUnion </a>å°†å‡ ä¸ª transformer å¯¹è±¡ç»„åˆæˆä¸€ä¸ªæ–°çš„ transformerï¼Œè¯¥ transformer å°†å®ƒä»¬çš„è¾“å‡ºè¿›è¡Œç»„åˆã€‚FeatureUnion æ¥å—ä¸€ä¸ª transformer å¯¹è±¡åˆ—è¡¨ã€‚åœ¨æ‹ŸåˆæœŸé—´ï¼Œ<strong class="lt iu">æ¯ä¸€ä¸ªéƒ½ç‹¬ç«‹åœ°æ‹Ÿåˆåˆ°æ•°æ®</strong>ã€‚ä¸ºäº†è½¬æ¢æ•°æ®ï¼Œè½¬æ¢å™¨è¢«å¹¶è¡Œåº”ç”¨<strong class="lt iu"/>ï¼Œå¹¶ä¸”å®ƒä»¬è¾“å‡ºçš„æ ·æœ¬å‘é‡è¢«<strong class="lt iu">é¦–å°¾ç›¸è¿</strong>æˆæ›´å¤§çš„å‘é‡ã€‚</p></blockquote><p id="b080" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">ä¸‹é¢ï¼Œ<code class="fe ms mt mu mv b">"classifier"</code>æ­¥éª¤å·²ç»ä»æ¯ä¸ªç®¡é“ä¸­åˆ é™¤ï¼Œå› ä¸ºè¯¥æ­¥éª¤éœ€è¦åœ¨æˆ‘ä»¬åº”ç”¨äº†<code class="fe ms mt mu mv b">FeatureUnion</code>ä¹‹åå‡ºç°ã€‚</p><pre class="kj kk kl km gt nq mv nr ns aw nt bi"><span id="2dd6" class="nu la it mv b gy nv nw l nx ny"># individual pipelines minus the estimator step: </span><span id="d6c4" class="nu la it mv b gy nz nw l nx ny"><strong class="mv iu">bow_pipeline</strong> = Pipeline(<br/>    steps=[<br/>        ("tfidf", TfidfVectorizer()),<br/>    ]<br/>)</span><span id="0dcd" class="nu la it mv b gy nz nw l nx ny"><strong class="mv iu">manual_pipeline</strong> = Pipeline(<br/>    steps=[<br/>        ("stats", ManualTransformer()),<br/>        ("dict_vect", DictVectorizer()),<br/>    ]<br/>)</span></pre><p id="57ea" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">æœ€ç»ˆç®¡é“ç”±é€šè¿‡<code class="fe ms mt mu mv b">FeatureUnion</code>å’Œæœ€ç»ˆåˆ†ç±»å™¨è¿æ¥çš„ç»„åˆç‰¹å¾ç»„æˆ:</p><pre class="kj kk kl km gt nq mv nr ns aw nt bi"><span id="1527" class="nu la it mv b gy nv nw l nx ny">combined_features = FeatureUnion(<br/>    transformer_list=[<br/>        ("bow", bow_pipeline),<br/>        ("manual", manual_pipeline),<br/>    ]<br/>)</span><span id="6acc" class="nu la it mv b gy nz nw l nx ny"><strong class="mv iu">final_pipeline</strong> = Pipeline(<br/>    steps=[<br/>        ("combined_features", combined_features),<br/>        ("classifier", RandomForestClassifier()),<br/>    ]<br/>)</span></pre><p id="baed" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">æ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æ‹Ÿåˆ<code class="fe ms mt mu mv b">final_pipeine</code>å¹¶è®¡ç®—æŒ‡æ ‡ï¼Œä½†æ˜¯ä¸ºäº†æ›´å¥½åœ°æµ‹é‡ï¼Œæˆ‘å°†å¯¹æ‹Ÿåˆçš„éšæœºæ£®æ—åˆ†ç±»å™¨çš„å‚æ•°æ‰§è¡Œéšæœºæœç´¢ã€‚(æ‚¨ä¹Ÿå¯ä»¥è¿è¡Œç½‘æ ¼æœç´¢ï¼Œä½†è¿™éœ€è¦æ›´é•¿æ—¶é—´ã€‚)</p><pre class="kj kk kl km gt nq mv nr ns aw nt bi"><span id="ea27" class="nu la it mv b gy nv nw l nx ny">from sklearn.model_selection import RandomizedSearchCV</span><span id="51bd" class="nu la it mv b gy nz nw l nx ny"># the keys can be accessed with <strong class="mv iu">final_pipeline.get_params().keys()</strong><br/>params = {<br/>    "combined_features__bow__tfidf__use_idf": [True, False],<br/>    "combined_features__bow__tfidf__ngram_range": [(1, 1), (1, 2)],<br/>    "classifier__bootstrap": [True, False],<br/>    "classifier__class_weight": ["balanced", None],<br/>    "classifier__n_estimators": [100, 300, 500, 800, 1200],<br/>    "classifier__max_depth": [5, 8, 15, 25, 30],<br/>    "classifier__min_samples_split": [2, 5, 10, 15, 100],<br/>    "classifier__min_samples_leaf": [1, 2, 5, 10]<br/>}</span><span id="1167" class="nu la it mv b gy nz nw l nx ny">search = RandomizedSearchCV(final_pipeline, params)<br/>search.fit(train_data, train_target)<br/>y_pred = search.predict(test_data)<br/>classification_report(test_target, y_pred)</span></pre><p id="c53b" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">é…·ï¼ç»“æœ<em class="mz">æ¯”</em>æ›´å¥½ï¼Œå…·æœ‰ç‰¹å¾ç»Ÿä¸€å’Œç½‘æ ¼æœç´¢æ”¯æŒçš„å‚æ•°ä¼˜åŒ–ï¼</p><pre class="kj kk kl km gt nq mv nr ns aw nt bi"><span id="acb4" class="nu la it mv b gy nv nw l nx ny"># combined features + randomized search </span><span id="43eb" class="nu la it mv b gy nz nw l nx ny">              precision    recall  f1-score   support<br/><br/>           0       0.70      0.55      0.61       165<br/>           1       0.73      0.84      0.78       242<br/><br/>    accuracy                           <strong class="mv iu">0.72</strong>       407<br/>   macro avg       0.72      0.69      0.70       407<br/>weighted avg       0.72      0.72      0.71       407</span></pre><p id="08a6" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">åœ¨æ¯é¡¹æŒ‡æ ‡ä¸Šï¼Œæ··åˆæ¸ é“çš„å¾—åˆ†éƒ½é«˜äºè¡¨ç°æœ€ä½³çš„å•ä¸ªæ¸ é“:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pj"><img src="../Images/025beb1ef3dc97c7d6778108b09dafc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HNCvGiMYoFSJf67iin5yQw.png"/></div></div></figure><p id="d4a8" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">ä½œä¸ºæ­£ç¡®çš„ä¸‹ä¸€æ­¥ï¼Œæ‚¨å¯ä»¥å°è¯•ç»„åˆæ‰€æœ‰ä¸‰ä¸ªç‰¹æ€§é›†ï¼Œçœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆï¼Œä»è€Œåˆ›å»ºä¸€ä¸ªçœŸæ­£çš„â€œtriuneâ€(ä¸‰åˆä¸€)ç®¡é“ã€‚ğŸ”±</p><h1 id="d754" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">ç»“æŸäº†ã€‚</h1><p id="3fb3" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘æ¼”ç¤ºäº†å¦‚ä½•å»ºç«‹ä¸‰ä½ä¸€ä½“ç®¡é“æ¥é¢„æµ‹æ€»ç»Ÿå€™é€‰äººæœ‰èµ„æ ¼å‚åŠ ä¸‹ä¸€åœºè¾©è®ºçš„å¯èƒ½æ€§ã€‚ä»–ä»¬æ˜¯:</p><ol class=""><li id="2bd8" class="pk pl it lt b lu mn lx mo ma pm me pn mi po mm pp pq pr ps bi translated">ä½¿ç”¨æ ‡å‡†<strong class="lt iu">å­—è¢‹</strong>æ¨¡å‹çš„ç®¡é“</li><li id="1f62" class="pk pl it lt b lu pt lx pu ma pv me pw mi px mm pp pq pr ps bi translated">ä½¿ç”¨<strong class="lt iu">å­—åµŒå…¥çš„ç®¡é“</strong></li><li id="f84d" class="pk pl it lt b lu pt lx pu ma pv me pw mi px mm pp pq pr ps bi translated">ä¸€æ¡ç®¡é“ä½¿ç”¨<strong class="lt iu">æ‰‹åŠ¨(è‡ªå®šä¹‰)åŠŸèƒ½</strong></li></ol><p id="daa2" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">æ¯ä¸ªç»„ä»¶ç®¡é“åŒ…æ‹¬ä¸€ä¸ªè½¬æ¢å™¨ï¼Œå®ƒè¾“å‡º NLP ä¸­çš„ä¸»è¦ç‰¹å¾ç±»å‹/è¡¨ç¤ºã€‚æˆ‘è¿˜å±•ç¤ºäº†æˆ‘ä»¬å¯ä»¥ç»„åˆæ¥è‡ªä¸åŒç®¡é“çš„ä¸åŒç‰¹æ€§é›†æ¥è·å¾—æ›´å¥½çš„ç»“æœï¼Œå°¤å…¶æ˜¯ä¸<code class="fe ms mt mu mv b">RandomizedSearchCV</code>ç»“åˆä½¿ç”¨æ—¶ã€‚æˆ‘è®¤ä¸ºå¦ä¸€ä¸ªå¾ˆå¥½çš„æ”¶è·æ˜¯ç»“åˆ ML é©±åŠ¨å’ŒåŸºäºè§„åˆ™çš„æ–¹æ³•æ¥æå‡æ¨¡å‹æ€§èƒ½çš„ä»·å€¼ã€‚</p><p id="d52a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">æˆ‘ç¡®å®å‘ç°ï¼Œå€™é€‰äººçš„æ¼”è®²ç‰¹æ€§<em class="mz">æœ¬èº«â€”â€”ä¸å—ä»»ä½•å…¶ä»–äººå£ç»Ÿè®¡ç‰¹å¾æˆ–å€™é€‰äººæ”¿æ²»æˆå°±ä¿¡æ¯çš„å½±å“</em>â€”â€”<em class="mz"/>èƒ½å¤Ÿç›¸å½“å‡†ç¡®åœ°é¢„æµ‹æŸäººæ˜¯å¦æœ‰èµ„æ ¼å‚åŠ ä¸‹ä¸€åœºè¾©è®ºï¼Œè¿™æ˜¯é¢„æµ‹æˆ‘ä»¬ä¸‹ä¸€ä»»æ€»ç»Ÿçš„ä¼—å¤šé¢„æµ‹å› ç´ ä¹‹ä¸€ã€‚</p></div><div class="ab cl ne nf hx ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="im in io ip iq"><p id="b453" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">å¦‚æœä½ æƒ³è¦ä¸é‚£ä¹ˆç½—å—¦çš„ä¸œè¥¿:</p><div class="op oq gp gr or os"><a href="https://medium.com/swlh/randomized-or-grid-search-with-pipeline-cheatsheet-719c72eda68" rel="noopener follow" target="_blank"><div class="ot ab fo"><div class="ou ab ov cl cj ow"><h2 class="bd iu gy z fp ox fr fs oy fu fw is bi translated">ç®¡é“éšæœº(æˆ–ç½‘æ ¼)æœç´¢è¶…çº§å¿«é€ŸæŒ‡å—</h2><div class="oz l"><h3 class="bd b gy z fp ox fr fs oy fu fw dk translated">ä½¿ç”¨ scikit çš„äº”ä¸ªæ­¥éª¤-å­¦ä¹ </h3></div><div class="pa l"><p class="bd b dl z fp ox fr fs oy fu fw dk translated">medium.com</p></div></div><div class="pb l"><div class="py l pd pe pf pb pg ks os"/></div></div></a></div></div></div>    
</body>
</html>