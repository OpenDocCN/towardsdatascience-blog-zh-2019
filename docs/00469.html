<html>
<head>
<title>Seamlessly Integrated Deep Learning Environment with Terraform, Google cloud, Gitlab and Docker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将深度学习环境与 Terraform、Google cloud、Gitlab 和 Docker 无缝集成</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/seamlessly-integrated-deep-learning-environment-with-terraform-google-cloud-gitlab-and-docker-faee4b351e94?source=collection_archive---------13-----------------------#2019-01-21">https://towardsdatascience.com/seamlessly-integrated-deep-learning-environment-with-terraform-google-cloud-gitlab-and-docker-faee4b351e94?source=collection_archive---------13-----------------------#2019-01-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div class="gh gi jq"><img src="../Images/cf6fcce53ff22dce03817d6e40deb626.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/1*klFO3rgLSPYhj3OvmdfvGQ.png"/></div></figure><p id="08b4" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">当你开始一些严肃的深度学习项目时，你通常会遇到需要一个合适的 GPU 的问题。购买适合深度学习工作负载的合理工作站很容易变得非常昂贵。幸运的是，云中有一些选项。我尝试的一个方法是使用美妙的谷歌计算引擎。在 GCE 中，GPU 可以作为实例的外部加速器。目前，有这些 GPU 可用(价格为美国中心 1)。</p><ul class=""><li id="9587" class="kv kw it jz b ka kb ke kf ki kx km ky kq kz ku la lb lc ld bi translated">英伟达特斯拉 P4:每月每 GPU 1267.28 美元</li><li id="8671" class="kv kw it jz b ka le ke lf ki lg km lh kq li ku la lb lc ld bi translated">NVIDIA Tesla V100:每个 GPU 每月 306.60 美元</li><li id="0e3d" class="kv kw it jz b ka le ke lf ki lg km lh kq li ku la lb lc ld bi translated">英伟达特斯拉 P100:每月每 GPU 746.06 美元</li><li id="e758" class="kv kw it jz b ka le ke lf ki lg km lh kq li ku la lb lc ld bi translated">NVIDIA Tesla K80:每月每 GPU 229.95 美元</li></ul><p id="10cf" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">手动配置通常不是您可以轻松扩展的事情，所以我做了一些调查，看是否有方法可以尽可能无缝地扩展我的环境，并以同样的方式破坏它。因此，我找到了一个解决方案，使用 terraform 在谷歌计算平台上建立基础设施。源代码从 Git 部署，Docker 容器自动启动，安装了所有必要的依赖项，如 tensorflow、keras 和 jupyter。在这篇博文中，我将指导你如何轻松设置环境的各个步骤。一些工作基于这个 git 库:<a class="ae lj" href="https://github.com/Cheukting/GCP-GPU-Jupyter" rel="noopener ugc nofollow" target="_blank">https://github.com/Cheukting/GCP-GPU-Jupyter</a></p><h1 id="4070" class="lk ll it bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">你会从博文中学到什么？</h1><ul class=""><li id="4a16" class="kv kw it jz b ka mi ke mj ki mk km ml kq mm ku la lb lc ld bi translated">以自动化的方式使用 GPU 设置 GCE 实例</li><li id="9a2f" class="kv kw it jz b ka le ke lf ki lg km lh kq li ku la lb lc ld bi translated">如何与 GCP 一起使用 terraform</li><li id="9abc" class="kv kw it jz b ka le ke lf ki lg km lh kq li ku la lb lc ld bi translated">如何将 Gitlab 存储库的代码部署到 GCE 实例中</li></ul><figure class="mo mp mq mr gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi mn"><img src="../Images/2d94ee54158efd297c9c7c70b98ac570.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sVL-TiTyzBc8HHcahsCa9Q.png"/></div></div><figcaption class="mw mx gj gh gi my mz bd b be z dk">What we will build in this blog post.</figcaption></figure><p id="2ec9" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">如上图所示，我将向您展示如何编写一个 terraform 脚本，该脚本自动启动一个 Google compute engine 虚拟机，在其上安装 CUDA、Docker 等，并最终使用来自另一个外部 Git 存储库(在我们的例子中是来自 gitlab)的代码启动一个 Docker 容器。这个 Docker 容器运行的是 jupyter 笔记本服务器，可以通过浏览器从外部访问。此外，我将向您展示如何使用 Docker 在虚拟机中运行笔记本之外的更长时间的任务。</p><h1 id="9826" class="lk ll it bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">TL；速度三角形定位法(dead reckoning)</h1><p id="4fd2" class="pw-post-body-paragraph jx jy it jz b ka mi kc kd ke mj kg kh ki na kk kl km nb ko kp kq nc ks kt ku im bi translated">只是想试试，那就去看看 TL；DR 部分，列出了所有必要的命令。</p><h1 id="7a02" class="lk ll it bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">为您的 python 代码创建 Gitlab 库</h1><p id="76bd" class="pw-post-body-paragraph jx jy it jz b ka mi kc kd ke mj kg kh ki na kk kl km nb ko kp kq nc ks kt ku im bi translated">如果你已经有一个想要给我们的知识库，请随意。否则，现在应该创建一个新的存储库。https://gitlab.com/<a class="ae lj" href="https://gitlab.com/" rel="noopener ugc nofollow" target="_blank">。你所有的 ml 和 data exploration 代码都将进入这个库。我们将把它与基础设施代码分开。</a></p><p id="70e1" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">同样，在这个 Gitlab 存储库中，您现在可以添加所有代码，例如，创建一个简单的 train.py python 文件来训练神经网络，并在最后保存训练好的权重。这里可以找到一个非常简单的例子:https://gitlab.com/dice89/deep-learning-experiments</p><p id="a684" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">这个 repo 只包含一个用于数据探索的 Jupyter 笔记本和一个用于训练 RNN·LSTM 文本生成模型的<em class="nd"> train.py </em>。</p><h1 id="dde8" class="lk ll it bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">创建您自己的 Docker 图像/使用现有的图像</h1><p id="9187" class="pw-post-body-paragraph jx jy it jz b ka mi kc kd ke mj kg kh ki na kk kl km nb ko kp kq nc ks kt ku im bi translated">您可以采用现有的 Docker 图像，也可以创建自己的图像。为了简单起见，我们将使用预构建的 Docker 映像，其中安装了 python 3.5 环境，并包含了合理的深度学习用例所需的所有库。它应该包含第一次尝试所需的一切:python 3。x，tensorflow-gpu，numpy，pandas，sklearn，keras</p><p id="fff1" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">如果你感兴趣，你可以看看这张图片:https://hub.docker.com/r/dice89/ubuntu-gpu-python-dl/<a class="ae lj" href="https://hub.docker.com/r/dice89/ubuntu-gpu-python-dl/" rel="noopener ugc nofollow" target="_blank"/></p><h1 id="be17" class="lk ll it bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">使用 Terraform 配置和启动实例</h1><p id="5b69" class="pw-post-body-paragraph jx jy it jz b ka mi kc kd ke mj kg kh ki na kk kl km nb ko kp kq nc ks kt ku im bi translated">Terraform 是一个“基础设施即代码”工具包，允许您通过编写代码来定义、创建和销毁基础设施。这带来了很多好处:例如，你不需要像在 GCP 控制台中那样通过 UI 来配置任何东西。此外，默认情况下，您的整个基础设施配置都有文档记录，因为它是可读的代码，在 git 存储库中有理想的版本。我一年前才发现 Terraform，已经无法想象没有它如何建立基础设施。Hashicorp 发现了可编码和可版本化基础设施的完美结合，这可以用编码者的心态来理解。您只需要一些 terraform 文件和 terraform CLI 来创建您的基础架构。</p><p id="0a40" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">添加新的 Google compute 实例很容易创建，如下所示:</p><figure class="mo mp mq mr gt ju"><div class="bz fp l di"><div class="ne nf l"/></div><figcaption class="mw mx gj gh gi my mz bd b be z dk">Example of a gcloud compute instance creation with terraform.</figcaption></figure><p id="01c8" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">在创建实例之前，您需要预先执行一些步骤:</p><ul class=""><li id="0153" class="kv kw it jz b ka kb ke kf ki kx km ky kq kz ku la lb lc ld bi translated">创建 gcloud 帐户(<a class="ae lj" href="https://cloud.google.com/" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com/</a>)</li><li id="a165" class="kv kw it jz b ka le ke lf ki lg km lh kq li ku la lb lc ld bi translated">安装 gcloud CLI 工具作为<a class="ae lj" href="https://cloud.google.com/sdk/docs/" rel="noopener ugc nofollow" target="_blank"> Google Cloud SDK </a>的一部分</li><li id="7942" class="kv kw it jz b ka le ke lf ki lg km lh kq li ku la lb lc ld bi translated">使用您的终端“gcloud auth login”登录 gcloud</li></ul><p id="e6e5" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">在下面的代码片段中，您将创建一个 gcloud 项目，将执行上下文设置为您的当前帐户，创建一个能够创建新实例的服务帐户，最后下载私钥以在 terraform 中使用该服务帐户。</p><figure class="mo mp mq mr gt ju"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="6779" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">在您的 CLI 中执行这些命令，并用您想要的项目名称替换<your>。这可能需要一些时间，主要是因为激活了计算 API。</your></p><p id="6f5b" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">在我们开始实例之前，让我们看一下关于如何配置一个支持 GPU 的 Google compute 实例的细节。<em class="nd">不幸的是，你必须为 GPU 申请一个配额(直到 2018 年 12 月没有它，它一直为我工作)。请听从本</em> <a class="ae lj" href="https://stackoverflow.com/questions/45227064/how-to-request-gpu-quota-increase-in-google-cloud" rel="noopener ugc nofollow" target="_blank"> <em class="nd"> Stackoverflow 文章</em> </a> <em class="nd">的建议。处理此请求可能需要 2 个工作日。</em></p><figure class="mo mp mq mr gt ju"><div class="bz fp l di"><div class="ne nf l"/></div><figcaption class="mw mx gj gh gi my mz bd b be z dk">Google Compute Instance with a GPU</figcaption></figure><p id="4202" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">正如您在第 19 行中看到的，我们向该实例添加了一个 Tesla K80 GPU，启动时我们在一个脚本中执行一些操作(<em class="nd"> start-up-script.sh </em>)。如下所示:</p><figure class="mo mp mq mr gt ju"><div class="bz fp l di"><div class="ne nf l"/></div><figcaption class="mw mx gj gh gi my mz bd b be z dk">Setting up Ubuntu VM to run with CUDA</figcaption></figure><p id="3d43" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">在这个脚本中，我们安装所有需要的库，为用户添加一个 ssh 密钥，并运行 Docker 容器，将端口 80 暴露给外界。因此，我们可以到达 jupyter 笔记本服务器。请注意，创建此实例后，任何知道 IP 的人都可以访问您的笔记本。即使对于像这样的短命环境，这也应该改变。现在创建一个新的 ssh 密钥，以便能够将我们的代码从 Gitlab 部署到实例中。</p><pre class="mo mp mq mr gt ng nh ni nj aw nk bi"><span id="ce0f" class="nl ll it nh b gy nm nn l no np">ssh-keygen -t rsa -b 4096 -C “your_email@example.com”</span></pre><p id="e15b" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">为了使它工作，您必须将占位符“在此添加您的 SSH 密钥”替换为您生成的私有(！！！)在<em class="nd">启动脚本. sh </em>中输入 ssh 密钥。请注意:不要与任何人分享您的密钥！从这个存储库中克隆完整的配置，然后更改您的 ssh 密钥:<a class="ae lj" href="https://gitlab.com/dice89/google-cloud-gpu-vm." rel="noopener ugc nofollow" target="_blank">https://gitlab.com/dice89/google-cloud-gpu-vm.</a>(不要将您的私钥提交给任何 git 存储库)另外，确保您的 credentials.json 在这个文件夹的根目录中(不要提交 credentials.json)。您还必须将这个 ssh 密钥添加到您的 gitlab 帐户，以便可以部署来自 Gitlab 存储库的代码。</p><p id="cbcf" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">现在我们准备创建机器。这仅用 3 个 bash 命令就可以实现！🚀</p><figure class="mo mp mq mr gt ju"><div class="bz fp l di"><div class="ne nf l"/></div></figure><p id="8ed0" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">填写您的 GCP 项目 id 类型“是”,您的实例将被创建(还要考虑这将导致的成本，免费层不包括 GPU)。创建实例后，您将看到一个发布到命令行的 IP 地址。这是您的公共 IP，您的 jupyter 实例将在该 IP 下可用。可能需要几分钟的时间，直到<em class="nd">启动脚本. sh </em>完成并安装好所有东西。</p><p id="19e5" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">在脚本完成之前，让我们花点时间来研究一下这个实例。为了做到这一点，你必须 ssh 到它。幸运的是，谷歌为我们提供了一个命令。</p><pre class="mo mp mq mr gt ng nh ni nj aw nk bi"><span id="0ddd" class="nl ll it nh b gy nm nn l no np">gcloud compute --project “&lt;your&gt;_dl” ssh --zone “europe-west1-d” “gpu-vm”</span></pre><p id="1f45" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated"><em class="nd"> start-up-script.sh </em>作为根用户运行，因此，您必须切换到您的根控制台来查看发生了什么。</p><pre class="mo mp mq mr gt ng nh ni nj aw nk bi"><span id="a00d" class="nl ll it nh b gy nm nn l no np">sudo su<br/>cd /var/log<br/>tail -f syslog | grep startup-script</span></pre><p id="5a65" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">现在我们在实例上，可以检查，例如，是否安装并使用了 GPU。</p><pre class="mo mp mq mr gt ng nh ni nj aw nk bi"><span id="111d" class="nl ll it nh b gy nm nn l no np">nvidia-smi -l 1</span></pre><p id="4f57" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">我们还可以安装 htop，因为它可以方便地监控正在运行的进程的内存消耗:</p><pre class="mo mp mq mr gt ng nh ni nj aw nk bi"><span id="b983" class="nl ll it nh b gy nm nn l no np">sudo apt-get install htop</span></pre><p id="aeed" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">过一会儿，您可以检查是否已经有 Docker 容器在运行:</p><pre class="mo mp mq mr gt ng nh ni nj aw nk bi"><span id="ff86" class="nl ll it nh b gy nm nn l no np">docker ps</span></pre><p id="869d" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">如果你在这个概览上看到你的 Docker 容器，你已经准备好在显示的 IP 下登录你的 jupyter 笔记本。</p><p id="1b9d" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">此外，如果你进入路径<em class="nd">~/data science/deep-learning-experiments</em>，你会看到它会自动挂载到你的 Docker 容器中的<em class="nd"> /root/project </em>下，并包含你的 gitlab 库的内容，如<em class="nd"> train.py </em>。</p><h1 id="a3c8" class="lk ll it bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">在 jupyter 外执行训练任务</h1><p id="6b96" class="pw-post-body-paragraph jx jy it jz b ka mi kc kd ke mj kg kh ki na kk kl km nb ko kp kq nc ks kt ku im bi translated">Jupyter 非常适合一些数据探索或实验代码。然而，训练深度学习模型需要很多时间，你不能承受 jupyter 会话崩溃和丢失所有训练进度。幸运的是，有一种补救方法。通过运行 Docker 容器作为守护进程，运行 python 脚本来训练您的模型，您可以非常容易地训练一个新模型。例如，在我们的示例类型中，您需要做的所有事情都是。</p><pre class="mo mp mq mr gt ng nh ni nj aw nk bi"><span id="4bad" class="nl ll it nh b gy nm nn l no np">docker run --runtime=nvidia -d -v ~/datascience:/root/project dice89/ubuntu-gpu-python-dl python3 /root/project/deep-learning-experiments/train.py</span></pre><p id="5480" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">如果您现在检查<em class="nd"> docker ps </em>，您会看到类似这样的内容:</p><figure class="mo mp mq mr gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi nq"><img src="../Images/6252d64a3fced78c44ef2aef7808724a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u5OJU6hlIkMTfmWAkFtL0A.png"/></div></div></figure><p id="3bee" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">要查看训练任务的日志，只需输入:</p><pre class="mo mp mq mr gt ng nh ni nj aw nk bi"><span id="2406" class="nl ll it nh b gy nm nn l no np">docker logs &lt;your_container_id_from docker ps&gt;</span></pre><p id="8fb6" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">最后，您将使用 Git 存储库中的代码以可重复的方式训练您的模型。当您完成并保存和储存了您的体重后，您只需输入:</p><pre class="mo mp mq mr gt ng nh ni nj aw nk bi"><span id="a34c" class="nl ll it nh b gy nm nn l no np">terraform destroy \<br/>  -var 'project_id=&lt;your&gt;-dl' \<br/>  -var 'region=europe-west1-d'</span></pre><p id="3ab2" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">如果您需要相同的环境，只需输入:</p><pre class="mo mp mq mr gt ng nh ni nj aw nk bi"><span id="b6ba" class="nl ll it nh b gy nm nn l no np">terraform apply \<br/>  -var 'project_id=&lt;your&gt;-dl' \<br/>  -var 'region=europe-west1-d'</span></pre><p id="6465" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">所以，这就是这个关于如何使用云资源创建深度学习环境的小演练。祝你试用愉快，如果你有任何改善环境的建议，请给我一些反馈。</p><h1 id="a316" class="lk ll it bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">TL；速度三角形定位法(dead reckoning)</h1><p id="55b8" class="pw-post-body-paragraph jx jy it jz b ka mi kc kd ke mj kg kh ki na kk kl km nb ko kp kq nc ks kt ku im bi translated">下面是使用预定义的 Docker 容器创建环境的说明。用你喜欢的前缀替换<your>。</your></p><p id="48e6" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">1.创建 gcloud 帐户</p><p id="028f" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">2.安装 g cloud CLI:https://cloud.google.com/sdk/docs/downloads-interactive</p><pre class="mo mp mq mr gt ng nh ni nj aw nk bi"><span id="ab48" class="nl ll it nh b gy nm nn l no np">curl <a class="ae lj" href="https://sdk.cloud.google.com" rel="noopener ugc nofollow" target="_blank">https://sdk.cloud.google.com</a> | bash<br/>exec -l $SHELL<br/>gcloud init</span></pre><p id="1ed9" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">3.创建 Gcloud 帐户和项目(替换<your>)</your></p><pre class="mo mp mq mr gt ng nh ni nj aw nk bi"><span id="3090" class="nl ll it nh b gy nm nn l no np">gcloud projects create &lt;your&gt;-dl --enable-cloud-apis<br/>gcloud config set project  &lt;your&gt;-dl<br/>gcloud services enable compute.googleapis.com</span></pre><p id="bcd8" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">4.安装地形:<a class="ae lj" href="https://www.terraform.io/intro/getting-started/install.html" rel="noopener ugc nofollow" target="_blank">https://www.terraform.io/intro/getting-started/install.html</a></p><pre class="mo mp mq mr gt ng nh ni nj aw nk bi"><span id="e5b0" class="nl ll it nh b gy nm nn l no np">brew install terraform</span></pre><p id="6601" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">6.(如果你想给它部署一些代码的话是可选的)Fork 和 git 克隆深度学习实验</p><p id="f887" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated"><a class="ae lj" href="https://gitlab.com/dice89/deep-learning-experiments/forks/new" rel="noopener ugc nofollow" target="_blank">https://git lab . com/dice 89/deep-learning-experiments/forks/new</a></p><pre class="mo mp mq mr gt ng nh ni nj aw nk bi"><span id="19f5" class="nl ll it nh b gy nm nn l no np">git clone <a class="ae lj" href="mailto:git@gitlab.com" rel="noopener ugc nofollow" target="_blank">git@gitlab.com</a>:&lt;your_user&gt;/deep-learning-experiments.git</span></pre><p id="01c9" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">7.Git 克隆代码，用 GPU 定义 Google 计算引擎 VM</p><pre class="mo mp mq mr gt ng nh ni nj aw nk bi"><span id="02c1" class="nl ll it nh b gy nm nn l no np">git clone git@gitlab.com:dice89/google-cloud-gpu-vm.git<br/>cd google-cloud-gpu-vm</span></pre><p id="a0f0" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">6.创建 ssh 密钥</p><pre class="mo mp mq mr gt ng nh ni nj aw nk bi"><span id="ec8c" class="nl ll it nh b gy nm nn l no np">ssh-keygen -t rsa -b 4096 -C “your_email@example.com”</span></pre><p id="c559" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">7.将私有 ssh 密钥添加到 Google 云基础架构“start_up_script.sh”</p><p id="80a3" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">8.将公共 ssh 密钥添加到您的 Gitlab 帐户</p><p id="6e88" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">9.创建一个 GCP 服务帐户并获取凭据</p><pre class="mo mp mq mr gt ng nh ni nj aw nk bi"><span id="cded" class="nl ll it nh b gy nm nn l no np">gcloud iam service-accounts create gcp-terraform-dl --display-name gcp-terraform-dl</span><span id="1d8b" class="nl ll it nh b gy nr nn l no np">gcloud projects add-iam-policy-binding  &lt;your&gt;-dl \<br/>            --member='serviceAccount:gcp-terraform-dl@&lt;your&gt;-dl.iam.gserviceaccount.com' --role='roles/owner'</span><span id="97e6" class="nl ll it nh b gy nr nn l no np">gcloud iam service-accounts keys create 'credentials.json' --iam-account='gcp-terraform-dl@&lt;your&gt;-dl.iam.gserviceaccount.com'</span></pre><p id="7ade" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">10.初始化你的地形环境</p><pre class="mo mp mq mr gt ng nh ni nj aw nk bi"><span id="446e" class="nl ll it nh b gy nm nn l no np">terraform init</span></pre><p id="849b" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">11.启动环境</p><pre class="mo mp mq mr gt ng nh ni nj aw nk bi"><span id="87af" class="nl ll it nh b gy nm nn l no np">terraform apply \<br/>  -var 'project_id=&lt;your&gt;-dl' \<br/>  -var 'region=europe-west1-d'</span></pre><p id="faa3" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">稍等片刻(大约 5-10 分钟),查看您的 jupyter 笔记本电脑服务器的 IP 地址:</p><pre class="mo mp mq mr gt ng nh ni nj aw nk bi"><span id="9e05" class="nl ll it nh b gy nm nn l no np">terraform show | grep assigned_nat_ip</span></pre><p id="2361" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">要 ssh 到您计算实例:</p><pre class="mo mp mq mr gt ng nh ni nj aw nk bi"><span id="b8e7" class="nl ll it nh b gy nm nn l no np">gcloud compute — project “&lt;your&gt;-dl” ssh — zone “europe-west1-d” “gpu-vm”</span></pre><p id="5ab4" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">12.破坏环境</p><pre class="mo mp mq mr gt ng nh ni nj aw nk bi"><span id="7c47" class="nl ll it nh b gy nm nn l no np">terraform destroy \<br/>  -var 'project_id=&lt;your&gt;-dl' \<br/>  -var 'region=europe-west1-d'</span></pre><p id="9f94" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated"><em class="nd">如果你发现教程有什么问题，请向我反映！我非常希望它保持最新。</em></p></div></div>    
</body>
</html>