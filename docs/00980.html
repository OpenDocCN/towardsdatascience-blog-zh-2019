<html>
<head>
<title>Time Series in Python — Part 2: Dealing with seasonal data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python 中的时间序列—第 2 部分:处理季节性数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/time-series-in-python-part-2-dealing-with-seasonal-data-397a65b74051?source=collection_archive---------4-----------------------#2019-02-15">https://towardsdatascience.com/time-series-in-python-part-2-dealing-with-seasonal-data-397a65b74051?source=collection_archive---------4-----------------------#2019-02-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="f286" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kl">在</em> <a class="ae km" rel="noopener" target="_blank" href="/time-series-in-python-exponential-smoothing-and-arima-processes-2c67f2a52788"> <em class="kl">第一部分</em> </a> <em class="kl">中，你学习了趋势和季节性、平滑模型和 ARIMA 过程。在这一部分中，您将学习如何处理季节性模型，以及如何实现季节性 Holt-Winters 和季节性 ARIMA (SARIMA)。</em></p><h1 id="461c" class="kn ko iq bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk bi translated">获取数据</h1><p id="b290" class="pw-post-body-paragraph jn jo iq jp b jq ll js jt ju lm jw jx jy ln ka kb kc lo ke kf kg lp ki kj kk ij bi translated">我们将使用“每月牛奶产量”数据:</p><figure class="lq lr ls lt gt lu"><div class="bz fp l di"><div class="lv lw l"/></div></figure><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="gh gi lx"><img src="../Images/a23b76300bb933cecda62d0140ed4df5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kTxFxHrvDH35Hyd3ifDMpQ.png"/></div></div></figure><h2 id="88c2" class="me ko iq bd kp mf mg dn kt mh mi dp kx jy mj mk lb kc ml mm lf kg mn mo lj mp bi translated">季节分解</h2><p id="ca95" class="pw-post-body-paragraph jn jo iq jp b jq ll js jt ju lm jw jx jy ln ka kb kc lo ke kf kg lp ki kj kk ij bi translated">在<a class="ae km" rel="noopener" target="_blank" href="/time-series-in-python-exponential-smoothing-and-arima-processes-2c67f2a52788">上一篇</a>中，我简单讲过季节分解。季节性分解的思想是，任何序列都可以分解为三个部分的总和(或乘积):趋势、季节性成分和残差。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/e5743df9ed59a75a6986bed5f0c36430.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*XwWP7JInuQJ7A1B_GOceXg.png"/></div></figure><p id="d7ba" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我们的例子中，我们将使用 statsmodels 提供的<em class="kl">季节性分解</em>函数:</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/281918c7a77c7b2e29f2254d4b8213b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:956/format:webp/1*FY_yvZiKhm3UA2pu9qp7pw.png"/></div></figure><p id="8c54" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">趋势分量是一条增长曲线，似乎达到了一个平稳状态，并最终在终点下降。这是一个有用的信息，当我们将消除趋势，以稳定的数据。</p><h1 id="d4ce" class="kn ko iq bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk bi translated">将数据固定化</h1><h2 id="2fae" class="me ko iq bd kp mf mg dn kt mh mi dp kx jy mj mk lb kc ml mm lf kg mn mo lj mp bi translated">应对趋势</h2><p id="3d81" class="pw-post-body-paragraph jn jo iq jp b jq ll js jt ju lm jw jx jy ln ka kb kc lo ke kf kg lp ki kj kk ij bi translated">基于我们的分解，我们看到趋势是跟随一个向上的运动，然后在最后达到稳定状态(或者下降)。为了消除这种趋势，我们将尝试一种新颖的方法，即回归 STL 分解给出的趋势。然后，如果回归令人满意，我们将尝试通过从原始序列中减去获得的回归来“缩小”序列。</p><figure class="lq lr ls lt gt lu"><div class="bz fp l di"><div class="lv lw l"/></div></figure><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="gh gi ms"><img src="../Images/17a74d51f24e86c675fd9721c6f244a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EHUPNyw9EVdRd_x5ToXtSw.png"/></div></div></figure><p id="9f4d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们回归的 r 平方系数相当好(0.988)，但是查看残差，我们注意到它们的方差从左到右增加。这是异方差的标志。您可以自己查找确切的定义，只要记住这并不好，我们的模型中缺少了一些东西。我们将放弃回归趋势的想法，因为它现在需要太多的努力。</p><h2 id="ef22" class="me ko iq bd kp mf mg dn kt mh mi dp kx jy mj mk lb kc ml mm lf kg mn mo lj mp bi translated">应对趋势，第 2 页</h2><p id="be4c" class="pw-post-body-paragraph jn jo iq jp b jq ll js jt ju lm jw jx jy ln ka kb kc lo ke kf kg lp ki kj kk ij bi translated">我们的系列仍然需要站化，我们将回到基本方法，看看我们是否可以消除这种趋势。我们将分几个步骤操作:</p><ul class=""><li id="e558" class="mt mu iq jp b jq jr ju jv jy mv kc mw kg mx kk my mz na nb bi translated">对原始数据进行 ADF 测试以检查平稳性</li><li id="51fd" class="mt mu iq jp b jq nc ju nd jy ne kc nf kg ng kk my mz na nb bi translated">12 个月差异的 ADF 测试</li><li id="da3a" class="mt mu iq jp b jq nc ju nd jy ne kc nf kg ng kk my mz na nb bi translated">对记录数据的 12 个月差异进行 ADF 检验</li><li id="e7ad" class="mt mu iq jp b jq nc ju nd jy ne kc nf kg ng kk my mz na nb bi translated">对减去 12 个月移动平均值的数据进行 ADF 测试</li></ul><p id="da1d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kl">如果您需要代码，请参考第一部分，了解如何进行 ADF 测试</em></p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/65934ef064f1f216f5c4abea3539a126.png" data-original-src="https://miro.medium.com/v2/resize:fit:1348/format:webp/1*eLPD8__bRoafHBT0T4Neyg.png"/></div></figure><p id="c2c1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们用 KPSS 检验来确认数据减去 12 个月的均线是平稳的:</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/7a10109fcac716f39d67abb26145d807.png" data-original-src="https://miro.medium.com/v2/resize:fit:698/format:webp/1*QUPD0wUmTDCVn78IkQBwDA.png"/></div></figure><p id="1c27" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">测试统计低于阈值，因此<strong class="jp ir">我们的序列是平稳的</strong>(回想一下，对于 KPSS 测试，零假设是序列是平稳的)。</p><h1 id="8799" class="kn ko iq bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk bi translated">霍尔特-温特季节平滑模型的拟合</h1><p id="1055" class="pw-post-body-paragraph jn jo iq jp b jq ll js jt ju lm jw jx jy ln ka kb kc lo ke kf kg lp ki kj kk ij bi translated">记得从<a class="ae km" rel="noopener" target="_blank" href="/time-series-in-python-exponential-smoothing-and-arima-processes-2c67f2a52788">第一部分</a>得知，霍尔特-温特的模型有几个部分:一个<strong class="jp ir"> <em class="kl">水平</em> </strong>，一个<strong class="jp ir"> <em class="kl">趋势</em> </strong>，在季节性平滑的情况下，一个<strong class="jp ir"> <em class="kl">季节性</em> </strong>成分。这背后的数学有点难，所以我不会把它放在这里，只要记住上面的三个组成部分。以下是我们拟合模型后得到的结果:</p><figure class="lq lr ls lt gt lu"><div class="bz fp l di"><div class="lv lw l"/></div></figure><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/096b0c2231df9f2e59d8614f85ca3372.png" data-original-src="https://miro.medium.com/v2/resize:fit:1298/format:webp/1*glIziOeMNMEZpo4AIc2RXg.png"/></div></figure><p id="8988" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">没有阻尼的模型似乎表现更好，因为 AIC 更低。</p><h1 id="b197" class="kn ko iq bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk bi translated">季节性 ARIMA</h1><p id="4f4f" class="pw-post-body-paragraph jn jo iq jp b jq ll js jt ju lm jw jx jy ln ka kb kc lo ke kf kg lp ki kj kk ij bi translated">老 ARIMA 又回来了，但这一次我们将为它添加季节性元素！SARIMA 模型由两部分组成:非季节性部分和季节性部分。如果你还记得<a class="ae km" rel="noopener" target="_blank" href="/time-series-in-python-exponential-smoothing-and-arima-processes-2c67f2a52788">上一部分</a>，非季节性部分由 AR(p)项、MA(q)项、I(d)项组成，我们写 ARIMA (p，d，q)。季节性的部分也是一样的！<br/>我们的舍利玛是指 ARIMA (p，D，q)x(P，D，Q)。</p><p id="37b5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> <em class="kl">问题:我们如何确定所有这些 P，D，Q，P，D，Q？</em> </strong></p><blockquote class="nk nl nm"><p id="d343" class="jn jo kl jp b jq jr js jt ju jv jw jx nn jz ka kb no kd ke kf np kh ki kj kk ij bi translated">每当你听到“ARIMA”，就想到“ACF/PACF”。</p></blockquote><p id="017c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有了 ACF 和 PACF 图，我们将能够猜测我们的参数的合理值。让我们绘制我们的静态化数据的 ACF 和 PACF 图:</p><figure class="lq lr ls lt gt lu"><div class="bz fp l di"><div class="lv lw l"/></div></figure><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="gh gi nq"><img src="../Images/3090af9bc60d7a632e4fd5c6a58a60cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*spf8FSAWKnBlaSoxuB7EbQ.png"/></div></div></figure><p id="fcf3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">鉴于在 ACF 中观察到的尖峰信号的缓慢衰减，数据显然不是稳定的。这是一个信号，表明我们应该对<em class="kl"> x: </em>取一个额外的差值</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="gh gi nr"><img src="../Images/98bc9156086d36bee7f98597b87ccf03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oZTO3CMRx1Vvs4L9y-yb0A.png"/></div></div></figure><p id="53d1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们的系列现在是静止的。总而言之，我们有:</p><ul class=""><li id="06c2" class="mt mu iq jp b jq jr ju jv jy mv kc mw kg mx kk my mz na nb bi translated">取平稳序列的 12 个滞后差。这相当于“一个季节滞后”的差异。</li><li id="66a8" class="mt mu iq jp b jq nc ju nd jy ne kc nf kg ng kk my mz na nb bi translated">取 12 滞后差分序列的 1 滞后差分。这对应于 1 的非季节性差序。</li></ul><p id="4396" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这给了我们一个萨里玛(？, 1, ?)x(？, 1, ?).</p><p id="f723" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"><em class="kl">AR 和 MA 术语呢？</em> </strong></p><p id="c290" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">嗯，我们知道在 ACF 和 PACF 中仍然有显著的峰值，所以我们可以决定添加 AR 术语和 MA 术语。我们应该从哪一个开始？这一次，我们将使用网格搜索 AR 和 MA 术语的可能组合(最大顺序限制为 2)…</p><p id="11a9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当运行不同的配置时，使用 SARIMA(0，1，2)x(0，1，2)可以获得最低的 AIC。</p><figure class="lq lr ls lt gt lu"><div class="bz fp l di"><div class="lv lw l"/></div></figure><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/63c548fa5c6e736b27212aaf25e91c63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1302/format:webp/1*ynr0mZbO0uCD3LnbOcSI5w.png"/></div></figure><p id="2ddb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用<em class="kl">plot _ diagnotis()</em>命令，我们可以显示残差并检查它们的正态性(记住，残差应该是正态分布的(零均值和一元方差)并且不相关)。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="gh gi nt"><img src="../Images/930bd64e6e4a8cec9b2ffa0db0e2dcd3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1306/format:webp/1*IIeks322xgT61bmK0T8q3Q.png"/></div></div></figure><p id="fd99" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请注意正态 Q-Q 图和直方图如何显示我们的残差遵循正态分布(我们可以使用额外的测试来测试正态性，如 Ljung-Box)。相关图还显示残差是不相关的！</p></div><div class="ab cl nu nv hu nw" role="separator"><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz"/></div><div class="ij ik il im in"><p id="1fb7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">附加讲座</strong>:</p><p id="4ff1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你对时间序列预测和分析感兴趣，我强烈推荐下面两个:</p><ul class=""><li id="9d9e" class="mt mu iq jp b jq jr ju jv jy mv kc mw kg mx kk my mz na nb bi translated"><a class="ae km" href="https://otexts.com/fpp2/" rel="noopener ugc nofollow" target="_blank"> <em class="kl">预测、原理与实践</em> </a> <em class="kl">(海德曼&amp; Athanasopoulos) </em></li><li id="68e2" class="mt mu iq jp b jq nc ju nd jy ne kc nf kg ng kk my mz na nb bi translated"><a class="ae km" href="https://people.duke.edu/~rnau/411home.htm" rel="noopener ugc nofollow" target="_blank"><em class="kl"/></a><em class="kl">(罗伯特·诺)</em></li></ul><p id="3457" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> <em class="kl">你还可以查看</em> </strong> <a class="ae km" href="https://medium.com/@benjamin_47408/neural-turing-machines-an-artificial-working-memory-cd913420508b" rel="noopener"> <strong class="jp ir"> <em class="kl">这篇文章</em> </strong> </a> <strong class="jp ir"> <em class="kl">关于神经图灵机和</em> </strong> <a class="ae km" href="https://medium.com/@benjamin_47408/attention-seq2seq-with-pytorch-learning-to-invert-a-sequence-34faf4133e53" rel="noopener"> <strong class="jp ir"> <em class="kl">这篇文章</em> </strong> </a> <strong class="jp ir"> <em class="kl">关于基于注意力的神经网络！</em> </strong></p></div></div>    
</body>
</html>