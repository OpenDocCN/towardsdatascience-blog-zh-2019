<html>
<head>
<title>Redshift from the command line</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从命令行红移</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/redshift-from-the-command-line-5d6b3233f649?source=collection_archive---------8-----------------------#2019-04-04">https://towardsdatascience.com/redshift-from-the-command-line-5d6b3233f649?source=collection_archive---------8-----------------------#2019-04-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/624d14a69dd3915e09c0e5d606db08a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4wcDxA22CNsbX0RlEAVq8w.jpeg"/></div></div></figure><p id="8d42" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我最近发现自己在 AWS Redshift 控制台中编写和引用保存的查询，并知道一定有更简单的方法来跟踪我的常用 sql 语句(我主要用于定制复制作业或检查日志，因为我们对所有 BI 使用<a class="ae kw" href="https://modeanalytics.com/" rel="noopener ugc nofollow" target="_blank">模式</a>)。</p><p id="4f2d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">原来有一种更简单的方法，叫做 psql (Postgres 的基于终端的交互工具)！开始使用 psql 非常容易，您会对 AWS 控制台点击它的次数感到高兴。</p><h2 id="a642" class="kx ky iq bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated">步骤 1:安装</h2><p id="4e67" class="pw-post-body-paragraph jy jz iq ka b kb lq kd ke kf lr kh ki kj ls kl km kn lt kp kq kr lu kt ku kv ij bi translated">从<a class="ae kw" href="https://www.postgresql.org/download/" rel="noopener ugc nofollow" target="_blank">安装 postgres 开始。</a></p><pre class="lv lw lx ly gt lz ma mb mc aw md bi"><span id="bc30" class="kx ky iq ma b gy me mf l mg mh">$ brew install postgres</span></pre><h2 id="856d" class="kx ky iq bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated">步骤 2:建立红移连接</h2><p id="b6c9" class="pw-post-body-paragraph jy jz iq ka b kb lq kd ke kf lr kh ki kj ls kl km kn lt kp kq kr lu kt ku kv ij bi translated">接下来，<a class="ae kw" href="https://docs.aws.amazon.com/redshift/latest/mgmt/connecting-from-psql.html" rel="noopener ugc nofollow" target="_blank">连接到你的红移星团</a>。</p><p id="2e2d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">由于您将一直使用 psql，我建议在您的<code class="fe mi mj mk ma b">~/.bash_profile</code>中创建一个别名，这样您就可以轻松地用一个单词建立数据库连接。我用<code class="fe mi mj mk ma b">redshift</code>作为我的别名。您可以使用您在中定义的凭据。bash_profile:</p><pre class="lv lw lx ly gt lz ma mb mc aw md bi"><span id="0f3a" class="kx ky iq ma b gy me mf l mg mh">alias redshift='psql "host=$REDSHIFT_HOST user=$REDSHIFT_USER dbname=$REDSHIFT_DB port=$REDSHIFT_PORT sslmode=verify-ca     sslrootcert=&lt;path to your postgres root .crt file&gt; password=$REDSHIFT_PASSWORD"'</span></pre><h2 id="2a2f" class="kx ky iq bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated">步骤 3:添加您的开发 IP 地址</h2><p id="c754" class="pw-post-body-paragraph jy jz iq ka b kb lq kd ke kf lr kh ki kj ls kl km kn lt kp kq kr lu kt ku kv ij bi translated">您需要确保您的集群安全组被设置为接收来自您将在开发中使用的任何 IP 地址的入站流量。如果您的集群在自定义 VPC 中，您可以从命令行使用<a class="ae kw" href="https://docs.aws.amazon.com/cli/latest/reference/ec2/authorize-security-group-ingress.html" rel="noopener ugc nofollow" target="_blank"> CLI </a>的<code class="fe mi mj mk ma b">authorize-security-group-ingress</code>来完成此操作。否则，如果您使用默认 VPC，您可以在控制台中手动将您的 IP 地址添加到安全组的入站规则中</p><h2 id="7858" class="kx ky iq bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated">第四步:探索你的仓库</h2><p id="9e50" class="pw-post-body-paragraph jy jz iq ka b kb lq kd ke kf lr kh ki kj ls kl km kn lt kp kq kr lu kt ku kv ij bi translated">现在您已经连接好了，在命令行上键入<code class="fe mi mj mk ma b">redshift</code>，并尝试这些方便的命令:</p><p id="374a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> \dt — </strong>查看您的表<br/> <strong class="ka ir"> \df — </strong>查看您的函数<br/> <strong class="ka ir"> \dg — </strong>列出数据库角色<br/> <strong class="ka ir"> \dn — </strong>列出模式<br/> <strong class="ka ir"> \dy — </strong>列出事件触发器<br/> <strong class="ka ir"> \dp — </strong>显示表、视图和序列的访问权限</p><h2 id="9d5e" class="kx ky iq bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated">步骤 5:进行一次查询</h2><pre class="lv lw lx ly gt lz ma mb mc aw md bi"><span id="52a9" class="kx ky iq ma b gy me mf l mg mh">$ SELECT * FROM your_schema.your_table LIMIT 10;</span></pre><h2 id="0b59" class="kx ky iq bd kz la lb dn lc ld le dp lf kj lg lh li kn lj lk ll kr lm ln lo lp bi translated">步骤 6:运行一个简单的事务</h2><p id="4526" class="pw-post-body-paragraph jy jz iq ka b kb lq kd ke kf lr kh ki kj ls kl km kn lt kp kq kr lu kt ku kv ij bi translated">打开您最喜欢的文本编辑器，编写一个简单的事务(一系列 sql 语句，作为一个整体运行，如果其中任何一个失败，什么也不做)，例如:</p><pre class="lv lw lx ly gt lz ma mb mc aw md bi"><span id="38af" class="kx ky iq ma b gy me mf l mg mh">BEGIN; <br/>INSERT INTO your_table VALUES (1), (2), (3), (4);<br/>INSERT INTO your_table VALUES (5), (6), (7), (8);<br/>INSERT INTO your_table VALUES (9), (10), (11), (12);<br/>COMMIT;</span></pre><p id="4255" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">保存这个事务，并使用<code class="fe mi mj mk ma b">\i</code>命令在 psql repl 中运行:</p><pre class="lv lw lx ly gt lz ma mb mc aw md bi"><span id="7f6a" class="kx ky iq ma b gy me mf l mg mh">dev=# \i your_transaction.sql</span></pre><p id="7695" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">玩得开心，让我知道你发现了什么！</p></div><div class="ab cl ml mm hu mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="ij ik il im in"><p id="13c3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Siobhán 是在<a class="ae kw" href="http://www.landed.com" rel="noopener ugc nofollow" target="_blank">着陆</a>的数据工程负责人。Landed 的使命是帮助重要的专业人士在他们服务的社区附近建立金融安全，当他们准备在昂贵的市场购买房屋时，我们会与教育工作者一起投资。听起来很棒？<a class="ae kw" href="https://landed.com/jobs" rel="noopener ugc nofollow" target="_blank">加入我们</a>！</p></div></div>    
</body>
</html>