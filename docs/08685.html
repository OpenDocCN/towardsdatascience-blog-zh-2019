<html>
<head>
<title>A Better Excel Goal Seek using Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 Python 实现更好的 Excel 目标搜索</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/a-better-excel-goal-seek-using-python-fb6aff56e9f2?source=collection_archive---------7-----------------------#2019-11-22">https://towardsdatascience.com/a-better-excel-goal-seek-using-python-fb6aff56e9f2?source=collection_archive---------7-----------------------#2019-11-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div class="gh gi jq"><img src="../Images/3e407720aff1c566467aeecfef95202c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1382/0*6NZeMM-s2IVuSBwX.gif"/></div><figcaption class="jx jy gj gh gi jz ka bd b be z dk">Solving has been artifically slowed down for visualization.</figcaption></figure><p id="7e50" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">微软 Excel 有一个很棒的功能，在<em class="kz">数据/假设… </em>菜单下的“Goal Seek”。给定一个公式，它将计算输入需要什么，以便该公式等于一个特定的结果。这是一个非常强大但简单的工具。</p><p id="4293" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">标准的“目标搜索”功能虽然在许多情况下很有用，但却有一定的局限性。它只能求解单个输入像元，并且无法控制所使用的算法。</p><p id="0f0d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">还有更复杂的“规划求解”插件，它也是 Excel 的一部分。这就像是打了兴奋剂的“寻根问底”！它可以处理多元函数、约束，并有多种优化算法可供选择。</p><p id="ffb5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果这还不够呢？对于更复杂的问题，如全局优化或大规模优化，“规划求解”加载项中的默认算法可能不够。</p><h1 id="4a15" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">Python 和 scipy.optimize</h1><p id="4a6b" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">Python 是许多数据科学家的首选工具，理由很充分！对于超越 Excel 中简单的“目标求解”或“规划求解”解决方案的优化问题，Python 包<a class="ae md" href="https://docs.scipy.org/doc/scipy/reference/tutorial/optimize.html" rel="noopener ugc nofollow" target="_blank"> scipy.optimize </a>提供了一系列更全面的算法。</p><p id="bfa8" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果您的模型可以很容易地用 Python 重写，那么使用 scipy.optimize 是一个很好的解决方案。但是，如果您的模型已经在 Excel 中，或者您更喜欢留在 Excel 中，仍然可以在 Excel 中利用 scipy.optimize 函数。</p><figure class="mf mg mh mi gt ju gh gi paragraph-image"><div class="gh gi me"><img src="../Images/acebfde9bfe05035071d69489ce37e46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1152/format:webp/0*Fn2XaMA9-Y9OLNGo.png"/></div></figure><p id="6239" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果你是 Python 的新手并且想学习，你可以在这里下载免费的电子书《VBA 开发者的 Python 终极指南》:</p><p id="0ca6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><a class="ae md" href="https://www.pyxll.com/ultimate-python-guide-for-vba-developers.html" rel="noopener ugc nofollow" target="_blank">https://www . pyxll . com/ultimate-python-guide-for-VBA-developers . html</a></p><h1 id="20e2" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">Python Excel 与 PyXLL 的集成</h1><p id="dfa8" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">如果你是一个 Excel 用户，你想使用 Python 作为工作簿的后端，或者如果你是一个 Python 用户，你想使用 Excel 作为 Python 代码的前端，你可以使用<a class="ae md" href="https://www.pyxll.com" rel="noopener ugc nofollow" target="_blank"> PyXLL，Python Excel 插件</a>。</p><p id="b60f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">没有必要在 Excel 的交互性和 Python 的强大功能和生产力之间做出选择，因为您可以将 Python 集成到 Excel 中，甚至使用<a class="ae md" href="https://www.pyxll.com/docs/userguide/vba.html" rel="noopener ugc nofollow" target="_blank"> Python 作为 VBA </a>的完全替代。</p><p id="047f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">PyXLL 允许你编写工作表函数(UDF)，Excel 宏，菜单函数，功能区工具栏，RTD 函数等等，全部使用 Python——不需要 VBA。</p><h1 id="f7d8" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">从 Excel 调用 scipy.optimize</h1><p id="1ad9" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">随着 Python 在 Excel 中运行，我们现在可以直接在 Excel 中使用 scipy.optimize。</p><p id="9997" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">要在 Python 中执行与 Excel 的 Goal Seek 等效的操作，我们应该执行如下操作:</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="a152" class="mo lb it mk b gy mp mq l mr ms"><strong class="mk iu">from</strong> <!-- -->scipy.optimize <strong class="mk iu">import</strong> <!-- -->minimize</span><span id="73e4" class="mo lb it mk b gy mt mq l mr ms">minimize(objective_func, X)</span></pre><p id="7435" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">其中 X 是<em class="kz">目标函数</em>输入的初始值。目标函数是我们试图最小化的东西，在我们的例子中是一个 Excel 公式。</p><p id="4107" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们的目标函数需要在 Excel 中包装我们的模型。与我们使用 Goal Seek 时一样，我们的模型只是一组输入单元和一个输出单元。我们的目标函数将设置输入单元格的值，计算工作表，然后读回输出单元格的值。</p><p id="3817" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">一个简单的例子是，输入在 C2 和 C3，输出在 C4。PyXLL 使访问 Excel 应用程序对象和访问单元格值变得简单，就像在 VBA 中一样:</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="5e1b" class="mo lb it mk b gy mp mq l mr ms"><strong class="mk iu">from</strong> <!-- -->pyxll <strong class="mk iu">import</strong> <!-- -->xl_app<br/></span><span id="67bf" class="mo lb it mk b gy mt mq l mr ms"><strong class="mk iu">def</strong> <!-- -->objective_func(arg):</span><span id="7683" class="mo lb it mk b gy mt mq l mr ms">    xl <strong class="mk iu">=</strong> <!-- -->xl_app()</span><span id="31b9" class="mo lb it mk b gy mt mq l mr ms">    # Copy argument values to input range</span><span id="fd56" class="mo lb it mk b gy mt mq l mr ms">    xl.Range('C2').Value <strong class="mk iu">=</strong> <!-- -->float(arg[0])</span><span id="c7db" class="mo lb it mk b gy mt mq l mr ms">    xl.Range('C3').Value <strong class="mk iu">=</strong> <!-- -->float(arg[1])</span><span id="5e8b" class="mo lb it mk b gy mt mq l mr ms">    # Calculate after changing the inputs</span><span id="bd9b" class="mo lb it mk b gy mt mq l mr ms">    xl.Calculate()</span><span id="36e1" class="mo lb it mk b gy mt mq l mr ms">    # Return the value of the output cell</span><span id="b8a2" class="mo lb it mk b gy mt mq l mr ms">    result <strong class="mk iu">=</strong> <!-- -->xl.Range("C4").Value</span><span id="1550" class="mo lb it mk b gy mt mq l mr ms"><strong class="mk iu">    return</strong> <!-- -->result</span></pre><p id="78aa" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在我们有了一个目标函数，我们需要一些调用优化器的方法。我们可以通过 PyXLL 的@xl_macro decorator 使用 Python 编写的 Excel 宏来实现这一点。</p><pre class="mf mg mh mi gt mj mk ml mm aw mn bi"><span id="84d9" class="mo lb it mk b gy mp mq l mr ms"><strong class="mk iu">from</strong> <!-- -->pyxll <strong class="mk iu">import</strong> <!-- -->xl_macro, xl_app</span><span id="3142" class="mo lb it mk b gy mt mq l mr ms">@xl_macro(shortcut<strong class="mk iu">=</strong>'Ctrl+Alt+P')</span><span id="72fa" class="mo lb it mk b gy mt mq l mr ms"><strong class="mk iu">def</strong> <!-- -->optimize():<br/>    # Get the initial values of the input cells</span><span id="6fee" class="mo lb it mk b gy mt mq l mr ms">    xl <strong class="mk iu">=</strong> <!-- -->xl_app()</span><span id="7c50" class="mo lb it mk b gy mt mq l mr ms">    x <strong class="mk iu">=</strong> <!-- -->xl.Range("C2").Value</span><span id="90f7" class="mo lb it mk b gy mt mq l mr ms">    y <strong class="mk iu">=</strong> <!-- -->xl.Range("C3").Value</span><span id="f409" class="mo lb it mk b gy mt mq l mr ms">    X <strong class="mk iu">=</strong> <!-- -->np.array([x, y])</span><span id="d8ab" class="mo lb it mk b gy mt mq l mr ms">    # run the minimization routine</span><span id="c809" class="mo lb it mk b gy mt mq l mr ms">    minimize(obj_func, X, method<strong class="mk iu">=</strong>'nelder-mead')</span></pre><p id="f6c3" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">该宏可以分配给按钮，也可以通过指定的快捷键调用。</p><h1 id="ef31" class="la lb it bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">进一步阅读</h1><p id="369d" class="pw-post-body-paragraph kb kc it kd b ke ly kg kh ki lz kk kl km ma ko kp kq mb ks kt ku mc kw kx ky im bi translated">在这篇博客文章中，有更多关于使用 Python 的 scipy . optimize from Excel with PyXLL 的技术细节和深入解释:</p><p id="d03f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">https://www.pyxll.com/blog/a-better-goal-seek/<a class="ae md" href="https://www.pyxll.com/blog/a-better-goal-seek/" rel="noopener ugc nofollow" target="_blank"/></p><p id="0044" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">有关 PyXLL 的更多详细信息，请参见</p><p id="8e3f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">【https://www.pyxll.com】T4。</p><p id="cb17" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果您是 Python 的新手，并且想学习 Python，请在此下载免费电子书“VBA 开发者 Python 终极指南”:</p><p id="21bf" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><a class="ae md" href="https://www.pyxll.com/ultimate-python-guide-for-vba-developers.html" rel="noopener ugc nofollow" target="_blank">https://www . pyxll . com/ultimate-python-guide-for-VBA-developers . html</a></p><p id="65cd" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">请在这里查看 scipy.optimize 文档</p><p id="24f9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><a class="ae md" href="https://docs.scipy.org/doc/scipy/reference/optimize.html" rel="noopener ugc nofollow" target="_blank">https://docs.scipy.org/doc/scipy/reference/optimize.html</a></p></div></div>    
</body>
</html>