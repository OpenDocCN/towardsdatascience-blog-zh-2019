<html>
<head>
<title>Analyzing Anime data in R</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">分析 R 中的动漫数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/analyzing-anime-data-in-r-8d2c2730de8c?source=collection_archive---------16-----------------------#2019-05-31">https://towardsdatascience.com/analyzing-anime-data-in-r-8d2c2730de8c?source=collection_archive---------16-----------------------#2019-05-31</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div class="gh gi jq"><img src="../Images/881dfcd497ca03bcf24e3a2a1cf17018.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*1GP5nU_EDyUeBcrI4fAodw.jpeg"/></div></figure><p id="a22a" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">如果你是一个动漫迷，那么你会喜欢我在 R 中做的这个分析。这个数据来自于<a class="ae kv" href="https://myanimelist.net/" rel="noopener ugc nofollow" target="_blank"> MyAnimeLis </a> t 网站，是 R for Data Science 社区发起的 Tidy Tuesday 计划的一部分。你可以从<a class="ae kv" href="https://github.com/rfordatascience/tidytuesday/blob/master/data/2019/2019-04-23/tidy_anime.csv" rel="noopener ugc nofollow" target="_blank">这里</a>下载这个数据的整洁版本。他们每周发布有趣的数据集，社区分享他们的分析，大多使用 Tidyverse 软件包，这是一个很好的学习资源。我还建议关注大卫·罗宾逊的<a class="ae kv" href="https://www.youtube.com/user/safe4democracy" rel="noopener ugc nofollow" target="_blank"> YouTube 频道</a>。他每周都会上传新的视频，在视频中他分析了来自 Tidy Tuesday 的新数据集，你可以从他那里学到很多很酷的东西。</p><h2 id="f9ad" class="kw kx it bd ky kz la dn lb lc ld dp le ki lf lg lh km li lj lk kq ll lm ln lo bi translated">加载库</h2><p id="0d25" class="pw-post-body-paragraph jx jy it jz b ka lp kc kd ke lq kg kh ki lr kk kl km ls ko kp kq lt ks kt ku im bi translated">像往常一样，我们将加载一些库。</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="3cbc" class="kw kx it lz b gy md me l mf mg">library(tidyverse)# Data manipulation and visualization<br/>library(scales)# Converting data values to units<br/>library(patchwork) # For Patching multiple ggplots together</span></pre><h2 id="c416" class="kw kx it bd ky kz la dn lb lc ld dp le ki lf lg lh km li lj lk kq ll lm ln lo bi translated">数据的读取和初步调查</h2><p id="1282" class="pw-post-body-paragraph jx jy it jz b ka lp kc kd ke lq kg kh ki lr kk kl km ls ko kp kq lt ks kt ku im bi translated">使用<strong class="jz iu"> read_csv </strong>函数，我可以通过为<strong class="jz iu">文件</strong>参数提供到数据集的链接，直接从网站读取数据。加载数据后，让我们使用<strong class="jz iu">视图</strong>功能来查看数据</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="8d1a" class="kw kx it lz b gy md me l mf mg">tidy_anime &lt;- read_csv(file="<a class="ae kv" href="https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2019/2019-04-23/tidy_anime.csv" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2019/2019-04-23/tidy_anime.csv</a>")</span><span id="285e" class="kw kx it lz b gy mh me l mf mg">View(tidy_anime)</span></pre><figure class="lu lv lw lx gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi mi"><img src="../Images/6f55a3cc82968b572ec424b772103322.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rVwozwCbqxvIG1I97i9mwg.png"/></div></div></figure><figure class="lu lv lw lx gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi mn"><img src="../Images/94aae513ff99df88cefa54c16918b57c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k_xag237g4Fi7voIzVl3aw.png"/></div></div></figure><figure class="lu lv lw lx gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi mo"><img src="../Images/d27afa9ed42c880db868984ff0d3ba46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sGt0N_RyZmIuXrsIYPHRfg.png"/></div></div></figure><p id="c1a4" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">如您所见，这是一个巨大的数据集，我不需要所有的列来进行分析。如果你看第一张截图，你会看到每个动画 ID 都被复制了。这是因为 MyAnimeList 网站上的每部动漫都被归类在不同的流派下。因此，每部不同类型的动漫都有一行，因此出现了重复。同样的问题也出现在<strong class="jz iu">制作人</strong>和<strong class="jz iu">工作室</strong>栏目，因为一部动漫可以有多个制作人和工作室</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="c7e3" class="kw kx it lz b gy md me l mf mg">tidy_anime &lt;- tidy_anime%&gt;%<br/>select(-c(title_synonyms,synopsis,background,related,genre,studio,producer))</span></pre><p id="2476" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">要删除这些列，我只需将它们包装在一个<strong class="jz iu"> "-" </strong>中，这是一种取消选择的方式。</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="b6d9" class="kw kx it lz b gy md me l mf mg">unique_anime &lt;- tidy_anime%&gt;%<br/>distinct()%&gt;%<br/>filter(!is.na(title_english))</span><span id="9a5f" class="kw kx it lz b gy mh me l mf mg">View(unique_anime)</span></pre><p id="3123" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">然后我们使用<strong class="jz iu"> distinct </strong>函数，这样我们就可以为每一行获得一个唯一的动画 ID。我只对那些有英文标题的感兴趣，所以我删除了所有没有英文标题的。现在让我们再看一下数据。</p><figure class="lu lv lw lx gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi mp"><img src="../Images/a39a29a4df73855696875fdc9b10baa2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6zG9Q_MBUvPn-kfNz2F_YA.png"/></div></div></figure><p id="e217" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">不错！现在我们在每一行都有一个唯一的动漫 ID。我们现在可以开始分析我们的数据。</p><h2 id="0c5f" class="kw kx it bd ky kz la dn lb lc ld dp le ki lf lg lh km li lj lk kq ll lm ln lo bi translated">分析和可视化</h2><p id="b81e" class="pw-post-body-paragraph jx jy it jz b ka lp kc kd ke lq kg kh ki lr kk kl km ls ko kp kq lt ks kt ku im bi translated">如果你们中的任何一个人是动漫迷，那么你应该知道动漫电视剧和动漫电影不应该被放在一起比较。两者应该在各自的范畴内进行比较。为此，我们将进一步将这些数据分为电视和电影类别</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="7173" class="kw kx it lz b gy md me l mf mg">tv_anime &lt;- unique_anime%&gt;%filter(type=="TV")<br/>tv_plot &lt;-tv_anime%&gt;%<br/>  mutate(graph_name=paste0(title_english," (",premiered,")"))%&gt;%<br/>  top_n(-20,wt=popularity) %&gt;% <br/>  ggplot(aes(reorder(graph_name,desc(popularity)),popularity,colour=title_english))+<br/>  geom_point(show.legend = FALSE)+<br/>  geom_segment(aes(x=graph_name,xend=graph_name,y=0,yend=popularity),show.legend = FALSE)+<br/>  coord_flip()+<br/>  theme_classic()+<br/>  labs(x="",y="Popularity",title = "Top 20 Most Popular Anime TV Shows")</span></pre><p id="baad" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">让我们一步一步地看这段代码:</p><ul class=""><li id="5c0c" class="mq mr it jz b ka kb ke kf ki ms km mt kq mu ku mv mw mx my bi translated">我只过滤电视节目的日期</li><li id="228c" class="mq mr it jz b ka mz ke na ki nb km nc kq nd ku mv mw mx my bi translated">在我的图中，我还想看看它们何时开始，所以我使用<strong class="jz iu"> mutate </strong>函数创建了一个新列— <strong class="jz iu"> graph_name </strong>。在 mutate 函数中，我使用了<strong class="jz iu"> Paste0 </strong>函数来组合<strong class="jz iu"> title_english </strong>和<strong class="jz iu"> premiered </strong>列</li><li id="41df" class="mq mr it jz b ka mz ke na ki nb km nc kq nd ku mv mw mx my bi translated">然后我用<strong class="jz iu"> top_n </strong>函数得到了最受欢迎的 20 部动漫。请注意，我使用了-20，因为这将获得 20 个最低值，而且因为这是一个基于排名的值，最低值意味着最受欢迎</li><li id="f2b7" class="mq mr it jz b ka mz ke na ki nb km nc kq nd ku mv mw mx my bi translated">然后我使用标准的<strong class="jz iu"> ggplot </strong>函数来绘制我们的 x 和 y 轴值。我在 x 轴上使用了<strong class="jz iu"> reorder </strong>函数，因为我想根据流行度值对它进行排序</li><li id="e7ee" class="mq mr it jz b ka mz ke na ki nb km nc kq nd ku mv mw mx my bi translated">我正在创建一个棒棒糖图，为此，我需要将<strong class="jz iu">几何点</strong>和<strong class="jz iu">几何段</strong>组合在一起以获得我的结果。<strong class="jz iu">几何点</strong>绘制点，而<strong class="jz iu">几何段</strong>绘制线</li><li id="db5f" class="mq mr it jz b ka mz ke na ki nb km nc kq nd ku mv mw mx my bi translated"><strong class="jz iu"> coord_flip </strong>使其垂直和其他标准功能来标记情节和改变主题的外观。</li></ul><figure class="lu lv lw lx gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi ne"><img src="../Images/84a038d40172dd8c7d17847e8e8e9281.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4jVM6RGNfHp81SHDwuR6zw.jpeg"/></div></div></figure><p id="04c7" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">这没什么奇怪的。所有这些节目都非常受欢迎，但值得注意的一件有趣的事情是，所有这些节目目前都没有播出，因此像<strong class="jz iu"> Once Piece </strong>和<strong class="jz iu">漂白剂</strong>这样的节目也没有播出。让我们来看看目前正在播放的最受欢迎的节目</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="a229" class="kw kx it lz b gy md me l mf mg">tv_anime_airing &lt;- unique_anime%&gt;%filter(type=="TV",airing=="TRUE")<br/>tv_plot_airing &lt;-tv_anime_airing%&gt;%<br/>  mutate(graph_name=paste0(title_english," (",premiered,")"))%&gt;%<br/>  top_n(-20,wt=popularity) %&gt;% <br/>  ggplot(aes(reorder(graph_name,desc(popularity)),popularity,colour=title_english))+<br/>  geom_point(show.legend = FALSE)+<br/>  geom_segment(aes(x=graph_name,xend=graph_name,y=0,yend=popularity),show.legend = FALSE)+<br/>  coord_flip()+<br/>  theme_classic()+<br/>  labs(x="",y="Popularity",title = "Top 20 Most Popular Anime TV Shows")+<br/>  theme(axis.text.y.left = element_text(size = 12))</span></pre><p id="6fa9" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">代码和以前一样。我对目前正在播放的节目的过滤做了一点调整</p><figure class="lu lv lw lx gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi ne"><img src="../Images/d01d56af68d048b05ed1c6bcf52dc821.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OMz0O5pL-PFLEHuIGbuhUg.jpeg"/></div></div></figure><p id="f5e6" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">啊！<strong class="jz iu">一块</strong>放在当前正在播放的节目的顶部。我很惊讶<strong class="jz iu">一拳第二季</strong>和<strong class="jz iu">袭提坦第三季(下)</strong>不在这里。收集这些数据时，它们可能还没有播出。我只看过这些<strong class="jz iu">中的<strong class="jz iu">暴民惊魂记 100 </strong>。</strong>我们也来看看评分最高的动漫吧。</p><figure class="lu lv lw lx gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi ne"><img src="../Images/5c858f2039bc314e463a4a5dee673fe8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1bet5ZH-PqRGPK11SbdhDw.jpeg"/></div></div></figure><p id="cef9" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">嗯，有些令人失望的是，这些动漫中的大多数甚至没有超过 8 分。接下来，我有兴趣看看哪些流行动漫得分高，它们与这些动漫的得分人数有什么关系</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="4421" class="kw kx it lz b gy md me l mf mg">tv_anime %&gt;% <br/>  filter(popularity &lt;= 50) %&gt;%<br/>  mutate(title_english = str_replace(title_english, "Code Geass: Lelouch of the Rebellion", "Code Geass")) %&gt;%<br/>  ggplot(aes(score, scored_by)) + <br/>  geom_point(shape=21,aes(fill=title_english,size=members)) + <br/>  geom_text(aes(label = title_english ), check_overlap = T, show.legend = F, size = 3, hjust = 1) + <br/>  xlim(c(6, 10)) +<br/>  scale_y_log10()+<br/>  labs(title = "Which popular anime also score high?", <br/>       subtitle = "Top 50 anime shown based on popularity",<br/>       y = "Number of users that scored",<br/>       x = "Score (1-10)") +<br/>  theme_classic()+<br/>  theme(legend.position = 'none',aspect.ratio = 0.5)</span></pre><figure class="lu lv lw lx gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi nf"><img src="../Images/5813db1f08195ae7acefcc351978715a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vnL5B-3rTLfrtoKjt7kOlw.png"/></div></div></figure><p id="3c68" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated"><strong class="jz iu">死亡笔记</strong>再次置顶。我会假设像<strong class="jz iu">死亡笔记</strong>、<strong class="jz iu">攻击泰坦</strong>和<strong class="jz iu">剑术在线</strong>这样的动漫有一个真正忠诚的粉丝群，他们会去网站为他们评分。像<strong class="jz iu"> Once Piece </strong>这样的节目已经播出了相当长一段时间，但相对而言，很少有人获得它的评分。</p><p id="64e4" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">现在让我们来看看流行度与分数。有没有哪部热门动漫没得高分，反之亦然。</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="a93e" class="kw kx it lz b gy md me l mf mg">tv_anime%&gt;%<br/>  filter(popularity&lt;=100) %&gt;% <br/>  ggplot(aes(popularity,score,fill=rating))+<br/>  geom_point(shape=21,size=3,alpha=0.8)+<br/>  geom_text(aes(label=title_english),size=3,check_overlap = TRUE)+<br/>  scale_x_log10()+<br/>  theme_classic()+<br/>  scale_color_brewer(palette = 'Set1')+<br/>  theme(legend.position = "bottom")+<br/>  labs(title = "Popularity vs Score",subtitle = "Do all Popular Anime score high?")</span></pre><figure class="lu lv lw lx gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi nf"><img src="../Images/663365f2b7159af7a1fe2fd7c392d4bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uJMHDqHVrft4t9pJHjugfA.jpeg"/></div></div></figure><p id="cb2a" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">所以最受欢迎的动漫肯定得分最高。虽然图表中充满了 PG-13 级的节目，但得分最高的动画肯定是 R-17+。有点惊讶的是，《我的赫拉学院》第二季&amp;第三季没有第一季那么受欢迎，尽管它们的收视率都比第一季高。</p><p id="8924" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">最后，我想比较一下前 20 名最受欢迎的成员和最受欢迎的人。</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="0790" class="kw kx it lz b gy md me l mf mg"><strong class="lz iu">most_members</strong> &lt;- tv_anime%&gt;%<br/>  top_n(20,wt=members) %&gt;%<br/>  mutate(graph_name=paste0(title_english," (",premiered,")"),graph_name=fct_reorder(graph_name,members))%&gt;%<br/>  ggplot(aes(graph_name,members,fill=graph_name))+<br/>  geom_bar(stat = 'identity',width=0.5,show.legend = FALSE,color='black')+<br/>  coord_flip()+<br/>  theme_classic()+<br/>  scale_y_continuous(limits = c(0,1700000),labels = comma)+<br/>  geom_text(aes(label=comma(members)),size=3)+<br/>  labs(x="",y="Rank",title = "Top 20 Most Members")</span><span id="cdb3" class="kw kx it lz b gy mh me l mf mg"><strong class="lz iu">most_favorite</strong>&lt;-<br/>  tv_anime%&gt;%<br/>  top_n(20,wt=favorites) %&gt;% <br/>  mutate(title_english=fct_reorder(title_english,favorites))%&gt;%<br/>  ggplot(aes(title_english,favorites,fill=title_english))+<br/>  geom_bar(stat = 'identity',width=0.5,show.legend = FALSE,color='black')+<br/>  coord_flip()+<br/>  theme_classic()+<br/>  scale_y_continuous(limits = c(0,150000),labels = comma)+<br/>  geom_text(aes(label=comma(favorites)),size=3,hjust=1,fontface='bold')+<br/>  labs(x="",y="Favourites",title = "Top 20 Most Favorite")</span><span id="bf36" class="kw kx it lz b gy mh me l mf mg"><strong class="lz iu">most_scored</strong>&lt;-<br/>  tv_anime%&gt;%<br/>  top_n(20,wt=scored_by) %&gt;% <br/>  mutate(title_english=fct_reorder(title_english,scored_by))%&gt;%<br/>  ggplot(aes(title_english,scored_by,fill= title_english))+<br/>  geom_bar(stat = 'identity',width=0.5,color='black',show.legend = FALSE)+<br/>  coord_flip()+<br/>  theme_classic()+<br/>  scale_y_continuous(limits = c(0,1500000),labels = comma)+<br/>  geom_text(aes(label=comma(scored_by)),size=3,hjust=1,fontface='bold')+<br/>  labs(x="",y="Favourites",title = "Top 20 Most Scored by")</span><span id="f19b" class="kw kx it lz b gy mh me l mf mg">most_favorite + most_members+ most_scored + plot_layout(widths = 20)</span></pre><figure class="lu lv lw lx gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi ng"><img src="../Images/cf0d0324247cde22af1b085bcc0d335c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bS7awtVOI7vNVyXg97mCWw.jpeg"/></div></div></figure><p id="6ded" class="pw-post-body-paragraph jx jy it jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">很明显，拥有最多成员的动漫会有更多人给它打分。我从未在我的动画列表上为一部动画打分，但我认为你需要成为这部动画的一员才能为它打分。<strong class="jz iu">最喜欢的</strong>是一个不同的故事。这可以潜在地突出具有最忠实的粉丝基础的动画，这些粉丝如此喜爱该动画以至于他们将它添加到他们的最爱中。</p><h1 id="041a" class="nh kx it bd ky ni nj nk lb nl nm nn le no np nq lh nr ns nt lk nu nv nw ln nx bi translated">结论</h1><p id="e337" class="pw-post-body-paragraph jx jy it jz b ka lp kc kd ke lq kg kh ki lr kk kl km ls ko kp kq lt ks kt ku im bi translated">我希望你觉得这个分析很有趣。如果你想分析动画电影，你可以使用相同的代码，但唯一的区别是只过滤电影而不是电视。</p></div></div>    
</body>
</html>