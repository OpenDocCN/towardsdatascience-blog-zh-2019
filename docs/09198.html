<html>
<head>
<title>Extract and query knowledge graphs using Apache Jena (SPARQL Engine)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Apache Jena (SPARQL 引擎)提取和查询知识图</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/extract-and-query-knowledge-graphs-using-apache-jena-sparql-engine-5c66648797a4?source=collection_archive---------28-----------------------#2019-12-05">https://towardsdatascience.com/extract-and-query-knowledge-graphs-using-apache-jena-sparql-engine-5c66648797a4?source=collection_archive---------28-----------------------#2019-12-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/29bc964d22eb13cede0faf73512bcc52.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Tw7A4yAPOLkEmhsI.jpg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">Image by LTDatEHU — Pixabay</figcaption></figure><h1 id="7eec" class="kf kg it bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">在本文中，我们将使用 Apache Jena 下载、提取和查询 AGROVOC 三元组</h1><p id="026d" class="pw-post-body-paragraph ld le it lf b lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma im bi translated"><strong class="lf iu"> AGROVOC </strong>是一个受控词汇，涵盖了联合国粮食及农业组织(<a class="ae mb" href="http://www.fao.org/home/en/" rel="noopener ugc nofollow" target="_blank"> FAO </a>)关注的所有领域，包括粮食、营养、农业、渔业、林业、环境等。</p><p id="5f8f" class="pw-post-body-paragraph ld le it lf b lg mc li lj lk md lm ln lo me lq lr ls mf lu lv lw mg ly lz ma im bi translated">AGROVOC 由资源描述框架(RDF)三元组组成。每个三元组由 3 个部分(主语、谓语和宾语)组成，如“Alice — knows — Bob”，其中“Alice”是主语，“knows”是谓语或关系，“Bod”是宾语。然而，由于我们可能有不止一个人的名字叫“爱丽丝”，那么最好给主题添加一个统一的资源标识符(URI ),使其唯一。例如，“http://Google . com/developers/teamA/Alice”现在更容易区分不同的主题。称为<strong class="lf iu">知识图的 RDF 三元组的集合。</strong></p><h1 id="d2fb" class="kf kg it bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">为什么我们需要提取三元组？</h1><p id="4008" class="pw-post-body-paragraph ld le it lf b lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma im bi translated">如果你观察水的 URI<code class="fe mh mi mj mk b">&lt;http://aims.fao.org/aos/agrovoc/c_8309&gt;</code>，你会注意到最初的实体<code class="fe mh mi mj mk b">c_8309</code>代表“水”。然而，我们把它的 ID 而不是真正的单词“water ”,因为它也可能存在于其他语言中(查看下图)。因此，我们需要提取实际的单词，而不是 id，这是第一个查询的目的。</p><figure class="mm mn mo mp gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ml"><img src="../Images/d55fd87144a158a2aea82eddf47ce4af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V5ygkuTOXcwf0n0HVfEEZw.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">The page for the entity “c_8309”, notice the entity names in different languages on the right bar</figcaption></figure><h1 id="8fe5" class="kf kg it bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">下载要求</h1><ul class=""><li id="a758" class="mq mr it lf b lg lh lk ll lo ms ls mt lw mu ma mv mw mx my bi translated">首先，你需要下载 AGROVOC 数据集。点击这里或在谷歌上搜索 AGROVOC，然后点击“发布”并下载文件“<a class="ae mb" href="http://agrovoc.uniroma2.it/agrovocReleases/agrovoc_2019-11-04_lod.nt.zip" rel="noopener ugc nofollow" target="_blank">agro VOC LOD nt(zipped-44 MB)</a>”，扩展名“nt”告诉你这是一个三重文件。</li><li id="f33b" class="mq mr it lf b lg mz lk na lo nb ls nc lw nd ma mv mw mx my bi translated">您还需要下载 Apache Jena，以便我们可以使用 SPARQL 引擎提取和查询数据集。点击这里或者谷歌搜索 Apache Jena 然后下载"<a class="ae mb" href="http://mirror.reverse.net/pub/apache/jena/binaries/apache-jena-3.13.1.zip" rel="noopener ugc nofollow" target="_blank">Apache-Jena-3 . 13 . 1 . zip</a>(<a class="ae mb" href="https://www.apache.org/dist/jena/binaries/apache-jena-3.13.1.zip.sha512" rel="noopener ugc nofollow" target="_blank">sha 512</a>，<a class="ae mb" href="https://www.apache.org/dist/jena/binaries/apache-jena-3.13.1.zip.asc" rel="noopener ugc nofollow" target="_blank"> PGP </a>)"</li></ul><h1 id="cd1f" class="kf kg it bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">提取三元组</h1><p id="1d30" class="pw-post-body-paragraph ld le it lf b lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma im bi translated">下载 Apache Jena 后，我们将使用两个主要命令:<code class="fe mh mi mj mk b">tdbloader2</code>和<code class="fe mh mi mj mk b">tdbquery.</code>，第一个命令为三元组创建索引以使将来的查询更快，第二个命令允许我们运行 SPARQL 查询。请注意:为了能够使用这些命令，您需要导航到<code class="fe mh mi mj mk b">apache-jena-&lt;version&gt;/bin/</code>然后运行命令，或者您需要提供其位置的路径，例如<code class="fe mh mi mj mk b">apache-jena-&lt;version&gt;/bin/tdbloader2</code></p><h2 id="02f3" class="ne kg it bd kh nf ng dn kl nh ni dp kp lo nj nk kt ls nl nm kx lw nn no lb np bi translated">为三元组建立索引</h2><pre class="mm mn mo mp gt nq mk nr ns aw nt bi"><span id="799f" class="ne kg it mk b gy nu nv l nw nx">tdbloader2 --loc Indices agrovoc_2019-06-03_lod.nt</span></pre><p id="c666" class="pw-post-body-paragraph ld le it lf b lg mc li lj lk md lm ln lo me lq lr ls mf lu lv lw mg ly lz ma im bi translated">注意:<code class="fe mh mi mj mk b">Indices</code>是存储索引的目录(给出任何名称)。<code class="fe mh mi mj mk b">agrovoc_2019-06-03_lod.nt</code>是我们从 AGROVOC 下载的输入文件(triples)的名称。</p><p id="67aa" class="pw-post-body-paragraph ld le it lf b lg mc li lj lk md lm ln lo me lq lr ls mf lu lv lw mg ly lz ma im bi translated">之后，创建一个新文件(我更喜欢扩展名为<code class="fe mh mi mj mk b">.sparql</code>)并编写以下 SPARQL 查询，该查询只提取英语对象:</p><pre class="mm mn mo mp gt nq mk nr ns aw nt bi"><span id="b826" class="ne kg it mk b gy nu nv l nw nx"><strong class="mk iu">SELECT</strong> ?subject ?predicate ?object<br/><strong class="mk iu">WHERE</strong> {<br/>?subject ?predicate ?object<br/><strong class="mk iu">FILTER</strong>(lang (?object) = 'en')<br/>}</span></pre><p id="d164" class="pw-post-body-paragraph ld le it lf b lg mc li lj lk md lm ln lo me lq lr ls mf lu lv lw mg ly lz ma im bi translated">最后，使用以下命令执行查询:</p><pre class="mm mn mo mp gt nq mk nr ns aw nt bi"><span id="507a" class="ne kg it mk b gy nu nv l nw nx">tdbquery --loc Indices --query English_Query.sparql </span></pre><p id="316a" class="pw-post-body-paragraph ld le it lf b lg mc li lj lk md lm ln lo me lq lr ls mf lu lv lw mg ly lz ma im bi translated"><code class="fe mh mi mj mk b">English_Query.sparql</code>是查询文件的名称。可以使用 Linux <code class="fe mh mi mj mk b">&gt;</code>命令将输出定向到一个文件，如下所示:</p><pre class="mm mn mo mp gt nq mk nr ns aw nt bi"><span id="1abc" class="ne kg it mk b gy nu nv l nw nx">tdbquery --loc Indices --query English_Query.sparql &gt; output.txt</span></pre><h2 id="e16c" class="ne kg it bd kh nf ng dn kl nh ni dp kp lo nj nk kt ls nl nm kx lw nn no lb np bi translated">其他查询示例</h2><p id="8bf4" class="pw-post-body-paragraph ld le it lf b lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma im bi translated">另一个简单的查询是返回整个知识图(所有三元组)而不进行任何过滤:</p><pre class="mm mn mo mp gt nq mk nr ns aw nt bi"><span id="b2c6" class="ne kg it mk b gy nu nv l nw nx"><strong class="mk iu">SELECT</strong> ?subject ?predicate ?object<br/><strong class="mk iu">WHERE</strong> {<br/>?subject ?predicate ?object<br/>}</span></pre><p id="3965" class="pw-post-body-paragraph ld le it lf b lg mc li lj lk md lm ln lo me lq lr ls mf lu lv lw mg ly lz ma im bi translated">运行以下查询以返回所有以“水”为主题的三元组(不要忘记在水之前包括 URI):</p><pre class="mm mn mo mp gt nq mk nr ns aw nt bi"><span id="c303" class="ne kg it mk b gy nu nv l nw nx"><strong class="mk iu">SELECT </strong>?predicate ?object<br/><strong class="mk iu">WHERE</strong> {<br/>&lt;water&gt; ?predicate ?object<br/>}</span></pre><p id="62bd" class="pw-post-body-paragraph ld le it lf b lg mc li lj lk md lm ln lo me lq lr ls mf lu lv lw mg ly lz ma im bi translated">注意，在这个例子中，我们没有在查询中包含<code class="fe mh mi mj mk b">?subject</code>，因为我们的目标是返回与<code class="fe mh mi mj mk b">&lt;water&gt;</code>主题相关的谓词和对象。</p><p id="a0f8" class="pw-post-body-paragraph ld le it lf b lg mc li lj lk md lm ln lo me lq lr ls mf lu lv lw mg ly lz ma im bi translated">您可以使用非常有用的命令，比如与 SQL 语法非常相似的<code class="fe mh mi mj mk b">FILTER, GROUP BY, HAVING, etc.</code>。然而，其他数据集可能由四元组而不是三元组组成。四元组由三元组组成，第四部分称为上下文。比如“Alice—knows—Bobs—Google dev department”。您仍然可以使用包含上下文部分的精确查询，因为图中可能有多个上下文。以下查询将返回上下文为“GoogleDevDepartment”的所有四边形:</p><pre class="mm mn mo mp gt nq mk nr ns aw nt bi"><span id="641a" class="ne kg it mk b gy nu nv l nw nx"><strong class="mk iu">SELECT</strong> * <strong class="mk iu">WHERE</strong> {<br/><strong class="mk iu">GRAPH</strong> ?GoogleDevDepartment {<br/>?subject ?predicate ?object<br/>}<br/>}</span></pre><p id="5bb5" class="pw-post-body-paragraph ld le it lf b lg mc li lj lk md lm ln lo me lq lr ls mf lu lv lw mg ly lz ma im bi translated">恭喜你，现在你应该能够提取和查询知识图了！</p></div></div>    
</body>
</html>