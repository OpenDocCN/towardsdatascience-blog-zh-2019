<html>
<head>
<title>How to Send Email with Attachments by using Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用 Python 发送带附件的电子邮件</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-send-email-with-attachments-by-using-python-41a9d1a3860b?source=collection_archive---------11-----------------------#2019-10-14">https://towardsdatascience.com/how-to-send-email-with-attachments-by-using-python-41a9d1a3860b?source=collection_archive---------11-----------------------#2019-10-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="86a5" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用 Python 电子邮件库实现报告自动化的几个简单步骤。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/06376798963cd5b8a460b1575202b63e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DslM9L8fSyR1mBcWc9VT4Q.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Photo by <a class="ae ky" href="https://unsplash.com/@webhost?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Web Hosting</a> on <a class="ae ky" href="https://unsplash.com/s/photos/email?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="68e6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">作为一名数据分析师，我经常会收到这样的请求:“你能每周给我发一份报告吗？”或者“你能每个月通过邮件把这些数据发给我吗？”。发送报告很容易，但如果你每周都要做同样的事情，那就太烦人了。这就是为什么您应该学习如何使用 python 来发送电子邮件/报告以及在您的服务器上安排脚本。</p><p id="783f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我将向您展示如何从<strong class="lb iu"> Google BigQuery </strong>中提取数据，并将其作为报告发送。如果你只想知道如何使用 Python 发送电子邮件，你可以跳到<strong class="lb iu">电子邮件</strong>部分。</p><h1 id="2e43" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">导入库</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="5b2d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">像往常一样，我们必须在进入编码部分之前导入库。我们将使用<a class="ae ky" href="https://docs.python.org/3/library/smtplib.html" rel="noopener ugc nofollow" target="_blank"> SMTP 协议客户端</a>发送电子邮件。<strong class="lb iu"> ConfigParser </strong>用于读取存储 SQL 查询的配置文件。我将在下一部分解释细节。</p><h1 id="3a80" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">从 BigQuery 提取数据</h1><p id="fd9a" class="pw-post-body-paragraph kz la it lb b lc mp ju le lf mq jx lh li mr lk ll lm ms lo lp lq mt ls lt lu im bi translated">首先，您必须创建一个配置文件来存储所有的 SQL 查询。将 python 脚本与 SQL 查询分开是一种很好的做法，尤其是当您的 SQL 查询很长(超过 20 行)时。这样，您的主脚本就不会被冗长的 SQL 查询弄得杂乱无章。</p><h2 id="6b2e" class="mu lw it bd lx mv mw dn mb mx my dp mf li mz na mh lm nb nc mj lq nd ne ml nf bi translated"><strong class="ak">配置文件示例</strong></h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="aab6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="ng">【报告 1】</em>是您的子配置。<code class="fe nh ni nj nk b">filename</code>、<code class="fe nh ni nj nk b">dialect</code>和<code class="fe nh ni nj nk b">query</code>是子配置的属性。</p><p id="9c63" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以使用以下代码读取配置文件。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div></figure><h2 id="bf5d" class="mu lw it bd lx mv mw dn mb mx my dp mf li mz na mh lm nb nc mj lq nd ne ml nf bi translated">写一个函数来读取子配置的属性</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="fb0c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个自定义函数将读取您传入的子配置文件的属性，并输出一个 CSV 文件。</p><p id="3e99" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nh ni nj nk b">yourProjectID</code>将是您的 BigQuery 项目 ID，而<code class="fe nh ni nj nk b">credential.json</code>将是您的 BigQuery 凭证 JSON 文件。如果您希望使用 Web Auth 登录，您可以删除它。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="51eb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，您只需要一个循环来提取您在配置文件中定义的所有文件。<code class="fe nh ni nj nk b">config.sections()</code>将返回您的配置文件中的子配置文件列表。</p><h1 id="ce48" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">通过电子邮件发送您的报告和附件</h1><h2 id="6419" class="mu lw it bd lx mv mw dn mb mx my dp mf li mz na mh lm nb nc mj lq nd ne ml nf bi translated">定义您的电子邮件内容</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="b57f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以上是你如何定义你的电子邮件属性，如发件人，收件人，抄送和主题。<code class="fe nh ni nj nk b">htmlEmail</code>将是你的邮件正文。您可以使用纯文本或 html 作为您的电子邮件正文。我更喜欢使用 html，因为我可以做更多的格式化工作，比如粗体、斜体和改变字体的颜色。</p><p id="02ed" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">同样的事情，我们将使用循环来附加所有的文件。</p><h2 id="0e9f" class="mu lw it bd lx mv mw dn mb mx my dp mf li mz na mh lm nb nc mj lq nd ne ml nf bi translated">发送电子邮件</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="547b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">出于演示目的，密码被硬编码在脚本中。这不是一个好的做法。为了更安全，您应该将密码保存在其他文件中。</p><p id="a10a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在你已经学会了如何使用 Python 发送带有附件的电子邮件。如果我犯了任何错误或打字错误，请给我留言。</p><p id="d2b3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以在我的<a class="ae ky" href="https://github.com/chingjunetao/google-service-with-python/tree/master/email-with-python" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu"> Github </strong> </a>中查看完整的脚本。如果你觉得这篇文章对你有用，请鼓掌支持我。干杯！</p></div></div>    
</body>
</html>