<html>
<head>
<title>Introduction to LSTM Units While Playing Jazz</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">演奏爵士乐时介绍 LSTM 单元</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/introduction-to-lstm-units-while-playing-jazz-fa0175b59012?source=collection_archive---------15-----------------------#2019-04-17">https://towardsdatascience.com/introduction-to-lstm-units-while-playing-jazz-fa0175b59012?source=collection_archive---------15-----------------------#2019-04-17</a></blockquote><div><div class="fc ij ik il im in"/><div class="io ip iq ir is"><div class=""/><div class=""><h2 id="0369" class="pw-subtitle-paragraph js iu iv bd b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj dk translated">了解长短期记忆(LSTM)单位，并运用它们生成爵士乐使用 Keras</h2></div><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi kk"><img src="../Images/562785eb641ff94144a1b8ebf6cd25ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*s3R2YFZQD9lRYOpn"/></div></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk">Photo by <a class="ae la" href="https://unsplash.com/@chrisbair?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Chris Bair</a> on <a class="ae la" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="e994" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">长短期记忆(LSTM)单元允许学习很长的序列。它是门控循环单元(<strong class="ld iw"> GRU </strong>)的一个更加通用和健壮的版本，在这篇文章中不会讨论。</p><p id="6940" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">在这篇文章中，我们将学习 LSTM 单元是如何工作的，我们将应用它来生成一些爵士音乐。</p><p id="74d4" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">我们开始吧！</p><blockquote class="lx"><p id="08ad" class="ly lz iv bd ma mb mc md me mf mg lw dk translated">对于机器学习、深度学习和人工智能的实践视频教程，请查看我的<a class="ae la" href="https://www.youtube.com/channel/UC-0lpiwlftqwC7znCcF83qg?view_as=subscriber" rel="noopener ugc nofollow" target="_blank"> YouTube 频道</a>。</p></blockquote><figure class="mh mi mj mk ml kp"><div class="bz fp l di"><div class="mm mn l"/></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk"><a class="ae la" href="https://www.youtube.com/watch?v=uq-gYOrU8bA" rel="noopener ugc nofollow" target="_blank"><em class="mo">You can call me Al</em></a> is a great song!</figcaption></figure><h1 id="ad7c" class="mp mq iv bd mr ms mt mu mv mw mx my mz kb na kc nb ke nc kf nd kh ne ki nf ng bi translated">LSTM 的结构</h1><p id="17e5" class="pw-post-body-paragraph lb lc iv ld b le nh jw lg lh ni jz lj lk nj lm ln lo nk lq lr ls nl lu lv lw io bi translated">LSTM 的主要特征是有三个门:</p><ul class=""><li id="4745" class="nm nn iv ld b le lf lh li lk no lo np ls nq lw nr ns nt nu bi translated">更新门</li><li id="7838" class="nm nn iv ld b le nv lh nw lk nx lo ny ls nz lw nr ns nt nu bi translated">忘记大门</li><li id="0aee" class="nm nn iv ld b le nv lh nw lk nx lo ny ls nz lw nr ns nt nu bi translated">输出门</li></ul><p id="7248" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">下面是一个 LSTM 单位的示意图。三个门通过三个<em class="oa">符号</em>的出现来显示:</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/c697fb1c6f6800674708158a6d538295.png" data-original-src="https://miro.medium.com/v2/resize:fit:1316/format:webp/1*-DEuMMLS72eAy-G9gblUGg.png"/></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk">Schema of an LSTM unit</figcaption></figure><p id="799b" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">从上图中，注意在 LSTM 单元的顶部有一条从左到右的线。这条线代表早期的信息如何在网络中传递到下一步，这就是为什么 LSTM 单元如此擅长于<em class="oa">记忆</em>长序列。因此，这允许模型捕捉更长范围的依赖性。</p><p id="27f4" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">这看起来好像没有太多关于 LSTM 的知识，但是要理解这只是一个循环神经网络中的一个单元(MAKE LINK)。上面的绿框只是代表一个 RNN 的一个单位。然后，连接多个单元，形成一个完整的网络。</p><h1 id="ad3a" class="mp mq iv bd mr ms mt mu mv mw mx my mz kb na kc nb ke nc kf nd kh ne ki nf ng bi translated">使用 LSTMs 生成 jazz</h1><p id="9c6a" class="pw-post-body-paragraph lb lc iv ld b le nh jw lg lh ni jz lj lk nj lm ln lo nk lq lr ls nl lu lv lw io bi translated">现在，我们将使用 LSTM 实现一个 RNN 来生成爵士乐！我们将使用 Keras 实现网络，它将生成一个 15 秒的爵士乐剪辑。</p><p id="a5d7" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">一如既往的<a class="ae la" href="https://github.com/marcopeix/Deep_Learning_AI/blob/master/5.Sequence%20Models/1.Recurrent%20Neural%20Networks/Improvise%20a%20Jazz%20Solo%20with%20LSTM.ipynb" rel="noopener ugc nofollow" target="_blank">全笔记本</a>可供咨询。</p><blockquote class="oc od oe"><p id="9506" class="lb lc oa ld b le lf jw lg lh li jz lj of ll lm ln og lp lq lr oh lt lu lv lw io bi translated">不幸的是，用于训练的数据太大，无法上传到 Github 上</p></blockquote><h2 id="61b8" class="oi mq iv bd mr oj ok dn mv ol om dp mz lk on oo nb lo op oq nd ls or os nf ot bi translated">概观</h2><p id="0f01" class="pw-post-body-paragraph lb lc iv ld b le nh jw lg lh ni jz lj lk nj lm ln lo nk lq lr ls nl lu lv lw io bi translated">我们模型的架构将如下所示:</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi ou"><img src="../Images/6efd0e0713f1a30e3ad879073a363c51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EZtKFu22eCuSkflH_o9YPQ.png"/></div></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk">RNN architecture to generate jazz music. <a class="ae la" href="https://www.deeplearning.ai/" rel="noopener ugc nofollow" target="_blank">Source</a></figcaption></figure><p id="b384" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">基本上，这个模型会被输入一个音乐值，然后它会产生一系列的音乐值来产生音乐。</p><p id="9e3d" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">在这里，“值”代表一个音符、一个持续时间，它还包含是否同时演奏另一个音符的信息(也称为和弦)。</p><h2 id="c799" class="oi mq iv bd mr oj ok dn mv ol om dp mz lk on oo nb lo op oq nd ls or os nf ot bi translated">步骤 1:初始模型设置</h2><p id="730d" class="pw-post-body-paragraph lb lc iv ld b le nh jw lg lh ni jz lj lk nj lm ln lo nk lq lr ls nl lu lv lw io bi translated">首先，我们定义网络中隐藏状态的数量。在这种情况下，我们将使用 64。</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div class="gh gi ov"><img src="../Images/534d6dda74fddf2d2573b4c2ee10c03e.png" data-original-src="https://miro.medium.com/v2/resize:fit:790/format:webp/1*-6BHenEnxxmKlautS52oSA.png"/></div></figure><p id="5051" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">现在，Keras 有简单的内置函数来构建模型。然而，对于序列生成，不是所有的输入值都是已知的；它们一次生成一个。因此，我们需要添加一个定制的 for 循环，并定义层对象，以便在步骤之间共享权重。</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div class="gh gi ow"><img src="../Images/9b1408dd8755718e803a6f8a001ce6bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1160/format:webp/1*mUC9k3pTWW9KpHY8PTM3eg.png"/></div></figure><h2 id="0b4f" class="oi mq iv bd mr oj ok dn mv ol om dp mz lk on oo nb lo op oq nd ls or os nf ot bi translated">步骤 2:构建模型</h2><p id="245f" class="pw-post-body-paragraph lb lc iv ld b le nh jw lg lh ni jz lj lk nj lm ln lo nk lq lr ls nl lu lv lw io bi translated">现在，我们准备构建模型:</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="ox mn l"/></div></figure><h2 id="eb8a" class="oi mq iv bd mr oj ok dn mv ol om dp mz lk on oo nb lo op oq nd ls or os nf ot bi translated">步骤 3:创建、编译、适应</h2><p id="b7ac" class="pw-post-body-paragraph lb lc iv ld b le nh jw lg lh ni jz lj lk nj lm ln lo nk lq lr ls nl lu lv lw io bi translated">现在，我们可以创建模型，对其进行编译，并使其符合数据:</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi oy"><img src="../Images/4a0eb8c519f653052384c0a04d096f11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oWDgvU88wQLxZYNUqEYBDA.png"/></div></div></figure><h2 id="5e2e" class="oi mq iv bd mr oj ok dn mv ol om dp mz lk on oo nb lo op oq nd ls or os nf ot bi translated">第四步:创作音乐</h2><p id="bff8" class="pw-post-body-paragraph lb lc iv ld b le nh jw lg lh ni jz lj lk nj lm ln lo nk lq lr ls nl lu lv lw io bi translated">现在，我们开始有趣的部分:让我们用我们的模型产生音乐！</p><p id="6554" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">在每个采样步骤中，来自前一个 LSTM 单元的激活和单元状态将在下一个单元中传播，并且它们将用于生成另一个输出。</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi oz"><img src="../Images/4d7fa71eb7d63acef293d8b9861adede.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*caC3fRPT8i4cY2x_ifle6w.png"/></div></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk">How the output propagates in the network. <a class="ae la" href="https://www.deeplearning.ai/" rel="noopener ugc nofollow" target="_blank">Source</a></figcaption></figure><p id="6621" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">要生成音乐，我们需要首先对音符进行采样:</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi pa"><img src="../Images/937e3bd1cd7adad1773ef401e23ec3ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OZVWULS_B31q6HYjbMQNdA.png"/></div></div></figure><p id="a0d0" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">有了这些，我们现在可以预测并创造一个音乐序列:</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi pa"><img src="../Images/22ae13d9b8a2ad0a45211b5d947233e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1eWW1nl3hWgcbbxXELKhFA.png"/></div></div></figure><p id="7ffd" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">然后用这个代码单元生成音乐:</p><pre class="kl km kn ko gt pb pc pd pe aw pf bi"><span id="ba14" class="oi mq iv pc b gy pg ph l pi pj">out_stream = generate_music(inference_model)</span></pre><p id="f091" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">你可以找到我生成的音乐文件(。midi 文件)存储在<a class="ae la" href="https://github.com/marcopeix/Deep_Learning_AI/tree/master/5.Sequence%20Models/1.Recurrent%20Neural%20Networks" rel="noopener ugc nofollow" target="_blank">库</a>中。</p></div><div class="ab cl pk pl hz pm" role="separator"><span class="pn bw bk po pp pq"/><span class="pn bw bk po pp pq"/><span class="pn bw bk po pp"/></div><div class="io ip iq ir is"><p id="a2fe" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">就是这样！您学习了什么是 LSTM 单元，以及如何用 Keras 应用它来生成音乐。请记住，LSTM 单位只是 RNN 中使用的块。</p><p id="1057" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">对于进一步的阅读，我建议你看看 GRU 单元，因为它是一个 LSTM 的简单版本。</p><p id="b999" class="pw-post-body-paragraph lb lc iv ld b le lf jw lg lh li jz lj lk ll lm ln lo lp lq lr ls lt lu lv lw io bi translated">干杯！</p></div></div>    
</body>
</html>