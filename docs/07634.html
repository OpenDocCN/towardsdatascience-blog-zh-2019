<html>
<head>
<title>Analysis of Tweets about the Joker (2019 film) in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python 中关于小丑(2019 年电影)的推文分析</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/analysis-of-tweets-about-the-joker-2019-film-in-python-df9996aa5fb1?source=collection_archive---------28-----------------------#2019-10-23">https://towardsdatascience.com/analysis-of-tweets-about-the-joker-2019-film-in-python-df9996aa5fb1?source=collection_archive---------28-----------------------#2019-10-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn js jt ju jv gh gi paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gh gi jr"><img src="../Images/092e9cc1ddc1212753d668ea3faeee38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iGRKKqXaa4LWWNH22ja0kQ.jpeg"/></div></div><figcaption class="kc kd gj gh gi ke kf bd b be z dk">Photo by <a class="ae kg" href="https://www.pexels.com/@pixabay" rel="noopener ugc nofollow" target="_blank">Pixabay</a> on <a class="ae kg" href="https://www.pexels.com/photo/apps-blur-button-close-up-267350/" rel="noopener ugc nofollow" target="_blank">Pexels</a></figcaption></figure><p id="46f4" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">在本帖中，我们将分析与<em class="lf">小丑(2019 年电影)</em>相关的推特推文。首先，你需要申请一个 Twitter 开发者账户:</p><figure class="lh li lj lk gt jv gh gi paragraph-image"><div class="gh gi lg"><img src="../Images/8de478e493cd200d2ddb35292f06e27d.png" data-original-src="https://miro.medium.com/v2/resize:fit:808/format:webp/1*0xmSHPJRMafMjW4Zr4atYQ.png"/></div><figcaption class="kc kd gj gh gi ke kf bd b be z dk"><a class="ae kg" href="https://projects.raspberrypi.org/en/projects/getting-started-with-the-twitter-api/3" rel="noopener ugc nofollow" target="_blank">Source</a></figcaption></figure><p id="a903" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">您的开发人员帐户获得批准后，您需要创建一个 Twitter 应用程序:</p><figure class="lh li lj lk gt jv gh gi paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gh gi ll"><img src="../Images/535749c04db1726dafff300aac41628c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5EGnUjPFY2dF-jUkTdd6QA.png"/></div></div><figcaption class="kc kd gj gh gi ke kf bd b be z dk"><a class="ae kg" href="https://projects.raspberrypi.org/en/projects/getting-started-with-the-twitter-api/4" rel="noopener ugc nofollow" target="_blank">Source</a></figcaption></figure><p id="f9b6" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">申请 Twitter 开发者账户和创建 Twitter 应用的步骤在<a class="ae kg" href="https://projects.raspberrypi.org/en/projects/getting-started-with-the-twitter-api/4" rel="noopener ugc nofollow" target="_blank">这里</a>有所概述。</p><p id="2741" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">为了访问 Twitter API，我们将使用免费的 python 库 tweepy。tweepy 的文档可以在<a class="ae kg" href="https://tweepy.readthedocs.io/en/latest/getting_started.html" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><ol class=""><li id="44fd" class="lm ln it kj b kk kl ko kp ks lo kw lp la lq le lr ls lt lu bi translated"><strong class="kj iu">安装</strong></li></ol><p id="4861" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">首先，确保您已经安装了 tweepy。打开命令行并键入:</p><pre class="lh li lj lk gt lv lw lx ly aw lz bi"><span id="a36d" class="ma mb it lw b gy mc md l me mf">pip install tweepy </span></pre><p id="8039" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">2.<strong class="kj iu">导入库</strong></p><p id="23e6" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">接下来，打开您最喜欢的编辑器，导入 tweepy 和 pandas 库:</p><pre class="lh li lj lk gt lv lw lx ly aw lz bi"><span id="725b" class="ma mb it lw b gy mc md l me mf">import tweepy<br/>import pandas as pd<strong class="lw iu">AUTHENTICATION</strong></span></pre><p id="b15e" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">接下来，我们需要我们的消费者密钥和访问令牌:</p><figure class="lh li lj lk gt jv gh gi paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gh gi mg"><img src="../Images/6e8d1ea132e104bb6c262ddad9d50495.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7TxOpsOni5I1HAdafJ9BWw.png"/></div></div><figcaption class="kc kd gj gh gi ke kf bd b be z dk"><a class="ae kg" href="https://projects.raspberrypi.org/en/projects/getting-started-with-the-twitter-api/4" rel="noopener ugc nofollow" target="_blank">Source</a></figcaption></figure><p id="d398" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">请注意，该网站建议您保持您的密钥和令牌私有！这里我们定义了一个假的密钥和令牌，但是在创建 Twitter 应用程序时，您应该使用真正的密钥和令牌，如上所示:</p><pre class="lh li lj lk gt lv lw lx ly aw lz bi"><span id="7ab4" class="ma mb it lw b gy mc md l me mf">consumer_key = '5GBi0dCerYpy2jJtkkU3UwqYtgJpRd' <br/>consumer_secret = 'Q88B4BDDAX0dCerYy2jJtkkU3UpwqY'<br/>access_token = 'X0dCerYpwi0dCerYpwy2jJtkkU3U'<br/>access_token_secret = 'kly2pwi0dCerYpjJtdCerYkkU3Um'</span></pre><p id="39f9" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">下一步是创建 OAuthHandler 实例。我们传递上面定义的消费者密钥和访问令牌:</p><pre class="lh li lj lk gt lv lw lx ly aw lz bi"><span id="607d" class="ma mb it lw b gy mc md l me mf">auth = tweepy.OAuthHandler(consumer_key, consumer_secret)<br/>auth.set_access_token(access_token, access_token_secret)</span></pre><p id="6ffd" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">接下来，我们将 OAuthHandler 实例传递给 API 方法:</p><pre class="lh li lj lk gt lv lw lx ly aw lz bi"><span id="7715" class="ma mb it lw b gy mc md l me mf">api = tweepy.API(auth)</span></pre><p id="58f6" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">3 <strong class="kj iu">。TWITTER API 请求</strong></p><p id="2cca" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">接下来，我们为我们有兴趣分析的字段初始化列表。现在，我们可以查看推文字符串、用户和推文时间。接下来，我们在一个 tweepy“Cursor”对象上编写一个 for 循环。在“Cursor”对象中，我们传递“api.search”方法，为我们想要搜索的内容设置查询字符串(q =“Joker”)，并设置“count”= 1000，这样我们就不会超过 twitter 的速率限制。我们还使用“item()”方法将“Cursor”对象转换为 iterable。</p><p id="c42f" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">为了简化查询，我们可以删除转发，只包含英文推文。为了了解该请求返回的内容，我们还可以打印附加到每个列表的值:</p><pre class="lh li lj lk gt lv lw lx ly aw lz bi"><span id="d70c" class="ma mb it lw b gy mc md l me mf">twitter_users = []<br/>tweet_time = []<br/>tweet_string = []<br/>for tweet in tweepy.Cursor(api.search,q="Joker", count=1000).items(1000):<br/>        if (not tweet.retweeted) and ('RT @' not in tweet.text):<br/>            if tweet.lang == "en":<br/>                twitter_users.append(tweet.user.name)<br/>                tweet_time.append(tweet.created_at)<br/>                tweet_string.append(tweet.text)<br/>                print([tweet.user.name,tweet.created_at,tweet.text])</span></pre><figure class="lh li lj lk gt jv gh gi paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gh gi mh"><img src="../Images/80c8a9672011a3f3d7e0994986e337cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EWTvs9_Vkv_6Hp4PlYoq_Q.png"/></div></div><figcaption class="kc kd gj gh gi ke kf bd b be z dk">Tweets related to “Joker”</figcaption></figure><p id="cdcf" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">我们也可以使用查询字符串。让我们把它从“小丑”改成“华金”，这是<em class="lf">小丑</em>中男主角的名字:</p><pre class="lh li lj lk gt lv lw lx ly aw lz bi"><span id="90cc" class="ma mb it lw b gy mc md l me mf">for tweet in tweepy.Cursor(api.search,q="Joaquin", count=1000).items(1000):<br/>        if (not tweet.retweeted) and ('RT @' not in tweet.text):<br/>            if tweet.lang == "en":<br/>                twitter_users.append(tweet.user.name)<br/>                tweet_time.append(tweet.created_at)<br/>                tweet_string.append(tweet.text)<br/>                print([tweet.user.name,tweet.created_at,tweet.text])</span></pre><figure class="lh li lj lk gt jv gh gi paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gh gi mi"><img src="../Images/43fe70cce1a7c7cfa102bd95f49fad1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZnVEIVtUF64lPxYP1RSwXA.png"/></div></div><figcaption class="kc kd gj gh gi ke kf bd b be z dk">Tweets related to “Joaquin”</figcaption></figure><p id="8b03" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">接下来，我们可以将查询结果存储在数据帧中。为此，让我们定义一个函数，该函数将一个关键字作为参数，并返回一个包含与该关键字相关的 1000 条推文的数据帧:</p><pre class="lh li lj lk gt lv lw lx ly aw lz bi"><span id="1a1f" class="ma mb it lw b gy mc md l me mf">def get_related_tweets(key_word):<br/>    twitter_users = []<br/>    tweet_time = []<br/>    tweet_string = [] <br/>    for tweet in tweepy.Cursor(api.search,q=key_word, count=1000).items(1000):<br/>            if (not tweet.retweeted) and ('RT @' not in tweet.text):<br/>                if tweet.lang == "en":<br/>                    twitter_users.append(tweet.user.name)<br/>                    tweet_time.append(tweet.created_at)<br/>                    tweet_string.append(tweet.text)<br/>                    #print([tweet.user.name,tweet.created_at,tweet.text])<br/>    df = pd.DataFrame({'name':twitter_users, 'time': tweet_time, 'tweet': tweet_string})<br/>    df.to_csv(f"{key_word}.csv")<br/>    return df</span></pre><p id="e7c4" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">当我们用“Joker”调用函数时，定义一个 dataframe 作为函数的返回值，并打印它的前五行，我们得到:</p><pre class="lh li lj lk gt lv lw lx ly aw lz bi"><span id="ff9d" class="ma mb it lw b gy mc md l me mf">df_joker = get_related_tweets("Joker")<br/>print(df_joker.head(5))</span></pre><figure class="lh li lj lk gt jv gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/2fc31a515eaf65ea216bd7b808486b89.png" data-original-src="https://miro.medium.com/v2/resize:fit:790/format:webp/1*rouzF4OhkaVu_W090W5dDg.png"/></div><figcaption class="kc kd gj gh gi ke kf bd b be z dk">First five rows of dataframe of tweets for “Joker”</figcaption></figure><p id="fcbe" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">如果我们对“华金”做同样的事情:</p><pre class="lh li lj lk gt lv lw lx ly aw lz bi"><span id="9c1f" class="ma mb it lw b gy mc md l me mf">df_joaquin = get_related_tweets("Joaquin")<br/>print(df_joaquin.head(5))</span></pre><figure class="lh li lj lk gt jv gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/3fd4b875e7adbdd99d1b5a8ac0f6efb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:772/format:webp/1*OJ3iorFBJvINYzmV3_oqbQ.png"/></div><figcaption class="kc kd gj gh gi ke kf bd b be z dk">First five rows of dataframe of tweets for “Joaquin”</figcaption></figure><p id="ff55" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">我们还可以搜索带有“小丑”和“糟糕电影”的推文。csv '行):</p><pre class="lh li lj lk gt lv lw lx ly aw lz bi"><span id="4c5b" class="ma mb it lw b gy mc md l me mf">def get_related_tweets(key_word):<br/>    twitter_users = []<br/>    tweet_time = []<br/>    tweet_string = [] <br/>    for tweet in tweepy.Cursor(api.search,q=key_word, count=1000).items(1000):<br/>            if (not tweet.retweeted) and ('RT @' not in tweet.text):<br/>                if tweet.lang == "en":<br/>                    twitter_users.append(tweet.user.name)<br/>                    tweet_time.append(tweet.created_at)<br/>                    tweet_string.append(tweet.text)<br/>                    #print([tweet.user.name,tweet.created_at,tweet.text])<br/>    df = pd.DataFrame({'name':twitter_users, 'time': tweet_time, 'tweet': tweet_string})<br/>    return df<br/>df_bad = get_related_tweets("Joker bad movie")<br/>print(df_bad.head(5))</span></pre><figure class="lh li lj lk gt jv gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/2ddf50261a85c2334e1b56885dbb7f07.png" data-original-src="https://miro.medium.com/v2/resize:fit:782/format:webp/1*OnAxUGDWEB6Zc2epNcqmvg.png"/></div></figure><p id="baea" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">让我们通过遍历 dataframe 索引并从 tweet 列中选择值来仔细查看几行:</p><figure class="lh li lj lk gt jv gh gi paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gh gi mm"><img src="../Images/28447fceda4daff0ff78168111be7d0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mBeEbwhB47D32dcpPCNuHA.png"/></div></div><figcaption class="kc kd gj gh gi ke kf bd b be z dk">Expanded strings of ”Joker bad movie” tweets</figcaption></figure><p id="7dc3" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">对于带有“小丑”和“好电影”的推文:</p><pre class="lh li lj lk gt lv lw lx ly aw lz bi"><span id="0f28" class="ma mb it lw b gy mc md l me mf">df_good = get_related_tweets("Joker good movie")<br/>print(df_good.head(5))</span></pre><figure class="lh li lj lk gt jv gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/c47652ff2a7e8fea46d835a2fbcaa42e.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/format:webp/1*2v9cLMTn1XICXpqfKJMPHg.png"/></div></figure><figure class="lh li lj lk gt jv gh gi paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="gh gi mo"><img src="../Images/b47a853ca9901aad5b0121f2771255ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*moeFg5t0ybq9FAIiowDaWg.png"/></div></div><figcaption class="kc kd gj gh gi ke kf bd b be z dk">Expanded strings of ”Joker good movie” tweets</figcaption></figure><p id="f608" class="pw-post-body-paragraph kh ki it kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">在下一篇文章中，我们将使用一个名为 TextBlob 的 python 库对其中一些推文进行情感分析。在此基础上，我们可以构建一个情绪分析器，将一条推文分类为负面情绪或正面情绪。这篇文章的代码可以在 Github 上找到。感谢您的阅读！祝好运，机器学习快乐！</p></div></div>    
</body>
</html>