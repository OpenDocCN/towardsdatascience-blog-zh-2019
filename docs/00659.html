<html>
<head>
<title>Mapping with Matplotlib, Pandas, Geopandas and Basemap in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Python 中的 Matplotlib、Pandas、Geopandas 和底图进行制图</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/mapping-with-matplotlib-pandas-geopandas-and-basemap-in-python-d11b57ab5dac?source=collection_archive---------0-----------------------#2019-01-31">https://towardsdatascience.com/mapping-with-matplotlib-pandas-geopandas-and-basemap-in-python-d11b57ab5dac?source=collection_archive---------0-----------------------#2019-01-31</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="c285" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">作为 FORSK TECHNOLOGIES， 的一名实习生，我探索了相当多的 Python 库(Matplotlib、Pandas、Numpy、Seaborn、Shapefile、Basemap、Geopandas ),它们对绘制数据(某种程度上也是实时数据)很有帮助..)过地图。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/10d9a58a87caec41a69275299dbfb341.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*klt39QKy6dCrrCIgcAwq5A.png"/></div></div></figure></div><div class="ab cl ky kz hu la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ij ik il im in"><h1 id="ef76" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">用 Python 绘制地理地图</h1><p id="8b72" class="pw-post-body-paragraph jn jo iq jp b jq md js jt ju me jw jx jy mf ka kb kc mg ke kf kg mh ki kj kk ij bi translated">在处理数据科学时，可视化地图上的数据非常有用，这可以通过 geopandas 等模块来完成。在这里，我们将探索使用<a class="ae kl" href="https://en.wikipedia.org/wiki/Shapefile" rel="noopener ugc nofollow" target="_blank"> shapefiles </a>()创建地理地图并在其上可视化数据的方法。shp)和其他一些 Python 库。</p><p id="2a4d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这里，我们将根据地图上的可视化数据来研究拉贾斯坦邦的城市人口。</p><p id="eae5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">本文所需的 shapefile 可以从这个链接下载<a class="ae kl" href="https://www.arcgis.com/home/item.html?id=acb8cb18e7cd45c982086b6ef2bb5a62" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">点击这里</strong> </a></p><p id="afd8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">安装 Shapefile 库</strong></p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="7cf0" class="mn lg iq mj b gy mo mp l mq mr"><em class="ms">~ conda/pip install pyshp</em></span></pre><p id="c7df" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">导入库</strong></p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="0d91" class="mn lg iq mj b gy mo mp l mq mr"><em class="ms">import numpy as np<br/>import pandas as pd<br/>import shapefile as shp<br/>import matplotlib.pyplot as plt<br/>import seaborn as sns</em></span></pre><p id="7fb1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">初始化可视化集</strong></p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="4c8c" class="mn lg iq mj b gy mo mp l mq mr"><em class="ms">sns.set(style=”whitegrid”, palette=”pastel”, color_codes=True) sns.mpl.rc(“figure”, figsize=(10,6))</em></span></pre><p id="5705" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">打开矢量地图</strong></p><p id="62da" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">矢量地图是一组具有. shp 格式的文件。</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="a856" class="mn lg iq mj b gy mo mp l mq mr"><em class="ms">#opening the vector map</em></span><span id="c913" class="mn lg iq mj b gy mt mp l mq mr"><em class="ms">shp_path = “\\District_Boundary.shp”</em></span><span id="e483" class="mn lg iq mj b gy mt mp l mq mr"><em class="ms">#reading the shape file by using reader function of the shape lib</em></span><span id="f619" class="mn lg iq mj b gy mt mp l mq mr"><em class="ms">sf = shp.Reader(shp_path)</em></span></pre><p id="a7d4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">shp.reader 导入的不同形状的数量</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="e445" class="mn lg iq mj b gy mo mp l mq mr"><em class="ms">len(sf.shapes())</em></span></pre><p id="efb5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">结果将是 33，这告诉我们有 33 个形状，或者我们可以说拉贾斯坦邦地区的城市。</p><p id="7474" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要浏览这些记录:</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="b256" class="mn lg iq mj b gy mo mp l mq mr"><em class="ms">sf.records()</em></span></pre><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/d319d7d2e7be58fc5a279cc4b0e542ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:710/format:webp/1*5wer7W-Lkam-cKOHiMEKHw.png"/></div><figcaption class="mv mw gj gh gi mx my bd b be z dk">A sample output</figcaption></figure><p id="7478" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要浏览特定记录，其中 1 是 Id 或行号，0 表示列:</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="06a3" class="mn lg iq mj b gy mo mp l mq mr"><strong class="mj ir"><em class="ms">sf.records()[1][0]</em></strong></span></pre><p id="2f06" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">结果- </strong></p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="acbf" class="mn lg iq mj b gy mo mp l mq mr">Output= Barmer</span></pre><p id="a6fa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">将形状文件数据转换为熊猫数据帧:</strong></p><p id="a4de" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通过将 shapefile 数据转换为更相关的 Pandas Dataframe 格式，使访问城市变得更加容易。</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="4017" class="mn lg iq mj b gy mo mp l mq mr"><strong class="mj ir">def read_shapefile(sf):</strong><br/>    #fetching the headings from the shape file<br/>    fields = [x[0] for x in sf.fields][1:]</span><span id="17f2" class="mn lg iq mj b gy mt mp l mq mr">#fetching the records from the shape file<br/>    records = [list(i) for i in sf.records()]<br/>    shps = [s.points for s in sf.shapes()]</span><span id="c036" class="mn lg iq mj b gy mt mp l mq mr">#converting shapefile data into pandas dataframe<br/>    df = pd.DataFrame(columns=fields, data=records)</span><span id="6e14" class="mn lg iq mj b gy mt mp l mq mr">#assigning the coordinates<br/>    df = df.assign(coords=shps)<br/>    return df</span></pre><p id="7d31" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">数据转换为数据帧后的可视化，其中数据帧指的是行和列</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="d7f6" class="mn lg iq mj b gy mo mp l mq mr"><em class="ms">df = read_shapefile(sf)</em></span><span id="5c01" class="mn lg iq mj b gy mt mp l mq mr"><strong class="mj ir"><em class="ms">df.shape</em></strong></span></pre><p id="624e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">具有(33，6)形状的数据帧意味着其中有 33 行和 6 列。</p><p id="b81b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">让我们看看创建的数据帧的示例</strong></p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="8cca" class="mn lg iq mj b gy mo mp l mq mr"><em class="ms"># sample of a data representation the last point has the coordinates of the data latitude and longitude which will be used to create a specific map shape</em></span><span id="b8fa" class="mn lg iq mj b gy mt mp l mq mr"><strong class="mj ir"><em class="ms">df.sample(5)</em></strong></span></pre><p id="1e9d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">结果会是这样的—</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/b8f417ca7c4bce45f3757736f718f60c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*m9RGwkeF-ELtbAKC18cmjA.png"/></div><figcaption class="mv mw gj gh gi mx my bd b be z dk">Output</figcaption></figure><p id="8fc6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里的线是用来创建地图的纬度和经度。</p><p id="6c44" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">借助 Matplotlib </strong>绘制拉贾斯坦邦的城市地图或特定形状</p><p id="47f4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">#a)根据城市坐标绘制形状(多边形),</p><p id="b892" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">#b)计算并返回该特定形状的中点(x0，y0)。</p><p id="be8f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">#此中点也用于定义打印城市名称的位置。</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="675c" class="mn lg iq mj b gy mo mp l mq mr"><strong class="mj ir">def plot_shape(id, s=None):</strong><br/>    plt.figure()<br/>    #plotting the graphical axes where map ploting will be done<br/>    ax = plt.axes()<br/>    ax.set_aspect('equal')</span><span id="70ee" class="mn lg iq mj b gy mt mp l mq mr">#storing the id number to be worked upon<br/>    shape_ex = sf.shape(id)</span><span id="b5f5" class="mn lg iq mj b gy mt mp l mq mr">#NP.ZERO initializes an array of rows and column with 0 in place of each elements <br/>    #an array will be generated where number of rows will be(len(shape_ex,point))and number of columns will be 1 and stored into the variable<br/>    x_lon = np.zeros((len(shape_ex.points),1))</span><span id="49eb" class="mn lg iq mj b gy mt mp l mq mr">#an array will be generated where number of rows will be(len(shape_ex,point))and number of columns will be 1 and stored into the variable<br/>    y_lat = np.zeros((len(shape_ex.points),1))<br/>    for ip in range(len(shape_ex.points)):<br/>        x_lon[ip] = shape_ex.points[ip][0]<br/>        y_lat[ip] = shape_ex.points[ip][1]</span><span id="d145" class="mn lg iq mj b gy mt mp l mq mr">#plotting using the derived coordinated stored in array created by numpy<br/>    plt.plot(x_lon,y_lat) <br/>    x0 = np.mean(x_lon)<br/>    y0 = np.mean(y_lat)<br/>    plt.text(x0, y0, s, fontsize=10)</span><span id="fcc0" class="mn lg iq mj b gy mt mp l mq mr"># use bbox (bounding box) to set plot limits<br/>    plt.xlim(shape_ex.bbox[0],shape_ex.bbox[2])<br/>    return x0, y0</span></pre><p id="bc16" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">设置城市名称以绘制各自的地图</strong></p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="e95c" class="mn lg iq mj b gy mo mp l mq mr"><em class="ms">DIST_NAME = ‘JAIPUR’</em></span><span id="03ab" class="mn lg iq mj b gy mt mp l mq mr"><em class="ms">#to get the id of the city map to be plotted</em></span><span id="048d" class="mn lg iq mj b gy mt mp l mq mr"><em class="ms">com_id = df[df.DIST_NAME == ‘JAIPUR’].index.get_values()[0]</em></span><span id="ea56" class="mn lg iq mj b gy mt mp l mq mr"><strong class="mj ir"><em class="ms">plot_shape(com_id, DIST_NAME)</em></strong></span><span id="af38" class="mn lg iq mj b gy mt mp l mq mr"><em class="ms">sf.shape(com_id)</em></span></pre><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi na"><img src="../Images/9bd72275d7852fe0736872f6f2ad6552.png" data-original-src="https://miro.medium.com/v2/resize:fit:678/format:webp/1*hpg84dwbWRfWF5gXJqoJGQ.png"/></div><figcaption class="mv mw gj gh gi mx my bd b be z dk">Output</figcaption></figure><blockquote class="nb nc nd"><p id="4c26" class="jn jo ms jp b jq jr js jt ju jv jw jx ne jz ka kb nf kd ke kf ng kh ki kj kk ij bi translated">为了绘制特定的形状，我们必须知道特定城市的 ID，但是将 shapefile 文件数据更改为 Pandas dataframe 使工作变得更加容易和简单，现在我们可以直接调用它的名称。</p></blockquote><p id="c6e9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">绘制全图</strong></p><p id="20ee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个特殊的函数将所有使用坐标制作的单个形状组合起来，并显示为一个组合形状。</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="405e" class="mn lg iq mj b gy mo mp l mq mr">def plot_map(sf, x_lim = None, y_lim = None, figsize = (11,9)):<br/>    plt.figure(figsize = figsize)<br/>    id=0<br/>    for shape in sf.shapeRecords():<br/>        x = [i[0] for i in shape.shape.points[:]]<br/>        y = [i[1] for i in shape.shape.points[:]]<br/>        plt.plot(x, y, 'k')<br/>        <br/>        if (x_lim == None) &amp; (y_lim == None):<br/>            x0 = np.mean(x)<br/>            y0 = np.mean(y)<br/>            plt.text(x0, y0, id, fontsize=10)<br/>        id = id+1<br/>    <br/>    if (x_lim != None) &amp; (y_lim != None):     <br/>        plt.xlim(x_lim)<br/>        plt.ylim(y_lim)</span><span id="9dd9" class="mn lg iq mj b gy mt mp l mq mr"><em class="ms">#calling the function and passing required parameters to plot the full map</em></span><span id="cd9d" class="mn lg iq mj b gy mt mp l mq mr"><strong class="mj ir"><em class="ms">plot_map(sf)</em></strong></span></pre><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/bf0542177aab2b9242a1a91703b37be5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1348/format:webp/1*LwqFa1PWa6yBhA0QDnKuOQ.png"/></div></figure><p id="3d84" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">绘制缩放地图</strong></p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="33aa" class="mn lg iq mj b gy mo mp l mq mr"><em class="ms">y_lim = (2900000,3000000) # latitude</em></span><span id="c965" class="mn lg iq mj b gy mt mp l mq mr"><em class="ms">x_lim = (200000, 400000) # longitude</em></span><span id="485d" class="mn lg iq mj b gy mt mp l mq mr"><strong class="mj ir"><em class="ms">plot_map(sf, x_lim, y_lim)</em></strong></span></pre><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/2a77c58bfb47c47ca1f759550102bd66.png" data-original-src="https://miro.medium.com/v2/resize:fit:1370/format:webp/1*cHdEThE-xqybj1xnPJYYWg.png"/></div><figcaption class="mv mw gj gh gi mx my bd b be z dk">output</figcaption></figure><p id="9081" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">在完整的地图上突出显示一个单一的形状</strong></p><p id="b9c3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">结合以前的功能就可以了。我们可以在一张完整的地图上画出一个形状。ID 和颜色代码将是该功能的必需参数。</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="776f" class="mn lg iq mj b gy mo mp l mq mr"><strong class="mj ir">def plot_map_fill(id, sf, x_lim = None, <br/>                          y_lim = None, <br/>                          figsize = (11,9), <br/>                          color = 'r'):</strong><br/>   <br/>    plt.figure(figsize = figsize)<br/>    fig, ax = plt.subplots(figsize = figsize)<br/>    for shape in sf.shapeRecords():<br/>        x = [i[0] for i in shape.shape.points[:]]<br/>        y = [i[1] for i in shape.shape.points[:]]<br/>        ax.plot(x, y, 'k')<br/>        <br/>    shape_ex = sf.shape(id)<br/>    x_lon = np.zeros((len(shape_ex.points),1))<br/>    y_lat = np.zeros((len(shape_ex.points),1))<br/>    for ip in range(len(shape_ex.points)):<br/>        x_lon[ip] = shape_ex.points[ip][0]<br/>        y_lat[ip] = shape_ex.points[ip][1]<br/>    ax.fill(x_lon,y_lat, color)<br/>    <br/>    if (x_lim != None) &amp; (y_lim != None):     <br/>        plt.xlim(x_lim)<br/>        plt.ylim(y_lim)</span><span id="2389" class="mn lg iq mj b gy mt mp l mq mr"><em class="ms">#plot_map_fill(0, sf, x_lim, y_lim, color=’y’)</em></span><span id="5337" class="mn lg iq mj b gy mt mp l mq mr"><strong class="mj ir"><em class="ms">plot_map_fill(13, sf,color=’y’)</em></strong></span></pre><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/955f31444c42c0b5ab55373f6c8deb9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1356/format:webp/1*DYx93kY-cZdp4T7pNTirDA.png"/></div><figcaption class="mv mw gj gh gi mx my bd b be z dk">Desired Output</figcaption></figure><p id="d338" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">用城市 ID 在整个地图上突出显示多个形状</strong></p><p id="b252" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这个函数的帮助下，作为参数，我们可以给出多个城市的 ID，这将导致突出显示多个城市而不是 1 个。</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="f7e7" class="mn lg iq mj b gy mo mp l mq mr"><strong class="mj ir">def plot_map_fill_multiples_ids(title, city, sf, <br/>                                               x_lim = None, <br/>                                               y_lim = None, <br/>                                               figsize = (11,9), <br/>                                               color = 'r'):</strong><br/>  <br/>    <br/>    plt.figure(figsize = figsize)<br/>    fig, ax = plt.subplots(figsize = figsize)<br/>    fig.suptitle(title, fontsize=16)<br/>    for shape in sf.shapeRecords():<br/>        x = [i[0] for i in shape.shape.points[:]]<br/>        y = [i[1] for i in shape.shape.points[:]]<br/>        ax.plot(x, y, 'k')<br/>            <br/>    for id in city:<br/>        shape_ex = sf.shape(id)<br/>        x_lon = np.zeros((len(shape_ex.points),1))<br/>        y_lat = np.zeros((len(shape_ex.points),1))<br/>        for ip in range(len(shape_ex.points)):<br/>            x_lon[ip] = shape_ex.points[ip][0]<br/>            y_lat[ip] = shape_ex.points[ip][1]<br/>        ax.fill(x_lon,y_lat, color)<br/>             <br/>        x0 = np.mean(x_lon)<br/>        y0 = np.mean(y_lat)<br/>        plt.text(x0, y0, id, fontsize=10)<br/>    <br/>    if (x_lim != None) &amp; (y_lim != None):     <br/>        plt.xlim(x_lim)<br/>        plt.ylim(y_lim)</span></pre><p id="f30b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们看看地图是什么样子的</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="7576" class="mn lg iq mj b gy mo mp l mq mr"><em class="ms">#naming the id numbers of the cities to be coloured</em></span><span id="b494" class="mn lg iq mj b gy mt mp l mq mr"><em class="ms">city_id = [0, 1, 2, 3, 4, 5, 6]</em></span><span id="dcc2" class="mn lg iq mj b gy mt mp l mq mr"><strong class="mj ir"><em class="ms">plot_map_fill_multiples_ids(“Multiple Shapes”,</em></strong></span><span id="18db" class="mn lg iq mj b gy mt mp l mq mr"><strong class="mj ir"><em class="ms">city_id, sf, color = ‘g’)</em></strong></span></pre><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/52d25a12c6ebd470c3dce4eb0e5c03b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/1*OCBUmsiMtsTYsg-FJfIuVA.png"/></div></figure><p id="24ef" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">通过城市名称在整个地图上突出显示多个形状</strong></p><p id="2b04" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最近，我们遇到了用城市 ID(索引)突出显示形状的问题，但尽管我们的数据是熊猫数据框架，我们也可以通过提到城市名称来做到这一点。</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="a06e" class="mn lg iq mj b gy mo mp l mq mr"># plotting the city on the map to be coloured by using the dist_name</span><span id="5f73" class="mn lg iq mj b gy mt mp l mq mr"><strong class="mj ir">def plot_cities_2(sf, title, cities, color):</strong><br/>    <br/>    df = read_shapefile(sf)<br/>    city_id = []<br/>    for i in cities:<br/>        city_id.append(df[df.DIST_NAME == i.upper()]<br/>                         .index.get_values()[0])<br/>    plot_map_fill_multiples_ids(title, city_id, sf, <br/>                                       x_lim = None, <br/>                                       y_lim = None, <br/>                                       figsize = (11,9), <br/>                                       color = color);</span></pre><p id="2602" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们来看看输出</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="1ef7" class="mn lg iq mj b gy mo mp l mq mr"><em class="ms">south = [‘jaipur’,’churu’,’bikaner’]</em></span><span id="cdce" class="mn lg iq mj b gy mt mp l mq mr"><em class="ms">plot_cities_2(sf, ‘DIST’, south, ‘c’)</em></span></pre><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/f60d7d823f8aa63abe4bad538a2b63c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1348/format:webp/1*jNl78Rzi6fhk9WoG6sJQDg.png"/></div></figure><p id="aa0d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">绘制热图</strong></p><p id="05e2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是一种根据提供的值用不同强度的特定颜色填充形状的地图。它以地理格式提供清晰的数据解释。</p><p id="f88b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在第一个函数中，我们将把我们的数据列表划分为区间或箱，其中每个箱将具有特定的颜色强度，6 个箱和 4 个不同的颜色托盘。</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="22ad" class="mn lg iq mj b gy mo mp l mq mr"><strong class="mj ir">def calc_color(data, color=None):</strong><br/>        if color   == 1: <br/>            color_sq =  ['#dadaebFF','#bcbddcF0','#9e9ac8F0','#807dbaF0','#6a51a3F0','#54278fF0']; <br/>            colors = 'Purples';<br/>        elif color == 2: <br/>            color_sq = ['#c7e9b4','#7fcdbb','#41b6c4','#1d91c0','#225ea8','#253494']; <br/>            colors = 'YlGnBu';<br/>        elif color == 3: <br/>            color_sq = ['#f7f7f7','#d9d9d9','#bdbdbd','#969696','#636363','#252525']; <br/>            colors = 'Greys';<br/>        elif color == 9: <br/>            color_sq = ['#ff0000','#ff0000','#ff0000','#ff0000','#ff0000','#ff0000'];<br/>                        <br/>        else:           <br/>            color_sq = ['#ffffd4','#fee391','#fec44f','#fe9929','#d95f0e','#993404']; <br/>            colors = 'YlOrBr';<br/>        new_data, bins = pd.qcut(data, 6, retbins=True, <br/>        labels=list(range(6)))<br/>        color_ton = []<br/>        for val in new_data:<br/>            color_ton.append(color_sq[val]) <br/>        if color != 9:<br/>            colors = sns.color_palette(colors, n_colors=6)<br/>            sns.palplot(colors, 0.6);<br/>            for i in range(6):<br/>                print ("\n"+str(i+1)+': '+str(int(bins[i]))+<br/>                       " =&gt; "+str(int(bins[i+1])-1))<br/>            print("\n\n   1   2   3   4   5   6")    <br/>        return color_ton, bins;</span></pre><p id="b4fd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">函数 plot_cities()和 plot_map_fill_multiples_ids 应进行调整，以利用这种新的颜色方案:</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="b9f3" class="mn lg iq mj b gy mo mp l mq mr"><strong class="mj ir">def plot_cities_data(sf, title, cities, data=None,color=None, print_id=False):</strong><br/> <br/>    color_ton, bins = calc_color(data, color)<br/>    df = read_shapefile(sf)<br/>    city_id = []<br/>    for i in cities:<br/>        city_id.append(df[df.DIST_NAME == <br/>                            i.upper()].index.get_values()[0])<br/>    plot_map_fill_multiples_ids_tone(sf, title, city_id, <br/>                                     print_id, <br/>                                     color_ton, <br/>                                     bins, <br/>                                     x_lim = None, <br/>                                     y_lim = None, <br/>                                     figsize = (11,9));</span><span id="6810" class="mn lg iq mj b gy mt mp l mq mr"><strong class="mj ir">def plot_map_fill_multiples_ids_tone(sf, title, city,  <br/>                                     print_id, color_ton, <br/>                                     bins, <br/>                                     x_lim = None, <br/>                                     y_lim = None, <br/>                                     figsize = (11,9)):<br/>   <br/>        </strong><br/>    plt.figure(figsize = figsize)<br/>    fig, ax = plt.subplots(figsize = figsize)<br/>    fig.suptitle(title, fontsize=16)<br/>    for shape in sf.shapeRecords():<br/>        x = [i[0] for i in shape.shape.points[:]]<br/>        y = [i[1] for i in shape.shape.points[:]]<br/>        ax.plot(x, y, 'k')<br/>            <br/>    for id in city:<br/>        shape_ex = sf.shape(id)<br/>        x_lon = np.zeros((len(shape_ex.points),1))<br/>        y_lat = np.zeros((len(shape_ex.points),1))<br/>        for ip in range(len(shape_ex.points)):<br/>            x_lon[ip] = shape_ex.points[ip][0]<br/>            y_lat[ip] = shape_ex.points[ip][1]<br/>        ax.fill(x_lon,y_lat, color_ton[city.index(id)])<br/>        if print_id != False:<br/>            x0 = np.mean(x_lon)<br/>            y0 = np.mean(y_lat)<br/>            plt.text(x0, y0, id, fontsize=10)<br/>    if (x_lim != None) &amp; (y_lim != None):     <br/>        plt.xlim(x_lim)<br/>        plt.ylim(y_lim)</span></pre><p id="9e62" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们举一个例子，以热图演示格式绘制数据。</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="0836" class="mn lg iq mj b gy mo mp l mq mr"><em class="ms">names= [‘jaipur’,’bikaner’,’churu’,’bhilwara’,’udaipur’]</em></span><span id="c27c" class="mn lg iq mj b gy mt mp l mq mr"><em class="ms">data = [100, 2000, 300, 400000, 500, 600, 100, 2000, 300, 400, 500, 600, 100, 2000, 300, 400, 500, 600]</em></span><span id="1114" class="mn lg iq mj b gy mt mp l mq mr"><em class="ms">print_id = True # The shape id will be printed</em></span><span id="a201" class="mn lg iq mj b gy mt mp l mq mr"><em class="ms">color_pallete = 1 # ‘Purple’</em></span><span id="de2f" class="mn lg iq mj b gy mt mp l mq mr"><strong class="mj ir"><em class="ms">plot_cities_data(sf, ‘Heat map of given cities’, names, data, color_pallete, print_id)</em></strong></span></pre><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/407888c4685ce5da02e65ebe415b131a.png" data-original-src="https://miro.medium.com/v2/resize:fit:480/format:webp/1*vTD9M0qSNEX1sxgXEC_fdQ.png"/></div></figure><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/6b041f790d6c5178e3de95dfc13dcb01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1372/format:webp/1*1SIZzmzB3sSpJ3tVhSfj1g.png"/></div></figure><p id="2df2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">绘制真实数据</strong></p><p id="4ad8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">绘制拉贾斯坦邦地区的人口图，这里指的是真实数据。</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="6426" class="mn lg iq mj b gy mo mp l mq mr"><em class="ms"># reading data set<br/>census_17 = df.POPULATION</em></span><span id="9317" class="mn lg iq mj b gy mt mp l mq mr"><em class="ms">census_17.shape</em></span><span id="696a" class="mn lg iq mj b gy mt mp l mq mr"><em class="ms">#plotting</em></span><span id="4066" class="mn lg iq mj b gy mt mp l mq mr"><em class="ms">title = ‘Population Distrubution on Rajasthan Region’</em></span><span id="d723" class="mn lg iq mj b gy mt mp l mq mr"><em class="ms">data = census_17</em></span><span id="09ad" class="mn lg iq mj b gy mt mp l mq mr"><em class="ms">names = df.DIST_NAME</em></span><span id="01e9" class="mn lg iq mj b gy mt mp l mq mr"><strong class="mj ir"><em class="ms">plot_cities_data(sf, title, names, data, 1, True)</em></strong></span></pre><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/c386ebc2bf841e7b2e4d3920fb3ad46b.png" data-original-src="https://miro.medium.com/v2/resize:fit:472/format:webp/1*0NufY4bJCfXHdGCmL6kkvA.png"/></div></figure><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/0619c3877937efeeea3531a82b78edf8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1372/format:webp/1*r4Vp6bRzy38pyJFi4UgB-Q.png"/></div></figure><p id="098f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">希望你已经理解了通过 Python 库绘制地图的概念。</p><p id="4a7b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">具体代码可以参考我的<a class="ae kl" href="https://github.com/ashwanidhankhar/Forsk/blob/master/Day4%2C5/geomap.py" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir"><em class="ms">GITHUB</em></strong></a>。</p></div><div class="ab cl ky kz hu la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ij ik il im in"><h1 id="32e6" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">使用 Geopandas 制图</h1><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi no"><img src="../Images/e7af194d1c6d32bfd115f0fcd3ac8208.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2_M4T879tbxzoSlhbXMkdA.png"/></div></div></figure><p id="93cc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们已经看到了用 Pandas 数据帧进行制图的过程，现在轮到用 Geopandas 数据帧对其进行可视化了。Geopandas 简化了 Python 中地理空间数据(包含地理成分的数据)的处理。它结合了熊猫和 shapely 的功能，通过运行一个更紧凑的代码。这是开始制作 choropleth 地图的最好方法之一。</p><p id="6251" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们先通过 Geopandas 绘制一些地图，然后在上面绘制拉贾斯坦邦的人口！</p><p id="b356" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">上一主题中使用的 Shapefile 足以进一步用于 Geopandas。</p><p id="a29a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">安装</strong></p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="67f9" class="mn lg iq mj b gy mo mp l mq mr">conda install geopandas</span></pre><p id="39e7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">第一步是导入所需的库</strong></p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="6c84" class="mn lg iq mj b gy mo mp l mq mr">import pandas as pd<br/>import matplotlib.pyplot as plt<br/>import geopandas as gpd</span></pre><p id="ce6c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">获取感兴趣的数据</strong></p><p id="58b6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">作为印度最大的邦，拉贾斯坦邦是一个人口高度密集的邦。绘制人口地图将使可视化更加简单和高效。让我们设置路径，通过 Geopandas 打开 Rajasthan 地区的 shapefile。</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="987a" class="mn lg iq mj b gy mo mp l mq mr"># set the filepath and load<br/>fp = “\\District_Boundary.shp”</span><span id="8cc5" class="mn lg iq mj b gy mt mp l mq mr">#reading the file stored in variable fp<br/>map_df = gpd.read_file(fp)</span><span id="8f4a" class="mn lg iq mj b gy mt mp l mq mr"># check data type so we can see that this is not a normal dataframe, but a GEOdataframe</span><span id="593b" class="mn lg iq mj b gy mt mp l mq mr"><strong class="mj ir">map_df.head()</strong></span></pre><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/b8f417ca7c4bce45f3757736f718f60c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*m9RGwkeF-ELtbAKC18cmjA.png"/></div></figure><p id="3b4c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们预览一下地图</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="466d" class="mn lg iq mj b gy mo mp l mq mr">#plotting the map of the shape file preview of the maps without data in it<br/><strong class="mj ir">map_df.plot()</strong></span></pre><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi np"><img src="../Images/2507720b581bc500a60717aa6ee14759.png" data-original-src="https://miro.medium.com/v2/resize:fit:884/format:webp/1*jnIIqB0Knx8DEI6sPaSfqw.png"/></div></figure><p id="b6c7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在是时候打开包含要绘制的数据的 CSV 文件了。在这里，我们也可以为所需的数据制作一个 csv，但我只从 shapefile 中提取数据，而不是制作 csv 或在 web 上搜索，这样可以节省大量时间。</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="6117" class="mn lg iq mj b gy mo mp l mq mr">#opening the csv(.shp) file which contains the data to be plotted on the map<br/>df = gpd.read_file(\\District_Boundary.shp”)</span><span id="7b62" class="mn lg iq mj b gy mt mp l mq mr">df.head()</span><span id="60e9" class="mn lg iq mj b gy mt mp l mq mr">#selecting the columns required<br/>df = df[[‘DIST_NAME’,’POPULATION’]]</span><span id="9959" class="mn lg iq mj b gy mt mp l mq mr">#renaming the column name<br/>data_for_map = df.rename(index=str, columns={‘DIST_NAME’: ‘DISTRICT’,‘POPULATION’: ‘POP’})</span></pre><p id="8f5b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们预览一下地理数据框架</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="5031" class="mn lg iq mj b gy mo mp l mq mr"># check dat dataframe<br/><strong class="mj ir">data_for_map.head()</strong></span></pre><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/7eb5ca772a985cdf35a890d0ecb7724a.png" data-original-src="https://miro.medium.com/v2/resize:fit:322/format:webp/1*NkC78S2FoxPEnGJP85lsBg.png"/></div></figure><p id="e7dc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，让我们将地理数据与数据集连接起来</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="c736" class="mn lg iq mj b gy mo mp l mq mr"># joining the geodataframe with the cleaned up csv dataframe<br/>merged = map_df.set_index(‘DIST_NAME’).join(data_for_map.set_index(‘DISTRICT’))</span><span id="7dd8" class="mn lg iq mj b gy mt mp l mq mr">#.head() returns the top 5(by default ) lines of the dataframe<br/><strong class="mj ir">merged.head()</strong></span></pre><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/3621e4e0eb2f90afc08423a82277caf2.png" data-original-src="https://miro.medium.com/v2/resize:fit:544/format:webp/1*o4X92xu8RWVwi3EvN3tJaQ.png"/></div><figcaption class="mv mw gj gh gi mx my bd b be z dk">Output after merging datasets</figcaption></figure><p id="e89c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">映射时间</strong></p><p id="fcf1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，我们需要为 Matplotlib 绘制地图做一些预先要求的工作，如设置变量、范围和为地图创建基本图形。</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="733e" class="mn lg iq mj b gy mo mp l mq mr"># set a variable that will call whatever column we want to visualise on the map<br/>variable = ‘POP’</span><span id="3b9e" class="mn lg iq mj b gy mt mp l mq mr"># set the range for the choropleth<br/>vmin, vmax = 120, 220</span><span id="e3f7" class="mn lg iq mj b gy mt mp l mq mr"># create figure and axes for Matplotlib<br/>fig, ax = plt.subplots(1, figsize=(10, 6))</span></pre><p id="df07" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">创建地图的时间</strong></p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="8fc9" class="mn lg iq mj b gy mo mp l mq mr">merged.plot(column=variable, cmap=’BuGn’, linewidth=0.8, ax=ax, edgecolor=’0.8')</span></pre><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/7aac01339b9f0333020c439ae8e91834.png" data-original-src="https://miro.medium.com/v2/resize:fit:866/format:webp/1*nJ66RnlLw_03LKzVfW64Fw.png"/></div></figure><p id="1e02" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这就是我们想要的，地图已经准备好了！但是需要一些美化和定制。</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="9c10" class="mn lg iq mj b gy mo mp l mq mr"># remove the axis<br/>ax.axis(‘off’)</span><span id="1629" class="mn lg iq mj b gy mt mp l mq mr"># add a title<br/>ax.set_title(‘Population of Rajasthan’, fontdict={‘fontsize’: ‘25’, ‘fontweight’ : ‘3’})</span><span id="e54a" class="mn lg iq mj b gy mt mp l mq mr"># create an annotation for the data source<br/>ax.annotate(‘Source: Rajasthan Datastore, 2019’,xy=(0.1, .08), xycoords=’figure fraction’, horizontalalignment=’left’, verticalalignment=’top’, fontsize=12, color=’#555555')</span></pre><p id="c8e3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">颜色条是地图中必不可少的东西，它告诉我们要寻找的参数，让我们为我们的地图定制它。</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="5b27" class="mn lg iq mj b gy mo mp l mq mr"># Create colorbar as a legend<br/>sm = plt.cm.ScalarMappable(cmap=’BuGn’, norm=plt.Normalize(vmin=vmin, vmax=vmax))</span><span id="22a3" class="mn lg iq mj b gy mt mp l mq mr"># empty array for the data range<br/>sm._A = []</span><span id="2571" class="mn lg iq mj b gy mt mp l mq mr"># add the colorbar to the figure<br/>cbar = fig.colorbar(sm)</span><span id="139b" class="mn lg iq mj b gy mt mp l mq mr">#saving our map as .png file.<br/>fig.savefig(‘map_export.png’, dpi=300)</span></pre><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/db4ae04461daf7fbbc52f71078fb3c9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1102/format:webp/1*DLWiTE8_I31Fg8GhysDkWQ.png"/></div></figure><p id="148c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您可能已经知道为什么使用 Geopandas 进行制图更好了。它有一个非常紧凑和简单的代码，并给出了一个很好的期望输出。通过这种方法，我们可以绘制任何地区的任何类型的数据。</p><p id="8693" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">关于 th <strong class="jp ir"> e </strong>的确切代码，请参考我的<a class="ae kl" href="https://github.com/ashwanidhankhar/Forsk/blob/master/DAY%209%20Rajasthan/map_geopandas_rajasthan.py" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> <em class="ms"> GITHUB </em> </strong> </a>。</p></div><div class="ab cl ky kz hu la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ij ik il im in"><h1 id="7bdb" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">使用底图制图</h1><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/b88455a57fb0b2db96b061c564fc2475.png" data-original-src="https://miro.medium.com/v2/resize:fit:920/format:webp/1*qnU4cxbEKMu-xRazHHs8tA.png"/></div></figure><p id="7630" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Matplotlib 底图工具包是一个用于在 Python 中的地图上绘制 2D 数据的库。底图本身不进行任何绘图，但提供了将坐标转换为 25 种不同地图投影之一的工具。 <a class="ae kl" href="http://matplotlib.sourceforge.net/" rel="noopener ugc nofollow" target="_blank"> Matplotlib </a>用于在转换后的坐标中绘制轮廓、图像、矢量、线或点。提供了海岸线、河流和政治边界数据集，以及绘制它们的方法。</p><p id="9284" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本节中，您将了解如何通过底图工具包在地图上绘制数据。</p><p id="48fe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们通过底图工具包来查看地图可视化。</p><p id="a76b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">安装</strong></p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="049e" class="mn lg iq mj b gy mo mp l mq mr">conda install basemap<br/>conda install basemap-data-hires</span></pre><p id="f000" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">导入库</strong></p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="71dc" class="mn lg iq mj b gy mo mp l mq mr">import numpy as np<br/>import matplotlib.pyplot as plt<br/>from mpl_toolkits.basemap import Basemap<br/>import geopandas as gpd<br/>import pandas as pd</span></pre><blockquote class="nb nc nd"><p id="360e" class="jn jo ms jp b jq jr js jt ju jv jw jx ne jz ka kb nf kd ke kf ng kh ki kj kk ij bi translated">注意:如果在导入底图库时遇到任何困难或错误(PROJ_LIB ),您可以直接设置其路径，以便在导入底图之前导入并运行它。</p></blockquote><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="a4b4" class="mn lg iq mj b gy mo mp l mq mr">#to import the basemap library give the direct path to the library</span><span id="487f" class="mn lg iq mj b gy mt mp l mq mr">import os<br/>os.environ["PROJ_LIB"]="C:\\Users\\Anaconda3\\Library\\share"</span></pre><p id="88f8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们从 csv 和 shapefile 中获取感兴趣的数据。以下是下载所需 csv 文件的链接<a class="ae kl" href="https://github.com/ashwanidhankhar/Forsk/blob/master/Day10%20Rajasthan/latlong_raj.csv" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">点击此处</strong> </a> <strong class="jp ir"> </strong>和所需 shapefile】点击此处 </p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="972d" class="mn lg iq mj b gy mo mp l mq mr">city=gpd.read_file("F:\\District_Boundary.shp")<br/>csv=pd.read_csv("\\latlong_raj.csv")</span></pre><p id="d45f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们从加载数据开始。Lat-long 是从一个单独的 csv 中导入的，其他数据如地区名称及其人口来自。在前面部分下载的 shp 文件。</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="1472" class="mn lg iq mj b gy mo mp l mq mr">lat=csv['LAT'].values<br/>lon=csv['LONG'].values<br/>population = city['POPULATION'].values<br/>dist=city['DIST_NAME'].values</span></pre><blockquote class="nb nc nd"><p id="bd97" class="jn jo ms jp b jq jr js jt ju jv jw jx ne jz ka kb nf kd ke kf ng kh ki kj kk ij bi translated">这些数据已经被保存为一个 numpy 数组，你可以通过[ <em class="iq"> type(lat)] </em>来检查它。</p></blockquote><p id="ed35" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">接下来，我们设置地图投影，散布数据，然后创建一个颜色栏</strong></p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="7dee" class="mn lg iq mj b gy mo mp l mq mr">fig = plt.figure(figsize=(8, 8))<br/>m = Basemap(projection='lcc', resolution='h', <br/>            lat_0=27.0238, lon_0=74.2179,<br/>            width=1.05E6, height=1.2E6)<br/>m.shadedrelief()</span></pre><p id="277e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们的地图背景现在已经准备好了，可以在上面绘制数据。印度拉贾斯坦邦的 lat-long 已经用“lcc”投影设置了一定的缩放量，以便只聚焦特定的状态。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/179d5613d6bbf5925397d28695bed85d.png" data-original-src="https://miro.medium.com/v2/resize:fit:384/format:webp/1*E8mHICN3ELvYbhoAf5xvgg.png"/></div></figure><p id="4628" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们来给它添加一些细节，划分一下界限。</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="a353" class="mn lg iq mj b gy mo mp l mq mr">m.drawcoastlines(color='blue',linewidth=3)<br/>m.drawcountries(color='gray',linewidth=3)<br/>m.drawstates(color='gray')</span></pre><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/59565540c8cee1e59f1cafc7cf43996d.png" data-original-src="https://miro.medium.com/v2/resize:fit:762/format:webp/1*DteXfCsyX1PGIvz7EddFxQ.png"/></div></figure><p id="c002" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在是时候在地图投影上散布数据并设置颜色条了。</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="7030" class="mn lg iq mj b gy mo mp l mq mr"># scatter city data, with c reflecting population<br/>m.scatter(lon,lat, latlon=True,<br/>          c=population,s=700,<br/>          cmap='YlGnBu_r', alpha=0.5)</span><span id="09fd" class="mn lg iq mj b gy mt mp l mq mr">#create colorbar <br/>plt.colorbar(label=r'Population')<br/>plt.clim(300000, 4000000)</span></pre><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/694c2d7e8be1652a6c99bcc5de1a2908.png" data-original-src="https://miro.medium.com/v2/resize:fit:948/format:webp/1*8zV6yLpyloqDFp9-wCS5bg.png"/></div></figure><p id="7b88" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">看起来是不是少了点什么？是啊！当然，区名。我们无法通过这种投影来识别地区。</p><p id="91a6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">让我们把它们画出来。</strong></p><blockquote class="nb nc nd"><p id="b311" class="jn jo ms jp b jq jr js jt ju jv jw jx ne jz ka kb nf kd ke kf ng kh ki kj kk ij bi translated">我们在上面的变量中存储了地区名称及其经度，但是我们将数据存储为 numpy 数组，所以我们需要将它们存储在列表或字典中。</p></blockquote><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="1048" class="mn lg iq mj b gy mo mp l mq mr">dict1={}<br/>list1=[]<br/>list2=[]<br/>list3=[]<br/>n=0</span><span id="0a09" class="mn lg iq mj b gy mt mp l mq mr">#storing each value in different lists<br/>for z in lat:<br/>    list1.append(z)<br/>for c in lon:<br/>    list2.append(c)<br/>for b in dist:<br/>    list3.append(b)</span><span id="1157" class="mn lg iq mj b gy mt mp l mq mr">#storing the values of lat long in a dictionary with lat as keys and long as values    <br/>while(n&lt;len(list1)):<br/>    dict1[list1[n]]=list2[n]<br/>    n+=1</span></pre><p id="6cd2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，lat-long 已被存储到字典(dict1)和区名列表(list3)中。让我们用它们来命名区域。</p><pre class="kn ko kp kq gt mi mj mk ml aw mm bi"><span id="5a92" class="mn lg iq mj b gy mo mp l mq mr">i=0</span><span id="ab40" class="mn lg iq mj b gy mt mp l mq mr"># Map (long, lat) to (x, y) for plotting<br/>#naming the cities of Rajasthan with the help of their lat(z)long(c)</span><span id="76f5" class="mn lg iq mj b gy mt mp l mq mr">for z,c in dict1.items():<br/>    x,y = m(c, z)<br/>    plt.plot(x, y, 'ok', markersize=5)<br/>    plt.text(x, y,list3[i], fontsize=10);<br/>    i+=1</span></pre><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/31623e473e8fe4685ba8063c518d47fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:948/format:webp/1*dD2PkKimBk3opsm5yvqDKA.png"/></div></figure><p id="9c21" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">参考我的<a class="ae kl" href="https://github.com/ashwanidhankhar/Forsk/blob/master/Day10%20Rajasthan/basemap_rajasthan.py" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir"><em class="ms">GITHUB</em></strong></a>获取 th <strong class="jp ir"> e </strong>确切代码。</p><p id="df77" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这就是了。感谢您的阅读。</p><p id="dcc4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有关 Geopandas、Basemap 的更多信息，或者您想了解 Python、ML、DL、AI、IoT 等行业趋势技术，请联系 Forsk Technologies。</p></div></div>    
</body>
</html>