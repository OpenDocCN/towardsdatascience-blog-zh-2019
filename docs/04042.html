<html>
<head>
<title>Political Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">政治巨蟒</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/political-python-1e8eb46c1bc1?source=collection_archive---------14-----------------------#2019-06-25">https://towardsdatascience.com/political-python-1e8eb46c1bc1?source=collection_archive---------14-----------------------#2019-06-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="2645" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">用 Scrapy 刮国会文件</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/95cd31eb7a7b0e182f9e947eb2eb3d8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dvJqoS_bGrOZzJbQqWWpxw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">No, not that kind of python.</figcaption></figure><p id="c3b0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">2020 年民主党总统候选人将在周三开始的辩论中交锋。他们中的许多人是现任或前任国会议员。他们都在竞争领导这个国家。</p><p id="1f70" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">作为选民，如果我们有他们在政治生涯中在参议院或众议院所说的每一句话的记录，那不是很棒吗？</p><p id="b3fa" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">作为数据科学家，难道我们不想提取他们的话，分析他们，并用他们来判断或预测这些国会议员作为总统候选人吗？</p><h1 id="1433" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">用 Scrapy 造一只蜘蛛</h1><p id="af5f" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">是的，我们可以。宪法要求国会记录其议事过程。因此，政府出版办公室印刷(并以数字形式发布)国会记录，其中包含立法机构两院的日常正式会议记录，包括:</p><ul class=""><li id="693a" class="ms mt it la b lb lc le lf lh mu ll mv lp mw lt mx my mz na bi translated">住房部分</li><li id="1943" class="ms mt it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">参议院部分</li><li id="0c77" class="ms mt it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">评论的延伸(演讲、颂词、证词和立法史)</li><li id="99be" class="ms mt it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">每日文摘</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/76f0e985a1da2ec8aafcb92caef1f464.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*97hwEWxu21VIlbtr3KDvMg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Congressional Record, November 17, 2008.</figcaption></figure><p id="af1e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">尽管这些数据存在于公共领域，但将它们从网站上取出并转换成可用的格式却是一个挑战。在无法访问昂贵的法律数据库的情况下，网络搜集是有事业心的公众的最佳选择，Scrapy 使得快速获得大量信息变得相对容易。</p><h1 id="093a" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">蜘蛛去了华盛顿</h1><p id="3510" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">Scrapy 允许使用 python 进行异步 web 抓取。您可以使用它通过 API 提取数据，将它与 BeautifulSoup 和 Selenium 集成，并像蜘蛛网有细丝一样扩展它的功能。</p><p id="aad9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Scrapy 的核心想法是复制<a class="ae lu" href="https://www.djangoproject.com/" rel="noopener ugc nofollow" target="_blank"> Django </a>一个“不要重复自己”的框架，这意味着它提供了一种重用代码和轻松将项目扩大到更大范围的方法。爬行器的组成部分，如项目、中间件、管道和设置，存在于单独的脚本中，爬行不同网站的多个“蜘蛛”可以在同一个“项目”中使用它们。</p><p id="777e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">蜘蛛本身自然依赖于面向对象的编程(每个都属于“蜘蛛”类):</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/4ce00992229425c8cebe818e75ba81a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gRaj43PgAi4VS2Kik-ZXRw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">A Scrapy spider.</figcaption></figure><p id="e4ed" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">重要组件包括:</p><ul class=""><li id="c161" class="ms mt it la b lb lc le lf lh mu ll mv lp mw lt mx my mz na bi translated">开始 URL</li><li id="2793" class="ms mt it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">你从回答中提取了什么，如何提取</li><li id="bc35" class="ms mt it la b lb nb le nc lh nd ll ne lp nf lt mx my mz na bi translated">返回给解析函数的内容</li></ul><h1 id="b562" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">在 Python 中使用 XPath</h1><p id="c292" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">Scrapy 最有用的功能之一是 Scrapy shell，它允许你实时探索你正在抓取的网站，以测试你的假设。本质上，在部署代码之前，您可以在沙盒模式下尝试您的代码(并发现它不起作用)。</p><p id="0e17" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">当您在处理像 XPath 这样复杂的东西时，这个附加功能极大地减少了深入网站结构提取所需内容的时间和挫折感。例如，我需要从 Congress.gov 网站的 HTML 中的特定元素获取部分 URL 和文本。Scrapy shell 允许我在将结果语法复制并粘贴到代码中之前，确保我的 XPath 语法不会返回空列表。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/e838ee6a2b1c466be9e5d490e005680d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rjfIMS0J8qiNQXkJyU1w-Q.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk"><em class="nj">Is it worth auto-generating XPath?</em></figcaption></figure><p id="5535" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">关于从 DevTools 中“复制 XPath”的说明:</strong>虽然您可能觉得在 DevTools 中右键单击 HTML 元素并从出现的菜单中选择“复制 XPath”很吸引人，但是不要屈服于诱惑。如果像国会一样，你的网站是用表格组织的，你将无法检索到你想要的一切。就我而言，我想要的 pdf 文件位于页面的最右边一栏:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nk"><img src="../Images/767d0f547b283cdd7495834cb2e4fb5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4TLcRSG_8pWQB84LET2iWA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Congress.gov website</figcaption></figure><p id="69d4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">单击“复制 XPath”会显示以下信息:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="5531" class="nq lw it nm b gy nr ns l nt nu">//*[@id="browse_expanded_panel_1"]/div/table/tbody/tr[1]/td[6]/a</span></pre><p id="84e5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="nv">这只是描述一个表内的位置。</em></p><p id="df3f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">下面是 shell 中返回的内容:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/b1eb2648b1ddd0746fbae60f6faa35c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rQgrSztu7mx_L94Gfj4U3w.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk"><em class="nj">An empty list</em></figcaption></figure><p id="7128" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">下面是我的<em class="nv">实际的</em> XPath 表达式:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="c928" class="nq lw it nm b gy nr ns l nt nu">response.xpath('//td/a[@target="_blank"]/@href').extract()</span></pre><p id="96f3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这是它返回给定页面的内容:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/cf3de9259023a84ed9dd78cf29d11a00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7-TYbXbuc-vbpTOG4yhQFQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk"><em class="nj">PDFs that exist</em></figcaption></figure><p id="fc4c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您必须<a class="ae lu" href="https://www.guru99.com/xpath-selenium.html" rel="noopener ugc nofollow" target="_blank">学会使用 XPath </a>来选择<em class="nv">有意义的</em>内容，而不是依赖于自动生成的表达式，后者——很像正在讨论的政府机构——通常表功能有利于形式。</p><h1 id="c5c7" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">使用 Tika 提取文本</h1><p id="8c11" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">一旦我写了这个蜘蛛，它很快就把 25 年的国会记录下载到了我的硬盘上。后来没有太多额外的代码，我已经用处理 pdf 的 python 库<a class="ae lu" href="https://github.com/chrismattmann/tika-python" rel="noopener ugc nofollow" target="_blank"> Tika </a>提取了文本。</p><p id="0dc3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我创建了一个正则表达式来拆分个人发言:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/f806e9e9e99e7d7f25be8bcb9a44bf7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OSYwFMl2Dy9bNrF0l72hAQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk"><em class="nj">Preliminary NLP pre-processing</em></figcaption></figure><p id="040a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">尝试了一些非常初步的情感分析:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/457a365a3f9384960dd629df2a8ee94c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K7cfOe7hv6NAA_waO8YG7g.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk"><em class="nj">Preliminary NLP with VADER</em></figcaption></figure><h1 id="8126" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">议长先生，交出你的秘密</h1><p id="c6bb" class="pw-post-body-paragraph ky kz it la b lb mn ju ld le mo jx lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">既然他们的话已经暴露无遗，国会下一步该怎么办？分析与数据挖掘，自然(语言处理)ly。尽管人们对 Twitter 争论不休，但几乎没有人对参议员和众议员在国会发言时所说的话提出质疑，无论是因为获取数据的难度、训练模型的难度、缺乏法律素养，还是上述所有原因。但借助适当的工具和领域知识，我希望在 2020 年选举季之前提供一些有价值的见解。</p></div><div class="ab cl oa ob hx oc" role="separator"><span class="od bw bk oe of og"/><span class="od bw bk oe of og"/><span class="od bw bk oe of"/></div><div class="im in io ip iq"><p id="4335" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="nv">原载于</em><a class="ae lu" href="https://www.espritdecorpus.com/posts/political-python-scrapy/" rel="noopener ugc nofollow" target="_blank"><em class="nv">https://www.espritdecorpus.com</em></a><em class="nv">。</em></p></div></div>    
</body>
</html>