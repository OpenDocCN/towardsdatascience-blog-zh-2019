<html>
<head>
<title>Puppies &amp; Python: Analyzing Geospatial Data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">小狗和 Python:分析地理空间数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/puppies-python-analyzing-geospatial-data-93dd9dc3137?source=collection_archive---------17-----------------------#2019-12-08">https://towardsdatascience.com/puppies-python-analyzing-geospatial-data-93dd9dc3137?source=collection_archive---------17-----------------------#2019-12-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0bdb" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">通过使用 Geopandas、Shapely、Pyplot 和 Folium 组合多个形状文件和数据源来可视化西雅图宠物密度</h2></div><p id="e14b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">所以你对有地理空间成分的数据感兴趣？酷！我也是！</p><p id="27d5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当我开始我的第一个植根于地理空间数据的项目时，我并没有意识到我所面临的挑战的程度——并没有超出我的能力范围，但对于我当时的情况来说，这绝对是一个难题。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi le"><img src="../Images/8ac55ded6ec3a8a2c2afc2b6fb7894bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:582/format:webp/1*0suDlFWP-NyCuaLpzE3WXA.jpeg"/></div><figcaption class="lm ln gj gh gi lo lp bd b be z dk">photo credit: Chris Martin on <a class="ae lq" href="https://www.flickr.com/photos/14798455@N06/7808358384" rel="noopener ugc nofollow" target="_blank">Flickr</a></figcaption></figure><p id="ed1d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我快速的谷歌搜索让我，或许还有你，直接找到了<code class="fe lr ls lt lu b"><a class="ae lq" href="http://geopandas.org/" rel="noopener ugc nofollow" target="_blank">geopandas</a></code>。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi lv"><img src="../Images/75c4aa26e834b22d44bf4828e5d50cf9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TBjwbZvcOoalgHVy2enoVQ.png"/></div></div><figcaption class="lm ln gj gh gi lo lp bd b be z dk">This plus another 600+ lines of package conflicts… including NumPy.</figcaption></figure><p id="7c54" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我最初与<code class="fe lr ls lt lu b">geopandas</code>安装有很多包冲突，包括<code class="fe lr ls lt lu b">numpy</code>和我项目环境中的几乎所有东西。然后我按照他们的指示在<code class="fe lr ls lt lu b">conda-forge</code>频道的新环境中安装了<code class="fe lr ls lt lu b">geopandas</code>。非常管用！</p><p id="bd55" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在您的新环境中，您还需要<code class="fe lr ls lt lu b">conda install descartes</code>和<code class="fe lr ls lt lu b">matplotlib</code>来获得全部功能。</p></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><p id="312d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在今天的例子中，我正在为我的下一步行动做一些研究:在西雅图哪里可以找到密度最高的宠物？当我在未来的社区里散步、蹦蹦跳跳、做瑜伽时，我想向所有的宠物抛媚眼。为此，我从西雅图市的公开数据中下载了关于<a class="ae lq" href="https://data.seattle.gov/Community/Seattle-Pet-Licenses/jguv-t9rb" rel="noopener ugc nofollow" target="_blank">宠物执照</a>的文件和关于<a class="ae lq" href="http://data-seattlecitygis.opendata.arcgis.com/datasets/83fc2e72903343aabff6de8cb445b81c_2" rel="noopener ugc nofollow" target="_blank">邮政编码</a>、市政<a class="ae lq" href="http://data-seattlecitygis.opendata.arcgis.com/datasets/municipal-boundaries" rel="noopener ugc nofollow" target="_blank">边界</a>和<a class="ae lq" href="http://data-seattlecitygis.opendata.arcgis.com/datasets/city-of-seattle-shoreline" rel="noopener ugc nofollow" target="_blank">海岸线</a>的形状数据(这样我们就可以看到我们所了解和喜爱的西雅图的轮廓)。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/2b31d1360e40a36346c5389e32e2d3e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/1*JzwQPHg6vNqAvQaBlUNGxg.jpeg"/></div><figcaption class="lm ln gj gh gi lo lp bd b be z dk">Photo Credit: Joshua T. Beck [CC BY-SA 4.0] on <a class="ae lq" href="https://commons.wikimedia.org/wiki/File:Photo_Feb_01,_9_31_50_AM.jpg" rel="noopener ugc nofollow" target="_blank">wikimedia commons</a></figcaption></figure><h2 id="7f38" class="mi mj it bd mk ml mm dn mn mo mp dp mq kr mr ms mt kv mu mv mw kz mx my mz na bi translated">要点 1:shape file 不仅仅是一个文件</h2><p id="2671" class="pw-post-body-paragraph ki kj it kk b kl nb ju kn ko nc jx kq kr nd kt ku kv ne kx ky kz nf lb lc ld im bi translated">当我下载并解压缩我的第一个 shapefile 时，我只将<code class="fe lr ls lt lu b">.shp</code>文件移到我的目录中，心想，“也许这些其他文件可以在不同的程序中工作。”但是没有。</p><p id="28c8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">即使你用来读取形状文件的任何包可能只需要一个<code class="fe lr ls lt lu b">.shp</code>文件路径，它们需要整个文件集在同一个目录下才能工作:</p><ul class=""><li id="9db9" class="ng nh it kk b kl km ko kp kr ni kv nj kz nk ld nl nm nn no bi translated"><code class="fe lr ls lt lu b">.shp</code> —实际形状文件—这是你的形状的几何图形</li><li id="808f" class="ng nh it kk b kl np ko nq kr nr kv ns kz nt ld nl nm nn no bi translated"><code class="fe lr ls lt lu b">.shx</code> —形状索引<strong class="kk iu"> x </strong>格式—帮助快速浏览形状</li><li id="68c2" class="ng nh it kk b kl np ko nq kr nr kv ns kz nt ld nl nm nn no bi translated"><code class="fe lr ls lt lu b">.dbf</code> —这是关于形状的其他信息(同样，这是必需的，即使您不需要它。关于每个形状的参考信息(如名称)通常很有帮助。)</li></ul><p id="9f48" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">有时也有其他文件。查看这篇<a class="ae lq" href="https://en.wikipedia.org/wiki/Shapefile" rel="noopener ugc nofollow" target="_blank">文章</a>了解更多信息。现在，我不用太担心我想要或需要哪个，我只需要将它解压到我的目标目录中。然后你就知道你的数据源提供了什么好东西。</p><p id="aeff" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">还要注意:所有文件必须有相同的文件名，唯一的区别是扩展名/后缀。所以如果你喜欢改文件名去掉空格，大写字母等(只是恢复完美主义的事情？)，确保您更改了软件包中所有文件的名称，并注意拼写错误。</p><blockquote class="nu nv nw"><p id="1db5" class="ki kj nx kk b kl km ju kn ko kp jx kq ny ks kt ku nz kw kx ky oa la lb lc ld im bi translated">当你考虑一个 shapefile 的时候，总是要加上那个尾随的 s——shape file<strong class="kk iu">s</strong>。</p></blockquote><p id="286f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在搜索最大 pet 密度时，只需几行代码就可以让我开始使用地理数据框中的形状:</p><pre class="lf lg lh li gt ob lu oc od aw oe bi"><span id="b612" class="mi mj it lu b gy of og l oh oi">import geopandas as gpd</span><span id="7bf8" class="mi mj it lu b gy oj og l oh oi"># load zip code shape data<br/>zip_codes_gdf = gpd.read_file('data/shapes/Zip_Codes.shp')</span><span id="9469" class="mi mj it lu b gy oj og l oh oi"># load seattle shape<br/>cities = gpd.read_file('data/shapes/Municipal_Boundaries.shp')<br/>seattle = cities.loc[cities['CITYNAME'] == 'Seattle']<br/>seattle = seattle.reset_index()<br/>seattle_shp = seattle.loc[0, 'geometry']</span><span id="8052" class="mi mj it lu b gy oj og l oh oi"># load seattle waterfront shape<br/>waterfront = gpd.read_file('data/shapes/<br/>                            City_of_Seattle_Shoreline.shp')</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/66e8f7d32223eb40b32d15c4c6763cbb.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*rjyALajKryTVkY13OOqrwQ.png"/></div></figure><p id="9170" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">注意这里的<code class="fe lr ls lt lu b">seattle_shp</code>是一个<code class="fe lr ls lt lu b">shapely Polygon</code>，在 Jupyter 笔记本中调用它会显示该形状的图像。或者，<code class="fe lr ls lt lu b">waterfront</code>是一个地理数据框架，因此您可以用<code class="fe lr ls lt lu b">waterfront.plot()</code>来可视化它。跟踪对象类型将为您省去麻烦和时间！或者至少是当事情不像你期望的那样工作时的一个好的开始。</p></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><p id="52a1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">首先，我注意到西雅图开放数据上的邮政编码文件实际上有华盛顿几个县的邮政编码的形状文件。我需要把邮编范围缩小到西雅图。我很快意识到西雅图地区的邮政编码边界与城市边界不一致。</p><p id="24bc" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这里是<code class="fe lr ls lt lu b">geopandas</code>对所有其他包的包装，包括<code class="fe lr ls lt lu b">shapely</code>，派上用场的地方(即使它使安装变得很困难)。</p><h2 id="a7b4" class="mi mj it bd mk ml mm dn mn mo mp dp mq kr mr ms mt kv mu mv mw kz mx my mz na bi translated">拿走#2: Shapely 是你的朋友</h2><p id="0f42" class="pw-post-body-paragraph ki kj it kk b kl nb ju kn ko nc jx kq kr nd kt ku kv ne kx ky kz nf lb lc ld im bi translated">为了组合来自不同来源的数据并准确获得您想要的数据，我发现 shapely 函数非常有用。方便的是，它们在<code class="fe lr ls lt lu b">GeoDataFrames</code>上工作得很好，在每行上用一行代码进行计算(只需调用<code class="fe lr ls lt lu b">geo_df.<strong class="kk iu">shapely_function</strong>()</code>)。一些<code class="fe lr ls lt lu b"><a class="ae lq" href="https://shapely.readthedocs.io/en/stable/manual.html" rel="noopener ugc nofollow" target="_blank">shapely</a></code>功能在<code class="fe lr ls lt lu b"><a class="ae lq" href="http://geopandas.org/" rel="noopener ugc nofollow" target="_blank">geopandas</a></code>文档中有描述，但是<code class="fe lr ls lt lu b">geopandas</code>没有包括所有 shapely 功能的文档。当 shapely docs 中描述的额外功能，而不是<code class="fe lr ls lt lu b">geopandas</code>中描述的功能工作良好时，我感到惊喜，尤其是<code class="fe lr ls lt lu b">intersection</code>！</p><p id="c49d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">在:</strong></p><p id="accb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe lr ls lt lu b">object.<strong class="kk iu">within</strong>(<em class="nx">other)</em></code> —如果对象的边界和内部仅与另一个对象的内部相交(而不是其边界或外部)，则返回<code class="fe lr ls lt lu b">True</code>。这适用于所有类型，与<code class="fe lr ls lt lu b"><a class="ae lq" href="https://shapely.readthedocs.io/en/stable/manual.html#object.contains" rel="noopener ugc nofollow" target="_blank"><strong class="kk iu">contains()</strong></a></code>相反。<a class="ae lq" href="#55a1" rel="noopener ugc nofollow"> * </a></p><p id="d6a5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">所以我试了一下。这里，<code class="fe lr ls lt lu b">zip_codes_gdf.within(seattle_shp)</code>返回一系列的<code class="fe lr ls lt lu b">True</code>和<code class="fe lr ls lt lu b">False</code>，每个记录对应于<code class="fe lr ls lt lu b">GeoDataFrame</code>中的一条记录。这个系列与<code class="fe lr ls lt lu b">.loc</code>一起使用，创建一个新的<code class="fe lr ls lt lu b">GeoDataFrame</code>，只包含全部在西雅图的记录(邮政编码及其形状)。</p><pre class="lf lg lh li gt ob lu oc od aw oe bi"><span id="a463" class="mi mj it lu b gy of og l oh oi">seattle_zips_within = zip_codes_gdf.loc[zip_codes_gdf.within(seattle_shp)]</span></pre><p id="168f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来，我绘制了我的结果，以及西雅图的轮廓和滨水区。</p><pre class="lf lg lh li gt ob lu oc od aw oe bi"><span id="4a8a" class="mi mj it lu b gy of og l oh oi">fig, ax = plt.subplots(figsize=(10,10))<br/>seattle.plot(ax=ax, color='white', edgecolor='black', linewidth=2)<br/>waterfront.plot(ax=ax, color='blue')<br/>seattle_zips_within.plot(ax=ax, cmap='Paired', alpha=.8)</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi ol"><img src="../Images/4f1e9e509dacc74e55cd028b3732d1b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EK80sLiw45KBg1am1S4F5g.png"/></div></div></figure><p id="c869" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">使用<code class="fe lr ls lt lu b">within()</code>函数，进入西雅图以外其他城市的邮政编码被排除在这个选择过程之外。如果邮政编码与城市边界一致，这个功能会很棒。不幸的是，事实并非如此，所以我继续寻找更好的邮政编码选择功能。</p><p id="e83b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">相交</strong></p><p id="0bba" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe lr ls lt lu b">object.<strong class="kk iu">intersects</strong>(<em class="nx">other</em>)</code> —如果对象的边界或内部以任何方式与其他对象相交，则返回<code class="fe lr ls lt lu b">True</code>。换句话说，如果几何对象有共同的边界或内点，则它们相交。<a class="ae lq" href="#55a1" rel="noopener ugc nofollow"> * </a></p><pre class="lf lg lh li gt ob lu oc od aw oe bi"><span id="85be" class="mi mj it lu b gy of og l oh oi">seattle_zips_intersects = zip_codes_gdf.loc[zip_codes_gdf.intersects(seattle_shp)]</span><span id="f02c" class="mi mj it lu b gy oj og l oh oi">fig, ax = plt.subplots(figsize=(10,10))<br/>waterfront.plot(ax=ax, color='blue')<br/>seattle_zips_intersects.plot(ax=ax, cmap='Paired', alpha=.8)<br/>seattle.plot(ax=ax, color='#00000000', edgecolor='black', <br/>linewidth=2)</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi ol"><img src="../Images/f00ef904a5057d83032c8f26387723ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pJAxjnHVDhLduNvlKEeb1w.png"/></div></div></figure><p id="38f2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在我们走上了正轨，整个西雅图都被代表了。现在我想把城市范围之外所有区域都去掉。如果我使用西雅图市范围内注册的宠物数量和这些跨境邮政编码的整个(西雅图和非西雅图)土地面积来计算宠物密度，这将低估这些西雅图社区的宠物密度。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi om"><img src="../Images/4de6b40839810f17540a9db20a875659.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0o7yk3rZOiZcoSd8-AOn_A.jpeg"/></div></div><figcaption class="lm ln gj gh gi lo lp bd b be z dk">Photo Credit: George Hodan [<a class="ae lq" href="http://creativecommons.org/publicdomain/zero/1.0/" rel="noopener ugc nofollow" target="_blank">CC0 Public Domain</a>] from <a class="ae lq" href="https://www.publicdomainpictures.net/en/view-image.php?image=35428&amp;picture=sad-dog" rel="noopener ugc nofollow" target="_blank">PublicDomainPictures</a></figcaption></figure><p id="ae56" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">所以我寻找另一个<code class="fe lr ls lt lu b">shapely</code>函数。</p><p id="5cce" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">路口</strong></p><p id="1111" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><code class="fe lr ls lt lu b">object.<strong class="kk iu">intersection</strong>(<em class="nx">other</em>)</code> —返回该对象与其他几何对象的交集的表示。<a class="ae lq" href="#55a1" rel="noopener ugc nofollow"> * </a></p><p id="0349" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">换句话说，它返回两个对象重叠区域的形状。</p><pre class="lf lg lh li gt ob lu oc od aw oe bi"><span id="3029" class="mi mj it lu b gy of og l oh oi">seattle_zips_intersection = zip_codes_gdf.intersection(seattle_shp)</span><span id="1d2b" class="mi mj it lu b gy oj og l oh oi">fig, ax = plt.subplots(figsize=(10,10))<br/>waterfront.plot(ax=ax, color='black')<br/>seattle_zips_intersection.plot(ax=ax, cmap='Paired', alpha=.8, <br/>                               edgecolor='gray')<br/>seattle.plot(ax=ax, color='#00000000', edgecolor='black', <br/>             linewidth=2)</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi ol"><img src="../Images/1ea683d4c716eeb9a92dae12710d9650.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*51ECkxoJxo2odm3zCWm2sg.png"/></div></div></figure><p id="9591" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我还不确定地图上的粉红色是怎么回事，但这看起来越来越好了！随着邮政编码被修剪到西雅图内的区域，就地图绘制而言，我准备去掉标记胡德运河中心的西雅图轮廓，或者西雅图技术上结束的任何地方，取而代之的是水路和邮政编码轮廓。</p></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><p id="2d1a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">准备好地图形状后，我就可以使用 pet 数据了！</p><h2 id="d961" class="mi mj it bd mk ml mm dn mn mo mp dp mq kr mr ms mt kv mu mv mw kz mx my mz na bi translated">第三点:Geopandas.plot()使用了 matplotlib.pyplot 中几乎所有你知道和喜欢的参数</h2><p id="4c8a" class="pw-post-body-paragraph ki kj it kk b kl nb ju kn ko nc jx kq kr nd kt ku kv ne kx ky kz nf lb lc ld im bi translated">首先，我将上一步中确定的新相交几何图形添加到我的<code class="fe lr ls lt lu b">GeoDataFrame</code>中。注意:默认情况下，Geopandas 总是绘制“几何图形”列，以绘制您的形状或完成如上所用的基于形状的计算。您可以使用<code class="fe lr ls lt lu b">geo_object.<strong class="kk iu">set_geometry</strong>(<em class="nx">‘column_name')</em></code>切换哪个列<code class="fe lr ls lt lu b">geopandas</code>将用作感兴趣的几何图形。在这种情况下，我决定用一个新的、成对的 down <code class="fe lr ls lt lu b">GeoDataFrame</code>重新开始——只有西雅图的邮政编码及其交集几何和面积。</p><pre class="lf lg lh li gt ob lu oc od aw oe bi"><span id="3354" class="mi mj it lu b gy of og l oh oi"># add intersection geometry to my dataframe<br/>zip_codes_gdf['intersection'] = seattle_zips_intersection</span><span id="5686" class="mi mj it lu b gy oj og l oh oi"># create dataframe with the seattle in-city geometries<br/>seattle_zip_geom = zip_codes_gdf.loc[:, ['ZIP', 'intersection']]</span><span id="e47d" class="mi mj it lu b gy oj og l oh oi"># name the geometry column 'geometry' for easy geopandas plotting<br/>seattle_zip_geom.columns = ['ZIP', 'geometry']</span><span id="a5fb" class="mi mj it lu b gy oj og l oh oi"># calculate the in-seattle area for each zipcode and add as a column<br/>seattle_zip_geom['area'] = seattle_zip_geom.area</span><span id="f7a8" class="mi mj it lu b gy oj og l oh oi"># drop zip codes that have no area in seattle<br/>seattle_zip_geom = seattle_zip_geom.loc[seattle_zip_geom['area'] &gt; <br/>                                        0]</span></pre><p id="2f30" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为此，我添加了宠物数量和宠物密度，只使用相交面积来计算密度。</p><pre class="lf lg lh li gt ob lu oc od aw oe bi"><span id="75a5" class="mi mj it lu b gy of og l oh oi"># create dataframe with Seattle zips and their respective pet counts<br/>seattle_pets_zip = seattle_zip_geom.merge(pet_counts, on='ZIP')</span><span id="e4b3" class="mi mj it lu b gy oj og l oh oi"># add pet_density column<br/>seattle_pets_zip['pet_density'] = (seattle_pets_zip['pets'] / <br/>                                   seattle_pets_zip['area'])</span></pre><p id="3430" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要根据列<code class="fe lr ls lt lu b">'pet_density'</code>对地图进行着色，将该列设置为 plot 调用中的列名。这种基于数据值着色的地图被称为 choropleth (vocab，我希望我以前就知道……用更精确的关键字搜索帮助效果更好…)</p><pre class="lf lg lh li gt ob lu oc od aw oe bi"><span id="c269" class="mi mj it lu b gy of og l oh oi">fig, ax = plt.subplots(figsize=(10,10))<br/>waterfront.plot(ax=ax, color='black')<br/>seattle_pets_zip.plot(<strong class="lu iu">column='pet_density'</strong>, ax=ax, edgecolor='gray')</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi ol"><img src="../Images/db85680c45d8baa1170753518df157b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HAkvuFEMQePPIkN_0rp9rg.png"/></div></div></figure><p id="cc9f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">啊！所有的邮政编码看起来都一样！</p><p id="eb1a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后，我注意到两个邮政编码(98146，98168)的宠物密度要大得多，尽管在我的地图比例下看不到它们。</p><p id="6661" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了更仔细地研究这些地点，我用<code class="fe lr ls lt lu b">folium</code>将它们绘制在城市街道上:</p><pre class="lf lg lh li gt ob lu oc od aw oe bi"><span id="a7cd" class="mi mj it lu b gy of og l oh oi">import folium<br/>import geopandas as gpd</span><span id="3455" class="mi mj it lu b gy oj og l oh oi">def create_geo_map(geo_df, index, location, zoom=17, <br/>                   tiles='Stamen Terrain'):<br/>  """creates a folium map with the geometry highlighted<br/>     <br/>  Args:<br/>    geo_df: a geopandas dataframe (must have a column 'geometry'<br/>    index: the index of the row you want mapped<br/>    location: [lat, long] list with the center location for the map<br/>    zoom: start zoom level. Default: 17<br/>    tiles: Folium tiles / design. Default: Stamen Terrain</span><span id="f7c0" class="mi mj it lu b gy oj og l oh oi">  Returns:<br/>    folium map with geometry highlighted<br/>  """<br/>  # create geodataframe for zip code<br/>  zip_code = gpd.GeoDataFrame(geo_df.iloc[index]).T</span><span id="3cbe" class="mi mj it lu b gy oj og l oh oi">  # get the geojson for the zipcode<br/>  gjson = zip_code['geometry'].to_json()</span><span id="7519" class="mi mj it lu b gy oj og l oh oi">  # create folium map<br/>  m = folium.Map(location=location, tiles=tiles, zoom_start=zoom)</span><span id="44dd" class="mi mj it lu b gy oj og l oh oi">  # add geojson to the map<br/>  folium.GeoJson(gjson, name='geojson').add_to(m)<br/>  <br/>  return m</span></pre><p id="8d75" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">看看这两个邮政编码:</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi on"><img src="../Images/2be386f7660f31317d42b320b268f007.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ekfCiNqJKz0Oz8O2_NEQ1w.png"/></div></div></figure><p id="e519" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">第一个是西雅图市中心的一个街区，紧挨着图书馆，里面有一栋高层公寓。我不知道为什么这个街区有自己的邮政编码，但是好吧。我能相信这里登记了 35 只宠物。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi on"><img src="../Images/803239bca822efd76f4643a1266aef8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A-qGyUuw9gVlze30BBSUWQ.png"/></div></div></figure><p id="c51d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">第二个更神秘。更大的邮政编码中的这一小部分是波音机场附近的工业区。有一个<a class="ae lq" href="https://en.wikipedia.org/wiki/SuperValu_(United_States)" rel="noopener ugc nofollow" target="_blank">超级价值</a>，但是在谷歌地图卫星视图上没有可见的房屋(是的，我试图跟踪这 35 只宠物——你可以自由地<a class="ae lq" href="https://www.google.com/maps/@47.5101408,-122.2903633,1106m/data=!3m1!1e3" rel="noopener ugc nofollow" target="_blank">亲自查看</a>。目前，我的工作假设是这些是超价值工作者的情感支持动物。)</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/1af5ca949bccbed4bf6dcd549e6d9ed2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/1*0743EuiJb6hMEeRwOQTpBQ.jpeg"/></div><figcaption class="lm ln gj gh gi lo lp bd b be z dk">Example emotional support animal. Photo Credit: <a class="ae lq" href="https://www.linkedin.com/in/kevinhonold/" rel="noopener ugc nofollow" target="_blank">Kevin Honold</a>, used with permission</figcaption></figure><p id="4470" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">经过进一步调查，邮政编码 98168 在未合并的国王县有一些地区，这些地址可能标有“西雅图”，但从技术上来说不在西雅图市的范围内。我想知道，在这个未合并的地区，一些非西雅图居民的宠物主人是否在该市登记了他们的宠物，而没有意识到他们在技术上不是该市居民。你可能会认为这个城市不会接受非城市地址的注册……这仍然是个谜。</p><p id="b489" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">无论如何，我选择放弃这两个邮政编码，以便更大的邮政编码的宠物密度更容易区分。在<code class="fe lr ls lt lu b">geopandas</code>文档的帮助下，我还添加了图例。</p><pre class="lf lg lh li gt ob lu oc od aw oe bi"><span id="6fbe" class="mi mj it lu b gy of og l oh oi"># adding a legend using code from <a class="ae lq" href="http://geopandas.org/mapping.html" rel="noopener ugc nofollow" target="_blank">http://geopandas.org/mapping.html</a><br/><strong class="lu iu">from mpl_toolkits.axes_grid1 import make_axes_locatable</strong></span><span id="d85e" class="mi mj it lu b gy oj og l oh oi">fig, ax = plt.subplots(figsize=(10,10))<br/><strong class="lu iu">divider = make_axes_locatable(ax)<br/>cax = divider.append_axes("right", size="5%", pad=0.1)</strong><br/>waterfront.plot(ax=ax, color='black')<br/>seattle_pets_zip_dropped.plot(column='pet_density', ax=ax, <br/>                              <strong class="lu iu">legend=True</strong>, <strong class="lu iu">cax=cax</strong>);</span></pre><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi ol"><img src="../Images/139c429b0720cd8e111b9025b532c2ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jpuUy2tWpCmjkIDzWPTt3Q.png"/></div></div></figure><p id="bbd2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">所以现在我有了一个很好的主意，最适合和最不适合看宠物的社区！我确实有一些挥之不去的问题:如果我们把人口密度标准化呢？我们谈论的是什么类型的宠物——这张地图对于猫/狗/山羊/猪来说会有所不同吗(是的，山羊和猪在城市里注册了！)?但是，这些问题将不得不等待另一天…即将来到你附近的数据科学博客。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi oo"><img src="../Images/d4659d99dcd8d01464c1350dd68c0f90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XqpLec2ZlYpFoCWYojC_ow.jpeg"/></div></div><figcaption class="lm ln gj gh gi lo lp bd b be z dk">Are these your neighbors? Photo Credit: <a class="ae lq" href="https://www.linkedin.com/in/kevinhonold/" rel="noopener ugc nofollow" target="_blank">Kevin Honold</a>, used with permission</figcaption></figure></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><p id="1505" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">分模提示:</strong>在显示图形之前，使用<code class="fe lr ls lt lu b">plt.savefig('fig_name.png')</code>保存图像<strong class="kk iu">，以避免保存空白画布。例如，所有功能都包含在一个 jupyter 笔记本电池中:</strong></p><pre class="lf lg lh li gt ob lu oc od aw oe bi"><span id="5e74" class="mi mj it lu b gy of og l oh oi">fig, ax = plt.subplots(figsize=(10,10))<br/>waterfront.plot(ax=ax, color='blue')<br/>plt.savefig('images/seattle_zips_intersects.png');</span></pre><p id="e975" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您仍然可以显示图像<strong class="kk iu">并保存</strong>。</p></div><div class="ab cl ma mb hx mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="im in io ip iq"><p id="dac9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你可以在我的 GitHub repo <a class="ae lq" href="https://github.com/allisonhonold/geospatial_data_blog" rel="noopener ugc nofollow" target="_blank">这里</a>看到完整的代码。</p><p id="55a1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">*来自身材匀称的医生的描述。</p><p id="c7c6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">更新:</strong>追加安装<code class="fe lr ls lt lu b">descartes</code>和<code class="fe lr ls lt lu b">matplotlib</code>。感谢您关注<a class="op oq ep" href="https://medium.com/u/60c1c7acc358?source=post_page-----93dd9dc3137--------------------------------" rel="noopener" target="_blank">沙希德·纳瓦兹·汗</a>！</p></div></div>    
</body>
</html>