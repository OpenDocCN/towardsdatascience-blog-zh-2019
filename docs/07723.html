<html>
<head>
<title>Pivoting your Data using Python, SQL or Spreadsheets</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Python、SQL 或电子表格透视数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/pivoting-your-data-using-python-sql-or-spreadsheets-62736ba23921?source=collection_archive---------9-----------------------#2019-10-26">https://towardsdatascience.com/pivoting-your-data-using-python-sql-or-spreadsheets-62736ba23921?source=collection_archive---------9-----------------------#2019-10-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div class="gh gi ir"><img src="../Images/124f904bea270fb0a9843e290b126eb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1384/format:webp/1*RJW-mUIr37B863GM4njbTw.png"/></div></figure><div class=""/><p id="1749" class="pw-post-body-paragraph jx jy ja jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">如今，收集数据似乎比以往任何时候都容易，但这并不意味着你总能以一种能提供你所寻找的洞察力的方式来收集数据。有时，您需要以改变数据组织的方式来操作数据，以便可以从一个新的角度来查看数据。透视数据通常是重新组织数据列和行的一种简单方法，可以将它们转换成组、统计数据或摘要。本文将向您展示使用 Google sheets、Microsoft SQL Server Management Studios 和 Pandas Python 库等工具透视数据的三种简单方法。</p><p id="844d" class="pw-post-body-paragraph jx jy ja jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">如果你想跟进，你可以从 kaggle 下载我的期权时间和销售数据:</p><div class="is it gp gr iu kv"><a href="https://www.kaggle.com/bendgame/options-market-trades" rel="noopener  ugc nofollow" target="_blank"><div class="kw ab fo"><div class="kx ab ky cl cj kz"><h2 class="bd jb gy z fp la fr fs lb fu fw iz bi translated">期权市场交易</h2><div class="lc l"><h3 class="bd b gy z fp la fr fs lb fu fw dk translated">下载数千个项目的开放数据集+在一个平台上共享项目。探索热门话题，如政府…</h3></div><div class="ld l"><p class="bd b dl z fp la fr fs lb fu fw dk translated">www.kaggle.com</p></div></div></div></a></div><h1 id="f85e" class="le lf ja bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">使用熊猫在 Python 中旋转</h1><p id="006a" class="pw-post-body-paragraph jx jy ja jz b ka mc kc kd ke md kg kh ki me kk kl km mf ko kp kq mg ks kt ku im bi translated">Pandas 是一个强大而流行的 Python 数据分析库。它允许您创建数据框，以类似于电子表格或数据库表的结构来查看和操作数据。您可以使用熊猫创建数据透视表，只需几行代码！我将向您展示如何透视列或行:</p><ol class=""><li id="a842" class="mi mj ja jz b ka kb ke kf ki mk km ml kq mm ku mn mo mp mq bi translated">导入依赖项和数据:</li></ol><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="efc0" class="na lf ja mw b gy nb nc l nd ne">import pandas as pd<br/>import numpy as np</span><span id="998f" class="na lf ja mw b gy nf nc l nd ne">#read your csv data to a Data Frame<br/>data = pd.read_csv(r'C:\Users\Admin\Desktop\Edge\optionsTradeData.csv')</span><span id="86eb" class="na lf ja mw b gy nf nc l nd ne">#check the data<br/>data.head()<br/></span></pre><figure class="mr ms mt mu gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi ng"><img src="../Images/2011054a77a647b8dd8b94cc8bba9a0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZMQFzdyhQ-C_NHbBx6klgA.png"/></div></div></figure><p id="1988" class="pw-post-body-paragraph jx jy ja jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">2.使用 Pandas.pivot_table 函数创建类似电子表格的数据透视表:</p><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="5e15" class="na lf ja mw b gy nb nc l nd ne">pd.pivot_table(data, index = ['Sector'], values = ['Spent'], aggfunc = np.sum)</span></pre><figure class="mr ms mt mu gt iv gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/116fe31568a1d5621faa4fe7d98a8868.png" data-original-src="https://miro.medium.com/v2/resize:fit:628/format:webp/1*WSd114Y1aBs0V5zAqe6Q3g.png"/></div></figure><p id="e96e" class="pw-post-body-paragraph jx jy ja jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated"><strong class="jz jb">或</strong>您可以将扇区设置为列，而不是将其用作索引:</p><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="2203" class="na lf ja mw b gy nb nc l nd ne">pd.pivot_table(data, columns = ['Sector'], values = ['Spent'], aggfunc = np.sum)</span></pre><figure class="mr ms mt mu gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi nm"><img src="../Images/ba41058052ba8e429790346020df4cb8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RPWWDitW25ckSIKv_HYE2Q.png"/></div></div></figure></div><div class="ab cl nn no hx np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="im in io ip iq"><h1 id="38c3" class="le lf ja bd lg lh nu lj lk ll nv ln lo lp nw lr ls lt nx lv lw lx ny lz ma mb bi translated">透视您的电子表格</h1><figure class="mr ms mt mu gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi nz"><img src="../Images/a7eed3b09e19340a2bf37b08680e585c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4aSbEnNplmtLlD0VtlIYfw.png"/></div></div></figure><p id="8bbe" class="pw-post-body-paragraph jx jy ja jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">查看我们的数据，假设我们想要按部门合计支出金额。数据透视表使计算变得简单。Microsoft Excel 和 Google Sheets 具有内置的透视功能，可以轻松转换您的电子表格。要在 google sheets 中创建数据透视表，请遵循以下步骤:</p><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="ea6f" class="na lf ja mw b gy nb nc l nd ne">1. Data &gt; Pivot table.<br/>2. Set the Data range.<br/>3. Select an insert option data. I recommend New sheet.<br/>4. Click Create.</span></pre><figure class="mr ms mt mu gt iv gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/910dbba5433d1c05844744c01d2afbeb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1004/format:webp/1*6HdVjY1KBCSocBmOv7xTUQ.png"/></div></figure><p id="214e" class="pw-post-body-paragraph jx jy ja jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">您将看到一个空表和透视表编辑器，允许您设置行、列、值和过滤器。如果您对数据透视表完全陌生，Google Sheets 会为您提供建议的数据透视表，让您轻松入门:</p><figure class="mr ms mt mu gt iv gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/386cc996ec25991a63f0afa8cfb3b6b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:744/format:webp/1*2xlwAu492ZkS6-Q2SfVBaA.png"/></div></figure><p id="af9f" class="pw-post-body-paragraph jx jy ja jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">要获得部门的总支出，我们需要设置我们的行和值:</p><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="4ab6" class="na lf ja mw b gy nb nc l nd ne">1. Click Add Rows.<br/>2. Select sector.<br/>3. Click Add Values.<br/>4. Select Spent.</span></pre><figure class="mr ms mt mu gt iv gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/32307ca4ba59c27d78e0447e0dd68d34.png" data-original-src="https://miro.medium.com/v2/resize:fit:682/format:webp/1*O_gS9FWUimKSNjQdY3zk7w.png"/></div></figure><p id="2d28" class="pw-post-body-paragraph jx jy ja jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">您已成功透视了数据，如下所示:</p><figure class="mr ms mt mu gt iv gh gi paragraph-image"><div class="gh gi od"><img src="../Images/2ce33c9945fd74225405ace64a41ba24.png" data-original-src="https://miro.medium.com/v2/resize:fit:632/format:webp/1*wD7jtI9omYksJdtTA3U-bg.png"/></div></figure><h1 id="0cb6" class="le lf ja bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">SQL 中的透视</h1><p id="66b7" class="pw-post-body-paragraph jx jy ja jz b ka mc kc kd ke md kg kh ki me kk kl km mf ko kp kq mg ks kt ku im bi translated">SQL 是一种强大的查询语言，允许你在关系数据库中检索和操作数据。这是一门相当容易学习的语言，如果你不熟悉它，我强烈推荐<a class="ae mh" href="https://www.w3schools.com/sql/" rel="noopener ugc nofollow" target="_blank">探索基础</a>。我在工作和家庭中使用<a class="ae mh" href="https://www.microsoft.com/en-us/sql-server/sql-server-downloads" rel="noopener ugc nofollow" target="_blank">微软 SQL Server 和 SQL Server Management Studios </a>，所以这是我在我的例子中使用的风格，但是有几种不同的数据库/SQL 环境可供您使用:MySQL、PostgreSQL、SQLite 和 Oracle Database，仅举几例。</p><p id="90d4" class="pw-post-body-paragraph jx jy ja jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">Microsoft SQL Server 允许您使用<a class="ae mh" href="https://docs.microsoft.com/en-us/sql/t-sql/queries/from-using-pivot-and-unpivot?view=sql-server-ver15" rel="noopener ugc nofollow" target="_blank"> PIVOT 关系运算符</a>来旋转和聚合您的数据，将其转换为数据透视表。这是微软文档中透视语法的一个示例:</p><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="ddb7" class="na lf ja mw b gy nb nc l nd ne">SELECT &lt;non-pivoted column&gt;,  <br/>    [first pivoted column] AS &lt;column name&gt;,  <br/>    [second pivoted column] AS &lt;column name&gt;,  <br/>    ...  <br/>    [last pivoted column] AS &lt;column name&gt;  <br/>FROM  <br/>    (&lt;SELECT query that produces the data&gt;)   <br/>    AS &lt;alias for the source query&gt;  <br/>PIVOT  <br/>(  <br/>    &lt;aggregation function&gt;(&lt;column being aggregated&gt;)  <br/>FOR   <br/>[&lt;column that contains the values that will become column headers&gt;]   <br/>    IN ( [first pivoted column], [second pivoted column],  <br/>    ... [last pivoted column])  <br/>) AS &lt;alias for the pivot table&gt;  <br/>&lt;optional ORDER BY clause&gt;;</span></pre></div><div class="ab cl nn no hx np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="im in io ip iq"><p id="7240" class="pw-post-body-paragraph jx jy ja jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">从输出您想要透视的数据的<strong class="jz jb"> SELECT </strong>语句开始:</p><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="2600" class="na lf ja mw b gy nb nc l nd ne">(select sector, spent<br/>from v_FlowTotal)</span></pre><figure class="mr ms mt mu gt iv gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/1f065b8a06aab7f60c46d55e9029f881.png" data-original-src="https://miro.medium.com/v2/resize:fit:360/format:webp/1*ng8Z7HjlV6kYGHJ5Frz4EQ.png"/></div></figure><p id="1e85" class="pw-post-body-paragraph jx jy ja jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">从该数据中，选择要透视的列。在我们的示例中，我们希望旋转扇区:</p><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="cf8a" class="na lf ja mw b gy nb nc l nd ne">select [Non-Cyclical Consumer Goods]<br/>,ETF<br/>,Healthcare<br/>,Utilities<br/>,MISC<br/>,[Cyclical Consumer Goods]<br/>,Telecommunication<br/>,WEED<br/>,Financials<br/>,Energy<br/>,[Basic Materials]<br/>,Industrials<br/>,REIT<br/>,Technology<br/>FROM (<br/>  select sector, spent FROM v_FlowTotal ft<br/>) as SourceTable</span></pre><p id="9034" class="pw-post-body-paragraph jx jy ja jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">然后应用<strong class="jz jb"> PIVOT </strong>运算符以及您的聚合函数:</p><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="0f8d" class="na lf ja mw b gy nb nc l nd ne">select [Non-Cyclical Consumer Goods]<br/>,ETF<br/>,Healthcare<br/>,Utilities<br/>,MISC<br/>,[Cyclical Consumer Goods]<br/>,Telecommunication<br/>,WEED<br/>,Financials<br/>,Energy<br/>,[Basic Materials]<br/>,Industrials<br/>,REIT<br/>,Technology<br/>FROM (<br/>  select sector, spent FROM v_FlowTotal ft<br/> ) as SourceTable<br/>PIVOT (<br/>  sum(spent)<br/>  for sector IN (<br/>  [Non-Cyclical Consumer Goods]<br/>  ,ETF<br/>  ,Healthcare<br/>  ,Utilities<br/>  ,MISC<br/>  ,[Cyclical Consumer Goods]<br/>  ,Telecommunication<br/>  ,WEED<br/>  ,Financials<br/>  ,Energy<br/>  ,[Basic Materials]<br/>  ,Industrials<br/>  ,REIT<br/>  ,Technology)<br/>)As PivotTable</span></pre><p id="f213" class="pw-post-body-paragraph jx jy ja jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated">输出将如下所示:</p><figure class="mr ms mt mu gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi of"><img src="../Images/e77443a89cd001a347f550c7c025de67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yLbxwT0OImSSVJtHdVWw5Q.png"/></div></div></figure></div><div class="ab cl nn no hx np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="im in io ip iq"><h1 id="394e" class="le lf ja bd lg lh nu lj lk ll nv ln lo lp nw lr ls lt nx lv lw lx ny lz ma mb bi translated">最后备注:</h1><p id="8f5d" class="pw-post-body-paragraph jx jy ja jz b ka mc kc kd ke md kg kh ki me kk kl km mf ko kp kq mg ks kt ku im bi translated">虽然本文将帮助您开始使用数据透视表，但是了解它们所提供的所有功能的最好方法是通过修补和摆弄这些功能！数据透视表易于创建，并允许您通过更改查看数据的方式来获得对数据的洞察力。</p><h1 id="e37d" class="le lf ja bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">谢谢大家！</h1><ul class=""><li id="df36" class="mi mj ja jz b ka mc ke md ki og km oh kq oi ku oj mo mp mq bi translated"><em class="ok">如果你喜欢这个，</em> <a class="ae mh" href="https://medium.com/@erickleppen" rel="noopener"> <em class="ok">在 Medium 上关注我</em> </a> <em class="ok">了解更多</em></li><li id="4555" class="mi mj ja jz b ka ol ke om ki on km oo kq op ku oj mo mp mq bi translated"><a class="ae mh" href="https://erickleppen.medium.com/membership" rel="noopener"> <em class="ok">通过订阅</em> </a>获得对我的内容的完全访问和帮助支持</li><li id="f17a" class="mi mj ja jz b ka ol ke om ki on km oo kq op ku oj mo mp mq bi translated"><em class="ok">我们连线上</em><a class="ae mh" href="https://www.linkedin.com/in/erickleppen01/" rel="noopener ugc nofollow" target="_blank"><em class="ok">LinkedIn</em></a></li><li id="5bf8" class="mi mj ja jz b ka ol ke om ki on km oo kq op ku oj mo mp mq bi translated"><em class="ok">用 Python 分析数据？查看我的</em> <a class="ae mh" href="https://pythondashboards.com/" rel="noopener ugc nofollow" target="_blank"> <em class="ok">网站</em> </a></li></ul><p id="122d" class="pw-post-body-paragraph jx jy ja jz b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku im bi translated"><a class="ae mh" href="http://pythondashboards.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="jz jb"> —埃里克·克莱本</strong> </a></p></div></div>    
</body>
</html>