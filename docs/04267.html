<html>
<head>
<title>Here’s how you can accelerate your Data Science on GPU</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">以下是如何在 GPU 上加速数据科学的方法</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/heres-how-you-can-accelerate-your-data-science-on-gpu-4ecf99db3430?source=collection_archive---------6-----------------------#2019-07-03">https://towardsdatascience.com/heres-how-you-can-accelerate-your-data-science-on-gpu-4ecf99db3430?source=collection_archive---------6-----------------------#2019-07-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><blockquote class="jq jr js"><p id="8699" class="jt ju jv jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr im bi translated">想获得灵感？快来加入我的<a class="ae ks" href="https://www.superquotes.co/?utm_source=mediumtech&amp;utm_medium=web&amp;utm_campaign=sharing" rel="noopener ugc nofollow" target="_blank"> <strong class="jw iu">超级行情快讯</strong> </a>。😎</p></blockquote><p id="f638" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke kt kg kh ki ku kk kl km kv ko kp kq kr im bi translated">数据科学家需要计算能力。无论你是用 Pandas 处理一个大数据集，还是用 Numpy 在一个大规模矩阵上运行一些计算，你都需要一台强大的机器来在合理的时间内完成工作。</p><p id="25c3" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke kt kg kh ki ku kk kl km kv ko kp kq kr im bi translated">在过去几年中，数据科学家通常使用的 Python 库在利用 CPU 能力方面已经变得相当不错。</p><p id="8dbf" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke kt kg kh ki ku kk kl km kv ko kp kq kr im bi translated">Pandas 的底层代码是用 C 语言编写的，它在处理超过 100GB 的数据集方面做得很好。如果您没有足够的内存来容纳这样的数据集，您可以使用方便的分块功能，一次处理一部分数据。</p><h1 id="16b4" class="kw kx it bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">GPU 与 CPU:并行处理</h1><p id="edc1" class="pw-post-body-paragraph jt ju it jw b jx lu jz ka kb lv kd ke kt lw kh ki ku lx kl km kv ly kp kq kr im bi translated">对于海量数据，一个 CPU 是无法处理的。</p><p id="006a" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke kt kg kh ki ku kk kl km kv ko kp kq kr im bi translated">一个超过 100GB 的数据集将会有很多很多的数据点，大概在<em class="jv">百万</em>甚至<em class="jv">十亿</em>的范围内。有这么多的点要处理，无论你的 CPU 有多快，它都没有足够的内核来进行高效的并行处理。如果您的 CPU 有 20 个内核(这将是相当昂贵的 CPU)，您一次只能处理 20 个数据点！</p><p id="e015" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke kt kg kh ki ku kk kl km kv ko kp kq kr im bi translated">CPU 在时钟速度更重要的任务中会更好——或者你根本没有 GPU 实现。如果你正在尝试执行的进程有一个 GPU 实现，那么如果这个任务可以从并行处理中受益，那么 GPU 将会更加有效。</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div class="gh gi lz"><img src="../Images/97044e92f81353dedc6d34778d18efae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1086/format:webp/1*UM8QYfoYH-Dva1BnHokbTA.png"/></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk">How a Multi-core system can process data faster. For a single core system (left), all 10 tasks go to a single node. For the dual-core system (right), each node takes on 5 tasks, thereby doubling the processing speed</figcaption></figure><p id="17e7" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke kt kg kh ki ku kk kl km kv ko kp kq kr im bi translated">深度学习已经看到了利用 GPU 的公平份额。深度学习中的许多卷积运算都是重复的，因此可以在 GPU 上大大加速，甚至高达数百倍。</p><p id="12f0" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke kt kg kh ki ku kk kl km kv ko kp kq kr im bi translated">今天的数据科学没有什么不同，因为许多重复操作都是通过 Pandas、Numpy 和 Scikit-Learn 等库在大型数据集上执行的。这些操作在 GPU 上实现起来也不会太复杂。</p><p id="c124" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke kt kg kh ki ku kk kl km kv ko kp kq kr im bi translated">终于有解决办法了。</p><h1 id="2624" class="kw kx it bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">GPU 加速与急流</h1><p id="79a5" class="pw-post-body-paragraph jt ju it jw b jx lu jz ka kb lv kd ke kt lw kh ki ku lx kl km kv ly kp kq kr im bi translated"><a class="ae ks" href="https://rapids.ai/" rel="noopener ugc nofollow" target="_blank"> Rapids </a>是一套软件库，旨在利用 GPU 加速数据科学。它使用低级别的 CUDA 代码来实现快速的 GPU 优化算法，同时仍然拥有一个易于使用的 Python 层。</p><p id="1c0a" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke kt kg kh ki ku kk kl km kv ko kp kq kr im bi translated">Rapids 的美妙之处在于它可以与数据科学库顺利集成——像 Pandas 数据帧这样的东西很容易通过 Rapids 进行 GPU 加速。下图说明了 Rapids 如何实现低级别加速，同时保持易于使用的顶层。</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div class="ab gu cl ml"><img src="../Images/4f3b76df6614cf9cc928334b761ed945.png" data-original-src="https://miro.medium.com/v2/format:webp/1*obdH95sFBvL24l8id8V8uA.png"/></div></figure><p id="f4bf" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke kt kg kh ki ku kk kl km kv ko kp kq kr im bi translated">Rapids 利用了几个 Python 库:</p><ul class=""><li id="7454" class="mm mn it jw b jx jy kb kc kt mo ku mp kv mq kr mr ms mt mu bi translated"><a class="ae ks" href="https://github.com/rapidsai/cudf" rel="noopener ugc nofollow" target="_blank"><strong class="jw iu">cuDF</strong></a>—Python GPU data frames。在数据处理和操作方面，它几乎可以做熊猫能做的一切。</li><li id="2008" class="mm mn it jw b jx mv kb mw kt mx ku my kv mz kr mr ms mt mu bi translated"><a class="ae ks" href="https://github.com/rapidsai/cuml" rel="noopener ugc nofollow" target="_blank"> <strong class="jw iu"> cuML </strong> </a> — Python GPU 机器学习。它包含许多 Scikit-Learn 拥有的 ML 算法，格式都非常相似。</li><li id="019c" class="mm mn it jw b jx mv kb mw kt mx ku my kv mz kr mr ms mt mu bi translated"><a class="ae ks" href="https://github.com/rapidsai/cuml" rel="noopener ugc nofollow" target="_blank"><strong class="jw iu">cuGraph</strong></a>—Python GPU 图形处理。它包含许多常见的图形分析算法，包括 PageRank 和各种相似性度量。</li></ul><h1 id="06ab" class="kw kx it bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">如何使用 Rapids 的教程</h1><h2 id="76fe" class="na kx it bd ky nb nc dn lc nd ne dp lg kt nf ng lk ku nh ni lo kv nj nk ls nl bi translated">装置</h2><p id="891a" class="pw-post-body-paragraph jt ju it jw b jx lu jz ka kb lv kd ke kt lw kh ki ku lx kl km kv ly kp kq kr im bi translated">现在你将看到如何使用急流！</p><p id="5095" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke kt kg kh ki ku kk kl km kv ko kp kq kr im bi translated">要安装它，前往<a class="ae ks" href="https://rapids.ai/start.html" rel="noopener ugc nofollow" target="_blank">网站</a>，在那里你会看到如何安装 Rapids。您可以通过<a class="ae ks" href="https://anaconda.org/anaconda/conda" rel="noopener ugc nofollow" target="_blank"> Conda </a>将它直接安装在您的机器上，或者只需拉动 Docker 容器。</p><p id="fd65" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke kt kg kh ki ku kk kl km kv ko kp kq kr im bi translated">安装时，您可以设置您的系统规格，如 CUDA 版本和您想要安装的库。例如，我有 CUDA 10.0，想安装所有的库，所以我的安装命令是:</p><pre class="ma mb mc md gt nm nn no np aw nq bi"><span id="3040" class="na kx it nn b gy nr ns l nt nu">conda install -c nvidia -c rapidsai -c numba -c conda-forge -c pytorch -c defaults cudf=0.8 cuml=0.8 cugraph=0.8 python=3.6 cudatoolkit=10.0</span></pre><p id="f09c" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke kt kg kh ki ku kk kl km kv ko kp kq kr im bi translated">一旦该命令运行完毕，您就可以开始进行 GPU 加速的数据科学了。</p><h2 id="4b41" class="na kx it bd ky nb nc dn lc nd ne dp lg kt nf ng lk ku nh ni lo kv nj nk ls nl bi translated">设置我们的数据</h2><p id="71db" class="pw-post-body-paragraph jt ju it jw b jx lu jz ka kb lv kd ke kt lw kh ki ku lx kl km kv ly kp kq kr im bi translated">对于本教程，我们将经历一个修改版本的<a class="ae ks" href="https://github.com/rapidsai/notebooks/blob/branch-0.8/tutorials/DBSCAN_Demo_Full.ipynb" rel="noopener ugc nofollow" target="_blank"> DBSCAN 演示</a>。我将使用<a class="ae ks" rel="noopener" target="_blank" href="/nvidias-new-data-science-workstation-a-review-and-benchmark-e451db600551"> Nvidia 数据科学工作站</a>来运行 2 个 GPU 附带的测试。</p><p id="555a" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke kt kg kh ki ku kk kl km kv ko kp kq kr im bi translated">DBSCAN 是一种基于密度的<a class="ae ks" rel="noopener" target="_blank" href="/the-5-clustering-algorithms-data-scientists-need-to-know-a36d136ef68">聚类算法</a>，可以自动对数据组进行分类，而无需用户指定有多少组。在<a class="ae ks" href="https://scikit-learn.org/stable/modules/generated/sklearn.cluster.DBSCAN.html" rel="noopener ugc nofollow" target="_blank"> Scikit-Learn </a>中有它的一个实现。</p><p id="8398" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke kt kg kh ki ku kk kl km kv ko kp kq kr im bi translated">我们将从获取所有导入设置开始。用于加载数据、可视化数据和应用 ML 模型的库。</p><pre class="ma mb mc md gt nm nn no np aw nq bi"><span id="1d52" class="na kx it nn b gy nr ns l nt nu">import os<br/>import matplotlib.pyplot as plt<br/>from matplotlib.colors import ListedColormap<br/>from sklearn.datasets import make_circles</span></pre><p id="ac82" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke kt kg kh ki ku kk kl km kv ko kp kq kr im bi translated"><em class="jv"> make_circles </em>函数将自动创建一个复杂的数据分布，类似于我们将应用 DBSCAN 的两个圆。</p><p id="368f" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke kt kg kh ki ku kk kl km kv ko kp kq kr im bi translated">让我们从创建 100，000 个点的数据集开始，并在图中显示它:</p><pre class="ma mb mc md gt nm nn no np aw nq bi"><span id="ee80" class="na kx it nn b gy nr ns l nt nu">X, y = make_circles(n_samples=int(1e5), factor=.35, noise=.05)<br/>X[:, 0] = 3*X[:, 0]<br/>X[:, 1] = 3*X[:, 1]<br/>plt.scatter(X[:, 0], X[:, 1])<br/>plt.show()</span></pre><figure class="ma mb mc md gt me gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/0580c5354f336f362cdeef493924cf9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:852/format:webp/1*5BSNgayza_21x6ChorZgVA.png"/></div></figure><h2 id="39a6" class="na kx it bd ky nb nc dn lc nd ne dp lg kt nf ng lk ku nh ni lo kv nj nk ls nl bi translated">CPU 上的数据库扫描</h2><p id="000a" class="pw-post-body-paragraph jt ju it jw b jx lu jz ka kb lv kd ke kt lw kh ki ku lx kl km kv ly kp kq kr im bi translated">使用 Scikit-Learn 在 CPU 上运行 DBSCAN 很容易。我们将导入我们的算法并设置一些参数。</p><pre class="ma mb mc md gt nm nn no np aw nq bi"><span id="6b11" class="na kx it nn b gy nr ns l nt nu">from sklearn.cluster import DBSCAN</span><span id="5e7a" class="na kx it nn b gy nw ns l nt nu">db = DBSCAN(eps=0.6, min_samples=2)</span></pre><p id="78ee" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke kt kg kh ki ku kk kl km kv ko kp kq kr im bi translated">现在，我们可以通过调用 Scikit-Learn 中的一个函数对 circle 数据应用 DBSCAN。在我们的函数前加一个<code class="fe nx ny nz nn b">%%time</code>告诉 Jupyter Notebook 测量它的运行时间。</p><pre class="ma mb mc md gt nm nn no np aw nq bi"><span id="3647" class="na kx it nn b gy nr ns l nt nu">%%time</span><span id="5390" class="na kx it nn b gy nw ns l nt nu">y_db = db.fit_predict(X)</span></pre><p id="5915" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke kt kg kh ki ku kk kl km kv ko kp kq kr im bi translated">对于这 100，000 个点，运行时间是 8.31 秒。结果图如下所示。</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/d6ae2fa4245fdea88504f5f9146aa0bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:992/format:webp/1*c5SVYApSpUa_3O_aP-fwLA.png"/></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk">Result of running DBSCAN on the CPU using Scikit-Learn</figcaption></figure><h2 id="68c1" class="na kx it bd ky nb nc dn lc nd ne dp lg kt nf ng lk ku nh ni lo kv nj nk ls nl bi translated">GPU 上带 Rapids 的 DBSCAN</h2><p id="430c" class="pw-post-body-paragraph jt ju it jw b jx lu jz ka kb lv kd ke kt lw kh ki ku lx kl km kv ly kp kq kr im bi translated">现在让我们用急流让事情变得更快！</p><p id="c1d6" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke kt kg kh ki ku kk kl km kv ko kp kq kr im bi translated">首先，我们将把数据转换成一个<code class="fe nx ny nz nn b">pandas.DataFrame</code>，并用它来创建一个<code class="fe nx ny nz nn b">cudf.DataFrame</code>。Pandas 数据帧无缝转换为 cuDF 数据帧，数据格式没有任何变化。</p><pre class="ma mb mc md gt nm nn no np aw nq bi"><span id="1477" class="na kx it nn b gy nr ns l nt nu">import pandas as pd<br/>import cudf</span><span id="2ff4" class="na kx it nn b gy nw ns l nt nu">X_df = pd.DataFrame({'fea%d'%i: X[:, i] for i in range(X.shape[1])})<br/>X_gpu = cudf.DataFrame.from_pandas(X_df)</span></pre><p id="257f" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke kt kg kh ki ku kk kl km kv ko kp kq kr im bi translated">然后我们将从 cuML 导入并初始化一个<em class="jv">特殊</em>版本的 DBSCAN，一个 GPU 加速的版本。DBSCAN 的 cuML 版本的函数格式与 Scikit-Learn 的完全相同——相同的参数，相同的风格，相同的函数。</p><pre class="ma mb mc md gt nm nn no np aw nq bi"><span id="dec2" class="na kx it nn b gy nr ns l nt nu">from cuml import DBSCAN as cumlDBSCAN</span><span id="7d15" class="na kx it nn b gy nw ns l nt nu">db_gpu = cumlDBSCAN(eps=0.6, min_samples=2)</span></pre><p id="a73b" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke kt kg kh ki ku kk kl km kv ko kp kq kr im bi translated">最后，我们可以在测量运行时间的同时为 GPU DBSCAN 运行我们的预测函数。</p><pre class="ma mb mc md gt nm nn no np aw nq bi"><span id="0021" class="na kx it nn b gy nr ns l nt nu">%%time</span><span id="d7ec" class="na kx it nn b gy nw ns l nt nu">y_db_gpu = db_gpu.fit_predict(X_gpu)</span></pre><p id="ca1b" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke kt kg kh ki ku kk kl km kv ko kp kq kr im bi translated">GPU 版本的运行时间为 4.22 秒，几乎是 2 倍的加速。因为我们使用相同的算法，所以结果图也与 CPU 版本完全相同。</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/d6ae2fa4245fdea88504f5f9146aa0bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:992/format:webp/1*c5SVYApSpUa_3O_aP-fwLA.png"/></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk">Result of running DBSCAN on the GPU using cuML</figcaption></figure><h1 id="ffe4" class="kw kx it bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">借助 Rapids GPU 获得超快速度</h1><p id="fed7" class="pw-post-body-paragraph jt ju it jw b jx lu jz ka kb lv kd ke kt lw kh ki ku lx kl km kv ly kp kq kr im bi translated">我们从 Rapids 获得的加速量取决于我们处理的数据量。一个很好的经验法则是，较大的数据集将受益于 GPU 加速。在 CPU 和 GPU 之间传输数据会产生一些开销时间，对于较大的数据集，这些开销时间变得更加“值得”。</p><p id="4638" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke kt kg kh ki ku kk kl km kv ko kp kq kr im bi translated">我们可以用一个简单的例子来说明这一点。</p><p id="848b" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke kt kg kh ki ku kk kl km kv ko kp kq kr im bi translated">我们将创建一个 Numpy 随机数数组，并对其应用 DBSCAN。我们将比较我们的常规 CPU DBSCAN 和 cuML 的 GPU 版本的速度，同时增加和减少数据点的数量，以查看它如何影响我们的运行时间。</p><p id="e2a1" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke kt kg kh ki ku kk kl km kv ko kp kq kr im bi translated">下面的代码演示了这个测试:</p><pre class="ma mb mc md gt nm nn no np aw nq bi"><span id="c60e" class="na kx it nn b gy nr ns l nt nu">import numpy as np</span><span id="08c6" class="na kx it nn b gy nw ns l nt nu">n_rows, n_cols = 10000, 100<br/>X = np.random.rand(n_rows, n_cols)<br/>print(X.shape)</span><span id="529a" class="na kx it nn b gy nw ns l nt nu">X_df = pd.DataFrame({'fea%d'%i: X[:, i] for i in range(X.shape[1])})<br/>X_gpu = cudf.DataFrame.from_pandas(X_df)</span><span id="b429" class="na kx it nn b gy nw ns l nt nu">db = DBSCAN(eps=3, min_samples=2)<br/>db_gpu = cumlDBSCAN(eps=3, min_samples=2)</span><span id="d415" class="na kx it nn b gy nw ns l nt nu">%%time<br/>y_db = db.fit_predict(X)</span><span id="0c3b" class="na kx it nn b gy nw ns l nt nu">%%time<br/>y_db_gpu = db_gpu.fit_predict(X_gpu)</span></pre><p id="5bdf" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke kt kg kh ki ku kk kl km kv ko kp kq kr im bi translated">查看下面 Matplotlib 的结果图:</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/a0d6795f7133a1752e0e6ef8af146740.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*sbd1OMP3W54IZtWimzoTZA.png"/></div></figure><p id="3fdb" class="pw-post-body-paragraph jt ju it jw b jx jy jz ka kb kc kd ke kt kg kh ki ku kk kl km kv ko kp kq kr im bi translated">当使用 GPU 而不是 CPU 时，数量会急剧增加。即使在 10，000 点(最左边)，我们仍然获得了 4.54 倍的加速。在更高端的情况下，10，000，000 点在切换到 GPU 时，我们获得了 88.04 倍的加速！</p></div><div class="ab cl oc od hx oe" role="separator"><span class="of bw bk og oh oi"/><span class="of bw bk og oh oi"/><span class="of bw bk og oh"/></div><div class="im in io ip iq"><h1 id="64a4" class="kw kx it bd ky kz oj lb lc ld ok lf lg lh ol lj lk ll om ln lo lp on lr ls lt bi translated">喜欢学习？</h1><p id="ed85" class="pw-post-body-paragraph jt ju it jw b jx lu jz ka kb lv kd ke kt lw kh ki ku lx kl km kv ly kp kq kr im bi translated">在推特<a class="ae ks" href="https://twitter.com/GeorgeSeif94" rel="noopener ugc nofollow" target="_blank">上关注我，我会在这里发布所有最新最棒的人工智能、技术和科学！也在 LinkedIn </a>上与我联系！</p></div></div>    
</body>
</html>