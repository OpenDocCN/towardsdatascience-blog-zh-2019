<html>
<head>
<title>Pandas for Football Analysis</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">熊猫足球分析</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/pandas-for-football-analysis-42c23b252995?source=collection_archive---------9-----------------------#2019-05-23">https://towardsdatascience.com/pandas-for-football-analysis-42c23b252995?source=collection_archive---------9-----------------------#2019-05-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="58f6" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">一个利用足球联赛数据合并和抓取数据帧的例子</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/f436a69e75fc2ae484ff6fc22fb44953.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i7Rx4egymjgvq8r9fMWljA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Image Courtesy of <a class="ae ky" href="https://unsplash.com/@donnycocacola" rel="noopener ugc nofollow" target="_blank">Donnycocacola</a></figcaption></figure><h1 id="97dd" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">介绍</h1><p id="44f9" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">本教程将集中在如何合并从不同的网上来源搜集的数据帧。首先，我将把可从<a class="ae ky" href="https://en.wikipedia.org/wiki/2018%E2%80%9319_Premier_League" rel="noopener ugc nofollow" target="_blank">维基百科</a>获得的英超联赛表格，与一支球队在一个赛季中领先、追平或落后的平均时间相关的统计数据合并起来。这些信息将从一个独立的来源搜集而来，即<a class="ae ky" href="https://www.soccerstats.com/table.asp?league=england&amp;tid=t" rel="noopener ugc nofollow" target="_blank">足球统计</a>。</p><p id="5ab9" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">2018-19 英超赛季刚刚结束。虽然冠军争夺和降级之战占据了大部分头条，但知道一支球队在整个赛季的英超比赛中平均需要领先多少分钟才能确保欧洲足球，这将是一件有趣的事情。</p><p id="4b7d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">当每个英超联赛结束时，奖金会根据球队在联赛中的排名在球队之间分配。通过收集数据，并将其列表成数据框，你可以清楚地看到托特纳姆热刺队在赛季最后一天与埃弗顿队打平的影响，这使他们失去了第三名的成绩。</p><h1 id="1c91" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated"><strong class="ak">刮痧</strong></h1><p id="5230" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我按照惯例导入 Pandas 模块作为它的别名 pd。Pandas 有一个内置函数，<strong class="lt iu"> read_html </strong>，它使用 lxml 和 BeautifulSoup 之类的库来自动解析 html 文件中的表格，作为 DataFrame 对象。默认情况下，<strong class="lt iu"> pandas.read_html </strong>函数搜索并尝试解析包含在<strong class="lt iu"> &lt; table &gt; </strong>标签中的所有表格数据。结果是 DataFrame 对象的列表。</p><p id="aa89" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我使用 pandas 函数<strong class="lt iu"> pd.read_html() </strong>从维基百科中删除英超联赛表，从 soccerstats 中删除 leading_level_trailing 表。快速回顾如何做到这一点和基本的清理(这很简单)，请参阅我的文章；<a class="ae ky" rel="noopener" target="_blank" href="/pandas-in-the-premier-league-78f1d0c21b4f">英超熊猫</a>。</p><p id="8fd1" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这导致了下面描述的两个数据帧。为了节省空间，我只使用。head()方法。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ms"><img src="../Images/ea8ac6c60c969ae0045e6ac12d9f1a93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xTG1fsBXeJeiLiLl5KP7bQ.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mt"><img src="../Images/fbb9ad2b614bbd44c70efece36da062c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LAo5CBF5imcBHwBqCW4CLw.png"/></div></div></figure><h1 id="9ab3" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated"><strong class="ak">合并两个数据帧</strong></h1><p id="40a4" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">“Premier_league”表和“leading_level_trailing”表现在可以合并了。在这种情况下，为了合并，我创建了一个在两个数据帧之间共享的新列。我本来可以选择使用现有的团队名称列，但是许多条目的名称和填充实际上略有不同。</p><p id="e4f7" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">例如，“曼城(C)”是 premier_league 表中的列值，但“曼城”列在 leading_level_trailing 表中。由于有许多不同名称的实例，我选择为每个团队插入一个新列，用简单的三个字母缩写。这省去了重命名每个团队的时间，因此相应的行将在两个数据帧之间匹配，但是有许多方法可以做到这一点。</p><p id="ed6d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">名词（noun 的缩写）b:当我用球队简写创建新列时，条目必须与他们的球队结合，例如“leading_level_trailing”表中的第一个球队是阿森纳，因此我的球队简写列表中的第一个元素是“ARS ”,等等。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="3b5b" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我在 Premier_league 表中创建了相同的 Team _ 缩写。我现在可以合并两个数据帧。</p><p id="8dd4" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我为合并的表决定一个新的变量名，并使用<strong class="lt iu"> pd.merge </strong>函数进行合并。我在括号中列出了这两个表，使用<strong class="lt iu"> on= </strong>参数选择匹配哪一列，使用<strong class="lt iu"> how= </strong>参数保留左侧 Premier_league 表中的所有行。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mu mv l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mw"><img src="../Images/1c436e86257581d7fe86c4aed003ea0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RibdtkN5_yqZtASQnETINg.png"/></div></div></figure><p id="538d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在更彻底地组织数据帧之后，例如删除重复的列名(例如 Team_y)，我检查合并表‘leading _ level _ trailing _ stats’中列的数据类型，并将‘object’类型的列(python 字符串)转换为我们可以应用数字过滤条件的数字数据类型。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mx"><img src="../Images/009d34ea1b7d6d60f14cd77fc3c012ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zfkb1mxW_kEUryUOZ3g6yA.png"/></div></div></figure><p id="dca6" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">为了回答最初的问题，我们对表应用过滤标准。这告诉我们，一支球队需要平均领先 31.7 分钟才能确保欧洲足球！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi my"><img src="../Images/5d6b67ed20869df4d0b40429b1404dd9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vJU1eSGWZ0O6wHln6ulyCA.png"/></div></div></figure></div><div class="ab cl mz na hx nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="im in io ip iq"><h1 id="f706" class="kz la it bd lb lc ng le lf lg nh li lj jz ni ka ll kc nj kd ln kf nk kg lp lq bi translated"><strong class="ak">将新构建的数据帧与刮除的非表格数据合并</strong></h1><p id="696c" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在这个新成立的“合并英超联赛表”中增加一个奖金栏将会使它更具知识性。我们可以开始绘制英超比赛中平均领先时间和奖金之间的关系。</p><p id="90ac" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">然而，在这种情况下，当我访问一个网站时，例如 RadioTimes，我需要的数据不是我可以使用 pd.read_html 抓取的表格格式。</p><p id="7ad6" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这意味着我有两个目标。首先，收集数据，其次，我需要把它转换成一个数据帧，我可以合并到新成立的'合并 _ 英超 _ 联赛 _ 表'。</p><p id="bf02" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我首先从《广播时报》找到我需要的数据。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/61f0daac152b8a10a6fba133c978c30e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2mdgVU6_SCFjzHCyIUhhHw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk"><a class="ae ky" href="https://www.radiotimes.com/news/sport/2019-05-12/premier-league-prize-money-2018-2019/" rel="noopener ugc nofollow" target="_blank">Sourced from RadioTimes</a></figcaption></figure><p id="2b9a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">当我右键单击并选择 inspect 时，我可以看到底层的 HTML 源代码。我需要的信息嵌套在代表列表项的标签中。这些 li 标签位于一个<strong class="lt iu"> HTML &lt; ol &gt;标签中。</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nm"><img src="../Images/7fa470f4e0e365c620cfd960c3649f28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sKrGZg8mCQpwUbdJDqAPTQ.png"/></div></div></figure><p id="ac88" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">为了开始抓取这些数据，我导入了 requests 模块，并将感兴趣的 URL 放在 requests.get 方法的括号中。接下来，我导入 BeautifulSoup 来解析这个 HTML 代码，并将解析器参数设置为“html.parser”。然后，我使用 soup 对象的<strong class="lt iu"> findall </strong>方法来查找所有出现的“ol”。这将返回一个结果集对象，其行为类似于一个列表长度为 2 的 python 列表。我检查这两个列表，以找到我的信息所在的位置。我在变量名 prize_money_scrape 下索引第二个列表。为了查看这个列表的内容，我使用了 contents 属性。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mu mv l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/9e6a5f4394cdce4626822d70f49c186f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*htUEP4xcVEXMtDpv_BFIxQ.png"/></div></div></figure><p id="42a7" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">虽然这个列表提供了我需要的信息，但是每个列表项都由换行符分隔。由于这遵循一种常规模式，我可以使用索引符号来提供跳过这些换行符的步骤。我从元素 2 (python 的列表 1)开始我的新收入列表，并以步长 2[1::2]递增。</p><p id="8638" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">既然换行符已经从列表中删除，我需要从<li>标签中提取数据。为此，我创建了一个名为 records 的新的空列表，遍历收入列表中的元素，并从结果集对象中提取文本，然后追加到新列表中。为了确认这些工作正常，我打印了新的记录列表。</li></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/bfe1fc8547722bac0a1194b878c80fb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qQtXH1-gCViFjHSDOqd7-A.png"/></div></div></figure><p id="22b0" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我很喜欢熊猫的一点是，你可以把列表变成数据框。这样做很简单。现在，我可以通过将记录列表传递给 pd，将它转换成数据帧。DataFrame 方法。我在引号中的花括号内创建了一个新的列标题，用分号分隔，然后在结束花括号之前传入我的列表。当我可视化我的一列数据框架时，我可以看到它已经如预期的那样工作了。</p><p id="1347" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">新的数据框架有一列，将所有的信息转储在里面。理想的情况是“收入”和“团队”在不同的列中。为此，我在公共的 hypen (-)上拆分字符串，并使用 get 方法提取收入的第一个元素和团队的第二个元素，如下所示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/96a93ef50441e65e28180f5e1bf9bec0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3uwpb80HUGAuOvtJtkHjeg.png"/></div></div></figure><p id="bd20" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">为了与现有的 Premier League 表合并，我创建了一个新的公共列，它将在新抓取的 Premier_league_prize_money 数据框架和“Merged_premier_league_table”之间共享。我还删除了前缀“”符号和后缀“m”字符，将“收入”列转换为数字数据类型。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mu mv l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/24aff23aa2ef39877872e22b884bdc37.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z_ZWOIVW8Ipt9mfWzoVKrA.png"/></div></div></figure><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mu mv l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mx"><img src="../Images/05b7a913c5250efd2d329614bc4ccf3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dLqjuoKUQqccXuSpmTxMWw.png"/></div></div></figure><p id="a826" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">最后，我将 Team_x 列的名称改为 Team，并将“收入”列改为“奖金 _ 金钱 _ 百万”,这样就可以清楚地看出该列中的数值代表什么。</p><p id="59b1" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">最后，在连续变量‘奖金 _ 百万’和‘平均 _ 分钟 _ 领先’之间建立一个关系是有用的。在英超联赛中领先的平均上场时间和获得的奖金之间有很强的相关性是合理的，但为了明确起见，我可以使用下面显示的代码片段使用海运库中的<strong class="lt iu"> regplot </strong>函数绘制一个带有回归线的散点图(<em class="nr">这里，确保 seaborn 和 matplotlib 是通过 pip 命令安装的，并导入到您的 python 脚本</em>)。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mu mv l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/171dc9488a348afb3545e4bc4c34774a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NwTKX11lPoT4NJe3pxwbbQ.png"/></div></div></figure><p id="749f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">为了确定相关性，我使用了<strong class="lt iu"> DataFrame.corr </strong>方法。我已经将可选的方法参数设置为'<em class="nr"> pearson </em>'，但是也可以将<em class="nr"> kendall '和' spearman' </em>作为可选参数提供，以覆盖默认参数'<em class="nr"> pearson </em>'。</p><p id="263e" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">正如所料，这两个变量之间的相关性很强。正如可以合理预期的那样，你花在领导上的时间越多，获得的奖金就越多。</p><p id="530b" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">最后，作为总结，让我们看看最后一天的抽签对托特纳姆奖金的影响。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/f92905ff847396969b0478a47fd6ac1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r3w6_FXkaX5qkea-hxSVfg.png"/></div></div></figure><p id="e302" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">200 万！</p><p id="47db" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">足球<em class="nr">真的</em>是个结果生意！</p></div></div>    
</body>
</html>