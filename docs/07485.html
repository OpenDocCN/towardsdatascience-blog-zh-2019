<html>
<head>
<title>Exploratory Data Analysis in R for beginners (Part 2)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">面向初学者的 R 中的探索性数据分析(第 2 部分)</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/exploratory-data-analysis-in-r-for-beginners-part-2-5bfd35fc9781?source=collection_archive---------15-----------------------#2019-10-19">https://towardsdatascience.com/exploratory-data-analysis-in-r-for-beginners-part-2-5bfd35fc9781?source=collection_archive---------15-----------------------#2019-10-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="53df" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用“ggplot2”和“tidyverse”进行 EDA 的更高级方法</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/edc6af7a1ca9a2b114fb5d5c7c320213.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*I1D0IzP47T5vZeMU.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">ggplot2</figcaption></figure><p id="aff4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在我的上一篇文章，<a class="ae lu" rel="noopener" target="_blank" href="/exploratory-data-analysis-in-r-for-beginners-fe031add7072"> <strong class="la iu"> <em class="lv">初学者 R 中的探索性数据分析(第 1 部分)</em></strong></a>’中，我已经介绍了从数据导入到清理和可视化的基本分步方法。下面是第 1 部分的简要总结:</p><ul class=""><li id="02b8" class="lw lx it la b lb lc le lf lh ly ll lz lp ma lt mb mc md me bi translated">用<em class="lv"> fileEncoding </em>和<em class="lv"> na.strings </em>参数适当导入数据。我展示了它与使用 read.csv()导入 csv 文件的普通方式有何不同。</li><li id="32ff" class="lw lx it la b lb mf le mg lh mh ll mi lp mj lt mb mc md me bi translated">用“tidyverse”包清理数据的一些基本操作</li><li id="24aa" class="lw lx it la b lb mf le mg lh mh ll mi lp mj lt mb mc md me bi translated">“ggplot2”包中的箱线图、柱状图、相关图的可视化</li></ul><p id="68a1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这些是执行简单 EDA 的基本步骤。然而，为了让我们的图、图表和图形更丰富，当然也更具视觉吸引力，我们需要更进一步。我这么说是什么意思？让我们去发现它！</p><h1 id="1658" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">你希望在这篇文章中找到什么？</h1><p id="c9c6" class="pw-post-body-paragraph ky kz it la b lb nc ju ld le nd jx lg lh ne lj lk ll nf ln lo lp ng lr ls lt im bi translated">做 EDA 不仅仅是绘制图表。它是关于制作<strong class="la iu">信息图</strong>的。在本文中，您可能会发现以下技巧:</p><ol class=""><li id="02d5" class="lw lx it la b lb lc le lf lh ly ll lz lp ma lt nh mc md me bi translated">如何摆弄数据集以获得每种分析的最佳版本？没有放之四海而皆准的数据集。每个分析和可视化有不同的目的，因此有不同的数据结构。</li><li id="6490" class="lw lx it la b lb mf le mg lh mh ll mi lp mj lt nh mc md me bi translated">更改图中图例的顺序</li><li id="f822" class="lw lx it la b lb mf le mg lh mh ll mi lp mj lt nh mc md me bi translated">让 R 识别异常值，并在图上标记它们</li><li id="37fc" class="lw lx it la b lb mf le mg lh mh ll mi lp mj lt nh mc md me bi translated">使用'<strong class="la iu"> <em class="lv"> gridExtra </em> </strong>'包组合图形</li></ol><p id="7176" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">到本文结束时，您将能够生成以下图形:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/a9a3a4787ee96ad57b3eafb0f4afb46b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Os14FTTbOF-F9eHBC9R3TA.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/d36541b6ac45f874e0c45d727436dfc1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zxDzbRD8tIwdKzIymhrr8g.png"/></div></div></figure><p id="5f69" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们开始吧，伙计们！！！！</p><h1 id="37b3" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">来唤起你的记忆</h1><p id="ef28" class="pw-post-body-paragraph ky kz it la b lb nc ju ld le nd jx lg lh ne lj lk ll nf ln lo lp ng lr ls lt im bi translated">让我们快速查看一下我们在本系列的第 1 部分中创建的数据集类型。</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="9764" class="np ml it nl b gy nq nr l ns nt">view(df)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/ece9795590bf64b6afce9523c2a36926.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ZJ3VGYo05Q3SCRE1.png"/></div></div></figure><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="2d05" class="np ml it nl b gy nq nr l ns nt">View(df2)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/05daa0bda651158282cbf650156598f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:530/format:webp/0*qqsWVvC4aunZumzH.png"/></div></figure><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="dc0a" class="np ml it nl b gy nq nr l ns nt">View(df4) ## df3 combines with df2 to get df4</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/be93ac479402a62b75526a839eff9439.png" data-original-src="https://miro.medium.com/v2/resize:fit:644/format:webp/0*sz0mNtnfw5smGUyV.png"/></div></figure><p id="d650" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">请参考我的<a class="ae lu" rel="noopener" target="_blank" href="/exploratory-data-analysis-in-r-for-beginners-fe031add7072">上一篇文章</a>中关于如何操作原始数据集以获得这些不同版本的详细解释。</p><p id="5f9d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">太好了！让我们现在开始新的视觉情节</p><h1 id="e330" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">箱线图</h1><h2 id="d809" class="np ml it bd mm nx ny dn mq nz oa dp mu lh ob oc mw ll od oe my lp of og na oh bi translated"><strong class="ak">简单箱线图</strong></h2><p id="5a17" class="pw-post-body-paragraph ky kz it la b lb nc ju ld le nd jx lg lh ne lj lk ll nf ln lo lp ng lr ls lt im bi translated">首先，我们想实现这种箱线图</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oi"><img src="../Images/2dd0e405742fdf70f147e94ca7c05581.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_D3qw4L6llX7FsKTNBwgvw.png"/></div></div></figure><p id="faad" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为了得到这个，我们必须有一个数据框，其中<strong class="la iu">行</strong>是<strong class="la iu">国家</strong>和 4 列，即国家名称、数学、阅读和科学的百分比差异。现在回头参考我们之前创建的所有数据帧，我们可以看到<strong class="la iu"> df </strong>具有所有这些需求。因此，我们将从<strong class="la iu"> df </strong>中选择相关列，并将其命名为<strong class="la iu"> df5 </strong></p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="9893" class="np ml it nl b gy nq nr l ns nt">df5 = df[,c(1,11,12,13)]<br/>boxplot(df5$Maths.Diff, df5$Reading.Diff, df5$Science.Diff,<br/>        main = 'Are Males better than Females?',<br/>        names = c('Maths','Reading','Science'),<br/>        col = 'green'<br/>        )</span></pre><p id="abff" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">搞定了。按照这段代码，你应该能够得到如上图。</p><h2 id="c866" class="np ml it bd mm nx ny dn mq nz oa dp mu lh ob oc mw ll od oe my lp of og na oh bi translated">高层箱线图</h2><p id="c1c2" class="pw-post-body-paragraph ky kz it la b lb nc ju ld le nd jx lg lh ne lj lk ll nf ln lo lp ng lr ls lt im bi translated">现在我们想进入下一个阶段。这是我们想要得到的情节</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oj"><img src="../Images/56986077759ffdceb0966cc78466b8f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tPCppp2sqRZmfz3TECtWXw.png"/></div></div></figure><p id="aa8f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">请注意以下差异:</p><ol class=""><li id="0207" class="lw lx it la b lb lc le lf lh ly ll lz lp ma lt nh mc md me bi translated">副标题</li><li id="cdd7" class="lw lx it la b lb mf le mg lh mh ll mi lp mj lt nh mc md me bi translated">坐标轴的名称</li><li id="f74e" class="lw lx it la b lb mf le mg lh mh ll mi lp mj lt nh mc md me bi translated">离群值的布局和颜色。</li><li id="d4c1" class="lw lx it la b lb mf le mg lh mh ll mi lp mj lt nh mc md me bi translated">标题</li></ol><p id="a71a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">谢天谢地，'<strong class="la iu"> ggplot2 </strong>'包拥有我们需要的一切。问题只是我们能否在'<strong class="la iu"> ggplot2 </strong>'包中找到这些<strong class="la iu">参数</strong>和<strong class="la iu">函数</strong>。但是在我们继续讨论使用什么参数和函数之前，我们需要确定数据集应该是什么样的数据框架/结构。通过查看该图，我们可以看到数据框必须有<strong class="la iu"> 1 列 3 个类别(数学、阅读和科学)，1 列数字结果表示每个科目的成绩差异百分比，当然还有 1 列国家名称。因此总共有 3 列</strong>。</p><p id="6997" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在我们有了看起来像这样的 df5</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/4f3c9890332aa748fee6276c16e8223d.png" data-original-src="https://miro.medium.com/v2/resize:fit:820/format:webp/1*iKKR4t396Ze17lGYU3ECVQ.png"/></div></figure><p id="ea33" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们如何将它转换成上述的数据帧？还记得我在本系列<a class="ae lu" rel="noopener" target="_blank" href="/exploratory-data-analysis-in-r-for-beginners-fe031add7072">第 1 部分</a>介绍的一个招数吗，神奇的功能是<strong class="la iu"> pivot_longer()。</strong>现在，我们开始吧:</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="8f34" class="np ml it nl b gy nq nr l ns nt">df6 = df5 %&gt;% pivot_longer(c(2,3,4))<br/>names(df6) = c('Country','Test Diff','Result')<br/>View(df6)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/ac3b091116fe839ea11716f9397d01af.png" data-original-src="https://miro.medium.com/v2/resize:fit:590/format:webp/1*-CJX2NZ-ll00BZMcB-ODRA.png"/></div></figure><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="a341" class="np ml it nl b gy nq nr l ns nt">new = rep(c('Maths', 'Reading', 'Science'),68) #to create a new   column indicating 'Maths', 'Reading' and 'Science'</span><span id="fff5" class="np ml it nl b gy om nr l ns nt">df6 = cbind(df6, new)<br/>names(df6) = c('Country','Test Diff','Result', 'Test')   #change column names<br/>View(df6)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi on"><img src="../Images/1af6c260d5b3a000fe643b6f25b4073c.png" data-original-src="https://miro.medium.com/v2/resize:fit:690/format:webp/1*5CZxbpt5--46eKaw00y0Rg.png"/></div></figure><p id="63b9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">“Test Diff”列现在是多余的，所以您可以选择删除它，只需使用下面的代码。(这一步不是强制性的)</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="959a" class="np ml it nl b gy nq nr l ns nt">df6$'Test Diff' = NULL</span></pre><p id="cef2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在这里，我就不删了。</p><p id="640d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">太好了！现在，我们已经为可视化准备好了正确结构的数据集，现在让我们使用 ggplot</p><ol class=""><li id="5846" class="lw lx it la b lb lc le lf lh ly ll lz lp ma lt nh mc md me bi translated">要获取标题、副标题、题注，请使用<strong class="la iu"> labs(title = ' …'，y = ' …'，x = ' …'，caption = ' …'，subtitle = ' …') </strong></li><li id="6479" class="lw lx it la b lb mf le mg lh mh ll mi lp mj lt nh mc md me bi translated">如果标题或题注很长，使用<strong class="la iu"> ' …。\n …' </strong>将其分成两行。</li><li id="e7b7" class="lw lx it la b lb mf le mg lh mh ll mi lp mj lt nh mc md me bi translated">为了指示异常值，在 geom_boxplot()内</li></ol><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="4456" class="np ml it nl b gy nq nr l ns nt">geom_boxplot(alpha = 0.7,<br/>               outlier.colour='blue',   #color of outlier<br/>               outlier.shape=19,        #shape of outlier<br/>               outlier.size=3,          #size of outlier<br/>               width = 0.6, color = "#1F3552", fill = "#4271AE"<br/>               )</span></pre><p id="16cb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">将一切结合在一起:</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="30ef" class="np ml it nl b gy nq nr l ns nt">ggplot(data = df6, aes(x=Test,y=Result, fill=Test)) + <br/>  geom_boxplot(alpha = 0.7,<br/>               outlier.colour='blue', <br/>               outlier.shape=19, <br/>               outlier.size=3, <br/>               width = 0.6, color = "#1F3552", fill = "#4271AE"<br/>               )+<br/>  theme_grey() +<br/>  labs(title = 'Did males perform better than females?',<br/>       y='% Difference from FEMALES',x='',<br/>       caption  = 'Positive % Difference means Males performed \n better than Females and vice versa',<br/>       subtitle = 'Based on PISA Score 2015')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/7d58ece1b8e768e9d2a3bb8a4e21c50b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PyFF2VeGr88Qi0yh5wDwpg.png"/></div></div></figure><p id="3408" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这样够好了吗？答案是<strong class="la iu">否:</strong>题注、片头和字幕太小，情节的比例和大小都不如我们在这一节开头介绍的情节。</p><p id="5e66" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们可以做得更好。</p><p id="a426" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">要调整尺寸等，使用<strong class="la iu">主题()</strong>功能</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="454c" class="np ml it nl b gy nq nr l ns nt">theme(axis.text=element_text(size=20),<br/>        plot.title = element_text(size = 20, face = "bold"),<br/>        plot.subtitle = element_text(size = 10),<br/>        plot.caption = element_text(color = "Red", face = "italic", size = 13)<br/>      <br/>        )</span></pre><p id="120c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在这里，不要问我如何得到这些数字。这是试错法。你可以尝试任何数字，直到你得到完美的尺寸和位置。</p><p id="6b0d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在让我们把所有的东西结合在一起</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="68c9" class="np ml it nl b gy nq nr l ns nt">ggplot(data = df6, aes(x=Test,y=Result, fill=Test)) + <br/>  geom_boxplot(alpha = 0.7,<br/>               outlier.colour='blue', <br/>               outlier.shape=19, <br/>               outlier.size=3, <br/>               width = 0.6, color = "#1F3552", fill = "#4271AE"<br/>               )+<br/>  theme_grey() +<br/>  labs(title = 'Did males perform better than females?',<br/>       y='% Difference from FEMALES',x='',<br/>       caption  = 'Positive % Difference means Males performed \n better than Females and vice versa',<br/>       subtitle = 'Based on PISA Score 2015') + <br/>theme(axis.text=element_text(size=20),<br/>        plot.title = element_text(size = 20, face = "bold"),<br/>        plot.subtitle = element_text(size = 10),<br/>        plot.caption = element_text(color = "Red", face = "italic", size = 13)<br/>)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/dd9ae20e5a6389eacb26a484b578962c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h37Xk0zy61kggk-M78KGaA.png"/></div></div></figure><p id="5f19" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在剧情看起来好多了。你可以停在这里。但是，我想介绍一种方法，重新排列变量的顺序，得到一个递减的趋势。简单使用</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="b61e" class="np ml it nl b gy nq nr l ns nt">scale_x_discrete(limits=c("Maths","Science","Reading"))</span></pre><p id="73a4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因此，结合一切</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="c3cd" class="np ml it nl b gy nq nr l ns nt">ggplot(data = df6, aes(x=Test,y=Result, fill=Test)) + <br/>  geom_boxplot(alpha = 0.7,<br/>               outlier.colour='blue', <br/>               outlier.shape=19, <br/>               outlier.size=3, <br/>               width = 0.6, color = "#1F3552", fill = "#4271AE"<br/>               )+<br/><strong class="nl iu">scale_x_discrete(limits=c("Maths","Science","Reading"))+</strong></span><span id="fa4e" class="np ml it nl b gy om nr l ns nt">  theme_grey() +<br/>  labs(title = 'Did males perform better than females?',<br/>       y='% Difference from FEMALES',x='',<br/>       caption  = 'Positive % Difference means Males performed \n better than Females and vice versa',<br/>       subtitle = 'Based on PISA Score 2015') + <br/>theme(axis.text=element_text(size=20),<br/>        plot.title = element_text(size = 20, face = "bold"),<br/>        plot.subtitle = element_text(size = 10),<br/>        plot.caption = element_text(color = "Red", face = "italic", size = 13)<br/>)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi op"><img src="../Images/35b212f1c06b5724161b4dda49aa784c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b4678ahcmtPKpq5jpQalKw.png"/></div></figure><p id="6c67" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">厉害！！现在剧情看起来真的很有知识性。然而，更好的数据分析师会产生更丰富的信息，如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oq"><img src="../Images/dcd2cb24c4c3e4f840260d90cd70cbda.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kPYD_B_Z_4Fh4Ru9nlK9MA.png"/></div></div></figure><h2 id="a529" class="np ml it bd mm nx ny dn mq nz oa dp mu lh ob oc mw ll od oe my lp of og na oh bi translated">怎样才能让 R 识别出离群值，并为我们贴上标签？</h2><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="8fb6" class="np ml it nl b gy nq nr l ns nt">df6$Test = factor(df6$Test, levels = c("Maths","Science","Reading"))  # To change order of legend</span></pre><p id="8776" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们来定义离群值。这部分需要一点统计学知识。我会推荐你在这里阅读迈克尔·加拉尼克的文章<a class="ae lu" rel="noopener" target="_blank" href="/understanding-boxplots-5e2df7bcbd51">。他很好地解释了这些概念。</a></p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="b335" class="np ml it nl b gy nq nr l ns nt">is_outlier &lt;- function(x) {<br/>   return(x &lt; quantile(x, 0.25) - 1.5 * IQR(x) | x &gt; quantile(x, 0.75) + 1.5 * IQR(x))<br/>}   # define a function to detect outliers</span><span id="f12a" class="np ml it nl b gy om nr l ns nt">str(df6)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/24454cf0c89acff3424fb9921cac010b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yfJl9BTuZVs9c1envtg90A.png"/></div></div></figure><p id="b901" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">请注意，列“国家”和“测试”是因子。首先让我们把它改成字符。</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="a56b" class="np ml it nl b gy nq nr l ns nt">df6$Country = as.character(df6$Country)<br/>df7 &lt;- df6  %&gt;% group_by(as.character(Test)) %&gt;% <br/>  mutate(is_outlier=ifelse(is_outlier(Result), Country, as.numeric(NA)))</span><span id="2c2b" class="np ml it nl b gy om nr l ns nt">### What we are doing now is that we are creating a new data frame with the last column 'is_outlier' indicating whether the data point is an outlier or not</span><span id="3136" class="np ml it nl b gy om nr l ns nt">View(df7)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi os"><img src="../Images/9fa66d9145b92615c9e5467255e01504.png" data-original-src="https://miro.medium.com/v2/resize:fit:1174/format:webp/1*1wOlqaFSS7SpM4xgZa5WqA.png"/></div></figure><p id="f882" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如您所见，数据框的最后一列显示 Jordan 是一个异常值。现在，在“Country”列，我们希望确保只标记异常值，其余的应该标记为“NA”。这将有助于我们以后编写可视化绘图代码。</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="453d" class="np ml it nl b gy nq nr l ns nt">df7$Country[which(is.na(df7$is_outlier))] &lt;- as.numeric(NA)<br/>View(df7)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/3a393a45ce6456022a7ac9706485cedf.png" data-original-src="https://miro.medium.com/v2/resize:fit:974/format:webp/1*8cO2gWAnzQUKiOC4QLyMvA.png"/></div></figure><p id="7b11" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，让我们绘制图表。与上面相同的代码。然而，我们需要添加<strong class="la iu"> geom_text () </strong>来标记异常值</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="b540" class="np ml it nl b gy nq nr l ns nt">ggplot(data = df7, aes(x=Test,y=Result, fill=Test)) + <br/>  geom_boxplot(alpha = 0.7,<br/>               outlier.colour='red', <br/>               outlier.shape=19, <br/>               outlier.size=3, <br/>               width = 0.6)+<br/>  <strong class="nl iu">geom_text(aes(label = Country), na.rm = TRUE, hjust = -0.2)</strong>+         <br/>  theme_grey() +<br/>  labs(title = 'Did males perform better than females?',<br/>       y='% Difference from FEMALES',x='',<br/>       caption  = 'Positive % Difference means Males performed \n better than Females and vice versa',<br/>       subtitle = 'Based on PISA Score 2015') + <br/>  theme(axis.text=element_text(size=20),<br/>        legend.text = element_text(size = 16), <br/>        legend.title = element_text(size = 16),<br/>        <br/>        legend.position = 'right', aspect.ratio = 1.4,<br/>        plot.title = element_text(size = 20, face = "bold"),<br/>        plot.subtitle = element_text(size = 10),<br/>        plot.caption = element_text(color = "Red", face = "italic", size = 13)<br/>  )</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ou"><img src="../Images/c674f13081aee790a5e851f169099522.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DLb66qkmrog4JS4j4umpmw.png"/></div></div></figure><h2 id="d36b" class="np ml it bd mm nx ny dn mq nz oa dp mu lh ob oc mw ll od oe my lp of og na oh bi translated">组合多个地块</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/d36541b6ac45f874e0c45d727436dfc1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zxDzbRD8tIwdKzIymhrr8g.png"/></div></div></figure><p id="3007" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">对于上面组合情节中的每个情节，我们已经在本系列的<a class="ae lu" rel="noopener" target="_blank" href="/exploratory-data-analysis-in-r-for-beginners-fe031add7072">第一部</a>中讲述了如何创建它。以下是概要:</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="895c" class="np ml it nl b gy nq nr l ns nt">plot1 = ggplot(data=df, aes(x=reorder(Country.Name, Maths.Diff), y=Maths.Diff)) +<br/>  geom_bar(stat = "identity", aes(fill=Maths.Diff)) +<br/>  coord_flip() +<br/>  theme_light() +<br/>  geom_hline(yintercept = mean(df$Maths.Diff), size=1, color="black") +<br/>  labs(x="", y="Maths")+<br/>  scale_fill_gradient(name="% Difference Level", low = "red", high = "green")+<br/>  theme(legend.position = "none")<br/></span><span id="b4c1" class="np ml it nl b gy om nr l ns nt">plot2 = ggplot(data=df, aes(x=reorder(Country.Name, Reading.Diff), y=Reading.Diff)) +<br/>  geom_bar(stat = "identity", aes(fill=Reading.Diff)) +<br/>  coord_flip() +<br/>  theme_light() +<br/>  geom_hline(yintercept = mean(df$Reading.Diff), size=1, color="black") +<br/>  labs(x="", y="Reading")+<br/>  scale_fill_gradient(name="% Difference Level", low = "red", high = "green") +<br/>  theme(legend.position = "none")<br/></span><span id="001b" class="np ml it nl b gy om nr l ns nt">plot3 = ggplot(data=df, aes(x=reorder(Country.Name, Science.Diff), y=Science.Diff)) +<br/>  geom_bar(stat = "identity", aes(fill=Science.Diff)) +<br/>  coord_flip() +<br/>  theme_light() +<br/>  geom_hline(yintercept = mean(df$Science.Diff), size=1, color="black") +<br/>  labs(x="", y="Science")+<br/>  scale_fill_gradient(name="% Difference", low = "red", high = "green") +<br/>  theme(legend.position = "none")</span></pre><p id="4e4a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">要将它们结合在一起，请使用“gridExtra”包。</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="40c0" class="np ml it nl b gy nq nr l ns nt">install.packages('gridExtra')<br/>library(gridExtra)</span><span id="8831" class="np ml it nl b gy om nr l ns nt">grid.arrange(plot1, plot2,plot3, nrow = 1,<br/>             top = 'Are Males better than Females?',<br/>             bottom = '% Difference from Females'<br/>             )</span><span id="c30a" class="np ml it nl b gy om nr l ns nt">#nrow=1 means all the plots are placed in one row</span></pre><p id="4dd5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">就是这样！同样，我希望你们喜欢这篇文章，并从中有所收获。当然，本指南并不详尽，还有很多其他技术可以用来做 EDA。然而，我相信这个指南或多或少会给你一些如何用 R 从一个简单的情节改进到一个更复杂和更有信息的情节的想法。</p><p id="dff6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你有任何问题，请在下面的评论区写下来。再次感谢您的阅读。祝您愉快，编程愉快！！！</p></div></div>    
</body>
</html>