<html>
<head>
<title>Deep Learning for Clinical Diagnostics</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用于临床诊断的深度学习</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/deep-learning-for-clinical-diagnostics-ca7bc254e5ac?source=collection_archive---------17-----------------------#2019-05-20">https://towardsdatascience.com/deep-learning-for-clinical-diagnostics-ca7bc254e5ac?source=collection_archive---------17-----------------------#2019-05-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="25a0" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsdatascience.com/tagged/dl-for-life-sciences" rel="noopener" target="_blank">生命科学的深度学习</a></h2><div class=""/><div class=""><h2 id="f97e" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">利用深度学习进行更安全的生物医学预测</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/ecf1ad4e6a36b67a89d99e1fa069b9fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*inEhq_u3Hfa2aknUm7XCyA.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk"><a class="ae lh" href="https://unsplash.com/photos/7jjnJ-QA9fY" rel="noopener ugc nofollow" target="_blank">Image source</a></figcaption></figure><p id="7bf7" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这是系列<strong class="lk jd">生命科学深度学习</strong>的第四篇文章。在之前的帖子中，我展示了如何使用<a class="ae lh" rel="noopener" target="_blank" href="/deep-learning-on-ancient-dna-df042dc3c73d">深度学习古 DNA </a> <a class="ae lh" rel="noopener" target="_blank" href="/deep-learning-for-single-cell-biology-935d45064438">、深度学习单细胞生物学</a>和<a class="ae lh" rel="noopener" target="_blank" href="/deep-learning-for-data-integration-46d51601f781">深度学习数据整合</a>。现在，我们将深入生物医学，了解我们为什么以及如何将贝叶斯深度学习用于患者安全。</p><p id="dee0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><a class="ae lh" href="https://en.wikipedia.org/wiki/DNA_sequencing" rel="noopener ugc nofollow" target="_blank">下一代测序(NGS) </a>为我们理解导致常见人类疾病的致病机制提供了重大进展。然而，<strong class="lk jd">数据量仍然是生物医学分析的瓶颈</strong>。与数据科学相比，数百万个例子在生物医学中相当罕见，而高维数据却非常典型，因此<strong class="lk jd">机器学习</strong>在生物医学中的应用非常有限。数据的缺乏和高维参数空间阻碍了临床诊断的精确性，带来了许多在临床试验中不成立的<strong class="lk jd">错误预测</strong>。当数据稀疏/稀缺/嘈杂和高维时，<strong class="lk jd">贝叶斯统计</strong>有助于做出概化预测。</p><p id="799f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这里我们将讨论如何用 PyMC3 实现<strong class="lk jd">贝叶斯深度学习</strong>，以确保<strong class="lk jd">患者安全</strong>并为临床诊断提供更加准确和智能的预测。</p><h1 id="0a03" class="me mf it bd mg mh mi mj mk ml mm mn mo ki mp kj mq kl mr km ms ko mt kp mu mv bi translated">运行深度学习时为什么要做贝叶斯？</h1><p id="a56e" class="pw-post-body-paragraph li lj it lk b ll mw kd ln lo mx kg lq lr my lt lu lv mz lx ly lz na mb mc md im bi translated">在之前的<a class="ae lh" rel="noopener" target="_blank" href="/deep-learning-for-single-cell-biology-935d45064438">帖子</a>中，我解释了在进行统计分析时，你应该特别注意统计观测值的数量<strong class="lk jd"> N </strong>和你的空间的维度，即特征的数量<strong class="lk jd"> P </strong>之间的平衡。根据数据量，您可以在<strong class="lk jd">贝叶斯统计、频率统计和机器/深度学习</strong>之间进行选择。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nb"><img src="../Images/13641087c16af89c246b6f4b7b1ff561.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XvbK9zzJljlropYJIFiIJg.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk">Deep Learning makes sense to use only when you have a lot of data</figcaption></figure><p id="3e09" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">所以当你拥有大量数据时使用深度学习是有意义的，因为你可以放弃线性代数的枯燥世界，跳进<strong class="lk jd">非线性数学</strong>的兔子洞。相比之下，生物医学通常在相反的极限下工作，N &lt; &lt; P，需要<strong class="lk jd">优于</strong> <strong class="lk jd">来弥补数据的不足。</strong>这就是<strong class="lk jd">生物医学分析为什么要贝叶斯的第一个理由</strong>。</p><p id="aff0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在想象一下，你得到了一些生物医学大数据，这是不常见的，但不是不可能的，如果一个人从事成像或单细胞生物学工作，你可以而且应该进行深度学习。但在这种情况下你为什么要做贝叶斯呢？</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/904a2210867769780c067a3391f07b0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1366/format:webp/1*n9ej5YIEE_ordJCSsg77fg.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk">Images are adapted from <a class="ae lh" href="https://emtiyaz.github.io/papers/ukjapan2018.pdf" rel="noopener ugc nofollow" target="_blank">Emtiyaz Khan</a> and <a class="ae lh" href="https://alexgkendall.com/computer_vision/bayesian_deep_learning_for_safe_ai/" rel="noopener ugc nofollow" target="_blank">Alex Kendall</a></figcaption></figure><p id="9b10" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">第二个原因<strong class="lk jd">来了:通过将<strong class="lk jd">不确定性</strong>合并到模型中来生成<strong class="lk jd">不太明确的</strong>(与传统的基于频率主义者的深度学习相比)预测的必要性。这对错误预测代价非常高的领域非常重要，例如<strong class="lk jd">自动驾驶汽车、模拟股票市场、地震，特别是</strong> <strong class="lk jd">临床诊断</strong>。</strong></p><h1 id="d0bc" class="me mf it bd mg mh mi mj mk ml mm mn mo ki mp kj mq kl mr km ms ko mt kp mu mv bi translated">为什么不是生物医学的频率分析？</h1><p id="38fe" class="pw-post-body-paragraph li lj it lk b ll mw kd ln lo mx kg lq lr my lt lu lv mz lx ly lz na mb mc md im bi translated">将频率统计应用于临床诊断时，有许多理由需要谨慎。它在很大程度上基于<strong class="lk jd">正态假设</strong>，因此<strong class="lk jd">对异常值</strong>敏感，它使用<strong class="lk jd">描述性统计</strong>进行操作，这些统计并不总是反映潜在的数据分布，因此无法正确捕捉<a class="ae lh" href="https://en.wikipedia.org/wiki/Anscombe%27s_quartet" rel="noopener ugc nofollow" target="_blank"> Anscombe 四重奏</a>中数据集之间的差异。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nd"><img src="../Images/b5442433de045fa7dcdd2959954418ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oMbcPjuDprAu_QAGizFf7g.png"/></div></div></figure><p id="1e5d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">相比之下，Anscombe 数据集的贝叶斯概率模型将导致概率分布的巨大差异。</p><blockquote class="ne"><p id="a086" class="nf ng it bd nh ni nj nk nl nm nn md dk translated">智慧就是知道你不知道多少</p></blockquote><p id="f040" class="pw-post-body-paragraph li lj it lk b ll no kd ln lo np kg lq lr nq lt lu lv nr lx ly lz ns mb mc md im bi translated">有几个通常被称为<strong class="lk jd"> Data Saurus </strong>的著名例子，进一步证明了 Frequentist 统计无法捕捉具有相同<strong class="lk jd">描述性统计(如均值、标准差或皮尔逊相关系数</strong>)的样本组之间的差异。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nt"><img src="../Images/e0549dc08dab969b9b0b67549912cee8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uzVmvgn7I-t9x5MTByQg_A.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk"><a class="ae lh" href="https://www.autodeskresearch.com/publications/samestats" rel="noopener ugc nofollow" target="_blank">Image source</a></figcaption></figure><p id="c019" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">因此，<strong class="lk jd">过于简单的频率分析不应用于临床诊断</strong>，因为在临床诊断中，我们不能做出会损害人们生命的错误预测。</p><h1 id="87db" class="me mf it bd mg mh mi mj mk ml mm mn mo ki mp kj mq kl mr km ms ko mt kp mu mv bi translated">基于 PyMC3 的贝叶斯深度学习</h1><p id="4784" class="pw-post-body-paragraph li lj it lk b ll mw kd ln lo mx kg lq lr my lt lu lv mz lx ly lz na mb mc md im bi translated">这里，我将使用关于<a class="ae lh" href="https://www.nature.com/articles/s41467-018-07582-3" rel="noopener ugc nofollow" target="_blank"><strong class="lk jd"/></a>癌症相关成纤维细胞的 scRNAseq 数据，并应用贝叶斯深度学习对它们在恶性和非恶性细胞类型之间进行分类。<a class="ae lh" href="https://www.ncbi.nlm.nih.gov/pubmed/29503172" rel="noopener ugc nofollow" target="_blank">以类似的方式</a>、<strong class="lk jd">糖尿病患者</strong>可以被分配到特定的疾病子类型，以获得精确的治疗处方。我们先从<a class="ae lh" href="https://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE111229" rel="noopener ugc nofollow" target="_blank">这里</a>下载表达式数据，加载到 Python 中，拆分成训练和验证子集，用<a class="ae lh" href="https://en.wikipedia.org/wiki/T-distributed_stochastic_neighbor_embedding" rel="noopener ugc nofollow" target="_blank"> tSNE </a>可视化。通常，表达式矩阵的行是样本/细胞，列是特征/基因，最后一列包含来自无偏<a class="ae lh" href="https://en.wikipedia.org/wiki/DBSCAN" rel="noopener ugc nofollow" target="_blank"> DBSCAN </a>聚类的细胞标签。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nu nv l"/></div></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nw"><img src="../Images/c82117cbaf0ecc86acf2902a2ccc6268.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vrkYg0M5jGltDPxvfPuDeg.png"/></div></div></figure><p id="369d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在 tSNE 图中，四个聚类清晰可辨。接下来，我们将构建一个具有一个隐藏层和 16 个神经元的<strong class="lk jd">贝叶斯神经网络(BNN) </strong>模型，这是通过向权重和偏差分配正常先验并用随机值初始化它们来完成的。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/d5dd66fee1a894fc7c82584cf802b5eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1378/format:webp/1*2YmT8EvIelQEjVqRWajKAQ.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk"><a class="ae lh" href="https://medium.com/@joeDiHare/deep-bayesian-neural-networks-952763a9537" rel="noopener">Image source</a></figcaption></figure><p id="f05b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">为了构建 BNN，我将使用 PyMC3 并遵循 Thomas Wiecki 的博客中描述的方法。在模型中，我们还定义了一个<strong class="lk jd">分类分布</strong>的可能性，因为我们正在处理一个 scRNAseq 多类(4 类)分类问题。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="9cde" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">通过赋予权重和偏差先验，我们让模型知道那些参数具有<strong class="lk jd">不确定性</strong>，因此<a class="ae lh" href="https://en.wikipedia.org/wiki/Markov_chain_Monte_Carlo" rel="noopener ugc nofollow" target="_blank"> <strong class="lk jd"> MCMC </strong> </a> <strong class="lk jd">采样器</strong>将为它们建立后验分布。现在，我们将定义一个函数，该函数使用称为 NUTS 的<a class="ae lh" href="https://en.wikipedia.org/wiki/Hamiltonian_Monte_Carlo" rel="noopener ugc nofollow" target="_blank"> <strong class="lk jd">哈密顿蒙特卡罗</strong> </a>(与 Metropolis 相比，当可以计算参数的导数时，这是一个更快的采样器)算法之一，从贝叶斯神经网络的参数的后验中抽取样本。取样是 BNN 的训练。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="c593" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在，我们将使用<a class="ae lh" href="https://docs.pymc.io/notebooks/posterior_predictive.html" rel="noopener ugc nofollow" target="_blank">后验预测检查(PPC) </a>程序来<strong class="lk jd">验证</strong>贝叶斯神经网络模型的预测。为此，我们将使用经过训练的模型，并在 tNSE 图上为测试子集绘制<strong class="lk jd">决策边界</strong>。决策边界是通过在 tSNE 图上构建 100 x 100 的网格并对网格的每个点运行模型预测来创建的。接下来，我们计算网格上每个点分配给 4 个单元子类型之一的概率的平均值和标准偏差，并可视化<strong class="lk jd">平均概率和概率的不确定性</strong>。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nu nv l"/></div></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ny"><img src="../Images/8796cd83d97c12266ae1baaf89467ebf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NySxl9KjPCnFCELXGzegNg.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk">Probabilistic decision boundary together with uncertainty map for CAFs classification</figcaption></figure><p id="4e51" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">上面的图对应于测试子集上的 tSNE(左上)；测试子集上的 tSNE，每个点分配到 4 个细胞亚型中的任何一个的平均概率(右上)，这基本上是<strong class="lk jd">最大似然/频率主义神经网络</strong>将预测的；和 tSNE 在测试子集上，每个点分配给 4 个细胞子类型(右下)的概率的不确定性，这是<strong class="lk jd">贝叶斯神经网络</strong>的特定输出。这里，红色和蓝色分别表示将 tSNE 点分配给任何单元子类型的高概率和低概率。不确定性热图中较暗的区域表示不确定性较高的区域。</p><p id="e887" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们可以立即看到，平均概率热图包含<strong class="lk jd">来自黄色类别的两个单元，以 100%的概率分配给紫色聚类</strong>。这是一个严重的错误分类，也是最大似然/频率主义神经网络失败的证明。相比之下，不确定性热图显示两个黄色单元落在相对较暗的区域，这意味着<strong class="lk jd">贝叶斯神经网络根本不确定是否将这些单元分配到任何聚类</strong>。这个例子展示了贝叶斯深度学习在进行更安全和更不激进的分类方面的能力，这对于临床诊断尤其重要。</p><h1 id="1d58" class="me mf it bd mg mh mi mj mk ml mm mn mo ki mp kj mq kl mr km ms ko mt kp mu mv bi translated">摘要</h1><p id="16cb" class="pw-post-body-paragraph li lj it lk b ll mw kd ln lo mx kg lq lr my lt lu lv mz lx ly lz na mb mc md im bi translated">在这里，我们已经了解到贝叶斯深度学习是一种更加准确和安全的预测方式，这对于在临床诊断中使用非常有意义，在临床诊断中我们不允许被治疗处方所误导。我们使用了<strong class="lk jd"> PyMC3 和 MCMC </strong>来构建贝叶斯神经网络模型，并从样本分配到恶性与非恶性类别的后验概率中取样。最后，我们证明了贝叶斯深度学习在利用不确定性信息避免样本错误分类方面优于频率主义方法。</p><p id="69a8" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">像往常一样，如果你在生命科学中有特别喜欢的领域，想在深度学习框架中解决，请在评论中告诉我。在 twitter @NikolayOskolkov 的 Medium <a class="nz oa ep" href="https://medium.com/u/8570b484f56c?source=post_page-----ca7bc254e5ac--------------------------------" rel="noopener" target="_blank"> Nikolay Oskolkov、</a>关注我，并在我的<a class="ae lh" href="https://github.com/NikolayOskolkov/DeepLearningClinicalDiagnostics" rel="noopener ugc nofollow" target="_blank"> github </a>上查看这篇文章的代码。我计划写下一篇关于<strong class="lk jd">显微图像分析深度学习</strong>的帖子，敬请关注。</p></div></div>    
</body>
</html>