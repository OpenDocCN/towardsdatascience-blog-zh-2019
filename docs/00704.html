<html>
<head>
<title>Deep Learning with Satellite Data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">利用卫星数据进行深度学习</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/deep-learning-with-satellite-data-b78b20708de?source=collection_archive---------4-----------------------#2019-02-02">https://towardsdatascience.com/deep-learning-with-satellite-data-b78b20708de?source=collection_archive---------4-----------------------#2019-02-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="376b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="kl">“我们现在正在创造的火箭、卫星、宇宙飞船，<br/>我们正在给宇宙授粉。”——尼尔·杨</em></p><h1 id="bcef" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated"><strong class="ak">概述—卫星数据—数据收集—模型—结果</strong></h1><p id="9474" class="pw-post-body-paragraph jn jo iq jp b jq lk js jt ju ll jw jx jy lm ka kb kc ln ke kf kg lo ki kj kk ij bi translated"><strong class="jp ir">概述</strong></p><p id="1fa8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">今年 1 月在意大利贝内文托的桑尼奥大学，我和我的朋友图马斯·奥伊卡里宁(Tuomas Oikarinen)创建了一个(半自动)下载公开图片的管道，并根据数据训练了一个三维卷积神经网络。最终，我们的模型在 Sentinel-2 光学卫星图像上实现了大约 0.65 的平衡精度。我将更详细地介绍结果(以及为什么这个模型实际上是有用的)。在 Silvia Ullo 的指导下，在她的研究生 Maria Pia Del Rosso、Alejandro Sebastianelli 和 Federico Picarillo 的帮助下，我们最终向一个遥感会议提交了一篇论文[1]!</p><p id="b604" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你想直接进入代码，这里的是到 Github 库的直接链接。</p><p id="8af5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我将以相对技术性的方式(包括代码)描述如何从 google earth 引擎快速下载一些卫星图像，然后用它们来训练一个 3 维卷积神经网络。</p><p id="9b1f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">具体来说，我们使用成对的图像(一个滑坡图像，一个相同地理区域但没有滑坡的图像)作为训练示例。然而，这对于涉及使用公共卫星数据作为影像模型的任何情况都是有帮助的。</p><p id="72b2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">卫星数据</strong></p><p id="cef5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在开始收集数据之前，有必要大致了解一下我们将要使用的卫星图像的类型。最容易处理和广泛提供的最新卫星数据来自哥白尼卫星计划。构成哥白尼计划的卫星被称为<a class="ae lp" href="https://www.wikiwand.com/en/Copernicus_Programme#/Earth_Observation_missions" rel="noopener ugc nofollow" target="_blank">哨兵卫星</a>。为了观察地面的变化，哨兵 1 号和哨兵 2 号卫星是最有用的。Sentinel-1 提供雷达成像和比 Sentinel-2 更高的分辨率，但也更难使用。与 Sentinel-2 图像相比，你必须对雷达图像进行更多的处理，Sentinel-2 图像基本上适合在裁剪和下载后立即使用。我们最终使用 Sentinel-2 的图像来训练我们的模型。</p><p id="3d86" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面是我们能找到的山体滑坡前后卫星图像的最佳例子。</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi lq"><img src="../Images/333350a2abd00bccb5e2aa8f1dd64fd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*KQGr93m47hJ38s9T"/></div></div><figcaption class="mc md gj gh gi me mf bd b be z dk">Before the landslide</figcaption></figure><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi lq"><img src="../Images/dedcd3740c870e9fbafd06e5161c5add.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*e7L9dbyouA6LJL5t"/></div></div><figcaption class="mc md gj gh gi me mf bd b be z dk">After the landslide</figcaption></figure><p id="c73e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们拥有的绝大多数其他图像对都不那么清晰。即使是这个例子，你也可以看到云层覆盖，光照条件和植被颜色都有很大的不同。此外，我们可以找到的所有自动处理滑坡的不同方法都使用了输入支持向量机的特征，如坡度、土地覆盖、坡向、地形湿度指数等(关于这些方法的论文，见<a class="ae lp" href="https://link.springer.com/article/10.1007%2Fs10346-013-0391-7" rel="noopener ugc nofollow" target="_blank">此处</a>和<a class="ae lp" href="https://www.sciencedirect.com/science/article/pii/S0169555X13004182" rel="noopener ugc nofollow" target="_blank">此处</a>)。这里我们感兴趣的问题是<em class="kl">一个模型能从少量的光学图像中学到任何关于危险探测的东西吗？</em></p><p id="efe4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">数据采集</strong></p><p id="9e27" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">给我们的标签来自<a class="ae lp" href="https://data.nasa.gov/Earth-Science/Global-Landslide-Catalog/h9d8-neg4/data" rel="noopener ugc nofollow" target="_blank"> NASA 全球滑坡目录</a>，记录了 2000 年代初至 2017 年末的滑坡。这是我们必须处理的编辑版本的截屏:</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi mg"><img src="../Images/6dac90a0bf5587637e42e004c800ceec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TmrEnH2vL3EvbRhqAcc9Tw.png"/></div></div><figcaption class="mc md gj gh gi me mf bd b be z dk">Processed Landslide Catalog</figcaption></figure><p id="3846" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">绿色表示好数据，红色表示差数据，灰色表示位置精度太低，无法保证裁剪会捕捉到它。</p><p id="c9ee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">整个项目的第一个也是最困难的部分是收集标记数据的干净样本。在花了大量时间摆弄 ESA Copernicus SciHub(欧洲航天局用于下载卫星图像的在线用户界面)之后，我们意识到要实现下载过程的自动化是相当困难的。第一个问题是，你不能在网站上的任何地方手动输入坐标，还有一个事实是，你必须下载整个卫星“图像”，在给定的日期，它覆盖了大约三分之一非洲大小的区域。对于每个示例来说，这最终都超过了 7gb；对我们笔记本电脑的存储容量来说太多了。雪上加霜的是，你不得不花半个小时在地理数据处理软件<a class="ae lp" href="http://step.esa.int/main/toolboxes/snap/" rel="noopener ugc nofollow" target="_blank"> SNAP </a>中预处理图像(顺便提一下，这也很难自动化)。</p><p id="671d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">相反，我们求助于<a class="ae lp" href="https://code.earthengine.google.com/f1d4022a395f2f2f6a4dd53da2cf3b8e?noload=1" rel="noopener ugc nofollow" target="_blank">谷歌地球引擎</a>，它可以根据日期、作物进行过滤，显示云密度并提供下载链接，只需点击一个按钮！我们确实花了一段时间来弄清楚如何做到这一点，因为缺乏关于地球引擎的例子/稀疏的文档。<a class="ae lp" href="https://developers.google.com/earth-engine/" rel="noopener ugc nofollow" target="_blank">入门指南</a>确实给出了你可以期待的 Javascript API 的功能概述，所以我仍然推荐从那里开始。</p><p id="7b57" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">快速提示:你必须注册成为谷歌地球引擎开发者才能访问我们使用的控制台。幸运的是，这个过程非常简单，你应该很快就能获得批准。按照说明在这里报名<a class="ae lp" href="https://signup.earthengine.google.com/#!/" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="46a3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们的最终(半)自动化流水线是如何结束工作的，如下所示:</p><ol class=""><li id="32ac" class="mh mi iq jp b jq jr ju jv jy mj kc mk kg ml kk mm mn mo mp bi translated">在<code class="fe mq mr ms mt b"><a class="ae lp" href="https://github.com/Yichabod/natural_disaster_pred/blob/master/cropping_coordinates.py" rel="noopener ugc nofollow" target="_blank">cropping_coordinates.py</a></code>中输入坐标，计算一个 10 公里见方的坐标。</li><li id="a48f" class="mh mi iq jp b jq mu ju mv jy mw kc mx kg my kk mm mn mo mp bi translated">复制输出并替换 Google Earth 引擎控制台中 javascript 代码顶部的变量(<a class="ae lp" href="https://github.com/Yichabod/natural_disaster_pred/blob/master/image_download_script.js" rel="noopener ugc nofollow" target="_blank">我们使用的 javascript 代码</a>)。不要忘记将日期范围更改为您喜欢的日期范围。</li><li id="c2bb" class="mh mi iq jp b jq mu ju mv jy mw kc mx kg my kk mm mn mo mp bi translated">单击控制台输出中打印的链接，下载平均云密度小于 100 的图像。</li></ol><p id="ab50" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">瞧啊。您已经有了预处理过的数据集。</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi mz"><img src="../Images/af2f38ee54300238db895a2e6f77def7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HLYxCvJe1Q4OkTqloVGLCQ.png"/></div></div><figcaption class="mc md gj gh gi me mf bd b be z dk">Google Earth Engine Dev Console</figcaption></figure><p id="18bf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">(简单的技术说明:对于我们的模型，我们选择对每幅图像使用 12 个可用波段中的 5 个。您可以在 javascript 代码中更改这一点。每个波段捕捉不同的波长光谱，你可以在谷歌地球引擎 Sentinel-2 <a class="ae lp" href="https://developers.google.com/earth-engine/datasets/catalog/COPERNICUS_S2" rel="noopener ugc nofollow" target="_blank">数据集描述</a>上了解更多信息。</p><p id="177c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">型号</strong></p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div class="gh gi na"><img src="../Images/4513a20ba8d3c8ceac1c78a469ea9abf.png" data-original-src="https://miro.medium.com/v2/resize:fit:680/0*KtTxLGlrRv12aICO"/></div><figcaption class="mc md gj gh gi me mf bd b be z dk">Our CNN</figcaption></figure><p id="44f1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于我们的模型，我们在 Tensorflow 中定义了一个 8 层 CNN(参见这里的代码<a class="ae lp" href="https://github.com/Yichabod/natural_disaster_pred/blob/master/landslide_detection_main.py" rel="noopener ugc nofollow" target="_blank"/>)。这没什么特别的。我们从 5 层开始，并注意到随着我们增加更多的层，性能略有提高。与你对常规前馈网络的期望相反(参见<a class="ae lp" href="https://stats.stackexchange.com/questions/181/how-to-choose-the-number-of-hidden-layers-and-nodes-in-a-feedforward-neural-netw" rel="noopener ugc nofollow" target="_blank">这个不错的堆叠交换讨论</a>了解一些背景理论)，对于 CNN 的深度没有共识。你只需要试一试。</p><p id="7f16" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因为我们最终处理的是大约 120 的图像对，而不是我们想要的 12，000，所以我们增加了几个扩展来使我们的模型更加健壮。首先我们使用<code class="fe mq mr ms mt b">tf.random_crop</code>函数随机裁剪图像，然后我们随机翻转和旋转图像的随机部分。我们还尝试在图像中添加随机高斯噪声，但这降低了性能，并真的减慢了训练过程。</p><p id="ed9e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">结果</strong></p><p id="b9dd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们使用了 5 重<a class="ae lp" href="https://en.wikipedia.org/wiki/Cross-validation_(statistics)" rel="noopener ugc nofollow" target="_blank">交叉验证</a>，这样我们可以使用更多的训练数据，并且仍然可以很好地了解我们的模型在评估集上的表现。</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/549e7c0af2bb0ed6a592b4aa6db19bd0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/0*Zc33seNLbWGPMRlq"/></div><figcaption class="mc md gj gh gi me mf bd b be z dk">Graph of Accuracy over Epochs</figcaption></figure><p id="8767" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">仅仅从光学图像中学习一些东西是可能的，而不需要接触一堆私人的陆地特征！然而，很明显，当验证精度稳定在 0.65 左右时，信号很弱。最明显的改进来自更多的训练例子。虽然我们已经穷尽了 NASA 公开的滑坡目录中的好例子，但是应该有很多国家的滑坡目录以及它们的日期、大小和坐标。</p><p id="a769" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我希望你觉得这个指南有用，或者至少有点意思。我当然喜欢研究它，并解释我们研究背后的动机。</p><figure class="lr ls lt lu gt lv gh gi paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="gh gi nc"><img src="../Images/5d0ac081544b5ac93ef7fb959b337217.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xhKwn-dFiNXBcO8YFFRj9Q.jpeg"/></div></div><figcaption class="mc md gj gh gi me mf bd b be z dk">Tuomas and I (third and second from the right) at the European Space Agency</figcaption></figure><p id="efe5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">再见。</p><p id="be4c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">[1] S. L. Ullo，M.S. Langenkamp，T.P. Oikarinen，M.P. Del Rosso，A. Sebastianelli，F. Piccirillo，S. Sica，“使用 Sentinel-2 图像数据使用卷积神经网络进行滑坡地质灾害评估”，<em class="kl">IGARSS 2019–2019 IEEE 国际地球科学与遥感研讨会</em>，日本横滨，2019 年，第 9646–9649 页。</p></div></div>    
</body>
</html>