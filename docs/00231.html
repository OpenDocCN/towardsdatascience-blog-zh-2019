<html>
<head>
<title>Cold Start Energy Predictions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">冷启动能量预测</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/cold-start-energy-predictions-d3971b1803e?source=collection_archive---------10-----------------------#2019-01-10">https://towardsdatascience.com/cold-start-energy-predictions-d3971b1803e?source=collection_archive---------10-----------------------#2019-01-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/f6466259761804eec9a178a2a78145ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*FRyXyNFuE0tZVb43.jpg"/></div></div></figure><div class=""/><p id="b665" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">大约三个月前，我参加了施耐德电气在 DrivenData 平台举办的“<a class="ae kz" href="https://www.drivendata.org/competitions/55/schneider-cold-start/" rel="noopener ugc nofollow" target="_blank"> Power Laws:冷启动能量预测</a>”比赛。目的是根据以前的用电量和其他因素(如温度、节假日信息等)来预测几栋建筑的用电量。挑战的一个有趣部分是几个家庭(2 天或更少)可用的少量消费信息，因此，我们的模型必须很好地概括新建筑。</p><p id="04a8" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">结果，我在 1300 名参与者中名列第四。这篇文章将描述我的解决方案和这次比赛的主要收获。</p><figure class="lb lc ld le gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi la"><img src="../Images/cea3fa20ec925df957195faf7bf8bdf8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AJa4mnibt4xOaOFcAlJDMg.png"/></div></div><figcaption class="lf lg gj gh gi lh li bd b be z dk">A <a class="ae kz" href="https://www.drivendata.org/competitions/55/schneider-cold-start/leaderboard/" rel="noopener ugc nofollow" target="_blank">final leaderboard</a> of the competition</figcaption></figure><h1 id="b614" class="lj lk je bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">任务、数据和指标</h1><blockquote class="mh mi mj"><p id="8249" class="kb kc mk kd b ke kf kg kh ki kj kk kl ml kn ko kp mm kr ks kt mn kv kw kx ky im bi translated">预测建筑的全球能耗在建筑运营中发挥着关键作用。它为设施管理人员和楼宇自动化系统提供了初步检查，以标记预期和实际能源使用之间的任何差异。设施管理者、公用事业公司和建筑调试项目也使用准确的能耗预测来实施节能政策并优化冷却器、锅炉和能量存储系统的操作。</p><p id="3fdc" class="kb kc mk kd b ke kf kg kh ki kj kk kl ml kn ko kp mm kr ks kt mn kv kw kx ky im bi translated">通常，预测算法使用历史信息来计算他们的预测。大多数时候，历史数据集越大，预测就越准确。这项挑战的目标是构建一种算法，从构建仪器的一开始就提供准确的预测。</p></blockquote><p id="219e" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">组织者提供了训练数据集，该数据集由 758 栋建筑组成，这些建筑在 672 小时内具有已知的电力消耗(总共 509 376 个数据点)。此外，我们还有关于建筑类型(基于表面面积)、节假日和温度的信息。如果一栋楼是一套公寓，周六周日大概是节假日；如果一个建筑是一个购物中心，它在周末工作，没有假期。为了让自己熟悉这些数据，你可以查看组织者的<a class="ae kz" href="http://drivendata.co/blog/benchmark-cold-start-lstm-deep-learning/" rel="noopener ugc nofollow" target="_blank"> EDA </a>。</p><p id="7239" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">测试数据集由 625 栋新建筑组成，这些建筑不在训练数据集中。我们有过去 24-372 小时内“测试”建筑的消耗信息。预测的三个时间范围是不同的。每栋建筑的目标是:</p><ul class=""><li id="efb9" class="mo mp je kd b ke kf ki kj km mq kq mr ku ms ky mt mu mv mw bi translated">预测一天中每小时的消耗量(24 次预测)；</li><li id="d536" class="mo mp je kd b ke mx ki my km mz kq na ku nb ky mt mu mv mw bi translated">预测一周内每天的消耗量(7 次预测)；</li><li id="ab86" class="mo mp je kd b ke mx ki my km mz kq na ku nb ky mt mu mv mw bi translated">预测两周内每周的消耗量(2 次预测)。</li></ul><figure class="lb lc ld le gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nc"><img src="../Images/21b6a18adc3d536ca7636a028434b63a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*OSHaiqeGVkfoQvvF.png"/></div></div><figcaption class="lf lg gj gh gi lh li bd b be z dk">The illustration for the train/test split and what we had to predict</figcaption></figure><p id="0648" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">竞争指标类似于<a class="ae kz" href="https://en.wikipedia.org/wiki/Mean_absolute_percentage_error" rel="noopener ugc nofollow" target="_blank"> MAPE </a> — <a class="ae kz" href="https://www.drivendata.org/competitions/55/schneider-cold-start/page/111/#metric" rel="noopener ugc nofollow" target="_blank"> NMAE </a>，使得每个预测(每小时、每天或每周)同等重要(以下指标包含<code class="fe nd ne nf ng b">ci</code>内真实值的平均值):</p><figure class="lb lc ld le gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nh"><img src="../Images/8e1e4779fb2352a457cb183316b44566.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PxoN1wRhuCaKmJCjV52xMg.png"/></div></div><figcaption class="lf lg gj gh gi lh li bd b be z dk">The competition metric</figcaption></figure><h1 id="6fe6" class="lj lk je bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">最终解决方案</h1><p id="0f56" class="pw-post-body-paragraph kb kc je kd b ke ni kg kh ki nj kk kl km nk ko kp kq nl ks kt ku nm kw kx ky im bi translated">在这次比赛中，我测试了很多想法，但大多数想法都没有给我的分数带来任何显著的提高。然而，要讲述我尝试过的每一件事需要太长的时间；因此，在这一部分，我决定只关注我的最终解决方案的主要部分。</p><h2 id="7d3f" class="nn lk je bd ll no np dn lp nq nr dp lt km ns nt lx kq nu nv mb ku nw nx mf ny bi translated">数据预处理</h2><p id="c5cf" class="pw-post-body-paragraph kb kc je kd b ke ni kg kh ki nj kk kl km nk ko kp kq nl ks kt ku nm kw kx ky im bi translated">数据预处理包括三个主要步骤:填充缺失值、删除常量值和数据缩放。首先，我用给定 Id 和一个小时的小时平均值来填充缺失的温度值。在此之后，缺失值的数量从 45%下降到 2%。剩下的 2%缺失值我用给定小时的月平均温度来填充。</p><p id="5797" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">其次，我用一个不变的目标清洗了所有的时间序列。在训练数据集中有几个例子，在这些例子中，我们有很长一段时间消耗不变。这些示例看起来像是最初丢失的，组织者决定用中值来填充它们(常量值接近中值，但不精确)。如果我保持这些值，我的预测会有偏差；因此，我删除了所有的数据点，我们观察到在过去的 6 个小时里有一个持续的消耗。</p><p id="c00a" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我认为，我的解决方案中最重要的部分之一是独立地衡量每栋建筑的能耗。当您对线性回归的神经网络进行预处理时，一种常见的方法是将所有训练数据用于目标缩放:</p><figure class="lb lc ld le gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nz"><img src="../Images/4af6bc4e1ae34c998afc3cf0fc2058b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:682/format:webp/0*GcryBrojJ0ec9vZX.png"/></div></div></figure><p id="9637" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">由于度量标准的原因，本次比赛中没有出现这种情况。我用给定建筑的最小和最大值来标准化每栋建筑的值。它允许比较不同电力消耗水平的建筑物；因此，我的模型开始更好地概括。</p><p id="16d4" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我做了一个玩具例子来说明这个想法。据推测，我们有两座建筑，如下图所示。他们有相似的消费性质(1 号地块)，唯一的区别是消费水平。如果我们用所有可用的数据(第二个图)缩放目标，图像不会改变太多。我们的预测只基于一个特征——一天中的一个小时。它将具有较高的偏差(事实上，这种情况下的最佳预测将是给定小时的平均消耗量)。但是，如果我们独立缩放每个时间序列，它们将看起来相同(第三个图),我们的模型将更容易发现潜在的模式。</p><figure class="lb lc ld le gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oa"><img src="../Images/afdeb7b9ca53862db3627c64fb728c53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NNTfDjRvVW9qrTNqAjLRIg.png"/></div></div><figcaption class="lf lg gj gh gi lh li bd b be z dk">Toy example: X — an hour of the day, y — consumption</figcaption></figure><p id="a42a" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在规范化之前，我还尝试了不同的目标预处理策略。在最近的机器学习比赛中(在<a class="ae kz" href="https://idao.world/" rel="noopener ugc nofollow" target="_blank"> IDAO 2018 </a>中神奇的 1/3 度)，在训练数据中存在离群值的情况下，它显示出了显著的改善。然而，他们都没有给我一个接近建筑物 Id 内简单的最小-最大缩放的分数:</p><ul class=""><li id="6cb8" class="mo mp je kd b ke kf ki kj km mq kq mr ku ms ky mt mu mv mw bi translated">1/2、1/3 或 1/4 度的目标+最小-最大标度或均值-标准差标度；</li><li id="127a" class="mo mp je kd b ke mx ki my km mz kq na ku nb ky mt mu mv mw bi translated">目标+最小-最大缩放或均值-标准差缩放的对数。</li></ul><h2 id="54b6" class="nn lk je bd ll no np dn lp nq nr dp lt km ns nt lx kq nu nv mb ku nw nx mf ny bi translated">验证策略</h2><p id="a24d" class="pw-post-body-paragraph kb kc je kd b ke ni kg kh ki nj kk kl km nk ko kp kq nl ks kt ku nm kw kx ky im bi translated">我使用维持验证集(20%)来检查我的模型的分数，并使用 10 重验证(建筑物 Id 分层)来优化管道的超参数。我注意到这场比赛中的大多数时间序列是静止的，时间序列分裂和洗牌的分数几乎是一样的。因此，我决定使用混洗 10 倍，而不是常见的时间序列分裂，因为它允许我在事后使用不同的分裂，这将使我的预测更加稳定。</p><p id="f8f3" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在，我对时间序列任务使用一个简单的规则:如果时间序列是静态的，那么使用 KFold 进行超参数优化是可以的(但是不能用于整个流水线的评估)。</p><figure class="lb lc ld le gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ob"><img src="../Images/70802bc0b3f3bf7135d33431e3f6914a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YWslgnHKuKlXEA_fYRofmw.png"/></div></div><figcaption class="lf lg gj gh gi lh li bd b be z dk">Examples of the training data. It is clearly seen that properties of time series don’t change too much over time, there is no trend in the data, so we might use KFold instead of time-series split for validation</figcaption></figure><h2 id="9a3a" class="nn lk je bd ll no np dn lp nq nr dp lt km ns nt lx kq nu nv mb ku nw nx mf ny bi translated">特征工程</h2><p id="a8c6" class="pw-post-body-paragraph kb kc je kd b ke ni kg kh ki nj kk kl km nk ko kp kq nl ks kt ku nm kw kx ky im bi translated">我为特性工程使用了不同的策略，但我认为最重要的是:</p><ul class=""><li id="1c06" class="mo mp je kd b ke kf ki kj km mq kq mr ku ms ky mt mu mv mw bi translated">基于时间戳的特征:年、年中的某一天、年中的某一月、年中的某一周、周中的某一天。这些特征在 NN 中被视为分类特征，我还通过正弦-余弦变换将它们添加为数值特征(见下面的等式)。这是一种众所周知的处理循环特征的方法。这种方法背后的思想很简单:我们希望在我们的模型中归纳出关于过程的先验信息，即周期的结束是新周期的开始。因此，应用此映射后，00:00 和 23:00 之间的距离将变得更小。我推荐查看这些帖子看代码示例:<a class="ae kz" href="https://www.kaggle.com/avanwyk/encoding-cyclical-features-for-deep-learning" rel="noopener ugc nofollow" target="_blank">编码深度学习的循环特征</a>，<a class="ae kz" href="http://blog.davidkaleko.com/feature-engineering-cyclical-features.html" rel="noopener ugc nofollow" target="_blank">特征工程——处理循环特征</a>；</li></ul><figure class="lb lc ld le gt iv gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/e6edbc21689f37775b69d76a6f6c0095.png" data-original-src="https://miro.medium.com/v2/resize:fit:610/format:webp/1*9zp6Aw_jcfNdUQetwMBs8w.png"/></div></figure><ul class=""><li id="92d3" class="mo mp je kd b ke kf ki kj km mq kq mr ku ms ky mt mu mv mw bi translated">我把温度从摄氏温度转换成了开尔文温度。然后，我添加了一个小时的温度，下一个小时的温度，这一个小时和下一个小时的温度之间的绝对和相对差异，下一个小时和这一个小时的温度之间的绝对和相对差异，作为新的特征。；</li><li id="6f3c" class="mo mp je kd b ke mx ki my km mz kq na ku nb ky mt mu mv mw bi translated">基于建筑类型的特征:最大和最小消耗的记录、建筑表面类别、休息日、建筑工作制度(<code class="fe nd ne nf ng b">is_{weekday}_dayoff</code>组合在单一类别中)。</li></ul><p id="a790" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">根据竞赛规则，禁止使用附加数据。但是，不管怎样，因为好奇，我测试了下面这个想法。我使用一个<a class="ae kz" href="https://www.kaggle.com/noaa/ghcn-d" rel="noopener ugc nofollow" target="_blank">开放的温度观测数据库</a>来确定建筑位置。我们知道给定建筑每小时的温度，这就是为什么我在数据库中搜索相似的温度模式。关于温度观测值(实际值和台站观测值之间的绝对距离之和)与给定建筑物的温度最接近的台站的信息(纬度、经度、国家、最近的城市)被用作附加特征。然而，它降低了验证和排行榜的分数。我认为这是因为温度数据中有很多缺失值。我放弃了这个伟大的想法。</p><h2 id="63d2" class="nn lk je bd ll no np dn lp nq nr dp lt km ns nt lx kq nu nv mb ku nw nx mf ny bi translated">模型</h2><p id="5230" class="pw-post-body-paragraph kb kc je kd b ke ni kg kh ki nj kk kl km nk ko kp kq nl ks kt ku nm kw kx ky im bi translated">我使用前馈神经网络作为最终模型，其架构如下所示。我对所有分类特征都使用了嵌入层。这是神经网络中处理类别的常用方法。嵌入将相似的类别彼此更紧密地映射在一起(参见这篇<a class="ae kz" href="https://arxiv.org/abs/1604.06737" rel="noopener ugc nofollow" target="_blank">论文</a>的温和介绍)。在这次比赛中，这是非常有益的，因为数据集中有很多建筑。</p><figure class="lb lc ld le gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi od"><img src="../Images/ce957faa62b9c004cfa010c4ce75f25c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V702u7ebdjen34crbq_DEw.png"/></div></div></figure><p id="2f07" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我用以下参数训练 NN:100 个时期，批量大小 1024，Adam 优化器，3 个时期用于提前停止。我在 Keras 测试了训练 NN 的不同损失。我有一种感觉，MAPE 和 MSE 的损失可以给我不同的高分预测，这样我就可以把它们融合在一起，获得更高的分数。但是这些方法还不够好，不足以将它们包含在最终的管道中。</p><p id="c76b" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我还尝试了众所周知的梯度增强方法(XGBoost 和 LightGBM ),这些方法是在原始数据和 NN 之后的数据表示(几个时期的训练之后 NN 内层的输出)上训练的，但是它们不能显示出像样的结果。这些模型的分数甚至不足以包含在最终的集合中。</p><p id="868b" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我最终提交的只是 30 个模型的简单平均值(10 倍* 3 个略有不同的架构)。赌注并没有提高分数太多。</p><h1 id="409d" class="lj lk je bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">决赛成绩</h1><p id="02eb" class="pw-post-body-paragraph kb kc je kd b ke ni kg kh ki nj kk kl km nk ko kp kq nl ks kt ku nm kw kx ky im bi translated">大部分比赛时间，我都是抱着和第二名差距巨大的第一名。但是在过去的两天里，来自第二名和第四名的小伙子们组队了，一点小小的变动就让一切都不同了。</p><figure class="lb lc ld le gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oe"><img src="../Images/1fcafb939195fb4e29c5660a8ed83b16.png" data-original-src="https://miro.medium.com/v2/resize:fit:700/1*0zD_PRDuCZaqBK0jTNf6Tw.gif"/></div></div><figcaption class="lf lg gj gh gi lh li bd b be z dk">Shake up be like</figcaption></figure><p id="7e9c" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">但是，无论如何，我花了 1.5 个月解决了一个有趣的任务，这帮助我组织了一个类似任务和比赛的管道。最终解决方案的一部分用于 Junction 2018，在那里我们赢得了智能云赛道(ODS)的“<a class="ae kz" href="https://live.hackjunction.com/winners/" rel="noopener ugc nofollow" target="_blank">信号英雄</a>挑战赛。AI 团队)。</p></div></div>    
</body>
</html>