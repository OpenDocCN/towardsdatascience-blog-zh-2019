<html>
<head>
<title>Deploying a Deep Learning Model on Heroku using Flask and Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Flask 和 Python 在 Heroku 上部署深度学习模型</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/deploying-a-deep-learning-model-on-heroku-using-flask-and-python-769431335f66?source=collection_archive---------5-----------------------#2019-12-23">https://towardsdatascience.com/deploying-a-deep-learning-model-on-heroku-using-flask-and-python-769431335f66?source=collection_archive---------5-----------------------#2019-12-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="5252" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在我的上一篇文章中，我们已经看到了如何使用 Python 和 Flask(下面的链接)在 web 上部署机器学习模型</p><div class="ko kp gp gr kq kr"><a href="https://medium.com/analytics-vidhya/deploying-a-machine-learning-model-on-web-using-flask-and-python-54b86c44e14a" rel="noopener follow" target="_blank"><div class="ks ab fo"><div class="kt ab ku cl cj kv"><h2 class="bd iu gy z fp kw fr fs kx fu fw is bi translated">使用 Flask 和 Python 在 Web 上部署机器学习模型</h2><div class="ky l"><h3 class="bd b gy z fp kw fr fs kx fu fw dk translated">创建一个机器学习模型并对现实世界的问题进行预测听起来很酷。但是，那不是很…</h3></div><div class="kz l"><p class="bd b dl z fp kw fr fs kx fu fw dk translated">medium.com</p></div></div><div class="la l"><div class="lb l lc ld le la lf lg kr"/></div></div></a></div><p id="26c5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">通过 CLI 进行预测很酷，但也存在一些问题，比如手动启动服务器和缺少简单的 GUI(图形用户界面)。</p><p id="1a6d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在本帖中，我们将尝试通过在 Heroku 服务器上部署我们的模型来解决上述问题，并因此为最终用户建立一个简单的全天候运行的 HTML 网站来进行预测。T3】</p><p id="3e8f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们从创建深度学习模型的最基础开始旅程，然后逐步完成部署过程并学习新概念。</p></div><div class="ab cl li lj hx lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="im in io ip iq"><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div class="gh gi lp"><img src="../Images/b1071cff39cff53b10f96072cc44db85.png" data-original-src="https://miro.medium.com/v2/resize:fit:896/format:webp/1*rYS6Ay1iaDuNqMAd8-MVsA.png"/></div></figure><blockquote class="lw lx ly"><p id="1750" class="jq jr lh js b jt ju jv jw jx jy jz ka lz kc kd ke ma kg kh ki mb kk kl km kn im bi translated"><strong class="js iu">深度学习模型的创建</strong></p></blockquote><p id="3c2d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">步骤 1。为虹膜数据集创建一个简单的 Keras 模型</strong></p><p id="d4df" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">R.A. Fisher 在 1936 年的经典论文中使用了 Iris 数据集。它包括三种鸢尾，每种有 50 个样本，以及每种花的一些特性。</p><p id="a08a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">该数据集中的列是:</p><ul class=""><li id="8f1c" class="mc md it js b jt ju jx jy kb me kf mf kj mg kn mh mi mj mk bi translated">身份</li><li id="dcc1" class="mc md it js b jt ml jx mm kb mn kf mo kj mp kn mh mi mj mk bi translated">SepalLengthCm</li><li id="9b2f" class="mc md it js b jt ml jx mm kb mn kf mo kj mp kn mh mi mj mk bi translated">SepalWidthCm</li><li id="ce42" class="mc md it js b jt ml jx mm kb mn kf mo kj mp kn mh mi mj mk bi translated">PetalLengthCm</li><li id="d921" class="mc md it js b jt ml jx mm kb mn kf mo kj mp kn mh mi mj mk bi translated">PetalWidthCm</li><li id="330e" class="mc md it js b jt ml jx mm kb mn kf mo kj mp kn mh mi mj mk bi translated">种类</li></ul><p id="5569" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们导入必要的库，然后将 iris.csv 中的数据加载到 pandas 数据框架中，以便更好地理解。</p><pre class="lq lr ls lt gt mq mr ms mt aw mu bi"><span id="1f47" class="mv mw it mr b gy mx my l mz na">import numpy as np<br/>import pandas as pd</span><span id="5488" class="mv mw it mr b gy nb my l mz na">iris = pd.read_csv(“../DATA/iris.csv”)</span><span id="0592" class="mv mw it mr b gy nb my l mz na">iris.head()</span></pre><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/b0b7815bd9d249f3dcf92ac3fcf734a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:824/format:webp/1*FFMsYzp3czorBRP73RkP4g.png"/></div></figure><p id="f21e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">第二步。为训练目的定义 X 和 y</strong></p><p id="8209" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，一旦我们加载了我们的数据，我们就可以为训练目的定义我们的 X 和 y，<em class="lh">我们最初的四列将贡献 X，物种将被标记为 y，这表示我们来自数据集的真实标签。</em></p><pre class="lq lr ls lt gt mq mr ms mt aw mu bi"><span id="bd1a" class="mv mw it mr b gy mx my l mz na">X = iris.drop(‘species’,axis=1)<br/>y = iris[‘species’]</span></pre><p id="1a7b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">第三步。二值化物种标签</strong></p><p id="8964" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">正如我们在数据集<strong class="js iu"> <em class="lh">【物种】</em> </strong> <em class="lh">中看到的，包含字符串格式的数据，因此我们应该将其编码成数字</em>，为此我们可以通过下面的代码使用 sklearn .预处理库中的<strong class="js iu"> LabelBinarizer</strong></p><pre class="lq lr ls lt gt mq mr ms mt aw mu bi"><span id="b9db" class="mv mw it mr b gy mx my l mz na">from sklearn.preprocessing import LabelBinarizer<br/>encoder = LabelBinarizer()<br/>y = encoder.fit_transform(y)</span></pre><p id="4c25" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，如果我们检查我们的<em class="lh">"</em><strong class="js iu"><em class="lh">y</em></strong><em class="lh">"它应该被二值化如下，其中[1，0，0]表示花“Setosa”，[0，1，0]表示“Virginica”，而[0，0，1]表示“Versicolor”。</em></p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/3ddaee7569df2412a08e3df2d333bda2.png" data-original-src="https://miro.medium.com/v2/resize:fit:542/format:webp/1*FbC-e_V3ihFed-O5ULfcrA.png"/></div></figure><p id="0dad" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">步骤四。缩放数据</strong></p><p id="ae51" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在输入模型之前缩放我们的数据总是很重要的，以确保所有列的值都在同一范围内，您可以使用<strong class="js iu"> scikit-learn </strong>中的任何缩放器，如 StandardScaler 或 MinMaxScaler，下面我们使用的是<strong class="js iu"> MinMax scaler </strong></p><pre class="lq lr ls lt gt mq mr ms mt aw mu bi"><span id="c1e3" class="mv mw it mr b gy mx my l mz na">from sklearn.preprocessing import MinMaxScaler<br/>scaler = MinMaxScaler()<br/>scaled_X = scaler.fit_transform(X)</span></pre><p id="98fd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">请注意，我们正在缩放我们的整个 X，这将用于训练我们的深度学习模型，您可以根据自己的建模步骤纳入更多步骤，如<strong class="js iu"> train_test_split </strong>。</p><p id="5af6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">第五步。创建 Keras 模型</strong></p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/5543d5afc5a8374563ad0c30e8f470a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:628/format:webp/1*uAOgK2J3UXMQi1us0fi0xA.jpeg"/></div></figure><p id="dadb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们通过导入下面的库并调用顺序 API 来创建一个简单的 Keras 模型</p><pre class="lq lr ls lt gt mq mr ms mt aw mu bi"><span id="7f5c" class="mv mw it mr b gy mx my l mz na">from tensorflow.keras.models import Sequential<br/>from tensorflow.keras.layers import Dense</span><span id="2c9b" class="mv mw it mr b gy nb my l mz na">model = Sequential()<br/>model.add(Dense(units=4,activation=’relu’))<br/>model.add(Dense(units=32,activation=’relu’))<br/>model.add(Dense(units=16,activation=’relu’))<br/># Last layer for multi-class classification of 3 species<br/>model.add(Dense(units=3,activation=’softmax’))</span><span id="452f" class="mv mw it mr b gy nb my l mz na">model.compile(optimizer=’adam’,loss=’categorical_crossentropy’,metrics=[‘accuracy’])</span></pre><p id="f369" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在上面的代码中，我们已经开始创建一个连续的 Keras 模型，第一层的<em class="lh">是密集的，在 X 轴上有 4 个输入(萼片长度，萼片宽度，花瓣长度，花瓣宽度)。</em></p><p id="45a8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">之后，我们添加了 2 个隐藏层，并使用<strong class="js iu">“relu”</strong>作为除最后一层之外的所有层的激活函数。</p><p id="6ea9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">最后一层包含 3 个单元，分别用于 3 类花</strong> ( Setosa、Virginica 和 Versicolor)，具有<em class="lh"/><strong class="js iu"><em class="lh">soft max</em></strong><em class="lh"/>激活函数，因为我们正在处理多类分类问题，而且在编译模型时，我们使用了<em class="lh"/><strong class="js iu"><em class="lh">【亚当</em></strong><em class="lh"/>优化器以及<strong class="js iu"> <em class="lh"/></strong></p><p id="c991" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">第六步。训练和保存模型</strong></p><p id="b088" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最后，让我们开始在大约 100+个时期上训练我们的 Keras 模型，如果您想减少训练的运行时间，您可以添加回调机制，例如 EarlyStopping。</p><pre class="lq lr ls lt gt mq mr ms mt aw mu bi"><span id="4f99" class="mv mw it mr b gy mx my l mz na">model.fit(scaled_X,y,epochs=150)</span><span id="1389" class="mv mw it mr b gy nb my l mz na">Epoch 1/150<br/>150/150 [==============================] - 0s 1ms/sample - loss: 1.1053 - accuracy: 0.3333<br/>Epoch 2/150<br/>150/150 [==============================] - 0s 93us/sample - loss: 1.0953 - accuracy: 0.3467<br/>Epoch 3/150<br/>150/150 [==============================] - 0s 86us/sample - loss: 1.0864 - accuracy: 0.5667<br/>Epoch 4/150<br/>150/150 [==============================] - 0s 100us/sample - loss: 1.0770 - accuracy: 0.6200<br/>Epoch 5/150<br/>150/150 [==============================] - 0s 86us/sample - loss: 1.0669 - accuracy: 0.4867</span></pre><p id="5dc3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">训练完成后，我们将达到大约 95%的准确率</strong>，而不会过度拟合数据。现在让我们保存我们的模型，以便稍后在部署过程中使用。</p><pre class="lq lr ls lt gt mq mr ms mt aw mu bi"><span id="edb2" class="mv mw it mr b gy mx my l mz na">model.save(“final_iris_model.h5”)</span></pre><p id="01c7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这将把模型保存在您的<em class="lh">当前工作目录</em>中。</p><p id="3324" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">第七步。保存定标器</strong></p><p id="8fa9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们还将在当前的工作目录中保存 scaler，这样我们就可以在将用户输入数据传递给我们的模型并在我们的网站上显示结果之前对其进行缩放。</p><pre class="lq lr ls lt gt mq mr ms mt aw mu bi"><span id="2b7b" class="mv mw it mr b gy mx my l mz na">import joblib<br/>joblib.dump(scaler,’iris_scaler.pkl’)</span></pre></div><div class="ab cl li lj hx lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="im in io ip iq"><blockquote class="lw lx ly"><p id="418c" class="jq jr lh js b jt ju jv jw jx jy jz ka lz kc kd ke ma kg kh ki mb kk kl km kn im bi translated"><strong class="js iu">部署通过烧瓶，Python 对 Heroku </strong></p></blockquote><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/01346703adb8ea8d90c7bec3c4b58cb7.png" data-original-src="https://miro.medium.com/v2/resize:fit:628/format:webp/1*bdQmxVjDVfEsR1QfCm5oXw.png"/></div></figure><p id="e919" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">将我们的模型与 scaler 一起保存真是太好了，现在让我们深入了解设置我们自己的 flask 应用程序并将其部署在 Heroku 服务器上的步骤。</p><p id="aecf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们开始创建我们的<strong class="js iu"> <em class="lh"> app.py </em> </strong>文件，稍后将用于 Heroku 服务器上的部署。</p><p id="e7be" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">步骤一。导入所需的库</strong></p><pre class="lq lr ls lt gt mq mr ms mt aw mu bi"><span id="ab2d" class="mv mw it mr b gy mx my l mz na">from flask import Flask, render_template, session, redirect, url_for, session<br/>from flask_wtf import FlaskForm<br/>from wtforms import TextField,SubmitField<br/>from wtforms.validators import NumberRange<br/>import numpy as np <br/>from tensorflow.keras.models import load_model<br/>import joblib</span></pre><p id="bb7c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">第二步。定义返回模型预测的函数</strong></p><pre class="lq lr ls lt gt mq mr ms mt aw mu bi"><span id="a7ba" class="mv mw it mr b gy mx my l mz na">def return_prediction(model,scaler,sample_json):<br/> <br/> s_len = sample_json[‘sepal_length’]<br/> s_wid = sample_json[‘sepal_width’]<br/> p_len = sample_json[‘petal_length’]<br/> p_wid = sample_json[‘petal_width’]<br/> <br/> flower = [[s_len,s_wid,p_len,p_wid]]<br/> flower = scaler.transform(flower)<br/> <br/> classes = np.array([‘setosa’, ‘versicolor’, ‘virginica’])<br/> class_ind = model.predict_classes(flower)<br/> <br/> return classes[class_ind][0]</span></pre><p id="328d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在上面的函数中，我们传递了<strong class="js iu"> <em class="lh">三个参数，我们的 model、scaler 和 sample_json </em> </strong>用于从 HTML 页面输入数据。</p><p id="e7ab" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">JSON (JavaScript Object Notation)是网络上最广泛使用的数据交换格式。这种数据交换可以在不同地理位置的两个计算机应用程序之间进行，也可以在同一台硬件机器上运行。</p><p id="7a8c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">首先，JSON 构建在类似 python 字典的结构之上</p><ul class=""><li id="d553" class="mc md it js b jt ju jx jy kb me kf mf kj mg kn mh mi mj mk bi translated"><strong class="js iu">名称/值对的集合。</strong></li></ul><pre class="lq lr ls lt gt mq mr ms mt aw mu bi"><span id="83f7" class="mv mw it mr b gy mx my l mz na">"employee": {<br/>"id":           1,<br/>"name":         "Admin",<br/>"location":     "USA"<br/>}</span></pre><p id="d460" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">以类似的方式，我们从传入的请求中捕获了 sepal_length/width、petal_length/width 的数据</p><pre class="lq lr ls lt gt mq mr ms mt aw mu bi"><span id="1a4f" class="mv mw it mr b gy mx my l mz na">s_len = sample_json[‘sepal_length’]<br/> s_wid = sample_json[‘sepal_width’]<br/> p_len = sample_json[‘petal_length’]<br/> p_wid = sample_json[‘petal_width’]</span></pre><p id="82be" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">完成上述步骤后，我们缩放了我们的花卉列表，并使用了<strong class="js iu">model . predict _ classes()</strong><strong class="js iu">函数来获取对应于以下代码中花卉数据的类标签，</strong>有关此函数的更多详细信息，请参见下面的链接。</p><p id="98bc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><a class="ae nf" href="https://kite.com/python/docs/tensorflow.keras.Sequential.predict_classes" rel="noopener ugc nofollow" target="_blank">https://kite . com/python/docs/tensor flow . keras . sequential . predict _ classes</a></p><pre class="lq lr ls lt gt mq mr ms mt aw mu bi"><span id="7e45" class="mv mw it mr b gy mx my l mz na">flower = [[s_len,s_wid,p_len,p_wid]]<br/>flower = scaler.transform(flower)<br/>classes = np.array([‘setosa’, ‘versicolor’, ‘virginica’])<br/>class_ind = model.predict_classes(flower)<br/>return classes[class_ind][0]</span></pre><p id="f6e3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">第三步。定义 app 路线并完成 app.py 文件</strong></p><p id="3e1d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在下面的代码中，为了更好的理解，每个代码块上面都定义了代码注释，如果你需要更多的了解 flask 的基本架构，也可以通过下面的链接访问我的上一篇文章。</p><p id="2bdb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><a class="ae nf" href="https://medium.com/analytics-vidhya/deploying-a-machine-learning-model-on-web-using-flask-and-python-54b86c44e14a" rel="noopener">https://medium . com/analytics-vid hya/deploying-a-machine-learning-model-on-web-using-flask-and-python-54 b 86 c 44 e 14 a</a></p><pre class="lq lr ls lt gt mq mr ms mt aw mu bi"><span id="9a06" class="mv mw it mr b gy mx my l mz na"><strong class="mr iu">app = Flask(__name__)</strong><br/><strong class="mr iu"># Configure a secret SECRET_KEY</strong><br/>app.config[‘SECRET_KEY’] = ‘someRandomKey’</span><span id="cbe4" class="mv mw it mr b gy nb my l mz na"><strong class="mr iu"># Loading the model and scaler</strong><br/>flower_model = load_model(“final_iris_model.h5”)<br/>flower_scaler = joblib.load(“iris_scaler.pkl”)</span><span id="492f" class="mv mw it mr b gy nb my l mz na"><strong class="mr iu"># Now create a WTForm Class</strong><br/><strong class="mr iu">class FlowerForm(FlaskForm):</strong><br/> sep_len = TextField(‘Sepal Length’)<br/> sep_wid = TextField(‘Sepal Width’)<br/> pet_len = TextField(‘Petal Length’)<br/> pet_wid = TextField(‘Petal Width’)<br/> submit = SubmitField(‘Analyze’)<br/> <br/><a class="ae nf" href="http://twitter.com/app" rel="noopener ugc nofollow" target="_blank"><strong class="mr iu">@app</strong></a><strong class="mr iu">.route(‘/’, methods=[‘GET’, ‘POST’])</strong><br/> def index():<br/>  # Create instance of the form.<br/>  form = FlowerForm()<br/>  # If the form is valid on submission<br/>  if form.validate_on_submit():<br/>  # Grab the data from the input on the form.<br/>  session[‘sep_len’] = form.sep_len.data<br/>  session[‘sep_wid’] = form.sep_wid.data<br/>  session[‘pet_len’] = form.pet_len.data<br/>  session[‘pet_wid’] = form.pet_wid.data</span><span id="cc49" class="mv mw it mr b gy nb my l mz na">return redirect(url_for(“prediction”))</span><span id="fd79" class="mv mw it mr b gy nb my l mz na">return render_template(‘home.html’, form=form)</span><span id="79df" class="mv mw it mr b gy nb my l mz na"><a class="ae nf" href="http://twitter.com/app" rel="noopener ugc nofollow" target="_blank"><strong class="mr iu">@app</strong></a><strong class="mr iu">.route(‘/prediction’)</strong><br/>def prediction():<br/> #Defining content dictionary<br/> content = {}</span><span id="fc3b" class="mv mw it mr b gy nb my l mz na">content[‘sepal_length’] = float(session[‘sep_len’])<br/> content[‘sepal_width’] = float(session[‘sep_wid’])<br/> content[‘petal_length’] = float(session[‘pet_len’])<br/> content[‘petal_width’] = float(session[‘pet_wid’])<br/> <br/> results = return_prediction(model=flower_model,scaler=flower_scaler,sample_json=content)</span><span id="11a1" class="mv mw it mr b gy nb my l mz na">return render_template(‘prediction.html’,results=results)</span><span id="20cd" class="mv mw it mr b gy nb my l mz na"><strong class="mr iu">if __name__ == ‘__main__’:<br/> app.run(debug=True)</strong></span></pre><p id="d600" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们一点一点来理解上面的代码。</p><p id="0203" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">我们正在配置一个<em class="lh">密钥</em> </strong>。<em class="lh">需要密钥来保证 Flask 中客户端会话的安全。</em>您可以生成任何您选择的随机密钥。</p><p id="b115" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> <em class="lh">我们正在使用@app.route 装饰主页和预测页面</em> </strong>，详情请参考我上一篇文章。</p><p id="67b7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">另外，我们正在创建 WT 表单</strong>。使用<strong class="js iu"> Flask-WTF </strong>，<strong class="js iu"> <em class="lh">我们可以在 Python 脚本中定义表单字段，并使用 HTML 模板</em> </strong>呈现它们</p><p id="28bf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> TextField </strong>表示&lt;输入 type = 'text' &gt; HTML 表单元素</p><p id="791c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">请通过下面的脚本安装 Flask-WTF</p><pre class="lq lr ls lt gt mq mr ms mt aw mu bi"><span id="7194" class="mv mw it mr b gy mx my l mz na">pip install flask-wtf</span></pre><p id="c7ee" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">第四步。定义我们的 HTML 表单，从终端用户那里获取输入。</strong></p><p id="1d51" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在让我们进入最后一步，为部署做好一切准备。</p><p id="fe30" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们将为最终用户的输入创建两个基本的 HTML 表单，即<strong class="js iu"><em class="lh"/></strong>和<strong class="js iu"><em class="lh">prediction.html</em></strong>。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/c28379378a633d021c44b6899ec157ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:320/format:webp/1*x6QQObhK7f1pmMb2dHWaFw.png"/></div></figure><p id="328b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="lh">你也可以在</em> <strong class="js iu"> <em class="lh">第三步</em> </strong> <em class="lh">查看代码，通过@app.route decorator 定义两者，将 Flask 与 HTML 模板连接起来。</em></p><p id="efd1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">home.html</strong></p><pre class="lq lr ls lt gt mq mr ms mt aw mu bi"><span id="03fb" class="mv mw it mr b gy mx my l mz na">&lt;h1&gt;Welcome to IRIS prediction&lt;/h1&gt;<br/>&lt;h2&gt;Please enter your flower measurements below:&lt;/h2&gt;<br/>&lt;form method=”POST”&gt;<br/> {# This hidden_tag is a CSRF security feature. #}<br/> {{ form.hidden_tag() }}<br/> {{ form.sep_len.label }} {{form.sep_len}}<br/> &lt;br&gt;<br/> {{ form.sep_wid.label}} {{form.sep_wid}}<br/> &lt;br&gt;<br/> {{form.pet_len.label}}{{form.pet_len}}<br/> &lt;br&gt;<br/> {{form.pet_wid.label}}{{form.pet_wid}}<br/> &lt;br&gt;<br/> {{ form.submit() }}<br/>&lt;/form&gt;</span></pre><p id="51a7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在上述表格中，每一项如─</p><p id="0bc1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> <em class="lh"> form.sep_len、form.sep_wid 等</em> </strong> <em class="lh">是我们在 FlowerForm 类中的 S</em><strong class="js iu"><em class="lh">TEP 3</em></strong><em class="lh">中定义的文本字段，这样一旦用户输入数据，这些数据就会被传递给 FlaskSession。</em></p><p id="4bbd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">Prediction.html</strong></p><pre class="lq lr ls lt gt mq mr ms mt aw mu bi"><span id="936c" class="mv mw it mr b gy mx my l mz na">&lt;h1&gt;Thank You. Here is the Information You Gave:&lt;/h1&gt;<br/>&lt;ul&gt;<br/> &lt;li&gt;Sepal Length: {{session[‘sep_len’]}}&lt;/li&gt;<br/> &lt;li&gt;Sepal Width : {{session[‘sep_wid’]}}&lt;/li&gt;<br/> &lt;li&gt;Petal Length: {{session[‘pet_len’]}}&lt;/li&gt;<br/> &lt;li&gt;Petal Width : {{session[‘pet_wid’]}}&lt;/li&gt;<br/>&lt;/ul&gt;<br/>&lt;h2&gt;Your Predicted Flower Class is: {{results}}&lt;/h2&gt;</span></pre><p id="c3ca" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> <em class="lh">然后我们将相同的数据传递到步骤 3 中预测函数内部定义的内容字典中，</em> </strong> <em class="lh">和</em> <strong class="js iu"> <em class="lh"> </em> </strong>进一步使用相同的数据作为我们模型的输入。<em class="lh">最后，我们将显示步骤 3 的结果变量。我们的 prediction.html 页面。</em></p></div><div class="ab cl li lj hx lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="im in io ip iq"><blockquote class="lw lx ly"><p id="f54c" class="jq jr lh js b jt ju jv jw jx jy jz ka lz kc kd ke ma kg kh ki mb kk kl km kn im bi translated"><strong class="js iu">收拾好一切，部署到 Heroku </strong></p></blockquote><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi ne"><img src="../Images/7dec467a05ac897ec2c33ff2e2eb2726.png" data-original-src="https://miro.medium.com/v2/resize:fit:628/format:webp/1*TqST5uESWxqab-ClezWMVA.png"/></div></div></figure><p id="f85a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在我们已经到了最后一步，那就是在 Heroku 号上部署一切。</p><p id="8bca" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">步骤一。请按照下面的方式建立你的项目工作目录，有一个单独的模板文件夹包含你的 home.html 和 prediction.html 文件。</strong></p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/6bf1f7dd2092920cec2303026327cb29.png" data-original-src="https://miro.medium.com/v2/resize:fit:506/format:webp/1*5H6meS4az698tw3USJe8fA.png"/></div></figure><p id="fe78" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">此外，请添加以下代码的 Procfile(无扩展名)作为一行代码</p><pre class="lq lr ls lt gt mq mr ms mt aw mu bi"><span id="ea5e" class="mv mw it mr b gy mx my l mz na">web: gunicorn app:app</span></pre><p id="4dee" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">“guni corn”，</strong>是一个<a class="ae nf" href="https://www.fullstackpython.com/wsgi-servers.html" rel="noopener ugc nofollow" target="_blank"> Web 服务器网关接口(WSGI)服务器</a>实现，常用于运行 Python web 应用，<strong class="js iu"> <em class="lh">这里 app 是我们的 app.py 文件名。</em>T47】</strong></p><p id="4b1a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">第二步。创建一个 conda 虚拟环境来设置所有的库</strong></p><p id="9074" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">导航到项目目录后，在 Anaconda 提示符下运行下面的代码，然后激活环境。</p><pre class="lq lr ls lt gt mq mr ms mt aw mu bi"><span id="45cc" class="mv mw it mr b gy mx my l mz na">Step1. conda create — name mydevenv python=3.7<br/>Step2. activate mydevenv</span></pre><p id="8d9b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为您新创建的环境安装以下库，并为 Heroku 生成 requirements.txt</p><pre class="lq lr ls lt gt mq mr ms mt aw mu bi"><span id="0e77" class="mv mw it mr b gy mx my l mz na">Step1. pip install flask<br/>Step2. pip install flask-wtf<br/>Step3. pip install tensorflow2.0.0a0<br/>Step4. pip install scikit-learn<br/>Step5. pip install gunicorn<br/>Step6. pip freeze &gt; requirements.txt</span></pre><p id="48fe" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在您的工作目录应该已经为 Heroku 部署创建了 requirements . txt。</p><p id="53a3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">第三步。创建 Heroku 帐户并安装 Heroku CLI 进行部署</strong></p><p id="8067" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">注册一个新的 Heroku 账号<a class="ae nf" href="https://www.heroku.com/" rel="noopener ugc nofollow" target="_blank">https://www.heroku.com/</a></p><p id="1f6d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">根据您的操作系统安装 Heroku CLI 和 GIT</p><p id="0f81" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><a class="ae nf" href="https://devcenter.heroku.com/articles/heroku-cli#download-and-install" rel="noopener ugc nofollow" target="_blank">https://dev center . heroku . com/articles/heroku-CLI #下载并安装</a></p><p id="b398" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><a class="ae nf" href="https://git-scm.com/downloads" rel="noopener ugc nofollow" target="_blank">https://git-scm.com/downloads</a></p><p id="97b1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">完成后请重启系统，在命令提示符下键入<strong class="js iu"> heroku </strong>和<strong class="js iu">如果没有“Heroku not found”的错误，您就可以进入下一步</strong>。</p><p id="d5d0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">第四步。将应用部署到 Heroku 服务器</strong></p><p id="857c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">通过打开一个新的命令提示符并键入以下内容来登录 Heroku。</p><pre class="lq lr ls lt gt mq mr ms mt aw mu bi"><span id="be0d" class="mv mw it mr b gy mx my l mz na">heroku login</span></pre><p id="6825" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">按任意键，一旦完成，你将被重定向到浏览器的登录页面，在那里完成登录过程。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/8bc02b885e9fa78a8d36ce31448cb113.png" data-original-src="https://miro.medium.com/v2/resize:fit:1184/format:webp/1*seIEp0geAZ_LZiYRaKHvzg.png"/></div></figure><p id="0d7b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在转到 Heroku 主页，点击创建一个新的应用程序，如下所示</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="nh ni di nj bf nk"><div class="gh gi nn"><img src="../Images/d5fdc3a4f2fe515f1e9b9e8e0729aa5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BMvWAg8Vykiewz3_z46C0A.png"/></div></div></figure><p id="2c7b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">完成上述步骤后，执行最后几个步骤来部署到服务器。</p><h2 id="fcc8" class="mv mw it bd no np nq dn nr ns nt dp nu kb nv nw nx kf ny nz oa kj ob oc od oe bi translated">打开 GitBash 并导航到您的项目目录</h2><p id="d8c2" class="pw-post-body-paragraph jq jr it js b jt of jv jw jx og jz ka kb oh kd ke kf oi kh ki kj oj kl km kn im bi translated">初始化目录中的 git 存储库。用您自己的应用程序名称替换 ml-deployment-app。</p><pre class="lq lr ls lt gt mq mr ms mt aw mu bi"><span id="1ada" class="mv mw it mr b gy mx my l mz na">$ cd my-project/<br/>$ git init<br/>$ heroku git:remote -a ml-deployment-app</span></pre><h2 id="6de4" class="mv mw it bd no np nq dn nr ns nt dp nu kb nv nw nx kf ny nz oa kj ob oc od oe bi translated">部署应用程序</h2><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/3a3537ae1e738f9698af638397c0feb8.png" data-original-src="https://miro.medium.com/v2/resize:fit:320/format:webp/1*kK5Jnm-QZ7vPkTvXSh86KA.png"/></div></figure><p id="17fb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">将您的代码提交到存储库，并使用 Git 将其部署到 Heroku。</p><pre class="lq lr ls lt gt mq mr ms mt aw mu bi"><span id="e77a" class="mv mw it mr b gy mx my l mz na">$ git add .<br/>$ git commit -am "adding files"<br/>$ git push heroku master</span></pre><p id="66e8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最后，您应该能够在 CLI 上看到如下所示的成功消息以及您的应用程序的 URL。</p><p id="7bcd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">祝贺</strong>你拥有了自己的网络直播应用。</p><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/704d31640e77d2c37b568c58bfa4227a.png" data-original-src="https://miro.medium.com/v2/resize:fit:548/format:webp/1*UBpaZIQ6Lpk9OGvdv9wShw.jpeg"/></div></figure><figure class="lq lr ls lt gt lu gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/a75211e186aab00c47387fcc6ddd8f36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1116/format:webp/1*q7oJq3Z931Su1EMvhFnpiA.png"/></div></figure><p id="ffa3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在下面的网址上查看正在运行的应用程序。</p><p id="3403" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><a class="ae nf" href="https://ml-deployment-app.herokuapp.com/" rel="noopener ugc nofollow" target="_blank">https://ml-deployment-app.herokuapp.com/</a></p><p id="cd8a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你错过了什么或面临问题，所有的代码文件都在下面的 Github 链接中。</p><p id="f00b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><a class="ae nf" href="https://github.com/guptasoumya26/ml-deployment-app-heroku" rel="noopener ugc nofollow" target="_blank">https://github.com/guptasoumya26/ml-deployment-app-heroku</a></p></div><div class="ab cl li lj hx lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="im in io ip iq"><p id="7128" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> <em class="lh">在这篇文章中，我们学习了 Flask with Web，如何将它与 HTML 网站集成，最重要的是如何应用这些知识在 Web 服务器上部署它，以便最终用户可以随时与我们的 ML 模型交互，而无需任何外部依赖。</em>T15】</strong></p><p id="6d9c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我希望你觉得这个教程有用，谢谢你读到这里。我很好奇你是怎么想的，所以给我一些建议吧。<br/>您也可以直接通过<a class="ae nf" href="mailto:soumyansh@gmail.com" rel="noopener ugc nofollow" target="_blank">邮箱</a>与我取得联系，或者通过<a class="ae nf" href="https://www.linkedin.com/in/soumyansh/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>与我联系。</p></div></div>    
</body>
</html>