<html>
<head>
<title>Nearest Neighbour Analysis with Geospatial data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用地理空间数据的最近邻分析</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/nearest-neighbour-analysis-with-geospatial-data-7bcd95f34c0e?source=collection_archive---------8-----------------------#2019-11-28">https://towardsdatascience.com/nearest-neighbour-analysis-with-geospatial-data-7bcd95f34c0e?source=collection_archive---------8-----------------------#2019-11-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a662" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">关于如何在 Python 中查找空间数据的最近邻的指南</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/1bb1a80e260c16c1272afc2c65045811.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OOzIFj9pWOJ1Epn5"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Photo by <a class="ae ky" href="https://unsplash.com/@franckinjapan?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Franck V.</a> on <a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="060a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">查找一个对象与另一个对象的最近邻是一项常见的空间数据分析任务。例如，确定离家最近的服务点是一个优化问题，需要使用空间数据执行<strong class="lb iu">最近邻分析</strong>。</p><p id="5dbf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本教程中，我们使用芝加哥市的自行车共享数据集执行最近邻分析。数据集由两个独立的文件组成。第一个是自行车站点，第二个是随机生成的点。我们<strong class="lb iu">想要确定哪个站靠近第二个数据集中的任意给定点</strong>——随机生成的点。随机生成的数据集可以表示真实情况，其中骑车人想要确定哪个自行车站离停放自行车最近。</p><h2 id="d21a" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">探索数据</h2><p id="18b4" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">我们使用 pandas 读取数据，并调用第一个数据帧<code class="fe mt mu mv mw b">stations</code>,其中包含站点名称、容量和坐标等属性。</p><pre class="kj kk kl km gt mx mw my mz aw na bi"><span id="1be9" class="lv lw it mw b gy nb nc l nd ne">stations = pd.read_csv(“data/stations.csv”)<br/>stations.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nf"><img src="../Images/3814bcbb19ce165137a21d8f44b88a23.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CRYiPgUd78kooxVOBgjsAA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Bike stations</figcaption></figure><p id="5b1c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第二个表保存随机生成的点。我们称之为数据帧<code class="fe mt mu mv mw b">points</code>。我们在这个表中只有三列，id 和 X 和 y 的坐标。</p><pre class="kj kk kl km gt mx mw my mz aw na bi"><span id="fc47" class="lv lw it mw b gy nb nc l nd ne">points = pd.read_csv(“data/points.csv”)<br/>points.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/506252c938ead24596594176c6c8f10e.png" data-original-src="https://miro.medium.com/v2/resize:fit:826/format:webp/1*8sCJRGgl0IhMdaJF319mvA.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Random points</figcaption></figure><p id="89f9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要执行任何地理处理任务，包括本教程中的最近邻分析，我们需要使用 Geopandas 将数据转换为地理数据框架。这将允许我们计算 Geopandas 中可用的任何地理处理任务以及我们想要使用的任何 pandas 方法。</p><p id="86c9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下函数将两个数据集转换为 Geopandas 地理数据框架。这将创建一个存储几何图形的附加列。我们还为数据集构建了一个坐标参考系统，在本例中，EPSG:4326。</p><pre class="kj kk kl km gt mx mw my mz aw na bi"><span id="4d23" class="lv lw it mw b gy nb nc l nd ne">def create_gdf(df, x=”xcoord”, y=”ycoord”):<br/>    return gpd.GeoDataFrame(df, <br/>    geometry=gpd.points_from_xy(df[y], df[x]), <br/>             crs={“init”:”EPSG:4326"})</span><span id="d1c4" class="lv lw it mw b gy nh nc l nd ne">stations_gdf = create_gdf(stations)<br/>points_gdf = create_gdf(points)</span></pre><p id="d233" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，让我们使用 follow Python 库可视化地图中的数据。</p><pre class="kj kk kl km gt mx mw my mz aw na bi"><span id="ef05" class="lv lw it mw b gy nb nc l nd ne">m = folium.Map([41.805379, -87.601501], tiles=”CartoDb dark_matter”)</span><span id="64f7" class="lv lw it mw b gy nh nc l nd ne">locs_stations = zip(stations_gdf.ycoord, stations_gdf.xcoord)</span><span id="dc10" class="lv lw it mw b gy nh nc l nd ne">locs_points = zip(points_gdf.ycoord, points_gdf.xcoord)</span><span id="4d4c" class="lv lw it mw b gy nh nc l nd ne">for location in locs_stations:<br/>    folium.CircleMarker(location=location, <br/>        color=”red”,   radius=4).add_to(m)</span><span id="a8bc" class="lv lw it mw b gy nh nc l nd ne">for location in locs_points:<br/>    folium.CircleMarker(location=location, <br/>        color=”white”, radius=2).add_to(m)</span><span id="3b9c" class="lv lw it mw b gy nh nc l nd ne">m</span></pre><p id="0bd0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下图显示了红色的<code class="fe mt mu mv mw b">station_gdf</code>和白色的<code class="fe mt mu mv mw b">points_gdf</code>。目标是为随机生成的点找出最近的站。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/665b404053639c28571e1e6f6cd880fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ukLipa5rziKZLFbUMJ3ocA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Map — Bike stations in Red &amp; random points in white</figcaption></figure><p id="d9ce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在下一节中，我们将使用 Geopandas 和 Shapely 功能执行最近邻分析。</p><h2 id="af84" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">表演最近邻</h2><p id="531f" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">我们想找到离其他随机点最近的自行车站。我们可以使用 Shapely function <code class="fe mt mu mv mw b">nearest_points</code>功能找出最接近每个位置的几何图形，并在此过程中保存其他属性，例如，车站的名称。这里，我们使用<code class="fe mt mu mv mw b">caclulate_nearest </code>函数，该函数接受目的地(<code class="fe mt mu mv mw b">station_gdf</code>)和我们希望从该数据集存储的值(车站名称)。</p><pre class="kj kk kl km gt mx mw my mz aw na bi"><span id="ad90" class="lv lw it mw b gy nb nc l nd ne">def calculate_nearest(row, destination, val, col=”geometry”):</span><span id="8e07" class="lv lw it mw b gy nh nc l nd ne">    # 1 - create unary union    <br/>    dest_unary = destination[“geometry”].unary_union</span><span id="58e5" class="lv lw it mw b gy nh nc l nd ne">    # 2 - find closest point<br/>    nearest_geom = nearest_points(row[col], dest_unary)</span><span id="ad3c" class="lv lw it mw b gy nh nc l nd ne">    # 3 - Find the corresponding geom<br/>    match_geom = destination.loc[destination.geometry <br/>                == nearest_geom[1]]</span><span id="4078" class="lv lw it mw b gy nh nc l nd ne">    # 4 - get the corresponding value<br/>    match_value = match_geom[val].to_numpy()[0]</span><span id="ed6c" class="lv lw it mw b gy nh nc l nd ne">    return match_value</span></pre><p id="1aea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将该函数应用于第二个数据集<code class="fe mt mu mv mw b">points_gdf</code>以导出每个随机点的最近几何图形(从<code class="fe mt mu mv mw b">station_gdf</code>中)以及最近几何图形的站名。</p><pre class="kj kk kl km gt mx mw my mz aw na bi"><span id="ed48" class="lv lw it mw b gy nb nc l nd ne"># Get the nearest geometry<br/>points_gdf[“nearest_geom”] = points_gdf.apply(calculate_nearest, destination=stations_gdf, val=”geometry”, axis=1)</span><span id="d634" class="lv lw it mw b gy nh nc l nd ne"># Get the nearest Bike station name<br/>points_gdf[“nearest_station”] = points_gdf.apply(calculate_nearest, destination=stations_gdf, val=”name”, axis=1)</span><span id="1705" class="lv lw it mw b gy nh nc l nd ne">points_gdf.head()</span></pre><p id="0586" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">输出是下表，其中有我们在上面创建的两个附加列。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/4846fe23401c94efa1a8654e05f3ad7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lmItMX1PH8i-VBpLiv3iCw.png"/></div></div></figure><p id="1bcf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，<code class="fe mt mu mv mw b">points_gdf</code>里既有<code class="fe mt mu mv mw b">nearest_station</code>又有<code class="fe mt mu mv mw b">nearest_geom</code>。例如，在<code class="fe mt mu mv mw b">id</code> 2 中，我们可以看到最近的车站是林肯大道&amp;百丽平面大道站。我们需要验证我们的结果，让我们从<code class="fe mt mu mv mw b">geometry</code>和<code class="fe mt mu mv mw b">nearest_geom</code>创建一个线地理数据框架，这有助于我们直观地探索数据。</p><pre class="kj kk kl km gt mx mw my mz aw na bi"><span id="50c8" class="lv lw it mw b gy nb nc l nd ne"># Create LineString Geometry<br/>points_gdf[‘line’] = points_gdf.apply(lambda row: LineString([row[‘geometry’], row[‘nearest_geom’]]), axis=1)</span><span id="3a87" class="lv lw it mw b gy nh nc l nd ne"># Create Line Geodataframe<br/>line_gdf = points_gdf[["id", "nearest_station", "line"]].set_geometry('line')</span><span id="2efb" class="lv lw it mw b gy nh nc l nd ne"># Set the Coordinate reference<br/>line_gdf.crs = crs={"init":"epsg:4326"}</span></pre><p id="863e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们有目的点<code class="fe mt mu mv mw b">station_gdf</code>，最近点<code class="fe mt mu mv mw b">points_gdf</code>，现在还有连接两个数据集的<code class="fe mt mu mv mw b">line_gdf</code>。让我们在一个情节中想象它们。</p><pre class="kj kk kl km gt mx mw my mz aw na bi"><span id="a9eb" class="lv lw it mw b gy nb nc l nd ne">m = folium.Map([41.805379, -87.601501],zoom_start = 12,  <br/>    tiles=”CartoDb dark_matter”)</span><span id="20e1" class="lv lw it mw b gy nh nc l nd ne">locs_stations = zip(stations_gdf.ycoord, stations_gdf.xcoord)</span><span id="fe8f" class="lv lw it mw b gy nh nc l nd ne">locs_points = zip(points_gdf.ycoord, points_gdf.xcoord)</span><span id="df25" class="lv lw it mw b gy nh nc l nd ne">for location in locs_stations:<br/>    folium.CircleMarker(location=location, <br/>              color=”red”,  radius=8).add_to(m)</span><span id="778f" class="lv lw it mw b gy nh nc l nd ne">for location in locs_points:<br/>    folium.CircleMarker(location=location, <br/>              color=”white”, radius=4).add_to(m)</span><span id="acb0" class="lv lw it mw b gy nh nc l nd ne">folium.GeoJson(line_gdf).add_to(m)</span><span id="c2ec" class="lv lw it mw b gy nh nc l nd ne">m.save(“map2.html”)</span><span id="b506" class="lv lw it mw b gy nh nc l nd ne">m</span></pre><p id="f7a7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">借助下图所示的地图，您可以轻松浏览数据集并查看每个点的最近站点之间的连接。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/069a0b329e0ea4ea35b2f783019aee3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M94Wv3YT9BrsTV9stLlpzQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Nearest neighbour Visualization</figcaption></figure><p id="6f2d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">地图用红色圆圈显示自行车站点，用白色显示随机点，用蓝色显示连接线。您可以在附带的笔记本中进一步探索交互式地图。最终结果是准确的，并且可以在您选择的任何其他数据集中复制。</p><h2 id="1869" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">结论</h2><p id="f431" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">在本教程中，我们讲述了如何使用 Geopandas 执行最近邻分析，以及如何使用芝加哥自行车站执行 Shapely 分析。我们还探索了如何使用 leav 轻松构建和可视化分析结果。</p><p id="bc5c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本教程的代码可以在 Github 资源库中找到:</p><div class="nk nl gp gr nm nn"><a href="https://github.com/shakasom/NearestNeighbour-Analysis" rel="noopener  ugc nofollow" target="_blank"><div class="no ab fo"><div class="np ab nq cl cj nr"><h2 class="bd iu gy z fp ns fr fs nt fu fw is bi translated">shaka som/最近邻-分析</h2><div class="nu l"><h3 class="bd b gy z fp ns fr fs nt fu fw dk translated">查找一个对象与另一个对象的最近邻是一项常见的空间数据分析任务。例如，确定…</h3></div><div class="nv l"><p class="bd b dl z fp ns fr fs nt fu fw dk translated">github.com</p></div></div><div class="nw l"><div class="nx l ny nz oa nw ob ks nn"/></div></div></a></div><p id="604c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Google Colab 笔记本可以从这里直接访问:</p><div class="nk nl gp gr nm nn"><a href="https://github.com/shakasom/NearestNeighbour-Analysis/blob/master/NNA.ipynb" rel="noopener  ugc nofollow" target="_blank"><div class="no ab fo"><div class="np ab nq cl cj nr"><h2 class="bd iu gy z fp ns fr fs nt fu fw is bi translated">shaka som/最近邻-分析</h2><div class="nu l"><h3 class="bd b gy z fp ns fr fs nt fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="nv l"><p class="bd b dl z fp ns fr fs nt fu fw dk translated">github.com</p></div></div><div class="nw l"><div class="oc l ny nz oa nw ob ks nn"/></div></div></a></div></div></div>    
</body>
</html>