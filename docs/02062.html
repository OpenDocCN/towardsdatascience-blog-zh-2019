<html>
<head>
<title>Data Manipulation for Machine Learning with Pandas</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">熊猫机器学习的数据处理</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/data-manipulation-for-machine-learning-with-pandas-ab23e79ba5de?source=collection_archive---------7-----------------------#2019-04-05">https://towardsdatascience.com/data-manipulation-for-machine-learning-with-pandas-ab23e79ba5de?source=collection_archive---------7-----------------------#2019-04-05</a></blockquote><div><div class="fc if ig ih ii ij"/><div class="ik il im in io"><div class=""/><div class=""><h2 id="615c" class="pw-subtitle-paragraph jo iq ir bd b jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf dk translated">熊猫提供的用于机器学习项目的一些数据工具的介绍</h2></div><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj kg"><img src="../Images/1cd0680b480667fdd1aa3e1191096349.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BatwmEWtECFVQdwJJKWO2Q.jpeg"/></div></div><figcaption class="ks kt gk gi gj ku kv bd b be z dk">Photo by <a class="ae kw" href="https://unsplash.com/photos/0ZQ8vojHNuc?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Michael Fenton</a> on <a class="ae kw" href="https://unsplash.com/search/photos/heart?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="9115" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi lt translated">python 熊猫库是一个开源项目，提供了各种易于使用的数据操作和分析工具。在实际建立任何模型之前，任何机器学习项目都必须花费大量时间来准备数据，分析基本趋势和模式。在接下来的文章中，我想简单介绍一下 pandas 中的各种工具，这些工具用于在开始建模之前处理、清理、转换和分析数据。</p><p id="b444" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">在整篇文章中，我将使用来自 drivendata.org 的数据集<a class="ae kw" href="https://www.drivendata.org/competitions/54/machine-learning-with-a-heart/data/" rel="noopener ugc nofollow" target="_blank">这里</a>。这也可以从克利夫兰心脏病数据库下载。训练数据包括两个单独的 csv 文件，一个包含关于许多患者的特征，第二个包含二进制标签“heart_disease_present ”,其表示患者是否患有心脏病。</p><h2 id="894b" class="mc md ir bd me mf mg dn mh mi mj dp mk lg ml mm mn lk mo mp mq lo mr ms mt mu bi translated">导入数据</h2><p id="5ac6" class="pw-post-body-paragraph kx ky ir kz b la mv js lc ld mw jv lf lg mx li lj lk my lm ln lo mz lq lr ls ik bi translated">Pandas 提供了从各种来源读取数据的工具。因为我使用的数据集是一个 csv 文件，所以我将使用 read_csv 函数。这个函数有大量的<a class="ae kw" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.read_csv.html#pandas.read_csv" rel="noopener ugc nofollow" target="_blank">选项</a>用于解析数据。对于大多数文件来说，默认选项很好——这里就是这种情况。</p><pre class="kh ki kj kk gu na nb nc nd aw ne bi"><span id="fe64" class="mc md ir nb b gz nf ng l nh ni">import pandas as pd</span><span id="0792" class="mc md ir nb b gz nj ng l nh ni">train_values = pd.read_csv('train_values.csv')<br/>train_labels = pd.read_csv('train_labels.csv')</span></pre><p id="64b1" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">为了分析数据，我需要将 train_values 和 train_labels 合并到一个数据帧中。Pandas 提供了一个合并功能，可以连接列或索引上的数据帧。在下面的代码中，我使用 patient_id 执行内部合并，将正确的值与正确的标签连接起来。</p><pre class="kh ki kj kk gu na nb nc nd aw ne bi"><span id="2a3b" class="mc md ir nb b gz nf ng l nh ni">train = pd.merge(train_values, train_labels, left_on='patient_id', right_on='patient_id', how='inner')</span></pre><h2 id="b6dd" class="mc md ir bd me mf mg dn mh mi mj dp mk lg ml mm mn lk mo mp mq lo mr ms mt mu bi translated">缺失数据</h2><p id="35e0" class="pw-post-body-paragraph kx ky ir kz b la mv js lc ld mw jv lf lg mx li lj lk my lm ln lo mz lq lr ls ik bi translated">Pandas 提供了许多处理缺失数据的功能。首先，我们可以使用<code class="fe nk nl nm nb b">isna()</code>函数来了解我们的数据中有多少缺失值。</p><p id="b03e" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">它的基本功能是查看每一行和每一列中的每一个值，如果缺少就返回<code class="fe nk nl nm nb b">True</code>，如果没有就返回<code class="fe nk nl nm nb b">false</code>。因此，我们可以编写一个函数，返回每一列中缺失值的分数。</p><pre class="kh ki kj kk gu na nb nc nd aw ne bi"><span id="fb0e" class="mc md ir nb b gz nf ng l nh ni">train.apply(lambda x: sum(x.isna()/len(train)))</span></pre><p id="b1ee" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">在该数据集中，实际上不存在任何缺失值。但是，如果有，我们可以使用<code class="fe nk nl nm nb b">DataFrame.fillna()</code>替换为另一个值，或者使用<code class="fe nk nl nm nb b">DataFrame.dropna()</code>删除包含缺失值的行。</p><p id="aad4" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">使用<code class="fe nk nl nm nb b">fillna()</code>时，你有很多选择。您可以用静态值替换，该值可以是字符串或数字。您也可以用平均值之类的计算来替换。根据数据类型和丢失值的数量，很可能必须对不同的列使用不同的策略。在下面的代码中，我演示了如何使用其他一些方便的熊猫函数，<code class="fe nk nl nm nb b">select_dtypes</code>和<code class="fe nk nl nm nb b">DataFrame.columns</code>，只用平均值填充数值。</p><pre class="kh ki kj kk gu na nb nc nd aw ne bi"><span id="a90c" class="mc md ir nb b gz nf ng l nh ni">train[train.select_dtypes(include=['int64', 'float64']).columns] = train[train.select_dtypes(include=['int64', 'float64']).columns].apply(lambda x:x.fillna(x.mean()))</span></pre><h2 id="d009" class="mc md ir bd me mf mg dn mh mi mj dp mk lg ml mm mn lk mo mp mq lo mr ms mt mu bi translated">可视化数据</h2><p id="d415" class="pw-post-body-paragraph kx ky ir kz b la mv js lc ld mw jv lf lg mx li lj lk my lm ln lo mz lq lr ls ik bi translated">在熊猫身上绘图并不特别，但是如果你想从数据中快速识别一些趋势，这通常是最有效的方法。</p><p id="f244" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">基本的绘图功能只是在系列或数据帧上调用<code class="fe nk nl nm nb b">plt.plot()</code>。pandas 中的绘图引用了 matplotlib API，因此您需要首先导入 matplotlib 来访问它。该功能支持许多不同的可视化类型，包括线形图、条形图、直方图、箱线图和散点图。pandas 中的绘图功能真正有用的地方是当您将它与其他数据聚合功能结合使用时。下面我举几个例子。</p><p id="1b0c" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">将<code class="fe nk nl nm nb b">value_counts()</code>与柱状图选项结合使用，可快速显示分类特征。在下面的代码中，我用这种方法查看了 thal(流向心脏的血液量)的分布。</p><pre class="kh ki kj kk gu na nb nc nd aw ne bi"><span id="9513" class="mc md ir nb b gz nf ng l nh ni">import matplotlib.pyplot as plt<br/>% matplotlib inline</span><span id="1e24" class="mc md ir nb b gz nj ng l nh ni">train['thal'].value_counts().plot.bar()</span></pre><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj nn"><img src="../Images/5d42fa8f2a3914de56c94b38ecd7f5cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9K_eyg8c_XLpvh7vBwT1kg.png"/></div></div></figure><p id="db15" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">使用 groupby 函数，我们可以通过峰值运动 st 段斜率来绘制平均静息血压。</p><pre class="kh ki kj kk gu na nb nc nd aw ne bi"><span id="7cb4" class="mc md ir nb b gz nf ng l nh ni">train.groupby("slope_of_peak_exercise_st_segment")['resting_blood_pressure'].mean().plot(kind='bar')</span></pre><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj no"><img src="../Images/7f8f62d41caadd56493754a887ffa09d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IUPcJ4e-U8FGXBvNNkBLSQ.png"/></div></div></figure><p id="5b82" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">Pandas 数据透视表也可以用来提供聚合数据的可视化。在这里，我比较了胸痛类型的平均血清胆固醇毫克每分升，以及与心脏病的关系。</p><pre class="kh ki kj kk gu na nb nc nd aw ne bi"><span id="aad1" class="mc md ir nb b gz nf ng l nh ni">import numpy as np</span><span id="aa85" class="mc md ir nb b gz nj ng l nh ni">pd.pivot_table(train, index='chest_pain_type', columns= 'heart_disease_present', values= "serum_cholesterol_mg_per_dl", aggfunc=np.mean).plot(kind= 'bar')</span></pre><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj np"><img src="../Images/bf7175c31e44ee6fb4dd9981e59aa01e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zCJZxNjtvfJuTtvya7gv2g.png"/></div></div></figure><h2 id="3130" class="mc md ir bd me mf mg dn mh mi mj dp mk lg ml mm mn lk mo mp mq lo mr ms mt mu bi translated">特征转换</h2><p id="a572" class="pw-post-body-paragraph kx ky ir kz b la mv js lc ld mw jv lf lg mx li lj lk my lm ln lo mz lq lr ls ik bi translated">Pandas 还有许多功能，可用于您可能需要进行的大多数功能转换。</p><p id="3869" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">例如，最常用的机器学习库要求数据是数值型的。因此，有必要转换任何非数字特征，一般来说，最好的方法是使用热编码。熊猫对此有一种方法叫做<code class="fe nk nl nm nb b">get_dummies</code>。该函数在应用于一列数据时，会将每个唯一值转换为一个新的二进制列。</p><pre class="kh ki kj kk gu na nb nc nd aw ne bi"><span id="7eea" class="mc md ir nb b gz nf ng l nh ni">train = train.drop('patient_id', axis=1)<br/>train = pd.get_dummies(train, columns=train.select_dtypes('object').columns)</span></pre><p id="2907" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">可能需要为机器学习转换特征的另一种方式是宁滨。这个数据集中的一个例子是年龄特征。将年龄分组到模型要学习的范围(或箱)中可能更有意义。熊猫还有一个功能<code class="fe nk nl nm nb b">pd.cut</code>可以用来做这个。</p><pre class="kh ki kj kk gu na nb nc nd aw ne bi"><span id="05fd" class="mc md ir nb b gz nf ng l nh ni">bins = [0, 30, 40, 50, 60, 70, 100]<br/>train['age_group'] = pd.cut(train['age'], bins)<br/>train['age_group'].value_counts().plot(kind='bar')</span></pre><figure class="kh ki kj kk gu kl gi gj paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="gi gj nq"><img src="../Images/b48148b6756b2e34a07b78663c2e55b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_PhBv8-nJIVfuP6B6zG6UA.png"/></div></div></figure><p id="a7f2" class="pw-post-body-paragraph kx ky ir kz b la lb js lc ld le jv lf lg lh li lj lk ll lm ln lo lp lq lr ls ik bi translated">这只是对 pandas 中用于机器学习项目早期阶段的一些功能的介绍。数据操作和分析以及熊猫图书馆本身还有很多方面。这通常是一个非常耗时的阶段，我发现 pandas 提供了各种各样的功能和工具，可以帮助提高这个过程的效率。</p></div></div>    
</body>
</html>