<html>
<head>
<title>Obtain Historical Weather Forecast data in CSV format using Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Python 获取 CSV 格式的历史天气预报数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/obtain-historical-weather-forecast-data-in-csv-format-using-python-5a6c090fc828?source=collection_archive---------4-----------------------#2019-06-06">https://towardsdatascience.com/obtain-historical-weather-forecast-data-in-csv-format-using-python-5a6c090fc828?source=collection_archive---------4-----------------------#2019-06-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/cc18c3baf26ef77aeaa09b691583dc43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P2AuDJnPN9mV8dqklrEoZA.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">credit: <a class="ae kf" href="https://www.pexels.com/photo/black-windmill-33493/" rel="noopener ugc nofollow" target="_blank">https://www.pexels.com/photo/black-windmill-33493/</a></figcaption></figure><p id="a518" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最近在做一个机器学习项目，需要多个城市的<strong class="ki iu">历史天气预报数据。尽管进行了大量的研究，我还是很难找到好的数据源。大多数网站只允许访问过去两周的历史数据。如果需要更多，需要付费。在我的例子中，我需要五年的数据——每小时的历史预测，这可能很昂贵。</strong></p></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><h1 id="af18" class="ll lm it bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated"><strong class="ak">概述……</strong></h1><p id="c7b1" class="pw-post-body-paragraph kg kh it ki b kj mj kl km kn mk kp kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated"><strong class="ki iu"> 1。免费—至少在试用期内</strong></p><p id="8ebe" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">不需要提供信用卡信息。</p><p id="b857" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu"> 2。灵活</strong></p><p id="69bf" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">灵活改变预测时间间隔，时间段，地点。</p><p id="d724" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu"> 3。可重复</strong></p><p id="b3ab" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">易于在生产阶段复制和实施。</p><p id="280c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最后，我决定使用来自世界天气在线的数据。这花了我不到两分钟的时间订阅免费试用高级 API——无需填写信用卡信息。(截至 2019 年 5 月 30 日，60 天内每天 500 次免费请求)。</p><figure class="mp mq mr ms gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mo"><img src="../Images/2f11b3ff266c915b85df1e0bc8c3b683.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kVPI57az2iE7Kjni3AhxOw.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk"><a class="ae kf" href="https://www.worldweatheronline.com/developer/signup.aspx" rel="noopener ugc nofollow" target="_blank">https://www.worldweatheronline.com/developer/signup.aspx</a></figcaption></figure><p id="bc1d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您可以在这里尝试 JSON 或 XML 格式的请求<a class="ae kf" href="https://www.worldweatheronline.com/developer/premium-api-explorer.aspx" rel="noopener ugc nofollow" target="_blank"/>。结果是嵌套的 JSON，在输入 ML 模型之前需要做一些预处理工作。因此，我写了一些<a class="ae kf" href="https://github.com/ekapope/WorldWeatherOnline" rel="noopener ugc nofollow" target="_blank">脚本</a>来将它们解析成熊猫数据帧，并保存为 CSV 以备后用。</p></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><h1 id="6b42" class="ll lm it bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">介绍 wwo-hist 包</h1><p id="ea37" class="pw-post-body-paragraph kg kh it ki b kj mj kl km kn mk kp kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated">该<a class="ae kf" href="https://pypi.org/project/wwo-hist/" rel="noopener ugc nofollow" target="_blank"> wwo-hist 包</a>用于从<a class="ae kf" href="https://www.worldweatheronline.com/developer/api/historical-weather-api.aspx" rel="noopener ugc nofollow" target="_blank">世界天气在线</a>中检索历史天气数据并解析成 pandas DataFrame 和 CSV 文件。</p><p id="3737" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">输入: api_key，location_list，start_date，end_date，frequency</p><p id="bb1c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">输出:</strong>位置名称. csv</p><p id="1800" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">输出列名:</strong> date_time，maxtempC，mintempC，totalSnow_cm，sunHour，uvIndex，uvIndex，moon_illumination，moonrise，moonset，sunrise，sunset，DewPointC，FeelsLikeC，HeatIndexC，WindChillC，WindGustKmph，cloudcover，湿度，precipMM，气压，tempC，能见度，winddirDegree，windspeedKmph</p><h2 id="291e" class="mt lm it bd ln mu mv dn lr mw mx dp lv kr my mz lz kv na nb md kz nc nd mh ne bi translated">安装软件包:</h2><pre class="mp mq mr ms gt nf ng nh ni aw nj bi"><span id="d014" class="mt lm it ng b gy nk nl l nm nn">pip install <strong class="ng iu">wwo-hist</strong></span></pre><div class="no np gp gr nq nr"><a href="https://pypi.org/project/wwo-hist/" rel="noopener  ugc nofollow" target="_blank"><div class="ns ab fo"><div class="nt ab nu cl cj nv"><h2 class="bd iu gy z fp nw fr fs nx fu fw is bi translated">世界历史</h2><div class="ny l"><h3 class="bd b gy z fp nw fr fs nx fu fw dk translated">这个软件包是用来检索和转换历史天气数据从 www.worldweatheronline.com 到熊猫…</h3></div><div class="nz l"><p class="bd b dl z fp nw fr fs nx fu fw dk translated">pypi.org</p></div></div><div class="oa l"><div class="ob l oc od oe oa of jz nr"/></div></div></a></div><h2 id="8520" class="mt lm it bd ln mu mv dn lr mw mx dp lv kr my mz lz kv na nb md kz nc nd mh ne bi translated">导入包:</h2><pre class="mp mq mr ms gt nf ng nh ni aw nj bi"><span id="d0e3" class="mt lm it ng b gy nk nl l nm nn">from <strong class="ng iu">wwo_hist</strong> import <strong class="ng iu">retrieve_hist_data</strong></span></pre><h2 id="c40d" class="mt lm it bd ln mu mv dn lr mw mx dp lv kr my mz lz kv na nb md kz nc nd mh ne bi translated">设置工作目录以存储输出 csv 文件:</h2><pre class="mp mq mr ms gt nf ng nh ni aw nj bi"><span id="9d71" class="mt lm it ng b gy nk nl l nm nn">import os<br/>os.chdir(".\YOUR_PATH")</span></pre><h2 id="6c33" class="mt lm it bd ln mu mv dn lr mw mx dp lv kr my mz lz kv na nb md kz nc nd mh ne bi translated"><strong class="ak">示例代码:</strong></h2><p id="316a" class="pw-post-body-paragraph kg kh it ki b kj mj kl km kn mk kp kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated">指定输入参数并调用<strong class="ki iu"><em class="og">retrieve _ hist _ data()</em></strong><em class="og">。</em>有关参数设置的更多信息，请访问<a class="ae kf" href="https://github.com/ekapope/WorldWeatherOnline" rel="noopener ugc nofollow" target="_blank"> my github repo </a>。</p><p id="c901" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这将从 2018 年 12 月 11 日到 2019 年 3 月 11 日<strong class="ki iu"/>检索<strong class="ki iu">新加坡</strong>和<strong class="ki iu">加州</strong>的<strong class="ki iu"> 3 小时间隔</strong>历史天气预报数据，并将输出保存到 hist_weather_data 变量和<strong class="ki iu"> CSV </strong>文件中。</p><pre class="mp mq mr ms gt nf ng nh ni aw nj bi"><span id="0585" class="mt lm it ng b gy nk nl l nm nn">frequency = 3<br/>start_date = '11-DEC-2018'<br/>end_date = '11-MAR-2019'<br/>api_key = 'YOUR_API_KEY'<br/>location_list = ['singapore','california']</span><span id="e865" class="mt lm it ng b gy oh nl l nm nn">hist_weather_data = <strong class="ng iu">retrieve_hist_data</strong>(api_key,<br/>                                location_list,<br/>                                start_date,<br/>                                end_date,<br/>                                frequency,<br/>                                location_label = False,<br/>                                export_csv = True,<br/>                                store_df = True)</span></pre><figure class="mp mq mr ms gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oi"><img src="../Images/9ad9b0cdf5cbcb8b5527ee5cc912ad67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Ga1fGBrxkoKgfzbu"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">This is what you will see in your console.</figcaption></figure><figure class="mp mq mr ms gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oj"><img src="../Images/f9eb89c0cb2651dbe09ef3ffefd926ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0-UJ7XO4ZG76oDlVvHQNVA.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">Result CSV(s) exported to your working directory.</figcaption></figure><figure class="mp mq mr ms gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ok"><img src="../Images/8a56c50a67535b91ce5b9843ba2ab0ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*gdtco3Zi0Kv03uz9"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">Check the CSV output.</figcaption></figure><p id="217e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你有它！详细的脚本也记录在 GitHub 上。</p></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><p id="f737" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">感谢您的阅读。请尝试一下，并让我知道你的反馈！</p><p id="78b7" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">考虑在<a class="ae kf" href="https://github.com/ekapope" rel="noopener ugc nofollow" target="_blank"> GitHub </a>、<a class="ae kf" href="https://medium.com/@ekapope.v" rel="noopener"> Medium </a>和<a class="ae kf" href="https://twitter.com/EkapopeV" rel="noopener ugc nofollow" target="_blank"> Twitter </a>上关注我，在你的 feed 上获取更多文章和教程。如果你喜欢我做的，不要只按一次拍手按钮。击中它 50 次:D</p></div></div>    
</body>
</html>