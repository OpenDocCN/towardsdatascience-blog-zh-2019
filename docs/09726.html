<html>
<head>
<title>Reverse Geocoding in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python 中的反向地理编码</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/reverse-geocoding-in-python-a915acf29eb6?source=collection_archive---------0-----------------------#2019-12-21">https://towardsdatascience.com/reverse-geocoding-in-python-a915acf29eb6?source=collection_archive---------0-----------------------#2019-12-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="ede7" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何将原始的纬度/经度转换成带有地址的有洞察力的数据。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/1d3844d3744e27e7328ff895f2bc523a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*CKnFJMS14cBJLorv"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Photo by <a class="ae ky" href="https://unsplash.com/@devintavery?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Devin Avery</a> on <a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="2edf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">许多数据集只有坐标——纬度和经度——与我们人类识别的地址、街道名称、建筑名称或邮政编码等可识别特征没有任何关联。反向地理编码是许多位置数据科学应用中的重要组成部分。将原始坐标转换为有洞察力的位置数据要素的过程称为反向地理编码。</p><blockquote class="lv lw lx"><p id="9575" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated"><strong class="lb iu">反向地理编码</strong>是将一个点的位置(纬度、经度)反向(反向)编码为可读地址或地名的过程。— <a class="ae ky" href="https://en.wikipedia.org/wiki/Reverse_geocoding" rel="noopener ugc nofollow" target="_blank">维基百科</a></p></blockquote><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mc"><img src="../Images/9c53d52d6e5da10fc002f86293aacefa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GC6HUHW4101DZpBLrUVU1Q.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Reverse Geocoding</figcaption></figure><p id="f98d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本教程中，我们将介绍如何使用 Python 执行反向地理编码。我们使用 Pandas 和 Geopy 库来提供反向地理编码。在下一节中，我们将介绍一些基础知识，并将单点坐标转换为带有邮政编码和建筑物名称的地址。</p><h2 id="0b2d" class="md me it bd mf mg mh dn mi mj mk dp ml li mm mn mo lm mp mq mr lq ms mt mu mv bi translated">反向地理编码单一示例</h2><p id="3200" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li my lk ll lm mz lo lp lq na ls lt lu im bi translated">让我们先导入我们的库。</p><pre class="kj kk kl km gt nb nc nd ne aw nf bi"><span id="56b0" class="md me it nc b gy ng nh l ni nj">%load_ext autotime<br/>import pandas as pd<br/>import geopandas as gpd<br/>import geopy<br/>from geopy.geocoders import Nominatim<br/>from geopy.extra.rate_limiter import RateLimiter</span><span id="3a55" class="md me it nc b gy nk nh l ni nj">import matplotlib.pyplot as plt<br/>import plotly_express as px</span><span id="d0e6" class="md me it nc b gy nk nh l ni nj">import tqdm<br/>from tqdm._tqdm_notebook import tqdm_notebook</span></pre><p id="ca70" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们现在可以构建我们的地理编码器。我们首先需要指定地理编码服务。您可以访问不同的服务，包括<code class="fe nl nm nn nc b">'google'</code>、<code class="fe nl nm nn nc b">'bing'</code>、<code class="fe nl nm nn nc b">'yahoo'</code>和<code class="fe nl nm nn nc b">'openmapquest'</code>。其中一些服务在特定限制后收取少量免费费用，但在我们的示例中，我们将使用 Openstreetmap 的免费地理编码服务。</p><pre class="kj kk kl km gt nb nc nd ne aw nf bi"><span id="229b" class="md me it nc b gy ng nh l ni nj">locator = Nominatim(user_agent=”myGeocoder”)</span><span id="3569" class="md me it nc b gy nk nh l ni nj">coordinates = “53.480837, -2.244914”</span><span id="2a7a" class="md me it nc b gy nk nh l ni nj">location = locator.reverse(coordinates)</span><span id="ca38" class="md me it nc b gy nk nh l ni nj">location.raw</span></pre><p id="1ce2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦您使用我们选择的地理编码服务提供了坐标，结果就是您可以访问的不同要素的字典。如果你打印出<code class="fe nl nm nn nc b">location</code>的<code class="fe nl nm nn nc b">raw</code>元素，你将会看到几个源自坐标的激动人心的特征。</p><pre class="kj kk kl km gt nb nc nd ne aw nf bi"><span id="c9bd" class="md me it nc b gy ng nh l ni nj">{‘address’: {‘building’: ‘Eagle Insurance Buildings’, <br/>‘city’: ‘Manchester’, <br/>‘country’: ‘United Kingdom’, <br/>‘country_code’: ‘gb’, <br/>‘county’: ‘Greater Manchester’, <br/>‘house_number’: ‘68’, <br/>‘postcode’: ‘M2 4JG’, <br/>‘road’: ‘Cross Street’, <br/>‘state’: ‘England’, <br/>‘state_district’: ‘North West England’, <br/>‘suburb’: ‘City Centre’}, <br/>‘boundingbox’: [‘53.480856’, ‘53.4810634’, ‘-2.2451761’, ‘-2.2449576’], <br/>‘display_name’: ‘Eagle Insurance Buildings, 68, Cross Street, City Centre, Manchester, Greater Manchester, North West England, England, M2 4JG, United Kingdom’,<br/>‘lat’: ‘53.4809597’, <br/>‘licence’: ‘Data © OpenStreetMap contributors, ODbL 1.0. <a class="ae ky" href="https://osm.org/copyright" rel="noopener ugc nofollow" target="_blank">https://osm.org/copyright</a>', <br/>‘lon’: ‘-2.24506682746292’, <br/>‘osm_id’: 37139875, <br/>‘osm_type’: ‘way’, <br/>‘place_id’: 86197794}</span></pre><p id="7df3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里，您有一个建筑物，邮政编码，地址，国家，道路名称和一堆其他深刻的属性，不可用的原始坐标。如果你只对打印地址感兴趣，你可以使用字典键，或者你可以直接这样做。</p><pre class="kj kk kl km gt nb nc nd ne aw nf bi"><span id="2c8c" class="md me it nc b gy ng nh l ni nj">print(location.address)</span></pre><p id="5b13" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它将打印出输出的地址部分。在下一节中，我们将了解如何在 Pandas 数据帧中使用反向地理编码。</p><h2 id="8530" class="md me it bd mf mg mh dn mi mj mk dp ml li mm mn mo lm mp mq mr lq ms mt mu mv bi translated">使用熊猫数据框架进行反向地理编码</h2><p id="dfa1" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li my lk ll lm mz lo lp lq na ls lt lu im bi translated">我们通常希望从纬度和经度(反向地理编码)而不是单个坐标获得地址的子集或完整数据集。在这一部分，我们将探索如何通过熊猫和地质公园做到这一点。</p><p id="8c92" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，我们从熊猫的 URL 中读取数据。数据存储在 Dropbox 中，如果我们有一个链接，我们可以很容易地使用熊猫。你只需要确保 URL 的最后几个字符设置为“dl=1”。</p><pre class="kj kk kl km gt nb nc nd ne aw nf bi"><span id="d01f" class="md me it nc b gy ng nh l ni nj">url = “https://www.dropbox.com/s/15gisj8hx218rn1/street-pole-sample.csv?dl=1"</span><span id="4207" class="md me it nc b gy nk nh l ni nj">df = pd.read_csv(url)</span><span id="b6cf" class="md me it nc b gy nk nh l ni nj">df.head()</span></pre><p id="e06c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据具有 X 和 Y 列，其中的坐标与其他要素一起存储，如下表所示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/9fce8f6b665e2bcb4d7c444f50b12b70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bh6Ud09b5CUVdRNLAj9Oug.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Street Poles in Philadelphia Data</figcaption></figure><p id="c5f8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还可以使用 Plotly Express 浏览数据并在地图中显示。只需一行代码，您就可以显示带有底图的地图。</p><pre class="kj kk kl km gt nb nc nd ne aw nf bi"><span id="6bcc" class="md me it nc b gy ng nh l ni nj">import plotly_express as px</span><span id="c8aa" class="md me it nc b gy nk nh l ni nj">px.scatter_mapbox(df, lat=”Y”, lon=”X”, zoom=15)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/2eb9e8a30428665c9baf2f43d9eb79bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dKwLxVO9F8lGr8eGJCHijg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Philly Street Poles Map</figcaption></figure><p id="b045" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">地图显示了 Phillidelphia 街道杆的子集。现在，我们需要从 X 和 Y 列构造坐标列。我们只需将这两列(X &amp; Y)映射为字符串，然后用逗号将它们连接起来，就可以实现这一点。</p><pre class="kj kk kl km gt nb nc nd ne aw nf bi"><span id="4575" class="md me it nc b gy ng nh l ni nj">df[“geom”] = df[“Y”].map(str) + ‘,’ + df[‘X’].map(str)<br/>df[“geom”][0]</span></pre><p id="cd4d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是我们在上面创建的<code class="fe nl nm nn nc b">geom</code>列的第一行。</p><pre class="kj kk kl km gt nb nc nd ne aw nf bi"><span id="1bac" class="md me it nc b gy ng nh l ni nj">'39.9427660880249,-75.17009743393821'</span></pre><p id="681a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们创建一个服务提供者<code class="fe nl nm nn nc b">locator</code>这个时间通行证<code class="fe nl nm nn nc b">timeout</code>是 10 分钟，因为我们有许多行。这将防止您在此过程中可能遇到的超时错误。</p><pre class="kj kk kl km gt nb nc nd ne aw nf bi"><span id="505b" class="md me it nc b gy ng nh l ni nj">locator = Nominatim(user_agent=”myGeocoder”, timeout=10)</span><span id="8a78" class="md me it nc b gy nk nh l ni nj">rgeocode = RateLimiter(locator.reverse, min_delay_seconds=0.001)</span></pre><p id="607d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们可以通过应用上面创建的反向地理编码<code class="fe nl nm nn nc b">rgeocode</code>来进行反向地理编码。为了得到一个漂亮的进度条，我们使用了 tqdm 库。</p><pre class="kj kk kl km gt nb nc nd ne aw nf bi"><span id="c16e" class="md me it nc b gy ng nh l ni nj">tqdm.pandas()</span><span id="da4a" class="md me it nc b gy nk nh l ni nj">df[‘address’] = df[‘geom’].progress_apply(rgeocode)<br/>df.head()</span></pre><p id="9942" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这可能需要一段时间，具体取决于数据集中的行数。但是一旦该过程完成，数据集中就会有一个额外的要素，其中每个点都有一个地址，如下所示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/04ad2005abbbbd5f3d500d7cb9dbf036.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4Sr9AG0pojT4Jrfvw9TAww.png"/></div></div></figure><p id="34e9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据现在有了与每个点相关的更有洞察力的属性，包括地址、邮政编码、建筑物等。…</p><p id="e60c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">仅用 150 个点进行反向地理编码，耗时 1 分 45 秒。计算时间可能不是一个好的选择，因为数据点的增加将需要大量的处理时间。如果您有一个大型数据集，您可以尝试减少延迟秒数。</p><h2 id="8dd6" class="md me it bd mf mg mh dn mi mj mk dp ml li mm mn mo lm mp mq mr lq ms mt mu mv bi translated">结论</h2><p id="db89" class="pw-post-body-paragraph kz la it lb b lc mw ju le lf mx jx lh li my lk ll lm mz lo lp lq na ls lt lu im bi translated">在本文中，我们探讨了如何将地理编码坐标转换为地址。您可以在这个 Google Colab 笔记本中访问本教程的笔记本。</p><div class="nr ns gp gr nt nu"><a href="https://colab.research.google.com/github/shakasom/geocoding/blob/master/ReverseGeocoding.ipynb" rel="noopener  ugc nofollow" target="_blank"><div class="nv ab fo"><div class="nw ab nx cl cj ny"><h2 class="bd iu gy z fp nz fr fs oa fu fw is bi translated">谷歌联合实验室</h2><div class="ob l"><h3 class="bd b gy z fp nz fr fs oa fu fw dk translated">编辑描述</h3></div><div class="oc l"><p class="bd b dl z fp nz fr fs oa fu fw dk translated">colab.research.google.com</p></div></div><div class="od l"><div class="oe l of og oh od oi ks nu"/></div></div></a></div></div></div>    
</body>
</html>