<html>
<head>
<title>Teaching a RNN to write code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">教 RNN 人写代码</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/teaching-an-rnn-to-write-code-84a8e3435f65?source=collection_archive---------27-----------------------#2019-10-01">https://towardsdatascience.com/teaching-an-rnn-to-write-code-84a8e3435f65?source=collection_archive---------27-----------------------#2019-10-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="4cf1" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">请放心，您可以阅读本文的其余部分，知道您的开发职业不会有任何风险。</h2></div><p id="fca7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">上学的时候对计算机科学和开发了解不多，偶然发现了<a class="ae le" href="https://hackertyper.net/" rel="noopener ugc nofollow" target="_blank">这个很酷的网站</a>。当键盘上的任意键被点击时，它会输出视觉上有意义的代码。它让任何人看起来都像一个专业黑客，整个矩阵都是黑底绿字，发现这个工具意味着巨大的责任，因为它有可能给人留下深刻印象——但这是另一个故事了。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi lf"><img src="../Images/bb1fc1991cbb6ebc9a621bbdc0d77cda.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3YdGRlhIX6G66bFopHyqjw.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk">Source code of the matrix (<a class="ae le" href="https://hackertyper.net/" rel="noopener ugc nofollow" target="_blank">Cloned from Keanu’s GitHub</a>)</figcaption></figure><p id="7b66" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">几年后，在发现了 RNN 氏症之后，在抽出一些空闲时间从事这个迷你项目之后，我终于有机会目睹了“代码创建”，结果令人捧腹。</p><h2 id="1c88" class="lv lw it bd lx ly lz dn ma mb mc dp md kr me mf mg kv mh mi mj kz mk ml mm mn bi translated">数据集</h2><p id="8fa8" class="pw-post-body-paragraph ki kj it kk b kl mo ju kn ko mp jx kq kr mq kt ku kv mr kx ky kz ms lb lc ld im bi translated">对于本文，我决定用两个数据集来训练网络:</p><ol class=""><li id="ec09" class="mt mu it kk b kl km ko kp kr mv kv mw kz mx ld my mz na nb bi translated">我从 https://github.com/gcc-mirror/gcc 的<a class="ae le" href="https://github.com/gcc-mirror/gcc" rel="noopener ugc nofollow" target="_blank">拿的几个 C 文件。(完全公开——因为我的 C 语言知识是中级的，所以我随机选择了两个看起来足够长的 C 文件)</a></li><li id="aeb7" class="mt mu it kk b kl nc ko nd kr ne kv nf kz ng ld my mz na nb bi translated">HTML 页面——没有任何内联或外部 CSS 或 Javascript。</li></ol><p id="cedf" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">框架和平台<br/> </strong>我很喜欢学习<a class="ae le" href="https://www.tensorflow.org/" rel="noopener ugc nofollow" target="_blank"> TensorFlow </a> (v2.0)和<a class="ae le" href="https://keras.io/" rel="noopener ugc nofollow" target="_blank"> Keras </a>，但我会将本教程主要放在 TensorFlow 上，并在我认为比 TensorFlow 更容易实现或理解的地方提供 Keras 实现的示例。<br/>我使用过<a class="ae le" href="https://colab.research.google.com/notebooks/welcome.ipynb" rel="noopener ugc nofollow" target="_blank">Google Colab</a>——这是一个由 Google 提供的很酷的云服务，允许你完全在云上运行你的 Jupyter 笔记本 env(无论是 CPU 还是 GPU 运行时)</p><h2 id="c01d" class="lv lw it bd lx ly lz dn ma mb mc dp md kr me mf mg kv mh mi mj kz mk ml mm mn bi translated">想法</h2><p id="ba1a" class="pw-post-body-paragraph ki kj it kk b kl mo ju kn ko mp jx kq kr mq kt ku kv mr kx ky kz ms lb lc ld im bi translated">在文本生成领域，<a class="ae le" href="https://en.wikipedia.org/wiki/Recurrent_neural_network#LSTM" rel="noopener ugc nofollow" target="_blank">递归神经网络——特别是长短期记忆(LSTM) </a>网络擅长记住给定输入的输出历史，然后相应地预测新的结果。</p><p id="ac08" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这听起来可能比实际情况复杂一点，所以让我试着分解一下— <br/>考虑一下正文</p><blockquote class="nh ni nj"><p id="332e" class="ki kj nk kk b kl km ju kn ko kp jx kq nl ks kt ku nm kw kx ky nn la lb lc ld im bi translated">这只狗被命名为猫。</p></blockquote><p id="e97f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，当我们将此作为训练数据提供给 RNN 时，我们将文本中的每个标记等同于其输出的直接邻居。</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="no np l"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk">Input to Output correlation [ training data ]</figcaption></figure><p id="b0d8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">每个[i+1]元素被训练为每个第 I 个元素的输出。</p><h2 id="499a" class="lv lw it bd lx ly lz dn ma mb mc dp md kr me mf mg kv mh mi mj kz mk ml mm mn bi translated">步伐</h2><h2 id="d075" class="lv lw it bd lx ly lz dn ma mb mc dp md kr me mf mg kv mh mi mj kz mk ml mm mn bi translated"><strong class="ak"> 1。导入库和数据集</strong></h2><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="nq np l"/></div></figure><p id="5870" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">使用 Google Colab 允许我们通过使用 google.colab 连接到 Google Drive 上的数据集。验证您的帐户后，您可以装载驱动器并指向您的数据集。</p><h2 id="e7b0" class="lv lw it bd lx ly lz dn ma mb mc dp md kr me mf mg kv mh mi mj kz mk ml mm mn bi translated"><strong class="ak"> 2。准备查找表和数据集</strong></h2><p id="d671" class="pw-post-body-paragraph ki kj it kk b kl mo ju kn ko mp jx kq kr mq kt ku kv mr kx ky kz ms lb lc ld im bi translated">查找表负责将字符转换为整数，并将整数转换为字符。字符的查找表是建立在我们的文本词汇上的。</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="nq np l"/></div></figure><p id="befa" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，我们可以将数据集分成输入(dataX)和输出(dataY)。为了创建数据集，我们通过每个字符的步长来累积输入和输出。这里，每个训练模式是一个字符(输入)的 100 次步进，后跟一个字符输出。我们从文本的开头开始，直到结尾，如果有任何剩余部分，就把它们去掉。</p><pre class="lg lh li lj gt nr ns nt nu aw nv bi"><span id="e490" class="lv lw it ns b gy nw nx l ny nz">sequences = char_dataset.batch(seq_length+1, drop_remainder=True)<br/>char_dataset = tf.data.Dataset.from_tensor_slices(text2int)</span><span id="fc97" class="lv lw it ns b gy oa nx l ny nz">def split_input_target(chunk):<br/>    dataX = chunk[:-1]<br/>    dataY = chunk[1:]<br/>    return dataX, dataY</span><span id="81f5" class="lv lw it ns b gy oa nx l ny nz">dataset = sequences.map(split_input_target)<br/></span></pre><h2 id="bea0" class="lv lw it bd lx ly lz dn ma mb mc dp md kr me mf mg kv mh mi mj kz mk ml mm mn bi translated"><strong class="ak"> 3。构建和编译模型</strong></h2><pre class="lg lh li lj gt nr ns nt nu aw nv bi"><span id="6117" class="lv lw it ns b gy nw nx l ny nz">def build_model(vocab_size, embedding_dim, rnn_units, batch_size):<br/>  model = tf.keras.Sequential([<br/>    tf.keras.layers.Embedding(vocab_size, embedding_dim,<br/>                              batch_input_shape=[batch_size, None]),<br/>    tf.keras.layers.GRU(rnn_units,<br/>                        return_sequences=True,<br/>                        stateful=True,<br/>                        recurrent_initializer='glorot_uniform'),<br/>    tf.keras.layers.Dense(vocab_size)<br/>  ])<br/>  return model</span></pre><p id="122b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">并且训练模型！这个模型在 Colab 上被训练了 30 个时期</p><pre class="lg lh li lj gt nr ns nt nu aw nv bi"><span id="fe3b" class="lv lw it ns b gy nw nx l ny nz">model.compile(optimizer='adam',loss=tf.keras.losses.sparse_categorical_crossentropy(target_example_batch, example_batch_predictions, from_logits=True)<strong class="ns iu">)</strong></span><span id="6d2b" class="lv lw it ns b gy oa nx l ny nz">model.fit(dataset, epochs=EPOCHS, callbacks=[checkpoint_callback])</span></pre><h2 id="96d4" class="lv lw it bd lx ly lz dn ma mb mc dp md kr me mf mg kv mh mi mj kz mk ml mm mn bi translated"><strong class="ak"> 4。生成结果</strong></h2><p id="43a4" class="pw-post-body-paragraph ki kj it kk b kl mo ju kn ko mp jx kq kr mq kt ku kv mr kx ky kz ms lb lc ld im bi translated">有两组共享的结果</p><ol class=""><li id="cc48" class="mt mu it kk b kl km ko kp kr mv kv mw kz mx ld my mz na nb bi translated">HTML 数据集——使用的数据集来自维基百科(随机页面),因为它有很多 HTML 属性。我尽可能地删除了内联 CSS，这是训练数据的样子-</li></ol><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi ob"><img src="../Images/0125065e361ed79bcf38a3e28d360b0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*71lKo-LBTHPIeYgWGb4fRQ.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk">(INPUT) looks structured even without most of the CSS elements</figcaption></figure><p id="907c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下面是模型生成的代码(HTML 预览)</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi oc"><img src="../Images/ea7409f504198bd4092dc4019795b0e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0y4U13i16FY8XHnEo44_0g.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk">(OUTPUT) Lower temperature predicted output, 5000 predicted characters</figcaption></figure><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi od"><img src="../Images/8305bd613fd0ba04e777f0fe23b66d76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Nm7_29wLpKDamxc3qx_TXw.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk">(OUTPUT) Higher temperature predicted output, 10k predicted characters</figcaption></figure><p id="b0b0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">温度越低，文本越容易预测。更高的温度导致更令人惊讶的文本。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi oe"><img src="../Images/82d6fb63b7ae05e2400b7375fa7994c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E_e9hBdVSxWW9w4rPpWcXQ.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk">OUTPUT: Lower temperature, 10k predicted characters</figcaption></figure><p id="8de0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">2.生成 C 代码</p><figure class="lg lh li lj gt lk"><div class="bz fp l di"><div class="nq np l"/></div></figure><p id="73ed" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">胡言乱语，但努力。</p><p id="1271" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">感谢您的阅读！</p></div></div>    
</body>
</html>