<html>
<head>
<title>From 0 to Machine Learning with R</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 R 从 0 到机器学习</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/from-0-to-machine-learning-with-r-d339a8be6004?source=collection_archive---------12-----------------------#2019-09-03">https://towardsdatascience.com/from-0-to-machine-learning-with-r-d339a8be6004?source=collection_archive---------12-----------------------#2019-09-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/e5114ad6a99bf6213e1d2e7ee837101b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ghSi_xYoOSWLVPQLPqmVfQ.jpeg"/></div></div></figure><div class=""/><div class=""><h2 id="9c22" class="pw-subtitle-paragraph jy ja jb bd b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp dk translated">R 编码，数据帧，应用模型之旅。</h2></div><p id="d27e" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">我最近参加了一个使用 R 的项目，我来自 Python，不得不花几天时间研究 R 文档。对于初学者来说，R 文档不像 Python 那样友好，一开始把它们放在一起可能会很痛苦。</p><p id="62c3" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">然而，网上有很多很棒的资源:</p><ul class=""><li id="4780" class="lm ln jb ks b kt ku kw kx kz lo ld lp lh lq ll lr ls lt lu bi translated">文档是我最常用的网站，一旦你熟悉了语法和搜索引擎，它就是一座金矿。</li><li id="cea4" class="lm ln jb ks b kt lw kw lx kz ly ld lz lh ma ll lr ls lt lu bi translated"><a class="ae lv" href="https://www.datacamp.com/home" rel="noopener ugc nofollow" target="_blank"> Datacamp </a>是从 R(甚至 Python)开始的好地方。每周都有新的内容，还有一些不错的特色，比如项目和挑战。</li></ul><p id="7475" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">本文收集了从原始数据文件应用机器学习模型的所有元素和概念，其中 r。</p><blockquote class="mb mc md"><p id="a869" class="kq kr me ks b kt ku kc kv kw kx kf ky mf la lb lc mg le lf lg mh li lj lk ll ij bi translated">让我们从 R 开始，选择一个数据集并开始沿着代码片段工作。</p></blockquote></div><div class="ab cl mi mj hu mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ij ik il im in"><h1 id="188a" class="mp mq jb bd mr ms mt mu mv mw mx my mz kh na ki nb kk nc kl nd kn ne ko nf ng bi translated">入门指南</h1><p id="aec8" class="pw-post-body-paragraph kq kr jb ks b kt nh kc kv kw ni kf ky kz nj lb lc ld nk lf lg lh nl lj lk ll ij bi translated">在你的电脑上安装<a class="ae lv" href="https://cran.r-project.org/" rel="noopener ugc nofollow" target="_blank"> R 语言</a>。<br/>安装一个免费完整的 IDE : <a class="ae lv" href="https://www.rstudio.com/products/rstudio/#Desktop" rel="noopener ugc nofollow" target="_blank"> RStudio </a>。</p><h2 id="b6ff" class="nm mq jb bd mr nn no dn mv np nq dp mz kz nr ns nb ld nt nu nd lh nv nw nf nx bi translated">图书馆</h2><p id="c720" class="pw-post-body-paragraph kq kr jb ks b kt nh kc kv kw ni kf ky kz nj lb lc ld nk lf lg lh nl lj lk ll ij bi translated">R 基本安装并不附带每个库，<strong class="ks jc">就像 Python </strong>中的 pip 一样，新的库是用这个命令安装的，在 R 终端中:</p><pre class="ny nz oa ob gt oc od oe of aw og bi"><span id="29d6" class="nm mq jb od b gy oh oi l oj ok">install.packages(tidyverse) # For installing tidyverse</span></pre><p id="f6dc" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">安装软件包后，以下是对库的一些操作:</p><pre class="ny nz oa ob gt oc od oe of aw og bi"><span id="0eb4" class="nm mq jb od b gy oh oi l oj ok">library(readr) # Load library</span><span id="8813" class="nm mq jb od b gy ol oi l oj ok"># Load multiple libraries<br/>p.names &lt;- c(‘xgboost’, ‘caret’, ‘dplyr’, ‘e1071’)<br/>lapply(p.names, library, character.only = TRUE)</span><span id="33fa" class="nm mq jb od b gy ol oi l oj ok"><br/>installed.packages()                # List available packages<br/>remove.packages("tidyverse")   # Uninstall a package</span><span id="c864" class="nm mq jb od b gy ol oi l oj ok"># Getting help and documentation<br/>?functionName<br/>help(functionName)<br/>example(functionName)</span></pre></div><div class="ab cl mi mj hu mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ij ik il im in"><h1 id="9dc0" class="mp mq jb bd mr ms mt mu mv mw mx my mz kh na ki nb kk nc kl nd kn ne ko nf ng bi translated">写一些代码</h1><h2 id="99be" class="nm mq jb bd mr nn no dn mv np nq dp mz kz nr ns nb ld nt nu nd lh nv nw nf nx bi translated">变量</h2><p id="c6b0" class="pw-post-body-paragraph kq kr jb ks b kt nh kc kv kw ni kf ky kz nj lb lc ld nk lf lg lh nl lj lk ll ij bi translated">定义变量非常简单，我们同样使用" = "或"</p><pre class="ny nz oa ob gt oc od oe of aw og bi"><span id="15bb" class="nm mq jb od b gy oh oi l oj ok"># Create new variables<br/>my_var &lt;- 54<br/>my.data.vector = c(34, 54, 65)</span><span id="2f3e" class="nm mq jb od b gy ol oi l oj ok"># Clean a variable<br/>my_var &lt;- NULL</span></pre><h2 id="0a99" class="nm mq jb bd mr nn no dn mv np nq dp mz kz nr ns nb ld nt nu nd lh nv nw nf nx bi translated">Functions</h2><p id="e83d" class="pw-post-body-paragraph kq kr jb ks b kt nh kc kv kw ni kf ky kz nj lb lc ld nk lf lg lh nl lj lk ll ij bi translated">Functions in R are similar to Python functions :</p><ul class=""><li id="73ab" class="lm ln jb ks b kt ku kw kx kz lo ld lp lh lq ll lr ls lt lu bi translated">Assign the function like you would assign a variable.</li><li id="1a2f" class="lm ln jb ks b kt lw kw lx kz ly ld lz lh ma ll lr ls lt lu bi translated">Use the <strong class="ks jc"> <em class="me">函数</em> </strong>关键字，参数在括号内。</li><li id="cf82" class="lm ln jb ks b kt lw kw lx kz ly ld lz lh ma ll lr ls lt lu bi translated">使用<strong class="ks jc"> <em class="me">回车</em> </strong>作为退出点</li></ul><p id="f069" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">下面这个名为<strong class="ks jc"> prod_age，</strong>的小函数以 creation_date 为参数。对于 if 语句，我们处理空情况，否则我们将值转换为 date。</p><pre class="ny nz oa ob gt oc od oe of aw og bi"><span id="fe6c" class="nm mq jb od b gy oh oi l oj ok">prod_age &lt;- function(creation_date) {<br/> if (is.na(creation_date)) {return(as.numeric(-1))}<br/> else {return(as.Date(creation_date))}<br/>}</span></pre></div><div class="ab cl mi mj hu mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ij ik il im in"><h1 id="87e5" class="mp mq jb bd mr ms mt mu mv mw mx my mz kh na ki nb kk nc kl nd kn ne ko nf ng bi translated">使用数据框架</h1><h2 id="2aa1" class="nm mq jb bd mr nn no dn mv np nq dp mz kz nr ns nb ld nt nu nd lh nv nw nf nx bi translated">加载数据，读取文件</h2><p id="bf5d" class="pw-post-body-paragraph kq kr jb ks b kt nh kc kv kw ni kf ky kz nj lb lc ld nk lf lg lh nl lj lk ll ij bi translated">readr 库中的<a class="ae lv" href="https://www.rdocumentation.org/packages/readr/versions/1.3.1/topics/read_delim" rel="noopener ugc nofollow" target="_blank"> read_delim </a>函数提供了很多工具来读取大多数文件类型。</p><p id="eb9f" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">在下面的例子中，我们指定了每一列的数据类型。该文件有 56 列，我们希望所有列都作为字符读取，所以我们使用带有“c…c”的 col_types 参数，每个字符对应一列。</p><pre class="ny nz oa ob gt oc od oe of aw og bi"><span id="c230" class="nm mq jb od b gy oh oi l oj ok"># Load the library<br/>library(readr)</span><span id="4d46" class="nm mq jb od b gy ol oi l oj ok"># Create dataframe from CSV file<br/>my_dataframe &lt;- read_delim(“C:/path/to/file.csv”,<br/>   delim = “|”,<br/>   escape_double = FALSE,<br/>   col_types = paste(rep(“c”, 56), collapse = ‘’))</span></pre><h2 id="89ad" class="nm mq jb bd mr nn no dn mv np nq dp mz kz nr ns nb ld nt nu nd lh nv nw nf nx bi translated">设置数据帧的子集</h2><p id="053a" class="pw-post-body-paragraph kq kr jb ks b kt nh kc kv kw ni kf ky kz nj lb lc ld nk lf lg lh nl lj lk ll ij bi translated">不仅在导入数据集时会遇到数据帧。有时函数结果是数据帧。子集的主要工具是括号操作符。</p><ul class=""><li id="3c9e" class="lm ln jb ks b kt ku kw kx kz lo ld lp lh lq ll lr ls lt lu bi translated">要访问特定的列，使用$运算符，非常方便。</li></ul><pre class="ny nz oa ob gt oc od oe of aw og bi"><span id="e608" class="nm mq jb od b gy oh oi l oj ok">y_train &lt;- my.dataframe$label</span></pre><ul class=""><li id="f4d5" class="lm ln jb ks b kt ku kw kx kz lo ld lp lh lq ll lr ls lt lu bi translated">为了访问特定的行，我们使用[]操作符。您可能熟悉这个语法:<strong class="ks jc">【行，列】</strong></li></ul><pre class="ny nz oa ob gt oc od oe of aw og bi"><span id="e8ae" class="nm mq jb od b gy oh oi l oj ok"># Works with numeric indices<br/>y_train &lt;- my.dataframe[c(0:100), 8]</span><span id="13c7" class="nm mq jb od b gy ol oi l oj ok"># Works with negative indices to exclude<br/>y_test &lt;- my.dataframe[-c(0:100), 8]</span></pre><ul class=""><li id="56ed" class="lm ln jb ks b kt ku kw kx kz lo ld lp lh lq ll lr ls lt lu bi translated">这是另一种仍然使用括号语法的技术。和<strong class="ks jc">命名的</strong>运算符的<strong class="ks jc">用于子集化行和列。</strong></li></ul><pre class="ny nz oa ob gt oc od oe of aw og bi"><span id="0d5a" class="nm mq jb od b gy oh oi l oj ok">filtered.dataframe &lt;- my.dataframe[<br/>   which(my.dataframe$col1 == 2),     # Filter rows on condition<br/>   names(my.dataframe) %in% c("col1","col2","col3")] # Subset cols</span></pre><ul class=""><li id="efc9" class="lm ln jb ks b kt ku kw kx kz lo ld lp lh lq ll lr ls lt lu bi translated">subset 函数:第一个参数是 dataframe，然后是行的过滤条件，然后是要选择的列。</li></ul><pre class="ny nz oa ob gt oc od oe of aw og bi"><span id="b7f2" class="nm mq jb od b gy oh oi l oj ok">filtered.dataframe &lt;- subset(<br/>   my.dataframe, <br/>   col1 == 2, <br/>   select = c("col1","col2","col3"))</span></pre><h2 id="ddfa" class="nm mq jb bd mr nn no dn mv np nq dp mz kz nr ns nb ld nt nu nd lh nv nw nf nx bi translated">dplyr 图书馆</h2><p id="4601" class="pw-post-body-paragraph kq kr jb ks b kt nh kc kv kw ni kf ky kz nj lb lc ld nk lf lg lh nl lj lk ll ij bi translated">plyr 是一个流行的数据操作库。由此产生了<strong class="ks jc"> dplyr </strong>包，它为最常见的数据操作挑战引入了一种语法。</p><p id="51a1" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">如果您来自 Python，您可能熟悉用点号链接命令。在这里，你可以用一个特殊的管道做同样的事情:<strong class="ks jc"> % &gt; %。</strong>以下是文档中的一些示例:</p><pre class="ny nz oa ob gt oc od oe of aw og bi"><span id="0548" class="nm mq jb od b gy oh oi l oj ok">starwars %&gt;% <br/>  filter(species == "Droid")</span><span id="5cc4" class="nm mq jb od b gy ol oi l oj ok">starwars %&gt;% <br/>  select(name, ends_with("color"))</span><span id="9f9c" class="nm mq jb od b gy ol oi l oj ok">starwars %&gt;% <br/>  mutate(name, bmi = mass / ((height / 100)  ^ 2)) %&gt;%<br/>  select(name:mass, bmi)</span><span id="6b92" class="nm mq jb od b gy ol oi l oj ok">starwars %&gt;% <br/>  arrange(desc(mass))</span><span id="3cb3" class="nm mq jb od b gy ol oi l oj ok">starwars %&gt;%<br/>  group_by(species) %&gt;%<br/>  summarise(<br/>    n = n(),<br/>    mass = mean(mass, na.rm = TRUE)<br/>  ) %&gt;%<br/>  filter(n &gt; 1)</span></pre><p id="432f" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated"><strong class="ks jc"> dplyr </strong>其实对于数据的筛选和探索非常方便，语法也很直观。</p><h2 id="c456" class="nm mq jb bd mr nn no dn mv np nq dp mz kz nr ns nb ld nt nu nd lh nv nw nf nx bi translated">修改列值</h2><p id="83b8" class="pw-post-body-paragraph kq kr jb ks b kt nh kc kv kw ni kf ky kz nj lb lc ld nk lf lg lh nl lj lk ll ij bi translated">包，它为最常见的数据操作挑战引入了一种语法</p><h2 id="abdd" class="nm mq jb bd mr nn no dn mv np nq dp mz kz nr ns nb ld nt nu nd lh nv nw nf nx bi translated">修改列值</h2><p id="1bc1" class="pw-post-body-paragraph kq kr jb ks b kt nh kc kv kw ni kf ky kz nj lb lc ld nk lf lg lh nl lj lk ll ij bi translated">创建 dataframe 对象时，我们使用$操作符访问特定的列。</p><pre class="ny nz oa ob gt oc od oe of aw og bi"><span id="6035" class="nm mq jb od b gy oh oi l oj ok"># Filtering rows based on a specific column value<br/>my_datarame &lt;- subset(my_dataframe, COLNAME != ‘str_value’)</span><span id="9828" class="nm mq jb od b gy ol oi l oj ok"># Assign 0 where column values match condition<br/>non_conformites$REGUL_DAYS[non_conformites$REGUL_DAYS_NUM &lt; 0] &lt;- 0</span><span id="da11" class="nm mq jb od b gy ol oi l oj ok"># Create new column from existing columns<br/>table$AMOUNT &lt;- table$Q_LITIG * table$PRICE</span><span id="6fac" class="nm mq jb od b gy ol oi l oj ok"># Delete a column<br/>my_dataframe$COLNAME &lt;- NULL</span></pre><h2 id="9ea3" class="nm mq jb bd mr nn no dn mv np nq dp mz kz nr ns nb ld nt nu nd lh nv nw nf nx bi translated">将函数应用于列</h2><p id="c937" class="pw-post-body-paragraph kq kr jb ks b kt nh kc kv kw ni kf ky kz nj lb lc ld nk lf lg lh nl lj lk ll ij bi translated">一旦我们准备好了数据帧和函数，我们通常需要对列应用函数，以应用转换。</p><p id="e511" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">这里我们使用<strong class="ks jc">应用</strong>操作符。我们用它对结构化数据的 blob 进行操作，所以它不局限于数据帧。当然，每个点必须具有相同的类型。</p><pre class="ny nz oa ob gt oc od oe of aw og bi"><span id="eee2" class="nm mq jb od b gy oh oi l oj ok"># Product age function<br/>prod_age &lt;- function(creation_date) {<br/> if (xxx) {return(as.numeric(-1))}<br/> else { return(as.Date(creation_date))}<br/>}</span><span id="083e" class="nm mq jb od b gy ol oi l oj ok"># Apply function on column<br/>mytable$PRODUCT_AGE &lt;-<br/> apply(mytable[,c(‘DATE_CREA’), drop=F], 1, function(x) prod_age(x))</span></pre><h2 id="bf43" class="nm mq jb bd mr nn no dn mv np nq dp mz kz nr ns nb ld nt nu nd lh nv nw nf nx bi translated">使用日期</h2><p id="e1b5" class="pw-post-body-paragraph kq kr jb ks b kt nh kc kv kw ni kf ky kz nj lb lc ld nk lf lg lh nl lj lk ll ij bi translated">当处理日期时，第一步是从日期字符串到日期对象。<strong class="ks jc">为。Date </strong>函数正是这样做的，并使用指定的格式进行解析。在本文<a class="ae lv" href="https://www.r-bloggers.com/date-formats-in-r/" rel="noopener ugc nofollow" target="_blank">的最后</a>，你会发现每一种日期格式都可以用于<em class="me">格式的</em>自变量。</p><pre class="ny nz oa ob gt oc od oe of aw og bi"><span id="573b" class="nm mq jb od b gy oh oi l oj ok"># Convert a column into date format<br/>sales$date_f &lt;- as.Date(sales$date, format = ‘%d/%m/%Y’)</span><span id="5bc1" class="nm mq jb od b gy ol oi l oj ok"># Create column from time difference<br/>mytable$REGUL_DAYS = as.numeric(difftime(<br/> strptime(mytable$closing, “%Y-%m-%d”),<br/> strptime(mytable$opening, “%Y-%m-%d”),<br/> unit=”days”))</span></pre><h2 id="bd00" class="nm mq jb bd mr nn no dn mv np nq dp mz kz nr ns nb ld nt nu nd lh nv nw nf nx bi translated">导出数据框架</h2><p id="442c" class="pw-post-body-paragraph kq kr jb ks b kt nh kc kv kw ni kf ky kz nj lb lc ld nk lf lg lh nl lj lk ll ij bi translated">几个内置函数允许将数据帧作为文件写入。一种非常常见的格式是 CSV。但是，RDS 格式被优化(序列化+ Gzip 压缩)以存储任何 R 对象。</p><pre class="ny nz oa ob gt oc od oe of aw og bi"><span id="1500" class="nm mq jb od b gy oh oi l oj ok"># Write to CSV<br/>write.csv(non_conformites,<br/> ‘C:\\Users\\path\\export.csv’,<br/> row.names = FALSE)</span><span id="4e0c" class="nm mq jb od b gy ol oi l oj ok"># Write to RDS<br/>saveRDS(<br/> feature_importance_values,<br/> file=”c:/path/folder/feature_importance.RDS”)</span></pre></div><div class="ab cl mi mj hu mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ij ik il im in"><h1 id="e8cf" class="mp mq jb bd mr ms mt mu mv mw mx my mz kh na ki nb kk nc kl nd kn ne ko nf ng bi translated">测绘</h1><p id="d75b" class="pw-post-body-paragraph kq kr jb ks b kt nh kc kv kw ni kf ky kz nj lb lc ld nk lf lg lh nl lj lk ll ij bi translated">就像 Python 一样，R 附带了几个用于绘制数据的库。<strong class="ks jc"> plot </strong>函数其实和 python 的<em class="me"> plt.plot </em>差不多。</p><p id="f2c5" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">RStudio 对于绘图非常方便，它有一个专用的绘图窗口，可以返回到以前的绘图。</p><h2 id="0135" class="nm mq jb bd mr nn no dn mv np nq dp mz kz nr ns nb ld nt nu nd lh nv nw nf nx bi translated">折线图</h2><pre class="ny nz oa ob gt oc od oe of aw og bi"><span id="faf9" class="nm mq jb od b gy oh oi l oj ok">plot(<br/> ref_sales$Date, ref_sales$Sales,<br/> type = ‘l’,<br/> xlab = “Date”, ylab = “Sales”,<br/> main = paste(‘Sales evolution over time for : ‘, article_ref)<br/>)</span></pre><h2 id="2092" class="nm mq jb bd mr nn no dn mv np nq dp mz kz nr ns nb ld nt nu nd lh nv nw nf nx bi translated">各种图表</h2><p id="2b94" class="pw-post-body-paragraph kq kr jb ks b kt nh kc kv kw ni kf ky kz nj lb lc ld nk lf lg lh nl lj lk ll ij bi translated">r 是统计学家的语言，它带有各种绘制数据分布的图表。</p><pre class="ny nz oa ob gt oc od oe of aw og bi"><span id="70b7" class="nm mq jb od b gy oh oi l oj ok">values &lt;- c(1, 4, 8, 2, 4)<br/>barplot(values)<br/>hist(values)<br/>pie(values)<br/>boxplot(values)</span></pre></div><div class="ab cl mi mj hu mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ij ik il im in"><h1 id="a3d3" class="mp mq jb bd mr ms mt mu mv mw mx my mz kh na ki nb kk nc kl nd kn ne ko nf ng bi translated">机器学习:XGBoost 库</h1><p id="a3bf" class="pw-post-body-paragraph kq kr jb ks b kt nh kc kv kw ni kf ky kz nj lb lc ld nk lf lg lh nl lj lk ll ij bi translated">xgboost 包是一个很好的起点，因为它有很好的文档记录。它使我们能够快速了解数据集，如特征重要性，我们将在下面看到。</p><p id="1ab8" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">对于这部分，我们需要那些具体的库:<br/> - <strong class="ks jc"> xgboost </strong>:让我们围绕 XGB 著名算法展开工作。<br/> - <strong class="ks jc">脱字符</strong>:分类和回归训练，包括许多数据处理函数<br/> - <strong class="ks jc"> dplyr </strong>:一个快速、一致的工具，用于处理内存中和内存外的类似数据帧的对象。</p><h2 id="29d2" class="nm mq jb bd mr nn no dn mv np nq dp mz kz nr ns nb ld nt nu nd lh nv nw nf nx bi translated">列车测试分离</h2><p id="96bc" class="pw-post-body-paragraph kq kr jb ks b kt nh kc kv kw ni kf ky kz nj lb lc ld nk lf lg lh nl lj lk ll ij bi translated">准备好数据帧后，我们使用索引(inTrain)将其分为训练集和测试集:</p><pre class="ny nz oa ob gt oc od oe of aw og bi"><span id="e3e1" class="nm mq jb od b gy oh oi l oj ok">set.seed(1337)<br/>inTrain &lt;- createDataPartition(y = my.dataframe$label, p = 0.85, list = FALSE)</span><span id="7385" class="nm mq jb od b gy ol oi l oj ok">X_train = xgb.DMatrix(as.matrix(my.dataframe[inTrain, ] %&gt;% select(-label)))<br/>y_train = my.dataframe[inTrain, ]$label<br/>X_test = xgb.DMatrix(as.matrix(my.dataframe[-inTrain, ] %&gt;% select(-label)))<br/>y_test = my.dataframe[-inTrain, ]$label</span></pre><h2 id="9b72" class="nm mq jb bd mr nn no dn mv np nq dp mz kz nr ns nb ld nt nu nd lh nv nw nf nx bi translated">XGBoost 的参数搜索</h2><p id="876a" class="pw-post-body-paragraph kq kr jb ks b kt nh kc kv kw ni kf ky kz nj lb lc ld nk lf lg lh nl lj lk ll ij bi translated">下面的函数做什么:<br/> -把我们的训练/测试集作为输入。<br/> -定义交叉验证的列车控制。<br/> -定义参数网格。<br/> -设置包含参数搜索的 XGB 模型。<br/> -评估模型的准确性<br/> -返回最佳参数集</p><pre class="ny nz oa ob gt oc od oe of aw og bi"><span id="4e49" class="nm mq jb od b gy oh oi l oj ok">param_search &lt;- function(xtrain, ytrain, xtest, ytest) {</span><span id="336d" class="nm mq jb od b gy ol oi l oj ok"># Cross validation init<br/> xgb_trcontrol = trainControl(method = “cv”, number = 5, allowParallel = TRUE,<br/> verboseIter = T, returnData = FALSE)</span><span id="1b15" class="nm mq jb od b gy ol oi l oj ok"># Param grid<br/> xgbGrid &lt;- expand.grid(nrounds = 60, #nrounds = c(10,20,30,40),<br/> max_depth = 20, #max_depth = c(3, 5, 10, 15, 20, 30),<br/> colsample_bytree = 0.6,#colsample_bytree = seq(0.5, 0.9, length.out = 5),<br/> eta = 0.005, #eta = c(0.001, 0.0015, 0.005, 0.1),<br/> gamma=0, min_child_weight = 1, subsample = 1<br/> )</span><span id="2539" class="nm mq jb od b gy ol oi l oj ok"># Model and parameter search<br/> xgb_model = train(xtrain, ytrain, trControl = xgb_trcontrol,<br/> tuneGrid = xgbGrid, method = “xgbTree”,<br/> verbose=2,<br/> #objective=”multi:softprob”,<br/> eval_metric=”mlogloss”)<br/> #num_class=3)</span><span id="ac50" class="nm mq jb od b gy ol oi l oj ok"># Evaluate du model<br/> xgb.pred = predict(xgb_model, xtest, reshape=T)<br/> xgb.pred = as.data.frame(xgb.pred, col.names=c(“pred”))<br/> result = sum(xgb.pred$xgb.pred==ytest) / nrow(xgb.pred)<br/> print(paste(“Final Accuracy =”,sprintf(“%1.2f%%”, 100*result)))</span><span id="6d54" class="nm mq jb od b gy ol oi l oj ok">return(xgb_model)<br/>}</span></pre><p id="9630" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">一旦参数搜索完成，我们可以直接使用它来定义我们的工作模型，我们用$操作符访问每个元素:</p><pre class="ny nz oa ob gt oc od oe of aw og bi"><span id="056d" class="nm mq jb od b gy oh oi l oj ok"><br/>best.model &lt;- xgboost(<br/> data = as.matrix(my.dataframe[inTrain, ] %&gt;% select(-IMPORTANCE)),<br/> label = as.matrix(as.numeric(my.dataframe[inTrain,]$IMPORTANCE)-1),<br/> nrounds = xgb_model$bestTune$nrounds,<br/> max_depth = xgb_model$bestTune$max_depth,<br/> eta = xgb_model$bestTune$eta,<br/> gamma = xgb_model$bestTune$gamma,<br/> colsample_bytree = xgb_model$bestTune$colsample_bytree,<br/> min_child_weight = xgb_model$bestTune$min_child_weight,<br/> subsample = xgb_model$bestTune$subsample,<br/> objective = “multi:softprob”, num_class=3)</span></pre><h2 id="6968" class="nm mq jb bd mr nn no dn mv np nq dp mz kz nr ns nb ld nt nu nd lh nv nw nf nx bi translated">计算并绘制特征重要性</h2><p id="0803" class="pw-post-body-paragraph kq kr jb ks b kt nh kc kv kw ni kf ky kz nj lb lc ld nk lf lg lh nl lj lk ll ij bi translated">同样，xgboost 包中提供了许多函数。<a class="ae lv" href="https://xgboost.readthedocs.io/en/latest/R-package/xgboostPresentation.html" rel="noopener ugc nofollow" target="_blank">文档</a>展示了其中的大部分。</p><pre class="ny nz oa ob gt oc od oe of aw og bi"><span id="aea2" class="nm mq jb od b gy oh oi l oj ok">xgb_feature_imp &lt;- xgb.importance(<br/>   colnames(donnees[inTrain, ] %&gt;% select(-label)), <br/>   model = best.model<br/>)</span><span id="15dc" class="nm mq jb od b gy ol oi l oj ok">gg &lt;- xgb.ggplot.importance(xgb_feature_imp, 40); gg</span></pre><p id="0b10" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">下面是一个功能重要性图的示例，如 Rstudio 中所示。用 xgboost 生成的聚类只是按照相似的分数对特性进行分组，没有其他特定的含义。</p><figure class="ny nz oa ob gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi om"><img src="../Images/dd835d5ca6f9225ac0045d1f777c1860.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wbnlxZbu4ZatWZXUf8GWlg.png"/></div></div><figcaption class="on oo gj gh gi op oq bd b be z dk">Feature importance with ggplot</figcaption></figure></div><div class="ab cl mi mj hu mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ij ik il im in"><h1 id="b307" class="mp mq jb bd mr ms mt mu mv mw mx my mz kh na ki nb kk nc kl nd kn ne ko nf ng bi translated">进一步阅读</h1><p id="5962" class="pw-post-body-paragraph kq kr jb ks b kt nh kc kv kw ni kf ky kz nj lb lc ld nk lf lg lh nl lj lk ll ij bi translated">我希望这是对 R 的简单介绍，我相信进步是通过操作和实验取得的。这里有一些资源可以让你继续学习，自己飞翔:</p><ul class=""><li id="0a0f" class="lm ln jb ks b kt ku kw kx kz lo ld lp lh lq ll lr ls lt lu bi translated">R-bloggers :关于 R 的新闻和教程，收集大量博文。</li><li id="b811" class="lm ln jb ks b kt lw kw lx kz ly ld lz lh ma ll lr ls lt lu bi translated">我总是会回到这个问题上来</li><li id="2331" class="lm ln jb ks b kt lw kw lx kz ly ld lz lh ma ll lr ls lt lu bi translated"><a class="ae lv" href="https://cran.r-project.org/" rel="noopener ugc nofollow" target="_blank">R 简介</a>:如果你需要 R 编码的刷新者</li><li id="348b" class="lm ln jb ks b kt lw kw lx kz ly ld lz lh ma ll lr ls lt lu bi translated"><a class="ae lv" href="https://xgboost.readthedocs.io/en/latest/R-package/xgboostPresentation.html" rel="noopener ugc nofollow" target="_blank">xgboost(R API)入门</a></li><li id="a86b" class="lm ln jb ks b kt lw kw lx kz ly ld lz lh ma ll lr ls lt lu bi translated"><a class="ae lv" href="https://www.datacamp.com/home" rel="noopener ugc nofollow" target="_blank">数据营</a>课程和文章</li><li id="cd62" class="lm ln jb ks b kt lw kw lx kz ly ld lz lh ma ll lr ls lt lu bi translated"><a class="ae lv" href="https://www.kaggle.com/kernels?sortBy=hotness&amp;group=everyone&amp;pageSize=20&amp;language=R" rel="noopener ugc nofollow" target="_blank"> Kaggle R 内核</a></li></ul><p id="8e4d" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">感谢您的关注，感谢您的反馈，一路平安！</p><figure class="ny nz oa ob gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi or"><img src="../Images/abbdbe4457e02131388713546ba5b4cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tlhG0oJERrSTX_DmqCptDw.jpeg"/></div></div></figure></div></div>    
</body>
</html>