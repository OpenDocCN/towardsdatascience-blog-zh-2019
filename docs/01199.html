<html>
<head>
<title>Implementing YOLOv3 in tensorflow python with tensornets</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 tensornets 在 tensorflow python 中实现 YOLOv3</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/track-vehicles-and-people-using-yolov3-and-tensorflow-4f3d0e5b1b5f?source=collection_archive---------12-----------------------#2019-02-24">https://towardsdatascience.com/track-vehicles-and-people-using-yolov3-and-tensorflow-4f3d0e5b1b5f?source=collection_archive---------12-----------------------#2019-02-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/324e9fd68c43c20720377b43900bba28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oGs8oE4bPtWJU651Gp1a8w.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Spectacular architecture and a splendid view! source:<a class="ae kc" href="https://pixabay.com/en/architecture-buildings-cars-city-1837176/" rel="noopener ugc nofollow" target="_blank">https://pixabay.com/en/architecture-buildings-cars-city-1837176/</a></figcaption></figure><p id="63ec" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">从对象检测到<a class="ae kc" href="https://hackerstreak.com/pix2pix-gan/" rel="noopener ugc nofollow" target="_blank">生成对抗网络</a> (GAN)，深度学习显示了它的威力。<a class="ae kc" href="https://hackerstreak.com/yolo-made-simple-interpreting-the-you-only-look-once-paper/" rel="noopener ugc nofollow" target="_blank">物体检测</a>从很好的老式人工设计的特征检测器发展到现在的基于深度学习的卷积神经网络(CNN)物体检测器，如 R-CNN、<a class="ae kc" href="https://hackerstreak.com/yolo-made-simple-interpreting-the-you-only-look-once-paper/" rel="noopener ugc nofollow" target="_blank"> YOLO </a>。使用 CNN 的检测通过预测对象的边界框坐标来近似图像中对象的位置，而分割通过预测图像中对象的边界来更进一步。在本文中，我们将逐步运行一个车辆检测网络，使用在 MS-COCO 数据集上训练的 YOLOv3，该网络可以检测大约 90 种不同类别的对象。有了这个网络，我们将能够检测和跟踪汽车，公共汽车，卡车，自行车，人和更多！要找到更多有趣的人工智能文章，请点击这里。</p><p id="b80b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir"> 1。了解张量网</strong></p><p id="5a62" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">下载 YOLOv3 的暗网权重并让它在 tensorflow 上运行是一项相当繁琐的任务。但是我们两分钟后也要做同样的事情！你怎么问？</p><p id="7451" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">嗯，李泰勋先生将各种流行网络的权重转换成 tensorflow 的格式，并发布了一个名为“Tensornets”的 PyPi 库。Tensornets 使迁移学习和运行推理成为可能，只需“10 行”直观代码。</p><p id="f6bb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">查看他的 Github 页面:<a class="ae kc" href="https://github.com/taehoonlee/tensornets" rel="noopener ugc nofollow" target="_blank">https://github.com/taehoonlee/tensornets</a></p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lb"><img src="../Images/fe7bd2568aca1021c1bdd5ebf40139c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sVAUAeTidT-DwkP5KCUvVg.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Some of the models available in tensornets</figcaption></figure><p id="f9eb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir"> 2。装载 YOLO </strong></p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lg"><img src="../Images/931141d106fc3088f2b20aa229764c34.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*92fk1kaQ_dsJhguZFtTXVw.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">You Only Look Once source:<a class="ae kc" href="https://pixabay.com/photos/yolo-sparklers-new-year-1758212/" rel="noopener ugc nofollow" target="_blank">https://pixabay.com/photos/yolo-sparklers-new-year-1758212/</a></figcaption></figure><p id="2b04" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">YOLOv3 是 YOLOv2 的改进版本，具有更高的精确度和地图得分，这也是我们选择 v3 而不是 v2 的主要原因。</p><p id="8a6c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们开始吧。</p><p id="90a8" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">首先，我们需要安装“tensornets”库，使用方便的“PIP”命令可以很容易地做到这一点。“pip install tensornets”就可以了，但是你也可以从 GitHub 上下载来安装。在开始使用代码之前，请确保安装了 Tensorflow。</p><p id="ea18" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">启动您最喜欢的 IDE 并导入 tensorflow 和 tensornets。除此之外，我们还需要 OpenCV 和 numpy 来帮助导入图像和视频。我们使用“时间”来监控网络处理一帧所需的时间。</p><pre class="lc ld le lf gt lh li lj lk aw ll bi"><span id="57a6" class="lm ln iq li b gy lo lp l lq lr">import tensorflow as tf<br/>import tensornets as nets<br/>import cv2<br/>import numpy as np<br/>import time</span></pre><p id="7363" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一旦我们导入了必要的库，我们继续为网络和模型本身创建输入占位符。</p><pre class="lc ld le lf gt lh li lj lk aw ll bi"><span id="ec1f" class="lm ln iq li b gy lo lp l lq lr">inputs = tf.placeholder(tf.float32, [None, 416, 416, 3]) <br/>model = nets.YOLOv3COCO(inputs, nets.Darknet19)</span></pre><p id="a84a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这<em class="ls">两行</em>完成了加载权重和图形的繁重任务，<strong class="kf ir">“就两行”。</strong></p><p id="fa92" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir"> 3。运行推断</strong></p><p id="b607" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在是时候创建一个 tensorflow 会话并对视频进行推理了。下面几行定义了我们要跟踪的对象的类别和它们的 MS-COCO 索引。</p><pre class="lc ld le lf gt lh li lj lk aw ll bi"><span id="fcbe" class="lm ln iq li b gy lo lp l lq lr">classes={'0':'person','1':'bicycle','2':'car','3':'bike','5':'bus','7':'truck'}<br/>list_of_classes=[0,1,2,3,5,7]#to display other detected #objects,change the classes and list of classes to their respective #COCO indices available in their website. Here 0th index is for #people and 1 for bicycle and so on. If you want to detect all the #classes, add the indices to this list</span><span id="4586" class="lm ln iq li b gy lt lp l lq lr">with tf.Session() as sess:<br/>    sess.run(model.pretrained())<br/>    <br/>    cap = cv2.VideoCapture("D://pyworks//yolo//videoplayback.mp4")<br/>    #change the path to your directory or to '0' for webcam<br/>    while(cap.isOpened()):<br/>        ret, frame = cap.read()<br/>        img=cv2.resize(frame,(416,416))<br/>        imge=np.array(img).reshape(-1,416,416,3)<br/>        start_time=time.time()<br/>        preds = sess.run(model.preds, {inputs: model.preprocess(imge)})</span></pre><p id="ec91" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir"> 4。结果</strong></p><p id="72eb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">继续前进。一旦视频帧被传送到网络，它就会返回边界框并将其封装在“preds”对象中。现在，我们可以从“preds”对象中获取检测到的类及其坐标。</p><pre class="lc ld le lf gt lh li lj lk aw ll bi"><span id="2439" class="lm ln iq li b gy lo lp l lq lr">print("--- %s seconds ---" % (time.time() - start_time)) #to time it<br/>        boxes = model.get_boxes(preds, imge.shape[1:3])<br/>        cv2.namedWindow('image',cv2.WINDOW_NORMAL)</span><span id="d46d" class="lm ln iq li b gy lt lp l lq lr">cv2.resizeWindow('image', 700,700)<br/>        <br/>        boxes1=np.array(boxes)<br/>        for j in list_of_classes: #iterate over classes<br/>            count =0<br/>            if str(j) in classes:<br/>                lab=classes[str(j)]<br/>            if len(boxes1) !=0:<br/>#iterate over detected vehicles<br/>                for i in range(len(boxes1[j])): <br/>                    box=boxes1[j][i] <br/>                    #setting confidence threshold as 40%<br/>                    if boxes1[j][i][4]&gt;=.40: <br/>                        count += 1    <br/> <br/>                        cv2.rectangle(img,(box[0],box[1]),(box[2],box[3]),(0,255,0),3)<br/>                        cv2.putText(img, lab, (box[0],box[1]), cv2.FONT_HERSHEY_SIMPLEX, 1.0, (0, 0, 255), lineType=cv2.LINE_AA)<br/>            print(lab,": ",count)<br/>    <br/>        #Display the output      <br/>        cv2.imshow("image",img)  <br/>        if cv2.waitKey(1) &amp; 0xFF == ord('q'):<br/>            break</span></pre><p id="9f81" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这将在一个新窗口中显示带有名称标签的被跟踪车辆！</p><figure class="lc ld le lf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lu"><img src="../Images/3172ed1edc4386d8045f21c18a8db729.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8Feq4r5LCsJXKD_6ElEmNw.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Et voila!</figcaption></figure><p id="6a3c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">就是这么做的！</strong></p><p id="f1cd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">YOLOv3 在英伟达 GTX 1060 6GB 上运行时的速度约为 12 fps，在英伟达 Titan 上可以达到 30 fps。随着功能强大的边缘计算设备的兴起，<a class="ae kc" href="https://hackerstreak.com/yolo-made-simple-interpreting-the-you-only-look-once-paper/" rel="noopener ugc nofollow" target="_blank"> YOLO </a>可能会取代 Mobilenet 和其他不如<a class="ae kc" href="https://hackerstreak.com/yolo-made-simple-interpreting-the-you-only-look-once-paper/" rel="noopener ugc nofollow" target="_blank"> YOLO </a>精确的紧凑型物体探测网络。卷积网络可以做的不仅仅是物体检测。语义分割、图像生成、实例分割和<a class="ae kc" href="https://medium.com/analytics-vidhya/siamese-neural-network-for-signature-verification-efd2f399d586" rel="noopener">更多</a>。</p><p id="7170" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">跳转到这里深入研究 YOLO 文件，并了解其优雅的架构和工作。</p><p id="f203" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">解读 YOLO 文件的实质细节</p><p id="e8f6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">机器学习无疑正在改变数字世界的面貌。而且几乎每个行业都会很快受到 AI 的冲击。</p><p id="c23f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了更深入地探索人工智能，请进入<a class="ae kc" href="https://hackerstreak.com" rel="noopener ugc nofollow" target="_blank"> HackerStreak </a></p><p id="5493" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在 GitHub 上找到完整的代码<a class="ae kc" href="https://github.com/Baakchsu/Vehicle-and-people-tracking-with-YOLOv3-" rel="noopener ugc nofollow" target="_blank">https://GitHub . com/baakcshu/Vehicle-and-people-tracking-with-yolov 3-</a></p><p id="d72c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有什么问题吗？向我开枪。</p><div class="lv lw gp gr lx ly"><a href="https://www.linkedin.com/in/anirudh-s-37307114b/" rel="noopener  ugc nofollow" target="_blank"><div class="lz ab fo"><div class="ma ab mb cl cj mc"><h2 class="bd ir gy z fp md fr fs me fu fw ip bi translated">在 Linkedin 上找到我</h2></div><div class="mf l"><div class="mg l mh mi mj mf mk jw ly"/></div></div></a></div><p id="f9c3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="ls">原载于</em><a class="ae kc" href="https://hackerstreak.com" rel="noopener ugc nofollow" target="_blank"><em class="ls">https://hackerstreak.com</em></a></p></div></div>    
</body>
</html>