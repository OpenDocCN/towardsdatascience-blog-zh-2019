<html>
<head>
<title>MachineX: Image Data Augmentation Using Keras</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">MachineX:使用 Keras 增强图像数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/machinex-image-data-augmentation-using-keras-b459ef87cd22?source=collection_archive---------31-----------------------#2019-12-17">https://towardsdatascience.com/machinex-image-data-augmentation-using-keras-b459ef87cd22?source=collection_archive---------31-----------------------#2019-12-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="1f92" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这篇博客中，我们将关注使用 Keras 的<strong class="js iu">图像数据增强</strong>以及我们如何实现它。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ko"><img src="../Images/804d30fc04a05df298340602b35c2609.png" data-original-src="https://miro.medium.com/v2/resize:fit:1210/0*Utma-dS47hSoQ6Zt"/></div></figure><h1 id="3173" class="kw kx it bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">问题</h1><p id="462c" class="pw-post-body-paragraph jq jr it js b jt lu jv jw jx lv jz ka kb lw kd ke kf lx kh ki kj ly kl km kn im bi translated">当我们处理图像分类项目时，用户给出的输入可能在许多方面有所不同，如点击图片时的角度、缩放和稳定性。所以我们应该训练我们的模型去接受和理解几乎所有类型的输入。</p><p id="4346" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这可以通过为所有可能性训练模型来完成。但是当训练集大到 10000 张图片时，我们不能到处点击每个可能角度的相同训练图片！</p><p id="892b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这可以很容易地通过一种叫做图像数据扩充的技术来解决，这种技术拍摄一幅图像，将其转换并以我们指定的所有可能的形式保存。</p><h1 id="5430" class="kw kx it bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">图像增强介绍</h1><p id="9151" class="pw-post-body-paragraph jq jr it js b jt lu jv jw jx lv jz ka kb lw kd ke kf lx kh ki kj ly kl km kn im bi translated">图像增强是一种用于人工扩展数据集的技术。当我们得到一个只有很少数据样本的数据集时，这是很有帮助的。在深度学习的情况下，这种情况很糟糕，因为当我们在有限数量的数据样本上训练它时，模型往往会过度拟合。</p><p id="1513" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">通常用于增加数据样本计数的图像增强参数是缩放、剪切、旋转、预处理 _ 函数等。这些参数的使用导致在深度学习模型的训练期间生成具有这些属性的图像。使用图像增强生成的图像样本通常会导致现有数据样本集增加近 3 到 4 倍。</p><h1 id="7f97" class="kw kx it bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">履行</h1><p id="a104" class="pw-post-body-paragraph jq jr it js b jt lu jv jw jx lv jz ka kb lw kd ke kf lx kh ki kj ly kl km kn im bi translated">让我们从导入所有必需的库开始:</p><pre class="kp kq kr ks gt lz ma mb mc aw md bi"><span id="b3b6" class="me kx it ma b gy mf mg l mh mi">pip install tensorflow<br/>pip install scipy<br/>pip install numpy<br/>pip install h5py<br/>pip install pyyaml<br/>pip install keras</span></pre><p id="50ab" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们已经安装了<code class="fe mj mk ml ma b">scipy</code>、<code class="fe mj mk ml ma b">numpy</code>、<code class="fe mj mk ml ma b">h5py</code>、<code class="fe mj mk ml ma b">pyyaml</code>，因为它们是<code class="fe mj mk ml ma b">keras</code>所需的依赖项，而且由于 keras 工作在<code class="fe mj mk ml ma b">tensorflow</code>后端，所以也需要安装它们。你可以在这里阅读更多关于<a class="ae mm" href="https://www.tensorflow.org/install/" rel="noopener ugc nofollow" target="_blank"> tensorflow 安装的信息</a>。我们将使用<code class="fe mj mk ml ma b">keras</code>进行图像增强。</p><p id="09f0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们导入 keras 图像预处理。</p><pre class="kp kq kr ks gt lz ma mb mc aw md bi"><span id="fa4d" class="me kx it ma b gy mf mg l mh mi">from keras.preprocessing.image import ImageDataGenerator,img_to_array, load_img</span></pre><p id="7ee3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这里，<code class="fe mj mk ml ma b">ImageDataGenerator</code>用于指定我们将用来生成图像的参数，如旋转、缩放、宽度，稍后将会介绍更多的参数。<code class="fe mj mk ml ma b">img_to_array</code>用于将给定的图像转换成一个<strong class="js iu"> numpy 数组</strong>供<code class="fe mj mk ml ma b">ImageDataGenerator</code>使用，<code class="fe mj mk ml ma b">load_img</code>将用于加载要修改的图像到我们的程序中。</p><pre class="kp kq kr ks gt lz ma mb mc aw md bi"><span id="4287" class="me kx it ma b gy mf mg l mh mi">datagen = ImageDataGenerator(<br/>        rotation_range=40,<br/>        width_shift_range=0.2,<br/>        height_shift_range=0.2,<br/>        shear_range=0.2,<br/>        zoom_range=0.2,<br/>        horizontal_flip=True,<br/>        fill_mode='nearest')</span></pre><h1 id="e2a1" class="kw kx it bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt bi translated">参数:</h1><p id="f883" class="pw-post-body-paragraph jq jr it js b jt lu jv jw jx lv jz ka kb lw kd ke kf lx kh ki kj ly kl km kn im bi translated">我们在此使用<code class="fe mj mk ml ma b">ImageDataGenerator()</code>指定生成图像的参数，解释如下:</p><p id="feee" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">旋转 _ 范围:</strong>旋转量</p><p id="8e0f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">宽度 _ 移动 _ 范围，高度 _ 移动 _ 范围:</strong>宽度、高度的移动量</p><p id="6c71" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> shear_range : </strong>逆时针方向的剪切角度，以弧度表示</p><p id="18ad" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">缩放范围:</strong>随机缩放的范围</p><p id="22b3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> horizontal_flip : </strong>布尔型(真或假)。水平随机翻转输入</p><p id="c33e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">f<strong class="js iu">ill _ mode:</strong>{“常量”、“最近”、“反射”或“换行”}之一。根据给定的模式填充输入边界外的点</p><p id="5680" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在指定参数并将它们存储在<code class="fe mj mk ml ma b">datagen</code>变量中之后，我们开始导入我们的图像。</p><pre class="kp kq kr ks gt lz ma mb mc aw md bi"><span id="661e" class="me kx it ma b gy mf mg l mh mi">img = load_img('lion.jpg')</span></pre><p id="ac5c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这里，我使用的是狮子图像，你可以简单地使用你自己的样本图像。</p><pre class="kp kq kr ks gt lz ma mb mc aw md bi"><span id="7d18" class="me kx it ma b gy mf mg l mh mi">x = img_to_array(img)  # creating a Numpy array with shape (3, 150, 150)<br/>x = x.reshape((1,) + x.shape)  # converting to a Numpy array with shape (1, 3, 150, 150)</span></pre><p id="661c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">用于加载所需的图像，您可以使用任何您喜欢的图像，但我会推荐一张脸像猫、狗或人的图像！</p><p id="3785" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">接下来，我们使用<code class="fe mj mk ml ma b">img_to_array</code>将图像转换成数字，在本例中，是一个<strong class="js iu"> numpy 数组</strong>，它可以很容易地输入到我们的<code class="fe mj mk ml ma b">flow()</code>函数中(不要担心，稍后会解释！).我们将转换后的 numpy 数组存储到一个变量<code class="fe mj mk ml ma b">x</code>中。</p><p id="0e9a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后，我们必须重塑 numpy 数组，添加另一个大小为 1 的参数。我们这样做是为了使它成为 4 阶而不是 3 阶的 numpy 数组，以容纳名为<strong class="js iu">通道轴</strong>的参数。对于灰度数据，通道轴的值应为 1，对于 RGB 数据，通道轴的值应为 3。</p><p id="28ee" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这是我的输入图像(一只狮子):</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi mn"><img src="../Images/e1dd4d567d6d07c885530deb778c2374.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1poqBIJDbu4vgBfr"/></div></div></figure><h2 id="40ae" class="me kx it bd ky ms mt dn lc mu mv dp lg kb mw mx lk kf my mz lo kj na nb ls nc bi translated">输出:</h2><p id="dd0f" class="pw-post-body-paragraph jq jr it js b jt lu jv jw jx lv jz ka kb lw kd ke kf lx kh ki kj ly kl km kn im bi translated">现在我们已经有了表单输入，让我们开始产生一些输出。</p><pre class="kp kq kr ks gt lz ma mb mc aw md bi"><span id="3c49" class="me kx it ma b gy mf mg l mh mi">i = 0<br/>for batch in datagen.flow(x,save_to_dir='output', save_prefix='lion', save_format='jpeg'):<br/>    i += 1<br/>    if i &gt; 20:<br/>        break</span></pre><p id="1239" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们在每次迭代中使用<code class="fe mj mk ml ma b">datatgen.flow()</code>函数。我们给了<code class="fe mj mk ml ma b">x</code>—输入图像的 numpy 数组、<code class="fe mj mk ml ma b">save_to_dir</code>—保存输出的目录、<code class="fe mj mk ml ma b">save_prefix</code>—图像名称的前缀和<code class="fe mj mk ml ma b">save_format</code>—作为输入的图像格式。</p><p id="f1b1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这是我们输出图像的样子:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="gh gi nd"><img src="../Images/31e81a4587813725149dccff2566f7b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*UrGSdY47kbS8ZkhW"/></div></div></figure><p id="4d79" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">请注意，由于缩放、旋转、宽度或高度偏移等原因，每张图像都与其他图像略有不同。这将有助于您将要构建的模型识别大量图像，从而提高效率。</p><p id="d216" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这是 keras 中图像增强的概述。</p><p id="3484" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">此外，请访问 Machinex 页面，了解更多相同的更新:</p><ul class=""><li id="05cc" class="ne nf it js b jt ju jx jy kb ng kf nh kj ni kn nj nk nl nm bi translated"><a class="ae mm" href="https://www.linkedin.com/company/machinex-intelligence/" rel="noopener ugc nofollow" target="_blank">领英</a></li><li id="1cf6" class="ne nf it js b jt nn jx no kb np kf nq kj nr kn nj nk nl nm bi translated"><a class="ae mm" href="https://twitter.com/MachinexWizards" rel="noopener ugc nofollow" target="_blank">推特</a></li></ul></div></div>    
</body>
</html>