<html>
<head>
<title>Travis CI for R — Advanced guide</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Travis CI for R —高级指南</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/travis-ci-for-r-advanced-guide-719cb2d9e0e5?source=collection_archive---------20-----------------------#2019-01-13">https://towardsdatascience.com/travis-ci-for-r-advanced-guide-719cb2d9e0e5?source=collection_archive---------20-----------------------#2019-01-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="2c44" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">在 Travis CI 中构建 R 项目的持续集成，包括代码覆盖、<code class="fe kf kg kh ki b"><a class="ae kj" href="https://github.com/r-lib/pkgdown" rel="noopener ugc nofollow" target="_blank">pkgdown</a></code> <a class="ae kj" href="https://github.com/r-lib/pkgdown" rel="noopener ugc nofollow" target="_blank"> </a>文档、osx 和多个 R 版本</h2></div><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="gh gi kk"><img src="../Images/7aadd0c52a29b58ac29766401c9d3164.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Om5XkKisYiGYg1ZD"/></div></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk">Photo by <a class="ae kj" href="https://unsplash.com/@guiccunha?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Guilherme Cunha</a> on <a class="ae kj" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="45d4" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">Travis CI 是构建 R 包的常用工具。在我看来，在持续集成中使用 R 是最好的平台。一些下载量最大的 R 包就是在这个平台上构建的。例如<em class="lw">测试</em>、<em class="lw"> magick </em>或<em class="lw"> covr </em>。我也在这个平台上构建了我的包<a class="ae kj" href="https://medium.com/@zappingseb/rtest-pretty-testing-of-r-packages-50f50b135650" rel="noopener"> <em class="lw"> RTest </em> </a>。在安装过程中，我遇到了一些麻烦。在这本指南中，我将与你分享我获得的知识。</p><h1 id="16c2" class="lx ly iq bd lz ma mb mc md me mf mg mh jw mi jx mj jz mk ka ml kc mm kd mn mo bi translated">目录</h1><ul class=""><li id="9ff3" class="mp mq iq lc b ld mr lg ms lj mt ln mu lr mv lv mw mx my mz bi translated"><a class="ae kj" href="#a056" rel="noopener ugc nofollow">来自“构建 R 项目”的基础知识</a></li><li id="8415" class="mp mq iq lc b ld na lg nb lj nc ln nd lr ne lv mw mx my mz bi translated"><a class="ae kj" href="#031a" rel="noopener ugc nofollow">修改 R CMD 版本</a></li><li id="d204" class="mp mq iq lc b ld na lg nb lj nc ln nd lr ne lv mw mx my mz bi translated">多种操作系统</li><li id="1a25" class="mp mq iq lc b ld na lg nb lj nc ln nd lr ne lv mw mx my mz bi translated"><a class="ae kj" href="#45c4" rel="noopener ugc nofollow">使用用户界面运行脚本</a></li><li id="ffd5" class="mp mq iq lc b ld na lg nb lj nc ln nd lr ne lv mw mx my mz bi translated"><a class="ae kj" href="#5da6" rel="noopener ugc nofollow">代码覆盖率</a></li><li id="f3a5" class="mp mq iq lc b ld na lg nb lj nc ln nd lr ne lv mw mx my mz bi translated"><a class="ae kj" href="#22c9" rel="noopener ugc nofollow">构建并部署一个 pkgdown 页面到 github 页面</a></li><li id="dad3" class="mp mq iq lc b ld na lg nb lj nc ln nd lr ne lv mw mx my mz bi translated"><a class="ae kj" href="#7ef5" rel="noopener ugc nofollow"> ImageMagick 和 Travis CI </a></li><li id="fecd" class="mp mq iq lc b ld na lg nb lj nc ln nd lr ne lv mw mx my mz bi translated"><a class="ae kj" href="#b418" rel="noopener ugc nofollow">延伸阅读</a></li></ul><h1 id="a056" class="lx ly iq bd lz ma mb mc md me mf mg mh jw mi jx mj jz mk ka ml kc mm kd mn mo bi translated">“构建 R 项目”的基础知识</h1><p id="f40e" class="pw-post-body-paragraph la lb iq lc b ld mr jr lf lg ms ju li lj nf ll lm ln ng lp lq lr nh lt lu lv ij bi translated">Travis CI 的文章“<a class="ae kj" href="https://docs.travis-ci.com/user/languages/r/" rel="noopener ugc nofollow" target="_blank">构建一个 R 项目</a>”告诉您一些基本知识。它允许为 R 包或 R 项目建立一个构建。主要的收获来自这个. travis.yml 文件。</p><pre class="kl km kn ko gt ni ki nj nk aw nl bi"><span id="4c5b" class="nm ly iq ki b gy nn no l np nq"># Use R language<br/>language: r</span><span id="2c28" class="nm ly iq ki b gy nr no l np nq">#Define multiple R-versions, one from bioconductor<br/>r:<br/>  - oldrel<br/>  - release<br/>  - devel<br/>  - bioc-devel</span><span id="0010" class="nm ly iq ki b gy nr no l np nq"># Set one of you dependencies from github<br/>r_github_packages: r-lib/testthat</span><span id="5027" class="nm ly iq ki b gy nr no l np nq"># Set one of your dependencies from CRAN<br/>r_packages: RTest</span><span id="b09c" class="nm ly iq ki b gy nr no l np nq"># set a Linux system dependency<br/>apt_packages:<br/>  - libxml2-dev</span></pre><p id="1d09" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">教程向你解释你应该把你的类型语言设置成<strong class="lc ir"> R. </strong>你可以使用不同的<strong class="lc ir"> R 版本。</strong>这些 R 版本是:</p><p id="931f" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">[旧版本，发布，开发，生物开发，生物发布]</p><p id="ec51" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">此外，你可以通过<code class="fe kf kg kh ki b">r_github_packages</code>从 github 加载任何包。或者你可以通过<code class="fe kf kg kh ki b">r_packages</code>从<a class="ae kj" href="https://cran.r-project.org/" rel="noopener ugc nofollow" target="_blank">起重机</a>处拿到任何包裹。可以使用标准的 yml 格式创建多个包的列表:</p><pre class="kl km kn ko gt ni ki nj nk aw nl bi"><span id="90ec" class="nm ly iq ki b gy nn no l np nq">r_packages:<br/>  - RTest<br/>  - testthat</span></pre><p id="c13b" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">如果你有 Linux 依赖，这需要被提及。RTest 包使用 XML 测试用例。需要的 XML Linux 库是<code class="fe kf kg kh ki b">libxml2</code>。可以通过以下方式添加:</p><pre class="kl km kn ko gt ni ki nj nk aw nl bi"><span id="e57a" class="nm ly iq ki b gy nn no l np nq">apt_packages:<br/>  - libxml2-dev</span></pre><p id="c4ef" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">您已经完成了基本操作。如果您的存储库中有这个. travis.yml 文件，它将使用<code class="fe kf kg kh ki b">R CMD build</code>和<code class="fe kf kg kh ki b">R CMD check</code>来检查您的项目。</p><h1 id="031a" class="lx ly iq bd lz ma mb mc md me mf mg mh jw mi jx mj jz mk ka ml kc mm kd mn mo bi translated">修改 R CMD 命令</h1><p id="d665" class="pw-post-body-paragraph la lb iq lc b ld mr jr lf lg ms ju li lj nf ll lm ln ng lp lq lr nh lt lu lv ij bi translated">为了建立我的项目，我想把它建得像克兰一样。因此，我需要更改包检查的脚本。因此我补充道:</p><pre class="kl km kn ko gt ni ki nj nk aw nl bi"><span id="dd28" class="nm ly iq ki b gy nn no l np nq">script:<br/>  - R CMD build . --compact-vignettes=gs+qpdf<br/>  - R CMD check *tar.gz --as-cran</span></pre><p id="9204" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">在这个脚本中，你可以改变<code class="fe kf kg kh ki b">R CMD build</code>或<code class="fe kf kg kh ki b">R CMD check</code>参数。关于<code class="fe kf kg kh ki b">R CMD</code>的参数列表，请参见 RStudio 的本<a class="ae kj" href="https://support.rstudio.com/hc/en-us/articles/200486518-Customizing-Package-Build-Options" rel="noopener ugc nofollow" target="_blank">教程。</a></p><p id="c39c" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">要运行晕影压缩，请通过以下方式获得<code class="fe kf kg kh ki b">gs+qpdf</code>:</p><pre class="kl km kn ko gt ni ki nj nk aw nl bi"><span id="fd0b" class="nm ly iq ki b gy nn no l np nq">addons:<br/>  apt:<br/>    update: true<br/>    packages:<br/>      - libgs-dev<br/>      - qpdf<br/>      - ghostscript</span></pre><h1 id="9571" class="lx ly iq bd lz ma mb mc md me mf mg mh jw mi jx mj jz mk ka ml kc mm kd mn mo bi translated">多重操作系统</h1><p id="077e" class="pw-post-body-paragraph la lb iq lc b ld mr jr lf lg ms ju li lj nf ll lm ln ng lp lq lr nh lt lu lv ij bi translated">Travis CI 目前提供两种不同的操作系统(2019 年 1 月)。那些是 macOS 和 Linux。测试的标准方式是 Linux。对于我的项目 RTest，我也需要在 macOS 中进行测试。要在两个操作系统中进行测试，请使用 Travis CI 的<code class="fe kf kg kh ki b">matrix</code>参数。</p><p id="c984" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated"><code class="fe kf kg kh ki b">matrix</code>参数允许为某些构建调整某些参数。为了在 Linux 和 macOS 中拥有完全相同的版本，我使用了以下结构:</p><pre class="kl km kn ko gt ni ki nj nk aw nl bi"><span id="0fba" class="nm ly iq ki b gy nn no l np nq">matrix:<br/>  include:<br/>  - r: release<br/>    script:<br/>      - R CMD build . --compact-vignettes=gs+qpdf<br/>      - R CMD check *tar.gz --as-cran <br/>  - r: release<br/>    os: osx<br/>    osx_image: xcode7.3<br/>    before_install:<br/>      - sudo tlmgr install framed titling<br/>    script:<br/>      - R CMD build . --compact-vignettes=gs+qpdf<br/>      - R CMD check *tar.gz --as-cran</span></pre><p id="e64f" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated"><code class="fe kf kg kh ki b">matrix</code>函数将构建分成不同的操作系统。对于 macOS，我使用了 xcode7.3 图像，因为它是由<a class="ae kj" href="https://ropensci.org/blog/2016/07/12/travis-osx/" rel="noopener ugc nofollow" target="_blank"> rOpenSCI </a>提出的。这个版本额外的一点是，它接近目前的 CRAN macOS 版本。正如你所看到的，你应该安装乳胶包<code class="fe kf kg kh ki b">framed</code>和<code class="fe kf kg kh ki b">titling</code>来创建插图。</p><h1 id="45c4" class="lx ly iq bd lz ma mb mc md me mf mg mh jw mi jx mj jz mk ka ml kc mm kd mn mo bi translated">使用用户界面运行脚本</h1><p id="9f15" class="pw-post-body-paragraph la lb iq lc b ld mr jr lf lg ms ju li lj nf ll lm ln ng lp lq lr nh lt lu lv ij bi translated">我的包<a class="ae kj" href="https://medium.com/@zappingseb/rtest-pretty-testing-of-r-packages-50f50b135650" rel="noopener"> RTest </a>使用<a class="ae kj" href="https://www.rdocumentation.org/packages/tcltk/versions/3.5.2" rel="noopener ugc nofollow" target="_blank"> Tcl/Tk </a>用户界面。为了测试这样的用户界面，您需要分别在 Linux 和 macOS 中启用用户界面。Travis CI 为 Linux 提供了<code class="fe kf kg kh ki b">xvfb</code>包。对于 macOS，您需要用<code class="fe kf kg kh ki b">homebrew</code>重新安装<code class="fe kf kg kh ki b">xquartz</code>和<code class="fe kf kg kh ki b">tcl-tk</code>。</p><h2 id="a040" class="nm ly iq bd lz ns nt dn md nu nv dp mh lj nw nx mj ln ny nz ml lr oa ob mn oc bi translated">Linux 的用户界面</h2><p id="dde1" class="pw-post-body-paragraph la lb iq lc b ld mr jr lf lg ms ju li lj nf ll lm ln ng lp lq lr nh lt lu lv ij bi translated">要在 Linux 中启用用户界面，请安装<code class="fe kf kg kh ki b">xvfb</code>。</p><pre class="kl km kn ko gt ni ki nj nk aw nl bi"><span id="c1c0" class="nm ly iq ki b gy nn no l np nq">addons:<br/>  apt:<br/>    update: true<br/>    packages:<br/>       -   x11proto-xf86vidmode-dev<br/>       -   xvfb<br/>       -   libxxf86vm-dev</span></pre><p id="a5c1" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">您可以在用户界面中运行所有的 R 脚本，方法是在<code class="fe kf kg kh ki b">R</code>命令前使用<code class="fe kf kg kh ki b">xvfb-run</code>命令。</p><pre class="kl km kn ko gt ni ki nj nk aw nl bi"><span id="7598" class="nm ly iq ki b gy nn no l np nq">script:<br/>      - R CMD build . --compact-vignettes=gs+qpdf<br/>      - xvfb-run R CMD check *tar.gz --as-cran</span></pre><h2 id="e920" class="nm ly iq bd lz ns nt dn md nu nv dp mh lj nw nx mj ln ny nz ml lr oa ob mn oc bi translated">macOS 的用户界面</h2><p id="c96d" class="pw-post-body-paragraph la lb iq lc b ld mr jr lf lg ms ju li lj nf ll lm ln ng lp lq lr nh lt lu lv ij bi translated">对于 macOS 来说，用户界面的安装更加困难。您需要将<code class="fe kf kg kh ki b">xquart</code>和<code class="fe kf kg kh ki b">tcl-tk</code>添加到<code class="fe kf kg kh ki b">xcode7.3</code>中提供的图像中。</p><pre class="kl km kn ko gt ni ki nj nk aw nl bi"><span id="eb92" class="nm ly iq ki b gy nn no l np nq">before_install:<br/>      - brew update<br/>      - brew cask reinstall xquartz<br/>      - brew install tcl-tk --with-tk<br/>      - brew link --overwrite --force tcl-tk; brew unlink tcl-tk</span></pre><p id="2055" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">要使用 xquartz，macOS 下没有<code class="fe kf kg kh ki b">xvfb-run</code>命令。在 github 的一期<a class="ae kj" href="https://github.com/travis-ci/travis-ci/issues/7313" rel="noopener ugc nofollow" target="_blank">中，我发现了一个解决方案，仍然可以让用户界面与<code class="fe kf kg kh ki b">xquartz</code>一起工作。</a></p><pre class="kl km kn ko gt ni ki nj nk aw nl bi"><span id="7e27" class="nm ly iq ki b gy nn no l np nq">before_script:<br/>      - "export DISPLAY=:99.0"<br/>      - if [ "${TRAVIS_OS_NAME}" = "osx" ]; then ( sudo Xvfb :99 -ac -screen 0 1024x768x8; echo ok ) &amp; fi</span></pre><p id="f259" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">在运行 R 会话可以使用的任何 R 脚本之前，创建一个显示。导出<code class="fe kf kg kh ki b">DISPLAY</code>变量很重要。该变量由 tcktk R 包读取。</p><p id="451e" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">在 macOS 中，你不需要修改脚本</p><pre class="kl km kn ko gt ni ki nj nk aw nl bi"><span id="3199" class="nm ly iq ki b gy nn no l np nq">script:<br/>      - R CMD build . --compact-vignettes=gs+qpdf<br/>      - R CMD check *tar.gz --as-cran</span></pre><h2 id="58e2" class="nm ly iq bd lz ns nt dn md nu nv dp mh lj nw nx mj ln ny nz ml lr oa ob mn oc bi translated">插件</h2><p id="23e2" class="pw-post-body-paragraph la lb iq lc b ld mr jr lf lg ms ju li lj nf ll lm ln ng lp lq lr nh lt lu lv ij bi translated">有关用户界面的更多信息，您可以阅读以下两个 github 问题:</p><ul class=""><li id="05b1" class="mp mq iq lc b ld le lg lh lj od ln oe lr of lv mw mx my mz bi translated"><a class="ae kj" href="https://www.google.com/search?q=rselenium+shiny+trvais&amp;rlz=1C1GCEA_enDE800DE801&amp;oq=rselenium+shiny+trvais&amp;aqs=chrome..69i57.2913j0j4&amp;sourceid=chrome&amp;ie=UTF-8" rel="noopener ugc nofollow" target="_blank">带特拉维斯和闪亮的硒元素</a></li><li id="c5da" class="mp mq iq lc b ld na lg nb lj nc ln nd lr ne lv mw mx my mz bi translated"><a class="ae kj" href="https://github.com/ropensci/RSelenium/issues/145" rel="noopener ugc nofollow" target="_blank">酱硒</a></li></ul><h1 id="5da6" class="lx ly iq bd lz ma mb mc md me mf mg mh jw mi jx mj jz mk ka ml kc mm kd mn mo bi translated">代码覆盖率</h1><p id="886c" class="pw-post-body-paragraph la lb iq lc b ld mr jr lf lg ms ju li lj nf ll lm ln ng lp lq lr nh lt lu lv ij bi translated">对于代码覆盖率，我建议使用一个特定版本的构建。我决定用 Linux + r-release 来测试代码覆盖率。首先，我将<em class="lw"> covr </em>包添加到我的构建脚本中:</p><pre class="kl km kn ko gt ni ki nj nk aw nl bi"><span id="25bc" class="nm ly iq ki b gy nn no l np nq">r_github_packages:<br/>  - r-lib/covr</span></pre><p id="7d70" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">其次，我想使用<em class="lw"> covr </em>测试我的包。这可以在 Travis 中使用<code class="fe kf kg kh ki b">after_success</code>步骤完成。为了在这个步骤中使用<em class="lw"> covr </em>，你需要定义你的包 tarball 将如何命名。您可以将这一点直接写入您的脚本。更好的方法是将其写入 you .travis.yml 文件的<code class="fe kf kg kh ki b">env</code>部分。您的 tarball 的名称将始终是<em class="lw">package name+" _ "+package version+" . tar . gz "。在您的描述文件中，您定义了<em class="lw"> PackageName </em>和<em class="lw"> PackageVersion。我使用 CODECOV 来存储我的覆盖测试的结果。</em></em></p><pre class="kl km kn ko gt ni ki nj nk aw nl bi"><span id="ea71" class="nm ly iq ki b gy nn no l np nq">env:<br/>    - PKG_TARBALL=RTest_1.2.3.1000.tar.gz</span><span id="0b74" class="nm ly iq ki b gy nr no l np nq">after_success:<br/>      - tar -C .. -xf $PKG_TARBALL<br/>      - xvfb-run Rscript -e 'covr::codecov(type=c("tests", "vignettes", "examples"))'</span></pre><p id="2e44" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">我在我的包中使用的设置包括了我所有的例子、插图和测试的代码覆盖率。要部署代码覆盖率的结果，您必须定义全局变量<code class="fe kf kg kh ki b">CODECOV_TOKEN</code>。令牌可以在<code class="fe kf kg kh ki b">https://codecov.io/gh/&lt;owner&gt;/&lt;repo&gt;/settings</code>下找到。你可以把它秘密地插入你的崔维斯电脑里。在<code class="fe kf kg kh ki b">https://travis-ci.org/&lt;owner&gt;/&lt;repo&gt;/settings</code>内添加代币。环境变量部分为您秘密存储变量。</p><p id="37bb" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">要使用工作服而不是代码罩，使用<code class="fe kf kg kh ki b">covr::coveralls</code>功能并在您的环境中定义一个<code class="fe kf kg kh ki b">COVERALLS_TOKEN</code>。</p><h1 id="22c9" class="lx ly iq bd lz ma mb mc md me mf mg mh jw mi jx mj jz mk ka ml kc mm kd mn mo bi translated">构建并部署一个 pkgdown 页面到 github 页面</h1><p id="5578" class="pw-post-body-paragraph la lb iq lc b ld mr jr lf lg ms ju li lj nf ll lm ln ng lp lq lr nh lt lu lv ij bi translated">构建一个<em class="lw"> pkgdown </em>页面对于记录您的代码非常有用。在我的 github 存储库中，我还托管了我的包 RTest 的<em class="lw"> pkgdown </em>页面。你可以在这里找到页面:<a class="ae kj" href="https://zappingseb.github.io/RTest/index.html" rel="noopener ugc nofollow" target="_blank">https://zappingseb.github.io/RTest/index.html</a></p><p id="38e1" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">为了允许部署到 github 页面，我在 https://github.com/<owner>/<repo>/设置中激活了这个特性。你必须使用 gh-pages 分公司。如果您没有这样的<a class="ae kj" href="https://help.github.com/articles/creating-and-deleting-branches-within-your-repository/" rel="noopener ugc nofollow" target="_blank">分支，您需要创建它</a>。</repo></owner></p><p id="7b3e" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">在. travis.yml 中，首先安装<em class="lw"> pkgdown。</em></p><pre class="kl km kn ko gt ni ki nj nk aw nl bi"><span id="ca5d" class="nm ly iq ki b gy nn no l np nq">r_github_packages:<br/>  - r-lib/pkgdown</span></pre><p id="3dac" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">你将不得不从你的包 tarball 建立页面。必须定义包 tarball 的名称。请参见章节<a class="ae kj" href="#5da6" rel="noopener ugc nofollow">代码覆盖率</a>了解如何做到这一点。拆开 tarball 的包装后，您应该在<code class="fe kf kg kh ki b">rm -rf &lt;PackageName&gt;.Rcheck</code>之前删除检查包装时留下的任何内容。</p><pre class="kl km kn ko gt ni ki nj nk aw nl bi"><span id="b82b" class="nm ly iq ki b gy nn no l np nq">after_success:<br/>      - tar -C .. -xf $PKG_TARBALL<br/>      - rm -rf RTest.Rcheck<br/>      - Rscript -e 'pkgdown::build_site()'</span></pre><p id="053e" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated"><code class="fe kf kg kh ki b">Rscript</code>将在<code class="fe kf kg kh ki b">docs</code>文件夹中生成网站。该文件夹必须部署在 github 页面上。</p><p id="362b" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">登录 github 后，首先进入<a class="ae kj" href="https://github.com/settings/tokens" rel="noopener ugc nofollow" target="_blank">https://github.com/settings/tokens</a>。在那里，您必须创建一个具有<code class="fe kf kg kh ki b">public_repo</code>或<code class="fe kf kg kh ki b">repo</code>范围的令牌。现在将这个令牌存储在您的 Travis CI 构建中。因此转到<code class="fe kf kg kh ki b">https://travis-ci.org/&lt;owner&gt;/&lt;repo&gt;/settings</code>并将其存储为名为<code class="fe kf kg kh ki b">GITHUB_TOKEN</code>的全局变量。现在，将使用以下脚本在每个成功的构建上部署网站:</p><pre class="kl km kn ko gt ni ki nj nk aw nl bi"><span id="309b" class="nm ly iq ki b gy nn no l np nq">deploy:<br/>  - provider: pages<br/>        skip-cleanup: true<br/>        github-token: $GITHUB_TOKEN<br/>        keep-history: false<br/>        local-dir: docs<br/>        on:<br/>          branch: master</span></pre><p id="3b5a" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">有关部署页面的更多信息，您可以查看第页的<a class="ae kj" href="https://docs.travis-ci.com/user/deployment/pages/" rel="noopener ugc nofollow" target="_blank"> Travis CI 指南。</a></p><h1 id="7ef5" class="lx ly iq bd lz ma mb mc md me mf mg mh jw mi jx mj jz mk ka ml kc mm kd mn mo bi translated">ImageMagick 和 Travis CI</h1><p id="fcdd" class="pw-post-body-paragraph la lb iq lc b ld mr jr lf lg ms ju li lj nf ll lm ln ng lp lq lr nh lt lu lv ij bi translated">在<a class="ae kj" href="https://travis-ci.community/t/error-configuration-failed-for-package-magick/1674" rel="noopener ugc nofollow" target="_blank"> travis-ci 社区</a>中，有一个关于如何在 travis-ci 上安装<code class="fe kf kg kh ki b">magick</code>包的问题。答案很简单。您需要拥有 ImageMagick 的所有系统依赖项。通过以下方式为 Linux 安装这些软件:</p><pre class="kl km kn ko gt ni ki nj nk aw nl bi"><span id="80fc" class="nm ly iq ki b gy nn no l np nq">addons:<br/>   apt:<br/>     update: true<br/>     sources:<br/>       - sourceline: 'ppa:opencpu/imagemagick'<br/>       - sourceline: 'ppa:ubuntugis/ppa'<br/>     packages:<br/>       - libmagick++-dev<br/>       - librsvg2-dev<br/>       - libwebp-dev<br/>       - libpoppler-cpp-dev<br/>       - libtesseract-dev<br/>       - libleptonica-dev<br/>       - tesseract-ocr-eng<br/>       - r-cran-rgdal<br/>       - libfftw3-dev<br/>       - cargo</span></pre><p id="9853" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">这也适用于我的 macOS。</p></div><div class="ab cl og oh hu oi" role="separator"><span class="oj bw bk ok ol om"/><span class="oj bw bk ok ol om"/><span class="oj bw bk ok ol"/></div><div class="ij ik il im in"><p id="48c0" class="pw-post-body-paragraph la lb iq lc b ld le jr lf lg lh ju li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated"><em class="lw">亲爱的读者:写我在持续集成方面的工作总是令人愉快的。感谢你一直读到这篇文章的结尾。如果你喜欢这篇文章，你可以在</em> <a class="ae kj" href="https://medium.com/p/c977015bc6a9" rel="noopener"> <strong class="lc ir"> <em class="lw">中</em> </strong> </a> <em class="lw">或者在</em><a class="ae kj" href="https://github.com/zappingseb/RTest" rel="noopener ugc nofollow" target="_blank"><strong class="lc ir"><em class="lw">github</em></strong></a><em class="lw">上为它鼓掌。如有评论，请在此处</em><strong class="lc ir"><em class="lw"/></strong><em class="lw">或在我的</em><strong class="lc ir"><em class="lw">LinkedIn</em></strong><em class="lw">个人资料</em><a class="ae kj" href="http://linkedin.com/in/zappingseb." rel="noopener ugc nofollow" target="_blank"><em class="lw">http://linkedin.com/in/zappingseb.</em></a>上留言</p><h1 id="b418" class="lx ly iq bd lz ma mb mc md me mf mg mh jw mi jx mj jz mk ka ml kc mm kd mn mo bi translated">进一步阅读</h1><ul class=""><li id="1d71" class="mp mq iq lc b ld mr lg ms lj mt ln mu lr mv lv mw mx my mz bi translated"><a class="ae kj" href="https://docs.travis-ci.com/user/languages/r/" rel="noopener ugc nofollow" target="_blank">在 Travis CI(基础)上构建 R 项目</a></li><li id="9f53" class="mp mq iq lc b ld na lg nb lj nc ln nd lr ne lv mw mx my mz bi translated"><a class="ae kj" href="https://travis-ci.community/c/languages/r" rel="noopener ugc nofollow" target="_blank"> Travis CI 社区为 R </a>(论坛)</li><li id="e69e" class="mp mq iq lc b ld na lg nb lj nc ln nd lr ne lv mw mx my mz bi translated"><a class="ae kj" href="https://github.com/zappingseb/RTest/blob/master/.travis.yml" rel="noopener ugc nofollow" target="_blank"> RTest 包. travis.yml 文件</a></li><li id="6c30" class="mp mq iq lc b ld na lg nb lj nc ln nd lr ne lv mw mx my mz bi translated"><a class="ae kj" rel="noopener" target="_blank" href="/rtest-pretty-testing-of-r-packages-50f50b135650">RTest 包—Travis-CI 的 99%代码覆盖率</a></li></ul></div></div>    
</body>
</html>