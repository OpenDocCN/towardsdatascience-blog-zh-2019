<html>
<head>
<title>How to Detect Mouth Open for Face Login</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何检测人脸登录时的张嘴</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-detect-mouth-open-for-face-login-84ca834dff3b?source=collection_archive---------9-----------------------#2019-10-08">https://towardsdatascience.com/how-to-detect-mouth-open-for-face-login-84ca834dff3b?source=collection_archive---------9-----------------------#2019-10-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="ef14" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你用过银行/支付 app 人脸登录，被要求张嘴、点头或转头吗？这种方法非常流行，特别是在中国，以防止使用静态人脸图像或 3D 打印进行欺骗/黑客攻击。我花了大约两天时间，终于想出了一个非常简单的方法，利用来自<a class="ae ko" href="https://github.com/ageitgey/face_recognition" rel="noopener ugc nofollow" target="_blank">人脸识别</a>项目的特征输出来检测嘴巴张开。</p><p id="7c4b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">下面是将该算法应用于实时网络摄像头视频时的效果。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi kp"><img src="../Images/09a22043e6c3046a4887e78cdb2f14d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1026/1*MmX84lE6y6NxppsCu6tAjg.gif"/></div></figure></div><div class="ab cl kx ky hx kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="im in io ip iq"><h1 id="91f0" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">人脸识别项目</h1><p id="5edd" class="pw-post-body-paragraph jq jr it js b jt mc jv jw jx md jz ka kb me kd ke kf mf kh ki kj mg kl km kn im bi translated"><a class="ae ko" href="https://github.com/ageitgey/face_recognition" rel="noopener ugc nofollow" target="_blank"> face_recognition </a>是一个基于<a class="ae ko" href="https://github.com/davisking/dlib" rel="noopener ugc nofollow" target="_blank"> dlib </a>的非常棒的人脸识别开源项目，正如它自己所描述的:</p><blockquote class="mh mi mj"><p id="a9d8" class="jq jr mk js b jt ju jv jw jx jy jz ka ml kc kd ke mm kg kh ki mn kk kl km kn im bi translated">世界上最简单的用于 Python 和命令行的面部识别 api</p></blockquote><p id="071b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">通过几行 Python 代码，您可以检测到一张脸，识别出是谁，并输出脸部特征，如下巴、眼睛、鼻子和嘴唇。</p><p id="8ed8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">例如，对一张奥巴马图片运行示例<a class="ae ko" href="https://gist.github.com/peterjpxie/2b0befb3b6696cf82fb891b871436380" rel="noopener ugc nofollow" target="_blank">find _ face _ features _ in _ picture . py</a>(只有 40 行代码)，可以得到如下所示的所有面部特征。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/0018100bad2fbab1e0508fb980ce20b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1128/format:webp/1*Mol-Z9WcmWlfxnTvNfGmeA.jpeg"/></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk">Source image</figcaption></figure><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/af300804810b9a67792b84360021f959.png" data-original-src="https://miro.medium.com/v2/resize:fit:1128/format:webp/1*-PDtfiSsBcUqVR_55cwzbQ.png"/></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk">Facial features drawn in the image</figcaption></figure><p id="be90" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您还将在标准输出中获得面部特征细节，包括上唇和下唇。每个特征都是位置点的列表。</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="mt mu l"/></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk">Facial feature outputs</figcaption></figure><h2 id="2216" class="mv lf it bd lg mw mx dn lk my mz dp lo kb na nb ls kf nc nd lw kj ne nf ma ng bi translated">面部识别装置</h2><p id="1d1b" class="pw-post-body-paragraph jq jr it js b jt mc jv jw jx md jz ka kb me kd ke kf mf kh ki kj mg kl km kn im bi translated">你可以按照 github 上的 face_recognition 项目中的<a class="ae ko" href="https://github.com/ageitgey/face_recognition#installation" rel="noopener ugc nofollow" target="_blank">步骤</a>，或者直接下载<a class="ae ko" href="https://medium.com/@ageitgey/try-deep-learning-in-python-now-with-a-fully-pre-configured-vm-1d97d4c3e9b" rel="noopener">预配置的 VM </a>(强烈推荐)。</p></div><div class="ab cl kx ky hx kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="im in io ip iq"><h1 id="1fc0" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">检测嘴张开的算法</h1><p id="d89b" class="pw-post-body-paragraph jq jr it js b jt mc jv jw jx md jz ka kb me kd ke kf mf kh ki kj mg kl km kn im bi translated">face_recognition 提供了用于静态图形分析的 API，但它不会告诉你像张嘴或点头这样的面部动作。然而，我们可以通过特征输出来检测这些运动，即，在这种情况下嘴张开/闭合。</p><p id="d39c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">上唇和下唇特征输出都包含 12 个位置点的列表，但顺序不同。</p><pre class="kq kr ks kt gt nh ni nj nk aw nl bi"><span id="4c78" class="mv lf it ni b gy nm nn l no np">top_lip points: [(181, 359), (192, 339), (211, 332), (225, 336), (243, 333), (271, 342), (291, 364), (282, 363), (242, 346), (225, 347), (211, 345), (188, 358)]<br/>bottom_lip points: [(291, 364), (270, 389), (243, 401), (223, 403), (207, 399), (190, 383), (181, 359), (188, 358), (210, 377), (225, 381), (243, 380), (282, 363)]</span></pre><p id="6197" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用 matplotlib 绘制唇点，可以清楚地看到点的顺序，如下所示。感兴趣的话，点击查看剧情脚本<a class="ae ko" href="https://gist.github.com/peterjpxie/ed43bf4f76cc38349fb06885f74678a6" rel="noopener ugc nofollow" target="_blank">。</a></p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="nr ns di nt bf nu"><div class="gh gi nq"><img src="../Images/7e091cba1b3310ed9bc742f1c2ad3e14.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1CP6ZKkt1yLxBOiqM7lzpQ.png"/></div></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk">Algorithm Illustration</figcaption></figure><p id="0a44" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">我的算法很简单:</strong></p><p id="be9b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果嘴巴张开高度大于嘴唇高度*比率，则嘴巴张开。</p><ul class=""><li id="14df" class="nv nw it js b jt ju jx jy kb nx kf ny kj nz kn oa ob oc od bi translated"><strong class="js iu">比率</strong>:可调，定义开口的大小。你可以简单地把 ratio = 1，也就是说嘴张开的程度大于唇高。</li><li id="af4c" class="nv nw it js b jt oe jx of kb og kf oh kj oi kn oa ob oc od bi translated"><strong class="js iu">唇高</strong>:三对点距离的平均值如下:</li></ul><pre class="kq kr ks kt gt nh ni nj nk aw nl bi"><span id="f759" class="mv lf it ni b gy nm nn l no np">2–10<br/>3–9<br/>4–8</span></pre><p id="612d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这些对对于顶部和底部唇点都是相同的。</p><ul class=""><li id="230a" class="nv nw it js b jt ju jx jy kb nx kf ny kj nz kn oa ob oc od bi translated"><strong class="js iu">口高</strong>:三对点距离的平均值，如下:</li></ul><pre class="kq kr ks kt gt nh ni nj nk aw nl bi"><span id="9a92" class="mv lf it ni b gy nm nn l no np">Top lip 8–10 Bottom lip<br/>Top lip 9–9  Bottom lip<br/>Top lip 10–8 Bottom lip</span></pre><h2 id="a86c" class="mv lf it bd lg mw mx dn lk my mz dp lo kb na nb ls kf nc nd lw kj ne nf ma ng bi translated">算法代码</h2><p id="e8ed" class="pw-post-body-paragraph jq jr it js b jt mc jv jw jx md jz ka kb me kd ke kf mf kh ki kj mg kl km kn im bi translated"><strong class="js iu">唇高功能:</strong></p><p id="acc6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你把每个点对的指数加起来，你会发现总和总是 12。所以如果<em class="mk"> i </em>是一个点，另一个点就是<em class="mk"> 12-i. </em></p><p id="cb83" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">两点(x1，y1)和(x2，y2)的距离定义如下。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/62ed3380adc51d2a4e4c7d1bc4084ffa.png" data-original-src="https://miro.medium.com/v2/resize:fit:762/format:webp/1*0n19gzPuR5KwMw_Ucb7lRg.png"/></div></figure><p id="eb68" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">因此我们得到下面的嘴唇高度函数。</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="d6f6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">口高功能:</strong></p><p id="906d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">将各口穴对的指数相加，总和为 18。</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="mt mu l"/></div></figure><p id="7924" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">检查口开启功能:</strong></p><p id="621c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用唇高和嘴高功能，我们可以定义检查嘴张开功能如下。</p><p id="fed2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我选择上嘴唇高度和下嘴唇高度的最小值作为嘴唇高度。或者可以用平均值。</p><p id="16fd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">而我挑一个比值为 0.5，就不用张大嘴测试了😄。</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="mt mu l"/></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk">mouth_open_algorithm_part3.py</figcaption></figure><p id="69db" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">好了，一切都准备好了。让我们来测试一下。</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="mt mu l"/></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk">mouth_open_algorithm_test.py</figcaption></figure><p id="42be" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">产出:</p><pre class="kq kr ks kt gt nh ni nj nk aw nl bi"><span id="9950" class="mv lf it ni b gy nm nn l no np">top_lip height: 12.35<br/>bottom_lip height: 21.76<br/>mouth height: 33.34<br/>Is mouth open: True</span></pre></div><div class="ab cl kx ky hx kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="im in io ip iq"><h1 id="cd7b" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">真实世界的例子</h1><p id="ffbb" class="pw-post-body-paragraph jq jr it js b jt mc jv jw jx md jz ka kb me kd ke kf mf kh ki kj mg kl km kn im bi translated">结合 face_recognition 和嘴部张开检测算法，我们可以开发一个网络摄像头实时人脸识别应用程序，具有检测嘴部张开/闭合的能力，正如你在本文开头的视频中看到的那样。它只有 80 行代码，你可以从 github <a class="ae ko" href="https://github.com/peterjpxie/detect_mouth_open" rel="noopener ugc nofollow" target="_blank">这里</a>克隆。注意，你需要先安装<a class="ae ko" href="https://github.com/ageitgey/face_recognition.git" rel="noopener ugc nofollow" target="_blank"> face_recognition </a>包。</p><pre class="kq kr ks kt gt nh ni nj nk aw nl bi"><span id="f387" class="mv lf it ni b gy nm nn l no np">git clone <a class="ae ko" href="https://github.com/peterjpxie/detect_mouth_open.git" rel="noopener ugc nofollow" target="_blank">https://github.com/peterjpxie/detect_mouth_open.git</a></span><span id="3b38" class="mv lf it ni b gy ok nn l no np">cd detect_mouth_open</span><span id="6e0d" class="mv lf it ni b gy ok nn l no np">python facerec_from_webcam_mouth_open.py</span></pre><h1 id="a90a" class="le lf it bd lg lh ol lj lk ll om ln lo lp on lr ls lt oo lv lw lx op lz ma mb bi translated">笔记</h1><p id="9df0" class="pw-post-body-paragraph jq jr it js b jt mc jv jw jx md jz ka kb me kd ke kf mf kh ki kj mg kl km kn im bi translated">这只是检测嘴巴张开的一种方式。你肯定会从其他来源找到其他类似或不类似的方法，或者你可以找到自己的方法。在寻找答案之前，自己想出一个方法是有趣和令人兴奋的。</p><p id="7ea1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">感谢阅读。</p></div></div>    
</body>
</html>