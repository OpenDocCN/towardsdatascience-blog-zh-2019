<html>
<head>
<title>Clean Up Your R Code! A Secret to Better Feature Engineering</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">清理你的 R 代码！更好的特征工程的秘密</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/tired-of-nested-ifelse-in-dplyr-look-no-further-ebf7166b5289?source=collection_archive---------25-----------------------#2019-11-22">https://towardsdatascience.com/tired-of-nested-ifelse-in-dplyr-look-no-further-ebf7166b5289?source=collection_archive---------25-----------------------#2019-11-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/5e949b5af2f8b27efd6b4e7198e6ffe5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OloZSTvTetsJDO0fC6CSyQ.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">by jarmoluk at pixabay.com</figcaption></figure><h1 id="749d" class="kf kg it bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">使用变异特征设计新的分类</h1><p id="f4bd" class="pw-post-body-paragraph ld le it lf b lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma im bi translated"><code class="fe mb mc md me b">dplyr</code>中最有用的函数是<code class="fe mb mc md me b">mutate</code>；它允许您创建新的变量——通常是通过在数据集中的其他变量之上分层放置一些逻辑。</p><h1 id="12c6" class="kf kg it bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">快速示例</h1><p id="2aa4" class="pw-post-body-paragraph ld le it lf b lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma im bi translated">假设您正在分析用户数据，并希望根据使用量对用户进行分类。</p><p id="fd04" class="pw-post-body-paragraph ld le it lf b lg mf li lj lk mg lm ln lo mh lq lr ls mi lu lv lw mj ly lz ma im bi translated">您决定需要四个等级——非活动用户、受限用户、健康用户和高级用户。</p><p id="38a7" class="pw-post-body-paragraph ld le it lf b lg mf li lj lk mg lm ln lo mh lq lr ls mi lu lv lw mj ly lz ma im bi translated">您的代码可能如下所示。您将在这里看到的是，为了创建新的<code class="fe mb mc md me b">user_type</code>变量，我们使用<code class="fe mb mc md me b">mutate</code>函数，声明新的变量名，然后利用<code class="fe mb mc md me b">ifelse</code>来确定在什么波段下应用不同的值。正如你在下面看到的，如果应用程序中的动作少于 5，这是最低的阈值，那么我们称之为非活动...如果该标准不为真，那么我们将进入下一个<code class="fe mb mc md me b">ifelse</code>语句来建立下一组标准。</p><pre class="mk ml mm mn gt mo me mp mq aw mr bi"><span id="4af7" class="ms kg it me b gy mt mu l mv mw">df %&gt;% <br/>    mutate(user_type = ifelse(<br/>                app_actions &lt;= 5, 'inactive user', ifelse(     <br/>                    app_actions &lt;= 10, 'limited user', ifelse(<br/>                        app_actions &lt;= 15, 'healthy user', 'active user' ) ) ) )</span></pre><p id="037a" class="pw-post-body-paragraph ld le it lf b lg mf li lj lk mg lm ln lo mh lq lr ls mi lu lv lw mj ly lz ma im bi translated">虽然<code class="fe mb mc md me b">ifelse</code>是一个主要工具并且非常有用，但是当你开始嵌套太多<code class="fe mb mc md me b">ifelse</code>时，就会出现一些问题。</p><ol class=""><li id="4208" class="mx my it lf b lg mf lk mg lo mz ls na lw nb ma nc nd ne nf bi translated">难以解释和编辑的混乱代码</li><li id="5941" class="mx my it lf b lg ng lk nh lo ni ls nj lw nk ma nc nd ne nf bi translated">你写了很多多余的代码</li></ol><p id="3bc9" class="pw-post-body-paragraph ld le it lf b lg mf li lj lk mg lm ln lo mh lq lr ls mi lu lv lw mj ly lz ma im bi translated">我应该补充一下，我上面写的并不太疯狂，但是你可能很快就需要两位数的<code class="fe mb mc md me b">ifelse</code>语句，这就产生了我们正在讨论的问题。</p><h1 id="fe0c" class="kf kg it bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated"><code class="fe mb mc md me b">case_when</code>化险为夷</h1><p id="a13d" class="pw-post-body-paragraph ld le it lf b lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma im bi translated">在许多方面，R 比 sql 提供了更多的灵活性，但是也就是说，许多人不必要错过的一个 SQL 命令是<code class="fe mb mc md me b">case_when</code>。幸运的是，<code class="fe mb mc md me b">case_when</code>实际上是 r 中的一个东西。</p><p id="397e" class="pw-post-body-paragraph ld le it lf b lg mf li lj lk mg lm ln lo mh lq lr ls mi lu lv lw mj ly lz ma im bi translated">查看用<code class="fe mb mc md me b">case_when</code>呈现的完全相同的代码片段。</p><pre class="mk ml mm mn gt mo me mp mq aw mr bi"><span id="c028" class="ms kg it me b gy mt mu l mv mw">df %&gt;% <br/>    mutate(user_type = case_when(<br/>                           app_actions &lt;= 5 ~ 'inactive user',<br/>                           app_actions &lt;= 10 ~ 'limited user',<br/>                           app_actions &lt;= 15 ~ 'healthy user', <br/>                           TRUE ~ 'active user' ) )</span></pre><p id="5f35" class="pw-post-body-paragraph ld le it lf b lg mf li lj lk mg lm ln lo mh lq lr ls mi lu lv lw mj ly lz ma im bi translated">同样，这是一个非常简单的示例，但是当您必须进行二十种条件/值组合时，这可以节省大量时间，并且清晰易读。这里的主要区别在于，左侧实际上是为条件保留的，<code class="fe mb mc md me b">~</code>符号用作比较值&amp;之间的分隔符，显然右侧是要给出匹配标准的值。最后一点，<code class="fe mb mc md me b">TRUE</code>作为最终的总括，类似于<code class="fe mb mc md me b">else</code>语句。</p><h1 id="2b50" class="kf kg it bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">结论</h1><p id="a734" class="pw-post-body-paragraph ld le it lf b lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma im bi translated">简而言之，虽然<code class="fe mb mc md me b">ifelse</code>有它们的位置并且非常有用，但是当你面对无数的<code class="fe mb mc md me b">ifelse</code>陈述时，<code class="fe mb mc md me b">case_when</code>让一个简单的&amp;变得容易解释。</p><p id="c250" class="pw-post-body-paragraph ld le it lf b lg mf li lj lk mg lm ln lo mh lq lr ls mi lu lv lw mj ly lz ma im bi translated">我希望这在你所有的特性工程工作中对你有用！如果你觉得这有用而且有趣，来看看我们在 datasciencelessons.com 的其他数据科学帖子吧！祝数据科学快乐！</p></div><div class="ab cl nl nm hx nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="im in io ip iq"><p id="d45d" class="pw-post-body-paragraph ld le it lf b lg mf li lj lk mg lm ln lo mh lq lr ls mi lu lv lw mj ly lz ma im bi translated"><em class="ns">原载于 2019 年 11 月 22 日【http://datasciencelessons.com】<a class="ae nt" href="https://datasciencelessons.com/2019/11/22/tired-of-nested-ifelse-in-dplyr/" rel="noopener ugc nofollow" target="_blank"><em class="ns"/></a><em class="ns">。</em></em></p></div></div>    
</body>
</html>