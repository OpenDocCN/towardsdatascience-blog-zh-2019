<html>
<head>
<title>Analyse Kafka messages with SQL queries using Apache Drill</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Apache Drill 通过 SQL 查询分析 Kafka 消息</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/analyse-kafka-messages-with-sql-queries-using-apache-drill-cc26420bb7c3?source=collection_archive---------20-----------------------#2019-09-23">https://towardsdatascience.com/analyse-kafka-messages-with-sql-queries-using-apache-drill-cc26420bb7c3?source=collection_archive---------20-----------------------#2019-09-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><blockquote class="jn jo jp"><p id="a4e4" class="jq jr js jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ij bi translated">原文发布于此:<a class="ae kp" href="https://blog.contactsunny.com/tech/analyse-kafka-messages-with-sql-queries-using-apache-drill" rel="noopener ugc nofollow" target="_blank">https://blog . contact sunny . com/tech/analyse-Kafka-messages-with-SQL-queries-using-Apache-drill</a></p></blockquote><p id="a141" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">在上一篇文章中，我们弄清楚了如何<a class="ae kp" href="https://blog.contactsunny.com/tech/getting-started-with-apache-drill-and-mongodb" rel="noopener ugc nofollow" target="_blank">将 MongoDB 与 Apache Drill </a>连接起来，并使用 SQL 查询来查询数据。在这篇文章中，让我们扩展这方面的知识，看看如何使用类似的 SQL 查询来分析我们的 Kafka 消息。</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div class="gh gi kt"><img src="../Images/8d8eb4e1cd3c70511716e16dd6500c32.png" data-original-src="https://miro.medium.com/v2/resize:fit:512/format:webp/1*Kjf7O30nvOCFU7YoXy9FrQ.png"/></div></figure><p id="68ac" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">在 Apache Drill 中配置 Kafka 存储插件非常简单，与我们配置 MongoDB 存储插件的方式非常相似。首先，我们运行 Apache Drill、Apache Zookeeper 和 Apache Kafka 的本地实例。在这之后，前往<a class="ae kp" href="http://localhost:8047/storage" rel="noopener ugc nofollow" target="_blank">http://localhost:8047/storage</a>，在那里我们可以启用 Kafka 插件。您应该在页面右侧的列表中看到它。单击启用按钮。存储插件将被启用。在这之后，我们需要添加一些配置参数来开始从 Kafka 查询数据。单击 Kafka 旁边的 Update 按钮，这将打开一个带有 JSON 配置的新页面。用以下内容替换 JSON:</p><pre class="ku kv kw kx gt lb lc ld le aw lf bi"><span id="772f" class="lg lh iq lc b gy li lj l lk ll">{<br/>   "type": "kafka",<br/>   "kafkaConsumerProps": {<br/>     "key.deserializer": "org.apache.kafka.common.serialization.ByteArrayDeserializer",<br/>     "auto.offset.reset": "earliest",<br/>     "bootstrap.servers": "localhost:9092",<br/>     "group.id": "drill-query-consumer-1",<br/>     "enable.auto.commit": "true",<br/>     "value.deserializer": "org.apache.kafka.common.serialization.ByteArrayDeserializer",<br/>     "session.timeout.ms": "30000"<br/>   },<br/>   "enabled": true<br/> }</span></pre><p id="2cb3" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">如果需要，您可以更改此配置。如果您要连接到远程引导服务器，请更改引导服务器地址。一旦完成这些，我们就可以开始从 Kafka 主题中查询数据了。因此，让我们切换到终端，看看一些查询。</p><h1 id="4dfe" class="lm lh iq bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">使用 Drill SQL 查询查询 Apache Kafka 消息</h1><p id="69bf" class="pw-post-body-paragraph jq jr iq jt b ju mj jw jx jy mk ka kb kq ml ke kf kr mm ki kj ks mn km kn ko ij bi translated">首先，我们来看看 Kafka 存储插件是否确实启用了。为此，我们只需运行<em class="js"> show 数据库；</em>查询。这将列出我们已启用的所有存储插件，以及这些服务中的数据库(如果适用)。如果您运行此查询，您的输出应该类似于:</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/407574f34a9a0ed08406b9b58c264a77.png" data-original-src="https://miro.medium.com/v2/resize:fit:572/format:webp/1*AmAKrgn9wJ4JDTsWoqAtJA.png"/></div></figure><p id="f650" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">可以看到，<em class="js">卡夫卡</em>被列为数据库。让我们使用下面的命令切换到这个模式:</p><pre class="ku kv kw kx gt lb lc ld le aw lf bi"><span id="d4c6" class="lg lh iq lc b gy li lj l lk ll">use kafka;</span></pre><p id="38a6" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">要开始从 Kafka 主题中读取数据，我们需要首先查看该主题是否被 Drill 识别。Kafka 中的每个主题都会在 Drill 中以表格的形式出现在 kafka 数据库中。所以我们只需要列出这个数据库中的所有表。出于测试目的，您可以创建一个新主题。我创建了主题“drill ”,用于使用 Drill 进行测试。让我们看看它是否在这个数据库中显示为一个表。</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/e3e33fd4db2e2ba3a916bb5d2d446643.png" data-original-src="https://miro.medium.com/v2/resize:fit:684/format:webp/1*1-W1-mOv5zfsRqUthf6UIA.png"/></div></figure><p id="a030" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">这就是了。我们将在这个表上运行我们的查询。</p><blockquote class="jn jo jp"><p id="c190" class="jq jr js jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ij bi translated"><em class="iq">这里你需要注意的一件事是，现在，对于最新版本的 Apache Drill 和 Kafka 存储插件，只有 JSON 消息可以工作。如果你发送的不是 JSON，Drill 会抛出一个异常，并且不能工作。所以让我们来解决这个问题。</em></p></blockquote><p id="eaba" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">让我们使用 Kafka 控制台生成器发送一些随机的 JSON 消息，看看 Drill 是否能够查询这些消息。</p><p id="72cd" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">我将从一个控制台生成器向“drill”主题发送以下 JSON 消息(总共四条)。这是我在简单的谷歌搜索后在网上得到的一些样本数据。</p><pre class="ku kv kw kx gt lb lc ld le aw lf bi"><span id="43ad" class="lg lh iq lc b gy li lj l lk ll">{<br/>  "id": 1,<br/>  "first_name": "Jeanette",<br/>  "last_name": "Penddreth",<br/>  "email": "jpenddreth0@census.gov",<br/>  "gender": "Female",<br/>  "ip_address": "26.58.193.2"<br/>}<br/>{<br/>  "id": 2,<br/>  "first_name": "Giavani",<br/>  "last_name": "Frediani",<br/>  "email": "gfrediani1@senate.gov",<br/>  "gender": "Male",<br/>  "ip_address": "229.179.4.212"<br/>}<br/>{<br/>  "id": 3,<br/>  "first_name": "Noell",<br/>  "last_name": "Bea",<br/>  "email": "nbea2@imageshack.us",<br/>  "gender": "Female",<br/>  "ip_address": "180.66.162.255"<br/>}<br/>{<br/>  "id": 4,<br/>  "first_name": "Willard",<br/>  "last_name": "Valek",<br/>  "email": "wvalek3@vk.com",<br/>  "gender": "Male",<br/>  "ip_address": "67.76.188.26"<br/>}</span></pre><p id="688c" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">现在，让我们对 Drill 中的表运行以下简单的 SQL 命令，看看会得到什么输出:</p><pre class="ku kv kw kx gt lb lc ld le aw lf bi"><span id="dde2" class="lg lh iq lc b gy li lj l lk ll">select * from drill;</span></pre><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="mr ms di mt bf mu"><div class="gh gi mq"><img src="../Images/eabe0c14fe8c84639e32db00b3f4d131.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iHXuZ4iASeMZmfLfEhNk4g.png"/></div></div></figure><p id="c3ea" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">这就是我们想要的结果。从 Drill 查询阿帕奇卡夫卡就是这么简单。我不知道为什么我没有早点遇到这个工具。</p></div></div>    
</body>
</html>