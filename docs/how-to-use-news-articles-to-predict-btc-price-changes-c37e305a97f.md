# 如何利用新闻文章预测 BTC 价格变化

> 原文：<https://towardsdatascience.com/how-to-use-news-articles-to-predict-btc-price-changes-c37e305a97f?source=collection_archive---------9----------------------->

itcoin (BTC)的价格变化是不稳定的，原因有很多，例如公众对其特别不同的感知价值和高知名度的损失。在本文中，我们关注的是其中的一个主要因素，BTC 新闻文章的影响。由于 BTC 过去的势头和加密货币市场中 BTC 市场的巨大份额，已经存在一个庞大的 BTC 玩家群体。然而，在这个市场中仍然缺乏一种定量分析的方法来做决定，所以我们在这里努力基于机器学习算法来帮助解决这种情况。

利用各种普通的监督机器学习算法并探索半监督算法，我们建立了一个模型来预测某篇新闻文章是否会导致 BTC 价格的明显上涨或下跌，以帮助 BTC 玩家做出更合理的卖出或买入 BTC 的决定。

我们的项目大致分为三个主要部分，金融数据处理、新闻文章处理和最终预测模型。迫不及待地想现在就走完整个流程！

# **财务数据处理**

我们在 Kaggle 上收集了 BTC 从 2018 年 1 月 1 日到 2018 年 1 月 4 日的逐秒数据集，这些数据集在转换为基于天的数据集后由以下信息组成。

![](img/30787d8c11f5438ec954c2bd56fe29de.png)

根据股票市场的经验法则，股票价格的明显变化被定义为价格波动超过过去 30 天滚动平均价格的 2 个标准差，但没有公认的明显 BTC 价格变化的定义。由于 BTC 价格的剧烈和不断变化，很难测试哪个数量的标准差是最明显的。因此，我们使用与 BTC 股票市场相同的 2 个标准差。代码如下所示，

Basic math equation of calculating 2 standard deviations

根据指标，我们得到并标记了在我们选定的时期内 BTC 价格发生明显变化的日期。然后，我们将日期分为三组，第一组具有明显的价格上涨，即正标记(日期:2018 年 3 月 19 日)，第二组具有明显的价格下跌和正标记(日期:2019 年 2 月 5 日、2019 年 3 月 15 日、2019 年 3 月 17 日、2019 年 3 月 18 日)，另一组价格变化在 2 个标准偏差内。

现在我们进入第二部分，新闻文章的数据处理。这两部分的逻辑联系将在第三部分阐述。

# **新闻文章**

我们使用 news API(可以使用下面的键)来提取与第一部分相同的指定日期范围内的新闻文章。

Available News API keys

从新闻文章中摘录的内容如下表所示:

![](img/116ab19dd48681e21070d2964e1ba74f.png)

News articles’ extracted contents

由于新闻文章的导语总是包含着最重要的信息，而且有很多读者只是略读导语段落，所以对于 ***内容*** 栏目，我们只提取了新闻文章的导语。

我们将所有提取的文章的引言段落中出现频率最高的前 100 个词(首先完成了词干化和词干化，并删除了停用词)作为我们的语料库，我们认为它们与 BTC 交易和价格最相关，因此如果一篇新闻文章在前 300 个词中没有提到这些关键词中的任何一个，我们就认为这篇文章与 BTC 无关，然后将其从我们待探究的文章中排除。(前 300 个单词是通过实证分析得出的新闻文章的主要思想，我们不选择介绍性段落是因为有时导语少于 300 个单词，我们希望涵盖更多的文章)，

以下是 100 字的部分内容。

![](img/ae1f4d73e0bf5d21f6373989cf9e3112.png)

Words of top occurrences in news articles

与上述三个日期组相匹配，新闻文章也被分成三组。三者中，价格变化明显的两个群体是我们关注的重点。

然后我们处理我们的功能，直到现在，我们已经得到了每篇文章的作者和出版商。为了将文本数据转换为数字数据，首先，我们根据作者和出版商在我们选择的文章中发布的文章数量对他们进行排名，然后通过查看文章数量的分布，我们将作者和出版商分成编号为 1 到 5 的五组，以使每组的人口大致相同。

我们没有简单地对作者和出版商进行分类的原因是，只有基于树的算法(如随机森林)才能识别类别号，而非基于树的算法(如 SVM)会将类别号视为一些有意义的数字，这将极大地影响模型的准确性。

**情感分析**

新闻文章有一个非常重要的特性，即其中所表达的主流情绪。许多组织已经开始对新闻文章进行情感分析，比如微软的 Azure、谷歌的云自然语言 API 以及 python 的 NLTK 包。

我们研究了谷歌的 API 和 Azure，在将两者与我们自己对文章中情感的判断进行比较后，结果表明谷歌在我们的模型中表现得更好。在许多研究中，谷歌的 API 也是所有工具中准确率最高的。

要使用 Google API 或 Azure，你必须获得认证，用 Python 进行情感分析的详细设置过程可以参考[https://www . ka ggle . com/c/new-York-city-taxi-fare-prediction/data](https://www.kaggle.com/c/new-york-city-taxi-fare-prediction/data)

Google API 给出的结果有 4 列，我们只使用其中的两列，一列是*分数*，另一列是*震级*。分数对应于总体的消极、中性或积极情绪，范围从 *-1* 到 *1* 。 *-1* 表示完全消极的情绪，1 表示积极的极端，0 表示中性情绪。总体情绪的其他程度在 *-1* 和 *1* 之间变化。*评分*已经归一化，也就是说新闻文章的字数不会影响这个数字。*量级*衡量积极和消极情绪的整体强度。与 s *核心*不同，*幅度*没有归一化，所以它与文章长度成比例，范围从 0 到 *+inf* 。例如，如果一个作者在一篇文章中表达了强烈的积极和消极情绪，抵消了积极情绪，那么这篇文章中传达的整体情绪将是中性的。然而，*量级*统计了所有的累积情绪，所以最终的分数可能是 *0* ，但是*量级*大于 *3* 或者其他什么大的数字。

以下是谷歌给出的一些例子，

![](img/76cea70503b9e581866f507ad39fdae1.png)

Examples of sentiment judgment

(详细的文档可以在

[https://cloud . Google . com/natural-language/docs/basics # interpreting _ 情操 _ 分析 _ 价值观](https://cloud.google.com/natural-language/docs/basics#interpreting_sentiment_analysis_values)

为了避免新闻文章字数会影响*量级*数量的问题，我们也对其进行了归一化处理。

**TF-IDF 探索**

在一组新闻文章中，一些重要的词可能在某篇新闻文章中多次出现，而在其他新闻文章中很少出现。当读者阅读一篇文章时，重复出现会加强视觉效果，因此读者更有可能对这些文章做出反应。TF-IDF 分数正好帮助我们很好地衡量影响。TF-IDF 代表术语频率-逆数据频率，是两部分的乘积。

第一部分是词频，它用一个等式计算文档(在我们的研究中是新闻文章)中每个词在语料库中的出现频率，

![](img/1ed42d58dc4aa398e397b483cb7092d5.png)

*n_i，j* 表示一个单词 *i* 在一个文档 *j* 中出现的次数，分母为文档 *j* 中的总字数。

第二部分是逆数据频率，其用途是计算我们所有文档(所有新闻文章)中的稀有词的权重，如下所示:

![](img/a6e804bf4a4725a50fce6703c6aadf10.png)

*N* 是文档总数， *df_t* 是包含单词 *t* 的文档数。因此，很少出现在所有文档中但只出现在少数文档中的单词将由于低的 *df_t* 值而具有高的 IDF 分数。

最后将以上两部分相乘得到 TF-IDF 得分。

![](img/a888f293e7c54e2dc9daf1eaa484c11a.png)

因此，如果单词 *i* 在一篇新闻文章中出现多次，但在其他新闻文章中很少出现，从而导致 TF-IDF 得分较高，我们可以得出结论，该单词在这篇文章中很重要。在删除停用词后，我们将 TF-IDF 得分高的词视为新闻中的重要词，因此我们对最高的 5 个 IF-IDF 得分进行平均，以衡量视觉效果。计算结果基本上如下所示:

![](img/e8034b9a981e4861a7f9ad98479f8f5d.png)

TF-IDF calculation result

干杯！所有的食物洗好了，调料拌好了，剩下的唯一任务就是倒入锅里煮。现在让我们来看看预测模型吧！

# **预测**

**监督算法**

在我们的模型中，我们总共有 5 个特征，即出版商、作者、情感得分、情感幅度得分和 TD-IDF 得分，数据如下

![](img/1c725963d56b12e1b58f327bcfdc4fa1.png)

Prediction model’s five features

预测的数据是二进制数。如果预测值为 0，则认为新闻文章对 BTC 市场没有影响，不会引起明显的价格变化。否则，这篇新闻文章将引起明显的价格变化。我们的 BTC 应用程序即时发布的结果可以供 BTC 投资者参考，以决定是否购买或出售，投资者的即时反应可以帮助他们节省或赚取合理的金额。

预测的精确程度由两个指标来检验。首先，我们使用传统的度量标准“准确性”来测试它。此外，我们还绘制了内置概率计算功能的算法的 ROC 曲线，并显示了每条 ROC 曲线的 AUC 值。我们还探索 ROC-AUC 度量的原因是我们希望更多地关注阳性结果 1。如果 BTC 玩家在当天的大部分新闻中看到 1，他们将获得 BTC 价格极有可能上涨的信息，从而购买更多的 BTC 来投机。然而，如果价格实际上是下降而不是上升，买家将需要相当大的成本来弥补损失。相反，如果预测价格会下降，但实际上是上升的，与买方的反应相比，卖方的损失相对较小。总之，积极的是更有价值的，因为它的高成本的属性。从准确性和 ROC-AUC 度量，我们可以找到性能最好的算法。

我们使用逻辑回归、随机森林、SVM、KNN、感知器和 XGBoost 进行预测。准确度结果如下所列，

![](img/b2f8f144627b4a8115dbdda1acd89063.png)

Comparison of tranning and test accuracy

可以看出，随机森林算法是 6 种算法中训练和测试精度最高的算法。

并且 ROC-AUC 产生了相同的结论，在所有其他算法中具有最大的 AUC 分数，

![](img/58f7f90f686eee9c12d4d1914dcbd9a1.png)

ROC-AUC of Random Forest

**半监督算法**

在现实情况下，很难像预期的那样收集大量数据，因此我们提出了探索半监督算法的想法，以仅利用部分可接近的数据来生成更多的自我标记数据，然后进行预测。

目前的半监督学习领域已经发展成为一个完善的知识体系，所以我不打算在这里讲述它的细节。基本上，有三种半监督学习，主动学习，纯直推式学习和模型丰富的直推式学习。具有不同数据集特征和最终目标的项目应该匹配合适的半监督模型。因为我们的模型的目标函数不是凸的，我们选择使用直推式支持向量机(TSVM)。

我们利用 100 个标记样本和 1014 个未标记样本来预测 478 个未标记测试样本。最后，TSVM 得到了 67%的准确率。与使用监督算法 SVM 的 60%相比，TSVM 显示出改进，这基本上是半监督学习的主要使用，同时受到有限数据集的约束。

![](img/7ecd34145ab5401407c20b2717248099.png)

Comparison of SVM and TSVM

我们还努力检查了基于图的模型，标签传播。它的方法论可以简化为下图，

![](img/a027589350f61580b3fbfbab3c494019.png)

Graph-based semi-supervised model

然而，其中一个关键的输入数据集是由专家给出的标记数据，旨在不断改进标签，但我们缺乏，所以在未来，我们将更深入地挖掘这种方法，并试图从中寻找一些有用的输出。

# **未来的探索与思考**

尽管我们的模型取得了令人满意的结果，但仍有一些潜在的问题需要考虑。已经出现的一个与神经网络有关，这是我们将来要探索的。

> 在范式 NLP 公式的约束下，神经网络(NN)可以提取当前文章中包含的信息，但是它们不能提取与未来事件相关的信息。也就是说，作为一个例子，如果我是以色列公民，我读到某个重要人物被暗杀，那么作为一个不仅了解历史而且了解报复能力的知情读者，我可以推断这种行为的后果——比如经济和/或军事报复。另一方面，一个完全的局外人会阅读同一篇文章，只知道有人被暗杀了，而且这个人很重要，值得写出来。NN 的就像后者。

所以我们必须弄清楚是否有办法绕过老练的读者和天真的读者之间的鸿沟——但是基于 ML 公式/方法。

对于未来的应用，我们计划开发一个聊天机器人来自动化我们的预测显示。原型接口是

![](img/2b1fe5a853ab72cad584a39e721f6702.png)

Prototype interface of Chatbot

它一般有三个部分，一个用于提问的聊天窗口，可供参考的实时 BTC 价格图表和带有作者和出版商标签的新闻文章，以及情感评分、幅度和 TF-IDF 评分。

我们对任何问题都持开放态度，我们非常欢迎您提出建议。如果你对这个项目有热情，请随时与我在 chelsea.yangmi@gmail.com 联系！