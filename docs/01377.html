<html>
<head>
<title>Reduce Your Data’s Memory and Your Life is Better</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">减少数据的内存，生活会更美好</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/reduce-your-datas-memory-and-your-life-is-better-319bdc1e8c98?source=collection_archive---------35-----------------------#2019-03-04">https://towardsdatascience.com/reduce-your-datas-memory-and-your-life-is-better-319bdc1e8c98?source=collection_archive---------35-----------------------#2019-03-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div class="gh gi jq"><img src="../Images/15605ff62643e0d1cd71b1d9a24e70bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:412/format:webp/1*kZGgF6-I9cXN6oRU5Lg93w.jpeg"/></div><figcaption class="jx jy gj gh gi jz ka bd b be z dk">Wing Tsun Practitioners Silhouette</figcaption></figure><p id="2014" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">上面的剪影是两个咏春练习者在做技术练习。请注意它们是如何相互靠近的。咏春是一种武术风格，从最小的动作中获得相同的冲击力。这种风格真正体现了“少即是多”的说法。</p><h1 id="fe31" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">酷，但这和数据有什么关系？</h1><p id="108f" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">它与数据的内存使用情况有关。在小数据集，这可能不是一个问题。但是如果你的数据集在内存中太大，你的计算机的性能将会降低。这意味着您的可视化将需要更长的时间来加载，特征工程需要更长的时间来生成，您的机器学习应用程序将需要更长的时间来处理。</p><p id="2c81" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">减少你数据的内存，你所有有数据的应用都会更流畅。</p><figure class="md me mf mg gt ju gh gi paragraph-image"><div class="gh gi mc"><img src="../Images/b5d3b18e2825493aab2ea50b14c6b5ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:998/format:webp/1*ppyQI0qeweBt3PdYJsZNew.jpeg"/></div><figcaption class="jx jy gj gh gi jz ka bd b be z dk">You don’t want to drag your data around. <a class="ae mh" href="https://www.flickr.com/photos/lloydm/216187948" rel="noopener ugc nofollow" target="_blank"><em class="mi">Image by Lloyd Morgan on Flickr</em></a></figcaption></figure><h1 id="a02e" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">那么，我们如何减少数据的内存使用呢？</h1><p id="7231" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">有两种方法可以让你在熊猫身上做到这一点:</p><p id="1539" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">1.删除任何不相关的列。</p><p id="10df" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">2.更改列的数据类型。</p><p id="716d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我会用我收集的纽约州几何试题的数据给你看一个例子。</p><p id="6578" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">对于那些感兴趣的人来说，这些数据是从公开提供的 pdf 中收集的。数据然后被转移到 Excel，然后转移到 Postgresql。在那里，我使用 Python 的<a class="ae mh" href="https://www.sqlalchemy.org/" rel="noopener ugc nofollow" target="_blank"> Sqlalchemy </a>库从 Postgresql 中提取数据，并将其放入数据框中。</p><p id="6ac7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我假设你熟悉熊猫的<a class="ae mh" href="https://pandas.pydata.org/pandas-docs/version/0.23/generated/pandas.DataFrame.info.html" rel="noopener ugc nofollow" target="_blank">信息</a>方法。应用这个，我们得到以下结果:</p><pre class="md me mf mg gt mj mk ml mm aw mn bi"><span id="52a8" class="mo la it mk b gy mp mq l mr ms">df.info()<br/><br/><br/>RangeIndex: 358 entries, 0 to 357<br/>Data columns (total 7 columns):<br/>id              358 non-null int64<br/>ClusterTitle    358 non-null object<br/>Cluster         358 non-null object<br/>Regents Date    358 non-null object<br/>Type            358 non-null object<br/>DateFixed       358 non-null object<br/>Qnumber         358 non-null object<br/>dtypes: int64(1), object(6)<br/>memory usage: 19.7+ KB</span></pre><p id="a8de" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">比这更准确。如果您应用参数<code class="fe mt mu mv mk b">memory_usage='deep'</code>，Pandas 将告诉您数据帧使用了多少内存。毕竟，当我们能得到精确的值时，它们比估计值要好。这样做显示了相同的信息，但是内存使用行是不同的。</p><pre class="md me mf mg gt mj mk ml mm aw mn bi"><span id="5eb1" class="mo la it mk b gy mp mq l mr ms">df.info(memory_usage='deep')<br/></span><span id="5135" class="mo la it mk b gy mw mq l mr ms">RangeIndex: 358 entries, 0 to 357<br/>Data columns (total 7 columns):<br/>id              358 non-null int64<br/>ClusterTitle    358 non-null object<br/>Cluster         358 non-null object<br/>Regents Date    358 non-null object<br/>Type            358 non-null object<br/>DateFixed       358 non-null object<br/>Qnumber         358 non-null object<br/>dtypes: int64(1), object(6)<br/>memory usage: 139.9 KB</span></pre><p id="0649" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">所以我们的数据帧专门用了 139.9 KB 的内存。<br/>我们需要的另一个方法是带有参数<code class="fe mt mu mv mk b">deep=True</code>的<code class="fe mt mu mv mk b">memory_usage</code>方法，以查看每一列使用了多少字节的内存。让我们将它应用到我们的数据集，看看使用了多少内存。</p><pre class="md me mf mg gt mj mk ml mm aw mn bi"><span id="d584" class="mo la it mk b gy mp mq l mr ms">df.memory_usage(deep=True)</span><span id="cb2f" class="mo la it mk b gy mw mq l mr ms">Index              80<br/>id               2864<br/>ClusterTitle    38222<br/>Cluster         22713<br/>Regents Date    14320<br/>Type            21122<br/>DateFixed       22554<br/>Qnumber         21392<br/>dtype: int64</span></pre><h1 id="c947" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">删除列</h1><p id="2ce1" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">我们将删除 id 列，因为它是 Postgresql 表使用的列。您不需要它来进行分析。为此，我们将使用来自熊猫的<code class="fe mt mu mv mk b">drop</code>方法，使用<code class="fe mt mu mv mk b">axis='columns'</code>和<code class="fe mt mu mv mk b">inplace=True</code>。我们的<code class="fe mt mu mv mk b">axis</code>参数确保只删除该列。<code class="fe mt mu mv mk b">inplace</code>参数保留原始数据帧，不包含我们删除的列。</p><pre class="md me mf mg gt mj mk ml mm aw mn bi"><span id="686f" class="mo la it mk b gy mp mq l mr ms">df.drop(['id'],axis='columns',inplace=True)</span></pre><p id="617c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在让我们看看内存减少了多少。</p><pre class="md me mf mg gt mj mk ml mm aw mn bi"><span id="60c7" class="mo la it mk b gy mp mq l mr ms">df.info(memory_usage='deep')<br/><br/><br/>RangeIndex: 358 entries, 0 to 357<br/>Data columns (total 6 columns):<br/>ClusterTitle    358 non-null object<br/>Cluster         358 non-null object<br/>Regents Date    358 non-null object<br/>Type            358 non-null object<br/>DateFixed       358 non-null object<br/>Qnumber         358 non-null object<br/>dtypes: object(6)<br/>memory usage: 137.1 KB</span></pre><p id="415c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">因此少了 2.8 KB 是一个很小的改进。但是当然，我们想做得更好。现在让我们看看我们可以对每一列的数据类型做些什么。</p><h1 id="7baa" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">改变列数据类型</h1><p id="1467" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">回想一下，我们使用了<code class="fe mt mu mv mk b">memory_usage</code>方法来查看每一列使用的内存量(以字节为单位)。我们还从<code class="fe mt mu mv mk b">info</code>方法中看到了每个列的类型。其中大部分是物品。在这些列中，有些是可以被视为标签的字符串数据列。我们可以减少标签数据(比如集群列)内存的一种方法是将它改为一种<code class="fe mt mu mv mk b">category</code>数据类型。<br/> <br/>让我们使用<code class="fe mt mu mv mk b">astype</code>方法将集群列更改为<code class="fe mt mu mv mk b">category</code>数据类型。(对于上下文:聚类列显示问题的总体主题的代码)</p><pre class="md me mf mg gt mj mk ml mm aw mn bi"><span id="364a" class="mo la it mk b gy mp mq l mr ms">df['Cluster']=df['Cluster'].astype('category')</span></pre><p id="8a79" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在来看看该列的内存使用量是如何变化的。</p><pre class="md me mf mg gt mj mk ml mm aw mn bi"><span id="07a4" class="mo la it mk b gy mp mq l mr ms">df.memory_usage(deep=True)<br/><br/>Index              80<br/>ClusterTitle    38222<br/>Cluster          1885<br/>Regents Date    14320<br/>Type            21122<br/>DateFixed       22554<br/>Qnumber         21392<br/>dtype: int64</span></pre><p id="2f10" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">哇！1885 字节比 22713 字节好多了！这意味着内存使用减少了 91.7%。现在我们将把 Type 和 Qnumber(问题编号范围从 1 到 36)列转换成相同的数据类型。如果你在看之前需要练习，你可以自己试试。</p><pre class="md me mf mg gt mj mk ml mm aw mn bi"><span id="4f33" class="mo la it mk b gy mp mq l mr ms">df['Type']=df['Type'].astype('category')<br/>df['Qnumber']=df['Qnumber'].astype('category')</span></pre><p id="1f2b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在让我们看看这对单个列的内存使用有什么影响。</p><pre class="md me mf mg gt mj mk ml mm aw mn bi"><span id="a59e" class="mo la it mk b gy mp mq l mr ms">df.memory_usage(deep=True)<br/><br/>Index              80<br/>ClusterTitle    38222<br/>Cluster          1885<br/>Regents Date    14320<br/>Type              556<br/>DateFixed       22554<br/>Qnumber          3789<br/>dtype: int64</span></pre><p id="5b1d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">太神奇了！Qnumber 数据类型内存使用减少了 82.8%。Type 列的内存使用大幅减少了 97.3%。现在，查看整个数据帧的整体内存使用量减少情况。请记住，我们的数据帧使用了 137.1 KB 的内存。</p><pre class="md me mf mg gt mj mk ml mm aw mn bi"><span id="25bd" class="mo la it mk b gy mp mq l mr ms">df.info(memory_usage='deep')<br/><br/><br/>RangeIndex: 358 entries, 0 to 357<br/>Data columns (total 6 columns):<br/>ClusterTitle    358 non-null object<br/>Cluster         358 non-null category<br/>Regents Date    358 non-null object<br/>Type            358 non-null category<br/>DateFixed       358 non-null object<br/>Qnumber         358 non-null category<br/>dtypes: category(3), object(3)<br/>memory usage: 79.5 KB</span></pre><p id="a3d2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">总体而言，我们的数据帧的内存使用减少了 42%。我们将内存使用量减少了将近一半！不错！</p><h1 id="b335" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">最终想法和额外资源</h1><p id="f2e6" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">内存使用更多的是一个计算机科学的概念，但是请记住，在您进行分析的时候，您仍然在编写代码。减少内存使用将全面提高计算机生成可视化的性能，在进行特征工程时提高新列的生成，并提高机器学习应用程序的处理能力。同样，您可以通过删除不必要的列并更改列的数据类型来减少数据的内存使用。</p><figure class="md me mf mg gt ju gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/a964a01320de752100d1f9b352039e95.png" data-original-src="https://miro.medium.com/v2/resize:fit:634/format:webp/1*BC5SbCcwlk2AO63bMNJcYg.jpeg"/></div><figcaption class="jx jy gj gh gi jz ka bd b be z dk">Image from Floriana on Flickr.</figcaption></figure><p id="7803" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这更多的是为了减少数据的内存使用。如果你觉得这有帮助(或没有)，你有进一步的问题，然后留下评论，让我知道。</p><p id="1cd8" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">关于减少内存使用的更深入的解释，请看 Josh Delvin 的博客文章。</p><p id="32e9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">感谢阅读！</p><p id="1b7f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">直到下一次，</p><p id="3751" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">约翰·德杰苏斯</p></div></div>    
</body>
</html>