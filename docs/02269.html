<html>
<head>
<title>How to create your own Deep Learning Project in Azure</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在 Azure 中创建自己的深度学习项目</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-create-your-own-deep-learning-project-in-azure-509660d8297?source=collection_archive---------10-----------------------#2019-04-15">https://towardsdatascience.com/how-to-create-your-own-deep-learning-project-in-azure-509660d8297?source=collection_archive---------10-----------------------#2019-04-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="36bb" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用 Azure 存储、带有 Keras 的数据块和 Azure ML 服务</h2></div><h1 id="83da" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">1.介绍</h1><p id="075f" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">深度学习对公司来说有很多实际应用，例如图像识别、视频索引和语音到文本转录。然而，对于公司来说，从深度学习项目开始可能会令人望而生畏。常见的问题是所用数据的敏感性和深度学习的复杂性，深度学习可以被视为机器学习的最高级。</p><h1 id="90ae" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">2.目标</h1><p id="c04c" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">在本教程中，创建了一个样本深度学习项目，它能够使用 CIFAR-10 数据集(飞机、青蛙、船)识别图片类别。在这种情况下，执行以下步骤:</p><ul class=""><li id="953b" class="lt lu iq kz b la lv ld lw lg lx lk ly lo lz ls ma mb mc md bi translated">Azure 存储用于安全地存储图片</li><li id="5225" class="lt lu iq kz b la me ld mf lg mg lk mh lo mi ls ma mb mc md bi translated">Azure Databricks 用于使用 Keras 和 TensorFlow 训练模型</li><li id="f46e" class="lt lu iq kz b la me ld mf lg mg lk mh lo mi ls ma mb mc md bi translated">Azure ML 服务用于将模型版本化和部署为 HTTP 端点</li></ul><p id="c155" class="pw-post-body-paragraph kx ky iq kz b la lv jr lc ld lw ju lf lg mj li lj lk mk lm ln lo ml lq lr ls ij bi translated">这可以在下面的体系结构概述中描述:</p><figure class="mn mo mp mq gt mr gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi mm"><img src="../Images/1558cb5bc9142353ab0659430baae7d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LDnkDgNGpV-OYqj8CfFfXQ.png"/></div></div><figcaption class="my mz gj gh gi na nb bd b be z dk">2. High level overview</figcaption></figure><p id="1b48" class="pw-post-body-paragraph kx ky iq kz b la lv jr lc ld lw ju lf lg mj li lj lk mk lm ln lo ml lq lr ls ij bi translated">这个解决方案的关键是 Azure Databricks，这是一个针对 Azure 优化的基于 Apache Spark 的分析平台。它本机集成了其他 Azure 服务，如 Azure Active Directory 和 Azure Storage。在本博客的剩余部分，将执行以下步骤:</p><ul class=""><li id="f107" class="lt lu iq kz b la lv ld lw lg lx lk ly lo lz ls ma mb mc md bi translated">3.先决条件</li><li id="5619" class="lt lu iq kz b la me ld mf lg mg lk mh lo mi ls ma mb mc md bi translated">4.创建深度学习项目</li><li id="0293" class="lt lu iq kz b la me ld mf lg mg lk mh lo mi ls ma mb mc md bi translated">5.部署深度学习模型</li><li id="70fa" class="lt lu iq kz b la me ld mf lg mg lk mh lo mi ls ma mb mc md bi translated">6.结论</li></ul><p id="33dc" class="pw-post-body-paragraph kx ky iq kz b la lv jr lc ld lw ju lf lg mj li lj lk mk lm ln lo ml lq lr ls ij bi translated">这是一个独立的教程，重点是在 Azure 中建立自己的深度学习项目，以“弄脏你的手”，从而更加熟悉这个主题。重点是深度学习的内部工作，最新的算法或<a class="ae nc" href="https://azure.microsoft.com/en-us/services/cognitive-services/computer-vision/" rel="noopener ugc nofollow" target="_blank">计算机视觉 API</a>。如果你对 AI 的 devops 更感兴趣，请参考我以前的博客，<a class="ae nc" rel="noopener" target="_blank" href="/how-to-bring-your-data-science-project-in-production-b36ae4c02b46">这里</a>和关注安全，见<a class="ae nc" rel="noopener" target="_blank" href="/how-to-embed-security-in-your-azure-data-science-project-55ef3f2ab47">这里</a>。</p><h1 id="85fd" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">3.先决条件</h1><p id="9371" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">需要在同一资源组和同一位置创建以下资源。</p><ul class=""><li id="216a" class="lt lu iq kz b la lv ld lw lg lx lk ly lo lz ls ma mb mc md bi translated"><a class="ae nc" href="https://docs.microsoft.com/en-us/azure/storage/blobs/data-lake-storage-quickstart-create-account?toc=%2Fazure%2Fstorage%2Fblobs%2Ftoc.json#create-an-account-using-azure-cli" rel="noopener ugc nofollow" target="_blank"> Azure 存储帐户</a></li><li id="066e" class="lt lu iq kz b la me ld mf lg mg lk mh lo mi ls ma mb mc md bi translated"><a class="ae nc" href="https://docs.azuredatabricks.net/getting-started/try-databricks.html#step-2-create-a-databricks-workspace" rel="noopener ugc nofollow" target="_blank"> Azure Databricks 工作区</a>。</li><li id="2a20" class="lt lu iq kz b la me ld mf lg mg lk mh lo mi ls ma mb mc md bi translated"><a class="ae nc" href="https://docs.microsoft.com/en-us/azure/machine-learning/service/quickstart-get-started" rel="noopener ugc nofollow" target="_blank"> Azure 机器学习服务</a></li></ul><h1 id="8ec3" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">4.创建深度学习项目</h1><p id="7d8e" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">这一部分将执行以下步骤。</p><ul class=""><li id="86d0" class="lt lu iq kz b la lv ld lw lg lx lk ly lo lz ls ma mb mc md bi translated">4a。将图片添加到存储帐户</li><li id="bfa9" class="lt lu iq kz b la me ld mf lg mg lk mh lo mi ls ma mb mc md bi translated">4b。创建深度学习集群</li><li id="13da" class="lt lu iq kz b la me ld mf lg mg lk mh lo mi ls ma mb mc md bi translated">4c。装载存储帐户</li><li id="4eaf" class="lt lu iq kz b la me ld mf lg mg lk mh lo mi ls ma mb mc md bi translated">4d。单节点训练深度学习模型</li><li id="f0ca" class="lt lu iq kz b la me ld mf lg mg lk mh lo mi ls ma mb mc md bi translated">4e。终止深度学习集群</li></ul><h2 id="8cc7" class="nd kg iq bd kh ne nf dn kl ng nh dp kp lg ni nj kr lk nk nl kt lo nm nn kv no bi translated">4a。将图片添加到存储帐户</h2><p id="70ba" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">在本教程中，<a class="ae nc" href="https://www.cs.toronto.edu/~kriz/cifar.html" rel="noopener ugc nofollow" target="_blank"> CIFAR-10 </a>数据用于训练深度学习模型。在第一个模型中，将使用 2000 个图片的子集。随后，将创建第二个模型，该模型使用 60000 张图片的完整 CIFAR-10 数据集。</p><p id="55d5" class="pw-post-body-paragraph kx ky iq kz b la lv jr lc ld lw ju lf lg mj li lj lk mk lm ln lo ml lq lr ls ij bi translated">为了说明如何将 Azure Storage 与 Azure Databricks 结合使用，将在 Storage 帐户中存储 2000 张图片的子集。因此，请访问以下 URL，下载 2000 张图片的压缩文件。</p><pre class="mn mo mp mq gt np nq nr ns aw nt bi"><span id="eb4c" class="nd kg iq nq b gy nu nv l nw nx"><a class="ae nc" href="https://github.com/rebremer/devopsai_databricks/raw/master/sampledata/2000pics_cifar10.zip" rel="noopener ugc nofollow" target="_blank">https://github.com/rebremer/devopsai_databricks/raw/master/sampledata/2000pics_cifar10.zip</a></span></pre><p id="4acc" class="pw-post-body-paragraph kx ky iq kz b la lv jr lc ld lw ju lf lg mj li lj lk mk lm ln lo ml lq lr ls ij bi translated">随后，转到 Azure 门户并选择您的存储帐户。然后选择 blobs 并创建一个名为“2000picscifar10”的新容器。随后，将之前下载的 zip 文件上传到您的容器中。</p><figure class="mn mo mp mq gt mr gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi ny"><img src="../Images/c04be774d32cd1b3e3e19a2fc5c318ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9QL7eN2SUSyivqnxqxuC9Q.png"/></div></div><figcaption class="my mz gj gh gi na nb bd b be z dk">4a1. Add zipfile to new container</figcaption></figure><p id="a763" class="pw-post-body-paragraph kx ky iq kz b la lv jr lc ld lw ju lf lg mj li lj lk mk lm ln lo ml lq lr ls ij bi translated">最后，转到访问密钥，复制密钥或您的存储帐户。</p><figure class="mn mo mp mq gt mr gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi nz"><img src="../Images/4a04d0b55a4690c55d51bf8fe501f1b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kCFl9VXreV7a6Wphov3SoA.png"/></div></div><figcaption class="my mz gj gh gi na nb bd b be z dk">4a3. Copy access keys</figcaption></figure><h2 id="da59" class="nd kg iq bd kh ne nf dn kl ng nh dp kp lg ni nj kr lk nk nl kt lo nm nn kv no bi translated">4b。创建深度学习集群</h2><p id="df21" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">转到您的 Azure Databricks 工作区并转到群集。由于模型将在不使用 Spark 作业的情况下在驱动程序节点上训练，因此不需要创建(并支付)工人节点。因此，使用以下设置创建一个新的 GPU 集群:</p><figure class="mn mo mp mq gt mr gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi oa"><img src="../Images/ea1057bd2a59b8f5b87df1c4aea5f215.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4yR1qsrpR_cS4lwTtQLMeg.png"/></div></div><figcaption class="my mz gj gh gi na nb bd b be z dk">4b1. Create GPU cluster without worker nodes</figcaption></figure><h2 id="8194" class="nd kg iq bd kh ne nf dn kl ng nh dp kp lg ni nj kr lk nk nl kt lo nm nn kv no bi translated">4c。装载存储帐户</h2><p id="e1a9" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">转到您的 Azure Databricks 工作区，右键单击，然后选择导入。在单选按钮中，选择使用 URL 导入以下笔记本:</p><pre class="mn mo mp mq gt np nq nr ns aw nt bi"><span id="bae4" class="nd kg iq nq b gy nu nv l nw nx"><a class="ae nc" href="https://raw.githubusercontent.com/rebremer/devopsai_databricks/master/project/modelling/0_mountStorage.py" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/rebremer/devopsai_databricks/master/project/modelling/0_mountStorage.py</a></span></pre><p id="5029" class="pw-post-body-paragraph kx ky iq kz b la lv jr lc ld lw ju lf lg mj li lj lk mk lm ln lo ml lq lr ls ij bi translated">另请参见下图:</p><figure class="mn mo mp mq gt mr gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi ob"><img src="../Images/0df07fccbc090bc305313069b0d64f21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P-jdfwh_MxqeMz9oaN6yBA.png"/></div></div><figcaption class="my mz gj gh gi na nb bd b be z dk">4c1. Import notebook to mount storage</figcaption></figure><p id="dac9" class="pw-post-body-paragraph kx ky iq kz b la lv jr lc ld lw ju lf lg mj li lj lk mk lm ln lo ml lq lr ls ij bi translated">打开您的节点簿并更改以下设置</p><pre class="mn mo mp mq gt np nq nr ns aw nt bi"><span id="7872" class="nd kg iq nq b gy nu nv l nw nx">storageaccount="&lt;&lt;your_storage_account&gt;&gt;"<br/>account_key="&lt;&lt;your_key_in_step4a&gt;&gt;"<br/>containername="2000picscifar10" # change if you used another name</span></pre><p id="fd3c" class="pw-post-body-paragraph kx ky iq kz b la lv jr lc ld lw ju lf lg mj li lj lk mk lm ln lo ml lq lr ls ij bi translated">请注意，在生产环境中，不得将密钥存储在笔记本中。相反，<a class="ae nc" href="https://docs.azuredatabricks.net/user-guide/secrets/secret-scopes.html#create-an-azure-key-vault-backed-secret-scope" rel="noopener ugc nofollow" target="_blank">秘密范围</a>将被使用，参见我的<a class="ae nc" rel="noopener" target="_blank" href="/how-to-embed-security-in-your-azure-data-science-project-55ef3f2ab47">博客</a>如何在数据科学项目中嵌入安全性。然后将笔记本连接到您创建的集群，然后单击 SHIFT+ENTER 来逐个单元地运行。</p><figure class="mn mo mp mq gt mr gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi oc"><img src="../Images/e02d6bedcee277263f529a158a83a643.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T207JiRToUiVnNOSqhM8Hg.png"/></div></div><figcaption class="my mz gj gh gi na nb bd b be z dk">4c2. Attach notebook to cluster</figcaption></figure><p id="c919" class="pw-post-body-paragraph kx ky iq kz b la lv jr lc ld lw ju lf lg mj li lj lk mk lm ln lo ml lq lr ls ij bi translated">在本笔记本中，将执行以下步骤:</p><ul class=""><li id="fa85" class="lt lu iq kz b la lv ld lw lg lx lk ly lo lz ls ma mb mc md bi translated">将存储帐户装载到 Azure Databricks 工作区</li><li id="c482" class="lt lu iq kz b la me ld mf lg mg lk mh lo mi ls ma mb mc md bi translated">解压缩存储帐户中的图片</li><li id="8c83" class="lt lu iq kz b la me ld mf lg mg lk mh lo mi ls ma mb mc md bi translated">列出并显示图片</li></ul><h2 id="b8d3" class="nd kg iq bd kh ne nf dn kl ng nh dp kp lg ni nj kr lk nk nl kt lo nm nn kv no bi translated">4d。单节点训练深度学习模型</h2><p id="9d3b" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">再次转到您的 Azure Databricks 工作区，右键单击，然后选择导入。在单选按钮中，选择使用 URL 导入以下笔记本:</p><pre class="mn mo mp mq gt np nq nr ns aw nt bi"><span id="3dcb" class="nd kg iq nq b gy nu nv l nw nx"><a class="ae nc" href="https://github.com/rebremer/devopsai_databricks/blob/master/project/modelling/1_DeepLearningCifar10NotebookExploration.py" rel="noopener ugc nofollow" target="_blank">https://github.com/rebremer/devopsai_databricks/blob/master/project/modelling/1_DeepLearningCifar10NotebookExploration.py</a></span></pre><p id="b0ec" class="pw-post-body-paragraph kx ky iq kz b la lv jr lc ld lw ju lf lg mj li lj lk mk lm ln lo ml lq lr ls ij bi translated">在本笔记本中，将执行以下步骤:</p><ul class=""><li id="1cec" class="lt lu iq kz b la lv ld lw lg lx lk ly lo lz ls ma mb mc md bi translated">从存储帐户导入和处理数据</li><li id="386f" class="lt lu iq kz b la me ld mf lg mg lk mh lo mi ls ma mb mc md bi translated">根据存储帐户中的 2000 张图片建立模型</li><li id="f3df" class="lt lu iq kz b la me ld mf lg mg lk mh lo mi ls ma mb mc md bi translated">在完整 CIFAR-10 数据集的 60000 张图片的数据集上建立模型</li><li id="b725" class="lt lu iq kz b la me ld mf lg mg lk mh lo mi ls ma mb mc md bi translated">将模型保存到磁盘(dbfs)</li></ul><p id="bf67" class="pw-post-body-paragraph kx ky iq kz b la lv jr lc ld lw ju lf lg mj li lj lk mk lm ln lo ml lq lr ls ij bi translated">当您成功运行笔记本时，您可以看到预测的概述(红色是错误的预测)。</p><figure class="mn mo mp mq gt mr gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi od"><img src="../Images/acda087e50f90ffe85ad156099ccc154.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZMh7cxP79zPl-KCcIB2HOg.png"/></div></div><figcaption class="my mz gj gh gi na nb bd b be z dk">4d1. Overview of predictions</figcaption></figure><h2 id="67c7" class="nd kg iq bd kh ne nf dn kl ng nh dp kp lg ni nj kr lk nk nl kt lo nm nn kv no bi translated">4e。终止深度学习集群</h2><p id="3f58" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">运行 GPU 集群的成本可能很高。由于我们在本教程的剩余部分不需要 GPU 集群，我们可以停止它。因此，转到您的集群并选择终止。</p><figure class="mn mo mp mq gt mr gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi oe"><img src="../Images/f6cf6e0d37e6a08b9b5fffb6eb0e8d92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*txWuK8WKf2pBMxPyBZn5Cw.png"/></div></div><figcaption class="my mz gj gh gi na nb bd b be z dk">4e1. Terminate cluster</figcaption></figure><h1 id="adfa" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">5.部署深度学习项目</h1><p id="bb6c" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">这一部分将执行以下步骤。</p><ul class=""><li id="32dc" class="lt lu iq kz b la lv ld lw lg lx lk ly lo lz ls ma mb mc md bi translated">5a。在数据块中创建新簇</li><li id="c557" class="lt lu iq kz b la me ld mf lg mg lk mh lo mi ls ma mb mc md bi translated">5b。将库添加到集群</li><li id="2c87" class="lt lu iq kz b la me ld mf lg mg lk mh lo mi ls ma mb mc md bi translated">5c。注册模型和日志指标</li><li id="a963" class="lt lu iq kz b la me ld mf lg mg lk mh lo mi ls ma mb mc md bi translated">5d。创建模型的 HTTP 端点</li><li id="ae65" class="lt lu iq kz b la me ld mf lg mg lk mh lo mi ls ma mb mc md bi translated">5e。测试模型的 HTTP 端点</li></ul><h2 id="5567" class="nd kg iq bd kh ne nf dn kl ng nh dp kp lg ni nj kr lk nk nl kt lo nm nn kv no bi translated">5a。在数据块中创建新簇</h2><p id="6477" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">在这一步中，将创建一个新的集群，用于部署我们的模型。既然模型已经训练好了，我们就不再需要 GPU 了。选择具有以下设置的群集</p><figure class="mn mo mp mq gt mr gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi of"><img src="../Images/28e8d2f566c6af6cd7ff1061f8c651da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7QPXFsqCmnj5Wo30nYT6Gw.png"/></div></div><figcaption class="my mz gj gh gi na nb bd b be z dk">5a1. Non GPU cluster</figcaption></figure><h2 id="2c9a" class="nd kg iq bd kh ne nf dn kl ng nh dp kp lg ni nj kr lk nk nl kt lo nm nn kv no bi translated">5b。将库添加到集群</h2><p id="5967" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">为了部署我们的模型，我们需要几个库。转到您的共享文件夹，右键单击共享并选择“创建库”。</p><figure class="mn mo mp mq gt mr gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi og"><img src="../Images/fb879bf7ba535e6976ae060141420867.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-0YR4UUXLuKMHCuuryXlGQ.png"/></div></div><figcaption class="my mz gj gh gi na nb bd b be z dk">4b1. Add Libraries</figcaption></figure><p id="b3ac" class="pw-post-body-paragraph kx ky iq kz b la lv jr lc ld lw ju lf lg mj li lj lk mk lm ln lo ml lq lr ls ij bi translated">随后，选择 Pypi 并将以下库添加到共享文件夹中:</p><pre class="mn mo mp mq gt np nq nr ns aw nt bi"><span id="b1fe" class="nd kg iq nq b gy nu nv l nw nx">azureml-sdk[databricks]<br/>keras<br/>tensorflow</span></pre><h2 id="219c" class="nd kg iq bd kh ne nf dn kl ng nh dp kp lg ni nj kr lk nk nl kt lo nm nn kv no bi translated">5c。注册模型和日志指标</h2><p id="e616" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">在这一步中，模型及其指标将被添加到您的 Azure ML 服务工作区。在 Azure Databricks 工作区中导入以下笔记本。</p><pre class="mn mo mp mq gt np nq nr ns aw nt bi"><span id="3745" class="nd kg iq nq b gy nu nv l nw nx"><a class="ae nc" href="https://raw.githubusercontent.com/rebremer/devopsai_databricks/master/project/modelling/2a_Cifar10KerasNotebookLogModel.py" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/rebremer/devopsai_databricks/master/project/modelling/2a_Cifar10KerasNotebookLogModel.py</a></span></pre><p id="4676" class="pw-post-body-paragraph kx ky iq kz b la lv jr lc ld lw ju lf lg mj li lj lk mk lm ln lo ml lq lr ls ij bi translated">打开您的节点簿并更改您的 Azure ML 服务工作区的以下设置(订阅 id 可在您的 Azure ML 服务工作区实例的概述选项卡中找到)。</p><pre class="mn mo mp mq gt np nq nr ns aw nt bi"><span id="a97a" class="nd kg iq nq b gy nu nv l nw nx">workspace="&lt;&lt;your_name_of_azure_ml_service_workspace&gt;&gt;"<br/>resource_grp="&lt;&lt;your_resource_group_amlservice&gt;&gt;"<br/>subscription_id="&lt;&lt;your_subscriptionid_amlservice&gt;&gt;"</span></pre><p id="7e73" class="pw-post-body-paragraph kx ky iq kz b la lv jr lc ld lw ju lf lg mj li lj lk mk lm ln lo ml lq lr ls ij bi translated">然后运行笔记本，再次使用 Shift+Enter 逐个单元格地浏览。在本笔记本中，将执行以下步骤:</p><ul class=""><li id="5cb0" class="lt lu iq kz b la lv ld lw lg lx lk ly lo lz ls ma mb mc md bi translated">在 2000 张图片上训练的模型的对数度量</li><li id="1463" class="lt lu iq kz b la me ld mf lg mg lk mh lo mi ls ma mb mc md bi translated">在所有 60000 张图片上训练的模型的日志度量</li><li id="9b0a" class="lt lu iq kz b la me ld mf lg mg lk mh lo mi ls ma mb mc md bi translated">在步骤 5d 中注册要部署的最佳模型</li></ul><p id="6fe8" class="pw-post-body-paragraph kx ky iq kz b la lv jr lc ld lw ju lf lg mj li lj lk mk lm ln lo ml lq lr ls ij bi translated">要查看指标，请转到门户，选择 Azure 机器学习工作区，然后选择 Expirement，见下文</p><figure class="mn mo mp mq gt mr gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi oh"><img src="../Images/03f6036a8ba5e1c45ab757c792e93215.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ktHkfGkK2Lq8qc7xhjLWBg.png"/></div></div><figcaption class="my mz gj gh gi na nb bd b be z dk">5c1. Log metrics of model with 2000 pictures and all CIFAR-10 pictures</figcaption></figure><h2 id="2c72" class="nd kg iq bd kh ne nf dn kl ng nh dp kp lg ni nj kr lk nk nl kt lo nm nn kv no bi translated">5d。创建模型的 HTTP 端点</h2><p id="fa91" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">将以下笔记本导入您的工作区</p><pre class="mn mo mp mq gt np nq nr ns aw nt bi"><span id="5b15" class="nd kg iq nq b gy nu nv l nw nx"><a class="ae nc" href="https://raw.githubusercontent.com/rebremer/devopsai_databricks/master/project/modelling/2b_Cifar10KerasNotebookDeployModel.py" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/rebremer/devopsai_databricks/master/project/modelling/2b_Cifar10KerasNotebookDeployModel.py</a></span></pre><p id="6995" class="pw-post-body-paragraph kx ky iq kz b la lv jr lc ld lw ju lf lg mj li lj lk mk lm ln lo ml lq lr ls ij bi translated">再次更改参数，类似于步骤 5c。在这个笔记本中，为在所有图片上训练的模型创建一个端点。当你去门户网站，选择 Azure 容器实例，你会发现端点的 IP 地址。</p><figure class="mn mo mp mq gt mr gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi oi"><img src="../Images/e806b07c8481024f46d1972cc67c16d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UJdd2tpNhBqnv7duV5yrhg.png"/></div></div><figcaption class="my mz gj gh gi na nb bd b be z dk">5d1. Azure Container Instance with IP addresss</figcaption></figure><h2 id="869c" class="nd kg iq bd kh ne nf dn kl ng nh dp kp lg ni nj kr lk nk nl kt lo nm nn kv no bi translated">5e。测试模型的 HTTP 端点</h2><p id="b729" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">要测试端点，需要完成以下步骤:</p><ul class=""><li id="f37c" class="lt lu iq kz b la lv ld lw lg lx lk ly lo lz ls ma mb mc md bi translated">从互联网上获得一个 CIFAR-10 类别的随机 png</li><li id="9013" class="lt lu iq kz b la me ld mf lg mg lk mh lo mi ls ma mb mc md bi translated">使用此<a class="ae nc" href="https://onlinepngtools.com/convert-png-to-base64" rel="noopener ugc nofollow" target="_blank">网站</a>将 png 转换为 base64 编码</li><li id="ae2a" class="lt lu iq kz b la me ld mf lg mg lk mh lo mi ls ma mb mc md bi translated">使用类似<a class="ae nc" href="https://www.getpostman.com/" rel="noopener ugc nofollow" target="_blank">邮递员</a>的工具发送 base64 有效载荷来创建预测。</li></ul><p id="be5e" class="pw-post-body-paragraph kx ky iq kz b la lv jr lc ld lw ju lf lg mj li lj lk mk lm ln lo ml lq lr ls ij bi translated">下图是一艘船的图片，转换为 base64 格式，用 Postman 发送，使用 endpoint 创建预测。</p><figure class="mn mo mp mq gt mr gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi oj"><img src="../Images/c646af5eee31d44217bb685abb225cad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6mtxxxWleAACPWIeYML_JQ.png"/></div></div><figcaption class="my mz gj gh gi na nb bd b be z dk">5e1. Picture of ship converted to base64 using <a class="ae nc" href="https://onlinepngtools.com/convert-png-to-base64" rel="noopener ugc nofollow" target="_blank">https://onlinepngtools.com/convert-png-to-base64</a></figcaption></figure><figure class="mn mo mp mq gt mr gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi ok"><img src="../Images/7d7319a33a84c773cb2efaa60cf0aa36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*30laWHXFXqPlvA2B4DfN7w.png"/></div></div><figcaption class="my mz gj gh gi na nb bd b be z dk">5e2. Prediction of ship using HTTP endpoint</figcaption></figure><h1 id="fe0a" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">6.结论</h1><p id="decd" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">在本教程中，创建了一个深度学习项目，其中使用了以下服务:</p><ul class=""><li id="d124" class="lt lu iq kz b la lv ld lw lg lx lk ly lo lz ls ma mb mc md bi translated">Azure 存储帐户可以安全地存储图片</li><li id="09eb" class="lt lu iq kz b la me ld mf lg mg lk mh lo mi ls ma mb mc md bi translated">Azure Databricks 与 Tensorflow 和 Keras 一起构建模型</li><li id="2b98" class="lt lu iq kz b la me ld mf lg mg lk mh lo mi ls ma mb mc md bi translated">Azure ML 服务跟踪模型并创建 HTTP 端点</li></ul><p id="923b" class="pw-post-body-paragraph kx ky iq kz b la lv jr lc ld lw ju lf lg mj li lj lk mk lm ln lo ml lq lr ls ij bi translated">深度学习对企业有很多实际应用。然而，对于企业来说，从深度学习项目开始可能会令人望而生畏。创建您自己的示例项目并“亲自动手”是学习和熟悉该主题的好方法。</p><figure class="mn mo mp mq gt mr gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi mm"><img src="../Images/1558cb5bc9142353ab0659430baae7d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LDnkDgNGpV-OYqj8CfFfXQ.png"/></div></div><figcaption class="my mz gj gh gi na nb bd b be z dk">6. Sample project overview</figcaption></figure><blockquote class="ol om on"><p id="8426" class="kx ky oo kz b la lv jr lc ld lw ju lf op mj li lj oq mk lm ln or ml lq lr ls ij bi translated">最后，非常感谢我的同事 Ilona Stuhler，她非常友好地向我提供了这个课题的重要内幕，并把她的项目捐赠给了我。</p></blockquote></div></div>    
</body>
</html>