<html>
<head>
<title>Generating a logo with MapBox GL and Python.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 MapBox GL 和 Python 生成 logo。</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/generating-a-logo-with-mapbox-gl-and-python-2c44a357f462?source=collection_archive---------14-----------------------#2019-11-08">https://towardsdatascience.com/generating-a-logo-with-mapbox-gl-and-python-2c44a357f462?source=collection_archive---------14-----------------------#2019-11-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/f4a1132051b8958575edce131107d103.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jO8GOCI6nrWJpJ5J74qyig.png"/></div></div></figure></div><div class="ab cl kb kc hx kd" role="separator"><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg"/></div><div class="im in io ip iq"><p id="3bf0" class="pw-post-body-paragraph ki kj it kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf im bi translated">建筑足迹总是有一种令人愉悦的美感。视觉设计通常源于自然和人造的隐喻——这两种事物都包含在制图领域中。拓扑特征和水路为我们呈现了柔和的曲线特征，与道路设计的线性和对称形状形成了直接对比。</p><p id="9fb3" class="pw-post-body-paragraph ki kj it kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf im bi translated">在这里，我们将建筑物的占地面积绘制成类似 Tron 的图像，有点像印刷电路板(PCB)。</p></div><div class="ab cl kb kc hx kd" role="separator"><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg"/></div><div class="im in io ip iq"><h2 id="ebda" class="lg lh it bd li lj lk dn ll lm ln dp lo kt lp lq lr kx ls lt lu lb lv lw lx ly bi translated">第一步:选择你的位置</h2><p id="a5a6" class="pw-post-body-paragraph ki kj it kk b kl lz kn ko kp ma kr ks kt mb kv kw kx mc kz la lb md ld le lf im bi translated">就我个人而言，我发现河流与城市结合的地方效果最好。这就是为什么我选择使用<a class="ae me" href="https://www.westminsterboatingbase.co.uk" rel="noopener ugc nofollow" target="_blank">威斯敏斯特划船基地</a>的位置，这是伦敦市中心的一个小型水上运动中心。</p><p id="15da" class="pw-post-body-paragraph ki kj it kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf im bi translated">使用快速谷歌地图搜索，可以从 url 获得经度和纬度:</p><p id="38a7" class="pw-post-body-paragraph ki kj it kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf im bi translated"><a class="ae me" href="http://www.google.com/maps/place/51°29'06.6&quot;N+0°08'04.9&quot;W/" rel="noopener ugc nofollow" target="_blank"><em class="mf"/><strong class="kk iu"><em class="mf">51 29 ' 06.6 " N+0 08 ' 04.9 " W</em></strong></a></p><h2 id="7516" class="lg lh it bd li lj lk dn ll lm ln dp lo kt lp lq lr kx ls lt lu lb lv lw lx ly bi translated">步骤 2:获取建筑造型文件</h2><p id="848f" class="pw-post-body-paragraph ki kj it kk b kl lz kn ko kp ma kr ks kt mb kv kw kx mc kz la lb md ld le lf im bi translated">获取一个国家建筑物的形状文件有很多来源。美国的足迹可以在这里<a class="ae me" href="https://github.com/microsoft/USBuildingFootprints" rel="noopener ugc nofollow" target="_blank">找到</a>，英国的足迹可以通过英国国家测绘局的开放地图项目(链接如下)找到。</p><div class="mg mh gp gr mi mj"><a href="http://ajrae.staff.shef.ac.uk/buildings/" rel="noopener  ugc nofollow" target="_blank"><div class="mk ab fo"><div class="ml ab mm cl cj mn"><h2 class="bd iu gy z fp mo fr fs mp fu fw is bi translated">英国的所有建筑</h2><div class="mq l"><h3 class="bd b gy z fp mo fr fs mp fu fw dk translated">此页面包含为整个英国构建 shapefile 数据的链接，以及指向单个地理包的链接…</h3></div><div class="mr l"><p class="bd b dl z fp mo fr fs mp fu fw dk translated">ajrae.staff.shef.ac.uk</p></div></div><div class="ms l"><div class="mt l mu mv mw ms mx jz mj"/></div></div></a></div><h2 id="b247" class="lg lh it bd li lj lk dn ll lm ln dp lo kt lp lq lr kx ls lt lu lb lv lw lx ly bi translated">步骤 3:只提取你需要的数据</h2><p id="9cbf" class="pw-post-body-paragraph ki kj it kk b kl lz kn ko kp ma kr ks kt mb kv kw kx mc kz la lb md ld le lf im bi translated">这个过程涉及到 Python 的使用，结合<a class="ae me" href="http://geopandas.org" rel="noopener ugc nofollow" target="_blank"> geopandas </a>库<code class="fe my mz na nb b">pip install geopandas</code>。</p><p id="04db" class="pw-post-body-paragraph ki kj it kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf im bi translated">我们用<code class="fe my mz na nb b">geopandas.read_file</code>读取文件，然后过滤掉任何不想要的结果。因为我们希望绘制的区域包括三个不同的行政区，所以我们只在<code class="fe my mz na nb b">NAME</code>列包含其中一个行政区名称的地方提取数据:</p><pre class="nc nd ne nf gt ng nb nh ni aw nj bi"><span id="72e4" class="lg lh it nb b gy nk nl l nm nn">selection = all_data[ (all_data.NAME == 'Westminster') ^     <br/>                      (all_data.NAME == 'Wandsworth' ) ^ <br/>                      (all_data.NAME == 'Lambeth'    )    ]</span></pre><p id="25f2" class="pw-post-body-paragraph ki kj it kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf im bi translated">然后，我们确保我们的单位是经度和纬度的单位:</p><pre class="nc nd ne nf gt ng nb nh ni aw nj bi"><span id="f206" class="lg lh it nb b gy nk nl l nm nn">selection = selection.to_crs(epsg=4326).reset_index()</span></pre><h2 id="a6e3" class="lg lh it bd li lj lk dn ll lm ln dp lo kt lp lq lr kx ls lt lu lb lv lw lx ly bi translated">第四步:只获取我们位置一定半径范围内的建筑</h2><p id="6b9e" class="pw-post-body-paragraph ki kj it kk b kl lz kn ko kp ma kr ks kt mb kv kw kx mc kz la lb md ld le lf im bi translated">现在我们有了所有的数据，我们希望过滤掉一定距离以外的所有建筑。</p><p id="7103" class="pw-post-body-paragraph ki kj it kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf im bi translated">为此，我们可以使用<em class="mf"> shapley </em> <strong class="kk iu">点</strong>几何图形并定义我们的位置。然后，我们可以遍历 GeoPandas 数据框中的所有项目，并且只追加距离所选点一定距离的项目。</p><pre class="nc nd ne nf gt ng nb nh ni aw nj bi"><span id="091b" class="lg lh it nb b gy nk nl l nm nn">point = Point(lon,lat)<br/>thresh = 0.01<br/>keep=[]</span><span id="03c7" class="lg lh it nb b gy no nl l nm nn"><strong class="nb iu">for</strong> r <strong class="nb iu">in</strong> selection.iterrows():</span><span id="215d" class="lg lh it nb b gy no nl l nm nn">    dst = point.distance(r[1].geometry)</span><span id="c59b" class="lg lh it nb b gy no nl l nm nn">    <strong class="nb iu">if</strong> abs(dst) &lt; thresh:<br/>        x,y = r[1].geometry.exterior.coords.xy<br/>        keep.append([list(x),list(y)])</span></pre><p id="3a88" class="pw-post-body-paragraph ki kj it kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf im bi translated">最后，我们将所有数据写入一个文本文件:</p><pre class="nc nd ne nf gt ng nb nh ni aw nj bi"><span id="bd9f" class="lg lh it nb b gy nk nl l nm nn"><strong class="nb iu">import</strong> <strong class="nb iu">json</strong><br/>json.dump( [[list(i) <strong class="nb iu">for</strong> i <strong class="nb iu">in</strong> zip(x,y)] <strong class="nb iu">for</strong> x,y <strong class="nb iu">in</strong> keep] , <br/>                                 open('keep_footprint.json','w') </span></pre><h2 id="7c5e" class="lg lh it bd li lj lk dn ll lm ln dp lo kt lp lq lr kx ls lt lu lb lv lw lx ly bi translated">可选:在 python 中预先绘制</h2><pre class="nc nd ne nf gt ng nb nh ni aw nj bi"><span id="dd9d" class="lg lh it nb b gy nk nl l nm nn">fig = plt.figure()<br/>ax = fig.add_subplot(111)<br/><br/><strong class="nb iu">for</strong> poly <strong class="nb iu">in</strong> keep:<br/>    x,y = poly<br/>    ax.plot(x, y, color='red', alpha=0.7,<br/>        linewidth=1, solid_capstyle='round', zorder=2)<br/><br/>ax.set_title('test')<br/>plt.show()</span></pre><h2 id="1703" class="lg lh it bd li lj lk dn ll lm ln dp lo kt lp lq lr kx ls lt lu lb lv lw lx ly bi translated">步骤 5:设计创建地图框样式</h2><p id="cae8" class="pw-post-body-paragraph ki kj it kk b kl lz kn ko kp ma kr ks kt mb kv kw kx mc kz la lb md ld le lf im bi translated">现在我们注册了一个免费的地图框账户，用提供的工作室应用【https://studio.mapbox.com T4】创建我们自己的定制风格</p><p id="75ed" class="pw-post-body-paragraph ki kj it kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf im bi translated">我个人是从“暗”布局开始的，把所有的街道都变暗，把所有的标签的不透明度设置为 0，去掉所有的标签。生产出来的款式可以在这里找到<a class="ae me" href="https://studio.mapbox.com/styles/dp626/ck2nqoqic01wu1cs2vdle2hsc/edit/#13.39/51.48051/-0.13192" rel="noopener ugc nofollow" target="_blank">。</a></p><figure class="nc nd ne nf gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi np"><img src="../Images/0966a454dc5bbdb89af24b4a386624bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rRGEt6qxb-SyAD7na--ZAA.png"/></div></div><figcaption class="nq nr gj gh gi ns nt bd b be z dk">Mapbox Studio</figcaption></figure><h2 id="e8f3" class="lg lh it bd li lj lk dn ll lm ln dp lo kt lp lq lr kx ls lt lu lb lv lw lx ly bi translated">步骤 6:简单的地图框布局</h2><p id="57e7" class="pw-post-body-paragraph ki kj it kk b kl lz kn ko kp ma kr ks kt mb kv kw kx mc kz la lb md ld le lf im bi translated">最后，我们可以使用带有我们的<em class="mf"> lat </em>和<em class="mf"> lon </em>值的自定义样式的 Mapbox 示例脚本来生成我们位置的预览。(下面链接中的代码)</p><div class="mg mh gp gr mi mj"><a href="https://docs.mapbox.com/mapbox-gl-js/example/custom-style-id/" rel="noopener  ugc nofollow" target="_blank"><div class="mk ab fo"><div class="ml ab mm cl cj mn"><h2 class="bd iu gy z fp mo fr fs mp fu fw is bi translated">以自定义样式显示地图</h2><div class="mq l"><h3 class="bd b gy z fp mo fr fs mp fu fw dk translated">使用自定义地图框托管样式。</h3></div><div class="mr l"><p class="bd b dl z fp mo fr fs mp fu fw dk translated">docs.mapbox.com</p></div></div><div class="ms l"><div class="nu l mu mv mw ms mx jz mj"/></div></div></a></div><p id="bf84" class="pw-post-body-paragraph ki kj it kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf im bi translated">然后，我们通过添加一个椭圆形的剪辑路径来扩展它，样式为“map”元素:</p><pre class="nc nd ne nf gt ng nb nh ni aw nj bi"><span id="63a1" class="lg lh it nb b gy nk nl l nm nn">&lt;style&gt;</span><span id="3f43" class="lg lh it nb b gy no nl l nm nn">#map{<br/>   width:600px;<br/>   height:600px;<br/>   clip-path:ellipse(300px 300px at 300px 300px);<br/>}</span><span id="6b7b" class="lg lh it nb b gy no nl l nm nn">&lt;/style&gt;</span></pre><p id="cd6e" class="pw-post-body-paragraph ki kj it kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf im bi translated">为我们的位置添加一个标记:</p><pre class="nc nd ne nf gt ng nb nh ni aw nj bi"><span id="2c5f" class="lg lh it nb b gy nk nl l nm nn">// marker<br/>new mapboxgl.Marker({"color":'#33ff00'})<br/>    .setLngLat([ -0.134605,51.484575])<br/>    .addTo(map);</span></pre><figure class="nc nd ne nf gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nv"><img src="../Images/075b72ee12961b2e365785b62eccc727.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ysk-7hZtVegoGiY0svM_Jw.png"/></div></div></figure><h2 id="d90b" class="lg lh it bd li lj lk dn ll lm ln dp lo kt lp lq lr kx ls lt lu lb lv lw lx ly bi translated">步骤 6:加载我们的足迹数据</h2><p id="a33f" class="pw-post-body-paragraph ki kj it kk b kl lz kn ko kp ma kr ks kt mb kv kw kx mc kz la lb md ld le lf im bi translated">最后，剩下的就是在文本文件中读取。我发现使用 GitHub 的 raw 格式，结合 d3 库最简单:<a class="ae me" href="https://d3js.org" rel="noopener ugc nofollow" target="_blank">d3js.org</a></p><pre class="nc nd ne nf gt ng nb nh ni aw nj bi"><span id="1804" class="lg lh it nb b gy nk nl l nm nn">d3.json(“<a class="ae me" href="https://raw.githubusercontent.com/wolfiex/GeoLogo/master/polyfoot.txt" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/wolfiex/GeoLogo/master/polyfoot.txt</a>", run)</span></pre><p id="bf93" class="pw-post-body-paragraph ki kj it kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf im bi translated">现在，我们需要做的就是在加载的数据集中绘制每个建筑物的轮廓:</p><pre class="nc nd ne nf gt ng nb nh ni aw nj bi"><span id="fea3" class="lg lh it nb b gy nk nl l nm nn">data.forEach((polygon, i) =&gt; {</span><span id="e2ce" class="lg lh it nb b gy no nl l nm nn">map.addLayer({<br/>        'id': 'poly' + i,<br/>        'type': 'line',<br/>        'source': {<br/>            'type': 'geojson',<br/>            'data': {<br/>                'type': 'Feature',<br/>                'geometry': {<br/>                    'type': 'Polygon',<br/>                    'coordinates': [polygon]<br/>                }<br/>            }<br/>        },<br/>        'layout': {},<br/>        'paint': {<br/>            'line-color': '#088',<br/>            'line-opacity': 0.8<br/>        }<br/>    });<br/>}<br/>})</span></pre><p id="81b5" class="pw-post-body-paragraph ki kj it kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf im bi translated">如果我们希望每个形状都被填充而不是描边，我们可以将“类型”设置为<code class="fe my mz na nb b">fill</code>而不是<code class="fe my mz na nb b">line</code>，并相应地更改<code class="fe my mz na nb b">line-color</code>和<code class="fe my mz na nb b">line-opacity</code>。</p><h2 id="ac62" class="lg lh it bd li lj lk dn ll lm ln dp lo kt lp lq lr kx ls lt lu lb lv lw lx ly bi translated">第七步:享受！</h2><p id="480f" class="pw-post-body-paragraph ki kj it kk b kl lz kn ko kp ma kr ks kt mb kv kw kx mc kz la lb md ld le lf im bi translated">我们有了它，一个围绕我们感兴趣的区域的漂亮标志。</p><p id="7036" class="pw-post-body-paragraph ki kj it kk b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf im bi translated"><em class="mf">注意:由于可能有许多多边形要绘制，此过程可能需要一段时间才能完成。明智地选择你的门槛距离！</em></p><figure class="nc nd ne nf gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nw"><img src="../Images/3383c36e1e2b08c3d872b5aadfeb2e7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WpejbRlKmUOqY9DZLA41nQ.png"/></div></div></figure></div></div>    
</body>
</html>