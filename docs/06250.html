<html>
<head>
<title>Become a video analysis expert using python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 python 成为视频分析专家</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/generate-any-sport-highlights-using-python-3695c98baead?source=collection_archive---------17-----------------------#2019-09-09">https://towardsdatascience.com/generate-any-sport-highlights-using-python-3695c98baead?source=collection_archive---------17-----------------------#2019-09-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/57e93a50f290ccbbca39e8fffa0e3013.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*KiYI6AmGN--NTEuy.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">Courtesy<a class="ae kf" href="https://pixabay.com/photos/children-splash-asia-sunset-1822688/" rel="noopener ugc nofollow" target="_blank">: pixabay</a></figcaption></figure><figure class="kg kh ki kj gt ju"><div class="bz fp l di"><div class="kk kl l"/></div></figure><h1 id="54b5" class="km kn it bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">如果告诉你这不是用机器学习或者深度学习生成的呢！</h1><p id="6621" class="pw-post-body-paragraph lk ll it lm b ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">为任何运动生成精彩场面的任务都是相当乏味和困难的。它涉及许多技术和其他软件、硬件需求。你也需要投入大量的时间去做。如果你对这样的视频公司或部门感兴趣，那就没问题，但如果你是像我一样的普通用户，你就不会想这么做。我将使用 python 在几个步骤中完成这项工作。不会涉及任何外部软件。只是纯粹的 python，而且，我们不必依赖机器学习或深度学习技术来做到这一点。我们将使用<strong class="lm iu">语音分析</strong>来完成这项任务。</p><p id="a6a4" class="pw-post-body-paragraph lk ll it lm b ln mi lp lq lr mj lt lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">当比赛中发生令人兴奋的事情时，解说员的声音就会提高。让我们以板球为例。每当击球手击球或投球手击球时，解说员的声音就会提高。在那场比赛中，观众和解说员的音调都很高。我们可以利用音频的这些变化从视频中捕捉有趣的瞬间。</p><p id="66d1" class="pw-post-body-paragraph lk ll it lm b ln mi lp lq lr mj lt lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">我们将遵循的流程补充如下:</p><ul class=""><li id="7f39" class="mn mo it lm b ln mi lr mj lv mp lz mq md mr mh ms mt mu mv bi translated">输入视频文件</li><li id="bf15" class="mn mo it lm b ln mw lr mx lv my lz mz md na mh ms mt mu mv bi translated">提取音频</li><li id="05b0" class="mn mo it lm b ln mw lr mx lv my lz mz md na mh ms mt mu mv bi translated">将音频分成几块</li><li id="f2a0" class="mn mo it lm b ln mw lr mx lv my lz mz md na mh ms mt mu mv bi translated">计算每个块的短时能量</li><li id="733f" class="mn mo it lm b ln mw lr mx lv my lz mz md na mh ms mt mu mv bi translated">将每个块分类为兴奋或不兴奋(基于阈值)</li><li id="9485" class="mn mo it lm b ln mw lr mx lv my lz mz md na mh ms mt mu mv bi translated">合并所有精彩片段，形成视频集锦</li><li id="c7f1" class="mn mo it lm b ln mw lr mx lv my lz mz md na mh ms mt mu mv bi translated">生成最终的视频集锦</li></ul><p id="fd8e" class="pw-post-body-paragraph lk ll it lm b ln mi lp lq lr mj lt lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated"><strong class="lm iu">记住，我们不会在这里使用任何外部软件。</strong></p><p id="b918" class="pw-post-body-paragraph lk ll it lm b ln mi lp lq lr mj lt lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated"><strong class="lm iu"> 1。下载视频输入</strong>:<a class="ae kf" href="https://bit.ly/2lKfVa6" rel="noopener ugc nofollow" target="_blank">https://bit.ly/2lKfVa6</a></p><p id="ea18" class="pw-post-body-paragraph lk ll it lm b ln mi lp lq lr mj lt lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">你也可以选择你最喜欢的运动的任何其他视频。</p><p id="3c52" class="pw-post-body-paragraph lk ll it lm b ln mi lp lq lr mj lt lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated"><strong class="lm iu"> <em class="nb"> 2。提取音频:</em> </strong></p><p id="c3dc" class="pw-post-body-paragraph lk ll it lm b ln mi lp lq lr mj lt lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">为了提取音频和对视频文件进行其他操作，我们将使用一个名为<strong class="lm iu"> moviepy 的包。</strong></p><p id="4650" class="pw-post-body-paragraph lk ll it lm b ln mi lp lq lr mj lt lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">a.安装软件包。</p><pre class="kg kh ki kj gt nc nd ne nf aw ng bi"><span id="c09d" class="nh kn it nd b gy ni nj l nk nl">pip install moviepy</span></pre><p id="6cfb" class="pw-post-body-paragraph lk ll it lm b ln mi lp lq lr mj lt lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">b.在此代码中输入文件路径。</p><pre class="kg kh ki kj gt nc nd ne nf aw ng bi"><span id="4d76" class="nh kn it nd b gy ni nj l nk nl"># AudioExtract.py</span><span id="e763" class="nh kn it nd b gy nm nj l nk nl">import moviepy.editor as mp</span><span id="495f" class="nh kn it nd b gy nm nj l nk nl">clip = mp.VideoFileClip("filepath//videoplayback.mp4").subclip(1, 1380)<br/>clip.audio.write_audiofile("filepath//audio.wav")</span></pre><blockquote class="nn no np"><p id="a7ab" class="lk ll nb lm b ln mi lp lq lr mj lt lu nq mk lx ly nr ml mb mc ns mm mf mg mh im bi translated"><em class="it">在上面的代码中，</em> mp 视频文件剪辑<em class="it">是我们输入视频文件的地方。</em></p><p id="1f17" class="lk ll nb lm b ln mi lp lq lr mj lt lu nq mk lx ly nr ml mb mc ns mm mf mg mh im bi translated">子剪辑<em class="it">，我们指定我们需要音频的时间限制。*如果您想要完整的剪辑音频，则不需要* </em></p><p id="ddb2" class="lk ll nb lm b ln mi lp lq lr mj lt lu nq mk lx ly nr ml mb mc ns mm mf mg mh im bi translated">audio.write_audiofile <em class="it">，我们在这里指定输出路径和文件名。</em></p></blockquote><p id="f1c0" class="pw-post-body-paragraph lk ll it lm b ln mi lp lq lr mj lt lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">就这样，我们通过两个简单的步骤提取了音频。</p><p id="1e90" class="pw-post-body-paragraph lk ll it lm b ln mi lp lq lr mj lt lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated"><strong class="lm iu"> 3。将音频分成几块:</strong></p><p id="cf19" class="pw-post-body-paragraph lk ll it lm b ln mi lp lq lr mj lt lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">我们将使用刚刚在<strong class="lm iu">步骤 2 中提取的音频。</strong></p><p id="a82d" class="pw-post-body-paragraph lk ll it lm b ln mi lp lq lr mj lt lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">librosa 是一个用于音乐和音频分析的 python 包。</p><pre class="kg kh ki kj gt nc nd ne nf aw ng bi"><span id="ac19" class="nh kn it nd b gy ni nj l nk nl">import librosa<br/>import IPython.display as ipd</span><span id="ff2e" class="nh kn it nd b gy nm nj l nk nl">filename = "filepath\\audio.wav"</span><span id="1680" class="nh kn it nd b gy nm nj l nk nl"># loading the file with a sampling rate<br/>x, sr = librosa.load(filename, sr=16000)</span><span id="09dc" class="nh kn it nd b gy nm nj l nk nl"># To get duration of the audio clip in minutes<br/>int(librosa.get_duration(x, sr) / 60)</span><span id="2530" class="nh kn it nd b gy nm nj l nk nl"># Dividing into chunks of 5 seconds <br/>max_slice = 10<br/>window_length = max_slice * sr</span><span id="8f55" class="nh kn it nd b gy nm nj l nk nl"># Playing the audio chunk<br/>a = x[21 * window_length:22 * window_length]<br/>ipd.Audio(a, rate=sr)</span></pre><p id="bf11" class="pw-post-body-paragraph lk ll it lm b ln mi lp lq lr mj lt lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">在这里，我将采样率设置为 16000，您可以根据自己的方便和需要进行设置。现在，我已经将音频分成每个 10 秒的块，因为我们想要找出特定的音频块是否包含音频声音的上升。您可以根据自己的选择设置时间限制，对不同的输出尝试不同的时间限制。此外，我们将播放音频块只是为了检查。</p><p id="5cb8" class="pw-post-body-paragraph lk ll it lm b ln mi lp lq lr mj lt lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated"><strong class="lm iu"> 4。计算每个组块的短时能量:</strong></p><pre class="kg kh ki kj gt nc nd ne nf aw ng bi"><span id="6a46" class="nh kn it nd b gy ni nj l nk nl">import numpy as np<br/>s_energy = np.array([sum(abs(x[i:i + window_length] ** 2)) for i in range(0, len(x), window_length)])</span></pre><p id="475b" class="pw-post-body-paragraph lk ll it lm b ln mi lp lq lr mj lt lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">音频信号的能量或功率是指声音的响度。它是通过时域中音频信号幅度的平方和来计算的。当对整个音频信号的块计算能量时，它被称为<strong class="lm iu">短时能量</strong>。</p><p id="3c33" class="pw-post-body-paragraph lk ll it lm b ln mi lp lq lr mj lt lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">让我们画出来:</p><pre class="kg kh ki kj gt nc nd ne nf aw ng bi"><span id="2c95" class="nh kn it nd b gy ni nj l nk nl">import matplotlib.pyplot as plt<br/>plt.hist(s_energy)<br/>plt.show()</span></pre><figure class="kg kh ki kj gt ju gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/1398392a53d65a9546fb87dceeea8d5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/0*BuOKhTcCUnH6WG3A.png"/></div></figure><p id="7288" class="pw-post-body-paragraph lk ll it lm b ln mi lp lq lr mj lt lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated"><strong class="lm iu"> 5。将每个组块分类为兴奋与否(基于阈值):</strong></p><pre class="kg kh ki kj gt nc nd ne nf aw ng bi"><span id="69f2" class="nh kn it nd b gy ni nj l nk nl">import pandas as pd<br/>df = pd.DataFrame(columns=['energy', 'start', 'end'])<br/>thresh = 180<br/>row_index = 0<br/>for i in range(len(s_energy)):<br/>    value = energy[i]<br/>    if value &gt;= thresh:<br/>        i = np.where(s_energy == value)[0]<br/>        df.loc[row_index, 'energy'] = value<br/>        df.loc[row_index, 'start'] = i[0] * 10<br/>        df.loc[row_index, 'end'] = (i[0] + 1) * 10<br/>        row_index = row_index + 1</span></pre><p id="5b66" class="pw-post-body-paragraph lk ll it lm b ln mi lp lq lr mj lt lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">我正在根据能源数据创建一个数据框架。我选择的阈值是 180，你可以根据自己的选择来选择，也可以看上面的图表。然后将音频剪辑的连续时间间隔合并成一个:</p><pre class="kg kh ki kj gt nc nd ne nf aw ng bi"><span id="9e93" class="nh kn it nd b gy ni nj l nk nl">temp = []<br/>i = 0<br/>j = 0<br/>n = len(df) - 2<br/>m = len(df) - 1<br/>while (i &lt;= n):<br/>    j = i + 1<br/>    while (j &lt;= m):<br/>        if (df['end'][i] == df['start'][j]):<br/>            df.loc[i, 'end'] = df.loc[j, 'end']<br/>            temp.append(j)<br/>            j = j + 1<br/>        else:<br/>            i = j<br/>            break<br/>df.drop(temp, axis=0, inplace=True)<br/>print(df)</span></pre><p id="466e" class="pw-post-body-paragraph lk ll it lm b ln mi lp lq lr mj lt lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated"><strong class="lm iu"> 6。合并所有精彩片段，形成视频集锦</strong></p><pre class="kg kh ki kj gt nc nd ne nf aw ng bi"><span id="6697" class="nh kn it nd b gy ni nj l nk nl">start = np.array(df['start'])<br/>end = np.array(df['end'])<br/>for i in range(len(df)):<br/>    if i != 0:<br/>        start_lim = start[i] - 10<br/>    else:<br/>        start_lim = start[i]<br/>    end_lim = end[i]<br/>    filename = "highlight" + str(i + 1) + ".mp4"<br/>    ffmpeg_extract_subclip("filepath//videofile.mp4", start_lim, end_lim, targetname=filename)</span></pre><p id="ddfc" class="pw-post-body-paragraph lk ll it lm b ln mi lp lq lr mj lt lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">这段代码将根据振幅从每个块中生成突出显示，然后将这些文件保存到您的系统中。你还没有完成，你必须将所有的<strong class="lm iu"> 14 </strong>文件合并成一个文件来创建高光。</p><p id="3629" class="pw-post-body-paragraph lk ll it lm b ln mi lp lq lr mj lt lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated"><strong class="lm iu"> 7。生成最终的视频集锦</strong></p><pre class="kg kh ki kj gt nc nd ne nf aw ng bi"><span id="df01" class="nh kn it nd b gy ni nj l nk nl"># Final_joined.py</span><span id="2aa8" class="nh kn it nd b gy nm nj l nk nl">from moviepy.editor import VideoFileClip, concatenate_videoclips</span><span id="f921" class="nh kn it nd b gy nm nj l nk nl">clip1 = VideoFileClip("filename\\highlight1.mp4")<br/>clip2 = VideoFileClip("filename\\highlight2.mp4")<br/>clip3 = VideoFileClip("filename\\highlight3.mp4")<br/>clip4 = VideoFileClip("filename\\highlight5.mp4")<br/>clip5 = VideoFileClip("filename\\highlight6.mp4")<br/>clip6 = VideoFileClip("filename\\highlight7.mp4")<br/>clip7 = VideoFileClip("filename\\highlight8.mp4")<br/>clip8 = VideoFileClip("filename\\highlight9.mp4")<br/>clip9 = VideoFileClip("filename\\highlight10.mp4")<br/>clip10 = VideoFileClip("filename\\highlight11.mp4")<br/>clip11= VideoFileClip("filename\\highlight12.mp4")<br/>clip12 = VideoFileClip("filename\\highlight13.mp4")<br/>clip13= VideoFileClip("filename\\highlight14.mp4")<br/>clip14= VideoFileClip("filename\\highlight4.mp4")</span><span id="768c" class="nh kn it nd b gy nm nj l nk nl">final_clip = concatenate_videoclips([clip1,clip2,clip3,clip4,clip5,clip6,clip7,clip8,clip9,clip9,clip10,clip11,clip12,clip13,clip14])<br/>final_clip.write_videofile("filepath\\Final_Highlights.mp4")</span></pre><p id="e18d" class="pw-post-body-paragraph lk ll it lm b ln mi lp lq lr mj lt lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">我们使用 concatenate 将所有文件合并成一个文件。在此之后，将生成最终文件。</p><blockquote class="nn no np"><p id="988c" class="lk ll nb lm b ln mi lp lq lr mj lt lu nq mk lx ly nr ml mb mc ns mm mf mg mh im bi translated"><strong class="lm iu"> <em class="it">完整代码:</em></strong><a class="ae kf" href="https://bit.ly/2lE55mi" rel="noopener ugc nofollow" target="_blank"><em class="it">https://bit.ly/2lE55mi</em></a></p><p id="3e1f" class="lk ll nb lm b ln mi lp lq lr mj lt lu nq mk lx ly nr ml mb mc ns mm mf mg mh im bi translated"><em class="it">你可以在这里获得【https://bit.ly/2lDEd5V】<strong class="lm iu"><em class="it">视频演示</em></strong><em class="it">:</em><a class="ae kf" href="https://bit.ly/2lDEd5V" rel="noopener ugc nofollow" target="_blank"><em class="it"/></a></em></p><p id="0609" class="lk ll nb lm b ln mi lp lq lr mj lt lu nq mk lx ly nr ml mb mc ns mm mf mg mh im bi translated"><em class="it">如果您遇到任何错误或需要任何帮助，您可以随时在 LinkedIn 上评论或 ping 我。</em></p><p id="d459" class="lk ll nb lm b ln mi lp lq lr mj lt lu nq mk lx ly nr ml mb mc ns mm mf mg mh im bi translated"><strong class="lm iu"><em class="it">LinkedIn</em></strong><em class="it">:</em><a class="ae kf" href="https://bit.ly/2u4YPoF" rel="noopener ugc nofollow" target="_blank"><em class="it">https://bit.ly/2u4YPoF</em></a></p><p id="71fd" class="lk ll nb lm b ln mi lp lq lr mj lt lu nq mk lx ly nr ml mb mc ns mm mf mg mh im bi translated"><em class="it">参考:</em><a class="ae kf" href="https://bit.ly/2kry0tB" rel="noopener ugc nofollow" target="_blank"><em class="it">https://bit.ly/2kry0tB</em></a></p></blockquote><blockquote class="nu"><p id="2abb" class="nv nw it bd nx ny nz oa ob oc od mh dk translated"><em class="oe">我希望这有助于增强你的知识基础:】</em></p><p id="aade" class="nv nw it bd nx ny of og oh oi oj mh dk translated"><em class="oe">关注我了解更多！</em></p><p id="3001" class="nv nw it bd nx ny of og oh oi oj mh dk translated">感谢您的阅读和宝贵时间！</p></blockquote></div></div>    
</body>
</html>