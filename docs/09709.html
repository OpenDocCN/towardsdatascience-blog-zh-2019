<html>
<head>
<title>Pump it up: predict water pump condition using data science</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">泵起来:使用数据科学预测水泵状况</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/pump-it-up-predict-water-pump-condition-using-data-science-2839d26638b8?source=collection_archive---------15-----------------------#2019-12-20">https://towardsdatascience.com/pump-it-up-predict-water-pump-condition-using-data-science-2839d26638b8?source=collection_archive---------15-----------------------#2019-12-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="085f" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph"><a class="ae ep" rel="noopener" target="_blank" href="https://towardsdatascience.com/data-science-in-the-real-world/home">现实世界中的数据科学</a></h2><div class=""/><div class=""><h2 id="cb65" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">如何使用 Python 中的数据科学和机器学习来预测坦桑尼亚的水泵运行情况？</h2></div><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ko"><img src="../Images/4936222a47ade9fadfc54712f7f5dbb1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*acjGajb52gNQ1iuYGKKJjg.jpeg"/></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk">Pump image courtesy of <a class="ae la" href="https://www.flickr.com/photos/christophercjensen/3559607145" rel="noopener ugc nofollow" target="_blank">Flickr user Christopher Jensen</a></figcaption></figure><p id="a979" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated"><a class="ae la" href="https://www.drivendata.org/" rel="noopener ugc nofollow" target="_blank"> DrivenData </a>的比赛以建设一个更美好的世界为背景。<a class="ae la" href="https://www.drivendata.org/competitions/7/pump-it-up-data-mining-the-water-table/" rel="noopener ugc nofollow" target="_blank"> Pump It Up </a>着眼于确定坦桑尼亚水泵的功能。在数据方面，数据是 38 个特征的逗号分隔值(CSV)文件，目标是预测三类中的一类(功能性、非功能性、功能性需要修复)。</p><p id="9604" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">代码并不太花哨，但是提供了一个很好的基线方法，可以对其进行改进，稍后会有更多的介绍。简而言之，你将对这个过程的每一步都有所了解，并在 70 秒内获得一个<strong class="ld ja"> f1 分数</strong>！</p><p id="8c90" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">这篇文章将涵盖:</p><ol class=""><li id="a742" class="lx ly iq ld b le lf lh li lk lz lo ma ls mb lw mc md me mf bi translated">解读竞争</li><li id="1827" class="lx ly iq ld b le mg lh mh lk mi lo mj ls mk lw mc md me mf bi translated">探索性数据分析</li><li id="a19e" class="lx ly iq ld b le mg lh mh lk mi lo mj ls mk lw mc md me mf bi translated">型号选择</li><li id="84f7" class="lx ly iq ld b le mg lh mh lk mi lo mj ls mk lw mc md me mf bi translated">估价</li><li id="dc9e" class="lx ly iq ld b le mg lh mh lk mi lo mj ls mk lw mc md me mf bi translated">结论和提示</li></ol><h2 id="655a" class="ml mm iq bd mn mo mp dn mq mr ms dp mt lk mu mv mw lo mx my mz ls na nb nc iw bi translated">解读竞争</h2><p id="8782" class="pw-post-body-paragraph lb lc iq ld b le nd ka lg lh ne kd lj lk nf lm ln lo ng lq lr ls nh lu lv lw ij bi translated">数据集的大小是合理的——59，400 个条目，所以我们不应该觉得有义务在我们的模型中使用所有 38 个特征！</p><p id="0f89" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated"><a class="ae la" href="https://scikit-learn.org/stable/modules/generated/sklearn.metrics.f1_score.html" rel="noopener ugc nofollow" target="_blank"> F1 得分</a>是评估一项技术表现如何的指标。这在数据不平衡时特别有用，因为类不是均匀分布的。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="nj nk di nl bf nm"><div class="gh gi ni"><img src="../Images/22f4b35f81f0aa32234824754fa72f5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hKgdHeMFIBn4hr7RHATJ1g.png"/></div></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk">A table indicating the data imbalance in the training set.</figcaption></figure><p id="9ae4" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">F1 分数是一个调和平均值，考虑了精确度和召回率。数学上，它看起来像这样:</p><p id="0b90" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">Precision 询问我们的模型在预测正面事件时的正确率，即:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/b43fae61b876ed991bfcd2aaedef79af.png" data-original-src="https://miro.medium.com/v2/resize:fit:780/format:webp/1*Rl7zZ49HEft8DnTCDtMkOA.png"/></div></figure><p id="95a5" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">另一方面，回忆询问我们的模型对积极事件的预测有多好:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi no"><img src="../Images/cbbbbfd56a96261d3ad67840e3c81656.png" data-original-src="https://miro.medium.com/v2/resize:fit:738/format:webp/1*F6mbrkIvYP5IBik0TIHCuA.png"/></div></figure><p id="41fc" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">F1 分数结合了这两个指标，如下所示:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi np"><img src="../Images/dc4b311b5138a1a10f6d4155aa9e2ddf.png" data-original-src="https://miro.medium.com/v2/resize:fit:426/format:webp/1*C_8UDP89JnM1r7vl_QLXLw.png"/></div></figure><h2 id="ab02" class="ml mm iq bd mn mo mp dn mq mr ms dp mt lk mu mv mw lo mx my mz ls na nb nc iw bi translated">探索性数据分析</h2><p id="cb39" class="pw-post-body-paragraph lb lc iq ld b le nd ka lg lh ne kd lj lk nf lm ln lo ng lq lr ls nh lu lv lw ij bi translated">我们已经看到了明显的阶级不平衡，但是我们现有的信息类型呢？当我们将它输入到模型中时，我们如何确保它得到适当的处理？</p><p id="4a1d" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">哪些栏目是多余的？现在，让我们忽略</p><pre class="kp kq kr ks gt nq nr ns nt aw nu bi"><span id="6165" class="ml mm iq nr b gy nv nw l nx ny">‘date_recorded’, ‘gps_height’, ‘longitude’, ‘latitude’, ‘wpt_name’, ‘num_private’, ‘subvillage’, ‘lga’,’ward’, ‘recorded_by’, ‘extraction_type_group’, ‘extraction_type’, ‘scheme_name’, ‘management’, ‘waterpoint_type_group’, ‘source’, ‘source_class’, ‘quantity_group’, ‘quality_group’, ‘payment_type’</span></pre><p id="764d" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">这给我们留下了剩余的 19 个特征:</p><ul class=""><li id="dfeb" class="lx ly iq ld b le lf lh li lk lz lo ma ls mb lw nz md me mf bi translated">amount_tsh —总静压头(水点可用的水量</li><li id="b3d6" class="lx ly iq ld b le mg lh mh lk mi lo mj ls mk lw nz md me mf bi translated">出资人——谁为油井出资</li><li id="6363" class="lx ly iq ld b le mg lh mh lk mi lo mj ls mk lw nz md me mf bi translated">安装者——安装油井的组织</li><li id="f534" class="lx ly iq ld b le mg lh mh lk mi lo mj ls mk lw nz md me mf bi translated">区域—地理位置</li><li id="075d" class="lx ly iq ld b le mg lh mh lk mi lo mj ls mk lw nz md me mf bi translated">区域代码-地理位置(编码)</li><li id="7685" class="lx ly iq ld b le mg lh mh lk mi lo mj ls mk lw nz md me mf bi translated">地区代码—地理位置(编码)</li><li id="fed4" class="lx ly iq ld b le mg lh mh lk mi lo mj ls mk lw nz md me mf bi translated">人口—油井周围的人口</li><li id="0ed9" class="lx ly iq ld b le mg lh mh lk mi lo mj ls mk lw nz md me mf bi translated">公开会议—对/错</li><li id="bb27" class="lx ly iq ld b le mg lh mh lk mi lo mj ls mk lw nz md me mf bi translated">scheme _ management——谁在运营供水点</li><li id="a00c" class="lx ly iq ld b le mg lh mh lk mi lo mj ls mk lw nz md me mf bi translated">允许—如果水点是允许的</li><li id="9a48" class="lx ly iq ld b le mg lh mh lk mi lo mj ls mk lw nz md me mf bi translated">建造年份——供水点建造的年份</li><li id="1c2c" class="lx ly iq ld b le mg lh mh lk mi lo mj ls mk lw nz md me mf bi translated">construction _ type 水点使用的提取类型</li><li id="e045" class="lx ly iq ld b le mg lh mh lk mi lo mj ls mk lw nz md me mf bi translated">construction _ type _ group 水点使用的提取类型</li><li id="7f32" class="lx ly iq ld b le mg lh mh lk mi lo mj ls mk lw nz md me mf bi translated">construction _ type _ class 水点使用的提取类型</li><li id="409e" class="lx ly iq ld b le mg lh mh lk mi lo mj ls mk lw nz md me mf bi translated">管理组—如何管理水点</li><li id="ac1c" class="lx ly iq ld b le mg lh mh lk mi lo mj ls mk lw nz md me mf bi translated">付款——水的价格</li><li id="9168" class="lx ly iq ld b le mg lh mh lk mi lo mj ls mk lw nz md me mf bi translated">水质——水的质量</li><li id="bd0b" class="lx ly iq ld b le mg lh mh lk mi lo mj ls mk lw nz md me mf bi translated">数量——水的数量</li><li id="0a55" class="lx ly iq ld b le mg lh mh lk mi lo mj ls mk lw nz md me mf bi translated">水点类型—水点的种类</li></ul><p id="231a" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">接下来，任何包含类似字符串/单词的信息的列都需要更改为数值，我们必须确保没有隐含的邻近性。为了实现这一点，我们使用了一个叫做一次热编码的过程。这将一列中所有不同的可能值(n)展开为 n 列，用 1 或 0 表示是否满足特定值。例如，quantity 列有五个可能的值:干旱、足够、不足、季节性和未知。一次热编码前后该特性的快照如下所示:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="nj nk di nl bf nm"><div class="gh gi oa"><img src="../Images/d5a9a4340245298cbe204006046f6856.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1D2f_8bYAqFBag4N8Xwfrw.png"/></div></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk">A table showing how the quantity column is transformed through one-hot-encoding.</figcaption></figure><p id="093b" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">funder 和 installer 列有大量的唯一值，因此我们可以使用一个函数将这些列扩展到前 n 个值(将 n 指定为函数中的一个参数)。不在这些值范围内的任何值都被标记为其他。这允许我们减少通过任何模型输入的列数，同时仍然表示大量的数据。</p><p id="9d97" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">最后，状态组的标签需要改为数值，以便模型理解输入。将它们转换成有序类还是一次性编码，这是一个很难决定的问题。在这种情况下，我们使用的模型预期有一列，所以我们用序数转换来凑合，但是在某些情况下，这种隐含的接近性可能不合适。</p><p id="6540" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">这些步骤通过下面的函数进行总结。通过创建一个函数，我们可以调用它并使它适应任何版本的数据。状态组标签到数值的转换应该单独进行，因为这些仅针对训练数据。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ob oc l"/></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk">Code for data pre-processing.</figcaption></figure><h2 id="47d2" class="ml mm iq bd mn mo mp dn mq mr ms dp mt lk mu mv mw lo mx my mz ls na nb nc iw bi translated">型号选择</h2><p id="d0c1" class="pw-post-body-paragraph lb lc iq ld b le nd ka lg lh ne kd lj lk nf lm ln lo ng lq lr ls nh lu lv lw ij bi translated">当考虑使用哪个模型时，我们首先缩小到适合分类而不是回归问题的模型。在这种情况下，我们尝试六种不同的方法。</p><ul class=""><li id="92de" class="lx ly iq ld b le lf lh li lk lz lo ma ls mb lw nz md me mf bi translated">随机森林是一系列决策树，其中的叶节点表示预测的类别。</li><li id="6f24" class="lx ly iq ld b le mg lh mh lk mi lo mj ls mk lw nz md me mf bi translated">XGBoost 是一种复杂的决策树算法，它使用梯度推进(通过查看变化率来最小化误差)。</li><li id="d517" class="lx ly iq ld b le mg lh mh lk mi lo mj ls mk lw nz md me mf bi translated">决策树使用整个数据集为每个特征创建决策过程。</li><li id="43c6" class="lx ly iq ld b le mg lh mh lk mi lo mj ls mk lw nz md me mf bi translated">k-最近邻查找与当前数据点最近的 k 个数据点，并采用多数分类。</li><li id="9dcb" class="lx ly iq ld b le mg lh mh lk mi lo mj ls mk lw nz md me mf bi translated">支持向量机将创建平面作为区分类别的边界，试图最大化类别之间的距离。</li><li id="a9d1" class="lx ly iq ld b le mg lh mh lk mi lo mj ls mk lw nz md me mf bi translated">逻辑回归也创建了决策边界，但却最小化了对数似然函数。</li></ul><p id="d163" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">实现模型相对容易，导入相关的类，然后输入数据，接受初始探索的默认参数。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ob oc l"/></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk">Code for model implementation.</figcaption></figure><h2 id="5543" class="ml mm iq bd mn mo mp dn mq mr ms dp mt lk mu mv mw lo mx my mz ls na nb nc iw bi translated">估价</h2><p id="04c1" class="pw-post-body-paragraph lb lc iq ld b le nd ka lg lh ne kd lj lk nf lm ln lo ng lq lr ls nh lu lv lw ij bi translated">为了评估模型性能，我们留出了训练数据的子集，称为验证集。这使我们能够预测这部分数据的类别，并直接将预测结果与已知类别进行比较。对于每个模型，我们可以打印分类报告，该报告为我们提供分类指标，包括精确度、召回率、F1 分数和准确度。我们在验证集上实现了这一点，使用下面这条线比较真实标签和预测标签</p><pre class="kp kq kr ks gt nq nr ns nt aw nu bi"><span id="b16c" class="ml mm iq nr b gy nv nw l nx ny">print(classification_report(y_test,clf.predict(X_test)))</span></pre><p id="c203" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">如前所述，在这种情况下，由于数据不平衡，准确性不是一个合适的指标，因此我们使用 F1 得分。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi od"><img src="../Images/632152953c90e54a1df9fd1ae1bf4dc7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*HWpQaG4Mhc54dTGnkab3dA.png"/></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk">Graph showing the respective metrics for each type of model (0–1).</figcaption></figure><p id="d3f0" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">评估模型时的另一个考虑因素是运行时间。这与计算步骤成比例，并导致性能和速度之间的折衷。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi od"><img src="../Images/cab6de6ba5d0bc43fce0fb6565c14678.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*L_a0S6kx84AK9BDJcWUxhw.png"/></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk">Graph showing the respective run times for each type of model in seconds.</figcaption></figure><p id="68a9" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">考虑到图形的组合结果，在给定训练数据的情况下，使用随机森林或决策树似乎是最合适的。但是，当模型预测测试数据的结果时，结果可能会有所不同。</p><h2 id="01af" class="ml mm iq bd mn mo mp dn mq mr ms dp mt lk mu mv mw lo mx my mz ls na nb nc iw bi translated">结论和提示</h2><p id="aabf" class="pw-post-body-paragraph lb lc iq ld b le nd ka lg lh ne kd lj lk nf lm ln lo ng lq lr ls nh lu lv lw ij bi translated">对于这种应对挑战的方法，随机森林和决策树模型表现最佳，但是，通过超参数调整(查看设置每个模型的参数)，所有模型都可以表现得更好。这个项目的所有代码和数据可以在<a class="ae la" href="https://github.com/shiaoligreen/practical-data-science/tree/master/Pump%20it%20Up%20-%20Data%20Mining%20the%20Water%20Table" rel="noopener ugc nofollow" target="_blank">这个 GitHub 文件夹</a>中找到。</p><ul class=""><li id="926c" class="lx ly iq ld b le lf lh li lk lz lo ma ls mb lw nz md me mf bi translated">不要觉得必须使用数据集中给定的所有特征/变量。</li><li id="c76e" class="lx ly iq ld b le mg lh mh lk mi lo mj ls mk lw nz md me mf bi translated">尝试几种不同的型号。</li><li id="c8b4" class="lx ly iq ld b le mg lh mh lk mi lo mj ls mk lw nz md me mf bi translated">考虑哪种指标最适合评估模型。</li><li id="bf8a" class="lx ly iq ld b le mg lh mh lk mi lo mj ls mk lw nz md me mf bi translated">一旦你完成了一些初步的探索，通过创建函数来优化代码结构。</li></ul><p id="79e8" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">直到下一次…随时与我分享任何意见/问题！</p><h2 id="5a1f" class="ml mm iq bd mn mo mp dn mq mr ms dp mt lk mu mv mw lo mx my mz ls na nb nc iw bi translated">参考</h2><p id="907c" class="pw-post-body-paragraph lb lc iq ld b le nd ka lg lh ne kd lj lk nf lm ln lo ng lq lr ls nh lu lv lw ij bi translated">DrivenData。(未注明)。抽水:地下水位的数据挖掘。检索自<a class="ae la" href="https://www.drivendata.org/competitions/7/pump-it-up-data-mining-the-water-table/" rel="noopener ugc nofollow" target="_blank">https://www . driven data . org/competitions/7/pump-it-up-data-mining-the-water-table/</a></p><p id="8bba" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">达尔，奥，埃纳霍罗，p，格林，s .，&amp;斯塔克，A. (2019，10 月)。冲刺二队一队。从 https://github.com/shiaoligreen/practical-data-science<a class="ae la" href="https://github.com/shiaoligreen/practical-data-science" rel="noopener ugc nofollow" target="_blank">取回</a></p></div></div>    
</body>
</html>