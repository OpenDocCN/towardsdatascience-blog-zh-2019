<html>
<head>
<title>Quick and Dirty Data Gathering with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Python 快速收集脏数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/quick-and-dirty-data-gathering-with-python-9d3d4b8cba13?source=collection_archive---------22-----------------------#2019-04-10">https://towardsdatascience.com/quick-and-dirty-data-gathering-with-python-9d3d4b8cba13?source=collection_archive---------22-----------------------#2019-04-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/7c8b02dc720b95381ca19602e7b39e38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*PO7-yGtdcm4UMtnosDMO1A.jpeg"/></div></figure><p id="261f" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">前几天我去杂货店的时候，简直不敢相信自己的眼睛。另一家星巴克似乎一夜之间就在我家附近的街区开张了。还有…这家新的星巴克是<strong class="jw ir"> <em class="ks">字面意思是</em> </strong>就在两个街区之间，每个街区都有他们自己的星巴克！</p><p id="3680" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">以新星巴克不断涌现的速度，我发现自己在想:<strong class="jw ir"> <em class="ks">“洛杉矶县会有多少家星巴克？”</em>T9】</strong></p><p id="89f8" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">快速的谷歌搜索并没有给我想要的东西。要么结果只是在洛杉矶市(而不是整个县)，要么估计值已经过时 5 年以上。我知道我必须做什么:<strong class="jw ir">自己收集数据！</strong></p><p id="2910" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我决定从访问<a class="ae kt" href="https://www.starbucks.com/store-locator?map=39.635307,-101.337891,5z" rel="noopener ugc nofollow" target="_blank">星巴克商店定位器</a>开始，希望它能给我需要的信息。</p><figure class="kv kw kx ky gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="gh gi ku"><img src="../Images/68b2159f22a13e0068274154e6164daa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dzUIAKAmyY8iJCAK1isjlA.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk">Starbucks Store Locator</figcaption></figure><p id="f6c3" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">我得到了… <em class="ks">有点儿</em> …我想要的。我发现，通过在搜索栏中键入邮政编码，我得到了以该邮政编码为中心的 100 家星巴克商店的列表。</p><p id="ffe6" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">通过查看页面顶部的 URL，我发现可以使用哪个<strong class="jw ir"> API 调用</strong>(发送到星巴克网站的命令的别称)来访问以邮政编码 90815 为中心的 100 家商店的列表:</p><blockquote class="lh"><p id="9504" class="li lj iq bd lk ll lm ln lo lp lq kr dk translated"><strong class="ak">https://www.starbucks.com/store-locator?place=90815</strong></p></blockquote><p id="12d0" class="pw-post-body-paragraph ju jv iq jw b jx lr jz ka kb ls kd ke kf lt kh ki kj lu kl km kn lv kp kq kr ij bi translated">基于此，我想出了一个如何获取洛杉矶县所有星巴克门店信息的计划:</p><blockquote class="lw lx ly"><p id="5f6e" class="ju jv ks jw b jx jy jz ka kb kc kd ke lz kg kh ki ma kk kl km mb ko kp kq kr ij bi translated"><strong class="jw ir"> <em class="iq"> 1。</em> </strong> <em class="iq">获取洛杉矶所有邮政编码的列表</em></p><p id="f384" class="ju jv ks jw b jx jy jz ka kb kc kd ke lz kg kh ki ma kk kl km mb ko kp kq kr ij bi translated"><strong class="jw ir">T29】2。 </strong> <em class="iq">对于每个邮政编码，调用上面的 API 并解析返回的 100 家星巴克门店</em></p><p id="ed26" class="ju jv ks jw b jx jy jz ka kb kc kd ke lz kg kh ki ma kk kl km mb ko kp kq kr ij bi translated"><strong class="jw ir"> <em class="iq"> 3。</em> </strong> <em class="iq">从存储的大列表中删除重复项(因为一个 API 调用和下一个 API 调用之间可能有很多重叠)</em></p><p id="96c3" class="ju jv ks jw b jx jy jz ka kb kc kd ke lz kg kh ki ma kk kl km mb ko kp kq kr ij bi translated"><strong class="jw ir"> <em class="iq"> 4。</em> </strong> <em class="iq">删除所有不在洛杉矶县的商店(因为有些邮政编码就在洛杉矶县的边界上，可能包括邻近县的商店)</em></p></blockquote><p id="70a7" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">听起来合理吗？<strong class="jw ir">我们开始吧！</strong></p><p id="1102" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">首先，我想提供这个项目需要的 Python 库列表:</p><figure class="kv kw kx ky gt jr"><div class="bz fp l di"><div class="mc md l"/></div></figure><h1 id="4488" class="me mf iq bd mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb bi translated">获取洛杉矶县所有邮编的列表</h1><p id="3624" class="pw-post-body-paragraph ju jv iq jw b jx nc jz ka kb nd kd ke kf ne kh ki kj nf kl km kn ng kp kq kr ij bi translated">这个很简单，你可以从很多不同的来源得到这个列表。我选择了直接从县里拿<a class="ae kt" href="http://file.lacounty.gov/SDSInter/lac/1031552_MasterZipCodes.pdf" rel="noopener ugc nofollow" target="_blank">。我将这些邮政编码(每行一个)加载到一个名为<em class="ks"> laZips.txt </em>的文本文件中。</a></p><h1 id="6a8d" class="me mf iq bd mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb bi translated">为每个邮政编码调用 API</h1><p id="2b76" class="pw-post-body-paragraph ju jv iq jw b jx nc jz ka kb nd kd ke kf ne kh ki kj nf kl km kn ng kp kq kr ij bi translated">接下来，我们要为我们收集的每个邮政编码调用 Starbucks Store Locator API:</p><figure class="kv kw kx ky gt jr"><div class="bz fp l di"><div class="mc md l"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk">Scraping all Starbucks stores in LA County</figcaption></figure><p id="9d53" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">您可能已经注意到了神奇的'<em class="ks"> processResponse </em>'函数，它获取星巴克返回的内容，并将该文本转换成 100 家商店中每一家的信息。实际上，这只是一堆文本处理，我鼓励您查看完整的代码。</p><p id="1a9d" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">此时，变量<em class="ks"> allStores </em>是一个商店信息列表，每个信息看起来像这样:</p><figure class="kv kw kx ky gt jr"><div class="bz fp l di"><div class="mc md l"/></div></figure><h1 id="02c1" class="me mf iq bd mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb bi translated">删除重复的商店</h1><p id="bf2f" class="pw-post-body-paragraph ju jv iq jw b jx nc jz ka kb nd kd ke kf ne kh ki kj nf kl km kn ng kp kq kr ij bi translated">一个问题是，我们的星巴克门店主列表<em class="ks"> allStores </em>，将包含(可能很多)重复的门店。</p><p id="f624" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">没什么大不了的！让我们遍历并删除已经遇到商店 id 的所有商店。</p><figure class="kv kw kx ky gt jr"><div class="bz fp l di"><div class="mc md l"/></div></figure><p id="aed4" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">此时，变量<em class="ks"> laStores </em>不包含重复的商店。</p><h1 id="7b55" class="me mf iq bd mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb bi translated">移除洛杉矶县以外的商店</h1><p id="5dff" class="pw-post-body-paragraph ju jv iq jw b jx nc jz ka kb nd kd ke kf ne kh ki kj nf kl km kn ng kp kq kr ij bi translated">我们的名单还有一个问题。邮政编码可能在洛杉矶县的郊区，因此以该邮政编码为中心的 100 家星巴克店将包括邻近县的店。我们如何解决这个问题？</p><p id="f0be" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">一种选择是在我们的商店信息中使用'<em class="ks"> City' </em>字段，并将其与我们收集的洛杉矶县的一些城市列表进行匹配。这可能行得通，但我担心在我们的数据和我们从网上获取的城市名称列表之间会有轻微的差异。</p><p id="2e7c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">让我们用一种更直接的方法。也就是说，我们将使用洛杉矶县的 geojson 文件(基本上是一个 json 文件，它精确地定义了一个复杂的形状，如洛杉矶县)。我会把这个文件贴在我的 GitHub 上。</p><p id="5a02" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">在进行数据清理之前，让我们制作一张地图，以确保我们确实需要担心洛杉矶县以外的商店。</p><figure class="kv kw kx ky gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="gh gi nh"><img src="../Images/0c2dd02b3804afaa14fdba3f5a99eebc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7mr0Vs-YUjdUmLe8LRsRIQ.png"/></div></div></figure><p id="8662" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">是的</strong> …很明显，我们在洛杉矶县(以蓝色突出显示)之外有商店。让我们摆脱他们！</p><figure class="kv kw kx ky gt jr"><div class="bz fp l di"><div class="mc md l"/></div></figure><p id="df4b" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">让我们使用<em class="ks"> keepLAStores </em>重新生成地图:</p><figure class="kv kw kx ky gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="gh gi ni"><img src="../Images/0cb46af4dcfc847fc6951c64de907cee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HP9mjURtjLKXj9qa7tTELA.png"/></div></div></figure><p id="aa3c" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">耶！<strong class="jw ir">问题修复。</strong></p><p id="b560" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">(我很快会写一篇关于如何创建这样的地图的教程！)</p><p id="d929" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">咻！现在我们已经完成了所有工作，让我们将数据存储在一个 csv 中，以备将来再次使用:</p><figure class="kv kw kx ky gt jr"><div class="bz fp l di"><div class="mc md l"/></div></figure><p id="6604" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">那么…洛杉矶有多少家星巴克？</p><p id="c477" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">728。</p><p id="a8d6" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated">本项目中使用的所有代码和必要文件都可以在<a class="ae kt" href="https://github.com/ritvikmath/StarbucksStoreScraping" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="6e6a" class="pw-post-body-paragraph ju jv iq jw b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ij bi translated"><strong class="jw ir">快乐的数据采集！</strong></p></div></div>    
</body>
</html>