<html>
<head>
<title>Data Science Code Refactoring Example</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">数据科学代码重构示例</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/data-science-code-refactoring-example-14c3ec858e0c?source=collection_archive---------13-----------------------#2019-03-10">https://towardsdatascience.com/data-science-code-refactoring-example-14c3ec858e0c?source=collection_archive---------13-----------------------#2019-03-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="b6f5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当学习为数据科学编码时，我们通常不会考虑修改我们的代码以在性能方面获得特定的好处。我们编码来修改我们的数据，产生可视化，并构建我们的 ML 模型。但是，如果你的代码将被用于仪表板或应用程序，我们必须考虑我们的代码是否是最佳的。在这个代码示例中，我们将针对速度对 ecdf 函数做一个小的修改。</p><p id="63d1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="ko">如果你不确定 ecdf 是什么，你可以查看我的</em> <a class="ae kp" rel="noopener" target="_blank" href="/what-why-and-how-to-read-empirical-cdf-123e2b922480"> <em class="ko">博客文章</em> </a> <em class="ko">了解更多详情。为了方便起见，这里有一个快速的可视化示例。</em></p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div class="gh gi kq"><img src="../Images/5baf8ba242f8c41a261616044e735a7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1088/format:webp/1*H0KK017XSbkVS7gcfrQSRA.png"/></div><figcaption class="ky kz gj gh gi la lb bd b be z dk">Ecdf Plot made the function we will make below.</figcaption></figure><p id="f3e6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="ko">我们将用于绘制上述 ecdf 函数的数据是关于 2015 年至 2018 年</em> <a class="ae kp" href="https://data.world/makeovermonday/2018w40-avocado-prices" rel="noopener ugc nofollow" target="_blank"> <em class="ko">鳄梨价格</em> </a> <em class="ko">的数据。</em></p><h1 id="563f" class="lc ld it bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">等等，到底什么是代码重构？</h1><p id="d683" class="pw-post-body-paragraph jq jr it js b jt ma jv jw jx mb jz ka kb mc kd ke kf md kh ki kj me kl km kn im bi translated">代码重构是对代码进行修改，以提高其可读性和性能。对于性能部分，这意味着您必须调整代码，以减少内存使用或缩短运行时间。</p><p id="77ee" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">首先，让我们完成导入和数据加载。</p><pre class="kr ks kt ku gt mf mg mh mi aw mj bi"><span id="5580" class="mk ld it mg b gy ml mm l mn mo"><em class="ko"># Load Libraries</em><br/>import pandas as pd<br/>import numpy as np<br/>import matplotlib.pyplot as plt<br/>import seaborn as sns<br/>import time</span><span id="4540" class="mk ld it mg b gy mp mm l mn mo"><em class="ko"># Load the data from data.world</em><br/>avocado = pd.read_csv('https://query.data.world/s/qou5hvocejsu4qt4qb2xlndg5ntzbm')</span></pre><p id="01e9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Seaborn 更喜欢这里。当我在 jupyter 笔记本上创建情节时，我使用 seaborn 来设置情节背景。</p><p id="1bb1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在我们的导入和数据已经设置好了，让我们来看看我们的 ecdf 绘图功能。</p><pre class="kr ks kt ku gt mf mg mh mi aw mj bi"><span id="89b8" class="mk ld it mg b gy ml mm l mn mo"><em class="ko"># Create a function for computing and plotting the ECDF with default parameters</em><br/>def plot_ecdf(data, title='ECDF Plot', xlabel='Data Values', ylabel='Percentage'):<br/>    <br/>    <em class="ko">""" </em><br/><em class="ko">    Function to plot ecdf taking a column of data as input.</em><br/><em class="ko">    """</em><br/>    xaxis = np.sort(data)<br/>    yaxis = np.arange(1, len(data)+1)/len(data)<br/>    plt.plot(xaxis,yaxis,linestyle='none',marker='.')<br/>    plt.title(title)<br/>    plt.xlabel(xlabel)<br/>    plt.ylabel(ylabel)<br/>    plt.margins(0.02)</span></pre><p id="626c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">对于速度重构，我们将关注于定义<code class="fe mq mr ms mg b">yaxis</code>的地方。</p><pre class="kr ks kt ku gt mf mg mh mi aw mj bi"><span id="dd6d" class="mk ld it mg b gy ml mm l mn mo">yaxis = np.arange(1, len(data)+1)/len(data)</span></pre><p id="4256" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">注意，我们调用了两次<code class="fe mq mr ms mg b">len()</code>来构造<code class="fe mq mr ms mg b">yaxis</code>。这导致运行时间不必要的增加。为了解决这个问题，我们将把我们的<code class="fe mq mr ms mg b">yaxis</code>代码重构如下:</p><pre class="kr ks kt ku gt mf mg mh mi aw mj bi"><span id="d9b4" class="mk ld it mg b gy ml mm l mn mo">length = len(data)<br/>yaxis = np.arange(1,length+1)/length</span></pre><p id="0a4a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在上面的代码中:</p><ol class=""><li id="8b43" class="mt mu it js b jt ju jx jy kb mv kf mw kj mx kn my mz na nb bi translated">我们分配变量<code class="fe mq mr ms mg b">length</code>来保存数据长度值。</li><li id="48c5" class="mt mu it js b jt nc jx nd kb ne kf nf kj ng kn my mz na nb bi translated">用我们预先定义的变量<code class="fe mq mr ms mg b">length</code>替换了对<code class="fe mq mr ms mg b">len()</code>的调用。</li></ol><p id="d040" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在来看看这些变化后我们的功能:</p><pre class="kr ks kt ku gt mf mg mh mi aw mj bi"><span id="d9c5" class="mk ld it mg b gy ml mm l mn mo"># ECDF plot function with modifications<br/>def plot_ecdf_vtwo(data, title='ECDF Plot', xlabel='Data Values', ylabel='Percentage'):<br/>    <br/>    <em class="ko">""" </em><br/><em class="ko">    Function to plot ecdf taking a column of data as input.</em><br/><em class="ko">    """</em><br/>    xaxis = np.sort(data)<br/>    length = len(data)<br/>    yaxis = np.arange(1,length+1)/length<br/>    plt.plot(xaxis,yaxis,linestyle='none',marker='.')<br/>    plt.title(title)<br/>    plt.xlabel(xlabel)<br/>    plt.ylabel(ylabel)<br/>    plt.margins(0.02)</span></pre><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="ni nj di nk bf nl"><div class="gh gi nh"><img src="../Images/8af2b53588594550c07018f69c707876.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*USy9WNhYvT6-VJER.jpg"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk">Pic from <a class="ae kp" href="https://www.flickr.com/photos/83633410@N07/7658225516" rel="noopener ugc nofollow" target="_blank">CollegeDegrees360 </a>on Flickr</figcaption></figure><h1 id="9e01" class="lc ld it bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">但是现在我们有了另一行代码！这如何改进我们的运行时间？</h1><p id="b267" class="pw-post-body-paragraph jq jr it js b jt ma jv jw jx mb jz ka kb mc kd ke kf md kh ki kj me kl km kn im bi translated">是的，我们确实使用了另一行代码。它也比我们上一个版本的函数使用了更多的内存。但是现在我们的函数会比以前更快地生成一个图。为了确定改进，我们为此引入了<code class="fe mq mr ms mg b">time</code>模块。让我们来看看。</p><pre class="kr ks kt ku gt mf mg mh mi aw mj bi"><span id="f5f4" class="mk ld it mg b gy ml mm l mn mo"># Generating Run Time of plot_ecdf<br/>start1 = time.time()<br/>plot_ecdf(avocado['AveragePrice'])<br/>end1 = time.time()<br/>diff1 = end1-start1<br/>print(diff1)</span><span id="cc41" class="mk ld it mg b gy mp mm l mn mo">0.04869723320007324</span></pre><p id="4f99" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">所以第一个版本的时钟大约是百分之五秒。现在来看看我们的重构版本是否真的有所改进。</p><pre class="kr ks kt ku gt mf mg mh mi aw mj bi"><span id="48a1" class="mk ld it mg b gy ml mm l mn mo"># Generating Run Time of plot_ecdf_vtwo<br/>start2 = time.time()<br/>plot_ecdf_vtwo(avocado['AveragePrice'])<br/>end2 = time.time()<br/>diff2 = end2-start2<br/>print(diff2)</span><span id="964b" class="mk ld it mg b gy mp mm l mn mo">0.019404888153076172</span></pre><p id="e430" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">太好了！我们将绘图函数的运行时间提高了大约百分之二秒！</p><h1 id="8e7a" class="lc ld it bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">那么，从长远来看，这有什么好处呢？</h1><p id="75f8" class="pw-post-body-paragraph jq jr it js b jt ma jv jw jx mb jz ka kb mc kd ke kf md kh ki kj me kl km kn im bi translated">假设这是一个进入仪表板的绘图函数。你为你的雇主制作的仪表板。</p><p id="0c4f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果这是一个应用程序中的 ML 模型的函数呢？</p><p id="45a2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在这两种情况下，更快的运行时间非常重要。</p><p id="f19b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">百分之一秒可能看起来不多。但是，如果您考虑该功能的使用量，那么您可以为仪表板或应用程序的用户节省大量时间。它会让你的产品对他们来说快如闪电。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="ni nj di nk bf nl"><div class="gh gi nm"><img src="../Images/eebe9fda629561d1f60c8b20d8c29e98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ed58JY7TMG9hPhI_.jpg"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk">Pic from <a class="ae kp" href="https://www.goodfreephotos.com/finland/other-finland/lightning-across-the-sky-over-the-water.jpg.php" rel="noopener ugc nofollow" target="_blank">GoodFreePhotos</a></figcaption></figure><h1 id="a0dd" class="lc ld it bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">酷！怎样才能学到更多的代码重构？</h1><ol class=""><li id="0250" class="mt mu it js b jt ma jx mb kb nn kf no kj np kn my mz na nb bi translated">如果你需要更多的例子，看看这个由<a class="ae kp" href="https://pybit.es/" rel="noopener ugc nofollow" target="_blank">的<a class="ae kp" href="https://twitter.com/_juliansequeira?lang=en" rel="noopener ugc nofollow" target="_blank">Julian Sequeria</a>py bites</a>写的<a class="ae kp" href="https://pybit.es/refactoring.html" rel="noopener ugc nofollow" target="_blank">牛逼博客帖子</a>。</li><li id="1130" class="mt mu it js b jt nc jx nd kb ne kf nf kj ng kn my mz na nb bi translated">从旧项目中回顾你自己的代码。找到一些不止一次使用函数的代码。然后尝试重构代码，使函数只被调用一次。</li><li id="6653" class="mt mu it js b jt nc jx nd kb ne kf nf kj ng kn my mz na nb bi translated">如果你想看我口头讲述同样的例子，你可以看看这篇文章的 youtube 视频短片<a class="ae kp" href="https://www.youtube.com/watch?v=zIakz2_b1Lc&amp;t=1s" rel="noopener ugc nofollow" target="_blank">。这是这篇文章和视频的笔记本</a><a class="ae kp" href="https://github.com/JohnDeJesus22/YoutubeTutorials/blob/master/Data%20Science%20Code%20Refactoring%20Example.ipynb" rel="noopener ugc nofollow" target="_blank">和</a>。</li></ol><h1 id="6cb0" class="lc ld it bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">在我们走之前大声喊出来。</h1><p id="806c" class="pw-post-body-paragraph jq jr it js b jt ma jv jw jx mb jz ka kb mc kd ke kf md kh ki kj me kl km kn im bi translated">Tony Fischetti 是纽约公共图书馆的数据科学家。他是我在数据科学领域的第一位导师。是他让我更加意识到代码重构。</p><p id="87a1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">感谢阅读！希望你喜欢这个代码重构的例子，并考虑重构你的代码。你认为你将重构哪些代码？</p><p id="6d57" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你喜欢在媒体上阅读，并愿意进一步支持我，你可以使用我的<a class="ae kp" href="https://medium.com/@j.dejesus22/membership" rel="noopener">推荐链接</a>注册一个媒体会员。这样做可以用你的会费的一部分在经济上支持我，我将不胜感激。</p><p id="560f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">直到下一次，</p><p id="b7e9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">约翰·德杰苏斯</p></div></div>    
</body>
</html>