<html>
<head>
<title>Predicting Taxi fares in NYC using Google Cloud AI Platform (Billion + rows) Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用谷歌云人工智能平台预测纽约市的出租车价格(十亿多行)第 2 部分</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/predicting-taxi-fares-in-nyc-using-google-cloud-ai-platform-billion-rows-part-2-f0191a70dea8?source=collection_archive---------32-----------------------#2019-10-24">https://towardsdatascience.com/predicting-taxi-fares-in-nyc-using-google-cloud-ai-platform-billion-rows-part-2-f0191a70dea8?source=collection_archive---------32-----------------------#2019-10-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/a90267aebfb44e2d8fbb0416422bd893.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uFxKE52I3Y4Ym12GCJGSnw.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Taxis | Photo by Life of Pix on <a class="ae kc" href="https://www.pexels.com/photo/new-york-street-cabs-taxis-8247/" rel="noopener ugc nofollow" target="_blank">pexels.com</a></figcaption></figure><p id="9625" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这一系列文章中，我们正在处理一个真实世界的纽约出租车乘坐数据集，该数据集托管在 BigQuery 中，以便能够估计车费金额。</p><p id="6cf6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<a class="ae kc" rel="noopener" target="_blank" href="/predicting-taxi-fares-in-nyc-using-google-cloud-ai-platform-billion-rows-part-1-ac121832babf">上一篇</a>中，我们在 Google 云平台上建立了一个项目，启动了一个预装 TensorFlow 的 AI 笔记本实例，并准备/清理/采样了数据。现在到了我们建立一个模型来预测目标变量的部分。</p><p id="dfe2" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将使用<strong class="kf ir"> tf.estimator </strong>，一个高级 TensorFlow API 来构建我们的模型。详细信息可以在这里<a class="ae kc" href="http://www.tensorflow.org" rel="noopener ugc nofollow" target="_blank">找到。</a></p><p id="2ebd" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用这个 API 有四个主要步骤。</p><ul class=""><li id="1c46" class="lb lc iq kf b kg kh kk kl ko ld ks le kw lf la lg lh li lj bi translated">创建一个函数来导入数据集</li><li id="43d3" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated">定义特征列</li><li id="d8e6" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated">实例化评估者</li><li id="1390" class="lb lc iq kf b kg lk kk ll ko lm ks ln kw lo la lg lh li lj bi translated">培训/评估</li></ul><h2 id="63c9" class="lp lq iq bd lr ls lt dn lu lv lw dp lx ko ly lz ma ks mb mc md kw me mf mg mh bi translated"><strong class="ak">创建一个函数来导入数据集</strong></h2><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mi"><img src="../Images/15d7edc07a0d0856aef5f2159839efb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XzlUSDuvvO6x_mo_S3ho2Q.png"/></div></div></figure><p id="03a0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">另一种方法是使用<code class="fe mn mo mp mq b">tf.data.experimental.make_csv_dataset </code>函数来读取数据集。</p><p id="a842" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对于较小的数据集，我们可以将它们加载到 pandas 数据帧中，因为它们适合内存。我们可以使用<code class="fe mn mo mp mq b">tf.data.Dataset.from_tensor_slices</code>读取这些数据帧</p><p id="a7b7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">导入训练和验证集的函数</strong></p><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mr"><img src="../Images/891f522c0c9c2d0db9aa71a35a46cf03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*frA42UWIdJGXwg_egOVfvg.png"/></div></div></figure><h2 id="d140" class="lp lq iq bd lr ls lt dn lu lv lw dp lx ko ly lz ma ks mb mc md kw me mf mg mh bi translated">定义特征列</h2><p id="cf68" class="pw-post-body-paragraph kd ke iq kf b kg ms ki kj kk mt km kn ko mu kq kr ks mv ku kv kw mw ky kz la ij bi translated">任何预测分析项目中最重要的步骤之一是特征工程。有了一些经验、领域专业知识和良好的老式尝试和错误，您可以设计出显著改善最终结果的特性。</p><p id="8cb4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">存储纬度和经度</strong></p><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mx"><img src="../Images/c53c00ec7ea9dc59e62aa464feb24aa4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oxwsE-2xEMDVIpsx68lsRg.png"/></div></div></figure><p id="3e49" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">一个热编码</strong></p><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi my"><img src="../Images/22d3bfc5a55e26376367be5dd2ba391c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mtxrS_4b1MKunh0UASJKKQ.png"/></div></div></figure><p id="f46b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">TF . feature _ column . crossed _ column</strong></p><p id="c62c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用 TF . feature _ column . crossed _ column 创建一个为我们提供时间和星期组合信息的要素。例如，周五晚上和周日晚上的票价可能会有很大不同。</p><pre class="mj mk ml mm gt mz mq na nb aw nc bi"><span id="fe62" class="lp lq iq mq b gy nd ne l nf ng">fc_crossed_day_hr = tf.feature_column.crossed_column(keys = [fc_dayofweek, fc_hourofday], hash_bucket_size = 24 * 7)</span></pre><p id="1484" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">创建一个函数，以便我们可以在读取数据的同时创建新的功能。</p><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nh"><img src="../Images/6d3c494db5b22729d772b1e38bd4ae01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QBfhMWnSJAxiiORttCYXoQ.png"/></div></div></figure><p id="cb18" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们创建坐标之间的欧几里德距离作为一个特征，以及单独的纬度差和经度差，这将为我们提供关于行驶方向的信息。</p><p id="38da" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后，创建我们决定用来训练模型的特征列的列表，并创建服务输入接收器函数</p><h2 id="3696" class="lp lq iq bd lr ls lt dn lu lv lw dp lx ko ly lz ma ks mb mc md kw me mf mg mh bi translated">培训/评估</h2><p id="48a4" class="pw-post-body-paragraph kd ke iq kf b kg ms ki kj kk mt km kn ko mu kq kr ks mv ku kv kw mw ky kz la ij bi translated">线性模型</p><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ni"><img src="../Images/eed0283c26081006ed92336e8e354745.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TVeGZ2wI4_QBXBC1c7ojBA.png"/></div></div></figure><blockquote class="nj"><p id="5b9e" class="nk nl iq bd nm nn no np nq nr ns la dk translated">RMSE 是<strong class="ak"> 7.4 </strong></p></blockquote><p id="0800" class="pw-post-body-paragraph kd ke iq kf b kg nt ki kj kk nu km kn ko nv kq kr ks nw ku kv kw nx ky kz la ij bi translated">现在，让我们使用 DNN 回归器来训练我们的模型，这将更好地理解非线性关系。</p><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ny"><img src="../Images/2dc94af331b0ca47ce47b070239da98d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*stFcfR15LT3xfKgAMrg9Ig.png"/></div></div></figure><figure class="mj mk ml mm gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nz"><img src="../Images/189e34f8c958ff6895196517a1a8361a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ACzq5AZCUVmCKyjyPCFMsQ.png"/></div></div></figure><blockquote class="nj"><p id="5438" class="nk nl iq bd nm nn no np nq nr ns la dk translated">我们得到的均方根误差为 4.13 </p></blockquote><p id="8a60" class="pw-post-body-paragraph kd ke iq kf b kg nt ki kj kk nu km kn ko nv kq kr ks nw ku kv kw nx ky kz la ij bi translated">在下一篇文章中，我们将调整<strong class="kf ir">超参数</strong>来改进这个结果，并对包含 10 亿次以上乘坐的整个数据进行训练。正如你所猜测的，我们不能在我们的笔记本电脑上这样做。是时候转向云计算了。</p><p id="7665" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">资源:<a class="ae kc" href="https://www.coursera.org/specializations/machine-learning-tensorflow-gcp" rel="noopener ugc nofollow" target="_blank">Google 云平台上 TensorFlow 的机器学习</a></p><p id="3d0f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在<a class="ae kc" href="http://www.linkedin.com/in/tejan-irla" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上与我联系。你可以在这里找到完整的代码。</p><p id="47cf" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">干杯！！</p></div></div>    
</body>
</html>