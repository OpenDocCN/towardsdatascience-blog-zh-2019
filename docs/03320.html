<html>
<head>
<title>Google Ads reporting Python — Step by Step Guide</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">谷歌广告报道 Python —逐步指南</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/getting-adwords-kpis-reports-via-api-python-step-by-step-guide-245fc74d9d73?source=collection_archive---------1-----------------------#2019-05-28">https://towardsdatascience.com/getting-adwords-kpis-reports-via-api-python-step-by-step-guide-245fc74d9d73?source=collection_archive---------1-----------------------#2019-05-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/e16e89dc7c3e9f23bc2ed6efac385ba9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QJdZeqYUFC2014QEbSknZA.jpeg"/></div></div></figure><p id="d084" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Google Adwords 的用户界面非常棒，并且会不断更新，以更加方便用户。它的用户界面功能并不总是能让你解决你的企业特有的问题。我从 SEM 团队的一个问题中受到启发，他们希望按一天中的小时来报告广告支出。</p><p id="f8e8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">毫无疑问，每小时的广告支出报告可以通过 Adwords UI 创建，但它需要你的团队额外的资源来提取原始数据并生成报告，特别是当你有多个帐户时。内部数据库记录 adwords 的每日数据，但不记录一天中的小时。因此，让我们利用 Adwords API！</p><p id="fa6e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Adwords API 客户端库有好几个，像<a class="ae kw" href="https://github.com/googleads/googleads-php-lib" rel="noopener ugc nofollow" target="_blank"> PHP </a>、<a class="ae kw" href="https://github.com/googleads/google-api-ads-ruby" rel="noopener ugc nofollow" target="_blank"> Ruby </a>、<a class="ae kw" href="https://github.com/googleads/googleads-java-lib" rel="noopener ugc nofollow" target="_blank"> Java </a>等。我选定了<a class="ae kw" href="https://github.com/googleads/googleads-python-lib" rel="noopener ugc nofollow" target="_blank"> Python </a>库，因为我没有任何使用其他语言的经验。(有时候，我希望我能有一些网络/软件开发人员的工作经验… LOL)。</p><h1 id="e5e2" class="kx ky iq bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">通过 OAuth2 进行 API 调用。</h1><p id="482a" class="pw-post-body-paragraph jy jz iq ka b kb lv kd ke kf lw kh ki kj lx kl km kn ly kp kq kr lz kt ku kv ij bi translated">如果你是 Adwords API 的初学者，也没有 Adwords 账号，我会推荐跟随<a class="ae kw" href="https://github.com/googleads/googleads-python-lib/wiki/API-access-using-own-credentials-(installed-application-flow)" rel="noopener ugc nofollow" target="_blank">官方指南</a>和<a class="ae kw" href="https://www.youtube.com/watch?v=80KOeuCNc0c&amp;list=PLOU2XLYxmsII2PCvm73bwxRCu2g_dyp67" rel="noopener ugc nofollow" target="_blank">视频</a>(五集)。因为你需要创建一个<a class="ae kw" href="https://developers.google.com/adwords/api/docs/guides/first-api-call#create_test_accounts" rel="noopener ugc nofollow" target="_blank">测试账户</a>来玩 Adwords APIs，官方指南&amp;视频将带你完成<a class="ae kw" href="https://developers.google.com/adwords/api/docs/guides/first-api-call" rel="noopener ugc nofollow" target="_blank">第一次 API 调用</a>。</p><p id="0d3c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你有 adwords 帐户，让我们开始我们的旅程。总之需要两个脚本:1。第一个脚本—获取刷新的令牌 2。第二个脚本——在活动级别按小时获取广告支出。</p><p id="bc96" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你以前从未使用过 Adwords API，请不要担心。下一部分将带您从头开始。</p><p id="e704" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">步骤:</strong></p><ol class=""><li id="5431" class="ma mb iq ka b kb kc kf kg kj mc kn md kr me kv mf mg mh mi bi translated"><strong class="ka ir">通过 OAuth2 设置认证</strong></li><li id="b846" class="ma mb iq ka b kb mj kf mk kj ml kn mm kr mn kv mf mg mh mi bi translated">为你的 adwords 帐户申请/获得一个开发者令牌</li><li id="d768" class="ma mb iq ka b kb mj kf mk kj ml kn mm kr mn kv mf mg mh mi bi translated"><strong class="ka ir">获取您的刷新令牌并配置您的 adwords 客户端—运行脚本“获取您的刷新令牌”</strong></li><li id="f8db" class="ma mb iq ka b kb mj kf mk kj ml kn mm kr mn kv mf mg mh mi bi translated"><strong class="ka ir">进行 API 调用—运行脚本<em class="mo">' Get _ ads _ KPIs _ hourofday . py '</em></strong></li></ol><p id="49c9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在让我们来看一下每个步骤中的所有细节。</p><ol class=""><li id="0dcb" class="ma mb iq ka b kb kc kf kg kj mc kn md kr me kv mf mg mh mi bi translated">通过 OAuth2 设置身份验证</li></ol><p id="a67b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这一步的目标:获取客户端 id 和客户端机密。这些是你的应用凭证。你将在谷歌 API 中心创建自己的应用程序后拥有这些。</p><p id="e47d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">首先，在谷歌 API 中心创建一个应用程序，可以通过这个链接创建(【https://console.developers.google.com】T4)。请使用您用来访问 adwords 帐户的同一电子邮件。</p><p id="1309" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">打开<a class="ae kw" href="https://console.developers.google.com/apis/credentials" rel="noopener ugc nofollow" target="_blank"> Google API 控制台凭证页面</a>。点击“选择一个项目”&gt;“新建项目”&gt;输入项目名称&gt;“创建”。</p><p id="7cb6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">创建项目后，单击“创建凭据”并选择“OAuth 客户端 ID”。</p><figure class="mq mr ms mt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mp"><img src="../Images/521f967931b2829a4c9af33d26aba85d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EvNcaP3J6Q_nuEr5YUfswg.png"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk">pic-1</figcaption></figure><figure class="mq mr ms mt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi my"><img src="../Images/cc39ef513cc097361918db5853511be1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nvKU8QRPluRZE1FKDG9KTA.png"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk">pic-2</figcaption></figure><figure class="mq mr ms mt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mz"><img src="../Images/f5a4c899c6a802f649299e6fba1a7097.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c94aYDMyac3AJWfAvES73Q.png"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk">pic-3</figcaption></figure><p id="79c0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">请下载或复制&amp;粘贴您的客户 ID 和客户密码，并保存在安全的地方:)</strong></p><p id="259f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">点击图 3 中的“确定”后。你会看到类似的网页截图如下(图 1)。例如，在 pic-1 中，我的应用程序名称为“Ads-api ”,可以看到客户端 ID。</p><figure class="mq mr ms mt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi na"><img src="../Images/b7faa21d9c053681eed56e147ced2e88.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8r9MDnFlpQ4Lg5eL7Ok9xw.png"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk">pic-4</figcaption></figure><p id="06b0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">2.获取/请求开发者令牌</p><p id="33d3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">转到您的 adwords 帐户，单击右上角的“工具”图标，然后单击“API 中心”。然后，你将登陆一个类似 P2 显示的页面。基本访问级别足以让您进行 API 调用。将开发者令牌信息复制并粘贴到您的“googleleads.yaml”中，您可以在其中存储访问 adwords 帐户的凭据。</p><figure class="mq mr ms mt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nb"><img src="../Images/ca7ac6febe46bd926d601f174c99fc49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IlXSQDs8808YCfBSnwLOkA.png"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk">pic-2</figcaption></figure><figure class="mq mr ms mt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nc"><img src="../Images/88ecd9f354de1f80f8efac8016941c0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*InDxjTkY6z8GTs-Ylu_m7w.png"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk">pic-3</figcaption></figure><p id="25a4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">3.获取您的刷新令牌并配置您的 adwords 客户端</p><p id="991a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">将您在步骤 1 中获得的客户端 ID 和客户端密码添加到下面的脚本中。然后通过您的终端(Mac 用户)或注释行(PC 用户)运行“Get_your_refreshed_token.py”下面的脚本。因为我是 Mac 用户，所以我将使用终端来处理其余的步骤。</p><figure class="mq mr ms mt gt jr"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="dc91" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">运行<em class="mo">' Get _ your _ refreshed _ token . py '</em>时，您会看到下面的截图</p><figure class="mq mr ms mt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nf"><img src="../Images/67b0e11b06633a845d50bd41c9ef21f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T3dvEJMXa6ukpsDE4-Yrrw.png"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk">pic-5</figcaption></figure><p id="0032" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">按照 pic-5 中的说明，将 URL 从终端复制并粘贴到您的浏览器中。它可能会要求您选择一个 gmail 帐户。请记得选择与您的 adwords 帐户相关的电子邮件。然后你会看到:</p><figure class="mq mr ms mt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ng"><img src="../Images/d39cec8ccadc09844043ce430e59c145.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SUMZKelF_ShybBKsmFK6-A.png"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk">pic-5</figcaption></figure><p id="f4bb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可能会在图 5 中看到不同的名称。比如我的 app 名字叫‘Adwords-test’。所以你会看到你的应用程序名称。点击“允许”，然后登陆:</p><figure class="mq mr ms mt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nh"><img src="../Images/46fbc8e222358cfec8bffff63c342e94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y1tNYgKRhntedHbmPk2O5w.png"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk">pic-6</figcaption></figure><p id="abe6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">再次点击“允许”，您将看到:</p><figure class="mq mr ms mt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ni"><img src="../Images/519dc00468bdaf05cbc875e84528717d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EnhC7wrU7jW6iYOkwXAtjQ.png"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk">pic-7</figcaption></figure><p id="3e11" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">按照网页上显示的说明，将代码复制回您的终端，然后按键盘上的“enter”或“return”。然后终端会显示:</p><figure class="mq mr ms mt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nj"><img src="../Images/76580ac87770c0417ff6361b9c8fae25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4ZcVBlSwO7i_hRSbuOV9xg.png"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk">pic-8</figcaption></figure><p id="4437" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">复制和粘贴刷新的令牌并保存它。到目前为止还好吗？我知道第一次它可能仍然令人困惑，但你已经有了所有的部分来建立通过 API 访问 adwords 的关键。</p><p id="2f46" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们从<a class="ae kw" href="https://github.com/googleads/googleads-python-lib/blob/master/googleads.yaml" rel="noopener ugc nofollow" target="_blank"> Google API Python 库</a>下载“<a class="ae kw" href="https://github.com/googleads/googleads-python-lib/blob/master/googleads.yaml" rel="noopener ugc nofollow" target="_blank"> googleleads.yaml </a>”(其中存储了您访问账户的凭证)。</p><p id="1e55" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在“<a class="ae kw" href="https://github.com/googleads/googleads-python-lib/blob/master/googleads.yaml" rel="noopener ugc nofollow" target="_blank"> googleleads.yaml </a>”中，有两种配置。根据您的 adwords 帐户类型，您只需要其中一个。在我的例子中，我使用 AdWordsClient 配置。现在，将已经获得的信息输入到“googleleads.yaml”文件中:</p><p id="f42c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="mo">开发者令牌(来自步骤 2) </em></p><p id="6202" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="mo">客户端 id &amp;客户端密码(来自步骤 1) </em></p><p id="373e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="mo">刷新 _ 令牌(来自步骤 3) </em></p><p id="ece7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">完成以下信息后，将“googleleads.yaml”文件保存在本地驱动器的安全位置。完美！您已经完成了访问 Adword 的密钥设置！</p><p id="0f81" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">4.进行 API 调用—运行脚本“获取每小时广告花费”</p><p id="b25e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">运行脚本“Get_ads_KPIs_HourOfDay.py”，为每个 adwords 帐户生成 csv 文件，包括最近 4 周的数据。</p><p id="d4b1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">注意事项:</p><ol class=""><li id="ed5b" class="ma mb iq ka b kb kc kf kg kj mc kn md kr me kv mf mg mh mi bi translated">初始化客户端对象时。adwords_client = adwords。AdWords client . LoadFromStorage('…/Google ads . YAML ')这里的' googleads.yaml' 文件包括你的凭证。</li><li id="1d29" class="ma mb iq ka b kb mj kf mk kj ml kn mm kr mn kv mf mg mh mi bi translated">小心 API 报告中的微量。为了得到美元，货币变量/1000000。在我的脚本中，我为<strong class="ka ir"> <em class="mo">【成本】</em>变量做了这个。</strong> <em class="mo"> df['成本']=df。成本/1000000 </em></li><li id="93f3" class="ma mb iq ka b kb mj kf mk kj ml kn mm kr mn kv mf mg mh mi bi translated">我在字典中放了三个 adwords 帐户信息(<em class="mo"> Ad_acc </em>)只是为了同时运行几个帐户的报告。如果你只有一个账号，那么只需在字典中输入一个账号(<em class="mo"> Ad_acc </em>)。或者，您可以将您的品牌名称作为'<em class="mo">键'</em>输入，将 adwords 帐户 ID 作为<em class="mo"> 'acc_id' </em>输入，作为函数(<em class="mo">run _ hour 0 fday _ kip _ report</em>)的输入变量</li><li id="bf23" class="ma mb iq ka b kb mj kf mk kj ml kn mm kr mn kv mf mg mh mi bi translated">我使用函数根据今天的日期生成过去 28 天的开始日期和结束日期。但你并不真的需要那部分。只需输入任何开始/结束日期格式，如 yymmdd。</li><li id="770d" class="ma mb iq ka b kb mj kf mk kj ml kn mm kr mn kv mf mg mh mi bi translated">在我的函数(<em class="mo"> run_Hour0fDay_kip_report)中，</em>报告定义是用 AWQL(AdWords 查询语言)创建的。也可以用 XML 创建报告定义。<a class="ae kw" href="https://developers.google.com/adwords/api/docs/guides/reporting" rel="noopener ugc nofollow" target="_blank"> <em class="mo">查看此处引用的</em> </a>。</li></ol><figure class="mq mr ms mt gt jr"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="5840" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，有许多不同类型的报告可以通过 AdWords API 构建。请检查<a class="ae kw" href="https://developers.google.com/adwords/api/docs/appendix/reports/all-reports" rel="noopener ugc nofollow" target="_blank">参考</a>。</p></div></div>    
</body>
</html>