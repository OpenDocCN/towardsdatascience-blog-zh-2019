<html>
<head>
<title>Power up your Python Projects with Visual Studio Code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Visual Studio 代码启动您的 Python 项目</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/power-up-your-python-projects-with-visual-studio-code-401f78dd97eb?source=collection_archive---------2-----------------------#2019-12-07">https://towardsdatascience.com/power-up-your-python-projects-with-visual-studio-code-401f78dd97eb?source=collection_archive---------2-----------------------#2019-12-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8231" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">用 Visual Studio 代码设置几乎自动化的 Python 虚拟环境，创建 Jupyter 笔记本和更多内容。</h2></div><h1 id="9207" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">为什么在数据科学中使用虚拟环境？</h1><p id="0e43" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我们知道依赖管理对于包开发和软件开发人员的重要性。但是对于那些没有被部署到 PyPI 或 conda-forge 的从事数据科学的人来说呢？</p><h2 id="fb4a" class="lw kj it bd kk lx ly dn ko lz ma dp ks lj mb mc ku ln md me kw lr mf mg ky mh bi translated">虚拟环境可以帮助你修复坏掉的东西。</h2><p id="e70e" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">如果您使用 Python 已经有一段时间了，那么您会对安装了太多包的混乱开发环境感到沮丧。您不需要一次全部用到它们，并且试图找出哪些是您的项目所必需的，手工操作是令人沮丧的。</p><p id="491e" class="pw-post-body-paragraph la lb it lc b ld mi ju lf lg mj jx li lj mk ll lm ln ml lp lq lr mm lt lu lv im bi translated">软件包并不总是在同一时间升级，许多软件包彼此不兼容，甚至与您正在运行的 Python 或 Anaconda 版本不兼容。来自 conda 内部不同渠道的包甚至不能保证不冲突。如果你把所有东西都下载到同一个大环境中，不可避免的是，你会以不一致的依赖关系结束，事情<em class="mn">会</em>崩溃。</p><figure class="mp mq mr ms gt mt gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/cdae72330b9b3744b4b2823a3ad9b5d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1206/format:webp/1*HJ8RewhD-vuiv0YlaPiF-Q.png"/></div><figcaption class="mw mx gj gh gi my mz bd b be z dk">this is not wise.</figcaption></figure><p id="5f28" class="pw-post-body-paragraph la lb it lc b ld mi ju lf lg mj jx li lj mk ll lm ln ml lp lq lr mm lt lu lv im bi translated">更不用说各种工具，如 pip、pipx、conda、poeties、hatch、pipenv、pyenv、virtualenv、pyvenv、pyenv-virtualenv、virtualenvwrapper、pyenv-virtualenvwrapper 和 venv……尽管听起来非常相似，但往往彼此不兼容。</p><h2 id="4a0d" class="lw kj it bd kk lx ly dn ko lz ma dp ks lj mb mc ku ln md me kw lr mf mg ky mh bi translated">如果您使用 Anaconda，这是您的项目何时中断的问题，而不是是否中断的问题。</h2><p id="11af" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">不在容器外使用 anaconda 的另一个原因是——您不知道自己在运行什么。在<a class="ae na" href="https://github.com/AnacondaRecipes/aggregate/issues/151" rel="noopener ugc nofollow" target="_blank">一些奇怪的案例</a>中，anaconda 的激活脚本严重破坏了 pyenv 之前的系统环境清理，唯一快速解决这个问题的方法是在. zshrc 前面加上<code class="fe nb nc nd ne b">HOST=$(hostname)</code></p><figure class="mp mq mr ms gt mt gh gi paragraph-image"><div role="button" tabindex="0" class="ng nh di ni bf nj"><div class="gh gi nf"><img src="../Images/f50be0544a03eb57d6103fab3ea7e892.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jU8CCQ_KKQCIZeLuCpR8lQ.png"/></div></div><figcaption class="mw mx gj gh gi my mz bd b be z dk">I feel confident running this code in my user root directory, don’t you?</figcaption></figure><h2 id="6a48" class="lw kj it bd kk lx ly dn ko lz ma dp ks lj mb mc ku ln md me kw lr mf mg ky mh bi translated">虚拟环境有助于数据科学的再现性。</h2><p id="e446" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">Python 有一个很棒的开源社区，但这也意味着各种工具和方法的激增。</p><p id="9ffc" class="pw-post-body-paragraph la lb it lc b ld mi ju lf lg mj jx li lj mk ll lm ln ml lp lq lr mm lt lu lv im bi translated">如果你提供你在科学分析中使用的库的精确版本，你的结果将更可验证。事实上，这种依赖性管理在责任性和准确性方面可以发挥至关重要的作用。有时，Python 包中的错误被证明是统计模型中计算错误的根本原因。重要的是能够追踪您是否使用了错误的包，以便您可以在必要时验证或纠正您的结果。</p><p id="f353" class="pw-post-body-paragraph la lb it lc b ld mi ju lf lg mj jx li lj mk ll lm ln ml lp lq lr mm lt lu lv im bi translated">能够为一个给定的项目冻结你的需求——<em class="mn">并且只</em>那些真正是需求的包——并且提供它作为一个环境文件以备将来参考，会让你成为一个更好的合作者和科学家。您将确切地知道您的模型使用了什么，何时使用，以及为什么使用。</p><h2 id="7be9" class="lw kj it bd kk lx ly dn ko lz ma dp ks lj mb mc ku ln md me kw lr mf mg ky mh bi translated">将 pyenv 与 pyenv-virtualenv 结合使用可以让您安全地管理 python 安装</h2><p id="dab9" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我已经写了一个(完全不全面，保证会崩溃)<a class="ae na" href="https://medium.com/swlh/a-guide-to-python-virtual-environments-8af34aa106ac" rel="noopener">的指南，在这里用 pyenv 和 pyenv-virtualenv 设置你的系统</a>。这是我最喜欢的管理多个安装的方法，因为它:</p><ul class=""><li id="ee4a" class="nk nl it lc b ld mi lg mj lj nm ln nn lr no lv np nq nr ns bi translated">干净、灵活且可逆</li><li id="e0ba" class="nk nl it lc b ld nt lg nu lj nv ln nw lr nx lv np nq nr ns bi translated">抵抗用户错误</li><li id="c4b9" class="nk nl it lc b ld nt lg nu lj nv ln nw lr nx lv np nq nr ns bi translated">防止蟒蛇破坏我的环境的有效措施</li></ul><p id="3e26" class="pw-post-body-paragraph la lb it lc b ld mi ju lf lg mj jx li lj mk ll lm ln ml lp lq lr mm lt lu lv im bi translated">如果你不想读完整本书，我把它浓缩成了一张备忘单:</p><div class="ny nz gp gr oa ob"><a href="https://github.com/lorarjohns/awesomeVenvs/blob/master/pyenv_cheat_sheet.md" rel="noopener  ugc nofollow" target="_blank"><div class="oc ab fo"><div class="od ab oe cl cj of"><h2 class="bd iu gy z fp og fr fs oh fu fw is bi translated">lorarjohns/awesomeVenvs</h2><div class="oi l"><h3 class="bd b gy z fp og fr fs oh fu fw dk translated">安装并运行 Anaconda 卸载程序 conda install Anaconda-clean &amp; &amp; Anaconda-clean-yes 找到剩余的目录…</h3></div><div class="oj l"><p class="bd b dl z fp og fr fs oh fu fw dk translated">github.com</p></div></div><div class="ok l"><div class="ol l om on oo ok op mu ob"/></div></div></a></div><p id="9752" class="pw-post-body-paragraph la lb it lc b ld mi ju lf lg mj jx li lj mk ll lm ln ml lp lq lr mm lt lu lv im bi translated">我还使用<a class="ae na" href="https://www.arqbackup.com/arqcloudbackup/" rel="noopener ugc nofollow" target="_blank"> Arq 云备份</a>，它的工作方式类似于 git，而且非常便宜，几乎是自动化的，在用这种方法建立新系统之前，我可以保护重要的文件。对于我想更直接访问的 Zotero、dotfiles 和较小的文件，我使用<a class="ae na" href="http://www.sync.com/get-started?_sync_refer=22dfdd050" rel="noopener ugc nofollow" target="_blank"> Sync </a>(本质上是一个端到端加密的、符合 GDPR 标准的 Dropbox)。</p></div><div class="ab cl oq or hx os" role="separator"><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov"/></div><div class="im in io ip iq"><h1 id="0932" class="ki kj it bd kk kl ox kn ko kp oy kr ks jz oz ka ku kc pa kd kw kf pb kg ky kz bi translated">包含 pyenv 和 Visual Studio 代码的集成开发环境</h1><p id="58c0" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">设置好 pyenv 安装后，您可以为虚拟环境中的数据科学开发创建一些非常酷的工作流。让我们用 Anaconda 发行版创建一个项目，看看如何使用 Visual Studio 代码开发 Jupyter 笔记本并将其转换为。py 脚本</p></div><div class="ab cl oq or hx os" role="separator"><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov"/></div><div class="im in io ip iq"><p id="2c04" class="pw-post-body-paragraph la lb it lc b ld mi ju lf lg mj jx li lj mk ll lm ln ml lp lq lr mm lt lu lv im bi translated">每个项目都应该有一个目录，每个目录都应该有一个虚拟环境。这个结构做两件重要的事情:</p><ol class=""><li id="e32e" class="nk nl it lc b ld mi lg mj lj nm ln nn lr no lv pc nq nr ns bi translated">它可以让你的东西有条不紊，这样就更容易把项目分开，管理依赖关系，把不该放在那里的东西挡在外面。(谁喜欢撤销 git 提交？)</li><li id="34f7" class="nk nl it lc b ld nt lg nu lj nv ln nw lr nx lv pc nq nr ns bi translated">它允许您为每个目录(因此也为每个项目)创建一个单独的<code class="fe nb nc nd ne b">.python-version file</code>，<strong class="lc iu">，<em class="mn">这意味着当您更改目录时，pyenv-virtualenv 可以自动切换到适合您的环境。</em>T13】</strong></li></ol><p id="7bd1" class="pw-post-body-paragraph la lb it lc b ld mi ju lf lg mj jx li lj mk ll lm ln ml lp lq lr mm lt lu lv im bi translated">这里是<strong class="lc iu">TL；项目设置的 DR </strong>版本:</p><ol class=""><li id="5f5b" class="nk nl it lc b ld mi lg mj lj nm ln nn lr no lv pc nq nr ns bi translated">制作一个项目文件夹，并将<code class="fe nb nc nd ne b">cd</code>放入其中</li><li id="ae29" class="nk nl it lc b ld nt lg nu lj nv ln nw lr nx lv pc nq nr ns bi translated">用<code class="fe nb nc nd ne b">pyenv local $PYTHON_VERSION</code>设置你的项目 Python</li><li id="432d" class="nk nl it lc b ld nt lg nu lj nv ln nw lr nx lv pc nq nr ns bi translated">运行这个命令(例如)来创建一个虚拟环境:<code class="fe nb nc nd ne b">pyenv virtualenv anaconda3–2019.10 venv-cool_project </code>如果您忽略 Python 版本，您的环境将使用当前在本地有效的版本。</li><li id="c09b" class="nk nl it lc b ld nt lg nu lj nv ln nw lr nx lv pc nq nr ns bi translated">通过使用 venv 的名称执行<code class="fe nb nc nd ne b">pyenv local</code>，激活您的新环境并将其设置为项目的本地 Python，并使用(例如)<code class="fe nb nc nd ne b">conda activate venv-cool_project</code>激活环境</li></ol><p id="42bb" class="pw-post-body-paragraph la lb it lc b ld mi ju lf lg mj jx li lj mk ll lm ln ml lp lq lr mm lt lu lv im bi translated">如果您在每次创建新项目时都运行下面的一行程序，您应该能够<code class="fe nb nc nd ne b">cd</code>进出目录，并让您的虚拟环境自动激活和停用。(当然，您需要更改环境名称和 Python 解释器。)</p><figure class="mp mq mr ms gt mt gh gi paragraph-image"><div role="button" tabindex="0" class="ng nh di ni bf nj"><div class="gh gi pd"><img src="../Images/95924011d6a596ff55db9fec52fe164b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Vk8IQEXU4P8I9urzB6ZsXw.png"/></div></div><figcaption class="mw mx gj gh gi my mz bd b be z dk">$ mkdir $2 &amp;&amp; cd $2 &amp;&amp; pyenv local $1 &amp;&amp; pyenv virtualenv venv-$2 &amp;&amp; pyenv local venv-$2 &amp;&amp; pyenv activate venv-$2</figcaption></figure><p id="ea85" class="pw-post-body-paragraph la lb it lc b ld mi ju lf lg mj jx li lj mk ll lm ln ml lp lq lr mm lt lu lv im bi translated">这里有一个 GitHub 要点和一个脚本可以帮你做到。下载它(你可能需要运行<code class="fe nb nc nd ne b">chmod +x newproj.sh</code>来确保它是可执行的)。然后，通过向它传递您想要使用的 python 版本和项目名称，就可以使用它来创建新项目:</p><figure class="mp mq mr ms gt mt gh gi paragraph-image"><div role="button" tabindex="0" class="ng nh di ni bf nj"><div class="gh gi pe"><img src="../Images/f66aff79cfbdb62e43bdf7f09daacad7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jGs9i71X1H6BfdTzY1jQzQ.png"/></div></div></figure><figure class="mp mq mr ms gt mt"><div class="bz fp l di"><div class="pf pg l"/></div><figcaption class="mw mx gj gh gi my mz bd b be z dk">now you really have no excuse not to use venvs.</figcaption></figure><h1 id="5e32" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">通过 Python 和 Jupyter 使用 Visual Studio 代码</h1><p id="d66d" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated"><a class="ae na" href="https://code.visualstudio.com/docs/languages/python" rel="noopener ugc nofollow" target="_blank"> Visual Studio 代码</a>可以做很多很酷的花样。首先，如果您按照上面的说明进行设置，它可以自动为您的项目目录选择正确的虚拟解释器。</p><p id="743b" class="pw-post-body-paragraph la lb it lc b ld mi ju lf lg mj jx li lj mk ll lm ln ml lp lq lr mm lt lu lv im bi translated"><code class="fe nb nc nd ne b">brew cask install visual-studio-code</code>上手。</p><p id="b1bd" class="pw-post-body-paragraph la lb it lc b ld mi ju lf lg mj jx li lj mk ll lm ln ml lp lq lr mm lt lu lv im bi translated">然后，进入 VS 代码的设置:</p><ul class=""><li id="f4bf" class="nk nl it lc b ld mi lg mj lj nm ln nn lr no lv np nq nr ns bi translated">确保系统的终端与应用程序的终端同步:告诉 VS 代码使用带有“外部”变量的操作系统终端应用程序。</li><li id="4f71" class="nk nl it lc b ld nt lg nu lj nv ln nw lr nx lv np nq nr ns bi translated">打开集成终端功能，该功能允许您在 VSCode 应用程序中使用终端模拟器。</li></ul><figure class="mp mq mr ms gt mt gh gi paragraph-image"><div role="button" tabindex="0" class="ng nh di ni bf nj"><div class="gh gi ph"><img src="../Images/d25e7dd5b51e3ba4d5ea86ef5b4829eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PObPSAKVU1NX_NjUO41Axg.png"/></div></div><figcaption class="mw mx gj gh gi my mz bd b be z dk">VS Code user settings for integrated terminal and iTerm.app on macOS</figcaption></figure><ul class=""><li id="fea3" class="nk nl it lc b ld mi lg mj lj nm ln nn lr no lv np nq nr ns bi translated">用<code class="fe nb nc nd ne b">⌘+⇧+P</code>打开命令面板，选择<code class="fe nb nc nd ne b">Shell Command: Install 'code' command in PATH</code>。这允许您从外部终端启动 VS 代码:<code class="fe nb nc nd ne b">code --</code>启动应用程序，<code class="fe nb nc nd ne b">code .</code>打开当前工作目录，<code class="fe nb nc nd ne b">code path/to/file/or/dir</code>打开特定文件或目录。</li></ul><figure class="mp mq mr ms gt mt gh gi paragraph-image"><div role="button" tabindex="0" class="ng nh di ni bf nj"><div class="gh gi pi"><img src="../Images/c845bb8f2c4baf452206e26800460594.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mL5oEQAf5H6dwls5Y7Q9rQ.png"/></div></div><figcaption class="mw mx gj gh gi my mz bd b be z dk">one of my project directories, with an integrated terminal</figcaption></figure><ul class=""><li id="e45d" class="nk nl it lc b ld mi lg mj lj nm ln nn lr no lv np nq nr ns bi translated">为 VS 代码安装<a class="ae na" href="https://marketplace.visualstudio.com/items?itemName=ms-python.python" rel="noopener ugc nofollow" target="_blank"> Python 扩展</a>。一旦启用，只要你用 python 扩展名保存了一个文件，编辑器就会知道它应该在 Python 上下文中被解释。</li></ul><p id="fb10" class="pw-post-body-paragraph la lb it lc b ld mi ju lf lg mj jx li lj mk ll lm ln ml lp lq lr mm lt lu lv im bi translated">您会注意到，当您在集成终端中 cd 进入和退出项目目录时，python 解释器将自动检测您的 venvs，只要有一个<code class="fe nb nc nd ne b">.python-version</code>文件存在(如果您正确使用 pyenv-virtualenv，应该有)。</p><figure class="mp mq mr ms gt mt gh gi paragraph-image"><div role="button" tabindex="0" class="ng nh di ni bf nj"><div class="gh gi pj"><img src="../Images/b89070dfe96673f5d87eef4fe7e4e0c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7qgrkHk2C4VvRgrUdlgFaw.png"/></div></div><figcaption class="mw mx gj gh gi my mz bd b be z dk">The name of the detected virtual environment, in the lower left-hand corner</figcaption></figure><p id="4526" class="pw-post-body-paragraph la lb it lc b ld mi ju lf lg mj jx li lj mk ll lm ln ml lp lq lr mm lt lu lv im bi translated">您还可以通过点击底部工具栏中的 Python 解释器名称，或者打开命令面板并键入<code class="fe nb nc nd ne b">Python: Select Interpreter</code>，明确地告诉应用程序使用哪个 Python 解释器。</p><figure class="mp mq mr ms gt mt gh gi paragraph-image"><div role="button" tabindex="0" class="ng nh di ni bf nj"><div class="gh gi pk"><img src="../Images/7d01673e22cffbda7d641ce2e11b13e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CA_h1_b_5-p02nKDvgZ2eQ.png"/></div></div><figcaption class="mw mx gj gh gi my mz bd b be z dk">A list of available interpreters/environments and their paths</figcaption></figure><p id="8912" class="pw-post-body-paragraph la lb it lc b ld mi ju lf lg mj jx li lj mk ll lm ln ml lp lq lr mm lt lu lv im bi translated">因为我们在一个终端，我们也可以创建和激活新的 venvs，就像我们通常在这里做的那样。</p><h2 id="2bc6" class="lw kj it bd kk lx ly dn ko lz ma dp ks lj mb mc ku ln md me kw lr mf mg ky mh bi translated">创建 Jupyter 笔记本</h2><p id="e41f" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">要使用笔记本，只需在 conda 环境中打开一个<code class="fe nb nc nd ne b">.ipynb</code>文件或从命令面板中选择<code class="fe nb nc nd ne b">Python: Create New Blank Jupyter Notebook</code>即可。然后，您可以像往常一样运行单元和创建笔记本，但额外的好处是您不依赖于您的 web 浏览器。</p><figure class="mp mq mr ms gt mt gh gi paragraph-image"><div role="button" tabindex="0" class="ng nh di ni bf nj"><div class="gh gi pl"><img src="../Images/b774808e07eba5c0062b5113e96a8bbe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1bm7IAhMSDqf1GevA5om5g.png"/></div></div><figcaption class="mw mx gj gh gi my mz bd b be z dk">a jupyter notebook in a conda virtual environment in vscode</figcaption></figure><p id="a515" class="pw-post-body-paragraph la lb it lc b ld mi ju lf lg mj jx li lj mk ll lm ln ml lp lq lr mm lt lu lv im bi translated">你也可以一键将笔记本快速转换成 Python 脚本，或者使用<code class="fe nb nc nd ne b">Python: Convert to python script</code>:</p><figure class="mp mq mr ms gt mt gh gi paragraph-image"><div role="button" tabindex="0" class="ng nh di ni bf nj"><div class="gh gi pm"><img src="../Images/01f707b5f2110828382b7a63faa1a913.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iesuaXhdTFdBVs4lkNj7XQ.png"/></div></div><figcaption class="mw mx gj gh gi my mz bd b be z dk">notebook converted to a script</figcaption></figure><p id="bc4d" class="pw-post-body-paragraph la lb it lc b ld mi ju lf lg mj jx li lj mk ll lm ln ml lp lq lr mm lt lu lv im bi translated">这对于将探索性分析转化为可运行的、可再现的程序来说非常方便。</p><h1 id="d935" class="ki kj it bd kk kl km kn ko kp kq kr ks jz kt ka ku kc kv kd kw kf kx kg ky kz bi translated">满怀信心地完成伟大的项目</h1><p id="d0f4" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">现在，当您开始一个项目时，您将能够在您的开发环境中控制包，轻松地将 conda envs 转换成 requirements.txt 文件，并更高效地将您的笔记本整理成适合生产的脚本。VS Code 提供了更多的工具，比如语法高亮、代码林挺、测试集成，以及与 GitHub、Docker、各种数据库等的接口，来增强你的项目。将这些工具添加到您的数据科学工作流程中，成为更高效的程序员和开发人员。</p></div></div>    
</body>
</html>