<html>
<head>
<title>How We Built a Content-Based Filtering Recommender System For Music with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用 Python 构建基于内容的音乐过滤推荐系统</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-we-built-a-content-based-filtering-recommender-system-for-music-with-python-c6c3b1020332?source=collection_archive---------9-----------------------#2019-05-24">https://towardsdatascience.com/how-we-built-a-content-based-filtering-recommender-system-for-music-with-python-c6c3b1020332?source=collection_archive---------9-----------------------#2019-05-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/b5dc50b153652401d5b947d88a6e8473.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kmH0XEvw8tptUDJ-VWWhLg.jpeg"/></div></div></figure><p id="cf2a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">背景:这个项目指的是 Lambda School 的 Lambda 实验室，学生们在过去的 5 周时间里构建了生产级的 web 应用程序，其中一些人利用机器学习模型作为他们后端的一部分。我们小组的任务包括开发一个应用程序，根据他们的情绪推荐无版权音乐。我是使用 Python 和 Django 等工具实现后端的数据科学团队的一员。如果你想看成品，去 moodibeats.com 看看，在那里你会找到超过 1000 首无版权音乐的目录——其中一些被你即将在这里看到的机器学习模型标记。</p><h2 id="acc6" class="la lb it bd lc ld le dn lf lg lh dp li km lj lk ll kq lm ln lo ku lp lq lr ls bi translated"><strong class="ak">第一部分:推荐系统一瞥</strong></h2><p id="4bf3" class="pw-post-body-paragraph kb kc it kd b ke lt kg kh ki lu kk kl km lv ko kp kq lw ks kt ku lx kw kx ky im bi translated">每当我想到推荐系统，我就会想到这部电影:</p><figure class="ly lz ma mb gt ju"><div class="bz fp l di"><div class="mc md l"/></div></figure><p id="7998" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><a class="ae kz" href="https://en.wikipedia.org/wiki/High_Fidelity_(film)" rel="noopener ugc nofollow" target="_blank">高保真</a>19 年前上映的一部电影，讲的是一个名叫罗布·戈登的唱片店老板，他的员工据说对音乐非常了解，以至于他们实际上阻止顾客购买他们想买的音乐。我提到这一点是因为在我们有网飞、亚马逊和 YouTube 之前，真人是最接近个性化推荐系统的。</p><p id="1a13" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">知道你喜欢什么并推荐最新 Blink-182 或 Green Day 专辑的唱片店老板，尝过菜单上所有东西并根据你以前吃过的东西确切知道你想要什么的餐馆服务员，或者在街上告诉你去你正在寻找的地方的最快和最容易的方法的随机陌生人——这些都是活生生的推荐系统——并且非常有效。</p><p id="5319" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">问题是它们无法扩展。直到有了像谷歌这样的互联网，它才得以扩展。即便如此，直到数据科学的到来及其处理大量数据的能力出现之前，也没有办法有效地评估推荐过程。</p><p id="6842" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">推荐系统通常可以分为两种类型:</p><ol class=""><li id="0658" class="me mf it kd b ke kf ki kj km mg kq mh ku mi ky mj mk ml mm bi translated">基于协作的过滤:基于用户相似性提供推荐——使用<a class="ae kz" href="https://en.wikipedia.org/wiki/K-nearest_neighbors_algorithm" rel="noopener ugc nofollow" target="_blank">kNN</a>(k-最近邻)或<a class="ae kz" href="https://en.wikipedia.org/wiki/Matrix_factorization_(recommender_systems)" rel="noopener ugc nofollow" target="_blank">矩阵分解</a>算法。协同过滤是个性化推荐系统的黄金标准，但你需要大量的用户数据，这就是为什么像 YouTube 和亚马逊这样的应用程序能够如此有效地做到这一点。</li><li id="fa5f" class="me mf it kd b ke mn ki mo km mp kq mq ku mr ky mj mk ml mm bi translated">基于内容的过滤:基于元数据或你想推荐的东西的特征提供推荐。如果你推荐电影之类的东西，那么你可以使用类型、演员、导演、电影长度等。作为预测你是否喜欢一部电影的输入。</li></ol><p id="84ae" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">对于 MoodiBeats，由于数据的限制，我们最终选择了基于内容的过滤。</p><h2 id="dd1d" class="la lb it bd lc ld le dn lf lg lh dp li km lj lk ll kq lm ln lo ku lp lq lr ls bi translated">第二部分:对 MoodiBeats 起源的一瞥</h2><p id="23bc" class="pw-post-body-paragraph kb kc it kd b ke lt kg kh ki lu kk kl km lv ko kp kq lw ks kt ku lx kw kx ky im bi translated">回到我们的 Lambda Labs 项目，在<a class="ae kz" href="http://moodibeats.com" rel="noopener ugc nofollow" target="_blank"> MoodiBeats </a>的规划阶段，我们团队内部有一些相当大的斗争。试图将机器学习集成到尚不存在的 web 应用程序中的一个主要问题是先有鸡还是先有蛋的问题——在没有实际数据的情况下，如何设计数据科学驱动的前端，以及如何为您不太确定其规范的网站获取数据？</p><p id="d8d7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">最初，数据科学家希望使用现成的 CSV 文件，所以我们花了近两周时间分析了<a class="ae kz" href="http://millionsongdataset.com/lastfm/" rel="noopener ugc nofollow" target="_blank"> last.fm </a>数据集和臭名昭著的<a class="ae kz" href="https://github.com/mdeff/fma/" rel="noopener ugc nofollow" target="_blank"> FMA </a>数据集。最终，为了避免版权问题和让用户下载歌曲的不可行性，前端团队决定使用 YouTube 的 API 和播放器来播放<strong class="kd iu">无版权音乐</strong>。这迫使数据科学团队完全放弃了在 last.fm 和 FMA 数据集上所做的所有工作，并在项目中途重新专注于尝试从 YouTube v3 API 获取数据。</p><h2 id="dc68" class="la lb it bd lc ld le dn lf lg lh dp li km lj lk ll kq lm ln lo ku lp lq lr ls bi translated">第三部分:让我们构建一个作为 REST API 的准系统 Django 后端</h2><p id="da40" class="pw-post-body-paragraph kb kc it kd b ke lt kg kh ki lu kk kl km lv ko kp kq lw ks kt ku lx kw kx ky im bi translated">警告 1:我将快速构建一个 Django 后端，只做最少的解释，这样对 Django 没有太多经验但感兴趣的读者可以参考 Medium 或 YouTube 上的无数教程，或者这里的<a class="ae kz" href="https://docs.djangoproject.com/en/2.2/" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="103e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">警告 2:第三和第四部分必然会很长。但是，要知道我们在这里所做的实际上是建立一个机器学习管道，它将:</p><ul class=""><li id="91e4" class="me mf it kd b ke kf ki kj km mg kq mh ku mi ky ms mk ml mm bi translated">从 YouTube API v3 自动检索数据</li><li id="f1f4" class="me mf it kd b ke mn ki mo km mp kq mq ku mr ky ms mk ml mm bi translated">运行机器学习模型</li><li id="7d14" class="me mf it kd b ke mn ki mo km mp kq mq ku mr ky ms mk ml mm bi translated">将 YouTube 数据和机器生成的预测(在这种情况下是情绪)作为 RESTful 端点公开</li></ul><p id="0aea" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">因此，对于希望收集大量新数据并以世界其他地方可以访问的形式拥有这些数据的数据科学家来说，这是非常重要的，而且可能非常有用。*如果您只关心数据科学部分，请直接跳到第五部分。</p><p id="9b42" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在命令行上:</p><pre class="ly lz ma mb gt mt mu mv mw aw mx bi"><span id="c688" class="la lb it mu b gy my mz l na nb">"""Working within a virtual environment is highly recommended.  For this project either Conda or Pipenv is sufficient.  I'm using Python 3.6 and Django 1.11.20 and PostgreSQL for this project."""</span><span id="8b59" class="la lb it mu b gy nc mz l na nb">$ mkdir MoodiBeatsAPI &amp;&amp; cd MoodiBeatsAPI</span><span id="1cce" class="la lb it mu b gy nc mz l na nb"># psycopg2 is for interfacing with PostgreSQL database<br/>$ pip install Django==1.11.20 psycopg2</span><span id="2dac" class="la lb it mu b gy nc mz l na nb"># don't forget the trailing period<br/>$ django-admin startproject music_selector .</span></pre><p id="342a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在在你选择的文本编辑器中打开项目文件夹(MoodiBeatsAPI ),现在很多人使用 VS 代码，我仍然使用 Sublime 文本。</p><p id="98da" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">Django 将 SQLite3 作为数据库提供，但是我更喜欢使用 PostgreSQL，所以如果您还没有 PostgreSQL，我建议您在系统上安装它。</p><p id="4157" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">您的项目结构应该如下所示:</p><pre class="ly lz ma mb gt mt mu mv mw aw mx bi"><span id="d005" class="la lb it mu b gy my mz l na nb">.</span><span id="c0dd" class="la lb it mu b gy nc mz l na nb">├── manage.py</span><span id="a030" class="la lb it mu b gy nc mz l na nb">└── music_selector</span><span id="5272" class="la lb it mu b gy nc mz l na nb">    ├── __init__.py</span><span id="2dfb" class="la lb it mu b gy nc mz l na nb">    ├── settings.py</span><span id="6bc0" class="la lb it mu b gy nc mz l na nb">    ├── urls.py</span><span id="e5cd" class="la lb it mu b gy nc mz l na nb">    └── wsgi.py</span></pre><p id="1252" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">首先创建 PostgreSQL 数据库:</p><pre class="ly lz ma mb gt mt mu mv mw aw mx bi"><span id="ea90" class="la lb it mu b gy my mz l na nb">$ psql -d postgres</span><span id="35a9" class="la lb it mu b gy nc mz l na nb">postgres=# CREATE DATABASE moodibeats;</span><span id="af86" class="la lb it mu b gy nc mz l na nb"># You can verify that the database has been created by running </span><span id="42d7" class="la lb it mu b gy nc mz l na nb">postgres=# \l</span><span id="ed08" class="la lb it mu b gy nc mz l na nb"># And exit<br/>postgres=# \q</span></pre><p id="3a93" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">进入您的<strong class="kd iu"> settings.py </strong>并进行一些更改:</p><pre class="ly lz ma mb gt mt mu mv mw aw mx bi"><span id="c3d9" class="la lb it mu b gy my mz l na nb">### Change this:</span><span id="c544" class="la lb it mu b gy nc mz l na nb">DATABASES = {<br/>    'default': {<br/>        'ENGINE': 'django.db.backends.sqlite3',<br/>        'NAME': os.path.join(BASE_DIR, 'db.sqlite3'),<br/>    }<br/>}</span><span id="a3fb" class="la lb it mu b gy nc mz l na nb">### To this:</span><span id="8955" class="la lb it mu b gy nc mz l na nb">DATABASES = {<br/>    'default': {<br/>        'ENGINE': 'django.db.backends.postgresql_psycopg2',<br/>        'NAME': 'moodibeats', # Name of our database<br/>        'USER': 'sammylee', # This would be different for you<br/>        'PASSWORD': '',<br/>        'HOST': 'localhost',<br/>        'PORT': '5432',</span><span id="fe13" class="la lb it mu b gy nc mz l na nb">    }<br/>}</span></pre><p id="17a9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在命令行上:</p><pre class="ly lz ma mb gt mt mu mv mw aw mx bi"><span id="b05f" class="la lb it mu b gy my mz l na nb">$ python manage.py migrate<br/>$ python manage.py createsuperuser</span><span id="4906" class="la lb it mu b gy nc mz l na nb"># Create your credentials</span><span id="61c7" class="la lb it mu b gy nc mz l na nb">$ python manage.py runserver</span><span id="1ead" class="la lb it mu b gy nc mz l na nb"># Go to <a class="ae kz" href="http://127.0.0.1:8000/" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:8000/</a> on your web browser<br/># Append 'admin' at the end of your localhost to gain access to your # Django admin app</span></pre><p id="3dff" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果一切顺利，您应该会看到:</p><figure class="ly lz ma mb gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nd"><img src="../Images/2d437ba4e4f0b9fb2dd4dd5ecb037898.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZZ_PKz6GT7S8LN_kO70EeA.jpeg"/></div></div></figure><p id="35f2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在让我们制作 Django 应用程序，它将是我们项目的主要功能核心。我们在这里所做的就是创建一个数据库来保存我们的数据，并将其公开为一个端点，这样就不再需要<strong class="kd iu"> views.py </strong>和<strong class="kd iu"> Django 模板系统</strong>了。在命令行上:</p><pre class="ly lz ma mb gt mt mu mv mw aw mx bi"><span id="e223" class="la lb it mu b gy my mz l na nb">$ python manage.py startapp songs</span></pre><p id="c63c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后将新的“歌曲”应用添加到<strong class="kd iu"> INSTALLED_APPS </strong>下的<strong class="kd iu"> settings.py </strong>:</p><pre class="ly lz ma mb gt mt mu mv mw aw mx bi"><span id="f6a2" class="la lb it mu b gy my mz l na nb">INSTALLED_APPS = [<br/>    # ...<br/>    'songs',</span><span id="93e8" class="la lb it mu b gy nc mz l na nb">]</span></pre><p id="146d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">您的项目结构现在应该是这样的:</p><figure class="ly lz ma mb gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ne"><img src="../Images/c00644ccf22f27f1b3dc5ad8c88edefe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BmTYThMxHuHyGZqaq0NJxQ.jpeg"/></div></div></figure><p id="48f7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">让我们为我们的新歌曲应用程序创建一个数据库表:</p><p id="df1b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> models.py </strong></p><pre class="ly lz ma mb gt mt mu mv mw aw mx bi"><span id="a6f3" class="la lb it mu b gy my mz l na nb"># songs/models.py</span><span id="f8f2" class="la lb it mu b gy nc mz l na nb">class NewVideo(models.Model):<br/>   MOOD_CHOICES = (<br/>   ('HAPPY', 'Happy'),<br/>   ('IN-LOVE', 'In-Love'),<br/>   ('SAD', 'Sad'),<br/>   ('CONFIDENT-SASSY', 'Confident-sassy'),<br/>   ('CHILL', 'Chill'),<br/>   ('ANGRY', 'Angry'),<br/>   )<br/>  video_title = models.TextField(db_index=True, null=True,        blank=True) </span><span id="6312" class="la lb it mu b gy nc mz l na nb">  video_id = models.CharField(max_length=11, null=False, blank=True, primary_key=True)</span><span id="fdbc" class="la lb it mu b gy nc mz l na nb">  moods = models.CharField(choices=MOOD_CHOICES, max_length=20,  default='HAPPY')<br/> <br/>  labeled = models.NullBooleanField()</span><span id="7b11" class="la lb it mu b gy nc mz l na nb">  video_description = models.TextField(null=True, blank=True)</span><span id="b443" class="la lb it mu b gy nc mz l na nb">  predicted_moods = models.CharField(max_length=17, null=True, blank=True)</span><span id="d6ed" class="la lb it mu b gy nc mz l na nb">  def __str__(self):<br/>      return self.video_title</span></pre><p id="79dd" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">你在上面看到的六种情绪[快乐、悲伤、自信、时髦、恋爱、寒冷、愤怒]将是我们的机器学习模型试图预测并最终作为 REST 端点公开的情绪。</p><p id="1abe" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这个新的视频模型也是我们为后端保存训练数据的地方。数据将来自一个 python 函数，该函数将对<a class="ae kz" href="https://developers.google.com/youtube/v3/" rel="noopener ugc nofollow" target="_blank"> YouTube v3 API </a>进行一系列调用，并自动保存到我们的数据库。</p><p id="de14" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在在<strong class="kd iu"> admin.py </strong></p><pre class="ly lz ma mb gt mt mu mv mw aw mx bi"><span id="4e26" class="la lb it mu b gy my mz l na nb"># songs/admin.py</span><span id="c2ba" class="la lb it mu b gy nc mz l na nb">from .models import NewVideo</span><span id="ac20" class="la lb it mu b gy nc mz l na nb">class NewVideoAdmin(admin.ModelAdmin):<br/> list_display = [<br/>  'video_id',<br/>  'video_title',<br/>  'moods',<br/>  'labeled',<br/>  'predicted_moods',<br/>]<br/> search_fields = [<br/>  'video_id',<br/>  'video_title',<br/>  'moods',<br/> ]<br/> list_editable = [<br/>  'moods',<br/>  'labeled',<br/> ]</span><span id="44f0" class="la lb it mu b gy nc mz l na nb">admin.site.register(NewVideo, NewVideoAdmin)</span></pre><p id="c09c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后在命令行上:</p><pre class="ly lz ma mb gt mt mu mv mw aw mx bi"><span id="c31d" class="la lb it mu b gy my mz l na nb">$ python manage.py makemigrations<br/>$ python manage.py migrate</span></pre><p id="2367" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果你已经走了这么远，拍拍自己的背，我们已经走了一半的路了。</p><p id="498f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">对于那些不熟悉 RESTful web APIs 的人来说，最简单的理解是，这只是后端 web 应用程序将其数据库公开为 JSON 的一种方式。它被认为是软件工程中最重要的发明之一，但是一旦你开始自己实现它们，它就非常容易掌握和使用。</p><p id="68db" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">为此，我们需要 Django REST 框架，我们可以将它覆盖在我们的项目之上。</p><p id="ec44" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在命令行上:</p><pre class="ly lz ma mb gt mt mu mv mw aw mx bi"><span id="6be1" class="la lb it mu b gy my mz l na nb">$ pip install djangorestframework==3.8.2</span><span id="67b2" class="la lb it mu b gy nc mz l na nb"># And add to INSTALLED_APPS on settings.py<br/>INSTALLED_APPS = [<br/>    # ...</span><span id="f908" class="la lb it mu b gy nc mz l na nb">    'rest_framework',<br/>]</span></pre><p id="6ea3" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在，我们实际上要创建一个单独的“api”应用程序，它将保存我们所有的 API 相关代码:</p><pre class="ly lz ma mb gt mt mu mv mw aw mx bi"><span id="9bcf" class="la lb it mu b gy my mz l na nb">$ python manage.py startapp api</span></pre><p id="52bb" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在 api 内部，创建一个<strong class="kd iu">serializer . py</strong>文件:</p><pre class="ly lz ma mb gt mt mu mv mw aw mx bi"><span id="2647" class="la lb it mu b gy my mz l na nb"># api/serializers.py</span><span id="fac3" class="la lb it mu b gy nc mz l na nb">from rest_framework import serializers</span><span id="faef" class="la lb it mu b gy nc mz l na nb">from songs.models import NewVideo</span><span id="7786" class="la lb it mu b gy nc mz l na nb">class NewVideoSerializer(serializers.ModelSerializer):<br/> class Meta:<br/>  model = NewVideo<br/>  fields = [<br/>   'video_title',<br/>   'video_id',<br/>   'moods',<br/>  ]</span></pre><p id="9f2b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后在你的<strong class="kd iu">views . py</strong>API app 里面:</p><pre class="ly lz ma mb gt mt mu mv mw aw mx bi"><span id="d499" class="la lb it mu b gy my mz l na nb"># api/views.py</span><span id="4a32" class="la lb it mu b gy nc mz l na nb">from django.shortcuts import render</span><span id="b9e3" class="la lb it mu b gy nc mz l na nb">from rest_framework import generics</span><span id="25d0" class="la lb it mu b gy nc mz l na nb">from songs.models import NewVideo</span><span id="0f74" class="la lb it mu b gy nc mz l na nb">from .serializers import NewVideoSerializer</span><span id="e4e3" class="la lb it mu b gy nc mz l na nb"># Create your views here.</span><span id="90b7" class="la lb it mu b gy nc mz l na nb">class NewVideoAPIView(generics.ListCreateAPIView):<br/> queryset = NewVideo.objects.all()<br/> serializer_class = NewVideoSerializer</span></pre><p id="9cc0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在在 api 应用程序中创建一个<strong class="kd iu"> urls.py </strong>,并且:</p><pre class="ly lz ma mb gt mt mu mv mw aw mx bi"><span id="0299" class="la lb it mu b gy my mz l na nb"># api/urls.py</span><span id="bf9e" class="la lb it mu b gy nc mz l na nb">from django.conf.urls import url</span><span id="72c3" class="la lb it mu b gy nc mz l na nb">from .views import NewVideoAPIView</span><span id="6e01" class="la lb it mu b gy nc mz l na nb">urlpatterns = [<br/> url(r'^new-videos/$', NewVideoAPIView.as_view()),<br/>]</span></pre><p id="ea53" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后在你的 urls.py 里面的项目配置文件夹(music_selector):</p><pre class="ly lz ma mb gt mt mu mv mw aw mx bi"><span id="84f2" class="la lb it mu b gy my mz l na nb"># music_selector/urls.py</span><span id="5f20" class="la lb it mu b gy nc mz l na nb">from django.conf.urls import url, include<br/>from django.contrib import admin</span><span id="2f6c" class="la lb it mu b gy nc mz l na nb">urlpatterns = [<br/>    url(r'^admin/', admin.site.urls),<br/>    url(r'^api/', include('api.urls', namespace='api')),</span><span id="5e7f" class="la lb it mu b gy nc mz l na nb">]</span></pre><p id="7b61" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在转到 Django 管理员，通过插入一些数据创建一个新的视频对象:</p><figure class="ly lz ma mb gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nf"><img src="../Images/243d3076fcc7b99b6ee7adfcbcf76f9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nNjvU_rLJ9RtFrQuq2x9Gg.jpeg"/></div></div></figure><p id="a91a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在运行您的本地服务器，并在浏览器上转到该端点:</p><pre class="ly lz ma mb gt mt mu mv mw aw mx bi"><span id="ddbf" class="la lb it mu b gy my mz l na nb">$ python manage.py runserver</span><span id="8c0c" class="la lb it mu b gy nc mz l na nb"># Point your browser to <a class="ae kz" href="http://127.0.0.1:8000/api/new-videos/" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:8000/api/new-videos/</a></span></pre><p id="1d57" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">Django REST 框架最棒的特性之一是它的可浏览 API，如果一切顺利，应该是这样的:</p><figure class="ly lz ma mb gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ng"><img src="../Images/9f961afb307613943f2b67e984b8b0ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UmDig1QP1HkEADdYO0rwoA.jpeg"/></div></div></figure><p id="4999" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">祝贺您——您已经创建了一个 RESTful 端点！</p><p id="9c65" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">创建这个的重要性在于，我们现在可以以一种方式公开我们的数据，这种方式可以作为 API 被 React-made FrontEnds 之类的东西消费，这正是我们在 MoodiBeats 项目中所做的。</p><h2 id="8464" class="la lb it bd lc ld le dn lf lg lh dp li km lj lk ll kq lm ln lo ku lp lq lr ls bi translated"><strong class="ak">第四部分:让我们创建一个训练数据集</strong></h2><p id="6e60" class="pw-post-body-paragraph kb kc it kd b ke lt kg kh ki lu kk kl km lv ko kp kq lw ks kt ku lx kw kx ky im bi translated">Django 最酷的部分之一是能够创建所谓的管理命令——管理员用户可以在命令行上运行的功能:</p><pre class="ly lz ma mb gt mt mu mv mw aw mx bi"><span id="cf05" class="la lb it mu b gy my mz l na nb">$ python manage.py do_something</span></pre><p id="edcf" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">对于 MoodiBeats 的数据科学部分，我们需要一个从 YouTube API 获取数据并填充数据库的函数。为了做到这一点，我们在 Django 中创建了一个管理命令来获取 video_id 和 video_title，并在我们的 Heroku 服务器上设置了一个名为 Heroku Scheduler 的东西，每 24 小时运行一次相同的功能——有效地创建了所谓的<em class="nh"> Cron 作业</em>。</p><p id="ad48" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">为此，您必须完成以下步骤:</p><ol class=""><li id="eca6" class="me mf it kd b ke kf ki kj km mg kq mh ku mi ky mj mk ml mm bi translated">在歌曲应用程序中创建一个名为<strong class="kd iu">管理</strong>的文件夹</li><li id="d9dd" class="me mf it kd b ke mn ki mo km mp kq mq ku mr ky mj mk ml mm bi translated">在管理内部创建一个名为<strong class="kd iu"> __init__ 的文件。py </strong></li><li id="deb6" class="me mf it kd b ke mn ki mo km mp kq mq ku mr ky mj mk ml mm bi translated">同样在管理内部创建另一个名为<strong class="kd iu">命令</strong>的文件夹</li><li id="25f0" class="me mf it kd b ke mn ki mo km mp kq mq ku mr ky mj mk ml mm bi translated">然后在命令内部创建另一个名为<strong class="kd iu"> __init__ 的文件。py </strong></li><li id="5dfc" class="me mf it kd b ke mn ki mo km mp kq mq ku mr ky mj mk ml mm bi translated">最后，在命令内部，创建一个名为<strong class="kd iu"> get_new_videos.py </strong>的文件</li><li id="3835" class="me mf it kd b ke mn ki mo km mp kq mq ku mr ky mj mk ml mm bi translated">给自己弄一个<a class="ae kz" href="https://developers.google.com/youtube/v3/getting-started" rel="noopener ugc nofollow" target="_blank"> YouTube v3 API 密匙</a></li><li id="84ba" class="me mf it kd b ke mn ki mo km mp kq mq ku mr ky mj mk ml mm bi translated">$ pip 安装 python-dotenv</li></ol><p id="221e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果您确实想要运行这个管理命令，请确保您已经安装了 python-dotenv。然后在您的顶层目录中，创建一个名为<strong class="kd iu">的文件。env </strong>你想在这里存储 SECRET_KEY 或者 YouTube API Key 之类的东西，然后添加。env 到你的。gitignore 文件。如果你想把你的项目提交给 GitHub Repo，你需要做这些事情。</p><p id="3ad7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">记住，永远不要把 API 密匙之类的东西或者任何私人的东西放到你的 GitHub Repo 或者任何公共场所。如果你这么做了，你就冒着非常糟糕的事情从非常糟糕的人那里发生的风险。</strong></p><p id="164a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> get_new_videos.py </strong></p><pre class="ly lz ma mb gt mt mu mv mw aw mx bi"><span id="2975" class="la lb it mu b gy my mz l na nb"># Credit goes to my data science teammate John Humphreys. for writing <br/># this function</span><span id="648f" class="la lb it mu b gy nc mz l na nb">from django.core.management.base import BaseCommand</span><span id="d917" class="la lb it mu b gy nc mz l na nb">from googleapiclient.discovery import build<br/>from dotenv import load_dotenv<br/>import os</span><span id="83a9" class="la lb it mu b gy nc mz l na nb">import json</span><span id="3b21" class="la lb it mu b gy nc mz l na nb">from songs.models import NewVideo</span><span id="66b0" class="la lb it mu b gy nc mz l na nb">load_dotenv()</span><span id="45eb" class="la lb it mu b gy nc mz l na nb">def html_reverse_escape(string):<br/>    '''Reverse escapes HTML code in string into ASCII text.'''<br/>    # see Ned Batchelder post <a class="ae kz" href="https://stackoverflow.com/questions/2077283/escape-special-html-characters-in-python" rel="noopener ugc nofollow" target="_blank">https://stackoverflow.com/questions/2077283/escape-special-html-characters-in-python</a><br/>    return (string \<br/>        .replace("&amp;amp;", "&amp;").replace("&amp;#39;", "'").replace("&amp;quot;", '"'))</span><span id="5ca1" class="la lb it mu b gy nc mz l na nb">def search_api():<br/>    '''Searches YouTube Data API v3 for videos based on project-specified parameters; returns list of videos.'''<br/>    api_service_name = 'youtube'<br/>    api_version = 'v3'<br/>    DEVELOPER_KEY = os.getenv('DEVELOPER_KEY')</span><span id="fdc3" class="la lb it mu b gy nc mz l na nb">youtube = build(api_service_name, api_version,<br/>                    developerKey = DEVELOPER_KEY)</span><span id="4dad" class="la lb it mu b gy nc mz l na nb">request = youtube.search().list(<br/>        part='id,snippet',<br/>        maxResults=20,<br/>        q='instrumental edm',<br/>        relevanceLanguage='en',<br/>        type='video',<br/>        videoDuration='medium',<br/>        videoLicense='creativeCommon',<br/>        videoSyndicated='true',<br/>    ).execute()</span><span id="5ff7" class="la lb it mu b gy nc mz l na nb">videos = []<br/>result_count = 0</span><span id="9efc" class="la lb it mu b gy nc mz l na nb">for search_result in request['items']:<br/>        video_title = search_result['snippet']['title']<br/>        video_title = html_reverse_escape(video_title)<br/>        video_id = search_result['id']['videoId']<br/>        video_description = search_result['snippet']['description']</span><span id="2f19" class="la lb it mu b gy nc mz l na nb">       try:<br/>            new_videos = NewVideo(video_id=video_id,      video_title=video_title, video_description=video_description, predicted_moods=predicted_moods)</span><span id="4be1" class="la lb it mu b gy nc mz l na nb">new_videos.save()<br/>        except:<br/>            pass</span><span id="d12b" class="la lb it mu b gy nc mz l na nb">class Command(BaseCommand):<br/>    def handle(self, *args, **options):<br/>        print("Pulling data from YouTube API and saving")<br/>        search_api()</span></pre><p id="9d00" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果您研究一下这个函数，它被设置为从 YouTube API 检索最多 20 个结果。我们特意将<code class="fe ni nj nk mu b">q</code>设置为“乐器 edm ”,将<code class="fe ni nj nk mu b">videoLicense</code>设置为“creativeCommons ”,因为我们只想要没有版权的音乐视频。</p><p id="f1c5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">让我们运行命令</p><pre class="ly lz ma mb gt mt mu mv mw aw mx bi"><span id="de4c" class="la lb it mu b gy my mz l na nb">$ python manage.py get_new_videos</span></pre><p id="295d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在运行你的本地 Django 服务器，回到你的管理员那里。</p><p id="4604" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">您应该会看到类似这样的内容:</p><figure class="ly lz ma mb gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nf"><img src="../Images/94b64adeb29c38e103a73e1a74354589.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qg1Lps56ortgJw-WDCv5Sw.jpeg"/></div></div></figure><p id="9dd4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果您单击 video_id 进入详细视图，您应该会在 description 字段中看到视频描述。</p><p id="a570" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在大约 7 天的时间里用不同的查询参数做这件事，最终给了我们一个超过 1000 首歌曲的数据库。</p><p id="053b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在我们进入项目的数据科学部分之前，为了完成一个训练集，你需要做的是给你的数据贴上标签。这对我来说是一个突然的觉醒，因为我最终给 800 多个 YouTube 视频贴上了“正确”情绪的标签。</p><p id="0b6b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我给数据科学学生的建议是:不要习惯 UCI 数据仓库。</p><h2 id="68ab" class="la lb it bd lc ld le dn lf lg lh dp li km lj lk ll kq lm ln lo ku lp lq lr ls bi translated">第五部分:数据科学时代的到来</h2><p id="5ff8" class="pw-post-body-paragraph kb kc it kd b ke lt kg kh ki lu kk kl km lv ko kp kq lw ks kt ku lx kw kx ky im bi translated">我们将使用数据科学工具，因此请确保您的虚拟环境中安装了 Conda(我建议使用 miniconda)、Jupyter、Pandas 和 Scikit-Learn 等工具。</p><p id="5894" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在我们终于有了数据，是时候将它们转换成我们开始时期望的整洁的小 CSV 文件了。</p><p id="7f80" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们将连接到 postgreSQL 数据库，查看一下表模式，然后运行一个简单的复制命令，复制到桌面上我创建的名为 CSV 的文件夹中。</p><pre class="ly lz ma mb gt mt mu mv mw aw mx bi"><span id="3380" class="la lb it mu b gy my mz l na nb">$ psql -d postgres</span><span id="9d96" class="la lb it mu b gy nc mz l na nb">postgres=# \c moodibeats;</span><span id="0c64" class="la lb it mu b gy nc mz l na nb">moodibeats=# \dt</span><span id="76ff" class="la lb it mu b gy nc mz l na nb">moodibeats=# SELECT * FROM songs_newvideo LIMIT 5;</span><span id="9c3c" class="la lb it mu b gy nc mz l na nb">\copy songs_newvideo(video_id,video_title,moods,labeled,video_description,predicted_moods) TO '/Users/sammylee/desktop/CSV/videos.csv' DELIMITER ',' CSV HEADER;</span></pre><p id="c681" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在启动你的 Jupyter 笔记本，导入熊猫，看看数据:</p><pre class="ly lz ma mb gt mt mu mv mw aw mx bi"><span id="cf3c" class="la lb it mu b gy my mz l na nb"># In the same directory which contains your 'videos.csv' file<br/>$ jupyter notebook</span></pre><p id="2e2c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后</p><pre class="ly lz ma mb gt mt mu mv mw aw mx bi"><span id="a899" class="la lb it mu b gy my mz l na nb">import pandas</span><span id="6568" class="la lb it mu b gy nc mz l na nb">videos = pd.read_csv('videos.csv', encoding='utf-8')</span><span id="31df" class="la lb it mu b gy nc mz l na nb">video.head()</span></pre><figure class="ly lz ma mb gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nl"><img src="../Images/8c141af46764f9c606cf3eb54872413a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aU0vzGazDOwShPGsk1HVHw.jpeg"/></div></div></figure><p id="5f79" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">当然，在我的例子中，我们有更多的数据，其中大多数都有标签，但这正是我们想要的。</p><p id="2141" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">让我们回顾一下迄今为止我们所取得的成就:</p><ol class=""><li id="f21f" class="me mf it kd b ke kf ki kj km mg kq mh ku mi ky mj mk ml mm bi translated">我们构建了我们的问题(基于内容的过滤)，并制定了一个计划来为数据科学构建 Django 后端，供 React 前端使用。</li><li id="cdc8" class="me mf it kd b ke mn ki mo km mp kq mq ku mr ky mj mk ml mm bi translated">然后，我们使用 Django REST 框架构建了后端</li><li id="98cb" class="me mf it kd b ke mn ki mo km mp kq mq ku mr ky mj mk ml mm bi translated">利用 YouTube v3 API 检索数据</li></ol><p id="31e9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们已经有效地为 MoodiBeats 的数据科学部分创建了一个第一通道的迷你管道。</p><p id="9e82" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们还需要记住，我们使用文本数据进行分析，这意味着我们需要使用不同的工具来进行机器学习。</p><p id="2cb4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这些不同工具中最重要的是单词袋模型，它允许我们将文本表示为数字向量。单词袋模型基本上是一个两步过程，首先是<a class="ae kz" href="https://nlp.stanford.edu/IR-book/html/htmledition/tokenization-1.html" rel="noopener ugc nofollow" target="_blank"> <strong class="kd iu">对文本文档</strong> </a> <strong class="kd iu"> </strong>进行标记，然后将它们转换为字数的特征向量。</p><p id="40d2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">例如</p><pre class="ly lz ma mb gt mt mu mv mw aw mx bi"><span id="a50c" class="la lb it mu b gy my mz l na nb">"""This is taken straight out of Sebastian Raschka &amp; Vahid Mirjalili's Python Machine Learning 2nd Edition, and in fact this project owes a debt of gratitude to their chapter 8 on Sentiment Analysis"""</span><span id="0388" class="la lb it mu b gy nc mz l na nb">import numpy as np<br/>from sklearn.feature_extraction.text import CountVectorizer<br/>count = CountVectorizer()<br/>docs = np.array([<br/>    'The sun is shining',<br/>    'The weather is sweet',<br/>    'The sun is shining and the weather is sweet'])<br/>bag = count.fit_transform(docs)</span><span id="9cd7" class="la lb it mu b gy nc mz l na nb"># print out the vocabulary of our bag-of-words:<br/>print(count.vocaulary_)</span></pre><p id="5478" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这将返回包含唯一单词及其索引位置的 Python 字典:</p><pre class="ly lz ma mb gt mt mu mv mw aw mx bi"><span id="fcf5" class="la lb it mu b gy my mz l na nb">{'the': 5, 'sun': 3, 'is': 1, 'shining': 2, 'weather': 6, 'sweet': 4, 'and': 0}</span></pre><p id="fa18" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">此外，我们可以看到单词袋模型为我们创建的特征向量:</p><pre class="ly lz ma mb gt mt mu mv mw aw mx bi"><span id="696d" class="la lb it mu b gy my mz l na nb">print(bag.toarray())</span><span id="abb2" class="la lb it mu b gy nc mz l na nb"># Returns<br/>[[0 1 1 1 0 1 0]<br/> [0 1 0 0 1 1 1]<br/> [1 2 1 1 1 2 1]]</span></pre><p id="644b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">此数组的第一列[0，0，1]位于索引位置 0，表示单词“and”，它只出现在第三个句子中，因此为[0，0，1]。第二列[1，1，2]代表‘是’，我们可以看到‘是’在前两句出现一次，在最后一句出现两次。</p><p id="f022" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们需要的第二个工具是实际的机器学习算法。对于 MoodiBeats，我们选择了一个逻辑回归分类器。</p><figure class="ly lz ma mb gt ju gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/b623879df9f8b7062fc51306e727c98e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bmzxomrAZ5vHBAQ72T7_oA.png"/></div><figcaption class="nn no gj gh gi np nq bd b be z dk">Sigmoid function for Logistic regression</figcaption></figure><p id="7ac8" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们本质上正在做的是通过获取关于 YouTube 音乐视频的元数据(在这种情况下是文本形式的视频描述)并使用它来预测视频本身的情绪，来建立一个非个性化的基于内容的过滤推荐系统。逻辑回归试图根据样本的概率函数对样本进行分类，概率函数是一种称为 sigmoid 函数的 S 形函数。阈值设置为 0.5，超过该阈值的概率被分类为 1，低于该阈值的概率被分类为 0。在视频描述的数字表示上使用这种方法允许我们找到情绪的概率，并选择概率最高的一个作为我们的预测(<a class="ae kz" href="https://stats.stackexchange.com/questions/167623/understanding-the-one-vs-the-rest-classifier" rel="noopener ugc nofollow" target="_blank"> One-vs-Rest method </a>)。</p><p id="7e07" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">另一个重要的考虑是，当处理文本数据时，几乎总是会处理脏数据 HMTL、表情符号、标点符号等。我们还将编写一个函数来预处理脏数据。因此，在这里，我们将文本清理和文本标记化结合起来，为我们提供数据，然后我们可以在这些数据上运行逻辑回归分类器。</p><pre class="ly lz ma mb gt mt mu mv mw aw mx bi"><span id="954f" class="la lb it mu b gy my mz l na nb">"""A simple text cleaning function borrowed from Sebastian Rachska""" </span><span id="1a6f" class="la lb it mu b gy nc mz l na nb">import re</span><span id="a987" class="la lb it mu b gy nc mz l na nb">from nltk.corpus import stopwords</span><span id="aad7" class="la lb it mu b gy nc mz l na nb">stop = stopwords.words('english')</span><span id="ec6e" class="la lb it mu b gy nc mz l na nb">def tokenizer(text):<br/>    text = re.sub('&lt;[^&gt;]*&gt;', '', str(text))<br/>    emoticons = re.findall('(?::|;|=)(?:-)?(?:\)|\(|D|P)', text.lower())<br/>    text = re.sub('[\W]+', ' ', text.lower()) +\<br/>        ' '.join(emoticons).replace('-', '')<br/>    tokenized = [w for w in text.split() if w not in stop]<br/>    return tokenized</span></pre><p id="32d1" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">实际训练之前的下一步是对我们的目标变量进行编码，也就是说将我们的情绪(快乐、自信、时髦、悲伤、愤怒、寒冷、恋爱)转化为我们的算法可以使用的数字。</p><p id="ffba" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">在这里，我们假设你已经在 Django admin 中浏览了你的数据，观看了所有的 YouTube 音乐视频，并在将它们发送到熊猫数据帧作为训练数据进行分析之前正确地标记了它们。</strong></p><pre class="ly lz ma mb gt mt mu mv mw aw mx bi"><span id="8b2d" class="la lb it mu b gy my mz l na nb">from sklearn import preprocessing</span><span id="0e5a" class="la lb it mu b gy nc mz l na nb">le = preprocessing.LabelEncoder()</span><span id="af3b" class="la lb it mu b gy nc mz l na nb">videos['moods_enc'] = le.fit_transform(videos['moods'])<br/>df.head()</span></pre><p id="5090" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">以下是我们最终培训的核心内容:</p><pre class="ly lz ma mb gt mt mu mv mw aw mx bi"><span id="ab61" class="la lb it mu b gy my mz l na nb">from sklearn.feature_extraction.text import HashingVectorizer<br/>from sklearn.model_selection import GridSearchCV<br/>from sklearn.linear_model import LogisticRegression</span><span id="2fc7" class="la lb it mu b gy nc mz l na nb">vect = HashingVectorizer(decode_error='ignore',<br/>                        n_features=2**21,<br/>                        preprocessor=None,<br/>                        tokenizer=tokenizer)</span><span id="f4f6" class="la lb it mu b gy nc mz l na nb">param_grid = {'C': [0.001, 0.01, 0.1, 1, 10, 100]}</span><span id="f7f3" class="la lb it mu b gy nc mz l na nb">lr = LogisticRegression()</span><span id="1670" class="la lb it mu b gy nc mz l na nb">grid_search = GridSearchCV(lr, param_grid, cv=5)</span><span id="4133" class="la lb it mu b gy nc mz l na nb">X_train = vect.transform(X_train.tolist())</span><span id="afe8" class="la lb it mu b gy nc mz l na nb">grid_search.fit(X_train, y_train)</span><span id="a398" class="la lb it mu b gy nc mz l na nb">X_test = vect.transform(X_test)</span><span id="0cc1" class="la lb it mu b gy nc mz l na nb">print('Test set accuracy: {:.3f}'.format(grid_search.score(X_test, y_test)))</span><span id="2f08" class="la lb it mu b gy nc mz l na nb">print("Best parameters: {}".format(grid_search.best_params_))</span><span id="c106" class="la lb it mu b gy nc mz l na nb">print("Best cross-validation score: {:.2f}".format(grid_search.best_score_))</span></pre><p id="a520" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在我们更大的 YouTube API 数据集上训练这个模型给了我们:</p><pre class="ly lz ma mb gt mt mu mv mw aw mx bi"><span id="4631" class="la lb it mu b gy my mz l na nb">Test set accuracy: 0.368<br/>Best parameters: {'C': 10}<br/>Best cross-validation score: 0.42</span></pre><p id="e3c7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">虽然这些结果不是很好，但由于我们的项目处于功能冻结状态，我们基本上没有时间收集更多的数据并重新训练我们的模型。事实上，在我写这些文字的时候，离我们向全校做报告只有一个小时了。</p><p id="59d7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">下一个挑战是将模型投入生产。</p><p id="c186" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们所做的是通过在 Django 应用程序中插入我们训练过的模型来自动化这个过程，以作为管理命令运行:</p><pre class="ly lz ma mb gt mt mu mv mw aw mx bi"><span id="07a6" class="la lb it mu b gy my mz l na nb">$ python manage.py get_new_videos</span></pre><p id="aae4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">您可以在生产中的 Heroku 调度程序上将该函数设置为 Cron 作业，以便在调用 YouTube API 的同时自动运行您的预测。为了简洁起见，我将跳过这一部分，但是如果你想了解它，请在评论中告诉我。</p><h2 id="9966" class="la lb it bd lc ld le dn lf lg lh dp li km lj lk ll kq lm ln lo ku lp lq lr ls bi translated">第六部分:经验教训</h2><p id="c520" class="pw-post-body-paragraph kb kc it kd b ke lt kg kh ki lu kk kl km lv ko kp kq lw ks kt ku lx kw kx ky im bi translated">看看这首歌</p><figure class="ly lz ma mb gt ju"><div class="bz fp l di"><div class="mc md l"/></div><figcaption class="nn no gj gh gi np nq bd b be z dk">An awesome band I discovered as a freshman in college</figcaption></figure><p id="5704" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果我要求把这归类为我们的六种情绪之一:</p><pre class="ly lz ma mb gt mt mu mv mw aw mx bi"><span id="350f" class="la lb it mu b gy my mz l na nb">[HAPPY, CHILL, CONFIDENT-SASSY, SAD, ANGRY, IN-LOVE]</span></pre><p id="896e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我敢肯定，你们大多数人会回答说，这首歌清楚地表达了愤怒，达到了愤怒的程度。</p><p id="d20d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">但是如果我给你这样的东西呢:</p><figure class="ly lz ma mb gt ju"><div class="bz fp l di"><div class="nr md l"/></div></figure><p id="30c1" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这是怎么回事？</p><p id="3a2f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">普通观众水平的歌曲有两个维度(歌曲、歌词)，但音乐视频有三个维度(歌曲、歌词、视觉)。</p><p id="e052" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">乍一听，这首歌听起来很冷。视觉效果有点傻(看看所有关于小预算和绿色屏幕的评论)。</p><p id="4e5e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在来看看这首歌的一些歌词:</p><pre class="ly lz ma mb gt mt mu mv mw aw mx bi"><span id="a344" class="la lb it mu b gy my mz l na nb">[Verse 1: Ed Sheeran]<br/>I’m at a party I don’t wanna be at<br/>And I don’t ever wear a suit and tie, yeah<br/>Wonderin’ if I could sneak out the back<br/>Nobody’s even lookin’ me in my eyes<br/>Can you take my hand?<br/>Finish my drink, say, “Shall we dance?” (Hell, yeah)<br/>You know I love ya, did I ever tell ya?<br/>You make it better like that</span><span id="e21e" class="la lb it mu b gy nc mz l na nb">[Pre-Chorus: Ed Sheeran]<br/>Don’t think I fit in at this party<br/>Everyone’s got so much to say (Yeah)<br/>I always feel like I’m nobody, mmm<br/>Who wants to fit in anyway?</span><span id="9418" class="la lb it mu b gy nc mz l na nb">[Chorus: Ed Sheeran]<br/>‘Cause I don’t care when I’m with my baby, yeah<br/>All the bad things disappear<br/>And you’re making me feel like maybe I am somebody<br/>I can deal with the bad nights<br/>When I’m with my baby, yeah<br/>Ooh, ooh, ooh, ooh, ooh, ooh<br/>‘Cause I don’t care as long as you just hold me near<br/>You can take me anywhere<br/>And you’re making me feel like I’m loved by somebody<br/>I can deal with the bad nights<br/>When I’m with my baby, yeah<br/>Ooh, ooh, ooh, ooh, ooh, ooh</span><span id="194e" class="la lb it mu b gy nc mz l na nb">[Verse 2: Justin Bieber]<br/>We at a party we don’t wanna be at<br/>Tryna talk, but we can’t hear ourselves<br/>Press your lips, I’d rather kiss ’em right back<br/>With all these people all around<br/>I’m crippled with anxiety<br/>But I’m told it’s where we’re s’posed to be<br/>You know what? It’s kinda crazy ’cause I really don’t mind<br/>And you make it better like that</span><span id="679a" class="la lb it mu b gy nc mz l na nb">[Pre-Chorus: Justin Bieber]<br/>Don’t think we fit in at this party<br/>Everyone’s got so much to say, oh yeah, yeah<br/>When we walked in, I said I’m sorry, mmm<br/>But now I think that we should stay</span></pre><p id="dba2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这首歌真的很寒意吗？难过？或者甚至是恋爱中？</p><p id="6ed3" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">你如何让一台机器学习像恋爱这样复杂的情感？爱情是人类情感的那不勒斯冰淇淋。有一种幸福的爱情，一切都很顺利，两个人都无法忍受彼此分离。有一种单相思，只有一个人感受到它的情感。甚至有一种爱是为结婚很久的夫妇保留的，在那里事情不是疯狂的，而是稳定的。</p><p id="601a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">情绪是超级主观的，因此对于机器来说是一个超级难解决的问题。但是非常有趣。</p><h2 id="6e14" class="la lb it bd lc ld le dn lf lg lh dp li km lj lk ll kq lm ln lo ku lp lq lr ls bi translated">第七部分:致谢</h2><p id="a4a5" class="pw-post-body-paragraph kb kc it kd b ke lt kg kh ki lu kk kl km lv ko kp kq lw ks kt ku lx kw kx ky im bi translated">我要感谢我在 Lambda 学校 MoodiBeats 项目中的队友:</p><p id="58bf" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">Jonathan Bernal、John Humphreys、史云光 Jake de los Santos、医学博士 Kawsar Hussen、Logan Hufstetler、Davina Taylor 和我们的项目经理 Kevin Brack。</p><p id="826d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">搭建 MoodiBeats 是我在 Lambda 学校经历的最好、最有趣的经历之一。我们的团队太棒了，我不会忘记这次经历。</p><p id="b85c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这篇文章的代码在这里:</p><div class="ns nt gp gr nu nv"><a href="https://github.com/Captmoonshot/moodibeats_api_medium" rel="noopener  ugc nofollow" target="_blank"><div class="nw ab fo"><div class="nx ab ny cl cj nz"><h2 class="bd iu gy z fp oa fr fs ob fu fw is bi translated">captmoonshot/moodibeats _ API _ medium</h2><div class="oc l"><h3 class="bd b gy z fp oa fr fs ob fu fw dk translated">对于中等职位。在 GitHub 上创建一个帐号，为 Captmoonshot/moodibeats _ API _ medium 开发做贡献。</h3></div><div class="od l"><p class="bd b dl z fp oa fr fs ob fu fw dk translated">github.com</p></div></div><div class="oe l"><div class="of l og oh oi oe oj jz nv"/></div></div></a></div></div></div>    
</body>
</html>