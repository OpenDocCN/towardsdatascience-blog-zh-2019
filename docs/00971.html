<html>
<head>
<title>Mastering Fast Gradient Boosting on Google Colaboratory with free GPU</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用免费 GPU 在 Google Colaboratory 上掌握快速梯度提升</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/mastering-fast-gradient-boosting-on-google-colaboratory-with-free-gpu-65c1dd47d1c5?source=collection_archive---------8-----------------------#2019-02-14">https://towardsdatascience.com/mastering-fast-gradient-boosting-on-google-colaboratory-with-free-gpu-65c1dd47d1c5?source=collection_archive---------8-----------------------#2019-02-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/cddf41053a9a62e7bdb435329686abcd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1250/0*GbTTuetDGgWYaFD0"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk">On the photo NVIDIA K80 GPU, <a class="ae jy" href="https://www.nvidia.com/ru-ru/data-center/tesla-k80/" rel="noopener ugc nofollow" target="_blank">https://www.nvidia.com/ru-ru/data-center/tesla-k80/</a></figcaption></figure><p id="6731" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated"><strong class="kb ir">决策树上的梯度推进</strong> (GBDT)是一个最先进的机器学习工具，用于处理异构或结构化数据。处理数据时，完美算法的选择在很大程度上取决于数据的类型。对于同类数据，如图像、声音或文本，最佳解决方案是神经网络。对于结构化数据，例如信用评分、推荐或任何其他表格数据，最佳解决方案是 GBDT。</p><p id="55fc" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">正因如此，<a class="ae jy" href="https://www.kaggle.com/" rel="noopener ugc nofollow" target="_blank"> Kaggle </a>比赛的大量获奖方案都是基于 GBDT。GBDT 也大量用于不同的推荐系统、搜索引擎和许多金融机构。</p><p id="6e6c" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">许多人认为 GBDT 无法通过 GPU 有效加速，但事实并非如此。在这篇文章中，我解释了如何使用 GPU 加速 GBDT。</p><p id="9fa9" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">对于 GBDT 实现，我将使用<a class="ae jy" href="http://catboost.ai" rel="noopener ugc nofollow" target="_blank"> <strong class="kb ir"> CatBoost </strong> </a>。CatBoost 以其分类特性支持和高效的 GPU 实现而闻名。它不仅适用于分类数据，而且适用于任何数据，在许多情况下，它的性能优于其他 GBDT 图书馆。</p><p id="9777" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">该库是为领先的俄罗斯科技公司<a class="ae jy" href="https://yandex.com" rel="noopener ugc nofollow" target="_blank"> Yandex </a>的生产需求开发的，后来大约一年半前在<a class="ae jy" href="https://en.wikipedia.org/wiki/Apache_License" rel="noopener ugc nofollow" target="_blank"> Apache 2 许可</a>下开源。</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div class="gh gi kx"><img src="../Images/3d6d90b8292e08dfa7b92e0ca2c6198f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1118/0*RUe8KwcFZ90kh3-q"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk">C<a class="ae jy" href="http://catboost.ai" rel="noopener ugc nofollow" target="_blank">atBoost</a></figcaption></figure><p id="452b" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">我的演示的测试环境将是<a class="ae jy" href="https://colab.research.google.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="kb ir"> Google 联合实验室</strong> </a>。这是一个免费访问 GPU 运行时的机器学习研究工具。这是一个 Jupyter 笔记本电脑环境，不需要设置即可使用。</p><p id="7527" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">谷歌合作实验室免费提供相当老的 GPU——一个大约 11GB 内存的特斯拉 K80 GPU。随着新的 GPU，速度的提高将更加显著。但即使使用这种旧的 GPU，你也会看到令人印象深刻的速度差异。</p><p id="fbbb" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">下面你会发现在 Colab 中设置 CatBoost 的几个简单步骤，下载数据集，在 CPU 和 GPU 上训练模型，以及比较执行时间。</p><h1 id="d18e" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">创建笔记本</h1><p id="da1e" class="pw-post-body-paragraph jz ka iq kb b kc ma ke kf kg mb ki kj kk mc km kn ko md kq kr ks me ku kv kw ij bi translated">导航到<a class="ae jy" href="https://colab.research.google.com" rel="noopener ugc nofollow" target="_blank">协同实验室</a>并创建一个新的 Python 3 笔记本。</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi mf"><img src="../Images/59776e972c1f0ec7da9466b41d9fd443.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*zjJtPkj_cM_Hn2V3"/></div></div></figure><h1 id="c0a8" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">将 GPU 设置为硬件加速器</h1><p id="df37" class="pw-post-body-paragraph jz ka iq kb b kc ma ke kf kg mb ki kj kk mc km kn ko md kq kr ks me ku kv kw ij bi translated">选择 GPU 作为硬件加速器有两个简单的步骤:</p><p id="104d" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">第一步。导航到“运行时”菜单并选择“更改运行时类型”</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/3f91e970b5ce6887a24d9d61af8411e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:956/0*WwOvTDo-F-I3pDic"/></div></figure><p id="8da2" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">第二步。选择“GPU”作为硬件加速器。</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/4d7c41bd3b8a240b8f439660fea5ca7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:882/0*VCcq1qoDT76Y5pS1"/></div></figure><h1 id="cce8" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">导入 CatBoost</h1><p id="d4e3" class="pw-post-body-paragraph jz ka iq kb b kc ma ke kf kg mb ki kj kk mc km kn ko md kq kr ks me ku kv kw ij bi translated">下一步是在环境中导入 CatBoost。大多数库都可以通过简单的<em class="mm">快速安装在 Colaboratyro 中！pip 安装</em>命令。</p><p id="8752" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">请注意，每次启动新的 Colab 会话时，都需要重新导入库。</p><blockquote class="mn mo mp"><p id="b7f1" class="jz ka mm kb b kc kd ke kf kg kh ki kj mq kl km kn mr kp kq kr ms kt ku kv kw ij bi translated"><em class="iq">！pip 安装 catboost </em></p></blockquote><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi mt"><img src="../Images/fcd3e903ddc5dcee285b75caf7896b56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ym67Ilbso193QzcK"/></div></div></figure><p id="7d2f" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">从 pypi 安装的 CatBoost 库支持 GPU，因此您可以直接使用它。要让它在你的机器上工作，你只需要安装一个 NVIDIA 驱动程序，其他一切都可以开箱即用。对于 Windows 来说也是如此，这使得想要在 GPU 上训练模型的 Windows 用户更加容易。</p><h1 id="be06" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">下载并准备数据集</h1><p id="4311" class="pw-post-body-paragraph jz ka iq kb b kc ma ke kf kg mb ki kj kk mc km kn ko md kq kr ks me ku kv kw ij bi translated">是时候编码了！配置好环境后，下一步是下载和准备数据集。对于 GPU 训练来说，数据集越大，加速就越大。对一千个样本或更少的数据集使用 GPU 训练没有太大意义，但从大约 10，000 个样本开始，你将获得很好的加速。</p><p id="ca6a" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">我们需要一个大型数据集来展示 GPU 在 GBDT 任务中的能力。我们将使用<a class="ae jy" href="https://www.csie.ntu.edu.tw/~cjlin/libsvmtools/datasets/binary.html" rel="noopener ugc nofollow" target="_blank"> Epsilon </a>，它有 50 万个样本和 2000 个特征，包含在 catboost.datasets 中</p><p id="cb01" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">下面的代码下载数据集大约需要 10-15 分钟。请耐心等待。</p><figure class="ky kz la lb gt jr"><div class="bz fp l di"><div class="mu mv l"/></div></figure><h1 id="3da3" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">CPU 培训</h1><p id="06fd" class="pw-post-body-paragraph jz ka iq kb b kc ma ke kf kg mb ki kj kk mc km kn ko md kq kr ks me ku kv kw ij bi translated">为了消除关于 GBDT 在 GPU 上没有表现出大的速度增益的神话，我想比较一下 GBDT 在 CPU 和 GPU 上的训练时间。先说 CPU。下面的代码创建一个模型，对其进行训练，并测量训练的执行时间。它使用默认参数，因为它们在许多情况下提供了相当好的基线。</p><p id="c4eb" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">我们将首先训练我们所有的模型 100 次迭代(因为在 CPU 上训练它需要很长时间)。</p><p id="901c" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">运行此代码后，您可以将其更改为默认值 1000 或更多次迭代，以获得更好的质量结果。</p><p id="e0d3" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">CatBoost 将需要大约 15 分钟在 CPU 上训练 100 次迭代。</p><figure class="ky kz la lb gt jr"><div class="bz fp l di"><div class="mu mv l"/></div></figure><blockquote class="mn mo mp"><p id="6473" class="jz ka mm kb b kc kd ke kf kg kh ki kj mq kl km kn mr kp kq kr ms kt ku kv kw ij bi translated"><em class="iq">在 CPU 上拟合模型的时间:877 秒</em></p></blockquote><h1 id="864e" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">关于 GPU 的培训</h1><p id="f93f" class="pw-post-body-paragraph jz ka iq kb b kc ma ke kf kg mb ki kj kk mc km kn ko md kq kr ks me ku kv kw ij bi translated">所有以前的代码执行都是在 CPU 上完成的。现在该用 GPU 了！</p><p id="6ab2" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">要启用 GPU 训练，您需要使用<em class="mm"> task_type='GPU' </em>参数。</p><p id="0ef2" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">让我们在 GPU 上重新运行实验，看看结果会是什么时间。</p><p id="9b8a" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">如果 Colab 会给你显示“GPU 内存使用接近极限”的警告，按“忽略”即可。</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="gh gi mw"><img src="../Images/c75e5702ebdc651f880679c233213046.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3jXNE7JbnnMRJc0L"/></div></div></figure><figure class="ky kz la lb gt jr"><div class="bz fp l di"><div class="mu mv l"/></div></figure><blockquote class="mn mo mp"><p id="8034" class="jz ka mm kb b kc kd ke kf kg kh ki kj mq kl km kn mr kp kq kr ms kt ku kv kw ij bi translated"><em class="iq">在 GPU 上适应模型的时间:199 秒<br/> GPU 比 CPU 加速:4.41 倍</em></p></blockquote><p id="5404" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">如你所见，GPU 比 CPU 快 4 倍。它只需要 3-4 分钟，而 CPU 需要 14-15 分钟来适应模型。此外，学习过程仅需 30 秒，而不是 12 分钟。</p><p id="9062" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">当我们训练 100 次迭代时，瓶颈是预处理而不是训练本身。但是对于在大型数据集上获得最佳质量所必需的数千次迭代来说，这个瓶颈将是不可见的。你可以尝试在 CPU 和 GPU 上训练 5000 次迭代，再比较一次。</p><h1 id="7532" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">密码</h1><p id="7337" class="pw-post-body-paragraph jz ka iq kb b kc ma ke kf kg mb ki kj kk mc km kn ko md kq kr ks me ku kv kw ij bi translated">上面所有的代码你都可以在 CatBoost 仓库找到，作为谷歌合作实验室的<a class="ae jy" href="https://colab.research.google.com/github/catboost/tutorials/blob/master/tools/google_colaboratory_cpu_vs_gpu_tutorial.ipynb" rel="noopener ugc nofollow" target="_blank"> <strong class="kb ir">教程</strong> </a>。</p><h1 id="333e" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">摘要</h1><ul class=""><li id="bb0d" class="mx my iq kb b kc ma kg mb kk mz ko na ks nb kw nc nd ne nf bi translated">GBDT 训练在 GPU 上完美运行。</li><li id="b514" class="mx my iq kb b kc ng kg nh kk ni ko nj ks nk kw nc nd ne nf bi translated">CatBoost 是一个超快速的 GBDT 实现，具有 GPU 开箱即用的支持。</li><li id="307f" class="mx my iq kb b kc ng kg nh kk ni ko nj ks nk kw nc nd ne nf bi translated">Google Colaboratory 是一个有免费 GPU 支持的有用工具。</li></ul><h1 id="32ef" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">进一步阅读</h1><p id="2416" class="pw-post-body-paragraph jz ka iq kb b kc ma ke kf kg mb ki kj kk mc km kn ko md kq kr ks me ku kv kw ij bi translated">[1] V .埃尔绍夫，<a class="ae jy" href="https://devblogs.nvidia.com/catboost-fast-gradient-boosting-decision-trees/" rel="noopener ugc nofollow" target="_blank"> CatBoost 使用 GPU 在决策树上实现快速梯度提升</a>，NVIDIA 博客文章</p><p id="fab1" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">[2] <a class="ae jy" href="https://github.com/catboost" rel="noopener ugc nofollow" target="_blank"> CatBoost GitHub </a></p><p id="0296" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">[3] R. Mitchell，<a class="ae jy" href="https://devblogs.nvidia.com/gradient-boosting-decision-trees-xgboost-cuda/" rel="noopener ugc nofollow" target="_blank">梯度增强，决策树和 XGBoost 与 CUDA </a>，NVIDIA 博客文章</p><p id="3c6d" class="pw-post-body-paragraph jz ka iq kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ij bi translated">[4] <a class="ae jy" href="https://lightgbm.readthedocs.io/en/latest/GPU-Tutorial.html" rel="noopener ugc nofollow" target="_blank"> LightGBM GPU 教程</a></p></div></div>    
</body>
</html>