<html>
<head>
<title>Building a Conversational Chatbot for Slack using Rasa and Python -Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Rasa 和 Python 为 Slack 构建对话聊天机器人——第 1 部分</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/building-a-conversational-chatbot-for-slack-using-rasa-and-python-part-1-bca5cc75d32f?source=collection_archive---------4-----------------------#2019-01-08">https://towardsdatascience.com/building-a-conversational-chatbot-for-slack-using-rasa-and-python-part-1-bca5cc75d32f?source=collection_archive---------4-----------------------#2019-01-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="b804" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用 Rasa 堆栈和 Python 创建聊天机器人指南。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/6dc56b6c614eb8578edcd6a9bd1e4cca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CKjk4H7XnYghNmau6wGU9g.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk"><a class="ae ky" href="https://www.wired.com/2015/08/slack-overrun-bots-friendly-wonderful-bots/" rel="noopener ugc nofollow" target="_blank">Source</a></figcaption></figure><blockquote class="kz la lb"><p id="3280" class="lc ld le lf b lg lh ju li lj lk jx ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated"><strong class="lf iu"> <em class="it">注意:这篇文章是很久以前写的，RASA 可能会有变化，但这些变化并没有纳入本文。建议访问他们的官方文档网站，了解最新的详细信息。</em>T3】</strong></p></blockquote><blockquote class="lz"><p id="8dc0" class="ma mb it bd mc md me mf mg mh mi ly dk translated">现在是时候超越“对不起，我没有得到那个”类型的机器人，并使用机器学习建立人工智能助手:Rasa</p></blockquote><p id="b68e" class="pw-post-body-paragraph lc ld it lf b lg mj ju li lj mk jx ll ml mm lo lp mn mo ls lt mp mq lw lx ly im bi translated"><a class="ae ky" href="https://arxiv.org/pdf/1712.05181.pdf" rel="noopener ugc nofollow" target="_blank">对话式人工智能系统</a>正在成为人类生态系统不可或缺的一部分。对话式人工智能的知名例子包括苹果的 Siri、亚马逊的 Alexa 和微软的 Cortana。对话聊天机器人已经从基于规则的前辈那里走了很长一段路，如今几乎每个科技公司都雇佣了一个或多个健谈的助手。</p><p id="c26b" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll ml ln lo lp mn lr ls lt mp lv lw lx ly im bi translated">对话聊天机器人理解对话的上下文，可以优雅地处理任何用户目标，并帮助尽可能好地完成它。这并不总是意味着机器人能够回答所有问题，但它可以很好地处理对话。</p></div><div class="ab cl mr ms hx mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="im in io ip iq"><h1 id="55eb" class="my mz it bd na nb nc nd ne nf ng nh ni jz nj ka nk kc nl kd nm kf nn kg no np bi translated">目标</h1><p id="7215" class="pw-post-body-paragraph lc ld it lf b lg nq ju li lj nr jx ll ml ns lo lp mn nt ls lt mp nu lw lx ly im bi translated">在本文中，我们将构建一个名为“<strong class="lf iu"> Robo </strong>的聊天机器人，它能够检查人们的情绪，并采取必要的行动让他们振作起来。然后我们将它部署到 Slack。这将是一个功能齐全的 Slackbot 能够监听和响应您的请求。下面的演示截图应该足以激励你建立一个自己的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="ab gu cl nv"><img src="../Images/ad5edfe4fe5351a26973bdbfb8328256.png" data-original-src="https://miro.medium.com/v2/format:webp/1*YCBEujcXGf4MFOT02my5hQ.png"/></div></figure><p id="2048" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll ml ln lo lp mn lr ls lt mp lv lw lx ly im bi translated"><strong class="lf iu"> <em class="le">本文来源于一篇</em> </strong> <a class="ae ky" href="https://www.youtube.com/watch?v=HV0bJMkzpO4" rel="noopener ugc nofollow" target="_blank"> <strong class="lf iu"> <em class="le">精彩演讲</em> </strong> </a> <strong class="lf iu"> <em class="le">工程主管 Tom Bocklisch @ Rasa 在柏林 Pydata 上的演讲。</em> </strong></p><h1 id="1058" class="my mz it bd na nb nw nd ne nf nx nh ni jz ny ka nk kc nz kd nm kf oa kg no np bi translated">要求</h1><p id="e9fd" class="pw-post-body-paragraph lc ld it lf b lg nq ju li lj nr jx ll ml ns lo lp mn nt ls lt mp nu lw lx ly im bi translated">我们主要要求安装<strong class="lf iu"> Rasa 栈</strong>和<strong class="lf iu">语言模型</strong>。语言模型将用于解析传入的文本消息并提取必要的信息。我们将使用空间语言模型。</p><h1 id="0f8e" class="my mz it bd na nb nw nd ne nf nx nh ni jz ny ka nk kc nz kd nm kf oa kg no np bi translated">Rasa 堆栈</h1><p id="bbc8" class="pw-post-body-paragraph lc ld it lf b lg nq ju li lj nr jx ll ml ns lo lp mn nt ls lt mp nu lw lx ly im bi translated"><strong class="lf iu"> Rasa Stack </strong>是一套开源的机器学习工具，供开发者创建<a class="ae ky" href="http://blog.rasa.com/level-3-contextual-assistants-beyond-answering-simple-questions/" rel="noopener ugc nofollow" target="_blank">上下文 AI 助手和聊天机器人</a>。它是领先的开源机器学习工具包，允许开发人员使用最少的训练数据来扩展机器人，而不仅仅是回答简单的问题。这些机器人基于在示例对话中训练的机器学习模型。它由两个框架组成:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/3aea7509260deabdb55f8366b98778c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1110/format:webp/1*4Wu5EUB9yJ2AUfoPGMSLXw.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk"><a class="ae ky" href="https://rasa.com/docs/get_started_step1/" rel="noopener ugc nofollow" target="_blank">source</a></figcaption></figure><p id="6c78" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll ml ln lo lp mn lr ls lt mp lv lw lx ly im bi translated"><strong class="lf iu"> Rasa NLU </strong>:一个自然语言理解库，具有意图分类和实体提取功能。这有助于聊天机器人理解用户在说什么。</p><p id="bfbe" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll ml ln lo lp mn lr ls lt mp lv lw lx ly im bi translated"><strong class="lf iu"> Rasa Core </strong>:基于机器学习的对话管理聊天机器人框架，根据来自 NLU 的输入、对话历史和训练数据预测下一个最佳行动<strong class="lf iu">。</strong></p><p id="86f6" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll ml ln lo lp mn lr ls lt mp lv lw lx ly im bi translated"><em class="le"> Rasa 有很棒的</em> <a class="ae ky" href="https://rasa.com/docs/" rel="noopener ugc nofollow" target="_blank"> <em class="le">文档</em> </a> <em class="le">包括一些互动的例子来轻松掌握主题。</em></p></div><div class="ab cl mr ms hx mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="im in io ip iq"><h1 id="fcd8" class="my mz it bd na nb nc nd ne nf ng nh ni jz nj ka nk kc nl kd nm kf nn kg no np bi translated">装置</h1><p id="88c0" class="pw-post-body-paragraph lc ld it lf b lg nq ju li lj nr jx ll ml ns lo lp mn nt ls lt mp nu lw lx ly im bi translated">我们将使用 Jupyter 笔记本来运行代码。然而，我会推荐使用谷歌的<a class="ae ky" href="https://colaboratory.jupyter.org/welcome/" rel="noopener ugc nofollow" target="_blank">合作实验室</a>，因为它不需要任何设置，代码是在你的账户专用的虚拟机中执行的。唯一的问题是，虚拟机在空闲一段时间后会被回收，并且有一个由系统强制执行的最大生命周期。</p><h2 id="c83b" class="oc mz it bd na od oe dn ne of og dp ni ml oh oi nk mn oj ok nm mp ol om no on bi translated">主要安装</h2><p id="1219" class="pw-post-body-paragraph lc ld it lf b lg nq ju li lj nr jx ll ml ns lo lp mn nt ls lt mp nu lw lx ly im bi translated">你需要一个 Rasa NLU，Rasa 核心和一个 spaCy 语言模型。</p><pre class="kj kk kl km gt oo op oq or aw os bi"><span id="89c9" class="oc mz it op b gy ot ou l ov ow">#Rasa NLU<br/>python -m pip install rasa_nlu[spacy] (<a class="ae ky" href="https://rasa.com/docs/nlu/installation/" rel="noopener ugc nofollow" target="_blank">https://rasa.com/docs/nlu/installation/</a>)</span><span id="ea99" class="oc mz it op b gy ox ou l ov ow">#Rasa Core<br/>python -m pip install -U rasa_core == 0.9.6<br/>(<a class="ae ky" href="https://rasa.com/docs/core/installation/" rel="noopener ugc nofollow" target="_blank">https://rasa.com/docs/core/installation/</a>)</span><span id="01e2" class="oc mz it op b gy ox ou l ov ow">#Language Model</span><span id="7ff5" class="oc mz it op b gy ox ou l ov ow">python -m spacy download en_core_web_md<br/>python -m spacy link en_core_web_md en --force;</span></pre><p id="56fe" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll ml ln lo lp mn lr ls lt mp lv lw lx ly im bi translated"><em class="le">本文使用的 Rasa 核心版本不是最新的。使用最新版本会在执行代码时抛出错误，所以我不得不使用旧版本。我目前正在努力让代码在最新版本上运行。</em></p><p id="3bbe" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll ml ln lo lp mn lr ls lt mp lv lw lx ly im bi translated">我们将按照他们的要求安装其他依赖项。</p></div><div class="ab cl mr ms hx mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="im in io ip iq"><h1 id="32ce" class="my mz it bd na nb nc nd ne nf ng nh ni jz nj ka nk kc nl kd nm kf nn kg no np bi translated">1.使用 Rasa NLU 教机器人理解用户输入</h1><p id="199f" class="pw-post-body-paragraph lc ld it lf b lg nq ju li lj nr jx ll ml ns lo lp mn nt ls lt mp nu lw lx ly im bi translated">NLU 教聊天机器人如何理解用户输入。这是一个我们希望与机器人进行对话的例子。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oy"><img src="../Images/3282aee592acecbe138c7813a179ddfc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1228/format:webp/1*2ZmeQffwE9JUdSz-dlLKOg.png"/></div></figure><p id="ad7c" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll ml ln lo lp mn lr ls lt mp lv lw lx ly im bi translated">为了能够实现这一点，我们将建立一个<strong class="lf iu">拉沙 NLU 模型</strong>，并输入用户必须准备的训练数据。然后，模型会将数据转换成由实体和意图组成的结构化格式。</p><h2 id="1ae8" class="oc mz it bd na od oe dn ne of og dp ni ml oh oi nk mn oj ok nm mp ol om no on bi translated">1.准备 NLU 培训数据</h2><p id="2f4c" class="pw-post-body-paragraph lc ld it lf b lg nq ju li lj nr jx ll ml ns lo lp mn nt ls lt mp nu lw lx ly im bi translated">训练数据由一个预期从机器人接收的消息列表组成。这些数据被注释了意图和实体，这是拉莎·NLU 应该学会提取的。让我们用一个例子来理解意图和实体的概念。</p><ul class=""><li id="3eea" class="oz pa it lf b lg lh lj lk ml pb mn pc mp pd ly pe pf pg ph bi translated"><strong class="lf iu">意图:</strong>意图描述了消息的内容。例如，对于一个天气预测机器人来说，句子:<code class="fe pi pj pk op b">What’s the weather like tomorrow?</code>”有一个<code class="fe pi pj pk op b">request_weather</code>意图。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pl"><img src="../Images/2edf4d7873ee729f2e9e9cc6df17c373.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Vxp3-_kh6jS5r5DuxsXLPw.png"/></div></div></figure><ul class=""><li id="8952" class="oz pa it lf b lg lh lj lk ml pb mn pc mp pd ly pe pf pg ph bi translated"><strong class="lf iu">实体:</strong>通过识别句子中的结构化数据，帮助聊天机器人理解用户具体在问什么<em class="le">的信息。</em></li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pm"><img src="../Images/e90463d335d959d4b0ea477ce2a77580.png" data-original-src="https://miro.medium.com/v2/resize:fit:1088/format:webp/1*84kkw5ddpVzA1IU8e5Sm4w.png"/></div></figure><p id="9554" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll ml ln lo lp mn lr ls lt mp lv lw lx ly im bi translated">在这里，美食和地点都是提取的实体。</p><p id="265b" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll ml ln lo lp mn lr ls lt mp lv lw lx ly im bi translated">以下是训练数据的摘录。你也可以添加一些拼写错误或俚语，因为这将给机器人带来口语的味道。有关全部训练数据，请参考<a class="ae ky" href="https://github.com/parulnith/Building-a-Conversational-Chatbot-for-Slack-using-Rasa-and-Python/blob/master/Notebook/Conversational_Chatbot.ipynb" rel="noopener ugc nofollow" target="_blank">笔记本</a>。</p><pre class="kj kk kl km gt oo op oq or aw os bi"><span id="8d6a" class="oc mz it op b gy ot ou l ov ow">nlu_md = """<br/>## intent:greet<br/>- hey<br/>- hello there<br/>- hi<br/>- hello there<br/>## intent:goodbye<br/>- cu<br/>- good by<br/>- cee you later<br/>## intent:mood_unhappy<br/>- my day was horrible<br/>- I am sad<br/>- I don't feel very well<br/>- I am disappointed<br/>%store nlu_md &gt; nlu.md</span></pre><p id="0061" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll ml ln lo lp mn lr ls lt mp lv lw lx ly im bi translated"><em class="le">训练数据将被写入</em> <code class="fe pi pj pk op b"><em class="le">nlu.md</em></code> <em class="le">文件，并保存在与笔记本相同的目录下。训练数据通常存储在减价文件中。</em></p><h2 id="7e4d" class="oc mz it bd na od oe dn ne of og dp ni ml oh oi nk mn oj ok nm mp ol om no on bi translated">2.定义 NLU 模型配置</h2><p id="fab3" class="pw-post-body-paragraph lc ld it lf b lg nq ju li lj nr jx ll ml ns lo lp mn nt ls lt mp nu lw lx ly im bi translated">Rasa NLU 有许多不同的组成部分，它们共同构成了一个管道。一旦训练数据准备好了，我们就可以把它输入 NLU 模型管道。在管道中列出的所有组件将被一个接一个地训练。你可以在这里阅读更多关于管道<a class="ae ky" href="https://rasa.com/docs/nlu/choosing_pipeline/#choosing-pipeline" rel="noopener ugc nofollow" target="_blank">的信息。</a></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pn po l"/></div></figure><p id="9a28" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll ml ln lo lp mn lr ls lt mp lv lw lx ly im bi translated">该文件包含将在 nlu 模型中使用的配置。配置文件对于模型训练很重要，因为它将提供相当多的重要参数，这些参数将在训练模型时使用。</p><h2 id="905d" class="oc mz it bd na od oe dn ne of og dp ni ml oh oi nk mn oj ok nm mp ol om no on bi translated">3.训练 NLU 模型。</h2><p id="ff0f" class="pw-post-body-paragraph lc ld it lf b lg nq ju li lj nr jx ll ml ns lo lp mn nt ls lt mp nu lw lx ly im bi translated">是时候训练我们的模型识别用户输入了，这样当你向你的机器人发送“你好”这样的消息时，它会识别这是一个<code class="fe pi pj pk op b">greet</code>意图，当你发送“再见”时，它会识别这是一个<code class="fe pi pj pk op b">goodbye</code>意图。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pn po l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pp"><img src="../Images/8ee648dfe718c3b7df1c123b7d43822e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XJHwqNvXRxZFwlYmHJ5s7A.png"/></div></div></figure><p id="e41d" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll ml ln lo lp mn lr ls lt mp lv lw lx ly im bi translated">训练好的模型文件将存储在路径:<code class="fe pi pj pk op b">‘./models/nlu/current’.</code></p><p id="bbbd" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll ml ln lo lp mn lr ls lt mp lv lw lx ly im bi translated"><strong class="lf iu"> 4。评估 NLU 模型</strong></p><p id="8a38" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll ml ln lo lp mn lr ls lt mp lv lw lx ly im bi translated">是时候检验我们的模型表现如何了。让我们传递一些随机消息。</p><pre class="kj kk kl km gt oo op oq or aw os bi"><span id="9820" class="oc mz it op b gy ot ou l ov ow"># small helper to make dict dumps a bit prettier<br/>def pprint(o):<br/>   print(json.dumps(o, indent=2))</span><span id="951f" class="oc mz it op b gy ox ou l ov ow">pprint(interpreter.parse("I am unhappy"))</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pq"><img src="../Images/eb342fb74a10c7249159635ee2eb7631.png" data-original-src="https://miro.medium.com/v2/resize:fit:1266/format:webp/1*gGhToGSTLZMT6qOOvzaAog.png"/></div></figure><p id="8e00" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll ml ln lo lp mn lr ls lt mp lv lw lx ly im bi translated">我们的模型表现良好。现在让我们在一个测试数据集上评估它。然而，出于我们的目的，让我们根据手头的数据对其进行评估，即<code class="fe pi pj pk op b">nlu.md</code></p><pre class="kj kk kl km gt oo op oq or aw os bi"><span id="770b" class="oc mz it op b gy ot ou l ov ow"><strong class="op iu">from</strong> <strong class="op iu">rasa_nlu.evaluate</strong> <strong class="op iu">import</strong> run_evaluation</span><span id="da57" class="oc mz it op b gy ox ou l ov ow">run_evaluation("nlu.md", model_directory)</span></pre><p id="809b" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll ml ln lo lp mn lr ls lt mp lv lw lx ly im bi translated">我们得到一个带有各种评估结果的意图混淆矩阵。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pr"><img src="../Images/020b5d8aeb9b1cc301d02df6420b083b.png" data-original-src="https://miro.medium.com/v2/resize:fit:846/format:webp/1*wN66a0ccfB4RIUcqmZuJ7Q.png"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ps"><img src="../Images/a222e8bb7bdd2120a0eef35e0aabb45d.png" data-original-src="https://miro.medium.com/v2/resize:fit:782/format:webp/1*EaXd0GOuasj6hGD9SniSpQ.png"/></div></figure><p id="cab1" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll ml ln lo lp mn lr ls lt mp lv lw lx ly im bi translated">我们已经成功地创造了一个基本的机器人，它只能理解自然语言，但没有对话。是时候给我们的机器人添加对话功能了。</p></div><div class="ab cl mr ms hx mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="im in io ip iq"><h1 id="cb9e" class="my mz it bd na nb nc nd ne nf ng nh ni jz nj ka nk kc nl kd nm kf nn kg no np bi translated">2.教导机器人使用 Rasa 核心进行响应</h1><p id="0d89" class="pw-post-body-paragraph lc ld it lf b lg nq ju li lj nr jx ll ml ns lo lp mn nt ls lt mp nu lw lx ly im bi translated">我们的机器人现在能够理解用户在说什么，即我们的心情是怎样的，是快乐还是悲伤。现在，下一个任务是让机器人响应消息。在我们的例子中，将根据用户的选择获取一只狗、猫或鸟的图像来让它们高兴起来。我们将通过使用 Rasa Core 训练一个对话管理模型来教'<code class="fe pi pj pk op b">robo’</code>做出回应。</p><h2 id="872f" class="oc mz it bd na od oe dn ne of og dp ni ml oh oi nk mn oj ok nm mp ol om no on bi translated">1.写故事</h2><p id="86ac" class="pw-post-body-paragraph lc ld it lf b lg nq ju li lj nr jx ll ml ns lo lp mn nt ls lt mp nu lw lx ly im bi translated">对话管理模型的训练数据称为<code class="fe pi pj pk op b">stories.</code>故事由用户和机器人之间发生的实际对话组成。用户的输入被表示为意图以及相应的实体，聊天机器人的响应被表示为动作。</p><p id="56aa" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll ml ln lo lp mn lr ls lt mp lv lw lx ly im bi translated">让我们看看一个典型的故事是什么样的。这只是摘录，完整数据请参考<a class="ae ky" href="https://github.com/parulnith/Building-a-Conversational-Chatbot-for-Slack-using-Rasa-and-Python/blob/master/Conversational_Chatbot.ipynb" rel="noopener ugc nofollow" target="_blank">笔记本</a>。</p><pre class="kj kk kl km gt oo op oq or aw os bi"><span id="802b" class="oc mz it op b gy ot ou l ov ow">stories_md = """</span><span id="0e8f" class="oc mz it op b gy ox ou l ov ow">## happy path               <br/>* greet              <br/>  - utter_greet<br/>* mood_great              <br/>  - utter_happy<br/>* mood_affirm<br/>  - utter_happy<br/>* mood_affirm<br/>  - utter_goodbye<br/>  <br/>## sad path          <br/>* greet<br/>  - utter_greet             <br/>* mood_unhappy<br/>  - utter_ask_picture<br/>* inform{"animal":"dog"}  <br/>  - action_retrieve_image<br/>  - utter_did_that_help<br/>* mood_affirm<br/>  - utter_happy<br/>"""</span><span id="7335" class="oc mz it op b gy ox ou l ov ow">%store stories_md &gt; stories.md</span></pre><p id="3b82" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll ml ln lo lp mn lr ls lt mp lv lw lx ly im bi translated">典型故事的格式如下:</p><p id="53b9" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll ml ln lo lp mn lr ls lt mp lv lw lx ly im bi translated"><code class="fe pi pj pk op b">## </code>表示一个故事的开始，你可以给它起一个名字，比如<code class="fe pi pj pk op b">happy path</code>、<code class="fe pi pj pk op b">sad path</code>等等。</p><p id="e96c" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll ml ln lo lp mn lr ls lt mp lv lw lx ly im bi translated"><code class="fe pi pj pk op b">*</code>表示用户以意图的形式发出的信息。</p><p id="d484" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll ml ln lo lp mn lr ls lt mp lv lw lx ly im bi translated"><code class="fe pi pj pk op b">- </code>表示机器人采取的行动。</p><h2 id="b50c" class="oc mz it bd na od oe dn ne of og dp ni ml oh oi nk mn oj ok nm mp ol om no on bi translated">2.定义域</h2><p id="f019" class="pw-post-body-paragraph lc ld it lf b lg nq ju li lj nr jx ll ml ns lo lp mn nt ls lt mp nu lw lx ly im bi translated">这个领域就像一个机器人生活和运作的宇宙。这包括它应该期望得到什么用户输入，它应该能够预测什么动作，如何响应以及存储什么信息。该域由五个关键部分组成，分别是<code class="fe pi pj pk op b">intents</code>、<code class="fe pi pj pk op b">slots</code>、<code class="fe pi pj pk op b">entities</code>、<code class="fe pi pj pk op b">actions</code>和<code class="fe pi pj pk op b">templates</code>。我们意识到了前两个，让我们来理解其他的。</p><ul class=""><li id="3e72" class="oz pa it lf b lg lh lj lk ml pb mn pc mp pd ly pe pf pg ph bi translated"><strong class="lf iu"> slots </strong> : slots 就像是值的占位符，使机器人能够跟踪对话。</li><li id="f0c3" class="oz pa it lf b lg pt lj pu ml pv mn pw mp px ly pe pf pg ph bi translated">动作:我们的机器人会说或做的事情。</li><li id="ca15" class="oz pa it lf b lg pt lj pu ml pv mn pw mp px ly pe pf pg ph bi translated"><strong class="lf iu">模板</strong>:机器人要说的东西的模板字符串</li></ul><p id="6f53" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll ml ln lo lp mn lr ls lt mp lv lw lx ly im bi translated">我们以生命的形式定义领域。这是我们的机器人的一个示例域:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pn po l"/></div></figure><h2 id="5ccb" class="oc mz it bd na od oe dn ne of og dp ni ml oh oi nk mn oj ok nm mp ol om no on bi translated">3.自定义操作</h2><p id="1a14" class="pw-post-body-paragraph lc ld it lf b lg nq ju li lj nr jx ll ml ns lo lp mn nt ls lt mp nu lw lx ly im bi translated">因为我们希望我们的机器人进行 API 调用来检索狗、猫或鸟的照片，这取决于用户指定的照片，所以我们需要创建一个自定义操作。机器人将通过检索插槽<code class="fe pi pj pk op b">group</code>的值来知道应该接收哪种类型的图片。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pn po l"/></div></figure><h2 id="d91d" class="oc mz it bd na od oe dn ne of og dp ni ml oh oi nk mn oj ok nm mp ol om no on bi translated">4.训练对话模型</h2><p id="80fd" class="pw-post-body-paragraph lc ld it lf b lg nq ju li lj nr jx ll ml ns lo lp mn nt ls lt mp nu lw lx ly im bi translated">最后，我们将引用应该用于训练对话管理模型的<a class="ae ky" href="https://rasa.com/docs/core/policies/" rel="noopener ugc nofollow" target="_blank">政策</a>来训练对话管理模型。对于我们的例子，我们将在 Keras 中实现一个神经网络，它可以预测下一步要采取的行动。</p><p id="153c" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll ml ln lo lp mn lr ls lt mp lv lw lx ly im bi translated">该模型的主要组件是一个递归神经网络(LSTM)，它从原始对话历史直接映射到系统动作的分布。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pn po l"/></div></figure><p id="e29d" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll ml ln lo lp mn lr ls lt mp lv lw lx ly im bi translated">有时你想回到一个后备的行动，比如说“对不起，我不明白”。为此，将<code class="fe pi pj pk op b">FallbackPolicy</code>添加到您的策略集合中。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi py"><img src="../Images/aa4479a198ead4104e99d2ff3a9278bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1150/format:webp/1*RIg02pl5E61ZJyeU9gHK_Q.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">The fitted keras policy model</figcaption></figure><p id="57cd" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll ml ln lo lp mn lr ls lt mp lv lw lx ly im bi translated">模型将保存在路径:<code class="fe pi pj pk op b">‘models/dialogue’</code></p><h2 id="8ddb" class="oc mz it bd na od oe dn ne of og dp ni ml oh oi nk mn oj ok nm mp ol om no on bi translated">4.聊天时间到了</h2><p id="0d92" class="pw-post-body-paragraph lc ld it lf b lg nq ju li lj nr jx ll ml ns lo lp mn nt ls lt mp nu lw lx ly im bi translated">是时候和我们的机器人聊天了。执行下面的代码并开始聊天。</p><pre class="kj kk kl km gt oo op oq or aw os bi"><span id="14a0" class="oc mz it op b gy ot ou l ov ow">import warnings<br/>warnings.simplefilter('ignore', ruamel.yaml.error.UnsafeLoaderWarning)</span><span id="90c5" class="oc mz it op b gy ox ou l ov ow">from rasa_core.agent import Agent<br/>from rasa_core.interpreter import NaturalLanguageInterpreter<br/>interpreter = NaturalLanguageInterpreter.create(model_directory)<br/>agent = Agent.load('models/dialogue', interpreter=interpreter)</span><span id="264a" class="oc mz it op b gy ox ou l ov ow">print("Your bot is ready to talk! Type your messages here or send 'stop'")<br/>while True:<br/>    a = input()<br/>    if a == 'stop':<br/>        break<br/>    responses = agent.handle_text(a)<br/>    for response in responses:<br/>        print(response["text"])</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pz"><img src="../Images/c966cf687a9d11b8c877e74b87cfcbe8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*0kMARjYJxSQtxPZ3sQGAzg.gif"/></div></div></figure></div><div class="ab cl mr ms hx mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="im in io ip iq"><h1 id="e281" class="my mz it bd na nb nc nd ne nf ng nh ni jz nj ka nk kc nl kd nm kf nn kg no np bi translated">《恋恋笔记本》</h1><p id="7706" class="pw-post-body-paragraph lc ld it lf b lg nq ju li lj nr jx ll ml ns lo lp mn nt ls lt mp nu lw lx ly im bi translated">你既可以从<a class="ae ky" href="https://github.com/parulnith/Building-a-Conversational-Chatbot-for-Slack-using-Rasa-and-Python/tree/master/Notebook" rel="noopener ugc nofollow" target="_blank"> Github </a>访问笔记本，也可以看看下面:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pn po l"/></div></figure></div><div class="ab cl mr ms hx mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="im in io ip iq"><h1 id="3ac1" class="my mz it bd na nb nc nd ne nf ng nh ni jz nj ka nk kc nl kd nm kf nn kg no np bi translated">结论</h1><p id="0015" class="pw-post-body-paragraph lc ld it lf b lg nq ju li lj nr jx ll ml ns lo lp mn nt ls lt mp nu lw lx ly im bi translated">我们的<strong class="lf iu">第一部</strong>到此结束。我们创建了一个聊天机器人，它能够监听用户的输入并根据上下文做出响应。在<strong class="lf iu">第二部分</strong>中，我们将在<strong class="lf iu"> Slack </strong>上部署这个机器人。</p><p id="6970" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll ml ln lo lp mn lr ls lt mp lv lw lx ly im bi translated">我们利用 NLU Rasa 和 Rasa Core 的能力，用最少的训练数据创建了一个机器人。在下一部分中，我们将利用创建的模型在 slack 上部署 bot。Rasa 让用户可以很容易地试验聊天机器人，并轻松地创建它们。所以是时候开始用 Rasa 为你的用例创建一个机器人了。</p></div><div class="ab cl mr ms hx mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="im in io ip iq"><p id="c19c" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll ml ln lo lp mn lr ls lt mp lv lw lx ly im bi translated">在这里阅读第 2 部分<a class="ae ky" href="https://medium.com/@parulnith/building-a-conversational-chatbot-for-slack-using-rasa-and-python-part-2-ce7233f2e9e7" rel="noopener"/>。</p></div></div>    
</body>
</html>