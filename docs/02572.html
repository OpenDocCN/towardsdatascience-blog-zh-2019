<html>
<head>
<title>Data augmentation using fastai</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 fastai 的数据增强</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/data-augmentations-in-fastai-84979bbcefaa?source=collection_archive---------5-----------------------#2019-04-27">https://towardsdatascience.com/data-augmentations-in-fastai-84979bbcefaa?source=collection_archive---------5-----------------------#2019-04-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/93fd1e8b25ebeab4b1630e1c5948d23c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uS9bR_Pk5533As4pInuzmA.jpeg"/></div></div></figure><h2 id="52fb" class="jy jz iq bd ka kb kc dn kd ke kf dp kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">介绍</h2><p id="33b3" class="pw-post-body-paragraph ku kv iq kw b kx ky kz la lb lc ld le kh lf lg lh kl li lj lk kp ll lm ln lo ij bi translated">数据扩充指的是对数据集中的图像随机应用各种变换。这些转换有助于在我们的数据集中引入更多种类。让我们看看这是什么意思。</p><figure class="lq lr ls lt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lp"><img src="../Images/2b0d5de85379fd638b9cbefcc9aa2b77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Up3AUuQbbDA8zwot6K7q-w.png"/></div></div></figure><p id="d9ac" class="pw-post-body-paragraph ku kv iq kw b kx lu kz la lb lv ld le kh lw lg lh kl lx lj lk kp ly lm ln lo ij bi translated">考虑一个构建面锁的例子。当你为锁取样时，你现在拍一些照片，你就完成了。然而，当用户想要解锁他的手机时，他并不总是处于相同的照明中(亮度)。或者，用户不会总是以相同的角度面对相机(翘曲)。可能他的照片因为某种原因(抖动)显得模糊。在训练数据时，我们需要考虑这些情况。这正是数据增强带给我们的。</p><p id="5fb1" class="pw-post-body-paragraph ku kv iq kw b kx lu kz la lb lv ld le kh lw lg lh kl lx lj lk kp ly lm ln lo ij bi translated">我们从这样一幅图像开始</p><figure class="lq lr ls lt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lz"><img src="../Images/52b6803bd0c1db5ae00ad1cb8385bd7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dpxeuARfJtW6SMPch2rpXg.jpeg"/></div></div></figure><p id="a3e8" class="pw-post-body-paragraph ku kv iq kw b kx lu kz la lb lv ld le kh lw lg lh kl lx lj lk kp ly lm ln lo ij bi translated">我们最终得到了一堆像这样的照片</p><figure class="lq lr ls lt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ma"><img src="../Images/ba5a5d525a9c98036d5ce231f3196187.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PXVioCnp4jh6TVZFCpSiaQ.png"/></div></div></figure><p id="baac" class="pw-post-body-paragraph ku kv iq kw b kx lu kz la lb lv ld le kh lw lg lh kl lx lj lk kp ly lm ln lo ij bi translated">我们所做的是，不是每次都给模型提供相同的图片，而是做一些小的随机变换(一点旋转、缩放、平移等)，这些变换不会改变图像内部的内容(对于人眼而言)，但会改变其像素值。用数据扩充训练的模型将更好地概括。在训练样本数量相对较少的情况下，数据扩充也很有用。</p><h2 id="9414" class="jy jz iq bd ka kb kc dn kd ke kf dp kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">工作</h2><p id="82d8" class="pw-post-body-paragraph ku kv iq kw b kx ky kz la lb lc ld le kh lf lg lh kl li lj lk kp ll lm ln lo ij bi translated"><a class="ae mb" href="https://www.kaggle.com/dipam7/data-augmentation-in-fastai?scriptVersionId=13445701" rel="noopener ugc nofollow" target="_blank">全 jupyter 笔记本。</a></p><p id="1cbf" class="pw-post-body-paragraph ku kv iq kw b kx lu kz la lb lv ld le kh lw lg lh kl lx lj lk kp ly lm ln lo ij bi translated">在这篇短文中，我们不会过多关注实现这些转换的代码。相反，我们将可视化各种可用的转换，以理解当我们执行数据扩充时在幕后发生了什么。</p><p id="bb49" class="pw-post-body-paragraph ku kv iq kw b kx lu kz la lb lv ld le kh lw lg lh kl lx lj lk kp ly lm ln lo ij bi translated">我们从查看 fastai 库中的缺省值开始。这些缺省值是以这样一种方式设置的，它们可以很好地用于大多数任务。</p><figure class="lq lr ls lt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mc"><img src="../Images/9695f775e8035870f642632636b00757.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1Km6zKfQO8cpmOIrRZ3vZw.png"/></div></div></figure><p id="18a7" class="pw-post-body-paragraph ku kv iq kw b kx lu kz la lb lv ld le kh lw lg lh kl lx lj lk kp ly lm ln lo ij bi translated">然而，我们可以根据应用程序的性质改变其中的一些(例如<code class="fe md me mf mg b">do_flip</code>)。</p><p id="57d1" class="pw-post-body-paragraph ku kv iq kw b kx lu kz la lb lv ld le kh lw lg lh kl lx lj lk kp ly lm ln lo ij bi translated"><code class="fe md me mf mg b">get transforms</code>返回两个转换列表的元组:一个用于训练集，一个用于验证集。但是，我们不想修改验证集中的图片，所以第二个列表仅限于调整图片的大小。</p><figure class="lq lr ls lt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mh"><img src="../Images/a36f369bca72fafd31cd09be264cda32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jMsbsBxKDz2x0AoyNGjsQQ.png"/></div></div></figure><p id="5198" class="pw-post-body-paragraph ku kv iq kw b kx lu kz la lb lv ld le kh lw lg lh kl lx lj lk kp ly lm ln lo ij bi translated">我们使用一个小助手功能来绘制网格。函数如下所示。</p><figure class="lq lr ls lt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mi"><img src="../Images/619c6d0357d26725d0a8204112585534.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HIp8ZcptfV8e3ux0PQBXog.png"/></div></div></figure><p id="0d5c" class="pw-post-body-paragraph ku kv iq kw b kx lu kz la lb lv ld le kh lw lg lh kl lx lj lk kp ly lm ln lo ij bi translated"><code class="fe md me mf mg b">**kwargs</code>意味着我们可以传递任意数量的命名参数(并且我们事先不知道数量)。要传递的一些有用的参数可以是<code class="fe md me mf mg b">size</code>，这样所有的图像都是相同的大小，以及<code class="fe md me mf mg b">padding</code>，以决定如何处理图像中丢失的像素。</p><p id="3f2a" class="pw-post-body-paragraph ku kv iq kw b kx lu kz la lb lv ld le kh lw lg lh kl lx lj lk kp ly lm ln lo ij bi translated">现在我们已经把所有的部分都准备好了，让我们来看看我们能做的一些很酷的转换。</p><h2 id="b4f3" class="jy jz iq bd ka kb kc dn kd ke kf dp kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">随机缩放/裁剪</h2><p id="f15b" class="pw-post-body-paragraph ku kv iq kw b kx ky kz la lb lc ld le kh lf lg lh kl li lj lk kp ll lm ln lo ij bi translated">随机裁剪或缩放图像。</p><figure class="lq lr ls lt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ma"><img src="../Images/5ed1556c93d9cc89953279372e0d3f02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y4DyDc08E-5Ls1QmCjUEDA.png"/></div></div></figure><h2 id="f496" class="jy jz iq bd ka kb kc dn kd ke kf dp kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">辐状的</h2><p id="c330" class="pw-post-body-paragraph ku kv iq kw b kx ky kz la lb lc ld le kh lf lg lh kl li lj lk kp ll lm ln lo ij bi translated">我们在转换中引入的随机性可以通过两种方式实现。</p><p id="185a" class="pw-post-body-paragraph ku kv iq kw b kx lu kz la lb lv ld le kh lw lg lh kl lx lj lk kp ly lm ln lo ij bi translated">在第一种方法中，我们可以传递一个图像将被变换的概率。基于该概率，图像将被变换或不被变换。在下一个变换中，我们以 50%的概率将图像旋转 30 度。</p><figure class="lq lr ls lt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mj"><img src="../Images/4b15cfb5ba14ee31bc239073190337ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vCXjR8ItdseYAWqezuukNw.png"/></div></div></figure><p id="11cb" class="pw-post-body-paragraph ku kv iq kw b kx lu kz la lb lv ld le kh lw lg lh kl lx lj lk kp ly lm ln lo ij bi translated">在第二种方式中，我们不是传递概率，而是传递一系列值(这里是度数)。然后图像将在两个浮动之间随机旋转一个角度。</p><figure class="lq lr ls lt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mj"><img src="../Images/6b87d2d014cb2398223840cc9126825e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1taitArcchZ5waB-26Av0g.png"/></div></div></figure><p id="2b2c" class="pw-post-body-paragraph ku kv iq kw b kx lu kz la lb lv ld le kh lw lg lh kl lx lj lk kp ly lm ln lo ij bi translated">我们也可以把上面提到的 2 种方法结合起来！</p><h2 id="3172" class="jy jz iq bd ka kb kc dn kd ke kf dp kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">聪明</h2><p id="38ae" class="pw-post-body-paragraph ku kv iq kw b kx ky kz la lb lc ld le kh lf lg lh kl li lj lk kp ll lm ln lo ij bi translated">这个转换需要一个名为<code class="fe md me mf mg b">change.</code>的参数，设置<code class="fe md me mf mg b">change</code>为 0 将把我们的图像转换成黑色，设置为 1 将把它变成白色</p><figure class="lq lr ls lt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mk"><img src="../Images/742216af9f3099f17e5c8ee2e174680d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YmU3ywl7mgb7t_zH6s1-_w.png"/></div></div></figure><h2 id="f5e8" class="jy jz iq bd ka kb kc dn kd ke kf dp kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">对比</h2><p id="6103" class="pw-post-body-paragraph ku kv iq kw b kx ky kz la lb lc ld le kh lf lg lh kl li lj lk kp ll lm ln lo ij bi translated">与亮度类似，对比度可以使用<code class="fe md me mf mg b">scale</code>参数进行设置。</p><figure class="lq lr ls lt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mj"><img src="../Images/62383f692cabf7464d20c6a1db1e1cdd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CW9hgGDzdCef6h9fszVTXQ.png"/></div></div></figure><h2 id="3fc8" class="jy jz iq bd ka kb kc dn kd ke kf dp kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">有两个平面的</h2><p id="de37" class="pw-post-body-paragraph ku kv iq kw b kx ky kz la lb lc ld le kh lf lg lh kl li lj lk kp ll lm ln lo ij bi translated">该变换结合了翻转(水平或垂直)和 90 度倍数的旋转。</p><figure class="lq lr ls lt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ml"><img src="../Images/5ad8c54d7508f58a3daae58c70419d7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ELS7XtfsZq_FS19VqykIcw.png"/></div></div></figure><h2 id="e7ac" class="jy jz iq bd ka kb kc dn kd ke kf dp kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">翻转 _lr(镜像)</h2><p id="7778" class="pw-post-body-paragraph ku kv iq kw b kx ky kz la lb lc ld le kh lf lg lh kl li lj lk kp ll lm ln lo ij bi translated">水平翻转图像。</p><figure class="lq lr ls lt gt jr gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/4983e094428326e790c126f7c635a389.png" data-original-src="https://miro.medium.com/v2/resize:fit:1210/format:webp/1*SG8C2ZOM6zHuQYkkhEw1FA.png"/></div></figure><h2 id="ae0e" class="jy jz iq bd ka kb kc dn kd ke kf dp kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">振动</h2><p id="ae53" class="pw-post-body-paragraph ku kv iq kw b kx ky kz la lb lc ld le kh lf lg lh kl li lj lk kp ll lm ln lo ij bi translated">这种变换通过用来自邻域的像素随机替换图像的像素来改变图像的像素，从而导致抖动。</p><figure class="lq lr ls lt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mn"><img src="../Images/2383637001c3b2f968e657636ca7b6b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fJUAjyhREs9SxQAboy9vrw.png"/></div></div></figure><h2 id="40e8" class="jy jz iq bd ka kb kc dn kd ke kf dp kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">对称翘曲</h2><p id="5b59" class="pw-post-body-paragraph ku kv iq kw b kx ky kz la lb lc ld le kh lf lg lh kl li lj lk kp ll lm ln lo ij bi translated">更改查看图像的角度。</p><figure class="lq lr ls lt gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mj"><img src="../Images/871afbcd1260378450f3876e9d24a046.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1SpN_HJcg2R0kThk0DhXNQ.png"/></div></div></figure><p id="aa57" class="pw-post-body-paragraph ku kv iq kw b kx lu kz la lb lv ld le kh lw lg lh kl lx lj lk kp ly lm ln lo ij bi translated">这些是计算机视觉项目的一些最佳增强。您可以阅读 fastai 文档了解更多信息。</p><p id="30b9" class="pw-post-body-paragraph ku kv iq kw b kx lu kz la lb lv ld le kh lw lg lh kl lx lj lk kp ly lm ln lo ij bi translated">一个有趣的研究领域是其他领域的数据扩充，例如声音数据。</p></div><div class="ab cl mo mp hu mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="ij ik il im in"><p id="c26d" class="pw-post-body-paragraph ku kv iq kw b kx lu kz la lb lv ld le kh lw lg lh kl lx lj lk kp ly lm ln lo ij bi translated">编辑:</p><h2 id="f782" class="jy jz iq bd ka kb kc dn kd ke kf dp kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated"><a class="ae mb" href="https://arxiv.org/abs/1710.09412" rel="noopener ugc nofollow" target="_blank">混淆:超越经验风险最小化</a></h2><p id="dbbf" class="pw-post-body-paragraph ku kv iq kw b kx ky kz la lb lc ld le kh lf lg lh kl li lj lk kp ll lm ln lo ij bi translated">Mixup 是一个巧妙的数据增强小技巧。在 mixup 中，我们不是提供网络原始图像，而是获取 2 幅图像，并对它们进行线性组合，如下所示:</p><p id="069e" class="pw-post-body-paragraph ku kv iq kw b kx lu kz la lb lv ld le kh lw lg lh kl lx lj lk kp ly lm ln lo ij bi translated"><code class="fe md me mf mg b">new_image = t * image1 + (1-t) * image2</code></p><p id="ae7f" class="pw-post-body-paragraph ku kv iq kw b kx lu kz la lb lv ld le kh lw lg lh kl lx lj lk kp ly lm ln lo ij bi translated">其中 t 是介于 0 和 1 之间的浮点数。那么我们分配给该图像的目标是原始目标的相同组合:</p><p id="5474" class="pw-post-body-paragraph ku kv iq kw b kx lu kz la lb lv ld le kh lw lg lh kl lx lj lk kp ly lm ln lo ij bi translated"><code class="fe md me mf mg b">new_target = t * target1 + (1-t) * target2</code></p><p id="5f65" class="pw-post-body-paragraph ku kv iq kw b kx lu kz la lb lv ld le kh lw lg lh kl lx lj lk kp ly lm ln lo ij bi translated">看看下面的图片</p><figure class="lq lr ls lt gt jr gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/0ca3652554e2a7f237451b755b80ef69.png" data-original-src="https://miro.medium.com/v2/resize:fit:466/format:webp/1*II0UAEW9kfDNsbN7b_4Gig.png"/></div></figure><p id="44b6" class="pw-post-body-paragraph ku kv iq kw b kx lu kz la lb lv ld le kh lw lg lh kl lx lj lk kp ly lm ln lo ij bi translated">狗还是猫？这里的正确答案是 70%狗，30%猫！</p><p id="422b" class="pw-post-body-paragraph ku kv iq kw b kx lu kz la lb lv ld le kh lw lg lh kl lx lj lk kp ly lm ln lo ij bi translated">当执行 mixup 时，实验表明跨类(而不是同一个类)执行通常是个好主意。此外，mixup 一次应用于一个小批量，而不是整个数据集(同样工作良好)。</p><p id="b541" class="pw-post-body-paragraph ku kv iq kw b kx lu kz la lb lv ld le kh lw lg lh kl lx lj lk kp ly lm ln lo ij bi translated">使用 mixup 的主要优点是它可以用几行代码实现，几乎没有任何计算开销。mixup 所做的是，它迫使你的神经网络偏向于你的类之间的简单线性行为。它使你的神经网络在对抗敌对样本时更加强健，并帮助它<a class="ae mb" href="https://becominghuman.ai/regularization-in-neural-networks-3b9687e1a68c" rel="noopener ugc nofollow" target="_blank">更好地调整。</a></p><p id="ec30" class="pw-post-body-paragraph ku kv iq kw b kx lu kz la lb lv ld le kh lw lg lh kl lx lj lk kp ly lm ln lo ij bi translated">在 fastai 中，使用 mixup 非常简单:</p><p id="e1d2" class="pw-post-body-paragraph ku kv iq kw b kx lu kz la lb lv ld le kh lw lg lh kl lx lj lk kp ly lm ln lo ij bi translated"><code class="fe md me mf mg b">learner = Learner(data, model, metrics=[accuracy]).mixup()</code></p><p id="828b" class="pw-post-body-paragraph ku kv iq kw b kx lu kz la lb lv ld le kh lw lg lh kl lx lj lk kp ly lm ln lo ij bi translated">在我目前看到的例子中，通常是和<a class="ae mb" href="https://becominghuman.ai/mixed-precision-training-using-fastai-435145d3178b" rel="noopener ugc nofollow" target="_blank">混合精度训练</a>一起使用。阅读<a class="ae mb" href="https://arxiv.org/abs/1710.09412" rel="noopener ugc nofollow" target="_blank">这篇研究论文</a>了解更多信息。</p><p id="2905" class="pw-post-body-paragraph ku kv iq kw b kx lu kz la lb lv ld le kh lw lg lh kl lx lj lk kp ly lm ln lo ij bi translated">这就是本文的全部内容。</p><p id="b329" class="pw-post-body-paragraph ku kv iq kw b kx lu kz la lb lv ld le kh lw lg lh kl lx lj lk kp ly lm ln lo ij bi translated">如果你想了解更多关于深度学习的知识，可以看看我在这方面的系列文章:</p><div class="mw mx gp gr my mz"><a href="https://medium.com/@dipam44/deep-learning-series-30ad108fbe2b" rel="noopener follow" target="_blank"><div class="na ab fo"><div class="nb ab nc cl cj nd"><h2 class="bd ir gy z fp ne fr fs nf fu fw ip bi translated">深度学习系列</h2><div class="ng l"><h3 class="bd b gy z fp ne fr fs nf fu fw dk translated">我所有关于深度学习的文章的系统列表</h3></div><div class="nh l"><p class="bd b dl z fp ne fr fs nf fu fw dk translated">medium.com</p></div></div><div class="ni l"><div class="nj l nk nl nm ni nn jw mz"/></div></div></a></div><p id="1a26" class="pw-post-body-paragraph ku kv iq kw b kx lu kz la lb lv ld le kh lw lg lh kl lx lj lk kp ly lm ln lo ij bi translated">~快乐学习。</p></div></div>    
</body>
</html>