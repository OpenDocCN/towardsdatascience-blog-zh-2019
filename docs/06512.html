<html>
<head>
<title>How To Do Fuzzy Matching on Pandas Dataframe Column Using Python?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用 Python 对 Pandas Dataframe 列进行模糊匹配？</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-do-fuzzy-matching-in-python-pandas-dataframe-6ce3025834a6?source=collection_archive---------0-----------------------#2019-09-18">https://towardsdatascience.com/how-to-do-fuzzy-matching-in-python-pandas-dataframe-6ce3025834a6?source=collection_archive---------0-----------------------#2019-09-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/e92d30e7db395c005371a5d56c658494.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XV6tuKLEWgWMWiRZGqBX1w.jpeg"/></div></div></figure><h2 id="0bed" class="kb kc it bd kd ke kf dn kg kh ki dp kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">熊猫和 FuzzyWuzzy 的模糊字符串匹配</h2><p id="9f25" class="pw-post-body-paragraph kx ky it kz b la lb lc ld le lf lg lh kk li lj lk ko ll lm ln ks lo lp lq lr im bi translated">模糊字符串匹配或搜索是近似匹配特定模式的字符串的过程。这是一个非常受欢迎的 Excel 附件。它给出了一个近似的匹配，并不能保证字符串是精确的，但是，有时字符串会精确地匹配模式。字符串与给定匹配的接近程度由<em class="ls">编辑距离</em>来衡量。FuzzyWuzzy 使用<a class="ae lt" href="https://en.wikipedia.org/wiki/Levenshtein_distance" rel="noopener ugc nofollow" target="_blank"> <em class="ls"> Levenshtein 距离</em> </a>来计算<em class="ls">编辑距离。</em></p><p id="3c28" class="pw-post-body-paragraph kx ky it kz b la lu lc ld le lv lg lh kk lw lj lk ko lx lm ln ks ly lp lq lr im bi translated"><strong class="kz iu">如何安装 FuzzyWuzzy 包</strong></p><p id="fe67" class="pw-post-body-paragraph kx ky it kz b la lu lc ld le lv lg lh kk lw lj lk ko lx lm ln ks ly lp lq lr im bi translated">要安装 FuzzyWuzzy，您可以使用如下的<em class="ls"> pip </em>命令</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="9b19" class="kb kc it me b gy mi mj l mk ml">Pip install fuzzywuzzy<br/>Pip install python-Levenshtein</span></pre><p id="8e80" class="pw-post-body-paragraph kx ky it kz b la lu lc ld le lv lg lh kk lw lj lk ko lx lm ln ks ly lp lq lr im bi translated">人们也可以使用 conda 来安装 FuzzyWuzzy。以下命令将安装该库。</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="4d5e" class="kb kc it me b gy mi mj l mk ml"><strong class="me iu">conda install -c conda-forge fuzzywuzzy<br/>conda install -c conda-forge python-levenshtein</strong></span></pre><p id="ee11" class="pw-post-body-paragraph kx ky it kz b la lu lc ld le lv lg lh kk lw lj lk ko lx lm ln ks ly lp lq lr im bi translated">现在让我们导入这些包，因为我们已经成功地安装了上面提到的库。</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="76b7" class="kb kc it me b gy mi mj l mk ml">from <strong class="me iu">fuzzywuzzy </strong>import <strong class="me iu">fuzz</strong><br/>from <strong class="me iu">fuzzywuzzy </strong>import <strong class="me iu">process</strong></span></pre><p id="6d15" class="pw-post-body-paragraph kx ky it kz b la lu lc ld le lv lg lh kk lw lj lk ko lx lm ln ks ly lp lq lr im bi translated">现在，让我告诉你如何使用它。</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="8657" class="kb kc it me b gy mi mj l mk ml">In[1]:fuzz.ratio(“Sankarshana Kadambari”,”Sankarsh Kadambari”)<br/>Out[1]:92<br/>In[2]:fuzz.partial_ratio("Sankarshana Kadambari","Sankarsh   Kadambari")<br/>Out[2]:83</span></pre><p id="3886" class="pw-post-body-paragraph kx ky it kz b la lu lc ld le lv lg lh kk lw lj lk ko lx lm ln ks ly lp lq lr im bi translated">Fuzz 有各种方法可以比较字符串，比如 ratio()、partial_ratio()、Token_Sort_Ratio()、Token_Set_Ratio()。现在下一个问题是什么时候使用哪个模糊函数。你可以在这里阅读<a class="ae lt" href="https://stackoverflow.com/questions/31806695/when-to-use-which-fuzz-function-to-compare-2-strings" rel="noopener ugc nofollow" target="_blank"/>这些场景都有很好的解释。此外，我将在最后提供参考，在那里它将与代码一起被进一步详细解释。</p><figure class="lz ma mb mc gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mm"><img src="../Images/c403e13c1b6220b3bbe077854aff3b05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kvCxfrQ_JdMEfWZ8ZHn-KA.jpeg"/></div></div></figure><h1 id="864a" class="mn kc it bd kd mo mp mq kg mr ms mt kj mu mv mw kn mx my mz kr na nb nc kv nd bi translated"><strong class="ak">现在博客的议程如何用这个在熊猫两栏之间的数据框然后导出到 excel？</strong></h1><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="256b" class="kb kc it me b gy mi mj l mk ml">import pandas as pd <br/>from fuzzywuzzy import fuzz <br/>from fuzzywuzzy import process</span><span id="582e" class="kb kc it me b gy ne mj l mk ml">def checker(wrong_options,correct_options):<br/>    names_array=[]<br/>    ratio_array=[]    <br/>    for wrong_option in wrong_options:<br/>        if wrong_option in correct_options:<br/>           names_array.append(wrong_option)<br/>           ratio_array.append(‘100’)<br/>        else:   <br/>            x=process.<br/>extractOne(wrong_option,correct_options,scorer=fuzz.token_set_ratio)<br/>            names_array.append(x[0])<br/>            ratio_array.append(x[1])<br/>     return names_array,ratio_array</span></pre><p id="1f29" class="pw-post-body-paragraph kx ky it kz b la lu lc ld le lv lg lh kk lw lj lk ko lx lm ln ks ly lp lq lr im bi translated">在上面的代码片段中，我使用了 token_set_ratio，因为它符合我的要求。我还添加了一个<strong class="kz iu"> if 块</strong>，通过检查第二列中的名称来减少迭代次数，因为有时出现的可能性很大。你可以在 scorer 参数中尝试各种其他方法，我在底部分享了源代码，在那里可以详细研究剩余模糊方法的工作。</p><p id="6bcd" class="pw-post-body-paragraph kx ky it kz b la lu lc ld le lv lg lh kk lw lj lk ko lx lm ln ks ly lp lq lr im bi translated">我不会说这是实现模糊逻辑的唯一方法，但是您也可以自己尝试如何在减少执行时间的同时增加代码的可伸缩性。</p><p id="7e90" class="pw-post-body-paragraph kx ky it kz b la lu lc ld le lv lg lh kk lw lj lk ko lx lm ln ks ly lp lq lr im bi translated">现在让我们传递方法中的参数，并创建一个包含结果的输出 excel 文件。</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="f4cf" class="kb kc it me b gy mi mj l mk ml">df_Original_List=pd.read_excel(“Original_list.xlsx”,sheet_name=’Sheet1',usecols=[“Original Name Column”])</span><span id="138e" class="kb kc it me b gy ne mj l mk ml">df_To_beMatched=pd.read_excel("To be matched.xlsx",sheet_name='Sheet1',usecols=["To be Matched Column"])</span></pre><p id="5381" class="pw-post-body-paragraph kx ky it kz b la lu lc ld le lv lg lh kk lw lj lk ko lx lm ln ks ly lp lq lr im bi translated">为了避免错误，在将列传递给函数之前，清理列是非常重要的。主要的运行时错误是由列中的 NAN 值创建的。我用以下方式处理它们。</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="53c4" class="kb kc it me b gy mi mj l mk ml">str2Match = df_To_beMatched[‘To be Matched Column’].fillna(‘######’).tolist()<br/>strOptions =df_Original_List[‘Original Name Column’].fillna(‘######’).tolist()</span></pre><p id="0ea4" class="pw-post-body-paragraph kx ky it kz b la lu lc ld le lv lg lh kk lw lj lk ko lx lm ln ks ly lp lq lr im bi translated">现在让我们传递方法中的参数。</p><pre class="lz ma mb mc gt md me mf mg aw mh bi"><span id="3d64" class="kb kc it me b gy mi mj l mk ml">name_match,ratio_match=checker(str2Match,strOptions)</span><span id="0b5c" class="kb kc it me b gy ne mj l mk ml">df1 = pd.DataFrame()<br/>df1[‘old_names’]=pd.Series(str2Match)<br/>df1[‘correct_names’]=pd.Series(name_match)<br/>df1[‘correct_ratio’]=pd.Series(ratio_match)<br/>df1.to_excel(‘matched_names.xlsx’, engine=’xlsxwriter’)</span></pre><p id="7a9e" class="pw-post-body-paragraph kx ky it kz b la lu lc ld le lv lg lh kk lw lj lk ko lx lm ln ks ly lp lq lr im bi translated">瞧，就是这样。我希望这篇文章在你各自的领域对你有用。这是一个在 excel 中使用的非常强大的函数，但现在它也可以在 python 中用于文本分析或分析。</p><h2 id="5e24" class="kb kc it bd kd ke kf dn kg kh ki dp kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">您可以在其他资源中找到已实现的剩余方法及其各自的工作方式。</h2><ol class=""><li id="845b" class="nf ng it kz b la lb le lf kk nh ko ni ks nj lr nk nl nm nn bi translated"><a class="ae lt" href="https://medium.com/@categitau/fuzzy-string-matching-in-python-68f240d910fe" rel="noopener">https://medium . com/@ categitau/fuzzy-string-matching-in-python-68f 240d 910 Fe</a></li><li id="ffcc" class="nf ng it kz b la no le np kk nq ko nr ks ns lr nk nl nm nn bi translated">https://www.geeksforgeeks.org/fuzzywuzzy-python-library/<a class="ae lt" href="https://www.geeksforgeeks.org/fuzzywuzzy-python-library/" rel="noopener ugc nofollow" target="_blank"/></li><li id="ec3f" class="nf ng it kz b la no le np kk nq ko nr ks ns lr nk nl nm nn bi translated"><a class="ae lt" href="https://www.datacamp.com/community/tutorials/fuzzy-string-python" rel="noopener ugc nofollow" target="_blank">https://www . data camp . com/community/tutorials/fuzzy-string-python</a></li><li id="bb2b" class="nf ng it kz b la no le np kk nq ko nr ks ns lr nk nl nm nn bi translated"><a class="ae lt" rel="noopener" target="_blank" href="/natural-language-processing-for-fuzzy-string-matching-with-python-6632b7824c49">https://towardsdatascience . com/natural-language-processing-for-fuzzy-string-matching-with-python-6632 b 7824 c 49</a></li><li id="5d13" class="nf ng it kz b la no le np kk nq ko nr ks ns lr nk nl nm nn bi translated"><a class="ae lt" href="https://galaxydatatech.com/2017/12/31/fuzzy-string-matching-pandas-fuzzywuzzy/" rel="noopener ugc nofollow" target="_blank">https://galaxydatatech . com/2017/12/31/fuzzy-string-matching-pandas-fuzzywuzzy/</a></li></ol></div></div>    
</body>
</html>