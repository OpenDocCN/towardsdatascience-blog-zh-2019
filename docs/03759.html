<html>
<head>
<title>Downloading the ImageNet…</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">正在下载 ImageNet…</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-scrape-the-imagenet-f309e02de1f4?source=collection_archive---------8-----------------------#2019-06-14">https://towardsdatascience.com/how-to-scrape-the-imagenet-f309e02de1f4?source=collection_archive---------8-----------------------#2019-06-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/b9aa727e0c2f7e439fd1b0e5acc857b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NdiFOoxRLHn2sNOSGupH0Q.jpeg"/></div></div></figure><h1 id="6a80" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">结果是:</h1><p id="0c8b" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">我写了一个<a class="ae lx" href="https://github.com/mf1024/ImageNet-datasets-downloader" rel="noopener ugc nofollow" target="_blank">软件工具</a>，它使用 ImageNet API 提供的 URL 从 ImageNet 数据创建新的数据集。</p><p id="aed7" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated"><strong class="lb iu">你可以告诉这个工具:“我想要一个有 200 个类的数据集，每个类至少有 800 张图片”，它就会开始收集图片。</strong></p><p id="2fc7" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">此外，在这个过程中，我做了一个<a class="ae lx" href="https://github.com/mf1024/data_analysis_notebooks/blob/master/imagenet_urls/ImageNet%20urls%20analysis.ipynb" rel="noopener ugc nofollow" target="_blank">小分析</a>，得出了关于 ImageNet 图片 URL 状态的有趣结论。</p><h1 id="dfa3" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">完整的故事:</h1><p id="37b2" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">我需要在大于 32x32 像素的图像上构建和训练分类 ConvNet，因此我必须找到一个包含用类标记的更大图像的数据集。ImageNet 就是这样一个数据集。</p><p id="6a04" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">ImageNet 广泛用于图像分类模型的基准测试。它包含超过 20 000 个类别的 1400 万张图片。</p><p id="5cd5" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">获取数据的一种方法是使用<a class="ae lx" href="http://academictorrents.com/collection/imagenet-lsvrc-2015" rel="noopener ugc nofollow" target="_blank"> ImageNet LSVRC 2012 </a>数据集，它是整个 ImageNet 的 1000 个类别的选择，包含 128 万张图像。</p><p id="800b" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">但是我不一定想要也不需要下载 20 000 个类中每一个类的 150GB 的数据和图像。出于原型和测试的目的，数据集的较小子集就足够了，例如，100 个类的数据集。</p><p id="78d5" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">ImageNet 项目不拥有任何图像，但是它们通过<a class="ae lx" href="http://image-net.org/download-API" rel="noopener ugc nofollow" target="_blank"> API </a> <a class="ae lx" href="http://image-net.org/download-imageurls" rel="noopener ugc nofollow" target="_blank">或在一个文件</a>中为每个图像提供 URL 列表。</p><p id="96e0" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">我想了解我能够从 ImageNet 创建什么样的数据集。我分析了 URL 列表并绘制了每类图像直方图:</p><figure class="me mf mg mh gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi md"><img src="../Images/6229c9fcef9bcfff5243d0936b22c7a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*mCakLoAJAB9GcxV3.png"/></div></div></figure><p id="a774" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">峰值大约是每类 1200 张图片，超过 1000 个这样的类。足以创建 100 个类数据集的许多变体，每个类至少有 1000 个图像。</p><h1 id="9168" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">下载和第一次观察</h1><p id="3df1" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">于是我写了一个程序，开始下载。</p><p id="c8d1" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated"><strong class="lb iu">在这个过程中，我观察到了 5 件事:</strong></p><ol class=""><li id="7a36" class="mi mj it lb b lc ly lg lz lk mk lo ml ls mm lw mn mo mp mq bi translated">许多网站都关闭了。许多图像找不到了。(这些网址来自 2011 年)</li><li id="deea" class="mi mj it lb b lc mr lg ms lk mt lo mu ls mv lw mn mo mp mq bi translated">从自己的 URL 逐个下载图片是一个缓慢的过程，但关闭的不包含图片的 URL 会使这个过程更慢——在大多数情况下，下载图片比意识到网站不会用图片来响应要快。</li><li id="8d21" class="mi mj it lb b lc mr lg ms lk mt lo mu ls mv lw mn mo mp mq bi translated">图像来源的多样性很高。</li><li id="c6dd" class="mi mj it lb b lc mr lg ms lk mt lo mu ls mv lw mn mo mp mq bi translated">大量图片来自 Flickr。</li><li id="dadb" class="mi mj it lb b lc mr lg ms lk mt lo mu ls mv lw mn mo mp mq bi translated">在某些网站上，如果图像不存在，则返回另一个图像，并带有一些文本，表明该图像不存在。例如:</li></ol><figure class="me mf mg mh gt ju gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/6d40c793f63e90f355ea9772a8e2d9b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:480/format:webp/0*udn7qM_TzW6d3t1N.jpg"/></div></figure><p id="f611" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">这是一个不太容易解决的问题。</p><p id="ef21" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">我想到了一个可能解决一些问题的选择——只使用 Flickr 网址。</p><p id="d4bf" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">为了继续，我首先检查了 ImageNet 中是否有足够的 Flickr 图片来创建足够大的数据集。<strong class="lb iu">快速 URL 解析显示，700 万张图片来自 Flickr，正好是一半。</strong></p><p id="5eb2" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">然后我检查了只有 Flickr URLs 的每个类的图像，得到了下面的图像:</p><figure class="me mf mg mh gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mx"><img src="../Images/500a5edf50470fcebd3ec77118ab8734.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*6xZrZAXaxGa_feuM.png"/></div></div></figure><p id="8aa9" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">高峰已经过去，形势看起来不再那么好了。</p><p id="95ee" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">为了更好地理解这种情况，我创建了每类图像的反向累积图，它不是显示每类有多少个图像，而是显示每类有多少个图像:</p><figure class="me mf mg mh gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi my"><img src="../Images/025825d3c21fd121558e592cb62df235.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*6-PTCo3F3f-B8Lqu.png"/></div></div></figure><p id="393a" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">它显示大约有 2000 个类，每个类至少有 1000 个图像，这仍然非常好，对于我的目的来说绰绰有余。</p><h1 id="b78e" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">Flickr 网址与其他网址</h1><p id="cced" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">现在我需要检查仅使用 Flickr 网址是否会改善下载过程。</p><p id="f9b2" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated"><strong class="lb iu">我运行了一段时间我的下载器。在这个过程中，我尝试了 25 000 个随机网址。对于我发出的每一个 URL 请求，我都标记了图片下载是否成功，并测量了处理 URL 所花费的时间。</strong></p><p id="3bae" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">首先，我想知道我尝试的网址中有多少是 Flickr 网址，有多少是其他网址:</p><figure class="me mf mg mh gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mz"><img src="../Images/4c95e08c704fd406d61d0f59468c11e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*i3j5Yas7oRvB-qHo.png"/></div></div></figure><p id="900c" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">至少在我的随机样本中，这些 URL 在 Flick 和 other 之间平均分布，这将使它们更容易比较。</p><p id="315f" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">以下是 Flickr URLs 与其他 URL 的请求时间对比:</p><figure class="me mf mg mh gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi na"><img src="../Images/688b84bd56cceb75b6b82215f2d1a0bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*qrYD-Y9jaBkrb7Le.png"/></div></div></figure><p id="f8af" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">似乎下载者在其他网址上花了很多时间。让我们看看所花的时间有多有成效。以下是 Flickr 网址与其他网址的成功比较:</p><figure class="me mf mg mh gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nb"><img src="../Images/82e3dd5d376fac288563743a999110de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*O7-Y1bmlr-rkC-ln.png"/></div></div></figure><p id="2b2a" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">在这里，我们可以看到，其他网址需要更多的时间，不太成功。我计算了一下平均值:<strong class="lb iu">大约。80%的 Flickr 网址是成功的，而只有 30%的其他网址是成功的</strong></p><p id="7e07" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">现在让我们检查一下最有趣的指标—<strong class="lb iu">Flickr URL 和其他 URL 每次成功花费的时间</strong>:</p><figure class="me mf mg mh gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nc"><img src="../Images/f9ef691c6e923ce487e4cbd934b14687.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*SIPD2YlCQLB5RVJS.png"/></div></div></figure><p id="dfe4" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">该图显示，下载者在其他 URL 上平均每次成功花费 2 到 10 秒(平均接近 4 秒)，而在 Flickr URLs 上，每次成功的时间始终保持在 0.5 秒以下。一个非常显著的差异。每张图片 0.5 秒仍然很慢，但比使用所有的 URL 要快得多，也更一致。</p><h1 id="1804" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">ImageNet 下载器</h1><p id="dda2" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">在这个过程中，我编写了一个<a class="ae lx" href="https://github.com/mf1024/ImageNet-datasets-downloader" rel="noopener ugc nofollow" target="_blank">下载器</a>，它将创建一个包含 Y 个类的数据集，每个类包含 X 张图片。我准备好用了放在 GitHub 上。</p><p id="e618" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">下载器将随机挑选每班至少有 YY 图像的班级。但是如果你有什么特殊的需求，你可以指定一个下载的类列表。要选择类，您可以查看一下<a class="ae lx" href="https://github.com/mf1024/ImageNet-datasets-downloader/blob/master/classes_in_imagenet.csv" rel="noopener ugc nofollow" target="_blank">类列表 csv </a>，其中我列出了出现在 ImageNet 中的每个类及其名称、id 和 URL 计数。</p><p id="b4e3" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated">默认情况下，下载器将只使用 Flickr 网址，但如果你足够勇敢，并准备等待更长时间，并准备清理坏图像的数据，你可以关闭该选项。</p><h1 id="a1a8" class="kb kc it bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">更新:多处理器工作人员带来 25 倍的性能提升</h1><p id="f299" class="pw-post-body-paragraph kz la it lb b lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw im bi translated">我已经实现了并行请求处理。<strong class="lb iu">有了 24 名员工，我的速度提高了 25 倍——大约。每幅图像约 0.02 秒。2 到 6 MB/s 的总下载速度。</strong>我担心 Flickr 会以某种方式限制带宽和下载的数据量，但幸运的是，情况并非如此——我通过在短时间内下载 1000 x 1000 的图像数据集(60GB 的数据)测试了这些限制，没有出现任何问题。</p><p id="558a" class="pw-post-body-paragraph kz la it lb b lc ly le lf lg lz li lj lk ma lm ln lo mb lq lr ls mc lu lv lw im bi translated"><a class="ae lx" href="https://mf1024.github.io/2019/06/09/how-to-scrape-the-imagenet/" rel="noopener ugc nofollow" target="_blank">这是我博客的转贴。</a></p></div></div>    
</body>
</html>