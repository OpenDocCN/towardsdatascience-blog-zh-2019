<html>
<head>
<title>Web Scraping Metacritic Reviews using BeautifulSoup</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 BeautifulSoup 的 Web 抓取元评论</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/web-scraping-metacritic-reviews-using-beautifulsoup-63801bbe200e?source=collection_archive---------7-----------------------#2019-12-11">https://towardsdatascience.com/web-scraping-metacritic-reviews-using-beautifulsoup-63801bbe200e?source=collection_archive---------7-----------------------#2019-12-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="a0d4" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">一个简单的 6 步指南，使用 BeautifulSoup 收集游戏评论并保存到 pandas dataframe 中。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/dfdf203f9be49b52122953b5e411df55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jEBcfN2xHgK3gTLXlxB5aw.png"/></div></div></figure><p id="a32d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi ln translated"><span class="l lo lp lq bm lr ls lt lu lv di">我</span>决定刮掉<a class="ae lw" href="https://www.metacritic.com/game/switch/pokemon-sword/user-reviews" rel="noopener ugc nofollow" target="_blank">元批评口袋妖怪的评论</a>，因为我想给负面游戏评论做个主题模型。我很好奇这些游戏是如何被评论家称赞，却被大多数玩家评价很差的。为什么游戏玩家讨厌口袋妖怪？在<a class="ae lw" rel="noopener" target="_blank" href="/using-mallet-lda-to-learn-why-players-hate-pokémon-sword-shield-23b12e4fc395">这篇</a>文章中会有更多相关内容。与此同时，我是这样从网站上搜集评论的。</p><p id="9dcb" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><em class="lx">* *底部全码。嵌入代码(在灰色框中)用于解释目的*** </em></p><ol class=""><li id="d08d" class="ly lz iq kt b ku kv kx ky la ma le mb li mc lm md me mf mg bi translated"><strong class="kt ir">导入包。你需要的主要包装是 request、BeautifulSoup 和 pandas。</strong></li></ol><pre class="kg kh ki kj gt mh mi mj mk aw ml bi"><span id="95b5" class="mm mn iq mi b gy mo mp l mq mr"><em class="lx">#To get the url, and scrap the html page  </em></span><span id="9c74" class="mm mn iq mi b gy ms mp l mq mr">import requests<br/>from bs4 import BeautifulSoup</span><span id="c79d" class="mm mn iq mi b gy ms mp l mq mr"><em class="lx">#To save the reviews in a dataframe </em></span><span id="2e90" class="mm mn iq mi b gy ms mp l mq mr">import pandas as pd</span></pre><p id="e820" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">2.<strong class="kt ir">弄清楚网页的 Html 结构。</strong> Html 标签用于标记页面元素，相似的元素通常包含在相同的标签内。您希望熟悉 Html 标签模式，哪些标签包含哪些信息，以及找到这些标签的最佳方法。</p><p id="00e0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">找到重要标签最简单的方法是使用 Chrome，选择你感兴趣的文本，点击右键，然后“检查”。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mt"><img src="../Images/14a5f4433102625fb75a5b72fbedfe91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vzN2IS_H261fSbtaObcAkQ.png"/></div></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk">Highlight the text of interest, and right-click to ‘Inspect’</figcaption></figure><p id="55c1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这将打开一个包含页面 Html 的单独窗口。我们突出显示的文本在<em class="lx"> span </em>标签中。你可以展开<em class="lx"> span </em>标签，点击<em class="lx">span&lt;span&gt;T17】旁边的小三角就可以看到文字。</em></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi my"><img src="../Images/3378370c044214a75cc4b86329ca1496.png" data-original-src="https://miro.medium.com/v2/resize:fit:1064/format:webp/1*IJWlVAdyq6SlPEBhZMsZ8Q.png"/></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk">A segment of each review’s html structure. We are interested in the user review in the span tag.</figcaption></figure><p id="3153" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">BeautifulSoup (BS)可以在<em class="lx"> span </em>标签中找到评论，但是在<em class="lx"> span </em>标签中还有其他页面元素是<strong class="kt ir">而不是</strong>评论。更好的方法是告诉 BS 找到一个特定于评论的外部标签，然后在其中找到一个<em class="lx"> span </em>标签。</p><p id="21d1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果您滚动页面的 Html，您会注意到每个评论的文本都嵌套在<em class="lx"> div 类</em>中。这些类遵循固定的结构，并在页面上的每个评论中重复。</p><p id="3094" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">记下<em class="lx"> review_content </em> div 类。它包含用户名、评分和评论文本等评论内容。另外，请注意<em class="lx"> review_content </em>中的其他类，因为我们将使用它们来告诉 BS 如何找到评论文本。</p><p id="50c8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">3.使用 BS 解析页面。发出 URL 请求，并将响应解析成 BS。</p><pre class="kg kh ki kj gt mh mi mj mk aw ml bi"><span id="956b" class="mm mn iq mi b gy mo mp l mq mr">url = '<a class="ae lw" href="https://www.metacritic.com/game/switch/pokemon-sword/user-reviews" rel="noopener ugc nofollow" target="_blank">https://www.metacritic.com/game/switch/pokemon-sword/user-reviews?page=</a>0'<br/><br/>user_agent = {'User-agent': 'Mozilla/5.0'}<br/>response = requests.get(url, headers = user_agent)<br/><br/>soup = BeautifulSoup(response.text, 'html.parser')</span></pre><p id="b8b9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">4.<strong class="kt ir">创建一个字典来保存你想要抓取的信息</strong>。关键字是功能名称，值是列表。</p><pre class="kg kh ki kj gt mh mi mj mk aw ml bi"><span id="41aa" class="mm mn iq mi b gy mo mp l mq mr">review_dict = {'name':[], 'date':[], 'rating':[], 'review':[]}</span></pre><p id="b562" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">5.告诉 BS 如何找到你想要的信息，并将它们添加到字典列表中。我们将讨论如何复习课文。其他元素的代码在这篇文章的底部。</p><pre class="kg kh ki kj gt mh mi mj mk aw ml bi"><span id="3675" class="mm mn iq mi b gy mo mp l mq mr">#look for review_content tags since every user review has this tag<br/> <br/>for review in soup.find_all('div', class_='review_content'): </span><span id="f416" class="mm mn iq mi b gy ms mp l mq mr">#within review_content tag, look for the presence of longer reviews</span><span id="6d3f" class="mm mn iq mi b gy ms mp l mq mr">if review.find('span', class_='blurb blurb_expanded'): review_dict['review'].append(review.find('span', class_=’blurb blurb_expanded').text)<br/> <br/>else: review_dict[‘review’].append(review.find('div',class_='review_body').find('span').text)</span></pre><p id="88fe" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们使用<em class="lx"> find all </em>来获取页面中所有的<em class="lx"> review_content </em>标签。这与查找页面上的所有评论是一样的，因为每个评论都包含在这个 div 类中。</p><p id="e12e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">if-else 语句确保从正确的标记中提取文本，这取决于评论是否很长。</p><p id="edca" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们先来看‘else’条件。对于每个<em class="lx"> review_content </em>标签，我们寻找一个靠近包含文本评论的 span 标签的 div 类。在本例中，我使用了<em class="lx"> review_body </em> div 类。由于这个类中只有一个<em class="lx"> span </em>标签，我们可以使用<em class="lx"> find </em>来查找第一个<em class="lx"> span </em>标签。</p><p id="fba7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">关于“如果”的条件。较长的评论(需要用户点击“展开”来查看全文)在一个<em class="lx">blurb blurb _ expanded</em>span 类中。较短的评论没有这个类。由于<em class="lx"> blurb blurb_expanded </em>只出现在较长的评论中，我们可以<em class="lx">直接找到</em>它。</p><p id="f642" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">因为 Metacritic 上的所有评论都有相同的元素，所以我们可以将所需的信息添加到列表中，它们将是有序的。</p><p id="783e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">6.将字典转换成数据帧。</p><pre class="kg kh ki kj gt mh mi mj mk aw ml bi"><span id="e711" class="mm mn iq mi b gy mo mp l mq mr">sword_reviews = pd.DataFrame(review_dict)</span></pre><p id="68a7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">呜哇！仅此而已。如果你想收集所有的评论，你只需要遍历所有的页面，就像我在下面的代码中所做的那样:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mz na l"/></div><figcaption class="mu mv gj gh gi mw mx bd b be z dk">Web Scraper for Metacritic Game Reviews</figcaption></figure><p id="0cfc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在这篇文章中，我们使用 BS 创建了一个简单的 web scraper。我们可以这样做，因为页面没有动态内容。对于动态页面，你可能想尝试使用<em class="lx"> Selenium，</em>当与 BS 结合使用时会非常强大。</p><p id="3585" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">网络抓取可能很耗时，但它是获取在线内容的一个途径。我个人认为网络抓取对 NPL 项目很有用，因为它可以方便地访问当前的对话，并快速感知情绪，这对营销/传播活动的实时评估很有用。</p><p id="d866" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">希望这篇帖子对你有帮助。刮的开心！</p></div></div>    
</body>
</html>