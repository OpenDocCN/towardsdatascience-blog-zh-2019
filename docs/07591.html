<html>
<head>
<title>Analysing breast cancer using deep learning</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用深度学习分析乳腺癌</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/analysing-breast-cancer-using-deep-learning-e3426f768c52?source=collection_archive---------29-----------------------#2019-10-22">https://towardsdatascience.com/analysing-breast-cancer-using-deep-learning-e3426f768c52?source=collection_archive---------29-----------------------#2019-10-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/c275344c53774b73aef37658dc086535.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r8-BLM-3PV_o4e4qPA0IyA.jpeg"/></div></div></figure><p id="16bd" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">用于检测乳腺癌的过程非常耗时，小的恶性肿瘤区域可能会被遗漏。</p><p id="ff80" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">为了检测癌症，将组织切片放在载玻片上。然后，病理学家在显微镜下检查这张载玻片，目视扫描没有癌症的大区域，以便最终找到恶性区域。由于这些载玻片现在可以数字化，计算机视觉可以用来加快病理学家的工作流程，并提供诊断支持。</p><h1 id="d179" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">一些术语</h1><p id="c418" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">组织病理学 <br/>这包括在显微镜下检查玻璃组织切片，看是否存在疾病。在这种情况下，这将是检查淋巴结的组织样本，以检测乳腺癌。</p><p id="0c1b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">整个载玻片图像(WSI) </strong> <br/>用扫描仪拍摄的载玻片的数字化高分辨率图像。这些图像的大小可能有几千兆字节。因此，为了让它们用于机器学习，这些数字图像被切割成小块。</p><p id="4738" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">小块</strong> <br/>小块是图像的一小块，通常为矩形。例如，一个 50×50 的小块是一个包含 2500 个像素的正方形小块，取自一个更大的图像，比如 1000×1000 个像素。</p><p id="99d9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">淋巴结是一个小豆状结构，是人体免疫系统的一部分。淋巴结过滤通过淋巴液的物质。它们含有淋巴细胞(白细胞)，帮助身体对抗感染和疾病。</p><p id="a43a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">前哨淋巴结</strong> <br/>在肿瘤附近注射蓝色染料和/或放射性示踪剂。这种注射物质到达的第一个淋巴结称为前哨淋巴结。我们将使用的图像是取自前哨淋巴结的所有组织样本。</p><p id="cd2e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">转移</strong> <br/>癌细胞扩散到身体新的区域，通常通过淋巴系统或血液。</p><h1 id="7a6d" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">数据</h1><p id="7f1f" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">浸润性导管癌(IDC)是所有乳腺癌中最常见的亚型。几乎 80%确诊的乳腺癌都是这种亚型。这个<a class="ae mc" href="https://www.kaggle.com/paultimothymooney/breast-histopathology-images" rel="noopener ugc nofollow" target="_blank"> kaggle 数据集</a>由 277，524 个大小为 50 x 50 的小块组成(198，738 个 IDC 阴性，78，786 个 IDC 阳性)，这些小块是从 162 个以 40 倍扫描的乳腺癌(BCa)标本的整块载玻片图像中提取的。每个补片的文件名格式为:u_xX_yY_classC.png(例如，10253 _ idx 5 _ X 1351 _ Y 1101 _ class 0 . png)，其中 u 为患者 ID (10253_idx5)，X 为该补片裁剪位置的 X 坐标，Y 为该补片裁剪位置的 Y 坐标，C 表示类别，其中 0 为非 IDC，1 为 IDC。</p><h2 id="a7d2" class="md la it bd lb me mf dn lf mg mh dp lj km mi mj ln kq mk ml lr ku mm mn lv mo bi translated">下载和准备数据</h2><p id="3946" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">首先，我们需要下载数据集并解压。这些图像将保存在“IDC_regular_ps50_idx5”文件夹中。每 279 名患者都有一个文件夹。患者文件夹包含 2 个子文件夹:文件夹“0”包含非 IDC 补丁，文件夹“1”包含相应患者的 IDC 图像补丁。</p><figure class="mp mq mr ms gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/58460a9af0e50351fa8ab12e7e2a77f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wsQo_GqZWlTrbDBpjE8n0Q.png"/></div></div><figcaption class="mt mu gj gh gi mv mw bd b be z dk">IDC dataset structure</figcaption></figure><p id="84bf" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">50x50 图像补丁看起来像这样:</p><figure class="mp mq mr ms gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mx"><img src="../Images/6931fdd03c20d261093ae6f6822b2dd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FoA7ZcymT70jsXqg5D7pDg.png"/></div></div><figcaption class="mt mu gj gh gi mv mw bd b be z dk">IDC images</figcaption></figure><p id="1fa3" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在，我们需要将所有患者的所有 IDC 图像放入一个文件夹，并将所有非 IDC 图像放入另一个文件夹。可以手动完成，但是我们编写了一个简短的 python 脚本来完成:</p><pre class="mp mq mr ms gt my mz na nb aw nc bi"><span id="90dd" class="md la it mz b gy nd ne l nf ng"><strong class="mz iu">import</strong> os <br/><strong class="mz iu">from</strong> shutil <strong class="mz iu">import</strong> copyfile  </span><span id="5d4f" class="md la it mz b gy nh ne l nf ng">src_folder = 'IDC_regular_ps50_idx5' <br/>dst_folder = 'train'  </span><span id="b786" class="md la it mz b gy nh ne l nf ng">os.mkdir(os.path.join(dst_folder, '0')) os.mkdir(os.path.join(dst_folder, '1'))  </span><span id="f71d" class="md la it mz b gy nh ne l nf ng">folders = os.listdir(src_folder) <br/><strong class="mz iu">for</strong> f <strong class="mz iu">in</strong> folders:<br/>     f_path = os.path.join(src_folder, f)<br/>     <strong class="mz iu">for</strong> cl <strong class="mz iu">in</strong> os.listdir(f_path):<br/>         cl_path = os.path.join(f_path, cl)<br/>         <strong class="mz iu">for</strong> img <strong class="mz iu">in</strong> os.listdir(cl_path):<br/>             copyfile(os.path.join(cl_path, img), os.path.join(dst_folder, cl, img))<br/></span></pre><p id="91bb" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">结果将如下所示。我们可以把它作为我们的训练数据。</p><figure class="mp mq mr ms gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ni"><img src="../Images/22fd6ef488ae0bd2639d6706c1dac301.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x-gcoG9EKWTa1n5AqxWleg.png"/></div></div></figure><p id="2673" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后，我们将 10%的训练图像放入一个单独的文件夹中，用于测试。为此，我们创建一个“test”文件夹，并执行以下 python 脚本:</p><pre class="mp mq mr ms gt my mz na nb aw nc bi"><span id="c230" class="md la it mz b gy nd ne l nf ng"><strong class="mz iu">import</strong> numpy <strong class="mz iu">as</strong> np<br/><strong class="mz iu">import</strong> os <br/><strong class="mz iu">from</strong> shutil <strong class="mz iu">import</strong> move</span><span id="2ecd" class="md la it mz b gy nh ne l nf ng">src_folder = 'train' <br/>dst_folder = 'test' <br/>test_ratio = 0.1  </span><span id="dca6" class="md la it mz b gy nh ne l nf ng">os.mkdir(os.path.join(dst_folder, '0')) os.mkdir(os.path.join(dst_folder, '1'))  </span><span id="51a6" class="md la it mz b gy nh ne l nf ng"><strong class="mz iu">for</strong> cl <strong class="mz iu">in</strong> os.listdir(src_folder):<br/>     class_path = os.path.join(src_folder, cl)<br/>     class_images = os.listdir(class_path)<br/>     n_test_images = int(test_ratio*len(class_images))<br/>     np.random.shuffle(class_images)<br/>     <strong class="mz iu">for</strong> img <strong class="mz iu">in</strong> class_images[:n_test_images]:<br/>         move(os.path.join(class_path, img), os.path.join(dst_folder, cl, img))<br/></span></pre><h1 id="fa0b" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">安装机器学习工具</h1><p id="a77a" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">我们将使用<a class="ae mc" href="https://www.intelec.ai/" rel="noopener ugc nofollow" target="_blank"> Intelec AI </a>创建一个图像分类器。你可以从这里免费下载并安装<a class="ae mc" href="https://www.intelec.ai/install" rel="noopener ugc nofollow" target="_blank"/>。</p><h1 id="3e56" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">训练图像分类器</h1><p id="4deb" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">Intelec AI 为图像分类提供了 2 种不同的训练器。第一个是<strong class="kd iu">简单图像分类器</strong>，它使用浅层卷积神经网络(CNN)。训练速度很快，但是最终的准确度可能没有另一个更深层次的 CNN 那么高。第二个是<strong class="kd iu">深度图像分类器</strong>，训练时间更长，但准确率更高。</p><p id="1d47" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">首先，我们使用简单的图像分类器创建了一个训练，并开始它:</p><figure class="mp mq mr ms gt ju gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/81ab38e88c774910484aaee04b295c20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*TzcEYwOTNI0ewm-IeqA04g.png"/></div><figcaption class="mt mu gj gh gi mv mw bd b be z dk">Train a simple image classifier</figcaption></figure><p id="ee22" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">培训总结如下:</p><figure class="mp mq mr ms gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ni"><img src="../Images/39951f4aac55307391e9f2da545cb43c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T6MEjsA4xoXYwFOQS26eJA.png"/></div></div><figcaption class="mt mu gj gh gi mv mw bd b be z dk">Training summary on test data</figcaption></figure><p id="26e5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">测试集准确率为 80%。对于一个小车型来说也算是不错的成绩了。但是我们可以做得更好。因此我们尝试了“深度图像分类器”,看看我们是否能训练出更准确的模型。</p><figure class="mp mq mr ms gt ju gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/5d5602a1c6e8549545f0e2ad00262e62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*ZCwA4OB86Y4JQdvBrpH3Pw.png"/></div><figcaption class="mt mu gj gh gi mv mw bd b be z dk">Train a deep CNN for image classification</figcaption></figure><p id="f0a2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们得到了更好的测试集准确性:</p><figure class="mp mq mr ms gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ni"><img src="../Images/5a61bf1a9188f16de60cc73dc6e7cd27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KdmOvM3OAoHZ-dAfui2wXg.png"/></div></div><figcaption class="mt mu gj gh gi mv mw bd b be z dk">Deep CNN training summary</figcaption></figure><p id="3589" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们能够通过训练更深层次的网络来提高模型的准确性。添加更多的训练数据也可能提高准确性。</p><h1 id="0542" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">专家对计算病理学有什么看法？</h1><p id="b2f0" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">计算病理学副教授、2016 年和 2017 年非常成功的<a class="ae mc" href="https://camelyon17.grand-challenge.org/" rel="noopener ugc nofollow" target="_blank">camelion grand challenges</a>的协调员耶鲁安·范德拉克教授认为，计算方法将在病理学的未来发挥重要作用。</p><figure class="mp mq mr ms gt ju"><div class="bz fp l di"><div class="nk nl l"/></div></figure><p id="9bbf" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在下一个视频中，诺丁汉大学的癌症病理学教授伊恩·埃利斯，他无法想象没有计算方法的病理学:</p><figure class="mp mq mr ms gt ju"><div class="bz fp l di"><div class="nk nl l"/></div></figure><h1 id="9e00" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">感谢</h1><p id="6566" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">使用的来源:</p><ul class=""><li id="9ecb" class="nm nn it kd b ke kf ki kj km no kq np ku nq ky nr ns nt nu bi translated"><a class="ae mc" href="https://www.kaggle.com/paultimothymooney/breast-histopathology-images" rel="noopener ugc nofollow" target="_blank">来自 kaggle 的数据集</a></li><li id="6d42" class="nm nn it kd b ke nv ki nw km nx kq ny ku nz ky nr ns nt nu bi translated"><a class="ae mc" href="https://www.kaggle.com/vbookshelf/part-1-breast-cancer-analyzer-web-app" rel="noopener ugc nofollow" target="_blank"> Kaggle 内核</a></li></ul></div></div>    
</body>
</html>