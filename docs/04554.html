<html>
<head>
<title>Data Science in daily life</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">日常生活中的数据科学</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/data-science-in-daily-life-ee1ed06b93d7?source=collection_archive---------31-----------------------#2019-07-12">https://towardsdatascience.com/data-science-in-daily-life-ee1ed06b93d7?source=collection_archive---------31-----------------------#2019-07-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="3b7c" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">— —获取数据，整理并分析数据</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/e247be8575350383904c560157d2823d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aCktFv5EjNI-w-0YuBGigg.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">(<a class="ae kv" href="https://akspic.com/image/93693-girder_bridge-arch_bridge-beam_bridge-transport-seattle" rel="noopener ugc nofollow" target="_blank">Source</a>)</figcaption></figure><p id="a1da" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我通常确保自己不是“迟到的人”甚至有时我不能提前参加聚会；我准时到达那里。我想，和大多数人一样，我会事先查看谷歌地图，计划好何时出发。然而，你永远无法避免各种各样的事故，让你陷入困境。最近，我刚刚在我的列表中添加了一个新事件。刚搬到西雅图过暑假，第一次被夹在一座可能会关闭的桥里！为了让渡船通过，这些桥会时不时地关闭。有时候 5 到 10 分钟会让你焦虑。</p><p id="baa8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为此我想，为什么不用数据科学知识来做一些基本面的分析。我的朋友曾经告诉我，有一个西雅图大桥 twitter 发布了西雅图所有桥梁的关闭-重新开放信息，我发现这是一个做网络报废的极好资源。在 twitter 内部，我发现这些推文仅仅是六天前的，这对于一个迷你数据科学项目来说已经足够了。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ls"><img src="../Images/2989d1d2a56b400373daa6752a315a11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wLTjYE0QXSQ22MMzaoA7ew.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">(The tweets generally look like this)</figcaption></figure><p id="a0cb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一般来说，网络搜集是数据科学家从网站收集数据的一种强有力的方法。即使我们获得了使用 API 的许可，我们可能会发现自己需要从现有数据库之外获取一些信息。这些信息可以帮助我们更好地分析问题，或者为更好的建模增加特性。在所有针对 python 的 web 浏览器包中，BeautifulSoup 和 Selenium 是最常用的工具之一。BeautifulSoup 允许您存储整个 HTML 页面以供进一步解析，而 Selenium 将允许您单击按钮，在框中键入单词，并向下滚动网页。在这个项目中，我使用 Selenium 向下滚动 twitter(就像人一样)，使用 BeautifulSoup 存储 HTML 页面并解析它以获取所有信息。</p><pre class="kg kh ki kj gt lt lu lv lw aw lx bi"><span id="4ea3" class="ly lz iq lu b gy ma mb l mc md"># import web scrapping libraries<br/>from selenium.common.exceptions import NoSuchElementException<br/>from selenium.webdriver import Chrome<br/>from bs4 import BeautifulSoup<br/>import re<br/>import requests</span><span id="1db7" class="ly lz iq lu b gy me mb l mc md">broswer = Chrome()</span><span id="106a" class="ly lz iq lu b gy me mb l mc md">url = '<a class="ae kv" href="https://twitter.com/sdotbridges?lang=en'" rel="noopener ugc nofollow" target="_blank">https://twitter.com/sdotbridges?lang=en'</a><br/>broswer.get(url)</span></pre></div><div class="ab cl mf mg hu mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="ij ik il im in"><p id="2615" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们首先导入 web 报废库，并使用 Selenium 打开网页。</p><pre class="kg kh ki kj gt lt lu lv lw aw lx bi"><span id="628e" class="ly lz iq lu b gy ma mb l mc md">def get_all_bridge_openings(browser):<br/>    """<br/>    Scrolls tweets.<br/>    Parameters<br/>    ----------<br/>    browser: webdriver object<br/>    Returns<br/>    -------<br/>    bridge_opening: webelement object<br/>    """<br/>    sel = 'div.tweet'<br/>    prev_items_found = -1<br/>    n_items_found = 0<br/>    while n_items_found &gt; prev_items_found:<br/>        prev_items_found = n_items_found<br/>        bridge_opening = browser.find_elements_by_css_selector(sel)<br/>        n_items_found = len(bridge_opening)<br/>        last_bridge_opening = bridge_opening[-1] <br/>        loc = last_bridge_opening.location_once_scrolled_into_view<br/>        time.sleep(2)<br/>    print(f"The total number of tweets collected is: {n_items_found}")<br/>    return bridge_opening</span><span id="4272" class="ly lz iq lu b gy me mb l mc md">bridge_openings = get_all_bridge_openings(broswer)</span></pre><p id="1bd4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个函数模拟向下滚动的过程，并获取 web 元素对象进行解析。如打印声明所示，我们总共收集了 821 条推文。</p><pre class="kg kh ki kj gt lt lu lv lw aw lx bi"><span id="c3c2" class="ly lz iq lu b gy ma mb l mc md">data = [tweet.get_attribute("innerHTML") for tweet in bridge_openings]</span><span id="3e89" class="ly lz iq lu b gy me mb l mc md">with open(".secret_bridge") as f:<br/>    password = f.readline().strip()</span><span id="49c2" class="ly lz iq lu b gy me mb l mc md">mongo_url = f'mongodb+srv://Colin:{<a class="ae kv" href="mailto:password}&lt;a href=" rel="noopener ugc nofollow" target="_blank">@cluster0</a>-tnykl.mongodb.net"&gt;password}<a class="ae kv" href="http://twitter.com/cluster0" rel="noopener ugc nofollow" target="_blank">@cluster0</a>-tnykl.mongodb.net/test'<br/>mc = pymongo.MongoClient(host= mongo_url)</span><span id="9d05" class="ly lz iq lu b gy me mb l mc md">db = mc['boat_info']</span><span id="3c52" class="ly lz iq lu b gy me mb l mc md">html_col = db['tweet_html']</span><span id="0b78" class="ly lz iq lu b gy me mb l mc md">for tweet in data[1:]:<br/>   html_col.insert_one({'html': tweet})</span></pre><p id="b17c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这里，我将我的 JSON 文档存储在 MongoDB 中，这是一个 NoSQL 数据库程序。这个视频很好地介绍了这个数据库。MongoDB 使用带有模式的类似 JSON 的文档，这对于存储 HTML 文件很有用。然而，MongoDB 要求客户端登录。然后，通过使用 insert-one 函数，我们可以追加我们的文档。</p><pre class="kg kh ki kj gt lt lu lv lw aw lx bi"><span id="baf1" class="ly lz iq lu b gy ma mb l mc md">def get_bridge_time(info):<br/>    """<br/>    Parse the epoch time in the html.<br/>    Parameters<br/>    ----------<br/>    info: dict<br/>    Returns<br/>    -------<br/>    date: datetime<br/>    """<br/>    soup = BeautifulSoup(info['html'])<br/>    epoch_time = soup.find_all('a')[1].span['data-time']<br/>    date = pd.Timestamp(int(epoch_time), unit='s')<br/>    return date</span></pre><p id="0670" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于 HTML 解析，我们可以使用 BeautifulSoup。其中一个解析函数如上所示。检查完网页后，我们需要查看 HTML 标记，如" div "、" a "、" span "、" li "，以找到我们想要的信息，并使用正确的方法来定位和调用它们。一旦获得时间戳，我们就可以将其转换为 DateTime 类型。</p><pre class="kg kh ki kj gt lt lu lv lw aw lx bi"><span id="044f" class="ly lz iq lu b gy ma mb l mc md">df.set_index('time',inplace=True)<br/>seattle_time = df.index - timedelta(hours=7)<br/>df.index = seattle_time<br/>df.tail()</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mm"><img src="../Images/134614d1722b34e8a24f76caa14985f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CQmcDon11B4sskkR9Dfx6w.png"/></div></div></figure><p id="9abe" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在我们解析 HTML 和时间、桥和状态信息之后，我们可以将它们存储到数据帧中。数据框将如下所示。</p><p id="e2c3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">通常，数据工程过程可能是另一个挑战。有时，会有一些无效的数据记录，如空值，或者可能会有一些由人为错误产生的荒谬记录。这些都需要评估。由于数据清理过程相当繁琐，我不会把它包括在博客中。</p><p id="ed22" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个数据集的另一个问题是很难解释状态。为了帮助在图中绘制，我将“关闭”状态设置为 1，将“重新打开”状态设置为 0。“关闭”状态和“重新开放”状态之间的时间段代表渡船经过的时间。同时,“重新开放”状态和“关闭”状态之间的时间段代表汽车经过的时间。前一个是我感兴趣的状态。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mn"><img src="../Images/a0d1d4b2eced0dbe658fe5404f7fa336.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r-Af1oox0eMQLUfag28A3w.png"/></div></div></figure><p id="618b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如上所示，每个细长条代表桥的“关闭”状态。六个支线剧情给出了“关闭”频率的直觉，即六天内每座桥的总“关闭”时间。从这个图中，我们了解到弗里蒙特桥、巴拉德桥和大学桥是西雅图最繁忙的桥梁。它们代表最长的总“关闭”时间和最高的“关闭”频率。此外，通过仔细观察，我们可以看出大多数状态变化发生在上午 10 点到下午 7 点。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mo"><img src="../Images/72870e5783dc987af9bdddffb8b9d19c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sasLWMUcfNTzgu5yxGtoEw.png"/></div></div></figure><p id="c276" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果我们计算每座桥的总时间段，我们还可以生成该数据框，该数据框显示总关闭时间、总关闭频率以及日平均关闭频率。用总关闭时间除以总关闭频率，可以计算出平均关闭持续时间。由此可见，前三座桥关闭的次数最多，时间最长。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mp"><img src="../Images/ff18d417b434804db18d352172e260c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n1HVH5L7ucb1Imno1rqtbw.png"/></div></div></figure><p id="906f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">从柱状图中可以更清楚地看出，在过去的六天中，弗里蒙特桥处于“关闭”状态的时间是六座桥中最长的。总之，弗里蒙特大桥的关闭状态总计接近 10 个小时。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mp"><img src="../Images/df8cdd921c7c12a8c4345924c8540253.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3j62U8zs9oEcPq6an-AdRA.png"/></div></div></figure><p id="5b2b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">更有趣的是，在这六天里，下斯波坎街大桥平均处于“关闭”状态的时间最长。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mq"><img src="../Images/0f8da5e9647d191b1e7868c4c5d2f789.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K1Pze5-ScVBL7FK6QFp5mA.png"/></div></div></figure><p id="749f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果位置信息相关并包含在数据集中，那么值得尝试在地图上绘制结果。我这里用的是 Tableau，一个强大的数据可视化软件。通过导入 CSV 文件，列将在左侧显示为“尺寸”和“尺寸”然后，您可以“拖动”上面“列”和“行”上的“纬度”和“经度”列。此外，通过将其他“维度”和“度量”拖到中间的“标记”框中，每一行的值都会按照您的需要显示在地图上。您可以尝试不同的标记方法，看看如何有效地说明这些值。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mr"><img src="../Images/c69b73639950d17439a48219f45347b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uMJwQp2ksZaWcP1MB7lcpg.png"/></div></div></figure><p id="0a17" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">六个圆圈代表六座桥的位置，三座靠近西雅图市中心，而另外三座稍远一点。圆圈的大小表示平均关闭状态持续时间。圆圈越大，平均关闭状态越长。这些数字代表每座桥的平均频率。绿色的透明度取决于总的关闭时间。</p><p id="ce4e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在我们对西雅图大桥有了更深入的了解，这更令人兴奋！我们可以假设为什么不同桥梁的关闭频率和持续时间是不同的。我们也可以从其他网站进行网络搜集，为进一步的研究提供证据。</p><p id="e7ac" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但更实际的是，因为我通常乘坐公交车通过弗里蒙特桥和大学桥，而且因为我现在知道这些桥应该只关闭 5 分钟，所以我不需要太担心迟到！</p><p id="7099" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我希望这个小项目对你有所帮助。下面随意评论，干杯！</p></div></div>    
</body>
</html>