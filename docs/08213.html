<html>
<head>
<title>STL decomposition : How to do it from Scratch?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">STL 分解:如何从零开始？</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/stl-decomposition-how-to-do-it-from-scratch-b686711986ec?source=collection_archive---------0-----------------------#2019-11-10">https://towardsdatascience.com/stl-decomposition-how-to-do-it-from-scratch-b686711986ec?source=collection_archive---------0-----------------------#2019-11-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="1e8c" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">弄清楚什么是 STL 分解，以及它是如何工作的。</h2></div><p id="6efd" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这篇文章将帮助你理解什么是 STL 分解，以及如何从头开始。最后，我也将使用 statsmodel 库，在几秒钟内得到结果。</p><h1 id="7ad9" class="le lf it bd lg lh li lj lk ll lm ln lo jz lp ka lq kc lr kd ls kf lt kg lu lv bi translated">什么是 STL 分解？</h1><p id="0acb" class="pw-post-body-paragraph ki kj it kk b kl lw ju kn ko lx jx kq kr ly kt ku kv lz kx ky kz ma lb lc ld im bi translated">所以，STL 代表<strong class="kk iu">使用黄土进行季节和趋势分解。</strong>这是一种将时间序列数据分解为包含季节性、趋势和残差的 3 个分量的统计方法。</p><figure class="mc md me mf gt mg gh gi paragraph-image"><div class="gh gi mb"><img src="../Images/ca26daa896a1af74461ab6486c9b3c5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:848/format:webp/1*idfm9hWt6OaO3A1-EeoOAw.png"/></div></figure><p id="5a52" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，什么是时间序列数据？它是一系列数据点，在一个连续的时间轴上变化。下面是一个时间序列数据的例子，你可以看到时间轴是在一个小时的水平，股票价值随时间而变化。</p><figure class="mc md me mf gt mg gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi mj"><img src="../Images/e974205e7a018a549928d580b97b5a20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jV6tE3kLnhy7tUU_7w00lw.jpeg"/></div></div></figure><p id="2d19" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在我们来谈谈趋势。趋势给你一个总体数据的大致方向。从上面的例子中，我可以说，从上午 9:00 到上午 11:00 有一个下降趋势，从上午 11:00 到下午 1:00 有一个上升趋势，下午 1:00 之后趋势是恒定的。</p><p id="cbce" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">而季节性是以固定时间间隔重复出现的规则且可预测的模式。例如，下图有助于我们了解零售商每月的总销售量。所以，如果我们仔细观察，我们会发现每年 12 月份的单位销售额都在增加。因此，在 12 个月的时间内，单位销售额有一个规律或季节性。</p><figure class="mc md me mf gt mg gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi mo"><img src="../Images/b608d5fc291c33eac39c97073823e61f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5BXq9kmJR_P0s4aUCmIa9w.jpeg"/></div></div></figure><p id="8ff9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">随机性或噪声或残差是随机波动或不可预测的变化。这是我们无法猜测的。例如，2014 年 3 月有一个高单位销售额，这在每个 3 月都是不规则的。因此，我们可以说，在这个月中，它有一些高百分比的噪声或残余。</p><p id="ed17" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，我们来谈谈<strong class="kk iu">黄土</strong>。因此，黄土是一种回归技术，它使用局部加权回归来拟合通过序列中的点的平滑曲线，在我们的情况下，序列是时间序列数据。要更详细地了解黄土，<a class="ae mp" href="https://blogs.sas.com/content/iml/2016/10/17/what-is-loess-regression.html" rel="noopener ugc nofollow" target="_blank">点击这里</a>。</p></div><div class="ab cl mq mr hx ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="im in io ip iq"><h1 id="23ca" class="le lf it bd lg lh mx lj lk ll my ln lo jz mz ka lq kc na kd ls kf nb kg lu lv bi translated">如何从零开始做 STL 分解？</h1><p id="cfd0" class="pw-post-body-paragraph ki kj it kk b kl lw ju kn ko lx jx kq kr ly kt ku kv lz kx ky kz ma lb lc ld im bi translated">所以在这里，我采用<a class="ae mp" href="https://www.kaggle.com/c/favorita-grocery-sales-forecasting/data" rel="noopener ugc nofollow" target="_blank"> Corporación Favorita 杂货销售预测数据集</a>来可视化每一步。为了更好地理解，我将数据按月进行了汇总。</p><p id="e0f7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">该数据集的时间序列数据如下所示。这里我们可以观察 2013 年到 2016 年每个月售出的单位价值。</p><figure class="mc md me mf gt mg gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi nc"><img src="../Images/28c70dcefaa1ed37e3d9014fdd0215fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h4-KCFJyj5CTbShQXJjkGg.png"/></div></div></figure><h2 id="feb6" class="nd lf it bd lg ne nf dn lk ng nh dp lo kr ni nj lq kv nk nl ls kz nm nn lu no bi translated"><strong class="ak">第一步</strong></h2><p id="3ec3" class="pw-post-body-paragraph ki kj it kk b kl lw ju kn ko lx jx kq kr ly kt ku kv lz kx ky kz ma lb lc ld im bi translated">找出符合上述时间序列数据的近似趋势线。</p><figure class="mc md me mf gt mg"><div class="bz fp l di"><div class="np nq l"/></div></figure><figure class="mc md me mf gt mg gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi nc"><img src="../Images/0c902cc69eb0c0efaeaaa0febdb27c0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WA-r1y_exqE_9a-4bU_vhA.png"/></div></div></figure><h2 id="67ef" class="nd lf it bd lg ne nf dn lk ng nh dp lo kr ni nj lq kv nk nl ls kz nm nn lu no bi translated">第二步</h2><p id="e77d" class="pw-post-body-paragraph ki kj it kk b kl lw ju kn ko lx jx kq kr ly kt ku kv lz kx ky kz ma lb lc ld im bi translated">通过用近似趋势线减去时间序列数据，找到去趋势序列。</p><figure class="mc md me mf gt mg"><div class="bz fp l di"><div class="np nq l"/></div></figure><figure class="mc md me mf gt mg gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi nr"><img src="../Images/b85180a22cdd34a3ad5711f1f4b566a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mHVEjFf8PpoZhRFTaDsv3A.png"/></div></div></figure><h2 id="c043" class="nd lf it bd lg ne nf dn lk ng nh dp lo kr ni nj lq kv nk nl ls kz nm nn lu no bi translated">第三步</h2><p id="45fe" class="pw-post-body-paragraph ki kj it kk b kl lw ju kn ko lx jx kq kr ly kt ku kv lz kx ky kz ma lb lc ld im bi translated">找出季节性因素。在这里，我找出了月水平上的季节性(周期= 12)。因此，我必须按月对去趋势化系列进行分组，以找出整个数据(48 个月)中每个月的平均销售量。</p><figure class="mc md me mf gt mg"><div class="bz fp l di"><div class="np nq l"/></div></figure><figure class="mc md me mf gt mg gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi nr"><img src="../Images/29881e97da52204cbc69873aab2c6820.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vKKTTX96rvjacAe6YZ_2qw.png"/></div></div></figure><h2 id="523a" class="nd lf it bd lg ne nf dn lk ng nh dp lo kr ni nj lq kv nk nl ls kz nm nn lu no bi translated">第四步</h2><p id="1244" class="pw-post-body-paragraph ki kj it kk b kl lw ju kn ko lx jx kq kr ly kt ku kv lz kx ky kz ma lb lc ld im bi translated">在整个数据中填充此组件(48 个月)。</p><figure class="mc md me mf gt mg"><div class="bz fp l di"><div class="np nq l"/></div></figure><figure class="mc md me mf gt mg gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi nr"><img src="../Images/d5973b46e02bf79982637a78ee309827.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xGqmlJg1DD_HEkVCid-b7Q.png"/></div></div></figure><h2 id="f151" class="nd lf it bd lg ne nf dn lk ng nh dp lo kr ni nj lq kv nk nl ls kz nm nn lu no bi translated">第五步</h2><p id="3dbc" class="pw-post-body-paragraph ki kj it kk b kl lw ju kn ko lx jx kq kr ly kt ku kv lz kx ky kz ma lb lc ld im bi translated">通过用季节性数据减去时间序列数据，找到去季节性的时间序列。</p><figure class="mc md me mf gt mg"><div class="bz fp l di"><div class="np nq l"/></div></figure><figure class="mc md me mf gt mg gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi nc"><img src="../Images/9a67407a8eee54ab723bbe40b43cc59f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J_NHJHhZ71xk80XUgdtRNw.png"/></div></div></figure><h2 id="9e61" class="nd lf it bd lg ne nf dn lk ng nh dp lo kr ni nj lq kv nk nl ls kz nm nn lu no bi translated">第六步</h2><p id="5e1b" class="pw-post-body-paragraph ki kj it kk b kl lw ju kn ko lx jx kq kr ly kt ku kv lz kx ky kz ma lb lc ld im bi translated">通过将去季节性数据拟合到多项式模型中来寻找趋势。</p><figure class="mc md me mf gt mg"><div class="bz fp l di"><div class="np nq l"/></div></figure><figure class="mc md me mf gt mg gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi ns"><img src="../Images/07b082423209a48c4ba2b6a4ff2dda57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BYgeTxj3Ao4W1TMcAFMK6g.png"/></div></div></figure><h2 id="758c" class="nd lf it bd lg ne nf dn lk ng nh dp lo kr ni nj lq kv nk nl ls kz nm nn lu no bi translated">第七步</h2><p id="9a7d" class="pw-post-body-paragraph ki kj it kk b kl lw ju kn ko lx jx kq kr ly kt ku kv lz kx ky kz ma lb lc ld im bi translated">通过减去具有季节性和趋势性的时间序列数据来找到残差。</p><figure class="mc md me mf gt mg"><div class="bz fp l di"><div class="np nq l"/></div></figure><figure class="mc md me mf gt mg gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi nr"><img src="../Images/7b586c2a5dd823c3d9d1349b28bea554.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wDkCvbqNsq5MfvpaV_r1oA.png"/></div></div></figure><h2 id="5c34" class="nd lf it bd lg ne nf dn lk ng nh dp lo kr ni nj lq kv nk nl ls kz nm nn lu no bi translated">时间序列的分解成分</h2><p id="839e" class="pw-post-body-paragraph ki kj it kk b kl lw ju kn ko lx jx kq kr ly kt ku kv lz kx ky kz ma lb lc ld im bi translated">所以，下面是 STL 分解的最终图:</p><div class="mc md me mf gt ab cb"><figure class="nt mg nu nv nw nx ny paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><img src="../Images/55e5d8fc3d8fab0465db753041f4f064.png" data-original-src="https://miro.medium.com/v2/resize:fit:1004/format:webp/1*h4-KCFJyj5CTbShQXJjkGg.png"/></div></figure><figure class="nt mg nz nv nw nx ny paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><img src="../Images/96eb17c023a353fe9e62d84971b65d2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:998/format:webp/1*BYgeTxj3Ao4W1TMcAFMK6g.png"/></div></figure></div><div class="ab cb"><figure class="nt mg oa nv nw nx ny paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><img src="../Images/8be6ecbdd7bb58c4e8086f3979ec2e0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*xGqmlJg1DD_HEkVCid-b7Q.png"/></div></figure><figure class="nt mg oa nv nw nx ny paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><img src="../Images/6835245af9773abc259e01daa4b43b1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*wDkCvbqNsq5MfvpaV_r1oA.png"/></div></figure></div></div><div class="ab cl mq mr hx ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="im in io ip iq"><h1 id="bc1c" class="le lf it bd lg lh mx lj lk ll my ln lo jz mz ka lq kc na kd ls kf nb kg lu lv bi translated">使用 stats 模型库进行 STL 分解</h1><p id="b68e" class="pw-post-body-paragraph ki kj it kk b kl lw ju kn ko lx jx kq kr ly kt ku kv lz kx ky kz ma lb lc ld im bi translated">首先，您必须完成 statsmodel 库的 pip <a class="ae mp" href="https://pypi.org/project/statsmodels/" rel="noopener ugc nofollow" target="_blank">安装</a>。然后，运行下面几行代码。</p><figure class="mc md me mf gt mg"><div class="bz fp l di"><div class="np nq l"/></div></figure><div class="mc md me mf gt ab cb"><figure class="nt mg nu nv nw nx ny paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><img src="../Images/55e5d8fc3d8fab0465db753041f4f064.png" data-original-src="https://miro.medium.com/v2/resize:fit:1004/format:webp/1*h4-KCFJyj5CTbShQXJjkGg.png"/></div></figure><figure class="nt mg nz nv nw nx ny paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><img src="../Images/936b7063954e8a7416ffbfe55abf9c8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:998/format:webp/1*kiiewQPcfad1kE2ycX7-Aw.png"/></div></figure></div><div class="ab cb"><figure class="nt mg oa nv nw nx ny paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><img src="../Images/edae30575ae9c9f711c16cd20627592b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*K8Ijdpz11VehZKecTRmffQ.png"/></div></figure><figure class="nt mg oa nv nw nx ny paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><img src="../Images/e468de1edb47aa32ef74f0c042e567a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*DoecnQx867N4bczBB-GNKQ.png"/></div></figure></div><p id="ade0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">通过比较两种技术的结果，我们可以看到，趋势和残差分量只有显著变化，季节分量与实际情况相同。</p></div><div class="ab cl mq mr hx ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="im in io ip iq"><h1 id="0827" class="le lf it bd lg lh mx lj lk ll my ln lo jz mz ka lq kc na kd ls kf nb kg lu lv bi translated">链接到笔记本</h1><p id="a00c" class="pw-post-body-paragraph ki kj it kk b kl lw ju kn ko lx jx kq kr ly kt ku kv lz kx ky kz ma lb lc ld im bi translated">这里是<a class="ae mp" href="https://github.com/rajatsharma369007/blog_codes/blob/master/STL_decoposition.ipynb" rel="noopener ugc nofollow" target="_blank">到笔记本</a>的链接，用于上面执行的观察。</p><p id="ee8f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最后，我只想说，一旦你使用一个库来完成任何统计和机器学习任务，试着去了解构建这些任务所需的实现和数学。这将帮助您更好地理解任何库的每个已定义类的方法参数的用法。</p><p id="c620" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">敬请关注下一篇博客…</p><figure class="mc md me mf gt mg gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/b36d84295dda7f60e06754e8d7a4ccd8.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/1*c95yo-_RD5nvOndUKMn7wQ.gif"/></div></figure></div></div>    
</body>
</html>