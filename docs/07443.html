<html>
<head>
<title>Install a Kafka Cluster on Ubuntu in AWS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在 AWS 的 Ubuntu 上安装一个 Kafka 集群</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/install-a-kafka-cluster-on-ubuntu-in-aws-17c951287284?source=collection_archive---------11-----------------------#2019-10-18">https://towardsdatascience.com/install-a-kafka-cluster-on-ubuntu-in-aws-17c951287284?source=collection_archive---------11-----------------------#2019-10-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="05b4" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">通过 AWS 中的 Kafka 消息主干构建实时数据功能</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c67bc09481c3622498e5c566ae96483c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uVl8W76JwB2Aayn8lk839A.png"/></div></div></figure><h1 id="c818" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">概观</h1><p id="3f77" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">数以万计的组织正在使用 Kafka，包括超过三分之一的财富 500 强公司。这些公司包括十大旅游公司、十大银行中的 7 家、十大保险公司中的 8 家、十大电信公司中的 9 家，等等。LinkedIn、微软和网飞每天用 Kafka 处理四条逗号消息(10 亿条)。它是管理和处理数据流运动的核心。</p><p id="13f7" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">Kafka 经常在实时流数据架构中使用，以提供实时分析。由于 Kafka 是一个快速、可伸缩、持久和容错的发布-订阅消息传递系统，因此 Kafka 用于 JMS 和 RabbitMQ 由于容量和响应性而可能不被考虑的用例中。Kafka 具有更高的吞吐量、可靠性和复制特性，这使其适用于跟踪服务呼叫(跟踪每个呼叫)或跟踪 IOT 传感器数据等传统 MOM 可能不考虑的事情。</p><p id="8b11" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">在这篇文章中，我将介绍在 AWS 中的 Linux Ubuntu 上安装 Kafka 的过程，并开始运行一些简单的示例。我将在以后的文章中介绍 Kafka 是如何工作的，以及一些使用 Java 和 Node 的用例。</p><h1 id="4e05" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">入门指南</h1><p id="c8bd" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">登录您的 AWS 帐户，如果您没有帐户，请创建一个新帐户。如果您使用免费服务，将不会被收费。点击了解有关免费层<a class="ae mn" href="https://aws.amazon.com/free/" rel="noopener ugc nofollow" target="_blank">的更多信息。</a></p><p id="7d4c" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">让我们生成一个密钥对。转到<strong class="lo iu"> EC2- &gt;键对</strong>。密钥对将允许您 SSH 并连接到您的 EC2 实例。选择您喜欢的地区并点击<strong class="lo iu">创建配对</strong>或导入一个已经存在的配对。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mo"><img src="../Images/47ee4a3d96e6ffc6f8abd05ef0c40da0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*zxTEB9IBIsIXxmTI.png"/></div></div></figure><p id="0f0d" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">下载您的密钥对。</p><p id="b610" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">请确保限制文件的权限:</p><pre class="kj kk kl km gt mp mq mr ms aw mt bi"><span id="5a48" class="mu kv it mq b gy mv mw l mx my">chmod 400 &lt;key pair name&gt;.pem</span></pre><h1 id="12c4" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">设置您的实例</h1><p id="1cf4" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">让我们为 EC2 实例提供一个 Ubuntu 映像。</p><p id="b9fe" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">转到<strong class="lo iu"> EC2 仪表板</strong>并点击启动实例。</p><p id="96b8" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">选择 Ubuntu 图像。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mz"><img src="../Images/e1734993523c160a1bd6d8e65bee74ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*gmflXw_bTYJR4vM_.png"/></div></div></figure><p id="e8ad" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">保留所有默认选项，点击<strong class="lo iu">查看并启动</strong>。</p><p id="4351" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">请注意，Kafka 的官方建议是最低 t2.medium，但此选项不在免费层范围内，会让您花钱，因此在本练习中，我们将使用 t2.micro。</p><p id="5fa4" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">选择在上一步中生成的密钥对。</p><p id="c004" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">回到 Instances 列表，您应该看到新的 EC2 实例启动了。</p><h1 id="da46" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">连接到您的实例</h1><p id="fb8f" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">单击实例，并在描述选项卡上复制公共 DNS (IPv4)</p><pre class="kj kk kl km gt mp mq mr ms aw mt bi"><span id="d521" class="mu kv it mq b gy mv mw l mx my">ssh -i ~/.ssh/&lt;key pair name.pem&gt; ubuntu@&lt;Public DNS (IPv4)&gt;</span></pre><p id="6576" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">您应该会看到 Ubuntu 欢迎屏幕:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi na"><img src="../Images/9d2a4dd3cde03de60b89f5a6a7b4fa3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*481mfxUwIaA0bnEf.png"/></div></div></figure><p id="4de5" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">太好了！！您已连接到 EC2 实例</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/ecf1c57e1308239a35c276ace521a5bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:128/format:webp/0*UytwMmgofyb7VeSO.png"/></div></figure></div><div class="ab cl nc nd hx ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="im in io ip iq"><h1 id="309b" class="ku kv it bd kw kx nj kz la lb nk ld le jz nl ka lg kc nm kd li kf nn kg lk ll bi translated">安装 Java</h1><p id="7f7a" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">让我们开始安装吧。第一步是更新实例并安装 Java。</p><p id="6ee5" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">运行以下命令:</p><pre class="kj kk kl km gt mp mq mr ms aw mt bi"><span id="614f" class="mu kv it mq b gy mv mw l mx my">sudo apt-get update <br/>sudo apt upgrade<br/>sudo add-apt-repository ppa:linuxuprising/java <br/>sudo apt install openjdk-11-jre-headless</span></pre><p id="6557" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">测试您的 Java 安装:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi no"><img src="../Images/25fa07f3765f47d2a5f8200144d9dfbe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*qY8VZEFBFG9pNR6b.png"/></div></div></figure><h1 id="afa4" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">安装卡夫卡</h1><p id="a4f7" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">现在，让我们使用以下命令安装合流 Kafka:</p><pre class="kj kk kl km gt mp mq mr ms aw mt bi"><span id="5467" class="mu kv it mq b gy mv mw l mx my">wget -qO - https://packages.confluent.io/deb/5.2/archive.key | sudo apt-key add -<br/>sudo add-apt-repository "deb [arch=amd64] https://packages.confluent.io/deb/5.2 stable main"<br/>sudo apt-get update &amp;&amp; sudo apt-get install confluent-platform-2.12</span></pre><p id="8c8f" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">恭喜你！！您现在已经在 AWS 中的 Ubuntu 上安装了一个 Kafka 服务器。</p></div><div class="ab cl nc nd hx ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="im in io ip iq"><h1 id="9428" class="ku kv it bd kw kx nj kz la lb nk ld le jz nl ka lg kc nm kd li kf nn kg lk ll bi translated">配置 Kafka</h1><p id="6ec9" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">让我们用 1 个 Kafka 代理和 1 个主题来配置 Kafka 的最小安装。<br/>导航到您的 Kafka 安装</p><h1 id="1ee8" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">卡夫卡经纪人</h1><p id="9e8c" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">编辑文件<strong class="lo iu">服务器.属性</strong></p><pre class="kj kk kl km gt mp mq mr ms aw mt bi"><span id="b97a" class="mu kv it mq b gy mv mw l mx my">sudo nano /etc/kafka/server.properties</span></pre><p id="a089" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">取消对以下行的注释:</p><pre class="kj kk kl km gt mp mq mr ms aw mt bi"><span id="ad58" class="mu kv it mq b gy mv mw l mx my">metric.reporters=io.confluent.metrics.reporter.ConfluentMetricsReporter<br/>confluent.metrics.reporter.bootstrap.servers=localhost:9092<br/>confluent.metrics.reporter.topic.replicas=1</span></pre><p id="c003" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">用 Ctrl+0 和 Ctrl+X 保存以退出</p><h1 id="1243" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">控制中心</h1><p id="a67a" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">编辑文件<strong class="lo iu">控制中心生产属性</strong></p><pre class="kj kk kl km gt mp mq mr ms aw mt bi"><span id="c22a" class="mu kv it mq b gy mv mw l mx my">sudo nano /etc/confluent-control-center/control-center.properties</span></pre><p id="f129" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">取消对以下行的注释，并编辑为您的服务器名称或本地主机:</p><pre class="kj kk kl km gt mp mq mr ms aw mt bi"><span id="c6b0" class="mu kv it mq b gy mv mw l mx my">bootstrap.servers=localhost:9092 <br/>zookeeper.connect=localhost:2181</span></pre><p id="ed52" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">在文件末尾添加以下几行:</p><pre class="kj kk kl km gt mp mq mr ms aw mt bi"><span id="846f" class="mu kv it mq b gy mv mw l mx my">confluent.controlcenter.internal.topics.partitions=1 confluent.controlcenter.internal.topics.replication=1 confluent.controlcenter.command.topic.replication=1 confluent.monitoring.interceptor.topic.partitions=1 confluent.monitoring.interceptor.topic.replication=1</span></pre><h1 id="3c24" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">连接器</h1><pre class="kj kk kl km gt mp mq mr ms aw mt bi"><span id="37af" class="mu kv it mq b gy mv mw l mx my">sudo nano /etc/kafka/connect-distributed.properties</span></pre><p id="05f2" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">在文件末尾添加以下几行:</p><pre class="kj kk kl km gt mp mq mr ms aw mt bi"><span id="7cca" class="mu kv it mq b gy mv mw l mx my">consumer.interceptor.classes=io.confluent.monitoring.clients.interceptor.MonitoringConsumerInterceptor producer.interceptor.classes=io.confluent.monitoring.clients.interceptor.MonitoringProducerInterceptor</span></pre><h1 id="c97b" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">开始卡夫卡</h1><p id="97f9" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">让我们开始 Kafka 服务:</p><pre class="kj kk kl km gt mp mq mr ms aw mt bi"><span id="c2e6" class="mu kv it mq b gy mv mw l mx my">sudo systemctl start confluent-zookeeper <br/>sudo systemctl start confluent-kafka <br/>sudo systemctl start confluent-schema-registry <br/>sudo systemctl start confluent-kafka-connect <br/>sudo systemctl start confluent-kafka-rest <br/>sudo systemctl start confluent-ksql <br/>sudo systemctl start confluent-control-center</span></pre><p id="9649" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">您可以使用以下命令检查服务状态:</p><pre class="kj kk kl km gt mp mq mr ms aw mt bi"><span id="86ed" class="mu kv it mq b gy mv mw l mx my">systemctl status confluent*</span></pre><p id="8ce5" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">服务将在以下端口上运行:</p><p id="4c20" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">ComponentPortKafka 经纪人(纯文本)9092</p><p id="ffad" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">合流控制中心 9021</p><p id="01b7" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">Kafka 连接 REST API 8083</p><p id="415a" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">KSQL 服务器 REST API 8088</p><p id="82c6" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">REST 代理 8082</p><p id="0e4a" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">模式注册表 REST API 8081</p><p id="1642" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">动物园管理员 2181</p><p id="4d99" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">要访问您的控制中心，请确保在 AWS 中打开端口 9021。<br/>转到您的实例<strong class="lo iu">描述</strong>选项卡，并单击安全组已创建。包括端口 9021 的新入站规则。你可以限制你的 IP 地址或者允许所有人访问。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi np"><img src="../Images/b9b7898b1c7cec8304c08ae1ef18e625.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*EN5cazZPhcKhYBew.png"/></div></div></figure><p id="bc17" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">导航到您的<strong class="lo iu"> &lt;公共 DNS (IPv4) &gt; :9021 </strong>，您应该会看到您的控制中心。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nq"><img src="../Images/5338166bc65ed5a0567bef3b22c664f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Dss0uzDTvetdvz_1.png"/></div></div></figure><p id="e034" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated">恭喜你！！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/3a4ed5303f05d1d5c6f00497ed69591d.png" data-original-src="https://miro.medium.com/v2/resize:fit:128/format:webp/0*ruvbR70GtzfuNa65.png"/></div></figure></div><div class="ab cl nc nd hx ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="im in io ip iq"><p id="f81e" class="pw-post-body-paragraph lm ln it lo b lp mi ju lr ls mj jx lu lv mk lx ly lz ml mb mc md mm mf mg mh im bi translated"><em class="nr">原载于</em><a class="ae mn" href="https://marcoslombog.com/2019/07/16/kafka-ubuntu-aws.html" rel="noopener ugc nofollow" target="_blank"><em class="nr">https://marcoslombog.com</em></a><em class="nr">。</em></p></div></div>    
</body>
</html>