<html>
<head>
<title>How to Visualize Data on top of a Map in Python using the Geoviews library</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用 Geoviews 库在 Python 中可视化地图顶部的数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-visualize-data-on-top-of-a-map-in-python-using-the-geoviews-library-c4f444ca2929?source=collection_archive---------9-----------------------#2019-11-09">https://towardsdatascience.com/how-to-visualize-data-on-top-of-a-map-in-python-using-the-geoviews-library-c4f444ca2929?source=collection_archive---------9-----------------------#2019-11-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="97fa" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">所以让我们从我们将要解决的问题开始。假设您有一些数据代表一个特定的数字(如人口)，该数字因地点而异(如不同的城市)，您希望绘制一个图表来可视化该数据。你是怎么做到的？</p><p id="eb08" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">一种方法(也是最常用的方法)是创建一个条形图。y 轴代表数字(如人口)，x 轴代表地点(如城市)。我敢打赌，这种数据上的绝大多数图都是这种类型的。结果，网上有无数这样的例子，因此我没有必要再增加一个。</p><p id="b08e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">幸运的是，有一种更好的方法来可视化这种数据。请记住，情节必须直观，观众才能更好地掌握他们面前的东西。因此，在这种情况下，将数据可视化的更直观的方法是将它们绘制在地图上。有什么比交互式地图更直观的呢？在交互式地图上，你可以放大、缩小和查看你要找的地方或人物。</p></div><div class="ab cl ko kp hx kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="im in io ip iq"><p id="d790" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">出于本教程的目的，我们将绘制一个图表来显示我国希腊和邻国土耳其最繁忙的机场的客流量，以便进行比较。</p><p id="4b00" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">首先，我们需要导入将要使用的库和方法。</p><pre class="kv kw kx ky gt kz la lb lc aw ld bi"><span id="35e1" class="le lf it la b gy lg lh l li lj">import pandas as pd<br/>import numpy as np<br/>import geoviews as gv<br/>import geoviews.tile_sources as gvts<br/>from geoviews import dim, opts<br/>gv.extension('bokeh')</span></pre><p id="5b57" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们的两个数据框架<code class="fe lk ll lm la b">greek_aiports</code>和<code class="fe lk ll lm la b">turkish_airports</code>，分别由客流量排名前 10 位的希腊机场和前 5 位的土耳其机场组成。</p><figure class="kv kw kx ky gt lo gh gi paragraph-image"><div class="gh gi ln"><img src="../Images/4aae4d3fe5d05ac9a7349e4759880667.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*xrOzl1uIQ2gu3ndtl4DFBg.jpeg"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk">Stats for 2018</figcaption></figure><p id="1dea" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">对于这些数据帧，我们将添加一个额外的列<code class="fe lk ll lm la b">country</code>。</p><pre class="kv kw kx ky gt kz la lb lc aw ld bi"><span id="71ad" class="le lf it la b gy lg lh l li lj">greek_airports['country']= 'GR'<br/>turkish_airports['country']= 'TR'</span></pre><p id="497a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们还将添加列<code class="fe lk ll lm la b">color</code>。你以后会明白我们为什么这样做。</p><pre class="kv kw kx ky gt kz la lb lc aw ld bi"><span id="ee1f" class="le lf it la b gy lg lh l li lj">greek_airports['color']= '#30a2da'<br/>turkish_airports['color']= '#fc4f30'</span></pre><p id="957b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在如果我们把这两个数据帧合并成<code class="fe lk ll lm la b">airports</code></p><pre class="kv kw kx ky gt kz la lb lc aw ld bi"><span id="4b4b" class="le lf it la b gy lg lh l li lj">airports = pd.merge(greek_airports, turkish_airports, how='outer')</span></pre><p id="0f48" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe lk ll lm la b">airports</code>数据帧看起来像这样。</p><figure class="kv kw kx ky gt lo gh gi paragraph-image"><div class="gh gi lv"><img src="../Images/f3d956451c371692010b1c9c3ca37db3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*wqbkAORKEQ7Njz-HkXaJCg.jpeg"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk">airports dataframe</figcaption></figure><p id="aad0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">对于这个例子，我不需要<code class="fe lk ll lm la b">citizens(k)</code>列，所以我将删除它。</p><pre class="kv kw kx ky gt kz la lb lc aw ld bi"><span id="aaed" class="le lf it la b gy lg lh l li lj">airports.drop('citizens(k)', axis=1, inplace=True)</span></pre><p id="f8be" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">所以最终的<code class="fe lk ll lm la b">airports</code>数据帧看起来会像这样。</p><figure class="kv kw kx ky gt lo gh gi paragraph-image"><div class="gh gi lw"><img src="../Images/6b5e082b279c5b0bce436706861c05fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*b7vvqr7b2JpU7pmw7Uxp6g.jpeg"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk">airports dataframe</figcaption></figure><blockquote class="lx ly lz"><p id="b363" class="jq jr ma js b jt ju jv jw jx jy jz ka mb kc kd ke mc kg kh ki md kk kl km kn im bi translated">(对于那些想在笔记本上跟随的人，可以在<a class="ae me" href="https://www.dropbox.com/s/hy2y82rlfb5m12g/airports.csv?dl=0" rel="noopener ugc nofollow" target="_blank">这里</a>找到<code class="fe lk ll lm la b">airports</code>数据框)</p></blockquote><p id="0a09" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在让我们开始使用 geoviews 模块。具体来说，让我们使用<code class="fe lk ll lm la b">geoviews.Points</code>功能创建一个带有我们的点的情节。</p><pre class="kv kw kx ky gt kz la lb lc aw ld bi"><span id="afa2" class="le lf it la b gy lg lh l li lj">airports_gv_points = gv.Points(airports, ['longitude', 'latitude'],<br/>                               ['IATA', 'city', 'passengers',<br/>                               'country', 'color'])</span></pre><figure class="kv kw kx ky gt lo gh gi paragraph-image"><div class="gh gi mf"><img src="../Images/69f159bae3f48ce61a441b06f4d0568e.png" data-original-src="https://miro.medium.com/v2/resize:fit:700/format:webp/1*iBAH1WlP7H3Ioz_L6eYnig.jpeg"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk">airports_gv_points</figcaption></figure><p id="c6b4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为了在地图上标出这些点，我们需要一张…地图。geoviews 模块提供了许多我们可以使用的 tilemaps。如果我们输入的话，我们可以看到什么是可用的</p><pre class="kv kw kx ky gt kz la lb lc aw ld bi"><span id="9cca" class="le lf it la b gy lg lh l li lj">gvts.tile_sources</span></pre><figure class="kv kw kx ky gt lo gh gi paragraph-image"><div class="gh gi mg"><img src="../Images/01f50c7a366c386acea9bdce4d5cd154.png" data-original-src="https://miro.medium.com/v2/resize:fit:940/format:webp/1*oHgm-MwCKbknryRrwgniug.jpeg"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk">Available tilemaps</figcaption></figure><p id="e5c7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">例如，让我们使用 CartoLight tilemap。让我们看看我们能得到什么</p><pre class="kv kw kx ky gt kz la lb lc aw ld bi"><span id="31c8" class="le lf it la b gy lg lh l li lj">gvts.CartoLight</span></pre><figure class="kv kw kx ky gt lo gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/99cd014d5dd2fbb7655a9e3acf20a797.png" data-original-src="https://miro.medium.com/v2/resize:fit:680/format:webp/1*zI-XJxkX7_cs3yJSqu8-eg.jpeg"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk">CartoLight</figcaption></figure><p id="9677" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，我们可以在 CartoLight 的顶部用</p><pre class="kv kw kx ky gt kz la lb lc aw ld bi"><span id="e949" class="le lf it la b gy lg lh l li lj">gvts.CartoLight * airports_gv_points</span></pre><figure class="kv kw kx ky gt lo gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/606e815514c24b997df1b2eda50bc3c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:680/format:webp/1*POAy53maC6KcXkRoufitXw.jpeg"/></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk">gv.Points on CartoLight</figcaption></figure><p id="fb0a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这里有几个问题:</p><ul class=""><li id="d0b0" class="mi mj it js b jt ju jx jy kb mk kf ml kj mm kn mn mo mp mq bi translated">剧情维度真的很小。</li><li id="28c3" class="mi mj it js b jt mr jx ms kb mt kf mu kj mv kn mn mo mp mq bi translated">我不喜欢经纬度的轴标签。</li><li id="6c59" class="mi mj it js b jt mr jx ms kb mt kf mu kj mv kn mn mo mp mq bi translated">我不喜欢地图上的网格。</li></ul><p id="a460" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我可以通过在<code class="fe lk ll lm la b">gvts.CartoLight</code>上添加一些选项来解决这些问题，比如</p><pre class="kv kw kx ky gt kz la lb lc aw ld bi"><span id="edfb" class="le lf it la b gy lg lh l li lj">gvts.CartoLight.options(width=1300, height=800, xaxis=None, yaxis=None, show_grid=False)  * airports_gv_points</span></pre><figure class="kv kw kx ky gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi mw"><img src="../Images/1f345a3e74d8c7326e9627cfaea2cc50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J_xShg4xHGCKqloNBinFNw.jpeg"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk">geoviews.Points on CartoLight</figcaption></figure><p id="7b13" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，因为点仍然只是点，因此它们不能说明客流量，我将使用我们之前导入的<code class="fe lk ll lm la b">opts</code>方法。我们需要的参数是<code class="fe lk ll lm la b">size</code>。此外，为了让数字更接近，我将使用<code class="fe lk ll lm la b">np.sqrt</code>函数来获得它们的平方根。</p><pre class="kv kw kx ky gt kz la lb lc aw ld bi"><span id="9cf9" class="le lf it la b gy lg lh l li lj">airports_plot = (gvts.CartoLight * airports_gv_points).opts(<br/>    opts.Points(width=1200, height=700, alpha=0.3,<br/>                xaxis=None, yaxis=None,<br/>                size=np.sqrt(dim('passengers'))*10))</span></pre><figure class="kv kw kx ky gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi nb"><img src="../Images/00f34a669366eab34523f9feedd4999c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*tqA6N4TjRY0LywBMDD6YIw.gif"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk">airports_plot</figcaption></figure><p id="c6db" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如你所见，我们现在有了互动地图，显示了希腊和土耳其的机场有多繁忙。显然，雅典拥有希腊最繁忙的机场，而土耳其最繁忙的机场位于伊斯坦布尔。</p><p id="a742" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为了使绘图更好，我们可以为每个国家使用不同的颜色，同时我们还可以添加一个悬停工具，以便在我们将光标移动到机场上方时获得一些关于机场的信息。为了添加颜色，我们添加了参数<code class="fe lk ll lm la b">color=dim('color')</code>，它使用我们在<code class="fe lk ll lm la b">color</code>列中指定的颜色，对于悬停工具，我们添加了参数<code class="fe lk ll lm la b">tools=['hover']</code>。</p><pre class="kv kw kx ky gt kz la lb lc aw ld bi"><span id="d7c1" class="le lf it la b gy lg lh l li lj">airports_plot = (gvts.CartoLight * airports_gv_points).opts(<br/>    opts.Points(width=1200, height=700, alpha=0.3,<br/>                color=dim('color'), hover_line_color='black',  <br/>                line_color='black', xaxis=None, yaxis=None,<br/>                tools=['hover'],size=np.sqrt(dim('passengers'))*10))</span></pre><figure class="kv kw kx ky gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi nb"><img src="../Images/8630b875dd22a77b4be257bc8bebc43d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*NmIkOS7m_p2RrLGn7HqGvA.gif"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk">airports_plot</figcaption></figure><p id="7146" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们甚至可以创建自己的悬停工具来完全控制悬停工具显示的内容。例如，我不希望它显示每个国家使用的颜色代码。<br/>最后，当我将光标放在每个点上时，我希望每个点的颜色变暗一点，所以我添加了参数<code class="fe lk ll lm la b">hover_fill_alpha=0.5</code>。</p><pre class="kv kw kx ky gt kz la lb lc aw ld bi"><span id="916f" class="le lf it la b gy lg lh l li lj">from bokeh.models import HoverTool<br/>tooltips = [('IATA', '<a class="ae me" href="http://twitter.com/IATA" rel="noopener ugc nofollow" target="_blank">@IATA</a>'),<br/>            ('Passengers', '<a class="ae me" href="http://twitter.com/passengers" rel="noopener ugc nofollow" target="_blank">@passengers</a>{0.00 a}m'),<br/>            ('City', '<a class="ae me" href="http://twitter.com/city" rel="noopener ugc nofollow" target="_blank">@city</a>'),<br/>            ('Country', '<a class="ae me" href="http://twitter.com/country" rel="noopener ugc nofollow" target="_blank">@country</a>'),<br/>            ('Longitude', '$x'),<br/>            ('Latitude', '$y'),<br/>            ]<br/>hover = HoverTool(tooltips=tooltips)</span><span id="2a98" class="le lf it la b gy nc lh l li lj">airports_plot = (gvts.CartoLight * airports_gv_points).opts(<br/>    opts.Points(width=1200, height=700, alpha=0.3,<br/>                color=dim('color'), hover_line_color='black',  <br/>                line_color='black', xaxis=None, yaxis=None,<br/>                tools=[hover],size=np.sqrt(dim('passengers'))*10,<br/>                hover_fill_color=None, hover_fill_alpha=0.5))<br/></span></pre><figure class="kv kw kx ky gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi nb"><img src="../Images/e53037aede34c378707b560d971499e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*BenzmLORCX6Yyw31tvSWFw.gif"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk">airports_plot</figcaption></figure><p id="ccff" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你像我一样喜欢深色主题，你可以随时使用<code class="fe lk ll lm la b">gvts.CartoDark</code> tilemap。</p><pre class="kv kw kx ky gt kz la lb lc aw ld bi"><span id="7dbe" class="le lf it la b gy lg lh l li lj">airports_plot = (gvts.CartoDark.options(alpha=0.8) * airports_gv_points).opts(<br/>    opts.Points(width=1200, height=700, alpha=0.3,<br/>                color=dim('color'), hover_line_color='black',  <br/>                line_color='black', xaxis=None, yaxis=None,<br/>                tools=[hover],size=np.sqrt(dim('passengers'))*10,<br/>                hover_fill_color=None, hover_fill_alpha=0.5))</span></pre><figure class="kv kw kx ky gt lo gh gi paragraph-image"><div role="button" tabindex="0" class="mx my di mz bf na"><div class="gh gi nb"><img src="../Images/7b67e8478ea7b0d4dd00efba9c908955.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*qjJtukvNogk9v58_k9wkuA.gif"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk">airports_plot</figcaption></figure><p id="d686" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">今天到此为止。希望你觉得有用。下次见！</p></div><div class="ab cl ko kp hx kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="im in io ip iq"><p id="0673" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你可以点击<a class="ae me" href="https://www.linkedin.com/in/christoszeglis/" rel="noopener ugc nofollow" target="_blank">这里</a>在 LinkedIn 上找到我。</p></div></div>    
</body>
</html>