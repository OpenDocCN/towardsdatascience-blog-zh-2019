<html>
<head>
<title>Face Detection Using JavaScript API — face-api.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 JavaScript API 的人脸检测— face-api.js</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/face-recognition-using-javascript-api-face-api-js-75af10bc3dee?source=collection_archive---------4-----------------------#2019-10-06">https://towardsdatascience.com/face-recognition-using-javascript-api-face-api-js-75af10bc3dee?source=collection_archive---------4-----------------------#2019-10-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div class="gh gi jq"><img src="../Images/363b1ab11d05567838765acd78f77def.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/1*TrN6eJDQf3n2nLLyKPvg3g.gif"/></div><figcaption class="jx jy gj gh gi jz ka bd b be z dk">Face-API.js</figcaption></figure><p id="3ee0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在本文中，我们将学习使用<code class="fe kz la lb lc b">face-api.js</code>的面部检测(年龄/性别/面部位置/情绪),以及在网络浏览器上使用<code class="fe kz la lb lc b">coco-ssd</code>模型的附近物体检测(人/电话等)。</p><p id="eb84" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><code class="fe kz la lb lc b">face-api.js</code>是一个 javascript 模块，构建在<a class="ae ld" href="https://github.com/tensorflow/tfjs-core" rel="noopener ugc nofollow" target="_blank"> <strong class="kd iu"> tensorflow.js 核心</strong> </a>之上，实现了几个<strong class="kd iu"> CNN </strong> s <strong class="kd iu"> ( </strong>卷积神经网络)来解决人脸检测、人脸识别和人脸地标检测，针对 web 和移动设备进行了优化。</p><p id="4f38" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">让我们现在开始，</p><h2 id="b4a9" class="le lf it bd lg lh li dn lj lk ll dp lm km ln lo lp kq lq lr ls ku lt lu lv lw bi translated">先决条件:</h2><ol class=""><li id="bfd2" class="lx ly it kd b ke lz ki ma km mb kq mc ku md ky me mf mg mh bi translated">对 React.js 有基本的了解(你可以选择任何你喜欢的库或前端框架)</li><li id="b88f" class="lx ly it kd b ke mi ki mj km mk kq ml ku mm ky me mf mg mh bi translated">对 p5.js 库的基本了解。</li><li id="86c2" class="lx ly it kd b ke mi ki mj km mk kq ml ku mm ky me mf mg mh bi translated">已安装的 create-react-app 和 Node.js 版本&gt; = 10.15.1</li></ol><h2 id="5bd2" class="le lf it bd lg lh li dn lj lk ll dp lm km ln lo lp kq lq lr ls ku lt lu lv lw bi translated">让我们创建一个 react 项目，</h2><pre class="mn mo mp mq gt mr lc ms mt aw mu bi"><span id="0dc8" class="le lf it lc b gy mv mw l mx my">npx create-react-app object_face_detection<br/>cd object_face_detection</span></pre><h2 id="add0" class="le lf it bd lg lh li dn lj lk ll dp lm km ln lo lp kq lq lr ls ku lt lu lv lw bi translated">现在，安装下面的依赖项</h2><pre class="mn mo mp mq gt mr lc ms mt aw mu bi"><span id="9e19" class="le lf it lc b gy mv mw l mx my">npm install @tensorflow-models/coco-ssd<br/>npm install @tensorflow/tfjs-converter<br/>npm install @tensorflow/tfjs-core<br/>npm install face-api.js<br/>npm install p5<br/>npm install react-p5-wrapper</span></pre><p id="a617" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">让我们一个一个地了解每一个依赖关系——</p><ol class=""><li id="fc43" class="lx ly it kd b ke kf ki kj km mz kq na ku nb ky me mf mg mh bi translated"><code class="fe kz la lb lc b">@tensorflow-models/coco-ssd</code> —这将用于其他物体检测，如电话、墙壁等。在脸的周围。<code class="fe kz la lb lc b">Coco-ssd</code>是一个 TensorFlow 模型，已经用大量通用图像进行了训练，可以直接在浏览器中使用。你可以在这里阅读—<a class="ae ld" href="https://github.com/tensorflow/tfjs-models/tree/master/coco-ssd" rel="noopener ugc nofollow" target="_blank">https://github . com/tensor flow/tfjs-models/tree/master/coco-SSD</a></li><li id="13b0" class="lx ly it kd b ke mi ki mj km mk kq ml ku mm ky me mf mg mh bi translated"><code class="fe kz la lb lc b">@tensorflow/tfjs-converter</code>—将 TensorFlow 保存的模型和 keras 模型直接转换为 tensorflow.js 使用。我的意思是已经有很多使用 python 或 R 制作/训练的模型，但是模型保存的格式不同于 TensorFlow.js 使用/消费的格式。所以需要这种依赖来将其他模型转换成 TensorFlow 的可消费格式。</li><li id="b52f" class="lx ly it kd b ke mi ki mj km mk kq ml ku mm ky me mf mg mh bi translated"><code class="fe kz la lb lc b">@tensorflow/tfjs-core</code> — Tensorflow 核心 javascript 库。你可以读读这个——https://www.tensorflow.org/js/tutorials/setup。face-api.js 是在这种依赖的基础上构建的。</li><li id="06a2" class="lx ly it kd b ke mi ki mj km mk kq ml ku mm ky me mf mg mh bi translated"><code class="fe kz la lb lc b">face-api.js</code> —这是本文的核心 API，将用于人脸检测。了解更多—<a class="ae ld" href="https://github.com/justadudewhohacks/face-api.js?files=1" rel="noopener ugc nofollow" target="_blank">https://github.com/justadudewhohacks/face-api.js?files=1</a></li><li id="473f" class="lx ly it kd b ke mi ki mj km mk kq ml ku mm ky me mf mg mh bi translated">这是最近发展起来的另一个伟大的库，在我们的上下文中，我们将使用它来制作网络摄像头视频，并在检测到的人脸和物体周围绘制一个红色框。你可以阅读—<a class="ae ld" href="https://p5js.org/reference/#/p5/createCapture" rel="noopener ugc nofollow" target="_blank">https://p5js.org</a></li><li id="27ab" class="lx ly it kd b ke mi ki mj km mk kq ml ku mm ky me mf mg mh bi translated"><code class="fe kz la lb lc b">react-p5-wrapper</code> —这只是一个在 p5js 功能上编写的 reactjs 包装器。所以与其写一个，不如用它来节省时间。</li></ol><h2 id="b1f0" class="le lf it bd lg lh li dn lj lk ll dp lm km ln lo lp kq lq lr ls ku lt lu lv lw bi translated">现在让我们深入编码💻</h2><p id="2918" class="pw-post-body-paragraph kb kc it kd b ke lz kg kh ki ma kk kl km nc ko kp kq nd ks kt ku ne kw kx ky im bi translated">在我们开始之前，我们需要下载<code class="fe kz la lb lc b">face-api.js </code>模型(已经建立做面部和情绪检测)。因此，让我们在我们的<code class="fe kz la lb lc b">public</code>文件夹中创建一个名为<code class="fe kz la lb lc b">models</code>的文件夹，并下载位于<a class="ae ld" href="https://github.com/justadudewhohacks/face-api.js/tree/master/weights" rel="noopener ugc nofollow" target="_blank">https://github . com/justadudewhohacks/face-API . js/tree/master/weights</a>的文件</p><p id="d6bf" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><code class="fe kz la lb lc b">models</code>文件夹将会是这样的</p><figure class="mn mo mp mq gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="ng nh di ni bf nj"><div class="gh gi nf"><img src="../Images/c6ccc63e42ecaa744805f6cbd49be430.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aCT0DyRYYsJ4kf1iDhGyOA.png"/></div></div></figure><p id="bbc4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们现在将在我们的<code class="fe kz la lb lc b">src</code>文件夹中创建一个名为<code class="fe kz la lb lc b">ObjectDetectionSketch.js</code>的文件，它将包含我们所有的逻辑。</p><p id="16bf" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">该文件将有如下一些导入语句</p><pre class="mn mo mp mq gt mr lc ms mt aw mu bi"><span id="7ee5" class="le lf it lc b gy mv mw l mx my">import * as p5 from 'p5'</span><span id="23dd" class="le lf it lc b gy nk mw l mx my">import "p5/lib/addons/p5.dom";</span><span id="a81c" class="le lf it lc b gy nk mw l mx my">import * as cocoSsd from '@tensorflow-models/coco-ssd';</span><span id="c307" class="le lf it lc b gy nk mw l mx my">import * as faceapi from 'face-api.js';</span></pre><ol class=""><li id="38ff" class="lx ly it kd b ke kf ki kj km mz kq na ku nb ky me mf mg mh bi translated"><strong class="kd iu"> p5 和 p5.dom </strong> —需配合 p5js，忍着点，过几段你就明白确切用法了。</li><li id="cda4" class="lx ly it kd b ke mi ki mj km mk kq ml ku mm ky me mf mg mh bi translated"><strong class="kd iu"> cocoSsd </strong>和<strong class="kd iu">faceapi</strong>——你现在已经知道了。</li></ol><p id="9000" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">接下来，我们将定义我们的 face-API 模型 URL</p><pre class="mn mo mp mq gt mr lc ms mt aw mu bi"><span id="bf00" class="le lf it lc b gy mv mw l mx my">const MODEL_URL = '/models' <br/>// this will pick public folder by default</span></pre><p id="da59" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在，我们将创建名为<strong class="kd iu"> sketch </strong>的函数(包含所有逻辑的包装函数)</p><pre class="mn mo mp mq gt mr lc ms mt aw mu bi"><span id="3f53" class="le lf it lc b gy mv mw l mx my">export default function sketch (p) {}</span></pre><p id="3bc3" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在 sketch 函数内部，我们将定义几个变量和四个函数，两个自定义的，两个来自 p5.js，分别叫做<code class="fe kz la lb lc b">setup</code>和<code class="fe kz la lb lc b">draw</code>。</p><p id="bc41" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">变量</strong></p><pre class="mn mo mp mq gt mr lc ms mt aw mu bi"><span id="caf6" class="le lf it lc b gy mv mw l mx my">// Variables</span><span id="14fa" class="le lf it lc b gy nk mw l mx my">// save current camera image<br/>let capture = null;</span><span id="11ab" class="le lf it lc b gy nk mw l mx my">// save cocossd Model<br/>let cocossdModel = null;</span><span id="4a8c" class="le lf it lc b gy nk mw l mx my">// to save the result of cocossd and face-api results<br/>let cocoDrawings = [];<br/>let faceDrawings = [];</span></pre><p id="8c90" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">自定义功能</strong></p><pre class="mn mo mp mq gt mr lc ms mt aw mu bi"><span id="193a" class="le lf it lc b gy mv mw l mx my">// Custom Function</span><span id="48c4" class="le lf it lc b gy nk mw l mx my">// Used to store the result of coco-ssd model<br/>function showCocoSSDResults(results) {<br/>    const id = capture.id();<br/>    cocoDrawings = results;<br/>}</span><span id="d8ad" class="le lf it lc b gy nk mw l mx my">// used to store the result for the face-api.js model<br/>function showFaceDetectionData(data) {<br/>    faceDrawings = data;<br/>}</span></pre><p id="1899" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> P5.js 函数</strong></p><pre class="mn mo mp mq gt mr lc ms mt aw mu bi"><span id="0feb" class="le lf it lc b gy mv mw l mx my">// P5.js Functions<br/>p.setup = async function() {}<br/>p.draw = function() {}</span></pre><p id="6b1e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们来详细了解一下这两个 p5 的功能。🚀</p><h1 id="dbc7" class="nl lf it bd lg nm nn no lj np nq nr lm ns nt nu lp nv nw nx ls ny nz oa lv ob bi translated"><code class="fe kz la lb lc b">Setup</code>功能</h1><p id="9613" class="pw-post-body-paragraph kb kc it kd b ke lz kg kh ki ma kk kl km nc ko kp kq nd ks kt ku ne kw kx ky im bi translated">页面加载后，将自动调用 p5.js 设置。我们正在覆盖 p5 内置的<code class="fe kz la lb lc b">setup</code>函数来初始化我们需要的一些细节。下面是我们将在设置函数中执行的步骤。</p><p id="1bd9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> 1。加载我们将用于人脸检测的三个 face-api.js 模型</strong>。</p><pre class="mn mo mp mq gt mr lc ms mt aw mu bi"><span id="871e" class="le lf it lc b gy mv mw l mx my">await faceapi.loadSsdMobilenetv1Model(MODEL_URL);<br/>await faceapi.loadAgeGenderModel(MODEL_URL);<br/>await faceapi.loadFaceExpressionModel(MODEL_URL);</span></pre><p id="1c4e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> 2 </strong>。<strong class="kd iu">创建一个 p5.js 画布</strong></p><pre class="mn mo mp mq gt mr lc ms mt aw mu bi"><span id="d756" class="le lf it lc b gy mv mw l mx my">p.createCanvas(1280, 720);</span></pre><p id="0c3a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> 3 </strong>。<strong class="kd iu">在画布上实现摄像头捕捉功能</strong>。</p><pre class="mn mo mp mq gt mr lc ms mt aw mu bi"><span id="38ad" class="le lf it lc b gy mv mw l mx my">const constraints = {<br/>  video: {<br/>      mandatory: {<br/>      minWidth: 1280,<br/>      minHeight: 720<br/>      },<br/>      optional: [{ maxFrameRate: 10 }]<br/>  },<br/>  audio: false<br/>};</span><span id="a329" class="le lf it lc b gy nk mw l mx my">capture = p.createCapture(constraints, () =&gt; {});</span></pre><p id="8b4b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> 4。</strong> <strong class="kd iu">设置视频 Id 和大小。</strong></p><pre class="mn mo mp mq gt mr lc ms mt aw mu bi"><span id="11a2" class="le lf it lc b gy mv mw l mx my">capture.id("video_element");<br/>capture.size(1280, 720);<br/>capture.hide(); // this is require as we don't want to show the deafault video input</span></pre><p id="8e43" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> 5 </strong>。<strong class="kd iu">加载 cocoSsd 模型并保存在本地。</strong></p><pre class="mn mo mp mq gt mr lc ms mt aw mu bi"><span id="d950" class="le lf it lc b gy mv mw l mx my">cocoSsd.load().then((model) =&gt; {<br/>  try {<br/>      cocossdModel = model;<br/>  } catch(e) {<br/>      console.log(e);<br/>  }<br/>}).catch((e) =&gt; {<br/>    console.log("Error occured : ", e);<br/>});</span></pre><h1 id="59c7" class="nl lf it bd lg nm nn no lj np nq nr lm ns nt nu lp nv nw nx ls ny nz oa lv ob bi translated">绘图功能</h1><p id="9431" class="pw-post-body-paragraph kb kc it kd b ke lz kg kh ki ma kk kl km nc ko kp kq nd ks kt ku ne kw kx ky im bi translated">如果在 p5js 画布上绘制任何东西，就会调用 p5js 的 draw 函数。在我们的自定义绘制函数中，我们将执行以下步骤。</p><ol class=""><li id="2d92" class="lx ly it kd b ke kf ki kj km mz kq na ku nb ky me mf mg mh bi translated">将背景设置为白色，并在上面绘制我们的图像。此外，<strong class="kd iu">添加透明度</strong>，这样任何进一步绘制到画布上的东西都将是透明的。</li></ol><pre class="mn mo mp mq gt mr lc ms mt aw mu bi"><span id="3ac1" class="le lf it lc b gy mv mw l mx my">p.background(255);<br/>p.image(capture, 0, 0);     <br/>p.fill(0,0,0,0);</span></pre><p id="57d5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">2.代码<strong class="kd iu">渲染 coco-ssd 模型结果。</strong></p><pre class="mn mo mp mq gt mr lc ms mt aw mu bi"><span id="15c1" class="le lf it lc b gy mv mw l mx my">cocoDrawings.map((drawing) =&gt; {<br/>  if (drawing) {<br/>      p.textSize(20);<br/>      p.strokeWeight(1);<br/>      const textX = drawing.bbox[0]+drawing.bbox[2];<br/>      const textY = drawing.bbox[1]+drawing.bbox[3];<br/>    <br/>      const confidenetext = "Confidence: "+ drawing.score.toFixed(1);<br/>      const textWidth = p.textWidth(confidenetext);<br/>    <br/>      const itemTextWidth = p.textWidth(drawing.class);<br/>      p.text(drawing.class, textX-itemTextWidth-10, textY-50);</span><span id="db5d" class="le lf it lc b gy nk mw l mx my">p.text(confidenetext, textX-textWidth-10, textY-10);<br/>      p.strokeWeight(4);<br/>      p.stroke('rgb(100%,100%,100%)');<br/>      p.rect(drawing.bbox[0], drawing.bbox[1], drawing.bbox[2], drawing.bbox[3]);<br/>  }<br/>});</span></pre><p id="b286" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这里我们有一个<code class="fe kz la lb lc b">cocoDrawings</code>对象，包含 coco-ssd 模型检测到的当前对象细节。这个物体的形状看起来像</p><pre class="mn mo mp mq gt mr lc ms mt aw mu bi"><span id="f308" class="le lf it lc b gy mv mw l mx my">{<br/>  "bbox": [<br/>    6.165122985839844,<br/>    2.656116485595703,<br/>    1034.7143936157227,<br/>    712.3482799530029<br/>  ],<br/>  "class": "person",<br/>  "score": 0.9296618103981018<br/>}</span></pre><p id="2695" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们使用这个对象数据来绘制一个矩形，该矩形定义了当前对象的位置以及被检测到的对象的名称(在上面的例子中是人)和分数。</p><p id="b85e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这是一个基本的 p5js 代码，用于绘制文本和矩形。如果你觉得很难理解，那么试试 p5.js docs，一个小时之内你就会明白了。—<a class="ae ld" href="https://p5js.org/" rel="noopener ugc nofollow" target="_blank">https://p5js.org/</a></p><p id="4d37" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们可以在画布上绘制多个对象，因为它们会被检测到。</p><p id="b741" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">3.代码<strong class="kd iu">呈现 face-api.js 模型结果。</strong></p><pre class="mn mo mp mq gt mr lc ms mt aw mu bi"><span id="10ad" class="le lf it lc b gy mv mw l mx my">faceDrawings.map((drawing) =&gt; {<br/>  if (drawing) {<br/>    p.textSize(15);<br/>    p.strokeWeight(1);</span><span id="1f95" class="le lf it lc b gy nk mw l mx my">   const textX = drawing.detection.box._x+drawing.detection.box._width;<br/>    const textY = drawing.detection.box._y+drawing.detection.box._height;<br/>    <br/>    const confidenetext = "Gender: "+ drawing.gender;<br/>    const textWidth = p.textWidth(confidenetext);<br/>    p.text(confidenetext, textX-textWidth, textY-60);</span><span id="189a" class="le lf it lc b gy nk mw l mx my">    const agetext = "Age: "+ drawing.age.toFixed(0);<br/>    const ageTextWidth = p.textWidth(agetext);<br/>    p.text(agetext, textX-ageTextWidth, textY-30);</span><span id="9f4e" class="le lf it lc b gy nk mw l mx my">    const copiedExpression = drawing.expressions;<br/>    const expressions = Object.keys(copiedExpression).map((key) =&gt; {<br/>        const value = copiedExpression[key];<br/>        return value;<br/>    })</span><span id="9f5a" class="le lf it lc b gy nk mw l mx my">    const max = Math.max(...expressions);<br/>    <br/>    const expression_value =    Object.keys(copiedExpression).filter((key) =&gt; {<br/>        return copiedExpression[key] === max; <br/>    })[0];</span><span id="abf8" class="le lf it lc b gy nk mw l mx my">    const expressiontext = "Mood: "+ expression_value;<br/>    const expressionWidth = p.textWidth(expressiontext);<br/>    p.text(expressiontext, textX-expressionWidth, textY-10);<br/>    <br/>    p.strokeWeight(4);<br/>    p.stroke('rgb(100%,0%,10%)');<br/>    p.rect(drawing.detection.box._x, drawing.detection.box._y, drawing.detection.box._width, drawing.detection.box._height);<br/>  }<br/>});</span></pre><p id="2148" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这里我们定义文本大小，将从 face-api.js 获得的数据绘制到 p5.js 画布上。</p><p id="21f0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在，每个检测到的人脸都有以下由 face-api.js 模型返回的数据</p><pre class="mn mo mp mq gt mr lc ms mt aw mu bi"><span id="d91c" class="le lf it lc b gy mv mw l mx my">{<br/>  "detection": {<br/>    "_imageDims": {<br/>      "_width": 1280,<br/>      "_height": 720<br/>    },<br/>    "_score": 0.6889822483062744,<br/>    "_classScore": 0.6889822483062744,<br/>    "_className": "",<br/>    "_box": {<br/>      "_x": 121.50997161865234,<br/>      "_y": 15.035667419433594,<br/>      "_width": 507.80059814453125,<br/>      "_height": 531.7609024047852<br/>    }<br/>  },<br/>  "gender": "male",<br/>  "genderProbability": 0.9683359265327454,<br/>  "age": 30.109874725341797,<br/>  "expressions": {<br/>    "neutral": 0.9950351715087891,<br/>    "happy": 0.0000017113824242187547,<br/>    "sad": 0.000005796719960926566,<br/>    "angry": 0.00000466804613097338,<br/>    "fearful": 1.3292748013427058e-9,<br/>    "disgusted": 3.015825145169515e-9,<br/>    "surprised": 0.004952521994709969<br/>  }<br/>}</span></pre><p id="2231" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">你可以看到，我们得到的是一个矩形坐标的人脸、性别、年龄和表情数据</p><p id="cbde" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们可以从<code class="fe kz la lb lc b">detection._box </code>中提取矩形坐标，对于表达式，我们有所有的表达式及其相应的分数。所以，</p><pre class="mn mo mp mq gt mr lc ms mt aw mu bi"><span id="dc3a" class="le lf it lc b gy mv mw l mx my">const copiedExpression = drawing.expressions;<br/>const expressions = Object.keys(copiedExpression).map((key) =&gt; {<br/>    const value = copiedExpression[key];<br/>    return value;<br/>})</span><span id="3ec5" class="le lf it lc b gy nk mw l mx my">const max = Math.max(...expressions);</span><span id="d172" class="le lf it lc b gy nk mw l mx my">const expression_value = Object.keys(copiedExpression).filter((key) =&gt; {<br/>    return copiedExpression[key] === max; <br/>})[0];</span></pre><p id="3a43" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">用上面的代码，我们将估计和获得高度记分员表达式，并显示在一个矩形内</p><p id="3f07" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">最困难的部分是将文本放入矩形，所以我们做了一个不太好的实现，但它是可行的。</p><p id="5e13" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">所以我们从盒子的 x 坐标上去掉这个宽度，再加 10，这样左边界和显示文本就有了一些空白。</p><pre class="mn mo mp mq gt mr lc ms mt aw mu bi"><span id="207f" class="le lf it lc b gy mv mw l mx my">const ageTextWidth = p.textWidth(agetext);<br/>p.text(agetext, textX-ageTextWidth, textY-30);</span></pre><p id="8876" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi oc translated">等一等🤔这一切都很好，但是检测人脸和其他物体的代码在哪里呢？</p><p id="d01a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这就是了👇</p><p id="7e15" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">4.检测人脸和其他元对象的<strong class="kd iu">代码。</strong></p><pre class="mn mo mp mq gt mr lc ms mt aw mu bi"><span id="e142" class="le lf it lc b gy mv mw l mx my">faceapi.detectAllFaces(capture.id())<br/>  .withAgeAndGender()<br/>  .withFaceExpressions()<br/>  .then((data) =&gt; {<br/>    showFaceDetectionData(data);<br/>});</span><span id="b70f" class="le lf it lc b gy nk mw l mx my">if(capture.loadedmetadata) {<br/>    if (cocossdModel) {<br/>        cocossdModel<br/>        .detect(document.getElementById("video_element"))<br/>        .then(showCocoSSDResults)<br/>        .catch((e) =&gt; {<br/>            console.log("Exception : ", e);<br/>        });<br/>    }<br/>}</span></pre><p id="df82" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们结束了🎢准备测试。</p><p id="19a1" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在候机楼里面做什么</p><pre class="mn mo mp mq gt mr lc ms mt aw mu bi"><span id="fcb5" class="le lf it lc b gy mv mw l mx my">cd object_face_detection<br/>npm start</span></pre><p id="b7dc" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这是尝试的结果—</p><figure class="mn mo mp mq gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="ng nh di ni bf nj"><div class="gh gi ol"><img src="../Images/a7345b0b74938f3b7d0ee03ee9541883.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1M7T7BniInpxDTnk"/></div></div></figure><p id="dac3" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">https://github . com/overflow js-com/object _ face _ detection _ web cam _ react——如果你觉得很难理解本文的内容，可以参考这里的代码。</p><blockquote class="om on oo"><p id="ec01" class="kb kc op kd b ke kf kg kh ki kj kk kl oq kn ko kp or kr ks kt os kv kw kx ky im bi translated">注意:这个实现很慢，因为我们在浏览器中加载所有的模型，并且是实时的</p></blockquote></div><div class="ab cl ot ou hx ov" role="separator"><span class="ow bw bk ox oy oz"/><span class="ow bw bk ox oy oz"/><span class="ow bw bk ox oy"/></div><div class="im in io ip iq"><p id="ae91" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果您想被添加到我的电子邮件列表中，请考虑在这里输入您的电子邮件地址 和<strong class="kd iu">关注我的</strong> <a class="ae ld" href="https://medium.com/@ideepak.jsd" rel="noopener"> <strong class="kd iu"> medium </strong> </a> <strong class="kd iu">阅读更多关于 javascript 的文章，并关注</strong><a class="ae ld" href="https://github.com/dg92" rel="noopener ugc nofollow" target="_blank"><strong class="kd iu">github</strong></a><strong class="kd iu">查看我的疯狂代码</strong>。如果有什么不清楚或者你想指出什么，请在下面评论。</p><p id="c3eb" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">你可能也会喜欢我的其他文章</p><ol class=""><li id="1d02" class="lx ly it kd b ke kf ki kj km mz kq na ku nb ky me mf mg mh bi translated"><a class="ae ld" href="https://levelup.gitconnected.com/javascript-execution-context-and-hoisting-c2cc4993e37d" rel="noopener ugc nofollow" target="_blank"> Javascript 执行上下文和提升</a></li><li id="dac0" class="lx ly it kd b ke mi ki mj km mk kq ml ku mm ky me mf mg mh bi translated"><a class="ae ld" href="https://medium.com/datadriveninvestor/javascript-generator-yield-next-async-await-8442d2c77185" rel="noopener"> Javascript —生成器-产出/下一个&amp;异步-等待🤔</a></li><li id="aa76" class="lx ly it kd b ke mi ki mj km mk kq ml ku mm ky me mf mg mh bi translated"><a class="ae ld" href="https://medium.com/datadriveninvestor/javascript-context-this-keyword-9a78a19d5786" rel="noopener">理解 Javascript‘this’关键字(上下文)</a>。</li><li id="a41e" class="lx ly it kd b ke mi ki mj km mk kq ml ku mm ky me mf mg mh bi translated"><a class="ae ld" href="https://levelup.gitconnected.com/write-beautiful-javascript-with-%CE%BB-fp-es6-350cd64ab5bf" rel="noopener ugc nofollow" target="_blank"> Javascript 数据结构与映射、归约、过滤</a></li><li id="f4cd" class="lx ly it kd b ke mi ki mj km mk kq ml ku mm ky me mf mg mh bi translated"><a class="ae ld" href="https://medium.com/datadriveninvestor/javascript-currying-vs-partial-application-4db5b2442be8" rel="noopener"> Javascript- Currying VS 部分应用</a></li><li id="7038" class="lx ly it kd b ke mi ki mj km mk kq ml ku mm ky me mf mg mh bi translated"><a class="ae ld" href="https://medium.com/datadriveninvestor/javascript-es6-iterables-and-iterators-de18b54f4d4" rel="noopener"> Javascript ES6 —可迭代程序和迭代器</a></li><li id="60e5" class="lx ly it kd b ke mi ki mj km mk kq ml ku mm ky me mf mg mh bi translated"><a class="ae ld" href="https://medium.com/datadriveninvestor/why-to-use-javascript-proxy-5cdc69d943e3" rel="noopener"> Javascript —代理</a></li><li id="a5b8" class="lx ly it kd b ke mi ki mj km mk kq ml ku mm ky me mf mg mh bi translated"><a class="ae ld" href="https://medium.com/datadriveninvestor/still-confused-in-js-scopes-f7dae62c16ee" rel="noopener"> Javascript —作用域</a></li></ol><h1 id="4d76" class="nl lf it bd lg nm nn no lj np nq nr lm ns nt nu lp nv nw nx ls ny nz oa lv ob bi translated">如果你喜欢这篇文章，请随意分享，以帮助他人找到它！ </h1></div></div>    
</body>
</html>