<html>
<head>
<title>Geocode with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Python 进行地理编码</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/geocode-with-python-161ec1e62b89?source=collection_archive---------1-----------------------#2019-09-15">https://towardsdatascience.com/geocode-with-python-161ec1e62b89?source=collection_archive---------1-----------------------#2019-09-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="159d" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何将物理地址转换为地理位置→经纬度</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/d681dee4b4accd599c1189b665319283.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9COIRPRZK_QnwtkX"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Photo by <a class="ae ky" href="https://unsplash.com/@terminath0r?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Thor Alvis</a> on <a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="1b8c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据集很少是完整的，通常需要预处理。想象一下，一些数据集只有一个地址列，而没有纬度和经度列来表示地理上的数据。在这种情况下，您需要将数据转换成地理格式。将地址转换为地理信息(纬度和经度)以绘制其位置的过程被称为<strong class="lb iu">地理编码</strong>。</p><p id="614f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi lv translated"><span class="l lw lx ly bm lz ma mb mc md di">G</span>T5】eocoding 是将一个 <a class="ae ky" href="https://en.wikipedia.org/wiki/Address_(geography)" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">物理地址</strong> </a> <strong class="lb iu">描述为地球表面上一个</strong> <a class="ae ky" href="https://en.wikipedia.org/wiki/Location_(geography)" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">位置</strong> </a> <strong class="lb iu">的</strong>  <strong class="lb iu">计算过程(以数值坐标表示)——维基百科</strong></p><p id="8a85" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本教程中，我将向您展示如何借助 Geopy 和 Geopandas 库在 Python 中执行地理编码。如果您已经安装了 Anaconda 环境，让我们用 Pip 安装这些库。</p><pre class="kj kk kl km gt me mf mg mh aw mi bi"><span id="edee" class="mj mk it mf b gy ml mm l mn mo">pip install geopandas<br/>pip install geopy</span></pre><p id="8a8c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你不想安装库并直接与本教程附带的 Jupyter 笔记本交互，本文底部有 Github 与 MyBinder 的链接。这是一个集装箱化的环境，它允许你直接在网上实验本教程，而不需要任何安装。数据集也包含在这个环境中，因此本教程不需要下载数据集。</p><h2 id="d5ca" class="mj mk it bd mp mq mr dn ms mt mu dp mv li mw mx my lm mz na nb lq nc nd ne nf bi translated">地理编码单个地址</h2><p id="f4a4" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">要对单个地址进行地理定位，可以使用 Geopy python 库。<a class="ae ky" href="https://geopy.readthedocs.io/en/stable/#" rel="noopener ugc nofollow" target="_blank"> Geopy </a>有不同的地理编码服务可供选择，包括谷歌地图、ArcGIS、AzureMaps、Bing 等。其中一些需要 API 键，而另一些则不需要。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/9a971206b91e52a22fc1e382cd3f8f7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I9Miy4XzfFIewVJe5GclRg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Geopy</figcaption></figure><p id="14cc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">作为我们的第一个例子，我们使用的是建立在 OpenStreetMap 数据之上的 nomist 地理编码服务。让我们对一个地址进行地理编码，巴黎的埃菲尔铁塔。</p><pre class="kj kk kl km gt me mf mg mh aw mi bi"><span id="c1b0" class="mj mk it mf b gy ml mm l mn mo">locator = Nominatim(user_agent=”myGeocoder”)<br/>location = locator.geocode(“Champ de Mars, Paris, France”)</span></pre><p id="9bcb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们创建了保存地理编码服务的<code class="fe nm nn no mf b">locator</code>,命名。然后，我们传递我们创建的定位器来对任何地址进行地理编码，在本例中，是 Eifel tower 地址。</p><pre class="kj kk kl km gt me mf mg mh aw mi bi"><span id="3545" class="mj mk it mf b gy ml mm l mn mo">print(“Latitude = {}, Longitude = {}”.format(location.latitude, location.longitude))</span></pre><p id="568a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们可以打印出我们创建的位置的坐标。</p><pre class="kj kk kl km gt me mf mg mh aw mi bi"><span id="7214" class="mj mk it mf b gy ml mm l mn mo">Latitude = 48.85614465, Longitude = 2.29782039332223</span></pre><p id="ef67" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">尝试一些不同的地址。在下一节中，我们将介绍如何对熊猫数据帧中的许多地址进行地理编码。</p><h2 id="54af" class="mj mk it bd mp mq mr dn ms mt mu dp mv li mw mx my lm mz na nb lq nc nd ne nf bi translated">对熊猫的地址进行地理编码</h2><p id="abe2" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">让我们阅读本教程的数据集。在本教程中，我们使用商店地址数据集的示例。CSV 文件可通过此链接获得。</p><div class="np nq gp gr nr ns"><a href="https://www.dropbox.com/s/nt9ab4nnhpyrmxe/addresses.csv?dl=0" rel="noopener  ugc nofollow" target="_blank"><div class="nt ab fo"><div class="nu ab nv cl cj nw"><h2 class="bd iu gy z fp nx fr fs ny fu fw is bi translated">addresses.csv</h2><div class="nz l"><h3 class="bd b gy z fp nx fr fs ny fu fw dk translated">Dropbox 是一项免费服务，可以让你将照片、文档和视频带到任何地方，并轻松分享。从不发电子邮件…</h3></div><div class="oa l"><p class="bd b dl z fp nx fr fs ny fu fw dk translated">www.dropbox.com</p></div></div><div class="ob l"><div class="oc l od oe of ob og ks ns"/></div></div></a></div><p id="13d1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下载 CSV 文件，用熊猫看。</p><pre class="kj kk kl km gt me mf mg mh aw mi bi"><span id="7704" class="mj mk it mf b gy ml mm l mn mo">df = pd.read_csv(“addresses.csv”)<br/>df.head()</span></pre><p id="fc9d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下表提供了 DataFrame 表的前五行。如您所见，没有纬度和经度列来映射数据。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/0bffffc7c3e948c6494692cffbb845d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1214/format:webp/1*85umjG3K78b9EeUMEKxwFA.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Ddataframe</figcaption></figure><p id="475f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将地址列连接成一个适合地理编码的列。例如，第一个地址是:</p><pre class="kj kk kl km gt me mf mg mh aw mi bi"><span id="0a48" class="mj mk it mf b gy ml mm l mn mo">Karlaplan 13,115 20,STOCKHOLM,Stockholms län, Sweden</span></pre><p id="db26" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以像这样连接 pandas 中的地址列，为地理编码创建一个地址列:</p><p id="1128" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦我们创建了地址列，我们就可以像下面的代码片段一样开始地理编码。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oi oj l"/></div></figure><ul class=""><li id="16a0" class="ok ol it lb b lc ld lf lg li om lm on lq oo lu op oq or os bi translated"># 1-我们首先在每个地址之间延迟 1 秒钟进行地理编码。当您对大量物理地址进行地理编码时，这非常方便，因为地理编码服务提供商可以拒绝对服务的访问。</li><li id="232f" class="ok ol it lb b lc ot lf ou li ov lm ow lq ox lu op oq or os bi translated">#2 —通过应用我们创建的<code class="fe nm nn no mf b">geocode</code>来创建一个<code class="fe nm nn no mf b">df['location']</code>列。</li><li id="8325" class="ok ol it lb b lc ot lf ou li ov lm ow lq ox lu op oq or os bi translated">#3 —第三，我们可以将纬度、经度和海拔高度创建为一个元组列。</li><li id="7e91" class="ok ol it lb b lc ot lf ou li ov lm ow lq ox lu op oq or os bi translated">#4 —最后，我们将纬度、经度和海拔列分成三个单独的列。</li></ul><p id="a324" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面的代码生成了一个带有纬度和经度列的数据帧，您可以使用自己选择的任何地理可视化工具绘制该数据帧。让我们看一下数据帧的前几个草图，但是首先，我们将清理掉不需要的列。</p><pre class="kj kk kl km gt me mf mg mh aw mi bi"><span id="700a" class="mj mk it mf b gy ml mm l mn mo">df = df.drop([‘Address1’, ‘Address3’, ‘Address4’, ‘Address5’,’Telefon’, ‘ADDRESS’, ‘location’, ‘point’], axis=1)</span><span id="8709" class="mj mk it mf b gy oy mm l mn mo">df.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oz"><img src="../Images/6d60db756ac823147f295d3261244d29.png" data-original-src="https://miro.medium.com/v2/resize:fit:768/format:webp/1*Hn6peKEloYKGNs2QKZenRg.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">cleaned table with latitude and longitude</figcaption></figure><p id="74ac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我将使用 lyum 来绘制我们创建的点，但也可以随意使用您选择的任何其他地理可视化工具。首先，我们用叶子将位置显示为圆形地图。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="5449" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面生成的地图将地理编码地址显示为圆圈。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pa"><img src="../Images/d4a40a0fd8d5b813a02c69f1fabecb53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ACLurItE8airVDXQk_TJSA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Map</figcaption></figure><p id="5c06" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者，如果您喜欢带有聚合点簇的深色背景，您可以执行以下操作:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oi oj l"/></div></figure><p id="3644" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是一个黑暗的背景地图与集群点地图在叶。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pb"><img src="../Images/18e48282a249e91a18a40b82eecadecf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qaKrvUBtWYcOdPcycgQNZg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Clustered map</figcaption></figure><h2 id="b20a" class="mj mk it bd mp mq mr dn ms mt mu dp mv li mw mx my lm mz na nb lq nc nd ne nf bi translated">结论</h2><p id="d04e" class="pw-post-body-paragraph kz la it lb b lc ng ju le lf nh jx lh li ni lk ll lm nj lo lp lq nk ls lt lu im bi translated">在许多需要坐标系的定位任务中，地理编码是一项关键任务。在本文中，我们看到了如何用 Python 进行地理编码。还有许多其他服务提供免费或付费的地理编码服务，您可以在 GeoPy 中进行试验。我发现 Google Maps 地理编码服务比我们在本教程中使用的 Openstreetmap 服务更强大，但是它需要一个 API 密钥。</p><p id="1c60" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了在没有任何安装的情况下与本教程进行交互和实验，我创建了一个活页夹。进入 GitHub 库，点击启动活页夹。</p><div class="np nq gp gr nr ns"><a href="https://github.com/shakasom/geocoding" rel="noopener  ugc nofollow" target="_blank"><div class="nt ab fo"><div class="nu ab nv cl cj nw"><h2 class="bd iu gy z fp nx fr fs ny fu fw is bi translated">shaka som/地理编码</h2><div class="nz l"><h3 class="bd b gy z fp nx fr fs ny fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="oa l"><p class="bd b dl z fp nx fr fs ny fu fw dk translated">github.com</p></div></div><div class="ob l"><div class="pc l od oe of ob og ks ns"/></div></div></a></div><p id="139d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">或者直接访问 Jupyter 笔记本活页夹链接:</p><div class="np nq gp gr nr ns"><a href="https://mybinder.org/v2/gh/shakasom/geocoding/master" rel="noopener  ugc nofollow" target="_blank"><div class="nt ab fo"><div class="nu ab nv cl cj nw"><h2 class="bd iu gy z fp nx fr fs ny fu fw is bi translated">GitHub:shaka som/geocoding/master</h2><div class="nz l"><h3 class="bd b gy z fp nx fr fs ny fu fw dk translated">单击运行此交互式环境。来自活页夹项目:可复制、可共享、交互式计算…</h3></div><div class="oa l"><p class="bd b dl z fp nx fr fs ny fu fw dk translated">mybinder.org</p></div></div><div class="ob l"><div class="pd l od oe of ob og ks ns"/></div></div></a></div></div></div>    
</body>
</html>