# 当我尝试用机器学习进行市场预测时，发生了什么

> 原文：<https://towardsdatascience.com/what-happened-when-i-tried-market-prediction-with-machine-learning-4108610b3422?source=collection_archive---------1----------------------->

![](img/cc291793be6494a19e148d24fe73d5a7.png)

*Image by Pexels on Pixabay*

就在你开始第一个基本回归或分类模型的时候，它至少会出现在你的脑海中。大量的时间序列数据，加上年轻时退休的可能性，就像在你祖父的阁楼里找到一张旧藏宝图一样，有着不可抗拒的吸引力。你怎么能不想呢？可以用机器学习预测市场吗？

我至少得试一试。以下是我所做的，以及我所学到的。

网上有很多小规模的教程，是一个很好的起点。他们向你展示如何拉下一只股票的历史，也许计算一些指标，并将其输入回归算法，并试图预测第二天的价值。或者，他们使用一个分类器来预测股票是上涨还是下跌，而不预测价值。

对于下一步该怎么走，我有两个想法。首先，我想做大。我的理论是，一些股票、货币和金融指标之间可能存在隐藏的关系，这些关系太微妙了，肉眼无法发现。我想机器学习算法也许能把它们挑出来。

第二，我不会选择我想预测的股票。我打算为它们训练模型，看看哪些股票表现最好。我的想法是，有些公司可能比其他公司更容易预测，所以我需要找到它们。

我首先下载了标准普尔 500 大部分股票的历史，一堆货币价值历史，和几十个金融指标。一个 Python 脚本负责将它们转换成一致的格式，填充缺失的值，并删除至少不能追溯到 2000 年代早期的时间序列。总之，当尘埃落定时，我在一个包含 18 年数据的漂亮的 Pandas 表中有一千多列。

一旦完成，我使用优秀的 [TA-lib](https://github.com/mrjbq7/ta-lib) 库为 5 天、10 天和 30 天的窗口计算每个时间序列的一系列指标。我没有金融背景，不知道哪些会真正增加价值，所以我采取的方法是增加一大堆，然后让模型把它们分类。这使得列数激增。数据集已准备好输入到超过 32000 列的训练模型中。

我选择 XGBoost 作为我的算法，是因为它的整体性能，以及能够很容易地看到模型使用哪些特性来进行预测。我将它设置为遍历数据集中的所有股票，为每只股票训练两个模型。第一个是分类器，它可以预测股票第二天是涨还是跌。第二个是回归模型，预测第二天的收盘价。

对于每个模型，我用 95%的可用数据训练它，然后用剩下的数据进行验证测试，模拟它从未见过的股票数据。剩下的 5%大约是 3 个月的交易数据。任何机器学习模型都将在预测它接受训练的数据方面做得很好——诀窍是让它更通用，并在它从未接触过的数据上表现良好。

对于验证运行，开始时模拟投资 1000 美元。如果预测股票会上涨，它就买入；如果预测会下跌，它就卖出。没有考虑交易成本，因为我想看看没有交易成本的结果是什么样的。

我开着我的杰特森 TX2 全速跑了一个月。

它发现了什么？

不出所料，对于大多数股票来说，结果很糟糕——准确性比扔硬币好不了多少。不过，有一些似乎在验证数据上表现得非常好。相当多的人在 3 到 6 个月内将我的模拟资金翻了一倍或两倍，有几个人在这段时间里获得了 20 倍的利润。事实证明，图表*可以*让你的心跳加速。谁知道呢？

请记住，这是该算法以前从未见过的数据-最后 5%被排除在训练数据集之外。

![](img/92ef3d64e7e8250bd5c32841ad79d296.png)

*Top is stock closing price, bottom is cash. Dips to near zero are buys.*

我找到了吗？有没有一些股票与市场指标微妙地联系在一起，从而可以被预测？如果是这样，我可以从价格波动中赚钱。

当我编写代码并运行它的时候，已经过了几个月，因为我下载了我的巨大数据集。我更新了它，加入了最近的交易数据，并决定看看这些模型在这段时间内会做些什么。他们在验证过程中做得很好——如果我在过去几个月里与他们进行实时交易，他们会做得一样好吗？这时候我变得非常兴奋。

结果令人困惑，令人沮丧。在最初的训练和验证运行中表现出色的模型可能在以后的数据运行中表现良好，但也可能会严重失败，烧掉所有的种子资金。一半时间模拟会赚钱，一半时间会破产。有时候，这比抛硬币好几个百分点，而其他时候，情况会糟糕得多。发生了什么事？它看起来很有希望。

**吸取的教训**

我终于明白我做了什么。

如果股票价格是随机游走，那么 50%左右的结果正是你所期望的。通过让我的程序在数百只股票中寻找它做得好的股票，它确实偶然发现了一些它碰巧在验证时间框架内预测得好的股票。然而，仅仅几周或几个月后，在随机漫步的另一个片段中，它失败了。

没有微妙的潜在模式。这个模型有几次完全是因为运气好，我就挑了这些例子。这是不可重复的。

因此，机器学习不是魔术。它不能预测随机序列，在训练模型时，你必须非常小心自己的偏见。仔细验证至关重要。

我确信我不会是最后一个被阁楼上的旧藏宝图召唤的受害者，但是要小心。如果你想学习的话，可以玩的随机时间序列要少得多。仔细模拟、验证，并意识到自己的偏见。

*最初发表于*[*【http://shortcircuitsandinfiniteloops.blogspot.com】*](https://shortcircuitsandinfiniteloops.blogspot.com/2019/11/what-happened-when-i-tried-market.html)*。*