<html>
<head>
<title>What does Twitter think of the New Tesla Cybertruck? Sentiment Analysis in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Twitter 如何看待新款特斯拉 Cybertruck？Python 中的情感分析</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/what-does-twitter-think-of-the-new-tesla-cybertruck-sentiment-analysis-in-python-afa22a9aefce?source=collection_archive---------30-----------------------#2019-12-02">https://towardsdatascience.com/what-does-twitter-think-of-the-new-tesla-cybertruck-sentiment-analysis-in-python-afa22a9aefce?source=collection_archive---------30-----------------------#2019-12-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/c4073e18c27941566b53e3d5e23a5cad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0aNLWKRFRPFHulyDeTdfUQ.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">Photo by <a class="ae kf" href="https://www.pexels.com/@pixabay" rel="noopener ugc nofollow" target="_blank">Pixabay</a> on <a class="ae kf" href="https://www.pexels.com/photo/close-up-of-illuminated-text-against-black-background-258083/" rel="noopener ugc nofollow" target="_blank">Pexels</a></figcaption></figure><p id="03cd" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最近，埃隆·马斯克(Elon Musk)推出了特斯拉 Cybertruck，这是一款由特斯拉公司(Tesla Inc .)开发的全电动电池驱动的商用车。Cybertruck 是每天销售的数千辆化石燃料驱动卡车的可持续能源替代品。最近，在一次电脑卡车的演示中，埃隆告诉卡车的主要设计师之一，向窗户扔一个小钢珠，以展示防弹玻璃的耐用性。两次投掷后，司机和乘客座位上的玻璃都碎了。</p><p id="49b7" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">此次发布会在社交媒体上引起了大量的关注。尽管许多人对卡车的锐利轮廓、不寻常的形状以及揭幕期间的失败测试表示不满，但特斯拉收到了超过 25 万辆卡车的预订。鉴于这种差异，看看社交媒体上对使用机器学习的网络卡车的普遍看法将是有趣的。在本帖中，我们将对关于特斯拉赛博卡车的推文进行情感分析。</p><p id="e20e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">首先，你需要申请一个 Twitter 开发者账户:</p><figure class="lf lg lh li gt ju gh gi paragraph-image"><div class="gh gi le"><img src="../Images/8de478e493cd200d2ddb35292f06e27d.png" data-original-src="https://miro.medium.com/v2/resize:fit:808/format:webp/1*0xmSHPJRMafMjW4Zr4atYQ.png"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk"><a class="ae kf" href="https://projects.raspberrypi.org/en/projects/getting-started-with-the-twitter-api/3" rel="noopener ugc nofollow" target="_blank">Source</a></figcaption></figure><p id="a903" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您的开发人员帐户获得批准后，您需要创建一个 Twitter 应用程序:</p><figure class="lf lg lh li gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi lj"><img src="../Images/535749c04db1726dafff300aac41628c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5EGnUjPFY2dF-jUkTdd6QA.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk"><a class="ae kf" href="https://projects.raspberrypi.org/en/projects/getting-started-with-the-twitter-api/4" rel="noopener ugc nofollow" target="_blank">Source</a></figcaption></figure><p id="f9b6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">申请 Twitter 开发者账户和创建 Twitter 应用程序的步骤在<a class="ae kf" href="https://projects.raspberrypi.org/en/projects/getting-started-with-the-twitter-api/4" rel="noopener ugc nofollow" target="_blank">这里</a>列出。</p><p id="2741" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了访问 Twitter API，我们将使用免费的 python 库 tweepy。tweepy 的文档可以在<a class="ae kf" href="https://tweepy.readthedocs.io/en/latest/getting_started.html" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><ol class=""><li id="44fd" class="lk ll it ki b kj kk kn ko kr lm kv ln kz lo ld lp lq lr ls bi translated"><strong class="ki iu">安装</strong></li></ol><p id="4861" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">首先，确保您已经安装了 tweepy。打开命令行并键入:</p><pre class="lf lg lh li gt lt lu lv lw aw lx bi"><span id="a36d" class="ly lz it lu b gy ma mb l mc md">pip install tweepy</span></pre><p id="8039" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">2.<strong class="ki iu">导入库</strong></p><p id="23e6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来，打开您最喜欢的编辑器，导入 tweepy 和 pandas 库:</p><pre class="lf lg lh li gt lt lu lv lw aw lx bi"><span id="725b" class="ly lz it lu b gy ma mb l mc md">import tweepy<br/>import pandas as pd</span></pre><p id="9918" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">3.<strong class="ki iu">认证</strong></p><p id="b15e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来，我们需要我们的消费者密钥和访问令牌:</p><figure class="lf lg lh li gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi me"><img src="../Images/6e8d1ea132e104bb6c262ddad9d50495.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7TxOpsOni5I1HAdafJ9BWw.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk"><a class="ae kf" href="https://projects.raspberrypi.org/en/projects/getting-started-with-the-twitter-api/4" rel="noopener ugc nofollow" target="_blank">Source</a></figcaption></figure><p id="d398" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">请注意，该网站建议您保持您的密钥和令牌私有！这里我们定义了一个假的密钥和令牌，但是在创建 Twitter 应用程序时，您应该使用真正的密钥和令牌，如上所示:</p><pre class="lf lg lh li gt lt lu lv lw aw lx bi"><span id="7ab4" class="ly lz it lu b gy ma mb l mc md">consumer_key = '5GBi0dCerYpy2jJtkkU3UwqYtgJpRd' <br/>consumer_secret = 'Q88B4BDDAX0dCerYy2jJtkkU3UpwqY'<br/>access_token = 'X0dCerYpwi0dCerYpwy2jJtkkU3U'<br/>access_token_secret = 'kly2pwi0dCerYpjJtdCerYkkU3Um'</span></pre><p id="39f9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下一步是创建 OAuthHandler 实例。我们传递上面定义的消费者密钥和访问令牌:</p><pre class="lf lg lh li gt lt lu lv lw aw lx bi"><span id="607d" class="ly lz it lu b gy ma mb l mc md">auth = tweepy.OAuthHandler(consumer_key, consumer_secret)<br/>auth.set_access_token(access_token, access_token_secret)</span></pre><p id="6ffd" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来，我们将 OAuthHandler 实例传递给 API 方法:</p><pre class="lf lg lh li gt lt lu lv lw aw lx bi"><span id="7715" class="ly lz it lu b gy ma mb l mc md">api = tweepy.API(auth)</span></pre><p id="58f6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">4.<strong class="ki iu"> TWITTER API 请求</strong></p><p id="2cca" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来，我们为我们有兴趣分析的字段初始化列表。现在，我们可以查看推文字符串、用户和推文时间。接下来，我们在一个 tweepy“Cursor”对象上编写一个 for 循环。在“Cursor”对象中，我们传递“api.search”方法，为我们想要搜索的内容设置查询字符串，并设置“count”= 1000，这样我们就不会超过 twitter 的速率限制。在这里，我们将搜索关于“特斯拉 Cybertruck”的推文。我们还使用“item()”方法将“Cursor”对象转换为 iterable。</p><p id="c42f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了简化查询，我们可以删除转发，只包含英文推文。为了了解该请求返回的内容，我们还可以打印附加到每个列表的值:</p><pre class="lf lg lh li gt lt lu lv lw aw lx bi"><span id="7e95" class="ly lz it lu b gy ma mb l mc md">twitter_users = []<br/>tweet_time = []<br/>tweet_string = []<br/>for tweet in tweepy.Cursor(api.search,q='Tesla Cybertruck', count=1000).items(1000):<br/>            if (not tweet.retweeted) and ('RT @' not in tweet.text):<br/>                if tweet.lang == "en":<br/>                    twitter_users.append(tweet.user.name)<br/>                    tweet_time.append(tweet.created_at)<br/>                    tweet_string.append(tweet.text)<br/>                    print([tweet.user.name,tweet.created_at,tweet.text])</span></pre><figure class="lf lg lh li gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mf"><img src="../Images/01f5d6d0366ec51e6137b0a803dd2080.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HWbFDdeR1TgmhciSr_Icwg.png"/></div></div></figure><p id="a0f4" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了实现可重用性，我们可以把它打包成一个函数，把关键字作为输入。我们还可以将结果存储在数据帧中并返回值:</p><pre class="lf lg lh li gt lt lu lv lw aw lx bi"><span id="9658" class="ly lz it lu b gy ma mb l mc md">def get_related_tweets(key_word):</span><span id="04af" class="ly lz it lu b gy mg mb l mc md">twitter_users = []<br/>    tweet_time = []<br/>    tweet_string = [] <br/>    for tweet in tweepy.Cursor(api.search,q=key_word, count=1000).items(1000):<br/>            if (not tweet.retweeted) and ('RT @' not in tweet.text):<br/>                if tweet.lang == "en":<br/>                    twitter_users.append(tweet.user.name)<br/>                    tweet_time.append(tweet.created_at)<br/>                    tweet_string.append(tweet.text)<br/>                    print([tweet.user.name,tweet.created_at,tweet.text])<br/>    df = pd.DataFrame({'name':twitter_users, 'time': tweet_time, 'tweet': tweet_string})<br/>    <br/>    return df</span></pre><p id="f3a2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当我们用关键词“特斯拉 Cybertruck”调用函数时，我们得到:</p><pre class="lf lg lh li gt lt lu lv lw aw lx bi"><span id="cdbe" class="ly lz it lu b gy ma mb l mc md">get_related_tweets('Tesla Cybertruck')</span></pre><figure class="lf lg lh li gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mh"><img src="../Images/db176b986aa646d1cc28a95343abb599.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HIozHIbq0DQA06VVJQesog.png"/></div></div></figure><p id="65e9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了获得情感分数，我们需要导入一个名为 textblob 的 python 包。textblob 的文档可以在这里找到<a class="ae kf" href="https://textblob.readthedocs.io/en/dev/" rel="noopener ugc nofollow" target="_blank">。要安装 textblob，请打开命令行并键入:</a></p><pre class="lf lg lh li gt lt lu lv lw aw lx bi"><span id="28f6" class="ly lz it lu b gy ma mb l mc md">pip install textblob</span></pre><p id="9259" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下次导入 textblob:</p><pre class="lf lg lh li gt lt lu lv lw aw lx bi"><span id="e7e0" class="ly lz it lu b gy ma mb l mc md">from textblob import TextBlob</span></pre><p id="4a82" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们将使用极性得分作为积极或消极感觉的衡量标准。极性得分是一个从-1 到+1 的浮点数。</p><p id="9bf6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，如果我们定义一个 textblob 对象并传入句子“我爱特斯拉 Cybertruck ”,我们应该得到一个正值的极性得分:</p><pre class="lf lg lh li gt lt lu lv lw aw lx bi"><span id="9545" class="ly lz it lu b gy ma mb l mc md">sentiment_score = TextBlob(“I love the Tesla Cybertruck”).sentiment.polarity<br/>print("Sentiment Polarity Score:", sentiment_score)</span></pre><figure class="lf lg lh li gt ju gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/43703cb93427dca4d0ee5dd5f6bee937.png" data-original-src="https://miro.medium.com/v2/resize:fit:844/format:webp/1*LxxyLQEg7XDMq1ahD84MFg.png"/></div></figure><p id="2682" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们来看看关于“特斯拉赛博卡车”的推文的情绪极性得分:</p><pre class="lf lg lh li gt lt lu lv lw aw lx bi"><span id="3502" class="ly lz it lu b gy ma mb l mc md">df = get_related_tweets("Tesla Cybertruck")<br/>df['sentiment'] = df['tweet'].apply(lambda tweet: TextBlob(tweet).sentiment.polarity)<br/>print(df.head())</span></pre><figure class="lf lg lh li gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mj"><img src="../Images/d77c8007e638d8c31f6ad3487b419015.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KjpB-XbAe-kFgxRvsNUqnA.png"/></div></div></figure><p id="2bb0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们也可以计算积极和消极情绪的数量:</p><pre class="lf lg lh li gt lt lu lv lw aw lx bi"><span id="5518" class="ly lz it lu b gy ma mb l mc md">df_pos = df[df['sentiment'] &gt; 0.0]<br/>df_neg = df[df['sentiment'] &lt; 0.0]<br/>print("Number of Positive Tweets", len(df_pos))<br/>print("Number of Negative Tweets", len(df_neg))</span></pre><figure class="lf lg lh li gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mk"><img src="../Images/fa0e95cc5f9a8376cd84438cfe1153a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:430/format:webp/1*nNJAw7hHahOoOcFHFZiv-w.png"/></div></div></figure><p id="bfff" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">同样，对于代码重用，我们可以将其全部封装在一个函数中:</p><pre class="lf lg lh li gt lt lu lv lw aw lx bi"><span id="ae18" class="ly lz it lu b gy ma mb l mc md">def get_sentiment(key_word):<br/>    df = get_related_tweets(key_word)<br/>    df['sentiment'] = df['tweet'].apply(lambda tweet: TextBlob(tweet).sentiment.polarity)<br/>    df_pos = df[df['sentiment'] &gt; 0.0]<br/>    df_neg = df[df['sentiment'] &lt; 0.0]<br/>    print("Number of Positive Tweets about {}".format(key_word), len(df_pos))<br/>    print("Number of Negative Tweets about {}".format(key_word), len(df_neg))</span></pre><p id="fde8" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果我们用“Tesla Cybertruck”调用这个函数，我们得到:</p><pre class="lf lg lh li gt lt lu lv lw aw lx bi"><span id="cbb2" class="ly lz it lu b gy ma mb l mc md">get_sentiment(“Tesla Cybertruck”)</span></pre><figure class="lf lg lh li gt ju gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/ff702c72af6025f7285e968a8304832b.png" data-original-src="https://miro.medium.com/v2/resize:fit:754/format:webp/1*mJkfjLSJ7qVMxdqkzbf_Mg.png"/></div></figure><p id="1ad1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果我们能以编程方式可视化这些结果，那将会很方便。让我们导入 seaborn 和 matplotlib 并修改我们的 get _ 情操函数:</p><pre class="lf lg lh li gt lt lu lv lw aw lx bi"><span id="2109" class="ly lz it lu b gy ma mb l mc md">import seaborn as sns<br/>import matplotlib.pyplot as plt</span><span id="76a4" class="ly lz it lu b gy mg mb l mc md">def get_sentiment(key_word):<br/>    df = get_related_tweets(key_word)<br/>    df['sentiment'] = df['tweet'].apply(lambda tweet: TextBlob(tweet).sentiment.polarity)<br/>    df_pos = df[df['sentiment'] &gt; 0.0]<br/>    df_neg = df[df['sentiment'] &lt; 0.0]<br/>    print("Number of Positive Tweets about {}".format(key_word), len(df_pos))<br/>    print("Number of Negative Tweets about {}".format(key_word), len(df_neg))<br/>    sns.set()<br/>    labels = ['Postive', 'Negative']<br/>    heights = [len(df_pos), len(df_neg)]<br/>    plt.bar(labels, heights, color = 'navy')<br/>    plt.title(key_word)</span><span id="cbd7" class="ly lz it lu b gy mg mb l mc md">get_sentiment(“Tesla Cybertruck”)</span></pre><figure class="lf lg lh li gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mm"><img src="../Images/890008b46f6b325dea17acccf82bef63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oOFxjnD-Dl0x9XM3slA4TA.png"/></div></div></figure><p id="b171" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如你所见，关于特斯拉电动卡车的推文正面情绪多于负面情绪。收集几天的数据来观察情绪如何随时间变化会很有趣。也许我会把它留到以后的文章里。</p><p id="8c04" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">感谢您的阅读。这篇文章的代码可以在<a class="ae kf" href="https://github.com/spierre91/medium_code" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到。祝好运，机器学习快乐！</p></div></div>    
</body>
</html>