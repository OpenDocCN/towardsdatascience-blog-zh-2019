<html>
<head>
<title>Parents of Data Science Survey — R code — Data Moves Me</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">数据科学家长调查— R 代码—数据让我感动</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/parents-of-data-science-survey-r-code-data-moves-me-f2e191cf18e8?source=collection_archive---------31-----------------------#2019-07-15">https://towardsdatascience.com/parents-of-data-science-survey-r-code-data-moves-me-f2e191cf18e8?source=collection_archive---------31-----------------------#2019-07-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="f85b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">几周前，Kate Strachnyi 和我在社交媒体上发布了一项调查，试图在数据科学领域收集人口统计数据和父母的经历。可以在这里看到原调查问题:<a class="ae ko" href="http://survey.constantcontact.com/survey/a07egckvkz0jvyimhdl/a01tmjy3nwegt/questions" rel="noopener ugc nofollow" target="_blank">调查</a></p><p id="7c28" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">共有 332 名受访者。如果您曾经从 Survey Monkey 下载过. csv 格式的调查数据，您会发现您下载的是“宽”格式的数据。这意味着调查中每个潜在的<em class="kp">响应</em>都有一个指标变量。对于数据分析和创建图表，我们更喜欢“长”格式的数据。长格式是每个问题有一个单独的栏目。</p><p id="6315" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">下面是一个来自 Survey Monkey 的原始数据的. csv 图像(一小部分数据，我已经编辑了一些列名，但您已经明白了):</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi kq"><img src="../Images/d1bd3a336d70014401d2a925082a7824.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*orfnRqvW0WtYbrWYOVBShg.png"/></div></div></figure><p id="211f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">下图是我们想要的长格式，调查中的每个问题都有一栏:</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi lc"><img src="../Images/52fd3effec53eefdb76ad0aa7d7e067c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dbRMXNovffRwLt1CKEdyow.png"/></div></div></figure><p id="83a7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你想下载 wide 格式的数据来跟随 R 中的代码，你可以在这里加入我的电子邮件列表<a class="ae ko" href="https://datamovesme.com/2019/07/14/parents-of-data-science-survey-r-code/#mailing-list" rel="noopener ugc nofollow" target="_blank">，数据集将被发送到你的电子邮件地址。你可以随时退订。</a></p><p id="34d1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在将数据从宽数据改为长数据之前，我做的第一件事是更改宽数据集中的列。调查中的一些问题是“是/否”问题。这意味着在我的原始数据中，我有多个名为“是”或“否”的列。我需要清理这些问题，使列名更直观，这样我就知道每个回答与哪个问题相关，并且每个列名需要是唯一的。</p><p id="9ae8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">推荐文章:如果我们即将进入的代码不太清楚，但是你很想学习 R，这个 R 课程绝对不可思议:<a class="ae ko" href="https://datamovesme.com/2019/06/08/my-favorite-r-programming-course/" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><p id="c17f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">首先，我加载 tidyverse，读入我的数据，并检查数据集中的列名:</p><pre class="kr ks kt ku gt ld le lf lg aw lh bi"><span id="199c" class="li lj it le b gy lk ll l lm ln"><strong class="le iu">library</strong>(tidyverse)  ### specifically we'll be using dplyr and ggplot2<br/><strong class="le iu">library</strong>(plyr) ## for use of the revalue function<br/>theme_set(theme_bw()) ## setting the theme for graphs</span><span id="4e5d" class="li lj it le b gy lo ll l lm ln">## read in the data<br/>mods &lt;- read_csv("[your file path]/mods_data.csv")</span><span id="09b6" class="li lj it le b gy lo ll l lm ln">### checking out my column names<br/>names(mods)</span></pre><p id="2c1d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">接下来，我指定了一个名称来存储我将要创建的长数据集，我将其命名为“Long_mods”。然后，我将宽数据集传递给它，并通过管道(%&gt;%)将其传递给聚集函数。这个聚集函数是直观的。在这里，我收集了“男性”、“女性”和“非二进制”列，并创建了一个名为“性别”的新列。</p><pre class="kr ks kt ku gt ld le lf lg aw lh bi"><span id="5b63" class="li lj it le b gy lk ll l lm ln">###  Converting a single column from wide to long:<br/>Long_mods &lt;- mods %&gt;%  <br/>  gather(key = gender, value = "value", <br/>         Female, <br/>         Male, <br/>         non_binary, na.rm = TRUE) %&gt;%<br/>    select(-value)</span></pre><p id="2854" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你会注意到我有 na.rm = TRUE，这意味着当(例如)male = 1 时，我们保留它，但如果 male = na，因为这个人不是男性，它会被删除。这允许我们始终保持相同的行数。对于每个 gather 语句，都会创建一个名为“value”的新列。这将为我们所有的行设置为 1，因为我们删除了 na。</p><p id="dad6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">重塑数据可能需要大量的工作。为了演示，下面是将这个数据集(最初有 80 多列)转换为长格式的剩余代码。我必须收集每个问题的回答，为这个回答集合设置一个新的变量名，然后删除每个收集的“value”列。</p><p id="739a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">下面是重塑整个数据集的代码。如果你跟着做，你可以复制粘贴这个。一旦你运行它，你将得到如上图所示的“长”数据集:</p><pre class="kr ks kt ku gt ld le lf lg aw lh bi"><span id="7c97" class="li lj it le b gy lk ll l lm ln">Long_mods &lt;- mods %&gt;%  <br/>  gather(key = gender, value = "value", <br/>         Female, <br/>         Male, <br/>         non_binary, na.rm = TRUE) %&gt;%<br/>    <strong class="le iu">select</strong>(-value)  %&gt;% <br/>  gather(key = current_role, value = "value", <br/>         data_worker,<br/>         Manager,<br/>         pursing_work,<br/>         not_in_field, na.rm = TRUE) %&gt;%<br/>    <strong class="le iu">select</strong>(-value)  %&gt;% <br/>  gather(key = "kids_in_home", value = "value", <br/>         kids_in_home_Yes, <br/>         kids_in_home_No, <br/>         empty_nester, na.rm = TRUE) %&gt;%<br/>    <strong class="le iu">select</strong>(-value)  %&gt;% <br/>  gather( key = "years_in_field", value = "value", <br/>          less_2, <br/>          '2_5_years' ,<br/>          '6_10_years', <br/>          '11_15_years', <br/>          '16_years_more'<br/>           ,not_in_the_field, na.rm = TRUE) %&gt;%<br/>    <strong class="le iu">select</strong>(-value)  %&gt;% <br/>  gather(key = "age", value = "value", <br/>         '18_24yo', <br/>         '25_34yo', <br/>         '35_44yo', <br/>         '45_54yo', <br/>         '55_64yo' ,<br/>         prefer_no_answer, na.rm = TRUE) %&gt;%  <br/>    <strong class="le iu">select</strong>(-value)  %&gt;% <br/>  gather(key = "employment_type",  value = "value", <br/>         Employed_full_time, <br/>         Employed_part_time,<br/>         Self_employed ,                 <br/>         not_employed_not_looking,<br/>         Student,<br/>         Military , <br/>         Homemaker ,<br/>         prefer_not_to_answer_jobtype, na.rm = TRUE) %&gt;%  <br/>    <strong class="le iu">select</strong>(-value)  %&gt;% <br/>  gather(key = "salary",  value = "value",  <br/>         less29999 , <br/>         '30_59k', <br/>         '60-89k', <br/>         '90_119k' , <br/>         '120_159k' , <br/>         '160_plus', <br/>         wont_answer_salary, na.rm = TRUE) %&gt;%  <br/>    <strong class="le iu">select</strong>(-value)  %&gt;% <br/>  gather(key = "parental_leave_pay", value = "value", <br/>         full_paid, <br/>         not_paid, <br/>         partially_paid, <br/>         other_materity_leave, na.rm = TRUE) %&gt;%  <br/>    <strong class="le iu">select</strong>(-value)  %&gt;% <br/>  gather(key = "parental_leave_length",  value = "value", <br/>         no_leave, <br/>         less_2weeks ,<br/>         '3_5weeks', <br/>         '6_8weeks', <br/>         '9_12weeks', <br/>         '13_16weeks',<br/>         '17_weeks_6_months', <br/>         '6_month_plus', na.rm = TRUE) %&gt;%    <br/>    <strong class="le iu">select</strong>(-value)  %&gt;% <br/>  gather(key = "country", value = "value", <br/>         US , <br/>         Europe ,<br/>         Asia , <br/>         other_country , na.rm = TRUE) %&gt;%<br/>    <strong class="le iu">select</strong>(-value)  %&gt;% <br/>  gather(key = "wish_parental_leave_longer",  value = "value", <br/>         Yes_wish_longer , <br/>         No_wish_longer,<br/>         Not_sure_longer_leave, <br/>         Other_leave, na.rm = TRUE) %&gt;%<br/>    <strong class="le iu">select</strong>(-value)  %&gt;% <br/>  gather(key = "ever_declined_promotion",  value = "value", <br/>         Yes_declined_promotion , <br/>         No_declined_promotion, <br/>         Other_declined_promotion, na.rm = TRUE) %&gt;%<br/>    <strong class="le iu">select</strong>(-value)  %&gt;% <br/>  gather(key = "ever_declined_travel", value = "value",  <br/>         Yes_declined_trip_or_conference, <br/>         No_declined_trip_or_conference,<br/>         never_asked_trip_conference ,<br/>         Other_trip_conference , na.rm = TRUE) %&gt;%<br/>    <strong class="le iu">select</strong>(-value)  %&gt;% <br/>  gather(key = "voicing_needs_difficult", value = "value",  <br/>         Yes_voicing_needs_difficult,<br/>         No_voicing_needs_difficult ,<br/>         Other_voicing_needs_difficult , na.rm = TRUE) %&gt;%  <br/>    <strong class="le iu">select</strong>(-value)  %&gt;% <br/>  gather(key = "have_support", value = "value",  <br/>         Yes_network_help, <br/>         No_network_help, <br/>         Other_network_help , na.rm = TRUE) %&gt;%<br/>    <strong class="le iu">select</strong>(-value)  %&gt;% <br/>  gather(key = "equal_partnership", value = "value", <br/>         partner_handles_more ,<br/>         partner_handles_less,single, <br/>         equal_partnership , na.rm = TRUE) %&gt;%<br/>    <strong class="le iu">select</strong>(-value)  %&gt;% <br/>  gather(key = "treated_unfairly_at_work", value = "value", <br/>         Yes_unfairly_treated, <br/>         No_unfairly_treated , <br/>         Other_unfairly_treated, na.rm = TRUE) %&gt;%<br/>    <strong class="le iu">select</strong>(-value)  %&gt;% <br/>  gather(key = "changed_company_balance",  value = "value", <br/>         Yes_changed_companies,<br/>         No_changed_companies ,<br/>         Other_changed_companies, na.rm = TRUE) %&gt;%  <br/>    <strong class="le iu">select</strong>(-value)  %&gt;% <br/>  gather(key = "remote_work", value = "value",  <br/>         Fully_remote , <br/>         Partially_remote, <br/>         Fully_in_office,<br/>         client_location,<br/>         Other_workplace_arrangement , na.rm = TRUE) %&gt;%<br/>    <strong class="le iu">select</strong>(-value)  %&gt;%   <br/>      arrange(id)</span></pre><p id="918a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在我们有了长数据集，我们可以开始可视化数据了。以下是调查中其中一个问题的情节截图。因为我在上面设置了主题，所以情节看起来很干净。然后，我只需输入特定的十六进制代码，以匹配我在列中的品牌颜色。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="gh gi lp"><img src="../Images/21af11ae23c08b6077de5bbd2984c640.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dk6hC9h4wJ9P32K5n7rEVg.png"/></div></div></figure><p id="2908" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">从图表中我们可以看出，最流行的工作安排是全职呆在办公室。我希望这是因为他们真的喜欢呆在办公室里。</p><p id="1a63" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为了创建这个图，我创建了一个新的 tibble，它只包含我想在我的图中使用的数据。这是一个“工作安排”变量，我希望能够筛选出那些至少在工作周的一部分时间里有孩子在家的父母。虽然这是一项针对父母的调查，但也有一些受访者不是父母，或者在工作时间没有孩子在家。</p><pre class="kr ks kt ku gt ld le lf lg aw lh bi"><span id="5665" class="li lj it le b gy lk ll l lm ln">work_arrangement_tbl &lt;- Long_mods %&gt;% <br/>  ## <strong class="le iu">using</strong> only the relevant <strong class="le iu">variables</strong><br/>  select(remote_work, kids_in_home) %&gt;%<br/>  ## filtering for parents that have kids in the home during the work week.<br/>  filter(kids_in_home == "kids_in_home_Yes") %&gt;% <br/>  ## grouping by remote work for the calculation<br/>  group_by(remote_work) %&gt;%<br/>  ## getting the proportion of each category out of the total<br/>  dplyr::summarize(distribution = n()/nrow(Long_mods)) %&gt;%<br/>  ungroup()</span></pre><p id="8661" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我还想对这些因素进行重新编码，使它们更具美感。我想把“全职”改为“全职”。为此，我使用了 plyr 包中的重估函数:</p><pre class="kr ks kt ku gt ld le lf lg aw lh bi"><span id="a60e" class="li lj it le b gy lk ll l lm ln">work_arrangement_tbl$remote_work &lt;- <br/>  revalue(work_arrangement_tbl$remote_work, <br/>c("Fully_remote" = "Full-Time Remote", <br/>"Partially_remote" = "Partially Remote", <br/>"Fully_in_office" = "Full-Time in Office",<br/>"client_location" = "Client Location",<br/>"Other_workplace_arrangement" = "Other"))</span></pre><p id="c88c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在我们已经获得了创建图表所需的正确格式的数据，我们可以继续创建图表了。我对每一步都进行了注释，以描述我们的数据在每一步都发生了什么:</p><pre class="kr ks kt ku gt ld le lf lg aw lh bi"><span id="aee6" class="li lj it le b gy lk ll l lm ln">work_arrangement_plot &lt;- work_arrangement_tbl %&gt;%<br/>  ## changing remote work to be a factor <strong class="le iu">variable</strong> and ordering the proportions from largest to smallest<br/>  mutate(remote_work = remote_work %&gt;% as_factor() %&gt;% fct_reorder(desc(distribution))) %&gt;%<br/>  ggplot(aes(remote_work, distribution)) +<br/>  ## giving the columns the desired color<br/>  geom_col(fill = "#4F9C98") +<br/>  ## We want labels as a percent rather than a decimal<br/>  scale_y_continuous(labels=scales::percent)  +<br/>  ## I also wanted the labels above the columns<br/>  geom_text(aes(label = scales::percent(distribution)), <br/>            vjust = -1.5) +<br/>  ## Setting y-axis to go to 50% for aesthetics<br/>  expand_limits(y = 0.5) +<br/>  ## Creating labels and subtitles<br/>  labs(x = "Work Arrangement", y = "Distribution", title = "Distribution of Work Arrangement",<br/>       subtitle = "For Parents With Kids in the Home")</span></pre><p id="061a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后运行“work_arrangement_plot”对象，瞧！你得到了一个漂亮的工作安排变量图，上面有每个因素的分布百分比，各列按百分比从大到小排列。</p><p id="9b0b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我祝你在重塑数据和进行分析方面取得成功！</p><p id="890a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">推荐文章:如果你正在寻找进一步的 R 技能，你可以在这里阅读我最喜欢的 R 编程课程<a class="ae ko" href="https://datamovesme.com/2019/06/08/my-favorite-r-programming-course/" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="cf88" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">很快，我将为我用这些数据构建的闪亮应用程序撰写文章，并发布来自该数据集的见解和有趣的花絮。同时，你已经可以在我的网站<a class="ae ko" href="https://datamovesme.com/data4data-nerds/" rel="noopener ugc nofollow" target="_blank">上查看这个闪亮的应用了。</a></p></div><div class="ab cl lq lr hx ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="im in io ip iq"><p id="7727" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="kp">原载于 2019 年 7 月 15 日</em><a class="ae ko" href="https://datamovesme.com/2019/07/14/parents-of-data-science-survey-r-code/" rel="noopener ugc nofollow" target="_blank"><em class="kp">https://datamovesme.com</em></a><em class="kp">。</em></p></div></div>    
</body>
</html>