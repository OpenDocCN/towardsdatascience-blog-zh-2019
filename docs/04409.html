<html>
<head>
<title>QuickStart — Apache Kafka + Kafka-Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">快速入门— Apache Kafka + Kafka-Python</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/quickstart-apache-kafka-kafka-python-e8356bec94?source=collection_archive---------34-----------------------#2019-07-08">https://towardsdatascience.com/quickstart-apache-kafka-kafka-python-e8356bec94?source=collection_archive---------34-----------------------#2019-07-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="aa36" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">阿帕奇卡夫卡一天可以处理万亿个事件。</h2></div><h1 id="0e89" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">介绍</h1><p id="fd71" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">实时数据摄取是实时分析中的一个常见问题，因为在电子商务这样的平台中，给定时间内的活跃用户和每个活跃用户创建的事件数量都很多。因此，对每个事件或事件组的推荐(即，预测)预期是接近实时的。</p><p id="6836" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated">主要关心的是，我们将如何有效地[消费、生产和处理]这些事件？</p><p id="413f" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated">阿帕奇卡夫卡解决了上述前两个问题。它是一个分布式流平台，有助于构建实时流数据管道。</p><h1 id="6a78" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">Apache Kafka 设置</h1><p id="ef1d" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">本文讨论了在 Linux 环境中设置 Apache Kafka，并揭示了如何使用 Kafka-Python 消费和产生事件。下图说明了我们期望建立的 Kafka 生态系统。</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi lz"><img src="../Images/395455d2a2a88ac1f1fd7dc65176d180.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h_FSre-22-e4saBn9zWr1g.png"/></div></div><figcaption class="ml mm gj gh gi mn mo bd b be z dk">Kafka Ecosystem — Image by Author</figcaption></figure><h2 id="e809" class="mp kg iq bd kh mq mr dn kl ms mt dp kp lg mu mv kr lk mw mx kt lo my mz kv na bi translated">启动动物园管理员</h2><p id="fdbd" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">Apache Zookeeper 是一个分布式、开源的配置同步服务，为分布式应用程序提供了一个命名注册表。</p><p id="0659" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated">在 Kafka 的上下文中，Zookeeper 帮助维护服务器状态，并将配置作为键值对存储在 ZK 数据树中，并以分布式方式在集群中使用它们。</p><p id="6038" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated">最新版本的 Kafka 二进制发行版可以在 https://kafka.apache.org/downloads 的<a class="ae nb" href="https://kafka.apache.org/downloads" rel="noopener ugc nofollow" target="_blank">买到。</a></p><p id="3014" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated"><strong class="kz ir">转到卡夫卡根文件夹</strong></p><pre class="ma mb mc md gt nc nd ne nf aw ng bi"><span id="9f00" class="mp kg iq nd b gy nh ni l nj nk">cd /home/***/***_STREAM_PROCESSOR/kafka_2.12-2.0.0</span></pre><p id="bc04" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated"><strong class="kz ir">执行以下命令启动 Zookeeper </strong></p><pre class="ma mb mc md gt nc nd ne nf aw ng bi"><span id="171a" class="mp kg iq nd b gy nh ni l nj nk">bin/zookeeper-server-start.sh config/zookeeper.properties</span></pre><p id="2ffc" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated"><strong class="kz ir">如果一切都准确无误，控制台上会显示以下输出:</strong></p><p id="b926" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated">Zookeeper 默认运行在端口 2181 上</p><figure class="ma mb mc md gt me"><div class="bz fp l di"><div class="nl nm l"/></div></figure><h2 id="ec80" class="mp kg iq bd kh mq mr dn kl ms mt dp kp lg mu mv kr lk mw mx kt lo my mz kv na bi translated">开始 Kafka 经纪人</h2><p id="19ad" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">Kafka 集群由一个或多个经纪人组成，制作者将事件推入 Kafka 经纪人内的 Kafka 主题。</p><p id="1884" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated">部署 Kafka 代理有两种选择:</p><ul class=""><li id="6488" class="nn no iq kz b la lt ld lu lg np lk nq lo nr ls ns nt nu nv bi translated">部署在本地计算机上</li><li id="4b6a" class="nn no iq kz b la nw ld nx lg ny lk nz lo oa ls ns nt nu nv bi translated">在远程机器上进行部署，为此，请确保使用值 listeners = PLAINTEXT://XXX . XXX . XXX . XXX:9092 更新 server.properties(位于 Kafka config 中)</li></ul><p id="0ede" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated"><strong class="kz ir">在新的控制台中转到 Kafka 根目录，执行以下命令:</strong></p><pre class="ma mb mc md gt nc nd ne nf aw ng bi"><span id="42a6" class="mp kg iq nd b gy nh ni l nj nk">cd /home/***/***_STREAM_PROCESSOR/kafka_2.12-2.0.0</span><span id="c9d9" class="mp kg iq nd b gy ob ni l nj nk">bin/kafka-server-start.sh config/server.properties</span></pre><p id="b093" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated"><strong class="kz ir">如果一切都准确无误，控制台上会显示以下输出:</strong></p><figure class="ma mb mc md gt me"><div class="bz fp l di"><div class="nl nm l"/></div></figure><h2 id="8ed1" class="mp kg iq bd kh mq mr dn kl ms mt dp kp lg mu mv kr lk mw mx kt lo my mz kv na bi translated">创造卡夫卡主题</h2><p id="e05d" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">卡夫卡主题的生产者推动和消费者拉动事件。</p><p id="60af" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated"><strong class="kz ir">执行以下命令，在 Kafka Broker 中创建一个主题(例如，“input_recommend_product”)</strong></p><figure class="ma mb mc md gt me"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="c6f1" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated">因为我们已经建立了一个代理，所以我们只能保留主题的一个副本；因此，将复制因子设置为 1。</p><p id="56e7" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated">这里我们把题目:“输入 _ 推荐 _ 产品”分成三个分区；我们将分区设置为 3。</p><h2 id="861a" class="mp kg iq bd kh mq mr dn kl ms mt dp kp lg mu mv kr lk mw mx kt lo my mz kv na bi translated">使用 Kafka-python 创建生产者和消费者</h2><p id="05d0" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">Kafka-python 是 Apache Kafka 的 python 客户端。这有助于为 Kafka Broker 创建主题和产生事件，并作为 Kafka Broker 的主题使用这些事件。</p><p id="d894" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated">下面的代码段显示了如何创建一个生成器，并将消息推送到代理中的一个主题:</p><figure class="ma mb mc md gt me"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="9401" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated">可以使用 KafkaConsumer 提取推送的消息，下面的代码段有助于使用该消息:</p><figure class="ma mb mc md gt me"><div class="bz fp l di"><div class="nl nm l"/></div></figure><p id="5525" class="pw-post-body-paragraph kx ky iq kz b la lt jr lc ld lu ju lf lg lv li lj lk lw lm ln lo lx lq lr ls ij bi translated">消费者的输出如下所示:</p><figure class="ma mb mc md gt me"><div class="bz fp l di"><div class="nl nm l"/></div></figure><h2 id="16cf" class="mp kg iq bd kh mq mr dn kl ms mt dp kp lg mu mv kr lk mw mx kt lo my mz kv na bi translated">最后的想法</h2><p id="5211" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">Apache — Kafka 是构建实时处理解决方案的重要平台。本文为您在分布式环境中设置 Apache-Kafka 提供了一个良好的开端，并为生成和消费事件提供了简单的指导。</p></div></div>    
</body>
</html>