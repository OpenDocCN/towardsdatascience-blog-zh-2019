<html>
<head>
<title>The Complete Guide to Time Series Analysis and Forecasting</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">时间序列分析和预测完全指南</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/the-complete-guide-to-time-series-analysis-and-forecasting-70d476bfe775?source=collection_archive---------0-----------------------#2019-08-07">https://towardsdatascience.com/the-complete-guide-to-time-series-analysis-and-forecasting-70d476bfe775?source=collection_archive---------0-----------------------#2019-08-07</a></blockquote><div><div class="fc ij ik il im in"/><div class="io ip iq ir is"><div class=""/><div class=""><h2 id="6a2a" class="pw-subtitle-paragraph js iu iv bd b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj dk translated">理解移动平均，指数平滑，平稳性，自相关，SARIMA，并在两个项目中应用这些技术。</h2></div><figure class="kl km kn ko gt kp gh gi paragraph-image"><div class="gh gi kk"><img src="../Images/ab016c6cd7728caa5cdf3d3d021ffd55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1034/format:webp/1*9xhiP7nD8Ur2c3nrnApQkQ.jpeg"/></div></figure><p id="cc70" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">无论我们希望预测金融市场或电力消费的趋势，时间都是我们的模型中必须考虑的重要因素。例如，预测在一天中的什么时间将会出现用电高峰是令人感兴趣的，例如调整电力的价格或产量。</p><p id="e704" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">输入<strong class="ku iw">时间序列</strong>。时间序列就是按时间顺序排列的一系列数据点。在时间序列中，时间通常是独立变量，目标通常是对未来做出预测。</p><p id="4efa" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">然而，在处理时间序列时，还有其他方面的因素在起作用。</p><p id="cee9" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">难道是<strong class="ku iw">静止不动</strong>？</p><p id="7af6" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">有没有<strong class="ku iw">季节性</strong>？</p><p id="d40f" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">目标变量<strong class="ku iw">是否自相关</strong>？</p><p id="b84f" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">在这篇文章中，我将介绍时间序列的不同特征，以及我们如何对它们建模以获得准确的(尽可能多的)预测。</p><blockquote class="lo"><p id="0969" class="lp lq iv bd lr ls lt lu lv lw lx ln dk translated">在 Python 课程的<a class="ae ly" href="https://www.datasciencewithmarco.com/offers/tdU2mtVK" rel="noopener ugc nofollow" target="_blank">应用时间序列分析中，超越基础并应用高级模型，如 SARIMAX、VARMAX、CNN、LSTM、ResNet、自回归 LSTM！</a></p></blockquote><figure class="lz ma mb mc md kp"><div class="bz fp l di"><div class="me mf l"/></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk">Predicting the future is hard.</figcaption></figure><h1 id="ec87" class="mk ml iv bd mm mn mo mp mq mr ms mt mu kb mv kc mw ke mx kf my kh mz ki na nb bi translated">自相关</h1><p id="de02" class="pw-post-body-paragraph ks kt iv ku b kv nc jw kx ky nd jz la lb ne ld le lf nf lh li lj ng ll lm ln io bi translated">非正式地说，<strong class="ku iw">自相关</strong>是观测值之间的相似性，是它们之间的时滞的函数。</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="ni nj di nk bf nl"><div class="gh gi nh"><img src="../Images/9b6c6776d243c85395b5c70a39dda240.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F5wTJgw8dpteJssJVGXPcg.png"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk">Example of an autocorrelation plot</figcaption></figure><p id="bff5" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">上面是一个自相关图的例子。仔细观察，您会发现第一个值和第 24 个值具有很高的自相关性。同样，第 12 次和第 36 次观察高度相关。这意味着我们会在每 24 个时间单位找到一个非常相似的值。</p><p id="62e2" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">注意这个图看起来像正弦函数。这是对<strong class="ku iw">季节性、</strong>的暗示，你可以通过在上面的图中找到时间段来找到它的值，这将给出 24 小时。</p><h1 id="a99d" class="mk ml iv bd mm mn mo mp mq mr ms mt mu kb mv kc mw ke mx kf my kh mz ki na nb bi translated">季节性</h1><p id="43cc" class="pw-post-body-paragraph ks kt iv ku b kv nc jw kx ky nd jz la lb ne ld le lf nf lh li lj ng ll lm ln io bi translated"><strong class="ku iw">季节性</strong>指周期性波动。例如，用电量白天高，晚上低，或者圣诞节期间在线销售增加，然后再次放缓。</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="ni nj di nk bf nl"><div class="gh gi nh"><img src="../Images/cdacbd28468d1cb7865d2510753061d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*po-ZfwDPLCS5cIQBG_S-lA.png"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk">Example of seasonality</figcaption></figure><p id="d593" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">从上面可以看出，有明显的日季节性。每一天，你都会在傍晚看到一个高峰，而最低点则是每天的开始和结束。</p><p id="c5f2" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">请记住，如果自相关图呈正弦曲线形状，季节性也可以从自相关图中得出。简单地看周期，它给出了季节的长度。</p><h1 id="023f" class="mk ml iv bd mm mn mo mp mq mr ms mt mu kb mv kc mw ke mx kf my kh mz ki na nb bi translated">平稳性</h1><p id="81ee" class="pw-post-body-paragraph ks kt iv ku b kv nc jw kx ky nd jz la lb ne ld le lf nf lh li lj ng ll lm ln io bi translated"><strong class="ku iw">平稳性</strong>是时间序列的重要特征。如果一个时间序列的统计特性不随时间变化，则称该时间序列是平稳的。换句话说，它有<strong class="ku iw">常数均值和方差</strong>，协方差与时间无关。</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="ni nj di nk bf nl"><div class="gh gi nh"><img src="../Images/19efda3edac97a2952e981c53b3d4aae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xwMPhair-k-djWtULbEObQ.png"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk">Example of a stationary process</figcaption></figure><p id="0474" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">再看同样的图，我们看到上面的过程是静止的。平均值和方差不随时间变化。</p><p id="7438" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">通常，股票价格不是一个稳定的过程，因为我们可能会看到一个增长的趋势，或者它的波动性可能会随着时间的推移而增加(意味着方差在变化)。</p><p id="2c9b" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">理想情况下，我们希望有一个平稳的时间序列来建模。当然，并不是所有的都是静止的，但是我们可以做不同的变换使它们静止。</p><h1 id="d832" class="mk ml iv bd mm mn mo mp mq mr ms mt mu kb mv kc mw ke mx kf my kh mz ki na nb bi translated">如何测试一个过程是否是稳定的</h1><p id="409f" class="pw-post-body-paragraph ks kt iv ku b kv nc jw kx ky nd jz la lb ne ld le lf nf lh li lj ng ll lm ln io bi translated">你可能已经注意到了上述<em class="nm">的标题。</em>这是我们用来确定时间序列是否平稳的统计测试。</p><p id="c137" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">在不深入 Dickey-Fuller 检验的技术细节的情况下，它检验了单位根存在的零假设。</p><p id="a6f1" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">如果是，那么<em class="nm">p&gt;T7】0，过程不是静止的。</em></p><p id="4045" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">否则，<em class="nm"> p = </em> 0，零假设被拒绝，过程被认为是平稳的。</p><p id="94bc" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">例如，下面的过程不是静止的。请注意，平均值在整个时间内并不恒定。</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="ni nj di nk bf nl"><div class="gh gi nn"><img src="../Images/e348b67086104bd475ea08ccbd4c8b1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*glPAXrlIM2jqMRh-hbACnQ.png"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk">Example of a non-stationary process</figcaption></figure><h1 id="d854" class="mk ml iv bd mm mn mo mp mq mr ms mt mu kb mv kc mw ke mx kf my kh mz ki na nb bi translated">建模时间序列</h1><p id="610c" class="pw-post-body-paragraph ks kt iv ku b kv nc jw kx ky nd jz la lb ne ld le lf nf lh li lj ng ll lm ln io bi translated">为了进行预测，有许多方法可以对时间序列进行建模。在这里，我将介绍:</p><ul class=""><li id="fc9c" class="no np iv ku b kv kw ky kz lb nq lf nr lj ns ln nt nu nv nw bi translated">移动平均数</li><li id="bf0d" class="no np iv ku b kv nx ky ny lb nz lf oa lj ob ln nt nu nv nw bi translated">指数平滑法</li><li id="a967" class="no np iv ku b kv nx ky ny lb nz lf oa lj ob ln nt nu nv nw bi translated">ARIMA</li></ul><h1 id="31cb" class="mk ml iv bd mm mn mo mp mq mr ms mt mu kb mv kc mw ke mx kf my kh mz ki na nb bi translated">移动平均数</h1><p id="1e70" class="pw-post-body-paragraph ks kt iv ku b kv nc jw kx ky nd jz la lb ne ld le lf nf lh li lj ng ll lm ln io bi translated">移动平均模型可能是时间序列建模中最简单的方法。该模型简单地说明了下一个观察值是所有过去观察值的平均值。</p><p id="00fc" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">虽然简单，但这个模型可能会出奇的好，它代表了一个好的起点。</p><p id="12dd" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">否则，移动平均线可用于识别数据中有趣的趋势。我们可以定义一个<em class="nm">窗口</em>来应用移动平均模型<em class="nm">平滑</em>时间序列，并突出显示不同的趋势。</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="ni nj di nk bf nl"><div class="gh gi nh"><img src="../Images/a6ac571804570e2d973dcbdea1c08947.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Vbuys1TqjbgBD6zTwXX8pQ.png"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk">Example of a moving average on a 24h window</figcaption></figure><p id="a26b" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">在上图中，我们将移动平均模型应用于 24 小时窗口。绿线<em class="nm">平滑了</em>时间序列，我们可以看到 24 小时内有两个峰值。</p><p id="93f8" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">当然，窗口越长，趋势就越平稳。下面是一个小窗口的移动平均线的例子。</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="ni nj di nk bf nl"><div class="gh gi nh"><img src="../Images/095cba872d93a817f2650818e26bd80f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WZOyzZewXwKOhJBbN82kfg.png"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk">Example of a moving average on a 12h window</figcaption></figure><h1 id="af9e" class="mk ml iv bd mm mn mo mp mq mr ms mt mu kb mv kc mw ke mx kf my kh mz ki na nb bi translated">指数平滑法</h1><p id="a801" class="pw-post-body-paragraph ks kt iv ku b kv nc jw kx ky nd jz la lb ne ld le lf nf lh li lj ng ll lm ln io bi translated">指数平滑使用与移动平均类似的逻辑，但是这一次，不同的<em class="nm">递减权重</em>被分配给每个观察值。换句话说，随着我们离现在越来越远，观察的重要性就越来越小。</p><p id="956d" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">数学上，指数平滑表示为:</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="ni nj di nk bf nl"><div class="gh gi nh"><img src="../Images/64855a0ec9fb2592e066543cda596e94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d8UsN4g3URJAaaEzD-zyZA.png"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk">Exponential smoothing expression</figcaption></figure><p id="fb90" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">这里，<em class="nm"> alpha </em>是一个<strong class="ku iw">平滑因子</strong>，取值在 0 和 1 之间。它决定了先前观察的重量减少的速度。</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="ni nj di nk bf nl"><div class="gh gi nh"><img src="../Images/dc023cd7e9b0fb977bb2869248ddf9ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nJyUcWKFrkUTFo6NPnz7gA.png"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk">Example of exponential smoothing</figcaption></figure><p id="0dbb" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">从上面的图中，深蓝色线表示使用平滑因子 0.3 对时间序列进行指数平滑，而橙色线使用平滑因子 0.05。</p><p id="a67f" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">可以看到，平滑因子越小，时间序列就越平滑。这是有意义的，因为当平滑因子接近 0 时，我们就接近移动平均模型。</p><h1 id="4825" class="mk ml iv bd mm mn mo mp mq mr ms mt mu kb mv kc mw ke mx kf my kh mz ki na nb bi translated">双指数平滑</h1><p id="10a3" class="pw-post-body-paragraph ks kt iv ku b kv nc jw kx ky nd jz la lb ne ld le lf nf lh li lj ng ll lm ln io bi translated">当时间序列中存在趋势时，使用双指数平滑。在这种情况下，我们使用这种技术，它只是指数平滑的两次递归使用。</p><p id="e392" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">数学上:</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="ni nj di nk bf nl"><div class="gh gi nh"><img src="../Images/964de824732ac890c6c191ef421ffff3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ng9wsOnjHu8FAse6ba2mwg.png"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk">Double exponential smoothing expression</figcaption></figure><p id="a0ac" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">这里，<em class="nm"> beta </em>是<strong class="ku iw">趋势平滑因子</strong>，取 0 到 1 之间的值。</p><p id="d416" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">下面，你可以看到<em class="nm">α</em>和<em class="nm">β</em>的不同值如何影响时间序列的形状。</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="ni nj di nk bf nl"><div class="gh gi nh"><img src="../Images/5721b722f7cb9da1abf7b342a0dadccc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DukUfTnknV3HirlKJAkwWQ.png"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk">Example of double exponential smoothing</figcaption></figure><h1 id="649f" class="mk ml iv bd mm mn mo mp mq mr ms mt mu kb mv kc mw ke mx kf my kh mz ki na nb bi translated">三指数平滑</h1><p id="1e4b" class="pw-post-body-paragraph ks kt iv ku b kv nc jw kx ky nd jz la lb ne ld le lf nf lh li lj ng ll lm ln io bi translated">该方法通过添加一个<strong class="ku iw">季节性平滑因子</strong>，扩展了双指数平滑。当然，如果您注意到时间序列中的季节性，这是很有用的。</p><p id="ed87" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">数学上，三重指数平滑表示为:</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="ni nj di nk bf nl"><div class="gh gi nh"><img src="../Images/498413a310542d20041e0f1e9c671629.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*073NrrolK3xB-sP0gI4Hxw.png"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk">Triple exponential smoothing expression</figcaption></figure><p id="a50b" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">其中<em class="nm"> gamma </em>是季节平滑因子，而<em class="nm"> L </em>是季节长度。</p><h1 id="3981" class="mk ml iv bd mm mn mo mp mq mr ms mt mu kb mv kc mw ke mx kf my kh mz ki na nb bi translated">季节性自回归积分移动平均模型</h1><p id="3275" class="pw-post-body-paragraph ks kt iv ku b kv nc jw kx ky nd jz la lb ne ld le lf nf lh li lj ng ll lm ln io bi translated">SARIMA 实际上是简单模型的组合，以形成一个复杂的模型，该模型可以模拟具有非平稳属性和季节性的时间序列。</p><p id="78ef" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">首先，我们有<strong class="ku iw">自回归模型 AR(p) </strong>。这基本上是时间序列自身的回归。这里，我们假设当前值依赖于它以前的值，有一些滞后。它采用代表最大滞后的参数<strong class="ku iw"> p </strong>。为了找到它，我们查看部分自相关图，并确定大多数滞后不显著之后的滞后。</p><p id="5a24" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">在下面的示例中，<strong class="ku iw"> p </strong>将为 4。</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/9261860f0e68c45434fd9d3f3d229be2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1390/format:webp/1*IWaUD1V9xWPkQ0F7Pn9MEA.png"/></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk">Example of a partial autocorrelation plot</figcaption></figure><p id="96b1" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">然后，我们添加<strong class="ku iw">移动平均线模型 MA(q) </strong>。这需要一个参数<strong class="ku iw"> q </strong>，该参数代表最大滞后，在该最大滞后之后，其他滞后在自相关图上不显著。</p><p id="08c8" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">下面，<strong class="ku iw"> q </strong>会是 4。</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div class="gh gi od"><img src="../Images/ac0cf08f319a48f97d7719639c297595.png" data-original-src="https://miro.medium.com/v2/resize:fit:1382/format:webp/1*cbrBuVysbX1sB5-dVV-pzA.png"/></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk">Example of an autocorrelation plot</figcaption></figure><p id="b878" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">之后，我们加上<strong class="ku iw">的积分顺序</strong> <strong class="ku iw"> I(d) </strong>。参数<strong class="ku iw"> d </strong>代表使系列稳定所需的差值数量。</p><p id="3269" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">最后，我们添加最后一个组件:<strong class="ku iw">季节性 S(P，D，Q，s) </strong>，其中<strong class="ku iw"> s </strong>就是季节的长度。此外，该组件需要参数<strong class="ku iw"> P </strong>和<strong class="ku iw"> Q </strong>，它们与<strong class="ku iw"> p </strong>和<strong class="ku iw"> q </strong>相同，但用于季节性组件。最后，<strong class="ku iw"> D </strong>是季节积分的顺序，代表从序列中去除季节性所需的差异数。</p><p id="4e26" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">综合所有这些，我们得到了<strong class="ku iw"> SARIMA(p，D，q)(P，D，Q，s) </strong>模型。</p><p id="2158" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">主要要点是:在使用 SARIMA 建模之前，我们必须对时间序列进行转换，以消除季节性和任何非平稳行为。</p></div><div class="ab cl oe of hz og" role="separator"><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj"/></div><div class="io ip iq ir is"><p id="45c2" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">那是一大堆让我们难以理解的理论！让我们在第一个项目中应用上面讨论的技术。</p><p id="1553" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">我们会试着预测一家特定公司的股价。现在，预测股票价格几乎是不可能的。然而，这仍然是一个有趣的练习，也是练习我们所学知识的好方法。</p><h1 id="60af" class="mk ml iv bd mm mn mo mp mq mr ms mt mu kb mv kc mw ke mx kf my kh mz ki na nb bi translated">项目 1 —预测股票价格</h1><p id="880f" class="pw-post-body-paragraph ks kt iv ku b kv nc jw kx ky nd jz la lb ne ld le lf nf lh li lj ng ll lm ln io bi translated">我们将使用新德国基金(GF)的历史股价来尝试预测未来五个交易日的收盘价。</p><p id="3174" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">你可以在这里抓取数据集和笔记本<a class="ae ly" href="https://github.com/marcopeix/stock-prediction" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="ef4f" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">和往常一样，我强烈推荐你跟着编码！启动你的笔记本，我们走吧！</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="ol mf l"/></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk">You will definitely not get rich trying to predict the stock market</figcaption></figure><h2 id="ae8d" class="om ml iv bd mm on oo dn mq op oq dp mu lb or os mw lf ot ou my lj ov ow na ox bi translated">导入数据</h2><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="oy mf l"/></div></figure><p id="fc5f" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">首先，我们导入一些对我们的分析有帮助的库。此外，我们定义了<strong class="ku iw">平均百分比误差(MAPE) </strong>，因为这将是我们的误差度量。</p><p id="c448" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">然后，我们导入数据集，对前十个条目进行排序，您应该得到:</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="ni nj di nk bf nl"><div class="gh gi nh"><img src="../Images/10403d4d16d5dcc87449313208793669.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FZesiM1ijC72RWwfgAsAww.png"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk">First 10 entries of the dataset</figcaption></figure><p id="4e84" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">正如你所看到的，我们有几个条目是关于一只不同于新德国基金的股票。此外，我们有一个关于当天信息的条目，但我们只想要当天结束时(EOD)的信息。</p><h2 id="7426" class="om ml iv bd mm on oo dn mq op oq dp mu lb or os mw lf ot ou my lj ov ow na ox bi translated">清理数据</h2><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="oy mf l"/></div></figure><p id="7b51" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">首先，我们删除不需要的条目。</p><p id="c6df" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">然后，我们删除不需要的列，因为我们只想关注股票的收盘价。</p><p id="db73" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">如果预览数据集，您应该会看到:</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="ni nj di nk bf nl"><div class="gh gi oz"><img src="../Images/908c1aa5396eb923a738f3b0453dd4ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1114/format:webp/1*Mu4l0UJru3TKJC3-_kNdGA.png"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk">Clean dataset</figcaption></figure><p id="80a8" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">厉害！我们准备好进行探索性数据分析了！</p><h2 id="a5f9" class="om ml iv bd mm on oo dn mq op oq dp mu lb or os mw lf ot ou my lj ov ow na ox bi translated">探索性数据分析</h2><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="oy mf l"/></div></figure><p id="f043" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">我们绘制了数据集整个时间段的收盘价。</p><p id="a676" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">您应该得到:</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="ni nj di nk bf nl"><div class="gh gi nh"><img src="../Images/fcb1559a7805118273af47835c17633f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s23YtXsNJhJDoyN0KQsVSQ.png"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk">Closing price of the New Germany Fund (GF)</figcaption></figure><p id="2a0b" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">很明显，你看到这不是一个<strong class="ku iw">平稳的</strong>过程，很难判断是否存在某种<strong class="ku iw">季节性</strong>。</p><h2 id="03fd" class="om ml iv bd mm on oo dn mq op oq dp mu lb or os mw lf ot ou my lj ov ow na ox bi translated">移动平均数</h2><p id="8327" class="pw-post-body-paragraph ks kt iv ku b kv nc jw kx ky nd jz la lb ne ld le lf nf lh li lj ng ll lm ln io bi translated">让我们使用<strong class="ku iw">移动平均线</strong>模型来平滑我们的时间序列。为此，我们将使用一个助手函数，该函数将在指定的时间窗口运行移动平均模型，并绘制出结果平滑曲线:</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="oy mf l"/></div></figure><p id="1fe9" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">使用 5 天的时间窗，我们得到:</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="ni nj di nk bf nl"><div class="gh gi nh"><img src="../Images/62ebe1e572c87c042a2d1a9d5cd508d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q6Fx_nLnYCY4x9U6xwabdQ.png"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk">Smoothed curve by the previous trading week</figcaption></figure><p id="0583" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">如你所见，我们几乎看不到趋势，因为它太接近实际曲线了。让我们看看上个月和上个季度的平滑结果。</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="ni nj di nk bf nl"><div class="gh gi nh"><img src="../Images/1ea3044d107d896317821f10c5e91ccc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oT4Gy6eAM06Viem_abMvQw.png"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk">Smoothed by the previous month (30 days)</figcaption></figure><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="ni nj di nk bf nl"><div class="gh gi nh"><img src="../Images/6864cbe6155ae436565aba8988b6c98c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*naAfsqpOsRD8nPsFXAoUDQ.png"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk">Smoothed by the previous quarter (90 days)</figcaption></figure><p id="40da" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">现在趋势更容易发现了。注意 30 天和 90 天的趋势是如何在最后显示出下降曲线的。这可能意味着股票可能会在接下来的几天下跌。</p><h2 id="5d22" class="om ml iv bd mm on oo dn mq op oq dp mu lb or os mw lf ot ou my lj ov ow na ox bi translated">指数平滑法</h2><p id="c24a" class="pw-post-body-paragraph ks kt iv ku b kv nc jw kx ky nd jz la lb ne ld le lf nf lh li lj ng ll lm ln io bi translated">现在，让我们使用<strong class="ku iw">指数平滑</strong>来看看它是否能拾取一个更好的趋势。</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="oy mf l"/></div></figure><p id="2bc6" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">这里，我们使用 0.05 和 0.3 作为<strong class="ku iw">平滑因子</strong>的值。随意尝试其他值，看看结果如何。</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="ni nj di nk bf nl"><div class="gh gi nh"><img src="../Images/2db1cd7bf4537ff163e035f1517ce47e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bJTFvi1pJZ4HGF-0TGojtA.png"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk">Exponential smoothing</figcaption></figure><p id="821b" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">正如你所看到的，0.05 的<em class="nm"> alpha </em>值平滑了曲线，同时拾取了大部分向上和向下的趋势。</p><p id="d097" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">现在，让我们使用<strong class="ku iw">双指数平滑。</strong></p><h2 id="84a6" class="om ml iv bd mm on oo dn mq op oq dp mu lb or os mw lf ot ou my lj ov ow na ox bi translated">双指数平滑</h2><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="oy mf l"/></div></figure><p id="8727" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">你会得到:</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="ni nj di nk bf nl"><div class="gh gi nh"><img src="../Images/69a642564d0e0871a351b8d2c8bdc936.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KBSXI6EbzkPqcRlyFTRbLg.png"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk">Double exponential smoothing</figcaption></figure><p id="febb" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">同样，尝试不同的<em class="nm"> alpha </em>和<em class="nm"> beta </em>组合来获得更好看的曲线。</p><h2 id="2348" class="om ml iv bd mm on oo dn mq op oq dp mu lb or os mw lf ot ou my lj ov ow na ox bi translated">系统模型化</h2><p id="addd" class="pw-post-body-paragraph ks kt iv ku b kv nc jw kx ky nd jz la lb ne ld le lf nf lh li lj ng ll lm ln io bi translated">如前所述，我们必须把我们的系列变成一个平稳的过程，以便对它建模。因此，让我们应用 Dickey-Fuller 检验来看看它是否是一个平稳过程:</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="oy mf l"/></div></figure><p id="b81c" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">您应该看到:</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="ni nj di nk bf nl"><div class="gh gi nh"><img src="../Images/05eb6b8bc06c9bf462df270784379674.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4I4nZ-QxdEYfRIx5Iv4v_w.png"/></div></div></figure><p id="bf77" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">通过 Dickey-Fuller 检验，时间序列无疑是非平稳的。还有，看自相关图，看到很高，似乎没有明显的季节性。</p><p id="eb15" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">因此，为了去掉高自相关性，并使过程平稳，我们取第一个差(代码块中的第 23 行)。我们简单地从滞后一天的时间序列中减去时间序列，我们得到:</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="ni nj di nk bf nl"><div class="gh gi nh"><img src="../Images/2a40b7cb8dc6ea78b8b2041e49264f99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gTmbbay--JUKt6FaB-0K_w.png"/></div></div></figure><p id="abe4" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">厉害！我们的系列现在是固定的，我们可以开始建模！</p><h2 id="55cb" class="om ml iv bd mm on oo dn mq op oq dp mu lb or os mw lf ot ou my lj ov ow na ox bi translated">萨里玛</h2><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="oy mf l"/></div></figure><p id="fcba" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">现在，对于 SARIMA，我们首先定义一些参数和其他参数的值范围，以生成 P，Q，D，P，Q，D，s 的所有可能组合的列表。</p><p id="36ac" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">现在，在上面的代码单元中，我们有 625 种不同的组合！我们将尝试每种组合，并用每种组合来训练 SARIMA，以找到最佳表现模式。这可能需要一段时间，具体取决于您计算机的处理能力。</p><p id="8336" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">完成后，我们会打印出最佳模型的摘要，您应该会看到:</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="ni nj di nk bf nl"><div class="gh gi nh"><img src="../Images/38aa410f19624eaf867be44262464747.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ny5j0lszPneHuTW2kUdacA.png"/></div></div></figure><p id="87a2" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">厉害！我们最终预测未来五个交易日的收盘价，并评估模型的 MAPE。</p><p id="c83d" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">在这种情况下，我们有 0.79%的 MAPE，这非常好！</p><h2 id="a03b" class="om ml iv bd mm on oo dn mq op oq dp mu lb or os mw lf ot ou my lj ov ow na ox bi translated">将预测价格与实际数据进行比较</h2><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="oy mf l"/></div></figure><p id="b21c" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">现在，为了将我们的预测与实际数据进行比较，我们从<a class="ae ly" href="https://ca.finance.yahoo.com/" rel="noopener ugc nofollow" target="_blank">雅虎财经</a>获取财务数据，并创建一个数据框架。</p><p id="c88a" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">然后，我们画一个图，看看我们离实际收盘价有多远:</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="ni nj di nk bf nl"><div class="gh gi nh"><img src="../Images/4dd64ebc46ce42b1a1c8c6c924e944ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AzFnt7DH4fDumTtEO4V_jw.png"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk">Comparison of predicted and actual closing prices</figcaption></figure><p id="b723" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">看来我们的预测有点偏差。事实上，预测价格基本持平，这意味着我们的模型可能表现不佳。</p><p id="42a3" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">同样，这不是因为我们的程序，而是因为预测股票价格基本上是不可能的。</p></div><div class="ab cl oe of hz og" role="separator"><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj"/></div><div class="io ip iq ir is"><p id="3e95" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">从第一个项目中，我们学习了在使用 SARIMA 建模之前使时间序列平稳的整个过程。这是一个漫长而乏味的过程，需要大量的手工调整。</p><p id="b7e6" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">现在，让我们介绍脸书的先知。这是一个 Python 和 r 版本的预测工具。该工具允许专家和非专家以最少的努力做出高质量的预测。</p><p id="89e3" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">让我们看看如何在第二个项目中使用它！</p><h1 id="1804" class="mk ml iv bd mm mn mo mp mq mr ms mt mu kb mv kc mw ke mx kf my kh mz ki na nb bi translated">项目 2 —用 Prophet 预测空气质量</h1><p id="703d" class="pw-post-body-paragraph ks kt iv ku b kv nc jw kx ky nd jz la lb ne ld le lf nf lh li lj ng ll lm ln io bi translated">标题说明了一切:我们将使用 Prophet 来帮助我们预测空气质量！</p><p id="5f7e" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">完整的笔记本和数据集可在<a class="ae ly" href="https://github.com/marcopeix/air-quality" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="8cd1" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">我们来做一些预测吧！</p><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="oy mf l"/></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk">Prophecy cat!</figcaption></figure><h2 id="ccc4" class="om ml iv bd mm on oo dn mq op oq dp mu lb or os mw lf ot ou my lj ov ow na ox bi translated">导入数据</h2><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="oy mf l"/></div></figure><p id="b157" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">和往常一样，我们从导入一些有用的库开始。然后，我们打印出前五行:</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="ni nj di nk bf nl"><div class="gh gi nh"><img src="../Images/f8fee99b539dd5be38346be7ed40bd57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q3a4H_pnCkrOCSZGr9N59g.png"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk">First five entries of the dataset</figcaption></figure><p id="b7f6" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">如您所见，数据集包含不同气体浓度的信息。他们每天每小时都被记录下来。你可以在这里找到所有<a class="ae ly" href="https://www.kaggle.com/sayakchakraborty/air-quality-prediction-of-relative-humidity" rel="noopener ugc nofollow" target="_blank">特征的描述</a>。</p><p id="0705" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">如果您进一步研究数据集，您会注意到有很多值-200 的实例。当然，负浓度是没有意义的，所以我们需要在建模前清理数据。</p><p id="0c37" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">因此，我们需要清理数据。</p><h2 id="1b72" class="om ml iv bd mm on oo dn mq op oq dp mu lb or os mw lf ot ou my lj ov ow na ox bi translated">数据清理和特征工程</h2><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="oy mf l"/></div></figure><p id="b11e" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">这里，我们首先解析日期列，将其转换为“日期”。</p><p id="19c7" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">然后，我们将所有的测量值转换成浮点数。</p><p id="64b6" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">之后，我们通过取每个测量值的平均值来汇总每天的数据。</p><p id="4a1d" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">在这一点上，我们仍然有一些<em class="nm">南</em>我们需要摆脱。因此，我们删除超过 8 个<em class="nm"> NaN </em>的列。这样，我们就可以删除包含<em class="nm"> NaN </em>值的行，而不会丢失太多数据。</p><p id="1c26" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">最后，我们按周汇总数据，因为这将给出一个更平滑的趋势来分析。</p><p id="985d" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">我们可以画出每种化学物质的趋势。在这里，我们展示了氮氧化物。</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="ni nj di nk bf nl"><div class="gh gi pa"><img src="../Images/ca41f311107139e30aee80f8d8d5dbed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6SpVC1NLcvGGPgT_V4Nu5Q.png"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk">NOx concentration</figcaption></figure><p id="a725" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">氮氧化物是非常有害的，因为它们反应形成烟雾和酸雨，并且是细颗粒和地面臭氧形成的原因。这些对健康有不良影响，所以氮氧化物的浓度是空气质量的一个关键特征。</p><h2 id="9328" class="om ml iv bd mm on oo dn mq op oq dp mu lb or os mw lf ot ou my lj ov ow na ox bi translated">系统模型化</h2><figure class="kl km kn ko gt kp"><div class="bz fp l di"><div class="oy mf l"/></div></figure><p id="be96" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">我们将只关注 NOx 浓度的建模。因此，我们删除所有其他不相关的列。</p><p id="2414" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">然后，我们进口先知。</p><p id="6ba1" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">Prophet 要求将日期列命名为<em class="nm"> ds </em>，将特性列命名为<em class="nm"> y </em>，因此我们进行了适当的修改。</p><p id="750b" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">此时，我们的数据看起来像这样:</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div class="gh gi pb"><img src="../Images/18d2b344412f7ec72c101635c2c94edb.png" data-original-src="https://miro.medium.com/v2/resize:fit:724/format:webp/1*96z-iG65uENR9dbFUtbuCQ.png"/></div></figure><p id="a4e1" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">然后，我们定义一个训练集。为此，我们将拿出最后 30 个条目进行预测和验证。</p><p id="d273" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">之后，我们简单地初始化 Prophet，将模型与数据进行拟合，并进行预测！</p><p id="c590" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">您应该看到以下内容:</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="ni nj di nk bf nl"><div class="gh gi nh"><img src="../Images/36ec2353e358b87495b8a326b59f7e8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5ctLJOJ2BLAoGRWZbd0fNA.png"/></div></div></figure><p id="18b4" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">这里，<em class="nm"> yhat </em>代表预测，<em class="nm"> yhat_lower </em>和<em class="nm"> yhat_upper </em>分别代表预测的下限和上限。</p><p id="11d0" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">Prophet 允许您轻松绘制预测图，我们得到:</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="ni nj di nk bf nl"><div class="gh gi nh"><img src="../Images/83dc3a27b6069c158f67dd5e31f30b6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r6F3L0fG1VkH9zz5uZjT7w.png"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk">NOx concentration forecast</figcaption></figure><p id="c0e5" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">可以看到，Prophet 只是简单的用了一条直线向下的线来预测未来 NOx 的浓度。</p><p id="848d" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">然后，我们检查时间序列是否有任何有趣的特征，例如季节性:</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="ni nj di nk bf nl"><div class="gh gi nh"><img src="../Images/5287486123a39fc59cfd82fae99b6546.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y1v5XE6PT9_iSmR4DshDfA.png"/></div></div></figure><p id="2848" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">在这里，Prophet 只确定了一个没有季节性的下降趋势。</p><p id="91eb" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">通过计算其平均绝对百分比误差(MAPE)和平均绝对误差(MAE)来评估模型的性能，我们看到 MAPE 为 13.86%，MAE 为 109.32，还不算太差！请记住，我们根本没有微调模型。</p><p id="afd3" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">最后，我们绘制了预测的上限和下限:</p><figure class="kl km kn ko gt kp gh gi paragraph-image"><div role="button" tabindex="0" class="ni nj di nk bf nl"><div class="gh gi nh"><img src="../Images/97f2911f60f2b220011af3dcf2865509.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zhh1nfUmJyPfIskxcoiYvQ.png"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk">Forecast of the average weekly NOx concentration</figcaption></figure></div><div class="ab cl oe of hz og" role="separator"><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj"/></div><div class="io ip iq ir is"><p id="1721" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">恭喜你坚持到最后！这是一篇很长但内容丰富的文章。您学习了如何对时间序列进行稳健分析和建模，并在两个不同的项目中应用了您的知识。</p><p id="2e96" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">我希望这篇文章对你有用，我希望你能回头参考它。</p><p id="031d" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">要了解时间序列分析的最新技术，请查看本课程:</p><ul class=""><li id="f27a" class="no np iv ku b kv kw ky kz lb nq lf nr lj ns ln nt nu nv nw bi translated"><a class="ae ly" href="https://www.datasciencewithmarco.com/offers/tdU2mtVK" rel="noopener ugc nofollow" target="_blank">在 Python 中应用时间序列分析</a></li></ul><p id="35ab" class="pw-post-body-paragraph ks kt iv ku b kv kw jw kx ky kz jz la lb lc ld le lf lg lh li lj lk ll lm ln io bi translated">干杯！</p><blockquote class="pc pd pe"><p id="12ed" class="ks kt nm ku b kv kw jw kx ky kz jz la pf lc ld le pg lg lh li ph lk ll lm ln io bi translated">参考:非常感谢这篇<a class="ae ly" href="https://medium.com/open-machine-learning-course/open-machine-learning-course-topic-9-time-series-analysis-in-python-a270cb05e0b3" rel="noopener">文章</a>对时间序列分析的精彩介绍！</p></blockquote></div></div>    
</body>
</html>