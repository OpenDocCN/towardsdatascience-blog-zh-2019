<html>
<head>
<title>Data Cleaning with R and the Tidyverse: Detecting Missing Values</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 R 和 Tidyverse 清理数据:检测缺失值</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/data-cleaning-with-r-and-the-tidyverse-detecting-missing-values-ea23c519bc62?source=collection_archive---------0-----------------------#2019-03-21">https://towardsdatascience.com/data-cleaning-with-r-and-the-tidyverse-detecting-missing-values-ea23c519bc62?source=collection_archive---------0-----------------------#2019-03-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/69f7a539d531ca88fdfd440ec6a190b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*-jB0PVHrv1-XhKDP.jpg"/></div></div></figure><p id="955e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://www.dataoptimal.com/data-cleaning-with-r/" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir"/></a><strong class="ka ir">数据清洗是数据科学最重要的一个方面。</strong></p><p id="181d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">作为一名数据科学家，你可能会花费 80%的时间清理数据。</p><p id="4ea5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在之前的一篇文章中，我使用 Python 和 Pandas 库完成了许多<a class="ae kw" href="https://www.dataoptimal.com/data-cleaning-with-python-2018/" rel="noopener ugc nofollow" target="_blank">数据清理任务。</a></p><p id="e01c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这篇文章引起了如此多的关注，我想在 r。</p><p id="ee58" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这篇文章中，你将学习如何使用来自<a class="ae kw" href="https://www.tidyverse.org/" rel="noopener ugc nofollow" target="_blank"> Tidyverse </a>的<a class="ae kw" href="https://tidyr.tidyverse.org/" rel="noopener ugc nofollow" target="_blank"> tidyr </a>和<a class="ae kw" href="https://dplyr.tidyverse.org/" rel="noopener ugc nofollow" target="_blank"> dplyr </a>包来检测缺失值。</p><p id="dfc4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">Tidyverse 是数据科学的最佳 R 包集合，所以您应该熟悉它。</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi kx"><img src="../Images/be7e99aee66670d62dd28a6c44ddeced.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*YtEO_eItMVX5Hblk.jpg"/></div></div></figure><h1 id="939f" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">入门指南</h1><p id="dc87" class="pw-post-body-paragraph jy jz iq ka b kb ma kd ke kf mb kh ki kj mc kl km kn md kp kq kr me kt ku kv ij bi translated">开始任何<a class="ae kw" href="https://www.dataoptimal.com/data-science-projects-2018/" rel="noopener ugc nofollow" target="_blank">数据科学项目</a>的一个好方法就是感受数据。</p><p id="1ad4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这只是快速查看变量名和预期的变量类型。查看数据的维度也很有用。</p><p id="68fa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">探索性数据分析(EDA)极其重要，因此它值得拥有自己的博文。在本文中，我们不会讨论完整的 EDA。</p><p id="6831" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在我们开始之前，先去我们的 github 页面<a class="ae kw" href="https://github.com/dataoptimal/posts/tree/master/data%20cleaning%20with%20R%20and%20the%20tidyverse" rel="noopener ugc nofollow" target="_blank">获取一份数据。确保将副本放在 R 代码所在的工作目录中。</a></p><p id="fe0c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">下面快速浏览一下我们的数据:</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mf"><img src="../Images/d2d4bedeabe57e1c7127b80c5a4f9117.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*b3poZbwBaw4Iy_io.jpg"/></div></div></figure><p id="af66" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是一个小型的<a class="ae kw" href="https://en.wikipedia.org/wiki/Customer_attrition" rel="noopener ugc nofollow" target="_blank">客户流失</a>数据集。</p><p id="74a8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了便于学习，该数据集展示了一些丢失值的真实示例。</p><p id="1a76" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">首先，加载 tidverse 库并读入 csv 文件。</p><pre class="ky kz la lb gt mg mh mi mj aw mk bi"><span id="e7f9" class="ml ld iq mh b gy mm mn l mo mp">library(tidyverse)</span><span id="7164" class="ml ld iq mh b gy mq mn l mo mp"># set working directory<br/>path_loc &lt;- "C:/Users/Jonathan/Desktop/data cleaning with R post"<br/>setwd(path_loc)</span><span id="8221" class="ml ld iq mh b gy mq mn l mo mp"># reading in the data<br/>df &lt;- read_csv("telecom.csv")</span></pre><p id="8cf1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">通常数据被读入 dataframe，但是 tidyverse 实际上使用了<a class="ae kw" href="https://tibble.tidyverse.org/" rel="noopener ugc nofollow" target="_blank">tibles</a>。</p><p id="784b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这些类似于数据帧，但也略有不同。要了解更多关于 tibbles 的信息，请查看数据科学的<a class="ae kw" href="https://r4ds.had.co.nz/" rel="noopener ugc nofollow" target="_blank"> R 中的</a><a class="ae kw" href="https://r4ds.had.co.nz/tibbles.html" rel="noopener ugc nofollow" target="_blank">这一章</a>。</p><p id="40e0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我喜欢使用<code class="fe mr ms mt mh b">glimpse</code>函数来查看变量名和类型。</p><pre class="ky kz la lb gt mg mh mi mj aw mk bi"><span id="2f55" class="ml ld iq mh b gy mm mn l mo mp"># taking a quick look<br/>glimpse(df)</span><span id="f6bc" class="ml ld iq mh b gy mq mn l mo mp">&gt; glimpse(df)<br/>Observations: 10<br/>Variables: 5<br/>$ customerID     chr "7590-VHVEG", "5575-GNVDE", "3668-QPYBK", "7...<br/>$ MonthlyCharges dbl 29.85, 56.95, NA, 42.30, 70.70, NaN, 89.10, ...<br/>$ TotalCharges   chr "109.9", "na", "108.15", "1840.75", NA, "820...<br/>$ PaymentMethod  chr "Electronic check", "Mailed check", "--", "B...<br/>$ Churn          chr "yes", "yes", "yes", "no", "no", "yes", "no"...</span></pre><p id="bf6b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们可以看到有 5 个变量。</p><ul class=""><li id="f5af" class="mu mv iq ka b kb kc kf kg kj mw kn mx kr my kv mz na nb nc bi translated"><code class="fe mr ms mt mh b">customerID</code></li><li id="c42e" class="mu mv iq ka b kb nd kf ne kj nf kn ng kr nh kv mz na nb nc bi translated"><code class="fe mr ms mt mh b">MonthlyCharges</code></li><li id="585f" class="mu mv iq ka b kb nd kf ne kj nf kn ng kr nh kv mz na nb nc bi translated"><code class="fe mr ms mt mh b">TotalCharges</code></li><li id="b168" class="mu mv iq ka b kb nd kf ne kj nf kn ng kr nh kv mz na nb nc bi translated"><code class="fe mr ms mt mh b">PaymentMethod</code></li><li id="5a51" class="mu mv iq ka b kb nd kf ne kj nf kn ng kr nh kv mz na nb nc bi translated"><code class="fe mr ms mt mh b">Churn</code></li></ul><p id="8b52" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">还有对每个变量类型的描述:</p><ul class=""><li id="6527" class="mu mv iq ka b kb kc kf kg kj mw kn mx kr my kv mz na nb nc bi translated"><code class="fe mr ms mt mh b">customerID: chr</code>代表字符，字符串的别称</li><li id="2da4" class="mu mv iq ka b kb nd kf ne kj nf kn ng kr nh kv mz na nb nc bi translated"><code class="fe mr ms mt mh b">MonthlyCharges: dbl</code>代表 double，是一种数值类型</li><li id="a6e6" class="mu mv iq ka b kb nd kf ne kj nf kn ng kr nh kv mz na nb nc bi translated"><code class="fe mr ms mt mh b">TotalCharges: chr</code>性格</li><li id="5840" class="mu mv iq ka b kb nd kf ne kj nf kn ng kr nh kv mz na nb nc bi translated"><code class="fe mr ms mt mh b">PaymentMethod: chr</code>人物</li><li id="caaa" class="mu mv iq ka b kb nd kf ne kj nf kn ng kr nh kv mz na nb nc bi translated"><code class="fe mr ms mt mh b">Churn: chr</code>人物</li></ul><p id="c698" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">有 10 个观察值，这意味着有 10 行数据。</p><p id="25be" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们已经快速地熟悉了数据，让我们回顾一些基本的数据操作。</p><h1 id="0151" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">数据操作的语法:dplyr</h1><p id="2510" class="pw-post-body-paragraph jy jz iq ka b kb ma kd ke kf mb kh ki kj mc kl km kn md kp kq kr me kt ku kv ij bi translated">在我们开始处理缺失值之前，让我们先来看一下<a class="ae kw" href="https://dplyr.tidyverse.org/" rel="noopener ugc nofollow" target="_blank"> dplyr 库</a>。</p><p id="b03c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这只是一个快速介绍，所以请务必查看官方的<a class="ae kw" href="https://dplyr.tidyverse.org/reference/index.html" rel="noopener ugc nofollow" target="_blank"> dplyr 文档</a>以及来自数据科学的<a class="ae kw" href="https://r4ds.had.co.nz/" rel="noopener ugc nofollow" target="_blank"> R 的</a><a class="ae kw" href="https://r4ds.had.co.nz/transform.html" rel="noopener ugc nofollow" target="_blank">第 5 章数据转换</a>。</p><p id="7493" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这个库使用了“数据操作语法”,这基本上意味着有一组带有逻辑动词名称的函数来完成你想做的事情。</p><p id="87e8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">例如，也许您想只查看顾客。您可以过滤流失率值等于“是”的数据。</p><p id="9588" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们可以使用 dplyr 中的<code class="fe mr ms mt mh b">filter</code>函数快速完成这项工作。</p><pre class="ky kz la lb gt mg mh mi mj aw mk bi"><span id="c528" class="ml ld iq mh b gy mm mn l mo mp"># filter on customers that churned<br/>df %&gt;%<br/>  filter(Churn=="yes")<br/></span><span id="d02c" class="ml ld iq mh b gy mq mn l mo mp"># A tibble: 5 x 5<br/>  customerID MonthlyCharges TotalCharges PaymentMethod    Churn<br/>  chr                  dbl  chr          chr              chr<br/>1 7590-VHVEG           29.8 109.9        Electronic check yes<br/>2 5575-GNVDE           57.0 na           Mailed check     yes<br/>3 3668-QPYBK           NA   108.15       --               yes<br/>4 9305-CDSKC          NaN   820.5        --               yes<br/>5 6713-OKOMC           NA   N/A          NA               yes</span></pre><p id="1316" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">看一看，我们可以看到 R 返回了一个有组织的 tibble，其中只包含了客户。</p><p id="d7ec" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果你不熟悉<code class="fe mr ms mt mh b">%&gt;%</code>操作员，也被称为“管道操作员”，看看这篇<a class="ae kw" href="https://www.datacamp.com/community/tutorials/pipe-r-tutorial" rel="noopener ugc nofollow" target="_blank">的博文</a>。</p><p id="00eb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">管道是 magritter 包中的一个有用的操作符。它允许我们通过消除嵌套括号来组织我们的代码，从而使我们的代码更具可读性。</p><p id="1d06" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">例如，假设我们有以下计算:</p><pre class="ky kz la lb gt mg mh mi mj aw mk bi"><span id="b0c6" class="ml ld iq mh b gy mm mn l mo mp"># nested functions<br/>log(sin(exp(2)))<br/></span><span id="bbe1" class="ml ld iq mh b gy mq mn l mo mp">&gt; log(sin(exp(2)))<br/>[1] -0.1122118</span></pre><p id="d627" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">由于所有的括号，这不是很可读。现在让我们看一个管道示例。</p><pre class="ky kz la lb gt mg mh mi mj aw mk bi"><span id="9c22" class="ml ld iq mh b gy mm mn l mo mp"># piped functions<br/>2 %&gt;% exp() %&gt;%<br/>  sin() %&gt;%<br/>  log()</span></pre><p id="f993" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">显而易见，管道示例可读性更好。</p><p id="4aa2" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">好了，回到 dplyr。</p><p id="5de4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们只是使用了 filter 函数来快速过滤掉流失值等于“yes”的行。</p><p id="2689" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">也许我们也想只选择<code class="fe mr ms mt mh b">customerID</code>和<code class="fe mr ms mt mh b">TotalCharges</code>列。我们也可以使用<code class="fe mr ms mt mh b">select</code>功能快速完成这项工作。</p><pre class="ky kz la lb gt mg mh mi mj aw mk bi"><span id="0530" class="ml ld iq mh b gy mm mn l mo mp"># filter on customers that churned,<br/># select customerID and TotalCharges columns<br/>df %&gt;%<br/>  filter(Churn=="yes") %&gt;%<br/>  select(customerID, TotalCharges)<br/></span><span id="6dbe" class="ml ld iq mh b gy mq mn l mo mp"># A tibble: 5 x 2<br/>  customerID TotalCharges<br/>  chr        chr<br/>1 7590-VHVEG 109.9<br/>2 5575-GNVDE na<br/>3 3668-QPYBK 108.15<br/>4 9305-CDSKC 820.5<br/>5 6713-OKOMC N/A</span></pre><p id="0331" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们可以看到使用这些 dplyr 函数来操作我们的数据是多么容易。</p><p id="8c77" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">垂直地将函数链接在一起使得我们的代码非常易读。</p><p id="8cda" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这种编码方式一开始可能看起来有点奇怪，但是经过一点实践之后，它会变得非常有用。</p><h1 id="9adf" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">标准缺失值</h1><p id="3583" class="pw-post-body-paragraph jy jz iq ka b kb ma kd ke kf mb kh ki kj mc kl km kn md kp kq kr me kt ku kv ij bi translated">现在我们对管道操作符和 dplyr 稍微熟悉了一些，让我们开始检测丢失的值。</p><p id="5e6f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们将从 R 识别的标准缺失值开始。</p><p id="18c4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">去看看<code class="fe mr ms mt mh b">MonthlyCharges</code>栏吧。</p><p id="fb24" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们可以看到有三个值丢失了。</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ni"><img src="../Images/5467d70cfc0e68bc993aed59280e1b4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*75s1xJrkXToArWC3.jpg"/></div></div></figure><p id="b527" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">有两个空牢房，一个写着“南”。这些显然是缺失的价值观。</p><p id="78d1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们可以看到 R 如何使用<code class="fe mr ms mt mh b">is.na</code>函数来识别这些。</p><p id="3608" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">首先让我们打印出该列，然后应用<code class="fe mr ms mt mh b">is.na</code>。</p><pre class="ky kz la lb gt mg mh mi mj aw mk bi"><span id="1ce8" class="ml ld iq mh b gy mm mn l mo mp"># looking at MonthlyCharges<br/>df$MonthlyCharges<br/>is.na(df$MonthlyCharges)<br/></span><span id="915e" class="ml ld iq mh b gy mq mn l mo mp">&gt; df$MonthlyCharges<br/> [1]  29.85  56.95     NA  42.30  70.70    NaN  89.10     NA 104.80<br/>[10]  54.10<br/>&gt; is.na(df$MonthlyCharges)<br/> [1] FALSE FALSE  TRUE FALSE FALSE  TRUE FALSE  TRUE FALSE FALSE</span></pre><p id="4493" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们可以看到，两个缺失的单元格被识别为“NA”，另一个带有 NaN 的缺失值被 R 识别为“Nan”。</p><p id="97ae" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当我们运行<code class="fe mr ms mt mh b">is.na</code>函数时，R 识别两种类型的缺失值。我们可以看到这一点，因为当我们运行<code class="fe mr ms mt mh b">is.na</code>时，会返回三个<code class="fe mr ms mt mh b">TRUE</code>值。</p><p id="90c0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">注意“那”和“南”的区别是很重要的。我们可以使用帮助功能来仔细查看这两个值。</p><pre class="ky kz la lb gt mg mh mi mj aw mk bi"><span id="5b14" class="ml ld iq mh b gy mm mn l mo mp"># using the help function to learn about NA<br/>help(NA)</span></pre><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nj"><img src="../Images/5235bc36d2145c2aca66ad88adc7deee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*PKs2zSugqf1HgMlW.jpg"/></div></div></figure><p id="130c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">看一下右下方的窗口，我们可以看到“NA”或“不可用”用于表示缺失值。</p><p id="bc6c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">“NaN”或“非数字”用于数值计算。如果一个值是未定义的，比如 0/0，“NaN”是表示它的合适方式。</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nk"><img src="../Images/c2d5efc93f6f025048adc0a25eeb451a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*KQE7uuZpDXRrDX5a.jpg"/></div></div></figure><p id="fef4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">还有一个<code class="fe mr ms mt mh b">is.nan</code>功能。试着用“NA”和“NaN”来运行它。您将看到它为“NaN”返回 TRUE 值，但为“NA”返回 FALSE 值。</p><p id="c58d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">另一方面,<code class="fe mr ms mt mh b">is.na</code>函数更加通用，因此它将检测两种类型的缺失值。</p><p id="d2aa" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们继续使用 dplyr 来稍微总结一下我们的数据。</p><p id="deec" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们可以使用<code class="fe mr ms mt mh b">distinct</code>函数来查看显示在<code class="fe mr ms mt mh b">MonthlyCharges</code>列中的不同值。</p><pre class="ky kz la lb gt mg mh mi mj aw mk bi"><span id="a25f" class="ml ld iq mh b gy mm mn l mo mp"># looking at the distinct values<br/>df %&gt;%<br/>  distinct(MonthlyCharges)<br/></span><span id="4e6b" class="ml ld iq mh b gy mq mn l mo mp"># A tibble: 9 x 1<br/>  MonthlyCharges<br/>             dbl<br/>1           29.8<br/>2           57.0<br/>3           NA<br/>4           42.3<br/>5           70.7<br/>6          NaN<br/>7           89.1<br/>8          105.<br/>9           54.1</span></pre><p id="098e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们可以看到有 9 个不同的值。有 10 行数据，但是“NA”出现了两次，所以有 9 个不同的值。</p><p id="76be" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果我们想快速计算不同的值，我们可以使用<code class="fe mr ms mt mh b">summarise</code>函数。</p><pre class="ky kz la lb gt mg mh mi mj aw mk bi"><span id="0f00" class="ml ld iq mh b gy mm mn l mo mp"># counting unique values<br/>df %&gt;%<br/>  summarise(n = n_distinct(MonthlyCharges))<br/></span><span id="c5ed" class="ml ld iq mh b gy mq mn l mo mp"># A tibble: 1 x 1<br/>      n<br/>     int<br/>1     9</span></pre><p id="2f34" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这将返回一个简单的 tibble，其中有一列我们命名为“n ”,用于计算<code class="fe mr ms mt mh b">MonthlyCharges</code>列中不同值的数量。</p><p id="a6a7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们真正追求的是丢失值的计数。我们可以使用<code class="fe mr ms mt mh b">summarise</code>函数和<code class="fe mr ms mt mh b">is.na</code>来计算缺失值。</p><pre class="ky kz la lb gt mg mh mi mj aw mk bi"><span id="cbec" class="ml ld iq mh b gy mm mn l mo mp"># counting missing values<br/>df %&gt;%<br/>  summarise(count = sum(is.na(MonthlyCharges)))</span><span id="95e2" class="ml ld iq mh b gy mq mn l mo mp"># A tibble: 1 x 1<br/>  count<br/>     int<br/>1     3</span></pre><p id="b0f6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">正如我们在上面看到的，缺失值的数量是 3。</p><p id="44d8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">也许我们想同时做多件事。假设我们想要得到唯一值、缺失值以及<code class="fe mr ms mt mh b">MonthlyCharges</code>的中值的计数。</p><p id="fc8c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">下面是我们如何使用<code class="fe mr ms mt mh b">summarise</code>实现这一点:</p><pre class="ky kz la lb gt mg mh mi mj aw mk bi"><span id="c2af" class="ml ld iq mh b gy mm mn l mo mp"># counting unique, missing, and median values<br/>df %&gt;% summarise(n = n_distinct(MonthlyCharges),<br/>                 na = sum(is.na(MonthlyCharges)),<br/>                 med = median(MonthlyCharges, na.rm = TRUE))<br/></span><span id="d1eb" class="ml ld iq mh b gy mq mn l mo mp"># A tibble: 1 x 3<br/>      n    na   med<br/>     int   int  dbl<br/>1     9     3  57.0</span></pre><p id="e610" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这产生了我们的汇总数据的一个有组织的小 tibble。</p><p id="0907" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">既然我们已经确定了缺失值，让我们用<code class="fe mr ms mt mh b">MonthlyCharges</code>的中值来替换它们。为此，我们可以使用 dplyr 的<code class="fe mr ms mt mh b">mutate</code>函数。</p><pre class="ky kz la lb gt mg mh mi mj aw mk bi"><span id="7aa6" class="ml ld iq mh b gy mm mn l mo mp"># mutate missing values<br/>df %&gt;%<br/>  mutate(MonthlyCharges<br/>         = replace(MonthlyCharges,<br/>                   is.na(MonthlyCharges),<br/>                   median(MonthlyCharges, na.rm = TRUE)))<br/></span><span id="d9ea" class="ml ld iq mh b gy mq mn l mo mp"># A tibble: 10 x 5<br/>   customerID MonthlyCharges TotalCharges PaymentMethod    Churn<br/>    chr                 dbl  chr          chr              chr<br/> 1 7590-VHVEG           29.8 109.9        Electronic check yes<br/> 2 5575-GNVDE           57.0 na           Mailed check     yes<br/> 3 3668-QPYBK           57.0 108.15       --               yes<br/> 4 7795-CFOCW           42.3 1840.75      Bank transfer    no<br/> 5 9237-HQITU           70.7 NA           Electronic check no<br/> 6 9305-CDSKC           57.0 820.5        --               yes<br/> 7 1452-KIOVK           89.1 1949.4       Credit card      no<br/> 8 6713-OKOMC           57.0 N/A          NA               yes<br/> 9 7892-POOKP          105.  3046.05      Electronic check no<br/>10 8451-AJOMK           54.1 354.95       Electronic check no</span></pre><p id="23c3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们可以看到，在三个不同的点上，缺失值被替换为中值 57。</p><p id="701c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">只是为了再次检查这是否有效，让我们再次打印出整个 tibble。</p><pre class="ky kz la lb gt mg mh mi mj aw mk bi"><span id="4022" class="ml ld iq mh b gy mm mn l mo mp">df</span><span id="52cb" class="ml ld iq mh b gy mq mn l mo mp"># A tibble: 10 x 5<br/>   customerID MonthlyCharges TotalCharges PaymentMethod    Churn<br/>    chr                 dbl  chr          chr              chr <br/> 1 7590-VHVEG           29.8 109.9        Electronic check yes<br/> 2 5575-GNVDE           57.0 na           Mailed check     yes<br/> 3 3668-QPYBK           NA   108.15       --               yes<br/> 4 7795-CFOCW           42.3 1840.75      Bank transfer    no<br/> 5 9237-HQITU           70.7 NA           Electronic check no<br/> 6 9305-CDSKC          NaN   820.5        --               yes<br/> 7 1452-KIOVK           89.1 1949.4       Credit card      no<br/> 8 6713-OKOMC           NA   N/A          NA               yes<br/> 9 7892-POOKP          105.  3046.05      Electronic check no<br/>10 8451-AJOMK           54.1 354.95       Electronic check no</span></pre><p id="f1ba" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">看起来所有丢失的值都回来了。发生了什么事？</p><p id="6bf6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这引出了重要的一点。dplyr 包不会就地修改数据。</p><p id="fab4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">基本上，这意味着如果我们用一个管道操作符将一个<code class="fe mr ms mt mh b">mutate</code>应用于一些数据，它将向我们显示数据的一个修改视图，但这不是一个永久的修改。</p><p id="6a49" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了永久地修改数据，我们需要使用赋值操作符<code class="fe mr ms mt mh b">&lt;-</code>将 mutate 赋值给原始数据。</p><p id="616c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们会这样做:</p><pre class="ky kz la lb gt mg mh mi mj aw mk bi"><span id="e465" class="ml ld iq mh b gy mm mn l mo mp"># mutate missing values, and modify the dataframe<br/>df &lt;- df %&gt;%<br/>  mutate(MonthlyCharges = replace(MonthlyCharges,<br/>                                  is.na(MonthlyCharges),<br/>                                  median(MonthlyCharges, na.rm = TRUE)))</span></pre><p id="0aff" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，如果我们再看一下数据，它应该会被修改。</p><pre class="ky kz la lb gt mg mh mi mj aw mk bi"><span id="8b4a" class="ml ld iq mh b gy mm mn l mo mp">df<br/></span><span id="60fd" class="ml ld iq mh b gy mq mn l mo mp"># A tibble: 10 x 5<br/>   customerID MonthlyCharges TotalCharges PaymentMethod    Churn<br/>    chr                 dbl  chr          chr              chr<br/> 1 7590-VHVEG           29.8 109.9        Electronic check yes<br/> 2 5575-GNVDE           57.0 na           Mailed check     yes<br/> 3 3668-QPYBK           57.0 108.15       --               yes<br/> 4 7795-CFOCW           42.3 1840.75      Bank transfer    no<br/> 5 9237-HQITU           70.7 NA           Electronic check no<br/> 6 9305-CDSKC           57.0 820.5        --               yes<br/> 7 1452-KIOVK           89.1 1949.4       Credit card      no<br/> 8 6713-OKOMC           57.0 N/A          NA               yes<br/> 9 7892-POOKP          105.  3046.05      Electronic check no<br/>10 8451-AJOMK           54.1 354.95       Electronic check no</span></pre><p id="7b6a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这次<code class="fe mr ms mt mh b">MonthlyCharges</code>列被永久修改。请记住，当您想要使用 dplyr 永久地变更您的数据时，您需要将 mutate 分配给原始数据。</p><h1 id="1db7" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">非标准缺失值</h1><p id="e2da" class="pw-post-body-paragraph jy jz iq ka b kb ma kd ke kf mb kh ki kj mc kl km kn md kp kq kr me kt ku kv ij bi translated">很多时候，你不会幸运地拥有 R 能马上识别的所有标准缺失值类型。</p><p id="58e1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们快速浏览下一篇专栏文章<code class="fe mr ms mt mh b">TotalCharges</code>，了解我的意思。</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nl"><img src="../Images/04a620d7aa52e387247fd4b6e7e63418.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*IHTfxL8MSJFSFTlR.jpg"/></div></div></figure><p id="9c75" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们可以看到有三个不同的缺失值，“na”、“NA”和“N/A”。</p><p id="4e87" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在前面的例子中我们看到 R 将“na”识别为缺失值，但是“NA”和“N/A”呢？</p><p id="adbe" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们看看这个列，并使用<code class="fe mr ms mt mh b">is.na</code>来看看 R 是否将所有这些都识别为缺失值。</p><pre class="ky kz la lb gt mg mh mi mj aw mk bi"><span id="32ee" class="ml ld iq mh b gy mm mn l mo mp"># looking at missing values<br/>df$TotalCharges<br/>is.na(df$TotalCharges)<br/></span><span id="3d7f" class="ml ld iq mh b gy mq mn l mo mp">&gt; is.na(df$TotalCharges)<br/> [1] FALSE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE</span></pre><p id="3e80" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">查看结果，我们可以看到 R 只将“NA”标识为缺失值。</p><p id="2b00" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们使用<code class="fe mr ms mt mh b">summarise</code>函数来看看 R 找到了多少个丢失的值。</p><pre class="ky kz la lb gt mg mh mi mj aw mk bi"><span id="19c5" class="ml ld iq mh b gy mm mn l mo mp"># counting missing values<br/>df %&gt;%<br/>  summarise(count = sum(is.na(TotalCharges)))</span><span id="1d44" class="ml ld iq mh b gy mq mn l mo mp"># A tibble: 1 x 1<br/>  count<br/>     int<br/>1     1</span></pre><p id="6c08" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">结果证实 R 只找到一个丢失的值。</p><p id="f3a0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们需要用“na”替换“NA”和“N/A ”,以确保 R 将所有这些都识别为缺失值。</p><p id="4db9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们使用<code class="fe mr ms mt mh b">mutate</code>函数将这些替换为正确的缺失值类型。请记住，我们需要使用赋值操作符来确保更改是永久性的。</p><pre class="ky kz la lb gt mg mh mi mj aw mk bi"><span id="c402" class="ml ld iq mh b gy mm mn l mo mp"># replacing with standard missing value type, NA<br/>df &lt;- df %&gt;%<br/>  mutate(TotalCharges = replace(TotalCharges, TotalCharges == "na", NA)) %&gt;%<br/>  mutate(TotalCharges = replace(TotalCharges, TotalCharges == "N/A", NA))</span></pre><p id="ee1a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果我们再看一下这一列，我们可以看到所有缺失的值都被 r 正确地识别出来了。</p><pre class="ky kz la lb gt mg mh mi mj aw mk bi"><span id="028d" class="ml ld iq mh b gy mm mn l mo mp"># taking another look<br/>df$TotalCharges<br/>is.na(df$TotalCharges)</span><span id="35f9" class="ml ld iq mh b gy mq mn l mo mp">&gt; df$TotalCharges<br/> [1] "109.9"   NA        "108.15"  "1840.75" NA        "820.5"<br/> [7] "1949.4"  NA        "3046.05" "354.95"<br/>&gt; is.na(df$TotalCharges)<br/> [1] FALSE  TRUE FALSE FALSE  TRUE FALSE FALSE  TRUE FALSE FALSE</span></pre><p id="bade" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们可以看到 R 选择了所有三个丢失的值。</p><p id="1f59" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在我们替换丢失的值之前，还有另一个问题。</p><p id="13ff" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">r 认为列值是字符。我们可以用<code class="fe mr ms mt mh b">glimpse</code>函数来确认这一点。</p><pre class="ky kz la lb gt mg mh mi mj aw mk bi"><span id="1d27" class="ml ld iq mh b gy mm mn l mo mp">&gt; glimpse(df$TotalCharges)<br/> chr [1:10] "109.9" NA "108.15" "1840.75" NA "820.5" "1949.4" NA ...</span></pre><p id="4e95" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们把它们改成数字类型。</p><pre class="ky kz la lb gt mg mh mi mj aw mk bi"><span id="9fa2" class="ml ld iq mh b gy mm mn l mo mp"># changing to numeric type<br/>df$TotalCharges &lt;- as.numeric(df$TotalCharges)<br/>glimpse(df$TotalCharges)<br/></span><span id="71ef" class="ml ld iq mh b gy mq mn l mo mp">&gt; df$TotalCharges &lt;- as.numeric(df$TotalCharges) <br/>&gt; glimpse(df$TotalCharges)<br/> num [1:10] 110 NA 108 1841 NA ...</span></pre><p id="cfac" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，让我们用中间值替换缺失值。</p><pre class="ky kz la lb gt mg mh mi mj aw mk bi"><span id="bbbd" class="ml ld iq mh b gy mm mn l mo mp"># replace missing values with median<br/>df &lt;- df %&gt;%<br/>  mutate(TotalCharges = replace(TotalCharges,<br/>                                is.na(TotalCharges),<br/>                                median(TotalCharges, na.rm = T)))<br/>df$TotalCharges</span><span id="1158" class="ml ld iq mh b gy mq mn l mo mp">&gt; df$TotalCharges<br/> [1]  109.90  820.50  108.15 1840.75  820.50  820.50 1949.40  820.50<br/> [9] 3046.05  354.95</span></pre><p id="8205" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">更改所有缺失值的一个更简单的方法是在执行任何操作之前将列更改为 numeric。</p><p id="52c4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们再次导入数据，这样我们就又有丢失的值了。</p><pre class="ky kz la lb gt mg mh mi mj aw mk bi"><span id="6d33" class="ml ld iq mh b gy mm mn l mo mp"># importing the data again<br/>df &lt;- read_csv("telecom.csv")<br/>df$TotalCharges</span><span id="4e11" class="ml ld iq mh b gy mq mn l mo mp">&gt; df$TotalCharges<br/> [1] "109.9"   "na"      "108.15"  "1840.75" NA        "820.5"<br/> [7] "1949.4"  "N/A"     "3046.05" "354.95"</span></pre><p id="a2fb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在让我们试着将该列改为数字。</p><pre class="ky kz la lb gt mg mh mi mj aw mk bi"><span id="69f8" class="ml ld iq mh b gy mm mn l mo mp"># change TotalCharges to numeric type<br/>df$TotalCharges &lt;- as.numeric(df$TotalCharges)<br/>df$TotalCharges</span><span id="6a08" class="ml ld iq mh b gy mq mn l mo mp">&gt; df$TotalCharges &lt;- as.numeric(df$TotalCharges)<br/>Warning message:<br/>NAs introduced by coercion <br/>&gt; df$TotalCharges<br/> [1]  109.90      NA  108.15 1840.75      NA  820.50 1949.40      NA<br/> [9] 3046.05  354.95</span></pre><p id="a988" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这一次，所有不同的缺失值类型都被自动更改。</p><p id="c32b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">虽然这有点短，但我并不总是喜欢这种解决方案。</p><p id="37d8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这对于我们的特定示例是有效的，但是如果您试图检测异常或其他脏数据，这可能不是一个好的解决方案。</p><p id="46c3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">请务必阅读 R 控制台上类似这样的警告。它可以提供有价值的信息。</p><h1 id="e9bc" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">更多缺失值</h1><p id="e3e6" class="pw-post-body-paragraph jy jz iq ka b kb ma kd ke kf mb kh ki kj mc kl km kn md kp kq kr me kt ku kv ij bi translated">到目前为止，我们已经查看了像“NA”这样的标准缺失值和像“n/a”和“N/A”这样的非标准值。</p><p id="0a95" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">还有许多其他方法来表示丢失的数据。</p><p id="b98c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">也许我是手动输入数据，并选择使用“—”来表示缺少的值。</p><p id="2020" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">另一方面，也许你更喜欢将单元格留空。</p><p id="506d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们了解一下如何检测这些更不常见的缺失值类型。</p><p id="e410" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">看一看<code class="fe mr ms mt mh b">PaymentMethod</code>栏目:</p><figure class="ky kz la lb gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nm"><img src="../Images/5c2a2ea252a6d0c5fe7a3f8cc257d8fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*6Tbe9Utogq_aQT_V.jpg"/></div></div></figure><p id="350f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们可以看到有三个值丢失了。</p><p id="0eab" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">两个用“—”表示，一个只是一个空单元格。</p><p id="3663" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">看看 R 对这些怎么看:</p><pre class="ky kz la lb gt mg mh mi mj aw mk bi"><span id="9f85" class="ml ld iq mh b gy mm mn l mo mp"># looking at PaymentMethod<br/>df$PaymentMethod<br/>is.na(df$PaymentMethod)<br/></span><span id="20be" class="ml ld iq mh b gy mq mn l mo mp">&gt; is.na(df$PaymentMethod)<br/> [1] FALSE FALSE FALSE FALSE FALSE FALSE FALSE  TRUE FALSE FALSE</span></pre><p id="5c9a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">r 只是为了识别一个丢失的值，即空单元格。</p><p id="d557" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们继续使用 mutate 将“—”改为 NA。</p><pre class="ky kz la lb gt mg mh mi mj aw mk bi"><span id="c104" class="ml ld iq mh b gy mm mn l mo mp"># replacing "--" with NA<br/>df &lt;- df %&gt;%<br/>  mutate(PaymentMethod = replace(PaymentMethod, PaymentMethod ==  "--", NA))<br/>is.na(df$PaymentMethod)<br/>df$PaymentMethod</span><span id="0ecd" class="ml ld iq mh b gy mq mn l mo mp">&gt; df$PaymentMethod<br/> [1] "Electronic check" "Mailed check"     NA<br/> [4] "Bank transfer"    "Electronic check" NA<br/> [7] "Credit card"      NA                 "Electronic check"<br/>[10] "Electronic check"</span></pre><p id="6891" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们可以看到所有三个缺失的值都显示出来了。</p><p id="2fc6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">到目前为止，我们要么不考虑缺失值，要么用中间值代替它们。</p><p id="914c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如何处理字符类型列中的缺失值？</p><p id="d2a8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">因为<code class="fe mr ms mt mh b">PaymentMethod</code>列中的所有条目都是字符串，所以没有中间值。</p><p id="35bf" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们将 NAs 转换为一个新的类别，称为“不可用”，而不仅仅是排除丢失的值。</p><pre class="ky kz la lb gt mg mh mi mj aw mk bi"><span id="0741" class="ml ld iq mh b gy mm mn l mo mp"># replace NA with "unavailable"<br/>df &lt;- df %&gt;%<br/>  mutate(PaymentMethod = replace(PaymentMethod, is.na(PaymentMethod), "unavailable"))</span><span id="0426" class="ml ld iq mh b gy mq mn l mo mp">df$PaymentMethod</span><span id="efc5" class="ml ld iq mh b gy mq mn l mo mp">&gt; df$PaymentMethod<br/> [1] "Electronic check" "Mailed check"     "unavailable"     <br/> [4] "Bank transfer"    "Electronic check" "unavailable"     <br/> [7] "Credit card"      "unavailable"      "Electronic check"<br/>[10] "Electronic check"</span></pre><p id="0a8e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在我们可以看到，我们的三个缺失值 NA 已经被转换为一个新的类别“不可用”。</p><p id="a99c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">有时值丢失是有原因的，所以保留这些信息以查看它如何影响我们的机器学习模型中的结果是很好的。</p><p id="4a6e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们不会在这篇文章中讨论这些细节，但是请记住，丢弃丢失的值可能并不总是一个好主意。</p><h1 id="03a0" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">结论</h1><p id="e396" class="pw-post-body-paragraph jy jz iq ka b kb ma kd ke kf mb kh ki kj mc kl km kn md kp kq kr me kt ku kv ij bi translated">在这篇文章中，我们了解了数据科学中最重要的技能之一<a class="ae kw" href="https://www.dataoptimal.com/data-cleaning-with-r/" rel="noopener ugc nofollow" target="_blank">数据清理</a>。</p><p id="c8e0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">具体来说，我们着眼于检测不同类型的缺失值。</p><p id="01a1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们还学习了如何替换数字和字符类型的缺失值。</p><p id="ba7c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可能会花费高达 80%的时间来清理数据，因此这是一项非常有价值的技能。</p><p id="bd6d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">有关使用 Python 清理数据和检测缺失值的信息，请查看<a class="ae kw" href="https://www.dataoptimal.com/data-cleaning-with-python-2018/" rel="noopener ugc nofollow" target="_blank">这篇文章</a>。</p></div></div>    
</body>
</html>