<html>
<head>
<title>My Portable Ubuntu 18 Deep Learning Setup</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我的便携式 Ubuntu 18 深度学习设置</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/my-portable-ubuntu-18-deep-learning-setup-66151fe78da9?source=collection_archive---------18-----------------------#2019-02-10">https://towardsdatascience.com/my-portable-ubuntu-18-deep-learning-setup-66151fe78da9?source=collection_archive---------18-----------------------#2019-02-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><h1 id="c526" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated"><strong class="ak">简介</strong></h1><p id="44c2" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">从我去年的早期文章<a class="ae lj" rel="noopener" target="_blank" href="/tensorflow-jupyter-notebook-nvidia-diy-setup-473acfe5b0e"/>开始，重点是在家里拥有一个 DIY 服务器，这是更新的指南，将更加关注使用游戏笔记本电脑的便携式深度学习。</p><h1 id="1f17" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">动机</h1><p id="f65f" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">我希望有一个便携式深度学习硬件，在加载到云或 DIY 服务器之前，我可以随身携带进行实验。</p><h1 id="9278" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">笔记本电脑规格</h1><p id="e2c9" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">我的笔记本电脑是<a class="ae lj" href="https://www.acer.com/ac/en/US/content/predator-helios300-series" rel="noopener ugc nofollow" target="_blank">宏碁 Predator Helios 300 </a></p><h1 id="2bde" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">安装和设置</h1><p id="3c16" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><strong class="kn ir"> Ubuntu 18.x 安装<br/> </strong> -从<a class="ae lj" href="https://www.ubuntu.com/download/desktop" rel="noopener ugc nofollow" target="_blank">官方网站</a>获取最新的 Ubuntu 18.04.1，我得到的是最新的 LTS 版本，而不是 18.10 <br/> -到目前为止，在宏碁 Predator Helios 300 上安装没有问题，一切正常，但记得在 BIOS 中禁用安全引导。迄今为止 UEFI 工作正常。<br/> -最后从软件&amp;更新的附加驱动程序下安装 NVIDIA 二进制驱动程序。</p><p id="c827" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated"><strong class="kn ir"> MicroK8s (Kubernetes)安装</strong><br/>——只需遵循 microk8s <br/>的官方<a class="ae lj" href="https://microk8s.io/docs/" rel="noopener ugc nofollow" target="_blank">安装指南</a>——我们可以通过以下命令打开 gpu 和注册表</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="3e6d" class="ly jo iq lu b gy lz ma l mb mc">microk8s.enable gpu dns dashboard registry</span></pre><p id="f31f" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">gpu 将与笔记本电脑 Nvidia 一起开箱即用，注册表是将在本地运行的 docker 注册表<br/> -请注意，我们只为 kubectl 创建别名，而不是 docker one，因为 docker kubernetes 不能很好地工作，需要在 kubernetes 部署环境中运行<br/> -最后，请参考<a class="ae lj" href="https://github.com/kubernetes/dashboard/wiki/Creating-sample-user" rel="noopener ugc nofollow" target="_blank">kubernetes wiki</a>来创建一些样本用户，因为我们需要用户令牌来稍后登录仪表板</p><p id="3089" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated"><strong class="kn ir"> Docker 安装</strong> <br/>比使用 kubernetes docker <br/>更容易官方使用 Docker-从<a class="ae lj" href="https://docs.docker.com/install/linux/docker-ce/ubuntu/" rel="noopener ugc nofollow" target="_blank">官方指南</a> <br/>安装 Docker-从<a class="ae lj" href="https://docs.docker.com/compose/install/" rel="noopener ugc nofollow" target="_blank">官方指南</a> <br/>安装 nvidia-docker2 从<a class="ae lj" href="https://github.com/nvidia/nvidia-docker/wiki/Installation-(version-2.0)" rel="noopener ugc nofollow" target="_blank">官方指南</a></p><p id="9164" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">一旦安装了 microk8s 和 docker，我们就可以重启笔记本电脑并使用 Nvidia prime (NVIDIA X 服务器设置)禁用 GPU</p><p id="41db" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">它将重新启动，这将为我们提供一个半 nvidia 加载驱动程序环境，我们可以充分利用 GPU 内存，而 X Windows 不会使用它。如果我们选择 Nvidia SMI 作为属性提供商，我们可以使用一些有趣的工具，如<br/> <a class="ae lj" href="https://extensions.gnome.org/extension/1320/nvidia-gpu-stats-tool/" rel="noopener ugc nofollow" target="_blank"> NVIDIA GPU 统计工具</a></p><figure class="lp lq lr ls gt me gh gi paragraph-image"><div class="gh gi md"><img src="../Images/30b46bed7a29f183490ba893f0bfcfeb.png" data-original-src="https://miro.medium.com/v2/resize:fit:558/format:webp/1*criWqlX6r68h-EHuRK3R0A.png"/></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk">Noticed close to 0% memory</figcaption></figure><p id="1298" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">nvidia-smi 命令也可以工作</p><figure class="lp lq lr ls gt me gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi ml"><img src="../Images/5659d0c661856f9f8ac4a1da374ecb43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YBQ62V9Gd80sAKa9EK3n-A.png"/></div></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk">nvidia-smi command still work even we disable the driver</figcaption></figure><p id="61a4" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated"><strong class="kn ir">Tensorflow + Jupyter(Docker-local)<br/></strong>借助 Docker，我们可以轻松部署 tensor flow+Jupyter 设置</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="276e" class="ly jo iq lu b gy lz ma l mb mc">docker run -it — rm — runtime=nvidia -p 8888:8888 tensorflow/tensorflow:latest-gpu-py3</span></pre><figure class="lp lq lr ls gt me gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi mq"><img src="../Images/196e17f7c28f4938f1276ffa62d5fce6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iwoWNO0Uf9R_-pj6HfaGzA.png"/></div></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk">Note down the token to login later</figcaption></figure><figure class="lp lq lr ls gt me gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi mr"><img src="../Images/7b6af2d4587264a2132e03cf9c5758e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ds3q-7YlW7rwKRMqS_IxsQ.png"/></div></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk">The url will be <a class="ae lj" href="http://localhost:8888" rel="noopener ugc nofollow" target="_blank">http://localhost:8888</a></figcaption></figure><p id="9cdc" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated"><strong class="kn ir">tensor flow+Jupyter(Kubernetes)<br/></strong>要在 Kubernetes 中运行相同的图像，请执行以下命令</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="f1f5" class="ly jo iq lu b gy lz ma l mb mc">microk8s.kubectl run — generator=run-pod/v1 tensorflow — image=tensorflow/tensorflow:latest-gpu-py3</span></pre><p id="fb37" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">要获得 dashboard 的 kubernetes 令牌，请查找关键字令牌</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="e72a" class="ly jo iq lu b gy lz ma l mb mc">kubectl -n kube-system describe secret $(kubectl -n kube-system get secret | grep admin-user | awk ‘{print $1}’)</span></pre><figure class="lp lq lr ls gt me gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi ms"><img src="../Images/a7e6fc59d773f9f23a230b3e6dce160b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_LjTCCRHYtrUKfRYVm1QxQ.png"/></div></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk">Retrieve the token to login later</figcaption></figure><p id="eb5b" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">那我们需要跑</p><pre class="lp lq lr ls gt lt lu lv lw aw lx bi"><span id="7e76" class="ly jo iq lu b gy lz ma l mb mc">kubectrl proxy</span></pre><p id="ec1f" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">使用<a class="ae lj" href="http://localhost:8001/api/v1/namespaces/kube-system/services/https:kubernetes-dashboard:/proxy/" rel="noopener ugc nofollow" target="_blank">本地主机 url </a>显示管理面板</p><figure class="lp lq lr ls gt me gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi mt"><img src="../Images/39b1c7aef05252c3cdcaa993f99cb3d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RcjDY52WDpyb_PrPjI_CCA.png"/></div></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk">Note IP in the tensorflow pod, this will be use to access the jupyter from browser</figcaption></figure><figure class="lp lq lr ls gt me gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi mu"><img src="../Images/0e40c11ed66ec8886e755565cd087db2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U9U6BT16qpddwCndwynScQ.png"/></div></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk">Then click on Logs to look for jupyter login token</figcaption></figure><p id="791c" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">一旦我们有了 IP 和令牌，我们就可以使用浏览器访问 jupyter。</p><h1 id="ede0" class="jn jo iq bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">结论</h1><p id="d50e" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">像 docker 这样的容器技术甚至在 kubernetes 中也提供了很好的工作流，我们可以在本地进行实验，特别是在游戏笔记本电脑/台式机上，然后再部署到云中。我们也不需要担心安装 CUDA 库，只需要在 Ubuntu 上使用官方的 Nvidia 驱动程序。</p><figure class="lp lq lr ls gt me gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi mv"><img src="../Images/be8367e66b0580e4c932efd1dc796807.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YFPTnn0ywuqt5SOG8GcDSQ.png"/></div></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk">Example runtime output with docker container that allow close to 100% GPU memory utilization</figcaption></figure><figure class="lp lq lr ls gt me gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/e9c5516e63f3767cc1cedad8fb24c8ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:604/format:webp/1*TyQKoLlvrirLmtLzsf3CKQ.png"/></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk">we could easily monitor the stats from here while running tensorflow</figcaption></figure><p id="6ae5" class="pw-post-body-paragraph kl km iq kn b ko lk kq kr ks ll ku kv kw lm ky kz la ln lc ld le lo lg lh li ij bi translated">这种设置的唯一缺点是电池寿命！因为我们有半激活的 nvidia 驱动环境。</p></div></div>    
</body>
</html>