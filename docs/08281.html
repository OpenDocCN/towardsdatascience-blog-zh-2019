<html>
<head>
<title>How to engineer Bayesian ratio features?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何工程贝叶斯比率特征？</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-engineer-bayesian-ratio-features-548b9862446b?source=collection_archive---------32-----------------------#2019-11-11">https://towardsdatascience.com/how-to-engineer-bayesian-ratio-features-548b9862446b?source=collection_archive---------32-----------------------#2019-11-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="28bb" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">这样我们的机器学习模型就可以区分 1 / 2 和 50 / 100。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/a3b38c1e0f071a70bb79ab696a1fbaa1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ok7DMvllxTI89Atq"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Photo by <a class="ae ky" href="https://unsplash.com/@jeffreyflin?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Jeffrey F Lin</a> on <a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="d4d6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">假设我们想要建立一个机器学习模型来预测足球点球大战的获胜者。在我们拥有的关于不同足球运动员的数据中，有<em class="lv">点球得分</em>和<em class="lv">点球未遂</em>。遵循传统智慧，我们设计了这个特征</p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="3fc0" class="mb mc it lx b gy md me l mf mg"><em class="lv">penalty_success_rate</em> = <em class="lv">penalties_scored</em> / <em class="lv">penalties_attempted</em></span></pre><p id="07cf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然而，由于点球和点球决胜并不经常发生，我们对这一新功能有以下问题:</p><ul class=""><li id="4d05" class="mh mi it lb b lc ld lf lg li mj lm mk lq ml lu mm mn mo mp bi translated">有些球员从来没有罚过球，所以他们的<em class="lv">点球成功率</em>是不确定的。</li><li id="c4ed" class="mh mi it lb b lc mq lf mr li ms lm mt lq mu lu mm mn mo mp bi translated">对于之前正好罚过一次的玩家，他们的<em class="lv"> penalty_success_rate </em>不是 100%就是 0%。这两个数字都不能反映球员获得下一个点球的概率，并且会误导我们的机器学习模型。(作为参考，世界杯点球大战的平均点球成功率约为<a class="ae ky" href="https://www.bbc.co.uk/sport/football/44641247" rel="noopener ugc nofollow" target="_blank"> 70% </a>)</li><li id="d07a" class="mh mi it lb b lc mq lf mr li ms lm mt lq mu lu mm mn mo mp bi translated">当我们用新数据更新<em class="lv"> penalty_success_rate </em>时，对于只接受了几次处罚的玩家来说，这些值可能会大幅波动。例如，如果一名球员罚进了第一个点球，但错过了第二个，他的特征值将从 100%大幅下降到 50%。这可能会导致模型性能不稳定。</li><li id="0fd5" class="mh mi it lb b lc mq lf mr li ms lm mt lq mu lu mm mn mo mp bi translated">最后，我们希望我们的特征考虑成功率证据的强度。2 分之 1 的记录仍然属于一个非常好的点球手，但是一个 100 分之 50 的记录的球员几乎肯定不擅长点球。但是<em class="lv"> penalty_success_rate </em>的公式对两种情况都给出了 50%，无法区分。</li></ul></div><div class="ab cl mv mw hx mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="im in io ip iq"><h2 id="0ebc" class="mb mc it bd nc nd ne dn nf ng nh dp ni li nj nk nl lm nm nn no lq np nq nr ns bi translated">贝叶斯方法</h2><p id="023d" class="pw-post-body-paragraph kz la it lb b lc nt ju le lf nu jx lh li nv lk ll lm nw lo lp lq nx ls lt lu im bi translated">贝叶斯统计解决了上述所有问题。天真地说，在贝叶斯框架内，首先给玩家一个初始特征值，对应于我们关于玩家的先验知识。然后当我们接收到新的数据时，我们逐渐更新特征值。只有当我们接收到足够多的数据时，新值才会与初始值有很大的偏差。</p><p id="cc3c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的贝叶斯特征的公式是</p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="f649" class="mb mc it lx b gy md me l mf mg"><em class="lv">bayesian_penalty_success_rate</em> = <br/>        (<em class="lv">penalties_scored</em> + α) / (<em class="lv">penalties_attempted</em> + α + β)</span></pre><p id="0a61" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">其中α和β是我们需要选择的超参数。直觉上，我们可以把α和β理解为我们分别给予点球得分和罚失的“领先”数量。</p></div><div class="ab cl mv mw hx mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="im in io ip iq"><h2 id="4114" class="mb mc it bd nc nd ne dn nf ng nh dp ni li nj nk nl lm nm nn no lq np nq nr ns bi translated">公式的动机</h2><p id="bcbc" class="pw-post-body-paragraph kz la it lb b lc nt ju le lf nu jx lh li nv lk ll lm nw lo lp lq nx ls lt lu im bi translated">因为我们只关心点球是进了还是没进(而不是怎么进的)，所以我们可以用二项式分布来模拟结果。然后，用贝塔分布来模拟球员得分的概率是自然和方便的，贝塔分布是二项式似然函数的共轭先验。</p><p id="5938" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面的公式是贝塔分布的平均值</p><pre class="kj kk kl km gt lw lx ly lz aw ma bi"><span id="171c" class="mb mc it lx b gy md me l mf mg">Beta(<em class="lv">penalties_scored</em> + α, <em class="lv">penalties_missed</em> + β)</span></pre><p id="69f6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">其中<em class="lv">点球 _ 未进</em> = <em class="lv">点球 _ 未遂</em> - <em class="lv">点球 _ 进球</em>。</p></div><div class="ab cl mv mw hx mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="im in io ip iq"><h2 id="0f92" class="mb mc it bd nc nd ne dn nf ng nh dp ni li nj nk nl lm nm nn no lq np nq nr ns bi translated">具体的例子</h2><p id="df1a" class="pw-post-body-paragraph kz la it lb b lc nt ju le lf nu jx lh li nv lk ll lm nw lo lp lq nx ls lt lu im bi translated">让我们选择α = 7，β = 3，并考虑一个之前从未罚过球的球员。</p><ul class=""><li id="be42" class="mh mi it lb b lc ld lf lg li mj lm mk lq ml lu mm mn mo mp bi translated">最初，<em class="lv">处罚 _ 得分</em>和<em class="lv">处罚 _ 未遂</em>均为 0。因此<br/> <em class="lv">贝叶斯 _ 惩罚 _ 成功率</em> = (0 + 7) / (0 + 7 + 3) = 0.7</li><li id="76de" class="mh mi it lb b lc mq lf mr li ms lm mt lq mu lu mm mn mo mp bi translated">假设我们的玩家第一次罚分:<br/><em class="lv">Bayesian _ penalty _ success _ rate</em>=(1+7)/(1+7+3)≈0.7272</li><li id="5709" class="mh mi it lb b lc mq lf mr li ms lm mt lq mu lu mm mn mo mp bi translated">然后我们的玩家错过了她的第二次惩罚:<br/> <em class="lv">贝叶斯 _ 惩罚 _ 成功 _ 率</em> = (1 + 7) / (2 + 7 + 3) ≈ 0.6667</li><li id="a6f1" class="mh mi it lb b lc mq lf mr li ms lm mt lq mu lu mm mn mo mp bi translated">最后，假设我们的玩家最终的总战绩是 100 分中的 50 分:<br/> <em class="lv">贝叶斯 _ 惩罚 _ 成功率</em> = (50 + 7) / (100 + 7 + 3) ≈ 0.5182</li></ul><p id="6acd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们看到<em class="lv">Bayesian _ penalty _ success _ rate</em>总是定义良好。它的值在收到新数据时会逐渐变化，并且它需要强有力的证据来证明该值明显偏离初始值。</p></div><div class="ab cl mv mw hx mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="im in io ip iq"><h2 id="0173" class="mb mc it bd nc nd ne dn nf ng nh dp ni li nj nk nl lm nm nn no lq np nq nr ns bi translated">如何选择α和β</h2><ul class=""><li id="beee" class="mh mi it lb b lc nt lf nu li ny lm nz lq oa lu mm mn mo mp bi translated"><em class="lv">贝叶斯 _ 惩罚 _ 成功率</em>的初始值为α / (α + β)。我们可以选择α和β，使得α / (α + β)等于全局平均惩罚成功率。这对应于用平均值替换缺失值的常见做法。</li></ul><p id="7b02" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在满足上述等式的所有对(α，β)中，我们可以使用以下方法选择一对:</p><ul class=""><li id="335b" class="mh mi it lb b lc ld lf lg li mj lm mk lq ml lu mm mn mo mp bi translated">查看 beta 分布的不同百分位数，看看它们是否与你的领域知识相匹配。</li><li id="919d" class="mh mi it lb b lc mq lf mr li ms lm mt lq mu lu mm mn mo mp bi translated">决定多少数据算作强有力的证据。例如，假设我们做了一些探索性的数据分析，发现前 5 个点球得分的球员最终职业生涯点球成功率都在 82%以上。因此，我们可能希望选择α和β，使<br/> (5 + α) / (5 + α + β) &gt;为 0.82</li><li id="2711" class="mh mi it lb b lc mq lf mr li ms lm mt lq mu lu mm mn mo mp bi translated">对数据进行聚类，看看是否有解释聚类的α和β。例如，如果 3 个记录中有 2 个，7 个中有 5 个，11 个中有 8 个的玩家表现出相似的特征，我们可以选择α = 7，β = 3，分别产生特征值 0.6923，0.7059 和 0.7143。</li></ul><p id="230e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一般来说，较小的α和β意味着我们的先验知识较弱，新数据将对β分布产生较大影响，从而影响我们的特征值。</p></div><div class="ab cl mv mw hx mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="im in io ip iq"><h2 id="f4d9" class="mb mc it bd nc nd ne dn nf ng nh dp ni li nj nk nl lm nm nn no lq np nq nr ns bi translated">一个具体的例子</h2><ul class=""><li id="5d53" class="mh mi it lb b lc nt lf nu li ny lm nz lq oa lu mm mn mo mp bi translated">首先，我们希望α / (α + β) = 0.7，这是世界杯点球大战中的平均点球成功率。</li></ul><p id="832f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在所有满足α / (α + β) = 0.7 的不同值中:</p><ul class=""><li id="fdf0" class="mh mi it lb b lc ld lf lg li mj lm mk lq ml lu mm mn mo mp bi translated">对于α= 70 °,β= 30 °,β(70，30)的第一百分位是 0.5887。这转化为一个先验知识，即，有 99%的可能性，我们的球员的下一个点球得分的概率至少是 58.87%。这对一个从未罚过球的球员来说似乎太高了。因此，我们将拒绝这一对价值观。</li><li id="d662" class="mh mi it lb b lc mq lf mr li ms lm mt lq mu lu mm mn mo mp bi translated">对于α = 7，β = 3，β(7，3)的第 1 和第 99 百分位分别为 0.3437 和 0.9467。这意味着有 98%的可能性，我们的玩家的概率在 34.37%和 94.67%之间，这比上面说的有意义得多。</li></ul><p id="ff4b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">另外，我们希望(5 + α) / (5 + α + β) &gt; 0.82，因为关于球员前 5 个点球全部进球的探索性数据分析。</p><ul class=""><li id="eb3c" class="mh mi it lb b lc ld lf lg li mj lm mk lq ml lu mm mn mo mp bi translated">对于α = 7，β = 3，(5 + 7) / (5 + 7 + 3) = 0.8 小于我们想要的。</li><li id="d147" class="mh mi it lb b lc mq lf mr li ms lm mt lq mu lu mm mn mo mp bi translated">对于α = 3.5，β = 1.5，(5 + 3.5) / (5 + 3.5 + 1.5) = 0.85 满足我们的条件。</li></ul><p id="0811" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">快速检查一下β的百分位数(3.5，1.5)看起来也不错，所以我们将选择α = 3.5，β = 1.5。</p><p id="985b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">备注:通常有很多对(α，β)满足我们的条件。通常，它们的相关特征以类似的方式对我们的机器学习模型做出贡献，所以我们可以简单地选择其中一个。</p></div><div class="ab cl mv mw hx mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="im in io ip iq"><h2 id="9316" class="mb mc it bd nc nd ne dn nf ng nh dp ni li nj nk nl lm nm nn no lq np nq nr ns bi translated">常见问题</h2><p id="187f" class="pw-post-body-paragraph kz la it lb b lc nt ju le lf nu jx lh li nv lk ll lm nw lo lp lq nx ls lt lu im bi translated">问:α和β必须是整数吗？</p><p id="8261" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">答:不需要。唯一的要求是它们是正实数。</p><p id="a0e8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">问:我们可以为不同的玩家选择不同的α和β吗？</p><p id="50be" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">答:是的。回想一下，α和β定义了描述我们先验知识的β分布。很可能我们对不同的球员有不同的先验知识，例如前锋通常擅长点球，而后卫则不然。</p><p id="f57b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">问:上面的贝叶斯特征公式使用了 beta 分布的平均值。我们可以使用其他统计数据(如标准差)来定义新特征吗？</p><p id="76f9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">答:是的。我们可以很容易地在维基百科上找到这些公式。</p><p id="6243" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">问:如果我们已经在我们的机器学习模型中使用<em class="lv"> penalty_success_rate </em>、<em class="lv">penalty _ scored、</em>和<em class="lv">penalty _ attempted</em>，那么创建这个贝叶斯特征是否有益？例如，为了区分 1/2 和 50/100，我们的模型可以简单地使用<em class="lv"> penalties_scored </em>特性。</p><p id="6a09" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">答:是的，这样做还是有好处的。假设我们开始时只有两个特征<em class="lv">罚分 _ 得分</em>和<em class="lv">罚分 _ 未遂</em>。即使一个足够复杂的模型可以做除法，我们仍然会设计<em class="lv"> penalty_success_rate </em>特性来使我们的模型学习得更好。工程我们的贝叶斯特征是一样的。</p></div><div class="ab cl mv mw hx mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="im in io ip iq"><h2 id="2deb" class="mb mc it bd nc nd ne dn nf ng nh dp ni li nj nk nl lm nm nn no lq np nq nr ns bi translated">进一步阅读</h2><ol class=""><li id="9438" class="mh mi it lb b lc nt lf nu li ny lm nz lq oa lu ob mn mo mp bi translated"><a class="ae ky" href="http://varianceexplained.org/statistics/beta_distribution_and_baseball/" rel="noopener ugc nofollow" target="_blank">这是一篇以棒球为例的关于 beta 发行版的博文。</a></li><li id="6e8d" class="mh mi it lb b lc mq lf mr li ms lm mt lq mu lu ob mn mo mp bi translated"><a class="ae ky" href="https://en.wikipedia.org/wiki/Binomial_proportion_confidence_interval#Wilson_score_interval" rel="noopener ugc nofollow" target="_blank">威尔逊评分区间</a>也可用于对小样本量的成功概率进行良好的估计。</li></ol></div></div>    
</body>
</html>