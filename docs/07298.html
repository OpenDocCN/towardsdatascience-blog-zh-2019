<html>
<head>
<title>Categorical Embedding and Transfer Learning</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">范畴嵌入与迁移学习</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/categorical-embedding-and-transfer-learning-dd3c4af6345d?source=collection_archive---------2-----------------------#2019-10-14">https://towardsdatascience.com/categorical-embedding-and-transfer-learning-dd3c4af6345d?source=collection_archive---------2-----------------------#2019-10-14</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="e695" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">深度学习的副产品比你想象的更有用。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/ac654a7747c3a32558c80ab048ab2da3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*isATEtAA_HGhN7JxHTfZvw.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Transferring the embedding matrix!</figcaption></figure><h1 id="7f7d" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">介绍</h1><p id="5bd4" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">许多机器学习算法不能直接处理分类变量，除非它们被转换成数字。然而，问题是它们的性能会因这些分类变量编码成数字的方式而有很大差异。本文探讨了分类编码的问题，并简要介绍了新旧方法。</p><h1 id="0c51" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">分类变量</h1><p id="2a33" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">一个<a class="ae mj" href="https://en.wikipedia.org/wiki/Categorical_variable" rel="noopener ugc nofollow" target="_blank"> <strong class="lp ir"> <em class="mk">分类变量</em> </strong> </a>是一个变量，它可以取一个可能的固定且大部分有限的值集合。它们与定性特征相关，因此无法测量。例如，星期几是一个分类变量，可以接受 7 个离散值。任何语言的单词/标记都是范畴变量。机器学习算法致力于处理数字，因此我们必须将这些分类变量转换为数字，以取悦算法。这个过程充满了陷阱，我们冒着丢失大量信息的风险。</p><p id="0dd6" class="pw-post-body-paragraph ln lo iq lp b lq ml jr ls lt mm ju lv lw mn ly lz ma mo mc md me mp mg mh mi ij bi translated">让我们来看看将类别转换成数字的几种常见方法，以及与之相关的问题。</p><h2 id="5894" class="mq kw iq bd kx mr ms dn lb mt mu dp lf lw mv mw lh ma mx my lj me mz na ll nb bi translated">标签编码</h2><p id="c8ad" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">在这个过程中，我们使用一些已定义的过程为每个唯一的类别分配一个离散的数字。例如，我们可以按照出现的次数对变量进行排序，并按照升序对它们进行编号。另一种方法是为每个独特的类别随机分配一个数字。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nc"><img src="../Images/66dfc58e8732f0c08eaa02e29f7ae653.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8HgbxewUsdQqgo1dMUFkPA.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Simple Label Encoder</figcaption></figure><p id="3a4c" class="pw-post-body-paragraph ln lo iq lp b lq ml jr ls lt mm ju lv lw mn ly lz ma mo mc md me mp mg mh mi ij bi translated">在上面的示例中，日期按照它们在数据中出现的顺序进行标记。这里的主要问题是</p><ol class=""><li id="3e77" class="nd ne iq lp b lq ml lt mm lw nf ma ng me nh mi ni nj nk nl bi translated">自然排序丢失了</li><li id="d306" class="nd ne iq lp b lq nm lt nn lw no ma np me nq mi ni nj nk nl bi translated">类别之间的常见关系未被捕获。(例如，星期六和星期天一起构成周末，因此应该彼此更接近)</li></ol><h2 id="9058" class="mq kw iq bd kx mr ms dn lb mt mu dp lf lw mv mw lh ma mx my lj me mz na ll nb bi translated">一个热/虚拟编码</h2><p id="25cb" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">在这个方案中，我们将分类变量分成单独的二进制变量(每个唯一的类别有一个变量),这样，当示例属于特定的类别时，每个新变量都被设置为 1，否则设置为 0。下面的例子将使事情变得清楚。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nr"><img src="../Images/f050ce767f68bcdd1292fd3ce28dd5f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LpdBCoHzuyMY0nDoIjI5Bw.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">One Hot Encoding</figcaption></figure><p id="91a7" class="pw-post-body-paragraph ln lo iq lp b lq ml jr ls lt mm ju lv lw mn ly lz ma mo mc md me mp mg mh mi ij bi translated">这里的主要问题类似于标签编码。自然秩序丧失了，每个独特类别之间的关系也丧失了。</p><blockquote class="ns"><p id="a4ce" class="nt nu iq bd nv nw nx ny nz oa ob mi dk translated">失去自然顺序的问题是，算法(线性模型)试图通过假设每个变量的顺序来进行归纳，而基于树的算法必须进行多次分裂才能克服错误的顺序。</p></blockquote></div><div class="ab cl oc od hu oe" role="separator"><span class="of bw bk og oh oi"/><span class="of bw bk og oh oi"/><span class="of bw bk og oh"/></div><div class="ij ik il im in"><h1 id="e3af" class="kv kw iq bd kx ky oj la lb lc ok le lf jw ol jx lh jz om ka lj kc on kd ll lm bi translated">嵌入向量</h1><p id="ac5c" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">嵌入是分类变量的向量表示。例如，我们可以用 4 个浮点数来表示一周中的每一天。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oo"><img src="../Images/0c1cb7ff01de59f2151918c7299257c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4Or0Vd_g0iqe7nAF6Z3Wtw.png"/></div></div></figure><p id="aeb4" class="pw-post-body-paragraph ln lo iq lp b lq ml jr ls lt mm ju lv lw mn ly lz ma mo mc md me mp mg mh mi ij bi translated">在这里，星期一和星期二彼此非常相似，但都与星期日非常不同。这是一个玩具示例，但是我们在实践中得到类似的嵌入，它捕获了丰富的信息和类别之间的关系。</p><h2 id="171e" class="mq kw iq bd kx mr ms dn lb mt mu dp lf lw mv mw lh ma mx my lj me mz na ll nb bi translated">学习嵌入矩阵</h2><p id="7406" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">嵌入矩阵是浮点数的<strong class="lp ir"> NxM </strong>矩阵。这里<strong class="lp ir"> N </strong>是唯一类别的数量<strong class="lp ir"> M </strong>是嵌入维度。我们决定选择 M 的值，这里我通常设置 M 的值等于 N  的平方根<a class="ae mj" href="https://forums.fast.ai/t/embedding-layer-size-rule/50691" rel="noopener ugc nofollow" target="_blank"> <em class="mk">开始，然后根据需要增加或减少它。实际上，嵌入矩阵是向量的查找表。嵌入矩阵的每一行都是唯一类别的向量。</em></a></p><p id="feb0" class="pw-post-body-paragraph ln lo iq lp b lq ml jr ls lt mm ju lv lw mn ly lz ma mo mc md me mp mg mh mi ij bi translated">为了学习嵌入，我们创建一个任务，使用这些嵌入作为特征，并与其他特征交互，以学习一组示例。让我用开启嵌入时代的例子来解释这一点；<strong class="lp ir">词向量</strong>。</p><p id="432a" class="pw-post-body-paragraph ln lo iq lp b lq ml jr ls lt mm ju lv lw mn ly lz ma mo mc md me mp mg mh mi ij bi translated">单词向量是语言中每个单词的嵌入向量。单词向量的整体思想是，在一个句子中出现的更近的单词通常彼此更近。嵌入是<strong class="lp ir"> <em class="mk"> n 维向量</em> </strong>。每个维度捕捉每个单词的某些属性/特性，所以特性越接近，单词就越接近。为了学习单词向量，我们创建一组出现在一个小单词窗口(比如 5 个单词)内的单词对作为正例，并创建一组不出现在该窗口内的单词对作为负例。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi op"><img src="../Images/09921708abf4e18693071503e18c6857.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oz-1Nc1J3zBV9KIJW7H-Lg.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Word2Vec Negative Sampling Architecture</figcaption></figure><p id="92e4" class="pw-post-body-paragraph ln lo iq lp b lq ml jr ls lt mm ju lv lw mn ly lz ma mo mc md me mp mg mh mi ij bi translated">当我们在足够大的数据集上训练上述神经网络时，模型会学习预测两个词是否相关。然而，这个模型的副产品是嵌入矩阵，它是词汇表中每个单词的信息丰富的向量表示。</p><h2 id="a780" class="mq kw iq bd kx mr ms dn lb mt mu dp lf lw mv mw lh ma mx my lj me mz na ll nb bi translated">范畴嵌入</h2><p id="991b" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">上面的部分是一个引子，说明如果我们定义一个有意义的任务，神经网络可以学习分类变量的有意义的向量表示。然而，上面的例子并没有处理通常的分类数据集，所以让我们看一些表格数据。</p><p id="c04e" class="pw-post-body-paragraph ln lo iq lp b lq ml jr ls lt mm ju lv lw mn ly lz ma mo mc md me mp mg mh mi ij bi translated">在<a class="ae mj" href="https://draup.com/" rel="noopener ugc nofollow" target="_blank"> Draup </a>，我们分析各种组织的职位描述(JD)。每个 JD 都有以下字段:-</p><ul class=""><li id="7157" class="nd ne iq lp b lq ml lt mm lw nf ma ng me nh mi oq nj nk nl bi translated">位置(大约 1000 个唯一值)</li><li id="9d81" class="nd ne iq lp b lq nm lt nn lw no ma np me nq mi oq nj nk nl bi translated">工作角色(超过 600 个唯一值)</li><li id="bbe2" class="nd ne iq lp b lq nm lt nn lw no ma np me nq mi oq nj nk nl bi translated">公司(超过 4400 个唯一值)</li><li id="d5bc" class="nd ne iq lp b lq nm lt nn lw no ma np me nq mi oq nj nk nl bi translated">技能(大约 15000 个唯一值)</li></ul><p id="448c" class="pw-post-body-paragraph ln lo iq lp b lq ml jr ls lt mm ju lv lw mn ly lz ma mo mc md me mp mg mh mi ij bi translated">每个 JD 被标记为内部定义的 18 个业务功能之一。数据集类似于下表。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi or"><img src="../Images/c3a37454a261a195c33152d6211a4383.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q6c5aoJi20Ti1gcaDvWewQ.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">A snippet of the tabular data.</figcaption></figure><p id="da79" class="pw-post-body-paragraph ln lo iq lp b lq ml jr ls lt mm ju lv lw mn ly lz ma mo mc md me mp mg mh mi ij bi translated">在上面的数据集中，所有列都有分类值，每个分类值都有许多唯一值。为了构建分类嵌入，我们需要两件事情</p><ol class=""><li id="62ea" class="nd ne iq lp b lq ml lt mm lw nf ma ng me nh mi ni nj nk nl bi translated">解决有意义任务的深度学习模型。</li><li id="cf7e" class="nd ne iq lp b lq nm lt nn lw no ma np me nq mi ni nj nk nl bi translated">在上述任务中使用嵌入矩阵来表示分类变量。</li></ol><p id="803c" class="pw-post-body-paragraph ln lo iq lp b lq ml jr ls lt mm ju lv lw mn ly lz ma mo mc md me mp mg mh mi ij bi translated">我们建立了一个深度学习模型，使用其他 4 个变量(技能、位置、公司、工作角色)来预测 JD 的业务功能。</p><p id="203e" class="pw-post-body-paragraph ln lo iq lp b lq ml jr ls lt mm ju lv lw mn ly lz ma mo mc md me mp mg mh mi ij bi translated"><em class="mk">下图显示了为业务功能预测任务构建的模型。</em></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi os"><img src="../Images/d5b9c736bcee6dba7a0ca5b7827df62f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2UTOiPJHZ3EpygMjiM4KOA.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Model to predict the Business Function of a JD.</figcaption></figure><p id="1330" class="pw-post-body-paragraph ln lo iq lp b lq ml jr ls lt mm ju lv lw mn ly lz ma mo mc md me mp mg mh mi ij bi translated">我们在数百万个 JDs 上训练了上述模型，准确率达到 85%以上。然而，从模型中榨取最大的准确性并不是这个模型的意图(更不用说这个模型本身是非常有用的)。我们对这个模型的副产品更感兴趣。所有分类输入变量的嵌入。下图显示了模型使用<strong class="lp ir"> t-SNE 学习的工作角色嵌入。</strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ot"><img src="../Images/ecf1875d562d46ce8cd5c24da218bb9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-K5k19B3eERbvsvI5ZK__g.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Clusters formed by tSNE</figcaption></figure><h1 id="be69" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">为什么它会起作用？</h1><p id="eda8" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">我喜欢把这个过程想象成变量之间的相互信息交换。下面，我用一小部分数据进行讨论。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ou"><img src="../Images/c87fbfa712afc070b0e240ae8413a6a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sm2MLpYmIi4pyCslGJzQGw.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">A subset of our Data</figcaption></figure><ol class=""><li id="1890" class="nd ne iq lp b lq ml lt mm lw nf ma ng me nh mi ni nj nk nl bi translated">在第一个示例中，模型了解到脸书和机器学习工程师与 AI 相关联，而脸书和机器学习工程师是有关系的。</li><li id="aa1b" class="nd ne iq lp b lq nm lt nn lw no ma np me nq mi ni nj nk nl bi translated">现在它了解到谷歌和数据科学家是有关联的，两者都与人工智能有关。正因如此，它试图将谷歌和脸书的嵌入彼此拉近。类似地，机器学习工程师和数据科学家的嵌入被拉近了。</li><li id="ce0a" class="nd ne iq lp b lq nm lt nn lw no ma np me nq mi ni nj nk nl bi translated">接下来的几个例子再次证实了模型对公司和工作角色的了解。</li><li id="f8d0" class="nd ne iq lp b lq nm lt nn lw no ma np me nq mi ni nj nk nl bi translated">现在它遇到了这样一个事实，脸书也与 NLP 工程师有关，两者都与人工智能有关。因此，该模型试图使 NLP 工程师更接近数据科学家和机器学习工程师。</li></ol><p id="39b2" class="pw-post-body-paragraph ln lo iq lp b lq ml jr ls lt mm ju lv lw mn ly lz ma mo mc md me mp mg mh mi ij bi translated"><em class="mk">上面的例子过于简单，只是为了带来一些直觉，因此应该有所保留。</em></p><h1 id="afe2" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">迁移学习</h1><p id="face" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">迁移学习是一种技术，其中从一个任务/模型中收集的知识被用于类似性质的另一个任务。</p><blockquote class="ns"><p id="d567" class="nt nu iq bd nv nw nx ny nz oa ob mi dk translated">迁移学习最明显的使用案例是当我们想要模拟任务 A，但是有一个小的数据集，然而我们有一个类似任务 b 的大数据集。</p></blockquote><p id="8c15" class="pw-post-body-paragraph ln lo iq lp b lq ov jr ls lt ow ju lv lw ox ly lz ma oy mc md me oz mg mh mi ij bi translated">我们在拥有大量数据的情况下为任务建立模型，然后重用模型权重(在嵌入的情况下)或模型的子集(通常在计算机视觉问题和最近的 NLP 中看到)。</p><p id="e6bd" class="pw-post-body-paragraph ln lo iq lp b lq ml jr ls lt mm ju lv lw mn ly lz ma mo mc md me mp mg mh mi ij bi translated">Draup 是一个人力资源技术平台。平台的部分显示了按不同工作角色划分的人口统计信息。</p><blockquote class="ns"><p id="15e4" class="nt nu iq bd nv nw nx ny nz oa ob mi dk translated">这项任务是预测每个特定地点从事某项工作的人数。</p></blockquote><p id="e9c9" class="pw-post-body-paragraph ln lo iq lp b lq ov jr ls lt ow ju lv lw ox ly lz ma oy mc md me oz mg mh mi ij bi translated">总<strong class="lp ir"> <em class="mk">工作角色—地点</em> </strong>组合总计约 30 万个。然而，训练样本的数量在 10，000 左右。我们构建了深度学习模型，<strong class="lp ir"> <em class="mk">重用了在业务功能</em> </strong>预测任务中学习到的嵌入。除了嵌入，我们还使用了一些其他的数字特征来训练模型。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pa"><img src="../Images/0095a959929f0349e46ca7d4ec34da6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rcxNY7cWwrgN12Oo97n2Zg.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Regression Model</figcaption></figure><p id="9120" class="pw-post-body-paragraph ln lo iq lp b lq ml jr ls lt mm ju lv lw mn ly lz ma mo mc md me mp mg mh mi ij bi translated">该模型在转移嵌入方面表现得令人难以置信的好，并且获得了超过<strong class="lp ir"> 0.9 </strong>的<strong class="lp ir"> r2 得分</strong>。</p><h1 id="f0a3" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">摘要</h1><p id="874b" class="pw-post-body-paragraph ln lo iq lp b lq lr jr ls lt lu ju lv lw lx ly lz ma mb mc md me mf mg mh mi ij bi translated">我们讨论了机器学习模型对数字变量驾轻就熟，但对分类变量却束手无策。处理分类变量的传统技术是可行的，但是限制了算法的能力。然而，在正确的情况下，我们可以使用从其他任务中学习到的分类嵌入或学习全新的嵌入来提高模型性能。类别嵌入通常表现得相当好，因为它们在自身之间有相似和相异的感觉，从而帮助模型更好地概括。</p><h1 id="606e" class="kv kw iq bd kx ky kz la lb lc ld le lf jw lg jx lh jz li ka lj kc lk kd ll lm bi translated">参考</h1><ul class=""><li id="691a" class="nd ne iq lp b lq lr lt lu lw pb ma pc me pd mi oq nj nk nl bi translated"><a class="ae mj" href="https://arxiv.org/pdf/1604.06737.pdf" rel="noopener ugc nofollow" target="_blank">实体嵌入纸</a></li><li id="01a8" class="nd ne iq lp b lq nm lt nn lw no ma np me nq mi oq nj nk nl bi translated"><a class="ae mj" href="http://contrib.scikit-learn.org/categorical-encoding/" rel="noopener ugc nofollow" target="_blank">常见分类编码器</a></li><li id="9b26" class="nd ne iq lp b lq nm lt nn lw no ma np me nq mi oq nj nk nl bi translated"><a class="ae mj" href="https://forums.fast.ai/t/embedding-layer-size-rule/50691" rel="noopener ugc nofollow" target="_blank">如何选择嵌入尺寸大小</a></li><li id="080f" class="nd ne iq lp b lq nm lt nn lw no ma np me nq mi oq nj nk nl bi translated"><a class="ae mj" href="https://papers.nips.cc/paper/5021-distributed-representations-of-words-and-phrases-and-their-compositionality.pdf" rel="noopener ugc nofollow" target="_blank"> Word2Vec 阴性采样纸</a></li><li id="0690" class="nd ne iq lp b lq nm lt nn lw no ma np me nq mi oq nj nk nl bi translated"><a class="ae mj" href="http://ruder.io/transfer-learning/" rel="noopener ugc nofollow" target="_blank">转移学习</a></li></ul></div></div>    
</body>
</html>