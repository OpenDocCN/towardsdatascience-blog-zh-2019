<html>
<head>
<title>Alternating Least Square for Implicit Dataset with code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">带代码的隐式数据集的交替最小二乘</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/alternating-least-square-for-implicit-dataset-with-code-8e7999277f4b?source=collection_archive---------1-----------------------#2019-06-25">https://towardsdatascience.com/alternating-least-square-for-implicit-dataset-with-code-8e7999277f4b?source=collection_archive---------1-----------------------#2019-06-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="38f1" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">反馈(交互)数据推荐引擎指南</h2></div><p id="67b5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在大数据和分析时代，数据驱动的业务的力量一直呈指数级增长。人工智能和机器学习的更大整合在系统开发中发挥了至关重要的作用，这既有利于企业，也有利于企业用户。此外，推荐系统为数字业务增添了优势。下图显示了推荐系统的重要性。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi lb"><img src="../Images/9284a19e2e880cb8c84e74447f4ef065.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RsTKCxbfndJ0wWapcILSIQ.png"/></div></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk"><strong class="bd lr">Importance of Recommendation engines</strong></figcaption></figure><p id="50d1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">包含特定项目或事件的显式等级、计数或类别的数据集被视为显式数据项。电影 5 分之 4 的评级是明确的数据点。然而，在隐式数据集中，我们需要理解用户和/或事件的交互，以找出其等级/类别。例如，一个人观看单一流派的电影。这种数据集被认为是隐式的。如果我们不考虑隐式数据集，我们就会错过很多隐藏的见解。</p><blockquote class="ls lt lu"><p id="3fe3" class="kf kg lv kh b ki kj jr kk kl km ju kn lw kp kq kr lx kt ku kv ly kx ky kz la ij bi translated"><strong class="kh ir">隐式数据集仅包含用户和项目交互。</strong></p></blockquote><p id="303c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，我们将考虑一个例子，以便有一个更好的了解。<a class="ae lz" href="https://www.kaggle.com/retailrocket/ecommerce-dataset" rel="noopener ugc nofollow" target="_blank"> Retailrocket 推荐系统数据集</a>是理解交替最小二乘法的一个很好的隐含数据。</p><h1 id="7917" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated"><strong class="ak">交替最小二乘法</strong></h1><p id="9991" class="pw-post-body-paragraph kf kg iq kh b ki ms jr kk kl mt ju kn ko mu kq kr ks mv ku kv kw mw ky kz la ij bi translated">交替最小二乘法是一种分解矩阵的算法。我们将讨论<a class="ae lz" href="http://yifanhu.net/PUB/cf.pdf" rel="noopener ugc nofollow" target="_blank">隐式反馈数据集的协同过滤</a>如何使用 ALS。如下图所示，我们看到一个矩阵被分解成两个更小的矩阵。将第一个矩阵视为用户-项目交互的集合。因此，分解后的矩阵将是用户特征和项目特征</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi mx"><img src="../Images/66d1ea8fbd0b90555433ae6c5b818e09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ezY_g30VQ8MTGpDwd3z56w.png"/></div></div></figure><p id="2e9c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">交互矩阵值是具有特定偏好和置信度的事件，其给出每个元素的值。对于一个实例，考虑有 3 个事件的电子商务数据集:查看、添加到购物车和事务处理。如果在用户和项目对之间存在交互，则认为是正面偏好，否则是负面偏好。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi my"><img src="../Images/e1b44de297c214812a54c3b3cd2abe53.png" data-original-src="https://miro.medium.com/v2/resize:fit:772/format:webp/1*LB7XYsLQ5sHWCffrr4XTpA.png"/></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk">Preference</figcaption></figure><blockquote class="ls lt lu"><p id="2639" class="kf kg lv kh b ki kj jr kk kl km ju kn lw kp kq kr lx kt ku kv ly kx ky kz la ij bi translated">信心可以定义为价值或我们给予互动的价值。对于购买(交易事件)物品 X 的用户 A，我们增加交互权重，而用户 A 查看物品 Z 的权重小于“购买的交互”。</p></blockquote><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/2b3f5c876fe6843c8dc8e7e13a5b942e.png" data-original-src="https://miro.medium.com/v2/resize:fit:410/format:webp/1*fcx5Y2fkeQeCpghrDvJZFw.png"/></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk">Confidence</figcaption></figure><p id="14da" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">置信度:r 是用户 u 和项目 I 之间的交互。交互越多，置信度越高——取决于值<strong class="kh ir"> α。买了 5 次的物品会比只买了两次的物品更有信心。如果相互作用的 r 为 0，那么我们加 1，使它不为零。该论文通常推荐 40 作为<strong class="kh ir"> α </strong>值。</strong></p><p id="a7b7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">该论文描述了用于寻找用户交互和项目交互矩阵的以下成本函数:</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi na"><img src="../Images/db90ce9807ecffba8241c53e9fe8edfa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eE60LAwabjMuhGfQfXjWTw.png"/></div></div></figure><p id="c8b8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这里，λ用于正则化模型，其值可以通过交叉验证来确定。</p><h1 id="0e14" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">交替最小二乘法的本质</h1><p id="ab9f" class="pw-post-body-paragraph kf kg iq kh b ki ms jr kk kl mt ju kn ko mu kq kr ks mv ku kv kw mw ky kz la ij bi translated">成本函数包含 m 个 n 项，其中 m 是用户数量，n 是项目数量。对于典型的数据集，m n 可以很容易地达到几十亿。因此，像随机梯度下降这样的优化方法会把如此庞大的数据搞得一团糟。因此，本文介绍了替代优化技术。</p><blockquote class="ls lt lu"><p id="c4c4" class="kf kg lv kh b ki kj jr kk kl km ju kn lw kp kq kr lx kt ku kv ly kx ky kz la ij bi translated">请注意，当用户因素或项目因素固定时，成本函数变成二次函数，因此可以很容易地计算出它的全局最小值。这导致了一个交替最小二乘优化过程，其中我们在重新计算用户因素和项目因素之间交替，并且每一步都保证降低成本函数值</p></blockquote><p id="7448" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们通过分别用 x 和 y 对上面的成本函数求微分来找到用户(x)向量和物品(y)向量。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/7dd4ae5c65b05e0fe24d710f6a62a0a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:744/format:webp/1*gHYZPT-fdhmOVGRqmqz4Rg.png"/></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk">User and Item Vectors</figcaption></figure><p id="20aa" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，现在为了找到用户-项目对的偏好分数，我们使用以下:</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi nc"><img src="../Images/610eb7f1d9b40bc5a0a64e1d855fb4bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:330/format:webp/1*Ty1wl92pdo0314GePsvExw.png"/></div></div></figure><p id="a76c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们发现最大的 p 值有项目推荐给用户。</p><h1 id="972e" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">我们如何编码？</h1><p id="758e" class="pw-post-body-paragraph kf kg iq kh b ki ms jr kk kl mt ju kn ko mu kq kr ks mv ku kv kw mw ky kz la ij bi translated">我们使用<a class="ae lz" href="https://implicit.readthedocs.io/en/latest/quickstart.html" rel="noopener ugc nofollow" target="_blank">隐式库</a>,它包含了 Cython 中的所有实现，使它更快。</p><blockquote class="ls lt lu"><p id="b82b" class="kf kg lv kh b ki kj jr kk kl km ju kn lw kp kq kr lx kt ku kv ly kx ky kz la ij bi translated"><strong class="kh ir">导入库</strong></p></blockquote><pre class="lc ld le lf gt nd ne nf ng aw nh bi"><span id="855e" class="ni mb iq ne b gy nj nk l nl nm"><br/>import pandas as pd<br/>import numpy as np<br/>import scipy.sparse as sparse<br/>import random<br/>import implicit <br/></span></pre><blockquote class="ls lt lu"><p id="07fa" class="kf kg lv kh b ki kj jr kk kl km ju kn lw kp kq kr lx kt ku kv ly kx ky kz la ij bi translated"><strong class="kh ir">数据预处理</strong></p></blockquote><p id="e861" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">不要担心[这部分不需要对每个用例都一样]</p><pre class="lc ld le lf gt nd ne nf ng aw nh bi"><span id="498c" class="ni mb iq ne b gy nj nk l nl nm">def create_data(datapath,start_date,end_date):<br/>    df=pd.read_csv(datapath)<br/>    df=df.assign(date=pd.Series(datetime.fromtimestamp(a/1000).date() for a in df.timestamp))<br/>    df=df.sort_values(by='date').reset_index(drop=True) # for some reasons RetailRocket did NOT sort data by date<br/>    df=df[(df.date&gt;=datetime.strptime(start_date,'%Y-%m-%d').date())&amp;(df.date&lt;=datetime.strptime(end_date,'%Y-%m-%d').date())]<br/>    df=df[['visitorid','itemid','event']]<br/>    return df</span><span id="8691" class="ni mb iq ne b gy nn nk l nl nm">datapath= './input/events.csv'<br/>data=create_data(datapath,'2015-5-3','2015-5-18')<br/>data['user'] = data['user'].astype("category")data['artist'] = data['artist'].astype("category")data['user_id'] = data['user'].cat.codesdata['artist_id'] = data['artist'].cat.codes</span></pre><blockquote class="ls lt lu"><p id="7673" class="kf kg lv kh b ki kj jr kk kl km ju kn lw kp kq kr lx kt ku kv ly kx ky kz la ij bi translated"><strong class="kh ir">创建交互矩阵</strong></p></blockquote><p id="b9bc" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">由于数据是稀疏的，我们为项目用户数据创建稀疏矩阵，这将是模型的输入。用户项目矩阵将用于获取建议</p><pre class="lc ld le lf gt nd ne nf ng aw nh bi"><span id="7660" class="ni mb iq ne b gy nj nk l nl nm"><br/>sparse_item_user = sparse.csr_matrix((data['event'].astype(float), (data['itemid'], data['visitorid'])))</span><span id="40b7" class="ni mb iq ne b gy nn nk l nl nm">sparse_user_item = sparse.csr_matrix((data['event'].astype(float), (data['visitor_id'], data['item_id'])))<br/></span></pre><blockquote class="ls lt lu"><p id="33cd" class="kf kg lv kh b ki kj jr kk kl km ju kn lw kp kq kr lx kt ku kv ly kx ky kz la ij bi translated"><strong class="kh ir">ALS</strong></p></blockquote><pre class="lc ld le lf gt nd ne nf ng aw nh bi"><span id="d960" class="ni mb iq ne b gy nj nk l nl nm"><br/>#Building the model<br/>model = implicit.als.AlternatingLeastSquares(factors=20, regularization=0.1, iterations=20)</span><span id="c5e3" class="ni mb iq ne b gy nn nk l nl nm">alpha_val = 40<br/>data_conf = (sparse_item_user * alpha_val).astype('double')</span><span id="0bc9" class="ni mb iq ne b gy nn nk l nl nm">model.fit(data_conf)<br/></span></pre><blockquote class="ls lt lu"><p id="8e0a" class="kf kg lv kh b ki kj jr kk kl km ju kn lw kp kq kr lx kt ku kv ly kx ky kz la ij bi translated"><strong class="kh ir">使用模型</strong></p></blockquote><p id="1a33" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用内置库函数获取<strong class="kh ir">建议</strong></p><pre class="lc ld le lf gt nd ne nf ng aw nh bi"><span id="4f0d" class="ni mb iq ne b gy nj nk l nl nm">#Get Recommendations</span><span id="2884" class="ni mb iq ne b gy nn nk l nl nm">user_id =   14</span><span id="b692" class="ni mb iq ne b gy nn nk l nl nm">recommended = model.recommend(user_id, sparse_user_item)</span><span id="8cc4" class="ni mb iq ne b gy nn nk l nl nm">print(recommended)<br/></span></pre><p id="f7b7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们还可以使用下面的函数得到一个类似项目的列表</p><pre class="lc ld le lf gt nd ne nf ng aw nh bi"><span id="4525" class="ni mb iq ne b gy nj nk l nl nm"><br/>#Get similar items</span><span id="a11f" class="ni mb iq ne b gy nn nk l nl nm">item_id = 7</span><span id="78a6" class="ni mb iq ne b gy nn nk l nl nm">n_similar = 3</span><span id="976a" class="ni mb iq ne b gy nn nk l nl nm">similar = model.similar_items(item_id, n_similar)</span><span id="06a8" class="ni mb iq ne b gy nn nk l nl nm">print(similar)<br/></span></pre><h1 id="8aa7" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">结论</h1><p id="4b0c" class="pw-post-body-paragraph kf kg iq kh b ki ms jr kk kl mt ju kn ko mu kq kr ks mv ku kv kw mw ky kz la ij bi translated">交替最小二乘法相当稳健。ALS 的时间复杂度与数据大小成线性比例。(即<strong class="kh ir"> O(x*n)其中 n 为数据集的长度，x 为整数</strong>)。代码可在此<a class="ae lz" href="https://gist.github.com/himanshk96/21594b9f49a8b3060ff1f00d0a0d8ec5" rel="noopener ugc nofollow" target="_blank">链接</a>获得</p></div></div>    
</body>
</html>