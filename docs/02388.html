<html>
<head>
<title>Software development best practices in a deep learning environment</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">深度学习环境中的软件开发最佳实践</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/software-development-best-practices-in-a-deep-learning-environment-a1769e9859b1?source=collection_archive---------8-----------------------#2019-04-19">https://towardsdatascience.com/software-development-best-practices-in-a-deep-learning-environment-a1769e9859b1?source=collection_archive---------8-----------------------#2019-04-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/cfc994966f28e9f3bae7d7be64e74f94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aHqGO8UCB_eS4MFdEF_X-w.jpeg"/></div></div></figure><h1 id="8e87" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">软件开发:深度学习环境中的最佳实践</h1><p id="a828" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi lu translated">eep 学习系统现在被广泛应用于许多环境中。它们与传统软件系统的不同之处在于产生输出的方式:产生结果的决策是从训练数据中学习的，而不是像传统软件系统那样手工编码。</p><p id="c25b" class="pw-post-body-paragraph kw kx iq ky b kz md lb lc ld me lf lg lh mf lj lk ll mg ln lo lp mh lr ls lt ij bi translated">这导致人们错误地认为软件开发对于机器学习系统来说不是必要的，因为算法是任何实际系统的核心，是由系统本身学习的。此外，最先进的机器学习(ML)发展如此之快，以至于数据科学家们主要关注模型精度等短期目标。鉴于深度学习世界将在几个月内发生变化，为什么要浪费时间今天就正确地设计你的系统呢？目前，深度学习工程的谎言是，一个系统被一起实验，直到达到某个精度目标，然后被投入生产。</p><p id="edff" class="pw-post-body-paragraph kw kx iq ky b kz md lb lc ld me lf lg lh mf lj lk ll mg ln lo lp mh lr ls lt ij bi translated">即使与传统系统不同，这种设计 ML 系统的方法也是有害的，原因如下:</p><ul class=""><li id="98a4" class="mi mj iq ky b kz md ld me lh mk ll ml lp mm lt mn mo mp mq bi translated">很容易出错，从而产生不正确的精度。例如，由于数据加载或转换中的错误，或者训练/测试/验证集的不正确处理。</li><li id="e1a8" class="mi mj iq ky b kz mr ld ms lh mt ll mu lp mv lt mn mo mp mq bi translated">复制培训结果非常耗时，因为所使用的数据和配置通常没有记录，也没有版本。</li><li id="76bb" class="mi mj iq ky b kz mr ld ms lh mt ll mu lp mv lt mn mo mp mq bi translated">在生产环境中运行 ML 模型是很困难的，因为系统只在文档记录不良的开发环境中进行测试。</li><li id="a24e" class="mi mj iq ky b kz mr ld ms lh mt ll mu lp mv lt mn mo mp mq bi translated">使 ML 系统适应变化的需求也是棘手的，因为代码库的可维护性不是一个问题，并且系统缺乏自动化测试。</li></ul><p id="2e2b" class="pw-post-body-paragraph kw kx iq ky b kz md lb lc ld me lf lg lh mf lj lk ll mg ln lo lp mh lr ls lt ij bi translated">鉴于这些挑战，你如何设计深度学习系统，同时避免抛弃编码和实验的有害影响？在本文中，我们分享了开普勒视觉技术公司开发和采用的最佳实践。这些实践深深植根于现代软件开发实践，并解释了开发机器学习系统的独特性。那么，与传统系统相比，开发深度学习系统有什么特殊之处呢？</p><figure class="mx my mz na gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mw"><img src="../Images/c28ab909bfc8a9878822d3066e1d0715.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*wuN6nJiONvPVk4E6"/></div></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk">Photo by <a class="ae nf" href="https://unsplash.com/@shanerounce?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Shane Rounce</a> on <a class="ae nf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="450d" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">深度学习工程的特性</h1><p id="3122" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">在本节中，我们列出了深度学习工程的特征，这些特征对采用传统软件工程的最佳实践构成了主要障碍。在本节的下一节中，我们将介绍我们采取的措施，以使我们的深度学习开发过程更加稳健和高效，克服(部分)这里列出的障碍。</p><h2 id="b9fb" class="ng jz iq bd ka nh ni dn ke nj nk dp ki lh nl nm km ll nn no kq lp np nq ku nr bi translated">1.快速发展的深度学习框架</h2><p id="7dd1" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">在深度学习革命的黎明，模型是基于低级库建立的。一段时间后，专门的图书馆开始出现，以帮助 ML 工程师，最引人注目的是 2013 年成立的 Caffe 图书馆的推出。三年后，大量其他深度学习库出现了。滚动到今天，不同图书馆的数量继续增加，尽管已经形成了一批领先的领跑者。除了新的个体库的诞生之外，每个库本身必须不断地经历快速进化，因为它们试图跟上神经网络研究的新发展。</p><h2 id="667d" class="ng jz iq bd ka nh ni dn ke nj nk dp ki lh nl nm km ll nn no kq lp np nq ku nr bi translated">2.数据管理</h2><p id="dd40" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">深度学习系统的一个主要特点是，与传统软件系统相比，输入数据量要大得多，单个数据项的大小也是如此。在训练阶段尤其如此，在此阶段使用的数据量通常非常大。虽然由传统软件系统管理的数据存储可能会变得非常庞大，但这些系统仍然可以通过使用给定数据的一小部分来运行和测试。另一方面，训练深度学习系统永远不会成功，除非利用大量数据。</p><h2 id="6a18" class="ng jz iq bd ka nh ni dn ke nj nk dp ki lh nl nm km ll nn no kq lp np nq ku nr bi translated">3.结构管理</h2><p id="8dea" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">管理配置数据是软件工程中的一门复杂的艺术，最佳实践是以这样一种方式对配置数据进行版本控制，即明确哪个配置数据属于哪个版本的源代码。这种最佳实践也适用于机器学习系统，但仍然很难实现，因为与传统系统相比，配置数据的规模非常大。毕竟，一个经过训练的神经网络的权重是配置数据，可以很容易地测量到总共 1Gb。</p><p id="4b2e" class="pw-post-body-paragraph kw kx iq ky b kz md lb lc ld me lf lg lh mf lj lk ll mg ln lo lp mh lr ls lt ij bi translated">训练深度学习模型时使用的所谓超参数也是配置数据，必须进行实物管理。事实证明，这些超参数通常分散在代码中，以能够满足精度目标的方式进行调整。</p><h2 id="edb2" class="ng jz iq bd ka nh ni dn ke nj nk dp ki lh nl nm km ll nn no kq lp np nq ku nr bi translated">4.测试深度学习系统</h2><p id="73dc" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">测试自动化现在广泛应用于软件开发中。然而，在深度学习领域，测试自动化的使用程度几乎不一样。原因有两个:首先，深度学习开发人员没有在现代软件工程实践中受过适当的培训，其次，开发深度学习模型需要大量的实验。</p><p id="ea55" class="pw-post-body-paragraph kw kx iq ky b kz md lb lc ld me lf lg lh mf lj lk ll mg ln lo lp mh lr ls lt ij bi translated">此外，训练深度学习系统是一个不确定的过程。这使得培训过程的自动化测试更加困难，因为对培训结果的简单断言是不够的。考虑到漫长的培训时间，很容易明白为什么大多数深度学习工程师放弃自动化测试。</p><p id="0ef2" class="pw-post-body-paragraph kw kx iq ky b kz md lb lc ld me lf lg lh mf lj lk ll mg ln lo lp mh lr ls lt ij bi translated">推理的自动化测试更加简单。一旦模型被训练，由于舍入误差，只剩下少量的不确定性。</p><h2 id="af42" class="ng jz iq bd ka nh ni dn ke nj nk dp ki lh nl nm km ll nn no kq lp np nq ku nr bi translated">5.深度学习系统的部署</h2><p id="4e5c" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">两个核心特征将深度学习系统的部署与传统系统区分开来:首先，大多数深度学习系统需要特殊的硬件，即 GPU，以足够的吞吐量运行。其次，深度学习系统需要一个大的配置文件，即权重文件，才能进行预测。这使得实现开发/生产对等，即开发和测试的相似环境变得更加困难。此外，由于其大小，将权重文件与源代码一起打包在一个部署包中是不明智的。这导致您需要使用单独的工件来部署权重文件和系统，同时保持它们的同步。</p><h1 id="c340" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">我们设计深度学习系统的方法</h1><p id="5d02" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi lu translated">我们的方法基于一个指导原则，即训练和运行深度学习系统应该尽可能自动化。它不应该基于一个人需要在几周的实验后训练和评估模型。</p><h2 id="5528" class="ng jz iq bd ka nh ni dn ke nj nk dp ki lh nl nm km ll nn no kq lp np nq ku nr bi translated">使用持续集成构建 Docker 映像</h2><p id="851a" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">我们使用 Docker 来指定我们深度学习系统的开发和运行时环境。当我们对版本控制系统进行修改时——在我们的例子中是 GitHub——Travis 会介入并运行测试，如果成功的话，就会构建最新的 Docker 映像并将它们推送到 Docker 存储库。Docker 图像将不包含模型，因为这会使我们的 Docker 图像太大而不容易分发。</p><p id="5ea2" class="pw-post-body-paragraph kw kx iq ky b kz md lb lc ld me lf lg lh mf lj lk ll mg ln lo lp mh lr ls lt ij bi translated">使用 Docker，运行时环境与代码一起得到保护，并且可以在任何支持 Docker 的环境中可靠地部署和运行系统，而不管使用的深度学习框架如何。</p><figure class="mx my mz na gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ns"><img src="../Images/822371611ac9df4a862548d2ca23ba90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*cj2-qxaGC368JOxv"/></div></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk">Photo by <a class="ae nf" href="https://unsplash.com/@elcarito?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">elCarito</a> on <a class="ae nf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h2 id="71a4" class="ng jz iq bd ka nh ni dn ke nj nk dp ki lh nl nm km ll nn no kq lp np nq ku nr bi translated">将云放在首位</h2><p id="8a24" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">我们努力在云中的一个实例上训练和评估我们的模型(我们使用 Amazon AWS)，因为这从运行我们的系统中解开了平台细节。上面描述的 Docker 镜像方法和 Amazon AWS 巧妙地结合在一起实现了这种抽象。</p><h2 id="61a8" class="ng jz iq bd ka nh ni dn ke nj nk dp ki lh nl nm km ll nn no kq lp np nq ku nr bi translated">将数据存储在中央位置</h2><p id="b6cf" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">数据管理是深度学习系统不可或缺的一部分。我们将数据和注释存储在中央存储库中(AWS S3 存储桶)，并使用脚本在本地同步数据，这样我们的应用程序、作业和开发人员就可以访问最新的数据。作业总是使用干净的数据副本运行，我们认为下载数据所花的时间是值得的；这让我们确信使用了正确的训练和测试数据。</p><h2 id="2892" class="ng jz iq bd ka nh ni dn ke nj nk dp ki lh nl nm km ll nn no kq lp np nq ku nr bi translated">将重量文件存储在中央位置</h2><p id="3818" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">我们将权重文件存储在一个中心位置，如果需要启动推理服务器或评估作业，可以将它们提取出来。当训练作业产生了模型的改进版本时，权重文件被更新。集中存储权重文件可确保乔布斯和开发人员能够轻松访问最新的模型。</p><h2 id="dd8b" class="ng jz iq bd ka nh ni dn ke nj nk dp ki lh nl nm km ll nn no kq lp np nq ku nr bi translated">将超参数配置存储在中央位置</h2><p id="3a1b" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">我们将用于训练和评估的超参数存储(更改)在配置文件中。这可以防止这些参数分散在源代码中。我们使用一个中心位置来存储这些配置文件，以便作业和开发人员可以访问它们。</p><figure class="mx my mz na gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nt"><img src="../Images/075dc734e917961d5072a1f4a5850a83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zKsgmiQ66tpicgu-ppA5Tg.png"/></div></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk">Jenkins training job</figcaption></figure><h2 id="b262" class="ng jz iq bd ka nh ni dn ke nj nk dp ki lh nl nm km ll nn no kq lp np nq ku nr bi translated">将培训和评估整合到工作中</h2><p id="be73" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">我们使用<a class="ae nf" href="https://jenkins.io" rel="noopener ugc nofollow" target="_blank"> Jenkins 自动化服务器</a>将培训和评估整合到工作中。这些作业获取最新的 Docker 图像、数据和注释，并将在 Docker 容器中运行培训或评估。Docker 容器具有附加的卷，在评估的情况下，这些卷指向数据、注释和模型文件。</p><p id="e829" class="pw-post-body-paragraph kw kx iq ky b kz md lb lc ld me lf lg lh mf lj lk ll mg ln lo lp mh lr ls lt ij bi translated">训练工作完成后，将生成一个权重文件，如果该文件符合模型的 KPI，则可以存储该文件。</p><p id="a350" class="pw-post-body-paragraph kw kx iq ky b kz md lb lc ld me lf lg lh mf lj lk ll mg ln lo lp mh lr ls lt ij bi translated">这项工作将把所有需要的知识和数据整合到脚本中，任何人都将能够可靠地训练或评估模型，而不需要理解模型的复杂性。</p><p id="3ba2" class="pw-post-body-paragraph kw kx iq ky b kz md lb lc ld me lf lg lh mf lj lk ll mg ln lo lp mh lr ls lt ij bi translated">但是，我们会存档注释文件、配置文件和生成的重量文件，以便可以重现作业结果。</p><h2 id="25e6" class="ng jz iq bd ka nh ni dn ke nj nk dp ki lh nl nm km ll nn no kq lp np nq ku nr bi translated">使用 PyCharm 的远程开发特性</h2><p id="c0db" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">当开发人员可以使用集成开发环境(IDE)时，效率会更高。有时，开发人员可能需要在 GPU 上测试和调试源代码和模型，而这通常无法在他们的开发机器上直接获得。在 GPU 上运行代码的同时结合使用 IDE 的一种方法是在一台有 GPU 的机器上启动 Docker 容器，然后使用 PyCharm 的特性让<a class="ae nf" href="https://www.jetbrains.com/help/pycharm/configuring-remote-interpreters-via-ssh.html" rel="noopener ugc nofollow" target="_blank">运行远程解释器</a>。与将源代码上传到远程服务器并为调试添加日志记录语句相比，远程解释器大大减少了往返时间。</p><h2 id="31a3" class="ng jz iq bd ka nh ni dn ke nj nk dp ki lh nl nm km ll nn no kq lp np nq ku nr bi translated">使用测试自动化</h2><p id="d872" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">如上所述，对于深度学习系统来说，编写有效且高效的自动化测试比传统软件系统更难。我们确实使用 pytest 框架为深度学习系统编写了自动化测试，但没有像我们为传统软件系统所做的那样广泛。</p><p id="a7ef" class="pw-post-body-paragraph kw kx iq ky b kz md lb lc ld me lf lg lh mf lj lk ll mg ln lo lp mh lr ls lt ij bi translated">我们专注于测试数据输入和重要的算法。我们也为训练和评估编写测试，但仅限于代码能流畅运行的程度。我们不会检查一次完整的训练运行是否产生了正确的结果，因为这太耗费时间了。相反，我们编写一个自动化测试，在一个非常小的数据集上运行一到两个时期，然后我们检查输出指标是否产生，但不断言它们的值。</p><p id="3d2b" class="pw-post-body-paragraph kw kx iq ky b kz md lb lc ld me lf lg lh mf lj lk ll mg ln lo lp mh lr ls lt ij bi translated">我们的测试自动化工作的结果是我们的代码库更容易理解，并且实现更改需要更少的努力。</p><figure class="mx my mz na gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nu"><img src="../Images/74560b3b7d6ff5ea1c3c19d4bcce4a7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Cb4KGuvUB4VTJPVU"/></div></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk">Photo by <a class="ae nf" href="https://unsplash.com/@amutiomi?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Miguel A. Amutio</a> on <a class="ae nf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h2 id="263b" class="ng jz iq bd ka nh ni dn ke nj nk dp ki lh nl nm km ll nn no kq lp np nq ku nr bi translated">测量可维护性度量</h2><p id="fa9f" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">一个软件系统需要维护，才能适应不断变化的需求和环境，深度学习系统也不例外。系统的可维护性越高，修改和扩展系统就越容易。我们使用<a class="ae nf" href="http://bettercodehub.com" rel="noopener ugc nofollow" target="_blank">bettercodehub.com</a>来检查 10 个软件工程指导方针，并在系统偏离轨道时通知我们。与代码违规工具相比，我们更喜欢这个工具，因为它允许我们专注于重要的可维护性准则，而不是处理像 PyLint 这样的工具将报告的大量违规。</p><h1 id="6c0d" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">结论</h1><p id="8240" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">深度学习是组织 IT 工具箱中相对较新的一项内容。它部分源于传统的软件开发，部分源于数据科学。考虑到深度学习仍处于起步阶段，标准工程实践尚未建立也就不足为奇了。然而，深度学习软件的开发是软件工程的一个组成部分，我们必须从现代软件工程的原则中获得灵感，作为改进深度学习软件工程的起点。</p><p id="fe41" class="pw-post-body-paragraph kw kx iq ky b kz md lb lc ld me lf lg lh mf lj lk ll mg ln lo lp mh lr ls lt ij bi translated">上面列出的实践使我们的深度学习模型开发过程更加健壮和可重复，并为深度学习实践者和软件工程师之间的合作创造了一个共同的基础。这个过程并不完美，因为没有一个过程是完美的，我们一直在寻找改进我们目前工作方法的方法。</p></div></div>    
</body>
</html>