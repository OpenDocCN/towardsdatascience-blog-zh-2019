<html>
<head>
<title>Fast.ai library: 1st impression</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Fast.ai 库:第一印象</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/fast-ai-library-1st-impression-958cb52afc?source=collection_archive---------12-----------------------#2019-03-07">https://towardsdatascience.com/fast-ai-library-1st-impression-958cb52afc?source=collection_archive---------12-----------------------#2019-03-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="a93e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最近尝试了一下<a class="ae kl" href="https://docs.fast.ai/" rel="noopener ugc nofollow" target="_blank"> fast.ai </a>深度学习库，想分享一下经验。</p><p id="33ff" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，我的背景——不是为了展示我有多酷/多坏，而是因为它主要与像我一样思考和编码的人相关，而与其他人不太相关。</p><p id="7ead" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我从来没有学过软件工程，所有的事情都是自学的。从<strong class="jp ir"> C++和 matlab 开始，</strong>在我参与的<strong class="jp ir"> caffe </strong>工作了 3 年，然后转到<strong class="jp ir"> python 和 pytorch </strong>。大多数情况下，我写脏代码，并不关心它是否是次优的和不可伸缩的，除非它成为瓶颈。我很少在尝试做某件事之前阅读文档。<br/>也就是说，我可以设计并实现干净、可扩展且高效的软件——就像我曾经在一家名为“先拍照后购买”的时尚初创公司担任首席技术官一样。但这需要时间，而且不适合深度学习研究的快速原型制作，所以大多数情况下我不愿意这么做。我也是<a class="ae kl" href="https://jupyter.org/" rel="noopener ugc nofollow" target="_blank"> Jupyter 笔记本</a>的粉丝。</p><p id="5e00" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">先从 fast.ai 的好东西说起，然后描述一下我经历过的挑战。</p><h1 id="6768" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">fast.ai 里的牛逼东西</h1><ol class=""><li id="efe7" class="lk ll iq jp b jq lm ju ln jy lo kc lp kg lq kk lr ls lt lu bi translated"><strong class="jp ir">微数据集</strong>。我无法表达微数据集对于快速调试、可再现性、健全性检查和学习有多酷。</li></ol><figure class="lw lx ly lz gt ma gh gi paragraph-image"><div role="button" tabindex="0" class="mb mc di md bf me"><div class="gh gi lv"><img src="../Images/9bd2cf3f82052219c0263e8921fcbc3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tux2WnspAJI_HxXXIjQArg.png"/></div></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk"><a class="ae kl" href="https://github.com/fastai/fastai/blob/master/examples/vision.ipynb" rel="noopener ugc nofollow" target="_blank">https://github.com/fastai/fastai/blob/master/examples/vision.ipynb</a></figcaption></figure><p id="5007" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2.<strong class="jp ir">学习率+wd+动量和增量的默认参数</strong>。这可能看起来是小事，但关系重大。当你试图让工作变得疯狂时，一切都可能出错。数据，采样，缩放，一切。从等式中去掉两个主要的东西是一件解放大脑的大事</p><figure class="lw lx ly lz gt ma gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/474852df3512345d8bb2247ec85ac99f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4SDsGLYLCXgjBMDWwLD51Q.png"/></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk"><a class="ae kl" href="https://docs.fast.ai/vision.transform.html#Data-augmentation-details" rel="noopener ugc nofollow" target="_blank">https://docs.fast.ai/vision.transform.html#Data-augmentation-details</a></figcaption></figure><p id="af80" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">3.<strong class="jp ir"> lr_find() </strong>，<strong class="jp ir">一个周期策略</strong>和<strong class="jp ir"> concat 池</strong>。Lr_find 是非常强大而简单的方法，来自 Leslie N. Smith 的“<a class="ae kl" href="https://arxiv.org/abs/1506.01186" rel="noopener ugc nofollow" target="_blank">训练神经网络的循环学习率</a>”，该论文值得 NIPS/ICML 的最佳论文，但可能会被忽视。fast.ai 保存并提升。想法很简单——用不同的 lr 做一个小批量 SGD，重新编码，选择最好的一个。</p><figure class="lw lx ly lz gt ma gh gi paragraph-image"><div role="button" tabindex="0" class="mb mc di md bf me"><div class="gh gi mm"><img src="../Images/93a1b04f8654364d67c485cdd76b9a44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_VVwerYAZOyilSXzUutmlQ.png"/></div></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk"><a class="ae kl" href="https://docs.fast.ai/basic_train.html#lr_find" rel="noopener ugc nofollow" target="_blank">https://docs.fast.ai/basic_train.html#lr_find</a></figcaption></figure><p id="c4ff" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它工作得很好:当我们为硬网络论文写代码并做实验的时候，我们花了大约 1 周的时间去发现并相信 lr = 10 是好的。使用 lr_find 和 one_cycle，我可以从 2 次尝试中恢复几乎相同的性能。</p><p id="1c3b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://docs.fast.ai/layers.html#AdaptiveConcatPool2d" rel="noopener ugc nofollow" target="_blank"> ConcatPool </a>是简单的[avg，max]池。根据我的经验，这是仅次于<a class="ae kl" href="https://github.com/filipradenovic/cnnimageretrieval-pytorch/blob/master/cirtorch/layers/pooling.py#L36" rel="noopener ugc nofollow" target="_blank">宝石</a>池的第二好选择。</p><h1 id="e9cf" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">太棒了，但是只有当你摸它们的时候</h1><ol class=""><li id="195b" class="lk ll iq jp b jq lm ju ln jy lo kc lp kg lq kk lr ls lt lu bi translated"><a class="ae kl" href="https://docs.fast.ai/callback.html" rel="noopener ugc nofollow" target="_blank"><strong class="jp ir"/></a><strong class="jp ir">。复试。<br/> </strong>这是最重要的事情<strong class="jp ir"/>，这可能在 fast.ai 课程中已经提到很多了，但对于外行人来说一点也不明显，尤其是当你只是谷歌那些不起作用的东西，而不是仔细阅读文档的时候。<br/>我如何尝试新事物？在 vim 中打开 train.py，把一些代码放在不同的地方，通常利用全局可见的变量(也有风险，但谁在乎呢)。因为我是那种“宁愿花一周时间在谷歌上搜索一些东西，也不愿占用别人的时间寻求帮助”的人<a class="mn mo ep" href="https://medium.com/u/4b74af654f57?source=post_page-----958cb52afc--------------------------------" rel="noopener" target="_blank"> Radek Osmulski </a>，我花了两天时间(虽然不是全职)试图找出如何在 fast.ai 中做同样的事情<br/>我几乎要放弃了，但后来找到了回调，并意识到它们是我所需要的。我只是不知道该找什么。Fast.ai 开发者标记了“插入你代码的地方”，你可以通过写回调来访问它们。您还可以全面访问所有变量。</li></ol><figure class="lw lx ly lz gt ma gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/713e2bd08f7dfacd1a19233ccd4dfd81.png" data-original-src="https://miro.medium.com/v2/resize:fit:902/format:webp/1*eeQQaCOS-ND8g8TOCzMuhQ.png"/></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk">My explanation of what fast.ai callbacks are — just marked places to put your code.</figcaption></figure><h1 id="31fd" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">对我没用的东西</h1><p id="ab5e" class="pw-post-body-paragraph jn jo iq jp b jq lm js jt ju ln jw jx jy mq ka kb kc mr ke kf kg ms ki kj kk ij bi translated">它们大多是测试时的东西，不在“单一输入—单一类输出”的范例中。例如，我的网络有 5 个独立的头(OK，4 个独立的和 1 个相关的)，并输出 2 个列表:一个列表具有来自 5 个分类器的预测，另一个具有 4 个 512d 特征。这足以打破许多现成的功能。<br/>所有故障实例都可以从这里重现:<a class="ae kl" href="https://github.com/ducha-aiki/whale-identification-2018/blob/master/reproduce_problems.ipynb" rel="noopener ugc nofollow" target="_blank">https://github . com/ducha-aiki/whale-identificati on-2018/blob/master/reproduct _ problems . ipynb</a></p><ol class=""><li id="8142" class="lk ll iq jp b jq jr ju jv jy mt kc mu kg mv kk lr ls lt lu bi translated">learn.predict()摘自<a class="ae kl" href="https://docs.fast.ai/tutorial.inference.html" rel="noopener ugc nofollow" target="_blank">推理教程</a>:</li></ol><figure class="lw lx ly lz gt ma gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/3f7987984ba563c2c6993c0a5f6229d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1232/format:webp/1*zzoZCQAgvplZIXvrMUMdnQ.png"/></div></figure><p id="f885" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2.好的，我可能应该使用函数 get_preds()，它根据教程给出了原始输出，对吗？不对。</p><div class="lw lx ly lz gt ab cb"><figure class="mx ma my mz na nb nc paragraph-image"><img src="../Images/e3527d5bb24b01e04ffafd0c35206e02.png" data-original-src="https://miro.medium.com/v2/resize:fit:922/format:webp/1*u2OFekJbik85_yLcaWrjEQ.png"/></figure><figure class="mx ma nd mz na nb nc paragraph-image"><div role="button" tabindex="0" class="mb mc di md bf me"><img src="../Images/ce7e5eb7aa207f9c1b28ab350906c84e.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*OEdtfc-RZr8Au4p6VeIJyg.png"/></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk ne di nf ng">Things which work with tutorial (left), do not work for me.</figcaption></figure></div><p id="0035" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">3.最后一次尝试，测试时间增加</p><figure class="lw lx ly lz gt ma gh gi paragraph-image"><div role="button" tabindex="0" class="mb mc di md bf me"><div class="gh gi nh"><img src="../Images/7b2d0c24fd1876a4c0083bc0ba784c60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qWuroKxMFXrugZNkX9aJ8g.png"/></div></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk">Again, when output is list, not tensor, nothing works out of the box</figcaption></figure><p id="dc71" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">不要误会我的意思，这些都不是严重的问题:我很容易就构建了工作区，尽管不是以 fast.ai 的方式</p><figure class="lw lx ly lz gt ma gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/654a2859ac40a6da03814597e7006421.png" data-original-src="https://miro.medium.com/v2/resize:fit:1184/format:webp/1*sh_Ajqtuyclpjn6kk8D0NA.png"/></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk">Not nice, but works</figcaption></figure><p id="a871" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于测试时的增强，我只是切换了转换。另一个问题:我还没有找到如何使火车装载机是非洗牌，所以在肮脏的方式:</p><figure class="lw lx ly lz gt ma gh gi paragraph-image"><div role="button" tabindex="0" class="mb mc di md bf me"><div class="gh gi nj"><img src="../Images/d77235940e486a55584e21d6e3af6e1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9Wun2NJYdix--I-1-jWK8A.png"/></div></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk">Poor-man TTA</figcaption></figure><p id="09a5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">4.fp16 从来没有为我工作过，结果是失败。我现在已经尝试了 fast.ai 的最新版本，但是不知何故其他东西被改变了，以前工作的代码现在不工作了。我已经经历过几次了，所以:</p><p id="0830" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">5.<strong class="jp ir"> fast.ai 真的很快，这很好，但也有它自己的缺点:你不能只是更新版本，然后希望什么都不会坏。</strong>特别简单的改名都很烦。</p><p id="8833" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我也有一些其他问题，但现在认为它们不值得一提——它们更像是我的错，而不是图书馆的错。</p><p id="64d2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">总之，我很高兴我已经尝试了 fast.ai，并且可能也会在我的研究项目中使用它。</p></div></div>    
</body>
</html>