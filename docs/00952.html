<html>
<head>
<title>Text Classification of Freedom of Information Requests: Part I</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">信息自由请求的文本分类:第一部分</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/text-classification-of-freedom-of-information-requests-part-i-8a75d1e7ea02?source=collection_archive---------23-----------------------#2019-02-12">https://towardsdatascience.com/text-classification-of-freedom-of-information-requests-part-i-8a75d1e7ea02?source=collection_archive---------23-----------------------#2019-02-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="bcef" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用机器学习来预测市政当局的决策。</h2></div><p id="9ad8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">根据《信息自由和隐私保护法》(FIPPA)，加拿大安大略省有义务对信息请求做出回应。更具体地说,《市政信息自由和隐私保护法》允许任何年龄、任何地点的人发出这样的请求。与个人相关的信息可能包括印刷品、胶片、电子邮件、图纸、照片等。只要发布的内容不侵犯另一个人的隐私权。在本帖中，我们将尝试预测一个市政当局做出的决定，即安大略省基奇纳-滑铁卢(第一部分)和后来的多伦多(第二部分)。</p><p id="ab7f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所使用的数据在每个城市的开放数据门户下提供。任何识别信息都已被删除。</p><p id="dbe6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用有限的 Kitchener-Waterloo 数据集将允许我们基线化一些度量标准和原型化我们的技术。这些数据通过 API 提供，涵盖 1992 年至 2016 年。</p><p id="8ccf" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一旦所有数据都被汇总并转换成熊猫数据框架，我们需要更仔细地看看我们有什么。可能的“决定”如下:</p><p id="0de6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir"> <em class="lb">全部公开 238 <br/>部分免除 197 <br/>撤回 116 <br/>无记录存在 54 <br/>部分公开的信息 50 <br/>部分不存在 32 <br/>未公开 28 <br/>无记录存在 21 <br/>全部公开 16 <br/>转发出去 15 <br/>放弃 13 <br/>全部公开 13 <br/>无响应记录存在 11 <br/>更正被拒绝 3 <br/>不存在 3<br/> 已披露 2 <br/>已转移 1 <br/>未披露信息 1 <br/>已提交不同意声明 1 <br/>不存在额外记录 1 <br/>批准更正 1 <br/>请求撤销 1 </em> </strong></p><p id="1065" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在可能的决定中，显然有一些重叠，共有 24 项。虽然可以(并且已经)在不太长的时间内手动合并这些类，但是如果有数百个这样的类，只是在空格的存在(或不存在)上有所不同呢？还是一个 s？还是以资本化的方式？SeatGeek 开发的 python 包<a class="ae lc" href="https://chairnerd.seatgeek.com/fuzzywuzzy-fuzzy-string-matching-in-python/" rel="noopener ugc nofollow" target="_blank"> fuzzywuzzy </a>非常适合这种类型的模糊字符串匹配。</p><p id="5b7e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">该软件包提供了四种方法来探测两个字符串的相似性。本质上，“fuzz_ratio”比较整个字符串，“fuzz_partial_ratio”在字符串中搜索部分匹配，“fuzz_token_sort_ratio”比较无序的字符串，“fuzz_token_set_ratio”将标记排序扩展到更长的字符串。每一个都返回一个相似率(越高越相似)，之后可以在可接受的截止点设置一个阈值。让我们测试一下每一个的性能。</p><pre class="ld le lf lg gt lh li lj lk aw ll bi"><span id="87ff" class="lm ln iq li b gy lo lp l lq lr">from fuzzywuzzy import fuzz</span><span id="057c" class="lm ln iq li b gy ls lp l lq lr">all_df_clean = all_df.copy()</span><span id="de84" class="lm ln iq li b gy ls lp l lq lr">for row in all_df['Decision'].unique():<br/>    for row2 in all_df['Decision'].unique():<br/>        matching_result = fuzz.ratio(row, row2) # could be ratio, partial_ratio, token_set_ratio, token_sort_ratio <br/>        if matching_result &gt; 80:<br/>            #print(row, row2)<br/>            #print(matching_results)<br/>            #Combine if match found<br/>            all_df_clean['Decision'][all_df_clean['Decision'] == row2] = row<br/>            <br/>print(all_df_clean['Decision'].value_counts())<br/>print(len(all_df_clean['Decision'].unique()))</span></pre><p id="e4fd" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir"> <em class="lb">全部披露 240 <br/>部分豁免 197 <br/>撤回 116 <br/>无记录存在 75 <br/>部分披露的信息 50 <br/>部分不存在 32 <br/>无信息披露 30 <br/>无披露 28 <br/>转发出去 15 <br/>放弃 13 <br/>无响应记录存在 11 <br/>不存在 3 <br/>改正被拒绝 3 <br/>改正作出 2 <br/>移交滑铁卢地区公共卫生 2 <br/>已转移 1 <br/>更正批准 1 <br/>请求撤回 1 <br/>名称:决定，dtype:int 64<br/>20</em>T24】</strong></p><p id="dccc" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">还不错。我们合并了四个类别(即“不存在记录”和“不存在记录”)，但“未披露信息”和“未披露任何内容”的意思显然是一样的。80%的截止值是通过反复试验确定的。让我们试试部分比率:</p><p id="0cd0" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir"> <em class="lb">全部披露 240 <br/>部分豁免 197 <br/>请求撤回 117 <br/>无响应记录存在 87 <br/>无信息披露 80 <br/>不存在 35 <br/>无披露 28 <br/>转发出去 15 <br/>放弃 13 <br/>更正拒绝 3 <br/>移交 3 <br/>更正作出 2 <br/>异议陈述归档 1 <br/>更正批准 1 <br/>名称:决定、dtt</em></strong></p><p id="5b8d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">另外六个类合并了，但是算法并不真正知道如何处理子串‘discovered’。它将“部分披露的信息”和“未披露的信息”结合在一起，这两个词的意思不同。</p><p id="5ff1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir"> <em class="lb">全部披露 240 <br/>部分豁免 197 <br/>撤回 116 <br/>无信息披露 80 <br/>无记录存在 75 <br/>部分不存在 32 <br/>无披露 28 <br/>转发出去 15 <br/>放弃 13 <br/>无响应记录存在 11 <br/>拒绝改正 3 <br/>不存在 3 <br/>改正作出 2 <br/>转移到滑铁卢公共卫生区 2【T55</em></strong></p><p id="1bb8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">类似于基本比率情况。</p><p id="0733" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir"> <em class="lb">未披露信息 348 <br/>部分免除 197 <br/>要求撤回 117 <br/>无响应记录存在 87 <br/>不存在 35 <br/>转发出去 15 <br/>放弃 13 <br/>更正拒绝 3 <br/>移交 3 <br/>更正作出 2 <br/>异议声明存档 1 <br/>更正批准 1 <br/>名称:决定，dtype: int64 <br/> 12 </em> </strong></p><p id="348b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">迄今为止最积极的匹配案例，但我们再次被“披露”绊倒，因为现在我们不再有“全部披露”的案例，这是不可接受的。部分比率的情况似乎是一种折衷——也许我们可以进一步手动合并几个类别。我们将会看到当多伦多的数据被加入第二部分时会发生什么。</p><pre class="ld le lf lg gt lh li lj lk aw ll bi"><span id="1bdc" class="lm ln iq li b gy lo lp l lq lr">all_df_pr['Decision'].loc[all_df_pr['Decision'] == "Abandoned"] = "Request withdrawn"<br/>all_df_pr['Decision'].loc[all_df_pr['Decision'] == "Non-existent"] = "No responsive records exist"<br/>all_df_pr['Decision'].loc[all_df_pr['Decision'] == "No information disclosed "] = "Nothing disclosed"<br/>all_df_pr['Decision'].loc[all_df_pr['Decision'] == "Transferred"] = "Forwarded out"<br/>all_df_pr['Decision'].loc[all_df_pr['Decision'] == "Correction granted"] = "Correction made"<br/>print(all_df_pr['Decision'].value_counts())</span></pre><p id="42c9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir"> <em class="lb">全部公开 240 <br/>部分免除 197 <br/>请求撤回 130 <br/>无响应记录存在 122 <br/>无公开 108 <br/>转发 18 <br/>更正已做出 3 <br/>更正被拒绝 3 <br/>异议声明已归档 1 <br/>名称:决定，dtype: int64 </em> </strong></p><p id="619f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在一切都变得清晰了。让我们砍掉人数下降幅度大的班级:</p><pre class="ld le lf lg gt lh li lj lk aw ll bi"><span id="20d4" class="lm ln iq li b gy lo lp l lq lr">all_df_over20 = all_df_pr.groupby('Decision').filter(lambda x: len(x) &gt; 20)</span></pre><p id="0b7e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">本文的剩余部分将大量借用 Susan Li 的<a class="ae lc" rel="noopener" target="_blank" href="/multi-class-text-classification-with-scikit-learn-12f1e60e0a9f">关于多类文本分类的优秀文章</a>。我们的预期是，基于我们的数据集较小，以及文本本身相当不透明的事实，我们的结果不会很好。我们数据的快速概述:</p><figure class="ld le lf lg gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi lt"><img src="../Images/7a2b823f7e366383b4618ee79b307f9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*owhMhjmFus8PVr0JsoX9zw.png"/></div></div></figure><figure class="ld le lf lg gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi mb"><img src="../Images/7a62f6977a0842e9066fe10cfb3e0a95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AGt-VVfrcOGrT9HKXQU_cg.png"/></div></div></figure><p id="1dd5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这些阶层并不像我们想象的那样不平衡。“category_id”列是可能的决策案例的整数表示。现在，为每个请求计算一个 tf-idf 向量，去掉所有停用词。</p><pre class="ld le lf lg gt lh li lj lk aw ll bi"><span id="1a5b" class="lm ln iq li b gy lo lp l lq lr">from sklearn.feature_extraction.text import TfidfVectorizer</span><span id="d508" class="lm ln iq li b gy ls lp l lq lr">tfidf = TfidfVectorizer(sublinear_tf=True, min_df=5, norm='l2', <br/>                       encoding='latin-1', ngram_range=(1,2), stop_words='english')</span><span id="6212" class="lm ln iq li b gy ls lp l lq lr">features = tfidf.fit_transform(all_df_over20.Request_summary).toarray()<br/>labels = all_df_over20.category_id<br/>features.shape</span></pre><p id="0e0e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">打印每个类的常见二元模型和二元模型。</p><pre class="ld le lf lg gt lh li lj lk aw ll bi"><span id="064d" class="lm ln iq li b gy lo lp l lq lr">from sklearn.feature_selection import chi2<br/>import numpy as np</span><span id="702b" class="lm ln iq li b gy ls lp l lq lr">N=2<br/>for Decision, category_id in sorted(category_to_id.items()):<br/>    features_chi2 = chi2(features, labels == category_id)<br/>    indices = np.argsort(features_chi2[0])<br/>    feature_names = np.array(tfidf.get_feature_names())[indices]<br/>    unigrams = [v for v in feature_names if len(v.split(' ')) ==1]<br/>    bigrams = [v for v in feature_names if len(v.split(' ')) ==2]<br/>    print("# '{}':".format(Decision))<br/>    print("  . Most correlated unigrams:\n. {}".format('\n.'.join(unigrams[-N:])))<br/>    print("  . Most correlated bigrams:\n. {}".format('\n.'.join(bigrams[-N:])))</span></pre><p id="0ee4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir"><em class="lb">#‘全部公开’:<br/>。最相关的单字:<br/>。协助<br/>。个人<br/>。最相关的二元模型:<br/>。信息已删除<br/>。移除竞争<br/>#‘不存在响应记录’:<br/>。最相关的单字:<br/>。地点<br/>。阶段<br/>。最相关的二元模型:<br/>。评估地址<br/>。现场评估<br/> #【未披露内容】:<br/>。最相关的单字:<br/>。总线<br/> .2014 <br/>。最相关的二元模型:<br/>。完成安大略省<br/>。工程文件<br/>#‘部分免除’:<br/>。最相关的单字:<br/>。比赛<br/> .94 <br/>。最相关的二元模型:<br/>。信息竞赛<br/>。狂犬病控制<br/>#‘请求撤回’:<br/>。最相关的单字:<br/>。省级<br/>。评测<br/>。最相关的二元模型:<br/>。处理厂<br/>。省级违法行为</em> </strong></p><p id="bd89" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这就是我说的请求本身在通过视觉进行分类方面相当不透明的意思。至少在阶级之间有很好的区分。</p><p id="394a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">尝试四种不同的型号:</p><pre class="ld le lf lg gt lh li lj lk aw ll bi"><span id="e737" class="lm ln iq li b gy lo lp l lq lr">import warnings<br/>warnings.filterwarnings(action='once')<br/>from sklearn.linear_model import LogisticRegression<br/>from sklearn.ensemble import RandomForestClassifier<br/>from sklearn.svm import LinearSVC</span><span id="fa17" class="lm ln iq li b gy ls lp l lq lr">from sklearn.model_selection import cross_val_score</span><span id="9738" class="lm ln iq li b gy ls lp l lq lr">models = [<br/>    RandomForestClassifier(n_estimators=200, max_depth=3,<br/>                          random_state=0), #, class_weight='balanced'),<br/>    LinearSVC(), #class_weight='balanced'),<br/>    MultinomialNB(),<br/>    LogisticRegression(random_state=0)#, class_weight='balanced'),<br/>]<br/>CV=5<br/>cv_df = pd.DataFrame(index=range(CV * len(models)))<br/>entries=[]<br/>for model in models:<br/>    model_name = model.__class__.__name__<br/>    accuracies = cross_val_score(model, features, labels,<br/>                                scoring='accuracy', cv=CV)<br/>    for fold_idx, accuracy in enumerate(accuracies):<br/>        entries.append((model_name, fold_idx, accuracy))<br/>cv_df = pd.DataFrame(entries, columns=['model_name', 'fold_idx', 'accuracy'])</span><span id="d7c3" class="lm ln iq li b gy ls lp l lq lr">import seaborn as sns</span><span id="071b" class="lm ln iq li b gy ls lp l lq lr">sns.boxplot(x='model_name', y='accuracy', data=cv_df)<br/>sns.stripplot(x='model_name', y='accuracy', data=cv_df,<br/>             size=8, jitter=True, edgecolor="gray", linewidth=2)<br/>plt.show()<br/>cv_df.groupby('model_name').accuracy.mean()</span></pre><figure class="ld le lf lg gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi mb"><img src="../Images/1f5efdd268f9134a8758e601fb5e8afd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6GGedRVNtZMUlKpTuLCYUg.png"/></div></div></figure><p id="463f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir"><em class="lb">model _ Name<br/>linear SVC 0.362882<br/>logistic regression 0.398066<br/>MultinomialNB 0.398152<br/>RandomForestClassifier 0.349038<br/>Name:accuracy，dtype: float64 </em> </strong></p><p id="c7a3" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">不出所料，性能非常差。我们来看看混淆矩阵。</p><figure class="ld le lf lg gt lu gh gi paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="gh gi mc"><img src="../Images/93788281b8d11c558c12d6e2dda9b439.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jPHd2fYKThQhARnv7u4FqQ.png"/></div></div></figure><pre class="ld le lf lg gt lh li lj lk aw ll bi"><span id="1d9c" class="lm ln iq li b gy lo lp l lq lr">precision    recall  f1-score   support<br/><br/>             All disclosed        0.36      0.69      0.47        67<br/>No responsive records exist       0.50      0.49      0.49        41<br/>            Partly exempted       0.58      0.48      0.53        73<br/>          Request withdrawn       0.38      0.11      0.17        47<br/>          Nothing disclosed       0.58      0.39      0.47        36<br/><br/>                avg / total       0.48      0.45      0.44       264</span></pre><p id="a603" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这个模型至少在尝试。在<a class="ae lc" rel="noopener" target="_blank" href="/text-classification-of-freedom-of-information-requests-part-ii-4d57b080d179">后续文章</a>中，我们将尝试通过显著增加可用数据和在每个类上尝试一系列二元分类器来改进这一点。</p><p id="9173" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">GitHub 上提供的代码:<a class="ae lc" href="https://github.com/scjones5/foi-kw" rel="noopener ugc nofollow" target="_blank">https://github.com/scjones5/foi-kw</a></p></div></div>    
</body>
</html>