<html>
<head>
<title>Time Series Analysis, Visualization &amp; Forecasting with LSTM</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">利用 LSTM 进行时间序列分析、可视化和预测</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/time-series-analysis-visualization-forecasting-with-lstm-77a905180eba?source=collection_archive---------1-----------------------#2019-05-16">https://towardsdatascience.com/time-series-analysis-visualization-forecasting-with-lstm-77a905180eba?source=collection_archive---------1-----------------------#2019-05-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/28dd0a583c79a9ceacde98c1b2859104.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mtho0xL9Qu-cXu61XeLrdA.jpeg"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Photo credit: Unsplash</figcaption></figure><div class=""/><div class=""><h2 id="4e7c" class="pw-subtitle-paragraph kc je jf bd b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt dk translated">统计正态性检验，迪基-富勒平稳性检验，长短期记忆</h2></div><p id="3078" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">标题说明了一切。</p><p id="fb1f" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">事不宜迟，我们滚吧！</p><h1 id="3f32" class="lq lr jf bd ls lt lu lv lw lx ly lz ma kl mb km mc ko md kp me kr mf ks mg mh bi translated">数据</h1><p id="f4b4" class="pw-post-body-paragraph ku kv jf kw b kx mi kg kz la mj kj lc ld mk lf lg lh ml lj lk ll mm ln lo lp ij bi translated">该数据是一个家庭在近 4 年的时间内以一分钟的采样率测量的电力消耗，可从<a class="ae mn" href="https://www.kaggle.com/uciml/electric-power-consumption-data-set" rel="noopener ugc nofollow" target="_blank">此处</a>下载。</p><p id="8c07" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">不同的电量和一些分计量值是可用的。然而，我们只对全局有功功率变量感兴趣。</p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="7f8f" class="mx lr jf mt b gy my mz l na nb">import numpy as np<br/>import matplotlib.pyplot as plt<br/>import pandas as pd<br/>pd.set_option('display.float_format', lambda x: '%.4f' % x)<br/>import seaborn as sns<br/>sns.set_context("paper", font_scale=1.3)<br/>sns.set_style('white')<br/>import warnings<br/>warnings.filterwarnings('ignore')<br/>from time import time<br/>import matplotlib.ticker as tkr<br/>from scipy import stats<br/>from statsmodels.tsa.stattools import adfuller<br/>from sklearn import preprocessing<br/>from statsmodels.tsa.stattools import pacf<br/>%matplotlib inline</span><span id="f28e" class="mx lr jf mt b gy nc mz l na nb">import math<br/>import keras<br/>from keras.models import Sequential<br/>from keras.layers import Dense<br/>from keras.layers import LSTM<br/>from keras.layers import Dropout<br/>from keras.layers import *<br/>from sklearn.preprocessing import MinMaxScaler<br/>from sklearn.metrics import mean_squared_error<br/>from sklearn.metrics import mean_absolute_error<br/>from keras.callbacks import EarlyStopping</span><span id="128f" class="mx lr jf mt b gy nc mz l na nb">df=pd.read_csv('household_power_consumption.txt', delimiter=';')<br/>print('Number of rows and columns:', df.shape)<br/>df.head(5)</span></pre><figure class="mo mp mq mr gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nd"><img src="../Images/c69ec6fe5e99f16ac2efb37005b4c2f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_uhygRBN14RxN6nVGTPDpA.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Table 1</figcaption></figure><p id="9147" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">需要完成以下数据预处理和特征工程步骤:</p><ul class=""><li id="95d4" class="ne nf jf kw b kx ky la lb ld ng lh nh ll ni lp nj nk nl nm bi translated">将日期和时间合并到一列中，并更改为日期时间类型。</li><li id="d80d" class="ne nf jf kw b kx nn la no ld np lh nq ll nr lp nj nk nl nm bi translated">将 Global_active_power 转换为数字，并删除缺少的值(1.2%)。</li><li id="8bfd" class="ne nf jf kw b kx nn la no ld np lh nq ll nr lp nj nk nl nm bi translated">创建年、季度、月和日功能。</li><li id="d703" class="ne nf jf kw b kx nn la no ld np lh nq ll nr lp nj nk nl nm bi translated">创建工作日特征，“0”是周末，“1”是工作日。</li></ul><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="5fed" class="mx lr jf mt b gy my mz l na nb">df['date_time'] = pd.to_datetime(df['Date'] + ' ' + df['Time'])<br/>df['Global_active_power'] = pd.to_numeric(df['Global_active_power'], errors='coerce')<br/>df = df.dropna(subset=['Global_active_power'])<br/>df['date_time']=pd.to_datetime(df['date_time']) <br/>df['year'] = df['date_time'].apply(lambda x: x.year)<br/>df['quarter'] = df['date_time'].apply(lambda x: x.quarter)<br/>df['month'] = df['date_time'].apply(lambda x: x.month)<br/>df['day'] = df['date_time'].apply(lambda x: x.day)<br/>df=df.loc[:,['date_time','Global_active_power', 'year','quarter','month','day']]<br/>df.sort_values('date_time', inplace=True, ascending=True)<br/>df = df.reset_index(drop=True)<br/>df["weekday"]=df.apply(lambda row: row["date_time"].weekday(),axis=1)<br/>df["weekday"] = (df["weekday"] &lt; 5).astype(int)</span><span id="56a4" class="mx lr jf mt b gy nc mz l na nb">print('Number of rows and columns after removing missing values:', df.shape)<br/>print('The time series starts from: ', df.date_time.min())<br/>print('The time series ends on: ', df.date_time.max())</span></pre><figure class="mo mp mq mr gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ns"><img src="../Images/dbed248b9e5cb3c10d5b508bfdf9cfd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6J4X7Ft17os7DYKYYF-HEQ.png"/></div></div></figure><p id="e269" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">去除缺失值后，数据包含 2006 年 12 月至 2010 年 11 月(47 个月)期间收集的 2，049，280 个测量值。</p><p id="a524" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">初始数据包含几个变量。这里我们将关注一个单一的值:一所房子的全局有功功率历史，即家庭全局每分钟平均有功功率，单位为千瓦。</p><h1 id="de81" class="lq lr jf bd ls lt lu lv lw lx ly lz ma kl mb km mc ko md kp me kr mf ks mg mh bi translated">统计正态性检验</h1><p id="c0e0" class="pw-post-body-paragraph ku kv jf kw b kx mi kg kz la mj kj lc ld mk lf lg lh ml lj lk ll mm ln lo lp ij bi translated">有几个统计测试，我们可以用来量化我们的数据是否看起来像是来自高斯分布。我们将使用<a class="ae mn" href="https://en.wikipedia.org/wiki/D%27Agostino%27s_K-squared_test" rel="noopener ugc nofollow" target="_blank">达戈斯蒂诺的 K 检验</a>。</p><p id="2fad" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">在测试的<a class="ae mn" href="http://scipy.github.io/devdocs/index.html" rel="noopener ugc nofollow" target="_blank"> SciPy </a>实现中，我们将 p 值解释如下。</p><ul class=""><li id="0f11" class="ne nf jf kw b kx ky la lb ld ng lh nh ll ni lp nj nk nl nm bi translated">阿尔法:拒绝 H0 失败，正常。</li><li id="ac21" class="ne nf jf kw b kx nn la no ld np lh nq ll nr lp nj nk nl nm bi translated">我们还可以计算<a class="ae mn" href="https://en.wikipedia.org/wiki/Kurtosis" rel="noopener ugc nofollow" target="_blank"> <strong class="kw jg"> <em class="nu">峰度</em> </strong> </a>和<a class="ae mn" href="https://en.wikipedia.org/wiki/Skewness" rel="noopener ugc nofollow" target="_blank"> <strong class="kw jg"> <em class="nu">偏度</em> </strong> </a>，来判断数据分布是否偏离正态分布。</li></ul><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="6e3f" class="mx lr jf mt b gy my mz l na nb">stat, p = stats.normaltest(df.Global_active_power)<br/>print('Statistics=%.3f, p=%.3f' % (stat, p))<br/>alpha = 0.05<br/>if p &gt; alpha:<br/>    print('Data looks Gaussian (fail to reject H0)')<br/>else:<br/>    print('Data does not look Gaussian (reject H0)')</span></pre><figure class="mo mp mq mr gt is gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/0a9ff70be52470a8405191b2763e1aa3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1106/format:webp/1*JQpoCL2OxTKrfzdHkXG4AA.png"/></div></figure><p id="293b" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg"><em class="nu"/></strong>:描述一个分布的尾部的沉重程度</p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="4785" class="mx lr jf mt b gy my mz l na nb">sns.distplot(df.Global_active_power);<br/>print( 'Kurtosis of normal distribution: {}'.format(stats.kurtosis(df.Global_active_power)))<br/>print( 'Skewness of normal distribution: {}'.format(stats.skew(df.Global_active_power)))</span></pre><figure class="mo mp mq mr gt is gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/f7df10a28c5b93c7f33cb1c11d694331.png" data-original-src="https://miro.medium.com/v2/resize:fit:1370/format:webp/1*9ju6xA26lyG1B0PvgtF2gA.png"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 1</figcaption></figure><p id="b6d3" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">正态分布的峰度接近于 0。如果峰度大于零，那么分布有较重的尾部。如果峰度小于零，则分布为轻尾。我们的峰度大于零。</p><p id="0f3e" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated"><strong class="kw jg"> <em class="nu">偏斜度</em> </strong>:测量分布的不对称性</p><p id="0822" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">如果偏斜度在-0.5 到 0.5 之间，则数据相当对称。如果偏斜度介于-1 和-0.5 之间或介于 0.5 和 1 之间，则数据是中度偏斜的。如果偏斜度小于-1 或大于 1，则数据高度偏斜。我们的偏斜度大于 1。</p><p id="e842" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">第一时间序列图</p><h1 id="17ad" class="lq lr jf bd ls lt lu lv lw lx ly lz ma kl mb km mc ko md kp me kr mf ks mg mh bi translated">显然，这个情节不是一个好主意。不要这样。</h1><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="ff1c" class="mx lr jf mt b gy my mz l na nb">df1=df.loc[:,['date_time','Global_active_power']]<br/>df1.set_index('date_time',inplace=True)<br/>df1.plot(figsize=(12,5))<br/>plt.ylabel('Global active power')<br/>plt.legend().set_visible(False)<br/>plt.tight_layout()<br/>plt.title('Global Active Power Time Series')<br/>sns.despine(top=True)<br/>plt.show();</span></pre><figure class="mo mp mq mr gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nw"><img src="../Images/316b6402e6740cbe4a35a10156ce200f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WjRLv5UzelL3t4e07pBrUg.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 2</figcaption></figure><p id="77dc" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">全球年度与季度有功功率的箱线图</p><h1 id="b781" class="lq lr jf bd ls lt lu lv lw lx ly lz ma kl mb km mc ko md kp me kr mf ks mg mh bi translated">当我们并排比较每年的箱线图时，我们注意到 2006 年的全球有功功率中值比其他年份高得多。这有点误导。如果你记得的话，我们只有 2006 年 12 月的数据。而 12 月显然是家庭电力消耗的高峰月。</h1><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="b1b3" class="mx lr jf mt b gy my mz l na nb">plt.figure(figsize=(14,5))<br/>plt.subplot(1,2,1)<br/>plt.subplots_adjust(wspace=0.2)<br/>sns.boxplot(x="year", y="Global_active_power", data=df)<br/>plt.xlabel('year')<br/>plt.title('Box plot of Yearly Global Active Power')<br/>sns.despine(left=True)<br/>plt.tight_layout()</span><span id="8f7f" class="mx lr jf mt b gy nc mz l na nb">plt.subplot(1,2,2)<br/>sns.boxplot(x="quarter", y="Global_active_power", data=df)<br/>plt.xlabel('quarter')<br/>plt.title('Box plot of Quarterly Global Active Power')<br/>sns.despine(left=True)<br/>plt.tight_layout();</span></pre><figure class="mo mp mq mr gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nx"><img src="../Images/30a1462dad5ec5da7f995bd9953a6ce1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9ty6iztGg97CEwi4abPISg.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 3</figcaption></figure><p id="615a" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">这与季度全球有功功率中值一致，第 1 和第 4 季度(冬季)较高，第 3 季度(夏季)最低。</p><p id="a03a" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">全球有功功率分配</p><h1 id="b4ab" class="lq lr jf bd ls lt lu lv lw lx ly lz ma kl mb km mc ko md kp me kr mf ks mg mh bi translated">正态概率图也显示数据远非正态分布。</h1><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="747e" class="mx lr jf mt b gy my mz l na nb">plt.figure(figsize=(14,6))<br/>plt.subplot(1,2,1)<br/>df['Global_active_power'].hist(bins=50)<br/>plt.title('Global Active Power Distribution')</span><span id="4260" class="mx lr jf mt b gy nc mz l na nb">plt.subplot(1,2,2)<br/>stats.probplot(df['Global_active_power'], plot=plt);<br/>df1.describe().T</span></pre><figure class="mo mp mq mr gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ny"><img src="../Images/dfaea32995ae7cf6b3462908acdc4792.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LLMi_qQpE5Tb1P8O63P9Zg.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 4</figcaption></figure><p id="b574" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">日、周、月、季度和年的平均全球有功功率重新采样</p><h1 id="771b" class="lq lr jf bd ls lt lu lv lw lx ly lz ma kl mb km mc ko md kp me kr mf ks mg mh bi translated">总的来说，我们的时间序列没有上升或下降的趋势。最高的平均功耗似乎是在 2007 年之前，实际上是因为我们只有 2007 年 12 月的数据，而那个月是高功耗月。换句话说，如果逐年比较，一直是平稳的。</h1><figure class="mo mp mq mr gt is"><div class="bz fp l di"><div class="nz oa l"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">timeseries_plot.py</figcaption></figure><figure class="mo mp mq mr gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ob"><img src="../Images/db966e6f82be6dcc8d54c4c9aad626c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q1l143_6aSredba6WCrZ8w.png"/></div></div></figure><figure class="mo mp mq mr gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ob"><img src="../Images/8d9fe7eebbd9f92a199d905a7bcebec3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*elxuVoG1JZ4k3xWkHsZ_9g.png"/></div></div></figure><figure class="mo mp mq mr gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi oc"><img src="../Images/a7539fd62148fea1b10088f70a99bef2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7ZodE8tdX98HGPMpEECEug.png"/></div></div></figure><figure class="mo mp mq mr gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi od"><img src="../Images/4eba10c005ff736df1b0d18d0b542b53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m70T6psxaS64c_GWt7uj-w.png"/></div></div></figure><figure class="mo mp mq mr gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi oe"><img src="../Images/dcf6725985d570434945c69ade859002.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CFEGvZ4t-iPKZH8ciOjEew.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 5</figcaption></figure><p id="acd8" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">按年、季度、月和日分组的全球平均有功功率图</p><h1 id="1913" class="lq lr jf bd ls lt lu lv lw lx ly lz ma kl mb km mc ko md kp me kr mf ks mg mh bi translated">以上情节证实了我们之前的发现。到了 2008 年，情况稳定了下来。按季度来看，平均功耗最低的是第三季度。按月份来看，平均用电量最低的是 7 月和 8 月。白天，平均功耗最低的时候是在 8 号左右(不知道为什么)。</h1><figure class="mo mp mq mr gt is"><div class="bz fp l di"><div class="nz oa l"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">grouped_plot.py</figcaption></figure><figure class="mo mp mq mr gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi of"><img src="../Images/55999e646d21937355687da880709d96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gg63jSml7Sm5T611PSidmQ.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 6</figcaption></figure><p id="2773" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">按年份划分的全球有功功率</p><h1 id="d5f8" class="lq lr jf bd ls lt lu lv lw lx ly lz ma kl mb km mc ko md kp me kr mf ks mg mh bi translated">这一次，我们去掉 2006。</h1><p id="a92e" class="pw-post-body-paragraph ku kv jf kw b kx mi kg kz la mj kj lc ld mk lf lg lh ml lj lk ll mm ln lo lp ij bi translated">从 2007 年到 2010 年，每年的情况都差不多。</p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="57fc" class="mx lr jf mt b gy my mz l na nb">pd.pivot_table(df.loc[df['year'] != 2006], values = "Global_active_power", <br/>               columns = "year", index = "month").plot(subplots = True, figsize=(12, 12), layout=(3, 5), sharey=True);</span></pre><figure class="mo mp mq mr gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi og"><img src="../Images/36b03c89f7b3114d21222b451e35de26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eP6V7FHLsCTT1ZZoDIqDqA.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 7</figcaption></figure><p id="d66a" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">工作日与周末的全球有功功耗</p><h1 id="96c0" class="lq lr jf bd ls lt lu lv lw lx ly lz ma kl mb km mc ko md kp me kr mf ks mg mh bi translated">2010 年之前，工作日的全球有功功率中值似乎低于周末。2010 年，他们是一模一样的。</h1><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="45b8" class="mx lr jf mt b gy my mz l na nb">dic={0:'Weekend',1:'Weekday'}<br/>df['Day'] = df.weekday.map(dic)</span><span id="80ad" class="mx lr jf mt b gy nc mz l na nb">a=plt.figure(figsize=(9,4)) <br/>plt1=sns.boxplot('year','Global_active_power',hue='Day',width=0.6,fliersize=3,<br/>                    data=df)                                                                                                                                                                                                                                                                                                                                                 <br/>a.legend(loc='upper center', bbox_to_anchor=(0.5, 1.00), shadow=True, ncol=2)<br/>sns.despine(left=True, bottom=True) <br/>plt.xlabel('')<br/>plt.tight_layout()                                                                                                                  <br/>plt.legend().set_visible(False);</span></pre><figure class="mo mp mq mr gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi oh"><img src="../Images/0c19803809c3e680e732e304c470d7a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fyvGi1CgsMyocGBcVkREPQ.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 8</figcaption></figure><p id="1d60" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">按工作日与周末划分的全球有功功率因数图</p><h1 id="d313" class="lq lr jf bd ls lt lu lv lw lx ly lz ma kl mb km mc ko md kp me kr mf ks mg mh bi translated">工作日和周末全年都遵循类似的模式。</h1><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="9437" class="mx lr jf mt b gy my mz l na nb">plt1=sns.factorplot('year','Global_active_power',hue='Day',<br/>                    data=df, size=4, aspect=1.5, legend=False)                                                                                                                                                                                                                                                                                                                                             <br/>plt.title('Factor Plot of Global active power by Weekend/Weekday')                                                             <br/>plt.tight_layout()                                                                                                                  <br/>sns.despine(left=True, bottom=True) <br/>plt.legend(loc='upper right');</span></pre><figure class="mo mp mq mr gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi oi"><img src="../Images/001c317150fe6c55ec8fa79726c487ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5XXi-NhDOonLL8yrh6QqQQ.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 9</figcaption></figure><p id="cad7" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">原则上，当我们使用<a class="ae mn" href="https://en.wikipedia.org/wiki/Long_short-term_memory" rel="noopener ugc nofollow" target="_blank"><strong class="kw jg"><em class="nu"/></strong></a>时，我们不需要检查<a class="ae mn" href="https://en.wikipedia.org/wiki/Stationary_process" rel="noopener ugc nofollow" target="_blank"> <strong class="kw jg"> <em class="nu">的平稳性</em> </strong> </a>也不需要对其进行校正。但是，如果数据是静态的，这将有助于提高性能，并使神经网络更容易学习。</p><p id="0645" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">平稳性</p><h1 id="eab0" class="lq lr jf bd ls lt lu lv lw lx ly lz ma kl mb km mc ko md kp me kr mf ks mg mh bi translated">在统计学中，<a class="ae mn" href="https://en.wikipedia.org/wiki/Dickey%E2%80%93Fuller_test" rel="noopener ugc nofollow" target="_blank"> <strong class="kw jg"> <em class="nu">迪基-富勒检验</em> </strong> </a>检验自回归模型中存在单位根的零假设。备选假设根据使用的测试版本而不同，但通常是<a class="ae mn" href="https://en.wikipedia.org/wiki/Stationary_process" rel="noopener ugc nofollow" target="_blank">平稳性</a>或<a class="ae mn" href="https://en.wikipedia.org/wiki/Trend_stationary" rel="noopener ugc nofollow" target="_blank">趋势平稳性</a>。</h1><p id="c8b2" class="pw-post-body-paragraph ku kv jf kw b kx mi kg kz la mj kj lc ld mk lf lg lh ml lj lk ll mm ln lo lp ij bi translated">平稳序列在一段时间内具有恒定的均值和方差。时间序列的滚动平均值和滚动标准差不随时间变化。</p><p id="1c07" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">迪基-富勒试验</p><h1 id="25e4" class="lq lr jf bd ls lt lu lv lw lx ly lz ma kl mb km mc ko md kp me kr mf ks mg mh bi translated"><a class="ae mn" href="https://en.wikipedia.org/wiki/Null_hypothesis" rel="noopener ugc nofollow" target="_blank"><strong class="kw jg"><em class="nu"/></strong></a>【H0】:暗示时间序列有单位根，意味着它是非平稳的。它有一些依赖于时间的结构。</h1><p id="85cb" class="pw-post-body-paragraph ku kv jf kw b kx mi kg kz la mj kj lc ld mk lf lg lh ml lj lk ll mm ln lo lp ij bi translated"><a class="ae mn" href="https://en.wikipedia.org/wiki/Alternative_hypothesis" rel="noopener ugc nofollow" target="_blank"> <strong class="kw jg"> <em class="nu">交替假设</em></strong></a>【H1】:暗示时间序列没有单位根，意味着它是平稳的。它没有依赖于时间的结构。</p><p id="7861" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">p 值&gt; 0.05:接受零假设(H0)，数据有单位根，非平稳。</p><p id="93f8" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">p 值&lt; = 0.05:拒绝零假设(H0)，数据没有单位根，是平稳的。</p><p id="0f77" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">从上述结果，我们将拒绝零假设 H0，数据没有单位根，是平稳的。</p><figure class="mo mp mq mr gt is"><div class="bz fp l di"><div class="nz oa l"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">stationarity.py</figcaption></figure><figure class="mo mp mq mr gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi oj"><img src="../Images/105e0ab2b179cd0966ae1a229a8ed0c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*teCNF7iDamLWXTVFWOF3ew.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 10</figcaption></figure><p id="ed17" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">LSTM</p><h1 id="79f7" class="lq lr jf bd ls lt lu lv lw lx ly lz ma kl mb km mc ko md kp me kr mf ks mg mh bi translated">这里的任务是预测一个时间序列的值，给定一个家庭 200 万分钟的电力消耗历史。我们将使用多层 LSTM 递归神经网络来预测值序列的最后一个值。</h1><p id="aa82" class="pw-post-body-paragraph ku kv jf kw b kx mi kg kz la mj kj lc ld mk lf lg lh ml lj lk ll mm ln lo lp ij bi translated">如果您想要减少计算时间，并且还想快速获得测试模型的结果，您可能想要在一个小时内对数据进行重新采样。我会把它记录下来。</p><p id="7106" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">在构建 LSTM 模型之前，需要进行以下数据预处理和特征工程。</p><p id="d186" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">创建数据集，确保所有数据都是浮动的。</p><ul class=""><li id="8eb6" class="ne nf jf kw b kx ky la lb ld ng lh nh ll ni lp nj nk nl nm bi translated">将特征标准化。</li><li id="86b2" class="ne nf jf kw b kx nn la no ld np lh nq ll nr lp nj nk nl nm bi translated">分为训练集和测试集。</li><li id="8ec7" class="ne nf jf kw b kx nn la no ld np lh nq ll nr lp nj nk nl nm bi translated">将值数组转换为数据集矩阵。</li><li id="c923" class="ne nf jf kw b kx nn la no ld np lh nq ll nr lp nj nk nl nm bi translated">重塑成 X=t，Y=t+1。</li><li id="be1c" class="ne nf jf kw b kx nn la no ld np lh nq ll nr lp nj nk nl nm bi translated">将输入整形为 3D(样本数，时间步长数，要素数)。</li><li id="fee5" class="ne nf jf kw b kx nn la no ld np lh nq ll nr lp nj nk nl nm bi translated">模型架构</li></ul><figure class="mo mp mq mr gt is"><div class="bz fp l di"><div class="nz oa l"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">lstm_data_preprocessing.py</figcaption></figure><h1 id="a5dc" class="lq lr jf bd ls lt lu lv lw lx ly lz ma kl mb km mc ko md kp me kr mf ks mg mh bi translated">定义 LSTM，第一个隐层 100 个神经元，输出层 1 个神经元，用于预测全局有功功率。输入形状将是具有 30 个特征的 1 个时间步长。</h1><ul class=""><li id="0396" class="ne nf jf kw b kx mi la mj ld ok lh ol ll om lp nj nk nl nm bi translated">退学 20%。</li><li id="cc5f" class="ne nf jf kw b kx nn la no ld np lh nq ll nr lp nj nk nl nm bi translated">使用 MSE 损失函数和有效的随机梯度下降的 Adam 版本。</li><li id="fa4e" class="ne nf jf kw b kx nn la no ld np lh nq ll nr lp nj nk nl nm bi translated">该模型将适合 20 个训练时期，批量大小为 70。</li><li id="233d" class="ne nf jf kw b kx nn la no ld np lh nq ll nr lp nj nk nl nm bi translated">做预测</li></ul><figure class="mo mp mq mr gt is"><div class="bz fp l di"><div class="nz oa l"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">lstm_timeseries.py</figcaption></figure><h1 id="0472" class="lq lr jf bd ls lt lu lv lw lx ly lz ma kl mb km mc ko md kp me kr mf ks mg mh bi translated">绘图模型损失</h1><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="4e2e" class="mx lr jf mt b gy my mz l na nb">train_predict = model.predict(X_train)<br/>test_predict = model.predict(X_test)<br/># invert predictions<br/>train_predict = scaler.inverse_transform(train_predict)<br/>Y_train = scaler.inverse_transform([Y_train])<br/>test_predict = scaler.inverse_transform(test_predict)<br/>Y_test = scaler.inverse_transform([Y_test])</span><span id="5b23" class="mx lr jf mt b gy nc mz l na nb">print('Train Mean Absolute Error:', mean_absolute_error(Y_train[0], train_predict[:,0]))<br/>print('Train Root Mean Squared Error:',np.sqrt(mean_squared_error(Y_train[0], train_predict[:,0])))<br/>print('Test Mean Absolute Error:', mean_absolute_error(Y_test[0], test_predict[:,0]))<br/>print('Test Root Mean Squared Error:',np.sqrt(mean_squared_error(Y_test[0], test_predict[:,0])))</span></pre><figure class="mo mp mq mr gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi on"><img src="../Images/23d816f54bef9a56a1557d6e4056d054.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b8JlFAzFOi6oihjc915gOg.png"/></div></div></figure><h1 id="e727" class="lq lr jf bd ls lt lu lv lw lx ly lz ma kl mb km mc ko md kp me kr mf ks mg mh bi translated">比较实际与预测</h1><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="7e3b" class="mx lr jf mt b gy my mz l na nb">plt.figure(figsize=(8,4))<br/>plt.plot(history.history['loss'], label='Train Loss')<br/>plt.plot(history.history['val_loss'], label='Test Loss')<br/>plt.title('model loss')<br/>plt.ylabel('loss')<br/>plt.xlabel('epochs')<br/>plt.legend(loc='upper right')<br/>plt.show();</span></pre><figure class="mo mp mq mr gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi oo"><img src="../Images/a81fb56cf2c0d6d8484db64c50aa5ae5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z6VdZ3BazbPmGmDIN0P8OA.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 11</figcaption></figure><h1 id="573e" class="lq lr jf bd ls lt lu lv lw lx ly lz ma kl mb km mc ko md kp me kr mf ks mg mh bi translated">对我来说，每一个时间步都是一分钟。如果您提前一个多小时重新采样数据，那么每个时间步长就是一个小时。</h1><p id="dafe" class="pw-post-body-paragraph ku kv jf kw b kx mi kg kz la mj kj lc ld mk lf lg lh ml lj lk ll mm ln lo lp ij bi translated">我将比较过去 200 分钟的实际和预测。</p><p id="5ee6" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">LSTMs 太神奇了！</p><pre class="mo mp mq mr gt ms mt mu mv aw mw bi"><span id="5555" class="mx lr jf mt b gy my mz l na nb">aa=[x for x in range(200)]<br/>plt.figure(figsize=(8,4))<br/>plt.plot(aa, Y_test[0][:200], marker='.', label="actual")<br/>plt.plot(aa, test_predict[:,0][:200], 'r', label="prediction")<br/># plt.tick_params(left=False, labelleft=True) #remove ticks<br/>plt.tight_layout()<br/>sns.despine(top=True)<br/>plt.subplots_adjust(left=0.07)<br/>plt.ylabel('Global_active_power', size=15)<br/>plt.xlabel('Time step', size=15)<br/>plt.legend(fontsize=15)<br/>plt.show();</span></pre><figure class="mo mp mq mr gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi op"><img src="../Images/e78adece980fc04c23b3f7bd88e08016.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fNpJ18MfE32UD0ib3LnrfA.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Figure 12</figcaption></figure><p id="2f85" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">Jupyter 笔记本可以在<a class="ae mn" href="https://github.com/susanli2016/Machine-Learning-with-Python/blob/master/LSTM%20Time%20Series%20Power%20Consumption.ipynb" rel="noopener ugc nofollow" target="_blank"> Github </a>上找到。享受这周剩下的时光吧！</p><p id="5264" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">参考:</p><p id="f20e" class="pw-post-body-paragraph ku kv jf kw b kx ky kg kz la lb kj lc ld le lf lg lh li lj lk ll lm ln lo lp ij bi translated">Keras 中 LSTMs 的多元时间序列预测</p><div class="ip iq gp gr ir oq"><a href="https://machinelearningmastery.com/multivariate-time-series-forecasting-lstms-keras/" rel="noopener  ugc nofollow" target="_blank"><div class="or ab fo"><div class="os ab ot cl cj ou"><h2 class="bd jg gy z fp ov fr fs ow fu fw je bi translated">像长短期记忆(LSTM)循环神经网络这样的神经网络能够几乎无缝地模拟…</h2><div class="ox l"><h3 class="bd b gy z fp ov fr fs ow fu fw dk translated">machinelearningmastery.com</h3></div><div class="oy l"><p class="bd b dl z fp ov fr fs ow fu fw dk">machinelearningmastery.com</p></div></div><div class="oz l"><div class="pa l pb pc pd oz pe ix oq"/></div></div></a></div></div></div>    
</body>
</html>