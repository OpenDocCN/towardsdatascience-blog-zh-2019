<html>
<head>
<title>Dating App Matching Optimization Development</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">交友 App 匹配优化开发</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/dating-app-matching-optimization-development-d42ace4ed83c?source=collection_archive---------39-----------------------#2019-09-17">https://towardsdatascience.com/dating-app-matching-optimization-development-d42ace4ed83c?source=collection_archive---------39-----------------------#2019-09-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="ed9b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">来自 Dine 首席执行官在 PyCon JP 2019 的体验</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/bb584d66e77d8533c55c011308bec49e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IAffMd30Fk4ciLbLcIxw-A.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Photo by <a class="ae ky" href="https://unsplash.com/@freestocks?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">freestocks.org</a> on <a class="ae ky" href="https://unsplash.com/search/photos/dating?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="2746" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://pycon.jp/2019/" rel="noopener ugc nofollow" target="_blank"> PyCon JP 2019 </a>于 2019/9/16~ 2019/9/17 举办，为期两天。这个帖子是关于第二天的一个讲座。</p><p id="bdb3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://twitter.com/_ok_mario" rel="noopener ugc nofollow" target="_blank">盛冈孝</a>是约会应用<a class="ae ky" href="http://dine.dating/" rel="noopener ugc nofollow" target="_blank"> Dine </a>的首席执行官。他的演讲主要集中在他在匹配优化方面的开发经验。数据处理在 Google Cloud data flow(Apache Beam Python SDK)下，ML 部分由 Cloud ML 引擎完成。<a class="ae ky" href="https://drive.google.com/file/d/1SXn7_u9OddelLPQ0Jn2H8vflL-hBp2Az/view" rel="noopener ugc nofollow" target="_blank">幻灯片</a>在这里。</p><h1 id="108c" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">背景</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mn"><img src="../Images/9df9f9ab4efa8fa815a4ceb89e76ec79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rBoFHrQv0_CJl_UPjmt-qQ.png"/></div></div></figure><p id="7b89" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">约会应用的目标是匹配两个用户。主要的匹配方法有两种，搜索法和推荐法。</p><ul class=""><li id="575c" class="mo mp it lb b lc ld lf lg li mq lm mr lq ms lu mt mu mv mw bi translated">搜索方法:用户根据自己的喜好进行搜索</li><li id="0570" class="mo mp it lb b lc mx lf my li mz lm na lq nb lu mt mu mv mw bi translated">推荐方式:交友网站会为用户推荐候选人</li></ul><p id="c739" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">盛冈隆告诉 Dine 主要采用推荐法。</p><p id="4bb3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了解决<a class="ae ky" href="https://www.wikiwand.com/en/Stable_marriage_problem" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">稳定婚姻问题</strong> </a>，Dine 采用了<a class="ae ky" rel="noopener" target="_blank" href="/gale-shapley-algorithm-simply-explained-caa344e643c2"> <strong class="lb iu">大风</strong>–<strong class="lb iu">沙普利算法</strong> </a> <strong class="lb iu">。</strong>但是这个算法有一个很大的问题，计算成本巨大。</p><h1 id="f41a" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">降低计算成本</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/7971278a5ff22250f04ac8395d669660.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*eSCZMzNMYHCoAfZMskFobQ.png"/></div></figure><p id="cac6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">看，我们总共有 N 个用户。我们首先计算用户 A 相对于其他 N-1 个用户的得分。然后，我们对 N 个用户进行排名，为用户 a 进行推荐，运行时间将为 O(N log N)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/b06c4b2419e21f5ce27bedc1ef577ec9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1368/format:webp/1*L_gVa32dYv2T88W4dK9u3w.png"/></div></figure><p id="d037" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了降低计算成本，Dine 将用户分成不同的组(演讲者没有提到划分标准)。分组的优点是可以将用户数从 N 个减少到组数，并可以并行计算得分。</p><p id="48d2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但还是有两个问题。</p><ul class=""><li id="ae98" class="mo mp it lb b lc ld lf lg li mq lm mr lq ms lu mt mu mv mw bi translated">匹配性能低</li><li id="50bf" class="mo mp it lb b lc mx lf my li mz lm na lq nb lu mt mu mv mw bi translated">分组方法对少数用户产生了不良影响</li></ul><p id="c2ab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是演讲者没有提到如何解决这些问题。他在接下来的演讲中主要讲了如何提高计算能力。</p><h1 id="8ff8" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">基础设施改善</h1><p id="1880" class="pw-post-body-paragraph kz la it lb b lc ne ju le lf nf jx lh li ng lk ll lm nh lo lp lq ni ls lt lu im bi translated">原来的系统架构如下图所示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/945dbfb67e0dac0fcfdf11ffd99c2a81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*egu7l-SINmaLGZxmZLfwug.png"/></div></div></figure><p id="c221" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">AppEngine 正在进行匹配过程计算。但是对于 GAE 实例的 CPU 和内存来说，计算量仍然很大。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nk"><img src="../Images/3b0079863ab6b3619c896eb48a63dad5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H3kB2hw3l4SQVj5rNwVtlw.png"/></div></div></figure><p id="f139" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">来解决问题。Dine 用提供 Java 和 Python SDK 的 Could Dataflow 代替 GAE。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/65c09929cbd0943991b1ac0ed5af102b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t06sQ9ornYcK5IYVSbcxHw.png"/></div></div></figure><p id="eb63" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个系统的容量比以前增加了 10 倍。</p><h1 id="7468" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">与 can AutoML 表集成</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nm"><img src="../Images/cd8b29fa5c133a07c0f83e0a2e9ac80f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VhG4KwmKxa6whkDknEsxrw.png"/></div></div></figure><p id="aaca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据流的一个优势是与其他机器学习服务的高度兼容性。Dine 使用 Cloud AutoML Table 从用户配置文件中构建表格功能。它会自动调整参数。第一天介绍 AutoML，<a class="ae ky" href="https://medium.com/@bramblexu/overview-of-automl-from-pycon-jp-2019-c8996954692f" rel="noopener">业界使用的 AutoML 库概述</a>。</p><p id="568d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">根据 AB 测试的结果，匹配分数(f1)增加了 20%。以下是演讲者在使用 Cloud AutoML Table 时的一些想法。</p><p id="9574" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">优点:</p><ul class=""><li id="af91" class="mo mp it lb b lc ld lf lg li mq lm mr lq ms lu mt mu mv mw bi translated">使用 BigQuery 很容易</li><li id="a175" class="mo mp it lb b lc mx lf my li mz lm na lq nb lu mt mu mv mw bi translated">批量预测和在线预测非常容易部署</li></ul><p id="41de" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">缺点:</p><ul class=""><li id="51c2" class="mo mp it lb b lc ld lf lg li mq lm mr lq ms lu mt mu mv mw bi translated">无法下载模型</li><li id="6784" class="mo mp it lb b lc mx lf my li mz lm na lq nb lu mt mu mv mw bi translated">不知道模型架构</li></ul><blockquote class="nn no np"><p id="7999" class="kz la nq lb b lc ld ju le lf lg jx lh nr lj lk ll ns ln lo lp nt lr ls lt lu im bi translated"><strong class="lb iu"> <em class="it">查看我的其他帖子</em> </strong> <a class="ae ky" href="https://medium.com/@bramblexu" rel="noopener"> <strong class="lb iu"> <em class="it">中等</em> </strong> </a> <strong class="lb iu"> <em class="it">同</em> </strong> <a class="ae ky" href="https://bramblexu.com/posts/eb7bd472/" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu"> <em class="it">一分类查看</em> </strong> </a> <strong class="lb iu"> <em class="it">！<br/>GitHub:</em></strong><a class="ae ky" href="https://github.com/BrambleXu" rel="noopener ugc nofollow" target="_blank"><strong class="lb iu"><em class="it">bramble Xu</em></strong></a><strong class="lb iu"><em class="it"><br/>LinkedIn:</em></strong><a class="ae ky" href="https://www.linkedin.com/in/xu-liang-99356891/" rel="noopener ugc nofollow" target="_blank"><strong class="lb iu"><em class="it">徐亮</em> </strong> </a> <strong class="lb iu"> <em class="it"> <br/>博客:</em></strong><a class="ae ky" href="https://bramblexu.com" rel="noopener ugc nofollow" target="_blank"><strong class="lb iu"><em class="it">bramble Xu</em></strong></a></p></blockquote><h1 id="a267" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">参考</h1><ul class=""><li id="2499" class="mo mp it lb b lc ne lf nf li nu lm nv lq nw lu mt mu mv mw bi translated"><a class="ae ky" href="https://pycon.jp/2019/schedule/?sessionId=207" rel="noopener ugc nofollow" target="_blank">https://pycon.jp/2019/schedule/?sessionId=207</a></li><li id="e1b3" class="mo mp it lb b lc mx lf my li mz lm na lq nb lu mt mu mv mw bi translated"><a class="ae ky" href="https://drive.google.com/file/d/1SXn7_u9OddelLPQ0Jn2H8vflL-hBp2Az/view" rel="noopener ugc nofollow" target="_blank">https://drive . Google . com/file/d/1 sxn 7 _ u 9 oddell pq 0 jn 2h 8 vfll-HBP 2 az/view</a></li></ul></div></div>    
</body>
</html>