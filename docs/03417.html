<html>
<head>
<title>How to build production-scale, cloud ML model in few minutes!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在几分钟内构建生产规模的云 ML 模型！</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-build-production-scale-cloud-ml-model-in-few-minutes-7d1bc59deac9?source=collection_archive---------22-----------------------#2019-05-31">https://towardsdatascience.com/how-to-build-production-scale-cloud-ml-model-in-few-minutes-7d1bc59deac9?source=collection_archive---------22-----------------------#2019-05-31</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="cbac" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">仅使用 Google Cloud 上的 SQL，在几分钟内构建、训练和部署一个机器学习模型。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/1a1e56638626d4152b5e574167600b55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*0PCgHG2hB4wboDEA"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Photo by <a class="ae ky" href="https://unsplash.com/@markusspiske?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Markus Spiske</a> on <a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="421f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">作为在云计算市场获得更大市场份额的努力的一部分，谷歌云一直在为其平台添加强大的工具，特别是在人工智能方面。其中一个工具是 BigQuery ML，它使用户能够在几分钟内开发和训练大型数据集的 ML 模型！</p><p id="521f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果您还不熟悉它，BigQuery 是一个无服务器的数据仓库，支持 SQL 查询，您只需为查询数据的使用和存储付费(它“类似”于 AWS 上的 Redshift)。</p><p id="0c8e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">自 2018 年年中以来，BigQuery 已使用户能够在几分钟内用几行 SQL 代码构建 ML 模型。这篇文章将带你经历构建这样的 ML 模型所需的步骤。</p><p id="cc11" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">注</strong>:</p><ul class=""><li id="5ff6" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">用于说明步骤的例子是受 BigQuery 官方教程中的<a class="ae ky" href="https://cloud.google.com/bigquery-ml/docs/bigqueryml-natality" rel="noopener ugc nofollow" target="_blank"> one </a>的启发。</li><li id="356d" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">如果你想执行这里的代码，你可以在这里找到它<a class="ae ky" href="https://github.com/nezar-a/tutorials/blob/master/bigquery_ml_demo.ipynb" rel="noopener ugc nofollow" target="_blank"/>。</li></ul><h2 id="3251" class="mj mk it bd ml mm mn dn mo mp mq dp mr li ms mt mu lm mv mw mx lq my mz na nb bi translated"><strong class="ak"> 1)将您的数据导入 BigQuery: </strong></h2><p id="65f7" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">如果数据还没有加载到 BigQuery 中，有几种方法可以实现。事实上，您不需要像查询外部数据一样将数据加载到 BigQuery 中进行查询。但是，如果您关心速度，将您的数据上传到 BigQuery 是一个好主意。</p><p id="b518" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里，我们将使用<strong class="lb iu">出生率数据集</strong>，其中有 1969 年至 2008 年间美国出生登记的详细信息，来<strong class="lb iu">预测新生儿的体重</strong>。它已经在 BigQuery 中作为公共数据集<a class="ae ky" href="https://bigquery.cloud.google.com/table/publicdata:samples.natality?tab=details" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">在这里</strong> </a>可用。</p><h2 id="f20e" class="mj mk it bd ml mm mn dn mo mp mq dp mr li ms mt mu lm mv mw mx lq my mz na nb bi translated">2)探索和预处理数据:</h2><p id="cbc6" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">让我们通过运行以下查询来考虑数据集中最近 10 年的数据，其中的值是有意义的(即&gt; 0):</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/b186cf592710cc3789eafbf777808671.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fgRLgYFeUrcG0RJx-GzN-Q.png"/></div></div></figure><p id="014c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这产生了下表:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ni nj l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">BigQuery runtime: 2.3s elapsed, 21.9 GB processed</figcaption></figure><p id="fe1f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从上表中可以看出，有几列似乎适合创建要素来预测新生儿的体重，即:</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="8001" class="mj mk it nl b gy np nq l nr ns"><strong class="nl iu">is_male</strong>,<br/><strong class="nl iu">plurality</strong>,(one baby, twins, ...etc)<br/><strong class="nl iu">mother_age</strong>,<br/><strong class="nl iu">gestation_weeks</strong>,(duration of pregnancy in weeks)<br/><strong class="nl iu">weight_gain_pounds </strong>(weight gained by the mother during the pregnancy in pounds)</span></pre><p id="1dbb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，为了检查这些列是否可以被利用到特性中，可以在 Jupyter 或 Datalab 笔记本中对照<code class="fe nt nu nv nl b">weight_pounds</code>列(预测的目标)来绘制这些列，并进行探索。检查缺失数据、稀疏性等。对于良好的特征工程是必不可少的。为了简单起见，让我们跳过这一步，跟着我们的直觉走！</p><h2 id="3ca7" class="mj mk it bd ml mm mn dn mo mp mq dp mr li ms mt mu lm mv mw mx lq my mz na nb bi translated">3)定义和设计特征:</h2><p id="cf3b" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">使用在上一步中选择的将被利用到特性中的列，让我们看看如何在 BigQuery 中编码我们的特性。</p><p id="e6dc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，在 BigQuery ML 中，所有字符串都被视为分类特征，所有数值都被视为连续特征。因此，我们的 5 个特征将定义如下:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/6540f2a3baa324e61bb79d5e4d127262.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IHdf9ggn73ZJlbxa_-NdsA.png"/></div></div></figure><p id="ed51" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">运行上述查询会产生:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ni nj l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">BigQuery runtime: 2.7s elapsed, 6.82 GB processed</figcaption></figure><p id="e522" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意<code class="fe nt nu nv nl b">hashmonth</code>栏。我们为数据集的过去 10 年中的每个月制作了一个哈希值(<code class="fe nt nu nv nl b">year&gt;1998</code>)，以在下一步中无泄漏地分割训练/评估数据集(即，具有相同出生日期的婴儿应该在训练或评估集中)。</p><h2 id="59a7" class="mj mk it bd ml mm mn dn mo mp mq dp mr li ms mt mu lm mv mw mx lq my mz na nb bi translated">3)创建和训练 ML 模型:</h2><p id="8ec4" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">在创建 ML 模型之前，需要一个 BigQuery 数据集来存储模型，这可以通过在 BiQuery web UI 中单击“创建数据集”来轻松创建。让我们把这个数据集命名为<code class="fe nt nu nv nl b">BigQDemo</code>。</p><p id="f00e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">SQL 命令<code class="fe nt nu nv nl b">CREATE MODEL</code>创建并训练模型。因为我们预测的是新生儿的体重，这是一个连续的值，所以在下面的查询中为<code class="fe nt nu nv nl b">model_type</code>选择了一个线性回归模型。运行这个查询(大约需要 4 分钟)创建并训练一个名为<code class="fe nt nu nv nl b">NewBornWeight_Model</code>的 ML 模型！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/b77f968b58baa6e8c1eed8709a90adaf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cTfc5WmADUnv54nGLkDgYA.png"/></div></div></figure><p id="9667" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">经过训练的模型以表格的形式出现在<code class="fe nt nu nv nl b">BigQDemo</code>数据集下:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/1b8b61f79980e9703c3650775e051aa7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pLc5FV7gexP_Lp68lBnOhg.png"/></div></div></figure><p id="be9c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">可以通过浏览<code class="fe nt nu nv nl b">NewBornWeight_Model</code>表或运行以下查询来查看培训统计数据，如损失和学习率:</p><pre class="kj kk kl km gt nk nl nm nn aw no bi"><span id="e8e3" class="mj mk it nl b gy np nq l nr ns">SELECT * FROM ML.TRAINING_INFO(MODEL BigQDemo.NewBornWeight_Model);</span></pre><p id="e57c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您可以在官方文档<a class="ae ky" href="https://cloud.google.com/bigquery-ml/docs/reference/standard-sql/bigqueryml-syntax-create" rel="noopener ugc nofollow" target="_blank">这里</a>找到 BigQuery ML 的所有其他模型类型和可选参数。</p><h2 id="f951" class="mj mk it bd ml mm mn dn mo mp mq dp mr li ms mt mu lm mv mw mx lq my mz na nb bi translated">4)评估训练好的模型:</h2><p id="c419" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">命令<code class="fe nt nu nv nl b">ML.EVALUATE</code>用于评估已训练的模型。在我们的例子中，让我们对训练期间没有使用的剩余 20%的数据评估模型(参见下面查询中的条件<code class="fe nt nu nv nl b">AND MOD (..., 5)&gt;= 4</code>):</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/06c65c63886073b3ebc30d3720d0613a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0Izgx2LqRSBbpAPw9a1w1w.png"/></div></div></figure><p id="6158" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这产生了以下结果:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oa nj l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">BigQuery runtime: 2.5s elapsed, 6.82 GB processed</figcaption></figure><h2 id="12eb" class="mj mk it bd ml mm mn dn mo mp mq dp mr li ms mt mu lm mv mw mx lq my mz na nb bi translated">5)用你的模型预测</h2><p id="e89e" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">当您对您的模型感到满意时，您可以使用命令<code class="fe nt nu nv nl b">ML.PREDICT</code>来使用它进行预测。让我们根据过去 10 年的出生数据预测 50 个婴儿的体重:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ob"><img src="../Images/43acf3751313f198f2424735f50aa7f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LL_FCj-AShqWRWl1EYJLmg.png"/></div></div></figure><p id="ab8a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如下表所示，当使用<code class="fe nt nu nv nl b">ml.PREDICT</code>命令时，预测列自动命名为<code class="fe nt nu nv nl b">predicted_&lt;label_column_name&gt;</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ni nj l"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">BigQuery runtime: 1.0s elapsed, 5.80 GB processed</figcaption></figure><p id="15fa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这样，您就有了一个功能完整的 ML 模型！</p><p id="3db6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">BigQuery ML 不仅有助于构建 ML 模型作为 Google Cloud 数据管道的一部分，或者使非技术人员能够运行 ML 模型；而且还可以快速测试新设计的复杂 ML 特征的效果，例如在大型数据集上。因此，当直接从开发环境(例如 Jupyter notebooks)执行时，BigQuery ML 对 ML 开发人员特别有用。</p></div></div>    
</body>
</html>