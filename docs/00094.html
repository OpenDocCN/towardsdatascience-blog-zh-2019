<html>
<head>
<title>Scraping Reddit data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">抓取 Reddit 数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/scraping-reddit-data-1c0af3040768?source=collection_archive---------1-----------------------#2019-01-05">https://towardsdatascience.com/scraping-reddit-data-1c0af3040768?source=collection_archive---------1-----------------------#2019-01-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="132a" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">如何使用 Python Reddit API 包装器从 Reddit 抓取数据(PRAW)</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/3f243b33a41133b40c59a1fd8f0d6fcf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*a1C0BvBtLQWQPHz4"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo by <a class="ae kv" href="https://unsplash.com/@grohsfabian?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Fabian Grohs</a> on <a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="8229" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">顾名思义，PRAW 是 Reddit API 的 Python 包装器，它使你能够从子编辑中抓取数据，创建机器人等等。</p><p id="f0ca" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这篇文章中，我们将学习如何使用 PRAW 从不同的子编辑中抓取帖子，以及如何从特定的帖子中获取评论。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="4fa2" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">入门指南</h1><p id="becd" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">PRAW 可以使用 pip 或 conda 安装:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="6a44" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">现在 PRAW 可以通过写:</p><pre class="kg kh ki kj gt my mz na nb aw nc bi"><span id="6837" class="nd ma iq mz b gy ne nf l ng nh">import praw</span></pre><p id="8f01" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在它被用来收集数据之前，我们需要验证自己的身份。为此，我们需要创建一个 Reddit 实例，并为其提供一个<code class="fe ni nj nk mz b">client_id</code>、<code class="fe ni nj nk mz b">client_secret</code>和一个<code class="fe ni nj nk mz b">user_agent</code>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="35ae" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了获得认证信息，我们需要创建一个 reddit 应用程序，方法是导航到<a class="ae kv" href="https://www.reddit.com/prefs/apps" rel="noopener ugc nofollow" target="_blank">此页面</a>并单击<strong class="ky ir">创建应用程序</strong>或<strong class="ky ir">创建另一个应用程序。</strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nl"><img src="../Images/5e7ff4d122c0476b4add2db4bef9a18f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GQ8IREDENnkCRQT3VS55mQ.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Figure 1: Reddit Application</figcaption></figure><p id="ac37" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这将打开一个表单，您需要在其中填写名称、描述和重定向 uri。对于重定向 uri，你应该选择<code class="fe ni nj nk mz b">http://localhost:8080</code>，正如优秀的<a class="ae kv" href="https://praw.readthedocs.io/en/latest/getting_started/authentication.html#script-application" rel="noopener ugc nofollow" target="_blank"> PRAW 文档</a>中所描述的。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nm"><img src="../Images/fa15da0225e5b2a43437e09c1a92b9a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ssLYczSLGzfm6SPM7mWzBg.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Figure 2: Create new Reddit Application</figcaption></figure><p id="8009" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">按下<strong class="ky ir">创建应用程序</strong>后，一个新的应用程序将会出现。在这里，您可以找到创建<code class="fe ni nj nk mz b">praw.Reddit </code>实例所需的认证信息。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nn"><img src="../Images/2f25fa2179d8b31f03dfd45d139fb520.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*khszOCCaCtqZ6jM19uhpiQ.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Figure 3: Authentication information</figcaption></figure></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="3e50" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">获取子编辑数据</h1><p id="fd3a" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">现在我们有了一个<code class="fe ni nj nk mz b">praw.Reddit</code>实例，我们可以访问所有可用的函数并使用它，例如从机器学习子编辑中获取 10 个“最热门”的帖子。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="a672" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">输出:</p><pre class="kg kh ki kj gt my mz na nb aw nc bi"><span id="3050" class="nd ma iq mz b gy ne nf l ng nh">[D] What is the best ML paper you read in 2018 and why?<br/>[D] Machine Learning - WAYR (What Are You Reading) - Week 53<br/>[R] A Geometric Theory of Higher-Order Automatic Differentiation<br/>UC Berkeley and Berkeley AI Research published all materials of CS 188: Introduction to Artificial Intelligence, Fall 2018<br/>[Research] Accurate, Data-Efficient, Unconstrained Text Recognition with Convolutional Neural Networks<br/>...</span></pre><p id="4fbd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们还可以通过指定“all”作为子编辑的名称，得到所有子编辑的 10 个“最热门”的帖子。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="2905" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">输出:</p><pre class="kg kh ki kj gt my mz na nb aw nc bi"><span id="a119" class="nd ma iq mz b gy ne nf l ng nh">I've been lying to my wife about film plots for years.<br/>I don’t care if this gets downvoted into oblivion! I DID IT REDDIT!!<br/>I’ve had enough of your shit, Karen<br/>Stranger Things 3: Coming July 4th, 2019<br/>...</span></pre><p id="b294" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个变量可以被迭代，包括文章标题、id 和 url 在内的特征可以被提取并保存到一个<code class="fe ni nj nk mz b">.csv</code>文件中。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mw mx l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi no"><img src="../Images/1eed3417e2705dc413a6889c83481a9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4fc6B-hv_KNSXED32HR_xA.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Figure 4: Hottest ML posts</figcaption></figure><p id="9293" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用 subreddit 对象上的<code class="fe ni nj nk mz b">.description</code>函数可以获得 subreddit 的一般信息。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="9b95" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">输出:</p><pre class="kg kh ki kj gt my mz na nb aw nc bi"><span id="613e" class="nd ma iq mz b gy ne nf l ng nh">**[Rules For Posts](https://www.reddit.com/r/MachineLearning/about/rules/)**<br/>--------<br/>+[Research](https://www.reddit.com/r/MachineLearning/search?sort=new&amp;restrict_sr=on&amp;q=flair%3AResearch)<br/>--------<br/>+[Discussion](https://www.reddit.com/r/MachineLearning/search?sort=new&amp;restrict_sr=on&amp;q=flair%3ADiscussion)<br/>--------<br/>+[Project](https://www.reddit.com/r/MachineLearning/search?sort=new&amp;restrict_sr=on&amp;q=flair%3AProject)<br/>--------<br/>+[News](https://www.reddit.com/r/MachineLearning/search?sort=new&amp;restrict_sr=on&amp;q=flair%3ANews)<br/>--------<br/>...</span></pre></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="b843" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">从特定帖子中获取评论</h1><p id="cfd5" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">您可以通过创建/获取一个<code class="fe ni nj nk mz b">Submission</code>对象并遍历<code class="fe ni nj nk mz b">comments</code>属性来获取帖子/提交的评论。要获得 post/submission，我们可以遍历 subreddit 的提交，或者使用<code class="fe ni nj nk mz b">reddit.submission</code>指定一个特定的提交，并向其传递提交 url 或 id。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="aad7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要获得<strong class="ky ir">顶级</strong>注释，我们只需迭代<code class="fe ni nj nk mz b">submission.comments</code>即可。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="03e0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这对于某些提交是有效的，但是对于其他有更多评论的提交，这段代码将抛出一个 AttributeError，表示:</p><pre class="kg kh ki kj gt my mz na nb aw nc bi"><span id="3713" class="nd ma iq mz b gy ne nf l ng nh">AttributeError: 'MoreComments' object has no attribute 'body'</span></pre><p id="9606" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这些<code class="fe ni nj nk mz b">MoreComments </code>对象代表在网站上遇到的“加载更多评论”和“继续此主题”链接，在<a class="ae kv" href="https://praw.readthedocs.io/en/latest/tutorials/comments.html" rel="noopener ugc nofollow" target="_blank">评论文档</a>中有更详细的描述。</p><p id="959e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">去掉了<code class="fe ni nj nk mz b">MoreComments</code>对象，我们可以在打印正文之前检查每个注释的数据类型。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="7ca2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是 Praw 已经提供了一个名为<code class="fe ni nj nk mz b">replace_more</code>的方法，它取代或移除了<code class="fe ni nj nk mz b">MoreComments</code>。该方法采用一个名为 limit 的参数，当该参数设置为 0 时，将删除所有的<code class="fe ni nj nk mz b">MoreComments</code>。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="c441" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">以上两个代码块都成功地迭代了所有的<strong class="ky ir">顶级</strong>注释，并打印了它们的正文。输出如下所示。</p><pre class="kg kh ki kj gt my mz na nb aw nc bi"><span id="d20d" class="nd ma iq mz b gy ne nf l ng nh">Source: [https://www.facebook.com/VoyageursWolfProject/](https://www.facebook.com/VoyageursWolfProject/)<br/>I thought this was a shit post made in paint before I read the title<br/>Wow, that’s very cool.  To think how keen their senses must be to recognize and avoid each other and their territories.  Plus, I like to think that there’s one from the white colored clan who just goes way into the other territories because, well, he’s a badass.<br/>That’s really cool. The edges are surprisingly defined.<br/>...</span></pre><p id="851b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然而，评论部分可以任意深入，大多数时候我们当然也想得到评论的评论。<code class="fe ni nj nk mz b">CommentForest</code>提供了<code class="fe ni nj nk mz b">.list </code>方法，可以用来获取评论区内的所有评论。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="mw mx l"/></div></figure><p id="68f6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">上面的代码将首先输出所有的顶级注释，然后是二级注释，依此类推，直到没有剩余的注释。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="d4e8" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">推荐阅读</h1><div class="np nq gp gr nr ns"><a rel="noopener follow" target="_blank" href="/web-scraping-using-selenium-and-beautifulsoup-99195cd70a58"><div class="nt ab fo"><div class="nu ab nv cl cj nw"><h2 class="bd ir gy z fp nx fr fs ny fu fw ip bi translated">使用硒和美丽素的网刮</h2><div class="nz l"><h3 class="bd b gy z fp nx fr fs ny fu fw dk translated">如何使用 Selenium 在页面之间导航，并使用它来废弃加载了 JavaScript 的 HTML。</h3></div><div class="oa l"><p class="bd b dl z fp nx fr fs ny fu fw dk translated">towardsdatascience.com</p></div></div><div class="ob l"><div class="oc l od oe of ob og kp ns"/></div></div></a></div></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="14a5" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">结论</h1><p id="e6c5" class="pw-post-body-paragraph kw kx iq ky b kz mr jr lb lc ms ju le lf mt lh li lj mu ll lm ln mv lp lq lr ij bi translated">Praw 是 Reddit API 的 Python 包装器，它使我们能够通过一个干净的 Python 接口使用 Reddit API。该 API 可用于网络抓取，创建一个机器人以及许多其他。</p><p id="b47f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">本文介绍了身份验证、从子编辑获取帖子以及获取评论。要了解更多关于 API 的信息，我建议看一看他们的<a class="ae kv" href="https://praw.readthedocs.io/en/latest/index.html" rel="noopener ugc nofollow" target="_blank">优秀文档</a>。</p><p id="702f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你喜欢这篇文章，可以考虑订阅我的 Youtube 频道，在社交媒体上关注我。</p><p id="22da" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">本文涵盖的代码可以从<a class="ae kv" href="https://github.com/TannerGilbert/Tutorials/tree/master/Reddit%20Webscraping%20using%20PRAW" rel="noopener ugc nofollow" target="_blank"> Github 资源库</a>获得。</p><p id="98db" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果你有任何问题、建议或批评，可以通过 Twitter 或评论区联系我。</p></div></div>    
</body>
</html>