<html>
<head>
<title>4 Awesome things you can do with Keras and the code you need to make it happen</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Keras 可以做 4 件了不起的事情，以及实现它所需的代码</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/4-awesome-things-you-can-do-with-keras-and-the-code-you-need-to-make-it-happen-858f022eec85?source=collection_archive---------12-----------------------#2019-08-26">https://towardsdatascience.com/4-awesome-things-you-can-do-with-keras-and-the-code-you-need-to-make-it-happen-858f022eec85?source=collection_archive---------12-----------------------#2019-08-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/a0cdd26531524f17d14210ffa09c974e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VN6bGHQnYkd-l2eJlDA_yA.jpeg"/></div></div></figure><blockquote class="kb kc kd"><p id="c5de" class="ke kf kg kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">想获得灵感？快来加入我的<a class="ae ld" href="https://www.superquotes.co/?utm_source=mediumtech&amp;utm_medium=web&amp;utm_campaign=sharing" rel="noopener ugc nofollow" target="_blank"> <strong class="kh iu">超级行情快讯</strong> </a>。😎</p></blockquote><p id="ac86" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">Keras 是最广泛使用的深度学习框架之一。它非常容易使用，但在性能方面仍然与更复杂的库如 TensorFlow、Caffe 和 MXNet 不相上下。除非你在一个应用程序中需要一些非常低级和复杂的代码，否则 Keras 会给你最好的回报！</p><p id="ca22" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">但是 Keras 并不像看上去那样简单。今天，我们分享一些鲜为人知但很棒的事情，以及实现这些事情所需的代码。这些将帮助您直接在 Keras 中编写所有自定义的东西，而不必切换到其他那些更乏味和复杂的库。</p><h1 id="13ec" class="lh li it bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">(1)自定义度量和损失函数</h1><p id="e0fa" class="pw-post-body-paragraph ke kf it kh b ki mf kk kl km mg ko kp le mh ks kt lf mi kw kx lg mj la lb lc im bi translated">Keras 带有许多内置的度量和损失函数，在许多情况下非常有用。然而有些遗憾的是，只有最常见的指标和损失被内置。</p><p id="83bb" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">所有的度量标准基本上都是某种形式的百分比准确度；损失确实有很多选择，但从最新的最先进的研究来看并不多。如果你想要尖端的东西，你需要实现你自己的。</p><p id="11e6" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">我们可以这样做！所有 Keras 损失和度量都以与具有两个输入变量的函数相同的方式定义:地面真实值和预测值；这些函数总是返回度量值或损耗值。你真正需要注意的唯一一件事是，矩阵上的任何操作都应该与<em class="kg"> Keras 或 TensorFlow Tensors </em>兼容，因为这是 Keras 一直期望从这些自定义函数中得到的格式。这可以通过坚持使用 Python math、Keras 或 TensorFlow 操作来实现。</p><p id="fdda" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">似乎很容易！下面是如何创建和应用自定义损失和自定义指标的示例。</p><p id="5489" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">对于度量标准，我实现了<a class="ae ld" href="https://www.mathworks.com/help/vision/ref/psnr.html" rel="noopener ugc nofollow" target="_blank"> PSNR </a>函数，它通常用于测量图像质量。对于损失函数，我实现了 Charbonnier，它比 L1 或 L2 损失对异常值更稳健。一旦函数编写完成，我们只需将它们传递给我们的模型编译函数！</p><figure class="mk ml mm mn gt ju"><div class="bz fp l di"><div class="mo mp l"/></div></figure><h1 id="83c7" class="lh li it bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">(2)自定义图层</h1><p id="6b94" class="pw-post-body-paragraph ke kf it kh b ki mf kk kl km mg ko kp le mh ks kt lf mi kw kx lg mj la lb lc im bi translated">类似于度量和损失函数，如果您想使用标准卷积、池化和激活函数之外的东西，您可能会发现自己需要创建一个自定义层。在这种情况下，您可以按照我下面给出的代码示例来实现它！</p><p id="9117" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">根据 Keras 文档，我们需要实现的两个最重要的是:</p><ul class=""><li id="773e" class="mq mr it kh b ki kj km kn le ms lf mt lg mu lc mv mw mx my bi translated">这是层的逻辑所在。除非您希望您的层支持遮罩，否则您只需关心传递给<code class="fe mz na nb nc b">call</code>的第一个参数:输入张量。</li><li id="e5f0" class="mq mr it kh b ki nd km ne le nf lf ng lg nh lc mv mw mx my bi translated"><code class="fe mz na nb nc b">get_output_shape_for(input_shape)</code>:如果你的层修改了它的输入的形状，你应该在这里指定形状转换逻辑。这允许 Keras 进行自动形状推断。</li></ul><figure class="mk ml mm mn gt ju"><div class="bz fp l di"><div class="mo mp l"/></div></figure><p id="af4f" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">在我的情况下，我想有一个层，可以自动调整图像到任何大小。为此，我需要使用 blinear，双三次，或最近邻调整大小。</p><p id="ca3f" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated"><code class="fe mz na nb nc b">call()</code>函数的第一个输入被定义为<code class="fe mz na nb nc b">x</code>，它是图像张量，第二个输入(可选)被定义为<code class="fe mz na nb nc b">method</code>，它指的是要使用的调整大小的类型。调整尺寸<em class="kg">比例</em>在初始化函数<code class="fe mz na nb nc b">__init__</code>中定义。</p><p id="42df" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">确保坚持 TensorFlow 操作(所以我们总是使用 Keras 或 TensorFlow tensors)，我们根据整数舍入比例调整图像大小并返回图像。在<code class="fe mz na nb nc b">get_output_shape_for()</code>函数中，计算并返回输出张量的完整形状</p><p id="a60e" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">既然我们已经为自定义层编写了代码，假设我们的图像张量被定义为<code class="fe mz na nb nc b">image</code>，我们所要做的就是将它与函数式 API 一起使用，就像这样调用它:</p><p id="5f3e" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated"><strong class="kh iu">image _ 2 = resize _ layer(scale = 2)(image，method= "双线性")</strong></p><h1 id="e00e" class="lh li it bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">(3)内置预处理</h1><p id="d25d" class="pw-post-body-paragraph ke kf it kh b ki mf kk kl km mg ko kp le mh ks kt lf mi kw kx lg mj la lb lc im bi translated">Keras 配备了几个内置模型<a class="ae ld" href="https://keras.io/applications/" rel="noopener ugc nofollow" target="_blank">和 ImageNet 上预先训练好的权重，开箱即可使用。但是，如果你想直接使用这些模型，你需要事先调整你的图像大小，因为最后完全连接的层强制输入大小是固定的。</a></p><p id="622d" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">例如，Xception 模型使用 299x299 的图像裁剪进行训练，因此您的所有图像都必须设置为该大小以避免错误。除此之外，可能还有一些其他类型的模型预处理或后处理，您希望在向其传递图像时自动应用这些预处理或后处理。</p><p id="9233" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">不要再看了！</p><p id="78a7" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">我们可以使用 Keras 的<em class="kg"> Lambda 层</em>对模型进行任何种类的数学或预处理操作<em class="kg">！lambda 将简单地定义您想要应用哪个操作。</em></p><p id="fa1c" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">完整层允许你将功能完全融入到你的模型中。查看下面的代码，了解我们如何在模型中内置调整大小和异常预处理功能！</p><figure class="mk ml mm mn gt ju"><div class="bz fp l di"><div class="mo mp l"/></div></figure><h1 id="7355" class="lh li it bd lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me bi translated">(4)用于重复块的函数</h1><p id="6e8d" class="pw-post-body-paragraph ke kf it kh b ki mf kk kl km mg ko kp le mh ks kt lf mi kw kx lg mj la lb lc im bi translated">如果我们想编写一个大的模型，比如说 50 层甚至 100 层的东西，代码会变得非常混乱。当您必须定义那么多层，并且在所有剩余的或密集的连接之上时，您将到处都是代码！</p><p id="e86a" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">相反，我们实际上可以在函数式 API 中做一个聪明的把戏，将重复的代码块定义为函数。例如，一个 ResNet 有许多重复的残差块，这些残差块有相同的基本成分:批量归一化、激活函数和卷积。因此，我们可以简单地将这些操作一起定义为函数中的一个块，从而大大简化我们的代码。</p><p id="1fe0" class="pw-post-body-paragraph ke kf it kh b ki kj kk kl km kn ko kp le kr ks kt lf kv kw kx lg kz la lb lc im bi translated">查看下面的代码，它实现了 ResNet 和 DenseNet 块，并向您展示了如何使用它们！</p><figure class="mk ml mm mn gt ju"><div class="bz fp l di"><div class="mo mp l"/></div></figure></div><div class="ab cl ni nj hx nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="im in io ip iq"><h1 id="ec24" class="lh li it bd lj lk np lm ln lo nq lq lr ls nr lu lv lw ns ly lz ma nt mc md me bi translated">喜欢学习？</h1><p id="b6d0" class="pw-post-body-paragraph ke kf it kh b ki mf kk kl km mg ko kp le mh ks kt lf mi kw kx lg mj la lb lc im bi translated">在 twitter 上关注我，我会在这里发布所有最新最棒的人工智能、技术和科学！</p></div></div>    
</body>
</html>