<html>
<head>
<title>Geospatial Indexing with Uber’s H3</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">优步 H3 的地理空间索引</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/geospatial-indexing-with-ubers-h3-766399b690c?source=collection_archive---------2-----------------------#2019-08-11">https://towardsdatascience.com/geospatial-indexing-with-ubers-h3-766399b690c?source=collection_archive---------2-----------------------#2019-08-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="1087" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">六边形动力！</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/1b584eb3bfb002a8b9df99d5f47192d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*N3sQOxCMYvQI-Jxy"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo by <a class="ae kv" href="https://unsplash.com/@jonassvidras?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Jonas Svidras</a> on <a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="7862" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本文中，我将介绍优步的 H3 地理空间索引系统。作为该公司众多开源项目中的一个，H3 系统允许你快速有效地索引你的数据，以备日后查询。</p><p id="7343" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">地理空间索引对于大规模聚合和查询数据至关重要。这种类型的数据通常很丰富，难以索引或搜索，并且结构可能很复杂。区分特定区域的多边形可能很难处理。想想一个城市的边界。你需要多少个点来有效地确定给定的车辆是否已经进入一个城镇或者甚至一个加油站？你需要的点数越多，你需要的 CPU 计算就越多。硬件负担过重会导致响应时间变慢和资源使用增加。</p><p id="7b03" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一个高效的地理空间索引系统可以帮助你克服这些障碍。在 H3 的情况下，解决方案采取散列方案的形式。</p><h1 id="42da" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">H3 是如何工作的？</h1><p id="438a" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">H3 算法将地球表面划分为六边形网络。您可以从可用的<a class="ae kv" href="https://uber.github.io/h3/#/documentation/core-library/resolution-table" rel="noopener ugc nofollow" target="_blank">十六级</a>中选择每个六边形包含的细节数量。你可以认为这些是地图上的“缩放”级别。每深入一步，六边形就会变小，你需要更多的六边形来覆盖相同的区域。</p><p id="ef13" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">每个六边形都是独一无二的，并且是可以识别的。您可以通过一个唯一的 64 位标识符、一个数据库表的理想关键字或一个内存中的字典来寻址各个六边形。这些标识符在“缩放”级别上是一致的，因此您可以随意混合和匹配它们。</p><p id="09f4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您对 H3 的第一个方法可以是把它想象成一个明亮的地理空间散列方案。有了它，您可以使用简单的值查找快速确定区域包含。您可以轻松地对地理空间观测进行聚类，并将其显示在地图上。</p><p id="194a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是还有更多。为了让您更好地理解 H3 的能力，我将用 Python 展示一个简单的用例。</p><h1 id="3145" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">回到英国交通事故</h1><p id="f95d" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">我在 Medium 上的第二篇文章是关于<a class="ae kv" rel="noopener" target="_blank" href="/mapping-the-uks-traffic-accident-hotspots-632b1129057b">绘制英国交通事故热点</a>。我决定从 H3 的角度重新审视它，作为本文的一个例证。当时，我关心的是找到交通事故报告最多的地区，并绘制地图。绘制重要事件频率的区域是优步每天都需要解决的问题，尽管规模要大得多(当然是为了不同的用例)。</p><p id="46bf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这里，我决定使用 H3 进行索引、聚合和显示。说明本文的代码可以在 GitHub <a class="ae kv" href="https://github.com/joaofig/uk-accidents" rel="noopener ugc nofollow" target="_blank">库</a>上找到，我建议您使用它来跟随本文。你只需要打开一本 Jupyter 笔记本:</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="93c7" class="mu lt iq mq b gy mv mw l mx my">uk-accident-h3.ipynb</span></pre><p id="e429" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这个文件中，我们主要看到的是与第一个版本相同的过程。我们加载数据，清理数据，并使用相同的 DBSCAN 算法对数据进行聚类。我们将利用 H3 的能力对位置进行分组，并以图形方式将它们表示为六边形簇，而不是麻烦地为这些层寻找形状。</p><h1 id="2cce" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">使用 H3 显示区域</h1><p id="d95b" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">一旦我们得到了 DBSCAN 聚类的结果，我们就为数据集获得了一个额外的列，即聚类数。噪声点的簇号为<em class="mz"> -1 </em>，并且不相关。从聚集的位置到地图形状是一个将它们散列成 H3 六角键的问题。这就像调用一个转换函数一样简单:</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="d9ac" class="mu lt iq mq b gy mv mw l mx my">h3_key = h3.geo_to_h3(latitude, longitude, level)</span></pre><p id="13b9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">得到的值是一个字典的关键字，我们在字典中存储六边形形状和共享该关键字的位置的数量。为了获得地理空间多边形，我们需要调用另一个函数:</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="da56" class="mu lt iq mq b gy mv mw l mx my">h3.h3_to_geo_boundary(h3_address=h3_key)</span></pre><p id="3c06" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个函数接受一个 H3 键，并返回六边形顶点的纬度和经度列表，我们可以很容易地用它在地图上显示。要查看地图，我们只需遍历字典并创建多边形形状。相关功能是:</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="e8f4" class="mu lt iq mq b gy mv mw l mx my">map = create_map(clusters)</span></pre><p id="0964" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">要测试解决方案的灵敏度，您可以调整两个 DBSCAN 参数和 H3 电平参数:</p><pre class="kg kh ki kj gt mp mq mr ms aw mt bi"><span id="25e4" class="mu lt iq mq b gy mv mw l mx my">eps_in_meters = 50.0<br/>num_samples = 10<br/>h3_level = 11</span></pre><p id="6611" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是我们最终得到的结果:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi na"><img src="../Images/ffd32fc5f8cd5661244769b0d50db856.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rPHCAUagKMouG0nUx_p9ww.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">H3 clusters generated from DBSCAN</figcaption></figure><h1 id="6f49" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">与 H3 聚类</h1><p id="9993" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">现在我们可以更进一步，使用 H3 直接对数据<em class="mz">进行聚类</em>。我们将使用所有输入数据并将其散列到 H3 键中，而不是通过 DBSCAN。我们不是显示所有可能的六边形，而是限制每个六边形出现的次数。这种限制将有助于整理地图，使其更具响应性。</p><p id="e52e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">生成的地图与第一张略有不同，但这是合理的。毕竟，我们使用的是不同的假设。请记住，DBSCAN 使用基于密度的标准对位置进行聚类。从某种意义上说，这是一种揭示结构的算法。另一方面，H3 使用一种强加结构的方法，定义哪些区域用作集群。</p><h1 id="0a62" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">结论</h1><p id="231a" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">这篇文章对优步的 H3 进行了一次相对短暂而肤浅的探索。这是一个方便的工具来执行地理空间索引和分析。我希望这已经激起了您更深入地研究这个库并将其添加到您的地理空间分析工具箱中的欲望。并且乐在其中。我做到了。</p><h1 id="1a67" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">参考</h1><p id="f734" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">[1] <a class="ae kv" href="https://eng.uber.com/h3/" rel="noopener ugc nofollow" target="_blank"> H3:优步的六边形层次空间索引</a></p><p id="da00" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">[2] <a class="ae kv" href="https://github.com/uber/h3-py" rel="noopener ugc nofollow" target="_blank"> H3 Python GitHub 库</a></p><p id="7a82" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">[3] <a class="ae kv" href="https://github.com/joaofig/uk-accidents" rel="noopener ugc nofollow" target="_blank">英国事故 GitHub 知识库</a></p><h1 id="1cb5" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">相关文章</h1><div class="nb nc gp gr nd ne"><a rel="noopener follow" target="_blank" href="/fast-geospatial-indexing-with-h3-90e862482585"><div class="nf ab fo"><div class="ng ab nh cl cj ni"><h2 class="bd ir gy z fp nj fr fs nk fu fw ip bi translated">H3 的快速地理空间索引</h2><div class="nl l"><h3 class="bd b gy z fp nj fr fs nk fu fw dk translated">H3 六角电力重装上阵！</h3></div><div class="nm l"><p class="bd b dl z fp nj fr fs nk fu fw dk translated">towardsdatascience.com</p></div></div><div class="nn l"><div class="no l np nq nr nn ns kp ne"/></div></div></a></div><div class="nb nc gp gr nd ne"><a rel="noopener follow" target="_blank" href="/geographic-clustering-with-hdbscan-ef8cb0ed6051"><div class="nf ab fo"><div class="ng ab nh cl cj ni"><h2 class="bd ir gy z fp nj fr fs nk fu fw ip bi translated">使用 HDBSCAN 进行地理聚类</h2><div class="nl l"><h3 class="bd b gy z fp nj fr fs nk fu fw dk translated">如何使用 HDBSCAN、H3、图论和 OSM 探索地理数据。</h3></div><div class="nm l"><p class="bd b dl z fp nj fr fs nk fu fw dk translated">towardsdatascience.com</p></div></div><div class="nn l"><div class="nt l np nq nr nn ns kp ne"/></div></div></a></div></div><div class="ab cl nu nv hu nw" role="separator"><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz"/></div><div class="ij ik il im in"><div class="kg kh ki kj gt ne"><a href="https://www.linkedin.com/in/joao-paulo-figueira/" rel="noopener  ugc nofollow" target="_blank"><div class="nf ab fo"><div class="ng ab nh cl cj ni"><h2 class="bd ir gy z fp nj fr fs nk fu fw ip bi translated">joo Paulo Figueira-数据科学家- tb.lx by 戴姆勒卡车和公共汽车| LinkedIn</h2><div class="nl l"><h3 class="bd b gy z fp nj fr fs nk fu fw dk translated">查看 joo Paulo Figueira 在全球最大的职业社区 LinkedIn 上的个人资料。圣保罗列出了 1 份工作…</h3></div><div class="nm l"><p class="bd b dl z fp nj fr fs nk fu fw dk translated">www.linkedin.com</p></div></div><div class="nn l"><div class="ob l np nq nr nn ns kp ne"/></div></div></a></div></div></div>    
</body>
</html>