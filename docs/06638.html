<html>
<head>
<title>Generalized linear models</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">广义线性模型</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/generalized-linear-models-9cbf848bb8ab?source=collection_archive---------0-----------------------#2019-09-23">https://towardsdatascience.com/generalized-linear-models-9cbf848bb8ab?source=collection_archive---------0-----------------------#2019-09-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="0fd4" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">高级统计建模简介</h2></div><p id="1417" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在本文中，我想解释广义线性模型(GLM)，这是学习更高级的统计建模的一个很好的起点。学习 GLM 让你了解我们如何使用概率分布作为建模的基础。我假设你熟悉线性回归和正态分布。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi lb"><img src="../Images/dc30abe586dd2e5641a2827672e0e0f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RGH_SbYtm_IWZ3yRDErnVA.jpeg"/></div></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk">Image by Semevent from Pixabay</figcaption></figure><h1 id="be95" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">线性回归再探</h1><p id="6ea2" class="pw-post-body-paragraph kf kg iq kh b ki mj jr kk kl mk ju kn ko ml kq kr ks mm ku kv kw mn ky kz la ij bi translated">线性回归是通过解释变量<em class="mo"> X </em>的线性组合来预测连续变量<em class="mo"> y </em>的值。</p><p id="4c84" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在单变量情况下，线性回归可以表示如下:</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/4c887ac6485436d26f3544102465ed5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:488/format:webp/1*D_2gt4WHDJEfb_hpZ1eoKQ.png"/></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk">Linear regression</figcaption></figure><p id="628a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这里，<em class="mo"> i </em>表示每个样本的指数。请注意，该模型假设噪声项呈正态分布。该模型可以说明如下:</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/a5c2dc5cb8a006903fab22ad4b29e18e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1140/format:webp/0*3OF9LJ_g1Fg_DtT9.png"/></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk">Linear regression illustrated</figcaption></figure><p id="5a17" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">通过三个正态 PDF(概率密度函数)图，我试图说明数据遵循具有固定方差的正态分布。</p></div><div class="ab cl mr ms hu mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="ij ik il im in"><h1 id="3960" class="lr ls iq bd lt lu my lw lx ly mz ma mb jw na jx md jz nb ka mf kc nc kd mh mi bi translated">泊松回归</h1><p id="d6ed" class="pw-post-body-paragraph kf kg iq kh b ki mj jr kk kl mk ju kn ko ml kq kr ks mm ku kv kw mn ky kz la ij bi translated">所以你只需要知道线性回归？肯定不是。如果你想在实际问题中应用统计建模，你必须知道更多。</p><p id="ceee" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，假设您需要用传感器值(<em class="mo"> x </em>)作为解释变量来预测缺陷产品的数量(<em class="mo"> Y </em>)。散点图看起来像这样。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/2dcc7d411275c033a21d0cf3108b56c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1116/format:webp/0*iCD-sPLnNXnOZCzS.png"/></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk">Do you use linear regression for this data?</figcaption></figure><p id="3ea4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果你试图对这类数据应用线性回归，会有几个问题。</p><ol class=""><li id="ed7f" class="ne nf iq kh b ki kj kl km ko ng ks nh kw ni la nj nk nl nm bi translated">X 和 Y 之间的关系<strong class="kh ir">看起来不是线性的</strong>。更有可能是指数级的。</li><li id="cf16" class="ne nf iq kh b ki nn kl no ko np ks nq kw nr la nj nk nl nm bi translated"><strong class="kh ir">相对于 X，Y 的方差看起来不恒定</strong>。这里，当 X 增加时，Y 的方差似乎也增加。</li><li id="312a" class="ne nf iq kh b ki nn kl no ko np ks nq kw nr la nj nk nl nm bi translated">因为 Y 代表产品的数量，所以它必须是正整数。换句话说，Y 是一个<strong class="kh ir">离散变量</strong>。然而，用于线性回归的正态分布假定变量是连续的。这也意味着通过线性回归的预测可能是负的。它不适合这种计数数据。</li></ol><p id="8015" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在这里，你能想到的更合适的模型是<strong class="kh ir">泊松回归</strong>模型。泊松回归是<strong class="kh ir">广义线性模型(GLM) </strong>的一个例子。</p><p id="228b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">广义线性模型有三个组成部分。</p><ol class=""><li id="cb49" class="ne nf iq kh b ki kj kl km ko ng ks nh kw ni la nj nk nl nm bi translated"><strong class="kh ir">线性预测器</strong></li><li id="466c" class="ne nf iq kh b ki nn kl no ko np ks nq kw nr la nj nk nl nm bi translated"><strong class="kh ir">链接功能</strong></li><li id="8ea3" class="ne nf iq kh b ki nn kl no ko np ks nq kw nr la nj nk nl nm bi translated"><strong class="kh ir">概率分布</strong></li></ol><p id="ec66" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在泊松回归的情况下，公式是这样的。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/157107da2434791ea9fe6edeb4b2db24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1282/format:webp/0*-ZviuacMrYAhFbg6.png"/></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk">Poisson regression</figcaption></figure><p id="7717" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">线性预测器</strong>只是参数(<em class="mo"> b </em>)和解释变量(<em class="mo"> x </em>)的线性组合。</p><p id="0946" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">链接功能</strong>字面上“链接”线性预测值和概率分布参数。在泊松回归的情况下，典型的连接函数是对数连接函数。这是因为泊松回归的参数必须是正的(稍后解释)。</p><p id="cf62" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后一个部分是<strong class="kh ir">概率分布</strong>，它产生观察变量<em class="mo"> y </em>。当我们在这里使用泊松分布时，该模型被称为泊松回归。</p><p id="a99d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">泊松分布用于模拟计数数据。它只有一个代表分布的均值和标准差的参数。这意味着平均值越大，标准差越大。见下文。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi nt"><img src="../Images/16c911f3250af46859109b7649650460.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*8lxYrT8kW2lxIuO-.png"/></div></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk">Poisson distribution with mean=1, 5, 10</figcaption></figure><p id="592a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，让我们将泊松回归应用于我们的数据。结果应该是这样的。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/27500338bd8284071ad11c03c5d5e796.png" data-original-src="https://miro.medium.com/v2/resize:fit:1116/format:webp/0*9XhxRne56Lhvmazv.png"/></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk">Poisson regression illustrated</figcaption></figure><p id="f9b4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">品红色曲线是通过泊松回归的预测。我添加了泊松分布的概率质量函数的条形图，以明确与线性回归的区别。</p><p id="f130" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">预测曲线是指数曲线，因为对数连接函数的倒数是指数函数。由此也可以清楚地看出，由线性预测器计算的泊松回归参数保证为正。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/252532b188f096853fa590e91e96191f.png" data-original-src="https://miro.medium.com/v2/resize:fit:776/format:webp/0*wNqeqIVx2VRnFjiN.png"/></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk">Inverse of log link function</figcaption></figure><p id="91d8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果使用 Python，<a class="ae nv" href="https://www.statsmodels.org/stable/glm.html" rel="noopener ugc nofollow" target="_blank"> statsmodels </a>库可以用于 GLM。泊松回归的代码非常简单。</p><pre class="lc ld le lf gt nw nx ny nz aw oa bi"><span id="1bf7" class="ob ls iq nx b gy oc od l oe of"># Poisson regression code<br/>import statsmodels.api as sm<br/>exog, endog = sm.add_constant(x), y<br/>mod = sm.GLM(endog, exog,<br/>             family=sm.families.Poisson(link=sm.families.links.log))<br/>res = mod.fit()</span></pre><p id="2afe" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">endog(内生)和 exog(外生)就是你在 statsmodels 中怎么称呼<em class="mo"> y </em>和<em class="mo"> X </em>。请注意，您需要将常数项添加到<em class="mo"> X </em>中。没有这个，你的线性预测器就只是<em class="mo"> b_1*x_i </em>。</p><p id="2c20" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">实际上，您不需要在这里提供 link 参数，因为 log link 是 Poisson 系列的缺省值。</p><p id="4884" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我用来创建所有图形的完整代码在我的<a class="ae nv" href="https://github.com/kidaufo/StatisticalModeling/blob/master/GLM.ipynb" rel="noopener ugc nofollow" target="_blank"> Github 库</a>中。</p></div><div class="ab cl mr ms hu mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="ij ik il im in"><h1 id="84aa" class="lr ls iq bd lt lu my lw lx ly mz ma mb jw na jx md jz nb ka mf kc nc kd mh mi bi translated">其他典型的 GLM</h1><p id="8c7d" class="pw-post-body-paragraph kf kg iq kh b ki mj jr kk kl mk ju kn ko ml kq kr ks mm ku kv kw mn ky kz la ij bi translated">线性回归也是 GLM 的一个例子。它只是使用<strong class="kh ir">恒等连接函数</strong>(线性预测器和概率分布的参数是相同的)和<strong class="kh ir">正态分布</strong>作为概率分布。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/4c887ac6485436d26f3544102465ed5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:488/format:webp/1*D_2gt4WHDJEfb_hpZ1eoKQ.png"/></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk">Linear regression</figcaption></figure><p id="a357" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果用<strong class="kh ir"> logit 函数</strong>作为连接函数，用<strong class="kh ir">二项式/伯努利分布</strong>作为概率分布，那么这个模型就叫做<strong class="kh ir"> logistic 回归</strong>。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi og"><img src="../Images/02f68ae30549d8b288abb0a0f5b915cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/format:webp/1*h5AM_ez965bZysPtSm4YLQ.png"/></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk">logistic regression</figcaption></figure><p id="ee63" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果用<em class="mo"> z </em>表示线性预测器，上面的等式等价于下面的。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/ecd12d020dddeeac384a348ed32e3a8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:632/format:webp/0*GNxoABLabxgy4xAg.png"/></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk">Logistic function</figcaption></figure><p id="2b94" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">第二个方程的右边称为逻辑函数。因此，这个模型被称为逻辑回归。</p><p id="4412" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">由于逻辑函数对任意输入返回值介于 0 和 1 之间，因此它是二项式分布的合适链接函数。</p><p id="6987" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">逻辑回归主要用于二元分类问题。下面是一个用逻辑回归拟合一些数据的例子。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/1de4c3f8d9c05317de29bc3e6ba0e04b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1080/format:webp/0*bXHLVcqQELurc-VQ.png"/></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk">Logistic regression illustrated</figcaption></figure><h1 id="df5a" class="lr ls iq bd lt lu lv lw lx ly lz ma mb jw mc jx md jz me ka mf kc mg kd mh mi bi translated">自定义 GLM</h1><p id="4472" class="pw-post-body-paragraph kf kg iq kh b ki mj jr kk kl mk ju kn ko ml kq kr ks mm ku kv kw mn ky kz la ij bi translated">到目前为止，我解释的模型使用了概率分布和链接函数的典型组合。换句话说，上面所有的模型都使用了<strong class="kh ir">规范链接函数。</strong></p><p id="e1d1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是概率分布及其规范链接函数的列表。</p><ul class=""><li id="a9c1" class="ne nf iq kh b ki kj kl km ko ng ks nh kw ni la oj nk nl nm bi translated">正态分布:身份函数</li><li id="9c17" class="ne nf iq kh b ki nn kl no ko np ks nq kw nr la oj nk nl nm bi translated">泊松分布:对数函数</li><li id="0210" class="ne nf iq kh b ki nn kl no ko np ks nq kw nr la oj nk nl nm bi translated">二项式分布:logit 函数</li></ul><p id="83e0" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是，您不一定要使用规范链接函数。更确切地说，统计建模的优势在于，您可以创建任何类型的模型来很好地适应您的数据。</p><p id="5c8f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，让我们考虑以下数据。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/981df4eaaa346aa568cd9ab19d2f7c84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1080/format:webp/0*wuIIJDt863G4UV2Y.png"/></div></figure><p id="86f7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这看起来类似于我为泊松回归准备的数据。然而，如果你仔细观察数据，似乎<em class="mo"> y </em>相对于<em class="mo"> X </em>的方差是恒定的。况且<em class="mo"> y </em>是连续的，不是离散的。</p><p id="13e0" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">因此，这里使用正态分布是合适的。由于<em class="mo"> X </em>和<em class="mo"> y </em>之间的关系看起来是指数关系，你最好选择对数链接函数。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/b72d6c36ddadce397bad9b3053b94950.png" data-original-src="https://miro.medium.com/v2/resize:fit:568/format:webp/1*g8A5Apgz7T8k60QEkqDAJw.png"/></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk">GLM with non-canonical link function</figcaption></figure><p id="ea8e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用 statsmodels，您可以像这样编码。</p><pre class="lc ld le lf gt nw nx ny nz aw oa bi"><span id="541f" class="ob ls iq nx b gy oc od l oe of">mod = sm.GLM(endog, exog,<br/>             family=sm.families.Gaussian(sm.families.links.log))<br/>res = mod.fit()</span></pre><p id="c33c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">请注意，您需要在这里指定链接函数，因为高斯分布的默认链接是身份链接函数。模型的预测结果是这样的。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/bd3ef12722db8cd284470e6928e5258e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1080/format:webp/0*tQio2Cuf2BsMdBOK.png"/></div></figure></div><div class="ab cl mr ms hu mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="ij ik il im in"><p id="dafd" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">statsmodels 中实现了各种链接功能。但是，如果您需要使用更复杂的链接函数，您必须自己编写模型。</p><p id="8272" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为此，Stan、PyMC3 和 TensorFlow Probability 等概率编程框架将是一个不错的选择。这可能是我未来工作的主题。</p></div></div>    
</body>
</html>