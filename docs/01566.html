<html>
<head>
<title>Speed up predictions on low-power devices using Neural Compute Stick and OpenVINO</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用神经计算棒和 OpenVINO 加速对低功耗设备的预测</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/speed-up-predictions-on-low-power-devices-using-neural-compute-stick-and-openvino-98f3ae9dcf41?source=collection_archive---------7-----------------------#2019-03-13">https://towardsdatascience.com/speed-up-predictions-on-low-power-devices-using-neural-compute-stick-and-openvino-98f3ae9dcf41?source=collection_archive---------7-----------------------#2019-03-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="bfa4" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">英特尔的神经计算棒能够在边缘加速 Tensorflow 神经网络推理，将性能提高 10 倍。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8224f0da72b6e63fb7dfcc8cce93df37.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M_D40fwPPdsIpBECTZnpGg.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Neural Compute Stick — NCS</figcaption></figure><p id="2f73" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在本文中，我们将探索实现以下目标所需的步骤:</p><ol class=""><li id="e865" class="lu lv it la b lb lc le lf lh lw ll lx lp ly lt lz ma mb mc bi translated">使用英特尔的 OpenVINO Toolkit 将 Tensorflow 模型转换为 NCS 兼容模型</li><li id="dc8a" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated">在 Raspberry 上安装一个轻量级版本的 OpenVINO，在船上运行推理</li><li id="07b2" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated">在 Raspberry 上测试和部署转换后的模型</li></ol><h1 id="5b36" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">要求</h1><p id="09f9" class="pw-post-body-paragraph ky kz it la b lb na ju ld le nb jx lg lh nc lj lk ll nd ln lo lp ne lr ls lt im bi translated">该程序需要:</p><ul class=""><li id="865a" class="lu lv it la b lb lc le lf lh lw ll lx lp ly lt nf ma mb mc bi translated">一个基于 Ubuntu 的<em class="ng">主机</em>(建议:Ubuntu 18.04 LTS)。</li><li id="b20f" class="lu lv it la b lb md le me lh mf ll mg lp mh lt nf ma mb mc bi translated">一个英特尔 Movidius 神经计算棒(两个<a class="ae nh" href="https://software.intel.com/en-us/movidius-ncs" rel="noopener ugc nofollow" target="_blank"> NCS1 </a>和<a class="ae nh" href="https://software.intel.com/en-us/neural-compute-stick" rel="noopener ugc nofollow" target="_blank"> NCS2 </a>都与程序兼容)。</li><li id="11b0" class="lu lv it la b lb md le me lh mf ll mg lp mh lt nf ma mb mc bi translated">安装了 Raspian 操作系统的 Raspberry Pi 板(建议:Raspberry Pi 3)</li></ul><h1 id="adf0" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated"><strong class="ak">定义程序</strong></h1><p id="dec3" class="pw-post-body-paragraph ky kz it la b lb na ju ld le nb jx lg lh nc lj lk ll nd ln lo lp ne lr ls lt im bi translated">首先，假设我们想要转换一个已经训练好的 Tensorflow 对象检测模型。出于本文的目的，我们将使用 Tensorflow 团队在<a class="ae nh" href="http://cocodataset.org/#home" rel="noopener ugc nofollow" target="_blank"> COCO 对象数据集</a>(此处<a class="ae nh" href="https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/detection_model_zoo.md" rel="noopener ugc nofollow" target="_blank">为模型的完整列表)上开发的一个已经训练好的模型。</a></p><p id="d8be" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们需要使用<a class="ae nh" href="https://software.intel.com/en-us/openvino-toolkit" rel="noopener ugc nofollow" target="_blank"> OpenVINO Toolkit </a>将这个模型转换成 NCS 兼容版本，称为中间表示(或 IR)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/d2d1cea923368b2653a1c1fb9eb09bde.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h4QNjKbGtTbaQgtM939y4A.png"/></div></div></figure><p id="a0f3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在转换之后，我们得到了两个文件，这两个文件可以部署在连接了 NCS 硬件的 Raspberry Pi 上。</p><p id="7cb7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">更详细的工艺流程如下:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nj"><img src="../Images/9b4d8133bb095add5aa30d3106758375.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bpuRklWg3uDeiiZAuXMhIw.png"/></div></div></figure><p id="a5b3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">神经计算棒装有一个<a class="ae nh" href="https://www.movidius.com/solutions/vision-processing-unit" rel="noopener ugc nofollow" target="_blank">万千芯片</a>(也叫视觉处理器或 VPU)。</p></div><div class="ab cl nk nl hx nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="im in io ip iq"><h1 id="f779" class="mi mj it bd mk ml nr mn mo mp ns mr ms jz nt ka mu kc nu kd mw kf nv kg my mz bi translated">在主机上开始使用 OpenVINO</h1><p id="3222" class="pw-post-body-paragraph ky kz it la b lb na ju ld le nb jx lg lh nc lj lk ll nd ln lo lp ne lr ls lt im bi translated">作为第一步，需要在<em class="ng">主机</em>上安装 OpenVINO Toolkit。</p><h2 id="e794" class="nw mj it bd mk nx ny dn mo nz oa dp ms lh ob oc mu ll od oe mw lp of og my oh bi translated">下载并安装 OpenVINO</h2><p id="6c2a" class="pw-post-body-paragraph ky kz it la b lb na ju ld le nb jx lg lh nc lj lk ll nd ln lo lp ne lr ls lt im bi translated">首先连接到<a class="ae nh" href="https://software.seek.intel.com/openvino-toolkit" rel="noopener ugc nofollow" target="_blank">下载页面</a>。然后，自己注册，选择 Ubuntu 版本的 OpenVINO，选择<em class="ng">全包</em>按钮。之后，下载文件，将其放在<code class="fe oi oj ok ol b">Downloads</code>中。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi om"><img src="../Images/f8f2a755e82cf077344a4510e8a581ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1124/format:webp/1*9wGjOYsioEPG-E_VhPQtXA.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">OpenVINO Download</figcaption></figure><p id="ad30" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">一旦完成，就该安装软件包了。</p><p id="660f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们打开一个新的终端(<code class="fe oi oj ok ol b">CTRL</code> + <code class="fe oi oj ok ol b">ALT</code> + <code class="fe oi oj ok ol b">T</code>)。导航到<code class="fe oi oj ok ol b">Downloads</code>文件夹，解压缩文件，安装依赖项并执行 GUI 安装，如下所示:</p><pre class="kj kk kl km gt on ol oo op aw oq bi"><span id="fe8d" class="nw mj it ol b gy or os l ot ou">cd ~/Downloads<br/>tar xvf l_openvino_toolkit_&lt;VERSION&gt;.tgz<br/>cd l_openvino_toolkit_&lt;VERSION&gt;<br/>sudo ./install_cv_sdk_dependencies.sh<br/>sudo ./install_GUI.sh</span></pre><p id="bb10" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">按照屏幕指示，继续进行<strong class="la iu">完全安装</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/32fbf1d4dc6a3d67d499c54d39ed0174.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WFgDepdhp8P35UEk3AX9iA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Proceed with full installation</figcaption></figure><p id="ea1d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">等待几分钟，直到安装过程完成。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ow"><img src="../Images/41a6903fd7c5b49e73152945cc7be225.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uqadbLgzn1HFNf5kZdoSIQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Installation completed</figcaption></figure><p id="0f2c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在需要<strong class="la iu">设置环境变量</strong>。运行以下脚本临时设置环境变量:</p><pre class="kj kk kl km gt on ol oo op aw oq bi"><span id="809a" class="nw mj it ol b gy or os l ot ou">source /opt/intel/computer_vision_sdk/bin/setupvars.sh</span></pre><p id="0ebc" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">当您关闭 shell 时，OpenVINO toolkit 环境变量将被删除。作为一个选项，可以永久设置如下环境变量(<em class="ng">强烈建议</em>):</p><p id="c616" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们打开<code class="fe oi oj ok ol b">.bashrc</code>文件，通过签发:</p><pre class="kj kk kl km gt on ol oo op aw oq bi"><span id="f53f" class="nw mj it ol b gy or os l ot ou">nano ~/.bashrc</span></pre><p id="6a40" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">将这一行附加到文件的末尾:</p><pre class="kj kk kl km gt on ol oo op aw oq bi"><span id="5c12" class="nw mj it ol b gy or os l ot ou">source /opt/intel/computer_vision_sdk/bin/setupvars.sh</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ox"><img src="../Images/bb88ed2dc52320689c90e58567ea071b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AHtYORBOcceri4UVVcBqNg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Command at the end of the file</figcaption></figure><p id="cb4f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">保存文件并关闭编辑器(<code class="fe oi oj ok ol b">CTRL</code> + <code class="fe oi oj ok ol b">X</code>)。</p><p id="c86a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为了确保一切正常，让我们打开一个新的终端。打开后，您应该能够看到:</p><pre class="kj kk kl km gt on ol oo op aw oq bi"><span id="e6df" class="nw mj it ol b gy or os l ot ou">[setupvars.sh] OpenVINO environment initialized</span></pre><h2 id="d1ae" class="nw mj it bd mk nx ny dn mo nz oa dp ms lh ob oc mu ll od oe mw lp of og my oh bi translated">配置神经计算棒通信</h2><p id="ecaa" class="pw-post-body-paragraph ky kz it la b lb na ju ld le nb jx lg lh nc lj lk ll nd ln lo lp ne lr ls lt im bi translated">现在有必要更新 udev 规则以便让 OpenVINO 能够与神经计算棒通信。</p><p id="86fc" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为此，让我们打开一个新的终端(<code class="fe oi oj ok ol b">CTRL</code> + <code class="fe oi oj ok ol b">ALT</code> + <code class="fe oi oj ok ol b">T</code>)并发出以下命令:</p><pre class="kj kk kl km gt on ol oo op aw oq bi"><span id="301b" class="nw mj it ol b gy or os l ot ou">cd ~/Download</span><span id="0598" class="nw mj it ol b gy oy os l ot ou">cat &lt;&lt;EOF &gt; 97-usbboot.rules<br/>SUBSYSTEM=="usb", ATTRS{idProduct}=="2150", ATTRS{idVendor}=="03e7", GROUP="users", MODE="0666", ENV{ID_MM_DEVICE_IGNORE}="1"<br/>SUBSYSTEM=="usb", ATTRS{idProduct}=="2485", ATTRS{idVendor}=="03e7", GROUP="users", MODE="0666", ENV{ID_MM_DEVICE_IGNORE}="1"<br/>SUBSYSTEM=="usb", ATTRS{idProduct}=="f63b", ATTRS{idVendor}=="03e7", GROUP="users", MODE="0666", ENV{ID_MM_DEVICE_IGNORE}="1"<br/>EOF</span></pre><p id="fd0b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后:</p><pre class="kj kk kl km gt on ol oo op aw oq bi"><span id="9d60" class="nw mj it ol b gy or os l ot ou">sudo cp 97-usbboot.rules /etc/udev/rules.d/<br/>sudo udevadm control --reload-rules<br/>sudo udevadm trigger<br/>sudo ldconfig<br/>rm 97-usbboot.rules</span></pre><h2 id="26fb" class="nw mj it bd mk nx ny dn mo nz oa dp ms lh ob oc mu ll od oe mw lp of og my oh bi translated">测试安装</h2><p id="5a73" class="pw-post-body-paragraph ky kz it la b lb na ju ld le nb jx lg lh nc lj lk ll nd ln lo lp ne lr ls lt im bi translated">我们现在可以通过对图像分类器进行预测来测试安装。让我们将记忆棒插入主机的 USB 端口(<em class="ng">建议使用 USB 3.0 端口</em>)。打开一个新终端，然后运行以下命令:</p><pre class="kj kk kl km gt on ol oo op aw oq bi"><span id="2f25" class="nw mj it ol b gy or os l ot ou">sudo ./opt/intel/computer_vision_sdk/deployment_tools/model_optimizer/install_prerequisites/install_prerequisites.sh</span></pre><p id="1331" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后:</p><pre class="kj kk kl km gt on ol oo op aw oq bi"><span id="6124" class="nw mj it ol b gy or os l ot ou">./opt/intel/computer_vision_sdk/deployment_tools/demo/demo_squeezenet_download_convert_run.sh -d MYRIAD</span></pre><p id="2f88" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在执行结束时，您将能够看到以下输出:</p><pre class="kj kk kl km gt on ol oo op aw oq bi"><span id="23e2" class="nw mj it ol b gy or os l ot ou">Top 10 results:</span><span id="aa8c" class="nw mj it ol b gy oy os l ot ou">Image /opt/intel/computer_vision_sdk/deployment_tools/demo/car.png</span><span id="f9a3" class="nw mj it ol b gy oy os l ot ou">817 0.8422852 label sports car, sport car<br/>511 0.0915527 label convertible<br/>479 0.0393982 label car wheel<br/>751 0.0093536 label racer, race car, racing car<br/>436 0.0068550 label beach wagon, station wagon, wagon, estate car, beach waggon, station waggon, waggon<br/>656 0.0036659 label minivan<br/>586 0.0023270 label half track<br/>717 0.0015497 label pickup, pickup truck<br/>864 0.0010500 label tow truck, tow car, wrecker<br/>581 0.0005631 label grille, radiator grille</span><span id="668e" class="nw mj it ol b gy oy os l ot ou">total inference time: 34.1828987<br/>Average running time of one iteration: 34.1828987 ms</span><span id="afb0" class="nw mj it ol b gy oy os l ot ou">Throughput: 29.2543944 FPS</span><span id="4e16" class="nw mj it ol b gy oy os l ot ou">[ INFO ] Execution successful</span><span id="ab0f" class="nw mj it ol b gy oy os l ot ou">###################################################</span><span id="5fe7" class="nw mj it ol b gy oy os l ot ou">Demo completed successfully.</span></pre><p id="275e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这意味着你成功地使用加载在神经计算棒上的 SqueezeNet 网络进行了预测。</p></div><div class="ab cl nk nl hx nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="im in io ip iq"><h1 id="755d" class="mi mj it bd mk ml nr mn mo mp ns mr ms jz nt ka mu kc nu kd mw kf nv kg my mz bi translated">将张量流模型转换为 IR</h1><p id="2acc" class="pw-post-body-paragraph ky kz it la b lb na ju ld le nb jx lg lh nc lj lk ll nd ln lo lp ne lr ls lt im bi translated">如前所述，我们希望使用 Tensorflow 模型来使用 OpenVINO Toolkit 进行推理。</p><p id="2a40" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">下面我们从 tensor flow ODAPI<a class="ae nh" href="https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/detection_model_zoo.md" rel="noopener ugc nofollow" target="_blank">Model Zoo</a>下载一个 SSD MobileNet v1 探测器模型。为此，让我们打开一个新的终端并发出命令:</p><pre class="kj kk kl km gt on ol oo op aw oq bi"><span id="e88c" class="nw mj it ol b gy or os l ot ou">cd ~/Downloads<br/>wget http://download.tensorflow.org/models/object_detection/ssd_mobilenet_v1_coco_2018_01_28.tar.gz</span><span id="12fd" class="nw mj it ol b gy oy os l ot ou">tar -xvzf <!-- -->ssd_mobilenet_v1_coco_2018_01_28.tar.gz</span></pre><p id="8ded" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们转换模型:</p><pre class="kj kk kl km gt on ol oo op aw oq bi"><span id="9ef0" class="nw mj it ol b gy or os l ot ou">mo_tf.py \<br/>    --input_model ~/Downloads/ssd_mobilenet_v1_coco_2018_01_28/frozen_inference_graph.pb \<br/>    --tensorflow_use_custom_operations_config     /opt/intel/computer_vision_sdk/deployment_tools/model_optimizer/extensions/front/tf/ssd_support.json \<br/>    --tensorflow_object_detection_api_pipeline_config ~/Downloads/ssd_mobilenet_v1_coco_2018_01_28/pipeline.config \<br/>    --data_type FP16</span></pre><p id="ee69" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们使用半精度浮点格式(或 FP16)转换了 Tensorflow 模型，以便将模型大小减半，但以可忽略的较低精度为代价大幅提高性能。</p><p id="5fa5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">输出应该类似于:</p><pre class="kj kk kl km gt on ol oo op aw oq bi"><span id="f6aa" class="nw mj it ol b gy or os l ot ou">Model Optimizer arguments:<br/>Common parameters:<br/> - Path to the Input Model:  /home/&lt;username&gt;/Downloads/ssd_mobilenet_v1_coco_2018_01_28/frozen_inference_graph.pb<br/> - Path for generated IR:  /home/&lt;username&gt;/Downloads/.<br/> - IR output name:  frozen_inference_graph<br/> - Log level:  ERROR<br/> - Batch:  Not specified, inherited from the model<br/> - Input layers:  Not specified, inherited from the model<br/> - Output layers:  Not specified, inherited from the model<br/> - Input shapes:  Not specified, inherited from the model<br/> - Mean values:  Not specified<br/> - Scale values:  Not specified<br/> - Scale factor:  Not specified<br/> - Precision of IR:  FP16<br/> - Enable fusing:  True<br/> - Enable grouped convolutions fusing:  True<br/> - Move mean values to preprocess section:  False<br/> - Reverse input channels:  False<br/>TensorFlow specific parameters:<br/> - Input model in text protobuf format:  False<br/> - Offload unsupported operations:  False<br/> - Path to model dump for TensorBoard:  None<br/> - List of shared libraries with TensorFlow custom layers implementation:  None<br/> - Update the configuration file with input/output node names:  None<br/> - Use configuration file used to generate the model with Object Detection API:  /home/&lt;username&gt;/Downloads/ssd_mobilenet_v1_coco_2018_01_28/pipeline.config<br/> - Operations to offload:  None<br/> - Patterns to offload:  None<br/> - Use the config file:  /opt/intel/computer_vision_sdk/deployment_tools/model_optimizer/extensions/front/tf/ssd_support.json<br/>Model Optimizer version:  1.5.12.49d067a0<br/>The Preprocessor block has been removed. Only nodes performing mean value subtraction and scaling (if applicable) are kept.</span><span id="626a" class="nw mj it ol b gy oy os l ot ou">[ SUCCESS ] Generated IR model.<br/>[ SUCCESS ] XML file: /home/&lt;username&gt;/Downloads/./frozen_inference_graph.xml<br/>[ SUCCESS ] BIN file: /home/&lt;username&gt;/Downloads/./frozen_inference_graph.bin<br/>[ SUCCESS ] Total execution time: 20.48 seconds.</span></pre><p id="0aec" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在<code class="fe oi oj ok ol b">Download</code>文件夹中，您现在应该可以看到新生成的文件，扩展名分别为:</p><ul class=""><li id="f7b2" class="lu lv it la b lb lc le lf lh lw ll lx lp ly lt nf ma mb mc bi translated"><code class="fe oi oj ok ol b">.xml</code></li><li id="49ec" class="lu lv it la b lb md le me lh mf ll mg lp mh lt nf ma mb mc bi translated"><code class="fe oi oj ok ol b">.bin</code></li></ul><p id="38df" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这些文件将用于树莓板上的预测。</p><h2 id="63c4" class="nw mj it bd mk nx ny dn mo nz oa dp ms lh ob oc mu ll od oe mw lp of og my oh bi translated">测试模型</h2><p id="9e7a" class="pw-post-body-paragraph ky kz it la b lb na ju ld le nb jx lg lh nc lj lk ll nd ln lo lp ne lr ls lt im bi translated">在将前面的文件上传到 Raspberry 之前，我们先检查一下是否一切正常，推断生成的模型。</p><p id="a341" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">将摄像头和神经计算棒插在你的<em class="ng">主机</em>上。让我们打开一个新的终端并发出:</p><pre class="kj kk kl km gt on ol oo op aw oq bi"><span id="6ff8" class="nw mj it ol b gy or os l ot ou">cp /opt/intel/computer_vision_sdk_2018.5.455/deployment_tools/inference_engine/samples/python_samples/object_detection_demo_ssd_async.py ~/Downloads/</span><span id="de1e" class="nw mj it ol b gy oy os l ot ou">python3 object_detection_demo_ssd_async.py \<br/>    -m ~/Downloads/frozen_inference_graph.xml \<br/>    -i cam \<br/>    -pt 0.6</span></pre><p id="3c52" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您的<em class="ng">主机</em>现在应该会打开一个新窗口，显示您的相机检测！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oz"><img src="../Images/9d3dc8cc16e6692cd68eaf014694df7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wrgrwd1rOmwuLeG0Z-Mnhw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Detections on the main machine using NCS2</figcaption></figure></div><div class="ab cl nk nl hx nm" role="separator"><span class="nn bw bk no np nq"/><span class="nn bw bk no np nq"/><span class="nn bw bk no np"/></div><div class="im in io ip iq"><h1 id="3ae6" class="mi mj it bd mk ml nr mn mo mp ns mr ms jz nt ka mu kc nu kd mw kf nv kg my mz bi translated">在树莓 Pi 上运行神经网络</h1><p id="a0bd" class="pw-post-body-paragraph ky kz it la b lb na ju ld le nb jx lg lh nc lj lk ll nd ln lo lp ne lr ls lt im bi translated">让我们来设置您的树莓 Pi 板。我们将首先为树莓安装一个轻量级版本的 OpenVINO。然后，我们将在板上设置运行 SSDMobileNet V1 所需的所有文件。</p><h2 id="fa4b" class="nw mj it bd mk nx ny dn mo nz oa dp ms lh ob oc mu ll od oe mw lp of og my oh bi translated">为树莓 Pi 安装 OpenVINO</h2><p id="46a9" class="pw-post-body-paragraph ky kz it la b lb na ju ld le nb jx lg lh nc lj lk ll nd ln lo lp ne lr ls lt im bi translated">需要安装并运行 Raspian OS(<em class="ng">建议从头安装 Raspian OS</em>)。</p><p id="98e2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">首先我们需要<a class="ae nh" href="https://download.01.org/openvinotoolkit/2018_R5/packages/l_openvino_toolkit_ie_p_2018.5.445.tgz" rel="noopener ugc nofollow" target="_blank">下载</a> OpenVINO。这个版本与上一个版本不同。在<code class="fe oi oj ok ol b">Download</code>内保存文件。</p><p id="23fa" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们打开一个新的终端。发出以下命令:</p><ul class=""><li id="3424" class="lu lv it la b lb lc le lf lh lw ll lx lp ly lt nf ma mb mc bi translated">导航至<code class="fe oi oj ok ol b">Download</code>文件夹:</li></ul><pre class="kj kk kl km gt on ol oo op aw oq bi"><span id="f582" class="nw mj it ol b gy or os l ot ou">cd<!-- --> <!-- -->~/Downloads/</span></pre><ul class=""><li id="dd8a" class="lu lv it la b lb lc le lf lh lw ll lx lp ly lt nf ma mb mc bi translated">解压缩先前下载的归档文件:</li></ul><pre class="kj kk kl km gt on ol oo op aw oq bi"><span id="e971" class="nw mj it ol b gy or os l ot ou">tar -xf l_openvino_toolkit_ie_p_&lt;version&gt;.tgz</span></pre><p id="1716" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这将创建<code class="fe oi oj ok ol b">inference_engine_vpu_arm</code>文件夹。</p><ul class=""><li id="d701" class="lu lv it la b lb lc le lf lh lw ll lx lp ly lt nf ma mb mc bi translated">修改<code class="fe oi oj ok ol b">setupvars.sh</code>脚本，在<code class="fe oi oj ok ol b">Downloads</code>文件夹中，将<code class="fe oi oj ok ol b">&lt;INSTALLDIR&gt;</code>替换为安装文件夹的绝对路径，发出以下命令:</li></ul><pre class="kj kk kl km gt on ol oo op aw oq bi"><span id="ab70" class="nw mj it ol b gy or os l ot ou">sudo sed -i "s|&lt;INSTALLDIR&gt;|$(pwd)/inference_engine_vpu_arm|" inference_engine_vpu_arm/bin/setupvars.sh</span></pre><h2 id="9587" class="nw mj it bd mk nx ny dn mo nz oa dp ms lh ob oc mu ll od oe mw lp of og my oh bi translated">设置环境变量</h2><p id="1e87" class="pw-post-body-paragraph ky kz it la b lb na ju ld le nb jx lg lh nc lj lk ll nd ln lo lp ne lr ls lt im bi translated">在启动和运行 OpenVINO Toolkit 之前，需要更新几个环境变量。让我们运行下面的命令，在<code class="fe oi oj ok ol b">Downloads</code>文件夹中临时设置环境变量:</p><pre class="kj kk kl km gt on ol oo op aw oq bi"><span id="cb0b" class="nw mj it ol b gy or os l ot ou">source inference_engine_vpu_arm/bin/setupvars.sh</span></pre><p id="fd1a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">输出应该类似于:</p><pre class="kj kk kl km gt on ol oo op aw oq bi"><span id="42d3" class="nw mj it ol b gy or os l ot ou">[setupvars.sh] OpenVINO environment initialized</span></pre><p id="d0f4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">类似于主机上的程序，现在建议通过打开<code class="fe oi oj ok ol b">.bashrc</code>文件 a 永久设置环境变量</p><pre class="kj kk kl km gt on ol oo op aw oq bi"><span id="75dc" class="nw mj it ol b gy or os l ot ou">nano ~/.bashrc</span></pre><p id="30c8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">并在结尾处添加以下一行:</p><pre class="kj kk kl km gt on ol oo op aw oq bi"><span id="2f5d" class="nw mj it ol b gy or os l ot ou">source ~/Downloads/inference_engine_vpu_arm/bin/setupvars.sh</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pa"><img src="../Images/46277a732ddfb7c80023db77dd71e282.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nddGeTKHqRDnMcK1DuHLCA.png"/></div></div></figure><p id="44fb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">保存文件并退出。</p><p id="813e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为了测试安装，让我们打开一个新的终端。您应该看到:</p><pre class="kj kk kl km gt on ol oo op aw oq bi"><span id="8f5a" class="nw mj it ol b gy or os l ot ou">[setupvars.sh] OpenVINO environment initialized</span></pre><p id="6645" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">添加 USB 规则</strong></p><ul class=""><li id="8a97" class="lu lv it la b lb lc le lf lh lw ll lx lp ly lt nf ma mb mc bi translated">将当前 Linux 用户添加到<code class="fe oi oj ok ol b">users</code>组:</li></ul><pre class="kj kk kl km gt on ol oo op aw oq bi"><span id="18c9" class="nw mj it ol b gy or os l ot ou">sudo usermod -a -G users "$(whoami)"</span></pre><p id="56e4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">注销然后再登录(或者关闭再打开 Raspberry)以使其生效。</p><ul class=""><li id="db14" class="lu lv it la b lb lc le lf lh lw ll lx lp ly lt nf ma mb mc bi translated">安装 USB 规则，从<code class="fe oi oj ok ol b">Downloads</code>文件夹内打开一个新的终端并发出:</li></ul><pre class="kj kk kl km gt on ol oo op aw oq bi"><span id="61ca" class="nw mj it ol b gy or os l ot ou">sh inference_engine_vpu_arm/install_dependencies/install_NCS_udev_rules.sh</span></pre><h2 id="3a5b" class="nw mj it bd mk nx ny dn mo nz oa dp ms lh ob oc mu ll od oe mw lp of og my oh bi translated">复制预测文件</h2><p id="c43a" class="pw-post-body-paragraph ky kz it la b lb na ju ld le nb jx lg lh nc lj lk ll nd ln lo lp ne lr ls lt im bi translated">现在是将模型文件复制到 Raspberry 的时候了。要运行演示应用程序，我们需要以下文件:</p><pre class="kj kk kl km gt on ol oo op aw oq bi"><span id="2e48" class="nw mj it ol b gy or os l ot ou">+ frozen_inference_graph.xml<br/>+ frozen_inference_graph.bin<br/>+ object_detection_demo_ssd_async.py</span></pre><p id="a658" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您正确遵循了前面的步骤，这些文件应该位于主机的<code class="fe oi oj ok ol b">Download</code>文件夹中。</p><p id="482b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您可以将这些文件复制到 USB 驱动器，然后复制到 Raspberry，或者通过 SSH。</p><p id="a925" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在树莓上，新建一个文件夹:<code class="fe oi oj ok ol b">mkdir ~/NCS-demo</code>。把所有以前的文件放进去。</p><h2 id="c5f2" class="nw mj it bd mk nx ny dn mo nz oa dp ms lh ob oc mu ll od oe mw lp of og my oh bi translated">在树莓上运行演示应用程序</h2><p id="5968" class="pw-post-body-paragraph ky kz it la b lb na ju ld le nb jx lg lh nc lj lk ll nd ln lo lp ne lr ls lt im bi translated">最后，我们可以在 Raspberry 上执行用于检测的演示应用程序。为了做到这一点:</p><ol class=""><li id="ea3c" class="lu lv it la b lb lc le lf lh lw ll lx lp ly lt lz ma mb mc bi translated">在树莓上连接神经计算棒</li><li id="5fcf" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated">将 USB 摄像头连接到 Raspberry</li><li id="7234" class="lu lv it la b lb md le me lh mf ll mg lp mh lt lz ma mb mc bi translated">执行以下命令:</li></ol><pre class="kj kk kl km gt on ol oo op aw oq bi"><span id="4e31" class="nw mj it ol b gy or os l ot ou">cd ~/NCS-demo</span><span id="16b7" class="nw mj it ol b gy oy os l ot ou">python3 object_detection_demo_ssd_async.py \<br/>    -m frozen_inference_graph.xml \<br/>    -i cam  \<br/>    -d MYRIAD \<br/>    -pt 0.6</span></pre><p id="a780" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu"> <em class="ng">提示</em> </strong> <em class="ng">:增减</em> <code class="fe oi oj ok ol b"><em class="ng">-pt</em></code> <em class="ng">标志值。会影响检测的信心。</em></p><p id="7f62" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">正如之前在主机上经历的那样，应该会弹出一个新窗口，以接近 10FPS 的速度显示该网络的推断！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pb"><img src="../Images/54b7e5da38f702c98bb8290f2df51bf4.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*9xy2SBkJ4MU1tLWd4QAqcQ.gif"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Detections on Raspberry Pi @ ~10FPS</figcaption></figure><h1 id="abbc" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">结论</h1><p id="4a61" class="pw-post-body-paragraph ky kz it la b lb na ju ld le nb jx lg lh nc lj lk ll nd ln lo lp ne lr ls lt im bi translated">神经计算棒是一种功能强大的硬件，可用于在低功率系统上执行卷积神经网络。我们的测试显示，与在香草树莓板上执行的推理相比，速度提高了近 10 倍。</p><p id="6158" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这只是硬件方面的起点。我们将在未来看到越来越多的低功率设备上的专用硬件，如手机、平板电脑、个人电脑、汽车、无人机，甚至<a class="ae nh" href="https://www.aikospace.com/" rel="noopener ugc nofollow" target="_blank">卫星</a>。</p><p id="3909" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">毫无疑问，英特尔是这一环境中的主要参与者之一，它在收购 Movidius 公司的同时，也在与脸书一起探索其他解决方案，如<a class="ae nh" href="https://www.intel.ai/ai-at-ces/#gs.0zw5zg" rel="noopener ugc nofollow" target="_blank">英特尔 Nervana </a>。</p><p id="815f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然而，竞争也在这一领域发挥着重要作用。</p><p id="c26e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Xilinx 正在调整他的 ZINQ FPGAs，以便在硬件方面加速边缘神经网络的性能，同时还开发了一个名为 Deephi DNNDK 的软件工具，用于优化低功耗系统的神经网络。</p><p id="e67a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">谷歌也在这方面采取行动，开发了全新的 Edge TPU，专为运行能够在非常低的功率下提高预测速度的<code class="fe oi oj ok ol b">.tflite</code>模型而设计<em class="ng">(敬请期待，我们将很快探索这一解决方案，与 NCS 进行性能比较)</em>。</p><p id="248a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">对于人工智能驱动的嵌入式设备来说，这是一个令人兴奋的时代。</p><p id="2045" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="ng">文章由</em> <a class="ae nh" href="http://www.linkedin.com/in/mattia-varile" rel="noopener ugc nofollow" target="_blank"> <em class="ng">马蒂亚·瓦里勒</em> </a></p><p id="59ec" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">请随意评论这篇文章，以提高他的质量和效果。</p><h1 id="62f0" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">资源</h1><ul class=""><li id="31bb" class="lu lv it la b lb na le nb lh pc ll pd lp pe lt nf ma mb mc bi translated"><a class="ae nh" href="https://software.intel.com/en-us/articles/OpenVINO-Install-Linux" rel="noopener ugc nofollow" target="_blank">Linux 上的详细安装</a></li><li id="3432" class="lu lv it la b lb md le me lh mf ll mg lp mh lt nf ma mb mc bi translated"><a class="ae nh" href="https://software.intel.com/en-us/articles/OpenVINO-Using-TensorFlow#converting-tf-object-detection-api-models" rel="noopener ugc nofollow" target="_blank"> Tensorflow ODAPI 转换指南</a></li><li id="d51f" class="lu lv it la b lb md le me lh mf ll mg lp mh lt nf ma mb mc bi translated"><a class="ae nh" href="https://software.intel.com/en-us/articles/OpenVINO-IE-Samples" rel="noopener ugc nofollow" target="_blank">物体检测固态硬盘演示</a></li><li id="f7e8" class="lu lv it la b lb md le me lh mf ll mg lp mh lt nf ma mb mc bi translated"><a class="ae nh" href="https://software.intel.com/en-us/articles/OpenVINO-Install-RaspberryPI" rel="noopener ugc nofollow" target="_blank">在树莓 P 上安装 OpenVINO</a>I</li></ul></div></div>    
</body>
</html>