<html>
<head>
<title>Extracting shapes from images using OpenCV and Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 OpenCV 和 Python 从图像中提取形状</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/extracting-circles-and-long-edges-from-images-using-opencv-and-python-236218f0fee4?source=collection_archive---------7-----------------------#2019-08-31">https://towardsdatascience.com/extracting-circles-and-long-edges-from-images-using-opencv-and-python-236218f0fee4?source=collection_archive---------7-----------------------#2019-08-31</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="63af" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">利用 OpenCV 从图像中高效提取已知形状的物体</h2></div><p id="3b8e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">欢迎阅读本系列博客中关于使用 OpenCV 和 Python 从图像中提取特征的第一篇文章。</p><p id="2d23" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">图像和视频的特征提取是计算机视觉领域的一个常见问题。在本帖中，我们将考虑识别台球桌上的球和桌边的任务。</p><p id="178c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">考虑下面这个在线台球游戏的例子。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi le"><img src="../Images/3dcbd618e176aa788226bc63cf6af43c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qGtvGr1VsNNg7QJyVNsxFA.png"/></div></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk">Screenshot from an online game of pool (image source author)</figcaption></figure><p id="bd67" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">假设我们想要标记这个图像中每个球的位置以及桌子的四个内边。有多种方法可以做到这一点，对于给定的图像，有些方法比其他方法效果更好。然而，一个有用的方法是尝试根据图像的颜色组成来分离出图像的内容。</p><p id="7561" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，在上面的图像中，我们可以看到桌面、球和图像背景都有不同的颜色。</p><p id="336e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">因此，如果我们能够分离出图像中的颜色，我们就离解决问题更近了一步。</p><p id="6648" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一种简单的方法是将 RBG 图像转换成 HSV 格式，然后找出与感兴趣的对象相对应的 H、S 和 V 值的范围。</p><p id="9a75" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">关于这一步的细节，请参考我的关于 HSV 提取的博客(即将发布)。</p><p id="a547" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一旦我们有了桌面的 HSV 颜色图，我们可以使用 OpenCV <strong class="kk iu"> "inRange()" </strong>函数来获得提取的遮罩的可视化，如下所示。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi lu"><img src="../Images/81d033360ce78489eaf874ed295a96be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FyTgOIzCuAhxgIJx6WxM1w.jpeg"/></div></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk">Image mask generated using OpenCV (image source author)</figcaption></figure><p id="4901" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">正如我们所见，这一步骤有助于实现以下目标:</p><ol class=""><li id="a6d5" class="lv lw it kk b kl km ko kp kr lx kv ly kz lz ld ma mb mc md bi translated">表格对象(白色)与图像背景(黑色)明显不同</li><li id="ceac" class="lv lw it kk b kl me ko mf kr mg kv mh kz mi ld ma mb mc md bi translated">球(黑色)与桌面(白色)清晰可辨</li></ol><p id="50cb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">作为第一步，我们需要从图像中提取表格对象，以便将注意力集中在表格及其内容上，而忽略图像中的其他对象，例如背景、外部对象等。</p><p id="b610" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在是应用边缘检测技术从图像中识别和提取所需成分的正确时间。有多个选项可用，如 Canny 和 Sobel 函数，每个都有其优点和缺点。</p><p id="5be8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们将使用 OpenCV<strong class="kk iu">“find contours()”</strong>函数进行边缘检测，以提取掩模图像中的所有轮廓。面积最大的轮廓是对应于桌子本身的轮廓。</p><p id="12b5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了实现桌子的平滑提取，我们将找到桌子轮廓的外接矩形(OpenCV <strong class="kk iu"> "boundingRect()" </strong>函数)，并使用其坐标从仅包含感兴趣对象的原始图像中提取子图像，在这种情况下，桌子表面和球如下图所示。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi mj"><img src="../Images/ad9abb58a55f74b128a07fe33149fd90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uaEqz48Qknj63xRqEwQRxg.jpeg"/></div></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk">Extracted only the region of interest using OpenCV (image source author)</figcaption></figure><p id="6ce8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在剩下的任务是提取单个的球并识别球台的内边缘。</p><p id="b79b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了实现这一点，我们将再次使用先前使用的基于 HSV 的提取方法来获得遮罩，首先聚焦于球，然后聚焦于桌子边缘。</p><h1 id="45f7" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">探测球</h1><p id="6c1f" class="pw-post-body-paragraph ki kj it kk b kl nc ju kn ko nd jx kq kr ne kt ku kv nf kx ky kz ng lb lc ld im bi translated">球的遮罩图像看起来将与我们之前用于桌子的图像相同。从获得的掩模图像中，我们将再次使用 OpenCV <strong class="kk iu"> "findContours()" </strong>函数提取球轮廓。这一次我们感兴趣的只是那些类似圆的给定大小的轮廓。</p><p id="a88e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">同样，有许多方法来检测球的轮廓，但是最有效的一种方法是为每个检测到的轮廓找到最小的外接矩形，并且选择最类似正方形并且也位于期望的区域范围内的那些。在这种情况下，我们将使用 OpenCV 函数<strong class="kk iu">“minarerect()”</strong>。</p><p id="3d7c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在选定的一组轮廓上，我们将进一步应用 OpenCV<strong class="kk iu">“minEnclosingCircle()</strong>”函数来获得每个球上统一大小的圆。</p><p id="81ea" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在我们只需要使用 OpenCV <strong class="kk iu"> "circle()" </strong>函数用我们选择的任何颜色绘制每个检测到的球。</p><h1 id="8374" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">检测表格边缘</h1><p id="2369" class="pw-post-body-paragraph ki kj it kk b kl nc ju kn ko nd jx kq kr ne kt ku kv nf kx ky kz ng lb lc ld im bi translated">这是一个分两步走的方法，因为表既有外边缘又有内边缘，我们只对后者感兴趣。</p><p id="a951" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">第一步是使用基于 HSV 的方法得到桌子边缘的遮罩。得到的面具看起来像下面，其中所有的四个方面都可以很容易区分。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi nh"><img src="../Images/6d221586f91d10762b9d256462c630b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VIIJQ07wYNW20wAWq8TUbw.jpeg"/></div></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk">Mask for table edges detection obtained using OpenCV (image source author)</figcaption></figure><p id="975a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">有了这个遮罩，我们现在可以通过定位离图像中心最近的两条水平线和两条垂直线来提取内部边缘。</p><p id="1479" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们将使用 OpenCV <strong class="kk iu"> "HoughLines()" </strong>函数来查找图像中的所有线条，并只选择我们感兴趣的 4 条。</p><p id="e7dc" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一旦检测到 4 条线，我们只需要使用 OpenCV <strong class="kk iu"> "line()" </strong>函数来绘制相应的表格边缘。</p><p id="e5f6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后可以将获得的图像覆盖在原始图像上，以完成如下所示的任务。</p><figure class="lf lg lh li gt lj gh gi paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="gh gi ni"><img src="../Images/ce0bf92fd3d9f78cee84b99de1ecf8a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*or1cM06ZjfCkBiUsCVQh7w.png"/></div></div><figcaption class="lq lr gj gh gi ls lt bd b be z dk">Identified all the balls and four table edges with high accuracy (image source author)</figcaption></figure><p id="2f4f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">希望你喜欢阅读这篇文章。</p><p id="5ca9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在我的下一篇文章中，我将介绍另一个有趣的特征提取的例子，请继续关注。</p><p id="0759" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">重要免责声明:</p><p id="3a62" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这篇博文中使用的方法，尤其是用于检测球和桌子边缘的 HSV 值，不一定适用于每张图像。每幅图像的特征都是独一无二的，并且需要正确的参数集，以使特征提取按预期工作。这正是计算机视觉如此有趣和具有挑战性的领域。</p></div></div>    
</body>
</html>