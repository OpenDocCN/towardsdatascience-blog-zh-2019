<html>
<head>
<title>How to get the Python Environment of all Spark Cluster Nodes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何获取所有 Spark 集群节点的 Python 环境</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-get-the-python-environment-of-all-spark-cluster-nodes-2642075e7772?source=collection_archive---------28-----------------------#2019-09-27">https://towardsdatascience.com/how-to-get-the-python-environment-of-all-spark-cluster-nodes-2642075e7772?source=collection_archive---------28-----------------------#2019-09-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/3feb5525dbcb760b2a161f054cf0a7ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qBhyt7bYqD_RMO7TEC9bLQ.png"/></div></div></figure><p id="6fe9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们在<a class="ae kw" href="https://invenium.io/" rel="noopener ugc nofollow" target="_blank"> Invenium </a>对匿名手机位置数据进行分析时，使用了 Apache Spark <strong class="ka ir">等工具。</strong>在我们的应用程序中，我们直接使用 Java API 和 Python API <code class="fe kx ky kz la b">pyspark</code>进行接口。最近，我们注意到在运行我们的算法时出现了不寻常的性能下降。</p><p id="6a33" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在确保我们没有对代码进行任何可能导致性能变化的更改后，我们给集群维护人员发了电子邮件，检查他们那边是否有任何更改。据他们说，除了增加几个新节点外，没有任何变化。然后，我们开始检查调度程序，发现一些节点以正常速度处理任务，而其他节点则慢得令人痛苦。这使我们对新增加的工人产生了怀疑。可能它们的某些配置与现有基础架构不同。</p><h2 id="ee1b" class="lb lc iq bd ld le lf dn lg lh li dp lj kj lk ll lm kn ln lo lp kr lq lr ls lt bi translated">但是如何调试不可访问的节点呢？</h2><p id="c601" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">由于只能直接访问边缘节点，而不能访问工作节点，因此我们想出了一个能够在工作节点上自省 Python 环境的简短脚本:</p><figure class="lz ma mb mc gt jr"><div class="bz fp l di"><div class="md me l"/></div><figcaption class="mf mg gj gh gi mh mi bd b be z dk">Code to query print the environment on worker nodes</figcaption></figure><p id="bfe9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">据我们所知，没有安全的方法来确保脚本在所有节点上运行，因为这依赖于调度程序。作为一种变通方法，下面的代码在<code class="fe kx ky kz la b">NUMBER_OF_PARTITIONS = 10_000</code>分区中启动<code class="fe kx ky kz la b">NUMBER_OF_OPERATIONS = 100_000</code>操作，这些操作通常应该(假设集群上没有太多其他负载)平均分布在工作节点中。根据集群大小和当前负载，您可以尝试增加这些值和/或多次运行脚本，以确保它在每个工作线程上至少执行一次。</p><h2 id="b7fe" class="lb lc iq bd ld le lf dn lg lh li dp lj kj lk ll lm kn ln lo lp kr lq lr ls lt bi translated">我们发现的窃听器</h2><p id="f558" class="pw-post-body-paragraph jy jz iq ka b kb lu kd ke kf lv kh ki kj lw kl km kn lx kp kq kr ly kt ku kv ij bi translated">我们发现所有节点上都安装了相同的软件包，但是，在较新的节点上，一些软件包的版本有所不同。即使情况不应该是这样——您会希望在相同的集群节点上有不同的版本吗？—只要主要版本保持不变，这通常不是问题。但是你永远不应该抛开墨菲定律。不幸的是，包含一个性能错误的<code class="fe kx ky kz la b">pyproj</code>的最新版本恰好在补丁发布前几天安装，导致转换慢得多，从而导致观察到的性能下降。</p><p id="a77a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们希望这可以帮助其他人调试不可访问的集群基础设施。</p></div></div>    
</body>
</html>