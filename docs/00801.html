<html>
<head>
<title>animated plots in R with tweenR</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">带 tweenR 的 R 中的动画情节</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/animated-plots-in-r-with-tweenr-80c48b9f5292?source=collection_archive---------18-----------------------#2019-02-06">https://towardsdatascience.com/animated-plots-in-r-with-tweenr-80c48b9f5292?source=collection_archive---------18-----------------------#2019-02-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/c628e2df4a5f7fb3cf788b6ec0482dee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kRKBilIWC0ZiSZEv9YGVQA.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/photos/QtFAXP6z0Wk?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Markus Spiske</a> on <a class="ae kc" href="https://unsplash.com/search/photos/frames?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure></div><div class="ab cl kd ke hu kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="ij ik il im in"><p id="240f" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">利用动画来展示数据趋势是一个很好的讲述工具。在 R 中有几个创建动画效果的包</p><p id="7eaf" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">我最近遇到了 tweenR，它允许你通过插值创建平滑的过渡。tweenr 包本身实际上并不执行任何动画；相反，它创建中间状态，使动画更流畅。</p><p id="941e" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">下面是一个使用一些虚拟数据的教程:</p><pre class="li lj lk ll gt lm ln lo lp aw lq bi"><span id="5150" class="lr ls iq ln b gy lt lu l lv lw">library(dplyr)<br/>library(scales)<br/>library(tweenr)<br/>library(animation)<br/>library(dplyr)<br/>library(ggplot2)<br/>library(ggthemes)</span><span id="9acd" class="lr ls iq ln b gy lx lu l lv lw"># an example of a time series data frame<br/>plot_data &lt;- data.frame(Date =seq(as.Date("2010/1/1"), as.Date("2019/1/1"), "years"), Value=runif(10,0,1000)) </span><span id="37cc" class="lr ls iq ln b gy lx lu l lv lw"># prepare  data for tween by creating columns for the time between points<br/>df.all&lt;-plot_data %&gt;% <br/>  mutate(day=as.numeric(Date-min(Date)+1),ease="linear")</span><span id="294f" class="lr ls iq ln b gy lx lu l lv lw"># add rows to fill in the gaps<br/>plot_data_tween&lt;-tween_elements(df.all, time = "day",  group="ease", ease="ease", nframes = nrow(df.all)*20)<br/>df_tween_appear &lt;- tween_appear(plot_data_tween, time='day', nframes = nrow(df.all)*10)<br/></span></pre><p id="3405" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">绘图功能:</p><pre class="li lj lk ll gt lm ln lo lp aw lq bi"><span id="fe79" class="lr ls iq ln b gy lt lu l lv lw">make_plot &lt;- function(i){<br/>  plot_data &lt;-  df_tween_appear %&gt;% filter(.frame==i, .age&gt; -3.5) <br/>  p&lt;- plot_data %&gt;%<br/>    ggplot()+<br/>    geom_line(aes(x=Date, y=Value),color="darkgray", size=0.7)+<br/>    geom_point(data=. %&gt;% <br/>              filter(Date==max(Date)),<br/>              mapping=aes(x=Date, y=Value),<br/>              size=3,color="pink",stroke=4)+<br/>    geom_point(data=. %&gt;% <br/>               filter(Date==max(Date)),<br/>               mapping=aes(x=Date, y=Value), color="white", size=2)+<br/>    geom_text(data=. %&gt;% filter(Date==max(Date)),<br/>              mapping=aes(x=Date,<br/>              y=Value,label=round(Value,0)),<br/>              color="black",<br/>              nudge_x=7,hjust=1.5, size=6)+<br/>    geom_line(data=df.all, aes(x=Date,y=Value),alpha=0.1)+<br/>    theme_minimal(base_family = "sans")+<br/>    scale_y_continuous(sec.axis=dup_axis())+<br/>    theme(plot.subtitle=element_text(face="italic",size=14),<br/>          plot.title=element_text(color="darkcyan",size=19),<br/>          plot.caption=element_text(hjust=0),<br/>          panel.grid.major.x = element_line(color="lightgray"),<br/>          panel.grid.minor.x = element_line(color="lightgray"),<br/>          panel.grid.major.y = element_line(color="lightgray"),<br/>          panel.grid.minor.y = element_line(color="lightgray"),<br/>          axis.text.x = element_text(angle = 90, hjust = 1, size=12))+<br/>          labs(x="",y="Total Value",<br/>          caption="All values- 2010-2019.")+<br/>          ggtitle(("Yearly Trends of Values"))<br/>  return(p)<br/>}<br/></span></pre><p id="cfde" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">现在我们循环每一帧并创建情节，然后使用<a class="ae kc" href="https://cran.r-project.org/package=animation" rel="noopener ugc nofollow" target="_blank">动画</a>包的<code class="fe ly lz ma ln b">saveGIF</code>函数保存它。</p><pre class="li lj lk ll gt lm ln lo lp aw lq bi"><span id="12de" class="lr ls iq ln b gy lt lu l lv lw">ani_settings&lt;-ani.options(interval=1/10)  <em class="mb"># N</em>umber to set the time interval of the animation (unit in seconds); <em class="mb">adjust for speed of ani</em></span><span id="e96e" class="lr ls iq ln b gy lx lu l lv lw">saveGIF({for (i in 1:max(df_tween_appear$.frame)){<br/>  g&lt;-make_plot(i)<br/>  print(g)<br/>  print(paste(i,"out of",max(df_tween_appear$.frame)))<br/>  ani.pause() # adds a pause the end of animation<br/>}<br/>},movie.name="gifs/yearlytrends.gif",ani.width = 500, ani.height = 350)</span></pre><figure class="li lj lk ll gt jr gh gi paragraph-image"><div class="gh gi mc"><img src="../Images/0af38d2b83cfe04a8f7752275d5f3b6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*gHdWWGAQT4ZCcc2XeiIjyw.gif"/></div></figure><h1 id="98e9" class="md ls iq bd me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz bi translated"><strong class="ak">一个有趣的例子:时间覆盖了多年</strong></h1><figure class="li lj lk ll gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi na"><img src="../Images/b64bdd59a73c8e73c83ce0e505de002a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ugyZLNO4qoC88Jhf2n_4HA.jpeg"/></div></div></figure><p id="0863" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">我摆弄了一下 Kaggle 的<strong class="km ir">‘时代杂志封面图片’</strong>数据集。</p><p id="e347" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">该数据包含每年登上封面的女性和男性人数。然后我给数据框添加了帧和渐变。</p><p id="a116" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">调整“make_plot”上方的函数，然后在 tween_elements 参数中按性别分组，以便每年创建一个帧。</p><p id="e64e" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">结果图如下所示:</p><p id="ac82" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated"><strong class="km ir">性别人口统计</strong></p><figure class="li lj lk ll gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nb"><img src="../Images/b6b33fea9cf1eb20a1acd87eda44188f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*Yr9bEZf6dot8fR-QlyY3cg.gif"/></div></div></figure><p id="1703" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">我在 R 中找到了一些很棒的动画资源，特别是:tweenr github 有一些教程:<a class="ae kc" href="https://github.com/thomasp85/tweenr" rel="noopener ugc nofollow" target="_blank">https://github.com/thomasp85/tweenr</a></p><p id="b30a" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">我使用了这里的优秀教程来学习和理解 tweenR:</p><p id="19d5" class="pw-post-body-paragraph kk kl iq km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated"><a class="ae kc" href="http://lenkiefer.com/2018/03/18/pipe-tweenr/" rel="noopener ugc nofollow" target="_blank">http://lenkiefer.com/2018/03/18/pipe-tweenr/</a></p></div></div>    
</body>
</html>