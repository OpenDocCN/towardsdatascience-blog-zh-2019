<html>
<head>
<title>What does Twitter think of Star Wars: The Rise of Skywalker? Sentiment Analysis in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">推特是如何看待星球大战：天行者崛起的？Python 中的情感分析</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/what-does-twitter-think-of-star-wars-the-rise-of-skywalker-sentiment-analysis-in-python-45a865d84049?source=collection_archive---------29-----------------------#2019-12-20">https://towardsdatascience.com/what-does-twitter-think-of-star-wars-the-rise-of-skywalker-sentiment-analysis-in-python-45a865d84049?source=collection_archive---------29-----------------------#2019-12-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/ba499b0dae5de2db5906384a3001ae97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*66WS7a8Z4rMX2w6beKCc8Q.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">Photo by <a class="ae kf" href="https://www.pexels.com/@thatguycraig000" rel="noopener ugc nofollow" target="_blank">Craig Adderley</a> on <a class="ae kf" href="https://www.pexels.com/photo/shallow-focus-photo-of-stormtrooper-3526022/" rel="noopener ugc nofollow" target="_blank">Pexels</a></figcaption></figure><p id="69e4" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">《星球大战：天行者崛起》最近在影院上映。迪士尼报告说，这部新电影的预告片获得了 4000 万美元的票房，这使它成为有史以来第五高的预告片。首映周末的票房收入在 1.7 亿到 2 亿美元之间。从这些数字来看，很明显这部新电影是票房成功的。我在这篇文章中试图回答的问题是:twitter 用户对这部电影的普遍看法是什么？</p><p id="ce80" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这篇文章中，我们将使用 twitter python API tweepy 来获取与新的《星球大战》电影相关的 Twitter 消息。然后，我们将使用 TextBlob，一个用于处理文本数据的 python 库，来为与电影相关的推文生成情感分数。最后，我们将使用 python 可视化包 seaborn 和 Matplotlib 来可视化我们的结果。</p><p id="1fd5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">首先，你需要申请一个 Twitter 开发者账户:</p><figure class="lg lh li lj gt ju gh gi paragraph-image"><div class="gh gi lf"><img src="../Images/8de478e493cd200d2ddb35292f06e27d.png" data-original-src="https://miro.medium.com/v2/resize:fit:808/format:webp/1*0xmSHPJRMafMjW4Zr4atYQ.png"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk"><a class="ae kf" href="https://projects.raspberrypi.org/en/projects/getting-started-with-the-twitter-api/3" rel="noopener ugc nofollow" target="_blank">Source</a></figcaption></figure><p id="a903" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在您的开发人员帐户获得批准后，您需要创建一个 Twitter 应用程序:</p><figure class="lg lh li lj gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi lk"><img src="../Images/535749c04db1726dafff300aac41628c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5EGnUjPFY2dF-jUkTdd6QA.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk"><a class="ae kf" href="https://projects.raspberrypi.org/en/projects/getting-started-with-the-twitter-api/4" rel="noopener ugc nofollow" target="_blank">Source</a></figcaption></figure><p id="f9b6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">申请 Twitter 开发者账户和创建 Twitter 应用程序的步骤在<a class="ae kf" href="https://projects.raspberrypi.org/en/projects/getting-started-with-the-twitter-api/4" rel="noopener ugc nofollow" target="_blank">这里</a>有概述。</p><p id="2741" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了访问 Twitter API，我们将使用免费的 python 库 tweepy。tweepy 的文档可以在<a class="ae kf" href="https://tweepy.readthedocs.io/en/latest/getting_started.html" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><ol class=""><li id="44fd" class="ll lm it ki b kj kk kn ko kr ln kv lo kz lp ld lq lr ls lt bi translated"><strong class="ki iu">安装</strong></li></ol><p id="4861" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">首先，确保您已经安装了 tweepy。打开命令行并键入:</p><pre class="lg lh li lj gt lu lv lw lx aw ly bi"><span id="a36d" class="lz ma it lv b gy mb mc l md me">pip install tweepy</span></pre><p id="8039" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">2.<strong class="ki iu">导入库</strong></p><p id="23e6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来，打开您最喜欢的编辑器，导入 tweepy 和 pandas 库:</p><pre class="lg lh li lj gt lu lv lw lx aw ly bi"><span id="725b" class="lz ma it lv b gy mb mc l md me">import tweepy<br/>import pandas as pd</span></pre><p id="9918" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">3.<strong class="ki iu">认证</strong></p><p id="b15e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来，我们需要我们的消费者密钥和访问令牌:</p><figure class="lg lh li lj gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mf"><img src="../Images/6e8d1ea132e104bb6c262ddad9d50495.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7TxOpsOni5I1HAdafJ9BWw.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk"><a class="ae kf" href="https://projects.raspberrypi.org/en/projects/getting-started-with-the-twitter-api/4" rel="noopener ugc nofollow" target="_blank">Source</a></figcaption></figure><p id="d398" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">请注意，该网站建议您保持您的密钥和令牌私有！这里我们定义了一个假的密钥和令牌，但是在创建 Twitter 应用程序时，您应该使用真正的密钥和令牌，如上所示:</p><pre class="lg lh li lj gt lu lv lw lx aw ly bi"><span id="7ab4" class="lz ma it lv b gy mb mc l md me">consumer_key = '5GBi0dCerYpy2jJtkkU3UwqYtgJpRd' <br/>consumer_secret = 'Q88B4BDDAX0dCerYy2jJtkkU3UpwqY'<br/>access_token = 'X0dCerYpwi0dCerYpwy2jJtkkU3U'<br/>access_token_secret = 'kly2pwi0dCerYpjJtdCerYkkU3Um'</span></pre><p id="39f9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下一步是创建 OAuthHandler 实例。我们传递上面定义的消费者密钥和访问令牌:</p><pre class="lg lh li lj gt lu lv lw lx aw ly bi"><span id="607d" class="lz ma it lv b gy mb mc l md me">auth = tweepy.OAuthHandler(consumer_key, consumer_secret)<br/>auth.set_access_token(access_token, access_token_secret)</span></pre><p id="6ffd" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来，我们将 OAuthHandler 实例传递给 API 方法:</p><pre class="lg lh li lj gt lu lv lw lx aw ly bi"><span id="7715" class="lz ma it lv b gy mb mc l md me">api = tweepy.API(auth)</span></pre><p id="58f6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">4.<strong class="ki iu"> TWITTER API 请求</strong></p><p id="2cca" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来，我们为我们有兴趣分析的字段初始化列表。现在，我们可以查看推文字符串、用户和推文时间。接下来，我们在一个 tweepy“Cursor”对象上编写一个 for 循环。在“Cursor”对象中，我们传递“api.search”方法，为我们想要搜索的内容设置查询字符串，并设置“count”= 1000，这样我们就不会超过 Twitter 的速率限制。在这里，我们将搜索关于“星球大战”的推文。我们还使用“item()”方法将“Cursor”对象转换为 iterable。</p><p id="c42f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了简化查询，我们可以删除转发，只包含英文推文。为了了解该请求返回的内容，我们还可以打印附加到每个列表的值:</p><pre class="lg lh li lj gt lu lv lw lx aw ly bi"><span id="7e95" class="lz ma it lv b gy mb mc l md me">twitter_users = []<br/>tweet_time = []<br/>tweet_string = []<br/>for tweet in tweepy.Cursor(api.search,q='Star Wars', count=1000).items(1000):<br/>            if (not tweet.retweeted) and ('RT @' not in tweet.text):<br/>                if tweet.lang == "en":<br/>                    twitter_users.append(tweet.user.name)<br/>                    tweet_time.append(tweet.created_at)<br/>                    tweet_string.append(tweet.text)<br/>                    print([tweet.user.name,tweet.created_at,tweet.text])</span></pre><figure class="lg lh li lj gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mg"><img src="../Images/705f198d810700c7a057d574621ed8a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qhfMAJ6NRdmdr5AdTkbLMQ.png"/></div></div></figure><p id="5da1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了实现可重用性，我们可以将它封装在一个函数中，该函数将关键字作为输入。我们还可以将结果存储在数据帧中并返回值:</p><pre class="lg lh li lj gt lu lv lw lx aw ly bi"><span id="de94" class="lz ma it lv b gy mb mc l md me">def get_related_tweets(key_word):</span><span id="3b60" class="lz ma it lv b gy mh mc l md me">twitter_users = []<br/>    tweet_time = []<br/>    tweet_string = [] <br/>    for tweet in tweepy.Cursor(api.search,q=key_word, count=1000).items(1000):<br/>            if (not tweet.retweeted) and ('RT @' not in tweet.text):<br/>                if tweet.lang == "en":<br/>                    twitter_users.append(tweet.user.name)<br/>                    tweet_time.append(tweet.created_at)<br/>                    tweet_string.append(tweet.text)<br/>                    print([tweet.user.name,tweet.created_at,tweet.text])<br/>    df = pd.DataFrame({'name':twitter_users, 'time': tweet_time, 'tweet': tweet_string})<br/>    <br/>    return df</span></pre><p id="148a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果用关键字“星球大战:天行者崛起”调用函数，我们会得到:</p><pre class="lg lh li lj gt lu lv lw lx aw ly bi"><span id="9997" class="lz ma it lv b gy mb mc l md me">get_related_tweets("Star Wars: The Rise of Skywalker")</span></pre><figure class="lg lh li lj gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mi"><img src="../Images/c7ed298305f125a6e7b947dab4ac51c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1pvIr9wQki2JYMzxkDo84g.png"/></div></div></figure><p id="8d10" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了获得情感分数，我们需要导入一个名为 textblob 的 python 包。textblob 的文档可以在这里找到<a class="ae kf" href="https://textblob.readthedocs.io/en/dev/" rel="noopener ugc nofollow" target="_blank">。要安装 textblob，请打开命令行并键入:</a></p><pre class="lg lh li lj gt lu lv lw lx aw ly bi"><span id="8985" class="lz ma it lv b gy mb mc l md me">pip install textblob</span></pre><p id="bdb1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下次导入 textblob:</p><pre class="lg lh li lj gt lu lv lw lx aw ly bi"><span id="aefd" class="lz ma it lv b gy mb mc l md me">from textblob import TextBlob</span></pre><p id="4fd1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们将使用极性得分作为积极或消极感觉的衡量标准。极性得分是一个从-1 到+1 的浮点数。</p><p id="864c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">例如，如果我们定义一个 textblob 对象并传入句子“我喜欢新的星球大战电影”,我们应该得到一个正值的极性分数:</p><pre class="lg lh li lj gt lu lv lw lx aw ly bi"><span id="b18c" class="lz ma it lv b gy mb mc l md me">sentiment_score = TextBlob("I love the new Star Wars movie").sentiment.polarity<br/>print("Sentiment Polarity Score:", sentiment_score)</span></pre><figure class="lg lh li lj gt ju gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/694d21fa477d339c96e62d5403caeb22.png" data-original-src="https://miro.medium.com/v2/resize:fit:642/format:webp/1*9zblRj3WYx0kTfyZynknAQ.png"/></div></figure><p id="1f3d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们给关于“星球大战：天行者崛起”的推文打分:</p><pre class="lg lh li lj gt lu lv lw lx aw ly bi"><span id="d500" class="lz ma it lv b gy mb mc l md me">df = get_related_tweets("Star Wars: The Rise of Skywalker")<br/>df['sentiment'] = df['tweet'].apply(lambda tweet: TextBlob(tweet).sentiment.polarity)<br/>print(df.head())</span></pre><figure class="lg lh li lj gt ju gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/0d9de91ebdaed1a9815ff9fcf63eb4b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1084/format:webp/1*lbfoYdXpjOZjjYsLRaU2UA.png"/></div></figure><p id="0121" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们也可以计算积极和消极情绪的数量:</p><pre class="lg lh li lj gt lu lv lw lx aw ly bi"><span id="a518" class="lz ma it lv b gy mb mc l md me">df_pos = df[df['sentiment'] &gt; 0.0]<br/>df_neg = df[df['sentiment'] &lt; 0.0]<br/>print("Number of Positive Tweets", len(df_pos))<br/>print("Number of Negative Tweets", len(df_neg))</span></pre><figure class="lg lh li lj gt ju gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/2d4a51e9de6c2f0469bb6a4508e1dc14.png" data-original-src="https://miro.medium.com/v2/resize:fit:424/format:webp/1*tTDNvcbdeIM0Dsj0PGdDtQ.png"/></div></figure><p id="9a72" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">同样，对于代码重用，我们可以将其全部封装在一个函数中:</p><pre class="lg lh li lj gt lu lv lw lx aw ly bi"><span id="9cc7" class="lz ma it lv b gy mb mc l md me">def get_sentiment(key_word):<br/>    df = get_related_tweets(key_word)<br/>    df['sentiment'] = df['tweet'].apply(lambda tweet: TextBlob(tweet).sentiment.polarity)<br/>    df_pos = df[df['sentiment'] &gt; 0.0]<br/>    df_neg = df[df['sentiment'] &lt; 0.0]<br/>    print("Number of Positive Tweets about {}".format(key_word), len(df_pos))<br/>    print("Number of Negative Tweets about {}".format(key_word), len(df_neg))</span></pre><p id="b99a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果我们用“星球大战：天行者崛起”调用这个函数，我们得到:</p><pre class="lg lh li lj gt lu lv lw lx aw ly bi"><span id="06ac" class="lz ma it lv b gy mb mc l md me">get_sentiment("Star Wars: The Rise of Skywalker")</span></pre><figure class="lg lh li lj gt ju gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/6a106c93f794a39a4f2eeec749bae9c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/format:webp/1*aPosmK4w-6ecRk6GofWtRg.png"/></div></figure><p id="c7fa" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们也可以试试《星球大战》:</p><pre class="lg lh li lj gt lu lv lw lx aw ly bi"><span id="79df" class="lz ma it lv b gy mb mc l md me">get_sentiment("Star Wars")</span></pre><figure class="lg lh li lj gt ju gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/897bb72e773d45c4ef508c925e523aef.png" data-original-src="https://miro.medium.com/v2/resize:fit:672/format:webp/1*7kHRRa6vx2TD0_banvAt7A.png"/></div></figure><p id="0686" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果我们能以编程方式可视化这些结果，那将会很方便。让我们导入 seaborn 和 matplotlib 并修改我们的 get _ 情操函数:</p><pre class="lg lh li lj gt lu lv lw lx aw ly bi"><span id="f731" class="lz ma it lv b gy mb mc l md me">import seaborn as sns<br/>import matplotlib.pyplot as plt<br/>def get_sentiment(key_word):<br/>    df = get_related_tweets(key_word)<br/>    df['sentiment'] = df['tweet'].apply(lambda tweet: TextBlob(tweet).sentiment.polarity)<br/>    df_pos = df[df['sentiment'] &gt; 0.0]<br/>    df_neg = df[df['sentiment'] &lt; 0.0]<br/>    print("Number of Positive Tweets about {}".format(key_word), len(df_pos))<br/>    print("Number of Negative Tweets about {}".format(key_word), len(df_neg))<br/>    sns.set()<br/>    labels = ['Postive', 'Negative']<br/>    heights = [len(df_pos), len(df_neg)]<br/>    plt.bar(labels, heights, color = 'navy')<br/>    plt.title(key_word)<br/>    <br/>get_sentiment("Star Wars: The Rise of Skywalker")</span></pre><figure class="lg lh li lj gt ju gh gi paragraph-image"><div class="gh gi lf"><img src="../Images/a2eb0bfff38474bf14e5e0be8900f3ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:808/format:webp/1*6G41UDdBYyg5hx75pm2Rvw.png"/></div></figure><p id="7080" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">而对于《星球大战》:</p><pre class="lg lh li lj gt lu lv lw lx aw ly bi"><span id="78f5" class="lz ma it lv b gy mb mc l md me">get_sentiment("Star Wars")</span></pre><figure class="lg lh li lj gt ju gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/35eb6ab00fd22c03ff42aea8b5eff32e.png" data-original-src="https://miro.medium.com/v2/resize:fit:760/format:webp/1*QzhBIJK173gI3J4PJ2HHrA.png"/></div></figure><p id="65e9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如你所见，关于<em class="le">星球大战：天行者崛起</em>的推文正面情绪多于负面情绪。我知道我很期待这个周末自己去看。收集几天的数据来观察情绪如何随时间变化会很有趣。也许我会把它留到以后的文章里。</p><p id="e84f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">感谢您的阅读。这篇文章的代码可以在<a class="ae kf" href="https://github.com/spierre91/medium_code" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到。祝好运，机器学习快乐！</p></div></div>    
</body>
</html>