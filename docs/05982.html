<html>
<head>
<title>Midnight Hack 1: Visualizing my Swiggy Order History</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">午夜黑客 1:可视化我的 Swiggy 订单历史</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/midnight-hack-episode-1-visualizing-my-swiggy-order-history-f1cce25cbff6?source=collection_archive---------9-----------------------#2019-08-31">https://towardsdatascience.com/midnight-hack-episode-1-visualizing-my-swiggy-order-history-f1cce25cbff6?source=collection_archive---------9-----------------------#2019-08-31</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="4566" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">却没有耐心去阅读？别担心。</p><p id="a671" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面是<a class="ae kl" href="https://swiggy-order-dashboard.herokuapp.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">可视化仪表盘</strong> </a> <strong class="jp ir">，</strong> <a class="ae kl" href="https://www.youtube.com/watch?v=M5qhpyvUYhw" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">仪表盘预览</strong> </a> <strong class="jp ir"> </strong>下面是项目<a class="ae kl" href="https://github.com/AtomicSpider/Swiggy-Dashboard" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> Github 链接</strong> </a>。</p></div><div class="ab cl km kn hu ko" role="separator"><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr"/></div><div class="ij ik il im in"><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="gh gi kt"><img src="../Images/353001f727c883959bc46a4aea43e6c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WSqoOZwryXVOJw0djaZsvw.jpeg"/></div></div></figure></div><div class="ab cl km kn hu ko" role="separator"><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr"/></div><div class="ij ik il im in"><p id="b87c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在是晚上 11 点，当我在去订多份午夜餐的路上时，我心想:</p><blockquote class="lf lg lh"><p id="9a1f" class="jn jo li jp b jq jr js jt ju jv jw jx lj jz ka kb lk kd ke kf ll kh ki kj kk ij bi translated">我不太清楚自己的点餐习惯。有趋势吗？我能否从我的订购历史中获得一些有意义的见解？</p></blockquote><p id="d7a1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当我在 Swiggy(一个印度食品订购和交付应用程序)上浏览甜点选项时，我试图弄清楚如何才能获得我的订单历史数据。现在，我从过去的经验中了解到，有时友好的请求会奏效。让我们试试那个。</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="gh gi lm"><img src="../Images/6df85a1dc9f33178bf1c847560c16bd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MQ-HkZkspvq5jLywARSHbg.jpeg"/></div></div></figure><p id="df43" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以是的，那没有成功，但是有志者事竟成。</p><p id="c178" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我大概可以在订单历史页面上拦截对<a class="ae kl" href="https://www.swiggy.com/" rel="noopener ugc nofollow" target="_blank"> Swiggy </a>应用的网络请求。我知道像 Drony 这样的应用可以做到这一点。但是我必须开发一个定制的应用程序，以便遍历所有的订单页面并汇总结果。aggggggghhhhhhhhh……好像工作量太大了。我们称这个计划为 b 计划吧。如果没有别的办法，b 计划会回来的。</p><p id="de9f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我想网络会是更好的选择。相对更容易黑。我只希望他们的网站上还有订单历史页面。</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="gh gi ln"><img src="../Images/2ed0bc68ea7785c7b453167239cf9de2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bR0BoZ_tD0E18wuTmch87Q.png"/></div></div></figure><p id="037a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">耶，他们有一个功能齐全的网站。我以为他们已经完全移动化了。嗯，对我来说不错。他们甚至有订单历史页面。我现在泪流满面。戴夫眼泪:')</p><p id="204c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们打开 chrome 开发工具，看看一些网络请求，好吗？</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="gh gi lo"><img src="../Images/8533ddb9206218e9f9894a4b46931a74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GPs_pFt5LTL8TAOM2uKu7w.png"/></div></div><figcaption class="lp lq gj gh gi lr ls bd b be z dk">Order list response</figcaption></figure><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="gh gi lt"><img src="../Images/c9e95063bd8651236791b370d9be9f2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yufZaAqf0SebcszVaM3qSg.png"/></div></div><figcaption class="lp lq gj gh gi lr ls bd b be z dk">GET request headers</figcaption></figure><p id="bf09" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">哦，那个甜甜的 JSON 回复:)</p><p id="4045" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">看起来 order_id 是分页的参数。</p><p id="f71a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">他们似乎在使用 CSRF 代币。查看请求头，似乎他们使用 cookies 来维护会话，并使用 CSRF 令牌来避免第三方客户端请求。我以为他们会使用一些简单的 JWT 令牌，所以我打算使用 python 来处理网络请求，但我想这不是一个选项。</p><p id="72b0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最好通过浏览器访问 API。不确定这是否可行，但让我们试一试。</p><pre class="ku kv kw kx gt lu lv lw lx aw ly bi"><span id="130f" class="lz ma iq lv b gy mb mc l md me">var xmlHttp = new XMLHttpRequest();<br/>xmlHttp.open( “GET”, “<a class="ae kl" href="https://www.swiggy.com/dapi/order/all?order_id=" rel="noopener ugc nofollow" target="_blank">https://www.swiggy.com/dapi/order/all?order_id=</a>", false );<br/>xmlHttp.send( null );<br/>console.log(xmlHttp.responseText);</span></pre><p id="bca3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当我登录时，这个简单的 JS 片段应该能够使用会话 cookies 获取订单数据。</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="gh gi mf"><img src="../Images/3a20adf728e7ff9abbed884370997d15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K_2ZprJ7DrRIiDQHF9SqkA.png"/></div></div><figcaption class="lp lq gj gh gi lr ls bd b be z dk">Order response through JS snippet</figcaption></figure><p id="16a1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">而且成功了:')</p><p id="13c1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我没想到它会和他们采取的所有安全措施一起工作，但是嘿嘿嘿…..</p><p id="9058" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，我所要做的就是修改脚本，这样它就可以对所有页面进行分页，并为我提供汇总数据。</p><pre class="ku kv kw kx gt lu lv lw lx aw ly bi"><span id="dafc" class="lz ma iq lv b gy mb mc l md me">order_array=[]<br/>order_id=’’<br/>page = 1</span><span id="2393" class="lz ma iq lv b gy mg mc l md me">try {<br/>    while(true){<br/>        var xmlHttp = new XMLHttpRequest()<br/>        xmlHttp.open( “GET”, “<a class="ae kl" href="https://www.swiggy.com/dapi/order/all?order_id=" rel="noopener ugc nofollow" target="_blank">https://www.swiggy.com/dapi/order/all?order_id=</a>"+order_id, false )<br/>        xmlHttp.send( null )<br/>        resText=xmlHttp.responseText<br/>        var resJSON = JSON.parse(resText)<br/>        order_id=resJSON.data.orders[resJSON.data.orders.length-1].order_id<br/>        order_array=order_array.concat(resJSON.data.orders)<br/>        console.log(“On page: “+page+” with last order id: “+order_id)<br/>        page++<br/>    }<br/>}<br/>catch(err) {<br/>    console.log(order_array)<br/>}</span></pre><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="gh gi mh"><img src="../Images/aebc1523cdd4c6fbb0788c3d89342ad7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CPCXH2C58lSGCC3xmjdiIw.png"/></div></div><figcaption class="lp lq gj gh gi lr ls bd b be z dk">Complete order history</figcaption></figure><p id="df7c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">总计<strong class="jp ir"> 53 </strong>页和<strong class="jp ir"> 518 </strong>订单。</p><p id="6ef7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">*看着他松软的肚子。</p><p id="b1fa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">还不错。一点也不差。*内心呐喊</p><p id="6b2b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，我可以添加一些代码来保存文件中的数据，但有一个更简单的方法。右键单击数据&gt;存储为全局变量。使用命令复制复制剪贴板中的数据。</p><pre class="ku kv kw kx gt lu lv lw lx aw ly bi"><span id="fcb9" class="lz ma iq lv b gy mb mc l md me">copy(temp1)</span></pre><p id="76dd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将其粘贴到记事本中并保存。瞧，现在你有了整个<a class="ae kl" href="https://www.swiggy.com/" rel="noopener ugc nofollow" target="_blank"> Swiggy </a>的历史。</p></div><div class="ab cl km kn hu ko" role="separator"><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr"/></div><div class="ij ik il im in"><p id="deda" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">是<strong class="jp ir">文本数据</strong>的<strong class="jp ir"> 5MB </strong>，信息很多。最初，我想以文本形式获得一些见解，但是，看看这些数据，最好创建一个可视化的仪表板。</p><p id="05bc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我真的没有任何创建可视化的经验，但是在浏览了大量的文档和评估工具之后，比如 J <strong class="jp ir"> upyter Notebooks，Matplotlib，Plotly，Dash</strong>；我决定和达什一起去。它有一个非常直接的布局过程，并且与 python 配合得很好。</p></div><div class="ab cl km kn hu ko" role="separator"><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr"/></div><div class="ij ik il im in"><p id="ea98" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在是第二天下午 4:20。经过一整夜的分析和设计，这是最终的结果。</p><figure class="ku kv kw kx gt ky"><div class="bz fp l di"><div class="mi mj l"/></div></figure><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="gh gi ln"><img src="../Images/86e02dcefc898c1eeee0512198209b00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I0xSMGOyeADny1KW4McDsA.png"/></div></div><figcaption class="lp lq gj gh gi lr ls bd b be z dk">Screencap of Visualization Page</figcaption></figure><p id="9bd9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可以在这里 查看我的可视化仪表盘<a class="ae kl" href="https://swiggy-order-dashboard.herokuapp.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">。如果您想可视化自己的<a class="ae kl" href="https://www.swiggy.com/" rel="noopener ugc nofollow" target="_blank"> Swiggy </a>订单历史，所有需要的资源都托管在<a class="ae kl" href="https://github.com/AtomicSpider/Swiggy-Dashboard" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">这里</strong> </a>。</strong></a></p></div><div class="ab cl km kn hu ko" role="separator"><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr"/></div><div class="ij ik il im in"><p id="8686" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我认为我从这个项目中得到的最有用的见解是我在食物上花了多少钱，这也是从一个单一的来源得到的。我不知道自己在 Swiggy 上花了多少钱。</p><p id="0c1f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">直到下一次…</p></div></div>    
</body>
</html>