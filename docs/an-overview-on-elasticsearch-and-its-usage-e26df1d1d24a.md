# 弹性搜索及其应用综述

> 原文：<https://towardsdatascience.com/an-overview-on-elasticsearch-and-its-usage-e26df1d1d24a?source=collection_archive---------1----------------------->

# 简介

Elasticsearch 是一个高度可扩展的开源全文搜索和分析引擎。它允许您以接近实时的速度快速存储、搜索和分析大量数据。它通常用作支持具有复杂搜索功能和需求的应用程序的底层引擎/技术。Elasticsearch 在 Lucene StandardAnalyzer 之上提供了一个分布式系统，用于索引和自动类型猜测，并利用一个基于 JSON 的 REST API 来引用 Lucene 特性。

它很容易开箱设置，因为它提供了合理的默认设置，并对初学者隐藏了复杂性。它有一个短的学习曲线来掌握基础知识，所以任何人只要稍加努力就可以很快变得富有成效。它是无模式的，使用一些缺省值来索引数据。

> 在消费者从电子商务网站搜索产品信息的情况下，目录面临着产品信息检索时间长等问题。这导致了糟糕的用户体验，进而错失了潜在客户。如今，企业正在寻找替代方法，以快速检索的方式存储大量数据。这可以通过采用 NOSQL 而不是 RDBMS(关系数据库管理系统)来存储数据来实现。

Elasticsearch 是一个 NOSQL 数据库,因为:

*   它易于使用
*   有一个很棒的社区
*   与 JSON 的兼容性
*   广泛的使用案例

# 后端组件

为了更好地理解 Elasticsearch 及其用法，对主要后端组件有一个大致的了解是有好处的。

## 结节

节点是作为集群一部分的单个服务器，存储我们的数据，并参与集群的索引和搜索功能。就像集群一样，节点由名称标识，默认情况下，名称是启动时分配给节点的随机通用唯一标识符(UUID)。如果需要，我们可以编辑默认的节点名。

## 串

集群是一个或多个节点的集合，这些节点共同保存您的全部数据，并提供联合索引和搜索功能。可以有 N 个节点具有相同的集群名称。
Elasticsearch 在分布式环境中运行:通过跨集群复制，辅助集群可以作为热备份发挥作用。

## 索引

索引是具有相似特征的文档的集合。例如，我们可以为特定的客户建立一个索引，为产品信息建立一个索引，为不同类型的数据建立一个索引。执行索引搜索、更新和删除操作时，索引由引用该索引的唯一名称来标识。在一个集群中，我们可以定义任意多的索引。索引类似于 RDBMS 中的数据库。

## 文件

文档是可以被索引的基本信息单元。例如，您可以有一个关于产品的索引，然后有一个针对单个客户的文档。该文档以 JSON (JavaScript 对象符号)表示，这是一种无处不在的互联网数据交换格式。类似于数据库中的单个原始数据。在一个索引中，您可以存储任意多的文档，因此在同一个索引中，您可以有一个针对单个产品的文档，还有一个针对单个订单的文档。

## 碎片和复制品

Elasticsearch 提供了将索引细分为多个片段的能力。当您创建一个索引时，您可以简单地定义您想要的碎片数量。每个碎片本身就是一个全功能的独立“索引”，可以托管在集群中的任何节点上。
Shards 非常重要，因为它允许水平分割您的数据量，还可能在多个节点上并行操作，从而提高性能。还可以通过将索引的多个副本制作成副本碎片来使用碎片，这在云环境中有助于提供高可用性。

# 弹性叠层

尽管搜索引擎是其核心，但用户开始使用 Elasticsearch 搜索日志，并希望轻松地摄取和可视化它们。 *Elasticsearch、Logstash、Kibana* 是弹性栈的主要组成部分，被称为 *ELK* **。**

## 基巴纳

Kibana 让您可视化您的 Elasticsearch 数据并浏览 Elastic 堆栈。您可以从一个问题开始，选择赋予数据形状的方式，找出交互式可视化将把您引向何处。您可以从经典图表(直方图、折线图、饼图、太阳图等)开始，或者设计自己的可视化并在任何地图上添加地理数据。
您还可以执行高级时间序列分析，发现数据中的视觉关系，并利用机器学习功能探索异常情况。更多详情请看官方页面。

![](img/48b207bab33a7bab25fddd8ca7c0895a.png)

Kinbana console

## Logstash

Logstash 是一个开源的服务器端数据处理管道，它同时从多个来源获取数据，对其进行转换，然后将其发送到 collect。数据通常以多种格式分散或污染在多个系统中。在 Logstash 上，可以接收日志、指标、web 应用程序、数据存储和各种 AWS 服务，所有这些都以连续流的方式进行。它可以与不同的模块一起使用，如 *Netflow* ，以获得对您的网络流量的见解。
它通过识别命名字段来构建结构，动态地转换和准备数据，而不考虑格式，并将其转换为通用格式。您可以使用 X-Pack 中的[监控特性来深入了解关于您的 Logstash 部署的指标。在 overview dashboard 中，您可以看到 Logstash 接收和发送的所有事件，以及关于内存使用和正常运行时间的信息。然后，您可以深入查看特定节点的统计信息。更多详情请访问官方页面](https://www.elastic.co/products/x-pack/monitoring)。

![](img/a5c085324c4ea75c0aa7584f68d57f88.png)

logstash node stats

# 弹性搜索用例

Elasticsearch 可以以如此多的方式使用，以至于我很难捕捉到所有最有趣的用例。为了简单起见，我选择了三个主要类别和三个主要公司用例，如果你想深入了解，可以看看它们的用例[页](https://www.elastic.co/use-cases\)。

*   **主数据存储**:创建可搜索的目录、文档存储和日志系统。
*   **补充技术**:给 SQL、mongoDB 增加可视化能力，给 Hadoop 增加 cast 索引和搜索，或者给 kafka 增加处理和存储。
*   **附加技术**:如果您已经登录了 Elasticsearch，您可能希望添加指标、监控和分析功能。

## 网飞

幕后的网飞信息系统正在使用 Elasticsearch。消息系统分为以下几类:

*   加入服务时收到的消息。
*   一旦人们加入，他们会收到关于他们可能喜欢的内容或服务器上的新功能的消息。
*   一旦他们通过机器学习算法对你有了更多的了解，他们就会发送更多关于你可能喜欢或喜欢看什么的迷人和个性化的信息。
*   如果你决定退出服务，他们会告诉你如何回来。

这些都是通过邮件、app 推送通知、短信来完成的。为了有效地实现这一点，他们需要几乎立即知道消息传递中可能出现的问题。为此，为消息生命周期引入了 Elasticsearch(以前他们使用分布式 grep)。
简而言之，每条状态信息都记录在 Elasticsearch 上，合适的团队可以通过在 Kibana 上编写查询来过滤每个类别。

假设推出了一部新电影，在这种情况下，必须将“*新片名*”消息发送给所有客户。
使用 Kibana，他们可以实时看到有多少人收到了新消息的通知，以及消息发送的成功率。他们还可以验证某些消息失败的原因。这带来了更快地调查和解决问题的能力，例如 2012 年巴西的高比率消息失败。

通过使用 Kibana 中的饼图，他们几乎可以立即发现大量的无效会员失败。他们跟踪调查了国家提供商，发现在 7 月 29 日，在许多巴西地区，所有现有手机号码的左边都添加了[数字 9](https://en.wikipedia.org/wiki/Telephone_numbers_in_Brazil)，而不管它们之前的初始数字是多少。这一变化旨在增加圣保罗等大都市地区的电话号码容量，从而消除该地区长期存在的号码短缺问题。
多亏了 Elasticsearch，他们能够近乎实时地发现所有这些故障，并及时与提供商跟进。

## 国外手机交友软件

这是一家大型 tec 公司和 Elasticsearch 社区相互合作的例子。Tinder 的核心是一个搜索引擎。搜索查询非常复杂，涉及两位数的事件、数百个国家和 50 多种语言。
大多数用户交互都会触发 Elasticsearch 查询。
根据位置不同，与 tinder 的交互方式也不同。例如在亚洲，他们也用它作为语言交换或寻找导游。
因此，Tinder 中的查询非常复杂。它们必须是:

*   **个性化:**机器学习算法也在这种情况下使用。
*   **基于位置:**根据您在某个时间点的位置来查找匹配。
*   **双向:**知道哪些用户会互相向右滑动，基本上就是匹配了。
*   **实时:**大量用户的整个交互必须在几毫秒内发生，并且每个用户都有许多相关的变量。

考虑到所有这些功能，后端现实非常复杂，从数据科学和机器学习扩展到双向排名和地理定位。Elasticsearch 的基石是让这些组件以一种非常高效的方式协同工作。在这种情况下，绩效是一个障碍。为此，他们一直在与 Elasticsearch 团队合作，微调许多参数并解决问题。通过这种方式，他们一直在支持 Elasticsearch 社区，并帮助改善整个 Elastic stack 产品，同时改善 Tinder 本身的用户体验。

## 思科商务交付平台

Elasticsearch 于 2017 年推出，当时他们升级了他们的[商业平台](https://apps.cisco.com/Commerce)。他们从 RDBMS 转向 Elasticsearch 的原因如下:

*   添加在主动/主动模式下工作的容错功能。RDBMS 不是分布式的，也不是容错的。
*   基于等级和类型的提前搜索来自 30/40 属性的多个数据库的数据，以获得亚秒级响应。
*   全局搜索:如果在搜索中没有指定特定的对象，搜索引擎将根据多个对象查找结果。

## 思科威胁情报部门

简而言之，思科威胁情报部门或*思科 Talos* 正在阻止恶意软件和垃圾邮件使*“互联网管道”*饱和。
在这个思科部门，他们每天查看超过 150 万个恶意软件样本。恶意负载和垃圾邮件占所有电子邮件流量的 86%(每天超过 6000 亿封电子邮件)。
Talos 的威胁情报团队负责在网络上发现新的全球规模的漏洞，并找出真正的坏人。
他们通过分析 ssh 终端和路由器蜜罐的流量模式来检测新的漏洞利用工具包，以收集异常行为，如使用暴力攻击猜测用户和密码的尝试登录。通过这种方式，他们记录了攻击者登录后使用的命令，他们从服务器下载和上传的文件(虽然难以置信，但互联网上的大多数凭证都像行密码和用户名 admin 一样简单)。
是他们在 2015 年阻止了所谓的[*ssh psychs*](https://blogs.cisco.com/security/talos/sshpsychos)。众所周知，该组织通过从特定类别的 IP 生成 SSH 暴力登录尝试，在互联网上创建了大量的扫描流量。一旦他们能够以 root 用户身份进入服务器，他们就可以下载并安装 DDoS rootkits。

自 2017 年以来，他们使用 logstash 和 kibana 来检测和分析可能的全球规模线程。

# 结论

Elasticsearch 是一个分布式、RESTful 和分析型搜索引擎，能够解决各种各样的问题。
许多公司正在转向 it 并将其集成到当前的后端基础设施中，因为:

*   它允许使用*聚合*缩小到您的数据，并理解数十亿条日志行。
*   它结合了不同类型的搜索:*结构化、非结构化、地理、应用程序搜索、安全分析、指标和日志记录*。
*   它真的很快，可以在只有一个节点的笔记本电脑上运行，也可以在有数百台服务器的集群上运行，这使得*非常容易原型化*。
*   它使用标准的 RESTful APIs 和 JSON。该社区还以多种语言构建和维护客户端，如 *Java、Python、.NET、SQL、Perl、PHP* 等。
*   通过使用*Elasticsearch-Hadoop*(ES-Hadoop)连接器，可以将 elastic search 的实时搜索和分析功能应用于您的大数据。
*   像 *Kibana* 和 *Logstash* 这样的工具允许你通过使用图表和执行粒度搜索，以非常简单和直接的方式理解你的数据。

在本文中，我们仅仅触及了弹性搜索能力和用例的皮毛，而各种业务挑战是可以解决的。如果你有兴趣了解更多或测试它，看看他们的[产品页面](https://www.elastic.co/products/elasticsearch)和他们的[教程](https://www.elastic.co/guide/en/elasticsearch/reference/current/getting-started-install.html)快速开始。如果你对如何使用 django 和 elasticsearch 创建一个基本的搜索应用感兴趣，我鼓励你看看我以前的文章。