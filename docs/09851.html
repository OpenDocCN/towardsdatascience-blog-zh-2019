<html>
<head>
<title>Machine Learning to Predict Stock Prices</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">机器学习预测股票价格</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/predicting-stock-prices-using-a-keras-lstm-model-4225457f0233?source=collection_archive---------2-----------------------#2019-12-26">https://towardsdatascience.com/predicting-stock-prices-using-a-keras-lstm-model-4225457f0233?source=collection_archive---------2-----------------------#2019-12-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="37e3" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph">金融中的人工智能</h2><div class=""/><div class=""><h2 id="c677" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">利用 LSTM 模型预测股票趋势</h2></div><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ko"><img src="../Images/f106889723e32adf505d48341e68ad84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*hVQp6GjkMF0ynqCLPxSAgA.png"/></div></figure><p id="bd3c" class="pw-post-body-paragraph kw kx iq ky b kz la ka lb lc ld kd le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">随着金融机构开始接受人工智能，机器学习越来越多地被用来帮助做出交易决策。虽然有大量的股票数据供机器学习模型训练，但高信噪比和影响股票价格的众多因素是预测市场困难的几个原因之一。同时，这些模型不需要达到很高的精确度，因为即使 60%的精确度也能带来稳定的回报。预测股票价格的一种方法是使用长短期记忆神经网络(LSTM)进行时间序列预测。</p><h1 id="810b" class="ls lt iq bd lu lv lw lx ly lz ma mb mc kf md kg me ki mf kj mg kl mh km mi mj bi translated">LSTM:简要说明</h1><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi mk"><img src="../Images/73b6462219bbd1c85aa726bc2fc18cf5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DbzpEg77lJr5r_ZKgXfALw.png"/></div></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk">LSTM diagram (<a class="ae mt" href="https://colah.github.io/posts/2015-08-Understanding-LSTMs/" rel="noopener ugc nofollow" target="_blank">source</a>)</figcaption></figure><p id="3751" class="pw-post-body-paragraph kw kx iq ky b kz la ka lb lc ld kd le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">LSTMs 是递归神经网络(RNNs)的改进版本。rnn 类似于人类的学习。当人类思考时，我们并不是每秒钟都从零开始思考。例如，在句子“鲍勃打篮球”中，我们知道鲍勃是打篮球的人，因为我们在阅读句子时保留了过去单词的信息。类似地，rnn 是具有环路的网络，这允许它们在到达最终输出之前使用过去的信息。然而，随着时间间隔的增长，RNNs 只能连接最近的先前信息，而不能连接信息。这就是 LSTMs 发挥作用的地方；LSTMs 是一种 RNN，可以长时间记忆信息，这使它们更适合预测股票价格。有关 LSTMs 的技术解释，请点击<a class="ae mt" rel="noopener" target="_blank" href="/illustrated-guide-to-lstms-and-gru-s-a-step-by-step-explanation-44e9eb85bf21">此处</a>。</p><h1 id="b152" class="ls lt iq bd lu lv lw lx ly lz ma mb mc kf md kg me ki mf kj mg kl mh km mi mj bi translated">导入/初始数据</h1><p id="e5a8" class="pw-post-body-paragraph kw kx iq ky b kz mu ka lb lc mv kd le lf mw lh li lj mx ll lm ln my lp lq lr ij bi translated">为了开始我们的项目，我们导入 numpy 来进行科学计算，导入 pandas 来加载和修改数据集，导入 matplotlib 来绘制图形。</p><pre class="kp kq kr ks gt mz na nb nc aw nd bi"><span id="3145" class="ne lt iq na b gy nf ng l nh ni">import numpy as np</span><span id="61ff" class="ne lt iq na b gy nj ng l nh ni">import matplotlib.pyplot as plt</span><span id="f0ca" class="ne lt iq na b gy nj ng l nh ni">import pandas as pd</span></pre><p id="ea49" class="pw-post-body-paragraph kw kx iq ky b kz la ka lb lc ld kd le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在进行必要的导入后，我们加载 Tata Global Beverage 过去股价的数据。从数据中，我们选择第一列和第二列的值(分别为“Open”和“High”)作为我们的训练数据集。“开盘价”栏代表当天股票的开盘价,“高价”栏代表当天股票的最高价格。</p><pre class="kp kq kr ks gt mz na nb nc aw nd bi"><span id="0606" class="ne lt iq na b gy nf ng l nh ni">url = 'https://raw.githubusercontent.com/mwitiderrick/stockprice/master/NSE-TATAGLOBAL.csv'</span><span id="1ee6" class="ne lt iq na b gy nj ng l nh ni">dataset_train = pd.read_csv(url)</span><span id="66ab" class="ne lt iq na b gy nj ng l nh ni">training_set = dataset_train.iloc[:, 1:2].values</span></pre><p id="9f41" class="pw-post-body-paragraph kw kx iq ky b kz la ka lb lc ld kd le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了查看我们正在使用的数据集，我们可以检查头部，它向我们显示了数据集的前五行。</p><pre class="kp kq kr ks gt mz na nb nc aw nd bi"><span id="840a" class="ne lt iq na b gy nf ng l nh ni">dataset_train.head()</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi nk"><img src="../Images/31109c3d70182604b6ef19f2de75dcd6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GZGNnVOD862wdULqGaSuww.png"/></div></div></figure><p id="514a" class="pw-post-body-paragraph kw kx iq ky b kz la ka lb lc ld kd le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">“低”代表当天的最低股价，“最后”代表股票最后一次交易的价格。“收盘”代表股票当天的收盘价。</p><h1 id="4692" class="ls lt iq bd lu lv lw lx ly lz ma mb mc kf md kg me ki mf kj mg kl mh km mi mj bi translated">数据标准化</h1><p id="33fd" class="pw-post-body-paragraph kw kx iq ky b kz mu ka lb lc mv kd le lf mw lh li lj mx ll lm ln my lp lq lr ij bi translated">规范化是将数据集中的数值列的值更改为通用的比例，这有助于提高模型的性能。为了缩放训练数据集，我们使用 Scikit-Learn 的 MinMaxScaler，其数字介于 0 和 1 之间。</p><pre class="kp kq kr ks gt mz na nb nc aw nd bi"><span id="8182" class="ne lt iq na b gy nf ng l nh ni">from sklearn.preprocessing import MinMaxScaler</span><span id="8a17" class="ne lt iq na b gy nj ng l nh ni">sc = MinMaxScaler(feature_range=(0,1))</span><span id="3081" class="ne lt iq na b gy nj ng l nh ni">training_set_scaled = sc.fit_transform(training_set)</span></pre><h1 id="7b94" class="ls lt iq bd lu lv lw lx ly lz ma mb mc kf md kg me ki mf kj mg kl mh km mi mj bi translated">将时间步长并入数据</h1><p id="5453" class="pw-post-body-paragraph kw kx iq ky b kz mu ka lb lc mv kd le lf mw lh li lj mx ll lm ln my lp lq lr ij bi translated">我们应该将数据以 3D 数组的形式输入到 LSTM 模型中。首先，在使用 numpy 将数据转换成数组之前，我们用 60 个时间步长创建数据。最后，我们将数据转换成一个 3D 数组，其中包含 X_train 样本、60 个时间戳以及每步一个特征。</p><pre class="kp kq kr ks gt mz na nb nc aw nd bi"><span id="7198" class="ne lt iq na b gy nf ng l nh ni">X_train = []</span><span id="5b12" class="ne lt iq na b gy nj ng l nh ni">y_train = []</span><span id="72b7" class="ne lt iq na b gy nj ng l nh ni">for i in range(60, 2035):</span><span id="e3b7" class="ne lt iq na b gy nj ng l nh ni">X_train.append(training_set_scaled[i-60:i, 0])</span><span id="6315" class="ne lt iq na b gy nj ng l nh ni">y_train.append(training_set_scaled[i, 0])</span><span id="0b5d" class="ne lt iq na b gy nj ng l nh ni">X_train, y_train = np.array(X_train), np.array(y_train)</span><span id="c6d5" class="ne lt iq na b gy nj ng l nh ni">X_train = np.reshape(X_train, (X_train.shape[0], X_train.shape[1], 1))</span></pre><h1 id="462f" class="ls lt iq bd lu lv lw lx ly lz ma mb mc kf md kg me ki mf kj mg kl mh km mi mj bi translated">创造 LSTM 模式</h1><p id="a1f1" class="pw-post-body-paragraph kw kx iq ky b kz mu ka lb lc mv kd le lf mw lh li lj mx ll lm ln my lp lq lr ij bi translated">在开发 LSTM 之前，我们必须从 Keras 进行一些导入:Sequential 用于初始化神经网络，LSTM 用于添加 LSTM 层，dropout 用于防止与 Dropout 层过度拟合，Dense 用于添加密集连接的神经网络层。</p><pre class="kp kq kr ks gt mz na nb nc aw nd bi"><span id="b654" class="ne lt iq na b gy nf ng l nh ni">from keras.models import Sequential</span><span id="4f70" class="ne lt iq na b gy nj ng l nh ni">from keras.layers import LSTM</span><span id="21d9" class="ne lt iq na b gy nj ng l nh ni">from keras.layers import Dropout</span><span id="159d" class="ne lt iq na b gy nj ng l nh ni">from keras.layers import Dense</span></pre><p id="0b97" class="pw-post-body-paragraph kw kx iq ky b kz la ka lb lc ld kd le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">添加 LSTM 图层时使用了以下参数:50 个单位是输出空间的维度，return_sequences=True 是堆叠 LSTM 图层所必需的，因此后续的 LSTM 图层具有三维序列输入，input_shape 是训练数据集的形状。</p><p id="3ee9" class="pw-post-body-paragraph kw kx iq ky b kz la ka lb lc ld kd le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在 Dropout 层中指定 0.2 意味着 20%的层将被丢弃。在 LSTM 和下降图层之后，我们添加了指定一个单位输出的密集图层。为了编译我们的模型，我们使用 Adam 优化器，并将损失设置为均方误差。之后，我们将模型拟合为运行 100 个时期(时期是学习算法将通过整个训练集工作的次数)，批次大小为 32。</p><pre class="kp kq kr ks gt mz na nb nc aw nd bi"><span id="7d8e" class="ne lt iq na b gy nf ng l nh ni">model = Sequential()</span><span id="b035" class="ne lt iq na b gy nj ng l nh ni">model.add(LSTM(units=50,return_sequences=True,input_shape=(X_train.shape[1], 1)))</span><span id="da9d" class="ne lt iq na b gy nj ng l nh ni">model.add(Dropout(0.2))</span><span id="b206" class="ne lt iq na b gy nj ng l nh ni">model.add(LSTM(units=50,return_sequences=True))</span><span id="906e" class="ne lt iq na b gy nj ng l nh ni">model.add(Dropout(0.2))</span><span id="ea5a" class="ne lt iq na b gy nj ng l nh ni">model.add(LSTM(units=50,return_sequences=True))</span><span id="59c0" class="ne lt iq na b gy nj ng l nh ni">model.add(Dropout(0.2))</span><span id="61cb" class="ne lt iq na b gy nj ng l nh ni">model.add(LSTM(units=50))</span><span id="4bcb" class="ne lt iq na b gy nj ng l nh ni">model.add(Dropout(0.2))</span><span id="dc99" class="ne lt iq na b gy nj ng l nh ni">model.add(Dense(units=1))</span><span id="cb07" class="ne lt iq na b gy nj ng l nh ni">model.compile(optimizer='adam',loss='mean_squared_error')</span><span id="5060" class="ne lt iq na b gy nj ng l nh ni">model.fit(X_train,y_train,epochs=100,batch_size=32)</span></pre><h1 id="c81f" class="ls lt iq bd lu lv lw lx ly lz ma mb mc kf md kg me ki mf kj mg kl mh km mi mj bi translated">对测试集进行预测</h1><p id="03ab" class="pw-post-body-paragraph kw kx iq ky b kz mu ka lb lc mv kd le lf mw lh li lj mx ll lm ln my lp lq lr ij bi translated">我们从导入测试集开始</p><pre class="kp kq kr ks gt mz na nb nc aw nd bi"><span id="745f" class="ne lt iq na b gy nf ng l nh ni">url = 'https://raw.githubusercontent.com/mwitiderrick/stockprice/master/tatatest.csv'</span><span id="0bec" class="ne lt iq na b gy nj ng l nh ni">dataset_test = pd.read_csv(url)</span><span id="3175" class="ne lt iq na b gy nj ng l nh ni">real_stock_price = dataset_test.iloc[:, 1:2].values</span></pre><p id="e36b" class="pw-post-body-paragraph kw kx iq ky b kz la ka lb lc ld kd le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在预测未来的股票价格之前，我们必须修改测试集(注意我们对训练集所做的编辑的相似之处):合并 0 轴上的训练集和测试集，再次将 60 设置为时间步长，使用 MinMaxScaler，并重塑数据。然后，inverse_transform 将股票价格转换成正常可读的格式。</p><pre class="kp kq kr ks gt mz na nb nc aw nd bi"><span id="3466" class="ne lt iq na b gy nf ng l nh ni">dataset_total = pd.concat((dataset_train['Open'], dataset_test['Open']), axis = 0)</span><span id="8509" class="ne lt iq na b gy nj ng l nh ni">inputs = dataset_total[len(dataset_total) - len(dataset_test) - 60:].values</span><span id="dc3e" class="ne lt iq na b gy nj ng l nh ni">inputs = inputs.reshape(-1,1)</span><span id="ae1e" class="ne lt iq na b gy nj ng l nh ni">inputs = sc.transform(inputs)</span><span id="e34a" class="ne lt iq na b gy nj ng l nh ni">X_test = []</span><span id="679c" class="ne lt iq na b gy nj ng l nh ni">for i in range(60, 76):</span><span id="b3f4" class="ne lt iq na b gy nj ng l nh ni">X_test.append(inputs[i-60:i, 0])</span><span id="f830" class="ne lt iq na b gy nj ng l nh ni">X_test = np.array(X_test)</span><span id="419c" class="ne lt iq na b gy nj ng l nh ni">X_test = np.reshape(X_test, (X_test.shape[0], X_test.shape[1], 1))</span><span id="1246" class="ne lt iq na b gy nj ng l nh ni">predicted_stock_price = model.predict(X_test)</span><span id="3313" class="ne lt iq na b gy nj ng l nh ni">predicted_stock_price = sc.inverse_transform(predicted_stock_price)</span></pre><h1 id="11ee" class="ls lt iq bd lu lv lw lx ly lz ma mb mc kf md kg me ki mf kj mg kl mh km mi mj bi translated">绘制结果</h1><p id="0c8d" class="pw-post-body-paragraph kw kx iq ky b kz mu ka lb lc mv kd le lf mw lh li lj mx ll lm ln my lp lq lr ij bi translated">完成所有这些步骤后，我们可以使用 matplotlib 来可视化我们预测的股价和实际股价的结果。</p><pre class="kp kq kr ks gt mz na nb nc aw nd bi"><span id="26e9" class="ne lt iq na b gy nf ng l nh ni">plt.plot(real_stock_price, color = 'black', label = 'TATA Stock Price')</span><span id="e0b1" class="ne lt iq na b gy nj ng l nh ni">plt.plot(predicted_stock_price, color = 'green', label = 'Predicted TATA Stock Price')</span><span id="d22a" class="ne lt iq na b gy nj ng l nh ni">plt.title('TATA Stock Price Prediction')</span><span id="b221" class="ne lt iq na b gy nj ng l nh ni">plt.xlabel('Time')</span><span id="9638" class="ne lt iq na b gy nj ng l nh ni">plt.ylabel('TATA Stock Price')</span><span id="7871" class="ne lt iq na b gy nj ng l nh ni">plt.legend()</span><span id="bc19" class="ne lt iq na b gy nj ng l nh ni">plt.show()</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/dabfa031fe738d1bd5662320b6cd7ca2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1278/format:webp/0*OWTgnJNmg3dYEZU5.png"/></div></figure><p id="f319" class="pw-post-body-paragraph kw kx iq ky b kz la ka lb lc ld kd le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">虽然我们的预测价格的准确价格点并不总是接近实际价格，但我们的模型仍然表明了整体趋势，如上涨或下跌。这个项目告诉我们 LSTMs 在时间序列预测中可以有些效果。</p><p id="5e63" class="pw-post-body-paragraph kw kx iq ky b kz la ka lb lc ld kd le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">点击<a class="ae mt" href="https://colab.research.google.com/drive/18WiSw1K0BW3jOKO56vxn11Fo9IyOuRjh" rel="noopener ugc nofollow" target="_blank">此处</a>查看完整代码</p><h1 id="e7bd" class="ls lt iq bd lu lv lw lx ly lz ma mb mc kf md kg me ki mf kj mg kl mh km mi mj bi translated">参考</h1><p id="3449" class="pw-post-body-paragraph kw kx iq ky b kz mu ka lb lc mv kd le lf mw lh li lj mx ll lm ln my lp lq lr ij bi translated">[1]德里克·姆维蒂，<a class="ae mt" href="https://github.com/mwitiderrick/stockprice" rel="noopener ugc nofollow" target="_blank">股票价格预测数据与笔记本教程</a> (2018)，Github</p></div><div class="ab cl nm nn hu no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="ij ik il im in"><p id="6da4" class="pw-post-body-paragraph kw kx iq ky b kz la ka lb lc ld kd le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ja">先别走</strong>！</p><p id="b5ac" class="pw-post-body-paragraph kw kx iq ky b kz la ka lb lc ld kd le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我是 Roshan，16 岁，对人工智能和金融的交叉领域充满热情。关于人工智能在金融中的广泛观点，请查看这篇文章:<a class="ae mt" href="https://becominghuman.ai/artificial-intelligence-and-its-application-in-finance-9f1e0588e777" rel="noopener ugc nofollow" target="_blank">https://becoming human . AI/artificial-intelligence-and-its-application-in-finance-9f1e 0588 e 777</a>。</p><p id="1c1b" class="pw-post-body-paragraph kw kx iq ky b kz la ka lb lc ld kd le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在 Linkedin 上联系我:<a class="ae mt" href="https://www.linkedin.com/in/roshan-adusumilli-96b104194/" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/roshan-adusumilli-96b104194/</a></p></div></div>    
</body>
</html>