# ä½¿ç”¨ Flask å’Œ Heroku åˆ›å»ºä¸€ä¸ª API æ¥éƒ¨ç½²æœºå™¨å­¦ä¹ æ¨¡å‹

> åŸæ–‡ï¼š<https://towardsdatascience.com/create-an-api-to-deploy-machine-learning-models-using-flask-and-heroku-67a011800c50?source=collection_archive---------4----------------------->

![](img/30036332da6a4ce1564b2685161ad33a.png)

*Photo by* [*Ian Simmonds*](https://unsplash.com/@ihs_photo?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) *on* [*Unsplash*](https://unsplash.com/s/photos/ship?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)

æœºå™¨å­¦ä¹ æ¨¡å‹æ˜¯åŸºäºå¯ç”¨æ•°æ®è¿›è¡Œé¢„æµ‹çš„å¼ºå¤§å·¥å…·ã€‚ä¸ºäº†ä½¿è¿™äº›æ¨¡å‹æœ‰ç”¨ï¼Œéœ€è¦éƒ¨ç½²å®ƒä»¬ï¼Œä»¥ä¾¿å…¶ä»–äººå¯ä»¥é€šè¿‡ API(åº”ç”¨ç¨‹åºç¼–ç¨‹æ¥å£)è½»æ¾è®¿é—®å®ƒä»¬æ¥è¿›è¡Œé¢„æµ‹ã€‚è¿™å¯ä»¥ä½¿ç”¨ [Flask](https://flask.palletsprojects.com/en/1.1.x/) å’Œ [Heroku](https://www.heroku.com) æ¥å®Œæˆâ€”â€”Flask æ˜¯ä¸€ä¸ªå¾®å‹ web æ¡†æ¶ï¼Œä¸éœ€è¦ç‰¹å®šçš„å·¥å…·æˆ–åº“æ¥åˆ›å»º web åº”ç”¨ç¨‹åºï¼ŒHeroku æ˜¯ä¸€ä¸ªå¯ä»¥æ‰˜ç®¡ web åº”ç”¨ç¨‹åºçš„äº‘å¹³å°ã€‚

è¦ä½¿ç”¨ Flask å’Œ Heroku æˆåŠŸéƒ¨ç½²æœºå™¨å­¦ä¹ æ¨¡å‹ï¼Œæ‚¨éœ€è¦ä»¥ä¸‹æ–‡ä»¶:model.pklã€app.pyã€requirements.txt å’Œä¸€ä¸ª Procfileã€‚æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•åˆ›å»ºè¿™äº›æ‰€éœ€çš„æ–‡ä»¶ï¼Œå¹¶æœ€ç»ˆåœ¨ Heroku ä¸Šéƒ¨ç½²åº”ç”¨ç¨‹åºã€‚è¯¥å‘˜é¢çš„ä¸»è¦éƒ¨åˆ†å¦‚ä¸‹:

*   åˆ›å»º GitHub å­˜å‚¨åº“(å¯é€‰)
*   ä½¿ç”¨å¤§é‡æ•°æ®åˆ›å»ºå’Œç­›é€‰æ¨¡å‹
*   åˆ›å»ºçƒ§ç“¶åº”ç”¨ç¨‹åº
*   æœ¬åœ°æµ‹è¯•çƒ§ç“¶åº”ç”¨ç¨‹åº(å¯é€‰)
*   éƒ¨ç½²åˆ° Heroku
*   æµ‹è¯•å·¥ä½œåº”ç”¨ç¨‹åº

æ ¹æ®æ‚¨åœ¨æµç¨‹ä¸­æ‰€å¤„çš„é˜¶æ®µï¼Œæ‚¨å¯ä»¥éšæ„è·³è¿‡å…¶ä¸­ä»»ä½•ä¸€é¡¹ï¼

# åˆ›å»º Github å­˜å‚¨åº“(å¯é€‰)

ä¸ºäº†ä¾¿äºä»¥ååœ¨ Heroku ä¸Šéƒ¨ç½²ï¼Œæ‚¨éœ€è¦ä¸ºè¿™ä¸ªé¡¹ç›®åˆ›å»ºä¸€ä¸ª github å­˜å‚¨åº“ï¼Œå¹¶å…‹éš†å®ƒä»¥ä¾›æœ¬åœ°ä½¿ç”¨ã€‚è¦åˆ›å»ºæ–°çš„å­˜å‚¨åº“ï¼Œè¯·å•å‡»å³ä¸Šè§’çš„ä¸ªäººèµ„æ–™å›¾æ ‡ï¼Œå•å‡»â€œå­˜å‚¨åº“â€ï¼Œç„¶åå•å‡»â€œæ–°å»ºâ€ã€‚ä¸ºæ‚¨çš„å­˜å‚¨åº“å‘½åï¼Œä½¿ç”¨è‡ªè¿°æ–‡ä»¶åˆå§‹åŒ–å­˜å‚¨åº“ï¼Œå¹¶æ·»åŠ ä¸€ä¸ªè®¸å¯è¯ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤º:

![](img/fad9d19dc048ea377916954efb611f36.png)

è¦å…‹éš†å­˜å‚¨åº“ï¼Œè¯·è½¬åˆ°å­˜å‚¨åº“é¡µé¢ï¼Œå•å‡»â€œå…‹éš†æˆ–ä¸‹è½½â€å¹¶å¤åˆ¶é“¾æ¥ã€‚åœ¨ç»ˆç«¯ä¸­ï¼Œè½¬åˆ°è¦å…‹éš†å­˜å‚¨åº“çš„æ–‡ä»¶å¤¹ï¼Œå¹¶é”®å…¥å‘½ä»¤:

```
git clone link_to_repository
```

è¿è¡Œæ­¤å‘½ä»¤ä¼šå°†å­˜å‚¨åº“å…‹éš†åˆ°æ‚¨çš„æœ¬åœ°è®¡ç®—æœºä¸Šï¼Œæ‚¨å¯ä»¥æ£€æŸ¥ä»¥ç¡®ä¿æ–‡ä»¶å¤¹æ˜¯åœ¨æ­£ç¡®çš„ä½ç½®åˆ›å»ºçš„ã€‚æ—¢ç„¶å›è´­å·²ç»è®¾ç½®å¥½äº†ï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ›å»ºæœºå™¨å­¦ä¹ æ¨¡å‹å¹¶å¯¹å…¶è¿›è¡Œå¤„ç†äº†ã€‚

# åˆ›å»ºå’Œç­›é€‰æœºå™¨å­¦ä¹ æ¨¡å‹

é¦–å…ˆï¼Œè®©æˆ‘ä»¬ä½¿ç”¨ Titanic æ•°æ®é›†åˆ›å»ºä¸€ä¸ªç®€å•çš„é€»è¾‘å›å½’æ¨¡å‹ã€‚æ ¹æ®é˜¶çº§ã€å¹´é¾„ã€å…„å¼Ÿå§å¦¹æ•°é‡å’Œç¥¨ä»·ç­‰ä¿¡æ¯ï¼Œè¯¥æ¨¡å‹å°†é¢„æµ‹æ˜¯å¦æœ‰äººåœ¨æ³°å¦å°¼å…‹å·ä¸Šå¹¸å­˜ã€‚å¦‚æœä½ æƒ³äº†è§£æˆ‘çš„ä¾‹å­ï¼Œä½ å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°æ•°æ®é›†[çš„ csv æ–‡ä»¶ã€‚åœ¨æ‚¨çš„å·¥ä½œç›®å½•ä¸­åˆ›å»ºä¸€ä¸ª Jupyter ç¬”è®°æœ¬ï¼Œå¹¶é€šè¿‡è¿è¡Œä»¥ä¸‹ä»£ç åˆ›å»ºæ¨¡å‹:](https://github.com/elizabethts/deploy-mlm-flask-heroku/blob/master/titanic.csv)

```
import pandas as pd
from sklearn.linear_model import LogisticRegression# create df
train = pd.read_csv('titanic.csv') # change file path# drop null values
train.dropna(inplace=True)# features and target
target = 'Survived'
features = ['Pclass', 'Age', 'SibSp', 'Fare']# X matrix, y vector
X = train[features]
y = train[target]# model 
model = LogisticRegression()
model.fit(X, y)
model.score(X, y)
```

ä¸Šé¢çš„ä»£ç ä» csv æ•°æ®åˆ›å»ºäº†ä¸€ä¸ª pandas dataframeï¼Œåˆ é™¤äº†ç©ºå€¼ï¼Œå®šä¹‰äº†æ¨¡å‹çš„ç‰¹å¾å’Œç›®æ ‡ï¼Œå°†æ•°æ®æ‹†åˆ†ä¸ºä¸€ä¸ªåªåŒ…å«ç‰¹å¾çš„çŸ©é˜µå’Œä¸€ä¸ªåŒ…å«ç›®æ ‡çš„å‘é‡ï¼Œå¹¶æ‹Ÿåˆé€»è¾‘å›å½’æ¨¡å‹ï¼Œç„¶åå¯¹å…¶è¿›è¡Œè¯„åˆ†ã€‚

è¿™å°±åˆ›å»ºäº†ä¸€ä¸ªæ¨¡å‹ï¼Œå®ƒå¯ä»¥ä»¥å¤§çº¦ 70%çš„å‡†ç¡®ç‡é¢„æµ‹æ³°å¦å°¼å…‹å·ä¹˜å®¢çš„å­˜æ´»ç‡ï¼Œç„¶åå¯ä»¥ä½¿ç”¨:

```
import pickle
pickle.dump(model, open(â€˜model.pklâ€™, â€˜wbâ€™))
```

pickle æ–‡ä»¶å¯ä»¥åœ¨ Jupyter ç¬”è®°æœ¬çš„åŒä¸€ä¸ªç›®å½•ä¸­æ‰¾åˆ°ã€‚

# ç¼–å†™çƒ§ç“¶åº”ç”¨ç¨‹åº

æ‰“å¼€æ‚¨çš„ IDE(æˆ‘ä½¿ç”¨ PyCharm)å¹¶åˆ›å»ºä¸€ä¸ªæ–°çš„ã€‚å·¥ä½œç›®å½•ä¸­çš„ py æ–‡ä»¶åä¸º`app.py`

![](img/0b84ba9c053d1d2244e2917d1c3d80b4.png)

flask åº”ç”¨ç¨‹åºçš„ä»£ç å¯ä»¥åœ¨ä¸‹é¢æ‰¾åˆ°(python v3.7 ç‰ˆ)ã€‚

```
**import** pandas **as** pd
**from** flask **import** Flask, jsonify, request
**import** pickle

*# load model* model = pickle.load(open(**'model.pkl'**,**'rb'**))

*# app* app = Flask(__name__)

*# routes* @app.route(**'/'**, methods=[**'POST'**])

**def** predict():
    *# get data* data = request.get_json(force=**True**)

    *# convert data into dataframe* data.update((x, [y]) **for** x, y **in** data.items())
    data_df = pd.DataFrame.from_dict(data)

    *# predictions* result = model.predict(data_df)

    *# send back to browser* output = {**'results'**: int(result[0])}

    *# return data* **return** jsonify(results=output)

**if** __name__ == **'__main__'**:
    app.run(port = 5000, debug=**True**)
```

**ä»£ç çš„ç»“æ„å¦‚ä¸‹:**

*   **è£…è½½é…¸æ´—æ¨¡å‹**
*   **å‘½åçƒ§ç“¶ app**
*   **åˆ›å»ºä¸€ä¸ªæ¥æ”¶ JSON è¾“å…¥çš„è·¯ç”±ï¼Œä½¿ç”¨è®­ç»ƒå¥½çš„æ¨¡å‹è¿›è¡Œé¢„æµ‹ï¼Œå¹¶ä»¥ JSON æ ¼å¼è¿”å›é¢„æµ‹ï¼Œå¯ä»¥é€šè¿‡ API ç«¯ç‚¹è®¿é—®ã€‚**

åœ¨è·¯ç”±å†…éƒ¨ï¼Œæˆ‘å°† JSON æ•°æ®è½¬æ¢ä¸º pandas dataframe å¯¹è±¡ï¼Œå› ä¸ºæˆ‘å‘ç°è¿™é€‚ç”¨äºå¤§å¤šæ•°(ä¸æ˜¯æ‰€æœ‰ï¼)æ‚¨å¸Œæœ›ç”¨æ¥è¿›è¡Œé¢„æµ‹çš„æ¨¡å‹ç±»å‹ã€‚æ‚¨å¯ä»¥é€‰æ‹©ä½¿ç”¨æ‚¨å–œæ¬¢çš„æ–¹æ³•æ¥è½¬æ¢è¾“å…¥ï¼Œåªè¦å®ƒä¸æ‚¨çš„æ¨¡å‹çš„`.predict()`æ–¹æ³•ä¸€èµ·å·¥ä½œã€‚è¾“å…¥çš„é¡ºåºå¿…é¡»ä¸ç”¨äºè®­ç»ƒæ¨¡å‹çš„æ•°æ®å¸§ä¸­çš„åˆ—é¡ºåºç›¸åŒ¹é…ï¼Œå¦åˆ™åœ¨å°è¯•è¿›è¡Œé¢„æµ‹æ—¶ä¼šå‡ºç°é”™è¯¯ã€‚å¦‚æœæ‚¨æ­£åœ¨æ¥æ”¶çš„è¾“å…¥é¡ºåºä¸æ­£ç¡®ï¼Œæ‚¨å¯ä»¥åœ¨åˆ›å»ºæ•°æ®å¸§åè½»æ¾åœ°å¯¹å…¶è¿›è¡Œé‡æ–°æ’åºã€‚

**è¿™é‡Œçš„è¦ç‚¹æ˜¯ï¼Œæ‚¨éœ€è¦å°†ä»è¯·æ±‚ä¸­è·å¾—çš„ JSON æ•°æ®è½¬æ¢æˆæ¨¡å‹å¯ä»¥ç”¨æ¥è¿›è¡Œé¢„æµ‹çš„æ•°æ®ç»“æ„ã€‚å¦‚ä½•åˆ°è¾¾é‚£é‡Œå–å†³äºä½ è‡ªå·±ã€‚**

ä¸€æ—¦å°†å®ƒç²˜è´´åˆ° app.py æ–‡ä»¶ä¸­ï¼Œæ‚¨å°±å¯ä»¥ä»å‘½ä»¤è¡Œè¿è¡Œ flask åº”ç”¨ç¨‹åº(æˆ–è€…å¦‚æœæ‚¨ä½¿ç”¨ PyCharmï¼Œåªéœ€è¿è¡Œä»£ç )ã€‚è¦ä»å‘½ä»¤è¡Œè¿è¡Œåº”ç”¨ç¨‹åºï¼Œè¯·ä½¿ç”¨:

```
python app.py
```

å¦‚æœæ“ä½œæ­£ç¡®ï¼Œæ‚¨å°†çœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„å†…å®¹:

![](img/f35510440f5e674a587a6c2ab288af44.png)

> é”™è¯¯æç¤º:å¦‚æœè¿™æ˜¯æ‚¨ç¬¬ä¸€æ¬¡åˆ›å»º flask åº”ç”¨ç¨‹åºï¼Œæ‚¨å¯èƒ½ä¼šå¾—åˆ°ä¸€ä¸ªé”™è¯¯æç¤ºï¼Œæç¤ºæ‚¨éœ€è¦å°† flask å®‰è£…åˆ° python ç¯å¢ƒä¸­ã€‚ä½¿ç”¨`!pip install flask`å¹¶é‡è¯•ã€‚

å½“ä½ çš„ flask åº”ç”¨ç¨‹åºå¯åŠ¨å¹¶è¿è¡Œæ—¶ï¼Œç‚¹å‡»è“è‰²é“¾æ¥ï¼Œä½ åº”è¯¥ä¼šçœ‹åˆ°è¿™ä¸ªâ€”â€”è¿™å¾ˆæ­£å¸¸:

![](img/1e2d15f9279b706ad42e45ef6f95c3cd.png)

## å¯é€‰çš„ï¼Œ*ä½†æ˜¯ä½ çœŸçš„åº”è¯¥*:æµ‹è¯•åº”ç”¨ç¨‹åºæ˜¯å¦å·¥ä½œ

å°†`requests`å’Œ`json`å¯¼å…¥åˆ°ä½ çš„ Jupyter ç¬”è®°æœ¬ä¸­ï¼Œç„¶åç”¨ä½ çš„æœ¬åœ°æœåŠ¡å™¨åˆ›å»ºä¸€ä¸ªå˜é‡ï¼Œå¦‚æœå®ƒä¸ä¸‹é¢çš„ä¸åŒ:

```
# local url
url = '[http://127.0.0.1:5000'](http://127.0.0.1:5000') # change to your url
```

åˆ›å»ºç¤ºä¾‹æ•°æ®å¹¶è½¬æ¢ä¸º JSON:

```
# sample data
data = {'Pclass': 3
      , 'Age': 2
      , 'SibSp': 1
      , 'Fare': 50}data = json.dumps(data)
```

ä½¿ç”¨`requests.post(url, data)`å‘å¸ƒæ ·æœ¬æ•°æ®å¹¶æ£€æŸ¥å“åº”ä»£ç ã€‚æ‚¨å¸Œæœ›è·å¾— 200 çš„å“åº”ä»£ç ï¼Œä»¥ç¡®ä¿åº”ç”¨ç¨‹åºæ­£å¸¸å·¥ä½œ:

![](img/b208ac416c3766cd49d98f4e4a782737.png)

ç„¶åæ‚¨å¯ä»¥æ‰“å°è¯·æ±‚çš„ JSON æ¥æŸ¥çœ‹æ¨¡å‹çš„é¢„æµ‹:

![](img/a40d64650e2dcaa192b4bae1773e60c2.png)

æ¨¡å‹é¢„æµ‹å€¼ä¸º 1ï¼Œè¿™æ„å‘³ç€ä¹˜å®¢ç”Ÿè¿˜ğŸ™Œ

å®Œæˆæµ‹è¯•åï¼ŒæŒ‰ ctrl+c å…³é—­ flask åº”ç”¨ç¨‹åºã€‚

# åˆ›å»º Procfile

Procfile æŒ‡å®šäº† Heroku åº”ç”¨ç¨‹åºåœ¨å¯åŠ¨æ—¶æ‰§è¡Œçš„å‘½ä»¤ã€‚è¦åˆ›å»ºä¸€ä¸ªï¼Œåœ¨å·¥ä½œç›®å½•ä¸­æ‰“å¼€ä¸€ä¸ªåä¸º Procfile(æ²¡æœ‰æ‰©å±•å)çš„æ–°æ–‡ä»¶ï¼Œå¹¶ç²˜è´´ä»¥ä¸‹å†…å®¹ã€‚

```
web: gunicorn app:app
```

ä»…æ­¤è€Œå·²ã€‚ä¿å­˜å¹¶å…³é—­ã€‚âœ…

# åˆ›å»ºéœ€æ±‚. txt

requirements.txt æ–‡ä»¶å°†åŒ…å« flask åº”ç”¨ç¨‹åºçš„æ‰€æœ‰ä¾èµ–é¡¹ã€‚è¦åˆ›å»º requirements.txtï¼Œè¯·åœ¨ç»ˆç«¯çš„å·¥ä½œç›®å½•ä¸‹è¿è¡Œä»¥ä¸‹å‘½ä»¤:

```
pip freeze > requirements.txt
```

å¦‚æœæ‚¨ä¸æ˜¯åœ¨ä¸€ä¸ªæ–°çš„ç¯å¢ƒä¸­å·¥ä½œï¼Œè¿™ä¸ªæ–‡ä»¶å°†åŒ…å«æ‚¨å½“å‰ç¯å¢ƒä¸­çš„æ‰€æœ‰éœ€æ±‚ã€‚å¦‚æœæ‚¨ç¨ååœ¨éƒ¨ç½²åº”ç”¨ç¨‹åºæ—¶é‡åˆ°é”™è¯¯ï¼Œæ‚¨å¯ä»¥åˆ é™¤å¯¼è‡´é”™è¯¯çš„éœ€æ±‚ã€‚

å¯¹äºè¿™ä¸ªé¡¹ç›®ï¼Œrequirements.txt è‡³å°‘åº”è¯¥åŒ…å«:

```
**Flask**==**1.1.1
gunicorn**==**19.9.0
pandas**==**0.25.0
requests**==**2.22.0
scikit-learn**==**0.21.2
scipy**==**1.3.1**
```

## å¯é€‰é¡¹:å°†æ–‡ä»¶æäº¤åˆ° GitHub

è¿è¡Œä»¥ä¸‹å‘½ä»¤å°†æ–‡ä»¶æäº¤ç»™ git:

```
# add all files from the working directory
git add .
```

ç„¶åæäº¤æ‚¨çš„ä¿¡æ¯:

```
git commit -m 'add flask files'
```

æœ€åï¼Œä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å°†æ›´æ”¹æ¨é€åˆ° Githubã€‚å¯èƒ½ä¼šè¦æ±‚æ‚¨è¾“å…¥æ‚¨çš„ github ç”¨æˆ·åå’Œå¯†ç ã€‚å¦‚æœæ‚¨è®¾ç½®äº† 2FAï¼Œæ‚¨å°†éœ€è¦æ‚¨çš„å¯†é’¥ä½œä¸ºå¯†ç ã€‚

```
git push origin master
```

è‡³å°‘ï¼Œæ‚¨çš„ Github repo ç°åœ¨åº”è¯¥åŒ…å«:

*   app.py
*   model.pkl
*   Procfile
*   requirements.txt

**æ³¨æ„:æ‰€æœ‰è¿™äº›æ–‡ä»¶éƒ½åº”è¯¥åœ¨å·¥ä½œç›®å½•çº§åˆ«ï¼Œè€Œä¸æ˜¯åœ¨å¦ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­**

# éƒ¨ç½²åˆ° Heroku

å¦‚æœæ‚¨è¿˜æ²¡æœ‰ï¼Œè¯·åœ¨[www.heroku.com](https://www.heroku.com)åˆ›å»ºä¸€ä¸ªå…è´¹è´¦æˆ·ã€‚

åªéœ€é€‰æ‹©åç§°å¹¶ç‚¹å‡»â€œåˆ›å»ºåº”ç”¨â€å³å¯åˆ›å»ºæ–°åº”ç”¨ã€‚è¿™ä¸ªåç§°å¹¶ä¸é‡è¦ï¼Œä½†å®ƒå¿…é¡»æ˜¯å”¯ä¸€çš„ã€‚

![](img/515a49fb7383b619bd277840f9d15794.png)

å¯¹äºéƒ¨ç½²åº”ç”¨ç¨‹åºçš„æ–¹å¼ï¼Œæ‚¨æœ‰å‡ ä¸ªé€‰é¡¹ã€‚æˆ‘è¯•è¿‡ Heroku CLI å’Œ GitHubï¼Œæˆ‘ä¸ªäººæ›´å–œæ¬¢ GitHubâ€¦ä½†æ˜¯æˆ‘ä¼šæŠŠä¸¤ä¸ªéƒ½å±•ç¤ºå‡ºæ¥ï¼Œæ‰€ä»¥æŒ‘ä¸€ä¸ªä½ æƒ³çœ‹çš„ã€‚

## ä½¿ç”¨ Github éƒ¨ç½²

ç‚¹å‡»ä¸‹é¢çš„ github å›¾æ ‡ï¼Œè¿æ¥æ‚¨çš„ github å¸æˆ·:

![](img/9a82e423c10faa2f60f108494e458a1e.png)

æœç´¢æ­£ç¡®çš„å­˜å‚¨åº“ï¼Œç„¶åå•å‡»è¿æ¥:

![](img/be25af5ec43a468c513e2c892165d0c1.png)

ç„¶åæ»šåŠ¨åˆ°é¡µé¢åº•éƒ¨ï¼Œå•å‡»â€œéƒ¨ç½²åˆ†æ”¯â€

![](img/68bdab299446511f2f341a5bfa5b4ffd.png)

å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°è¿™æ¡æ¶ˆæ¯ğŸ‰ğŸ‰

![](img/278abb0e4dba454a38d90e6da165f164.png)

å¦‚æœå‡ºç°é—®é¢˜ï¼Œè¯·æ£€æŸ¥æ‚¨çš„ requirements.txtï¼Œåˆ é™¤ç»™ä½ å¸¦æ¥é—®é¢˜çš„ä¾èµ–é¡¹ï¼Œç„¶åé‡è¯•\_(ãƒ„)_/

## ä½¿ç”¨ Heroku CLI éƒ¨ç½²

åœ¨ Heroku CLI éƒ¨åˆ†ï¼Œæ‚¨å°†çœ‹åˆ°éƒ¨ç½²æ—¶éœ€è¦éµå¾ªçš„è¯´æ˜ã€‚å°†æ¯ä¸ªå‘½ä»¤ç²˜è´´åˆ°æ‚¨çš„ç»ˆç«¯ä¸­ï¼Œå¹¶æŒ‰ç…§ä»»ä½•æç¤ºè¿›è¡Œæ“ä½œï¼Œå¦‚ç™»å½•ã€‚æ³¨æ„ä»»ä½•éœ€è¦ä¿®æ”¹çš„å‘½ä»¤ï¼Œæ¯”å¦‚`cd my-project/`â€”â€”å…¶ä¸­`my-project/`å®é™…ä¸Šåº”è¯¥æ˜¯æ‚¨çš„é¡¹ç›®ç›®å½•ã€‚git remote åº”è¯¥å‡†ç¡®åœ°è®¾ç½®ä¸º Heroku ä¸­çš„åº”ç”¨ç¨‹åºåç§°ã€‚

![](img/f5563426d2069523137855bab1a67e16.png)

å¦‚æœæ‚¨æˆåŠŸåœ°éµå¾ªäº†è¿™äº›è¯´æ˜ï¼Œæ‚¨åº”è¯¥åœ¨ overview é¡µé¢ä¸Šçœ‹åˆ° build successfulğŸ‰ğŸ‰

å¦‚æœæ²¡æœ‰ï¼Œæ‚¨å¯ä»¥é€šè¿‡ä»å‘½ä»¤è¡Œè¿è¡Œ`heroku logs --tail`æ¥æ£€æŸ¥å‡ºäº†ä»€ä¹ˆé—®é¢˜ã€‚

# æµ‹è¯•éƒ¨ç½²çš„æ¨¡å‹å¹¶ç”Ÿæˆé¢„æµ‹

å¦‚æœä½ å·²ç»æµ‹è¯•äº†ä½ çš„ flask åº”ç”¨ç¨‹åºï¼Œè¿™äº›è¯´æ˜å°†ä¼šéå¸¸ç›¸ä¼¼ï¼Œé™¤äº†ç°åœ¨ä½¿ç”¨ Heroku åº”ç”¨ç¨‹åºçš„ urlã€‚

åœ¨ä½ çš„ Jupyter ç¬”è®°æœ¬ä¸­å¯¼å…¥`requests`å’Œ`json`ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªå˜é‡æ¥å­˜å‚¨ Heroku åº”ç”¨çš„ url(ä½ å¯ä»¥åœ¨ Heroku ä¸Šç‚¹å‡»åº”ç”¨é¡µé¢å³ä¸Šè§’çš„â€œæ‰“å¼€åº”ç”¨â€æ¥æ‰¾åˆ°è¿™ä¸ª)ã€‚ç„¶ååˆ›å»ºä¸€äº›ç¤ºä¾‹æ•°æ®ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸º JSON:

```
# heroku url
heroku_url = '[https://titanic-flask-model.herokuapp.com'](https://titanic-flask-model.herokuapp.com') # change to your app name# sample data
data = {  'Pclass': 3
             , 'Age': 2
             , 'SibSp': 1
             , 'Fare': 50}data = json.dumps(data)
```

ä½¿ç”¨ä»¥ä¸‹ä»£ç æ£€æŸ¥å“åº”ä»£ç ã€‚å“åº”ä»£ç  200 è¡¨ç¤ºä¸€åˆ‡è¿è¡Œæ­£å¸¸ã€‚

```
send_request = requests.post(heroku_url, data)
print(send_request)
```

`Output: <Response [200]>`

æœ€åï¼Œçœ‹çœ‹è¿™ä¸ªæ¨¡å‹çš„é¢„æµ‹:

```
print(send_request.json())
```

`Output: {â€˜resultsâ€™: {â€˜resultsâ€™: 1}}`

å¦‚æœä½¿ç”¨ä¸åŒçš„æ ·æœ¬æ•°æ®ï¼Œè¾“å‡ºç»“æœä¼šæœ‰æ‰€ä¸åŒã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç»“æœä¸º 1 æ„å‘³ç€æ¨¡å‹é¢„æµ‹ä¹˜å®¢å¹¸å­˜ï¼Œæ›´é‡è¦çš„æ˜¯ API èµ·ä½œç”¨äº†ï¼

ç°åœ¨ï¼Œäººä»¬å¯ä»¥é€šè¿‡ Heroku URL è®¿é—®æ‚¨çš„ API ç«¯ç‚¹ï¼Œå¹¶ä½¿ç”¨æ‚¨çš„æ¨¡å‹åœ¨ç°å®ä¸–ç•Œä¸­è¿›è¡Œé¢„æµ‹ğŸŒ

è¿™é‡Œæ˜¯ [github repo](https://github.com/elizabethts/deploy-mlm-flask-heroku) ï¼ŒåŒ…å«éƒ¨ç½²è¿™ä¸ª API æ‰€éœ€çš„æ‰€æœ‰æ–‡ä»¶å’Œä»£ç ã€‚

åœ¨ twitter [@elizabethets](http://www.twitter.com/elizabethets) ä¸Šæ‰¾åˆ°æˆ‘æˆ–è€…åœ¨ [LinkedIn](https://www.linkedin.com/in/elizabethts/) ä¸Šè”ç³»æˆ‘ï¼

æ¥æº:

[](https://flask.palletsprojects.com/en/1.1.x/) [## æ¬¢è¿ä½¿ç”¨ Flask - Flask æ–‡æ¡£(1.1.x)

### æ¬¢è¿é˜…è¯» Flask çš„æ–‡æ¡£ã€‚å¼€å§‹å®‰è£…ï¼Œç„¶åäº†è§£å¿«é€Ÿå…¥é—¨æ¦‚è¿°ã€‚æœ‰â€¦

flask.palletsprojects.com](https://flask.palletsprojects.com/en/1.1.x/) [](https://heroku.com/) [## äº‘åº”ç”¨å¹³å°| Heroku

### æ— è®ºæ‚¨æ˜¯åœ¨æ„å»ºç®€å•çš„åŸå‹è¿˜æ˜¯å…³é”®ä¸šåŠ¡äº§å“ï¼ŒHeroku çš„å…¨æ‰˜ç®¡å¹³å°éƒ½èƒ½ä¸ºæ‚¨æä¾›â€¦

heroku.com](https://heroku.com/) [](https://devcenter.heroku.com/articles/procfile) [## Procfile

### Heroku åº”ç”¨ç¨‹åºåŒ…æ‹¬ä¸€ä¸ª Procfileï¼Œå®ƒæŒ‡å®šäº†åº”ç”¨ç¨‹åºåœ¨å¯åŠ¨æ—¶æ‰§è¡Œçš„å‘½ä»¤ã€‚ä½ å¯ä»¥ç”¨ä¸€ä¸ªâ€¦

devcenter.heroku.com](https://devcenter.heroku.com/articles/procfile)