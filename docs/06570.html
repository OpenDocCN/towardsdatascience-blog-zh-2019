<html>
<head>
<title>Predicting Sequential Data using LSTM: An Introduction</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 LSTM 预测序列数据:简介</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/time-series-forecasting-with-recurrent-neural-networks-74674e289816?source=collection_archive---------1-----------------------#2019-09-20">https://towardsdatascience.com/time-series-forecasting-with-recurrent-neural-networks-74674e289816?source=collection_archive---------1-----------------------#2019-09-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="c1ed" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用长短期记忆(LSTM)网络预测股票等序列数据的未来。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/7b74e4de1d952085cb88c0d40b5c02a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*A9wiZBOry70DDbLO"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk">Photo by <a class="ae lb" href="https://unsplash.com/@chrisliverani?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Chris Liverani</a> on <a class="ae lb" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="29a0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">预测是使用当前和以前的数据预测未来的过程。主要的挑战是理解数据序列中的模式，然后使用这种模式来分析未来。如果我们手工编码这些模式，那么对于下一个数据来说，这将是乏味的和变化的。深度学习已被证明在理解结构化和非结构化数据中的模式方面更好。</p><p id="3aa4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了理解一长串数据中的模式，我们需要网络来分析时间上的模式。递归网络通常用于学习这种数据。他们能够理解长期和短期的依赖性或时间差异。</p><p id="3902" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好了，不介绍了…</p><p id="1981" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这篇文章将向你展示如何在<strong class="jp ir"> Keras </strong>中使用 LSTM 网络和一些很酷的可视化工具来实现一个预测模型。我们将使用来自<a class="ae lb" href="https://finance.yahoo.com/quote/GOOG?p=GOOG" rel="noopener ugc nofollow" target="_blank">雅虎财经</a>的谷歌股价，但你可以随意使用任何你喜欢的股票数据。</p></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><h1 id="dc88" class="lj lk iq bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">履行</h1><p id="07a9" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">我已经使用<a class="ae lb" href="https://colab.research.google.com" rel="noopener ugc nofollow" target="_blank"> colab </a>来实现这个代码，以使可视化更容易，你可以使用你喜欢的方法。我们将从导入必要的库开始:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="cf48" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下载完您的。csv 文件，使用 pandas 加载数据。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="44d6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">dataframe 的信息显示如下:</p><pre class="km kn ko kp gt mo mp mq mr aw ms bi"><span id="ae6e" class="mt lk iq mp b gy mu mv l mw mx">&lt;class 'pandas.core.frame.DataFrame'&gt;<br/>RangeIndex: 3797 entries, 0 to 3796<br/>Data columns (total 7 columns):<br/>Date         3797 non-null object<br/>Open         3797 non-null float64<br/>High         3797 non-null float64<br/>Low          3797 non-null float64<br/>Close        3797 non-null float64<br/>Adj Close    3797 non-null float64<br/>Volume       3797 non-null int64<br/>dtypes: float64(5), int64(1), object(1)<br/>memory usage: 207.7+ KB</span></pre><p id="3011" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于本教程，我们只需要 Date 和 Close 列，其他的都可以删除。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="2838" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我们进行训练和预测之前，让我们看看数据是什么样子的。对于所有的可视化，我使用的是<a class="ae lb" href="https://plot.ly/" rel="noopener ugc nofollow" target="_blank"> Plotly </a> python 库。为什么是 Plotly？…因为它是最好的图形库，可以生成一些好看的图形。</p><p id="4418" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用 plotly，我们可以定义一个轨迹和布局，它可以做任何其他事情。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="my mn l"/></div></figure><p id="151a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">图表从 2018 年开始振荡，序列并不平滑…继续前进。</p><h2 id="6af9" class="mt lk iq bd ll mz na dn lp nb nc dp lt jy nd ne lx kc nf ng mb kg nh ni mf nj bi translated">数据预处理</h2><p id="80db" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">对于我们的分析，让我们在前 80%的数据上训练模型，并在剩余的 20%上测试它。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="8660" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我们进行培训之前，我们需要对我们的数据进行一些重大修改。记住，我们的数据仍然是一个序列..一列数字。神经网络被训练为监督模型。因此，我们需要将序列数据转换成监督数据😱。</p><p id="87d3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我来解释一下，训练任何机器学习模型的神经网络都需要数据是{ &lt;<em class="nk">特征</em> &gt;，&lt; <em class="nk">目标</em> &gt; }格式。同样，我们需要将给定的数据转换成这种格式。这里，我们引入一个回望的概念。</p><blockquote class="nl nm nn"><p id="5f26" class="jn jo nk jp b jq jr js jt ju jv jw jx no jz ka kb np kd ke kf nq kh ki kj kk ij bi translated">回顾只不过是使用前几天的数据来预测第二天的值。比如我们说回望是 2；所以为了预测明天的股价，我们需要今天和昨天的股价。</p></blockquote><p id="3f10" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">回到格式，在给定的一天<em class="nk">x(t)</em>,<em class="nk">特征</em>是<em class="nk"> x(t-1)，x(t-2)，…。，x(t-n) </em>其中 n 为回看。</p><p id="33c2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所以如果我们的数据是这样的，</p><pre class="km kn ko kp gt mo mp mq mr aw ms bi"><span id="8c52" class="mt lk iq mp b gy mu mv l mw mx">[2, 3, 4, 5, 4, 6, 7, 6, 8, 9]</span></pre><p id="f00a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">所需的数据格式(n=3)如下:</p><pre class="km kn ko kp gt mo mp mq mr aw ms bi"><span id="b0be" class="mt lk iq mp b gy mu mv l mw mx">[2, 3, 4] -&gt; [5]<br/>[3, 4, 5] -&gt; [4]<br/>[4, 5, 4] -&gt; [6]<br/>[5, 4, 6] -&gt; [7]<br/>[4, 6, 7] -&gt; [6]<br/>[6, 7, 6] -&gt; [8]<br/>[7, 6, 8] -&gt; [9]</span></pre><p id="2214" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">咳😓。</p><p id="4f25" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">幸运的是，Keras 中有一个模块可以做到这一点:<a class="ae lb" href="https://keras.io/preprocessing/sequence/" rel="noopener ugc nofollow" target="_blank"> TimeseriesGenerator </a>。请查阅文档以获取更多信息。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="4d3c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我已经将 look_back 设置为 15，但是您可以随意使用这个值。</p><h2 id="201e" class="mt lk iq bd ll mz na dn lp nb nc dp lt jy nd ne lx kc nf ng mb kg nh ni mf nj bi translated">神经网络</h2><p id="eeac" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">现在我们的数据已经准备好了，我们可以继续创建和训练我们的网络。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="ff07" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用 Adam 优化器和均方损失函数训练 25 个时期的 LSTM 单元的简单架构。注意，我们没有使用 model.fit()，而是使用 model.fit_generator()，因为我们已经创建了一个数据生成器。</p><p id="9816" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">想了解更多关于 LSTM 网络的信息，请看这篇令人敬畏的<a class="ae lb" href="https://colah.github.io/posts/2015-08-Understanding-LSTMs/" rel="noopener ugc nofollow" target="_blank">博文</a>。</p><h2 id="44a4" class="mt lk iq bd ll mz na dn lp nb nc dp lt jy nd ne lx kc nf ng mb kg nh ni mf nj bi translated">预言；预测；预告</h2><p id="0009" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">现在我们已经完成了培训，让我们看看网络是否运行良好。我们可以在测试数据上测试模型，看看预测值和实际值是否重叠。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="359a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以画出预测值和实际值之间的损失，而不是计算它们。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="my mn l"/></div></figure><p id="b1dd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">从图表中，我们可以看到预测值和实际值(地面实况)有些重叠。但如果放大看，拟合并不完美。我们应该预料到这一点，因为这是不可避免的，因为我们正在进行预测。</p><h2 id="e37e" class="mt lk iq bd ll mz na dn lp nb nc dp lt jy nd ne lx kc nf ng mb kg nh ni mf nj bi translated">预测</h2><p id="6580" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">我们的测试表明这个模型还不错。所以我们可以继续预测未来。</p><blockquote class="nl nm nn"><p id="a715" class="jn jo nk jp b jq jr js jt ju jv jw jx no jz ka kb np kd ke kf nq kh ki kj kk ij bi translated">伏笔:因为我们试图预测未来，所以预测中会有很大的不确定性。</p></blockquote><p id="1526" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">预测未来很容易…要预测明天的价值，将过去<em class="nk"> n </em>(回望)天的价值输入模型，我们就可以得到明天的价值作为输出。要获得后天的值，需要输入过去 n-1 天的值，以及明天的值和后天的模型输出。</p><p id="ec43" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">更长时间的预测是不可行的。所以，让我们预测一个月的股票价格。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="b600" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在描绘未来的价值，</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="my mn l"/></div></figure><p id="8be9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">预测未来很容易…是吗？</p><p id="db5c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在预测未来时，很有可能模型输出在很大程度上是不确定的。模型的输出作为输入反馈给它。这导致模型的噪音和不确定性被重复和放大。</p><p id="9607" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是，我们还是创建了一个模型，它给出了图表的趋势，以及未来可能的取值范围。</p></div><div class="ab cl lc ld hu le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ij ik il im in"><h1 id="191b" class="lj lk iq bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">结论</h1><p id="1c00" class="pw-post-body-paragraph jn jo iq jp b jq mh js jt ju mi jw jx jy mj ka kb kc mk ke kf kg ml ki kj kk ij bi translated">通过这个模型，我们创建了一个能够在一定程度上进行预测的基本模型。尽管这个模型并不完美，但我们有一个能很好地逼近过去数据的模型。但是对于新数据，我们需要更多的参数调整。</p><p id="97ac" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果在模型训练期间存在任何问题，请尝试调整这些参数:</p><ul class=""><li id="1d98" class="nr ns iq jp b jq jr ju jv jy nt kc nu kg nv kk nw nx ny nz bi translated"><em class="nk">回望 _ 回顾</em></li><li id="913a" class="nr ns iq jp b jq oa ju ob jy oc kc od kg oe kk nw nx ny nz bi translated"><em class="nk">批量</em></li><li id="82d8" class="nr ns iq jp b jq oa ju ob jy oc kc od kg oe kk nw nx ny nz bi translated"><em class="nk"> LSTM 台</em></li><li id="28ad" class="nr ns iq jp b jq oa ju ob jy oc kc od kg oe kk nw nx ny nz bi translated"><em class="nk">次数</em></li></ul><p id="e6f1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">您还可以通过堆叠 LSTM 图层来增强架构。</p><p id="14cd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">谢谢大家！！😁</p></div></div>    
</body>
</html>