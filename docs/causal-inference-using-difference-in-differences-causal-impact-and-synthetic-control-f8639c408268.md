# 使用差异中的差异、因果影响和综合控制的因果推理

> 原文：<https://towardsdatascience.com/causal-inference-using-difference-in-differences-causal-impact-and-synthetic-control-f8639c408268?source=collection_archive---------0----------------------->

相关性不是因果关系。那么什么是因果关系呢？如何衡量？

因果关系是衡量 x 对 Y 的实际影响，例如，广告活动对产品销售的影响是什么？

准确理解这些干预对受试者的因果影响至关重要。因果推理的主要威胁之一是来自其他变量的混杂效应。在广告活动的情况下，它可能是产品价格的降低，整体经济的变化或各种其他因素可能会导致销售的变化。那么，我们如何正确地将销售的变化归因于广告宣传呢？

有两种方法可以估计干预对受试者的真正因果影响。

**随机实验**:这是推断治疗的实际因果影响的最可靠方法，我们随机诱发过程中的变化，并测量结果变量的相应变化。然而，在大多数情况下，进行实验并控制整个系统真正随机是不可能的。

**计量经济学中的因果推断:**这种方法包括将统计程序应用于已经可用的数据，在控制混杂因素的同时得出因果估计。这种方法下的一些方法是我们将在这个分析中看到的。以下是一些方法:

*   差异中的差异
*   因果影响
*   综合控制

将使用 [*巴斯克*](https://www.rdocumentation.org/packages/Synth/versions/1.1-5/topics/basque) 数据集进行演示。利用这些数据，我们将在来自其他 17 个地区的数据的帮助下，估计恐怖主义冲突在西班牙自治区巴斯克地区的真实经济影响。让我们看看一些关于数据和实验设计的事实。

*   该数据集包含 1955 年至 1997 年的信息
*   关于西班牙 18 个地区的信息可用
    ——其中一个是西班牙全国的平均值(我们将删除它)
*   治疗年份被认为是 1975 年
*   治疗区域为“巴斯克地区(Pais Vasco)”
*   经济影响衡量变量是人均国内生产总值(以千计)

分析是在 R 中完成的，源代码可以在我的 [GitHub](https://github.com/prasanna7/Causal_Inference/tree/master/Basque) 中找到。我们将从提到的方法开始。

# 一阶差分估计

在讨论差异方法中的差异之前，让我们先看看第一个差异及其作用。我们的目标是量化巴斯克地区恐怖冲突前后 GDP 的影响。简单地说，我们实际上可以通过构建一阶差分回归并观察估计值来实现这一点。让我们看看巴斯克地区人均 GDP 的总体趋势。

![](img/5a7a294333362f02fe03cd04638d0847.png)

从图表中，我们可以看到趋势是如何在恐怖主义干预后突然下降，然后又重新上升的。我们的目标是确定我们看到的暴跌幅度。第一个差异估计值将告诉我们治疗前后 GDP 的差异。让我们以 GDP 为因变量，前后指标为自变量，构造一个一阶差分方程。

```
f_did <- lm(data = basq_fdid, gdpcap ~ post)
stargazer(f_did, type=”text”)
```

![](img/f290afa800f9664374079b2d664e328f.png)

后指标系数表明，后时期人均 GDP 增长了约 2.5 个单位，这并不是我们想要的，因为我们想要捕捉下降趋势。

这是因为有一个我们之前提到的预期问题。除了同时发生的恐怖主义冲突之外，GDP 的趋势可能会因为许多其他变量而发生改变，也就是所谓的混杂因素。这种情况下可能的混杂因素有:

*   贸易法的通过会影响当地的商业和国内生产总值
*   地方团体内部的兵变
*   对腐败或功能失调的政府的看法

对此的解决方案是将趋势与未受恐怖主义冲突影响的控制区域进行比较。这种比较允许我们在干预期后去除混杂效应，并得出真正的因果影响。这就是差异方法的不同之处。

# 差异中的差异

差异中的差异(DD)设计的基本假设是，对照组的趋势提供了在没有治疗的治疗组中观察到的趋势的适当代表。因此，斜率变化的差异将是实际的处理效果。这里的假设是治疗组和对照组在前期必须遵循相同的趋势。

对于这一分析，控制区是通过发现每个地区和巴斯克地区之间多年来国内生产总值百分比差异变化最低的地区来确定的。或者，在可行的情况下，我们可以通过观察治疗组和对照组的 GDP 趋势来寻找控制区域。在这种情况下，加泰罗尼亚地区被认为是最好的控制地区。让我们看看下面测试和控制区域的 GDP 趋势:

![](img/27d64349ad810d5663f4d7cbf9d11668.png)

加泰罗尼亚地区的国内生产总值趋势与巴斯克的国内生产总值齐头并进，但前几年除外。因此，将加泰罗尼亚视为我们的控制区应该没有问题。

让我们以 GDP 为因变量，以治疗指标和前后指标为自变量进行回归拟合。这里的关键方面是提供治疗和治疗前后指标之间的相互作用，因为我们希望估计值包含治疗和治疗后指标与未治疗和治疗前指标相比的影响。拟合之后，我们来看看下面的回归结果:

```
did <- lm(data = did_data, gdpcap ~ treat*post)
stargazer(did, type=”text”)
```

![](img/7bf41f2500d7c4ee8f72df19fa955b46.png)

查看交互变量的估计表明，由于发生的恐怖主义干预，巴斯克地区的 GDP 减少了 0.85 个单位。现在，一阶差分法和 DD 法提供的估计值之间存在着明显的差异。从数量上来说，我们可以看到第一个差异估计看起来是多么的欺骗和天真。

如果你感兴趣，你可以在这里阅读更多关于差异的差异。现在，让我们转到其他因果推断方法。

# 因果影响

因果影响是谷歌开发的一种方法，用于评估治疗对被治疗群体的因果影响。官方文件可以在[这里](https://google.github.io/CausalImpact/CausalImpact.html)找到。

使用因果影响方法的动机是，差异中的差异在以下方面受到限制:

*   DD 传统上基于静态回归模型，该模型假设独立且同分布的数据，尽管事实上设计具有时间成分
*   大多数 DD 分析只考虑两个时间点:干预前和干预后。在实践中，我们还必须考虑一个效应随时间演变的方式，尤其是它的开始和衰减结构

这里的想法是使用对照组中的趋势来预测治疗组中的趋势，如果治疗没有发生，这将是趋势。那么实际的因果估计将是我们预测的治疗组的实际趋势与反事实趋势之间的差异。因果影响使用贝叶斯结构时间序列模型来解释观察结果的时间演变。本质上，因果影响方法非常接近我们接下来要看到的综合控制方法。

在这种情况下，控制区域再次被认为是加泰罗尼亚。有了处理和控制地区的 GDP，让我们把它们输入到 R 中的因果影响函数，看看结果。

```
pre.period <- as.Date(c(“1955–01–01”, “1975–01–01”))
post.period <- as.Date(c(“1976–01–01”, “1997–01–01”))impact <- CausalImpact(basq_CI, pre.period, post.period)
summary(impact)
```

![](img/ca1e42132aaae8817c660d90f07a26df.png)

绝对效应是处理后的实际 GDP 与反事实 GDP 之差。从结果中，我们可以看到绝对影响给了我们-0.76 的值，这意味着人均 GDP 减少了 0.76 个单位，即 8.8%，因为在巴斯克地区发生了恐怖主义冲突。这几乎等于我们使用差异中的差异方法看到的估计。对于那些对因果影响感兴趣的人，该方法的作者给出了该方法的详尽解释，可以在这里 找到 [*。*](https://storage.googleapis.com/pub-tools-public-publication-data/pdf/41854.pdf)

# 综合控制

综合控制是一种与因果影响非常相似的技术，用于估计治疗的真实影响。这两种方法都是在对照组的帮助下构建一个治疗组的反事实，让我们知道如果治疗没有发生，趋势是什么。治疗组的反事实 GDP 将由对照组的 GDP 以及对照组中其他可能的协变量来预测。synth 算法通过为对照组中的回归变量分配权重来预测反事实，这有助于识别单个回归变量及其在预测中的影响。最终，真正的因果影响是实际 GDP 和反事实 GDP 之间的差异，如果治疗没有发生。

综合控制和因果影响之间的区别在于，综合控制仅使用治疗前变量进行匹配，而因果影响使用预测变量的全部治疗前和治疗后时间序列进行匹配。让我们看看数据中所有其他 17 个地区的 GDP 趋势图。

![](img/ef06dc9e89b11bd1a16adeaea034c604.png)

从上面的图中可以看出，所有控制区的 GDP 都有类似巴斯克地区前期的上升趋势。这表明巴斯克地区的 GDP 可以使用其他地区的数据相当准确地构建。

关于这个问题陈述的综合控制的实现已经在[这里](https://cran.r-project.org/web/packages/Synth/Synth.pdf)找到的包的官方文档中给出。执行之后，我们来看看实际 GDP 和反事实 GDP 之间的情节。

![](img/bc00c4c74582e502c81e2926b1449308.png)

路径图显示了前期的合成趋势和实际趋势之间的平滑关系，以及一旦治疗发生，它如何逐渐偏离。后期趋势的差异就是我们的平均治疗效果。

发现实际和合成趋势的均方根误差为 0.57 个单位。我们可以得出结论，恐怖主义冲突对巴斯克地区的真正因果影响是使用合成控制方法计算的 GDP 减少了 0.57 个单位。

让我们来看看以下三种方法的结果对比:

![](img/157cdccc650838f434fb4c6606523117.png)

这三种方法之间因果影响的大小只有很小的差别，而且没有一种方法能给我们“正确的答案”大多数时候，我们使用的方法会受到实验性质和我们试图解决的因果威胁的限制。

其他一些用于推断因果影响的技术有[倾向分数匹配](https://www.statisticshowto.datasciencecentral.com/propensity-score-matching/)、[固定效应回归](https://www.statisticshowto.datasciencecentral.com/experimental-design/fixed-effects-random-mixed-omitted-variable-bias/)、[工具变量](https://www.statisticshowto.datasciencecentral.com/instrumental-variable/)和[回归不连续性](https://www.socialresearchmethods.net/kb/quasird.htm)。