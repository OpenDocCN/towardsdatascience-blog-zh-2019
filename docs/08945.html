<html>
<head>
<title>Making Interactive Maps in R with Less Than 15 Lines of Code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用不到 15 行代码在 R 语言中制作交互式地图</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/making-interactive-maps-in-r-with-less-than-15-lines-of-code-bfd81f587e12?source=collection_archive---------3-----------------------#2019-11-29">https://towardsdatascience.com/making-interactive-maps-in-r-with-less-than-15-lines-of-code-bfd81f587e12?source=collection_archive---------3-----------------------#2019-11-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="b942" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你有地理数据，你会想把它显示在地图上。只用几行简单的代码，我们就可以用 r 语言制作一个漂亮的地图。我假设你的电脑上已经安装了 R and R 工作室。</p><p id="99ff" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我强烈建议您在自己的计算机上跟随。我在这个项目中使用的数据可以在<a class="ae ko" href="https://drive.google.com/open?id=1aG7zpEmBlHwlspzTszOXJRazbet-SZVk" rel="noopener ugc nofollow" target="_blank">这个链接</a>获得，它显示了我在过去几年中参观过的所有博物馆。我建议要么下载它，要么找到你自己的地理空间数据来玩。你应该查看我的数据，虽然检查我在做什么。</p><p id="8911" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我还将在 R 中使用管道操作符，这有时会令人困惑，看起来像这样%&gt;%。管道运算符将左边的对象作为右边函数的第一个参数。因此，以下几行 R 代码是等价的:</p><pre class="kp kq kr ks gt kt ku kv kw aw kx bi"><span id="7a44" class="ky kz it ku b gy la lb l lc ld">print(sum(c(1,2,3,4,5)))</span><span id="06ea" class="ky kz it ku b gy le lb l lc ld">c(1,2,3,4,5) %&gt;% sum() %&gt;% print()</span></pre><p id="7f9f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们将使用 2 个外包装，传单和 tidyverse。传单构建在 JavaScript 之上，对映射很有用(使用它不需要 JavaScript 知识)。tidyverse 是一个超级包，包含许多其他包，用于读取、组织和清理数据。知道 tidyverse 有很高的投资回报，我建议学习它。</p><h1 id="4863" class="lf kz it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">步骤 1:安装软件包</h1><p id="73c3" class="pw-post-body-paragraph jq jr it js b jt mc jv jw jx md jz ka kb me kd ke kf mf kh ki kj mg kl km kn im bi translated">我们在 R Studio 的控制台中运行这些代码行来安装所需的包。</p><pre class="kp kq kr ks gt kt ku kv kw aw kx bi"><span id="34f6" class="ky kz it ku b gy la lb l lc ld">install.packages("tidyverse")</span><span id="4cef" class="ky kz it ku b gy le lb l lc ld">install.packages("leaflet")</span></pre><figure class="kp kq kr ks gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi mh"><img src="../Images/269a1783fbf173af20414b6cbc49c2f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1b9vaDcb-X0eCB-qoMxfFg.png"/></div></div></figure><h1 id="ce96" class="lf kz it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">步骤 2:加载包</h1><p id="3756" class="pw-post-body-paragraph jq jr it js b jt mc jv jw jx md jz ka kb me kd ke kf mf kh ki kj mg kl km kn im bi translated">从现在开始，我们将在一个新的脚本文件中运行我们的代码。我们现在用 library()函数加载包。</p><pre class="kp kq kr ks gt kt ku kv kw aw kx bi"><span id="3c2e" class="ky kz it ku b gy la lb l lc ld">library("tidyverse")<br/>library("leaflet")</span></pre><h1 id="c3c9" class="lf kz it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">步骤 3:加载数据</h1><p id="8563" class="pw-post-body-paragraph jq jr it js b jt mc jv jw jx md jz ka kb me kd ke kf mf kh ki kj mg kl km kn im bi translated">接下来，我们使用 tidyverse 中的 read_csv()函数读入数据。您可能需要在 read_csv()函数中更改 csv 的文件路径。</p><pre class="kp kq kr ks gt kt ku kv kw aw kx bi"><span id="d393" class="ky kz it ku b gy la lb l lc ld">library("tidyverse")<br/>library("leaflet")</span><span id="a424" class="ky kz it ku b gy le lb l lc ld">museum &lt;- read_csv("museum.csv")</span></pre><h1 id="9981" class="lf kz it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">步骤 4:添加瓷砖</h1><p id="0ede" class="pw-post-body-paragraph jq jr it js b jt mc jv jw jx md jz ka kb me kd ke kf mf kh ki kj mg kl km kn im bi translated">步骤 4A:首先，我们必须使用管道将数据传递给传单函数。光靠这个是做不出地图的。<br/>第 4B 步:在这个<a class="ae ko" href="https://leaflet-extras.github.io/leaflet-providers/preview/" rel="noopener ugc nofollow" target="_blank">链接</a>处挑选出图块(地图的样子)。<br/>步骤 4C:将传单函数的输出传递给 addProviderTiles()函数，唯一的参数是您在步骤 4B 中选择的图块。我选了雄蕊。</p><pre class="kp kq kr ks gt kt ku kv kw aw kx bi"><span id="a5d3" class="ky kz it ku b gy la lb l lc ld">library("tidyverse")<br/>library("leaflet")</span><span id="11c8" class="ky kz it ku b gy le lb l lc ld">museum &lt;- read_csv("museum.csv")</span><span id="1924" class="ky kz it ku b gy le lb l lc ld">museum %&gt;% <br/>leaflet() %&gt;%<br/>addProviderTiles(providers$Stamen.TonerLite)</span></pre><figure class="kp kq kr ks gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi mp"><img src="../Images/0474f029bd8a4c535278a31ffa73b953.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jxxBAxpI3rJpztgNc8r3mw.png"/></div></div></figure><p id="0800" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">从现在开始，我建议在每一步结束时运行所有代码，看看地图是否合你的意。</p><h1 id="0c95" class="lf kz it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">步骤 5:添加多个图块</h1><p id="f1f4" class="pw-post-body-paragraph jq jr it js b jt mc jv jw jx md jz ka kb me kd ke kf mf kh ki kj mg kl km kn im bi translated">步骤 5A:选择另一组要添加的图块。<br/>步骤 5B:使用组参数为每个切片命名，我选择了 ESRI . world imagery。<br/>步骤 5C:添加图层控制(这使您可以看到两个切片)。您可以在右上角选择想要查看的互动程序</p><pre class="kp kq kr ks gt kt ku kv kw aw kx bi"><span id="ce2d" class="ky kz it ku b gy la lb l lc ld">library("tidyverse")<br/>library("leaflet")</span><span id="2bd4" class="ky kz it ku b gy le lb l lc ld">museum &lt;- read_csv("museum.csv")</span><span id="c96e" class="ky kz it ku b gy le lb l lc ld">museum %&gt;% <br/>leaflet() %&gt;%<br/>addProviderTiles(providers$Esri.WorldImagery, group = "World Imagery") %&gt;%<br/>addProviderTiles(providers$Stamen.TonerLite, group = "Toner Lite") %&gt;%<br/>addLayersControl(baseGroups = c("Toner Lite", "World Imagery"))</span></pre><figure class="kp kq kr ks gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi mq"><img src="../Images/7c6b023d5999a22b45729a6141dacf55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JP37tTGCxrDNOcbaBNJAZA.png"/></div></div></figure><h1 id="0575" class="lf kz it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">步骤 6:使用数据向地图添加标记</h1><p id="c14a" class="pw-post-body-paragraph jq jr it js b jt mc jv jw jx md jz ka kb me kd ke kf mf kh ki kj mg kl km kn im bi translated">步骤 6A:使用 addMarkers()函数，如果你的数据集有纬度和经度(或它们的缩写)，你不需要填写纬度和液化天然气的参数。<br/>步骤 6B:您可以选择设置标签和弹出参数，以便当您将鼠标悬停在标记上或单击它时显示信息。</p><pre class="kp kq kr ks gt kt ku kv kw aw kx bi"><span id="9645" class="ky kz it ku b gy la lb l lc ld">library("tidyverse")<br/>library("leaflet")</span><span id="c3b7" class="ky kz it ku b gy le lb l lc ld">museum &lt;- read_csv("museum.csv")</span><span id="e7a2" class="ky kz it ku b gy le lb l lc ld">museum %&gt;% <br/>leaflet() %&gt;%<br/>addProviderTiles(providers$Esri.WorldImagery, group = "World Imagery") %&gt;%<br/>addProviderTiles(providers$Stamen.TonerLite, group = "Toner Lite") %&gt;%<br/>addLayersControl(baseGroups = c("Toner Lite", "World Imagery")) %&gt;%<br/>addMarkers(label = museum$museum, <br/>           popup = ifelse(museum$`Presidential Library`=="Yes",<br/>                          "A Presidential Library", # Value if True<br/>                          "Not a Presidential Library")) # Val False</span></pre><figure class="kp kq kr ks gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi mr"><img src="../Images/4f96c9abefc0da10043f8e32f8d715fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LUxiasbO08cRhEU15ziHag.png"/></div></div></figure><h1 id="e8aa" class="lf kz it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">步骤 7:添加集群</h1><p id="8922" class="pw-post-body-paragraph jq jr it js b jt mc jv jw jx md jz ka kb me kd ke kf mf kh ki kj mg kl km kn im bi translated">如果你有很多很多的数据点，这是一件很好的事情，这样你的地图就不会被淹没。如果你们有非常接近的点，这也很好。我们需要做的就是用 clusterOptions 参数更新我们的 addMarkers()函数。</p><pre class="kp kq kr ks gt kt ku kv kw aw kx bi"><span id="7c62" class="ky kz it ku b gy la lb l lc ld">library("tidyverse")<br/>library("leaflet")</span><span id="759c" class="ky kz it ku b gy le lb l lc ld">museum &lt;- read_csv("museum.csv")</span><span id="c783" class="ky kz it ku b gy le lb l lc ld">museum %&gt;%<br/>leaflet() %&gt;%<br/>addProviderTiles(providers$Esri.WorldImagery, group = "World Imagery") %&gt;%<br/>addProviderTiles(providers$Stamen.TonerLite, group = "Toner Lite") %&gt;%<br/>addLayersControl(baseGroups = c("Toner Lite", "World Imagery")) %&gt;%<br/>addMarkers(label = museum$museum,<br/>           clusterOptions = markerClusterOptions(),<br/>           popup = ifelse(museum$`Presidential Library`=="Yes",<br/>                          "A Presidential Library",<br/>                          "Not a Presidential Library"))</span></pre><figure class="kp kq kr ks gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi ms"><img src="../Images/454ce1e81b2bf116a41f55a71cdf57fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MZRUM6PF3CFeEGz10bzB1A.png"/></div></div></figure><h1 id="35fc" class="lf kz it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">步骤 8:设置开始缩放</h1><p id="fd52" class="pw-post-body-paragraph jq jr it js b jt mc jv jw jx md jz ka kb me kd ke kf mf kh ki kj mg kl km kn im bi translated">这一步并不是必需的，但是如果您想将地图集中在一个特定的位置，您可以使用 setView()函数。我会关注亚特兰大。</p><pre class="kp kq kr ks gt kt ku kv kw aw kx bi"><span id="56b3" class="ky kz it ku b gy la lb l lc ld">library("tidyverse")<br/>library("leaflet")</span><span id="6f26" class="ky kz it ku b gy le lb l lc ld">museum &lt;- read_csv("museum.csv")</span><span id="39b3" class="ky kz it ku b gy le lb l lc ld">museum %&gt;%<br/>leaflet() %&gt;%<br/>addProviderTiles(providers$Esri.WorldImagery, group = "World Imagery") %&gt;%<br/>addProviderTiles(providers$Stamen.TonerLite, group = "Toner Lite") %&gt;%<br/>addLayersControl(baseGroups = c("Toner Lite", "World Imagery")) %&gt;%<br/>addMarkers(label = museum$museum,<br/>           clusterOptions = markerClusterOptions(),<br/>           popup = ifelse(museum$`Presidential Library`=="Yes",<br/>                          "A Presidential Library",<br/>                          "Not a Presidential Library")) %&gt;%<br/>setView(lat = 33.736309, lng = -84.388298, zoom = 11)</span></pre><figure class="kp kq kr ks gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi mt"><img src="../Images/3822d84416d4bb615289210ff14564a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rOpxG5zmeWBHYwXHoxNgDQ.png"/></div></div></figure><h1 id="90c8" class="lf kz it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">步骤 9:添加小地图</h1><p id="d4de" class="pw-post-body-paragraph jq jr it js b jt mc jv jw jx md jz ka kb me kd ke kf mf kh ki kj mg kl km kn im bi translated">要添加一个小地图到我们的地图，我们只需要使用 addMiniMap()函数。您可以使用 addMiniMap()调整的两个参数是更改图块(这允许您更改地图背景，就像在主视图中一样)和 toggleDisplay(这允许您隐藏地图)。</p><pre class="kp kq kr ks gt kt ku kv kw aw kx bi"><span id="f836" class="ky kz it ku b gy la lb l lc ld">library("tidyverse")<br/>library("leaflet")</span><span id="c04b" class="ky kz it ku b gy le lb l lc ld">museum &lt;- read_csv("museum.csv")</span><span id="4ff0" class="ky kz it ku b gy le lb l lc ld">museum %&gt;%<br/>leaflet() %&gt;%<br/>addProviderTiles(providers$Esri.WorldImagery, group = "World Imagery") %&gt;%<br/>addProviderTiles(providers$Stamen.TonerLite, group = "Toner Lite") %&gt;%<br/>addLayersControl(baseGroups = c("Toner Lite", "World Imagery")) %&gt;%<br/>addMarkers(label = museum$museum,<br/>           clusterOptions = markerClusterOptions(),<br/>           popup = ifelse(museum$`Presidential Library`=="Yes",<br/>                          "A Presidential Library",<br/>                          "Not a Presidential Library")) %&gt;%<br/>setView(lat = 33.736309, lng = -84.388298, zoom = 11) %&gt;%<br/>addMiniMap(<br/>    toggleDisplay = TRUE,<br/>    tiles = providers$Stamen.TonerLite<br/>    )</span></pre><figure class="kp kq kr ks gt mi gh gi paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gh gi ms"><img src="../Images/842ff445d2bd188c6e9bbf4a80f39925.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_kdeTPCacl9DZdEIcTEKzQ.png"/></div></div></figure><p id="1484" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们完了！您可能已经注意到这比 15 行稍微多一点，我选择通过将函数分成多行来优化可读性。祝你所有的地理空间工作好运！</p></div></div>    
</body>
</html>