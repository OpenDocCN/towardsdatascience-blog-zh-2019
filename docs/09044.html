<html>
<head>
<title>Interactive Neural Network Fun in Excel</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Excel 中的交互式神经网络乐趣</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/interactive-neural-network-fun-in-excel-8bad2b3a5d9d?source=collection_archive---------14-----------------------#2019-12-02">https://towardsdatascience.com/interactive-neural-network-fun-in-excel-8bad2b3a5d9d?source=collection_archive---------14-----------------------#2019-12-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/6855b0e847b984b6940de209dbcec810.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jzNyh-9RLyc3v3d9aVVdkw.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">Constructing CPPNs in Excel with PyTorch and PyXLL</figcaption></figure><p id="d5e5" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">在阅读了 T2 的《让深度神经网络绘画以理解它们如何工作》之后，我受到了启发，开始钻研自己的一些实验。产生的图像很有趣，我想玩一玩，感受一下它们是如何随着神经网络结构的变化而变化的。</p><p id="4f60" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">我鼓励你回去阅读原文，但作为一个简短的总结，它涉及到使用<a class="ae ld" href="https://en.wikipedia.org/wiki/Compositional_pattern-producing_network" rel="noopener ugc nofollow" target="_blank">合成模式产生网络</a> (CPPN)和随机权重来产生抽象图像。基本思想是，我们构造一个函数 c = <em class="lg"> f(x，y) </em>，它获取像素<em class="lg"> x，y </em>的输入坐标，并使用 CPPN 返回该像素的颜色<em class="lg"> c </em>。</p><figure class="li lj lk ll gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi lh"><img src="../Images/bc29249e00e8615c75cc0d3da6688b90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*wi2e2MjfNvNYbMiE.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">Image via <a class="ae ld" href="http://blog.otoro.net/2016/03/25/generating-abstract-patterns-with-tensorflow/" rel="noopener ugc nofollow" target="_blank">Generating Abstract Patterns with TensorFlow</a></figcaption></figure><p id="5742" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">正如在最初的文章中一样，我们将使用 PyTorch 创建一个 CPPN。下面的代码是大量工作的结果，也是我们的起点。</p><figure class="li lj lk ll gt ju"><div class="bz fp l di"><div class="lm ln l"/></div></figure><p id="9aad" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">在 512x512 输入数组上运行上述神经网络会产生如下所示的输出图像。用随机权重初始化神经网络，并且缩放输入数组，使得每个输入在+0.5 和-0.5 之间。</p><figure class="li lj lk ll gt ju gh gi paragraph-image"><div class="gh gi lo"><img src="../Images/fee5066174aa0f7e11cb5b657eeae28a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/1*IzgieOsVtJO1OgmVUCAjmA.png"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">Created using a CPPN with random weights</figcaption></figure><p id="1b53" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">有很多变量会影响最终的图像。从输入的缩放、每个阶段的神经元数量以及神经网络本身的结构。我们可以把这个代码放在一个 Jupyter 的笔记本里，然后在那里修改输入，但是我们所做的每一个修改都是对代码本身的修改，不知何故感觉不太像一个真正的交互体验。</p><p id="7077" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">最初，对于这种类型的任务，Microsoft Excel 似乎是一个奇怪的交互式选择。请原谅我……我们想要做的是输入一些信息，比如重量的数量和层数，然后有一个新的图像呈现给我们。本质上，Excel 只是在输入改变时运行函数——这些函数可以做任何事情，甚至在 Excel 中向我们显示图像！如果我们可以在 Excel 中有一个包含我们想要更改的参数的工作表，并且一旦我们做出更改，就会有图像更新，这将是一个很好的体验输入如何影响输出的场所。</p><h1 id="2a13" class="lp lq it bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">在 Excel 中使用 Python</h1><p id="6e7c" class="pw-post-body-paragraph kf kg it kh b ki mn kk kl km mo ko kp kq mp ks kt ku mq kw kx ky mr la lb lc im bi translated">Excel 中的神经网络听起来可能是一项艰巨的任务，但我们不是在谈论在 VBA 实现它！事实上，我们不需要去 VBA 附近的任何地方，因为我们可以继续使用 Python。</p><p id="c138" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated"><a class="ae ld" href="https://www.pyxll.com?utm_source=medium" rel="noopener ugc nofollow" target="_blank"> PyXLL </a>是一个 Excel 插件，将 Python 运行时嵌入到 Microsoft Excel 中。它允许我们完全用 Python 编写 Excel 函数，因此我们仍然可以将 PyTorch 用于我们的神经网络，但都是在 Excel 中。拥有所有 Python 工具的访问权限真正开启了 Excel 的潜能。用 Python 编写的软件并没有用 VBA 编码复杂的逻辑，而是简单地暴露给 Excel。Excel 成为我们的前端用户界面工具，Python 负责复杂的计算。</p><p id="3824" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">PyXLL 是完全用 Python 编写 Excel 函数的最高性能和最简单的方法，非常适合复杂的工作负载。你可以从 https://www.pyxll.com/download.html 的<a class="ae ld" href="https://www.pyxll.com/download.html?utm_source=medium" rel="noopener ugc nofollow" target="_blank">下载 30 天免费试用版。</a></p><h1 id="70a0" class="lp lq it bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">在 Excel 中构建神经网络</h1><p id="6438" class="pw-post-body-paragraph kf kg it kh b ki mn kk kl km mo ko kp kq mp ks kt ku mq kw kx ky mr la lb lc im bi translated">我们的目标是能够在 Excel 中构建我们的神经网络，并完全控制输入。我们将从编写一些 Python 函数并向 Excel 公开它们开始。大致来说，我们需要的函数是:</p><ol class=""><li id="fef7" class="ms mt it kh b ki kj km kn kq mu ku mv ky mw lc mx my mz na bi translated">创建层(nn。线性，nn。Tanh 和 nn。乙状结肠)</li><li id="afa2" class="ms mt it kh b ki nb km nc kq nd ku ne ky nf lc mx my mz na bi translated">从一组层创建神经网络(nn。顺序)</li><li id="a37e" class="ms mt it kh b ki nb km nc kq nd ku ne ky nf lc mx my mz na bi translated">对一组输入运行神经网络并显示输出</li></ol><p id="2a66" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">在这个阶段，你可能想知道我们如何在 Excel 中表示这些项目。PyXLL 允许我们在工作簿中的 Excel 函数之间传递 Python 对象，因此拥有一个返回 nn 的 Python 实例的函数。Linear 或另一个接受变换层列表的 Python 函数实际上非常简单。当 Python 对象返回 Excel 时，我们在 Excel 中看到的只是 Python 对象的句柄，当该句柄传递给另一个 Python 函数时，PyXLL 会自动获取该句柄的对象。PyXLL 还管理这些对象的生命周期，因此当不再需要它们时，它们会被自动清理。</p><p id="4c18" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">为了向 Excel 公开 Python 函数，我们使用 pyxll 模块中的@xl_func 装饰器。下面是我们创建图层需要的第一个函数:</p><figure class="li lj lk ll gt ju"><div class="bz fp l di"><div class="lm ln l"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">Exposing PyTorch functions to Excel</figcaption></figure><p id="4c84" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">@xl_func decorator 就是将这些函数暴露给 Excel 所需要的全部！nn_Linear 函数具有类型注释，PyXLL 使用这些注释来确保从 Excel 传递到该函数的类型是正确的，否则从 Excel 传递的数字可能会以浮点数的形式出现。</p><p id="4334" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">所需要做的就是将这个模块添加到 PyXLL 配置文件 pyxll.cfg 中。例如，如果您的代码被写入到文件夹“C:\ my code \ py torch-Abstract-Art \ Modules”中名为“pytorch_abstract_art.py”的 Python 模块中，您将使用以下设置更新您的 pyxll.cfg 文件:</p><pre class="li lj lk ll gt ng nh ni nj aw nk bi"><span id="d39a" class="nl lq it nh b gy nm nn l no np">[PYTHON]<br/>pythonpath =<br/>    C:\MyCode\PyTorch-Abstract-Art\Modules</span><span id="1882" class="nl lq it nh b gy nq nn l no np">[PYXLL]<br/>modules =<br/>    pytorch_abstract_art</span></pre><p id="434e" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">我们现在可以从 Excel 中调用这些函数来构建神经网络所需的所有层。所有的输入都输入到 Excel 中，我们甚至可以交互地改变层的数量和顺序。</p><figure class="li lj lk ll gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nr"><img src="../Images/69ce90f1da39fae0d26d2bacb5f9d695.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hTnchIrHsrRa586Tymelxg.png"/></div></div></figure><p id="eec7" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">要构建神经网络，我们只需要另一个函数，它接受这些层并使用 nn.Sequential 返回神经网络。PyXLL 可以接受参数数组以及单个值，因此我们可以将整个层集作为单个参数传递。@xl_func decorator 采用一个可选函数<em class="lg">签名</em>来告诉 PyXLL 更多关于参数和预期返回类型的信息。</p><p id="24fe" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">为了告诉 PyXLL 将传递给它的单元格范围转换成一维对象列表，我们使用了<em class="lg"> object[] </em>类型。如果我们想把一个范围作为一个 2d 的对象列表来传递，我们可以使用<em class="lg"> object[][] </em>类型。当从 2d 范围的单元格展平到 1d 值列表时，PyXLL 从左到右取单元格，因此上图中我们的层的排序将导致正确的排列。</p><figure class="li lj lk ll gt ju"><div class="bz fp l di"><div class="lm ln l"/></div></figure><p id="cd34" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">现在，我们可以将新函数<em class="lg"> nn_Sequential </em>添加到 Excel 工作表中，并传入之前创建的层。</p><figure class="li lj lk ll gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ns"><img src="../Images/293c045fa184e51c9d26ab7f08324b50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fXPCruFxdibtIIqEr0dHWQ.png"/></div></div></figure><h1 id="0b7d" class="lp lq it bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">创建输出图像</h1><p id="f78c" class="pw-post-body-paragraph kf kg it kh b ki mn kk kl km mo ko kp kq mp ks kt ku mq kw kx ky mr la lb lc im bi translated">现在剩下的事情就是创建一个输入集，初始化权重，并显示结果图像。</p><p id="3199" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">为此，我们将使用 Excel 的对象模型来操作 Excel 中的图像。如果你曾经编写过任何 VBA，Excel 的对象模型正是你可能使用过的，但是你可能没有意识到从 Python 中调用它就像从 VBA 中调用一样容易！指南<a class="ae ld" href="https://www.pyxll.com/docs/userguide/vba.html?utm_source=medium" rel="noopener ugc nofollow" target="_blank"> Python 作为 VBA 的替代品</a>解释了如何从 Python 中调用 Excel，还涵盖了 VBA 语法和 Python 之间的一些差异。</p><p id="84e2" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">最后一个函数需要:</p><ol class=""><li id="406e" class="ms mt it kh b ki kj km kn kq mu ku mv ky mw lc mx my mz na bi translated">神经网络对象</li><li id="6abd" class="ms mt it kh b ki nb km nc kq nd ku ne ky nf lc mx my mz na bi translated">Excel 中图像对象的名称</li><li id="fa40" class="ms mt it kh b ki nb km nc kq nd ku ne ky nf lc mx my mz na bi translated">输入的比例和偏移参数</li><li id="9d19" class="ms mt it kh b ki nb km nc kq nd ku ne ky nf lc mx my mz na bi translated">随机的种子</li></ol><p id="daba" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">要添加显示我们结果的图像，在 Excel 中点击<em class="lg">开发者</em> → <em class="lg">插入</em> →I <em class="lg">图像(活动 X 控件)</em>。在公式栏的左侧，您会看到图像对象的名称。这将默认为<em class="lg">图像 1 </em>，但是您可以将其编辑为您喜欢的任何名称。</p><p id="105a" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">下面的代码从 Excel 获取图像，构造输入，计算输出并更新图像。</p><figure class="li lj lk ll gt ju"><div class="bz fp l di"><div class="lm ln l"/></div></figure><p id="42ab" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">完成这最后一个功能后，我们现在可以将它们整合在一起了。构建神经网络的所有输入都显示在工作表上，控制输入数据创建方式的参数也是如此。</p><p id="32b9" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">我们可以添加或删除层，编辑每个阶段的特征数量，甚至切换激活功能。真正有趣的是，一切都是实时的。只要我们做出改变，图像就会更新。</p><figure class="li lj lk ll gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/6855b0e847b984b6940de209dbcec810.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jzNyh-9RLyc3v3d9aVVdkw.png"/></div></div></figure><p id="9faa" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">为了便于阅读，上面的代码中省略了几个函数。您可以在下面找到它们，或者您也可以从 pytorch 文件夹中的 GitHub repo<a class="ae ld" href="https://github.com/pyxll/pyxll-examples" rel="noopener ugc nofollow" target="_blank">https://github.com/pyxll/pyxll-examples</a>获得所有代码。</p><figure class="li lj lk ll gt ju"><div class="bz fp l di"><div class="lm ln l"/></div></figure><h1 id="9861" class="lp lq it bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">最后的想法</h1><p id="e02e" class="pw-post-body-paragraph kf kg it kh b ki mn kk kl km mo ko kp kq mp ks kt ku mq kw kx ky mr la lb lc im bi translated">以这种方式在 Excel 中摆弄神经网络真的很有趣。更重要的是，它展示了如何将复杂的 Python 任务无缝集成到 Excel 中。</p><p id="98a8" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">Excel 的优势在于它是一种用户界面工具，在我看来，它不应该用来存储数据、算法或业务逻辑，因为这些东西可以在其他地方更好地管理。任何使用过 Excel 一段时间或与依赖 Excel 的团队合作过的人都知道 VBA 宏的痛苦，这些宏不能被测试，不能被版本控制，甚至不能在不同用户的工作簿之间保持一致。通过将代码移出 Excel，您不仅可以获得 Python 等现代语言的巨大优势，还可以将现代开发实践应用于电子表格背后的代码。</p><p id="6b18" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">虽然没有多少人想在 Excel 中实际构建和训练神经网络，但是能够从 Excel 中<em class="lg">访问</em>神经网络仍然是有价值的。机器学习之所以有用，很大一部分是因为能够用它来辅助决策。如果决策者已经在使用 Excel，我们可以通过在 Excel 中<em class="lg">向他们展示经过培训和测试的机器学习解决方案，让他们轻松使用。这可能是一个大大改进的工作流程，他们使用 Excel 进行一些基本计算，然后使用定制工具或 web 应用程序(或者更糟，给数据科学组的人发电子表格！)，然后将这些结果放回 Excel 中——不管您认为您的定制工具有多好，他们都会想这么做；)</em></p><p id="eb95" class="pw-post-body-paragraph kf kg it kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc im bi translated">您可以从 pytorch 文件夹中的 GitHub repo<a class="ae ld" href="https://github.com/pyxll/pyxll-examples" rel="noopener ugc nofollow" target="_blank">https://github.com/pyxll/pyxll-examples</a>下载代码和示例工作簿。你还需要 PyXLL，你可以从<a class="ae ld" href="https://www.pyxll.com/download.html?utm_source=medium" rel="noopener ugc nofollow" target="_blank">https://www.pyxll.com/download.html</a>下载，免费试用 30 天。</p></div></div>    
</body>
</html>