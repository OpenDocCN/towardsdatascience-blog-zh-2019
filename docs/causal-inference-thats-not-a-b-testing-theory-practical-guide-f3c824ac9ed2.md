# é A/B æµ‹è¯•çš„å› æœæ¨ç†:ç†è®ºä¸å®è·µæŒ‡å—

> åŸæ–‡ï¼š<https://towardsdatascience.com/causal-inference-thats-not-a-b-testing-theory-practical-guide-f3c824ac9ed2?source=collection_archive---------14----------------------->

![](img/c9059383a4bef0d6e24109aaed24a6e6.png)

[https://conversionsciences.com/conversion-optimization-blog/](https://conversionsciences.com/conversion-optimization-blog/)

æ¯«æ— ç–‘é—®ï¼Œéšæœºå®éªŒ(å‡è®¾æ­£ç¡®è¿›è¡Œ)æ˜¯å»ºç«‹å› æœå…³ç³»çš„æœ€ç›´æ¥çš„æ–¹æ³•(å‚è€ƒæˆ‘ä¹‹å‰çš„ä¸€ç¯‡å…³äº A/B æµ‹è¯•å­¦ä¹ èµ„æºçš„æ–‡ç« ï¼).ç„¶è€Œï¼Œå®é™…ä¸Šï¼Œæœ‰äº›æƒ…å†µä¸‹å®éªŒå¹¶ä¸æ˜¯ä¸€ä¸ªå¯è¡Œçš„é€‰æ‹©:

*   æ‚¨æ­£åœ¨å¤„ç†æ²¡æœ‰æ§åˆ¶æˆ–æµ‹è¯•ç»„åˆ†é…çš„å›é¡¾æ€§å¹²é¢„æ•°æ®ï¼Œè¿™å¯èƒ½æ˜¯ç”±äºå®éªŒçš„é«˜æˆæœ¬
*   å¹²é¢„æ˜¯ä¸€ä¸ªè¶³å¤Ÿå¤§çš„å˜åŒ–ï¼Œä½ ä¸èƒ½åªå‘ä¸€åŠçš„ç›®æ ‡å—ä¼—å±•ç¤º(ä¾‹å¦‚ï¼Œä¸»è¦äº§å“å‘å¸ƒã€UI æ”¹è¿›ç­‰ã€‚)
*   æ²»ç–—æ˜¯è§‚å¯Ÿè€Œä¸æ˜¯åˆ†é…çš„(ä¾‹å¦‚å¸çƒŸè€…å’Œéå¸çƒŸè€…ä¹‹é—´çš„æ¯”è¾ƒï¼Œç¤¾äº¤åª’ä½“å¹³å°ä¸Šçš„æ´»åŠ¨æ°´å¹³)ï¼Œä¹Ÿç§°ä¸º**é€‰æ‹©åå·®**
*   è¿˜æœ‰æ›´å¤šâ€¦

ä¸Šè¿°æ¡ˆä¾‹ç»å¸¸è¢«ç§°ä¸º [**è§‚å¯Ÿæ€§ç ”ç©¶**](https://en.wikipedia.org/wiki/Observational_study) ï¼Œå…¶ä¸­è‡ªå˜é‡ä¸åœ¨ç ”ç©¶äººå‘˜çš„æ§åˆ¶ä¹‹ä¸‹ã€‚è§‚å¯Ÿæ€§ç ”ç©¶æ­ç¤ºäº†è¡¡é‡å› æœæ•ˆåº”çš„ä¸€ä¸ªåŸºæœ¬é—®é¢˜â€”â€”ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬åœ¨æ²»ç–—ç»„å’Œéæ²»ç–—ç»„ä¹‹é—´è§‚å¯Ÿåˆ°çš„ä»»ä½•å˜åŒ–éƒ½æ˜¯**åäº‹å®**ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬ä¸çŸ¥é“å¦‚æœæ²»ç–—ç»„çš„äººæ²¡æœ‰æ¥å—æ²»ç–—ï¼Œä»–ä»¬ä¼šå‘ç”Ÿä»€ä¹ˆã€‚

ä»ä¼—æ‰€å‘¨çŸ¥çš„ç»Ÿè®¡ä¹¦ç±ã€ç ”ç©¶è®ºæ–‡å’Œè¯¾ç¨‹è®²ä¹‰ä¸­æå–ç†è®ºï¼Œæœ¬æ–‡ä»‹ç»äº†åœ¨éå®éªŒæ•°æ®å­˜åœ¨çš„æƒ…å†µä¸‹**åšå‡ºåäº‹å®æ¨ç†çš„ 5 ç§ä¸åŒæ–¹æ³•**ã€‚è¿˜åŒ…æ‹¬ç®€å•çš„ä»£ç ç¤ºä¾‹å’ŒæŠ€æœ¯è¡Œä¸šä¸­çš„åº”ç”¨ï¼Œä»¥ä¾¿æ‚¨å¯ä»¥çœ‹åˆ°ç†è®ºæ˜¯å¦‚ä½•ä»˜è¯¸å®è·µçš„ã€‚

*ç‰¹åˆ«æ„Ÿè°¢****iris&Joe****çš„çµæ„Ÿå’ŒçŸ¥è¯†åˆ†äº«ï¼Œå¹¶æ„Ÿè°¢****matt****çš„ç‚¹è¯„ã€‚* [*å…³æ³¨æˆ‘åœ¨ Medium.com çš„*](https://medium.com/@eva.gong) *å®šæœŸå‘è¡¨å…³äºç§‘æŠ€&å•†ä¸šç›¸å…³è¯é¢˜çš„åšå®¢ï¼ğŸ“š*ğŸ˜Šâ¤ï¸

## æ–¹æ³• 1:ä½¿ç”¨æ··æ‚å˜é‡çš„ OLS

**æ‚¨ä»æ•´ä¸ªç”¨æˆ·ç¾¤ä¸­æ”¶é›†æ•°æ®ï¼Œå¹¶å¸Œæœ›å›å½’æ–°åŠŸèƒ½ç‚¹å‡»æ¬¡æ•°çš„å‚ä¸æŒ‡æ•°ã€‚è¿™æ˜¯ä¸€ä¸ªåˆç†çš„æ–¹æ³•å—ï¼Ÿ**

***ç†è®º:*** æœ€æœ‰å¯èƒ½çš„ç­”æ¡ˆæ˜¯å¦å®šçš„ã€‚åœ¨ä¸Šé¢çš„æ¡ˆä¾‹ä¸­ï¼Œæˆ‘ä»¬è¯•å›¾è¡¡é‡æ–°åŠŸèƒ½çš„ä½¿ç”¨å¯¹ç”¨æˆ·æ•´ä½“å‚ä¸åº¦çš„å½±å“(ä¸‹å›¾ I ä¸­å·¦ä¾§çš„å› æœå›¾)ã€‚

![](img/a594c3949767596565c315bde2376936.png)

Plot 1: Causal Graphs with Confounding Variables

ç„¶è€Œï¼Œæœ‰å¯èƒ½ [**æ··æ·†å˜é‡**](https://en.wikipedia.org/wiki/Confounding) è¢«ä»æ¨¡å‹ä¸­çœç•¥ï¼Œå¹¶ä¸”å¯¹è‡ªå˜é‡å’Œå› å˜é‡éƒ½æœ‰å½±å“ã€‚è¿™ç§æ··æ·†å˜é‡å¯ä»¥åŒ…æ‹¬ç”¨æˆ·çš„ç‰¹å¾(ä¾‹å¦‚ï¼Œå¹´é¾„ã€åœ°åŒºã€è¡Œä¸šç­‰ã€‚).å¾ˆæœ‰å¯èƒ½ï¼Œè¿™äº›ç”¨æˆ·ç‰¹å¾å†³å®šäº†ç”¨æˆ·ä½¿ç”¨æ–°ç‰¹æ€§çš„é¢‘ç‡ï¼Œä»¥åŠä»–ä»¬åœ¨å‘å¸ƒåçš„å‚ä¸ç¨‹åº¦(è§ä¸Šé¢å›¾ 1 ä¸­çš„å³å› æœå›¾)ã€‚è¿™äº›æ··æ·†çš„å˜é‡éœ€è¦åœ¨æ¨¡å‹ä¸­åŠ ä»¥æ§åˆ¶ã€‚

***ç¤ºä¾‹ä»£ç :*** å‡è®¾ä½ æœ‰ 10k MAUâ€¦

```
## Parameter setup
total_num_user = 10000
pre_engagement_level = rnorm(total_num_user)
new_feature_usage = .6 * pre_engagement_level + rnorm(total_num_user)
post_engagement_level = .4 * pre_engagement_level + .5 * new_feature_usage + rnorm(total_num_user)## Model without the confounder
summary(lm(post_engagement_level~new_feature_usage))## Model with the confounder
summary(lm(post_engagement_level~new_feature_usage+pre_engagement_level))
```

ç”±äºæ··æ‚å› ç´ å¯¹è‡ªå˜é‡å’Œå› å˜é‡çš„ç§¯æå½±å“ï¼Œç¬¬ä¸€æ¬¡å›å½’ä¼šå¯¼è‡´ç³»æ•°ä¼°è®¡å€¼çš„å‘ä¸Šåå·®ã€‚

***å½“è¿™ç§æ–¹æ³•ä¸èµ·ä½œç”¨æ—¶:*** ç°åœ¨ä½ å¯èƒ½æƒ³çŸ¥é“ï¼Œæ§åˆ¶æ··æ‚å› ç´ æ€»æ˜¯æœ‰æ•ˆå—ï¼Ÿä¸ã€‚å®ƒä»…åœ¨æ»¡è¶³ä»¥ä¸‹å‡è®¾æ—¶æœ‰æ•ˆ[1]:

*   a)æ²»ç–—ç»„å’Œéæ²»ç–—ç»„æ˜¯å¯æ¯”çš„(æ„å‘³ç€æ²¡æœ‰ä¸å¹³è¡¡æˆ–æ²¡æœ‰å®Œå…¨é‡å )
*   b)è§‚å¯Ÿæ‰€æœ‰èƒ½åŒæ—¶å½±å“å› å˜é‡å’Œæ²»ç–—å˜é‡çš„å˜é‡

å½“è¿™äº›å‡è®¾ä¸æˆç«‹æ—¶ï¼Œæˆ‘ä»¬å°†ç»§ç»­è®¨è®ºå…¶ä»–æ–¹æ³•ã€‚

## æ–¹æ³• 2:åŒ¹é…/å€¾å‘åˆ†æ•°åŒ¹é…

***ç†è®º:*** å½“æ²»ç–—ç»„å’Œéæ²»ç–—ç»„ä¸å¯æ¯”æ—¶ï¼Œå³å½“æ··æ‚åå˜é‡çš„åˆ†å¸ƒæˆ–èŒƒå›´åœ¨å¯¹ç…§ç»„å’Œæ²»ç–—ç»„ä¹‹é—´å˜åŒ–æ—¶ï¼Œç³»æ•°ä¼°è®¡å€¼æœ‰åå·®[1]ã€‚**åŒ¹é…**æŠ€æœ¯é€šè¿‡è¯†åˆ«æ²»ç–—ç»„å’Œéæ²»ç–—ç»„ä¸­ç›¸äº’æ¥è¿‘çš„æˆå¯¹æ•°æ®ç‚¹æ¥ç¡®ä¿å¹³è¡¡åˆ†å¸ƒï¼Œæ··æ‚åå˜é‡å®šä¹‰äº†æˆå¯¹æ•°æ®ç‚¹ä¹‹é—´çš„è·ç¦»ã€‚è¿™äº›æŠ€æœ¯è¾“å‡ºè¾ƒå°çš„æ•°æ®é›†ï¼Œå…¶ä¸­æ¯ä¸ªæ²»ç–—è§‚å¯Ÿä¸æœ€æ¥è¿‘å®ƒçš„ä¸€ä¸ª(æˆ–å¤šä¸ª)éæ²»ç–—è§‚å¯Ÿç›¸åŒ¹é…ã€‚

![](img/9e47c0bd1aa99781c68b2f2e14803cba.png)

Plot 2: Raw vs. Matched Control and Treatment Groups Using PSM

å¯¹äºå…·æœ‰å¤§é‡é¢„å¤„ç†å˜é‡çš„æ¨¡å‹ï¼ŒåŒ¹é…è¿‡ç¨‹å¯èƒ½æ˜¯æ˜‚è´µçš„ã€‚**å€¾å‘å¾—åˆ†åŒ¹é…(PSM)** é€šè¿‡è®¡ç®—æ¯ä¸ªè§‚å¯Ÿå€¼çš„å•ä¸ªå¾—åˆ†æ¥ç®€åŒ–é—®é¢˜ï¼Œç„¶åè¯¥å¾—åˆ†å¯ç”¨äºè¯†åˆ«åŒ¹é…å¯¹(å‚è§å·¦è¾¹çš„ç¤ºä¾‹ï¼Œä½¿ç”¨ä¸‹é¢çš„ç¤ºä¾‹ä»£ç ç”Ÿæˆ)ã€‚

å€¾å‘å¾—åˆ†é€šå¸¸ä½¿ç”¨æ ‡å‡†æ¨¡å‹(å¦‚é€»è¾‘å›å½’)è¿›è¡Œä¼°è®¡ï¼Œå…¶ä¸­æ²»ç–—å˜é‡ä¸ºå› å˜é‡***ã€Tã€‘***ï¼Œæ··æ‚åå˜é‡***ã€Xã€‘***ä¸ºè‡ªå˜é‡ã€‚å› æ­¤ï¼Œå®ƒä¼°è®¡äº†ä¸€ä¸ªäººæ¥å—æ²»ç–—çš„æ¦‚ç‡ï¼Œä»¥æ··æ‚åå˜é‡ä¸ºæ¡ä»¶ã€‚

![](img/ade5abb4f7dcdfe51b96049c58f2bb98.png)

Formula 1: PSM with Logistic Regression

***è¡Œä¸šåº”ç”¨:*** ä½œä¸º A/B æµ‹è¯•çš„æ›¿ä»£æ–¹æ³•ï¼Œè¿™ç§æ–¹æ³•ä¹Ÿè¢«ç§‘æŠ€å…¬å¸çš„ç ”ç©¶äººå‘˜æ‰€åº”ç”¨ã€‚ä¾‹å¦‚ï¼Œ [LinkedIn åœ¨ 2016 å¹´å‘è¡¨äº†ä¸€ç¯‡è®ºæ–‡](https://dl.acm.org/citation.cfm?id=2939703)ï¼Œåˆ†äº«äº†åœ¨å…¶ç§»åŠ¨åº”ç”¨é‡‡ç”¨åˆ†æä¸­ä½¿ç”¨çš„å‡†å®éªŒæ–¹æ³•ã€‚ç§»åŠ¨åº”ç”¨ç¨‹åº UI çš„å½»åº•æ”¹é€ ä»¥åŠåŸºç¡€è®¾æ–½çš„æŒ‘æˆ˜ä½¿å¾— A/B æµ‹è¯•ä¸å¯è¡Œã€‚åœ¨å†å²å‘å¸ƒæ•°æ®çš„å¸®åŠ©ä¸‹ï¼Œä»–ä»¬è¯æ˜äº†å€¾å‘è¯„åˆ†æŠ€æœ¯å¦‚ä½•å‡å°‘é‡‡ç”¨åå·®ï¼Œå¹¶å¯ç”¨äºè¡¡é‡ä¸»è¦äº§å“å‘å¸ƒçš„å½±å“[2]ã€‚

***ç¤ºä¾‹ä»£ç :*** R çš„ [Matchit åŒ…](https://cran.r-project.org/web/packages/MatchIt/MatchIt.pdf)æä¾›äº†ä½¿ç”¨ä¸åŒçš„è·ç¦»å®šä¹‰ã€åŒ¹é…æŠ€æœ¯ç­‰é€‰æ‹©åŒ¹é…å¯¹çš„å¤šç§æ–¹å¼ã€‚ï¼Œæˆ‘ä»¬å°†åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­è¯´æ˜å®ƒã€‚åœ¨ä¸‹é¢çš„ä»£ç ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† 2015 å¹´ [BRFSS è°ƒæŸ¥](https://www.cdc.gov/brfss/index.html)æ•°æ®çš„æ ·æœ¬ï¼Œå¯é€šè¿‡å¼—å‰å°¼äºšå¤§å­¦å›¾ä¹¦é¦†è®¿é—®ã€‚è¯¥æ ·æœ¬æœ‰ 5000 ä¸ªè®°å½•å’Œ 7 ä¸ªå˜é‡ï¼Œåœ¨æ§åˆ¶äº†ç§æ—ã€å¹´é¾„ã€æ€§åˆ«ã€ä½“é‡å’Œå¹³å‡é¥®é…’ä¹ æƒ¯åå˜é‡åï¼Œæˆ‘ä»¬æœ‰å…´è¶£äº†è§£å¸çƒŸå¯¹æ…¢æ€§é˜»å¡æ€§è‚ºç—…(CODP)çš„å½±å“ã€‚

```
## Read in data and identify matched pairs
library(MatchIt)
sample = read.csv("[http://static.lib.virginia.edu/statlab/materials/data/brfss_2015_sample.csv](http://static.lib.virginia.edu/statlab/materials/data/brfss_2015_sample.csv)")
match_result = matchit(SMOKE ~ RACE + AGE + SEX + WTLBS + AVEDRNK2, 
                       data = sample,
                       method = "nearest",
                       distancce = "logit")
par(family = "sans")
plot(match_result,  type = "hist", col = "#0099cc",lty="blank")
sample_match = match.data(match_result)## Models with imbalanced and balanced data distribution
sample$SMOKE = factor(sample$SMOKE, labels = c("No", "Yes"))
sample_match$SMOKE = factor(sample_match$SMOKE, labels = c("No", "Yes"))
mod_matching1 = glm(COPD ~ SMOKE + AGE + RACE + SEX + WTLBS + AVEDRNK2, data = sample, family = "binomial")
mod_matching2 = glm(COPD ~ SMOKE + AGE + RACE + SEX + WTLBS + AVEDRNK2, data = sample_match, family = "binomial")
summary(mod_matching1)
summary(mod_matching2)
```

## æ–¹æ³• 3:å·¥å…·å˜é‡

***ç†è®º*** *:* å½“å‡è®¾ b)ä¸æ»¡è¶³ï¼Œå³å­˜åœ¨æ— æ³•è§‚æµ‹åˆ°çš„æ··æ‚å˜é‡æ—¶ï¼Œä½¿ç”¨**å·¥å…·å˜é‡(IV)** å¯ä»¥å‡å°‘é—æ¼å˜é‡åå€šã€‚å¦‚æœ:1) Z ä¸ X ç›¸å…³ï¼Œåˆ™å˜é‡ Z æœ‰èµ„æ ¼ä½œä¸ºå·¥å…·å˜é‡ï¼›2) Z ä¸ä¸ä»»ä½•å¯¹ Y æœ‰å½±å“çš„åå˜é‡(åŒ…æ‹¬è¯¯å·®é¡¹)ç›¸å…³[3]ã€‚è¿™äº›æ¡ä»¶æ„å‘³ç€ Z ä»…é€šè¿‡å…¶å¯¹ x çš„å½±å“æ¥å½±å“ Yã€‚å› æ­¤ï¼ŒZ å¼•èµ·çš„ Y çš„å˜åŒ–ä¸ä¼šæ··æ·†ï¼Œå¹¶å¯ç”¨äºä¼°è®¡æ²»ç–—æ•ˆæœã€‚

ä¾‹å¦‚ï¼Œä¸ºäº†ç ”ç©¶å­¦æ ¡æ•™è‚²(å¦‚å—æ•™è‚²å¹´é™)å¯¹æ”¶å…¥çš„å½±å“ï¼Œâ€œèƒ½åŠ›â€æ˜¯ä¸€ä¸ªé‡è¦ä½†éš¾ä»¥è¡¡é‡çš„å˜é‡ï¼Œå®ƒå¯¹å­¦ç”Ÿåœ¨å­¦æ ¡çš„è¡¨ç°ä»¥åŠæ¯•ä¸šåçš„æ”¶å…¥éƒ½æœ‰å½±å“ã€‚ç ”ç©¶äººå‘˜ç ”ç©¶çš„ä¸€ä¸ªå·¥å…·å˜é‡æ˜¯å‡ºç”Ÿæœˆä»½ï¼Œå®ƒå†³å®šå…¥å­¦å¹´ä»½ï¼Œä»è€Œå†³å®šå—æ•™è‚²å¹´é™ï¼Œä½†åŒæ—¶å¯¹æ”¶å…¥æ²¡æœ‰å½±å“(å¦‚å›¾ 3 æ‰€ç¤º)ã€‚

![](img/62d224efd49a93814fc01a98b9213758.png)

Plot 3: Using â€œBirth Monthâ€ as an Instrumental Variable

åœ¨å®è·µä¸­ï¼Œé€šå¸¸ä½¿ç”¨**ä¸¤é˜¶æ®µæœ€å°äºŒä¹˜æ³•**æ¥ä¼°è®¡ IVã€‚åœ¨ç¬¬ä¸€é˜¶æ®µï¼ŒIV ç”¨äºåœ¨ X ä¸Šå›å½’ä»¥æµ‹é‡ X ä¹‹é—´çš„åæ–¹å·®& IVã€‚åœ¨ç¬¬äºŒé˜¶æ®µï¼Œæ¥è‡ªç¬¬ä¸€é˜¶æ®µçš„é¢„æµ‹ X å’Œå…¶ä»–åå˜é‡ä¸€èµ·ç”¨äºå›å½’ Yï¼Œä»è€Œé›†ä¸­äºç”± IV å¼•èµ·çš„ Y çš„å˜åŒ–ã€‚

è¿™ç§æ–¹æ³•æœ€å¤§çš„æŒ‘æˆ˜æ˜¯å·¥å…·å˜é‡å¾ˆéš¾æ‰¾åˆ°ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œç‹¬ç«‹å˜é‡æ›´å¹¿æ³›åœ°åº”ç”¨äºè®¡é‡ç»æµå­¦å’Œç¤¾ä¼šç§‘å­¦ç ”ç©¶ã€‚å› æ­¤ï¼Œè¿™é‡Œçœç•¥äº†è¡Œä¸šåº”ç”¨å’Œä»£ç ç¤ºä¾‹ã€‚

## **æ–¹æ³• 4:å·®å¼‚ä¸­çš„å·®å¼‚**

***ç†è®º:*** å½“ IVs æ²¡æœ‰å¥½çš„å€™é€‰è€…æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§æ›¿ä»£çš„æ–¹å¼æ¥è¯´æ˜æœªè§‚æµ‹çš„åå˜é‡ã€‚**å·®å¼‚ä¸­çš„å·®å¼‚(DiD)** æ–¹æ³•é€šè¿‡æ¯”è¾ƒå¯¹ç…§ç»„&æ²»ç–—ç»„çš„æ²»ç–—åå·®å¼‚ä¸æ²»ç–—å‰å·®å¼‚è¿›è¡Œå·¥ä½œï¼Œå‡è®¾å¦‚æœæ²¡æœ‰å¹²é¢„ï¼Œä¸¤ç»„çš„å› å˜é‡å°†éµå¾ªç›¸ä¼¼çš„è¶‹åŠ¿ã€‚ä¸è¯•å›¾è¯†åˆ«å½¼æ­¤ç›¸ä¼¼çš„æ•°æ®ç‚¹å¯¹çš„åŒ¹é…/PSM ä¸åŒï¼ŒDiD ä¼°è®¡å™¨è€ƒè™‘äº†ä¸¤ç»„ä¹‹é—´çš„ä»»ä½•åˆå§‹å¼‚è´¨æ€§ã€‚

![](img/24cb7db1802bae472e5a1770c07fd16f.png)

Source: What is difference-in-differences ([https://stats.stackexchange.com/questions/564/what-is-difference-in-differences](https://stats.stackexchange.com/questions/564/what-is-difference-in-differences))

DiD æ–¹æ³•çš„**å…³é”®** **å‡è®¾**æ˜¯å¯¹ç…§ç»„&æ²»ç–—ç»„çš„å› å˜é‡éµå¾ªç›¸åŒçš„è¶‹åŠ¿**å¹³è¡Œä¸–ç•Œ**å‡è®¾ **)** ã€‚è¿™å¹¶ä¸æ„å‘³ç€å®ƒä»¬éœ€è¦å…·æœ‰ç›¸åŒçš„å¹³å‡å€¼ï¼Œæˆ–è€…åœ¨é¢„å¤„ç†æœŸé—´æ ¹æœ¬æ²¡æœ‰è¶‹åŠ¿[4]ã€‚å‚è§å·¦ä¾§çš„ç¤ºä¾‹å›¾ï¼Œå…¶ä¸­æ§åˆ¶&è¯•éªŒç»„åœ¨é¢„å¤„ç†æœŸé—´å…·æœ‰ç›¸ä¼¼çš„è¶‹åŠ¿ã€‚å¦‚æœå‡è®¾æˆç«‹ï¼Œæ²»ç–—ç»„çš„æ²»ç–—åå·®å¼‚å¯ä»¥åˆ†è§£ä¸ºå¯¹ç…§ç»„ä¸­ç±»ä¼¼è§‚å¯Ÿåˆ°çš„å·®å¼‚å’Œæ²»ç–—æœ¬èº«å¼•èµ·çš„å·®å¼‚ã€‚DID é€šå¸¸è¢«å®ç°ä¸ºå›å½’æ¨¡å‹ä¸­æ—¶é—´å’Œæ²»ç–—ç»„è™šæ‹Ÿå˜é‡ä¹‹é—´çš„äº¤äº’é¡¹ã€‚

![](img/01d5f646afc6b400fd9d3b9e93c5ca66.png)

Formula 2: DiD in a Regression Model

æœ‰å‡ ç§ä¸åŒçš„æ–¹æ³•æ¥éªŒè¯å¹³è¡Œä¸–ç•Œçš„å‡è®¾ã€‚æœ€ç®€å•çš„æ–¹æ³•æ˜¯è¿›è¡Œç›®è§†æ£€æŸ¥ã€‚æˆ–è€…ï¼Œæ‚¨å¯ä»¥è®©æ²»ç–—å˜é‡ä¸æ—¶é—´è™šæ‹Ÿå˜é‡ç›¸äº’ä½œç”¨ï¼Œä»¥æŸ¥çœ‹ä¸¤ç»„ä¹‹é—´çš„å·®å¼‚åœ¨æ²»ç–—å‰æœŸé—´æ˜¯å¦ä¸æ˜¾è‘—[5]ã€‚

***è¡Œä¸šåº”ç”¨:*** ç±»ä¼¼äºå€¾å‘å¾—åˆ†åŒ¹é…ï¼Œè¿™ç§æ–¹æ³•ä¸€ç›´å—åˆ°å¸Œæœ›åœ¨éå®éªŒæ€§è®¾ç½®ä¸­ç ”ç©¶ç”¨æˆ·è¡Œä¸ºçš„ç§‘æŠ€å…¬å¸çš„é’çã€‚ä¾‹å¦‚ï¼Œ[è„¸ä¹¦åœ¨ä»–ä»¬ 2016 å¹´çš„è®ºæ–‡](https://research.fb.com/publications/changes-in-engagement-before-and-after-posting-to-facebook/)ä¸­åº”ç”¨ DiD æ–¹æ³•æ¥ç ”ç©¶è´¡çŒ®è€…çš„æ•¬ä¸šåº¦åœ¨è¢«æ´¾å¾€è„¸ä¹¦å‰åæ˜¯å¦‚ä½•å˜åŒ–çš„ã€‚ä»–ä»¬å‘ç°ï¼Œåœ¨å‘å¸ƒå†…å®¹åï¼Œäººä»¬â€œæ›´æœ‰å†…åœ¨åŠ¨åŠ›æ›´é¢‘ç¹åœ°è®¿é—®ç½‘ç«™â€¦â€¦â€[6]ã€‚è¿™æ˜¯å¦ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ï¼Œå‘å¸–ä¸å¦çš„è¡Œä¸ºä¸å—ç ”ç©¶è€…çš„æ§åˆ¶ï¼Œåªèƒ½é€šè¿‡å› æœæ¨ç†æŠ€æœ¯æ¥åˆ†æã€‚

***ç¤ºä¾‹ä»£ç :*** è¿™é‡Œæˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•ä½¿ç”¨ DiD æ¥ä¼°è®¡ 1993 å¹´ EITC(åŠ³åŠ¨æ‰€å¾—ç¨æ”¶æŠµå…)å¯¹è‡³å°‘æœ‰ä¸€ä¸ªå­©å­çš„å¦‡å¥³å°±ä¸šç‡çš„å½±å“ã€‚æ„Ÿè°¢[7]&ã€8ã€‘çš„åŸåˆ›åˆ†æï¼Œä¸‹é¢çš„ä»£ç åªæ˜¯ä¸€ä¸ªç®€å•çš„ç‰ˆæœ¬æ¥æ¼”ç¤ºæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼

```
## Read in data and create dummy variables
library(dplyr)
library(ggplot2)
data_file = '../did.dat'
if (!file.exists(data_file)) {
    download.file(url = '[https://drive.google.com/uc?authuser=0&id=0B0iAUHM7ljQ1cUZvRWxjUmpfVXM&export=download'](https://drive.google.com/uc?authuser=0&id=0B0iAUHM7ljQ1cUZvRWxjUmpfVXM&export=download'), destfile = data_file)}
df = haven::read_dta(data_file)
df = df %>%
    mutate(time_dummy = ifelse(year >= 1994, 1, 0), 
           if_treatment = ifelse(children >= 1, 1, 0))## Visualize the trend to validate the parallel world assumption
ggplot(df, aes(year, work, color = as.factor(if_treatment))) +
    stat_summary(geom = 'line') +
    geom_vline(xintercept = 1994)## Two ways to estimate the DiD effect: shift in means & regression
var1 = mean( (df %>% filter(time_dummy==0 & if_treatment==0 ))$work)
var2 = mean( (df %>% filter(time_dummy==0 & if_treatment==1 ))$work)
var3 = mean( (df %>% filter(time_dummy==1 & if_treatment==0 ))$work)
var4 = mean( (df %>% filter(time_dummy==1 & if_treatment==1 ))$work)
(var4 - var3) - (var2 - var1)mod_did1 = lm(work~time_dummy*if_treatment, data = df)
summary(mod_did1)
```

## æ–¹æ³• 5:è´å¶æ–¯æ¨¡å‹

å°½ç®¡ DiD æ˜¯ä¸€ç§æµè¡Œçš„å› æœæ¨ç†æ–¹æ³•ï¼Œä½†å®ƒæœ‰ä¸€äº›å±€é™æ€§:

*   a)å®ƒå‡è®¾å½±å“æ²¡æœ‰æ—¶é—´æ¼”å˜ï¼›ç›¸åï¼Œæˆ‘ä»¬åªæ˜¯åˆ†æå‰åçš„å˜åŒ–
*   b)å®ƒå‡è®¾è§‚å¯Ÿå€¼æ˜¯ç‹¬ç«‹ä¸”åŒåˆ†å¸ƒçš„ï¼Œå› æ­¤ä¸é€‚ç”¨äºåºåˆ—ç›¸å…³çš„æ•°æ®ç‚¹

æœ€è¿‘ä¸€ç³»åˆ—åŸºäºçŠ¶æ€ç©ºé—´æ¨¡å‹çš„ç ”ç©¶ï¼Œé€šè¿‡åˆ©ç”¨å®Œå…¨è´å¶æ–¯æ—¶é—´åºåˆ—å¯¹æ•ˆæœè¿›è¡Œä¼°è®¡ï¼Œå¹¶å¯¹æœ€ä½³ç»¼åˆæ§åˆ¶è¿›è¡Œæ¨¡å‹å¹³å‡ï¼Œæ¦‚æ‹¬äº†æ›´çµæ´»çš„ç”¨ä¾‹[9]ã€‚Google å‡ºç‰ˆç‰©[å’Œç›¸åº”çš„ R åŒ…â€œCausalImpactâ€å±•ç¤ºäº†è¿™ç§çŠ¶æ€ç©ºé—´æ¨¡å‹èƒŒåçš„ç†è®ºå’Œå®ç°ï¼Œå»ºè®®è¿›ä¸€æ­¥é˜…è¯»ã€‚](https://research.google/pubs/pub41854/)

 [## å› æœå½±å“

### è¿™ä¸ªåŒ…æ˜¯åšä»€ä¹ˆçš„ï¼Ÿè¿™ä¸ª R åŒ…å®ç°äº†ä¸€ç§æ–¹æ³•æ¥ä¼°è®¡å› æœæ•ˆåº”çš„è®¾è®¡â€¦

google.github.io](https://google.github.io/CausalImpact/CausalImpact.html) 

å‚è€ƒèµ„æ–™:

[1]å®‰å¾·é²Â·ç›–å°”æ›¼å’Œçå¦®å¼—Â·å¸Œå°”ã€‚[ä½¿ç”¨å›å½’å’Œå¤šçº§/åˆ†å±‚æ¨¡å‹çš„æ•°æ®åˆ†æ](http://www.stat.columbia.edu/~gelman/arm/chap10.pdf)(2007)

[2]ç”¨ A/B å’Œå‡† A/B æµ‹è¯•è¯„ä¼°ç§»åŠ¨ appã€‚[https://dl.acm.org/citation.cfm?id=2939703](https://dl.acm.org/citation.cfm?id=2939703)

[3]ç€å°”ï¼ŒJ. (2000 å¹´)ã€‚*å› æœå…³ç³»:æ¨¡å‹ã€æ¨ç†å’Œæ¨è®º*ã€‚çº½çº¦:å‰‘æ¡¥å¤§å­¦å‡ºç‰ˆç¤¾ã€‚

[4]è®²ç¨¿:å·®å¼‚ä¸­çš„å·®å¼‚ï¼Œå®è¯æ–¹æ³•[http://finance . Wharton . upenn . edu/~ Mr Robert/resources/Teaching/CorpFinPhD/Dif-In-Dif-slides . pdf](http://finance.wharton.upenn.edu/~mrrobert/resources/Teaching/CorpFinPhD/Dif-In-Dif-Slides.pdf)

[5][https://stats . stack exchange . com/questions/160359/difference-in-difference-method-how-to-test-of-assumption-of-common-trend-betw](https://stats.stackexchange.com/questions/160359/difference-in-difference-method-how-to-test-for-assumption-of-common-trend-betw)

[6]å‘å¸ƒåˆ°è„¸ä¹¦å‰åå‚ä¸åº¦çš„å˜åŒ–[https://research . FB . com/publications/Changes-in-Engagement-Before-and-After-Posting-Facebook/](https://research.fb.com/publications/changes-in-engagement-before-and-after-posting-to-facebook/)

[7][https://thetarzan . WordPress . com/2011/06/20/å·®å¼‚ä¼°ç®—ä¸­çš„å·®å¼‚-r-and-stata/](https://thetarzan.wordpress.com/2011/06/20/differences-in-differences-estimation-in-r-and-stata/)

[https://dhicks.github.io/2018-10-10-did/](https://dhicks.github.io/2018-10-10-did/)

[9]ä½¿ç”¨è´å¶æ–¯ç»“æ„æ—¶é—´åºåˆ—æ¨¡å‹æ¨æ–­å› æœå½±å“[https://research.google/pubs/pub41854/](https://research.google/pubs/pub41854/)