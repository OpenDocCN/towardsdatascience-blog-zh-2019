<html>
<head>
<title>Multi-label Land Cover Classification with Deep Learning</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于深度学习的多标签土地覆盖分类</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/multi-label-land-cover-classification-with-deep-learning-d39ce2944a3d?source=collection_archive---------15-----------------------#2019-11-26">https://towardsdatascience.com/multi-label-land-cover-classification-with-deep-learning-d39ce2944a3d?source=collection_archive---------15-----------------------#2019-11-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="4fc7" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用深度神经网络进行多标签土地覆盖分类的分步指南</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/7f6caea68e6562cecb3a8f2ec6df0e07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RScKhJWtCNHxJiEFcFrH_A.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Multi-label Land Cover Classification — <a class="ae ky" href="https://semiautomaticclassificationmanual.readthedocs.io/en/latest/remote_sensing.html" rel="noopener ugc nofollow" target="_blank">Source</a></figcaption></figure><p id="499c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">与单标签分类相比，对多标签土地覆盖分类的探索较少。相比之下，多标签分类更现实，因为我们总是在每个图像中找到多个土地覆盖。然而，通过深度学习应用和卷积神经网络，我们可以解决多标签分类的挑战。</p><p id="70da" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本教程中，我们使用重新设计的多标签 UC Merced 数据集和 17 个土地覆盖类。加州大学 Merced 土地利用数据集最初是作为最早的计算机视觉卫星数据集之一推出的。UC Merced 数据集被认为是卫星图像数据集的 MNIST。原始数据集由 21 类单标签分类组成。</p><p id="c362" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在下一节中，我们将获取数据并研究数据集中的类和类不平衡。接下来，我们使用深度神经网络训练我们的模型，最后，我们使用外部图像测试我们的模型以进行推断。</p><h2 id="8bc2" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">获取数据</h2><p id="9886" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">我们可以从以下网址使用 WGET 软件包直接访问 Jupyter 笔记本/Google Colab 中的数据。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="dab3" class="lv lw it mu b gy my mz l na nb">!wget <a class="ae ky" href="https://www.dropbox.com/s/u83ae1efaah2w9o/UCMercedLanduse.zip" rel="noopener ugc nofollow" target="_blank">https://www.dropbox.com/s/u83ae1efaah2w9o/UCMercedLanduse.zip</a></span><span id="977c" class="lv lw it mu b gy nc mz l na nb">!unzip UCMercedLanduse.zip</span></pre><p id="1c5e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦我们获得数据并解压缩，我们就准备好探索它了。让我们从标签开始。我们阅读熊猫的标签。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="e25c" class="lv lw it mu b gy my mz l na nb">df = pd.read_csv(“UCMerced/multilabels.txt”, sep=”\t”)</span><span id="776f" class="lv lw it mu b gy nc mz l na nb">df.head()</span></pre><p id="5c9b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这是前五行的标签。正如您所看到的，数据是一个热编码格式。每个图像有 17 个标签，其中“0”表示该标签在特定图像中不存在，而“1”表示该标签在图像中存在。我们总共有 2100 张图片。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nd"><img src="../Images/8c19c7890030cfff5cb4b9391439918e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JdO5kyYvKy-_WJgHb8nOrA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">UC Merced Multi-labels DataFrame</figcaption></figure><p id="0f8f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们继续使用神经网络和深度学习对任务进行分类之前，我们可以看看数据集中类的分布。检查数据集的分布是检查数据集中数据不平衡的重要步骤。我们首先创建一个新的数据框来存储类及其计数。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="3fd1" class="lv lw it mu b gy my mz l na nb"># Create Class count dataframe<br/>class_count = pd.DataFrame(df.sum(axis=0)).reset_index()<br/>class_count.columns = [“class”, “Count”]<br/>class_count.drop(class_count.index[0], inplace=True)</span><span id="b4a4" class="lv lw it mu b gy nc mz l na nb"># Visualize class distribution as Barchartfig, ax= plt.subplots(figsize=(12,10))<br/>sns.barplot(y="class", x="Count",  data=class_count, ax=ax);</span></pre><p id="8f19" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下可视化显示了数据集中的类别不平衡。我们有超过 1200 个图像的路面类，而飞机类有 100 个图像。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ne"><img src="../Images/0c65816f7a27cf9cfa2c188cc070a4b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EgIdef58vXz8yy_0mNrlcw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Class Distribution — UC Merced Multi-label dataset</figcaption></figure><p id="b283" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在下一节中，我们开始用 Fastai 库训练数据集。Fastai 是一个用户友好的库，构建在 Pytorch 之上，提供了许多易于使用的功能。</p><h2 id="977f" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">培养</h2><p id="e1f2" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">我们需要为训练准备数据。我们的数据标签是一个热点编码格式，我认为这将是一个挑战。幸运的是，浏览了一下 Fastai 论坛，我发现 Fastai 中有一个本机函数，可以使用一键编码格式处理多标签。当我们给数据集加标签时，我们需要传递列名，还需要指明数据是多类别数据集。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="c070" class="lv lw it mu b gy my mz l na nb">path = Path(“UCMerced”)</span><span id="db34" class="lv lw it mu b gy nc mz l na nb">data_src = (ImageList.from_df(df=df, path=path, folder=’images’,    suffix=”.tif”)<br/>      .split_by_rand_pct(0.2)<br/>      .label_from_df(cols=list(class_count[‘class’]),  label_cls=MultiCategoryList, one_hot=True))</span></pre><p id="b395" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦我们创建了数据源，我们就可以通过 Fastai 中的 data bunch API 来传递它。我们还执行一些数据扩充。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="f8c4" class="lv lw it mu b gy my mz l na nb">tfms = get_transforms(flip_vert=True, max_lighting=0.1, max_zoom=1.05, max_warp=0.)</span><span id="6d10" class="lv lw it mu b gy nc mz l na nb">data = (data_src.transform(tfms, size=256).databunch().normalize(imagenet_stats))</span><span id="7e01" class="lv lw it mu b gy nc mz l na nb">data.show_batch(4)</span></pre><p id="3180" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里有一些随机图像，它们的标签用 Fastai 可视化。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nf"><img src="../Images/099102cd02ffe2b8fb45b59a8f9a6a2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TOrOWCInH3S_07cS7nbMXA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Random images and labels — UC Merced dataset</figcaption></figure><p id="d7ce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们创建一个学习器，在那里我们传递我们创建的数据串、模型的选择(在本例中，我们使用 resnet34)和指标(accuracy_thresh 和 F Score)。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="b01a" class="lv lw it mu b gy my mz l na nb">f_score = partial(fbeta, thresh=0.45)</span><span id="c780" class="lv lw it mu b gy nc mz l na nb">learn = cnn_learner(data, models.resnet34, metrics=[accuracy_thresh, f_score], callback_fns=[CSVLogger,ShowGraph, SaveModelCallback])</span></pre><p id="fcf5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们也可以通过 Fastai 中的 lr_find 作图，得到适合训练数据集的学习率。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="0d24" class="lv lw it mu b gy my mz l na nb">learn.lr_find()</span><span id="03df" class="lv lw it mu b gy nc mz l na nb">learn.recorder.plot()</span></pre><p id="4885" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们可以开始用数据训练我们的模型。我们使用 fit_one_cycle 函数，这是一个强大的函数，使用一个循环技术结合了最先进的技术。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="1f83" class="lv lw it mu b gy my mz l na nb">learn.fit_one_cycle(5, 1e-2)</span></pre><p id="f8cb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦训练开始，Fastai 就显示与每个时期的训练和验证损失和时间一起提供的度量</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/1c7fb5410b2fb05ee884bd52590ba56d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1176/format:webp/1*SGACs9VE6pEm4VVC84kf8Q.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Training</figcaption></figure><p id="a610" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们的最终历元记录了 95.53 的准确度阈值和 90.84 的 F 分数，这对于仅仅五个历元来说是相当准确的。我们可以进一步训练，提高我们的指标。为此，我们可以冻结一些层，并从头开始训练其他层。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="4932" class="lv lw it mu b gy my mz l na nb">learn.freeze()<br/>lr = 1e-3</span><span id="f08d" class="lv lw it mu b gy nc mz l na nb">learn.fit_one_cycle(5, slice(lr))</span></pre><p id="062d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们最终的模型得分是 91.39 F 分，相比之前的训练有了一点点的提升。我们可以通过使用更多的纪元或增加深度神经网络的架构来进行更多的训练。你可以尝试一下，看看是否有助于改进模型。在下一节中，我们将使用外部图像作为模型的推论。</p><h2 id="0409" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">不同数据集的预测</h2><p id="f5b9" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">为了测试该模型，我们从外部来源预测几幅图像，并观察该模型的表现。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="064c" class="lv lw it mu b gy my mz l na nb">!wget <a class="ae ky" href="https://www.dropbox.com/s/6tt0t61uq2w1n3s/test.zip" rel="noopener ugc nofollow" target="_blank">https://www.dropbox.com/s/6tt0t61uq2w1n3s/test.zip</a></span><span id="4cf4" class="lv lw it mu b gy nc mz l na nb">!unzip test.zip</span><span id="cfff" class="lv lw it mu b gy nc mz l na nb">img = open_image(“/content/test/roundabout_086.jpg”)</span><span id="9590" class="lv lw it mu b gy nc mz l na nb">img</span></pre><p id="5534" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">测试数据集中的第一幅图像如下所示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/0dd20cd3c63b93f1eeb9551186dbcd54.png" data-original-src="https://miro.medium.com/v2/resize:fit:512/format:webp/1*nATwLm6f7ImUdvUCDQX6WA.png"/></div></figure><p id="fcdb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们看看这个模型预测了什么:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="4bdd" class="lv lw it mu b gy my mz l na nb">MultiCategory bare-soil;buildings;cars;grass;pavement</span></pre><p id="160b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">嗯，这就是模型产生的结果，我认为从我们在训练数据集中使用的类来看，它是准确的。我们的预测已经预测了图像中存在的大多数类(至少从我的眼睛中可以看到)。</p><p id="fae7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们用另一个图像来测试。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/0720190b754e48bbb0d5fa4dec617ef0.png" data-original-src="https://miro.medium.com/v2/resize:fit:512/format:webp/1*XH3kbRMRryiknG59sP4FmA.png"/></div></figure><p id="c2df" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个模型预测</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="157e" class="lv lw it mu b gy my mz l na nb">MultiCategory airplane;cars;pavement</span></pre><p id="c51b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">飞机和人行道，是的，但是我没看见任何汽车。</p><h2 id="3ec5" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">结论</h2><p id="c245" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">在本教程中，我们使用深度神经网络训练了一个多标签类别分类模型。我们还用其他图像对模型进行了推论。</p><p id="16e8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本教程的代码和 Google Colab 笔记本可以在这个 Github 资源库中找到。</p><div class="ni nj gp gr nk nl"><a href="https://github.com/shakasom/multilabel-landcover-deeplearning" rel="noopener  ugc nofollow" target="_blank"><div class="nm ab fo"><div class="nn ab no cl cj np"><h2 class="bd iu gy z fp nq fr fs nr fu fw is bi translated">shaka som/多标签-土地覆盖-深度学习</h2><div class="ns l"><h3 class="bd b gy z fp nq fr fs nr fu fw dk translated">与单标签分类相比，对多标签土地覆盖分类的探索较少。相比之下…</h3></div><div class="nt l"><p class="bd b dl z fp nq fr fs nr fu fw dk translated">github.com</p></div></div><div class="nu l"><div class="nv l nw nx ny nu nz ks nl"/></div></div></a></div><p id="8303" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以通过这个链接直接访问 Google Colab 笔记本</p><div class="ni nj gp gr nk nl"><a href="https://github.com/shakasom/multilabel-landcover-deeplearning/blob/master/Multi_label_Land_Cover_Classification.ipynb" rel="noopener  ugc nofollow" target="_blank"><div class="nm ab fo"><div class="nn ab no cl cj np"><h2 class="bd iu gy z fp nq fr fs nr fu fw is bi translated">shaka som/多标签-土地覆盖-深度学习</h2><div class="ns l"><h3 class="bd b gy z fp nq fr fs nr fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="nt l"><p class="bd b dl z fp nq fr fs nr fu fw dk translated">github.com</p></div></div><div class="nu l"><div class="oa l nw nx ny nu nz ks nl"/></div></div></a></div></div></div>    
</body>
</html>