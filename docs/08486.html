<html>
<head>
<title>Hosting your ML model on Azure Functions — Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在 Azure 函数上托管您的 ML 模型—第 1 部分</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/hosting-your-ml-model-on-azure-functions-ae3ca4ae1232?source=collection_archive---------13-----------------------#2019-11-17">https://towardsdatascience.com/hosting-your-ml-model-on-azure-functions-ae3ca4ae1232?source=collection_archive---------13-----------------------#2019-11-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="33aa" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsdatascience.com/tagged/modeldeployment" rel="noopener" target="_blank">我关于模型部署的其他帖子</a></h2><div class=""/><div class=""><h2 id="af68" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">终于有了一种便宜又简单的方法来部署您的模型</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/2f502d534f05c9630ac3cfb2de408d25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uT5S7jhIHnacYOVIWsET6w.png"/></div></div></figure><p id="cfb5" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">这是几个星期的功能工程，模型选择和超参数调整，你完成了。</p><p id="8ae0" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">你的同事对你不断使用“泡菜”这个词感到困惑，他们不再问你在做什么，只是假设你真的喜欢保存蔬菜。</p><p id="b920" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">现在让我们把这个模型放在一个你可以从中获得一些价值的地方。</p><p id="b23d" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated"><strong class="lf jd">如果你想通过 AWS lambdas 部署你的模型，请点击标题上方的链接查看我的文章。</strong></p><p id="3bdd" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated"><a class="ae lz" href="https://github.com/evanmiller29/azure_ml_function" rel="noopener ugc nofollow" target="_blank"> <strong class="lf jd">如果你想跟进</strong> </a>，这里是我的 Git 回购的链接</p><h1 id="6fa7" class="ma mb it bd mc md me mf mg mh mi mj mk ki ml kj mm kl mn km mo ko mp kp mq mr bi translated">Azure 函数 vs AWS Lambdas</h1><p id="0ba4" class="pw-post-body-paragraph ld le it lf b lg ms kd li lj mt kg ll lm mu lo lp lq mv ls lt lu mw lw lx ly im bi translated">这些与 AWS lambdas 非常相似，从模型部署选项来看，它们比 AWS lambdas 有更大的优势。</p><p id="59f2" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated"><strong class="lf jd">指定你的 Azure 函数运行时就像 pi </strong>一样简单</p><p id="8cf0" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">还记得让 AWS Lambdas 用熊猫有多痛苦吗？我当然知道。改变一个小东西(你的内部 ML 包或者想用一个新的花式 sklearn 模型)AWS lambdas 就开始了。</p><p id="022c" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">接下来你使用 Docker 重新创建图层，但愿你不会忘记更改图层版本..</p><p id="5714" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">使用 Azure Functions，你只需指定一个 requirements.txt，当你将 Azure Functions 部署到你的帐户时，它会为你安装所有这些包。</p><p id="ac95" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated"><em class="mx">它还允许你从本地直接上传模型到你的 Azure 函数。</em></p><p id="99f0" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">这真是太酷了。</p><p id="f0c0" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated"><strong class="lf jd">Azure CLI 允许你在本地调试你的 Azure 功能</strong></p><p id="4ed6" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">如果你遵循我的 AWS lambda 教程，你可能会花很多时间编写简单的测试来运行你的 AWS lambda，以确保你可以导入熊猫或一些非常小的东西。</p><p id="a98c" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">然后你可以测试通过 Python 中的请求包向 Azure 函数发送数据。但是现在您只需在本地运行它们，并通过请求包发送 POST 请求，您就可以在部署之前确保它正在工作</p><p id="9350" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated"><strong class="lf jd">创建 HTTP Azure 函数只需一个简单的步骤就可以部署和公开端点</strong></p><p id="d388" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">以前，当将模型部署到 AWS Lambdas 和 API Gateway 时，您必须分别执行这两个步骤。有了 Azure 函数，它们只是一个步骤。</p><p id="d558" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">除此之外，你的 Azure 函数是预先保护的(比如:有一个 API 密匙),所以当你在 API 网关端配置东西时，你不必担心关闭你的 AWS Lambda。</p><h1 id="cff7" class="ma mb it bd mc md me mf mg mh mi mj mk ki ml kj mm kl mn km mo ko mp kp mq mr bi translated">入门指南</h1><p id="6832" class="pw-post-body-paragraph ld le it lf b lg ms kd li lj mt kg ll lm mu lo lp lq mv ls lt lu mw lw lx ly im bi translated">现在我们进入有趣的部分。如果你想跟进<a class="ae lz" href="https://github.com/evanmiller29/azure_ml_function" rel="noopener ugc nofollow" target="_blank">，这里有</a>GitHub 回购。</p><p id="d6e9" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">首先你需要安装 Azure CLI 工具。这将允许您在本地测试您的 Azure 功能，然后将其推送到您的 Azure 帐户。</p><p id="9656" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">在这一点上，获得 Azure 帐户可能是值得的。如果你从未注册过，你可能会得到 200 美元的免费积分。但是，如果您不能，请不要担心，这些部署不会让您倾家荡产。</p><p id="d595" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">按照这个来安装 Azure CLI，这样我们就可以开始构建我们的功能了。</p><p id="5b7e" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">要测试这一点，您需要尝试:</p><pre class="ks kt ku kv gt my mz na nb aw nc bi"><span id="8b5b" class="nd mb it mz b gy ne nf l ng nh">func new</span></pre><p id="62ed" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">如果安装成功了，你就可以在本地创建一个 Azure 函数。但是在 Windows 上工作可能有点困难。</p><p id="741d" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated"><strong class="lf jd">让 Azure CLI 在 Windows 上运行</strong></p><p id="bbc5" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">如果你得到一个错误，说 func not found，你想安装做一些更多的步骤:</p><ul class=""><li id="5c38" class="ni nj it lf b lg lh lj lk lm nk lq nl lu nm ly nn no np nq bi translated">通过管理外壳安装<a class="ae lz" href="https://chocolatey.org/install" rel="noopener ugc nofollow" target="_blank">巧克力</a></li><li id="76e7" class="ni nj it lf b lg nr lj ns lm nt lq nu lu nv ly nn no np nq bi translated">使用<a class="ae lz" href="https://chocolatey.org/install" rel="noopener ugc nofollow" target="_blank"> chocolatey </a>安装 azure cli 工具<a class="ae lz" href="https://stackoverflow.com/questions/56526088/func-is-not-recognized-as-an-internal-or-external-command-operable-program-or" rel="noopener ugc nofollow" target="_blank"> azure cli 工具工作</a>(答案#2)。</li><li id="05c0" class="ni nj it lf b lg nr lj ns lm nt lq nu lu nv ly nn no np nq bi translated">运行 func 检查您的结果是否与 Stackoverflow 答案匹配，然后您就可以开始了</li></ul><p id="e8fb" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">显然这是因为 func 不在你的路径上。所以，如果你比我聪明，并整理了这些东西，让我知道，我会在这里添加它。</p><p id="d9ff" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">这将是你初始化 Azure 函数的地方。简单的事情是，如果你让你的 Azure 函数响应 HTTP 请求，那么你已经部署了你的模型，并通过 API 在一个简单的步骤中使它可用。</p><h1 id="1590" class="ma mb it bd mc md me mf mg mh mi mj mk ki ml kj mm kl mn km mo ko mp kp mq mr bi translated"><strong class="ak">设置你的 Azure 函数和本地 python 环境</strong></h1><p id="17bb" class="pw-post-body-paragraph ld le it lf b lg ms kd li lj mt kg ll lm mu lo lp lq mv ls lt lu mw lw lx ly im bi translated">#1 初始化您正在工作的文件夹</p><pre class="ks kt ku kv gt my mz na nb aw nc bi"><span id="9d28" class="nd mb it mz b gy ne nf l ng nh">func init titanic_model --python</span></pre><p id="8700" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">#2 设置基本 Azure 功能</p><pre class="ks kt ku kv gt my mz na nb aw nc bi"><span id="c2c0" class="nd mb it mz b gy ne nf l ng nh">cd titanic_model<br/>func new</span></pre><ul class=""><li id="c42d" class="ni nj it lf b lg lh lj lk lm nk lq nl lu nm ly nn no np nq bi translated">选择 HTTP 触发器</li><li id="7174" class="ni nj it lf b lg nr lj ns lm nt lq nu lu nv ly nn no np nq bi translated">给你的函数一个名字，我称之为我的模型 _ 部署</li></ul><p id="0fe3" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">如果你做对了，你会看到这个:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nw"><img src="../Images/7019d54adbfa0d837a2e7cc2a33d9ee0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m_vVGpiEH-jABjxpK7AUUw.png"/></div></div></figure><p id="568f" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">眼尖的读者会意识到我是在我的基本 Python 安装上运行这些功能的。</p><p id="21c2" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">当我们在本地运行 Azure 函数时，它使用我们指定的 Python 环境来执行。这让我们可以使用 requirements.txt 来指定一个本地环境，该环境将镜像将在 Azure 函数上运行的内容。</p><p id="e1f1" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">我使用 conda 创建我的环境，因为它很简单，但是你也可以使用 venv 或任何其他解决方案。</p><p id="400f" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">我还会添加到 requirements.txt 中，以涵盖所有的依赖项。这是我的样子:</p><pre class="ks kt ku kv gt my mz na nb aw nc bi"><span id="78de" class="nd mb it mz b gy ne nf l ng nh">azure-functions==1.0.4<br/>pandas==0.25.3<br/>scikit-learn==0.21.3<br/>requests==2.22.0</span></pre><p id="5f50" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">现在运行，这样您就可以安装包并构建用于部署的模型。</p><pre class="ks kt ku kv gt my mz na nb aw nc bi"><span id="09d3" class="nd mb it mz b gy ne nf l ng nh">conda create --name model_deploy python=3.7<br/>activate model_deploy<br/>pip install -r requirements.txt<br/></span></pre><h1 id="4ae0" class="ma mb it bd mc md me mf mg mh mi mj mk ki ml kj mm kl mn km mo ko mp kp mq mr bi translated">构建模型和配置 Azure 函数</h1><p id="09b1" class="pw-post-body-paragraph ld le it lf b lg ms kd li lj mt kg ll lm mu lo lp lq mv ls lt lu mw lw lx ly im bi translated">我在 Git repo 中放了一个简单的模型来指导您。来创建模型。您需要运行的 pkl:</p><pre class="ks kt ku kv gt my mz na nb aw nc bi"><span id="c947" class="nd mb it mz b gy ne nf l ng nh">python model_build.py</span></pre><p id="be33" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">这个模型是根据泰坦尼克号的数据集建立的，它预测了幸存者:</p><ul class=""><li id="df79" class="ni nj it lf b lg lh lj lk lm nk lq nl lu nm ly nn no np nq bi translated">年龄</li><li id="e59e" class="ni nj it lf b lg nr lj ns lm nt lq nu lu nv ly nn no np nq bi translated">乘客等级</li><li id="d13b" class="ni nj it lf b lg nr lj ns lm nt lq nu lu nv ly nn no np nq bi translated">上船(乘客上船的地方)</li><li id="f4b0" class="ni nj it lf b lg nr lj ns lm nt lq nu lu nv ly nn no np nq bi translated">性</li></ul><h1 id="b914" class="ma mb it bd mc md me mf mg mh mi mj mk ki ml kj mm kl mn km mo ko mp kp mq mr bi translated"><strong class="ak">改变 __init__。py 处理您的请求</strong></h1><p id="b2ae" class="pw-post-body-paragraph ld le it lf b lg ms kd li lj mt kg ll lm mu lo lp lq mv ls lt lu mw lw lx ly im bi translated">__init__。py 是你的 Azure 函数运行的内容。</p><p id="d844" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">使用 JSON 输入/输出可能有点麻烦，我花了一段时间才适应。</p><p id="a287" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">我将把代码的主要部分粘贴在这里，这样我就可以突出我遇到的主要困惑，这样你就可以从我的错误中吸取教训。</p><pre class="ks kt ku kv gt my mz na nb aw nc bi"><span id="0ffb" class="nd mb it mz b gy ne nf l ng nh">data = req.get_json()<br/>data = json.loads(data)</span></pre><p id="740d" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">您将为此模型使用 POST 请求。但是当您读入 JSON 请求时，它仍然是字符串格式，所以我们需要使用 json.loads 将它转换成适当的 dict/JSON 对象，然后才能使用数据进行预测。</p><pre class="ks kt ku kv gt my mz na nb aw nc bi"><span id="0d49" class="nd mb it mz b gy ne nf l ng nh">response = []<br/>for i in range(len(data)):<br/><br/>    data_row = data[i]<br/>    pred_df = pd.DataFrame([data_row])<br/>    pred_label = clf.predict(pred_df)[0]<br/>    pred_probs = clf.predict_proba(pred_df)[0]<br/><br/>    results_dict = {<br/>        'pred_label': int(pred_label),<br/>        'pred_prob_0': pred_probs[0],<br/>        'pred_prob_1': pred_probs[1]<br/>    }<br/><br/>    response.append(results_dict)<br/><br/>return json.dumps(response)</span></pre><p id="5e27" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">有几件事我会很快提到:</p><ul class=""><li id="f0bc" class="ni nj it lf b lg lh lj lk lm nk lq nl lu nm ly nn no np nq bi translated">警察。DataFrame([data_row]):允许您在 Pandas 中创建一个单行数据框架。否则你会得到一个索引错误</li><li id="6b64" class="ni nj it lf b lg nr lj ns lm nt lq nu lu nv ly nn no np nq bi translated">int(pred_label):因为输出的类是 numpy 数据类型(int64)而在返回 JSON 对象时是不可用的，所以我转换了它</li><li id="c69d" class="ni nj it lf b lg nr lj ns lm nt lq nu lu nv ly nn no np nq bi translated">json.dumps(response):即使我们使用 json，你也需要在发回之前将其转换成一个字符串</li></ul><p id="52ce" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated"><strong class="lf jd">现在让我们在本地部署那个坏的 boi</strong></p><pre class="ks kt ku kv gt my mz na nb aw nc bi"><span id="9712" class="nd mb it mz b gy ne nf l ng nh">func host start</span></pre><p id="c0ff" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">一旦它启动并运行，应该会给你下面的结果</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nx"><img src="../Images/8c2ba40b8024ac87c14cba2997ef61ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uou226Dnp8fS8pUwDrWR8Q.png"/></div></div></figure><p id="47b8" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated"><a class="ae lz" href="http://localhost:7071/api/model_deployment" rel="noopener ugc nofollow" target="_blank">http://localhost:7071/API/model _ deployment</a>是我们想要发送请求的目标。在本地 Azure 函数运行之后，使用 test_api.py 将数据 ping 到我们的 api。您应该会看到以下结果:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/e7830d4d977862fe849873b5d2b8f9fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1064/format:webp/1*vHHiwcmTxZJIrN7nGlfSUg.png"/></div></figure><p id="7723" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">布欧耶。现在成功了！！！！！所以现在我们有了一个本地运行的 Azure 功能，我们需要把它推送到 Azure，这样我们就可以永久地部署它。</p><h1 id="0910" class="ma mb it bd mc md me mf mg mh mi mj mk ki ml kj mm kl mn km mo ko mp kp mq mr bi translated">部署到 Azure</h1><p id="08b6" class="pw-post-body-paragraph ld le it lf b lg ms kd li lj mt kg ll lm mu lo lp lq mv ls lt lu mw lw lx ly im bi translated">现在我们已经让 Azure 函数在本地工作，我们可以把它推到 Azure 并部署这个坏的 boi。</p><p id="a960" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">如果你还没有创建一个 Azure 帐户，那么现在是时候了。一旦你这样做了，就去你的门户网站，然后运行一个 Azure Function 应用程序。</p><p id="73c3" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">下面是我如何配置我的</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nz"><img src="../Images/eb6239c286aa42bab4782773509ce2e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qdLG1dbxZCF7YgYs_1N7MQ.png"/></div></div><figcaption class="oa ob gj gh gi oc od bd b be z dk">Using Docker is a good shout. I’ll do my next blog post on that</figcaption></figure><p id="351f" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">现在你已经创建了你的 Azure 应用，你现在可以将你的模型部署到 Azure 并进行测试。</p><p id="7d75" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">从您的本地 Azure 函数目录中，您将需要运行以下命令</p><pre class="ks kt ku kv gt my mz na nb aw nc bi"><span id="0004" class="nd mb it mz b gy ne nf l ng nh">az login</span></pre><p id="bfa6" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">这将无缝执行，或者要求您登录 Azure 帐户。一旦完成，你就可以开始了。现在让我们将您的本地代码推送到 Azure。</p><pre class="ks kt ku kv gt my mz na nb aw nc bi"><span id="d338" class="nd mb it mz b gy ne nf l ng nh"><br/>func azure functionapp publish &lt;APP_NAME&gt; --build remote</span></pre><p id="8206" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">其中 APP_NAME 是您给函数 APP 起的名字(duh)。我的是泰坦模型，但是你的会不同。</p><p id="f78d" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">一旦完成，你需要找到你的 Azure 应用的 URL。你可以在这里找到</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oe"><img src="../Images/cedd1fd28915c449b8049ad9268e753d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j7WOtKHDaS5tAM_HJsHbAQ.png"/></div></div></figure><p id="4e0b" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">这个 URL 是您将要用来从 Azure 访问您的模型的。所以用你的 azure 函数 url 替换 test_api.py 中的 azure_url，试一试。</p><p id="e563" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">如果一切按计划进行，您将获得:</p><pre class="ks kt ku kv gt my mz na nb aw nc bi"><span id="d498" class="nd mb it mz b gy ne nf l ng nh">[<br/>  {<br/>    "pred_label": 1,<br/>    "pred_prob_0": 0.13974358581161161,<br/>    "pred_prob_1": 0.86025641418838839<br/>  },<br/>  {<br/>    "pred_label": 0,<br/>    "pred_prob_0": 0.65911568636955931,<br/>    "pred_prob_1": 0.34088431363044069<br/>  },<br/>  {<br/>    "pred_label": 1,<br/>    "pred_prob_0": 0.13974358581161161,<br/>    "pred_prob_1": 0.86025641418838839<br/>  },<br/>  {<br/>    "pred_label": 0,<br/>    "pred_prob_0": 0.65911568636955931,<br/>    "pred_prob_1": 0.34088431363044069<br/>  }<br/>]</span></pre><p id="05a8" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">现在，您还会有一种温暖而模糊的感觉，即将您的第一个 ML 模型部署到 Azure 函数中！！</p><p id="14b0" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">由于 API 端是由 Azure 函数本地处理的，我将在第二部分使用 Docker 重新创建这个过程，这可能会使事情变得更简单。</p></div></div>    
</body>
</html>