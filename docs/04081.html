<html>
<head>
<title>Make Data Acquisition Easy with AWS &amp; Lambda (Python) in 12 Steps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 AWS &amp; Lambda (Python)通过 12 个步骤轻松获取数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/make-data-acquisition-easy-with-aws-lambda-python-in-12-steps-33fe201d1bb4?source=collection_archive---------4-----------------------#2019-06-27">https://towardsdatascience.com/make-data-acquisition-easy-with-aws-lambda-python-in-12-steps-33fe201d1bb4?source=collection_archive---------4-----------------------#2019-06-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="402a" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated"><strong class="ak">告别复杂的 ETL 管道、SQL 数据库和其他复杂系统</strong></h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/47408d61302de27bcdaedaca80cd8a9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*tNXllYx93ipMLK44F6QWQw.png"/></div></figure><p id="2734" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">本文将简要介绍 AWS Lambda 和构建一个完全无服务器的数据管道。这篇文章是为至少对 Python 有基本(我指的是<em class="lm">基本</em>)理解的人写的，但是你也可以是 AWS 的新手。我们将创建一个 AWS 帐户，然后有一个 Lambda 函数从 Craigslist 拉数据，并存储在 S3 桶为我们自动，每天。</p><p id="7d17" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated"><strong class="ks iu">关于我:</strong>数据科学家和爱好者，他不断尝试学习新技术，让我的生活更轻松。像数据科学社区中的许多人一样，我是自学的，没有统计学或 cs 背景。在前世，我是一名机械工程师，但那感觉像是很久以前的事了。这些年来，我对 Python 和 AWS 的掌握相当不错(我有一些认证)，因为我总是从别人那里学到很多东西，所以我认为该轮到我为社区做贡献了。如果你觉得这篇文章有用，请随时在 LinkedIn 上与我联系，或者查看我的 Github 个人资料。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi lo"><img src="../Images/4ea9915bc458deea8a60e2da9b86747d.png" data-original-src="https://miro.medium.com/v2/resize:fit:382/format:webp/1*oTh2Tq2H4BTtTkdUgCTLGQ.png"/></div><figcaption class="lp lq gj gh gi lr ls bd b be z dk"><strong class="bd lt">AWS Lambda — Your serveless swiss army knife!</strong></figcaption></figure><h1 id="87a6" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated"><strong class="ak">什么是 Lambda </strong></h1><p id="98d5" class="pw-post-body-paragraph kq kr it ks b kt mm ju kv kw mn jx ky kz mo lb lc ld mp lf lg lh mq lj lk ll im bi translated">我经常会遇到“我编写了这个 Python 函数，需要它每天运行”的场景。您可以在您的机器上设置一个 Cron，但是如果您的计算机关闭了呢？另一个选择是转向云。用 AWS 做这件事的老方法是启动一个 EC2 实例，SSH 到其中，给它一个函数或者 docker 映像，在那里设置一个 Cron 作业，等等。还不算太糟，但是有点痛。此外，如果我只需要一些日常运行的东西，我真的需要一个 EC2 实例整天运行吗？输入 Lambda(是的，我知道您也可以为此使用 Batch，但这是一个 Lambda 教程)。</p><p id="1cba" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">AWS 有很多服务，但也许我最喜欢的是 AWS Lambda。基本上，它让你专注于编写代码，而不是处理那些烦人的事情，比如 VPC、EC2 实例、MySQL 数据库等等。只要写一些 Python，把代码交给 Lambda，它就会在云端执行这些代码。更好的是，你可以用各种方式触发代码:每分钟，每天一次，当你把东西放进 S3 桶时，等等。Lambda 非常棒(而且便宜),很快成为我最常用的 AWS 服务。</p><h1 id="2214" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated"><strong class="ak">我们将要做什么</strong></h1><p id="048b" class="pw-post-body-paragraph kq kr it ks b kt mm ju kv kw mn jx ky kz mo lb lc ld mp lf lg lh mq lj lk ll im bi translated">在 12 个简单的步骤中，我们将建立一个 Lambda 函数，每天自动从 Craigslist 获取数据，并将数据存储在 S3(JSON)中。这只是一个例子，但是您可以使用本教程以您指定的时间间隔自动运行任何 Python 函数。诚然，这篇文章有点长，但我想确保它很容易复制，尤其是对初学者来说。如果您遇到了问题，请随时联系我，我们可以尝试调试它。最后要注意的是，这里的一切都应该在免费层内，所以不会花你一分钱。Lambda 每月给你一百万个免费请求，所以除非你打算每秒钟都解雇这个宝贝，否则你应该很棒。</p><h1 id="cdea" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated"><strong class="ak">第一步:创建一个免费的 AWS 账户</strong></h1><p id="3ff5" class="pw-post-body-paragraph kq kr it ks b kt mm ju kv kw mn jx ky kz mo lb lc ld mp lf lg lh mq lj lk ll im bi translated">前往 https://aws.amazon.com 的<a class="ae ln" href="https://aws.amazon.com" rel="noopener ugc nofollow" target="_blank"/>，注册一个免费账户。请注意，您需要验证您的电话号码，但整个过程应该只需要几分钟。最后，选择“基本”计划，它将为你提供 12 个月的免费计算能力。</p><h1 id="7016" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated"><strong class="ak">第二步:创建一个存储桶来存储我们的数据</strong></h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi mr"><img src="../Images/aa0df9ec41f4eae862ef1562f01aec27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PUKTfe6J_qKnGhFYAvXZUQ.png"/></div></div><figcaption class="lp lq gj gh gi lr ls bd b be z dk"><strong class="bd lt">Create An S3 Bucket</strong></figcaption></figure><p id="d044" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">S3 桶是我们可以存储数据(或者更具体地说是对象数据)的地方。它基本上就像你电脑上的一个文件夹，但是在云中！进入服务&gt;存储&gt; S3，你将被带到 S3 启动画面。点击“创建存储桶”,给你的存储桶起个名字，然后选择离你最近的地区。我用桶来命名“我的超级甜桶”，你可以随意命名你的桶。只要知道桶名必须是全球唯一的，所以你不能有我的可怕的桶名。在给出名称和区域之后，只需使用所有的缺省值(单击 Next，直到创建了您的 bucket)。这将创建您的 bucket，并记下您对它的命名，因为我们稍后会用到它。</p><h1 id="8d74" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated"><strong class="ak">第三步:创建一个 Lambda 函数</strong></h1><p id="bfb0" class="pw-post-body-paragraph kq kr it ks b kt mm ju kv kw mn jx ky kz mo lb lc ld mp lf lg lh mq lj lk ll im bi translated">现在我们有了一个存储来自 Lambda 的数据的桶，是时候创建我们的 Lambda 函数了。如果您将鼠标悬停在顶部的服务上，在计算下方，您会发现 Lambda。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi mw"><img src="../Images/ec19c85e8b8c9442129506c539540c92.png" data-original-src="https://miro.medium.com/v2/resize:fit:934/format:webp/1*Qog8TABtCbxBfQQAH9MQJw.png"/></div></div><figcaption class="lp lq gj gh gi lr ls bd b be z dk"><strong class="bd lt">Lambda is found under computer (common AWS Cloud Practitioner exam question)</strong></figcaption></figure><p id="5c90" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">因为你还没有制作 Lambda，你会看到一个闪屏，向你介绍 Lambda 的世界。点击“创建函数”按钮来创建您的 Lambda。</p><p id="5e53" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">接下来，您将被要求命名您的函数，指定一种编程语言，并赋予它一个角色。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/b950a8cca4d53cfafb3bee1f6aaf165b.png" data-original-src="https://miro.medium.com/v2/resize:fit:754/format:webp/1*8X0LtQlNtTjvb4ZE6b4qGg.png"/></div><figcaption class="lp lq gj gh gi lr ls bd b be z dk"><strong class="bd lt">Create your Lambda function</strong></figcaption></figure><blockquote class="my mz na"><p id="5f40" class="kq kr lm ks b kt ku ju kv kw kx jx ky nb la lb lc nc le lf lg nd li lj lk ll im bi translated">先不说这个——什么是角色？亚马逊网络服务是一个巨大而神秘的怪兽，有很多事情在发生。值得注意的一点是，AWS 中的几乎所有东西都使用“最小权限”规则，基本上就是说，默认情况下，任何东西都没有访问任何东西的权限。例如，假设您在 AWS 网络中创建了一个名为 Bob 的用户。默认情况下，当 Bob 登录时，他不能访问任何 AWS 服务。鲍勃可以登录，但他不能使用 S3，EC2，Lambda 或其他任何东西。可怜的鲍勃。除非明确说明，否则不允许访问。总之，角色是一种以编程方式授予访问权限的方式。基本上，它会告诉 AWS“这是我的 Lambda 函数，我希望它能够访问 S3”。如果没有这个角色，你的 Lambda 函数将会像可怜的 Bob 一样无法访问。不要让你的 Lambda 像 Bob 一样。</p></blockquote><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi mr"><img src="../Images/3a6a5553a38399064395f3da1e6a27d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OjlLezEi3d4zOkFNaiCL_g.png"/></div></div><figcaption class="lp lq gj gh gi lr ls bd b be z dk"><strong class="bd lt">Details for your Lambda function</strong></figcaption></figure><p id="a873" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">不管怎样，你可以随意命名你的 Lambda 函数。我创造性地将我的名字命名为“pullCraigslistAds”。因为现在是 2019 年，我们是现代男女，我们将使用 Python 3.7，而不是任何 2.7 的废话。注意，Lambda 可以和许多其他编程语言一起使用，但是这里我们将使用 Python。现在权限可以设置为“创建一个具有基本 Lambda 权限的新角色”。我们将在教程的后面修正我们的角色。</p><h1 id="893e" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated"><strong class="ak">第 4 步:为你的代码选择上传一个. zip 文件</strong></h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi mr"><img src="../Images/17757be09ea693b5fa679915ea619838.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8TtLpwjpRkCvR48xBrPOcg.png"/></div></div><figcaption class="lp lq gj gh gi lr ls bd b be z dk"><strong class="bd lt">Set your Lambda to take a Zip file</strong></figcaption></figure><p id="b1aa" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">Lambda 的全部意义在于让它为我们执行一些代码。一旦你创建了 Lambda 函数，你会注意到浏览器中有一个代码编辑器。通常你可以直接在编辑器中写代码。然而，在本教程中，我们将使用一些外部(不是内置于 Python 中的)库，比如请求，我们将需要通过上传一个 zip 文件来做一些不同的事情。<strong class="ks iu">如果你不需要导入任何不附带 Python 的库，你可以直接内联编写。如果您确实需要导入库，我们将需要 Zip 文件。</strong>也就是说，Lambda 可以毫无问题地运行你的 Python 代码——但是如果你不需要 Pandas、Requests、Matplotlib 之类的库或者你用 Pip 安装的任何其他库呢？在本教程中，我们将使用 python-craigslist 库，所以我们使用“上传”。zip 文件”选项。</p><h1 id="5404" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated"><strong class="ak">第五步:我们函数的代码</strong></h1><p id="8b35" class="pw-post-body-paragraph kq kr it ks b kt mm ju kv kw mn jx ky kz mo lb lc ld mp lf lg lh mq lj lk ll im bi translated"><strong class="ks iu">注意:</strong>如果你很急，想跳过一些步骤，你可以克隆<a class="ae ln" href="https://github.com/scochran3/data_acquisition_aws_lambda" rel="noopener ugc nofollow" target="_blank"> <strong class="ks iu">这个库</strong> </a>它会提供你需要交给 Lambda 的最终 Zip 文件。如果您只是复制回购，您可以跳到步骤 8。</p><p id="a844" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">如果你不是懒惰的，并且想要跟随，那么在你的机器上的任何地方创建一个新的文件夹，并将下面的代码保存到一个名为"<strong class="ks iu"> lambda_function.py" </strong>的文件中。</p><p id="e1b8" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated"><strong class="ks iu">这是在做什么— </strong>基本上它是在用一个叫做 craigslist 的<a class="ae ln" href="https://pypi.org/project/python-craigslist/" rel="noopener ugc nofollow" target="_blank"> Python 库为我们抓取 craigslist。前几行导入我们的库。第 7 行是我们定义函数的地方，给出了<strong class="ks iu">事件</strong>和<strong class="ks iu">上下文</strong>的输入。如果你想变得书呆子气，去看看</a><a class="ae ln" href="https://docs.aws.amazon.com/lambda/latest/dg/python-programming-model-handler-types.html" rel="noopener ugc nofollow" target="_blank"> AWS 文档</a>。在高层次上，<strong class="ks iu">事件</strong>传递关于触发器的函数元数据，而<strong class="ks iu">上下文</strong>传递运行时信息给函数。对于这个函数，我们不需要过多地使用它们，但是在本系列的下一部分，我们将需要使用<strong class="ks iu">事件。</strong>例如，如果我们在某个东西被放入 S3 桶时触发一个 Lambda，我们可以使用<strong class="ks iu">事件</strong>来获取文件名，这通常很方便。</p><p id="a7de" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">无论如何，对于使用过 Python 的人来说，函数的其余部分相当简单:实例化我们的类，告诉它要拉取什么数据，并将其存储在某个 JSON 中。第 28 到 31 行是我们如何使用 Boto3 将数据发送到 S3 的。如果你从未使用过 Boto3，它是一个 Python SDK，或者简单地说就是你如何通过 Python 与 AWS 交互。Boto3 允许你把东西放到 S3，调用 Lambda，创建一个桶，等等。如果您想从 Python 脚本中使用 AWS 资源，那么 Boto3 就是您的答案。这里我们使用它的一个最基本的特性:输出到我们的 S3 桶。在第 29 行，您需要将 bucket 的名称更新为您在步骤 2 中命名的名称。作为参考，下面是我们函数中的一些样本数据，这些数据来自 Craigslist 上的一个公寓广告。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi mr"><img src="../Images/904c96ed082bd02ff6d83559dbe12a83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PpzJ59EGvRX0L-ocqnfWEA.png"/></div></div><figcaption class="lp lq gj gh gi lr ls bd b be z dk"><strong class="bd lt">Sample data</strong></figcaption></figure><p id="1b52" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">最后要注意的是，这只是我们的样本代码，但这可能是任何东西。例如，它可以调用 API，将数据转储到 JSON，并将 JSON 存储在 NoSQL 数据库中。这里我们将 JSON 输出到一个 S3 桶，但这可能是很多事情。</p><h1 id="cf27" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated"><strong class="ak">步骤 6: Pip 安装我们的依赖项</strong></h1><p id="7b15" class="pw-post-body-paragraph kq kr it ks b kt mm ju kv kw mn jx ky kz mo lb lc ld mp lf lg lh mq lj lk ll im bi translated">Lambda 在云中为你运行 Python，但它的 Python 版本有什么？任何经常使用 Python 的人都高度依赖库，库是我们可以使用的开源预写代码块(“import pandas as pd”，有人吗)？举个例子，如果我导入请求，在我们的 Lambda 中会发生什么？</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/887d99d7a05074e0fc4dfa8e43a5f195.png" data-original-src="https://miro.medium.com/v2/resize:fit:1104/format:webp/1*c2sQEIQ3r9CKFYZXzmNozg.png"/></div><figcaption class="lp lq gj gh gi lr ls bd b be z dk"><strong class="bd lt">Import requests library to our Lambda function</strong></figcaption></figure><p id="eb63" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated"><strong class="ks iu">注意:</strong>确保在点击测试之前保存你的函数，否则它将测试先前版本的代码而不包括请求。一个好的经验法则是总是保存你的 Lambda 函数，很容易忘记去做，然后你在调试过去的版本。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi mr"><img src="../Images/ccbbdb4012a68e8f2c5fe7a88e92b1ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GWtRHOE3kP4LmlgAusO0PA.png"/></div></div><figcaption class="lp lq gj gh gi lr ls bd b be z dk"><strong class="bd lt">Fail! Lambda won’t come with external libraries</strong></figcaption></figure><p id="9313" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">基本上我们的 Lambda 失败了，因为这个 Python 环境没有请求库。那么我们如何获得它(或任何库)？有几种方法，但这是我发现的最简单的方法。我们已经将我们的<strong class="ks iu"> lambda_function.py </strong>文件保存在一个文件夹中。接下来，pip 将您依赖项安装到同一个文件夹中。回头看看我们的代码，我们唯一的依赖是 craigslist 库(json、datetime、os 和 boto3 是其他需要的库，它们都是内置的，所以 Lambda 已经有了它们)。直到最近，我都不知道你可以这样做来 pip 安装到你当前的目录，但是它工作得很好:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/657f109f6ab4dab26a01c5b2bfbad830.png" data-original-src="https://miro.medium.com/v2/resize:fit:1120/format:webp/1*3lr5aVsIqBkIRhRqg5i46g.png"/></div><figcaption class="lp lq gj gh gi lr ls bd b be z dk"><strong class="bd lt">Pip install the packages to your current directory</strong></figcaption></figure><p id="ecee" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">这将把 python-craigslist(及其依赖项)和 lambda_function.py 一起安装到您的文件夹中</p><h1 id="6d48" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated"><strong class="ak">第七步:创建一个 Zip 文件</strong></h1><p id="7ad3" class="pw-post-body-paragraph kq kr it ks b kt mm ju kv kw mn jx ky kz mo lb lc ld mp lf lg lh mq lj lk ll im bi translated">回想一下 AWS 上的 Lambda 函数，我们选择了上传 Zip 文件的选项。现在，我的朋友们，是时候制作上述 Zip 文件了！选择你的文件夹中的所有文件，并将其放入一个 zip 文件，命名为 lambda_function.zip。我使用 7zip，所以我只是突出显示所有文件和文件夹，右键单击，选择 7Zip 并将其添加到一个 Zip 文件中。然后我把它重命名为 lambda_function.zip。你的目录应该看起来像下面这样，尽管现在你只需要那个 zip 文件。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi ng"><img src="../Images/012cc9ca071e3b5029601a37dc2e3fed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NR3LklEL1Rl8jCC0y7ARhg.png"/></div></div><figcaption class="lp lq gj gh gi lr ls bd b be z dk"><strong class="bd lt">Your current directory after creating the Zip file</strong></figcaption></figure><h1 id="8352" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated"><strong class="ak">第 8 步:上传你的 Zip 文件到 Lambda </strong></h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi mr"><img src="../Images/df1dc2df1758f0ac2e9e2ee48d39608f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zk9zoeWgfPxzU4sxBJCj9A.png"/></div></div><figcaption class="lp lq gj gh gi lr ls bd b be z dk"><strong class="bd lt">Time to upload our Zip file</strong></figcaption></figure><p id="ba5b" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">首先，我能感觉到你对我使用 Windows 的评价，我不喜欢这样。无论如何，点击上传按钮，并选择您新创建的 zip 文件。完成后，点击右上角的“保存”按钮。这将把你的 lambda_function.py 带进内联编辑器，你的 lambda 环境现在将拥有你需要的所有库！同样，从现在开始，如果您需要对代码进行修改，您可以直接编辑它，而不必重新打包您的 zip 文件。您需要重新打包 zip 文件的唯一原因是您对另一个库有新的依赖。如果发生这种情况，请重复步骤 6-8。</p><h1 id="f080" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">步骤 9:创建你的环境变量</h1><p id="243f" class="pw-post-body-paragraph kq kr it ks b kt mm ju kv kw mn jx ky kz mo lb lc ld mp lf lg lh mq lj lk ll im bi translated">完全进入环境变量有点超出了这个已经很长的教程的范围，但是基本上你可以在 Lambda 中完成。如果你看看我们的代码，我们调用了一个环境变量“number_of_posts”，这是我们将拉多少帖子。让我们对 Craigslist 好一点，不要让他们的系统超载，所以只要把它设置成 5 或 10 这样低的值就行了。这就创建了一个环境变量，我们的代码在被调用时会得到这个变量。</p><p id="75ea" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated"><strong class="ks iu">第十步:设置你的超时值</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi mr"><img src="../Images/54ee5d0b7a7f4424d9bcd187ec93a271.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YwvupG0OgCaisyOlt7HZfg.png"/></div></div><figcaption class="lp lq gj gh gi lr ls bd b be z dk"><strong class="bd lt">Set your max compute time for Lambda to 3 minutes</strong></figcaption></figure><p id="39b7" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">即将到来的 AWS 开发人员助理考试问题！默认情况下，Lambda 允许 3 秒钟的执行时间。对于这个例子，时间根本不够。您可以在“基本设置”下更改该超时值。最多 15 分钟，但我们应该能在 3 分钟内离开。如果你很吝啬，把你的功能设置成拉很多广告，比如说 200 个，你会需要更多的时间。请注意，Lambda 向您收取内存和计算时间费用。</p><h1 id="cd8f" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated"><strong class="ak">步骤 10:为你的 Lambda 函数添加权限</strong></h1><p id="e292" class="pw-post-body-paragraph kq kr it ks b kt mm ju kv kw mn jx ky kz mo lb lc ld mp lf lg lh mq lj lk ll im bi translated">我敢肯定，在这一点上，这篇文章就像简·奥斯汀的小说一样冗长，但是回想一下我们创建 Lambda 函数的第 3 步。我让你知道我们需要给 Lambda 一些权限来把东西放进 S3 桶。我们现在已经到了那个时候。我们是这样做的(尽可能简洁):</p><ul class=""><li id="3fef" class="nh ni it ks b kt ku kw kx kz nj ld nk lh nl ll nm nn no np bi translated">转到服务&gt;安全、身份和合规性&gt; IAM</li><li id="430e" class="nh ni it ks b kt nq kw nr kz ns ld nt lh nu ll nm nn no np bi translated">转到左侧导航栏上的角色</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi nv"><img src="../Images/56f2b1389ca1019d064ec1805b8f7b7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:656/format:webp/1*QPGjvyCn0Q_8RIhmPjTC6w.png"/></div></div><figcaption class="lp lq gj gh gi lr ls bd b be z dk"><strong class="bd lt">Select Roles</strong></figcaption></figure><ul class=""><li id="e515" class="nh ni it ks b kt ku kw kx kz nj ld nk lh nl ll nm nn no np bi translated">单击创建角色</li><li id="36ac" class="nh ni it ks b kt nq kw nr kz ns ld nt lh nu ll nm nn no np bi translated">在“选择将使用此角色的服务”下，选择 Lambda 并单击“下一步:权限”</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi mr"><img src="../Images/e3de67122f0f724f17125915f55fe1ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8Hxr8dDuxNjcI2F_gsqZiA.png"/></div></div><figcaption class="lp lq gj gh gi lr ls bd b be z dk"><strong class="bd lt">Specify we are creating a role for Lambda</strong></figcaption></figure><ul class=""><li id="ce2d" class="nh ni it ks b kt ku kw kx kz nj ld nk lh nl ll nm nn no np bi translated">现在您可以分配一个策略。从高层次上讲，策略就是如何授予权限。我们正在创建一个角色，为了让角色能够做任何事情，它需要附加一个定义权限的策略。也就是说，角色本身不授予任何权限。只有附加了策略，它才能访问资源。幸运的是，AWS 已经制定了一系列政策，所以在顶部搜索 S3 并选择“AmazonS3FullAccess”，单击复选框，然后单击下一步。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi mr"><img src="../Images/f156243022c89ac9893f1691cac35f1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GD_nzLyIU2A9XjbHSwzI0Q.png"/></div></div><figcaption class="lp lq gj gh gi lr ls bd b be z dk"><strong class="bd lt">Click the checkbox next to AmazonS3FullAccess and click Next</strong></figcaption></figure><ul class=""><li id="7763" class="nh ni it ks b kt ku kw kx kz nj ld nk lh nl ll nm nn no np bi translated">不要添加任何标签，点击前进(本教程很长，但标签允许您应用元数据)。</li><li id="3fcb" class="nh ni it ks b kt nq kw nr kz ns ld nt lh nu ll nm nn no np bi translated">在最后一步，我们命名我们的角色。我将把我的取名为<strong class="ks iu"> LambdaS3AllAccess，</strong>但是你可以随便给你的取名。单击“创建角色”按钮，我们就有了一个角色。</li><li id="5565" class="nh ni it ks b kt nq kw nr kz ns ld nt lh nu ll nm nn no np bi translated">回到你的 Lambda 函数。</li><li id="166f" class="nh ni it ks b kt nq kw nr kz ns ld nt lh nu ll nm nn no np bi translated">在“执行角色”下，选择您的新角色</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi mr"><img src="../Images/788aaa0743df65886462c77044905188.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hs1R0GL45-B6Qcq1HqH0rQ.png"/></div></div><figcaption class="lp lq gj gh gi lr ls bd b be z dk"><strong class="bd lt">Apply our spiffy new role to our Lambda function</strong></figcaption></figure><ul class=""><li id="17b9" class="nh ni it ks b kt ku kw kx kz nj ld nk lh nl ll nm nn no np bi translated">保存你的 Lambda 函数</li></ul><h1 id="41fb" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated"><strong class="ak">步骤 11:测试你的函数</strong></h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi mr"><img src="../Images/132c46966547fc3c88dafdbf7cbd2982.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mMis1mL7LdmRYRerDdoLYw.png"/></div></div><figcaption class="lp lq gj gh gi lr ls bd b be z dk"><strong class="bd lt">The default test should be fine, just give it a name</strong></figcaption></figure><p id="43de" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">我们的 Lambda 终于可以接受测试了！那么，我们如何测试这篇文章是不是一派胡言，这些东西是否真的有用呢？幸运的是 Lambda 内置了一个测试函数！如果你看“保存”按钮的右边，有一个“测试”按钮。点击那个！它将要求您创建一个测试输入，但我们现在将跳过它，因为当我们只是从 API 中提取或抓取时不需要它。基本上，如果你的 Lambda 要响应某种类型的输入，你可以在这里给它一个测试输入。我们不需要它，我们只需要它运行，所以只要给它一个名称，然后单击“创建”来测试它。</p><p id="77f3" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">现在您有了一个测试事件，再次单击“Test ”,您的函数应该运行了！如果神是好的，你应该看到一个巨大的绿色方块形式的正确执行的通用标志。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/0c895fbb4410907521d65e167df92f8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:926/format:webp/1*rupbPDQ0kLdptXyEp3s_RQ.png"/></div><figcaption class="lp lq gj gh gi lr ls bd b be z dk"><strong class="bd lt">Success!</strong></figcaption></figure><p id="d989" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">如果我们回想一下我们的函数正在做什么，它正在以 JSON blob 的形式向 S3 输出数据。因此，理论上，我们现在应该在我们的 S3 桶中有数据。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi mr"><img src="../Images/14e95d860c2c8226d3c524a171b22f2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PmKBMQi923fkZaf3tZu35w.png"/></div></div><figcaption class="lp lq gj gh gi lr ls bd b be z dk"><strong class="bd lt">Data in S3 from Lambda!</strong></figcaption></figure><p id="4bf1" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">如果你去你的 S3 桶，你现在应该有数据在那里！万岁。让我们进入最后一步:自动化！</p><h1 id="289a" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">第十二步:自动化！</h1><p id="4a26" class="pw-post-body-paragraph kq kr it ks b kt mm ju kv kw mn jx ky kz mo lb lc ld mp lf lg lh mq lj lk ll im bi translated">Lambda 的美妙之处在于它可以以多种方式被触发或调用。你可以让 Lambda 函数在任何时候发生，当一个对象进入一个桶，当另一个 Lambda 执行时，或者在一个时间间隔。我们将在这里使用后者，并将其设置为基于时间间隔运行。转到函数顶部，选择“云观察事件”。这就是你如何设置一个标准的时间间隔事件来触发我们的 Lambda。</p><p id="0405" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">CloudWatch 有很多功能，但本质上它是一个获取 AWS 环境数据的监控工具。如果你想获得任何 AWS 认证，你需要了解 CloudWatch，因为它会出现在许多考试中。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi mr"><img src="../Images/d9045e6d5e6e2ea4ee3dc9c135085296.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P2_3LDMao5p7S8xLO6TUcg.png"/></div></div><figcaption class="lp lq gj gh gi lr ls bd b be z dk"><strong class="bd lt">Add a CloudWatch Event to Fire Your Lambda</strong></figcaption></figure><p id="4351" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">下到最下面，保持为“创建新规则”。规则基本上就是控制事件何时触发的东西。我们将创造性地将其命名为“每日”,在描述中，因为创造性的汁液现在真的在流动，我们将说“每天跑一次”。选择“Schedule expression”并输入“rate(1 day)”作为值。注意，这既可以使用 rate()函数，也可以使用 Cron 调度程序。克朗是丑陋的，所以我要去与率，但使用任何浮动你的船。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi mr"><img src="../Images/b4be3bec3781678b34c1871c0c33f738.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bdYaZ89F1aF4yRWto41zKA.png"/></div></div><figcaption class="lp lq gj gh gi lr ls bd b be z dk"><strong class="bd lt">Setting up your CloudWatch trigger</strong></figcaption></figure><p id="aa54" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">就是这样！点击“添加”将你的新规则应用到你的 Lambda 函数中，然后点击顶部的“保存”将其应用到你的 Lambda 函数中。你的 Lambda 函数现在将每天提取数据并将其转储到 S3！</p><h1 id="10be" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated"><strong class="ak">总结</strong></h1><p id="ccfa" class="pw-post-body-paragraph kq kr it ks b kt mm ju kv kw mn jx ky kz mo lb lc ld mp lf lg lh mq lj lk ll im bi translated">Lambda 对于只想获取数据的开发人员或数据科学家来说是非常棒的，因为没有 EC2，没有数据库，没有硬件或其他令人痛苦的东西。它让我们只需简单地编写代码，让 AWS 处理所有烦人的事情。在本教程中，我们创建了一个 Python 函数，可以在本地机器上运行，并使用 Lambda 将其设置为每天在 AWS 上自动运行一次。第一次你可能会觉得很慢，但是一旦你习惯了 Lambda，你就可以开始快速部署了。当你第一次使用 AWS 和 Lambda 时，可能会有点害怕，但请坚持使用它，因为它对数据科学家来说有很多用途，特别是轻松获取数据。正如我提到的，如果你觉得这篇文章有用，请随时在<a class="ae ln" href="https://www.linkedin.com/in/shawn-cochran/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上与我联系，分享你对 Lambda 的用例。</p></div></div>    
</body>
</html>