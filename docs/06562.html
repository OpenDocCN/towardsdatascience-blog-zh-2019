<html>
<head>
<title>Anomaly Detection for Daily Bills with Reserved.ai</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">具有 Reserved.ai 的每日账单的异常检测</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/anomaly-detection-for-daily-bills-with-reserved-ai-547401218de2?source=collection_archive---------26-----------------------#2019-09-19">https://towardsdatascience.com/anomaly-detection-for-daily-bills-with-reserved-ai-547401218de2?source=collection_archive---------26-----------------------#2019-09-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><h1 id="3620" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">该项目</h1><p id="3917" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">这是我和<a class="ae lm" href="http://reserved.ai/#" rel="noopener ugc nofollow" target="_blank"> Reserved.ai </a>合作的一个项目，用于异常检测。广义地说，异常检测是检测意外或异常数据的任何过程。在这种特殊情况下，Reserved.ai 帮助客户在 AWS 信用上获得更好的交易，因此可以访问他们的日常账单。在一个案例中，有人注意到账单金额突然增加，并提醒了客户。原来，他们的一名工程师部署了一项改变，无意中大幅增加了他们的日常账单。该项目的想法是自动化监控每日账单的过程，目的是提醒客户意外的费用。</p><h1 id="6b01" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">数据</h1><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi ln"><img src="../Images/f08a4c7aa65267cb18e34200ddc42086.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*IkSV1re8QN8zpzzi"/></div></div></figure><p id="f2e1" class="pw-post-body-paragraph ko kp it kq b kr lz kt ku kv ma kx ky kz mb lb lc ld mc lf lg lh md lj lk ll im bi translated">数据由各种客户的每日账单组成，如上所述。此外，成本可以按服务、地区或客户进行细分。首要任务是找出一种方法来自动检测整个账单的异常情况。</p><p id="4fcd" class="pw-post-body-paragraph ko kp it kq b kr lz kt ku kv ma kx ky kz mb lb lc ld mc lf lg lh md lj lk ll im bi translated">我注意到的第一件事是，对于许多客户来说，每个月的第一天都会有一个可预测的高峰。虽然这将被许多异常检测算法标记出来，但它并不是我们真正要寻找的那种异常。首先，这是可以预测的；第二，客户可以在每个月的第一天查看他们的账单(其他日子的账单只在内部跟踪)，所以他们在第一天就已经知道账单了。目的是提醒他们注意他们<em class="me">不知道的指控。为了解决这个问题，我简单地从数据集中删除了每个月的第一天。这是剔除了每月第一天的相同数据。</em></p><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi ln"><img src="../Images/d92bd78ec468788b95dde2554e6b84e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*flxIOxgJTbpUnkYn"/></div></div></figure><p id="59cf" class="pw-post-body-paragraph ko kp it kq b kr lz kt ku kv ma kx ky kz mb lb lc ld mc lf lg lh md lj lk ll im bi translated">我们可以看到，这消除了许多尖峰，但一些仍然存在。这样一来，是时候尝试一些异常检测算法了。</p><h1 id="55c6" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">模型</h1><p id="33f0" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">异常检测有许多算法。我从最简单的开始:为基本的统计测量应用阈值。我的方法是基于一个叫做<a class="ae lm" href="https://github.com/SundaySky/cost-anomaly-detector" rel="noopener ugc nofollow" target="_blank"> SundaySky </a>的开源成本异常检测器。它查看过去 14 天的账单数据，并计算平均值和标准差。然后，它检查是否满足三个阈值:相对阈值，检查它是否至少是前几天平均成本的 1.25 倍；标准差阈值，寻找比平均值高至少 3.5 倍的标准差；和一个绝对阈值，寻找高于 10 美元的成本。</p><p id="c2cf" class="pw-post-body-paragraph ko kp it kq b kr lz kt ku kv ma kx ky kz mb lb lc ld mc lf lg lh md lj lk ll im bi translated">正如文档所解释的:</p><blockquote class="mf mg mh"><p id="06b0" class="ko kp me kq b kr lz kt ku kv ma kx ky mi mb lb lc mj mc lf lg mk md lj lk ll im bi translated"><em class="it">我们发现，同时使用所有 3 个阈值可以获得最佳结果，每个阈值都有自己的原因:</em></p><p id="1893" class="ko kp me kq b kr lz kt ku kv ma kx ky mi mb lb lc mj mc lf lg mk md lj lk ll im bi translated"><em class="it">相对阈值过滤掉无关紧要的异常。</em></p><p id="f228" class="ko kp me kq b kr lz kt ku kv ma kx ky mi mb lb lc mj mc lf lg mk md lj lk ll im bi translated"><em class="it">标准差阈值过滤掉具有正常不同日使用量(高日/低日)的服务常规使用量。</em></p><p id="4a48" class="ko kp me kq b kr lz kt ku kv ma kx ky mi mb lb lc mj mc lf lg mk md lj lk ll im bi translated"><em class="it">绝对阈值阻止我们得到关于廉价异常的通知，这将导致无行动。</em></p></blockquote><p id="ccbe" class="pw-post-body-paragraph ko kp it kq b kr lz kt ku kv ma kx ky kz mb lb lc ld mc lf lg lh md lj lk ll im bi translated">SundaySky repo 中的大部分代码处理从数据库中存储和检索数据。算法的核心实际上非常简单，所以我发现自己写出来是最简单的。</p><p id="d814" class="pw-post-body-paragraph ko kp it kq b kr lz kt ku kv ma kx ky kz mb lb lc ld mc lf lg lh md lj lk ll im bi translated">当我用建议的缺省值测试它时，发现要求增加至少 3.5 个标准差太多了:它没有标出一个点。然而，完全取消标准偏差要求导致它标记了太多的点。1.5 标准差的要求被证明是一个很好的中间立场，通过了突出客户可能关注的点的眼球测试。下图中，检测到的异常点以红色突出显示。</p><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi ln"><img src="../Images/831c94cfe631c14083513cb7427af97d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V1i-3BwSNqZmrJqpgGNc6A.png"/></div></div></figure><p id="a23a" class="pw-post-body-paragraph ko kp it kq b kr lz kt ku kv ma kx ky kz mb lb lc ld mc lf lg lh md lj lk ll im bi translated">我本来打算在转向更高级的模型之前使用这个简单的方法作为基线，但是结果证明它表现得足够好，以至于 CEO 决定按原样将其投入生产。有时候简单是最好的！</p><h1 id="27f5" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">履行</h1><p id="34d7" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">唯一的另一个调整是添加一些代码，从服务、地区和帐户方面找出增长的主要原因。准备就绪后，我们将系统投入生产。当算法检测到一个异常点时，它会向 Reserved.ai 的客户服务代表发送一个松弛警报。然后，那个人会查看成本历史和主要原因，并决定是否将其传递给客户。到目前为止，这已经导致几个客户被警告他们的日常账单会有意想不到的增加。</p><p id="f3ae" class="pw-post-body-paragraph ko kp it kq b kr lz kt ku kv ma kx ky kz mb lb lc ld mc lf lg lh md lj lk ll im bi translated">感谢 Aran Khanna 和 Reserved.ai 对这个项目的帮助。</p><p id="8323" class="pw-post-body-paragraph ko kp it kq b kr lz kt ku kv ma kx ky kz mb lb lc ld mc lf lg lh md lj lk ll im bi translated">该项目的代码可在<a class="ae lm" href="https://gist.github.com/NateSolon/2c1aba900307dbf5c6c99137c7a24b16" rel="noopener ugc nofollow" target="_blank">这里</a>获得。</p></div></div>    
</body>
</html>