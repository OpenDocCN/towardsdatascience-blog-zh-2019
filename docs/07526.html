<html>
<head>
<title>Exploring Data Augmentation with Keras and TensorFlow</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Keras 和 TensorFlow 探索数据扩充</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/exploring-image-data-augmentation-with-keras-and-tensorflow-a8162d89b844?source=collection_archive---------2-----------------------#2019-10-21">https://towardsdatascience.com/exploring-image-data-augmentation-with-keras-and-tensorflow-a8162d89b844?source=collection_archive---------2-----------------------#2019-10-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="3c89" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在下一个深度学习项目中使用数据增强的指南！</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/732930b4ddd05e8b57b0ff625a64fac3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*FXXOOs3xod_A2u26"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Photo by <a class="ae ky" href="https://unsplash.com/@jontyson?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Jon Tyson</a> on <a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="de4d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">数据扩充</strong>是一种用于<strong class="lb iu">通过使用裁剪、填充、翻转等技术来增加数据量</strong>的策略。</p><p id="b46d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据扩充使得模型对于微小的变化更加<strong class="lb iu">健壮</strong>，因此<strong class="lb iu">防止</strong>模型<strong class="lb iu">过度拟合</strong>。</p><p id="0c85" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将增加的数据存储在内存中既不实际也没有效率，这就是 Keras 的<code class="fe lv lw lx ly b">ImageDataGenerator</code>类(也包含在 TensorFlow 的高级 api 中:tensorflow.keras)发挥作用的地方。<code class="fe lv lw lx ly b">ImageDataGenerator</code>通过<strong class="lb iu">实时数据增强</strong>生成<strong class="lb iu">批张量图像数据</strong>。最棒的是。只是<strong class="lb iu">一行</strong>代码！</p><p id="1cf2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">生成器生成的输出图像将具有与输入图像相同的输出尺寸。</p><p id="1329" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下面是一个辅助脚本，我们将使用它来直观地展示使用<code class="fe lv lw lx ly b">ImageDataGenerator</code>类所能实现的一切。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lz ma l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mb"><img src="../Images/ae32a1b11d459a7d1d91bd0b84a7e465.png" data-original-src="https://miro.medium.com/v2/resize:fit:732/format:webp/1*1GyNk8UVyubIkIaExmltRA.png"/></div></figure><h2 id="6f7b" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">1.旋转</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lz ma l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mv"><img src="../Images/c82a531950d000b32d13f798acf4fcf8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UAKTEb0_tKBA6xUWiLoLRA.png"/></div></div></figure><p id="382e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过指定<code class="fe lv lw lx ly b">rotation_range</code>，生成的数据被随机旋转<code class="fe lv lw lx ly b">+rotation_range</code>到<code class="fe lv lw lx ly b">-rotation_range</code>范围内的一个角度(以度为单位)。</p><h2 id="b98b" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">2.宽度移动</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lz ma l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mv"><img src="../Images/5c923655f72b65645c91d48345a264bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GL-6WVWJ39j2_HLBiBhaUQ.png"/></div></div></figure><p id="8ec1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">width_shift_range</code>是一个介于<code class="fe lv lw lx ly b">0.0</code>和<code class="fe lv lw lx ly b">1.0</code>之间的浮点数，它指定了图像随机向左或向右移动的总宽度分数的上限。</p><h2 id="24ad" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">3.高度移动</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lz ma l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mv"><img src="../Images/015ac126b3a45bc0828f652c9afce53e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zyajFhb--ezkB2BO79LlGw.png"/></div></div></figure><p id="797f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">除了图像是垂直移动而不是水平移动之外，与宽度移动完全一样。</p><h2 id="7da0" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">4.聪明</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lz ma l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mv"><img src="../Images/88312888218841ff2eaea37e7e9e1c12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9aWRVK8GSuifjmsxPUoyYw.png"/></div></div></figure><p id="4355" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">brightness_range</code>指定随机选择亮度偏移值的范围。<code class="fe lv lw lx ly b">0.0</code>的亮度对应绝对无亮度，<code class="fe lv lw lx ly b">1.0</code>对应最大亮度。</p><h2 id="0e4c" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">5.剪切强度</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lz ma l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mv"><img src="../Images/55aab045c93ab5aa71295f85331a264c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xCPvNf3KPVx9DBoZOaSXgQ.png"/></div></div></figure><p id="08d9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">剪切变换会倾斜图像的形状。这不同于旋转，因为在剪切变换中，我们固定一个轴，并以某个角度(称为剪切角)拉伸图像。这在图像中产生了一种“拉伸”,这在旋转中是看不到的。<code class="fe lv lw lx ly b">shear_range</code>以度为单位指定倾斜的角度。</p><h2 id="43ce" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">6.一款云视频会议软件</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lz ma l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mv"><img src="../Images/c38f7ff719c051697c31095d5638d8c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DySF0dV9x_ngwZMHAEEE5g.png"/></div></div></figure><p id="b370" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过<code class="fe lv lw lx ly b">zoom_range</code>参数获得随机缩放。小于<code class="fe lv lw lx ly b">1.0</code>的缩放会放大图像，而大于<code class="fe lv lw lx ly b">1.0</code>的缩放会缩小图像。</p><h2 id="6fd5" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">7.频道转换</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lz ma l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mv"><img src="../Images/b6fe501a2536981427134c437fd30883.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*605WTBE9UZ9DQfw69HGjXA.png"/></div></div></figure><p id="1d42" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">信道偏移通过从<code class="fe lv lw lx ly b">channel_shift_range</code>指定的范围中选择一个随机值来随机偏移信道值。</p><h2 id="138b" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">8.水平翻转</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lz ma l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mv"><img src="../Images/3453895cbdc14f5ab037eae406dc2311.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3GWT6jWfaUNWdJ6wfeCvQg.png"/></div></div></figure><p id="c8d8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">生成器将生成图像，图像将随机水平翻转。</p><h2 id="455b" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">9.垂直翻转</h2><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lz ma l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mv"><img src="../Images/0a69b7447092ff1185c9aac36819432d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2b68ISjr-8APBnaicix33w.png"/></div></div></figure><p id="2d01" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">除了水平翻转，我们还可以应用垂直翻转。</p></div><div class="ab cl mw mx hx my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="im in io ip iq"><h2 id="562b" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">但是那些我们没有任何价值的点呢？</h2><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nd"><img src="../Images/1c32302cd51c8895362c471ab31a0de3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Hj4zFQ_pbEavxu2eJICp1w.png"/></div></div></figure><p id="fe5c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们有几个选项，从中我们可以选择我们希望如何填充这些区域。</p><h2 id="54ae" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">1.最近的</h2><p id="d7b7" class="pw-post-body-paragraph kz la it lb b lc ne ju le lf nf jx lh li ng lk ll lm nh lo lp lq ni ls lt lu im bi translated">这是默认选项，选择最接近的像素值，并对所有空值重复使用。(例如 aaaaaaaa | abcd | dddddddd)</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lz ma l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mv"><img src="../Images/5c923655f72b65645c91d48345a264bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GL-6WVWJ39j2_HLBiBhaUQ.png"/></div></div></figure><h2 id="d372" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">2.显示</h2><p id="d9e5" class="pw-post-body-paragraph kz la it lb b lc ne ju le lf nf jx lh li ng lk ll lm nh lo lp lq ni ls lt lu im bi translated">该模式创建一个“反射”,并以已知值的相反顺序填充空值。(例如 abcddcba|abcd|dcbaabcd)</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lz ma l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mv"><img src="../Images/3bb9d43b30a6afbd501a9cb0bf9bb2dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B7ertfd5W4ii794isidPEg.png"/></div></div></figure><h2 id="8772" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">3.包装</h2><p id="ad6c" class="pw-post-body-paragraph kz la it lb b lc ne ju le lf nf jx lh li ng lk ll lm nh lo lp lq ni ls lt lu im bi translated">除了反射效果，我们还可以通过将已知点的值复制到未知点来创建“包裹”效果，同时保持顺序不变。(例如 abcdabcd|abcd|abcdabcd)</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lz ma l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mv"><img src="../Images/15af51c9d35bd8316daef61cb3563178.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yhfyWk__lV3Uin4X0Xaf4w.png"/></div></div></figure><h2 id="d6b7" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">4.常数</h2><p id="14b4" class="pw-post-body-paragraph kz la it lb b lc ne ju le lf nf jx lh li ng lk ll lm nh lo lp lq ni ls lt lu im bi translated">如果我们想用一个常数值填充位于输入边界之外的所有点，这种模式可以帮助我们实现这一点。常量值由<code class="fe lv lw lx ly b">cval</code>参数指定。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lz ma l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mv"><img src="../Images/727ce1e2b8f04b5a4d66de7a36f2e4c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2Q1-0DxtYNmLEMu8jlSr3Q.png"/></div></div></figure></div><div class="ab cl mw mx hx my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="im in io ip iq"><h2 id="a7c7" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">但还有更多！</h2><p id="19c2" class="pw-post-body-paragraph kz la it lb b lc ne ju le lf nf jx lh li ng lk ll lm nh lo lp lq ni ls lt lu im bi translated">您可以直接从该课程中获得一些额外的好处。一些例子包括将数据归零(<code class="fe lv lw lx ly b">featurewise_center</code> <em class="nj">、</em> <code class="fe lv lw lx ly b">samplewise_center</code>)和归一化(<code class="fe lv lw lx ly b"><em class="nj">featurewise_std_normalization</em></code> <em class="nj">、</em> <code class="fe lv lw lx ly b"><em class="nj">samplewise_std_normalization</em></code>)。这些变量可以通过将它们的布尔值传递给<code class="fe lv lw lx ly b">ImageDataGenerator</code>类来设置。我们还可以通过指定<code class="fe lv lw lx ly b">rescale</code>参数来重新调整这些值，它会乘以所有的值。</p><p id="ff73" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">此外，还有一个参数<code class="fe lv lw lx ly b">preprocessing_function</code>,使用它您可以指定自己的自定义函数来执行图像处理。多酷啊！</p></div><div class="ab cl mw mx hx my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="im in io ip iq"><p id="78a5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你喜欢这篇文章，你可能也会喜欢<a class="ae ky" rel="noopener" target="_blank" href="/vggnet-vs-resnet-924e9573ca5c"> VGGNet vs ResNet:消失渐变问题的清晰答案！</a></p><h2 id="97b7" class="mc md it bd me mf mg dn mh mi mj dp mk li ml mm mn lm mo mp mq lq mr ms mt mu bi translated">参考</h2><p id="6391" class="pw-post-body-paragraph kz la it lb b lc ne ju le lf nf jx lh li ng lk ll lm nh lo lp lq ni ls lt lu im bi translated">[1] <a class="ae ky" href="https://keras.io/preprocessing/image/" rel="noopener ugc nofollow" target="_blank"> Keras 文档</a></p><p id="58cb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">[2] <a class="ae ky" href="https://www.tensorflow.org/api_docs/python/tf/keras/preprocessing/image/ImageDataGenerator" rel="noopener ugc nofollow" target="_blank">张量流文档</a></p><p id="d203" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">[3] <a class="ae ky" href="https://www.tutorialspoint.com/javafx/shearing_transformation" rel="noopener ugc nofollow" target="_blank">剪切变换</a></p></div></div>    
</body>
</html>