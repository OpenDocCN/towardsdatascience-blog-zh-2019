<html>
<head>
<title>Amazon RDS — Step-By-Step Guide</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">亚马逊 RDS —分步指南</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/amazon-rds-step-by-step-guide-14f9f3087d28?source=collection_archive---------4-----------------------#2019-07-10">https://towardsdatascience.com/amazon-rds-step-by-step-guide-14f9f3087d28?source=collection_archive---------4-----------------------#2019-07-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="8db1" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph"><a class="ae ep" rel="noopener" target="_blank" href="https://towardsdatascience.com/data-science/home">数据科学</a></h2><div class=""/><div class=""><h2 id="16f6" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">使用 Amazon RDS 和 Python 创建、连接和交互远程 PostgreSQL 数据库</h2></div><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/8296b8d6d7a216f44750804ed05a29e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*dMi160aqKRuXzs_A"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk">Photo by <a class="ae le" href="https://unsplash.com/@arnelhasanovic?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Arnel Hasanovic</a> on <a class="ae le" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="b3f0" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi mb translated"><span class="l mc md me bm mf mg mh mi mj di"> T </span>他的这篇文章将指导你如何使用<a class="ae le" href="https://aws.amazon.com/rds/postgresql/" rel="noopener ugc nofollow" target="_blank">亚马逊关系数据库服务</a>创建数据库实例，以及如何仅使用 Python 与远程数据库服务器交互。</p><h1 id="c843" class="mk ml iq bd mm mn mo mp mq mr ms mt mu kf mv kg mw ki mx kj my kl mz km na nb bi translated">步骤 1:启动 AWS 数据库实例</h1><p id="8dc5" class="pw-post-body-paragraph lf lg iq lh b li nc ka lk ll nd kd ln lo ne lq lr ls nf lu lv lw ng ly lz ma ij bi translated">首先，我们需要一个 AWS 账户。我们将转到<a class="ae le" href="https://portal.aws.amazon.com/billing/signup?nc2=h_ct&amp;src=header_signup&amp;redirect_url=https%3A%2F%2Faws.amazon.com%2Fregistration-confirmation#/start" rel="noopener ugc nofollow" target="_blank"> AWS 门户</a>创建一个新帐户，或者您可以使用现有的 AWS 帐户。</p><h2 id="7ff9" class="nh ml iq bd mm ni nj dn mq nk nl dp mu lo nm nn mw ls no np my lw nq nr na iw bi translated">什么是亚马逊 RDS？</h2><p id="3fd7" class="pw-post-body-paragraph lf lg iq lh b li nc ka lk ll nd kd ln lo ne lq lr ls nf lu lv lw ng ly lz ma ij bi translated">Amazon 关系数据库服务(RDS)是在云中建立关系数据库的核心部分。我们提供的每个云数据库称为一个数据库实例。因此，首先，点击<em class="ns">服务</em>并选择<em class="ns">数据库</em>导航至 RDS 仪表板:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nt"><img src="../Images/2715b5332e2eaefb1efca4e45d16e25a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1DHyLZT6nXKbySq6uZUCYw.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk">AWS Services Console. Select RDS for launching a new database instance.</figcaption></figure><p id="dcab" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">接下来，要创建一个新的数据库，点击“<em class="ns">创建数据库</em> e”。数据库实例是灵活的，您可以配置它们来满足您的需求。您可以使用一系列引擎类型来配置数据库，包括 Amazon Aurora、MySQL、PostgreSQL 等。除了引擎类型之外，您还可以配置数据库实例的类型和大小，分配存储，以及配置不同的设置，如监控、备份和许多其他设置。</p><p id="0bd3" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">现在，我们选择一个运行数据库的 PostgreSQL 引擎。在本帖中，我们使用一个<strong class="lh ja"> <em class="ns">自由层模板</em> </strong>。通过一个空闲的 trier，我们得到一个小实例<strong class="lh ja"> db.t2.micro </strong>，它有 1 个 CPU 和 1gb 内存。</p><p id="d1b5" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">接下来，在 Settings 部分指定您的数据库实例信息:实例名和登录到您的实例的主用户凭证。您还可以指定用于访问数据库的端口。对于 PostgreSQL 安装，默认端口是 5432。</p><p id="a4b9" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">如果您想要为您的数据库实例提供一个公共 IP 地址(这样 VPC 之外的设备将能够连接到您的数据库),在<em class="ns">连接</em>部分中为<strong class="lh ja">公共可访问</strong>选择<strong class="lh ja">是</strong>。我选择<strong class="lh ja"> Yes </strong>让我的数据库在我的本地机器上可用。</p><p id="e21c" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">您应该继续到<strong class="lh ja">附加配置</strong>部分，并指定 Amazon RDS 在创建数据库实例时创建的数据库名称。对于本教程，我将创建一个名为<strong class="lh ja"> <em class="ns"> titanic </em> </strong>的数据库。</p><blockquote class="nu nv nw"><p id="6104" class="lf lg ns lh b li lj ka lk ll lm kd ln nx lp lq lr ny lt lu lv nz lx ly lz ma ij bi translated"><strong class="lh ja">记住:数据库名称和数据库实例名称是两个不同的名称。如果不指定数据库名称，Amazon RDS 在创建数据库实例时不会创建数据库。</strong></p></blockquote><p id="9bea" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">最后，点击<strong class="lh ja">创建数据库</strong>。启动数据库可能需要几分钟时间。新的数据库实例出现在 Amazon RDS 控制台上。一旦实例的状态变为<strong class="lh ja">可用，您就可以连接到该实例。</strong></p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oa"><img src="../Images/cb216dd8a65713b854c55a4366349fe2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zK5kyZYQunMnoKhtPoIJLw.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk">The DB instance on the Amazon RDS console</figcaption></figure><h1 id="cd92" class="mk ml iq bd mm mn mo mp mq mr ms mt mu kf mv kg mw ki mx kj my kl mz km na nb bi translated">步骤 2:连接到 PostgreSQL 数据库</h1><p id="0042" class="pw-post-body-paragraph lf lg iq lh b li nc ka lk ll nd kd ln lo ne lq lr ls nf lu lv lw ng ly lz ma ij bi translated">一旦创建了数据库，我们就可以与它进行交互。在这里，我们使用 Python 包<a class="ae le" href="http://initd.org/psycopg/" rel="noopener ugc nofollow" target="_blank"><strong class="lh ja">psycopg 2</strong></a><strong class="lh ja">:</strong>从 Jupyter 笔记本连接到我们的数据库</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ob oc l"/></div></figure><blockquote class="nu nv nw"><p id="cab3" class="lf lg ns lh b li lj ka lk ll lm kd ln nx lp lq lr ny lt lu lv nz lx ly lz ma ij bi translated">注意，您甚至不需要在我们的本地机器上安装 Postgres。您只需要安装一个 psycopg2 包，在您的终端中输入:<strong class="lh ja"> pip install psycopg2 </strong></p></blockquote><p id="363f" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">在第二行中，我们通过使用<code class="fe od oe of og b">connect()</code>方法打开了到 Postgres 的连接。我们向 psycopg2 传递了五个参数。第一个是<code class="fe od oe of og b">host</code>,它指定数据库在哪里运行。在我们的例子中，它是一个远程 RDB，主机 url 是来自 Amazon RDS 控制台的<em class="ns">端点值</em>(参见下面的截图)。接下来，我们传递用户名和密码(第 5、6 行)。您可以从使用之前创建的主用户凭证开始。稍后，我们将添加一个新用户，作为提高安全性和数据划分的一种方式。最后，我们传递了数据库名称(<em class="ns">，它与数据库实例名称不同！！！</em>)。我让你在<strong class="lh ja">附加配置</strong>中输入的数据库名称，在我这里是<strong class="lh ja">泰坦尼克号。</strong></p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oa"><img src="../Images/5723048cbb11cc32132d4b753ddb480f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aATQXlVAHh0XLHXtg3m1iA.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk">Amazon RDS console for a test database instance</figcaption></figure><p id="5b84" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">最后但同样重要的是，我们需要创建一个<strong class="lh ja">光标</strong>对象(第 9 行)来交互和执行 Postgres 数据库上的命令。</p><h1 id="33f4" class="mk ml iq bd mm mn mo mp mq mr ms mt mu kf mv kg mw ki mx kj my kl mz km na nb bi translated">步骤 3:通过 Python 与数据库交互</h1><h2 id="e7d9" class="nh ml iq bd mm ni nj dn mq nk nl dp mu lo nm nn mw ls no np my lw nq nr na iw bi translated">3.1.资料组</h2><p id="dd14" class="pw-post-body-paragraph lf lg iq lh b li nc ka lk ll nd kd ln lo ne lq lr ls nf lu lv lw ng ly lz ma ij bi translated">一旦我们连接到我们的数据库，是时候添加一些数据了。为了这个教程，我从 Kaggle  (train.csv)上取了<a class="ae le" href="https://www.kaggle.com/c/titanic/data" rel="noopener ugc nofollow" target="_blank">泰坦尼克号数据集。经过一些预处理后，我将文件拆分为三个 CSV 文件:<em class="ns"> passengers.csv </em>、<em class="ns"> tripInfo.csv </em>和<em class="ns"> survival.csv. </em>我的回购与处理后的数据集和笔记本的链接在文章的最后。</a></p><h2 id="85e5" class="nh ml iq bd mm ni nj dn mq nk nl dp mu lo nm nn mw ls no np my lw nq nr na iw bi translated">3.2.创建表格</h2><p id="33ab" class="pw-post-body-paragraph lf lg iq lh b li nc ka lk ll nd kd ln lo ne lq lr ls nf lu lv lw ng ly lz ma ij bi translated">现在，我将把数据从 CSV 文件复制到数据库中，但是首先，我需要创建三个适合我的数据集的表。为此，我们可以使用<code class="fe od oe of og b">CREATE TABLE</code>命令，但是要注意，列的顺序应该与 CSV 文件中它们各自类型的顺序相同。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="f74f" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">记住，每次我们需要在每个事务结束时运行<code class="fe od oe of og b">connection.commit() </code>来提交我们的更改(第 22 行)。最后，您可以随时查询表 INFORMATION_SCHEMA。列来显示所有公共表的模式。我们尤其对列名和数据类型感兴趣。在 Python 中，我们还可以使用 pandas 方法<code class="fe od oe of og b">read_sql()</code>访问远程数据:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ob oc l"/></div></figure><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oh"><img src="../Images/871f3a997b65630d51c8da2e335c481b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lhFp1uozW9S96MU_gMVi4g.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk">A sample output after executing the SQL query.</figcaption></figure><h2 id="fecc" class="nh ml iq bd mm ni nj dn mq nk nl dp mu lo nm nn mw ls no np my lw nq nr na iw bi translated">3.3.将数据从 CSV 加载到 Postgres 表中</h2><p id="b1ed" class="pw-post-body-paragraph lf lg iq lh b li nc ka lk ll nd kd ln lo ne lq lr ls nf lu lv lw ng ly lz ma ij bi translated">一旦我们有了表，我们想从 CSV 文件中复制数据。幸运的是，使用<strong class="lh ja"> psycopg2 </strong>使用<em class="ns"> copy_from() </em>方法非常简单:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ob oc l"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk">Loading data into a Postgres table from CSV</figcaption></figure><p id="a486" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">我们还可以创建一个新用户，并授予管理数据库的权限:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ob oc l"/></div></figure><h2 id="d6bc" class="nh ml iq bd mm ni nj dn mq nk nl dp mu lo nm nn mw ls no np my lw nq nr na iw bi translated">3.4.执行查询</h2><p id="9135" class="pw-post-body-paragraph lf lg iq lh b li nc ka lk ll nd kd ln lo ne lq lr ls nf lu lv lw ng ly lz ma ij bi translated">现在，我们的远程数据库已经准备好了，我们可以开始使用 Python <code class="fe od oe of og b">pandas.read_sql()</code>从数据库表中获取一些数据。假设我们感兴趣的是获得每个乘客所在班级的存活率。下面是一个简单的带有内部连接的 SQL 查询:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="0a0a" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">使用 pandas 执行 SQL 非常方便，因为它将 SQL 查询读入数据帧:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oi"><img src="../Images/e49028723b67a71e38c9df67ae244837.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MIJPZCMAiC8rjPqemMJoLg.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk">The survival rate for each passenger’s class</figcaption></figure><h2 id="12a3" class="nh ml iq bd mm ni nj dn mq nk nl dp mu lo nm nn mw ls no np my lw nq nr na iw bi translated">删除数据库实例</h2><p id="0d60" class="pw-post-body-paragraph lf lg iq lh b li nc ka lk ll nd kd ln lo ne lq lr ls nf lu lv lw ng ly lz ma ij bi translated">最后的笔记。从 AWS 中删除不再使用的数据库实例是一个很好的做法。否则，你会因此而被收费。因此，您需要返回到 AWS RDS 控制台，选择您的实例并单击 Delete。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oj"><img src="../Images/747b48dc8778791e75688fc4ce648ca8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w7Y1_cqIYCuKSzNvVF_kdw.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk">Delete the database Instance</figcaption></figure></div><div class="ab cl ok ol hu om" role="separator"><span class="on bw bk oo op oq"/><span class="on bw bk oo op oq"/><span class="on bw bk oo op"/></div><div class="ij ik il im in"><p id="6402" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">我的带有处理过的数据集和笔记本的 repo 是<a class="ae le" href="https://github.com/ianap/aws_ec2_rds_examples" rel="noopener ugc nofollow" target="_blank">这里是</a>。</p></div></div>    
</body>
</html>