<html>
<head>
<title>Attach packages mindfully in R</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在 R 中小心地附加包</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/attach-packages-mindfully-in-r-b9c8151b3fb4?source=collection_archive---------23-----------------------#2019-06-24">https://towardsdatascience.com/attach-packages-mindfully-in-r-b9c8151b3fb4?source=collection_archive---------23-----------------------#2019-06-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="e448" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated"><strong class="ak">使用显式名称空间减少冲突，使您的源代码更加简洁，未来更加安全</strong></h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/3705f1a263474c2f32860354c8b6440e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iFK_lYyBb8whlYqjkJa-Yg.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">R packages exporting the same symbol lead to conflicts when imported into the global namespace (<a class="ae ky" href="https://pixabay.com/photos/package-packaging-shipping-carton-1511683/" rel="noopener ugc nofollow" target="_blank">Photo</a> by <a class="ae ky" href="https://pixabay.com/users/siala-719262/" rel="noopener ugc nofollow" target="_blank">Siala</a> on <a class="ae ky" href="https://pixabay.com" rel="noopener ugc nofollow" target="_blank">pixabay</a>)</figcaption></figure><p id="fdbb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi lv translated"><span class="l lw lx ly bm lz ma mb mc md di">当通过 library()调用在脚本顶部附加几个库时，R 中的一个常见问题就会出现。将所有符号加载到全局 R 环境中通常会导致名称冲突。最后导入的包赢得了战斗——<strong class="lb iu">顺序</strong>很重要，根据这个顺序，库出现在脚本的顶部！</span></p><p id="6c5d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">R 是一种快速发展的语言，有一个生动的社区贡献了无数的包(c.f. <a class="ae ky" href="https://rdrr.io/" rel="noopener ugc nofollow" target="_blank"> R 包文档</a>)。昨天的脚本很可能明天就不工作了，因为一个更新的包现在导出了一个与另一个全局附加包冲突的函数。</p><p id="4b3a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以我在这里提出<strong class="lb iu">注意使用</strong>将包附加到全局 R 环境中。尽量减少 library()调用，对其他包改用 requireNamespace()。使用<strong class="lb iu">显式名称空间</strong>比如</p><pre class="kj kk kl km gt me mf mg mh aw mi bi"><span id="c7d3" class="mj mk it mf b gy ml mm l mn mo">requireNamespace("lubridate") # at the top of your file<br/># ... some code<br/>lubridate::ymd(20190130)</span></pre><p id="6218" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">代替</p><pre class="kj kk kl km gt me mf mg mh aw mi bi"><span id="aa1e" class="mj mk it mf b gy ml mm l mn mo">library(lubridate) # at the top of your file<br/># ... some code<br/>ymd(20190130)</span></pre><p id="c5cb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">requireNamespace()加载包，将其留在自己的名称空间中。如果缺少所需的包，调用会产生异常。</p><p id="b27f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这可能看起来很尴尬。但是:它使代码更加简洁，并且在其他软件开发领域(例如 Python)被视为一种好习惯。<strong class="lb iu">否</strong>全局附件的候选对象可能是很少使用的函数或包，从而导致名称冲突。通常，我用重载操作符全局导入包，比如 dplyr 的% &gt; %操作符。</p><p id="57a3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">例如:</strong>我的一个脚本头看起来像这样:</p><pre class="kj kk kl km gt me mf mg mh aw mi bi"><span id="5933" class="mj mk it mf b gy ml mm l mn mo">library(dplyr)<br/>library(tidyr)<br/>library(readr)<br/>library(ggplot2)<br/>requireNamespace(“lubridate”)<br/>requireNamespace(“glue”)</span><span id="97c6" class="mj mk it mf b gy mp mm l mn mo"># here comes my code</span></pre><p id="9849" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用 data()调用的 package 参数从未附加的包中加载数据:</p><pre class="kj kk kl km gt me mf mg mh aw mi bi"><span id="a3c8" class="mj mk it mf b gy ml mm l mn mo">requireNamespace("psd")<br/>data(magnet, package = "psd")</span></pre><h2 id="47e0" class="mj mk it bd mq mr ms dn mt mu mv dp mw li mx my mz lm na nb nc lq nd ne nf ng bi translated">为什么 requireNamespace()很重要</h2><p id="5f7c" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated"><strong class="lb iu">不</strong>在顶部附加包的缺点是你的脚本可能会遇到这样的错误</p><pre class="kj kk kl km gt me mf mg mh aw mi bi"><span id="af7d" class="mj mk it mf b gy ml mm l mn mo">Error in loadNamespace(name) : there is no package called ‘lubridate’</span></pre><p id="ebd6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果当前的 R 安装缺少所需的包，则在稀有程序路径的深度。这让人很不舒服，也很意外！</p><p id="92f7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在像 R 或 Python 这样的动态类型语言中，确保软件完整性具有挑战性。编译语言在更早的时候抱怨缺少库:在编译时(如果静态链接)或者至少在启动应用程序时(如果动态链接)。</p><p id="00ed" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">警告:</strong>有些 R 包在没有全局附加它们的名称空间的情况下无法工作——所以在这些情况下，你必须使用 library()来代替。这个问题的一个例子是<a class="ae ky" href="https://cran.r-project.org/package=psd" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu"> psd </strong>包</a>(版本 1.2.0):</p><pre class="kj kk kl km gt me mf mg mh aw mi bi"><span id="d51f" class="mj mk it mf b gy ml mm l mn mo">data(magnet, package = "psd")<br/>x &lt;- magnet$clean<br/>spec &lt;- psd::pspectrum(x, plot = TRUE)</span></pre><p id="9b4e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">给出错误</p><pre class="kj kk kl km gt me mf mg mh aw mi bi"><span id="8872" class="mj mk it mf b gy ml mm l mn mo">Stage  0 est. (pilot)<br/>environment  ** .psdEnv **  refreshed<br/>detrending (and demeaning)<br/>Error in psdcore.default(as.vector(X.d), X.frq = frq, ...) :!is.null(ops) is not TRUE</span></pre></div><div class="ab cl nm nn hx no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="im in io ip iq"><h2 id="06a9" class="mj mk it bd mq mr ms dn mt mu mv dp mw li mx my mz lm na nb nc lq nd ne nf ng bi translated">结论</h2><p id="4adb" class="pw-post-body-paragraph kz la it lb b lc nh ju le lf ni jx lh li nj lk ll lm nk lo lp lq nl ls lt lu im bi translated">通过使用显式名称空间编写健壮而简洁的 R 脚本。此外，R 脚本对其他人来说可读性更好:函数在哪个包中被调用是很清楚的！</p></div></div>    
</body>
</html>