<html>
<head>
<title>How to use Jupyter on a Google Cloud VM</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在谷歌云虚拟机上使用 Jupyter</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-use-jupyter-on-a-google-cloud-vm-5ba1b473f4c2?source=collection_archive---------8-----------------------#2019-04-10">https://towardsdatascience.com/how-to-use-jupyter-on-a-google-cloud-vm-5ba1b473f4c2?source=collection_archive---------8-----------------------#2019-04-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="90c9" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">谷歌云平台上 AI 平台笔记本的菜谱</h2></div><p id="b8b8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">注意:本文中的方法仍然有效，但是我建议您现在使用笔记本 API。做:</p><p id="92f7" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="lb"> gcloud beta 笔记本-帮助</em></p><p id="239f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在 GCP 上启动笔记本最简单的方法是从 GCP 控制台浏览工作流程。进入 AI 平台，点击笔记本实例。您可以从用户界面创建新实例:</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div class="gh gi lc"><img src="../Images/9df460a20f53a17ea819e53476bf83c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1192/format:webp/1*ABWUnH7N21qWL9yKx7Z5Mw.png"/></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk">Create a new notebook instance from the UI</figcaption></figure><p id="9d41" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">实例启动后，您可以单击一个链接来打开 JupyterLab:</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="gh gi lo"><img src="../Images/e7367d38b39c6e3762055663316e2a94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0g_0LydkUxf9Y2CKBlvPTw.png"/></div></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk">Click on the blue link to open Jupyter Lab. Once you are done working for the day, Stop the VM. Then, restart. I tend to have different notebook instances for different projects.</figcaption></figure><p id="4fa3" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">当实例启动时，它有一个持久磁盘。那个磁盘可以装你的笔记本。您可以停止并重新启动虚拟机(从 GCP web 控制台)，而不会丢失这些笔记本。</p><p id="c3e8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">请注意，您可以从用户界面将 GPU 附加到笔记本实例:</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="gh gi lt"><img src="../Images/68d1440fc358bbe5b2b83d7e1e9c86d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CzrbzAiJAk_348OPkJBANA.png"/></div></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk">Attaching a GPU to a notebook instance</figcaption></figure><p id="a1c1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">尽情享受吧！</p><p id="ce5c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">本文收集了我使用笔记本实例的一些“诀窍”。</p><h1 id="7b88" class="lu lv iq bd lw lx ly lz ma mb mc md me jw mf jx mg jz mh ka mi kc mj kd mk ml bi translated">A.如何编写创建笔记本实例的脚本</h1><p id="69d8" class="pw-post-body-paragraph kf kg iq kh b ki mm jr kk kl mn ju kn ko mo kq kr ks mp ku kv kw mq ky kz la ij bi translated">该实例是一个计算引擎映像，因此如果您想要编写脚本、定制机器、更改防火墙规则等。您可以使用计算引擎功能。笔记本实例是一个<a class="ae mr" href="https://cloud.google.com/deep-learning-vm/docs/how-to" rel="noopener ugc nofollow" target="_blank">深度学习虚拟机</a>，这是一系列图像，提供了一种在谷歌云上启动带有/不带有 GPU 的虚拟机的便捷方式。它已经安装了 Jupyter Lab，你不需要代理或者 ssh 就可以访问它。</p><h2 id="c8a0" class="ms lv iq bd lw mt mu dn ma mv mw dp me ko mx my mg ks mz na mi kw nb nc mk nd bi translated">A1。使用 gcloud 启动深度学习虚拟机</h2><p id="fbeb" class="pw-post-body-paragraph kf kg iq kh b ki mm jr kk kl mn ju kn ko mo kq kr ks mp ku kv kw mq ky kz la ij bi translated">最简单的方法是指定一个图像族(参见<a class="ae mr" href="https://cloud.google.com/deep-learning-vm/docs/images" rel="noopener ugc nofollow" target="_blank">文档</a>了解可用的图像族)。例如，您可以使用以下方式获取 tensorflow-gpu 系列中附加了 P100 GPU 的最新图像:</p><pre class="ld le lf lg gt ne nf ng nh aw ni bi"><span id="7314" class="ms lv iq nf b gy nj nk l nl nm">IMAGE=<strong class="nf ir">--image-family=tf-latest-gpu</strong><br/>INSTANCE_NAME=dlvm<br/>GCP_<a class="ae mr" href="mailto:MAIL=google-cloud-customer@gmail.com" rel="noopener ugc nofollow" target="_blank">LOGIN_NAME=<strong class="nf ir">google-cloud-customer@gmail.com</strong></a>  # CHANGE THIS</span><span id="a7c8" class="ms lv iq nf b gy nn nk l nl nm">gcloud config set compute/zone <strong class="nf ir">us-central1-a</strong>  # CHANGE THIS</span><span id="4fb6" class="ms lv iq nf b gy nn nk l nl nm">gcloud compute instances create ${INSTANCE_NAME} \<br/>      --machine-type=<strong class="nf ir">n1-standard-8</strong> \<br/>      --scopes=<a class="ae mr" href="https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/userinfo.email" rel="noopener ugc nofollow" target="_blank">https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/userinfo.email</a> \<br/>      --min-cpu-platform="Intel Skylake" \<br/>      ${IMAGE} \<br/>      --image-project=deeplearning-platform-release \<br/>      --boot-disk-size=100GB \<br/>      --boot-disk-type=pd-ssd \ <br/>      --accelerator=<strong class="nf ir">type=nvidia-tesla-p100</strong>,count=1 \<br/>      --boot-disk-device-name=${INSTANCE_NAME} \<br/>      --maintenance-policy=TERMINATE --restart-on-failure \<br/>      --metadata="proxy-user-mail=${GCP_LOGIN_NAME}<strong class="nf ir">,install-nvidia-driver=True</strong>"</span></pre><h2 id="457b" class="ms lv iq bd lw mt mu dn ma mv mw dp me ko mx my mg ks mz na mi kw nb nc mk nd bi translated">A2。获取 Jupyter 实验室的网址</h2><p id="17e7" class="pw-post-body-paragraph kf kg iq kh b ki mm jr kk kl mn ju kn ko mo kq kr ks mp ku kv kw mq ky kz la ij bi translated">用于访问 Jupyter Lab 的 URL 是您刚刚启动的虚拟机的元数据的一部分。您可以通过以下方式获得:</p><pre class="ld le lf lg gt ne nf ng nh aw ni bi"><span id="faac" class="ms lv iq nf b gy nj nk l nl nm">gcloud compute instances describe ${INSTANCE_NAME} | grep dot-datalab-vm</span></pre><p id="b616" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">下面是一个脚本，它将执行第 1 步和第 2 步，一直等到 Jupyter 笔记本服务器启动:</p><pre class="ld le lf lg gt ne nf ng nh aw ni bi"><span id="38a6" class="ms lv iq nf b gy nj nk l nl nm">#!/bin/bash</span><span id="de78" class="ms lv iq nf b gy nn nk l nl nm">IMAGE=--image-family=tf-latest-cpu<br/>INSTANCE_NAME=dlvm<br/>GCP_<a class="ae mr" href="mailto:MAIL=google-cloud-customer@gmail.com" rel="noopener ugc nofollow" target="_blank">LOGIN_NAME</a><a class="ae mr" href="mailto:MAIL=vlakshmanan@google.com" rel="noopener ugc nofollow" target="_blank">=google-cloud-customer@gmail.com</a>  # CHANGE THIS</span><span id="6bab" class="ms lv iq nf b gy nn nk l nl nm">gcloud config set compute/zone <strong class="nf ir">us-central1-a</strong>  # CHANGE THIS</span><span id="1f7c" class="ms lv iq nf b gy nn nk l nl nm">echo "Launching $INSTANCE_NAME"<br/>gcloud compute instances create ${INSTANCE_NAME} \<br/>      --machine-type=n1-standard-2 \<br/>      --scopes=<a class="ae mr" href="https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/userinfo.email" rel="noopener ugc nofollow" target="_blank">https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/userinfo.email</a> \<br/>      ${IMAGE} \<br/>      --image-project=deeplearning-platform-release \<br/>      --boot-disk-device-name=${INSTANCE_NAME} \<br/>      --metadata="proxy-user-mail=${GCP_<a class="ae mr" href="mailto:MAIL=google-cloud-customer@gmail.com" rel="noopener ugc nofollow" target="_blank">LOGIN_NAME</a>}"</span><span id="f6cb" class="ms lv iq nf b gy nn nk l nl nm">echo "Looking for Jupyter URL on $INSTANCE_NAME"<br/>while true; do<br/>   proxy=$(gcloud compute instances describe ${INSTANCE_NAME} 2&gt; /dev/null | grep dot-datalab-vm)<br/>   if [ -z "$proxy" ]<br/>   then<br/>      echo -n "."<br/>      sleep 1<br/>   else<br/>      echo "done!"<br/>      echo "$proxy"<br/>      break<br/>   fi<br/>done</span></pre><h2 id="785c" class="ms lv iq bd lw mt mu dn ma mv mw dp me ko mx my mg ks mz na mi kw nb nc mk nd bi translated">A3。在 web 浏览器中访问 URL</h2><p id="75c6" class="pw-post-body-paragraph kf kg iq kh b ki mm jr kk kl mn ju kn ko mo kq kr ks mp ku kv kw mq ky kz la ij bi translated">只需导航到那个网址，你就会进入 JupyterLab。</p><h1 id="3e3b" class="lu lv iq bd lw lx ly lz ma mb mc md me jw mf jx mg jz mh ka mi kc mj kd mk ml bi translated">B.如何在笔记本实例上使用 Git</h1><h2 id="2633" class="ms lv iq bd lw mt mu dn ma mv mw dp me ko mx my mg ks mz na mi kw nb nc mk nd bi translated">B1。Git 交互式克隆存储库</h2><p id="1b82" class="pw-post-body-paragraph kf kg iq kh b ki mm jr kk kl mn ju kn ko mo kq kr ks mp ku kv kw mq ky kz la ij bi translated">单击左侧窗格中图标带的最后一个图标，您将能够 git 克隆一个存储库。用我书里的那个:</p><p id="0e8a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><a class="ae mr" href="https://github.com/GoogleCloudPlatform/data-science-on-gcp" rel="noopener ugc nofollow" target="_blank">https://github.com/GoogleCloudPlatform/data-science-on-gcp</a></p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="gh gi no"><img src="../Images/a2043e7e82011ea3465256b5172d90c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SyZIBHRSZZUrdo4NhoyrcA.png"/></div></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk">Running a Jupyter notebook on a cloud VM without any ssh tunnels or proxies</figcaption></figure><p id="72e5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">导航到 updates/cloudml 并打开 flights_model.ipynb。您应该能够浏览笔记本。</p><p id="b6e8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">你也可以打开一个终端，使用 git 克隆、git 检验、git 推送等等。我倾向于发现它比使用内置的 Git UI 更容易。但是您的里程可能会有所不同！</p><h1 id="f43f" class="lu lv iq bd lw lx ly lz ma mb mc md me jw mf jx mg jz mh ka mi kc mj kd mk ml bi translated">C.如何指定启动脚本</h1><p id="173f" class="pw-post-body-paragraph kf kg iq kh b ki mm jr kk kl mn ju kn ko mo kq kr ks mp ku kv kw mq ky kz la ij bi translated">您可以指定一组在 Jupyter 启动后运行的操作。这些将以 root 用户身份运行。</p><pre class="ld le lf lg gt ne nf ng nh aw ni bi"><span id="3444" class="ms lv iq nf b gy nj nk l nl nm">IMAGE=<strong class="nf ir">--image-family=tf-latest-gpu</strong><br/>INSTANCE_NAME=dlvm<br/>GCP_<a class="ae mr" href="mailto:MAIL=google-cloud-customer@gmail.com" rel="noopener ugc nofollow" target="_blank">LOGIN_NAME=<strong class="nf ir">google-cloud-customer@gmail.com</strong></a>  # CHANGE THIS<br/>STARTUP_SCRIPT="git clone <a class="ae mr" href="https://github.com/GoogleCloudPlatform/data-science-on-gcp" rel="noopener ugc nofollow" target="_blank">https://github.com/GoogleCloudPlatform/data-science-on-gcp</a>"</span><span id="3202" class="ms lv iq nf b gy nn nk l nl nm">gcloud config set compute/zone <strong class="nf ir">us-central1-a</strong>  # CHANGE THIS</span><span id="b4f4" class="ms lv iq nf b gy nn nk l nl nm">gcloud compute instances create ${INSTANCE_NAME} \<br/>      --machine-type=<strong class="nf ir">n1-standard-8</strong> \<br/>      --scopes=<a class="ae mr" href="https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/userinfo.email" rel="noopener ugc nofollow" target="_blank">https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/userinfo.email</a> \<br/>      --min-cpu-platform="Intel Skylake" \<br/>      ${IMAGE} \<br/>      --image-project=deeplearning-platform-release \<br/>      --boot-disk-size=100GB \<br/>      --boot-disk-type=pd-ssd \ <br/>      --accelerator=type=nvidia-tesla-p100,count=1 \<br/>      --boot-disk-device-name=${INSTANCE_NAME} \<br/>      --maintenance-policy=TERMINATE --restart-on-failure \<br/>      --metadata="proxy-user-mail=${GCP_LOGIN_NAME}<strong class="nf ir">,</strong>install-nvidia-driver=True,<strong class="nf ir">startup-script=${STARTUP_SCRIPT}</strong>"</span></pre><h1 id="9ea4" class="lu lv iq bd lw lx ly lz ma mb mc md me jw mf jx mg jz mh ka mi kc mj kd mk ml bi translated">D.如何安排笔记本</h1><h2 id="7051" class="ms lv iq bd lw mt mu dn ma mv mw dp me ko mx my mg ks mz na mi kw nb nc mk nd bi translated">D1。转移到生产时，使用映像，而不是映像系列</h2><p id="5a15" class="pw-post-body-paragraph kf kg iq kh b ki mm jr kk kl mn ju kn ko mo kq kr ks mp ku kv kw mq ky kz la ij bi translated">一般来说，使用映像系列方法进行开发(这样您就可以一直使用最新的东西进行开发)，但是一旦您将产品化，就要使用特定的映像。您希望在产品中固定一个特定映像的原因是，您希望在一个已经实际测试过代码的版本上运行。</p><p id="54ea" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">获取图像列表并找到您正在使用的图像(您在上面指定的图像系列中的最新图像):</p><pre class="ld le lf lg gt ne nf ng nh aw ni bi"><span id="3ad7" class="ms lv iq nf b gy nj nk l nl nm">gcloud compute images list \<br/>   --project deeplearning-platform-release \<br/>   --no-standard-images</span></pre><p id="4bef" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，在创建深度学习虚拟机时指定它(您可能想要更改的行以粗体显示):</p><pre class="ld le lf lg gt ne nf ng nh aw ni bi"><span id="7783" class="ms lv iq nf b gy nj nk l nl nm">IMAGE=--image=<strong class="nf ir">tf-latest-cpu-20190125b2</strong> # CHANGE<br/>INSTANCE_NAME=<strong class="nf ir">dlvm</strong><br/>GCP_<a class="ae mr" href="mailto:MAIL=google-cloud-customer@gmail.com" rel="noopener ugc nofollow" target="_blank">LOGIN_NAME</a><a class="ae mr" href="mailto:MAIL=vlakshmanan@google.com" rel="noopener ugc nofollow" target="_blank">=<strong class="nf ir">google-cloud-customer@gmail.com</strong></a>  # CHANGE THIS<br/>ZONE="us-central1-b"  # CHANGE</span><span id="61f5" class="ms lv iq nf b gy nn nk l nl nm">gcloud compute instances create ${INSTANCE_NAME} \<br/>      --machine-type=<strong class="nf ir">n1-standard-8 \<br/>      </strong>--zone=$ZONE \<br/>      --scopes=<a class="ae mr" href="https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/userinfo.email" rel="noopener ugc nofollow" target="_blank">https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/userinfo.email</a> \<br/>      --min-cpu-platform="Intel Skylake" \<br/>      ${IMAGE} \<br/>      --image-project=deeplearning-platform-release \<br/>      --boot-disk-size=<strong class="nf ir">100GB \</strong><br/>      --boot-disk-type=pd-ssd \<br/>      --boot-disk-device-name=${INSTANCE_NAME} \<br/>      --metadata="proxy-user-mail=${GCP_<a class="ae mr" href="mailto:MAIL=google-cloud-customer@gmail.com" rel="noopener ugc nofollow" target="_blank">LOGIN_NAME</a>}"</span></pre><h2 id="4e81" class="ms lv iq bd lw mt mu dn ma mv mw dp me ko mx my mg ks mz na mi kw nb nc mk nd bi translated">D2。使用 papermill 提交计划执行的笔记本</h2><p id="dee3" class="pw-post-body-paragraph kf kg iq kh b ki mm jr kk kl mn ju kn ko mo kq kr ks mp ku kv kw mq ky kz la ij bi translated">这里的关键点是使用启动脚本启动 papermill，并在 papermill 完成后使用 TERMINATE 退出笔记本虚拟机，而不需要在出现故障时重启。然后，删除该虚拟机。更多详情见这篇<a class="ae mr" href="https://cloud.google.com/blog/products/ai-machine-learning/let-deep-learning-vms-and-jupyter-notebooks-to-burn-the-midnight-oil-for-you-robust-and-automated-training-with-papermill" rel="noopener ugc nofollow" target="_blank">博文</a>。</p><pre class="ld le lf lg gt ne nf ng nh aw ni bi"><span id="15f5" class="ms lv iq nf b gy nj nk l nl nm"># Compute Engine Instance parameters<br/>IMAGE=--image=tf-latest-gpu-20190125b2 # CHANGE<br/>INSTANCE_NAME=dlvm<br/>ZONE="us-central1-b"  # CHANGE<br/>INSTANCE_TYPE="n1-standard-4"  #CHANGE<br/># Notebook parameters<br/>GCS_INPUT_NOTEBOOK="gs://my-bucket/input.ipynb"<br/>GCS_OUTPUT_NOTEBOOK="gs://my-bucket/output.ipynb"<br/>GCS_INPUT_PARAMS="gs://my-bucket/params.yaml" # Optional<br/><strong class="nf ir">export STARTUP_SCRIPT="</strong><a class="ae mr" href="https://raw.githubusercontent.com/GoogleCloudPlatform/ml-on-gcp/master/dlvm/tools/scripts/notebook_executor.sh" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/GoogleCloudPlatform/ml-on-gcp/master/dlvm/tools/scripts/notebook_executor.sh</a><strong class="nf ir">"</strong><br/><br/>gcloud compute instances create $INSTANCE_NAME \<br/>        --zone=$ZONE \<br/>        --image=$IMAGE \<br/>        --image-project=deeplearning-platform-release \<br/>       <strong class="nf ir"> --maintenance-policy=TERMINATE</strong> \<br/>        --accelerator='type=nvidia-tesla-t4,count=2' \<br/>        --machine-type=$INSTANCE_TYPE \<br/>        --boot-disk-size=100GB \<br/>        --scopes=https://www.googleapis.com/auth/cloud-platform \<br/>        --metadata="<!-- -->input_notebook_path=${GCS_INPUT_NOTEBOOK},output_notebook_path=${GCS_OUTPUT_NOTEBOOK},parameters_file=${GCS_INPUT_PARAMS},startup-script-url=$LAUNCHER_SCRIPT<!-- -->,<strong class="nf ir">startup-script=${STARTUP_SCRIPT}</strong>"<br/><br/>gcloud --quiet compute instances delete $INSTANCE_NAME --zone $ZONE</span></pre><h1 id="80ba" class="lu lv iq bd lw lx ly lz ma mb mc md me jw mf jx mg jz mh ka mi kc mj kd mk ml bi translated">E.如何使用 Jupyter 的 TPU</h1><p id="30c2" class="pw-post-body-paragraph kf kg iq kh b ki mm jr kk kl mn ju kn ko mo kq kr ks mp ku kv kw mq ky kz la ij bi translated">要创建附加到 TPU 的深度学习虚拟机，首先创建深度学习虚拟机，然后创建具有相同 TensorFlow 版本的 TPU:</p><pre class="ld le lf lg gt ne nf ng nh aw ni bi"><span id="56b2" class="ms lv iq nf b gy nj nk l nl nm">INSTANCE_NAME=<strong class="nf ir">laktpu</strong>   # CHANGE THIS<br/>GCP_<a class="ae mr" href="mailto:MAIL=google-cloud-customer@gmail.com" rel="noopener ugc nofollow" target="_blank">LOGIN_NAME</a><a class="ae mr" href="mailto:MAIL=vlakshmanan@google.com" rel="noopener ugc nofollow" target="_blank">=<strong class="nf ir">google-cloud-customer@gmail.com</strong></a>  # CHANGE THIS</span><span id="4bd0" class="ms lv iq nf b gy nn nk l nl nm">gcloud config set compute/zone <strong class="nf ir">us-central1-a</strong>  # CHANGE THIS</span><span id="0868" class="ms lv iq nf b gy nn nk l nl nm">TPU_NAME=$INSTANCE_NAME<br/>gcloud compute instances create $INSTANCE_NAME \<br/>--machine-type n1-standard-8 \<br/>--image-project deeplearning-platform-release \<br/>--image-family <strong class="nf ir">tf-1-12-cpu</strong> \<br/>--scopes cloud-platform \<br/>--metadata proxy-user-mail="${GCP_<a class="ae mr" href="mailto:MAIL=google-cloud-customer@gmail.com" rel="noopener ugc nofollow" target="_blank">LOGIN_NAME</a>}",\<br/>startup-script="echo export TPU_NAME=$TPU_NAME &gt; /etc/profile.d/tpu-env.sh"</span><span id="2ab2" class="ms lv iq nf b gy nn nk l nl nm">gcloud compute tpus create $TPU_NAME \<br/>  --network default \<br/>  --range 10.240.1.0 \<br/>  --version <strong class="nf ir">1.12</strong></span></pre><p id="7bce" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">创建深度学习虚拟机时唯一的区别是，您在启动脚本中指定了 TPU 名称。</p><h1 id="ce88" class="lu lv iq bd lw lx ly lz ma mb mc md me jw mf jx mg jz mh ka mi kc mj kd mk ml bi translated">F.如何在笔记本电脑中使用最终用户凭据</h1><p id="641e" class="pw-post-body-paragraph kf kg iq kh b ki mm jr kk kl mn ju kn ko mo kq kr ks mp ku kv kw mq ky kz la ij bi translated">如果你创建了一个深度学习虚拟机，并且你指定了一个 GCP 登录名(除了生产虚拟机之外，我上面的所有例子都是这样做的)，那么只有你(和项目管理员)能够通过 ssh 进入虚拟机。</p><p id="1f7a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所有 Jupyter 笔记本都将在一个服务帐户下运行。在大多数情况下，这没问题，但是如果您需要运行服务帐户没有权限执行的操作，您可以通过执行以下操作让 Jupyter 中的代码以您的身份运行:</p><ul class=""><li id="c857" class="np nq iq kh b ki kj kl km ko nr ks ns kw nt la nu nv nw nx bi translated">在启动菜单中，打开一个终端</li><li id="7b5e" class="np nq iq kh b ki ny kl nz ko oa ks ob kw oc la nu nv nw nx bi translated">在终端中，键入:</li></ul><pre class="ld le lf lg gt ne nf ng nh aw ni bi"><span id="1b32" class="ms lv iq nf b gy nj nk l nl nm">gcloud auth application-default login</span></pre><ul class=""><li id="6e68" class="np nq iq kh b ki kj kl km ko nr ks ns kw nt la nu nv nw nx bi translated">按照提示执行 OAuth2</li><li id="1552" class="np nq iq kh b ki ny kl nz ko oa ks ob kw oc la nu nv nw nx bi translated">如有必要，重启 Jupyter 内核</li></ul><p id="3290" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">注意</strong>:不要使用最终用户凭证，除非您在“单用户模式”下启动机器。</p><h1 id="5bdc" class="lu lv iq bd lw lx ly lz ma mb mc md me jw mf jx mg jz mh ka mi kc mj kd mk ml bi translated">G.如何创建 TF-nightly 虚拟机</h1><p id="f827" class="pw-post-body-paragraph kf kg iq kh b ki mm jr kk kl mn ju kn ko mo kq kr ks mp ku kv kw mq ky kz la ij bi translated">在 tf-latest 系列中创建映像使用最新的稳定 TensorFlow 版本。要使用 TF-nightly(例如，这就是如何获得 TensorFlow 2.0-alpha)，请使用:</p><pre class="ld le lf lg gt ne nf ng nh aw ni bi"><span id="0984" class="ms lv iq nf b gy nj nk l nl nm">INSTANCE_NAME=<strong class="nf ir">tfnightly</strong>   # CHANGE THIS<br/>GCP_<a class="ae mr" href="mailto:MAIL=google-cloud-customer@gmail.com" rel="noopener ugc nofollow" target="_blank">LOGIN_NAME</a><a class="ae mr" href="mailto:MAIL=vlakshmanan@google.com" rel="noopener ugc nofollow" target="_blank">=<strong class="nf ir">google-cloud-customer@gmail.com</strong></a>  # CHANGE THIS<br/>ZONE="us-west1-b" # CHANGE THIS<br/>INSTANCE_TYPE="n1-standard-4" # CHANGE THIS</span><span id="d492" class="ms lv iq nf b gy nn nk l nl nm">gcloud compute instances create ${INSTANCE_NAME} \<br/>      --machine-type=$INSTANCE_TYPE \<br/>      --zone=$ZONE \<br/>      --scopes=<a class="ae mr" href="https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/userinfo.email" rel="noopener ugc nofollow" target="_blank">https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/userinfo.email</a> \<br/>      --min-cpu-platform="Intel Skylake" \<br/>      --image-family="<strong class="nf ir">tf-latest-gpu-experimental</strong>" \<br/>      --image-project=deeplearning-platform-release \<br/>      --boot-disk-size=100GB \<br/>      --boot-disk-type=pd-ssd \<br/>      --accelerator=type=nvidia-tesla-p100,count=1 \<br/>      --boot-disk-device-name=${INSTANCE_NAME} \<br/>      --maintenance-policy=TERMINATE --restart-on-failure \<br/>      --metadata="proxy-user-mail=${GCP_LOGIN_NAME},install-nvidia-driver=True"</span></pre><h1 id="dfc2" class="lu lv iq bd lw lx ly lz ma mb mc md me jw mf jx mg jz mh ka mi kc mj kd mk ml bi translated">H.Jupyter 故障排除</h1><p id="4b16" class="pw-post-body-paragraph kf kg iq kh b ki mm jr kk kl mn ju kn ko mo kq kr ks mp ku kv kw mq ky kz la ij bi translated"><strong class="kh ir">重启 Jupyter: </strong>通常你需要做的就是点击笔记本菜单里的图标重启内核。但是偶尔，你可能会彻底破坏环境，想要重启 Jupyter。为此，转到 GCP 控制台的计算实例部分，并单击与您的笔记本实例对应的 SSH 按钮。在 SSH 窗口中，键入:</p><pre class="ld le lf lg gt ne nf ng nh aw ni bi"><span id="c7ea" class="ms lv iq nf b gy nj nk l nl nm">sudo service jupyter restart</span></pre><p id="88f3" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">启动日志:</strong>如果 Jupyter 启动失败，或者你没有得到笔记本链接，你可能要查看完整的日志(包括启动日志)。使用以下方式完成:</p><pre class="ld le lf lg gt ne nf ng nh aw ni bi"><span id="9329" class="ms lv iq nf b gy nj nk l nl nm">gcloud compute instances \<br/>    get-serial-port-output --zone $ZONE $INSTANCE_NAME</span></pre><h1 id="1a4b" class="lu lv iq bd lw lx ly lz ma mb mc md me jw mf jx mg jz mh ka mi kc mj kd mk ml bi translated">一.使用 conda</h1><p id="7b4b" class="pw-post-body-paragraph kf kg iq kh b ki mm jr kk kl mn ju kn ko mo kq kr ks mp ku kv kw mq ky kz la ij bi translated">张量流图像使用 pip，但 PyTorch 图像使用 conda。所以，如果你想使用 conda，PyTorch 图像是一个更好的起点。</p><h2 id="6db7" class="ms lv iq bd lw mt mu dn ma mv mw dp me ko mx my mg ks mz na mi kw nb nc mk nd bi translated">J.如何在本地运行笔记本实例</h2><p id="3914" class="pw-post-body-paragraph kf kg iq kh b ki mm jr kk kl mn ju kn ko mo kq kr ks mp ku kv kw mq ky kz la ij bi translated">如果您想在本地机器上使用深度学习 VM 容器映像进行开发，可以使用 Docker:</p><pre class="ld le lf lg gt ne nf ng nh aw ni bi"><span id="0aa0" class="ms lv iq nf b gy nj nk l nl nm">IMAGE_NAME="gcr.io/deeplearning-platform-release/tf-latest-cpu"<br/>docker pull "${IMAGE_NAME}"<br/>docker run -p 127.0.0.1:8080:8080/tcp -v "${HOME}:/home" \<br/>            "${IMAGE_NAME}"</span></pre><p id="a228" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您的本地机器上有一个 GPU，请将映像名称从 tf-latest-cpu 更改为 tf-latest-cu100。</p><p id="fc35" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi">__________________________________________________</p><p id="3c3f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我对这些食谱很感兴趣。如果您对我应该添加的问题/答案有任何建议，请联系我。为了方便起见，这里有一个包含所有代码的<a class="ae mr" href="https://gist.github.com/lakshmanok/f3f91d2965299c7c7a043824622c5890" rel="noopener ugc nofollow" target="_blank">要点</a>。</p></div></div>    
</body>
</html>