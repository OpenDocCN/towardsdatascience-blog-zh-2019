<html>
<head>
<title>Detecting soccer players and ball with RetinaNet.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用视网膜网探测足球运动员和球。</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/detecting-soccer-palyers-and-ball-retinantet-2ab5f997ab2?source=collection_archive---------18-----------------------#2019-10-19">https://towardsdatascience.com/detecting-soccer-palyers-and-ball-retinantet-2ab5f997ab2?source=collection_archive---------18-----------------------#2019-10-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="a7cc" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">用于体育运动的计算机视觉</h2><div class=""/><div class=""><h2 id="5c63" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">直截了当的指南，建立一个计算机视觉模型，以检测球员和球在架空摄像机图像。</h2></div><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="kw kx l"/></div></figure><p id="92cc" class="pw-post-body-paragraph ky kz it la b lb lc kd ld le lf kg lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们将使用 RetinaNet 模型，如<a class="ae lu" href="https://arxiv.org/search/cs?searchtype=author&amp;query=Lin%2C+T" rel="noopener ugc nofollow" target="_blank">宗-林逸</a>、<a class="ae lu" href="https://arxiv.org/search/cs?searchtype=author&amp;query=Goyal%2C+P" rel="noopener ugc nofollow" target="_blank">普里亚戈亚尔</a>、<a class="ae lu" href="https://arxiv.org/search/cs?searchtype=author&amp;query=Girshick%2C+R" rel="noopener ugc nofollow" target="_blank">罗斯·吉希克</a>、<a class="ae lu" href="https://arxiv.org/search/cs?searchtype=author&amp;query=He%2C+K" rel="noopener ugc nofollow" target="_blank">明凯·何</a>、<a class="ae lu" href="https://arxiv.org/search/cs?searchtype=author&amp;query=Doll%C3%A1r%2C+P" rel="noopener ugc nofollow" target="_blank">彼得·多拉</a>的论文<a class="ae lu" href="https://arxiv.org/abs/1708.02002" rel="noopener ugc nofollow" target="_blank">中所述。</a></p><p id="f71f" class="pw-post-body-paragraph ky kz it la b lb lc kd ld le lf kg lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们还将使用 Fizyr 对<a class="ae lu" href="https://github.com/fizyr/keras-retinanet" rel="noopener ugc nofollow" target="_blank"> keras-retinanet </a>的出色实现，将其应用于 Haizaha 的<a class="ae lu" href="https://haizaha.com/datasets/soccer-player-and-ball-localization" rel="noopener ugc nofollow" target="_blank">足球运动员和球检测</a>免费数据集。</p><h1 id="bf98" class="lv lw it bd lx ly lz ma mb mc md me mf ki mg kj mh kl mi km mj ko mk kp ml mm bi translated"><strong class="ak">要求</strong>:</h1><p id="21a2" class="pw-post-body-paragraph ky kz it la b lb mn kd ld le mo kg lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">首先，确保安装了 TensorFlow 和 Keras。</p><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="ms kx l"/></div></figure><p id="1881" class="pw-post-body-paragraph ky kz it la b lb lc kd ld le lf kg lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您需要 GPU 支持，请遵循<a class="ae lu" href="https://www.tensorflow.org/install/gpu" rel="noopener ugc nofollow" target="_blank">tensorflow.org</a>上的说明。</p><p id="be1b" class="pw-post-body-paragraph ky kz it la b lb lc kd ld le lf kg lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">接下来，您将需要克隆、构建和安装<a class="ae lu" href="https://github.com/fizyr/keras-retinanet" rel="noopener ugc nofollow" target="_blank"> keras-retinanet </a>项目。</p><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="ms kx l"/></div></figure><h1 id="9b13" class="lv lw it bd lx ly lz ma mb mc md me mf ki mg kj mh kl mi km mj ko mk kp ml mm bi translated"><strong class="ak">数据</strong></h1><p id="012f" class="pw-post-body-paragraph ky kz it la b lb mn kd ld le mo kg lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">安装完所有依赖项后，下一步是下载标记为的<a class="ae lu" href="https://haizaha.com/datasets/soccer-player-and-ball-localization" rel="noopener ugc nofollow" target="_blank">图片。</a></p><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="ms kx l"/></div></figure><h1 id="4094" class="lv lw it bd lx ly lz ma mb mc md me mf ki mg kj mh kl mi km mj ko mk kp ml mm bi translated"><strong class="ak">预训练重量</strong></h1><p id="7252" class="pw-post-body-paragraph ky kz it la b lb mn kd ld le mo kg lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">我已经公开了我的训练重量。如果您想立即运行模型，以下是下载它们的方法。</p><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="ms kx l"/></div></figure><h1 id="2ccd" class="lv lw it bd lx ly lz ma mb mc md me mf ki mg kj mh kl mi km mj ko mk kp ml mm bi translated"><strong class="ak">进口</strong></h1><p id="a07a" class="pw-post-body-paragraph ky kz it la b lb mn kd ld le mo kg lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">我们需要导入 TensorFlow、Keras、keras_retinanet，以及其他一些模块。</p><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="ms kx l"/></div></figure><h1 id="13cc" class="lv lw it bd lx ly lz ma mb mc md me mf ki mg kj mh kl mi km mj ko mk kp ml mm bi translated"><strong class="ak">实用程序</strong></h1><ul class=""><li id="aa00" class="mt mu it la b lb mn le mo lh mv ll mw lp mx lt my mz na nb bi translated"><strong class="la jd">查看注释:</strong></li></ul><p id="a91d" class="pw-post-body-paragraph ky kz it la b lb lc kd ld le lf kg lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们将使用下面的 view_annotations 函数来显示带有相关边界框注释的图像。</p><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="ms kx l"/></div></figure><p id="e0f2" class="pw-post-body-paragraph ky kz it la b lb lc kd ld le lf kg lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果您运行以下命令:</p><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="ms kx l"/></div></figure><p id="8ed7" class="pw-post-body-paragraph ky kz it la b lb lc kd ld le lf kg lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您应该会得到如下图像:</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nc"><img src="../Images/775aa6f834f5d4156ccf25773162d593.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hgJHgN18SNy8cOE4NQeh1Q.png"/></div></div><figcaption class="nj nk gj gh gi nl nm bd b be z dk">Output of view_annotations()</figcaption></figure><ul class=""><li id="92c8" class="mt mu it la b lb lc le lf lh nn ll no lp np lt my mz na nb bi translated"><strong class="la jd">加载模型:</strong></li></ul><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="ms kx l"/></div></figure><ul class=""><li id="0369" class="mt mu it la b lb lc le lf lh nn ll no lp np lt my mz na nb bi translated"><strong class="la jd">用模型对图像进行检测</strong></li></ul><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="ms kx l"/></div></figure><h1 id="1fab" class="lv lw it bd lx ly lz ma mb mc md me mf ki mg kj mh kl mi km mj ko mk kp ml mm bi translated"><strong class="ak">推论</strong></h1><p id="88f0" class="pw-post-body-paragraph ky kz it la b lb mn kd ld le mo kg lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">既然我们已经创建了助手函数，我们需要做的就是调用它们来加载模型并在图像上运行它。</p><p id="a2aa" class="pw-post-body-paragraph ky kz it la b lb lc kd ld le lf kg lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">加载模型:</p><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="ms kx l"/></div></figure><p id="edb2" class="pw-post-body-paragraph ky kz it la b lb lc kd ld le lf kg lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">使用模型检测球员和球:</p><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="ms kx l"/></div></figure><p id="63b8" class="pw-post-body-paragraph ky kz it la b lb lc kd ld le lf kg lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Run_detection 采用我们使用权重“pre-trained/resnet 50 _ CSV _ last _ inference . H5”创建的模型，并在“soccer/images/frame_0100.jpg”上运行该模型</p><p id="e96f" class="pw-post-body-paragraph ky kz it la b lb lc kd ld le lf kg lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您应该得到这样的结果:</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nc"><img src="../Images/e55b1c0eff781fce3b99d6bf873cf927.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q_3J7iv7Mje8f8xBB-EIyA.png"/></div></div><figcaption class="nj nk gj gh gi nl nm bd b be z dk">Output of run_detection()</figcaption></figure><h1 id="3583" class="lv lw it bd lx ly lz ma mb mc md me mf ki mg kj mh kl mi km mj ko mk kp ml mm bi translated"><strong class="ak">训练</strong></h1><p id="b7d0" class="pw-post-body-paragraph ky kz it la b lb mn kd ld le mo kg lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">要训练您的模型，您需要做的就是执行 train.py 脚本:</p><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="ms kx l"/></div></figure><p id="837b" class="pw-post-body-paragraph ky kz it la b lb lc kd ld le lf kg lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">模型训练应该开始，您应该会看到类似这样的内容:</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nq"><img src="../Images/fc3fa463535dd40eda42065ca2d91521.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zJGiJcqxpZCDzPsEIQfWLg.png"/></div></div><figcaption class="nj nk gj gh gi nl nm bd b be z dk">Screenshot: training progress in the terminal</figcaption></figure><h1 id="9c16" class="lv lw it bd lx ly lz ma mb mc md me mf ki mg kj mh kl mi km mj ko mk kp ml mm bi translated">监测培训进展</h1><p id="5da9" class="pw-post-body-paragraph ky kz it la b lb mn kd ld le mo kg lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">TensorBoard 提供了一个简洁的网络界面来监控你的模型学习。要运行它，您只需在终端中运行以下代码:</p><pre class="kr ks kt ku gt nr ns nt nu aw nv bi"><span id="6612" class="nw lw it ns b gy nx ny l nz oa">tensorboard --logdir logs/fit</span></pre><p id="e657" class="pw-post-body-paragraph ky kz it la b lb lc kd ld le lf kg lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您希望确保<strong class="la jd"> logs/fit </strong>指向</p><p id="80a1" class="pw-post-body-paragraph ky kz it la b lb lc kd ld le lf kg lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，您可以在浏览器上访问以下 URL:</p><pre class="kr ks kt ku gt nr ns nt nu aw nv bi"><span id="9b4d" class="nw lw it ns b gy nx ny l nz oa">http://you_ir_address:6006</span></pre><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi ob"><img src="../Images/827ab13e582e21956c1377f31273b343.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wj3NeaN4ghzH-7dZ3UAlsg.jpeg"/></div></div><figcaption class="nj nk gj gh gi nl nm bd b be z dk">Screenshot: TensorBoard</figcaption></figure><h1 id="ccff" class="lv lw it bd lx ly lz ma mb mc md me mf ki mg kj mh kl mi km mj ko mk kp ml mm bi translated"><strong class="ak">转换培训模式</strong></h1><p id="134a" class="pw-post-body-paragraph ky kz it la b lb mn kd ld le mo kg lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">训练完模型后，您需要将训练模型转换为推理模型，然后才能使用它来检测对象。</p><p id="cbbf" class="pw-post-body-paragraph ky kz it la b lb lc kd ld le lf kg lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">下面是如何将训练模型转换为推理模型:</p><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="ms kx l"/></div></figure><h1 id="bfdd" class="lv lw it bd lx ly lz ma mb mc md me mf ki mg kj mh kl mi km mj ko mk kp ml mm bi translated">运行新训练的模型</h1><p id="2731" class="pw-post-body-paragraph ky kz it la b lb mn kd ld le mo kg lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">现在，您可以加载新训练的模型并再次运行检测:</p><figure class="kr ks kt ku gt kv"><div class="bz fp l di"><div class="ms kx l"/></div></figure><p id="b64d" class="pw-post-body-paragraph ky kz it la b lb lc kd ld le lf kg lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您应该会从上面的代码中得到以下输出:</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="gh gi nc"><img src="../Images/315103516c19db2c19397434508a6ada.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3JZVvagvy-nG7aLeqPBBAQ.png"/></div></div><figcaption class="nj nk gj gh gi nl nm bd b be z dk">Output of run_detection() after re-training the model</figcaption></figure><h1 id="7dae" class="lv lw it bd lx ly lz ma mb mc md me mf ki mg kj mh kl mi km mj ko mk kp ml mm bi translated">优化:检测小物体具有挑战性</h1><p id="502f" class="pw-post-body-paragraph ky kz it la b lb mn kd ld le mo kg lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">在过去的几年里，我们在物体探测任务上取得了令人印象深刻的进展。尽管如此，与检测大对象相比，今天的模型仍然难以检测图像中的小对象。</p><figure class="kr ks kt ku gt kv gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/240873cd9485b99e76c2cd84c4916994.png" data-original-src="https://miro.medium.com/v2/resize:fit:658/format:webp/1*uwmEgx-xXW21UgdZzePkOA.jpeg"/></div><figcaption class="nj nk gj gh gi nl nm bd b be z dk"><a class="ae lu" href="https://paperswithcode.com/task/small-object-detection/codeless" rel="noopener ugc nofollow" target="_blank">Small Objects Detection</a>, on <a class="ae lu" href="https://paperswithcode.com" rel="noopener ugc nofollow" target="_blank">PapersWithCode.com</a></figcaption></figure><p id="324b" class="pw-post-body-paragraph ky kz it la b lb lc kd ld le lf kg lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">RetineNet 在第一阶段使用特征金字塔网络(FPN)来识别不同尺度上的对象。你可以使用不同的<strong class="la jd">比例</strong>和<strong class="la jd">比例</strong>值来帮助网络更好地识别小物体。</p><p id="8439" class="pw-post-body-paragraph ky kz it la b lb lc kd ld le lf kg lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您需要做的是为您的模型创建一个<strong class="la jd"> config.ini </strong>:</p><pre class="kr ks kt ku gt nr ns nt nu aw nv bi"><span id="ea99" class="nw lw it ns b gy nx ny l nz oa">[anchor_parameters] <br/>sizes   = 32 64 128 256 512 <br/>strides = 8 16 32 64 128 <br/>ratios  = 0.5 1 2 3 <br/>scales  = .5 1.2 1.6</span></pre><p id="5c84" class="pw-post-body-paragraph ky kz it la b lb lc kd ld le lf kg lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">训练模型时，请确保包含配置文件:</p><pre class="kr ks kt ku gt nr ns nt nu aw nv bi"><span id="7d94" class="nw lw it ns b gy nx ny l nz oa">python keras-retinanet/keras_retinanet/bin/train.py --config config.ini csv soccer/train.csv soccer/labels.csv --val-annotations soccer/valid.csv</span></pre><h1 id="80aa" class="lv lw it bd lx ly lz ma mb mc md me mf ki mg kj mh kl mi km mj ko mk kp ml mm bi translated">项目存储库</h1><p id="efeb" class="pw-post-body-paragraph ky kz it la b lb mn kd ld le mo kg lg lh mp lj lk ll mq ln lo lp mr lr ls lt im bi translated">这个项目的所有代码都可以在 GitHub 上免费获得:</p><pre class="kr ks kt ku gt nr ns nt nu aw nv bi"><span id="ead6" class="nw lw it ns b gy nx ny l nz oa"><a class="ae lu" href="https://github.com/ramarlina/retinanet-player-ball-detection" rel="noopener ugc nofollow" target="_blank">https://github.com/ramarlina/retinanet-player-ball-detection</a></span></pre></div></div>    
</body>
</html>