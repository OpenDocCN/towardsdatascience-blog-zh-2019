<html>
<head>
<title>NLP Text Preprocessing: A Practical Guide and Template</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">自然语言处理文本预处理:实用指南和模板</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/nlp-text-preprocessing-a-practical-guide-and-template-d80874676e79?source=collection_archive---------3-----------------------#2019-08-30">https://towardsdatascience.com/nlp-text-preprocessing-a-practical-guide-and-template-d80874676e79?source=collection_archive---------3-----------------------#2019-08-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/bde0a44ddee616ae64cfa8350132fd61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hCKBFMIji-2PU1vAG46lzw.png"/></div></div></figure><p id="ed41" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi kz translated">传统上，文本预处理是自然语言处理(NLP)任务的重要步骤。它将文本转换为更容易消化的形式，以便机器学习算法能够更好地执行。</p><h1 id="60dd" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated"><strong class="ak">文本预处理的重要性</strong></h1><p id="cf52" class="pw-post-body-paragraph kb kc it kd b ke mg kg kh ki mh kk kl km mi ko kp kq mj ks kt ku mk kw kx ky im bi translated">为了说明文本预处理的重要性，让我们考虑一个针对客户评论的情感分析任务。</p><p id="2713" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">假设一个客户反馈说“他们的客户支持服务是一场噩梦”，一个人肯定可以清楚地识别评论的情绪是负面的。然而对于机器来说，这并不简单。</p><p id="5831" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">为了说明这一点，我用<a class="ae ml" href="https://azure.microsoft.com/en-in/services/cognitive-services/text-analytics/" rel="noopener ugc nofollow" target="_blank"> Azure 文本分析 API </a>进行了实验。馈入同一个评论，API 返回 50%的结果，即中性情绪，这是错误的。</p><figure class="mn mo mp mq gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mm"><img src="../Images/1101602f594f6ebffc39c0f30d2c2482.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Rq9_Af0ZXTGbZJBLFhAAow.png"/></div></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk">Azure text analytics API results as of publication date (30 Aug 2019)</figcaption></figure><p id="9f17" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然而，如果我们已经执行了一些文本预处理，在这种情况下只是删除一些停用词(下面将进一步解释，但现在，将停用词视为非常常见的词，这样它们在我们的 NLP 任务中不会有太大帮助)，我们将看到结果变成 16%，即负面情绪，这是正确的。</p><figure class="mn mo mp mq gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mv"><img src="../Images/30f2ba3f13b819bb97dd03cee934af97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*erJtxRsyUYmIw_cubYwHNA.png"/></div></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk">Azure text analytics API results after our own preprocessing</figcaption></figure><p id="5cd5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">因此，如图所示，如果处理得当，文本预处理有助于提高 NLP 任务的准确性。</p><p id="ee3c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="mw">边注:上面的 Azure 例子实际上更有趣，因为按理说，</em> <a class="ae ml" href="https://docs.microsoft.com/en-in/azure/cognitive-services/text-analytics/how-tos/text-analytics-how-to-sentiment-analysis" rel="noopener ugc nofollow" target="_blank"> <em class="mw"> Azure 的文本分析 API 应该已经将文本作为其模型</em> </a> <em class="mw">的一部分进行了处理，但不知何故，停用词似乎混淆了其模型。</em></p><h1 id="e5b9" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">文本预处理概述</h1><p id="5201" class="pw-post-body-paragraph kb kc it kd b ke mg kg kh ki mh kk kl km mi ko kp kq mj ks kt ku mk kw kx ky im bi translated">那么我们如何着手进行文本预处理呢？通常，有 3 个主要组件:</p><ul class=""><li id="fb77" class="mx my it kd b ke kf ki kj km mz kq na ku nb ky nc nd ne nf bi translated">标记化</li><li id="27b3" class="mx my it kd b ke ng ki nh km ni kq nj ku nk ky nc nd ne nf bi translated">正常化</li><li id="72d8" class="mx my it kd b ke ng ki nh km ni kq nj ku nk ky nc nd ne nf bi translated">噪声消除</li></ul><p id="1e09" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">简而言之，<strong class="kd iu">记号化</strong>就是将文本串分割成更小的片段，或者“记号”。段落可以被标记成句子，句子可以被标记成单词。<strong class="kd iu">规范化</strong>旨在将所有文本置于一个公平的竞争环境中，例如，将所有字符转换为小写。<strong class="kd iu">噪声去除</strong>清理文本，例如，去除多余的空白。</p><p id="f8d0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">详情请参考<a class="nl nm ep" href="https://medium.com/u/a0bc63d95eb0?source=post_page-----d80874676e79--------------------------------" rel="noopener" target="_blank">马修·梅奥</a>的这篇<a class="ae ml" href="https://www.kdnuggets.com/2017/12/general-approach-preprocessing-text-data.html" rel="noopener ugc nofollow" target="_blank">伟大的文章</a>。</p><h1 id="7f76" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">文本预处理步骤列表</h1><p id="e826" class="pw-post-body-paragraph kb kc it kd b ke mg kg kh ki mh kk kl km mi ko kp kq mj ks kt ku mk kw kx ky im bi translated">根据上面的概述，我们在每个组件下执行了一系列步骤。</p><ol class=""><li id="32fc" class="mx my it kd b ke kf ki kj km mz kq na ku nb ky nn nd ne nf bi translated">删除 HTML 标签</li><li id="7d92" class="mx my it kd b ke ng ki nh km ni kq nj ku nk ky nn nd ne nf bi translated">删除多余的空格</li><li id="1646" class="mx my it kd b ke ng ki nh km ni kq nj ku nk ky nn nd ne nf bi translated">将重音字符转换为 ASCII 字符</li><li id="0356" class="mx my it kd b ke ng ki nh km ni kq nj ku nk ky nn nd ne nf bi translated">扩大收缩</li><li id="c8e9" class="mx my it kd b ke ng ki nh km ni kq nj ku nk ky nn nd ne nf bi translated">删除特殊字符</li><li id="1b9d" class="mx my it kd b ke ng ki nh km ni kq nj ku nk ky nn nd ne nf bi translated">小写所有文本</li><li id="c30a" class="mx my it kd b ke ng ki nh km ni kq nj ku nk ky nn nd ne nf bi translated">将数字转换成数字形式</li><li id="cf0e" class="mx my it kd b ke ng ki nh km ni kq nj ku nk ky nn nd ne nf bi translated">删除号码</li><li id="941c" class="mx my it kd b ke ng ki nh km ni kq nj ku nk ky nn nd ne nf bi translated">删除停用词</li><li id="b336" class="mx my it kd b ke ng ki nh km ni kq nj ku nk ky nn nd ne nf bi translated">词汇化</li></ol><p id="88e0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">完整代码的链接可以在文章的底部找到，但是请继续阅读以理解所采取的重要步骤。</p><p id="df83" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">必要的依赖关系如下:</p><pre class="mn mo mp mq gt no np nq nr aw ns bi"><span id="cf46" class="nt lj it np b gy nu nv l nw nx">from bs4 import BeautifulSoup<br/>import spacy<br/>import unidecode<br/>from word2number import w2n<br/>import contractions</span><span id="17c6" class="nt lj it np b gy ny nv l nw nx"># load spacy model, can be "en_core_web_sm" as well<br/>nlp = spacy.load('en_core_web_md')</span></pre><h1 id="a99b" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">删除 HTML 标签</h1><p id="ec9f" class="pw-post-body-paragraph kb kc it kd b ke mg kg kh ki mh kk kl km mi ko kp kq mj ks kt ku mk kw kx ky im bi translated">如果评论或文本是从网上搜集来的，它们很可能会包含一些 HTML 标签。因为这些标签对我们的 NLP 任务没有用，所以最好删除它们。</p><figure class="mn mo mp mq gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nz"><img src="../Images/24db23baa191292b8602092c67bcf9e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t97xE9-VoytnZ9Vp7N2XDQ.png"/></div></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk">Highlighted texts show HTML tags</figcaption></figure><p id="49cc" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">为此，我们可以使用 BeautifulSoup 的 HTML 解析器，如下所示:</p><pre class="mn mo mp mq gt no np nq nr aw ns bi"><span id="e771" class="nt lj it np b gy nu nv l nw nx">def strip_html_tags(text):<br/>    """remove html tags from text"""<br/>    soup = BeautifulSoup(text, "html.parser")<br/>    stripped_text = soup.get_text(separator=" ")<br/>    return stripped_text</span></pre><h1 id="1a76" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">转换重音字符</h1><p id="c6cf" class="pw-post-body-paragraph kb kc it kd b ke mg kg kh ki mh kk kl km mi ko kp kq mj ks kt ku mk kw kx ky im bi translated">“你想去我们的咖啡馆喝拿铁吗？”</p><p id="0e8a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">带有像“latté”和“café”这样的重音符号的单词可以被转换并标准化为“latte”和“cafe ”,否则我们的 NLP 模型会将“latté”和“latte”视为不同的单词，即使它们指的是同一事物。为此，我们使用模块 unidecode。</p><pre class="mn mo mp mq gt no np nq nr aw ns bi"><span id="fa4b" class="nt lj it np b gy nu nv l nw nx">def remove_accented_chars(text):<br/>    """remove accented characters from text, e.g. café"""<br/>    text = unidecode.unidecode(text)<br/>    return text</span></pre><h1 id="c6c6" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">扩大收缩</h1><p id="81f4" class="pw-post-body-paragraph kb kc it kd b ke mg kg kh ki mh kk kl km mi ko kp kq mj ks kt ku mk kw kx ky im bi translated">缩写是缩短的单词，例如，不要和不能。将这样的词扩展到“不要”和“不能”，有助于规范文字。</p><p id="2f48" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们使用收缩模块来扩展收缩。</p><pre class="mn mo mp mq gt no np nq nr aw ns bi"><span id="aab1" class="nt lj it np b gy nu nv l nw nx">def expand_contractions(text):<br/>    """expand shortened words, e.g. don't to do not"""<br/>    text = contractions.fix(text)<br/>    return text</span></pre><p id="72d9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="mw">注意:根据您的 NLP 任务，这一步是可选的，因为 spaCy 的标记化和词条化函数将执行相同的效果来扩展诸如 can't 和 don't 之类的缩写。稍微不同的是，spaCy 会把“we 're”扩展成“we be ”,而 py 缩略会给出结果“we are”。</em></p><h1 id="48a5" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">数字处理</h1><p id="e444" class="pw-post-body-paragraph kb kc it kd b ke mg kg kh ki mh kk kl km mi ko kp kq mj ks kt ku mk kw kx ky im bi translated">我们处理数字有两个步骤。</p><p id="9b22" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">其中一个步骤涉及将数字字转换成数字形式，例如 7 到 7，以标准化文本。为此，我们使用 word2number 模块。示例代码如下:</p><pre class="mn mo mp mq gt no np nq nr aw ns bi"><span id="8d90" class="nt lj it np b gy nu nv l nw nx">text = """three cups of coffee"""</span><span id="2e93" class="nt lj it np b gy ny nv l nw nx">doc = nlp(text)</span><span id="f474" class="nt lj it np b gy ny nv l nw nx">tokens = [w2n.word_to_num(token.text) if token.pos_ == 'NUM' else token for token in doc]<br/><br/>print(tokens) # result: [3, cups, of, coffee]</span></pre><p id="be37" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">另一步是删除数字。稍后您将会看到，我们能够通过将参数设置为<em class="mw">真</em>或<em class="mw">假</em>值来打开或关闭这些步骤。移除数字对于情感分析可能是有意义的，因为数字不包含关于情感的信息。然而，如果我们的 NLP 任务是提取发送给聊天机器人的消息中订购的机票数量，我们肯定不希望删除数字。</p><h1 id="eb14" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">停用词</h1><p id="f04d" class="pw-post-body-paragraph kb kc it kd b ke mg kg kh ki mh kk kl km mi ko kp kq mj ks kt ku mk kw kx ky im bi translated">如前所述，停用词是非常常见的单词。像“我们”和“是”这样的词可能对诸如情感分析或文本分类这样的 NLP 任务没有任何帮助。因此，我们可以删除停用词，以节省处理大量文本的计算时间和精力。</p><p id="1bc6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在我们的例子中，我们使用了 spaCy 内置的停用词，但是我们应该谨慎，并相应地修改停用词列表。例如，对于情感分析，单词“not”在诸如“not good”的文本的含义中是重要的。然而，spaCy 将“not”作为停用词。因此，我们通过以下代码修改停用词:</p><pre class="mn mo mp mq gt no np nq nr aw ns bi"><span id="bc4d" class="nt lj it np b gy nu nv l nw nx"># exclude words from spacy stopwords list<br/>deselect_stop_words = ['no', 'not']<br/>for w in deselect_stop_words:<br/>    nlp.vocab[w].is_stop = False</span></pre><h1 id="1042" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">词汇化</h1><p id="dacb" class="pw-post-body-paragraph kb kc it kd b ke mg kg kh ki mh kk kl km mi ko kp kq mj ks kt ku mk kw kx ky im bi translated">词汇化是将一个词转换成其基本形式的过程，例如，“caring”转换成“care”。我们使用 spaCy 的引理器来获得单词的引理或基本形式。示例代码:</p><pre class="mn mo mp mq gt no np nq nr aw ns bi"><span id="11f1" class="nt lj it np b gy nu nv l nw nx">text = """he kept eating while we are talking"""<br/>doc = nlp(text)</span><span id="c461" class="nt lj it np b gy ny nv l nw nx"># Lemmatizing each token<br/>mytokens = [word.lemma_ if word.lemma_ != "-PRON-" else word.lower_ for word in doc]</span><span id="8108" class="nt lj it np b gy ny nv l nw nx">print(mytokens) <br/># result: ['he', 'keep', 'eat', 'while', 'we', 'be', 'talk']</span></pre><p id="7c20" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">另一种获得单词基本形式的方法是词干分析法。我们没有在文本预处理代码中使用它，但是如果处理速度是最重要的考虑因素，你可以考虑使用词干。但是请注意，词干分析是一种粗糙的启发式方法，它将单词的词尾砍掉，因此，结果可能不是好的或真实的单词。例如，堵塞“关心”将导致“汽车”。</p><h1 id="7768" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">现在和接下来的步骤</h1><p id="c175" class="pw-post-body-paragraph kb kc it kd b ke mg kg kh ki mh kk kl km mi ko kp kq mj ks kt ku mk kw kx ky im bi translated">综上所述，全文预处理代码如下:</p><p id="1bdc" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><a class="ae ml" href="https://gist.github.com/jiahao87/d57a2535c2ed7315390920ea9296d79f" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/jiahao 87/d57a 2535 C2 ed 7315390920 ea 9296d 79 f</a></p><p id="f9a5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">运行该函数的示例代码如下:</p><pre class="mn mo mp mq gt no np nq nr aw ns bi"><span id="b10d" class="nt lj it np b gy nu nv l nw nx"># text = """I'd like to have three cups   of coffee&lt;br /&gt;&lt;br /&gt;from your Café. #delicious"""<br/><br/>text_preprocessing(text) <br/># result: ['like', 'cup', 'coffee', 'cafe', 'delicious']</span></pre><p id="890b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">要打开或关闭特定步骤，我们可以将相关参数设置为<em class="mw">真</em>或<em class="mw">假</em>值。例如，为了不删除数字，将参数“remove_num”设置为<em class="mw">假</em>。</p><pre class="mn mo mp mq gt no np nq nr aw ns bi"><span id="c6d2" class="nt lj it np b gy nu nv l nw nx"># example to not remove numbers<br/>text_preprocessing(text, remove_num=False)</span></pre><p id="234e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">之后，我们可以将处理过的文本转换成可以用数字表示的东西。这样做的两种主要方法是一键编码和单词嵌入向量。我们将在下一篇文章中探讨这些问题。</p><p id="b16b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">最后，请注意，有<a class="ae ml" href="https://twitter.com/peteskomoroch/status/1068318945382297600" rel="noopener ugc nofollow" target="_blank">专家</a>表达了文本预处理负面影响而不是增强深度学习模型性能的观点。尽管如此，文本预处理对于非深度学习模型来说无疑是至关重要的。</p><p id="3357" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">感谢阅读，我希望代码和文章是有用的。如果您有任何问题或建议，也请随时发表评论。</p><h1 id="e140" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">参考</h1><ul class=""><li id="e8c9" class="mx my it kd b ke mg ki mh km oa kq ob ku oc ky nc nd ne nf bi translated"><a class="ae ml" href="https://www.kdnuggets.com/2017/12/general-approach-preprocessing-text-data.html" rel="noopener ugc nofollow" target="_blank">https://www . kdnugges . com/2017/12/general-approach-预处理-text-data.html </a></li><li id="7b35" class="mx my it kd b ke ng ki nh km ni kq nj ku nk ky nc nd ne nf bi translated"><a class="ae ml" href="https://www.kdnuggets.com/2018/08/practitioners-guide-processing-understanding-text-2.html" rel="noopener ugc nofollow" target="_blank">https://www . kdnugges . com/2018/08/practices-guide-processing-understanding-text-2 . html</a></li><li id="adff" class="mx my it kd b ke ng ki nh km ni kq nj ku nk ky nc nd ne nf bi translated"><a class="ae ml" href="https://docs.microsoft.com/en-in/azure/cognitive-services/text-analytics/how-tos/text-analytics-how-to-sentiment-analysis" rel="noopener ugc nofollow" target="_blank">https://docs . Microsoft . com/en-in/azure/cognitive-services/text-analytics/how-tos/text-analytics-how-to-情操分析</a></li><li id="2f6e" class="mx my it kd b ke ng ki nh km ni kq nj ku nk ky nc nd ne nf bi translated"><a class="ae ml" href="https://pypi.org/project/contractions/" rel="noopener ugc nofollow" target="_blank">https://pypi.org/project/contractions/</a></li><li id="aacb" class="mx my it kd b ke ng ki nh km ni kq nj ku nk ky nc nd ne nf bi translated"><a class="ae ml" href="https://pypi.org/project/word2number/" rel="noopener ugc nofollow" target="_blank">https://pypi.org/project/word2number/</a></li></ul></div></div>    
</body>
</html>