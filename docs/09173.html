<html>
<head>
<title>Proper Ways to Pass Environment Variables in JSON for cURL POST</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在 JSON 中为 cURL POST 传递环境变量的正确方法</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/proper-ways-to-pass-environment-variables-in-json-for-curl-post-f797d2698bf3?source=collection_archive---------3-----------------------#2019-12-05">https://towardsdatascience.com/proper-ways-to-pass-environment-variables-in-json-for-curl-post-f797d2698bf3?source=collection_archive---------3-----------------------#2019-12-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5700" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">测试基于机器学习 API 的服务请求的最佳实践</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/40755e96e3c3a530592009bcf01b0fef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fNFobhVsBxSMjDAGiC5uOQ.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Photo by <a class="ae ky" href="https://unsplash.com/@cheaousa?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Ousa Chea</a> on <a class="ae ky" href="https://unsplash.com/s/photos/test?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="e03e" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">TL；速度三角形定位法(dead reckoning)</h1><p id="f49f" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">最佳实践是使用数据生成函数。滚动到底部查看详细信息。</p><h1 id="a15c" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">为请求测试设置一个模拟 API 服务器</h1><p id="20e4" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">当我们构建一个基于 API 的 web(前端和后端分离)时，我们通常希望看到 HTTP 客户端正在发送什么，或者检查和调试 webhook 请求。有两种方法:</p><ul class=""><li id="91f8" class="mn mo it lt b lu mp lx mq ma mr me ms mi mt mm mu mv mw mx bi translated">自己搭建一个 API 服务器</li><li id="bc2b" class="mn mo it lt b lu my lx mz ma na me nb mi nc mm mu mv mw mx bi translated">使用假的模拟 API 服务器</li></ul><p id="94eb" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">在本文中，我们选择第二种方法，使用<a class="ae ky" href="https://requestbin.io/" rel="noopener ugc nofollow" target="_blank"> RequestBin </a>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/830bea81f027da54c010ed352312787a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kcPmKkF86RUOOJq2eJu3yw.png"/></div></div></figure><p id="ded0" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">用法超级简单。单击按钮后，模拟 API 服务器就准备好了。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/48287392140f296d859838a04281e852.png" data-original-src="https://miro.medium.com/v2/resize:fit:1174/format:webp/1*HzqZNpSfG17u_aJI_QL1pA.png"/></div></figure><p id="67b0" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">运行以下命令发出 POST 请求:</p><pre class="kj kk kl km gt ni nj nk nl aw nm bi"><span id="d5d6" class="nn la it nj b gy no np l nq nr">$ curl -X POST https://requestbin.io/1bk0un41 -H "Content-Type: application/json" -d '{ "property1":"value1", "property2":"value2" }'</span></pre><p id="c570" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">刷新网站并确认状态:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/c5d3ddc9e976405087d70fd931f16cb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-BGbI-k4vfP4BR3J7UV11Q.png"/></div></div></figure><h1 id="cfa6" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">将变量传递给 curl 时的双引号问题</h1><p id="d35b" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">运行<code class="fe nt nu nv nj b">printenv</code>将显示环境变量:</p><pre class="kj kk kl km gt ni nj nk nl aw nm bi"><span id="e0cc" class="nn la it nj b gy no np l nq nr">$ <!-- -->printenv</span><span id="57fd" class="nn la it nj b gy nw np l nq nr">LC_TERMINAL=iTerm2<br/>COLORTERM=truecolor<br/>TERM=xterm-256color<br/>HOME=/Users/smap10<br/>...</span></pre><p id="eed1" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">我们想用<code class="fe nt nu nv nj b">TERM</code>变量替换<code class="fe nt nu nv nj b">property1</code>的值:</p><pre class="kj kk kl km gt ni nj nk nl aw nm bi"><span id="8286" class="nn la it nj b gy no np l nq nr">$ curl -X POST https://requestbin.io/<!-- -->1bk0un41<!-- -->  -H "Content-Type: application/json" -d '{ "property1":<strong class="nj iu">"$TERM"</strong>, "property2":"value2" }'</span></pre><p id="a1bd" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">但是似乎<code class="fe nt nu nv nj b">TERM</code>没有被认为是一个环境变量。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/39850dfc7898ecd80f1aba8a5dfe2eb8.png" data-original-src="https://miro.medium.com/v2/resize:fit:794/format:webp/1*Ir_cQh6JewFWXQIYzxETuA.png"/></div></figure><h1 id="4966" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">传递环境变量的三种方法</h1><h2 id="2bb7" class="nn la it bd lb ny nz dn lf oa ob dp lj ma oc od ll me oe of ln mi og oh lp oi bi translated">1 在变量周围添加单引号和双引号</h2><pre class="kj kk kl km gt ni nj nk nl aw nm bi"><span id="7497" class="nn la it nj b gy no np l nq nr">$ curl -X POST https://requestbin.io/<!-- -->1bk0un41<!-- -->  -H "Content-Type: application/json" -d '{ "property1":"'"$TERM"'", "property2":"value2" }'</span></pre><p id="c410" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">我们可以看到我们想要的结果。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/3de1f7d3f50c55fe3e2e15edb4afc3df.png" data-original-src="https://miro.medium.com/v2/resize:fit:948/format:webp/1*uwvn290kw75-17eiHNI3sw.png"/></div></figure><h2 id="3e60" class="nn la it bd lb ny nz dn lf oa ob dp lj ma oc od ll me oe of ln mi og oh lp oi bi translated">2 转义双引号</h2><p id="78a0" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">最外层使用双引号。并在 JSON 数据部分为每个双引号添加转义标记。</p><pre class="kj kk kl km gt ni nj nk nl aw nm bi"><span id="aeed" class="nn la it nj b gy no np l nq nr">$ curl -X POST https://requestbin.io/<!-- -->1bk0un41<!-- --> -H "Content-Type: application/json" -d "{ \"property1\":\"$TERM\", \"property2\":\"value2\" }"</span></pre><h2 id="a3f2" class="nn la it bd lb ny nz dn lf oa ob dp lj ma oc od ll me oe of ln mi og oh lp oi bi translated">3 使用数据生成功能</h2><p id="301d" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">这种方法可以让我们从所有关于 shell 引用的麻烦中解脱出来，并且更容易阅读和维护。</p><pre class="kj kk kl km gt ni nj nk nl aw nm bi"><span id="7029" class="nn la it nj b gy no np l nq nr">generate_post_data()<br/>{<br/>  cat &lt;&lt;EOF<br/>{<br/>  "property1":"$TERM", <br/>  "property2":"value2"<br/>}<br/>EOF<br/>}</span></pre><p id="b545" class="pw-post-body-paragraph lr ls it lt b lu mp ju lw lx mq jx lz ma nd mc md me ne mg mh mi nf mk ml mm im bi translated">给 curl 添加函数:</p><pre class="kj kk kl km gt ni nj nk nl aw nm bi"><span id="5624" class="nn la it nj b gy no np l nq nr">$ curl -X POST https://requestbin.io/<!-- -->1bk0un41<!-- --> -H "Content-Type: application/json" -d "$(generate_post_data)"</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/eb798313e1a6594685ab960644574f19.png" data-original-src="https://miro.medium.com/v2/resize:fit:546/format:webp/0*WR3j8KofAGGyOMpl.png"/></div></figure><blockquote class="ol om on"><p id="84d3" class="lr ls oo lt b lu mp ju lw lx mq jx lz op nd mc md oq ne mg mh or nf mk ml mm im bi translated"><strong class="lt iu"> <em class="it">查看我的其他帖子</em> </strong> <a class="ae ky" href="https://medium.com/@bramblexu" rel="noopener"> <strong class="lt iu"> <em class="it">中等</em> </strong> </a> <strong class="lt iu"> <em class="it">同</em> </strong> <a class="ae ky" href="https://bramblexu.com/posts/eb7bd472/" rel="noopener ugc nofollow" target="_blank"> <strong class="lt iu"> <em class="it">分类查看</em> </strong> </a> <strong class="lt iu"> <em class="it">！<br/>GitHub:</em></strong><a class="ae ky" href="https://github.com/BrambleXu" rel="noopener ugc nofollow" target="_blank"><strong class="lt iu"><em class="it">荆棘徐</em> </strong> </a> <strong class="lt iu"> <em class="it"> <br/>领英:</em> </strong> <a class="ae ky" href="https://www.linkedin.com/in/xu-liang-99356891/" rel="noopener ugc nofollow" target="_blank"> <strong class="lt iu"> <em class="it">徐亮</em> </strong> </a> <strong class="lt iu"> <em class="it"> <br/>博客:</em></strong><a class="ae ky" href="https://bramblexu.com" rel="noopener ugc nofollow" target="_blank"><strong class="lt iu"><em class="it"/></strong></a></p></blockquote><h1 id="1300" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">参考</h1><ul class=""><li id="eeb7" class="mn mo it lt b lu lv lx ly ma os me ot mi ou mm mu mv mw mx bi translated"><a class="ae ky" href="https://www.smashingmagazine.com/2018/01/understanding-using-rest-api/" rel="noopener ugc nofollow" target="_blank">理解和使用 REST API</a></li><li id="81d2" class="mn mo it lt b lu my lx mz ma na me nb mi nc mm mu mv mw mx bi translated"><a class="ae ky" href="https://superuser.com/a/835589" rel="noopener ugc nofollow" target="_blank">如何在 bash line CURL 中包含环境变量？</a></li><li id="5e35" class="mn mo it lt b lu my lx mz ma na me nb mi nc mm mu mv mw mx bi translated"><a class="ae ky" href="https://stackoverflow.com/questions/17029902/using-curl-post-with-variables-defined-in-bash-script-functions" rel="noopener ugc nofollow" target="_blank">使用 curl POST 和 bash 脚本函数中定义的变量</a></li></ul></div></div>    
</body>
</html>