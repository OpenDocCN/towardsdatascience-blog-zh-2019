<html>
<head>
<title>Object Detector Android App Using PyTorch Mobile Neural Network</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 PyTorch 移动神经网络的对象检测器 Android 应用程序</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/object-detector-android-app-using-pytorch-mobile-neural-network-407c419b56cd?source=collection_archive---------12-----------------------#2019-11-19">https://towardsdatascience.com/object-detector-android-app-using-pytorch-mobile-neural-network-407c419b56cd?source=collection_archive---------12-----------------------#2019-11-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/2a1bd06c6ffd9ab19135a95f453a272c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RLTaJw38yLZPKcxu84v5xQ.png"/></div></div></figure><p id="4ca0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><a class="ae kz" href="https://www.tusharck.com/" rel="noopener ugc nofollow" target="_blank">图沙尔·卡普尔</a>:(【https://www.tusharck.com/】T2</p><p id="5273" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在移动设备上运行机器学习代码是下一件大事。<a class="ae kz" href="https://pytorch.org/" rel="noopener ugc nofollow" target="_blank"> PyTorch </a>，在最新发布的<a class="ae kz" href="https://pytorch.org/blog/pytorch-1-dot-3-adds-mobile-privacy-quantization-and-named-tensors/" rel="noopener ugc nofollow" target="_blank"> PyTorch 1.3 </a>中，增加了<a class="ae kz" href="https://pytorch.org/mobile/home/" rel="noopener ugc nofollow" target="_blank"> PyTorch Mobile </a>，用于在 Android 和 iOS 设备上部署机器学习模型。</p><p id="8c34" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在这里，我们将研究创建一个 Android 应用程序，用于图像中的对象检测；比如下图的 GIF。</p><figure class="lb lc ld le gt ju gh gi paragraph-image"><div class="gh gi la"><img src="../Images/8c1b9bcaa21246ac4d6aa9c07e325e32.png" data-original-src="https://miro.medium.com/v2/resize:fit:678/1*F8Wkg1ETMdxpN7mYMxV1Yg.gif"/></div><figcaption class="lf lg gj gh gi lh li bd b be z dk">Demo Run of the application</figcaption></figure><h1 id="4c00" class="lj lk it bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">步骤 1:准备模型</h1><p id="088a" class="pw-post-body-paragraph kb kc it kd b ke mh kg kh ki mi kk kl km mj ko kp kq mk ks kt ku ml kw kx ky im bi translated">在本教程中，我们将使用预先训练好的<a class="ae kz" href="https://arxiv.org/abs/1512.03385" rel="noopener ugc nofollow" target="_blank"> ResNet18 </a>模型。ResNet18 是最先进的计算机视觉模型，有 1000 个分类类别。</p><ol class=""><li id="7e81" class="mm mn it kd b ke kf ki kj km mo kq mp ku mq ky mr ms mt mu bi translated">安装火炬视觉库</li></ol><pre class="lb lc ld le gt mv mw mx my aw mz bi"><span id="0b73" class="na lk it mw b gy nb nc l nd ne">pip install torchvision</span></pre><p id="bd13" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">2.下载并追踪 ResNet18 模型。</p><p id="c41b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们<a class="ae kz" href="https://pytorch.org/docs/stable/jit.html#torch.jit.trace" rel="noopener ugc nofollow" target="_blank">跟踪</a>模型，因为我们需要一个可执行的 ScriptModule 来进行实时编译。</p><pre class="lb lc ld le gt mv mw mx my aw mz bi"><span id="aba5" class="na lk it mw b gy nb nc l nd ne">import torch<br/>import torchvision</span><span id="0c9a" class="na lk it mw b gy nf nc l nd ne">resnet18 = torchvision.models.resnet18(pretrained=True)<br/>resnet18.eval()</span><span id="b273" class="na lk it mw b gy nf nc l nd ne">example_inputs = torch.rand(1, 3, 224, 224)</span><span id="0783" class="na lk it mw b gy nf nc l nd ne">resnet18_traced = torch.jit.trace(resnet18, example_inputs = example_inputs)</span><span id="32c2" class="na lk it mw b gy nf nc l nd ne">resnet18_traced.save("resnet18_traced.pt")</span></pre><p id="3ba1" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> <em class="ng">注:</em> </strong></p><ol class=""><li id="2b3e" class="mm mn it kd b ke kf ki kj km mo kq mp ku mq ky mr ms mt mu bi translated">将 resnet18_traced.pt 存储在一个已知的位置，我们将在本教程的后续步骤中用到它。</li><li id="f029" class="mm mn it kd b ke nh ki ni km nj kq nk ku nl ky mr ms mt mu bi translated">在 torch.rand 中，我们采用了 224，224 的尺寸，因为 ResNet18 接受 224*224 的尺寸。</li></ol><h1 id="c86d" class="lj lk it bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">步骤 2:制作 Android 应用程序</h1><ol class=""><li id="9fe7" class="mm mn it kd b ke mh ki mi km nm kq nn ku no ky mr ms mt mu bi translated">如果你还没有下载并安装 Android Studio，安装时说<strong class="kd iu"> YES </strong>下载并安装<strong class="kd iu"> SDK </strong>。<br/>链接:<a class="ae kz" href="https://developer.android.com/studio" rel="noopener ugc nofollow" target="_blank">https://developer.android.com/studio</a></li><li id="fc92" class="mm mn it kd b ke nh ki ni km nj kq nk ku nl ky mr ms mt mu bi translated">打开 Android Studio，点击:<br/> <strong class="kd iu"> +开始一个新的 Android Studio 项目</strong></li><li id="00f6" class="mm mn it kd b ke nh ki ni km nj kq nk ku nl ky mr ms mt mu bi translated">选择空活动。</li></ol><figure class="lb lc ld le gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi np"><img src="../Images/a08840ae5b5c928c642b84662d38f403.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r0yeVpwJ8FQgxESSbGA_KQ.png"/></div></div></figure><p id="a742" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">4.输入应用程序<strong class="kd iu">名称:</strong> ObjectDetectorDemo。然后按<strong class="kd iu">完成</strong>。</p><figure class="lb lc ld le gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nq"><img src="../Images/f6715fc908e07406b930d94c207cd402.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7jj79Nt9NZ-jrBPYO8VgiQ.png"/></div></div></figure><p id="2715" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">5.安装 NDK 在安卓内部运行原生代码:</p><ul class=""><li id="c8ba" class="mm mn it kd b ke kf ki kj km mo kq mp ku mq ky nr ms mt mu bi translated">转到<strong class="kd iu">工具&gt; SDK 管理器。</strong></li><li id="e633" class="mm mn it kd b ke nh ki ni km nj kq nk ku nl ky nr ms mt mu bi translated">点击<strong class="kd iu"> SDK 工具</strong>。</li><li id="cbd3" class="mm mn it kd b ke nh ki ni km nj kq nk ku nl ky nr ms mt mu bi translated">勾选<strong class="kd iu"> NDK(并排)</strong>旁边的复选框。</li></ul><figure class="lb lc ld le gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ns"><img src="../Images/65ea7cf137b78ae620c1da26e746d18e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xI4LjuVFyNTkNkxel_1uZQ.png"/></div></div></figure><p id="4bb5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">6.添加依赖项。</p><ul class=""><li id="75b9" class="mm mn it kd b ke kf ki kj km mo kq mp ku mq ky nr ms mt mu bi translated">在<strong class="kd iu"> build.gradle(模块:app)里面。在依赖项中添加以下内容。</strong></li></ul><pre class="lb lc ld le gt mv mw mx my aw mz bi"><span id="86f5" class="na lk it mw b gy nb nc l nd ne">dependencies {<br/>    implementation fileTree(dir: 'libs', include: ['*.jar'])<br/>    implementation 'androidx.appcompat:appcompat:1.0.2'<br/>    implementation 'androidx.constraintlayout:constraintlayout:1.1.3'</span><span id="989a" class="na lk it mw b gy nf nc l nd ne"><strong class="mw iu">implementation 'org.pytorch:pytorch_android:1.3.0'<br/>    implementation 'org.pytorch:pytorch_android_torchvision:1.3.0'</strong><br/>}</span></pre><p id="3e1c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">7.添加一个基本布局来加载图像并显示结果。</p><ul class=""><li id="c844" class="mm mn it kd b ke kf ki kj km mo kq mp ku mq ky nr ms mt mu bi translated">转到<strong class="kd iu">app&gt;RES&gt;layout&gt;activity _ main . XML</strong>并添加下面的代码。</li></ul><pre class="lb lc ld le gt mv mw mx my aw mz bi"><span id="8c8f" class="na lk it mw b gy nb nc l nd ne">&lt;ImageView<br/>    android:id="@+id/image"<br/>    app:layout_constraintTop_toTopOf="parent"<br/>    android:layout_width="match_parent"<br/>    android:layout_height="400dp"<br/>    android:layout_marginBottom="20dp"<br/>    android:scaleType="fitCenter" /&gt;<br/><br/>&lt;TextView<br/>    android:id="@+id/result_text"<br/>    android:layout_width="match_parent"<br/>    android:layout_height="wrap_content"<br/>    android:layout_gravity="top"<br/>    android:text=""<br/>    android:textSize="20dp"<br/>    android:textStyle="bold"<br/>    android:textAllCaps="true"<br/>    android:textAlignment="center"<br/>    app:layout_constraintTop_toTopOf="@id/button"<br/>    app:layout_constraintBottom_toBottomOf="@+id/image" /&gt;<br/><br/>&lt;Button<br/>    android:id="@+id/button"<br/>    android:layout_width="match_parent"<br/>    android:layout_height="wrap_content"<br/>    android:text="Load Image"<br/>    app:layout_constraintBottom_toBottomOf="@+id/result_text"<br/>    app:layout_constraintTop_toTopOf="@+id/detect" /&gt;<br/><br/>&lt;Button<br/>    android:id="@+id/detect"<br/>    android:layout_width="match_parent"<br/>    android:layout_height="wrap_content"<br/>    android:text="Detect"<br/>    android:layout_marginBottom="50dp"<br/>    app:layout_constraintBottom_toBottomOf="parent" /&gt;</span></pre><p id="ff04" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">你的布局应该如下图所示。</p><figure class="lb lc ld le gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nt"><img src="../Images/cc1032a91e171b29c7b9a380dc3e8ffd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0fzvw9L1BxlFc6BvwAKmag.png"/></div></div></figure><p id="8d11" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">8.我们需要设置权限来读取设备上存储的图像。</p><ul class=""><li id="7d84" class="mm mn it kd b ke kf ki kj km mo kq mp ku mq ky nr ms mt mu bi translated">转到<strong class="kd iu">app&gt;manifest&gt;androidmanifest . XML</strong>并将下面的代码添加到<strong class="kd iu"> manifest 标签</strong>内。</li></ul><pre class="lb lc ld le gt mv mw mx my aw mz bi"><span id="4b09" class="na lk it mw b gy nb nc l nd ne">&lt;uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE"/&gt;</span></pre><ul class=""><li id="3fed" class="mm mn it kd b ke kf ki kj km mo kq mp ku mq ky nr ms mt mu bi translated">获取应用程序加载的权限(只有在您授予权限后才会询问)。</li></ul><p id="416e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">—进入<strong class="kd iu">主活动</strong> java。将下面的代码添加到<strong class="kd iu"> onCreate() </strong>方法中。</p><pre class="lb lc ld le gt mv mw mx my aw mz bi"><span id="4fe8" class="na lk it mw b gy nb nc l nd ne">if (Build.VERSION.<em class="ng">SDK_INT </em>&gt;= Build.VERSION_CODES.<em class="ng">M</em>) {<br/>    requestPermissions(new String[]  {android.Manifest.permission.<em class="ng">READ_EXTERNAL_STORAGE</em>}, 1);<br/>}</span></pre><p id="8f4c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">9.复制模型。<br/>现在我们复制使用 python 脚本创建的模型。</p><ul class=""><li id="96dd" class="mm mn it kd b ke kf ki kj km mo kq mp ku mq ky nr ms mt mu bi translated">从<strong class="kd iu">文件浏览器/查找器</strong>中打开您的应用程序。</li><li id="2a0a" class="mm mn it kd b ke nh ki ni km nj kq nk ku nl ky nr ms mt mu bi translated">转到<strong class="kd iu"> app &gt; src &gt; main。</strong></li><li id="f049" class="mm mn it kd b ke nh ki ni km nj kq nk ku nl ky nr ms mt mu bi translated">创建一个名为<strong class="kd iu">资产</strong>的文件夹</li><li id="3d7f" class="mm mn it kd b ke nh ki ni km nj kq nk ku nl ky nr ms mt mu bi translated">将您的模型复制到该文件夹中。</li><li id="5a3a" class="mm mn it kd b ke nh ki ni km nj kq nk ku nl ky nr ms mt mu bi translated">当你打开你的 Android 工作室时，你会看到如下图所示。(如果没有，右击应用程序文件夹并点击<strong class="kd iu">同步应用程序</strong>)。</li></ul><figure class="lb lc ld le gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nu"><img src="../Images/cdb2dbaa92fd8965c299c6982a351b75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gAw_qJFI4DdnrD_4HFr26Q.png"/></div></div></figure><p id="c906" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">10.我们需要列出模型的输出类。</p><ul class=""><li id="d3bb" class="mm mn it kd b ke kf ki kj km mo kq mp ku mq ky nr ms mt mu bi translated">转到<strong class="kd iu"> app &gt; java。</strong></li><li id="ebff" class="mm mn it kd b ke nh ki ni km nj kq nk ku nl ky nr ms mt mu bi translated">在第一个文件夹中创建一个新的 Java 类名<strong class="kd iu"> ModelClasses </strong>。</li><li id="1ac3" class="mm mn it kd b ke nh ki ni km nj kq nk ku nl ky nr ms mt mu bi translated">将类的列表定义为(完整的列表有 1000 个类，所以可以在这里复制所有的 check <a class="ae kz" href="https://s3.amazonaws.com/outcome-blog/imagenet/labels.json" rel="noopener ugc nofollow" target="_blank"> Json </a>或<a class="ae kz" href="https://github.com/tusharck/Object-Detector-Android-App-Using-PyTorch-Mobile-Neural-Network/blob/master/ObjectDetectorDemo/app/src/main/java/com/tckmpsi/objectdetectordemo/ModelClasses.java" rel="noopener ugc nofollow" target="_blank"> check Git </a>。完整列表和下面列表中的副本):</li></ul><pre class="lb lc ld le gt mv mw mx my aw mz bi"><span id="3681" class="na lk it mw b gy nb nc l nd ne">public static String[] <em class="ng">MODEL_CLASSES </em>= new String[]{<br/>        "tench, Tinca tinca",<br/>        "goldfish, Carassius auratus"<br/>        .<br/>        .<br/>        .<br/>}</span></pre><p id="183d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">11.主活动 Java，这里将定义按钮动作，读取图像并调用 PyTorch 模型。参见代码中的注释以获得解释。</p><figure class="lb lc ld le gt ju"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="11b5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">12.现在是测试应用程序的时候了。有两种方法:</p><ul class=""><li id="fcdf" class="mm mn it kd b ke kf ki kj km mo kq mp ku mq ky nr ms mt mu bi translated"><a class="ae kz" href="https://developer.android.com/studio/run/emulator" rel="noopener ugc nofollow" target="_blank">运行在仿真器上【点击此处】。</a></li><li id="5cf8" class="mm mn it kd b ke nh ki ni km nj kq nk ku nl ky nr ms mt mu bi translated">使用安卓设备。(<a class="ae kz" href="https://developer.android.com/studio/debug/dev-options" rel="noopener ugc nofollow" target="_blank">为此您需要启用 USB 调试</a> [ <a class="ae kz" href="https://developer.android.com/studio/run/emulator" rel="noopener ugc nofollow" target="_blank">点击此处</a>)。</li><li id="497f" class="mm mn it kd b ke nh ki ni km nj kq nk ku nl ky nr ms mt mu bi translated">运行应用程序后，它应该看起来像页面顶部的 GIF。</li></ul></div><div class="ab cl nx ny hx nz" role="separator"><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc"/></div><div class="im in io ip iq"><p id="ddeb" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">链接到 Git 资源库:<a class="ae kz" href="https://github.com/tusharck/Object-Detector-Android-App-Using-PyTorch-Mobile-Neural-Network" rel="noopener ugc nofollow" target="_blank">https://github . com/tusharck/Object-Detector-Android-App-Using-py torch-Mobile-Neural-Network</a></p></div><div class="ab cl nx ny hx nz" role="separator"><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc"/></div><div class="im in io ip iq"><p id="f05a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">T34】免责声明:T36】</strong></p><ol class=""><li id="54a6" class="mm mn it kd b ke kf ki kj km mo kq mp ku mq ky mr ms mt mu bi translated">“Android”名称、Android 徽标、“Google Play”品牌和其他 Google 商标是 Google LLC 的财产，不属于 Android 开源项目的资产。</li><li id="3d8f" class="mm mn it kd b ke nh ki ni km nj kq nk ku nl ky mr ms mt mu bi translated">PyTorch、PyTorch、PyTorch 徽标以及与 PyTorch 或网站相关的所有其他商标、服务标志、图形和徽标是 PyTorch 或 PyTorch 许可方的商标或注册商标。</li></ol></div></div>    
</body>
</html>