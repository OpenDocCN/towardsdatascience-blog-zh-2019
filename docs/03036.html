<html>
<head>
<title>Feature Transformation for Multiple Linear Regression in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python 中多元线性回归的特征变换</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/feature-transformation-for-multiple-linear-regression-in-python-8648ddf070b8?source=collection_archive---------6-----------------------#2019-05-16">https://towardsdatascience.com/feature-transformation-for-multiple-linear-regression-in-python-8648ddf070b8?source=collection_archive---------6-----------------------#2019-05-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="e935" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">用于建模的数据处理和转换</h2></div><p id="6a38" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">数据处理和转换是一个迭代过程，在某种程度上，它永远不可能是“完美的”。因为随着我们对数据集的了解越来越多，例如目标变量和特征之间的内在关系，或者业务环境，我们会想到处理它们的新方法。最近，我开始利用多元线性回归研究媒体组合模型和一些预测模型。在这篇文章中，我将介绍建模的思维过程和处理变量的不同方法。</p><p id="887a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我就用<a class="ae lb" href="https://www.kaggle.com/gabriellima/house-sales-in-king-county-usa/data" rel="noopener ugc nofollow" target="_blank">金县房价数据集</a>(为了更好玩的修改版)来举例。</p><p id="7e83" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">我们先导入库，看看数据！</strong></p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="7837" class="ll lm iq lh b gy ln lo l lp lq">import pandas as pd<br/>import numpy as np<br/>import matplotlib.pyplot as plt<br/>import seaborn as sns<br/>import scipy.stats as stats</span><span id="957a" class="ll lm iq lh b gy lr lo l lp lq">% matplotlib inline</span><span id="a2f4" class="ll lm iq lh b gy lr lo l lp lq">df = pd.read_csv(“kc_house_data.csv”)<br/>df.head()</span></pre><figure class="lc ld le lf gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi ls"><img src="../Images/0bc1d1f347af9a99bb4411584f7fe830.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pJnzNcX9nNORM0UgfxOcmQ.png"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk">Image by Author</figcaption></figure><p id="fe6d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">识别缺失值和明显不正确的数据类型。</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="b4aa" class="ll lm iq lh b gy ln lo l lp lq">df.info()</span><span id="99ed" class="ll lm iq lh b gy lr lo l lp lq">&lt;class 'pandas.core.frame.DataFrame'&gt;<br/>RangeIndex: 21597 entries, 0 to 21596<br/>Data columns (total 21 columns):<br/>id               21597 non-null int64<br/>date             21597 non-null object<br/>price            21597 non-null float64<br/>bedrooms         21597 non-null int64<br/>bathrooms        21597 non-null float64<br/>sqft_living      21597 non-null int64<br/>sqft_lot         21597 non-null int64<br/>floors           21597 non-null float64<br/>waterfront       19221 non-null float64<br/>view             21534 non-null float64<br/>condition        21597 non-null int64<br/>grade            21597 non-null int64<br/>sqft_above       21597 non-null int64<br/>sqft_basement    21597 non-null object<br/>yr_built         21597 non-null int64<br/>yr_renovated     17755 non-null float64<br/>zipcode          21597 non-null int64<br/>lat              21597 non-null float64<br/>long             21597 non-null float64<br/>sqft_living15    21597 non-null int64<br/>sqft_lot15       21597 non-null int64<br/>dtypes: float64(8), int64(11), object(2)<br/>memory usage: 3.5+ MB</span></pre><p id="804d" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在大多数统计模型中，变量可以分为 4 种数据类型:</p><ul class=""><li id="1571" class="me mf iq kh b ki kj kl km ko mg ks mh kw mi la mj mk ml mm bi translated"><strong class="kh ir">连续</strong>:在一个选定的范围内可以有无限个可能值。“float”通常用于 python 中的连续数据。例如生活区的长度</li><li id="7a1e" class="me mf iq kh b ki mn kl mo ko mp ks mq kw mr la mj mk ml mm bi translated"><strong class="kh ir">标称:</strong>标称变量使用数字表示来解释对象的类型或属性。它们是具有两个或更多可能值的分类值，没有固有的顺序或排列次序。例如，汽车的原产国，美国可以是 1，日本 2，德国 3</li><li id="52cf" class="me mf iq kh b ki mn kl mo ko mp ks mq kw mr la mj mk ml mm bi translated"><strong class="kh ir">序数:</strong>序数变量实际上是呈现数值。它们通常在有限的范围内有两个或更多的可能值，并且这些值具有有序的类别。比如房子的档次。当你用 target 绘制序数值时，你经常会看到清晰的垂直线。在数据集中，序号数据可能被读取为整数或浮点数，因此数据可视化总是有助于检测它们</li><li id="ce75" class="me mf iq kh b ki mn kl mo ko mp ks mq kw mr la mj mk ml mm bi translated"><strong class="kh ir">二进制:</strong>只有 2 个可能的值，通常是 0 和 1。虚拟变量是二进制的</li></ul><p id="aed0" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">下图清楚地显示了这种关系。</p><figure class="lc ld le lf gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi ms"><img src="../Images/420ecec815099d0e0f55cabd4ab074b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MXq9rpqGDR9A5J5pbOs5-A.png"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk">Common data types in statistics (Image by Author)</figcaption></figure><h1 id="6a4e" class="mt lm iq bd mu mv mw mx my mz na nb nc jw nd jx ne jz nf ka ng kc nh kd ni nj bi translated">连续变量的变换</h1><ul class=""><li id="8659" class="me mf iq kh b ki nk kl nl ko nm ks nn kw no la mj mk ml mm bi translated"><strong class="kh ir"> Log: </strong>当您有偏斜的数据时，Log 转换有助于减少偏斜。</li></ul><p id="385b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">以房价为例。</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="d3b9" class="ll lm iq lh b gy ln lo l lp lq">df_log[‘price’] = np.log(df[‘price’])<br/>sns.distplot(df_set['price'], fit=norm)<br/>fig = plt.figure()</span></pre><figure class="lc ld le lf gt lt gh gi paragraph-image"><div class="gh gi np"><img src="../Images/7b518b1028eae43969eb0c7849fe1e1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:836/format:webp/1*eH4C5EbuqUPGWzvPEpQI3A.png"/></div><figcaption class="ma mb gj gh gi mc md bd b be z dk">before log transformation (Image by Author)</figcaption></figure><figure class="lc ld le lf gt lt gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/0cee4da2f19fd8d2ad8caeeb3b545b6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:756/format:webp/1*dkQQMMjdFRzpFAcSbeaxYg.png"/></div><figcaption class="ma mb gj gh gi mc md bd b be z dk">after log transformation (Image by Author)</figcaption></figure><ul class=""><li id="cade" class="me mf iq kh b ki kj kl km ko mg ks mh kw mi la mj mk ml mm bi translated"><strong class="kh ir">幂:</strong>如果我们从本质上知道自变量与目标变量存在指数或递减关系，我们可以使用幂变换。例如，当我们试图建立电视广告支出与销售额的模型时，我们知道在某个时候，电视广告对销售额的影响会降低。这就是所谓的“收益递减”。所以我们通常使用 0.3 到 0.7 的幂来转换电视支出，以便我们可以获得更好的模型拟合。</li><li id="37c9" class="me mf iq kh b ki mn kl mo ko mp ks mq kw mr la mj mk ml mm bi translated"><strong class="kh ir">标准化:</strong>减去平均值，除以标准差。标准化并没有使数据更正常，它只是改变了平均值和标准误差。</li></ul><figure class="lc ld le lf gt lt gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/08cab9f6abe9b30f7c5e4cbb5e629640.png" data-original-src="https://miro.medium.com/v2/resize:fit:214/format:webp/1*gxQPvK7CP6rg2DEdpznJqQ.png"/></div></figure><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="6512" class="ll lm iq lh b gy ln lo l lp lq">scaled_price = (logprice -np.mean(logprice))/np.sqrt(np.var(logprice))</span></pre><ul class=""><li id="8bfe" class="me mf iq kh b ki kj kl km ko mg ks mh kw mi la mj mk ml mm bi translated"><strong class="kh ir">均值归一化:</strong>分布的值介于-1 和 1 之间，均值为 0。</li></ul><figure class="lc ld le lf gt lt gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/f614185bb42e44e4aadfc0d829946789.png" data-original-src="https://miro.medium.com/v2/resize:fit:364/format:webp/1*cn16zRpgB5h3J8h7AF6YqA.png"/></div></figure><ul class=""><li id="eff8" class="me mf iq kh b ki kj kl km ko mg ks mh kw mi la mj mk ml mm bi translated"><strong class="kh ir">最小-最大缩放:</strong>带来 0 到 1 之间的值</li></ul><figure class="lc ld le lf gt lt gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/2c7dd1de9c751bb54fd8b3bd34baad49.png" data-original-src="https://miro.medium.com/v2/resize:fit:416/format:webp/1*aV8Qigxt2DeVgUl8HnI3yA.png"/></div></figure><h1 id="0c16" class="mt lm iq bd mu mv mw mx my mz na nb nc jw nd jx ne jz nf ka ng kc nh kd ni nj bi translated">离散变量的变换</h1><ul class=""><li id="454e" class="me mf iq kh b ki nk kl nl ko nm ks nn kw no la mj mk ml mm bi translated"><strong class="kh ir">标签编码:</strong>当实际值是文本，并且您想要为变量创建数值时。例如:</li></ul><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="35e9" class="ll lm iq lh b gy ln lo l lp lq">origin = [“USA”, “EU”, “EU”, “ASIA”,”USA”, “EU”, “EU”, “ASIA”, “ASIA”, “USA”]<br/>origin_series = pd.Series(origin)<br/>cat_origin = origin_series.astype('category')<br/>cat_origin.cat.codes</span><span id="f3ad" class="ll lm iq lh b gy lr lo l lp lq">0    2<br/>1    1<br/>2    1<br/>3    0<br/>4    2<br/>5    1<br/>6    1<br/>7    0<br/>8    0<br/>9    2<br/>dtype: int8</span><span id="317c" class="ll lm iq lh b gy lr lo l lp lq">#Or use scikit-learn's LabelEncoder:</span><span id="8bc9" class="ll lm iq lh b gy lr lo l lp lq">from sklearn.preprocessing import LabelEncoder<br/>lb_make = LabelEncoder()</span><span id="c0bf" class="ll lm iq lh b gy lr lo l lp lq">origin_encoded = lb_make.fit_transform(cat_origin)</span><span id="d57d" class="ll lm iq lh b gy lr lo l lp lq">origin_encoded</span><span id="8435" class="ll lm iq lh b gy lr lo l lp lq">array([2, 1, 1, 0, 2, 1, 1, 0, 0, 2])</span></pre><ul class=""><li id="0bf0" class="me mf iq kh b ki kj kl km ko mg ks mh kw mi la mj mk ml mm bi translated">宁滨:宁滨在处理序数值时非常得心应手。在模型中，我们可以通过基于值分布创建箱，然后创建虚拟变量，将变量转换为分类变量，而不是将顺序值作为整数读取。</li></ul><p id="5e4a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在金县房价例子中，等级是一个与房价正相关的顺序变量。</p><figure class="lc ld le lf gt lt gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/e0a5cb5fa82f32a2434133045d19030b.png" data-original-src="https://miro.medium.com/v2/resize:fit:974/format:webp/1*RlhHBRZo0cZec18E7Tr_9A.png"/></div><figcaption class="ma mb gj gh gi mc md bd b be z dk">Image by Author</figcaption></figure><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="3ac5" class="ll lm iq lh b gy ln lo l lp lq">df[‘grade’].describe()</span><span id="e391" class="ll lm iq lh b gy lr lo l lp lq">count    21596.000000<br/>mean         7.657946<br/>std          1.173218<br/>min          3.000000<br/>25%          7.000000<br/>50%          7.000000<br/>75%          8.000000<br/>max         13.000000<br/>Name: grade, dtype: float64</span></pre><p id="0fc9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以基于百分点值创建 4 个箱。</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="3c20" class="ll lm iq lh b gy ln lo l lp lq">bins = [3,7,8,10,13]<br/>bins_grade = pd.cut(df[‘grade’],bins)</span><span id="8f4d" class="ll lm iq lh b gy lr lo l lp lq">bins_grade.value_counts().plot(kind='bar')</span></pre><figure class="lc ld le lf gt lt gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/8851d4225ebf001c41974f6c255834f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:776/format:webp/1*NFNg5ElF2yAv-744E-Ym3g.png"/></div><figcaption class="ma mb gj gh gi mc md bd b be z dk">bins_grade (Image by Author)</figcaption></figure><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="b442" class="ll lm iq lh b gy ln lo l lp lq">bins_grade</span><span id="7890" class="ll lm iq lh b gy lr lo l lp lq">0          (3, 7]<br/>1          (3, 7]<br/>2          (3, 7]<br/>3          (3, 7]<br/>4          (7, 8]<br/>5        (10, 13]<br/>6          (3, 7]<br/>7          (3, 7]<br/>8          (3, 7]<br/>9          (3, 7]<br/>10         (7, 8]<br/>11         (3, 7]<br/>12         (3, 7]<br/>13         (3, 7]<br/>14         (3, 7]<br/>15        (8, 10]</span></pre><p id="8327" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后我们为它们创建虚拟变量，因为一些建模技术需要数值。</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="78ab" class="ll lm iq lh b gy ln lo l lp lq">bins_grade = bins_grade.cat.as_unordered()<br/>grade_dummy = pd.get_dummies(bins_grade, prefix=’grade’)</span></pre><ul class=""><li id="80b3" class="me mf iq kh b ki kj kl km ko mg ks mh kw mi la mj mk ml mm bi translated"><strong class="kh ir">创建虚拟变量</strong></li></ul><p id="6de4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">另一种创建虚拟变量的方法是使用 sklearn.preprocessing 包中的<strong class="kh ir"> LabelBinarizer</strong></p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="6bbe" class="ll lm iq lh b gy ln lo l lp lq">from sklearn.preprocessing import LabelBinarizer</span><span id="2c66" class="ll lm iq lh b gy lr lo l lp lq">lb = LabelBinarizer()<br/>grade_dummies = lb.fit_transform(grade)<br/># you need to convert this back to a dataframe<br/>grade_dum_df = pd.DataFrame(grade_dummies,columns=lb.classes_)</span></pre><p id="62d3" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用哑元的好处是，无论你使用什么算法，你的数值都不会被误解为连续的。接下来，重要的是要知道对于线性回归(以及 scikit-learn 中的大多数其他算法)，在回归模型中添加分类变量时需要<strong class="kh ir">一键编码</strong>！</p></div><div class="ab cl nw nx hu ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="ij ik il im in"><p id="6a97" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">同样，特征转换涉及多次迭代。有许多方法可以为模型获取正确的数据。保持好奇和耐心就好！</p></div></div>    
</body>
</html>