<html>
<head>
<title>Faster Pandas with parallel processing: cuDF vs. Modin</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">具有并行处理的更快的熊猫:cuDF 与 Modin</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/faster-pandas-with-parallel-processing-cudf-vs-modin-f2318c594084?source=collection_archive---------10-----------------------#2019-12-09">https://towardsdatascience.com/faster-pandas-with-parallel-processing-cudf-vs-modin-f2318c594084?source=collection_archive---------10-----------------------#2019-12-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/90767009a46f52947d9d9ce178dae1d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*htN0s-fY2TmgiqthUd4WiA.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@lindsayhenwood?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Lindsay Henwood</a> on <a class="ae kc" href="https://unsplash.com/s/photos/steps?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="98de" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对于 Pandas，默认情况下我们一次只能使用一个 CPU 内核。这对于小数据集来说没问题，但是当处理较大的文件时，这可能会造成瓶颈。</p><p id="a4e4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">通过使用并行处理来加快速度是可能的，但是如果你从未编写过多线程程序，不要担心:你不需要学习如何去做。一些新的图书馆可以为我们做到这一点。今天我们就来对比一下其中的两位:<a class="ae kc" href="https://github.com/rapidsai/cudf" rel="noopener ugc nofollow" target="_blank"> cuDF </a>和<a class="ae kc" href="https://github.com/modin-project/modin" rel="noopener ugc nofollow" target="_blank">摩丁</a>。它们都使用类似 pandas 的 API，所以我们可以通过修改 import 语句来开始使用它们。</p><h2 id="c3ef" class="lb lc iq bd ld le lf dn lg lh li dp lj ko lk ll lm ks ln lo lp kw lq lr ls lt bi translated">cuDF</h2><p id="23d4" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated"><a class="ae kc" href="https://github.com/rapidsai/cudf" rel="noopener ugc nofollow" target="_blank"> cuDF </a>是一个 GPU 数据帧库，它提供了一个<strong class="kf ir">类似熊猫的 API </strong>，允许我们加速我们的工作流，而无需进入 CUDA 编程的细节。lib 是 RAPIDS 的一部分，RAPIDS 是一套开源库，使用 GPU 加速，<strong class="kf ir">与流行的数据科学库和工作流</strong>集成，以加速机器学习。</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lz"><img src="../Images/376275ab2a3a682eb5c1b94b9b6662a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*xx-yJhML8P2TEKUE.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">The RAPIDS suite</figcaption></figure><p id="a614" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">该 API 与 pandas 非常相似，因此在大多数情况下，我们只需更改一行代码就可以开始使用它:</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="5a70" class="lb lc iq mf b gy mj mk l ml mm"><strong class="mf ir">import cudf as pd</strong></span><span id="4ad9" class="lb lc iq mf b gy mn mk l ml mm">s = pd<strong class="mf ir">.Series(</strong>[1,2,3,None,4]<strong class="mf ir">)</strong></span><span id="3c74" class="lb lc iq mf b gy mn mk l ml mm">df = pd<strong class="mf ir">.DataFrame</strong>([('a', list(range(20))),<br/>                     ('b', list(reversed(range(20)))),<br/>                     ('c', list(range(20)))]<strong class="mf ir">)</strong></span><span id="a156" class="lb lc iq mf b gy mn mk l ml mm">df.<strong class="mf ir">head</strong>(2)</span><span id="52e0" class="lb lc iq mf b gy mn mk l ml mm">df.<strong class="mf ir">sort_values</strong>(by='b')<br/>df['a']<br/>df.<strong class="mf ir">loc</strong>[2:5, ['a', 'b']]</span><span id="80c0" class="lb lc iq mf b gy mn mk l ml mm">s = pd.Series([1,2,3,None,4])<strong class="mf ir"><br/></strong>s.fillna(999)</span><span id="e454" class="lb lc iq mf b gy mn mk l ml mm">df = pd.<strong class="mf ir">read_csv(</strong>'example_output/foo.csv'<strong class="mf ir">)<br/></strong>df.<strong class="mf ir">to_csv(</strong>'example_output/foo.csv', index=False<strong class="mf ir">)</strong></span></pre><p id="a6fe" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">cuDF 是一个<strong class="kf ir">单 GPU 库</strong>。对于多 GPU，他们使用 Dask 和 dask-cudf 包，该包能够在单台机器上的多个 GPU 之间扩展 cudf，或者在一个集群中的许多机器上扩展多个 GPU[<a class="ae kc" href="https://rapidsai.github.io/projects/cudf/en/0.10.0/dask-cudf.html" rel="noopener ugc nofollow" target="_blank">cuDF 文档</a> ]。</p><h2 id="9a0c" class="lb lc iq bd ld le lf dn lg lh li dp lj ko lk ll lm ks ln lo lp kw lq lr ls lt bi translated">摩丁</h2><p id="179f" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated"><a class="ae kc" href="https://github.com/modin-project/modin" rel="noopener ugc nofollow" target="_blank"> Modin </a>还提供了一个<strong class="kf ir"> pandas-like API </strong>使用 Ray 或 Dask 实现一个高性能的分布式执行框架。有了 Modin，你可以使用<strong class="kf ir">你机器上的所有 CPU 内核</strong>。它在 4 个物理内核的笔记本电脑上提供了高达 4 倍的速度提升[ <a class="ae kc" href="https://github.com/modin-project/modin" rel="noopener ugc nofollow" target="_blank">摩丁文档</a> ]。</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mo"><img src="../Images/42380fab4abdfda22437521e8ae53de9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Km0V9HDi5W-o4i4Uzv6j5A.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk"><a class="ae kc" href="https://modin.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank">Modin</a></figcaption></figure><h1 id="83da" class="mp lc iq bd ld mq mr ms lg mt mu mv lj mw mx my lm mz na nb lp nc nd ne ls nf bi translated">环境</h1><p id="4a1d" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">我们将使用<a class="ae kc" href="https://maingear.com/nvidiadatascience/" rel="noopener ugc nofollow" target="_blank"> Maingear VYBE PRO 数据科学 PC </a>，我正在使用 Jupyter 运行脚本。以下是技术规格:</p><h2 id="bd6a" class="lb lc iq bd ld le lf dn lg lh li dp lj ko lk ll lm ks ln lo lp kw lq lr ls lt bi translated">Maingear VYBE PRO 数据科学电脑</h2><ul class=""><li id="a717" class="ng nh iq kf b kg lu kk lv ko ni ks nj kw nk la nl nm nn no bi translated">125gb 内存</li><li id="8aaa" class="ng nh iq kf b kg np kk nq ko nr ks ns kw nt la nl nm nn no bi translated">i9–7980 xe，36 个内核</li><li id="2ea4" class="ng nh iq kf b kg np kk nq ko nr ks ns kw nt la nl nm nn no bi translated">2x 泰坦 RTX 24GB</li></ul><p id="c016" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">用于基准的数据集是<a class="ae kc" href="http://download.inep.gov.br/microdados/microdados_educacao_superior_2018.zip" rel="noopener ugc nofollow" target="_blank">巴西 2018 年高等教育普查</a>。</p><h1 id="a796" class="mp lc iq bd ld mq mr ms lg mt mu mv lj mw mx my lm mz na nb lp nc nd ne ls nf bi translated">基准 1:读取一个 CSV 文件</h1><p id="2b2e" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">让我们使用 Pandas、cuDF 和 Modin 读取一个 3gb 的 CSV 文件。我们将运行它 30 次并得到平均值。</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="nu nv l"/></div></figure><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/3a7c8b3d60c320c77506fe35c24ddb99.png" data-original-src="https://miro.medium.com/v2/resize:fit:764/0*cRWyH59pKnrY_9Tz"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Reading a CSV file</figcaption></figure><p id="7db7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">摩丁以平均不到 4s 胜出。它会自动在系统的所有可用 CPU 内核中分配计算，我们有 36 个内核，这可能就是原因🤔？</p><h1 id="2999" class="mp lc iq bd ld mq mr ms lg mt mu mv lj mw mx my lm mz na nb lp nc nd ne ls nf bi translated">基准 2:缺失值</h1><p id="21dc" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">在这个基准测试中，我们将填充数据帧的 NaN 值。</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="nu nv l"/></div></figure><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/b9b7c95a6963516156b8f543c3cb0a06.png" data-original-src="https://miro.medium.com/v2/resize:fit:784/0*LxcdgfnFRsYClFnF"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Filling missing values</figcaption></figure><p id="8418" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">摩丁也是这个基准的赢家。cuDF 是平均运行时间更长的库。</p><h1 id="2556" class="mp lc iq bd ld mq mr ms lg mt mu mv lj mw mx my lm mz na nb lp nc nd ne ls nf bi translated">基准 3:分组依据</h1><p id="872c" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">让我们将行分组，看看每个库的行为。</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="nu nv l"/></div></figure><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/38995044793dcab2a089c0894ada0474.png" data-original-src="https://miro.medium.com/v2/resize:fit:772/0*OPQL_3ijNPebgeNT"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Grouping rows</figcaption></figure><p id="7f0a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这里 cuDF 是赢家，摩丁表现最差。</p><h1 id="4be2" class="mp lc iq bd ld mq mr ms lg mt mu mv lj mw mx my lm mz na nb lp nc nd ne ls nf bi translated">酷，那么我应该使用哪个库呢？</h1><figure class="ma mb mc md gt jr gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/cc56461199570b2499e1b0ee81fbd515.png" data-original-src="https://miro.medium.com/v2/resize:fit:962/format:webp/1*7UsoXElOKZa1Ej4npITISQ.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk"><a class="ae kc" href="https://twitter.com/swyx/status/1202202923385536513" rel="noopener ugc nofollow" target="_blank">https://twitter.com/swyx/status/1202202923385536513</a></figcaption></figure><p id="b27d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要回答这个问题，我想我们必须考虑一下<strong class="kf ir">我们在工作流程中最常用的方法</strong>。在今天的基准测试中，使用 Modin 读取文件要快得多，但是我们需要在 ETL 中使用多少次<code class="fe oa ob oc mf b">read_csv()</code>方法呢？相比之下，理论上，我们会更频繁地使用<code class="fe oa ob oc mf b">groupby()</code>方法，在这种情况下，cuDF 库的性能最好。</p><p id="e4c0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Modin 很容易安装(我们只需要使用 pip)，cuDF 比较难(你需要更新 NVIDIA 驱动，安装 CUDA，然后使用 conda 安装 cuDF)。或者你可以跳过所有这些步骤，得到一台<a class="ae kc" rel="noopener" target="_blank" href="/how-to-use-gpus-for-machine-learning-with-the-new-nvidia-data-science-workstation-64ef37460fa0">数据科学电脑</a>，因为它配备了所有 RAPIDS 库和完全安装的软件。</p><p id="2049" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，摩丁和 cuDF 仍处于早期阶段，他们还没有完整覆盖整个熊猫 API。</p><h1 id="4060" class="mp lc iq bd ld mq mr ms lg mt mu mv lj mw mx my lm mz na nb lp nc nd ne ls nf bi translated">入门指南</h1><p id="c7ca" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">如果你想深入研究 cuDF，10 分钟到 cuDF 和 Dask-cuDF 是一个很好的起点。</p><p id="cf8c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">关于摩丁的更多信息，<a class="ae kc" href="https://rise.cs.berkeley.edu/blog/pandas-on-ray-early-lessons/" rel="noopener ugc nofollow" target="_blank">这篇博文</a>解释了更多关于用<a class="ae kc" href="https://github.com/ray-project/ray" rel="noopener ugc nofollow" target="_blank">射线</a>并行化熊猫的信息。如果你想更深入地了解，还有关于用 Modin 透明地扩展交互式数据科学的技术报告，它很好地解释了 Modin 的技术架构。</p></div></div>    
</body>
</html>