<html>
<head>
<title>Violin plots explained</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">小提琴情节解释</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/violin-plots-explained-fb1d115e023d?source=collection_archive---------0-----------------------#2019-10-22">https://towardsdatascience.com/violin-plots-explained-fb1d115e023d?source=collection_archive---------0-----------------------#2019-10-22</a></blockquote><div><div class="fc ij ik il im in"/><div class="io ip iq ir is"><figure class="iu iv gp gr iw ix gh gi paragraph-image"><div role="button" tabindex="0" class="iy iz di ja bf jb"><div class="gh gi it"><img src="../Images/8b1e711813bb4d7576abdc659f8144de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EcNP8AaluYi8akcI_FtYow.jpeg"/></div></div><figcaption class="je jf gj gh gi jg jh bd b be z dk">Source: <a class="ae ji" href="https://unsplash.com/photos/OgqntOgPUP4" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><div class=""/><div class=""><h2 id="cfa5" class="pw-subtitle-paragraph ki jk jl bd b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz dk translated">学习如何使用小提琴情节，以及它们比盒子情节有什么优势！</h2></div><p id="1682" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">一般来说，violin 图是一种绘制数字数据的方法，可以被认为是<a class="ae ji" href="https://en.wikipedia.org/wiki/Box_plot" rel="noopener ugc nofollow" target="_blank">盒图</a>和<a class="ae ji" href="https://en.wikipedia.org/wiki/Kernel_density_estimation" rel="noopener ugc nofollow" target="_blank">核密度图</a>的组合。在小提琴图中，我们可以找到与盒子图中相同的信息:</p><ul class=""><li id="c621" class="lw lx jl lc b ld le lg lh lj ly ln lz lr ma lv mb mc md me bi translated">中值(小提琴图上的白点)</li><li id="6428" class="lw lx jl lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">四分位范围(小提琴中间的黑条)</li><li id="1714" class="lw lx jl lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">下/上相邻值(从条上拉伸的黑线)——分别定义为<code class="fe mk ml mm mn b">first quartile — 1.5 IQR</code>和<code class="fe mk ml mm mn b">third quartile + 1.5 IQR</code>。这些值可用于简单的异常值检测技术(图基栅栏)，位于这些“栅栏”之外的观察值可被视为异常值。</li></ul><figure class="mp mq mr ms gt ix gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/ebddccd1b0d849a2325b03c0e745d9ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1040/format:webp/1*TTMOaNG1o4PgQd-e8LurMg.png"/></div><figcaption class="je jf gj gh gi jg jh bd b be z dk"><a class="ae ji" href="https://medium.com/@shobhitsrivastava18th/boxplot-v-s-violinplot-93a1d9f3a831" rel="noopener">Source</a></figcaption></figure><p id="b96e" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">与箱线图相比，小提琴图无可置疑的优势在于，除了显示上述统计数据之外，它还显示了数据的整体分布。这是令人感兴趣的，尤其是当处理多峰数据时，<em class="mt">，即</em>，具有一个以上峰值的分布。</p><h1 id="b31e" class="mu mv jl bd mw mx my mz na nb nc nd ne kr nf ks ng ku nh kv ni kx nj ky nk nl bi translated">用 Python 实现</h1><p id="0d02" class="pw-post-body-paragraph la lb jl lc b ld nm km lf lg nn kp li lj no ll lm ln np lp lq lr nq lt lu lv io bi translated">在本文中，我们使用以下库:</p><pre class="mp mq mr ms gt nr mn ns nt aw nu bi"><span id="6d59" class="nv mv jl mn b gy nw nx l ny nz">seaborn    0.9.0<br/>numpy      1.17.2<br/>pandas     0.25.1<br/>matplotlib 3.1.1</span></pre><p id="6a95" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">我们首先定义我们将从某些分布中抽取的随机观察值的数量，以及为结果的可重复性设置种子。</p><pre class="mp mq mr ms gt nr mn ns nt aw nu bi"><span id="9cf5" class="nv mv jl mn b gy nw nx l ny nz">N = 10 ** 4<br/>np.random.seed(42)</span></pre><p id="7c09" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">然后，我们定义一个绘制以下内容的函数:</p><ul class=""><li id="f26a" class="lw lx jl lc b ld le lg lh lj ly ln lz lr ma lv mb mc md me bi translated">具有核密度估计的直方图(KDE)</li><li id="9e22" class="lw lx jl lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">箱线图</li><li id="6a24" class="lw lx jl lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">小提琴的情节</li></ul><p id="1187" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">我们将使用这个函数来检查随机创建的样本。</p><pre class="mp mq mr ms gt nr mn ns nt aw nu bi"><span id="b85c" class="nv mv jl mn b gy nw nx l ny nz">def plot_comparison(x, title):<br/>    fig, ax = plt.subplots(3, 1, sharex=True)<br/>    sns.distplot(x, ax=ax[0])<br/>    ax[0].set_title('Histogram + KDE')<br/>    sns.boxplot(x, ax=ax[1])<br/>    ax[1].set_title('Boxplot')<br/>    sns.violinplot(x, ax=ax[2])<br/>    ax[2].set_title('Violin plot')<br/>    fig.suptitle(title, fontsize=16)<br/>    plt.show()</span></pre><h2 id="6b90" class="nv mv jl bd mw oa ob dn na oc od dp ne lj oe of ng ln og oh ni lr oi oj nk ok bi translated">标准正态分布</h2><p id="d0bb" class="pw-post-body-paragraph la lb jl lc b ld nm km lf lg nn kp li lj no ll lm ln np lp lq lr nq lt lu lv io bi translated">我们从最基本的分布开始——标准正态分布。我们随机抽取 10000 个数字并绘制结果。</p><pre class="mp mq mr ms gt nr mn ns nt aw nu bi"><span id="5f1b" class="nv mv jl mn b gy nw nx l ny nz">sample_gaussian = np.random.normal(size=N)<br/>plot_comparison(sample_gaussian, 'Standard Normal Distribution')</span></pre><figure class="mp mq mr ms gt ix gh gi paragraph-image"><div role="button" tabindex="0" class="iy iz di ja bf jb"><div class="gh gi ol"><img src="../Images/f52a66e2b95f886a14405f52a8f14060.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dLw-Ib14E5VNSR_w1eIFug.png"/></div></div></figure><p id="c887" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">我们可以做一些观察:</p><ul class=""><li id="9280" class="lw lx jl lc b ld le lg lh lj ly ln lz lr ma lv mb mc md me bi translated">在直方图中，我们可以看到分布的对称形状</li><li id="5c84" class="lw lx jl lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">我们可以在箱线图和小提琴图中看到前面提到的指标(中位数、IQR、图基围栏)</li><li id="7a92" class="lw lx jl lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">用于创建小提琴图的内核密度图与添加到直方图顶部的内核密度图相同。小提琴图的较宽部分代表观察值取给定值的较高概率，较薄部分对应较低概率。</li></ul><p id="6632" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">我相信把这三个情节放在一起展示，可以很好地直观地了解小提琴的情节到底是什么，以及它包含了什么样的信息。</p><h2 id="3b4e" class="nv mv jl bd mw oa ob dn na oc od dp ne lj oe of ng ln og oh ni lr oi oj nk ok bi translated">对数正态分布</h2><p id="8752" class="pw-post-body-paragraph la lb jl lc b ld nm km lf lg nn kp li lj no ll lm ln np lp lq lr nq lt lu lv io bi translated">在第二个例子中，我们考虑对数正态分布，它肯定比正态分布更偏斜。</p><pre class="mp mq mr ms gt nr mn ns nt aw nu bi"><span id="d3d8" class="nv mv jl mn b gy nw nx l ny nz">sample_lognormal = np.random.lognormal(size=N)<br/>plot_comparison(sample_lognormal, 'Log-normal Distribution')</span></pre><figure class="mp mq mr ms gt ix gh gi paragraph-image"><div role="button" tabindex="0" class="iy iz di ja bf jb"><div class="gh gi om"><img src="../Images/e7819f1c504346159c463bd67fff9826.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PeX4ZV2hxkZF2DOrZU6CSw.png"/></div></div></figure><h2 id="1b29" class="nv mv jl bd mw oa ob dn na oc od dp ne lj oe of ng ln og oh ni lr oi oj nk ok bi translated">高斯混合物—双峰</h2><p id="9059" class="pw-post-body-paragraph la lb jl lc b ld nm km lf lg nn kp li lj no ll lm ln np lp lq lr nq lt lu lv io bi translated">在前两个例子中，我们已经看到小提琴图比盒子图包含更多的信息。当我们考虑多式联运配送时，这一点更加明显。在本例中，我们创建了一个双峰分布，作为两个高斯分布的混合。</p><figure class="mp mq mr ms gt ix"><div class="bz fp l di"><div class="on oo l"/></div></figure><p id="8fd8" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">如果不看直方图/密度图，就不可能在我们的数据中找到两个峰值。</p><figure class="mp mq mr ms gt ix gh gi paragraph-image"><div role="button" tabindex="0" class="iy iz di ja bf jb"><div class="gh gi om"><img src="../Images/5586b60910b23f4d9168d161287e35d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Uv7CXOXoYKM4B7ZkuvoXCQ.png"/></div></div></figure><h1 id="69b2" class="mu mv jl bd mw mx my mz na nb nc nd ne kr nf ks ng ku nh kv ni kx nj ky nk nl bi translated">高级用法</h1><p id="9a20" class="pw-post-body-paragraph la lb jl lc b ld nm km lf lg nn kp li lj no ll lm ln np lp lq lr nq lt lu lv io bi translated">小提琴图通常用于比较给定变量在某些类别中的分布。我们在下面介绍了几种可能性。为此，我们从<code class="fe mk ml mm mn b">seaborn</code>加载<code class="fe mk ml mm mn b">tips</code>数据集。</p><pre class="mp mq mr ms gt nr mn ns nt aw nu bi"><span id="ea5f" class="nv mv jl mn b gy nw nx l ny nz">tips = sns.load_dataset("tips")</span></pre><p id="a3b0" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">在第一个例子中，我们看看小费在不同性别中的分布。此外，我们改变了 violin 图的结构，只显示四分点。一些其他的可能性包括<code class="fe mk ml mm mn b">point</code>用于显示所有的观察结果，或者<code class="fe mk ml mm mn b">box</code>用于在小提琴图内绘制一个小方框图。</p><pre class="mp mq mr ms gt nr mn ns nt aw nu bi"><span id="c4c7" class="nv mv jl mn b gy nw nx l ny nz">ax = sns.violinplot(x="sex", y="tip", inner='quartile', data=tips)<br/>ax.set_title('Distribution of tips', fontsize=16);</span></pre><figure class="mp mq mr ms gt ix gh gi paragraph-image"><div role="button" tabindex="0" class="iy iz di ja bf jb"><div class="gh gi op"><img src="../Images/662d328e3f3e5988048508fc24a0252b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6hGDrjT5BICKPBfE4BgrcQ.png"/></div></div></figure><p id="14d7" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">我们看到，两种性别尖端的整体形状和分布是相似的(四分位数彼此非常接近)，但男性的异常值更多。</p><p id="40b8" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">在第二个例子中，我们研究了每天账单总额的分布。此外，我们按性别划分。我们立刻发现，性别分布形状的最大差异发生在周五。</p><pre class="mp mq mr ms gt nr mn ns nt aw nu bi"><span id="49ac" class="nv mv jl mn b gy nw nx l ny nz">ax = sns.violinplot(x="day", y="total_bill", hue="sex", data=tips)<br/>ax.set_title('Distribution of total bill amount per day', fontsize=16);</span></pre><figure class="mp mq mr ms gt ix gh gi paragraph-image"><div role="button" tabindex="0" class="iy iz di ja bf jb"><div class="gh gi ol"><img src="../Images/52d44cf4ebdd83de382348ca7bf48dee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RCinTh4NKSYRW0L7tKTLyA.png"/></div></div></figure><p id="b080" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">在最后一个例子中，我们调查了与前一个例子相同的事情，但是，我们设置了<code class="fe mk ml mm mn b">split=True</code>。这样做，我们得到的不是 8 把小提琴，而是 4 把——小提琴的每一面对应不同的性别。</p><pre class="mp mq mr ms gt nr mn ns nt aw nu bi"><span id="c9e4" class="nv mv jl mn b gy nw nx l ny nz">ax = sns.violinplot(x="day", y="total_bill", hue="sex", split=True, data=tips)<br/>ax.set_title('Distribution of total bill amount per day', fontsize=16);</span></pre><figure class="mp mq mr ms gt ix gh gi paragraph-image"><div role="button" tabindex="0" class="iy iz di ja bf jb"><div class="gh gi oq"><img src="../Images/78191e26c11c1ff4257a8b8261e97797.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FFZjRMfziX_ALy4KVPrAkw.png"/></div></div></figure><h1 id="6638" class="mu mv jl bd mw mx my mz na nb nc nd ne kr nf ks ng ku nh kv ni kx nj ky nk nl bi translated">结论</h1><p id="6e7d" class="pw-post-body-paragraph la lb jl lc b ld nm km lf lg nn kp li lj no ll lm ln np lp lq lr nq lt lu lv io bi translated">在这篇文章中，我展示了什么是小提琴情节，如何解释它们，以及它们相对于盒子情节的优势。值得注意的最后一点是，只要四分位数保持不变，箱线图就不会发生变化。我们可以用四分位数不变的方式修改数据，但分布的形状会有很大的不同。下面的 GIF 说明了这一点。</p><figure class="mp mq mr ms gt ix gh gi paragraph-image"><div role="button" tabindex="0" class="iy iz di ja bf jb"><div class="gh gi or"><img src="../Images/3392b3dbad80778086721007fb633ad3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*G5GJ9_M68FBFeZB2wePnjQ.gif"/></div></div><figcaption class="je jf gj gh gi jg jh bd b be z dk"><a class="ae ji" href="https://www.autodeskresearch.com/publications/samestats" rel="noopener ugc nofollow" target="_blank">Source</a></figcaption></figure><p id="c9ab" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">一如既往，我们欢迎任何建设性的反馈。你可以在推特<a class="ae ji" href="https://twitter.com/erykml1" rel="noopener ugc nofollow" target="_blank">或评论中联系我。您可以在我的</a><a class="ae ji" href="https://github.com/erykml/medium_articles/blob/master/Statistics/violin_plots.ipynb" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到本文使用的代码。</p><p id="1f56" class="pw-post-body-paragraph la lb jl lc b ld le km lf lg lh kp li lj lk ll lm ln lo lp lq lr ls lt lu lv io bi translated">喜欢这篇文章吗？成为一个媒介成员，通过无限制的阅读继续学习。如果你使用<a class="ae ji" href="https://eryk-lewinson.medium.com/membership" rel="noopener">这个链接</a>成为会员，你将支持我，而不需要额外的费用。提前感谢，再见！</p></div></div>    
</body>
</html>