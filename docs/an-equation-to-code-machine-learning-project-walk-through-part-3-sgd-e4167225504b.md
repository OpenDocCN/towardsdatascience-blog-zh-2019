# â€œç­‰å¼åˆ°ä»£ç â€æœºå™¨å­¦ä¹ é¡¹ç›®æ¼”ç»ƒâ€”ç¬¬ 3 éƒ¨åˆ† SGD

> åŸæ–‡ï¼š<https://towardsdatascience.com/an-equation-to-code-machine-learning-project-walk-through-part-3-sgd-e4167225504b?source=collection_archive---------15----------------------->

## ç”¨ Python å®ç°éšæœºæ¢¯åº¦ä¸‹é™(SGD)å’Œå°æ‰¹é‡æ¢¯åº¦ä¸‹é™çš„è¯¦ç»†è¯´æ˜

![](img/5410c1f5b4bdee5b89186442a9cf3f09.png)

from Shutterstock

å¤§å®¶å¥½ï¼è¿™æ˜¯â€œç­‰å¼åˆ°ä»£ç â€æ¼”ç»ƒçš„ç¬¬ 3 éƒ¨åˆ†ã€‚

åœ¨å‰é¢çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬åœ¨**ä¸­è°ˆåˆ°äº†çº¿æ€§å¯åˆ†é—®é¢˜**åœ¨[ç¬¬ä¸€éƒ¨åˆ†](/an-equation-to-code-machine-learning-project-walk-through-in-python-part-1-linear-separable-fd0e19ed2d7)ï¼Œåœ¨[ç¬¬äºŒéƒ¨åˆ†](/an-equation-to-code-machine-learning-project-walk-through-in-python-part-2-non-linear-d193c3c23bac)ä¸­è°ˆåˆ°äº†**éçº¿æ€§å¯åˆ†é—®é¢˜**ã€‚è¿™æ¬¡æˆ‘ä»¬å°†æ ¹æ®ç­‰å¼å®ç°**éšæœºæ¢¯åº¦ä¸‹é™(SGD)** ã€‚

ç¬¬ 3 éƒ¨åˆ†æ˜¯ç‹¬ç«‹çš„ã€‚ä½†å¯¹äº [part 2](/an-equation-to-code-machine-learning-project-walk-through-in-python-part-2-non-linear-d193c3c23bac?source=your_stories_page---------------------------) ä¸­é‡å¤çš„å†…å®¹æˆ‘å°±ä¸åšè¿‡å¤šè§£é‡Šäº†ã€‚å¦‚æœä½ è§‰å¾—æœ‰äº›ä¸œè¥¿å¾ˆéš¾ç†è§£ï¼Œæˆ‘æ¨èä½ å…ˆé˜…è¯» [part 2](/an-equation-to-code-machine-learning-project-walk-through-in-python-part-2-non-linear-d193c3c23bac) ã€‚

ä¸‹é¢æ˜¯[æ•°æ®](https://gist.github.com/BrambleXu/52b0aaf10987015a078d36c97729dace)å’Œ[ä»£ç ](https://gist.github.com/BrambleXu/0e00bbd2f11ad7b3fa264c4ea27ea03b)ã€‚

å†…å®¹ç»“æ„å¦‚ä¸‹ã€‚`*`è¡¨ç¤ºå¦‚æœæ‚¨å·²ç»å®Œæˆç¬¬ 2 éƒ¨åˆ†ï¼Œå¯ä»¥è·³è¿‡è¿™ä¸€æ­¥ã€‚

1.  é¢„è§ˆ*
2.  éšæœºæ¢¯åº¦ä¸‹é™
3.  å°æ‰¹é‡æ¢¯åº¦ä¸‹é™
4.  æ‘˜è¦

# 1 é¢„è§ˆ

> å¦‚æœæ‚¨å·²ç»é˜…è¯»äº†[ç¬¬ 2 éƒ¨åˆ†](/an-equation-to-code-machine-learning-project-walk-through-in-python-part-2-non-linear-d193c3c23bac)ï¼Œæ‚¨å¯ä»¥è·³è¿‡è¿™ä¸€æ­¥

é¦–å…ˆï¼Œæˆ‘ä»¬çœ‹çœ‹æˆ‘ä»¬åœ¨ç¬¬ 2 éƒ¨åˆ†åšäº†ä»€ä¹ˆã€‚

è¿™é‡Œæ˜¯æ•°æ®ï¼Œ [non_linear_data.csv](https://gist.github.com/BrambleXu/a64df128d6c0c26143f82f7b6e889983)

```
x1,x2,y
0.54508775,2.34541183,0
0.32769134,13.43066561,0
4.42748117,14.74150395,0
2.98189041,-1.81818172,1
4.02286274,8.90695686,1
2.26722613,-6.61287392,1
-2.66447221,5.05453871,1
-1.03482441,-1.95643469,1
4.06331548,1.70892541,1
2.89053966,6.07174283,0
2.26929206,10.59789814,0
4.68096051,13.01153161,1
1.27884366,-9.83826738,1
-0.1485496,12.99605136,0
-0.65113893,10.59417745,0
3.69145079,3.25209182,1
-0.63429623,11.6135625,0
0.17589959,5.84139826,0
0.98204409,-9.41271559,1
-0.11094911,6.27900499,0
```

æ•°æ®å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚

![](img/7ade453276139aebde2a779b35800e5f.png)

åœ¨å¯¹æ•°æ®ä½œå›¾åï¼Œæˆ‘ä»¬å‘ç°ä¸€æ¡ç›´çº¿æ— æ³•å°† X å’Œ o åˆ†å¼€ï¼Œè¿™ç±»é—®é¢˜è¢«ç§°ä¸º**éçº¿æ€§å¯åˆ†é—®é¢˜**ï¼Œæ•°æ®ä¸æ˜¯çº¿æ€§å¯åˆ†çš„ã€‚

æ‰€ä»¥æˆ‘ä»¬å¼•å…¥å¤šé¡¹å¼ logistic å›å½’ï¼Œåœ¨çº¿æ€§å‡½æ•°ä¸­å¢åŠ ä¸€ä¸ªå¤šé¡¹å¼é¡¹ã€‚

![](img/1fe7abc3aac2d5f70ec337406cae4fa1.png)

polynomial function

æˆ‘ä»¬ç”¨Î¸æ¥è¡¨ç¤ºå‚æ•°ã€‚å·¦è¾¹çš„Î¸æ ‡è®°è¡¨ç¤ºå‡½æ•° f(x)æœ‰å‚æ•°Î¸ã€‚å³è¾¹çš„Î¸è¡¨ç¤ºæœ‰ä¸¤ä¸ªå‚æ•°ã€‚æœ€åä¸€é¡¹æ˜¯å¤šé¡¹å¼é¡¹ï¼Œå®ƒä½¿æ¨¡å‹æ¨å¹¿åˆ°éçº¿æ€§å¯åˆ†æ•°æ®ã€‚

æ³¨æ„ï¼Œæˆ‘ä»¬åœ¨ [non_linear_data.csv](https://gist.github.com/BrambleXu/a64df128d6c0c26143f82f7b6e889983) ä¸­æœ‰ x1 å’Œ x2 ä¸¤ä¸ªç‰¹å¾ã€‚æˆ‘ä»¬é€‰æ‹© x1 ä½œä¸ºå¤šé¡¹å¼é¡¹ã€‚æ‰€ä»¥åŠŸèƒ½åº”è¯¥å˜æˆä½äºå½¢å¼ã€‚

![](img/3f19fd852c6c8878549a3d6a524e359b.png)

a specific form fit to our data

ç„¶åæˆ‘ä»¬å¼•å…¥æ ‡å‡†åŒ–ã€‚

![](img/5c3f709c7b442c54fde9bf1fc63508c0.png)

*   ğœ‡åœ¨æ¯ä¸€æ éƒ½å¾ˆåˆ»è–„
*   ğœæ˜¯æ¯åˆ—çš„æ ‡å‡†åå·®

å¯¹äºé¢„æµ‹æ¨¡å‹ï¼Œæˆ‘ä»¬ä½¿ç”¨ sigmoid å‡½æ•°ã€‚ä¸‹é¢æ˜¯çŸ¢é‡è¡¨ç¤ºã€‚

![](img/6b8e85b53ae5c43c8ad4dff2f1299236.png)

æˆ‘ä»¬ç”¨ z æ¥è¡¨ç¤ºçº¿æ€§å‡½æ•°ï¼Œå¹¶å°†å…¶ä¼ é€’ç»™ sigmoid å‡½æ•°ã€‚sigmoid å‡½æ•°å°†ç»™å‡ºæ¯ä¸ªæ•°æ®æ ·æœ¬çš„æ¦‚ç‡ã€‚æˆ‘ä»¬æ•°æ®ä¸­æœ‰ä¸¤ä¸ªç±»ï¼Œä¸€ä¸ªæ˜¯`1`ï¼Œå¦ä¸€ä¸ªæ˜¯`0`ã€‚

![](img/598ca2a33e63ef98b71a31237199f730.png)

å¥½äº†ï¼Œæˆ‘ä»¬å‡†å¤‡äº†æ•°æ®ã€æ¨¡å‹(sigmoid ),è¿˜éœ€è¦ä»€ä¹ˆï¼Ÿæ˜¯çš„ï¼Œä¸€ä¸ªç›®æ ‡å‡½æ•°ã€‚**ç›®æ ‡å‡½æ•°å¯ä»¥æŒ‡å¯¼æˆ‘ä»¬å¦‚ä½•ä»¥æ­£ç¡®çš„æ–¹å¼æ›´æ–°å‚æ•°ã€‚**å¯¹äº sigmoid(é€»è¾‘å›å½’)ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨[å¯¹æ•°ä¼¼ç„¶](https://www.wikiwand.com/en/Likelihood_function#/Log-likelihood)ä½œä¸ºç›®æ ‡å‡½æ•°ã€‚æ›´å…·ä½“åœ°è¯´ï¼Œæˆ‘ä»¬éœ€è¦è®¡ç®—å¯¹æ•°ä¼¼ç„¶å‡½æ•°çš„**å¯¼æ•°**ã€‚è¿™é‡Œæˆ‘ç›´æ¥ç»™å‡ºæœ€åçš„æ›´æ–°æ–¹ç¨‹å¼ã€‚(å¦‚æœä½ å¯¹å¦‚ä½•å¾—åˆ°è¿™ä¸ªæ–¹ç¨‹æ„Ÿå…´è¶£ï¼Œè¿™ä¸ª[è§†é¢‘](https://www.youtube.com/watch?v=SB2vz57eKgc)åº”è¯¥ä¼šæœ‰å¸®åŠ©)

![](img/92da534e72a3ead43346ba4017d5b243.png)

Î¸j æ˜¯ç¬¬ j ä¸ªå‚æ•°ã€‚

*   Î·æ˜¯å­¦ä¹ ç‡ï¼Œæˆ‘ä»¬è®¾ä¸º 0.001 (1e-3)ã€‚
*   n æ˜¯æ•°æ®æ ·æœ¬çš„æ•°é‡ï¼Œåœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æœ‰ 20 ä¸ªã€‚
*   I æ˜¯ç¬¬ I ä¸ªæ•°æ®æ ·æœ¬

ç±»ä¼¼ Numpy æ•°ç»„çš„ç‰ˆæœ¬å¯èƒ½å®¹æ˜“ç†è§£ã€‚

![](img/8548f80491498880aa47207a696be49e.png)

æˆ‘ä»¬ç»˜åˆ¶æ¨¡å‹çº¿å’Œç²¾åº¦çº¿ã€‚

![](img/6c1f0882db8ada4bf159cb93c511fce8.png)

model line

![](img/04f6e80589c0dad58f12db5b1e18d592.png)

accuracy line

ä¸‹é¢æ˜¯æˆ‘ä»¬åœ¨ç¬¬ 2 éƒ¨åˆ†ä¹‹åç•™ä¸‹çš„å…¨éƒ¨ä»£ç ã€‚

å¦‚æœä½ è§‰å¾—æœ‰äº›ä¸œè¥¿éš¾ä»¥ç†è§£ï¼Œä½ å¯ä»¥é˜…è¯»[ç¬¬ 2 éƒ¨åˆ†](/an-equation-to-code-machine-learning-project-walk-through-in-python-part-2-non-linear-d193c3c23bac)è·å¾—è¯¦ç»†è§£é‡Šã€‚

# 2 éšæœºæ¢¯åº¦ä¸‹é™æ³•

æˆ‘ä»¬ä½¿ç”¨ SGD çš„ä¸»è¦åŸå› æ˜¯ä¸ºäº†é¿å…å±€éƒ¨æœ€å°å€¼ã€‚

![](img/81a8d373399c098c58d534d481c206be.png)

the parameter is trapped in a local minimum

åŸºæœ¬æ€æƒ³æ˜¯é€šè¿‡åœ¨æ¯æ¬¡æ›´æ–°ä¸­éšæœºé€‰æ‹©ä¸€ä¸ªæ•°æ®æ¥æ›´æ–°å‚æ•°ã€‚æ‰€ä»¥å‚æ•°æ›´å®¹æ˜“èµ°å‡ºå±€éƒ¨æå°å€¼ã€‚

![](img/92da534e72a3ead43346ba4017d5b243.png)

gradient descent

è¿™æ˜¯æ¢¯åº¦ä¸‹é™å½¢å¼ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œä¸ºäº†æ›´æ–°Î¸jï¼Œæˆ‘ä»¬ä½¿ç”¨äº†æ•´ä¸ªè®­ç»ƒæ•°æ®(Ïƒéƒ¨åˆ†)ã€‚ä»£ç å¦‚ä¸‹ã€‚

```
# initialize parameter
theta = np.random.randn(4)# update parameter
**for _ in range(epoch):
    theta = theta - ETA * np.dot(f(mat_x) - train_y, mat_x)**
```

ä½†æ˜¯åœ¨ SGD ä¸­ï¼Œæˆ‘ä»¬ä¸€æ¬¡åªç”¨ä¸€ä¸ªæ•°æ®ã€‚

![](img/ecb25001c56be3994cffd3454bb8e5bd.png)

stochastic gradient descent

è¿™é‡Œçš„`k`æ˜¯æŒ‡æˆ‘ä»¬éšæœºé€‰å–çš„æ•°æ®ã€‚

```
# initialize parameter
theta = np.random.randn(4)# update parameter
for _ in range(epoch):    # sgd
    **p = np.random.permutation(len(mat_x))
    for x, y in zip(mat_x[p, :], train_y[p]):
        theta = theta - ETA * (f(x) - y) * x**
```

*   p åŒ…å«æ•´ä¸ªæ•°æ®é›†çš„éšæœºç´¢å¼•åˆ—è¡¨ï¼Œä¾‹å¦‚ï¼Œ[ 5ï¼Œ12ï¼Œ17ï¼Œ14ï¼Œ8ï¼Œ9ï¼Œ10ï¼Œ2ï¼Œ13ï¼Œ18ï¼Œ15ï¼Œ16ï¼Œ1ï¼Œ0ï¼Œ6ï¼Œ11ï¼Œ7ï¼Œ4ï¼Œ3ï¼Œ19]
*   for å¾ªç¯æ¯æ¬¡å–ä¸€ä¸ªæ•°æ®æ¥æ›´æ–°å‚æ•°Î¸

ä½ å¯ä»¥è¿™æ ·æƒ³ SGDã€‚åœ¨æ¯ä¸ªå†å…ƒä¸­ï¼Œæ¢¯åº¦ä¸‹é™å’Œ SGD éƒ½ä½¿ç”¨æ•´ä¸ªæ•°æ®é›†æ¥æ›´æ–°å‚æ•°ã€‚ç”¨**å®Œæ•´æœ‰åºæ•°æ®**æ¢¯åº¦ä¸‹é™æ›´æ–°å‚æ•°ã€‚ä½†æ˜¯ SGD ç”¨**ä¸€ä¸ªéšæœºé€‰æ‹©çš„æ•°æ®**æ¥æ›´æ–°å‚æ•°ï¼Œè¿™æ ·æ›´å®¹æ˜“**èµ°å‡ºå±€éƒ¨æœ€å°å€¼**ã€‚

![](img/3e19217eca4d30b6c488d90a6c4d2dcf.png)

ç²¾ç¡®çº¿ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ”¶æ•›æ¯”æ¢¯åº¦ä¸‹é™å¿«ã€‚

# 3 å°æ‰¹é‡æ¢¯åº¦ä¸‹é™

SGD æ˜¯å¥½çš„ï¼Œä½†æ˜¯ç”±äºæ¯æ¬¡ç”¨ä¸€ä¸ªæ•°æ®æ›´æ–°å‚æ•°ï¼Œè®¡ç®—æ•ˆç‡ä¸é«˜ã€‚

**ä½¿ç”¨æ•´ä½“æ•°æ®ä¼šé€ æˆå±€éƒ¨æå°é—®é¢˜(æ¢¯åº¦ä¸‹é™)ï¼Œæ¯æ¬¡ä½¿ç”¨ä¸€ä¸ªæ•°æ®æ•ˆç‡ä½ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬ä½¿ç”¨å°æ‰¹é‡æ¢¯åº¦ä¸‹é™ã€‚**

![](img/86d042522dc102ba89dff5cd2ed17cdf.png)

ä¸ SGD ä¸åŒï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å‡ ä¸ªæ•°æ®æ ·æœ¬æ›´æ–°å‚æ•°ã€‚è¿™é‡Œçš„`K`æ˜¯åŒ…å«`m`ä¸ªéšæœºé€‰æ‹©çš„æ•°æ®æ ·æœ¬çš„ç´¢å¼•é›†ã€‚

æˆ‘ä»¬æœ‰ 20 ä¸ªæ•°æ®æ ·æœ¬ï¼Œæˆ‘ä»¬å°†æ‰¹é‡å¤§å°`m`è®¾ä¸º 5ã€‚

```
**import math**# initialize parameter
theta = np.random.randn(4)**# batch size
batch = 5****# calculate steps based on batch size
steps = int(math.ceil(len(train_x)/batch))**# update parameter
for _ in range(epoch):
    **p = np.random.permutation(len(mat_x)) 
    shuffle_x = mat_x[p]
    shuffle_y = train_y[p]****for step in range(steps):
        x = shuffle_x[step:step + batch, :]
        y = shuffle_y[step:step + batch]
        theta = theta - ETA * np.dot(f(x) - y, x)**
```

è¯·æ³¨æ„ï¼Œæˆ‘ä»¬å¿…é¡»åœ¨æ¯ä¸ªæ—¶æœŸæ··æ´—æ•°æ®ã€‚è¯¥è®¡ç®—ä¸é€šè¿‡çŸ©é˜µä¹˜æ³•çš„æ¢¯åº¦ä¸‹é™ç›¸åŒã€‚å¦‚æœä½ æ„Ÿå…´è¶£ï¼Œä½ å¯ä»¥åœ¨ç¬¬ä¸€éƒ¨åˆ†æˆ–ç¬¬äºŒéƒ¨åˆ†æ‰¾åˆ°è¯¦ç»†çš„è§£é‡Šã€‚

ç²¾ç¡®åº¦çº¿

![](img/544f5d71af1b45b4ce2927fc4e929994.png)

æ”¶æ•›é€Ÿåº¦ä¸æ¢¯åº¦ä¸‹é™ç›¸åŒã€‚ä½†æ˜¯è®¡ç®—æ•ˆç‡æ›´é«˜ã€‚

# 4 æ‘˜è¦

åœ¨ç¬¬ 3 éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºäº†å¦‚ä½•å®ç° SGD å’Œå°æ‰¹é‡æ¢¯åº¦ä¸‹é™ã€‚ä½ å¯ä»¥åœ¨ä¸‹é¢æ‰¾åˆ°å®Œæ•´çš„ä»£ç ã€‚ç•™ä¸‹è¯„è®ºè®©æˆ‘çŸ¥é“æˆ‘çš„æ–‡ç« æ˜¯å¦æ˜“æ‡‚ã€‚è¯·ç»§ç»­å…³æ³¨è¿™ä¸ªå…³äºæ­£åˆ™åŒ–çš„â€œå…¬å¼åˆ°ä»£ç â€ç³»åˆ—çš„æœ€åä¸€ç¯‡æ–‡ç« ã€‚

> ***æŸ¥çœ‹æˆ‘çš„å…¶ä»–å¸–å­*** [***ä¸­ç­‰***](https://medium.com/@bramblexu) ***åŒ*** [***ä¸€ä¸ªåˆ†ç±»æŸ¥çœ‹***](https://bramblexu.com/posts/eb7bd472/) ***ï¼
> GitHub:***[***bramble Xu***](https://github.com/BrambleXu) ***LinkedIn:***[***å¾äº®***](https://www.linkedin.com/in/xu-liang-99356891/) ***åšå®¢:***[***bramble Xu***](https://bramblexu.com)