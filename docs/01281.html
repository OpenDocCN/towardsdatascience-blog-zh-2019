<html>
<head>
<title>Data Engineering with Python, Django, and PostgreSQL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Python、Django 和 PostgreSQL 的数据工程</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/data-engineering-with-python-django-and-postgresql-99409492769?source=collection_archive---------4-----------------------#2019-02-28">https://towardsdatascience.com/data-engineering-with-python-django-and-postgresql-99409492769?source=collection_archive---------4-----------------------#2019-02-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/edd2fab98099dc7d578e5486744641e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rCV5wEACUP8NUmKAXF8oiQ.jpeg"/></div></div></figure><p id="f728" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">今天的帖子将讨论数据科学中最困难的方面之一，它不涉及分析，而只是试图让数据科学的后端工作。我所说的后端指的是大多数数据科学家在工作中会用到的数据库系统。</p><p id="6d2d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我将回顾以下内容:</p><ul class=""><li id="f7a6" class="kz la it kd b ke kf ki kj km lb kq lc ku ld ky le lf lg lh bi translated">用关系数据库管理系统(RDBMS)构建一个绝对的准系统 Django 应用程序</li><li id="b493" class="kz la it kd b ke lj ki lk km ll kq lm ku ln ky le lf lg lh bi translated">演示附加到 Django 应用程序的 PostgresSQL 数据库的使用</li><li id="d054" class="kz la it kd b ke lj ki lk km ll kq lm ku ln ky le lf lg lh bi translated">如何在不同格式和平台之间移入和移出数据</li></ul><p id="2c86" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">虽然阅读本文不需要任何 Django 知识，但我认为重要的是要认识到大量数据收集是通过 web 应用程序进行的。</p><p id="373c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">对于不熟悉 Django 的数据科学家来说，可以把它看作是一个构建 web 应用程序的框架，同时坚持“控制反转”的哲学。这意味着 Django 负责 web 应用程序的框架，而您负责在框架上充实实际内容。</p><p id="1fb2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">对于不喜欢 Django 的读者，你可以跳到这篇文章末尾的标题为<em class="lo">“回报:Django 的对象关系映射器”</em>的部分。</p><h2 id="f59b" class="lp lq it bd lr ls lt dn lu lv lw dp lx km ly lz ma kq mb mc md ku me mf mg mh bi translated">我们的 Django 应用程序:“DoubleBagger”</h2><p id="7590" class="pw-post-body-paragraph kb kc it kd b ke mi kg kh ki mj kk kl km mk ko kp kq ml ks kt ku mm kw kx ky im bi translated">我感兴趣的应用程序将被称为“DoubleBagger”，这是一个投资博客，人们可以在这里自助发表对苹果(股票代码:AAPL)或微软(股票代码:MSFT)等上市公司的买入/卖出意见。</p><p id="6df7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这次我们将主要使用命令行+一个像 Sublime Text 这样的文本编辑器，而不是像我以前的文章那样使用 Jupyter 笔记本。</p><p id="f749" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">因为这是针对数据科学家的，我们将使用<a class="ae li" href="https://conda.io/projects/conda/en/latest/user-guide/install/macos.html" rel="noopener ugc nofollow" target="_blank"> conda </a>环境:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="891f" class="lp lq it ms b gy mw mx l my mz"># I like to do things on my desktop<br/># From the terminal:</span><span id="0943" class="lp lq it ms b gy na mx l my mz">$ cd desktop &amp;&amp; mkdir doublebagger &amp;&amp; cd doublebagger</span><span id="5dd1" class="lp lq it ms b gy na mx l my mz">$ conda create -n doublebagger<br/>$ conda activate doublebagger</span><span id="29c4" class="lp lq it ms b gy na mx l my mz"># You should now have the (doublebagger) conda environment activated</span></pre><p id="331c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在我们安装两个主要的包:Django 和 psycopg2，用于连接 PostgreSQL 数据库。Django 已经发布了 SQLite，它实际上可能适合许多组织和爱好者，但是我们将使用 Postgres 来代替。此外，我们将使用 Django 的旧版本(当前版本是 Django 2.1)。</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="aaad" class="lp lq it ms b gy mw mx l my mz">$ (doublebagger) conda install Django==1.9.6 psycopg2</span></pre><p id="8a89" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在验证您拥有这些包及其依赖项之后，创建一个源目录，我们将所有与“Doublebagger”相关的源代码放在这个目录中。</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="68fd" class="lp lq it ms b gy mw mx l my mz">$ (doublebagger) mkdir src &amp;&amp; cd src</span></pre><p id="890c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们用相同的命令以几乎相同的方式启动每个 Django 项目:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="045f" class="lp lq it ms b gy mw mx l my mz"># Inside of src:<br/># don't forget the space and period at the end</span><span id="746b" class="lp lq it ms b gy na mx l my mz">$ (doublebagger) django-admin startproject doublebagger_blog . </span></pre><p id="7aa0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">django-admin startproject 命令为我们的项目创建了框架，现在如果您查看 src 文件夹中的内容，您应该会看到:</p><ol class=""><li id="d1f2" class="kz la it kd b ke kf ki kj km lb kq lc ku ld ky nb lf lg lh bi translated">doublebagger_blog:包含我们项目的项目配置，包括 settings.py 文件。</li><li id="d66d" class="kz la it kd b ke lj ki lk km ll kq lm ku ln ky nb lf lg lh bi translated">manage.py:实用函数</li></ol><p id="e5cf" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在我们可以在 Sublime Text 或您选择的任何其他编辑器中打开我们的 DoubleBagger 项目。您应该会看到完全相同的目录结构:</p><figure class="mn mo mp mq gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nc"><img src="../Images/18c2c4e9847093e49811b93a2c25c94a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9qpWDtNEYYTCYmzQj15lRw.jpeg"/></div></div></figure><p id="2c46" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">假设您的机器上已经安装了 postgres 数据库，我们实际上需要为 django 应用程序创建一个 postgres 数据库:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="a2da" class="lp lq it ms b gy mw mx l my mz"># from the command line:</span><span id="1c0c" class="lp lq it ms b gy na mx l my mz">$ psql -d postgres</span><span id="d094" class="lp lq it ms b gy na mx l my mz">postgres=# CREATE DATABASE doublebagger;</span><span id="15f1" class="lp lq it ms b gy na mx l my mz"># That's it!<br/># quit by:</span><span id="d1f6" class="lp lq it ms b gy na mx l my mz">postgres=# \q</span></pre><p id="be99" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">*如果您没有 postgreSQL，您可以遵循这些<a class="ae li" href="https://medium.com/@viviennediegoencarnacion/getting-started-with-postgresql-on-mac-e6a5f48ee399" rel="noopener">指令</a>。</p><p id="41fd" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后在 settings.py(使用 Sublime Text)中，我们更改默认配置以考虑我们刚刚创建的数据库。改变这一点:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="5fa0" class="lp lq it ms b gy mw mx l my mz"># settings.py</span><span id="1bc7" class="lp lq it ms b gy na mx l my mz">DATABASES = {<br/>    'default': {<br/>        'ENGINE': 'django.db.backends.sqlite3',<br/>        'NAME': os.path.join(BASE_DIR, 'db.sqlite3'),<br/>    }<br/>}</span></pre><p id="7dc4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">对此:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="6413" class="lp lq it ms b gy mw mx l my mz"># Your 'User' is probably different depending on how you set up <br/># postgres.  In many cases, it's just 'postgres'.<br/># Also depends if you set up a password with you postgres.</span><span id="92f9" class="lp lq it ms b gy na mx l my mz">DATABASES = {<br/>    'default': {<br/>        'ENGINE': 'django.db.backends.postgresql_psycopg2',<br/>        'NAME': 'doublebagger',<br/>        'USER': 'WhoeverOwnsTheDatabase',<br/>        'PASSWORD': '',<br/>        'HOST': '127.0.0.1',<br/>        'PORT': '5432',<br/>    }<br/>}</span></pre><p id="3234" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">*确保在文本编辑器中保存您的更改</p><p id="0aa3" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在，如果你回到命令行，我们可以像这样连接应用程序和 postgres 数据库:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="21bd" class="lp lq it ms b gy mw mx l my mz"># Still inside of your src where manage.py lives:</span><span id="5c6e" class="lp lq it ms b gy na mx l my mz">$ (doublebagger) python manage.py migrate</span></pre><p id="48c3" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果一切顺利，您应该会看到类似这样的内容:</p><figure class="mn mo mp mq gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nd"><img src="../Images/ed4ce8fbdfe9dafd6a1868f17e7d2601.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UoZbUgvdCWn28tW-o0o4rQ.jpeg"/></div></div></figure><p id="3c7d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在从同一个命令行:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="48e3" class="lp lq it ms b gy mw mx l my mz">$ (doublebagger) python manage.py runserver</span></pre><p id="5316" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">并将您的浏览器指向:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="de66" class="lp lq it ms b gy mw mx l my mz">127.0.0.1:8000</span></pre><p id="bee0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">您应该会看到类似这样的内容:</p><figure class="mn mo mp mq gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ne"><img src="../Images/6b9f227f5258b0583f9f70fb9d4eb6f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K7trZIdORSV77GRXnLkx-g.jpeg"/></div></div><figcaption class="nf ng gj gh gi nh ni bd b be z dk">image sponsored by fakedoors.com</figcaption></figure><p id="a025" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这实际上是从 Django 的本地开发服务器上显示的假想 web 应用程序的主页，旨在模拟真实的 web 服务器。你可以用<control-c>退出开发服务器。</control-c></p><p id="5178" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这几乎是这个应用程序的全部了——甚至没有基本框架，甚至没有 hello world。</p><h2 id="cdb5" class="lp lq it bd lr ls lt dn lu lv lw dp lx km ly lz ma kq mb mc md ku me mf mg mh bi translated">那么，我们为什么要费这么大的劲来做这件事呢？</h2><p id="ace7" class="pw-post-body-paragraph kb kc it kd b ke mi kg kh ki mj kk kl km mk ko kp kq ml ks kt ku mm kw kx ky im bi translated">因为 Django Models 为其用户提供了一个对象关系映射器(ORM ),允许我们在连接到 postgresSQL 数据库时使用 python 操作模型对象。这只是构成 pythonic 数据科学生态系统的绝对动物园的一个更复杂的层次和意识。</p><p id="3c4d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">此时，我们需要考虑数据的组织。</p><p id="a3f3" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们的 web 应用程序将主要有两个主要组件或模型类:</p><ul class=""><li id="d47a" class="kz la it kd b ke kf ki kj km lb kq lc ku ld ky le lf lg lh bi translated">帖子:关于是否投资特定公司的博客帖子</li><li id="2e30" class="kz la it kd b ke lj ki lk km ll kq lm ku ln ky le lf lg lh bi translated">公司:博客文章中提到的公司的信息</li></ul><p id="40b5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">帖子将包含以下信息:</p><ul class=""><li id="346c" class="kz la it kd b ke kf ki kj km lb kq lc ku ld ky le lf lg lh bi translated">帖子的标题</li><li id="7741" class="kz la it kd b ke lj ki lk km ll kq lm ku ln ky le lf lg lh bi translated">slug:基于标题的博客文章的唯一标识符)</li><li id="07a7" class="kz la it kd b ke lj ki lk km ll kq lm ku ln ky le lf lg lh bi translated">文本:实际的博客文章文本</li><li id="9cca" class="kz la it kd b ke lj ki lk km ll kq lm ku ln ky le lf lg lh bi translated">发布日期:文章发布的时间</li></ul><p id="1160" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">公司将包含以下信息:</p><ul class=""><li id="46e8" class="kz la it kd b ke kf ki kj km lb kq lc ku ld ky le lf lg lh bi translated">公司名称</li><li id="4201" class="kz la it kd b ke lj ki lk km ll kq lm ku ln ky le lf lg lh bi translated">slug:公司的唯一标识符</li><li id="2faa" class="kz la it kd b ke lj ki lk km ll kq lm ku ln ky le lf lg lh bi translated">描述:该公司做什么</li><li id="ad7e" class="kz la it kd b ke lj ki lk km ll kq lm ku ln ky le lf lg lh bi translated">市盈率:公司相对于市场价格的估值指标</li></ul><p id="2d7c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在我们将其转化为 Django 模型代码之前，我们需要先创建一个 Django 应用程序。</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="430c" class="lp lq it ms b gy mw mx l my mz"># We're going to call our app 'post'<br/># Inside of src from terminal:</span><span id="f37b" class="lp lq it ms b gy na mx l my mz">$ (doublebagger) python manage.py startapp post</span></pre><p id="d225" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在，您应该可以在文本编辑器中看到 post 应用程序:</p><figure class="mn mo mp mq gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nj"><img src="../Images/df2579cd33193f6e10f0089ed7516292.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*11Ey-nJrGCx_1ObiLYqo6w.jpeg"/></div></div></figure><p id="7008" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">之后，我们必须在 settings.py 中的 INSTALLED_APPS 下添加我们的“post”应用程序:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="0aae" class="lp lq it ms b gy mw mx l my mz"># settings.py</span><span id="0177" class="lp lq it ms b gy na mx l my mz">INSTALLED_APPS = [<br/>    'django.contrib.admin',<br/>    'django.contrib.auth',<br/>    'django.contrib.contenttypes',<br/>    'django.contrib.sessions',<br/>    'django.contrib.messages',<br/>    'django.contrib.staticfiles',<br/>    'post', <br/>]</span><span id="bbda" class="lp lq it ms b gy na mx l my mz"># Don't forget to save changes</span></pre><p id="6919" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在，我们可以通过 post/models.py 为我们的数据编写组织代码:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="c8e1" class="lp lq it ms b gy mw mx l my mz"># post/models.py</span><span id="7512" class="lp lq it ms b gy na mx l my mz">from __future__ import unicode_literals</span><span id="e6ef" class="lp lq it ms b gy na mx l my mz">from django.db import models</span><span id="32de" class="lp lq it ms b gy na mx l my mz"># Create your models here.<br/>class Post(models.Model):<br/> title = models.CharField(max_length=100)<br/> slug  = models.SlugField()<br/> text  = modelsle.TextField()<br/> pub_date = models.DateField()</span><span id="0f3a" class="lp lq it ms b gy na mx l my mz">class Company(models.Model):<br/> name = models.CharField(max_length=100)<br/> slug = models.SlugField()<br/> description = models.TextField()<br/> pe_ratio = models.DecimalField(max_digits=7, decimal_places=2)</span></pre><figure class="mn mo mp mq gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nk"><img src="../Images/c18746eedca5d71074e4180d37f015a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ILgOPsvxnGCPEX9gZfkfdw.jpeg"/></div></div></figure><p id="b07e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在这一点上，我们需要考虑的模型的最重要的方面之一是这两件事是如何相互关联的。如果我们看看上面所做的，从 SQL 的角度来看，Post 是一个表，Company 是它自己的表，下面的字段如 title、slug 和 pub_date 代表两个表的列。</p><p id="96ea" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">对于 SQL，我们需要考虑我们的两个模型之间的关系是否是:</p><ul class=""><li id="863c" class="kz la it kd b ke kf ki kj km lb kq lc ku ld ky le lf lg lh bi translated">一对多或多对一</li><li id="0248" class="kz la it kd b ke lj ki lk km ll kq lm ku ln ky le lf lg lh bi translated">多对多</li></ul><p id="aed0" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果你考虑一下，我们这里有一个岗位和公司之间的<strong class="kd iu">多对一</strong>关系:</p><p id="bdeb" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">“一篇博文只能是一篇关于一家公司的投资论文，但一家公司可以有很多篇关于它的博文。”</p><p id="ae0d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">因此，我们的 Post 模型将有一个<a class="ae li" href="https://docs.djangoproject.com/en/1.9/ref/models/fields/#django.db.models.ForeignKey" rel="noopener ugc nofollow" target="_blank">外键</a>指向 Company。</p><p id="a543" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">Django 的美妙之处在于，它为我们处理了通常从零开始创建数据库模式的所有困难工作——不需要显式创建主键，不需要索引或多对多关系的连接表。</p><p id="d179" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们可以像这样添加外键:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="b86b" class="lp lq it ms b gy mw mx l my mz"># post/models.py</span><span id="24d3" class="lp lq it ms b gy na mx l my mz">class Post(models.Model):<br/> title = models.CharField(max_length=100)<br/> slug  = models.SlugField()<br/> text  = modelsle.TextField()<br/> pub_date = models.DateField()<br/> company = models.ForeignKey('Company') # Here</span></pre><p id="31e5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">添加一些额外的参数和字符串方法，允许我们的模型对象被字符串名称引用，这是我们最终更新的 post/models.py:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="57e5" class="lp lq it ms b gy mw mx l my mz"># post/models.py</span><span id="5a95" class="lp lq it ms b gy na mx l my mz">from __future__ import unicode_literals</span><span id="3f4e" class="lp lq it ms b gy na mx l my mz">from django.db import models</span><span id="8231" class="lp lq it ms b gy na mx l my mz"># Create your models here.<br/>class Post(models.Model):<br/> title = models.CharField(max_length=100)<br/> slug  = models.SlugField(max_length=50, unique_for_month='pub_date')<br/> text  = models.TextField()<br/> pub_date = models.DateField('date_published', auto_now_add=True)<br/> company = models.ForeignKey('Company')</span><span id="d781" class="lp lq it ms b gy na mx l my mz">def __str__(self):<br/>  return "{} on {}".format(<br/>   self.title,<br/>   self.pub_date.strftime('%Y-%m-%m'))</span><span id="7a13" class="lp lq it ms b gy na mx l my mz">class Meta:<br/>  verbose_name = 'investment thesis'<br/>  ordering = ['-pub_date', 'title']<br/>  get_latest_by = 'pub_date'</span><span id="7e01" class="lp lq it ms b gy na mx l my mz">class Company(models.Model):<br/> name = models.CharField(max_length=100, db_index=True)<br/> slug = models.SlugField(max_length=50, unique=True)<br/> description = models.TextField()<br/> pe_ratio = models.DecimalField(max_digits=7, decimal_places=2)</span><span id="c704" class="lp lq it ms b gy na mx l my mz">def __str__(self):<br/>  return self.name</span><span id="a68b" class="lp lq it ms b gy na mx l my mz">class Meta:<br/>  ordering = ['name']</span><span id="9a5c" class="lp lq it ms b gy na mx l my mz"># Don't forget to save your changes</span></pre><p id="3d87" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在神奇的部分来了，Django 为我们创建了一个 postgreSQL 数据库。</p><p id="ea3c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">回到命令行:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="4808" class="lp lq it ms b gy mw mx l my mz">$ (doublebagger) python manage.py makemigrations</span><span id="1a1d" class="lp lq it ms b gy na mx l my mz"># Then </span><span id="aa5c" class="lp lq it ms b gy na mx l my mz">$ (doublebagger) python manage.py migrate</span><span id="e030" class="lp lq it ms b gy na mx l my mz"># That's it!</span></pre><p id="9cfa" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">您应该会看到类似这样的内容:</p><figure class="mn mo mp mq gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nl"><img src="../Images/346df5ff07e821d499471f561d1bf434.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AOLshu3c0bhVz8114odOqA.jpeg"/></div></div></figure><h2 id="d233" class="lp lq it bd lr ls lt dn lu lv lw dp lx km ly lz ma kq mb mc md ku me mf mg mh bi translated">回报是:Django 的对象关系映射器(ORM)</h2><p id="9018" class="pw-post-body-paragraph kb kc it kd b ke mi kg kh ki mj kk kl km mk ko kp kq ml ks kt ku mm kw kx ky im bi translated">现在，我们可以像数据科学家一样，只使用 Python 与 PostgreSQL 数据库进行交互！</p><p id="fe39" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">从命令行:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="a22f" class="lp lq it ms b gy mw mx l my mz">$ (doublebagger) python manage.py shell</span></pre><p id="32cf" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">您应该看到一些让您想起 Python 解释器的东西，除了这个允许您使用 Django 的数据库:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="26a3" class="lp lq it ms b gy mw mx l my mz">&gt;&gt;&gt; from datetime import date<br/>&gt;&gt;&gt; from post.models import Post, Company</span></pre><p id="9aea" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">让我们创建一个公司对象:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="4518" class="lp lq it ms b gy mw mx l my mz">&gt;&gt;&gt; Company.objects.create(name='Apple', slug='Apple-incorporated-nasdaq', description='One of the greatest companies in the world created by the amazing Steve Jobs.', pe_ratio=14.43)</span></pre><p id="7f08" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">您应该会看到这样的内容:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="fb4c" class="lp lq it ms b gy mw mx l my mz">&lt;Company: Apple&gt;</span></pre><p id="a86f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">不需要:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="2608" class="lp lq it ms b gy mw mx l my mz">INSERT INTO company<br/>(name, slug, description, pe_ratio)<br/>VALUES<br/>('Apple', 'Apple-incorporated-nasdaq', description='...', pe_ration=14.43);</span></pre><p id="42e4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">更多公司:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="36fb" class="lp lq it ms b gy mw mx l my mz">&gt;&gt;&gt; Company.objects.create(name='Amazon', slug='amzn-nasdaq', description='AWS baby!', pe_ratio=81.48)</span><span id="a798" class="lp lq it ms b gy na mx l my mz">&gt;&gt;&gt; Company.objects.create(name='Microsoft', slug='msft-nasdaq', description='I love GitHub!', pe_ratio=26.02)</span><span id="00bd" class="lp lq it ms b gy na mx l my mz">&gt;&gt;&gt; Company.objects.create(name='MongoDB', slug='mdb-nasdaq', description='JSON in the cloud', pe_ratio=100)</span><span id="a6dd" class="lp lq it ms b gy na mx l my mz">&gt;&gt;&gt; Company.objects.all()</span><span id="502b" class="lp lq it ms b gy na mx l my mz"># Output:</span><span id="291a" class="lp lq it ms b gy na mx l my mz">[&lt;Company: Amazon&gt;, &lt;Company: Apple&gt;, &lt;Company: Microsoft&gt;, &lt;Company: MongoDB&gt;]</span></pre><p id="056a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们还可以做一些很酷的查询:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="edb7" class="lp lq it ms b gy mw mx l my mz">&gt;&gt;&gt; Company.objects.get(slug__contains='mdb')</span><span id="a6c9" class="lp lq it ms b gy na mx l my mz"># Output:</span><span id="919a" class="lp lq it ms b gy na mx l my mz">&lt;Company: MongoDB&gt;</span></pre><p id="62f4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">谁喜欢元组:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="fe30" class="lp lq it ms b gy mw mx l my mz">&gt;&gt;&gt; Company.objects.values_list()</span><span id="5f5c" class="lp lq it ms b gy na mx l my mz"># Output:</span><span id="00d8" class="lp lq it ms b gy na mx l my mz">[(3, u'Amazon', u'amzn-nasdaq', u'AWS baby!', Decimal('81.48')), (1, u'Apple', u'Apple-incorporated-nasdaq', u'One of the greatest companies in the world created by the amazing Steve Jobs, not so currently under Tim Cook.', Decimal('14.43')), (2, u'Microsoft', u'msft-nasdaq', u'I love GitHub!', Decimal('26.02')), (4, u'MongoDB', u'mdb-nasdaq', u'JSON in the cloud', Decimal('100.00'))]</span></pre><p id="f39f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们还可以创建一个 Post 对象:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="1081" class="lp lq it ms b gy mw mx l my mz">&gt;&gt;&gt; Post.objects.create(title='I heart Apple', slug='i-heart-apple', text='I heart Apple', company_id=1)</span><span id="78d3" class="lp lq it ms b gy na mx l my mz">&gt;&gt;&gt; Post.objects.create(title='Buy more Microsoft', slug='buy-more-microsoft', text="Nadella leads the way", company_id=2)</span><span id="7258" class="lp lq it ms b gy na mx l my mz">&gt;&gt;&gt; Post.objects.create(title='Buy more Amazon', slug='buy-more-amazon', text="Jeff Bezos acquires Mars from Elon Musk", company_id=3)</span><span id="f932" class="lp lq it ms b gy na mx l my mz">&gt;&gt;&gt; Post.objects.create(title='Time to sell MongoDB', slug='time-to-sell-mongdb', text="MongoDB seems a little overvalued", company_id=4)</span></pre><p id="e27d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们还可以验证这些对象确实存在于 postgreSQL 数据库中:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="36cf" class="lp lq it ms b gy mw mx l my mz">$ psql -d postgres<br/>postgres=# \c doublebagger<br/>doublebagger=# \dt<br/>doublebagger=# SELECT * FROM post_company;</span></pre><p id="5e26" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">您应该会看到类似这样的内容:</p><figure class="mn mo mp mq gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nm"><img src="../Images/f8111b2e7222dac449a06876e44faa60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HbPf1JblAE-iLxRjFUIusA.jpeg"/></div></div></figure><p id="8732" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">和一个 SQL 连接:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="05d4" class="lp lq it ms b gy mw mx l my mz">doublebagger=# SELECT * FROM post_company<br/>doublebagger=# JOIN post_post ON<br/>doublebagger=# post_company.id = post_post.company_id;</span></pre><figure class="mn mo mp mq gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nn"><img src="../Images/21a475f9ba311549f67851680fcc2dc9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tIPFN5FEVRVJB-zUAmDmYw.jpeg"/></div></div></figure><h2 id="c3b0" class="lp lq it bd lr ls lt dn lu lv lw dp lx km ly lz ma kq mb mc md ku me mf mg mh bi translated">从 postgreSQL 到熊猫</h2><p id="d574" class="pw-post-body-paragraph kb kc it kd b ke mi kg kh ki mj kk kl km mk ko kp kq ml ks kt ku mm kw kx ky im bi translated">使用<a class="ae li" href="https://www.sqlalchemy.org/" rel="noopener ugc nofollow" target="_blank"> sqlalchemy </a>我们可以直接从 pandas 访问 postgreSQL 对象:</p><p id="9941" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果你启动一台 Jupyter 笔记本:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="b5b9" class="lp lq it ms b gy mw mx l my mz">import pandas as pd<br/>from sqlalchemy import create_engine</span><span id="2718" class="lp lq it ms b gy na mx l my mz">engine = create_engine('postgresql://sammylee@localhost:5432/doublebagger')</span><span id="d894" class="lp lq it ms b gy na mx l my mz">posts = pd.read_sql('select * from post_post', engine)</span><span id="1c4f" class="lp lq it ms b gy na mx l my mz">companies = pd.read_sql('select * from post_company', engine)</span><span id="f1e8" class="lp lq it ms b gy na mx l my mz">posts_companies = pd.merge(companies, posts, left_on='id', right_on='company_id')</span><span id="eeba" class="lp lq it ms b gy na mx l my mz">posts_companies</span></pre><figure class="mn mo mp mq gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi no"><img src="../Images/be3154510e0c12e4f004b7c3942a5f4c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7PIUE1mvZ3xwhHRVkLFoug.jpeg"/></div></div></figure><p id="80b6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在，作为数据科学家，我们可以充分利用熊猫的力量和魔力做我们想做的任何事情。</p><p id="95b6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">虽然 web 开发框架的知识对于数据科学家来说不是必需的，但我认为退一步看看亚马逊森林是非常酷的，从 Django 到 postgreSQL 再到 pandas 都是数据科学。</p><h2 id="b3bd" class="lp lq it bd lr ls lt dn lu lv lw dp lx km ly lz ma kq mb mc md ku me mf mg mh bi translated">还有一点</h2><p id="db39" class="pw-post-body-paragraph kb kc it kd b ke mi kg kh ki mj kk kl km mk ko kp kq ml ks kt ku mm kw kx ky im bi translated">Django 有一个“包含电池”的理念，它提供了一个管理界面，基本上作为 postgreSQL 数据库的 GUI。我们所要做的就是在 post/admin.py 中添加一些行</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="fcc6" class="lp lq it ms b gy mw mx l my mz"># post/admin.py</span><span id="5766" class="lp lq it ms b gy na mx l my mz">from django.contrib import admin<br/>from django.db import models</span><span id="a49e" class="lp lq it ms b gy na mx l my mz"># Register your models here.<br/>from .models import Post, Company</span><span id="82cc" class="lp lq it ms b gy na mx l my mz">class MyCompanyAdmin(admin.ModelAdmin):<br/> model = Company<br/> list_display = ('name', 'slug', 'description', 'pe_ratio',)</span><span id="24ae" class="lp lq it ms b gy na mx l my mz">admin.site.register(Company, MyCompanyAdmin)</span></pre><p id="a8a5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">并在命令行上创建超级用户:</p><pre class="mn mo mp mq gt mr ms mt mu aw mv bi"><span id="b6e9" class="lp lq it ms b gy mw mx l my mz">$ (doublebagger) python manage.py createsuperuser</span><span id="d190" class="lp lq it ms b gy na mx l my mz"># Then create your credentials<br/># start up your local development server and head to your local host<br/># and append "/admin" to it</span></pre><figure class="mn mo mp mq gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi np"><img src="../Images/1dcee14da4e996a281991ac14ba8ad90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2ZPsOimniyVj_qeGblIleg.jpeg"/></div></div></figure><p id="afd4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">双重行囊者生活的代号<a class="ae li" href="https://github.com/Captmoonshot/doublebagger" rel="noopener ugc nofollow" target="_blank">在这里</a>。</p></div></div>    
</body>
</html>