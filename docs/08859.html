<html>
<head>
<title>BERT: Sentiment Analysis of App Store Review</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">伯特:应用商店评论的情感分析</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/bert-sentiment-analysis-of-app-store-review-db68f7721d94?source=collection_archive---------16-----------------------#2019-11-26">https://towardsdatascience.com/bert-sentiment-analysis-of-app-store-review-db68f7721d94?source=collection_archive---------16-----------------------#2019-11-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="e5e6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">利用最先进的模型分析应用商店的用户情绪</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/d0ddb0ad6ecaf79aa1b5e87bfa4c2b0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ANBfrHjoa7TWt8EWvHzXXg.jpeg"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk">Photo by <a class="ae le" href="https://unsplash.com/@williamtm?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">William Hook</a> on <a class="ae le" href="https://unsplash.com/s/photos/app-review?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="9a6a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">本文为您提供了对 app store 公众用户的评论进行情感分析的必要步骤。在本教程中，我将使用基于中文的模型来测试 Bert 应用于英语以外的语言时的性能。无论您使用哪种模型，情感分析的步骤都是一样的。如果您不确定使用哪种模型，请查看下面的<a class="ae le" href="https://github.com/google-research/bert#pre-trained-models" rel="noopener ugc nofollow" target="_blank">链接</a>，了解有关 BERT 团队提供的预训练模型的更多信息。如果你是 BERT 的新手，请查看我之前关于使用 BERT 的<a class="ae le" rel="noopener" target="_blank" href="/beginners-guide-to-bert-for-multi-classification-task-92f5445c2d7c">多分类任务的教程。本教程有 5 个部分:</a></p><ol class=""><li id="6e46" class="lf lg it js b jt ju jx jy kb lh kf li kj lj kn lk ll lm ln bi translated">数据集准备</li><li id="eb99" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated">培养</li><li id="cc60" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated">预言；预测；预告</li><li id="dad6" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated">结果</li><li id="5e25" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated">结论</li></ol></div><div class="ab cl lt lu hx lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="im in io ip iq"><h1 id="a624" class="ma mb it bd mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx bi translated">1.数据集准备</h1><p id="2171" class="pw-post-body-paragraph jq jr it js b jt my jv jw jx mz jz ka kb na kd ke kf nb kh ki kj nc kl km kn im bi translated">我将使用来自 Taptap 的评论，这是一个迎合中国市场的游戏应用商店。请随意使用您自己的数据集。你甚至可以在谷歌 Play 商店和苹果商店的评论上测试一下。如果是这种情况，请确保您对 BERT 使用的是英语模型。让我们来看看我们可以从 Taptap 的评论中获得的细节。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/98cd48cd79101d0ac7b956fc3bcf5a0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1326/format:webp/1*rulRSy0BJbozkej4XI7shA.png"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk">Image by Author. Taken from a review in Taptap.</figcaption></figure><p id="ee0e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这里有相当多有用的数据:</p><ul class=""><li id="0c1b" class="lf lg it js b jt ju jx jy kb lh kf li kj lj kn ne ll lm ln bi translated">用户发布的评论</li><li id="c16d" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn ne ll lm ln bi translated">评分从 1 到 5</li><li id="dab2" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn ne ll lm ln bi translated">竖起大拇指</li><li id="a470" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn ne ll lm ln bi translated">数数拇指朝下</li><li id="bba9" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn ne ll lm ln bi translated">其他用户对此评论的回复</li></ul><p id="b890" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们可以很容易地使用可用的数据来标记情感。如果你有时间的话，强烈建议你手工贴标签。在这种情况下，我将使用评级来确定标签。</p><ol class=""><li id="98f2" class="lf lg it js b jt ju jx jy kb lh kf li kj lj kn lk ll lm ln bi translated">负:1-3⭐</li><li id="d11e" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated">中立:4 名⭐</li><li id="2bf7" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated">阳性:5 ⭐</li></ol><p id="718f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我设法从几个游戏的用户评论中收集了相当多的数据集。我已经将数据集加载到三个数据帧中。</p><ol class=""><li id="1a6b" class="lf lg it js b jt ju jx jy kb lh kf li kj lj kn lk ll lm ln bi translated">训练数据集</li><li id="3dc3" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated">评估数据集</li><li id="7968" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated">测试数据集</li></ol><p id="aeb0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们看看<strong class="js iu">训练</strong>和<strong class="js iu">评估</strong>的数据内容。两者结构相同。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nf"><img src="../Images/c53d964f7d5a93a8e04e4f13ead2bc4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*phc9zSC0lG6NqRTvUV_5BQ.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk">Image by Author</figcaption></figure><ul class=""><li id="84e9" class="lf lg it js b jt ju jx jy kb lh kf li kj lj kn ne ll lm ln bi translated"><strong class="js iu"> Guid </strong>:注释的 id。</li><li id="716a" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn ne ll lm ln bi translated"><strong class="js iu">标签</strong>:评论的情绪。标签是基于用户的评价。</li><li id="343c" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn ne ll lm ln bi translated"><strong class="js iu"> Alpha </strong>:一次性栏。我刚填了一个。</li><li id="b3cf" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn ne ll lm ln bi translated"><strong class="js iu">文本</strong>:用户的实际评论。</li></ul><p id="68ae" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您在创建上面的数据帧时遇到问题，请随意使用下面的代码(相应地修改):</p><pre class="kp kq kr ks gt ng nh ni nj aw nk bi"><span id="d517" class="nl mb it nh b gy nm nn l no np">df_bert = pd.DataFrame({'guid': id_list,<br/>    'label': label_list,<br/>    'alpha': ['a']*len(count),<br/>    'text': text_list})</span></pre><p id="8320" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">测试数据会略有不同，因为它应该只包含<strong class="js iu"> guid </strong>和<strong class="js iu">文本</strong>。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nq"><img src="../Images/47224cc46f0eaa67c86d9862a36f94cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1376/format:webp/1*IiSexKki0MQ6FKMG6kRHLA.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk">Image by Author</figcaption></figure><p id="fde1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">完成后，让我们使用以下代码将其保存为 tsv 文件(相应地修改数据帧的名称):</p><pre class="kp kq kr ks gt ng nh ni nj aw nk bi"><span id="2f9d" class="nl mb it nh b gy nm nn l no np">df_bert_train.to_csv('data/train.tsv', sep='\t', index=False, header=False)<br/>df_bert_dev.to_csv('data/dev.tsv', sep='\t', index=False, header=False)<br/>df_bert_test.to_csv('data/test.tsv', sep='\t', index=False, header=True)</span></pre><p id="419c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">请注意，文件存储在<strong class="js iu">数据</strong>文件夹中。您可以根据自己的使用情况随意修改，但文件名必须如下所示:</p><ul class=""><li id="3019" class="lf lg it js b jt ju jx jy kb lh kf li kj lj kn ne ll lm ln bi translated">train.tsv</li><li id="0315" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn ne ll lm ln bi translated">开发 tsv</li><li id="efd3" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn ne ll lm ln bi translated">test.tsv</li></ul><p id="144f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">此外，<strong class="js iu"> test.tsv </strong>数据必须有一个不同于<strong class="js iu"> train.tsv </strong>和<strong class="js iu"> dev.tsv </strong>的头。将<strong class="js iu"> test.tsv </strong>的割台设置为<strong class="js iu"> True </strong>。</p><p id="551a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">完成数据准备后，让我们进入下一部分。</p></div><div class="ab cl lt lu hx lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="im in io ip iq"><h1 id="0190" class="ma mb it bd mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx bi translated">2.培养</h1><p id="f9bf" class="pw-post-body-paragraph jq jr it js b jt my jv jw jx mz jz ka kb na kd ke kf nb kh ki kj nc kl km kn im bi translated">我们现在将开始训练和微调模型。确保您已经从官方<a class="ae le" href="https://github.com/google-research/bert" rel="noopener ugc nofollow" target="_blank">站点</a>中克隆了存储库。此外，您应该将以下文件和文件夹放在存储库中的某个位置:</p><ul class=""><li id="0363" class="lf lg it js b jt ju jx jy kb lh kf li kj lj kn ne ll lm ln bi translated"><strong class="js iu">数据目录</strong>:存放 train.tsv、dev.tsv、test.tsv 的目录</li><li id="f376" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn ne ll lm ln bi translated"><strong class="js iu"> Vocab 文件</strong>:Vocab . txt 文件。它与您下载的模型一起提供。我创建了一个新的<strong class="js iu">模型</strong>文件夹，并将文件放入其中。</li><li id="0c16" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn ne ll lm ln bi translated"><strong class="js iu">配置文件</strong>:Config . JSON 文件。它也包含在模型中。同样，我把它放在<strong class="js iu">模型</strong>文件夹中。</li><li id="0695" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn ne ll lm ln bi translated"><strong class="js iu">初始模型</strong>:用于训练的模型。您可以使用基于预先训练的模型，或者从您已经微调的现有模型中恢复。我将它存储在<strong class="js iu">型号</strong>文件夹中</li><li id="be05" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn ne ll lm ln bi translated"><strong class="js iu">输出目录</strong>:模型将要写入的文件夹。您可以简单地为它创建一个空文件夹。</li></ul><p id="6275" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">下一步是确定以下变量:</p><ul class=""><li id="e4d7" class="lf lg it js b jt ju jx jy kb lh kf li kj lj kn ne ll lm ln bi translated"><strong class="js iu">最大序列长度</strong>:分词后最大总输入序列长度。长于此长度的序列将被截断，短于此长度的序列将被填充。默认值是 128，但在本教程中我将使用 256。</li><li id="2349" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn ne ll lm ln bi translated"><strong class="js iu">训练批量</strong>:训练的总批量。默认值为 32。我将在本教程中使用 8，因为我只在一个 GeForce RTX 2080 上训练。</li><li id="79d9" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn ne ll lm ln bi translated"><strong class="js iu">学习率</strong>:Adam 的初始学习率。默认为 5e-5。我已经将值设置为 2e-5。</li><li id="2d62" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn ne ll lm ln bi translated"><strong class="js iu"> Num train epoch </strong>:要执行的训练总次数。我将只使用默认值 3.0</li></ul><p id="9a08" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您不确定使用哪种 GPU，请运行以下命令找出答案:</p><pre class="kp kq kr ks gt ng nh ni nj aw nk bi"><span id="0fbd" class="nl mb it nh b gy nm nn l no np">nvidia-smi</span></pre><p id="da50" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们需要修改 run_classifier.py 中的代码，因为这个用例有 3 个类。打开 python 文件，在<strong class="js iu">cola processor(data processor)</strong>类中搜索<strong class="js iu"> get_labels </strong>()函数。将其更改为以下内容并保存:</p><pre class="kp kq kr ks gt ng nh ni nj aw nk bi"><span id="c9c8" class="nl mb it nh b gy nm nn l no np">def get_labels(self):<br/>    """See base class."""<br/>    return ["0", "1", "2"]</span></pre><p id="a50e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">完成后，激活虚拟环境，并将目录更改为存储库的根目录。在终端中键入以下命令。</p><pre class="kp kq kr ks gt ng nh ni nj aw nk bi"><span id="cba3" class="nl mb it nh b gy nm nn l no np">CUDA_VISIBLE_DEVICES=0 python run_classifier.py --task_name=cola --do_train=true --do_eval=true --data_dir=./data/ --vocab_file=./model/vocab.txt --bert_config_file=./model/bert_config.json --init_checkpoint=./model/bert_model.ckpt --max_seq_length=256 --train_batch_size=8 --learning_rate=2e-5 --num_train_epochs=3.0 --output_dir=./output/ --do_lower_case=False</span></pre><p id="a176" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">运行它，您应该会看到以下输出:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/bc886333e7a179b2e6a25a323eb79fe2.png" data-original-src="https://miro.medium.com/v2/resize:fit:984/format:webp/1*dPHB9LB5nCX875XVv_El0Q.png"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk">Image by Author</figcaption></figure><p id="b644" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">它可能需要相当长的时间来训练，这取决于你使用的数据集的大小。一旦训练完成，终端将输出以下内容。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/ad9ebf247ff7b2b1977a428b4182aad3.png" data-original-src="https://miro.medium.com/v2/resize:fit:896/format:webp/1*yBMEXLoW9pvCjQYkJf7xaw.png"/></div></figure><p id="f6c9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们进入下一步。</p><h1 id="4fc8" class="ma mb it bd mc md nt mf mg mh nu mj mk ml nv mn mo mp nw mr ms mt nx mv mw mx bi translated">3.预言；预测；预告</h1><p id="706e" class="pw-post-body-paragraph jq jr it js b jt my jv jw jx mz jz ka kb na kd ke kf nb kh ki kj nc kl km kn im bi translated">将在<strong class="js iu">输出</strong>文件夹中生成一个模型。请检查最高步骤数，以确定您拥有的最新型号。如果您不确定哪个型号是最新的，请打开<strong class="js iu">检查点</strong>文件找出答案。在我的例子中，我将 37125 作为模型的最后一步。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/2b1b715fefcbb4b1f1976de3d38feed0.png" data-original-src="https://miro.medium.com/v2/resize:fit:888/format:webp/1*vUoWu-ebHeE8CQAjny_htA.png"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk">Image by Author</figcaption></figure><p id="3af1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在同一个终端中，运行以下代码(确保最大序列长度与您在培训中使用的长度相同):</p><pre class="kp kq kr ks gt ng nh ni nj aw nk bi"><span id="2e12" class="nl mb it nh b gy nm nn l no np">CUDA_VISIBLE_DEVICES=0 python run_classifier.py --task_name=cola --do_predict=true --data_dir=./data/ --vocab_file=./model/vocab.txt --bert_config_file=./model/bert_config.json --init_checkpoint=./output/model.ckpt-37125 --max_seq_length=256 --output_dir=./output/</span></pre><p id="d53f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">代码将在输出文件夹中生成一个<strong class="js iu"> test_results.tsv </strong>文件。在我的例子中，我得到了以下结果。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/85c49329ea08c633718956e1db4ed75f.png" data-original-src="https://miro.medium.com/v2/resize:fit:844/format:webp/1*0AN30wqxXFmjPwinkYJYAw.png"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk">Image by Author</figcaption></figure><p id="ba73" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">每列代表预测类别的概率或置信水平，最高的是模型预测的类别。</p></div><div class="ab cl lt lu hx lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="im in io ip iq"><h1 id="d20e" class="ma mb it bd mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx bi translated">4.结果</h1><p id="1f88" class="pw-post-body-paragraph jq jr it js b jt my jv jw jx mz jz ka kb na kd ke kf nb kh ki kj nc kl km kn im bi translated">是我们分析结果的时候了。第一个任务是加载 test_results.tsv，并根据最高预测概率将其转换为 dataframe。使用以下代码读取文件:</p><pre class="kp kq kr ks gt ng nh ni nj aw nk bi"><span id="1a71" class="nl mb it nh b gy nm nn l no np">df_result = pd.read_csv('output/test_results.tsv', sep='\t', header=None)<br/>df_result.head()</span></pre><p id="92f8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您应该有一个包含三列的测试数据的数据框架(我将其命名为 df_test_with_label):</p><ul class=""><li id="5ce5" class="lf lg it js b jt ju jx jy kb lh kf li kj lj kn ne ll lm ln bi translated">全局唯一标识符</li><li id="d701" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn ne ll lm ln bi translated">标签</li><li id="f0e0" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn ne ll lm ln bi translated">文本</li></ul><p id="e042" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">创建一个新的数据帧，并使用<strong class="js iu"> idxmax </strong>映射结果。</p><pre class="kp kq kr ks gt ng nh ni nj aw nk bi"><span id="1875" class="nl mb it nh b gy nm nn l no np">df_predict = pd.DataFrame({'guid':df_test_with_label['guid'],<br/>                            'label':df_result.idxmax(axis=1),<br/>                            'text':df_test_with_label['text'],})<br/>df_predict.head()</span></pre><h2 id="31dd" class="nl mb it bd mc oa ob dn mg oc od dp mk kb oe of mo kf og oh ms kj oi oj mw ok bi translated">导入</h2><p id="ce79" class="pw-post-body-paragraph jq jr it js b jt my jv jw jx mz jz ka kb na kd ke kf nb kh ki kj nc kl km kn im bi translated">完成后，让我们从 sklearn 导入以下度量函数来计算我们的模型的性能。</p><pre class="kp kq kr ks gt ng nh ni nj aw nk bi"><span id="9ee2" class="nl mb it nh b gy nm nn l no np">from sklearn.metrics import accuracy_score, precision_score, recall_score, confusion_matrix</span></pre><h2 id="6afc" class="nl mb it bd mc oa ob dn mg oc od dp mk kb oe of mo kf og oh ms kj oi oj mw ok bi translated">准确(性)</h2><p id="ce45" class="pw-post-body-paragraph jq jr it js b jt my jv jw jx mz jz ka kb na kd ke kf nb kh ki kj nc kl km kn im bi translated">你可以如下计算模型的精确度。</p><pre class="kp kq kr ks gt ng nh ni nj aw nk bi"><span id="6a8b" class="nl mb it nh b gy nm nn l no np">accuracy_score(df_test_with_label['label'], df_predict['label'])</span></pre><p id="b1bd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">结果得到 0.7033952594490711。</p><h2 id="9595" class="nl mb it bd mc oa ob dn mg oc od dp mk kb oe of mo kf og oh ms kj oi oj mw ok bi translated">回忆</h2><p id="4471" class="pw-post-body-paragraph jq jr it js b jt my jv jw jx mz jz ka kb na kd ke kf nb kh ki kj nc kl km kn im bi translated">基于 sklearn <a class="ae le" href="https://scikit-learn.org/stable/modules/generated/sklearn.metrics.precision_score.html#sklearn.metrics.precision_score" rel="noopener ugc nofollow" target="_blank">文档</a>。召回率是比率<code class="fe ol om on nh b">tp / (tp + fn)</code>，其中<code class="fe ol om on nh b">tp</code>是真阳性的数量，<code class="fe ol om on nh b">fn</code>是假阴性的数量。召回直观上是分类器找到所有肯定样本的能力。最佳值为 1，最差值为 0。它还需要一个名为 average 的参数。我正在将它设置为<strong class="js iu">宏</strong>。</p><pre class="kp kq kr ks gt ng nh ni nj aw nk bi"><span id="c40a" class="nl mb it nh b gy nm nn l no np">recall_score(df_test_with_label['label'], df_predict['label'], average='macro')</span></pre><p id="b8b8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">运行代码的结果是输出 0.6312777479889565。</p><h2 id="4799" class="nl mb it bd mc oa ob dn mg oc od dp mk kb oe of mo kf og oh ms kj oi oj mw ok bi translated">精确</h2><p id="d7c7" class="pw-post-body-paragraph jq jr it js b jt my jv jw jx mz jz ka kb na kd ke kf nb kh ki kj nc kl km kn im bi translated">精度是比率<code class="fe ol om on nh b">tp / (tp + fp)</code>，其中<code class="fe ol om on nh b">tp</code>是真阳性的数量，<code class="fe ol om on nh b">fp</code>是假阳性的数量。精确度直观上是分类器不将阴性样品标记为阳性的能力。最佳值为 1，最差值为 0。同样，平均参数被设置为<strong class="js iu">宏</strong>。</p><pre class="kp kq kr ks gt ng nh ni nj aw nk bi"><span id="e634" class="nl mb it nh b gy nm nn l no np">precision_score(df_test_with_label['label'], df_predict['label'], average='macro')</span></pre><p id="6a5b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">精度比 recall 低一点，只有 0.6375505256。</p><h2 id="f859" class="nl mb it bd mc oa ob dn mg oc od dp mk kb oe of mo kf og oh ms kj oi oj mw ok bi translated">混淆矩阵</h2><p id="ebee" class="pw-post-body-paragraph jq jr it js b jt my jv jw jx mz jz ka kb na kd ke kf nb kh ki kj nc kl km kn im bi translated">仅仅有回忆和精确是不够好的，因为我们不知道哪个类有最好的预测，哪个类得到最差的结果。我们可以使用混淆矩阵方法来为我们提供这方面的更多见解。</p><pre class="kp kq kr ks gt ng nh ni nj aw nk bi"><span id="1a13" class="nl mb it nh b gy nm nn l no np">confusion_matrix(df_test_with_label['label'], df_predict['label'])</span></pre><p id="8f74" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我得到了以下输出。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/7491ed5deae4c45d2b9b98f2bf969254.png" data-original-src="https://miro.medium.com/v2/resize:fit:516/format:webp/1*63tpCMvZVFVZPiZtC8hxwQ.png"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk">Image by Author</figcaption></figure><p id="9faf" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们可以看到，该模型在预测第二个标签(中性)时有一些困难。在这种情况下，我们可能需要对数据集进行一些修改，并再次尝试重新训练它。</p></div><div class="ab cl lt lu hx lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="im in io ip iq"><h1 id="77b8" class="ma mb it bd mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx bi translated">5.结论</h1><p id="792b" class="pw-post-body-paragraph jq jr it js b jt my jv jw jx mz jz ka kb na kd ke kf nb kh ki kj nc kl km kn im bi translated">祝贺您完成本教程。让我们回顾一下今天所学的内容。</p><p id="ac76" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">首先，我们开始为我们的情感分析项目准备数据集。这包括获取数据并根据提供的详细信息自动标记数据。在我们的例子中，我们使用应用评论等级作为情感的标签。我们把它定为三类，即消极、中立和积极。我们从数据集生成了三个 tsv 文件。</p><p id="8d9a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">接下来，我们配置了所需的参数，如最大序列长度和批量大小。我们训练该模型，并使用它对测试数据进行预测。</p><p id="76f5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最后，我们将结果加载到一个数据框架中，并使用 sklearn 的度量函数对其进行分析。所提供的见解允许我们确定模型的性能。</p><p id="5157" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">感谢阅读，希望你喜欢这篇教程。下一篇文章再见。祝你有美好的一天！❤️</p></div><div class="ab cl lt lu hx lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="im in io ip iq"><h1 id="e512" class="ma mb it bd mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx bi translated">参考</h1><ol class=""><li id="51e9" class="lf lg it js b jt my jx mz kb op kf oq kj or kn lk ll lm ln bi translated"><a class="ae le" rel="noopener" target="_blank" href="/beginners-guide-to-bert-for-multi-classification-task-92f5445c2d7c">https://towards data science . com/beginners-guide-to-Bert-for-multi-class ification-task-92f 5445 c2d 7 c</a></li><li id="13a0" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated"><a class="ae le" href="https://github.com/google-research/bert" rel="noopener ugc nofollow" target="_blank">https://github.com/google-research/bert</a></li><li id="763b" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated"><a class="ae le" href="https://scikit-learn.org/stable/modules/classes.html#module-sklearn.metrics" rel="noopener ugc nofollow" target="_blank">https://sci kit-learn . org/stable/modules/classes . html # module-sk learn . metrics</a></li><li id="644c" class="lf lg it js b jt lo jx lp kb lq kf lr kj ls kn lk ll lm ln bi translated"><a class="ae le" href="https://www.taptap.com/" rel="noopener ugc nofollow" target="_blank">https://www.taptap.com/</a></li></ol></div></div>    
</body>
</html>