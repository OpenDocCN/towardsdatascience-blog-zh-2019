<html>
<head>
<title>Boost your efficiency and process Excel-files with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Python 提高效率和处理 Excel 文件</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/boost-your-efficiency-and-process-excel-files-with-python-cae650c85d6c?source=collection_archive---------8-----------------------#2019-11-01">https://towardsdatascience.com/boost-your-efficiency-and-process-excel-files-with-python-cae650c85d6c?source=collection_archive---------8-----------------------#2019-11-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="3404" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用 Python 加载、转换、修改和保存 Excel 文件，以改进您的报告流程</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/8a9d0c9a08897332fa0bab82227a98aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1zi6lnyQXFpXlZHYTYhCIw.png"/></div></div></figure><p id="5bc5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="lq">做数据工作，就会接触 excel。即使你自己不使用它，你的客户或同事也会使用它。Excel 的伟大之处就在于它本身:适用于较小数据集的表格计算。但是我一直很讨厌那种有一百万行几百列的 excel 表格。这种工作簿速度慢，往往在一些计算后崩溃。所以我开始使用 python 来处理大型 excel 文件，这提供了另一个很大的优势:你可以创建可重复的代码并提供文档。让我们跳进来吧！</em></p><h2 id="45dc" class="lr ls it bd lt lu lv dn lw lx ly dp lz ld ma mb mc lh md me mf ll mg mh mi mj bi translated">用 Python 读取 Excel 文件</h2><p id="8007" class="pw-post-body-paragraph ku kv it kw b kx mk ju kz la ml jx lc ld mm lf lg lh mn lj lk ll mo ln lo lp im bi translated">我们要处理的文件包含近一百万行和 16 列:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mp"><img src="../Images/bd120fe2ef1a4542c1d87e67893f8183.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nWiB2oIK5wwxehDXpvlKPw.png"/></div></div></figure><p id="6a1f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">Python 提供了<code class="fe mq mr ms mt b">read_excel()</code>来读取 Excel 文件作为数据帧:</p><pre class="kj kk kl km gt mu mt mv mw aw mx bi"><span id="56b4" class="lr ls it mt b gy my mz l na nb">import pandas as pd<br/>import numpy as np<br/>df = pd.read_excel(...\\Excel-Tutorial.xlsx')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nc"><img src="../Images/7143289db92afb123672268f7edce0b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zt3aXbX9NHoUZB7V6U1jUA.png"/></div></div></figure><p id="73ea" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如你所见，到目前为止数据看起来很干净，但我们的列标题似乎是错误的。许多 excel 地图包含标题或其他信息来引导读者。我们可以跳过这部分，定义一个标题行:</p><pre class="kj kk kl km gt mu mt mv mw aw mx bi"><span id="5677" class="lr ls it mt b gy my mz l na nb">df = pd.read_excel('…\\Excel-Tutorial.xlsx', header=[1]).reset_index()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nd"><img src="../Images/a6fb48fe30a50f74a3762184dfe5c604.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YjyEshsxM92hMBg-cCdF7A.png"/></div></div></figure><p id="3145" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">参数<code class="fe mq mr ms mt b">header=[1]</code>指定我们希望使用 excel 表格中的第二行作为标题。跳过所有以前的行。</p><h2 id="b57a" class="lr ls it bd lt lu lv dn lw lx ly dp lz ld ma mb mc lh md me mf ll mg mh mi mj bi translated">用熊猫做一些计算</h2><p id="db8b" class="pw-post-body-paragraph ku kv it kw b kx mk ju kz la ml jx lc ld mm lf lg lh mn lj lk ll mo ln lo lp im bi translated">营销部门的一个典型问题可能是，我们每年在不同国家的销售额是多少:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ne"><img src="../Images/a310ad54109a04118ae561aba10cf716.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jcgLC4z-zNK4ZTvgbSKa0w.png"/></div></div></figure><p id="da5b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们在 86 毫秒内完成了这个计算。用 Python 处理 Excel 文件的一个很大的优点是，任何类型的计算都比在 Excel 中快得多。操作越复杂，速度优势越大。</p><p id="7340" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">另一个需求可能是销售部门需要按年份和类别分组的每个国家的数据。因为他们要向全国市场提供数据，我们必须将计算结果保存在不同的工作表中:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ne"><img src="../Images/1c968d14fd3fd0f3649e95eed0e172cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tLxtgRIfzMDqB5JEEebZ8Q.png"/></div></div></figure><h2 id="f634" class="lr ls it bd lt lu lv dn lw lx ly dp lz ld ma mb mc lh md me mf ll mg mh mi mj bi translated">将结果保存为 Excel</h2><p id="01a3" class="pw-post-body-paragraph ku kv it kw b kx mk ju kz la ml jx lc ld mm lf lg lh mn lj lk ll mo ln lo lp im bi translated">下一步，我们想再次将文件保存为 Excel 格式，以便提供给销售和市场部。我们将创建一个<code class="fe mq mr ms mt b">pd.ExcelWriter</code>对象并创建不同的工作表:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nf"><img src="../Images/0d9fedade655c296a1db4eaf3169221a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3-HRq9pzTFG6uRu3W3Rquw.png"/></div></div></figure><p id="e47f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">很容易，不是吗？让我们看看新创建的工作簿:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/d33fe56b0d858e5ad408e687c0e48b64.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pzxOWeLwZ2jOR80WFAkA8g.png"/></div></div></figure><p id="f29c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如你所见，我们的数据帧被正确保存到指定的工作表中。在我们把好的结果发给两个部门后，第二天我们就收到了一封邮件:他们要求一些格式化和可视化。因为我们每个月都必须转换这种数据，所以我们决定也用 Python 来执行这些任务。</p><h2 id="79c3" class="lr ls it bd lt lu lv dn lw lx ly dp lz ld ma mb mc lh md me mf ll mg mh mi mj bi translated">格式化和可视化</h2><p id="8cde" class="pw-post-body-paragraph ku kv it kw b kx mk ju kz la ml jx lc ld mm lf lg lh mn lj lk ll mo ln lo lp im bi translated">要添加格式和可视化，我们必须再次创建一个 writer 对象:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/ea819672a2ab3f3660daff4d64e048e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pOckVYzl49_lrxFpsxnvjA.png"/></div></div></figure><p id="650f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如您所见，代码的第一部分与第一个示例中的相同。我们创建一个 writer 对象。<code class="fe mq mr ms mt b">xlsxwriter</code>让我们访问 Excel 的功能，如图表和格式。为了访问这个特性，我们需要获得工作簿对象<code class="fe mq mr ms mt b">workbook = writer.book</code>和工作表对象<code class="fe mq mr ms mt b">worksheet = writer.sheet['Sales_Sums']</code>。在本例中，我们将在第一张纸上进行修改。我们添加一个图表，指定数据的范围(<code class="fe mq mr ms mt b">=Sales_Sums!$B$2:$B$7'</code>)并将其添加到工作表的单元格<code class="fe mq mr ms mt b">A9</code>中。</p><p id="7b4f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">同样，我们为销售数据添加格式。我们在范围<code class="fe mq mr ms mt b">B2:B7</code>上添加了一个 3 色标，以在视觉上突出显示低值或高值。我们还调整了第一列和第二列的宽度<code class="fe mq mr ms mt b">worksheet.set_column(0,1,30)</code>。我们还格式化了销售数据的列标题，并将其重命名为<code class="fe mq mr ms mt b">2019 Sales Data</code>。最后一步，我们保存文件:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/a93307f21724831498aa512875a7a9b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1Fehla5bJfXUu5HcaD4lUA.png"/></div></div></figure><p id="ef08" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这个结果比 Excel 好得多，提供了一个很大的优势。下个月我们只需点击一下就能复制出完全相同的文件。</p><h2 id="257b" class="lr ls it bd lt lu lv dn lw lx ly dp lz ld ma mb mc lh md me mf ll mg mh mi mj bi translated">结论</h2><p id="6633" class="pw-post-body-paragraph ku kv it kw b kx mk ju kz la ml jx lc ld mm lf lg lh mn lj lk ll mo ln lo lp im bi translated">Python 非常适合处理 Excel 文件。您可以更轻松地处理大文件，创建可重复的代码，并为您的同事提供文档。我们还看到了我们可以轻松访问 Python 的高级功能。您可以自动化整个报告流程。</p><h2 id="21e9" class="lr ls it bd lt lu lv dn lw lx ly dp lz ld ma mb mc lh md me mf ll mg mh mi mj bi translated">延伸阅读:</h2><p id="2204" class="pw-post-body-paragraph ku kv it kw b kx mk ju kz la ml jx lc ld mm lf lg lh mn lj lk ll mo ln lo lp im bi translated">创建图表:</p><div class="nj nk gp gr nl nm"><a href="https://pandas-xlsxwriter-charts.readthedocs.io/" rel="noopener  ugc nofollow" target="_blank"><div class="nn ab fo"><div class="no ab np cl cj nq"><h2 class="bd iu gy z fp nr fr fs ns fu fw is bi translated">使用 Pandas 和 XlsxWriter 创建 Excel 图表</h2><div class="nt l"><h3 class="bd b gy z fp nr fr fs ns fu fw dk translated">使用 Pandas 和 XlsxWriter 创建带有图表的 Excel 文件的介绍。</h3></div><div class="nu l"><p class="bd b dl z fp nr fr fs ns fu fw dk translated">pandas-xlsxwriter-charts . readthedocs . io</p></div></div></div></a></div><p id="edbc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">带有熊猫透视的 Excel 报表:</p><div class="nj nk gp gr nl nm"><a href="https://pbpython.com/pandas-pivot-report.html" rel="noopener  ugc nofollow" target="_blank"><div class="nn ab fo"><div class="no ab np cl cj nq"><h2 class="bd iu gy z fp nr fr fs ns fu fw is bi translated">从熊猫数据透视表生成 Excel 报表</h2><div class="nt l"><h3 class="bd b gy z fp nr fr fs ns fu fw dk translated">上一篇数据透视表文章描述了如何使用 pandas pivot_table 函数在一个</h3></div><div class="nu l"><p class="bd b dl z fp nr fr fs ns fu fw dk translated">pbpython.com</p></div></div><div class="nv l"><div class="nw l nx ny nz nv oa ks nm"/></div></div></a></div><p id="bd40" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">用 Python 格式化 Excel 文件:</p><div class="nj nk gp gr nl nm"><a href="https://xlsxwriter.readthedocs.io/tutorial02.html" rel="noopener  ugc nofollow" target="_blank"><div class="nn ab fo"><div class="no ab np cl cj nq"><h2 class="bd iu gy z fp nr fr fs ns fu fw is bi translated">教程 2:向 XLSX 文件添加格式</h2><div class="nt l"><h3 class="bd b gy z fp nr fr fs ns fu fw dk translated">在上一节中，我们使用 Python 和 XlsxWriter 模块创建了一个简单的电子表格。这转换了…</h3></div><div class="nu l"><p class="bd b dl z fp nr fr fs ns fu fw dk translated">xlsxwriter.readthedocs.io</p></div></div></div></a></div></div><div class="ab cl ob oc hx od" role="separator"><span class="oe bw bk of og oh"/><span class="oe bw bk of og oh"/><span class="oe bw bk of og"/></div><div class="im in io ip iq"><p id="768f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><a class="ae oi" href="https://medium.com/@droste.benedikt/membership" rel="noopener">如果您喜欢中级数据科学，并且尚未注册，请随时使用我的推荐链接加入该社区。</a></p></div></div>    
</body>
</html>