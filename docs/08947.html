<html>
<head>
<title>Deploying Flask with Gunicorn 3</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 Gunicorn 3 展开烧瓶</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/deploying-flask-with-gunicorn-3-9eaacd0f6eea?source=collection_archive---------5-----------------------#2019-11-29">https://towardsdatascience.com/deploying-flask-with-gunicorn-3-9eaacd0f6eea?source=collection_archive---------5-----------------------#2019-11-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/af0889d46998ae75c857c30b9858809d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SrzgnJfRxDZ2nOk6S1SYWg.png"/></div></div></figure><p id="d82a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi kz translated">应用程序部署经常会带来意想不到的后果和错误。部署可能是决定最终期限的步骤，也可能是决定应用程序成败的步骤。许多数据科学家害怕这种部署，因为它可能非常乏味，并且需要我们许多人不一定精通的技能(开发-运营。)在我的<a class="ae li" rel="noopener" target="_blank" href="/the-unspoken-data-science-soft-skills-cc836d51b73d?source=your_stories_page---------------------------">“数据科学的软技能”文章</a>中，我提到了数据科学家在某些方面是如何实践开发-运营技能的。这是有充分理由的，因为我发现自己对<em class="lj">“系统管理员活动”越来越感兴趣了</em></p><p id="e961" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我真正喜欢的一项服务是基于 Linux 的 VPS 主机服务。Linode 非常棒，因为它拥有我想要的极简主义，以及我喜欢的安全性和功能。因此，我们首先假设您有一个想要托管的域(或 IP)，并且有一个 Linode 或类似的虚拟专用服务器正在运行，准备好通过 SSH 连接。</p></div><div class="ab cl lk ll hx lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="im in io ip iq"><h1 id="4fb1" class="lr ls it bd lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo bi translated">进去吧。</h1><p id="c037" class="pw-post-body-paragraph kb kc it kd b ke mp kg kh ki mq kk kl km mr ko kp kq ms ks kt ku mt kw kx ky im bi translated">第一步当然是知道你的主机和根密码。您的主机将是 Linode 提供给您的 IPV4 地址，例如:</p><pre class="mu mv mw mx gt my mz na nb aw nc bi"><span id="d7eb" class="nd ls it mz b gy ne nf l ng nh">48.87.54.01</span></pre><p id="de8f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">为了 SSH 到我们的服务器，我们可以使用一个 SSH 工具，比如 PuTTy(主要针对 Windows 用户)，或者只是通过我们的终端使用 SSH。然后就像对你的根用户一样简单了。万一这个命令返回“ssh: command not found ”,您可能需要安装 openssh。</p><pre class="mu mv mw mx gt my mz na nb aw nc bi"><span id="9033" class="nd ls it mz b gy ne nf l ng nh">ssh root@your.ip.address</span></pre><p id="ac5d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">太好了！现在我们进来了，我们必须创建一个新用户！当然，这取决于你的发行版…</p><figure class="mu mv mw mx gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ni"><img src="../Images/cef84c44ec8f9e5c704b19714a2c76b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KhFrObx3QU2_i-wMPsxoeg.jpeg"/></div></div></figure><p id="7b70" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我要戴上红帽:</p><pre class="mu mv mw mx gt my mz na nb aw nc bi"><span id="0b91" class="nd ls it mz b gy ne nf l ng nh">useradd <em class="lj">username</em></span></pre><p id="c2fd" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">但是如果你选择了 Ubuntu:</p><pre class="mu mv mw mx gt my mz na nb aw nc bi"><span id="93e8" class="nd ls it mz b gy ne nf l ng nh">adduser username</span></pre><p id="2942" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在，如果您想让您的新帐户能够使用超级用户的密码访问他们的命令:</p><pre class="mu mv mw mx gt my mz na nb aw nc bi"><span id="f8f4" class="nd ls it mz b gy ne nf l ng nh">usermod -aG sudo username</span></pre></div><div class="ab cl lk ll hx lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="im in io ip iq"><h1 id="aa3b" class="lr ls it bd lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo bi translated">安装目录(NGINX)</h1><p id="78a2" class="pw-post-body-paragraph kb kc it kd b ke mp kg kh ki mq kk kl km mr ko kp kq ms ks kt ku mt kw kx ky im bi translated">设置您的用户帐户后，您可以使用 root 的“login”命令登录，或者您可以使用您的用户名替换 root，通过 SSH 登录您的用户帐户:</p><pre class="mu mv mw mx gt my mz na nb aw nc bi"><span id="4db6" class="nd ls it mz b gy ne nf l ng nh">ssh username@your.ip.address</span></pre><p id="b1ce" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">第一步是获取 NGINX。你可以把 NGINX 想象成一个巨大的路由器，NGINX 使得从一个网站服务多个域和监听端口变得非常容易。所以打开你的终端，通过你的包管理器安装它。</p><pre class="mu mv mw mx gt my mz na nb aw nc bi"><span id="acb7" class="nd ls it mz b gy ne nf l ng nh">sudo dnf install nginx</span></pre><p id="eb3b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">您的操作系统的软件包管理器(如果您不知道)也在下面。(只需运行 sudo {包管理器}安装 nginx)</p><pre class="mu mv mw mx gt my mz na nb aw nc bi"><span id="8da8" class="nd ls it mz b gy ne nf l ng nh">Distro      |     Package Manager<br/>---------------------------------<br/>Ubuntu      |        apt-get<br/>RedHat      |      dnf / yum<br/>Opensuse    |          man<br/>Arch        |         pacman</span></pre><p id="8f65" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在我们需要在 HTTP 协议中为 www 建立一个域或位置。无论是购买的域名，还是你的服务器的 IP 地址，都没有那么重要。接下来，我们必须编辑 NGINX 的配置文件:</p><pre class="mu mv mw mx gt my mz na nb aw nc bi"><span id="da35" class="nd ls it mz b gy ne nf l ng nh">sudo nano /etc/nginx/sites-enabled/flask_app</span></pre><p id="4753" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这将打开一个文本编辑器，文件有可能是旧的，但很可能是新的。结果应该是这样的:</p><pre class="mu mv mw mx gt my mz na nb aw nc bi"><span id="9d77" class="nd ls it mz b gy ne nf l ng nh"><strong class="mz iu">server</strong> {<br/>    <strong class="mz iu">listen</strong> 80;<br/>    <strong class="mz iu">server_name</strong> your.ip.here;<br/><br/>    <strong class="mz iu">location</strong> / {<br/>        <strong class="mz iu">proxy_pass</strong> http://127.0.0.1:8000;<br/>        <strong class="mz iu">proxy_set_header</strong> Host $host;<br/>        <strong class="mz iu">proxy_set_header</strong> X-Forwarded-For $proxy_add_x_forwarded_for;<br/>    }<br/>}</span></pre><p id="2347" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在我们只需要取消默认配置文件的链接:</p><pre class="mu mv mw mx gt my mz na nb aw nc bi"><span id="c555" class="nd ls it mz b gy ne nf l ng nh">sudo unlink /etc/nginx/sites-enabled/default</span></pre><p id="4557" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在向上移动到根目录(不是您的用户主目录。)</p><pre class="mu mv mw mx gt my mz na nb aw nc bi"><span id="1de6" class="nd ls it mz b gy ne nf l ng nh">cd ..</span></pre><p id="60f7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在我们需要在 var/www/your.ip.here 中创建一个目录。</p><pre class="mu mv mw mx gt my mz na nb aw nc bi"><span id="2528" class="nd ls it mz b gy ne nf l ng nh">sudo mkdir var/www/your.ip.here</span></pre><p id="5c00" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后给我们自己超级用户特权，这样我们就不需要使用 sudo 来访问我们的文件系统。</p><pre class="mu mv mw mx gt my mz na nb aw nc bi"><span id="4636" class="nd ls it mz b gy ne nf l ng nh">sudo chown var/www/your.ip.here</span></pre><p id="de30" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">基本上就是这样了！恭喜你，你的静态文件将正式在这个目录中工作！但是弗拉斯克呢？我们只需要一个快速的服务器设置！</p></div><div class="ab cl lk ll hx lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="im in io ip iq"><h1 id="f339" class="lr ls it bd lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo bi translated">设置服务器(Gunicorn)</h1><p id="c3e0" class="pw-post-body-paragraph kb kc it kd b ke mp kg kh ki mq kk kl km mr ko kp kq ms ks kt ku mt kw kx ky im bi translated">将您的文件克隆、SSH 或安全复制到我们在文件系统设置中创建的 var/www 目录中。现在我们需要重新安装 Gunicorn 3。</p><pre class="mu mv mw mx gt my mz na nb aw nc bi"><span id="f4d5" class="nd ls it mz b gy ne nf l ng nh">sudo dnf install gunicorn3</span></pre><p id="f84f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">并且和 supervisor 做同样的事情(如果需要可以像上次一样参考包管理器图表！)</p><pre class="mu mv mw mx gt my mz na nb aw nc bi"><span id="f355" class="nd ls it mz b gy ne nf l ng nh">sudo dnf install supervisor</span></pre><p id="cf4d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在我们必须创建一个主管，所以准备在 Nano 中打开更多的文本吧！</p><pre class="mu mv mw mx gt my mz na nb aw nc bi"><span id="fa52" class="nd ls it mz b gy ne nf l ng nh">sudo nano /etc/supervisor/conf.d/flask_app.conf</span></pre><p id="c2b6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">并用您的设置进行配置！：</p><pre class="mu mv mw mx gt my mz na nb aw nc bi"><span id="2fe4" class="nd ls it mz b gy ne nf l ng nh">[program:flask_app]<br/>directory=/var/<br/>command=gunicorn3 -workers=3 flask_app:app<br/>autostart=true<br/>autorestart=true<br/>stopasgroup=true<br/>killasgroup=true<br/>stderr_logfile=/var/log/appname/lognameerr.log<br/>stdout_logfile=/var/log/appname/lognamestdout.log</span></pre><p id="fc7d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后为你的日志创建目录(当然这不是完全必要的，但是绝对是一个好的实践。)</p><pre class="mu mv mw mx gt my mz na nb aw nc bi"><span id="d8bd" class="nd ls it mz b gy ne nf l ng nh">sudo mkdir /path/to/logs (/var/log for me)<br/>sudo touch outputpath<br/>sudo touch stderrpath</span></pre></div><div class="ab cl lk ll hx lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="im in io ip iq"><h1 id="d3a4" class="lr ls it bd lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo bi translated">恭喜你！</h1><p id="5aa3" class="pw-post-body-paragraph kb kc it kd b ke mp kg kh ki mq kk kl km mr ko kp kq ms ks kt ku mt kw kx ky im bi translated">你已经用“传统的方式”部署了你的 Flask 应用程序这允许更多的扩展能力和多功能性，特别是与 Heroku 等其他替代方案相比。我认为这是一种非常有趣的方式，但有些人可能会说这有点乏味。当然，这些通常不是 DS 的职责，但是如果你发现你的团队陷入困境，这肯定是你很高兴学到的东西！</p></div></div>    
</body>
</html>