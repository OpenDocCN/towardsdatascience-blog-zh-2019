<html>
<head>
<title>Image clustering using Transfer learning</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于迁移学习的图像聚类</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/image-clustering-using-transfer-learning-df5862779571?source=collection_archive---------2-----------------------#2019-02-02">https://towardsdatascience.com/image-clustering-using-transfer-learning-df5862779571?source=collection_archive---------2-----------------------#2019-02-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="4b47" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">基于 Resnet50 + Kmeans 的猫狗图像聚类模型！！！！</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/64c9eff4d16f234b2de650011135a933.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6EZYXIKxlRYHOGRVZbNmVg.jpeg"/></div></div></figure><p id="3640" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">聚类是无监督机器学习的一个有趣领域，我们将数据集分类到一组相似的组中。这是“无监督学习”含义的一部分，其中没有事先训练发生，数据集将是无标签的。可以使用不同的技术进行聚类，如 K-means 聚类、均值漂移聚类、DB 扫描聚类、层次聚类等。所有聚类算法背后的关键假设是特征空间中的邻近点具有相似的质量，并且它们可以被聚类在一起。</p><p id="621b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在本文中，我们将对图像进行聚类。图像也与常规 ML 中的数据点相同，可视为类似问题。但是最大的问题是，</p><p id="ebc1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">定义图像的相似度！！！！！</p><p id="78ea" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">相似性可以意味着看起来相似的图像，或者可以是相似的尺寸，或者可以是相似的像素分布，相似的背景等。对于不同的用例，我们必须导出特定的图像向量。即，包含图像实体(包含猫或狗)的图像向量将不同于具有像素分布的图像向量。</p><p id="d652" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在这篇文章中，我们将有一组猫和狗的图片。我们会试着把它们聚类成猫照和狗照。为此，我们可以从预先训练的 CNN 模型(如 Resnet50)中导出图像向量。我们可以删除 resnet50 的最后一层，并提取 2048 大小的矢量。一旦我们有了向量，我们就在数据点上应用 KMeans 聚类。</p><p id="4a4a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这是我的数据集中的一些图片，大约有 60 张从网上随机抽取的猫狗图片。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ln"><img src="../Images/77a1ce5435562f6893775b7ea9cf9aab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S0HRefEJHnpWU5h38SuC7A.png"/></div></div></figure><h1 id="b4c9" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">代码遍历</h1><p id="92a7" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">第一步是加载所需的库并加载预训练的 Resnet50 模型。请记住从模型中移除最后一个 softmax 层。</p><pre class="kg kh ki kj gt ml mm mn mo aw mp bi"><span id="8805" class="mq lp iq mm b gy mr ms l mt mu">resnet_weights_path = '../input/resnet50/resnet50_weights_tf_dim_ordering_tf_kernels_notop.h5'<br/><br/>my_new_model = Sequential()<br/>my_new_model.add(ResNet50(include_top=False, pooling='avg', weights=resnet_weights_path))<br/><br/><em class="mv"># Say not to train first layer (ResNet) model. It is already trained</em><br/>my_new_model.layers[0].trainable = False</span></pre><p id="b350" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">一旦我们加载了模型，我们可以有一个函数来加载所有的图像，将图像调整到固定的像素大小(224，224)，通过模型传递它并提取特征集。</p><pre class="kg kh ki kj gt ml mm mn mo aw mp bi"><span id="490e" class="mq lp iq mm b gy mr ms l mt mu">def extract_vector(path):<br/>    resnet_feature_list = []<br/><br/>    for im in glob.glob(path):<br/><br/>        im = cv2.imread(im)<br/>        im = cv2.resize(im,(224,224))<br/>        img = preprocess_input(np.expand_dims(im.copy(), axis=0))<br/>        resnet_feature = my_new_model.predict(img)<br/>        resnet_feature_np = np.array(resnet_feature)<br/>        resnet_feature_list.append(resnet_feature_np.flatten())<br/><br/>    return np.array(resnet_feature_list)</span></pre><p id="b490" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">一旦我们有了提取的特征集，我们就可以对数据集进行 KMeans 聚类。K 必须事先确定，或者我们可以画出损失函数与 K 的关系，并推导出它。由于我们知道 K 的值为 2，所以可以直接代入。</p><pre class="kg kh ki kj gt ml mm mn mo aw mp bi"><span id="5611" class="mq lp iq mm b gy mr ms l mt mu">kmeans = KMeans(n_clusters=2, random_state=0).fit(array)<br/>print(kmeans.labels_)</span></pre><p id="a049" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">就这些！！！！我们已经完成了图像聚类模型。让我们看看，我们的模型能多好地聚集图像。</p><p id="5893" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">以下是与第一组相对应的一些图像:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mw"><img src="../Images/a6917f6661e3a023d9dffe85c47d6082.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K133H24z0YU2FI46XM2Y2g.png"/></div></div></figure><p id="f6de" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这是另一个集群:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mx"><img src="../Images/58cbb1b9e54a3637c9f6ba286b3882f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YkpgNYq9p2DdkR0ksJCuug.png"/></div></div></figure><p id="736b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">总体而言，集群性能似乎非常好。在我聚类的 60 个图像中，只有两个图像被错误地聚类。这些图片如下:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi my"><img src="../Images/130fd1e54b1821b8f224c2384178e1f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QDjb2MZgQzs3B00bWz_mow.png"/></div></div></figure><p id="b121" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">上面两只狗被错误的聚类成了猫。可能是 ML 模型觉得它们很像猫。:)</p><p id="8205" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们可以使用 t-SNE 算法进一步研究图像的分布。这是一种降维算法，其中 2048 图像向量将被降低到更小的维度，以便更好地绘图、存储和时间限制。下面是我得到的 60 个图像数据集的结果。</p><p id="1bc5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">蓝点代表聚类-1(猫)，绿点代表聚类-2(狗)。请注意，迷你照片不是 t-SNE 的一部分，它只是额外添加的。相交区域可以被认为是模型发现难以恰当地拟合聚类的地方。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/16cc1256ff0b67f3dbf07104286a3d92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1388/format:webp/1*n8UZ90NsFpGhHJSQ3YCg_Q.png"/></div></figure><h1 id="aa9b" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">结论</h1><p id="d6a1" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">希望您对使用迁移学习构建一个基本的图像聚类方法有很好的理解。正如我已经说过的，在某些情况下，CNN 输出可能不是图像特征的最佳选择。我们也可以用 bagging 技术考虑 HSV(色调-饱和度-值)来创建向量，其中相似的像素分布是我们的聚类方法。</p><p id="c998" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">快乐学习:)</p></div></div>    
</body>
</html>