<html>
<head>
<title>Climate Heatmaps Made Easy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">气候热图变得简单</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/climate-heatmaps-made-easy-6ec5be0be6ff?source=collection_archive---------19-----------------------#2019-02-28">https://towardsdatascience.com/climate-heatmaps-made-easy-6ec5be0be6ff?source=collection_archive---------19-----------------------#2019-02-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="c441" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">用熊猫和海牛调查古气候数据</h2></div><p id="f01e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">不久前<strong class="kh ir">艾德·霍金斯</strong>博士，恰好是<a class="ae lb" href="https://www.climate-lab-book.ac.uk/spirals/" rel="noopener ugc nofollow" target="_blank">气候螺旋</a>的创造者，向世界发布了从 1850 年到 2017 年全球年气温的<a class="ae lb" href="https://www.climate-lab-book.ac.uk/2018/warming-stripes/" rel="noopener ugc nofollow" target="_blank">变暖条纹</a>图。这个概念很简单，但也非常丰富:每个条纹代表一年的温度，随着时间序列的推移，任何人都可以非常明显地看到变化。</p><p id="01fd" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">从本质上讲，这些条纹一起构成了一个热图，而热图很容易通过<code class="fe lc ld le lf b">Seaborn</code>的一点帮助来制作。这里的目的是扩展几个世纪的变暖条纹，从稍微不同的角度来看温度变化，但为此你需要数据。</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi lg"><img src="../Images/e406c0841cf39171c8f422731b672bdd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qx9BIvD5TI7N1fP4ItR_eg.png"/></div></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk">The original Warming Stripes made by Dr. Ed Hawkins</figcaption></figure><h1 id="cf50" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">穴居人的气候</h1><p id="2f66" class="pw-post-body-paragraph kf kg iq kh b ki mo jr kk kl mp ju kn ko mq kq kr ks mr ku kv kw ms ky kz la ij bi translated">顾名思义，古气候学是一种专注于遥远时代气候条件的研究——从几个世纪前到我们星球出现后的第一个千年。</p><p id="bb42" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">你可能会疑惑:<em class="mt">我们</em>怎么才能<em class="mt">知道</em>？这有点复杂，但古气候学通过使用被称为<strong class="kh ir">代理</strong>的数据，树木年轮、冰芯、珊瑚和其他自然资源中包含的<strong class="kh ir">温度</strong>和<strong class="kh ir">降雨量</strong>的间接测量数据而繁荣发展，这些数据被仔细分析以提供良好的气候信息重建。</p><p id="f895" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">你可以去很多地方下载古气候时间序列，但是你的第一站应该是 NOAA 的国家环境信息中心(NCEI)数据库。对于喜欢气候的科学家和<em class="mt">数据</em>来说，这是一座金矿(但不是唯一的一座)。</p><h1 id="c150" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">把所有的放在一起</h1><p id="b99c" class="pw-post-body-paragraph kf kg iq kh b ki mo jr kk kl mp ju kn ko mq kq kr ks mr ku kv kw ms ky kz la ij bi translated">您将使用的数据代表了从 1000 年到 1998 年北半球温度的时间序列重建，这在<a class="ae lb" href="https://agupubs.onlinelibrary.wiley.com/doi/abs/10.1029/1999GL900070%4010.1002/%28ISSN%291944-8007.GRL40" rel="noopener ugc nofollow" target="_blank"> Mann、Bradley 和 Hughes (1999) </a>的开创性工作中有所展示。你可能从<strong class="kh ir">曲棍球棒</strong>图中知道这一点，但是现在你将有机会在这里制作<strong class="kh ir">你自己的</strong>版本的图。</p><p id="be57" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">首先，导入常见的疑点:</p><figure class="lh li lj lk gt ll"><div class="bz fp l di"><div class="mu mv l"/></div></figure><h1 id="a130" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">读取文件</h1><p id="e9a2" class="pw-post-body-paragraph kf kg iq kh b ki mo jr kk kl mp ju kn ko mq kq kr ks mr ku kv kw ms ky kz la ij bi translated">使用<code class="fe lc ld le lf b">Pandas</code>可以通过<code class="fe lc ld le lf b">read_csv()</code>读取包含时间序列的文本文件:</p><figure class="lh li lj lk gt ll"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="b3e2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe lc ld le lf b">delim_whitespace=True</code>参数识别由空格分隔的数据列，使用<code class="fe lc ld le lf b">header=None</code>您对<code class="fe lc ld le lf b">Pandas</code>说您的数据没有标题，也没有特定的列名，因此数据文件中的时间序列如下所示:</p><figure class="lh li lj lk gt ll"><div class="bz fp l di"><div class="mu mv l"/></div></figure><figure class="lh li lj lk gt ll gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/26da9ae4054cb13143d6289645171e4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:326/format:webp/1*8N3vwvVOwM3skFY6mUBLPA.png"/></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk">Two simple columns</figcaption></figure><p id="7505" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这些列由索引号识别，第一列为“0”(年份列)，第二列为“1”(温度数据)。好消息是<code class="fe lc ld le lf b">Pandas</code>允许您用任何您喜欢的<code class="fe lc ld le lf b">str</code>名称来重命名列，例如:</p><figure class="lh li lj lk gt ll"><div class="bz fp l di"><div class="mu mv l"/></div></figure><h1 id="bc1d" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">你自己的曲棍球棒</h1><p id="5a64" class="pw-post-body-paragraph kf kg iq kh b ki mo jr kk kl mp ju kn ko mq kq kr ks mr ku kv kw ms ky kz la ij bi translated">一个令人惊叹的<code class="fe lc ld le lf b">Seaborn</code>功能是可以根据不同的喜好为您的图形设置<code class="fe lc ld le lf b">style</code>和<code class="fe lc ld le lf b">context</code>，例如:</p><figure class="lh li lj lk gt ll"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="9536" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">虽然有许多选项，但所选的<code class="fe lc ld le lf b">style</code>是<code class="fe lc ld le lf b">ticks</code>和上下文<code class="fe lc ld le lf b">talk</code>，也从<code class="fe lc ld le lf b">Matplotlib</code>参数中定义了<code class="fe lc ld le lf b">lines.linewidth</code>。查看<code class="fe lc ld le lf b"><a class="ae lb" href="https://seaborn.pydata.org/tutorial/aesthetics.html" rel="noopener ugc nofollow" target="_blank">Seaborn</a></code> <a class="ae lb" href="https://seaborn.pydata.org/tutorial/aesthetics.html" rel="noopener ugc nofollow" target="_blank">文档</a>了解更多信息。</p><p id="4c8c" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">样式准备好了，是时候用<code class="fe lc ld le lf b">Seaborn</code>和<code class="fe lc ld le lf b">Matplotlib</code>的组合来绘制你的<strong class="kh ir">曲棍球棒</strong>图了:</p><figure class="lh li lj lk gt ll"><div class="bz fp l di"><div class="mu mv l"/></div></figure><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi mx"><img src="../Images/3de22c330a36f839e0e09b9505ca961d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rtnQJ9cCdeeQTXWAOvTZww.png"/></div></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk">The Hockey Stick, right at the end (where we are now)</figcaption></figure><p id="2231" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">上面发生了什么事？你用<code class="fe lc ld le lf b">sns.lineplot()</code>绘制温度数据就像你用<code class="fe lc ld le lf b">Matplotlib</code>中的标准<code class="fe lc ld le lf b">plt.plot()</code>一样，而红色和蓝色阴影区域在<code class="fe lc ld le lf b">axvspan()</code>的帮助下(带着诗意的许可)代表了<a class="ae lb" href="https://en.wikipedia.org/wiki/Medieval_Warm_Period" rel="noopener ugc nofollow" target="_blank">中世纪温暖期</a>和<a class="ae lb" href="https://en.wikipedia.org/wiki/Little_Ice_Age" rel="noopener ugc nofollow" target="_blank">小冰期</a>。任何接触过<code class="fe lc ld le lf b">Matplotlib</code>的人都熟悉<code class="fe lc ld le lf b">set_xlabel()</code>和<code class="fe lc ld le lf b">set_ylabel()</code>函数，但是在这里你可以看到它们也可以很好地处理<code class="fe lc ld le lf b">$\degree$</code>符号的 LaTeX。</p><p id="d628" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">别再打曲棍球了，条纹在哪里？</p><h1 id="6d0e" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">古气候条纹</h1><p id="d1b8" class="pw-post-body-paragraph kf kg iq kh b ki mo jr kk kl mp ju kn ko mq kq kr ks mr ku kv kw ms ky kz la ij bi translated">将原始变暖条纹作为热图来看，图表没有显示任何颜色条，也没有轴标签和刻度，因此抑制这些以保持您自己的条纹的保真度是很重要的。为此，<code class="fe lc ld le lf b">Seaborn</code>提供了<a class="ae lb" href="https://seaborn.pydata.org/generated/seaborn.heatmap.html" rel="noopener ugc nofollow" target="_blank">足够多的选项</a>来做一个好的近似。</p><p id="9592" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">需要注意的一点是，<code class="fe lc ld le lf b">Seaborn</code>需要一个 2D 数组作为输入数据，而您的时间序列是一个简单的 1D 数组:</p><figure class="lh li lj lk gt ll"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="6d60" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">解决这个问题的一个方法是使用<code class="fe lc ld le lf b">NumPy</code>并用<code class="fe lc ld le lf b"><a class="ae lb" href="https://docs.scipy.org/doc/numpy-1.13.0/reference/arrays.indexing.html#numpy.newaxis" rel="noopener ugc nofollow" target="_blank">np.newaxis</a></code>创建一个新的维度。解决了这个问题，制作自己的条纹就很容易了:</p><figure class="lh li lj lk gt ll"><div class="bz fp l di"><div class="mu mv l"/></div></figure><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi my"><img src="../Images/f40bafa9cb4d6c3cd8acb38d06c22cdf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VqMlIcU-Nxl6R3zqRnOdPw.png"/></div></div><figcaption class="ls lt gj gh gi lu lv bd b be z dk">How comparable is the Hockey Stick era to the last 1000 years?</figcaption></figure><p id="f740" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用<code class="fe lc ld le lf b">sns.heatmap()</code>你的论点是:</p><ul class=""><li id="b336" class="mz na iq kh b ki kj kl km ko nb ks nc kw nd la ne nf ng nh bi translated"><code class="fe lc ld le lf b">data</code>:温度时间序列<code class="fe lc ld le lf b">mbh99</code></li><li id="a4b1" class="mz na iq kh b ki ni kl nj ko nk ks nl kw nm la ne nf ng nh bi translated"><code class="fe lc ld le lf b">cmap</code>和<code class="fe lc ld le lf b">cbar</code>:来自<code class="fe lc ld le lf b"><a class="ae lb" href="https://matplotlib.org/examples/color/colormaps_reference.html" rel="noopener ugc nofollow" target="_blank">Matplotlib</a></code> <a class="ae lb" href="https://matplotlib.org/examples/color/colormaps_reference.html" rel="noopener ugc nofollow" target="_blank">库</a>的<code class="fe lc ld le lf b">seismic</code>颜色图(其他酷的有:RdYlBu_r、地震、coolwarm、bwr、RdBu_r)和<code class="fe lc ld le lf b">False</code>来抑制颜色条</li><li id="fb49" class="mz na iq kh b ki ni kl nj ko nk ks nl kw nm la ne nf ng nh bi translated"><code class="fe lc ld le lf b">vmin</code>、<code class="fe lc ld le lf b">vmax</code>和<code class="fe lc ld le lf b">center</code>:绘制颜色的最小(-.4)和最大(. 1)极限，而红色和蓝色在 0°处发散。</li><li id="80d6" class="mz na iq kh b ki ni kl nj ko nk ks nl kw nm la ne nf ng nh bi translated"><code class="fe lc ld le lf b">xticklabels</code>和<code class="fe lc ld le lf b">yticklabels</code>:所有<code class="fe lc ld le lf b">False</code>使条纹可见</li></ul><p id="0f31" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">你在这里，你自己的温暖条纹。很容易，不是吗？</p><h1 id="dff3" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">结论</h1><p id="90b6" class="pw-post-body-paragraph kf kg iq kh b ki mo jr kk kl mp ju kn ko mq kq kr ks mr ku kv kw ms ky kz la ij bi translated">古气候学是对遥远时期气候的研究，从几个世纪前到地球诞生的最初几天。NCEI 的古气候数据库允许任何人下载来自不同研究的几个数据集，例如 Mann、Bradley 和 Hughes(1999)，但是你也可以从许多其他人那里获得数据。</p><p id="2e94" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">只需一点点<code class="fe lc ld le lf b">Pandas</code>和<code class="fe lc ld le lf b">Seaborn</code>你就可以读取数据并为你感兴趣的任何时间序列制作热图，比如你在这里使用的，并制作你自己版本的变暖条纹(以及许多其他东西)。玩得开心！</p><p id="bbc1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">PS:就在这里，你可以很容易地获得源代码和数据<a class="ae lb" href="https://github.com/willyhagi/flyingcircus/tree/master/Paleostripes" rel="noopener ugc nofollow" target="_blank">。</a></p><h2 id="f17d" class="nn lx iq bd ly no np dn mc nq nr dp mg ko ns nt mi ks nu nv mk kw nw nx mm ny bi translated">参考</h2><p id="3f97" class="pw-post-body-paragraph kf kg iq kh b ki mo jr kk kl mp ju kn ko mq kq kr ks mr ku kv kw ms ky kz la ij bi translated">[1]m . e . Mann、r . s . Bradley 和 m . k . Hughes(1999 年)。<a class="ae lb" href="https://agupubs.onlinelibrary.wiley.com/doi/10.1029/1999GL900070" rel="noopener ugc nofollow" target="_blank">过去一千年北半球的温度:推论、不确定性和局限性。</a> <em class="mt">地球物理研究快报</em>，<em class="mt"> 26 </em> (6)，759–762。</p></div></div>    
</body>
</html>