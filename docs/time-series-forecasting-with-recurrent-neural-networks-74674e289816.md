# 使用 LSTM 预测序列数据:简介

> 原文：<https://towardsdatascience.com/time-series-forecasting-with-recurrent-neural-networks-74674e289816?source=collection_archive---------1----------------------->

使用长短期记忆(LSTM)网络预测股票等序列数据的未来。

![](img/7b74e4de1d952085cb88c0d40b5c02a0.png)

Photo by [Chris Liverani](https://unsplash.com/@chrisliverani?utm_source=medium&utm_medium=referral) on [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral)

预测是使用当前和以前的数据预测未来的过程。主要的挑战是理解数据序列中的模式，然后使用这种模式来分析未来。如果我们手工编码这些模式，那么对于下一个数据来说，这将是乏味的和变化的。深度学习已被证明在理解结构化和非结构化数据中的模式方面更好。

为了理解一长串数据中的模式，我们需要网络来分析时间上的模式。递归网络通常用于学习这种数据。他们能够理解长期和短期的依赖性或时间差异。

好了，不介绍了…

这篇文章将向你展示如何在 **Keras** 中使用 LSTM 网络和一些很酷的可视化工具来实现一个预测模型。我们将使用来自[雅虎财经](https://finance.yahoo.com/quote/GOOG?p=GOOG)的谷歌股价，但你可以随意使用任何你喜欢的股票数据。

# 履行

我已经使用 [colab](https://colab.research.google.com) 来实现这个代码，以使可视化更容易，你可以使用你喜欢的方法。我们将从导入必要的库开始:

下载完您的。csv 文件，使用 pandas 加载数据。

dataframe 的信息显示如下:

```
<class 'pandas.core.frame.DataFrame'>
RangeIndex: 3797 entries, 0 to 3796
Data columns (total 7 columns):
Date         3797 non-null object
Open         3797 non-null float64
High         3797 non-null float64
Low          3797 non-null float64
Close        3797 non-null float64
Adj Close    3797 non-null float64
Volume       3797 non-null int64
dtypes: float64(5), int64(1), object(1)
memory usage: 207.7+ KB
```

对于本教程，我们只需要 Date 和 Close 列，其他的都可以删除。

在我们进行训练和预测之前，让我们看看数据是什么样子的。对于所有的可视化，我使用的是 [Plotly](https://plot.ly/) python 库。为什么是 Plotly？…因为它是最好的图形库，可以生成一些好看的图形。

使用 plotly，我们可以定义一个轨迹和布局，它可以做任何其他事情。

图表从 2018 年开始振荡，序列并不平滑…继续前进。

## 数据预处理

对于我们的分析，让我们在前 80%的数据上训练模型，并在剩余的 20%上测试它。

在我们进行培训之前，我们需要对我们的数据进行一些重大修改。记住，我们的数据仍然是一个序列..一列数字。神经网络被训练为监督模型。因此，我们需要将序列数据转换成监督数据😱。

我来解释一下，训练任何机器学习模型的神经网络都需要数据是{ <*特征* >，< *目标* > }格式。同样，我们需要将给定的数据转换成这种格式。这里，我们引入一个回望的概念。

> 回顾只不过是使用前几天的数据来预测第二天的值。比如我们说回望是 2；所以为了预测明天的股价，我们需要今天和昨天的股价。

回到格式，在给定的一天*x(t)*,*特征*是 *x(t-1)，x(t-2)，…。，x(t-n)* 其中 n 为回看。

所以如果我们的数据是这样的，

```
[2, 3, 4, 5, 4, 6, 7, 6, 8, 9]
```

所需的数据格式(n=3)如下:

```
[2, 3, 4] -> [5]
[3, 4, 5] -> [4]
[4, 5, 4] -> [6]
[5, 4, 6] -> [7]
[4, 6, 7] -> [6]
[6, 7, 6] -> [8]
[7, 6, 8] -> [9]
```

咳😓。

幸运的是，Keras 中有一个模块可以做到这一点: [TimeseriesGenerator](https://keras.io/preprocessing/sequence/) 。请查阅文档以获取更多信息。

我已经将 look_back 设置为 15，但是您可以随意使用这个值。

## 神经网络

现在我们的数据已经准备好了，我们可以继续创建和训练我们的网络。

使用 Adam 优化器和均方损失函数训练 25 个时期的 LSTM 单元的简单架构。注意，我们没有使用 model.fit()，而是使用 model.fit_generator()，因为我们已经创建了一个数据生成器。

想了解更多关于 LSTM 网络的信息，请看这篇令人敬畏的[博文](https://colah.github.io/posts/2015-08-Understanding-LSTMs/)。

## 预言；预测；预告

现在我们已经完成了培训，让我们看看网络是否运行良好。我们可以在测试数据上测试模型，看看预测值和实际值是否重叠。

我们可以画出预测值和实际值之间的损失，而不是计算它们。

从图表中，我们可以看到预测值和实际值(地面实况)有些重叠。但如果放大看，拟合并不完美。我们应该预料到这一点，因为这是不可避免的，因为我们正在进行预测。

## 预测

我们的测试表明这个模型还不错。所以我们可以继续预测未来。

> 伏笔:因为我们试图预测未来，所以预测中会有很大的不确定性。

预测未来很容易…要预测明天的价值，将过去 *n* (回望)天的价值输入模型，我们就可以得到明天的价值作为输出。要获得后天的值，需要输入过去 n-1 天的值，以及明天的值和后天的模型输出。

更长时间的预测是不可行的。所以，让我们预测一个月的股票价格。

现在描绘未来的价值，

预测未来很容易…是吗？

在预测未来时，很有可能模型输出在很大程度上是不确定的。模型的输出作为输入反馈给它。这导致模型的噪音和不确定性被重复和放大。

但是，我们还是创建了一个模型，它给出了图表的趋势，以及未来可能的取值范围。

# 结论

通过这个模型，我们创建了一个能够在一定程度上进行预测的基本模型。尽管这个模型并不完美，但我们有一个能很好地逼近过去数据的模型。但是对于新数据，我们需要更多的参数调整。

如果在模型训练期间存在任何问题，请尝试调整这些参数:

*   *回望 _ 回顾*
*   *批量*
*   *LSTM 台*
*   *次数*

您还可以通过堆叠 LSTM 图层来增强架构。

谢谢大家！！😁