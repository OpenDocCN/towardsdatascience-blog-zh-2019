<html>
<head>
<title>Setting up GitHub Package Registry with Docker and Golang</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 Docker 和 Golang 设置 GitHub 包注册表</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/setting-up-github-package-registry-with-docker-and-golang-7a75a2533139?source=collection_archive---------15-----------------------#2019-10-05">https://towardsdatascience.com/setting-up-github-package-registry-with-docker-and-golang-7a75a2533139?source=collection_archive---------15-----------------------#2019-10-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="d7cd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="ko">注:此文最初发布于</em><a class="ae kp" href="https://martinheinz.dev/blog/6" rel="noopener ugc nofollow" target="_blank"><em class="ko">martinheinz . dev</em></a></p><p id="db88" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">通常，对于任何编程语言，要运行您的应用程序，您都需要创建某种包(<code class="fe kq kr ks kt b">npm</code>表示<em class="ko"> JavaScript </em>，<code class="fe kq kr ks kt b">NuGet</code>表示<em class="ko"> C# </em>，...)然后存放在某个地方。在<em class="ko"> Docker </em>的情况下，人们通常只是将他们的图像扔进<em class="ko"> Docker Hub </em>中，但是我们现在有了新的选择...</p><p id="7f33" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">另一个选择是<em class="ko">GitHub Package Registry</em>——它已经测试了一段时间，似乎越来越多的人开始使用它，所以感觉是时候探索它的功能了，这里专门针对<em class="ko"> Docker </em>和<em class="ko"> Go </em>项目。</p><p id="61e0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这篇文章是系列文章<em class="ko">“你的下一个 Golang 项目所需要的一切”</em>的一部分，如果这听起来很有趣，请点击这里查看上一部分<a class="ae kp" href="https://gist.github.com/MartinHeinz/134729d0d26ca88b5afb23961759de6e" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="549e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="ko">注意:本文适用于任何使用 docker 图像的项目，而不仅仅是 Golang。</em></p><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi ku"><img src="../Images/85106e33384b61a5b12587815be32d8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-Wpfv7kBoBBCb94EWKm8AQ.png"/></div></div></figure><h1 id="11e7" class="lg lh it bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">为什么使用 GitHub 注册表</h1><p id="8cc1" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn im bi translated">首先，你为什么要考虑从，比方说，<em class="ko"> Docker Hub </em>或任何其他注册表，切换到<em class="ko"> GitHub 包注册表</em>:</p><ul class=""><li id="473b" class="mj mk it js b jt ju jx jy kb ml kf mm kj mn kn mo mp mq mr bi translated">如果你已经在使用<em class="ko"> GitHub </em>作为你的 SCM，那么使用<em class="ko"> GitHub Package Registry </em>是有意义的，因为它允许你把所有东西放在一个地方，而不是把你的包推到别处。</li><li id="bc77" class="mj mk it js b jt ms jx mt kb mu kf mv kj mw kn mo mp mq mr bi translated"><em class="ko"> GitHub </em> — <em class="ko">动作</em>还有另一个闪亮的新(<em class="ko"> beta </em>)特性，你可以结合<em class="ko"> GitHub 包注册表</em>来利用它(在另一个帖子中有更多关于这个的内容……)。</li><li id="b205" class="mj mk it js b jt ms jx mt kb mu kf mv kj mw kn mo mp mq mr bi translated">即使我认为<em class="ko"> Docker </em>图像优于例如<code class="fe kq kr ks kt b">npm</code>包，如果你更喜欢<em class="ko">非 Docker </em>工件，你也可以将它们推送到<em class="ko"> GitHub 包注册表</em>。</li></ul><h1 id="4c06" class="lg lh it bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">我们开始吧！</h1><p id="55eb" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn im bi translated">那么，现在，让我们来看看如何使用它。让我们从构建和标记您的图像开始:</p><p id="4e2d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="ko">注意:如果你正在使用 Go，那么你可能想在这里查看</em> <a class="ae kp" href="https://github.com/MartinHeinz/go-project-blueprint" rel="noopener ugc nofollow" target="_blank"> <em class="ko">我的库</em> </a> <em class="ko">，这里所有的 GitHub 包注册表功能都已经绑定到 Makefile 目标中。</em></p><figure class="kv kw kx ky gt kz"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="84ae" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为了能够将图像推送到<em class="ko"> GitHub 包注册表</em>，您需要使用上面显示的格式来命名它——这实际上只是带有您的<em class="ko"> GitHub </em>用户名和存储库名称的注册表的 URL。</p><p id="ccda" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">接下来，我们如何访问它？</p><p id="d115" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">首先，为了能够用<em class="ko"> GitHub 包注册表</em>认证我们自己，我们需要创建个人访问令牌。这个访问令牌必须有<code class="fe kq kr ks kt b">read:packages</code>和<code class="fe kq kr ks kt b">write:packages</code>作用域，此外，如果您有一个私有存储库，您还必须包括<code class="fe kq kr ks kt b">repo</code>作用域。</p><p id="0516" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在<em class="ko"> GitHub </em>帮助网站上已经有非常好的关于如何创建个人令牌的指南，所以我不打算在这里复制和粘贴步骤。你可以在这里阅读<a class="ae kp" href="https://help.github.com/en/articles/creating-a-personal-access-token-for-the-command-line" rel="noopener ugc nofollow" target="_blank"/></p><p id="7ccc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，我们有了个人令牌，让我们登录:</p><figure class="kv kw kx ky gt kz"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="3c99" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最后，是时候推广我们的形象了:</p><figure class="kv kw kx ky gt kz"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="366c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">很明显，你也可以把图像拉出来:</p><figure class="kv kw kx ky gt kz"><div class="bz fp l di"><div class="mx my l"/></div></figure><h1 id="bd49" class="lg lh it bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">在 CI/CD 渠道中使用它</h1><p id="2e5c" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn im bi translated">对于 GitHub 包注册表，我们最不想做的事情就是将它与 CI/CD 工具集成在一起。我们来看看如何用<em class="ko"> Travis </em>来完成(<em class="ko">全</em> <code class="fe kq kr ks kt b"><em class="ko">.travis.yml</em></code> <em class="ko">可在我的资源库</em> <a class="ae kp" href="https://github.com/MartinHeinz/go-project-blueprint/blob/master/.travis.yml" rel="noopener ugc nofollow" target="_blank"> <em class="ko">这里</em> </a>):</p><figure class="kv kw kx ky gt kz"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="1895" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">正如你在上面看到的，你可以像在你的机器上一样运行<code class="fe kq kr ks kt b">build</code>和<code class="fe kq kr ks kt b">push</code>，唯一的区别是<code class="fe kq kr ks kt b">docker login</code>。这里，我们使用在<em class="ko"> Travis </em> UI 中指定的环境变量。用户名通过<code class="fe kq kr ks kt b">-u</code>参数传递给登录命令，密码使用<code class="fe kq kr ks kt b">echo</code>传递给<code class="fe kq kr ks kt b">stdin</code>，这是必需的，这样我们就不会在<em class="ko"> Travis </em>日志中打印出我们个人的<em class="ko"> GitHub </em>令牌。</p><p id="1537" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">那么，我们如何设置这些环境变量呢？这些是步骤:</p><ul class=""><li id="7778" class="mj mk it js b jt ju jx jy kb ml kf mm kj mn kn mo mp mq mr bi translated">导航到存储库的<em class="ko"> Travis </em>作业设置，例如<a class="ae kp" href="https://travis-ci.com/MartinHeinz/go-project-blueprint/settings" rel="noopener ugc nofollow" target="_blank">https://Travis-ci . com/Martin Heinz/go-project-blue print/settings</a></li><li id="8bb1" class="mj mk it js b jt ms jx mt kb mu kf mv kj mw kn mo mp mq mr bi translated">向下滚动到<em class="ko">环境变量</em>部分</li><li id="c4db" class="mj mk it js b jt ms jx mt kb mu kf mv kj mw kn mo mp mq mr bi translated">将变量名分别设置为<code class="fe kq kr ks kt b">DOCKER_USERNAME</code>和<code class="fe kq kr ks kt b">DOCKER_PASSWORD</code>。在密码(<em class="ko"> GitHub </em>令牌)情况下，确保构建日志中的<em class="ko">显示值设置为假。</em></li><li id="142e" class="mj mk it js b jt ms jx mt kb mu kf mv kj mw kn mo mp mq mr bi translated">点击<em class="ko">添加</em>并触发构建</li></ul><p id="f998" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你没有使用<em class="ko"> Travis </em>并且想要使用<em class="ko"> GitHub Webhook </em>来触发构建，那么你可以使用<code class="fe kq kr ks kt b"><a class="ae kp" href="https://developer.github.com/v3/activity/events/types/#registrypackageevent" rel="noopener ugc nofollow" target="_blank">RegistryPackageEvent</a></code>。如果您正在使用<em class="ko"> Jenkins </em>、<em class="ko"> OpenShift </em>或<em class="ko"> Kubernetes </em>，并且希望每次在<em class="ko"> GitHub Package Registry </em>中发布或更新您的包时触发部署，这可能会很有用。</p><h1 id="daee" class="lg lh it bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">告诫的话</h1><p id="e1eb" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn im bi translated">使用<em class="ko"> GitHub 包注册表</em>时，你要记住的一件事是，你不能删除你推送到注册表的包。这样你就不会破坏依赖于你的包的项目。你可以从<em class="ko"> GitHub Support </em>请求删除包，但是你不应该指望他们真的删除任何东西。</p><h1 id="455c" class="lg lh it bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">结论</h1><p id="03e7" class="pw-post-body-paragraph jq jr it js b jt me jv jw jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn im bi translated">希望看完这个你给<em class="ko"> GitHub 包注册表</em>打个预防针。如果你还没有<em class="ko"> beta </em>权限，可以在这里注册<a class="ae kp" href="https://github.com/features/package-registry/signup" rel="noopener ugc nofollow" target="_blank">。如果你有任何问题，不要犹豫，联系我，或者你也可以看看我的</a><a class="ae kp" href="https://github.com/MartinHeinz/go-project-blueprint" rel="noopener ugc nofollow" target="_blank">库</a>，在那里你可以找到<em class="ko"> GitHub 包注册表</em>用法的例子。</p><h1 id="da10" class="lg lh it bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">资源</h1><ul class=""><li id="1fab" class="mj mk it js b jt me jx mf kb mz kf na kj nb kn mo mp mq mr bi translated"><a class="ae kp" href="https://github.com/features/package-registry" rel="noopener ugc nofollow" target="_blank">https://github.com/features/package-registry</a></li><li id="6d83" class="mj mk it js b jt ms jx mt kb mu kf mv kj mw kn mo mp mq mr bi translated"><a class="ae kp" href="https://help.github.com/en/articles/about-github-package-registry" rel="noopener ugc nofollow" target="_blank">https://help . github . com/en/articles/about-github-package-registry</a></li></ul></div></div>    
</body>
</html>