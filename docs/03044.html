<html>
<head>
<title>Data cleaning in Python: examples from cleaning Airbnb data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python 中的数据清理:Airbnb 数据清理示例</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/predicting-airbnb-prices-with-deep-learning-part-1-how-to-clean-up-airbnb-data-a5d58e299f6c?source=collection_archive---------14-----------------------#2019-05-16">https://towardsdatascience.com/predicting-airbnb-prices-with-deep-learning-part-1-how-to-clean-up-airbnb-data-a5d58e299f6c?source=collection_archive---------14-----------------------#2019-05-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c1f0" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">Python 中如何处理杂乱的位置和文本数据</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/eddb8f68b23e0a7071090772042d1fb8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*1s0p0nQiz5xzfLQy.jpg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Source: airbnbeazy.com</figcaption></figure><h1 id="e7a6" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">项目背景</h1><p id="1e06" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">Airbnb 让我着迷。我之前在一家 Airbnb 物业管理公司工作了一年半，担任负责定价、收入和分析的团队主管。我发现特别有趣的一件事是如何计算出网站上的一个列表的价格。尽管“这是曼彻斯特的一套两居室”会让你走得相当远，但实际上有很多因素可以影响房源的价格。</p><p id="df6b" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">作为利用深度学习预测 Airbnb 价格的更大项目的一部分，我发现自己被抛回了房地产数据的黑暗世界。地理空间数据可能非常复杂和混乱，用户输入的地理空间数据更是如此。这篇文章将解释我是如何为我的项目寻找和准备数据的，包括一些关于处理英国地理数据(它出奇的复杂)和从长文本字符串中提取相关信息的想法。</p><h1 id="f20f" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">数据集</h1><p id="2e29" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">这个项目使用的数据集来自<a class="ae mr" href="https://insideairbnb.com/" rel="noopener ugc nofollow" target="_blank">Insideairbnb.com</a>，这是一个反 Airbnb 的游说团体，从全球多个城市搜集 Airbnb 房源、评论和日历数据。该数据集是在 2019 年 4 月 9 日抓取的，包含了当天该网站上所有伦敦 Airbnb 房源的信息(约 80，000)。</p><h1 id="213c" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">清理和准备数据</h1><p id="0512" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">关于数据清理的全部令人兴奋的细节(披露:兴奋程度可能有所不同)，请随时查看我的<a class="ae mr" href="https://github.com/L-Lewis/Airbnb-neural-network-price-prediction" rel="noopener ugc nofollow" target="_blank"> GitHub repo </a>。为了简洁起见，我将讨论可能感兴趣的数据预处理的三个特定领域。</p><h2 id="5073" class="ms kz it bd la mt mu dn le mv mw dp li lz mx my lk md mz na lm mh nb nc lo nd bi translated">未包含的功能(但我希望包含)</h2><p id="55df" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">原始数据集包含 106 个要素，包括许多不同描述字段的文本列，您可以在 Airbnb 列表中填写这些字段。由于时间限制，我没有在这个模型中做任何自然语言处理(NLP ),所以所有这些功能都被删除了。然而，该模型未来发展的一个有趣途径是用 NLP 来增强它——可能用于情感分析，或寻找关键词，或某种奇特的 Word2Vec 类型的情况，寻找相似的列表描述，并使用它来帮助根据相似的列表猜测价格。</p><p id="3427" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">未来工作的另一个潜在方向可能包括审查。Insideairbnb.com 还抓取评论，这些评论可以与带有列表 id 的列表匹配。虽然大多数客人倾向于给大多数列表高评级，但更多细微的评级可能来自评论本身。</p><h2 id="5510" class="ms kz it bd la mt mu dn le mv mw dp li lz mx my lk md mz na lm mh nb nc lo nd bi translated">处理伦敦的地理信息(TLDR:伦敦的地图没有考虑到数据科学家)</h2><p id="5e30" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">英国的邮政编码复杂而混乱。它们可以有不同的长度，由字母和数字以不同的顺序组成。邮政编码的前半部分称为输出码或邮政编码区，指的是如下所示的区域:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ne"><img src="../Images/71b7879f244bf20f49a202337a35e322.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pBw3nnNrDL_hlbBT1Z3n5g.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">London postcode districts. Source: <a class="ae mr" href="https://en.wikipedia.org/wiki/London_postal_district" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/London_postal_district</a></figcaption></figure><p id="0a03" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">让事情变得更复杂的是，伦敦的主要地理分区是 32 个区加上伦敦金融城(由于 12 世纪英国历史的一些怪癖，严格来说是一个公司而不是一个区)，这与邮政编码区不一致(因为这太容易了，对吗？):</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/6c4f770cb98003b7d29e3c6a24e4140a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1122/format:webp/1*wPkuO-TX-EGaNj7LPuyvCQ.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">London postcode districts (red), layered over London boroughs (black lines). Source: <a class="ae mr" href="https://en.wikipedia.org/wiki/London_postal_district" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/London_postal_district</a></figcaption></figure><p id="51f8" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">也没有什么简单的方法可以在更小的粒度上对伦敦地区进行分类。事实上，对于什么是“内伦敦”，人们甚至还没有达成一致:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/0d5e985ab779da3007a6bba832219c52.png" data-original-src="https://miro.medium.com/v2/resize:fit:584/format:webp/1*iRJw5CDOVV013nn4vxWf-w.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">What even is London? Source: <a class="ae mr" href="https://en.wikipedia.org/wiki/Inner_London" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/Inner_London</a></figcaption></figure><p id="c843" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">更糟糕的是，Airbnb 允许主机在自由文本输入框中输入邮政编码，排除了邮政编码部分的任何简单分离，并允许主机写各种无意义的内容(我最喜欢的只是“不”这个词)。</p><p id="e1ac" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">最后，在抛弃了一堆关于邮政编码的正则表达式实验之后，我决定使用行政区作为地理单位。位置对于 Airbnb 房源来说非常重要，所以我对不得不使用 borough 并不十分满意。它不是在一个特别精细的层次上，也不总是能很好地表达一处房产是在伦敦市中心还是在偏远地区——这对价格有很大的影响。例如，著名的夏德摩天大楼在南华克，但杜尔威治也是如此，地铁甚至没有到达那里(免责声明:杜尔威治其实很可爱，但可能不太为伦敦的游客所知)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nh"><img src="../Images/4bb2d3eee73a3a4ddb7d89efaf43b8ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sFTjng7iEGsgAzE8_1fLbw.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Both in Southwark, but possibly with different Airbnb prices? Left: the Shard (source: <a class="ae mr" href="https://www.visitbritainshop.com/world/the-view-from-the-shard/" rel="noopener ugc nofollow" target="_blank">https://www.visitbritainshop.com/world/the-view-from-the-shard/</a>). Right: Dulwich high street (source: <a class="ae mr" href="https://de.wikipedia.org/wiki/Dulwich_(London)" rel="noopener ugc nofollow" target="_blank">https://de.wikipedia.org/wiki/Dulwich_(London)</a>).</figcaption></figure><p id="4754" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">为了获得更精细的结果，我也尝试使用纬度和经度而不是行政区——但正如未来的博客文章所显示的，这并不完全成功。</p><h2 id="8304" class="ms kz it bd la mt mu dn le mv mw dp li lz mx my lk md mz na lm mh nb nc lo nd bi translated">便利设施(如此多的便利设施)</h2><p id="26aa" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">在 Insiderairbnb.com 的数据集中，设施被存储为一大块文本，下面是一个例子:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/fad89efc5828f0cfb842cf754547856f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N2a7A8ZBphEZ2EIZLxCYzQ.png"/></div></div></figure><p id="2849" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">为了弄清楚各种选项是什么以及哪些列表包含这些选项，我首先制作了一个包含所有便利设施值的巨大字符串，稍微整理了一下，用逗号分隔出各个便利设施，并创建了一组结果列表(幸运的是，数据集足够小，允许这样做，但我需要一种更有效的方法来处理更大的数据集):</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="a4a1" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">这里列出了所有可能拥有的便利设施:</p><pre class="kj kk kl km gt nl nm nn no aw np bi"><span id="c1dd" class="ms kz it nm b gy nq nr l ns nt"> '24-hour check-in',<br/> 'Accessible-height bed',<br/> 'Accessible-height toilet',<br/> 'Air conditioning',<br/> 'Air purifier',<br/> 'Alfresco bathtub',<br/> 'Amazon Echo',<br/> 'Apple TV',<br/> 'BBQ grill',<br/> 'Baby bath',<br/> 'Baby monitor',<br/> 'Babysitter recommendations',<br/> 'Balcony',<br/> 'Bath towel',<br/> 'Bathroom essentials',<br/> 'Bathtub',<br/> 'Bathtub with bath chair',<br/> 'Beach essentials',<br/> 'Beach view',<br/> 'Beachfront',<br/> 'Bed linens',<br/> 'Bedroom comforts',<br/> 'Bidet',<br/> 'Body soap',<br/> 'Breakfast',<br/> 'Breakfast bar',<br/> 'Breakfast table',<br/> 'Building staff',<br/> 'Buzzer/wireless intercom',<br/> 'Cable TV',<br/> 'Carbon monoxide detector',<br/> 'Cat(s)',<br/> 'Ceiling fan',<br/> 'Ceiling hoist',<br/> 'Central air conditioning',<br/> 'Changing table',<br/> "Chef's kitchen",<br/> 'Children’s books and toys',<br/> 'Children’s dinnerware',<br/> 'Cleaning before checkout',<br/> 'Coffee maker',<br/> 'Convection oven',<br/> 'Cooking basics',<br/> 'Crib',<br/> 'DVD player',<br/> 'Day bed',<br/> 'Dining area',<br/> 'Disabled parking spot',<br/> 'Dishes and silverware',<br/> 'Dishwasher',<br/> 'Dog(s)',<br/> 'Doorman',<br/> 'Double oven',<br/> 'Dryer',<br/> 'EV charger',<br/> 'Electric profiling bed',<br/> 'Elevator',<br/> 'En suite bathroom',<br/> 'Espresso machine',<br/> 'Essentials',<br/> 'Ethernet connection',<br/> 'Exercise equipment',<br/> 'Extra pillows and blankets',<br/> 'Family/kid friendly',<br/> 'Fax machine',<br/> 'Fire extinguisher',<br/> 'Fire pit',<br/> 'Fireplace guards',<br/> 'Firm mattress',<br/> 'First aid kit',<br/> 'Fixed grab bars for shower',<br/> 'Fixed grab bars for toilet',<br/> 'Flat path to front door',<br/> 'Formal dining area',<br/> 'Free parking on premises',<br/> 'Free street parking',<br/> 'Full kitchen',<br/> 'Game console',<br/> 'Garden or backyard',<br/> 'Gas oven',<br/> 'Ground floor access',<br/> 'Gym',<br/> 'HBO GO',<br/> 'Hair dryer',<br/> 'Hammock',<br/> 'Handheld shower head',<br/> 'Hangers',<br/> 'Heat lamps',<br/> 'Heated floors',<br/> 'Heated towel rack',<br/> 'Heating',<br/> 'High chair',<br/> 'High-resolution computer monitor',<br/> 'Host greets you',<br/> 'Hot tub',<br/> 'Hot water',<br/> 'Hot water kettle',<br/> 'Indoor fireplace',<br/> 'Internet',<br/> 'Iron',<br/> 'Ironing Board',<br/> 'Jetted tub',<br/> 'Keypad',<br/> 'Kitchen',<br/> 'Kitchenette',<br/> 'Lake access',<br/> 'Laptop friendly workspace',<br/> 'Lock on bedroom door',<br/> 'Lockbox',<br/> 'Long term stays allowed',<br/> 'Luggage dropoff allowed',<br/> 'Memory foam mattress',<br/> 'Microwave',<br/> 'Mini fridge',<br/> 'Mobile hoist',<br/> 'Mountain view',<br/> 'Mudroom',<br/> 'Murphy bed',<br/> 'Netflix',<br/> 'Office',<br/> 'Other',<br/> 'Other pet(s)',<br/> 'Outdoor kitchen',<br/> 'Outdoor parking',<br/> 'Outdoor seating',<br/> 'Outlet covers',<br/> 'Oven',<br/> 'Pack ’n Play/travel crib',<br/> 'Paid parking off premises',<br/> 'Paid parking on premises',<br/> 'Patio or balcony',<br/> 'Pets allowed',<br/> 'Pets live on this property',<br/> 'Pillow-top mattress',<br/> 'Pocket wifi',<br/> 'Pool',<br/> 'Pool cover',<br/> 'Pool with pool hoist',<br/> 'Printer',<br/> 'Private bathroom',<br/> 'Private entrance',<br/> 'Private gym',<br/> 'Private hot tub',<br/> 'Private living room',<br/> 'Private pool',<br/> 'Projector and screen',<br/> 'Propane barbeque',<br/> 'Rain shower',<br/> 'Refrigerator',<br/> 'Roll-in shower',<br/> 'Room-darkening shades',<br/> 'Safe',<br/> 'Safety card',<br/> 'Sauna',<br/> 'Security system',<br/> 'Self check-in',<br/> 'Shampoo',<br/> 'Shared gym',<br/> 'Shared hot tub',<br/> 'Shared pool',<br/> 'Shower chair',<br/> 'Single level home',<br/> 'Ski-in/Ski-out',<br/> 'Smart TV',<br/> 'Smart lock',<br/> 'Smoke detector',<br/> 'Smoking allowed',<br/> 'Soaking tub',<br/> 'Sound system',<br/> 'Stair gates',<br/> 'Stand alone steam shower',<br/> 'Standing valet',<br/> 'Steam oven',<br/> 'Step-free access',<br/> 'Stove',<br/> 'Suitable for events',<br/> 'Sun loungers',<br/> 'TV',<br/> 'Table corner guards',<br/> 'Tennis court',<br/> 'Terrace',<br/> 'Toilet paper',<br/> 'Touchless faucets',<br/> 'Walk-in shower',<br/> 'Warming drawer',<br/> 'Washer',<br/> 'Washer / Dryer',<br/> 'Waterfront',<br/> 'Well-lit path to entrance',<br/> 'Wheelchair accessible',<br/> 'Wide clearance to bed',<br/> 'Wide clearance to shower',<br/> 'Wide doorway',<br/> 'Wide entryway',<br/> 'Wide hallway clearance',<br/> 'Wifi',<br/> 'Window guards',<br/> 'Wine cooler',<br/> 'toilet',</span></pre><p id="131e" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">在上面的列表中，有些设施比其他设施更重要(例如，阳台比传真机更容易涨价)，有些设施可能相当不常见(例如，“电动仿形床”)。基于之前的行业经验，以及对顾客认为哪些设施更重要的进一步研究，我们选择了一些更重要的设施。然后根据数据的稀疏程度从最终模型中选择这些数据。例如，如果事实证明几乎所有的房产都有/没有特定的舒适设施，那么这个特性在区分房源或解释价格差异时就没什么用了。</p><p id="9499" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">关于这一点的复杂代码可以在 GitHub 上找到，但这是最后一部分，我删除了超过 90%的列表中有或没有特定便利设施的列:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="f20b" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">这些是我最终保留下来的便利设施:</p><ul class=""><li id="dad1" class="nu nv it ls b lt mm lw mn lz nw md nx mh ny ml nz oa ob oc bi translated">阳台</li><li id="1715" class="nu nv it ls b lt od lw oe lz of md og mh oh ml nz oa ob oc bi translated">被单和枕套</li><li id="7ddc" class="nu nv it ls b lt od lw oe lz of md og mh oh ml nz oa ob oc bi translated">早餐</li><li id="30d8" class="nu nv it ls b lt od lw oe lz of md og mh oh ml nz oa ob oc bi translated">电视</li><li id="ec4f" class="nu nv it ls b lt od lw oe lz of md og mh oh ml nz oa ob oc bi translated">咖啡机</li><li id="50c8" class="nu nv it ls b lt od lw oe lz of md og mh oh ml nz oa ob oc bi translated">基本烹饪设备</li><li id="3a0b" class="nu nv it ls b lt od lw oe lz of md og mh oh ml nz oa ob oc bi translated">白色家电(特别是洗衣机、烘干机和/或洗碗机)</li><li id="d6fd" class="nu nv it ls b lt od lw oe lz of md og mh oh ml nz oa ob oc bi translated">儿童友好型</li><li id="7e4f" class="nu nv it ls b lt od lw oe lz of md og mh oh ml nz oa ob oc bi translated">停车</li><li id="1756" class="nu nv it ls b lt od lw oe lz of md og mh oh ml nz oa ob oc bi translated">户外空间</li><li id="9f9b" class="nu nv it ls b lt od lw oe lz of md og mh oh ml nz oa ob oc bi translated">受到主人的欢迎</li><li id="86ed" class="nu nv it ls b lt od lw oe lz of md og mh oh ml nz oa ob oc bi translated">互联网</li><li id="11f2" class="nu nv it ls b lt od lw oe lz of md og mh oh ml nz oa ob oc bi translated">允许长期停留</li><li id="6640" class="nu nv it ls b lt od lw oe lz of md og mh oh ml nz oa ob oc bi translated">允许携带宠物</li><li id="46df" class="nu nv it ls b lt od lw oe lz of md og mh oh ml nz oa ob oc bi translated">私人入口</li><li id="5a10" class="nu nv it ls b lt od lw oe lz of md og mh oh ml nz oa ob oc bi translated">安全或安保系统</li><li id="27d1" class="nu nv it ls b lt od lw oe lz of md og mh oh ml nz oa ob oc bi translated">自助入住</li></ul><h1 id="b04e" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">摘要</h1><p id="899b" class="pw-post-body-paragraph lq lr it ls b lt lu ju lv lw lx jx ly lz ma mb mc md me mf mg mh mi mj mk ml im bi translated">在这些(和许多其他)清理和预处理步骤之后，Airbnb 处于合适的形式，可以开始探索和建模，你可以在<a class="ae mr" rel="noopener" target="_blank" href="/predicting-airbnb-prices-with-deep-learning-part-2-how-to-improve-your-nightly-price-50ea8bc2bd29">我的下一篇关于数据探索的文章</a>和我写的另一篇关于<a class="ae mr" href="https://medium.com/@lvlewis8/predicting-airbnb-prices-with-machine-learning-and-deep-learning-f46d44afb8a6" rel="noopener">建立预测模型的文章</a>中了解更多信息。</p></div><div class="ab cl oi oj hx ok" role="separator"><span class="ol bw bk om on oo"/><span class="ol bw bk om on oo"/><span class="ol bw bk om on"/></div><div class="im in io ip iq"><p id="c12d" class="pw-post-body-paragraph lq lr it ls b lt mm ju lv lw mn jx ly lz mo mb mc md mp mf mg mh mq mj mk ml im bi translated">如果你觉得这篇文章有趣或有帮助，请通过鼓掌和/或评论的方式让我知道，你可以关注我，以便在未来的文章中得到通知。感谢阅读！</p></div></div>    
</body>
</html>