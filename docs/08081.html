<html>
<head>
<title>Docker Made Easy for Data Scientists</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Docker 让数据科学家变得简单</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/docker-made-easy-for-data-scientists-b32efbc23165?source=collection_archive---------4-----------------------#2019-11-06">https://towardsdatascience.com/docker-made-easy-for-data-scientists-b32efbc23165?source=collection_archive---------4-----------------------#2019-11-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="b36e" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用 Docker 的机器学习模型部署中的动手学习，并提供各种示例。</h2></div><blockquote class="kf"><p id="9292" class="kg kh iq bd ki kj kk kl km kn ko kp dk translated">"谷歌在容器中运行所有软件，他们每周运行大约 20 亿个容器."</p></blockquote><figure class="kr ks kt ku kv kw gh gi paragraph-image"><div class="gh gi kq"><img src="../Images/d898747661747ed62235c66de7bd2e70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1276/0*SHM1Y3g1sDCxozaB"/></div><figcaption class="kz la gj gh gi lb lc bd b be z dk"><a class="ae ld" href="https://image.slidesharecdn.com/googlecloudplatform-kubernetesvotreassurance-viepourlecloudpariscontainerday2016-160706123026/95/paris-container-day-2016-kubernetes-votre-assurancevie-pour-le-cloud-google-cloud-platform-9-638.jpg?cb=1467808596" rel="noopener ugc nofollow" target="_blank">source</a></figcaption></figure><p id="1b17" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly kp ij bi translated">在继续之前，你应该想到的第一个问题是为什么我需要 docker，更重要的是它是什么？</p><p id="96b9" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly kp ij bi translated">那么，Docker 是什么？Docker 是一组平台服务产品，使用操作系统级虚拟化来交付称为容器的软件包中的软件。Docker 的巨大优势在于它使您的部署变得简单，到时候您甚至可以毫不费力地在多台机器上部署它。</p><p id="9e4d" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly kp ij bi translated">您还可以将 Docker 与 Kubernetes 一起使用，Kubernetes 可以通过在不同的 Docker 容器之间分配工作来自动处理工作负载。除此之外，它还负责处理任何 Docker 容器是否离线，并自动重启它以及其他许多事情。</p><p id="d25d" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly kp ij bi translated">在这里，我们将使用 Docker 构建各种 flask 应用程序。</p><ol class=""><li id="391e" class="lz ma iq lg b lh li lk ll ln mb lr mc lv md kp me mf mg mh bi translated">使用 Flask 的简单 Hello World 应用程序</li><li id="679f" class="lz ma iq lg b lh mi lk mj ln mk lr ml lv mm kp me mf mg mh bi translated">在 Docker 容器中传递参数</li><li id="8bef" class="lz ma iq lg b lh mi lk mj ln mk lr ml lv mm kp me mf mg mh bi translated">Docker 容器中的简单 ML 应用程序</li><li id="5234" class="lz ma iq lg b lh mi lk mj ln mk lr ml lv mm kp me mf mg mh bi translated">在 Docker 容器中将图像作为参数传递</li></ol><h1 id="1765" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated"><strong class="ak">安装</strong></h1><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="554f" class="no mo iq nk b gy np nq l nr ns">$ sudo apt update<br/>$ <!-- -->sudo apt install docker.io</span></pre><p id="8088" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly kp ij bi translated">这将安装 docker。现在，要检查 docker 是否正在运行，请键入</p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="b285" class="no mo iq nk b gy np nq l nr ns">$ sudo service docker status</span></pre><p id="fca6" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly kp ij bi translated">如果在活动模式下没有看到 docker，请键入</p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="e413" class="no mo iq nk b gy np nq l nr ns">$ sudo service docker start</span></pre><h1 id="a26b" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">基本术语</h1><ol class=""><li id="80e3" class="lz ma iq lg b lh nt lk nu ln nv lr nw lv nx kp me mf mg mh bi translated"><strong class="lg ir"> Docker 镜像</strong>——简单来说，Docker 镜像就像一个用来安装任何操作系统的 ISO 镜像文件。您可以查看所有 docker 图片(在<a class="ae ld" href="https://hub.docker.com/search?q=&amp;type=image" rel="noopener ugc nofollow" target="_blank"> DockerHub </a>上公开)</li><li id="c308" class="lz ma iq lg b lh mi lk mj ln mk lr ml lv mm kp me mf mg mh bi translated"><strong class="lg ir"> Docker 容器</strong> —当 Docker 映像运行时，它成为 Docker 容器。您可以再次运行相同的映像，将会创建一个不同的 docker 容器。</li><li id="3f89" class="lz ma iq lg b lh mi lk mj ln mk lr ml lv mm kp me mf mg mh bi translated"><strong class="lg ir">docker file</strong>—docker file 包含设置 docker 容器的所有代码，从下载 docker 映像到设置环境。</li></ol><p id="1177" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly kp ij bi translated">我把 GitHub 的链接放在了底部，那里有所有的代码。Docker 在你理解了它的流程之后，是非常容易学习的。</p><h1 id="bbb5" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">示例 1:简单的烧瓶应用程序</h1><p id="fa61" class="pw-post-body-paragraph le lf iq lg b lh nt jr lj lk nu ju lm ln ny lp lq lr nz lt lu lv oa lx ly kp ij bi translated">这是一个非常简单的应用程序，可以在浏览器屏幕上显示“hello world”。</p><p id="d31a" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly kp ij bi translated">让我们构建 flask 应用程序</p><figure class="nf ng nh ni gt kw"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="79dc" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly kp ij bi translated">此外，通过以下方式创建 requirements.txt 文件</p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="4220" class="no mo iq nk b gy np nq l nr ns">$ pip3 list &gt; requirements.txt</span></pre><p id="c986" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly kp ij bi translated">制作 flask 应用程序时需要记住的几件事是，主机应该设置为“0.0.0.0 ”,因为我们是在 Docker 内部运行它。</p><p id="7c2e" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly kp ij bi translated">让我们构建 docker 文件</p><ol class=""><li id="69f1" class="lz ma iq lg b lh li lk ll ln mb lr mc lv md kp me mf mg mh bi translated">用下面的命令，我们正在拉 ubuntu 图像。它还包含一个标签，我们可以用它来指定版本。这里，我们正在拉“最新”的图像。</li></ol><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="15a4" class="no mo iq nk b gy np nq l nr ns">FROM ubuntu:latest</span></pre><p id="1cad" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly kp ij bi translated">2.现在，假设您刚刚安装了 Linux 操作系统，您要做的第一件事就是更新包含软件包信息的本地数据库。还添加了一个'-y '标志，以确保它不需要任何用户输入。</p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="c8dc" class="no mo iq nk b gy np nq l nr ns">RUN sudo apt update -y </span></pre><p id="1e2a" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly kp ij bi translated">3.下一个任务是安装 python。因为我们只使用一个应用程序，所以不需要设置虚拟环境。</p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="9fc8" class="no mo iq nk b gy np nq l nr ns">RUN apt install -y python3-pip</span></pre><p id="0757" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly kp ij bi translated">4.下一个任务是将目录中的所有文件复制到 docker 映像中。</p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="3bf6" class="no mo iq nk b gy np nq l nr ns">COPY . /app</span></pre><p id="34ce" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly kp ij bi translated">在哪里？是当前目录，而'/app '是我们希望复制文件的位置。你可以选择任何你喜欢的文件夹。</p><p id="4986" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly kp ij bi translated">5.将工作目录设置为/app。</p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="06aa" class="no mo iq nk b gy np nq l nr ns">WORKDIR /app</span></pre><p id="377e" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly kp ij bi translated">6.我们已经调出了 ubuntu 映像，安装了 python，复制了所有数据。下一步是通过安装所有必需的包来设置 python 环境。我们已经创建了 requirements.txt 文件。现在，我们只需要安装它。</p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="1cfd" class="no mo iq nk b gy np nq l nr ns">RUN pip3 install -r requirements.txt</span></pre><p id="9551" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly kp ij bi translated">7.现在，将入口点设置为“python3”。</p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="408e" class="no mo iq nk b gy np nq l nr ns">ENTRYPOINT ['python3']</span></pre><p id="de4e" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly kp ij bi translated">8.最后，运行 app.py 文件</p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="7cd1" class="no mo iq nk b gy np nq l nr ns">CMD ['app.py']</span></pre><p id="468a" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly kp ij bi translated">最终的文件将如下所示。</p><figure class="nf ng nh ni gt kw"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="61d5" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly kp ij bi translated">该文件将被保存为不带扩展名的 Dockerfile。</p><p id="e586" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly kp ij bi translated">最终的目录结构将如下所示</p><figure class="nf ng nh ni gt kw gh gi paragraph-image"><div class="gh gi od"><img src="../Images/471af310819a22805fdd5fe156814bb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:344/format:webp/1*qLcJAQpNAwYrdapqvCd63g.png"/></div></figure><p id="b0d5" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly kp ij bi translated">最后，通过以下方式构建 docker 文件</p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="913b" class="no mo iq nk b gy np nq l nr ns">$ docker build -t simpleflask .</span></pre><p id="d695" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly kp ij bi translated">所有这一切听起来可能令人困惑，请原谅我。我们会看到更多的例子来更好地学习。让我们回顾一下到目前为止我们所学的内容。</p><ol class=""><li id="1756" class="lz ma iq lg b lh li lk ll ln mb lr mc lv md kp me mf mg mh bi translated">您需要创建一个 Docker 文件，其中包含 Docker 容器将安装的信息。它包括一个图像，python，python 环境，然后运行应用程序本身。</li><li id="ef6d" class="lz ma iq lg b lh mi lk mj ln mk lr ml lv mm kp me mf mg mh bi translated">然后，您需要构建 Dockerfile。</li></ol><p id="6b35" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly kp ij bi translated"><strong class="lg ir">现在，请注意这里</strong></p><p id="0f14" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly kp ij bi translated">您可以通过以下方式查看所有 docker 容器</p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="6c04" class="no mo iq nk b gy np nq l nr ns">$ docker ps -a</span></pre><blockquote class="oe of og"><p id="ebb6" class="le lf oh lg b lh li jr lj lk ll ju lm oi lo lp lq oj ls lt lu ok lw lx ly kp ij bi translated">您将看不到任何 docker 容器，因为您刚刚构建了它。现在，我们将运行该图像。</p></blockquote><p id="c883" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly kp ij bi translated">类型</p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="c781" class="no mo iq nk b gy np nq l nr ns">$ docker images</span></pre><p id="3c47" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly kp ij bi translated">您可以使用此命令查看所有 docker 图像。下一个任务将是运行您刚刚构建 docker 映像。</p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="02d2" class="no mo iq nk b gy np nq l nr ns">$ docker run -d -p 5000:5000 &lt;docker_image_id&gt;</span></pre><ul class=""><li id="c614" class="lz ma iq lg b lh li lk ll ln mb lr mc lv md kp ol mf mg mh bi translated">5000:5000 表示您已经将系统的端口 5000 连接到 docker。后一个端口是烧瓶。默认情况下，flask 在端口 5000 上运行。</li><li id="b091" class="lz ma iq lg b lh mi lk mj ln mk lr ml lv mm kp ol mf mg mh bi translated">-d 标志意味着您希望以守护模式(后台)运行它。</li></ul><p id="d45b" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly kp ij bi translated">成功运行后，您会看到一个输出。检查您的容器是否正在运行。类型</p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="0959" class="no mo iq nk b gy np nq l nr ns">$ docker ps -a</span></pre><p id="10df" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly kp ij bi translated">如果运行成功，那么在你的网络浏览器中输入<a class="ae ld" href="https://127.0.0.1:5000" rel="noopener ugc nofollow" target="_blank"> localhost:5000 </a>。你会看到“你好世界”。</p><h1 id="0852" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">示例 2:传递参数应用程序</h1><p id="5242" class="pw-post-body-paragraph le lf iq lg b lh nt jr lj lk nu ju lm ln ny lp lq lr nz lt lu lv oa lx ly kp ij bi translated">这不是一个机器学习预测模型，而是我们要学习如何通过 POST 方法从 flask 获取输入并打印出来。</p><p id="9267" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly kp ij bi translated">让我们首先创建 flask 应用程序</p><figure class="nf ng nh ni gt kw"><div class="bz fp l di"><div class="ob oc l"/></div></figure><ul class=""><li id="b02d" class="lz ma iq lg b lh li lk ll ln mb lr mc lv md kp ol mf mg mh bi translated">我们通过显式声明 POST 方法来使用它。</li><li id="abcf" class="lz ma iq lg b lh mi lk mj ln mk lr ml lv mm kp ol mf mg mh bi translated">使用<a class="ae ld" href="https://gist.github.com/gaganmanku96/ff8289917121fea6d75ad77655c3fc3e" rel="noopener ugc nofollow" target="_blank"> request.get_json </a>方法来接收输入。</li><li id="9f6c" class="lz ma iq lg b lh mi lk mj ln mk lr ml lv mm kp ol mf mg mh bi translated">然后简单地打印该值</li></ul><p id="4182" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly kp ij bi translated">让我们创建 requirements.txt 文件</p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="81de" class="no mo iq nk b gy np nq l nr ns">$ pip3 list &gt; requirements.txt</span></pre><p id="05cf" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly kp ij bi translated">docker 文件将与之前的完全相同</p><figure class="nf ng nh ni gt kw"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="4dc6" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly kp ij bi translated">要构建 docker 文件，请使用</p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="f9de" class="no mo iq nk b gy np nq l nr ns">$ docker build -t passingarguments .</span></pre><p id="e353" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly kp ij bi translated">我们将遵循上面的所有步骤。</p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="e3be" class="no mo iq nk b gy np nq l nr ns">$ docker images<br/>$ docker run -d -p 5000:5000 &lt;docker_image_id&gt;</span></pre><p id="a228" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly kp ij bi translated"><strong class="lg ir">现在，注意这里</strong></p><p id="4ac6" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly kp ij bi translated">有多种方法可以调用我们刚刚创建的 API。</p><ol class=""><li id="956b" class="lz ma iq lg b lh li lk ll ln mb lr mc lv md kp me mf mg mh bi translated">在 python 中使用请求。</li></ol><figure class="nf ng nh ni gt kw"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="5515" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly kp ij bi translated">2.使用邮递员</p><p id="bb19" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly kp ij bi translated">3.使用卷曲</p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="0086" class="no mo iq nk b gy np nq l nr ns">curl -X POST <a class="ae ld" href="http://127.0.0.1:5000/predict" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:5000/predict</a> -d 5</span></pre><p id="ae60" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly kp ij bi translated">结果将是传递的数字的平方。</p><h1 id="5e3f" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">示例 3:简单的 ML 应用程序</h1><p id="0b39" class="pw-post-body-paragraph le lf iq lg b lh nt jr lj lk nu ju lm ln ny lp lq lr nz lt lu lv oa lx ly kp ij bi translated">在这个例子中，我们将看到如何同时传递多个例子。我们将以 JSON 的形式传递参数。</p><p id="0ff9" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly kp ij bi translated">现在，你不用担心模特培训。训练模型的代码在 Docker 文件中，该模型将作为 Docker 构建过程的一部分进行训练。</p><blockquote class="oe of og"><p id="92c0" class="le lf oh lg b lh li jr lj lk ll ju lm oi lo lp lq oj ls lt lu ok lw lx ly kp ij bi translated">理想情况下，模型应该在本地系统上进行训练，然后复制到 Docker 容器中。</p></blockquote><p id="d040" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly kp ij bi translated">让我们看一下 Flask 应用程序</p><figure class="nf ng nh ni gt kw"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="f7c2" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly kp ij bi translated">这一次在 flask 应用程序中，我们从接收到的 JSON 中获取参数。JSON 的数据格式类似于 python 字典。</p><blockquote class="oe of og"><p id="5977" class="le lf oh lg b lh li jr lj lk ll ju lm oi lo lp lq oj ls lt lu ok lw lx ly kp ij bi translated">实际上，我们还应该在这里包含错误处理。如果参数不是数字或参数为空，则可能会出现错误。</p></blockquote><p id="a3f4" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly kp ij bi translated">另外，创建一个 requirements.txt 文件</p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="d9eb" class="no mo iq nk b gy np nq l nr ns">$ pip3 list &gt; requirements.txt</span></pre><p id="5944" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly kp ij bi translated">现在，让我们看看 Docker 文件</p><figure class="nf ng nh ni gt kw"><div class="bz fp l di"><div class="ob oc l"/></div></figure><blockquote class="oe of og"><p id="d740" class="le lf oh lg b lh li jr lj lk ll ju lm oi lo lp lq oj ls lt lu ok lw lx ly kp ij bi translated">请注意，我们正在 Docker 容器中训练模型。您还可以在本地系统上训练模型，并将其复制到容器中。在这种情况下，您只需删除训练模型的行。</p></blockquote><p id="0e29" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly kp ij bi translated">现在，有多种方法可以得到预测。</p><ol class=""><li id="7101" class="lz ma iq lg b lh li lk ll ln mb lr mc lv md kp me mf mg mh bi translated">在 python 中使用请求</li></ol><figure class="nf ng nh ni gt kw"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="ba80" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly kp ij bi translated">2.使用卷曲</p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="36b4" class="no mo iq nk b gy np nq l nr ns">curl -X POST <a class="ae ld" href="http://127.0.0.1:5000/predict" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:5000/predict</a> -d '{"f1":4, "f2":5, "f3":10}'</span></pre><p id="f7c1" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly kp ij bi translated">注意我们是如何以 JSON 格式传递数据的。在 python 中使用请求时，您必须使用 json.dumps 来将数据转换成 json 格式。</p><h1 id="a5db" class="mn mo iq bd mp mq mr ms mt mu mv mw mx jw my jx mz jz na ka nb kc nc kd nd ne bi translated">4.图像分类应用</h1><p id="2850" class="pw-post-body-paragraph le lf iq lg b lh nt jr lj lk nu ju lm ln ny lp lq lr nz lt lu lv oa lx ly kp ij bi translated">为简单起见，我使用 MNIST 数据集进行分类。</p><p id="9656" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly kp ij bi translated">让我们看看 Flask 应用程序</p><figure class="nf ng nh ni gt kw"><div class="bz fp l di"><div class="ob oc l"/></div></figure><figure class="nf ng nh ni gt kw"><div class="bz fp l di"><div class="ob oc l"/></div></figure><figure class="nf ng nh ni gt kw"><div class="bz fp l di"><div class="ob oc l"/></div></figure><ul class=""><li id="bc82" class="lz ma iq lg b lh li lk ll ln mb lr mc lv md kp ol mf mg mh bi translated">我们正在进口所有必要的包装</li><li id="8efe" class="lz ma iq lg b lh mi lk mj ln mk lr ml lv mm kp ol mf mg mh bi translated">我们在运行时加载模型，以加快推理速度</li><li id="c526" class="lz ma iq lg b lh mi lk mj ln mk lr ml lv mm kp ol mf mg mh bi translated">我们使用 convert('L ')将图像转换为灰度。</li><li id="e355" class="lz ma iq lg b lh mi lk mj ln mk lr ml lv mm kp ol mf mg mh bi translated">图像大小调整为 28x28 像素。</li><li id="6bbc" class="lz ma iq lg b lh mi lk mj ln mk lr ml lv mm kp ol mf mg mh bi translated">对于预测，Keras 需要图像的格式(批量大小、宽度、高度、颜色通道)。所以，我们把它转换成(1，28，28，1)。</li><li id="e131" class="lz ma iq lg b lh mi lk mj ln mk lr ml lv mm kp ol mf mg mh bi translated">接下来，我们将使用它的预测方法和 no.argmax 来查找概率最高的类。</li></ul><p id="be3f" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly kp ij bi translated">让我们创建 requirements.txt 文件</p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="54fa" class="no mo iq nk b gy np nq l nr ns">$ pip3 list &gt; requirements.txt</span></pre><p id="938c" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly kp ij bi translated">让我们看看它的 docker 文件</p><figure class="nf ng nh ni gt kw"><div class="bz fp l di"><div class="ob oc l"/></div></figure><blockquote class="oe of og"><p id="a88a" class="le lf oh lg b lh li jr lj lk ll ju lm oi lo lp lq oj ls lt lu ok lw lx ly kp ij bi translated">注意——这里我已经训练好了模型。您还可以在构建 docker 文件时添加培训功能。</p></blockquote><p id="ed95" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly kp ij bi translated">我们将遵循上面的步骤</p><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="06da" class="no mo iq nk b gy np nq l nr ns">$ docker build -t imageclassification .<br/>$ docker run -d -p 5000:5000 &lt;docker_image_id&gt;</span></pre><blockquote class="oe of og"><p id="8aea" class="le lf oh lg b lh li jr lj lk ll ju lm oi lo lp lq oj ls lt lu ok lw lx ly kp ij bi translated">在构建 Docker 映像之前，确保使用文件夹中包含的 train.py 文件训练模型</p></blockquote><p id="20c8" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly kp ij bi translated">现在，有多种方法可以得到预测。</p><ol class=""><li id="4ef6" class="lz ma iq lg b lh li lk ll ln mb lr mc lv md kp me mf mg mh bi translated">使用卷曲</li></ol><pre class="nf ng nh ni gt nj nk nl nm aw nn bi"><span id="8f7d" class="no mo iq nk b gy np nq l nr ns">curl -F "file=<a class="ae ld" href="http://twitter.com/exp" rel="noopener ugc nofollow" target="_blank">@</a>pic_name.extension" <a class="ae ld" href="http://localhost:5000/predict" rel="noopener ugc nofollow" target="_blank">http://localhost:5000/predict</a></span></pre><p id="5838" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly kp ij bi translated">2.使用请求</p><figure class="nf ng nh ni gt kw"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="a9c8" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly kp ij bi translated">现在够了。</p><p id="be0d" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly kp ij bi translated">如果你已经理解了一些基本的程度，那么祝贺你到此为止。当你尝试新事物并毫不犹豫地去尝试时，你会学到更多。一个大师曾经是一个初学者。</p><p id="a77a" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly kp ij bi translated">所有代码都在这里。</p><p id="121c" class="pw-post-body-paragraph le lf iq lg b lh li jr lj lk ll ju lm ln lo lp lq lr ls lt lu lv lw lx ly kp ij bi translated">快乐学习！</p></div></div>    
</body>
</html>