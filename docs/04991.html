<html>
<head>
<title>Neural Knapsack</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">神经背包</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/neural-knapsack-8edd737bdc15?source=collection_archive---------8-----------------------#2019-07-27">https://towardsdatascience.com/neural-knapsack-8edd737bdc15?source=collection_archive---------8-----------------------#2019-07-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c090" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">用神经网络求解背包问题</h2></div><p id="cc9d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在数据科学的某些情况下，需要对模型的输出运行特定的算法来获得结果。有时，它就像找到最大输出的索引一样简单，而其他时候，则需要更高级的算法。您可以在运行推理后运行算法。然而，设计一个可以在内部运行算法的模型有一些好处。使用神经网络解决背包问题不仅有助于模型在内部运行背包算法，而且允许模型被端到端地训练。</p><h2 id="94a4" class="le lf it bd lg lh li dn lj lk ll dp lm kr ln lo lp kv lq lr ls kz lt lu lv lw bi translated">什么是背包问题？</h2><p id="029c" class="pw-post-body-paragraph ki kj it kk b kl lx ju kn ko ly jx kq kr lz kt ku kv ma kx ky kz mb lb lc ld im bi translated">我可爱的计算机算法老师用这个故事给我解释了背包问题。想象一个小偷在抢劫。有一些物品可供抢劫。每个项目都有自己的重量和价值。小偷有一个容量确定的背包，该背包指示他(或她)能够携带的最大重量。小偷的利润是通过对所选物品的价值求和来计算的。我们的目标是最大化利润，同时保持所选物品的重量总和小于背包的容量。</p><p id="4c02" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">据<a class="ae mc" href="https://en.wikipedia.org/wiki/Knapsack_problem" rel="noopener ugc nofollow" target="_blank">维基百科</a>:</p><blockquote class="md me mf"><p id="a96f" class="ki kj mg kk b kl km ju kn ko kp jx kq mh ks kt ku mi kw kx ky mj la lb lc ld im bi translated">给定一组项目，每个项目都有一个重量和一个值，确定集合中要包含的每个项目的数量，使总重量小于或等于给定的限制，并且总值尽可能大。它的名字来源于一个人面临的问题，他被一个固定大小的背包所束缚，必须在里面装满最有价值的物品”</p></blockquote><p id="58a5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在本文中，我们尝试使用神经网络来解决背包问题。</p><h2 id="8e63" class="le lf it bd lg lh li dn lj lk ll dp lm kr ln lo lp kv lq lr ls kz lt lu lv lw bi translated">数据</h2><p id="84b6" class="pw-post-body-paragraph ki kj it kk b kl lx ju kn ko ly jx kq kr lz kt ku kv ma kx ky kz mb lb lc ld im bi translated">第一步是准备数据。我们使用随机整数来表示物品的重量、价格和背包的容量。创建问题后，我们使用蛮力来寻找最优解。</p><figure class="mk ml mm mn gt mo"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="ad60" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一个生成背包问题；</p><pre class="mk ml mm mn gt mr ms mt mu aw mv bi"><span id="5d6e" class="le lf it ms b gy mw mx l my mz">Weights:  [13, 10, 13, 7, 2]<br/>Prices:   [8, 7, 9, 6, 4]<br/>Capacity: 27<br/>Optimum<!-- --> solution: [0, 1, 1, 0, 1]</span></pre><p id="5a75" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">标准化输入是每个机器学习项目的一部分，因为它有助于模型更好地概括。为了标准化每个背包问题:</p><ul class=""><li id="486f" class="na nb it kk b kl km ko kp kr nc kv nd kz ne ld nf ng nh ni bi translated">将价格除以问题的最高价格。</li><li id="a98c" class="na nb it kk b kl nj ko nk kr nl kv nm kz nn ld nf ng nh ni bi translated">用重量除以容量。</li><li id="251f" class="na nb it kk b kl nj ko nk kr nl kv nm kz nn ld nf ng nh ni bi translated">从输入中删除容量，因为它现在包含在权重中。</li></ul><p id="c3a3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">先前创建的背包问题的规范化形式:</p><pre class="mk ml mm mn gt mr ms mt mu aw mv bi"><span id="df1e" class="le lf it ms b gy mw mx l my mz">Weights:  [0.48, 0.37, 0.48, 0.26, 0.07]<br/>Prices:   [0.89, 0.44, 1.00, 0.67, 0.44]<br/>Optimum<!-- --> solution: [0, 1, 1, 0, 1]</span></pre><p id="b6eb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">数据集由一万个用于训练的样本和两百个用于测试的样本组成。</p><h2 id="12c9" class="le lf it bd lg lh li dn lj lk ll dp lm kr ln lo lp kv lq lr ls kz lt lu lv lw bi translated">模型</h2><p id="242d" class="pw-post-body-paragraph ki kj it kk b kl lx ju kn ko ly jx kq kr lz kt ku kv ma kx ky kz mb lb lc ld im bi translated">我们为此任务选择的模型是一个相当简单的模型。它有两个输入和一个输出。首先，输入被连接在一起。结果进入由 sigmoid 非线性激活的两个连续的密集层。第二密集层的输出是模型的输出。在 Keras 中实施该模型:</p><figure class="mk ml mm mn gt mo"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="ae36" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下图显示了模型的体系结构:</p><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div role="button" tabindex="0" class="np nq di nr bf ns"><div class="gh gi no"><img src="../Images/02c73d313a8065ccc754d5b1fbdee5f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-gwfIFQ3APHJVNsum6AinA.jpeg"/></div></div><figcaption class="nv nw gj gh gi nx ny bd b be z dk">Model architecture</figcaption></figure><h2 id="ce4d" class="le lf it bd lg lh li dn lj lk ll dp lm kr ln lo lp kv lq lr ls kz lt lu lv lw bi translated">衡量标准</h2><p id="fa7a" class="pw-post-body-paragraph ki kj it kk b kl lx ju kn ko ly jx kq kr lz kt ku kv ma kx ky kz mb lb lc ld im bi translated">背包问题需要除二进制分类精度之外的度量来进行评估。我们引入的第一个指标叫做“<strong class="kk iu">定价过高</strong>”。顾名思义，它评估所选项目的价格和最优解之间的平均差异。它在 Keras 框架中实现如下:</p><figure class="mk ml mm mn gt mo"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="6c77" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">另一个重要的指标是使用的容量超过背包的容量。“<strong class="kk iu">空间违规</strong>是所选物品重量之和与背包容量之间的正差值。它可以在 Keras 中实现如下:</p><figure class="mk ml mm mn gt mo"><div class="bz fp l di"><div class="mp mq l"/></div></figure><h2 id="beb8" class="le lf it bd lg lh li dn lj lk ll dp lm kr ln lo lp kv lq lr ls kz lt lu lv lw bi translated">监督方法</h2><p id="4b33" class="pw-post-body-paragraph ki kj it kk b kl lx ju kn ko ly jx kq kr lz kt ku kv ma kx ky kz mb lb lc ld im bi translated">在监督方法中，我们将权重和价格输入到模型中，并期望最优解作为输出。在此过程中，模型使用交叉熵损失函数进行训练。</p><figure class="mk ml mm mn gt mo"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="bb7a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在使用监督方法训练模型之后，我们在 512 个时期之后获得了以下结果。</p><pre class="mk ml mm mn gt mr ms mt mu aw mv bi"><span id="7d73" class="le lf it ms b gy mw mx l my mz">Model results(Train/Test):<br/>Loss:               0.24 / 0.24<br/>Binary accuracy:    0.89 / 0.89<br/>Space violation:    0.04 / 0.06<br/>Overpricing:        0.06 / 0.08</span></pre><p id="254f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">不幸的是，有监督的方法有两个基本问题:</p><ul class=""><li id="9145" class="na nb it kk b kl km ko kp kr nc kv nd kz ne ld nf ng nh ni bi translated">最佳解决方案是强制开始训练。</li><li id="cb45" class="na nb it kk b kl nj ko nk kr nl kv nm kz nn ld nf ng nh ni bi translated">我们对<em class="mg">空间违规</em>和<em class="mg">定价过高</em>没有任何控制。</li></ul><p id="a673" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们将尝试在无监督的方法中解决这些问题。</p><h2 id="8231" class="le lf it bd lg lh li dn lj lk ll dp lm kr ln lo lp kv lq lr ls kz lt lu lv lw bi translated">无监督方法</h2><p id="5855" class="pw-post-body-paragraph ki kj it kk b kl lx ju kn ko ly jx kq kr lz kt ku kv ma kx ky kz mb lb lc ld im bi translated">我们希望在不计算最优解的情况下训练模型。因此，我们需要一个新的损失函数。相应地，我们随后将<strong class="kk iu"> <em class="mg"> w </em> </strong>，<strong class="kk iu"> <em class="mg"> p </em> </strong>，<strong class="kk iu"> <em class="mg"> c </em> </strong>，<strong class="kk iu">，</strong>o 定义为物品的重量，物品的价格，背包的容量和模型的产量。首先，我们需要最大化所选商品的价格总和。它可以通过以下方式计算:</p><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/cc2377e7f210147beae6e632974833ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:352/format:webp/1*qM_mzH7lqF4ToBbZwjQMQw.png"/></div></figure><p id="9848" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">同时，我们希望我们的选择不超过背包的容量。该值可以通过以下公式表示:</p><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/71e261ed43d99de67e4fd73ba27bdf44.png" data-original-src="https://miro.medium.com/v2/resize:fit:698/format:webp/1*FQ18zivrj63XmiMczxDoiw.png"/></div></figure><p id="c685" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最后，我们要最大化<strong class="kk iu"> <em class="mg">总价</em> </strong>同时最小化<strong class="kk iu"> <em class="mg">空间违例</em> </strong>。这可以通过以下方式制定:</p><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/255ac886dfc4967cdd39465d448dff02.png" data-original-src="https://miro.medium.com/v2/resize:fit:698/format:webp/1*ts-X-iWGpy1RjerhZ38V3w.png"/></div></figure><p id="3116" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了控制<strong class="kk iu"> <em class="mg">空间违逆</em> </strong>，我们在第二项中加入了<strong class="kk iu"> λ </strong>系数。最终损失公式为:</p><figure class="mk ml mm mn gt mo gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/932b1f617aa4b22368b5d1d3e861c268.png" data-original-src="https://miro.medium.com/v2/resize:fit:724/format:webp/1*R4oebih5Y6dvZQ7ErWQ5nw.png"/></div></figure><p id="e4e1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以像这样在 Keras 中实现新的损失:</p><figure class="mk ml mm mn gt mo"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="fcc6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">使用这个损失函数，我们以无监督的方式训练神经网络。</p><p id="da0b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">注 1: </strong>背包损耗的 Keras 实现中<strong class="kk iu"> λ </strong>参数命名为<strong class="kk iu"> <em class="mg"> cvc </em> </strong>。</p><p id="fcdb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">注 2: </strong>虽然我们收到了最优解(y_true)作为函数自变量，但我们并不使用它来计算损失。我们也不能省略参数，因为在损失函数中接收预测和预期输出是一个 Keras 约束。</p><p id="e3cd" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">注 3: </strong>当我们归一化数据时，背包的容量等于 1。</p><figure class="mk ml mm mn gt mo"><div class="bz fp l di"><div class="mp mq l"/></div></figure><p id="93b2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在用非监督方法训练模型之后，我们在 512 个时期之后得到以下结果。</p><pre class="mk ml mm mn gt mr ms mt mu aw mv bi"><span id="2a96" class="le lf it ms b gy mw mx l my mz">Model results(Train/Test):<br/>Loss:               -1.83 / -1.75<br/>Binary accuracy:    0.89 / 0.89<br/>Space violation:    0.05 / 0.06<br/>Overpricing:        0.12 / 0.14</span></pre><p id="cac0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">增加<strong class="kk iu"><em class="mg">CVC</em></strong><em class="mg"/>(<strong class="kk iu">λ</strong>)的值会在更少的空间内造成违规和套印。增加太多也会降低二进制精度。我发现它的合理值可能是 5.75。</p><h1 id="88b4" class="oc lf it bd lg od oe of lj og oh oi lm jz oj ka lp kc ok kd ls kf ol kg lv om bi translated">结论</h1><p id="38cc" class="pw-post-body-paragraph ki kj it kk b kl lx ju kn ko ly jx kq kr lz kt ku kv ma kx ky kz mb lb lc ld im bi translated">如前所述，我们使用神经网络解决了背包问题，而梯度可以通过网络。因此，我们的模型可以使用反向传播算法的任何变体进行端到端的训练。</p><p id="6b37" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这篇文章可以用在推荐系统中，特别是那些在保持空间使用率的同时推荐多个项目的系统(比如横幅广告)。</p></div></div>    
</body>
</html>