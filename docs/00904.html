<html>
<head>
<title>Jupyter Notebook — Forget CSV, fetch data from DB with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Jupyter 笔记本——忘记 CSV，用 Python 从 DB 获取数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/jupyter-notebook-forget-csv-fetch-data-from-db-with-python-5ef1a56402f2?source=collection_archive---------14-----------------------#2019-02-11">https://towardsdatascience.com/jupyter-notebook-forget-csv-fetch-data-from-db-with-python-5ef1a56402f2?source=collection_archive---------14-----------------------#2019-02-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="37c4" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">从数据库加载训练数据的简单方法</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/51d9e9f76ee3278a69dc11a56a71c966.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*57rEI1U8vHqTaudWjJCv_Q.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Source: Pixabay</figcaption></figure><p id="3e39" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果你阅读关于机器学习的书籍、文章或博客，它很可能会使用 CSV 文件中的训练数据。CSV 没什么不好，但是大家想想是不是真的实用。直接从数据库中读取数据不是更好吗？通常你不能直接将业务数据输入到 ML 训练中，它需要预处理——改变分类数据，计算新的数据特征，等等。在获取原始业务数据时，使用 SQL 可以非常容易地完成数据准备/转换步骤。直接从数据库中读取数据的另一个优点是，当数据发生变化时，更容易自动化 ML 模型重训练过程。</p><p id="4aba" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在这篇文章中，我描述了如何从 Jupyter 笔记本 Python 代码调用 Oracle DB。</p><p id="2a0b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">第一步</strong></p><p id="874d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">安装<a class="ae lr" href="https://oracle.github.io/python-cx_Oracle/" rel="noopener ugc nofollow" target="_blank"> cx_Oracle </a> Python 模块:</p><p id="8ada" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><em class="ls"> python -m pip 安装 cx_Oracle </em></p><p id="e47f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">该模块有助于从 Python 连接到 Oracle DB。</p><p id="1e0e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">第二步</strong></p><p id="4c4b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">cx_Oracle 支持从 Python 代码执行 SQL 调用。但是为了能够从 Python 脚本调用远程数据库，我们需要在运行 Python 的机器上安装和配置<a class="ae lr" href="https://www.oracle.com/technetwork/database/database-technologies/instant-client/overview/index.html" rel="noopener ugc nofollow" target="_blank"> Oracle Instant Client </a>。</p><p id="04ac" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果你用的是 Ubuntu，安装<em class="ls">外星人</em>:</p><p id="6040" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><em class="ls"> sudo apt-get 更新</em> <br/> <em class="ls"> sudo apt-get 安装外星人</em></p><p id="b975" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">下载 Oracle 即时客户端的 RPM 文件并使用<em class="ls"> alien </em>安装:</p><p id="b3fc" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><em class="ls">alien-I Oracle-instant client 18.3-basiclite-18 . 3 . 0 . 0 . 0–1 . x86 _ 64 . rpm<br/>alien-I Oracle-instant client 18.3-sqlplus-18 . 3 . 0 . 0 . 0–1 . x86 _ 64 . rpm<br/>alien-I Oracle-instant client 18.3-0 . 0 . 0 . 0–1 . x86 _ 64 . rpm</em></p><p id="9adc" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">添加环境变量:</p><p id="f387" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><em class="ls">导出 ORACLE _ HOME =/usr/lib/ORACLE/18.3/client 64<br/>导出路径=$PATH:$ORACLE_HOME/bin </em></p><p id="d259" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在这里阅读更多<a class="ae lr" href="http://mritjudge.com/linux/install-oracle-instant-client-on-ubuntu-linux/" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="23ad" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir">第三步</strong></p><p id="30bc" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">安装神奇的 SQL Python 模块:</p><p id="196c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><em class="ls"> pip 安装 jupyter-sql <br/> pip 安装 ipython-sql </em></p><p id="ced5" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">安装和配置完成。</p><p id="0ef6" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">对于今天的样本，我使用的是<a class="ae lr" href="https://raw.githubusercontent.com/jbrownlee/Datasets/master/pima-indians-diabetes.names" rel="noopener ugc nofollow" target="_blank">皮马印第安人糖尿病数据库</a>。CSV 数据可以从<a class="ae lr" href="https://raw.githubusercontent.com/jbrownlee/Datasets/master/pima-indians-diabetes.data.csv" rel="noopener ugc nofollow" target="_blank">这里</a>下载。我将 CSV 数据上传到数据库表中，并将通过 SQL 直接在 Jupyter notebook 中获取它。</p><p id="43da" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">首先，建立到数据库的连接，然后执行 SQL 查询。查询结果集存储在一个名为<em class="ls"> result </em>的变量中。您看到%%sql 了吗——这个神奇的 sql:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lt lu l"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Connecting to Oracle DB and fetching data through SQL query</figcaption></figure><p id="c35c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">建立连接时必须指定用户名和密码。为了避免共享密码，请确保从外部源读取密码值(可以是本例中的简单 JSON 文件，也可以是来自 keyring 的更高级的编码令牌)。</p><p id="363c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这种方法的美妙之处在于，通过 SQL 查询获取的数据是数据框中现成可用的。机器学习工程师可以像通过 CSV 加载数据一样处理数据:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="lt lu l"/></div></figure><p id="4115" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在<a class="ae lr" href="https://github.com/abaranovskis-redsamurai/automation-repo/blob/master/diabetes_redsamurai_db.ipynb" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上可以找到 Jupyter 笔记本的样本。样本凭证 JSON <a class="ae lr" href="https://github.com/abaranovskis-redsamurai/automation-repo/blob/master/credentials.json" rel="noopener ugc nofollow" target="_blank">文件</a>。</p></div></div>    
</body>
</html>