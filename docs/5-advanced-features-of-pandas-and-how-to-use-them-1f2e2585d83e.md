# 熊猫的 5 个高级功能以及如何使用它们

> 原文：<https://towardsdatascience.com/5-advanced-features-of-pandas-and-how-to-use-them-1f2e2585d83e?source=collection_archive---------16----------------------->

![](img/4a039ce8bea4985eaa2731f4e6888839.png)

> 想获得灵感？快来加入我的 [**超级行情快讯**](https://www.superquotes.co/?utm_source=mediumtech&utm_medium=web&utm_campaign=sharing) 。😎

Pandas 是所有事物数据的黄金标准库。凭借加载、过滤、操作和探索数据的功能，它成为数据科学家的[最爱也就不足为奇了。](https://www.kdnuggets.com/2018/06/top-20-python-libraries-data-science-2018.html)

我们大多数人自然会坚持熊猫最基本的东西。从 CSV 文件中加载数据，过滤一些列，然后直接进入[数据可视化](/5-quick-and-easy-data-visualizations-in-python-with-code-a2284bae952f)。然而，熊猫实际上有许多鲜为人知但有用的功能，可以使处理数据更加容易和干净。

本教程将指导你完成 5 个更高级的功能——它们的功能和使用方法。数据带来更多乐趣！

# (1)配置选项和设置

Pandas 提供了一组用户可配置的选项和设置。他们是巨大的生产力助推器，因为他们让你完全按照你的喜好来定制你的熊猫环境。

例如，我们可以更改 Pandas 的一些显示设置，以更改显示多少行和列，以及显示多少精度的浮点数。

上面的代码确保 Pandas 总是最多显示 10 行和 10 列，浮点值最多显示两位小数。这样，当我们试图打印出一个大的数据帧时，我们的终端或笔记本就不会看起来一团糟！

这只是一个基本的例子。除了简单的显示设置之外，还有更多值得探索的地方。你可以查看[官方文档](https://pandas.pydata.org/pandas-docs/stable/user_guide/options.html)中的所有选项。

# (2)组合数据帧

熊猫数据帧的一个相对未知的部分是，实际上有两种不同的方法来组合它们。每种方法都会产生不同的结果，所以根据你想要达到的目标选择合适的方法是非常重要的。此外，它们包含许多进一步定制合并的参数。我们去看看。

## 连结

串联是组合数据帧的最广为人知的方法，可以直观地认为是“堆叠”。堆叠可以水平或垂直进行。

假设您有一个 CSV 格式的庞大数据集。为了更容易处理，将它分成多个文件是有意义的(这是大型数据集的常见做法，称为*分片*)。

当您将它加载到 pandas 时，您可以垂直堆叠每个 CSV 的数据帧，为所有数据创建一个大的数据帧。例如，如果我们有 3 个碎片，每个碎片有 500 万行，那么在我们垂直堆叠它们之后，我们最终的数据帧将有 1500 万行。

下面的代码显示了如何垂直连接 Pandas 中的数据帧。

您可以通过根据列而不是行分割数据集来做类似的事情，每个 CSV 文件有几列(包含数据集的所有行)。这就像我们将数据集的要素分成不同的碎片。然后，您可以水平堆叠它们，以组合这些列/特征。

## 合并

合并更复杂但更强大，以一种类似 SQL 的风格合并 Pandas 数据帧。即数据帧将由一些公共属性连接。

想象一下，你有 2 个数据帧来描述你的 YouTube 频道。其中一个包含用户 id 列表以及每个用户在您的频道上总共花费了多少时间。另一个包含类似的用户 id 列表和每个用户看过多少视频。通过合并，我们可以将两个数据帧合并成一个数据帧，方法是匹配用户 ID，然后将每个用户的 ID、花费的时间和视频计数放在一行中。

在 Pandas 中合并两个数据帧是通过*合并*功能完成的。您可以在下面的代码中看到它是如何工作的示例。`left`和`right`参数指的是您希望合并的 2 个数据帧，而`on`指定用于匹配的列。

为了进一步模拟 SQL 连接，`how`参数允许您选择想要执行的 SQL 风格的连接类型:内部、外部、左侧或右侧。要了解更多关于 SQL 连接的信息，请参阅 W3Schools 教程。

# (3)重塑数据帧

有几种方法可以重塑和重组熊猫数据框架。从简单和容易到强大和复杂。让我们来看看 3 个最常见的。对于下面所有的例子，我们将使用这个超级英雄的数据集！

## 移项

最简单的。转置将数据帧的行与其列交换。如果你有 5000 行 10 列，然后转置你的数据帧，你将得到 10 行 5000 列。

## 分组依据

Groupby 的主要用途是根据一些键将数据帧分割成多个部分。一旦数据帧被分割成多个部分，您就可以在每个部分上独立地循环和应用一些操作。

例如，我们可以看到在下面的代码中，我们如何创建一个球员的数据框架，并给出相应的年份和分数。然后我们做了一个`groupby`来根据玩家将数据帧分成多个部分。因此，每个玩家都有自己的小组，显示该玩家在他们活跃的每一年中获得了多少积分。

## 堆垛

堆叠将数据帧转换为具有多级索引，即每行具有多个子部分。这些子部分是使用数据帧的列创建的，将它们压缩到多索引中。总的来说，堆叠可以被认为是将列压缩成多索引行。

下面的例子很好地说明了这一点。

# (4)使用时间数据

日期时间库是 Python 中的一个主要部分。每当您处理与现实世界的日期和时间信息相关的任何事情时，它都是您的首选库。幸运的是，Pandas 还附带了使用 Datetime 对象的功能。

让我们用一个例子来说明。在下面的代码中，我们首先创建一个包含 4 列的 data frame:Day、month、year 和 data，然后按照 Year 和 Month 对其进行排序。如你所见，相当凌乱；我们使用了 3 列来存储日期，而实际上我们知道日历日期只有 1 个值。

我们可以用日期时间来清理东西。

Pandas 方便地提供了一个名为`to_datetime()`的函数，可以将多个 DataFrame 列压缩并转换成一个 Datetime 对象。一旦采用这种格式，您就可以任意使用日期时间库的所有灵活性。

要使用`to_datetime()`函数，您需要传递相关列的所有“日期”数据。那是“日”、“月”和“年”栏。一旦我们有了 Datetime 格式的内容，我们就不再需要其他列，可以简单地删除它们。查看下面的代码，看看这一切是如何工作的！

# (5)将项目映射到组中

映射是一个帮助组织分类数据的巧妙技巧。例如，假设我们有一个巨大的数据框架，有几千行，其中一列有我们想要分类的项目。这样做可以大大简化机器学习模型的训练和有效地可视化数据。

查看下面的代码，其中有一个小例子，我们有一个要分类的食物列表。

在上面的代码中，我们将列表放入熊猫系列中。我们还创建了一个字典，显示我们想要的映射，将每个食物项目分类为“蛋白质”或“碳水化合物”。这是一个玩具示例，但是如果这个系列是大规模的，比如说有 1，000，000 个项目，那么遍历它根本不实际。

代替基本的 for 循环，我们可以使用 Pandas 内置的`.map()`函数编写一个函数，以优化的方式执行映射。查看下面的代码，看看这个函数以及它是如何应用的。

在这个函数中，我们首先遍历我们的字典来创建一个新字典，其中的键表示 pandas 系列中的每一个可能的项目，值表示新映射的项目，“蛋白质”或“碳水化合物”。然后，我们简单地应用 Pandas 内置的 map 函数来映射序列中的所有值

查看下面的输出结果！

```
['Carbs', 'Carbs', 'Protein', 'Protein', 'Protein', 'Carbs', 'Carbs', 'Carbs', 'Protein', 'Carbs', 'Carbs', 'Protein', 'Protein', 'Protein', 'Carbs', 'Carbs', 'Carbs', 'Protein', 'Carbs', 'Carbs', 'Carbs', 'Protein', 'Carbs', 'Carbs', 'Carbs', 'Protein', 'Carbs', 'Carbs', 'Protein', 'Protein', 'Protein', 'Carbs', 'Carbs', 'Protein', 'Protein', 'Protein', 'Carbs', 'Carbs', 'Protein', 'Protein', 'Protein', 'Carbs', 'Carbs', 'Carbs', 'Protein', 'Carbs', 'Carbs', 'Carbs', 'Protein', 'Carbs', 'Carbs', 'Carbs', 'Protein', 'Carbs', 'Carbs', 'Protein', 'Protein', 'Protein', 'Carbs', 'Carbs', 'Protein', 'Protein', 'Protein']
```

# 结论

所以你有它！你的熊猫的 5 个高级功能以及如何使用它们！

如果你想吃更多，不用担心！关于熊猫和数据科学，还有很多东西要学。作为推荐读物， [KDNuggets 网站](https://www.kdnuggets.com/)当然是关于这个主题的最佳资源！

# 喜欢学习？

在 [Twitter](https://twitter.com/GeorgeSeif94) 上关注我，在那里我会发布所有最新最棒的人工智能、技术和科学！也在 LinkedIn 上与我联系！