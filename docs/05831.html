<html>
<head>
<title>Tricks in R to Boost Your Productivity (Part 2)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">提高生产率的 R 技巧(第 2 部分)</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/tricks-in-r-to-boost-your-productivity-part-2-7222461c6671?source=collection_archive---------10-----------------------#2019-08-25">https://towardsdatascience.com/tricks-in-r-to-boost-your-productivity-part-2-7222461c6671?source=collection_archive---------10-----------------------#2019-08-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/dba4ba7047791fc7930a1fe00bfe67b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*kC07PbVF1T5ejo8i"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">Photo by <a class="ae kf" href="https://unsplash.com/@bradneathery?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Brad Neathery</a> on <a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="9e65" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我总是热衷于能帮助我更快完成工作的工具和技巧。虽然提高生产率并不一定意味着它能给你带来好的或正确的结果，但它肯定能减少你的工作时间，这意味着犯错误的时间更少。花些时间学习技巧和工具会在你以后的工作中得到回报，这是完全值得的。继我上一篇关于 R 和 RStudio 技巧的<a class="ae kf" rel="noopener" target="_blank" href="/tricks-in-r-to-boost-your-productivity-8c977242c69c">文章</a>之后，我将在这篇文章中继续与您分享一些我认为有用的其他技巧。</p><h1 id="d8a4" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated"><strong class="ak">设置 R 配置文件</strong></h1><p id="e4f8" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">当一个 R 会话启动时，它首先尝试在您的项目目录或您的主目录中搜索一个<code class="fe mh mi mj mk b">.Rprofile</code>文件，如果它存在，就执行函数<code class="fe mh mi mj mk b">.First</code>。你可以使用<code class="fe mh mi mj mk b">.Rprofile</code>在每节课开始时执行一些事情来节省你的时间</p><ul class=""><li id="96e9" class="ml mm it ki b kj kk kn ko kr mn kv mo kz mp ld mq mr ms mt bi translated">加载经常工作的包(如 tidyverse、data.table、ggplot2 等。).</li><li id="e466" class="ml mm it ki b kj mu kn mv kr mw kv mx kz my ld mq mr ms mt bi translated">设置环境变量(例如开发环境标识符(“沙箱”、“暂存”、“生产”等)。)、AWS 凭证、您的数据库连接凭证等)。</li><li id="eb97" class="ml mm it ki b kj mu kn mv kr mw kv mx kz my ld mq mr ms mt bi translated">设置 Java 参数(如果您需要通过 DBI/rJava 包从数据库中提取大量数据，您肯定需要设置这个参数)。</li><li id="ba57" class="ml mm it ki b kj mu kn mv kr mw kv mx kz my ld mq mr ms mt bi translated">设置 ggplot2 主题和调色板(如果您需要使用特定品牌的调色板，这很有用)。</li></ul><p id="5676" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下面是我的<code class="fe mh mi mj mk b">.Rprofile</code>的一个例子:</p><figure class="mz na nb nc gt ju"><div class="bz fp l di"><div class="nd ne l"/></div></figure><h1 id="95a3" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">让您的数据库查询包装函数</h1><p id="5a10" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">如果您经常使用 R 来查询数据库，那么您应该考虑更好地组织您的文件结构，并编写包装器函数来使您的生活更加轻松。首先，你应该把所有的 R 文件放在一个文件夹里，把所有的 SQL 文件放在另一个文件夹里。有些人喜欢将 SQL 命令直接写入 R 函数或脚本中，我认为这不是最佳做法，它会使您的 R 代码变得难看，并且您的 SQL 代码不能被另一个 R 代码重用。组织好后，你可以编写下面的包装函数:</p><figure class="mz na nb nc gt ju"><div class="bz fp l di"><div class="nd ne l"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">Wrapper Functions for database query</figcaption></figure><ul class=""><li id="37b8" class="ml mm it ki b kj kk kn ko kr mn kv mo kz mp ld mq mr ms mt bi translated"><code class="fe mh mi mj mk b">connect_db</code>是一个包装函数，在您调用驱动程序并使用 url 和凭证建立数据库连接后，它会返回一个数据库连接处理程序。</li><li id="428c" class="ml mm it ki b kj mu kn mv kr mw kv mx kz my ld mq mr ms mt bi translated"><code class="fe mh mi mj mk b">get_sql</code>是 SQL 文件解析器。</li><li id="a87a" class="ml mm it ki b kj mu kn mv kr mw kv mx kz my ld mq mr ms mt bi translated">是您调用来执行查询的函数，在这里您可以发送一个 sql 文件路径或一个纯 SQL 字符串。您可以通过<code class="fe mh mi mj mk b">DBI::sqlInterpolate</code>函数向函数传递额外的参数来替换 SQL 查询中的参数。最重要的是，我们需要在执行查询后关闭连接。</li></ul><p id="b4f9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">使用上面的包装器函数，所以您可以通过简单地调用下面的命令来执行 SQL 查询。</p><pre class="mz na nb nc gt nf mk ng nh aw ni bi"><span id="519f" class="nj lf it mk b gy nk nl l nm nn"># String based query<br/>accounts &lt;- db_query('select count(*) from accounts where created_at &lt; ?time', time = '2019-01-01')</span><span id="4aee" class="nj lf it mk b gy no nl l nm nn"># File based query<br/>accounts &lt;- db_query('sql/accounts.sql', time = '2019-01-01')</span></pre><p id="04d6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您可以轻松地用更多的功能来扩展上述包装函数，比如删除、加载等。来满足你的需求。</p><h1 id="f630" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">退出时不要保存<code class="fe mh mi mj mk b">Workspace</code>数据</h1><p id="2ca6" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">如果您在终端中使用 R 命令行工具来完成所有工作，那么当您想要退出 R 会话时，系统会询问您是否保存您的工作区数据。如果选择保存工作区数据，一个隐藏的"。RData”文件将创建在您的工作目录中。如果您的工作空间仅包含少量数据，则可以保存数据。但是，如果您的工作空间包含大量数据(512MB 或更多)，保存过程可能需要很长时间才能执行，因为工作空间数据需要压缩到文件中，这对于大数据来说很慢。所以，我个人的建议是，千万不要保存工作区数据存储。如果您使用 RStudio，您可以设置如下选项。如果你真的想在某些场合保存数据，你可以在退出前简单地调用<code class="fe mh mi mj mk b">save</code>命令。</p><figure class="mz na nb nc gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi np"><img src="../Images/a8cdc5e14b6bf39ec9acf11dd4f3be6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dUNl71Jic2zYhYS2hxOBZA.png"/></div></div></figure><h1 id="3488" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">包装开发</h1><h2 id="183d" class="nj lf it bd lg nq nr dn lk ns nt dp lo kr nu nv ls kv nw nx lw kz ny nz ma oa bi translated"><strong class="ak">包重装</strong></h2><p id="ac47" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">如果您正在编写一个 R 包，并且想要重新加载整个开发包而不重新启动 R 会话并因此丢失数据，您可以使用<code class="fe mh mi mj mk b">devtools</code>包中的函数<code class="fe mh mi mj mk b">devtools::reload()</code>来实现。在 RStudio 中，重新加载的快捷方式是<code class="fe mh mi mj mk b">CMD + SHIFT + L</code>。</p><h2 id="2ca0" class="nj lf it bd lg nq nr dn lk ns nt dp lo kr nu nv ls kv nw nx lw kz ny nz ma oa bi translated"><strong class="ak">包装文件</strong></h2><p id="14a0" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">在你的包的函数内部，你可以按<code class="fe mh mi mj mk b">CMD + Option + Shift + R</code>调用<code class="fe mh mi mj mk b">Roxygen2</code>为你的函数生成一个文档骨架，如下图所示。</p><figure class="mz na nb nc gt ju gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/260312487008377999221bd2164d91b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1008/format:webp/1*Hqhu2Vagcvk7eEBcX41K5A.png"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">Package Documentation Skeleton generated by Roxygen2</figcaption></figure><h1 id="64b5" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">RStudio 代码设置</h1><p id="b45d" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">我是 RStudio 的忠实用户，使用 RStudio 已经超过 4 年了。下面是我对 RStudio 的代码设置建议。目的是让编码体验更加愉悦高效。</p><figure class="mz na nb nc gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oc"><img src="../Images/08a76ef9e7bfcd9013a24ba73a9818e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t_oWTn6zq2qgSH03cDbOpw.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">Display Setting</figcaption></figure><figure class="mz na nb nc gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi od"><img src="../Images/81ba928a072904cc0b211266eec91210.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YZoPWVm2ELTYdKmfI2oi3A.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">Saving Setting</figcaption></figure><h1 id="70db" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">发展环境</h1><p id="636c" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">我相信 99%的 R 用户使用 RStudio 作为他们主要的 R 编程 IDE。RStudio IDE 有两个主要产品。一个是 RStudio 桌面，一个是 RStudio 服务器。大多数 R 用户从桌面版本开始，主要用于特定的分析和模型开发。如果他们的需求扩展到模型部署、任务自动化、闪亮的网站、仪表板、报告等。，那么服务器版本就成了更好的选择。如果您使用服务器版本，为了更好的软件管理，您最好在您的服务器上创建您的开发、试运行和生产环境。对我来说，我只有一台 EC2 服务器，没有三台分别用于开发、试运行和生产环境的专用服务器。作为一种变通方法，您可以在 git 和 Github 控制的三个不同的文件夹版本中创建三个 R 项目，以模拟开发、登台和生产环境，如下所示:</p><figure class="mz na nb nc gt ju gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/ce7f1ea4a7b07a0437dde72c02d7cd5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:912/format:webp/1*MKM-g1xHViBTlBxyQklnNA.png"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">Environment Management</figcaption></figure><ul class=""><li id="0b32" class="ml mm it ki b kj kk kn ko kr mn kv mo kz mp ld mq mr ms mt bi translated"><strong class="ki iu"> dev </strong>:它是我建模和分析的沙盒。</li><li id="6740" class="ml mm it ki b kj mu kn mv kr mw kv mx kz my ld mq mr ms mt bi translated"><strong class="ki iu"> stg </strong>:这是一个新特性的测试环境。</li><li id="e250" class="ml mm it ki b kj mu kn mv kr mw kv mx kz my ld mq mr ms mt bi translated"><strong class="ki iu"> prod </strong>:它包含用于生成报告、仪表板和自动化任务的代码和 cron 作业。在生产环境中，您应该只通过 git pull 更改代码，而不要手动更改。</li></ul><p id="dd0d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果您使用 RStudio server 的免费版本，在项目之间切换将会重新启动 R 会话，因此会丢失数据。如果使用 RStudio Pro 版本，可以在浏览器中并排运行 3 R 会话，更加方便。</p></div></div>    
</body>
</html>