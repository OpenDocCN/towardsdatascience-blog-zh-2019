<html>
<head>
<title>Building A ‘Serverless’ Chrome Extension</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建一个“无服务器”的 Chrome 扩展</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/building-a-serverless-chrome-extension-f684740e1ffc?source=collection_archive---------8-----------------------#2019-05-30">https://towardsdatascience.com/building-a-serverless-chrome-extension-f684740e1ffc?source=collection_archive---------8-----------------------#2019-05-30</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/68a235d2eafdcaea10ac7120eba8e863.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hTYxztUu7iXEoSZ2-LUkxw.jpeg"/></div></div></figure><p id="7732" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是一个关于构建利用无服务器架构的 Chrome 扩展的教程。具体来说——我们将在 Chrome 扩展的后端使用谷歌云功能，为我们做一些奇特的 Python 魔术。</p><p id="c476" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们将构建的扩展是 SummarLight Chrome 扩展:</p><div class="kw kx gp gr ky kz"><a href="https://medium.com/@btahir/introducing-summary-light-a-chrome-extension-that-highlights-the-most-important-parts-of-an-1666e10411a8" rel="noopener follow" target="_blank"><div class="la ab fo"><div class="lb ab lc cl cj ld"><h2 class="bd ir gy z fp le fr fs lf fu fw ip bi translated">介绍 summary light——一个 Chrome 扩展，它突出了</h2><div class="lg l"><p class="bd b dl z fp le fr fs lf fu fw dk translated">medium.com</p></div></div><div class="lh l"><div class="li l lj lk ll lh lm jw kz"/></div></div></a></div><p id="ee8a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">SummarLight 扩展获取你当前所在网页的文本(大概是一个像我这样的媒体上的很酷的博客),并突出显示那个页面/文章最重要的部分。</p><p id="44c5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了做到这一点，我们将设置一个 UI(在本例中是一个按钮),它将把当前网页上的文本发送到我们的后端。在这种情况下，“后端”将是一个谷歌云功能，它将分析文本并返回其摘要(该文本中最重要的句子)。</p><h1 id="4ed9" class="ln lo iq bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">体系结构</h1><figure class="ml mm mn mo gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/68a235d2eafdcaea10ac7120eba8e863.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hTYxztUu7iXEoSZ2-LUkxw.jpeg"/></div></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk">A Simple &amp; Flexible Architecture</figcaption></figure><p id="1f12" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">正如我们所见，该架构非常简单灵活。你可以设置一个简单的用户界面，比如一个应用程序，或者在这种情况下，一个 Chrome 扩展，然后把任何复杂的工作交给你的无服务器功能。您可以轻松地更改函数中的逻辑，并重新部署它来尝试其他方法。最后，您可以根据需要扩展它以支持任意多的 API 调用。</p><p id="33c7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这不是一篇关于无服务器的好处的文章，所以我不会详细讨论使用它优于传统服务器的优点。但是通常情况下，无服务器解决方案会便宜得多并且可伸缩(但并不总是这样…取决于您的使用情况)。</p><h1 id="989f" class="ln lo iq bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated">Chrome 扩展</h1><p id="0827" class="pw-post-body-paragraph jy jz iq ka b kb mt kd ke kf mu kh ki kj mv kl km kn mw kp kq kr mx kt ku kv ij bi translated">这里有一个关于 Chrome 扩展设置的很好的指南:</p><div class="kw kx gp gr ky kz"><a href="https://www.freecodecamp.org/news/how-to-create-and-publish-a-chrome-extension-in-20-minutes-6dc8395d7153/" rel="noopener  ugc nofollow" target="_blank"><div class="la ab fo"><div class="lb ab lc cl cj ld"><h2 class="bd ir gy z fp le fr fs lf fu fw ip bi translated">如何在 20 分钟内创建并发布一个 Chrome 扩展</h2><div class="my l"><h3 class="bd b gy z fp le fr fs lf fu fw dk translated">如何在 20 分钟内创建并发布 Chrome 扩展</h3></div><div class="lg l"><p class="bd b dl z fp le fr fs lf fu fw dk translated">www.freecodecamp.org</p></div></div><div class="lh l"><div class="mz l lj lk ll lh lm jw kz"/></div></div></a></div><p id="2383" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">SummarLight 扩展的所有代码都可以在这里找到:</p><div class="kw kx gp gr ky kz"><a href="https://github.com/btahir/summarlight" rel="noopener  ugc nofollow" target="_blank"><div class="la ab fo"><div class="lb ab lc cl cj ld"><h2 class="bd ir gy z fp le fr fs lf fu fw ip bi translated">btahir/summary light</h2><div class="my l"><h3 class="bd b gy z fp le fr fs lf fu fw dk translated">Summarlight Chrome 扩展突出了帖子/故事/文章中最重要的部分。-btahir/summary light</h3></div><div class="lg l"><p class="bd b dl z fp le fr fs lf fu fw dk translated">github.com</p></div></div><div class="lh l"><div class="na l lj lk ll lh lm jw kz"/></div></div></a></div><p id="fa39" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">根目录中的 main.py 文件是我们定义 Google Cloud 函数的地方。extension_bundle 文件夹包含了创建 Chrome 扩展的所有文件。</p><p id="45ee" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">谷歌云功能</strong></p><p id="a360" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我选择了谷歌而不是 AWS Lamba，因为我有一些免费的学分(感谢谷歌！)但是你也可以用 AWS 轻松做到。对我来说，这是一个巨大的优势，他们刚刚发布了 Python 的谷歌云功能，因为我用这种美丽的语言处理大部分数据。</p><p id="f13d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您可以在此了解有关部署谷歌云功能的更多信息:</p><div class="kw kx gp gr ky kz"><a href="https://cloud.google.com/functions/docs/deploying/filesystem" rel="noopener  ugc nofollow" target="_blank"><div class="la ab fo"><div class="lb ab lc cl cj ld"><h2 class="bd ir gy z fp le fr fs lf fu fw ip bi translated">从本地计算机部署|云功能文档| Google 云</h2><div class="my l"><h3 class="bd b gy z fp le fr fs lf fu fw dk translated">无论您的企业是刚刚踏上数字化转型之旅，还是已经走上数字化转型之路，谷歌云的解决方案…</h3></div><div class="lg l"><p class="bd b dl z fp le fr fs lf fu fw dk translated">cloud.google.com</p></div></div></div></a></div><p id="70c0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我强烈推荐使用 gcloud sdk，并从 hello_world 示例开始。您可以在他们提供的 main.py 文件中编辑您需要的函数。这是我的函数:</p><pre class="ml mm mn mo gt nb nc nd ne aw nf bi"><span id="6c3e" class="ng lo iq nc b gy nh ni l nj nk">import sys<br/>from flask import escape<br/>from gensim.summarization import summarize<br/>import requests<br/>import json<br/><br/><br/>def read_article(file_json):<br/>    article = ''<br/>    filedata = json.dumps(file_json)<br/>    if len(filedata) &lt; 100000:<br/>        article = filedata<br/>    return article<br/><br/>def generate_summary(request):<br/>    <br/>    request_json = request.get_json(silent=True)<br/>    sentences =  read_article(request_json)<br/><br/>    summary = summarize(sentences, ratio=0.3)<br/>    summary_list = summary.split('.')<br/>    for i, v in enumerate(summary_list):<br/>        summary_list[i] = v.strip() + '.'<br/>    summary_list.remove('.')<br/><br/>    return json.dumps(summary_list)</span></pre><p id="0901" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">相当直接。我通过 read_article()函数接收一些文本，然后使用 awesome Gensim 库返回这些文本的摘要。Gensim Summary 函数的工作原理是按照重要性对所有句子进行排序。在这种情况下，我选择返回最重要句子的前 30%。这将突出文章/博客的前三分之一。</p><p id="c8b7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">替代方法:</strong>我尝试了不同的摘要方法，包括使用手套词嵌入，但结果并不比 Gensim 好多少(特别是考虑到由于加载这些大规模嵌入而增加的处理计算/时间)。尽管如此，这里仍有很大的改进空间。这是一个活跃的研究领域，并且正在开发更好的文本摘要方法:</p><div class="kw kx gp gr ky kz"><a href="http://nlpprogress.com/english/summarization.html" rel="noopener  ugc nofollow" target="_blank"><div class="la ab fo"><div class="lb ab lc cl cj ld"><h2 class="bd ir gy z fp le fr fs lf fu fw ip bi translated">摘要</h2><div class="my l"><h3 class="bd b gy z fp le fr fs lf fu fw dk translated">知识库跟踪自然语言处理(NLP)的进展，包括数据集和当前…</h3></div><div class="lg l"><p class="bd b dl z fp le fr fs lf fu fw dk translated">nlpprogress.com</p></div></div></div></a></div><p id="4974" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">一旦我们对这个功能很满意，我们就可以部署它，它将在一个 HTTP 端点上可用，我们可以从我们的应用程序/扩展调用它。</p><p id="c5b3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">扩展包</strong></p><p id="9c97" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在是前端。首先，我们需要一份 popup.html 档案。这将处理 UI 部分。它将创建一个带有按钮的菜单。</p><pre class="ml mm mn mo gt nb nc nd ne aw nf bi"><span id="b2ad" class="ng lo iq nc b gy nh ni l nj nk">&lt;!DOCTYPE html&gt;<br/>&lt;html&gt;<br/>  &lt;head&gt;<br/>    &lt;link rel="stylesheet" href="styles.css"&gt;<br/>  &lt;/head&gt;<br/>  &lt;body&gt;<br/>    &lt;ul&gt;<br/>    	&lt;li&gt;<br/>      &lt;a&gt;&lt;button id="clickme" class="dropbtn"&gt;Highlight Summary&lt;/button&gt;&lt;/a&gt;<br/>      &lt;script type="text/javascript" src="popup.js" charset="utf-8"&gt;&lt;/script&gt;<br/>    	&lt;/li&gt;<br/>    &lt;/ul&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="c5eb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">正如我们所看到的,“Highlight Summary”按钮有一个触发 popup.js 文件的 onClick 事件。这将依次调用 summarize 函数:</p><pre class="ml mm mn mo gt nb nc nd ne aw nf bi"><span id="731e" class="ng lo iq nc b gy nh ni l nj nk">function summarize() {<br/>	chrome.tabs.executeScript(null, { file: "jquery-2.2.js" }, function() {<br/>	    chrome.tabs.executeScript(null, { file: "content.js" });<br/>	});<br/>}<br/>document.getElementById('clickme').addEventListener('click', summarize);</span></pre><p id="8158" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">summarize 函数调用 content.js 脚本(是的是的，我知道我们可以避免这个额外的步骤……)。</p><pre class="ml mm mn mo gt nb nc nd ne aw nf bi"><span id="580f" class="ng lo iq nc b gy nh ni l nj nk">alert("Generating summary highlights. This may take up to 30 seconds depending on length of article.");<br/><br/>function unicodeToChar(text) {<br/>	return text.replace(/\\u[\dA-F]{4}/gi, <br/>	      function (match) {<br/>	           return String.fromCharCode(parseInt(match.replace(/\\u/g, ''), 16));<br/>	      });<br/>}<br/><br/>// capture all text<br/>var textToSend = document.body.innerText;<br/><br/>// summarize and send back<br/>const api_url = 'YOUR_GOOGLE_CLOUD_FUNCTION_URL';<br/><br/>fetch(api_url, {<br/>  method: 'POST',<br/>  body: JSON.stringify(textToSend),<br/>  headers:{<br/>    'Content-Type': 'application/json'<br/>  } })<br/>.then(data =&gt; { return data.json() })<br/>.then(res =&gt; { <br/>	$.each(res, function( index, value ) {<br/>		value = unicodeToChar(value).replace(/\\n/g, '');<br/>		document.body.innerHTML = document.body.innerHTML.split(value).join('&lt;span style="background-color: #fff799;"&gt;' + value + '&lt;/span&gt;');<br/>	});<br/> })<br/>.catch(error =&gt; console.error('Error:', error));</span></pre><p id="204f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这里是我们解析当前页面的 html(document . body . innertext)的地方，在用 unicodeToChar 函数进行了一些预处理之后，我们通过 Fetch API 将它发送给我们的 Google Cloud 函数。为此，您可以在 api_url 变量中添加自己的 HTTP 端点 url。</p><p id="47be" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">同样，利用 Fetch，我们返回一个承诺，这是从我们的无服务器函数生成的摘要。一旦我们解决了这个问题，我们就可以通过页面的 html 内容解析这个循环，并突出显示摘要中的句子。</p><p id="0a66" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">由于完成所有这些处理可能需要一点时间，我们在页面顶部添加了一个警告来表明这一点(“生成摘要突出显示。根据文章的长度，这可能需要 30 秒钟。”).</p><p id="1dac" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">最后，我们需要创建一个 manifest.json 文件来发布扩展:</p><pre class="ml mm mn mo gt nb nc nd ne aw nf bi"><span id="b648" class="ng lo iq nc b gy nh ni l nj nk">{<br/>  "manifest_version": 2,<br/>  "name": "SummarLight",<br/>  "version": "0.7.5",<br/>  "permissions": ["activeTab", "YOUR_GOOGLE_CLOUD_FUNCTION_URL"],<br/>  "description": "Highlights the most important parts of posts/stories/articles!",<br/>  "icons": {"16": "icon16.png",<br/>            "48": "icon48.png",<br/>            "128": "icon128.png" },<br/>  "browser_action": {<br/>   "default_icon": "tab-icon.png",<br/>   "default_title": "Highlight the important stuff",<br/>   "default_popup": "popup.html"<br/>  }<br/>}</span></pre><p id="5ac0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">注意“权限”选项卡。我们必须在这里添加我们的 Google Cloud 函数 URL，以确保当我们通过 Fetch API 调用我们的函数时不会出现 CORS 错误。我们还填写了名称/描述和图标等细节，以便在 Google Store 上显示我们的 Chrome 扩展。</p><p id="ca07" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">就是这样！我们已经创建了一个 Chrome 扩展，它利用了一个无服务器的主干网，也就是谷歌云功能。最终效果是这样的:</p><figure class="ml mm mn mo gt jr"><div class="bz fp l di"><div class="nl nm l"/></div><figcaption class="mp mq gj gh gi mr ms bd b be z dk">A demo of SummarLight</figcaption></figure><p id="d222" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是一种简单而有效的方式来构建真正酷的应用程序/扩展。想想你用 Python 做过的一些东西。现在你可以把你的脚本挂在一个扩展/应用程序的按钮上，然后用它做一个好的产品。无需担心任何服务器或配置。</p><p id="bc3c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">下面是 Github 回购:<a class="ae nn" href="https://github.com/btahir/summarlight" rel="noopener ugc nofollow" target="_blank">https://github.com/btahir/summarlight</a></p><p id="5250" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你可以自己使用分机。这是谷歌商店的直播:</p><div class="kw kx gp gr ky kz"><a href="https://chrome.google.com/webstore/detail/summarlight/ligjmagakdphdlenhhncfegpdbbendlg?hl=en-US&amp;gl=US" rel="noopener  ugc nofollow" target="_blank"><div class="la ab fo"><div class="lb ab lc cl cj ld"><h2 class="bd ir gy z fp le fr fs lf fu fw ip bi translated">摘要灯</h2><div class="my l"><h3 class="bd b gy z fp le fr fs lf fu fw dk translated">突出文章最重要的部分！</h3></div><div class="lg l"><p class="bd b dl z fp le fr fs lf fu fw dk translated">chrome.google.com</p></div></div><div class="lh l"><div class="no l lj lk ll lh lm jw kz"/></div></div></a></div><p id="38b4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">请在评论中分享你对利用谷歌云功能的扩展(或应用)的想法。:)</p><p id="8fd7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">干杯。</p></div></div>    
</body>
</html>