<html>
<head>
<title>Building Machine Learning Apps with Streamlit</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Streamlit 构建机器学习应用</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/building-machine-learning-apps-with-streamlit-667cef3ff509?source=collection_archive---------19-----------------------#2019-10-22">https://towardsdatascience.com/building-machine-learning-apps-with-streamlit-667cef3ff509?source=collection_archive---------19-----------------------#2019-10-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/f66f042c5c481314ed3e7fc53ab4eee3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jsR5fwxRhrhV7vcwiLZU1g.png"/></div></div></figure><div class=""/><p id="d625" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><a class="ae kz" href="https://streamlit.io/docs/" rel="noopener ugc nofollow" target="_blank"> Streamlit </a>是一个开源的 Python 库，可以轻松构建漂亮的机器学习应用。你可以通过<em class="la"> pip </em>在你的终端上轻松安装它，然后开始用 Python 编写你的网络应用。</p><p id="78f9" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在这篇文章中，我将展示一些关于 Streamlit 的有趣功能，构建一个以检查数据为目的的应用程序，并在其上构建 ML 模型。为此，我将使用非常基本的 Iris 数据集，并对其进行一些分类。然而，如果你对这个工具更高级的潜力感兴趣，我建议你阅读<a class="ae kz" href="https://streamlit.io/docs/tutorial/create_a_data_explorer_app.html" rel="noopener ugc nofollow" target="_blank">这个教程</a>。</p><p id="13c7" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">说到这里，让我们开始构建我们的应用程序。我将把我所有的代码写在一个名为 iris.py 的文件中，这样我就可以通过<em class="la"> streamlit iris.py </em>从我的终端运行它。</p><p id="4d52" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">最后，我的应用程序的完整代码如下:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="7ac3" class="lk ll je lg b gy lm ln l lo lp">import streamlit as st<br/>import pandas as pd<br/>import numpy as np<br/>import plotly.express as px<br/>import seaborn as sns<br/>import matplotlib.pyplot as plt<br/>import plotly.graph_objects as go</span><span id="fe0b" class="lk ll je lg b gy lq ln l lo lp">st.title('Iris')</span><span id="42cb" class="lk ll je lg b gy lq ln l lo lp">df = pd.read_csv("iris.csv")</span><span id="1f67" class="lk ll je lg b gy lq ln l lo lp">if st.checkbox('Show dataframe'):<br/>    st.write(df)</span><span id="d111" class="lk ll je lg b gy lq ln l lo lp">st.subheader('Scatter plot')</span><span id="29f7" class="lk ll je lg b gy lq ln l lo lp">species = st.multiselect('Show iris per variety?', df['variety'].unique())<br/>col1 = st.selectbox('Which feature on x?', df.columns[0:4])<br/>col2 = st.selectbox('Which feature on y?', df.columns[0:4])</span><span id="1381" class="lk ll je lg b gy lq ln l lo lp">new_df = df[(df['variety'].isin(species))]<br/>st.write(new_df)<br/># create figure using plotly express<br/>fig = px.scatter(new_df, x =col1,y=col2, color='variety')<br/># Plot!</span><span id="9b41" class="lk ll je lg b gy lq ln l lo lp">st.plotly_chart(fig)</span><span id="abcc" class="lk ll je lg b gy lq ln l lo lp">st.subheader('Histogram')</span><span id="358d" class="lk ll je lg b gy lq ln l lo lp">feature = st.selectbox('Which feature?', df.columns[0:4])<br/># Filter dataframe<br/>new_df2 = df[(df['variety'].isin(species))][feature]<br/>fig2 = px.histogram(new_df, x=feature, color="variety", marginal="rug")<br/>st.plotly_chart(fig2)</span><span id="39aa" class="lk ll je lg b gy lq ln l lo lp">st.subheader('Machine Learning models')</span><span id="0874" class="lk ll je lg b gy lq ln l lo lp">from sklearn.model_selection import train_test_split<br/>from sklearn.tree import DecisionTreeClassifier<br/>from sklearn.metrics import confusion_matrix<br/>from sklearn.svm import SVC</span><span id="c3ff" class="lk ll je lg b gy lq ln l lo lp">features= df[['sepal.length', 'sepal.width', 'petal.length', 'petal.width']].values<br/>labels = df['variety'].values</span><span id="cde0" class="lk ll je lg b gy lq ln l lo lp">X_train,X_test, y_train, y_test = train_test_split(features, labels, train_size=0.7, random_state=1)</span><span id="8ece" class="lk ll je lg b gy lq ln l lo lp">alg = ['Decision Tree', 'Support Vector Machine']<br/>classifier = st.selectbox('Which algorithm?', alg)<br/>if classifier=='Decision Tree':<br/>    dtc = DecisionTreeClassifier()<br/>    dtc.fit(X_train, y_train)<br/>    acc = dtc.score(X_test, y_test)<br/>    st.write('Accuracy: ', acc)<br/>    pred_dtc = dtc.predict(X_test)<br/>    cm_dtc=confusion_matrix(y_test,pred_dtc)<br/>    st.write('Confusion matrix: ', cm_dtc)</span><span id="afb2" class="lk ll je lg b gy lq ln l lo lp">elif classifier == 'Support Vector Machine':<br/>    svm=SVC()<br/>    svm.fit(X_train, y_train)<br/>    acc = svm.score(X_test, y_test)<br/>    st.write('Accuracy: ', acc)<br/>    pred_svm = svm.predict(X_test)<br/>    cm=confusion_matrix(y_test,pred_svm)<br/>    st.write('Confusion matrix: ', cm)</span></pre><p id="da5b" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在，让我们检查每段代码。首先，一旦导入了所需的包，我想设置我的应用程序的标题并导入我的数据:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="736a" class="lk ll je lg b gy lm ln l lo lp">import streamlit as st<br/>import pandas as pd<br/>import numpy as np<br/>import plotly.express as px<br/>import seaborn as sns<br/>import matplotlib.pyplot as plt<br/>import plotly.graph_objects as go</span><span id="884c" class="lk ll je lg b gy lq ln l lo lp">st.title('Iris')</span><span id="ce1d" class="lk ll je lg b gy lq ln l lo lp">df = pd.read_csv("iris.csv")</span></pre><p id="cd23" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在我想要第一个选项，它允许用户决定是否显示整个数据集。我可以用下面的语法做到这一点(以及许多其他交互小部件):</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="fe42" class="lk ll je lg b gy lm ln l lo lp">if st.checkbox('Show dataframe'): <br/>     st.write(df)</span></pre><p id="d9bd" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">尽管天真，我们已经可以启动我们的婴儿应用程序，并在 localhost:8501:</p><figure class="lb lc ld le gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi lr"><img src="../Images/7c57a2fc15ace216f35b3964f11ece8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qvpMb-o7FHMXDyew"/></div></div></figure><p id="dcfd" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如您所见，我决定显示我的数据集，但是，在任何时候，我都可以通过取消选中该框来隐藏它。</p><p id="1e32" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在让我们转向一些可视化工具。假设我想要散点图我的数据，有可能选择那些我感兴趣的要素和标签。</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="3850" class="lk ll je lg b gy lm ln l lo lp">species = st.multiselect('Show iris per variety?', df['variety'].unique())<br/>col1 = st.selectbox('Which feature on x?', df.columns[0:4])<br/>col2 = st.selectbox('Which feature on y?', df.columns[0:4])</span><span id="87a8" class="lk ll je lg b gy lq ln l lo lp">new_df = df[(df['variety'].isin(species))]<br/>st.write(new_df)<br/>fig = px.scatter(new_df, x =col1,y=col2, color='variety')</span><span id="0064" class="lk ll je lg b gy lq ln l lo lp">st.plotly_chart(fig)</span></pre><figure class="lb lc ld le gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ls"><img src="../Images/49d8b6234cd92855d5934c75385df0d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*YJj9bdspKByQ1TR2"/></div></div></figure><p id="2199" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">正如你所看到的，在我选择的例子中，物种杂色和海滨锦鸡儿的特征是萼片长度和萼片宽度，但我可以随时改变它们，并实时更新我的所有图表。</p><p id="1c62" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在，我想用同样的逻辑添加一个直方图，显示任何特征的分布。此外，我想有可能绘制出每个特征的 3 个条件分布，相对于以前选择的品种。因此:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="4bcc" class="lk ll je lg b gy lm ln l lo lp">feature = st.selectbox('Which feature?', df.columns[0:4])<br/># Filter dataframe<br/>new_df2 = df[(df['variety'].isin(species))][feature]<br/>fig2 = px.histogram(new_df, x=feature, color="variety", marginal="rug")<br/>st.plotly_chart(fig2)</span></pre><figure class="lb lc ld le gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi lr"><img src="../Images/caa436f9054946caca0bc494d35d472b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*TzA9tGKbuFTrGyj4"/></div></div></figure><p id="95b1" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这两个物种和我上面选的是一样的，而且，我可以随时改变它们。</p><p id="67e4" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在让我们进入最后一部分，即训练实时 ML 算法，并让用户决定应用哪一种算法。为此，我将在 S <a class="ae kz" href="https://medium.com/swlh/support-vector-machine-from-scratch-ce095a47dc5c" rel="noopener">支持向量机</a>和 D <a class="ae kz" href="https://medium.com/analytics-vidhya/visualizing-decision-tree-with-r-774f58ac23c" rel="noopener">决策树</a>这两种分类算法之间进行选择。对于每一个问题，我会让我的应用程序打印准确性(正确分类的数量/观察总数)和混淆矩阵:</p><pre class="lb lc ld le gt lf lg lh li aw lj bi"><span id="a9ef" class="lk ll je lg b gy lm ln l lo lp">from sklearn.model_selection import train_test_split<br/>from sklearn.tree import DecisionTreeClassifier<br/>from sklearn.metrics import confusion_matrix<br/>from sklearn.svm import SVC</span><span id="c24b" class="lk ll je lg b gy lq ln l lo lp">features= df[['sepal.length', 'sepal.width', 'petal.length', 'petal.width']].values<br/>labels = df['variety'].values</span><span id="d3eb" class="lk ll je lg b gy lq ln l lo lp">X_train,X_test, y_train, y_test = train_test_split(features, labels, train_size=0.7, random_state=1)</span><span id="3b8b" class="lk ll je lg b gy lq ln l lo lp">alg = ['Decision Tree', 'Support Vector Machine']<br/>classifier = st.selectbox('Which algorithm?', alg)<br/>if classifier=='Decision Tree':<br/>    dtc = DecisionTreeClassifier()<br/>    dtc.fit(X_train, y_train)<br/>    acc = dtc.score(X_test, y_test)<br/>    st.write('Accuracy: ', acc)<br/>    pred_dtc = dtc.predict(X_test)<br/>    cm_dtc=confusion_matrix(y_test,pred_dtc)<br/>    st.write('Confusion matrix: ', cm_dtc)</span><span id="24f2" class="lk ll je lg b gy lq ln l lo lp">elif classifier == 'Support Vector Machine':<br/>    svm=SVC()<br/>    svm.fit(X_train, y_train)<br/>    acc = svm.score(X_test, y_test)<br/>    st.write('Accuracy: ', acc)<br/>    pred_svm = svm.predict(X_test)<br/>    cm=confusion_matrix(y_test,pred_svm)<br/>    st.write('Confusion matrix: ', cm)</span></pre><figure class="lb lc ld le gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi lr"><img src="../Images/2028a25b0fd9528cc07ab2ec000b7253.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*BPQ2nVn2gFUaeEYU"/></div></div></figure><p id="0c7c" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">那么，如果我选择 SVM:</p><figure class="lb lc ld le gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi lr"><img src="../Images/92d69e16b8ddc09f61bd63f99ff46bde.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Rrsfp6eX0hwX93Rt"/></div></div></figure><p id="8134" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">因此，我们能够以一种非常用户友好的方式即时比较两个分类器的性能。</p><p id="1211" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">Streamlit 是一个非常强大的工具，特别是如果您想要提供一种交互式的方式来理解您的分析结果:它允许实时可视化您的数据，并有可能过滤它们，它允许有意义的表示。</p><p id="0e51" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在这里，我向您展示了使用 Streamlit 可以实现的非常基本的实现，因此，如果您想更深入地研究这个工具，我推荐您进一步阅读参考资料。</p><p id="c583" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd jf">参考文献</strong>:</p><ul class=""><li id="c154" class="lt lu je kd b ke kf ki kj km lv kq lw ku lx ky ly lz ma mb bi translated"><a class="ae kz" href="https://streamlit.io/docs/" rel="noopener ugc nofollow" target="_blank">https://streamlit.io/docs/</a></li><li id="fec0" class="lt lu je kd b ke mc ki md km me kq mf ku mg ky ly lz ma mb bi translated"><a class="ae kz" href="https://streamlit.io/docs/tutorial/index.html" rel="noopener ugc nofollow" target="_blank">https://streamlit.io/docs/tutorial/index.html</a></li></ul></div><div class="ab cl mh mi hx mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="im in io ip iq"><p id="6e36" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="la">原载于 2019 年 10 月 22 日</em><a class="ae kz" href="https://datasciencechalktalk.com/2019/10/22/building-machine-learning-apps-with-streamlit/" rel="noopener ugc nofollow" target="_blank"><em class="la">http://datasciencechalktalk.com</em></a><em class="la">。</em></p></div></div>    
</body>
</html>