<html>
<head>
<title>A gentle Introduction to Customer Segmentation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">客户细分的简明介绍</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/a-gentle-introduction-to-customer-segmentation-375fb4346a33?source=collection_archive---------21-----------------------#2019-05-29">https://towardsdatascience.com/a-gentle-introduction-to-customer-segmentation-375fb4346a33?source=collection_archive---------21-----------------------#2019-05-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="adf2" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用 K-Means 聚类来理解营销响应</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/7793f655b6936f6ab9d1de4675864d23.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*bvG79j_XdVUPEcr5"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Photo by <a class="ae ky" href="https://unsplash.com/@nickkarvounis?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Nick Karvounis</a> on <a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="7b83" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">概观</h1><p id="c525" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">我这篇文章的目的是要表明，你并不总是需要超级复杂和精密的机器学习模型来从你的数据中获得有意义的见解。</p><p id="9b51" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">对于这个迷你项目，我使用流行的<a class="ae ky" href="https://en.wikipedia.org/wiki/K-means_clustering" rel="noopener ugc nofollow" target="_blank"> <strong class="lt iu"> K-Means 聚类</strong> </a>算法，根据客户对一系列<strong class="lt iu">营销活动</strong>的反应对他们进行细分。这种技术相对容易实现，但它允许我从我的数据中收集大量信息，并挖掘我的客户群中有趣的行为模式。</p><h1 id="b6e6" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">什么是市场细分？</h1><p id="efa0" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated"><a class="ae ky" href="https://en.wikipedia.org/wiki/Market_segmentation" rel="noopener ugc nofollow" target="_blank"> <strong class="lt iu">市场细分</strong> </a>是指根据共同的属性、兴趣和行为将现有和/或潜在客户的消费市场划分为多个群体(或细分市场)的过程。</p><p id="2857" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">基本概念是，拥有共同特征的消费者更有可能以相似的方式对营销传播做出回应，这样公司就可以以更相关、更有效的方式接触每个群体。</p><h1 id="601d" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">什么是 K-Means 聚类？</h1><p id="d772" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated"><strong class="lt iu"> K-Means 聚类</strong>是<a class="ae ky" href="https://en.wikipedia.org/wiki/Unsupervised_learning" rel="noopener ugc nofollow" target="_blank"> <strong class="lt iu">无监督学习</strong> </a>建模家族的一部分，这是一套用于在尚未标记、分类或归类的数据中寻找模式的技术。由于这种方法不要求有一个聚类目标，它可以在客户细分的探索阶段有很大的帮助。</p><p id="e110" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">基本思想是，分配到一个组的客户尽可能相似，而属于不同组的客户尽可能不相似。每个聚类由其<code class="fe ms mt mu mv b">centre</code>表示，对应于分配给该聚类的元素的平均值。</p><p id="af6f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">为了说明这个原理，假设你有一组像下图中那样的元素，并想把它们分成<strong class="lt iu"> 3 个簇</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mw"><img src="../Images/98fbd6e0bbfe70e518d85db1123c1287.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iXQrCb6wENe7sbxDMrR_UA.png"/></div></div></figure><p id="1bdf" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">K-Means 将为您做的是将它们分组在每个簇的中间或<code class="fe ms mt mu mv b">centre</code>，这里用<strong class="lt iu">“X”的</strong>表示，以最小化每个元素到其<code class="fe ms mt mu mv b">centre</code>的距离的方式</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mw"><img src="../Images/b5287c1d71e26514db3a077c5d4d8a6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TWi5s9eYgjjNgOuPSm67pA.png"/></div></div></figure><p id="fb5f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">那么这如何帮助你<strong class="lt iu">更好地了解你的客户</strong>？嗯，在这种情况下，你可以利用他们的<strong class="lt iu">行为</strong>(具体来说，他们选择或不选择哪种优惠)作为一种方式，将他们与想法相似的客户分组。现在，您可以研究每一组，发掘趋势和模式，并用它们来塑造未来的产品。</p><p id="864c" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu">稍微技术性一点的说明</strong>，重要的是要提到有许多 K-Means 算法可用(<em class="mx"> Hartigan-Wong </em>、<em class="mx"> Lloyd </em>、<em class="mx"> MacQueen </em>等等)，但它们都有相同的基本概念:每个元素都被分配到一个聚类中，从而使<strong class="lt iu">到<code class="fe ms mt mu mv b">centre</code>的欧几里德距离的平方和</strong>最小化——这个过程也被称为使<strong class="lt iu">总数最小化</strong></p><h1 id="67dd" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">加载包</h1><pre class="kj kk kl km gt my mv mz na aw nb bi"><span id="576d" class="nc la it mv b gy nd ne l nf ng"><strong class="mv iu">library</strong>(tidyverse)<br/><strong class="mv iu">library</strong>(lubridate)<br/><strong class="mv iu">library</strong>(knitr)<br/><strong class="mv iu">library</strong>(readxl)<br/><strong class="mv iu">library</strong>(broom)<br/><strong class="mv iu">library</strong>(umap)<br/><strong class="mv iu">library</strong>(ggrepel)</span></pre><h1 id="6938" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">数据</h1><p id="cec1" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated"><a class="ae ky" href="https://media.wiley.com/product_ancillary/6X/11186614/DOWNLOAD/ch02.zip" rel="noopener ugc nofollow" target="_blank">数据集</a>来自<a class="ae ky" href="http://www.john-foreman.com/blog" rel="noopener ugc nofollow" target="_blank">约翰·福尔曼</a>的书<a class="ae ky" href="http://www.wiley.com/WileyCDA/WileyTitle/productCd-111866146X.html" rel="noopener ugc nofollow" target="_blank">数据智能</a>。它包含<strong class="lt iu">虚构葡萄酒零售商</strong>的<strong class="lt iu">促销</strong>数据，包括<em class="mx"> 32 次促销</em>的详细信息(包括葡萄酒品种、最低购买量、折扣百分比和原产国)以及<em class="mx"> 100 名客户</em>及其响应的促销的列表。</p><pre class="kj kk kl km gt my mv mz na aw nb bi"><span id="aa54" class="nc la it mv b gy nd ne l nf ng">offers_tbl &lt;- <strong class="mv iu">read_excel</strong>('../00_data/WineKMC.xlsx', <br/>                           sheet = 'OfferInformation')</span><span id="0a3c" class="nc la it mv b gy nh ne l nf ng">offers_tbl &lt;- offers_tbl %&gt;% <br/>                 <strong class="mv iu">set_names</strong>(<strong class="mv iu">c</strong>('offer', 'campaign', <br/>                             'varietal', 'min_qty_kg',<br/>                             'disc_pct','origin','past_peak')<br/>                             )</span><span id="97e6" class="nc la it mv b gy nh ne l nf ng"><strong class="mv iu">head</strong>(offers_tbl)</span><span id="4efe" class="nc la it mv b gy nh ne l nf ng">## # A tibble: 6 x 7<br/>##  offer campaign varietal min_qty_kg disc_pct origin  past_peak<br/>##  &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;       &lt;dbl&gt;   &lt;dbl&gt;    &lt;chr&gt;     &lt;chr&gt;    <br/>## 1 1 January     Malbec        72     56      France     FALSE    <br/>## 2 2 January     Pinot Noir    72     17      France     FALSE    <br/>## 3 3 February    Espumante    144     32      Oregon     TRUE     <br/>## 4 4 February    Champagne     72     48      France     TRUE     <br/>## 5 5 February    Cabernet~    144     44      New Zeala~ TRUE     <br/>## 6 6 March       Prosecco     144     86      Chile      FALSE</span><span id="4580" class="nc la it mv b gy nh ne l nf ng">transac_tbl &lt;- <strong class="mv iu">read_excel</strong>('../00_data/WineKMC.xlsx', <br/>                            sheet = 'Transactions')</span><span id="6090" class="nc la it mv b gy nh ne l nf ng">transac_tbl &lt;- transac_tbl %&gt;% <br/>                   <strong class="mv iu">set_names</strong>(<strong class="mv iu">c</strong>('customer', 'offer')<br/>                               )</span><span id="a566" class="nc la it mv b gy nh ne l nf ng"><strong class="mv iu">head</strong>(transac_tbl)</span><span id="64fc" class="nc la it mv b gy nh ne l nf ng">## # A tibble: 6 x 2<br/>##   customer offer<br/>##   &lt;chr&gt;    &lt;dbl&gt;<br/>## 1 Smith        2<br/>## 2 Smith       24<br/>## 3 Johnson     17<br/>## 4 Johnson     24<br/>## 5 Johnson     26<br/>## 6 Williams    18</span></pre><p id="b44e" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">数据需要被转换成一个<code class="fe ms mt mu mv b">User-Item format</code>(又名<em class="mx">客户-产品矩阵</em>)，顶部是<em class="mx">客户</em>，下方是<em class="mx">报价</em>。单元格中填充了<strong class="lt iu"> 0 的</strong>和<strong class="lt iu"> 1 的</strong>，其中<strong class="lt iu"> 1 的</strong>表示客户是否对特定报价做出了回应。</p><p id="6726" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这种矩阵也被称为<strong class="lt iu">二进制评级矩阵</strong>和<em class="mx">不需要标准化</em>。</p><pre class="kj kk kl km gt my mv mz na aw nb bi"><span id="41ba" class="nc la it mv b gy nd ne l nf ng">wine_tbl &lt;- transac_tbl %&gt;% <br/>    <strong class="mv iu">left_join</strong>(offers_tbl) %&gt;% <br/>    <strong class="mv iu">mutate</strong>(value = 1) %&gt;%<br/>    <strong class="mv iu">spread</strong>(customer,value, fill = 0) </span><span id="3577" class="nc la it mv b gy nh ne l nf ng"><strong class="mv iu">head</strong>(wine_tbl)</span><span id="c615" class="nc la it mv b gy nh ne l nf ng">## # A tibble: 6 x 107<br/>##  offer campaign varietal min_qty_kg disc_pct origin past_peak <br/>##  &lt;dbl&gt;  &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt;      &lt;dbl&gt;    &lt;chr&gt;  &lt;chr&gt;     <br/>## 1 1    January  Malbec       72       56      France   FALSE         <br/>## 2 2    January  Pinot Noir   72       17      France   FALSE         <br/>## 3 3    February Espumante   144       32      Oregon   TRUE          <br/>## 4 4    February Champagne    72       48      France   TRUE          <br/>## 5 5    February Cabernern~  144       44      New Zea~ TRUE          <br/>## 6 6    March    Prosecco    144       86      Chile    FALSE         <br/>## # ... with 100 more variables: Adams &lt;dbl&gt;, Allen &lt;dbl&gt;, Anderson &lt;dbl&gt;, Bailey &lt;dbl&gt;, Baker &lt;dbl&gt;, Barnes &lt;dbl&gt;, ...</span></pre><h1 id="bb56" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">对客户进行聚类</h1><p id="402e" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">K-Means 算法附带了<strong class="lt iu"> stats </strong>包，这是 R 中的<strong class="lt iu">核心系统库</strong>之一，使用起来相当简单。我只需要将几个参数传递给<strong class="lt iu"> kmeans() </strong>函数。</p><pre class="kj kk kl km gt my mv mz na aw nb bi"><span id="a9ac" class="nc la it mv b gy nd ne l nf ng">user_item_tbl &lt;- wine_tbl[,8:107]</span><span id="aa1d" class="nc la it mv b gy nh ne l nf ng"><strong class="mv iu">set.seed</strong>(196) <br/>            <br/>kmeans_obj &lt;- user_item_tbl %&gt;%  <br/>    <strong class="mv iu">kmeans</strong>(centers = 5,     # number of clusters <br/>           nstart = 100,    # number of random sets to be chosen<br/>           iter.max = 50)   # max number of iterations allowed</span></pre><p id="a9d2" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我可以用<code class="fe ms mt mu mv b">broom</code>包中的<code class="fe ms mt mu mv b">glance()</code>快速检查模型，它提供了模型级统计数据的摘要</p><pre class="kj kk kl km gt my mv mz na aw nb bi"><span id="8a24" class="nc la it mv b gy nd ne l nf ng"><strong class="mv iu">glance</strong>(kmeans_obj) %&gt;% <strong class="mv iu">glimpse</strong>()</span><span id="2537" class="nc la it mv b gy nh ne l nf ng">## Observations: 1<br/>## Variables: 4<br/>## $ totss        &lt;dbl&gt; 283.1875<br/>## $ tot.withinss &lt;dbl&gt; 189.7255<br/>## $ betweenss    &lt;dbl&gt; 93.46201<br/>## $ iter         &lt;int&gt; 3</span></pre><p id="908f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">真正需要关注的一个指标是<strong class="lt iu">总的类内平方和</strong>(或<code class="fe ms mt mu mv b">tot.withinss</code>),因为类的最佳数量是最小化<code class="fe ms mt mu mv b">tot.withinss</code>的数量。</p><p id="51c1" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">所以我想为不同数量的集群拟合 k-means 模型，看看在哪里<code class="fe ms mt mu mv b">tot.withinss</code>达到最小值。</p><p id="a24b" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">首先，我为一定数量的<code class="fe ms mt mu mv b">centers</code>(本例中为 4)构建一个函数，并检查它是否在<code class="fe ms mt mu mv b">glance()</code>上工作。</p><pre class="kj kk kl km gt my mv mz na aw nb bi"><span id="e921" class="nc la it mv b gy nd ne l nf ng">kmeans_map &lt;- <strong class="mv iu">function</strong>(centers = 4) {<br/>    user_item_tbl %&gt;%  <br/>        <strong class="mv iu">kmeans</strong>(centers = centers, <br/>        nstart = 100, <br/>        iter.max = 50)<br/>}</span><span id="bc88" class="nc la it mv b gy nh ne l nf ng">4 %&gt;% <strong class="mv iu">kmeans_map</strong>() %&gt;%  <strong class="mv iu">glance</strong>()</span><span id="6d35" class="nc la it mv b gy nh ne l nf ng">## # A tibble: 1 x 4<br/>##   totss tot.withinss betweenss  iter<br/>##   &lt;dbl&gt;        &lt;dbl&gt;     &lt;dbl&gt; &lt;int&gt;<br/>## 1  283.         203.      80.0     2</span></pre><p id="63c8" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">然后，我创建了一个<strong class="lt iu">嵌套 tibble </strong>，这是一种在数据框中“嵌套”列的方式。</p><p id="6658" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">嵌套数据框的伟大之处在于，您可以在其中放置任何您想要的东西:列表、模型、数据框、绘图等！</p><pre class="kj kk kl km gt my mv mz na aw nb bi"><span id="5dfa" class="nc la it mv b gy nd ne l nf ng">kmeans_map_tbl &lt;- <strong class="mv iu">tibble</strong>(centers = 1:15) %&gt;%  <br/>                         # create column with centres </span><span id="c9a4" class="nc la it mv b gy nh ne l nf ng">          <strong class="mv iu">mutate</strong>(k_means = centers %&gt;% <br/>                  <strong class="mv iu">map</strong>(kmeans_map)) %&gt;%   <br/>                         # iterate `kmeans_map` row-wise to <br/>                         # gather kmeans models for each centre</span><span id="5b14" class="nc la it mv b gy nh ne l nf ng">          <strong class="mv iu">mutate</strong>(glance = k_means %&gt;%  <br/>                  <strong class="mv iu">map</strong>(glance))            <br/>                         # apply `glance()` row-wise to gather <br/>                         # each model’s summary metrics<br/></span><span id="9457" class="nc la it mv b gy nh ne l nf ng">kmeans_map_tbl %&gt;% <strong class="mv iu">glimpse</strong>()</span><span id="bf0c" class="nc la it mv b gy nh ne l nf ng">## Observations: 15<br/>## Variables: 3<br/>## $ centers &lt;int&gt;  1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, ...<br/>## $ k_means &lt;list&gt; [&lt;1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, ...<br/>## $ glance  &lt;list&gt; [&lt;tbl_df[1 x 4]&gt;, &lt;tbl_df[1 x 4]&gt;, ...</span></pre><p id="c264" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">最后，我可以构建一个<code class="fe ms mt mu mv b">scree plot</code>,并在图上寻找“肘部”,即额外集群的数量趋于稳定的地方。在这种情况下，<strong class="lt iu"> 5 </strong>似乎是一个最佳数字，因为 6 的<code class="fe ms mt mu mv b">tot.withinss</code>下降不如前一个明显。</p><pre class="kj kk kl km gt my mv mz na aw nb bi"><span id="f34b" class="nc la it mv b gy nd ne l nf ng">kmeans_map_tbl %&gt;% <br/>    <strong class="mv iu">unnest</strong>(glance) %&gt;%           <em class="mx"># unnest the glance column</em><br/>    <strong class="mv iu">select</strong>(centers, <br/>             tot.withinss) %&gt;%   <em class="mx"># select centers and tot.withinss</em><br/>    <br/>    <strong class="mv iu">ggplot</strong>(<strong class="mv iu">aes</strong>(x = centers, y = tot.withinss)) + <br/>    <strong class="mv iu">geom_line</strong>(colour = 'grey30', size = .8) +<br/>    <strong class="mv iu">geom_point</strong>(colour = 'green4', size = 3) +<br/>    <strong class="mv iu">geom_label_repel</strong>(<strong class="mv iu">aes</strong>(label = centers), <br/>                     colour = 'grey30') +<br/>    <strong class="mv iu">theme_light</strong>() +<br/>    <strong class="mv iu">labs</strong>(title = 'Scree Plot')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/ffa986c349965139b9244154bbfb3515.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QQb33dj2FAchKclwVxvRKg.png"/></div></div></figure><h1 id="c0e6" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">将片段可视化</h1><p id="d407" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">现在我已经确定了集群的最佳数量，我想把它们可视化。为此，我使用了<a class="ae ky" href="https://umap-learn.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank"><strong class="lt iu"/></a>(<em class="mx">均匀流形逼近和投影</em>)，这是一种维度缩减技术，可以以类似于<a class="ae ky" href="https://en.wikipedia.org/wiki/Principal_component_analysis" rel="noopener ugc nofollow" target="_blank"> <strong class="lt iu">主成分分析</strong> </a>和<a class="ae ky" href="https://en.wikipedia.org/wiki/T-distributed_stochastic_neighbor_embedding" rel="noopener ugc nofollow" target="_blank"> <strong class="lt iu"> t-SNE </strong> </a>的方式用于聚类可视化。</p><p id="c14e" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">首先，我创建一个 umap 对象，取出<code class="fe ms mt mu mv b">layout</code>参数(包含可用于可视化数据集的坐标)，将其格式更改为 tibble，并从<code class="fe ms mt mu mv b">wine_tbl</code>中附加<code class="fe ms mt mu mv b">offer</code>列。</p><pre class="kj kk kl km gt my mv mz na aw nb bi"><span id="291e" class="nc la it mv b gy nd ne l nf ng">umap_obj &lt;- user_item_tbl %&gt;%  <strong class="mv iu">umap</strong>() <br/><br/>umap_tbl &lt;- umap_obj$layout %&gt;% <br/>    <strong class="mv iu">as_tibble</strong>() %&gt;%                       <em class="mx"># change to a tibble</em><br/>    <strong class="mv iu">set_names</strong>(<strong class="mv iu">c</strong>('x', 'y')) %&gt;%            <em class="mx"># remane columns</em><br/>    <strong class="mv iu">bind_cols</strong>(wine_tbl %&gt;% <strong class="mv iu">select</strong>(offer)) <em class="mx"># attach offer reference</em></span></pre><p id="cf6a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">然后，我从<strong class="lt iu">嵌套表</strong>中<code class="fe ms mt mu mv b">pluck</code>出第 5 个 kmeans 模型，将<em class="mx"> cluster </em>参数从<code class="fe ms mt mu mv b">kmeans</code>函数附加到输出，并将 offer 和 cluster 加入 umap_tbl。</p><pre class="kj kk kl km gt my mv mz na aw nb bi"><span id="3153" class="nc la it mv b gy nd ne l nf ng">umap_kmeans_5_tbl &lt;- kmeans_map_tbl %&gt;% <br/>    <strong class="mv iu">pull</strong>(k_means) %&gt;%<br/>    <strong class="mv iu">pluck</strong>(5) %&gt;%                   <em class="mx"># pluck element 5 </em><br/>    broom::<strong class="mv iu">augment</strong>(wine_tbl) %&gt;%   <em class="mx"># attach .cluster to the tibble </em><br/>    <strong class="mv iu">select</strong>(offer, .cluster) %&gt;% <br/>    <strong class="mv iu">left_join</strong>(umap_tbl, <br/>                 by = 'offer')     <em class="mx"># join umap_tbl by offer</em></span></pre><p id="784b" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">最后，我可以看到星团的 UMAP 投影。<code class="fe ms mt mu mv b">plotly</code>增加了一些很好的交互性，让图表变得栩栩如生！</p><pre class="kj kk kl km gt my mv mz na aw nb bi"><span id="6014" class="nc la it mv b gy nd ne l nf ng">umap_kmeans_5_tbl %&gt;% <br/>    <strong class="mv iu">mutate</strong>(label_text = <strong class="mv iu">str_glue</strong>('Offer: {offer}<br/>                                  Cluster: {.cluster}')) %&gt;%<br/>    <strong class="mv iu">ggplot</strong>(<strong class="mv iu">aes</strong>(x,y, colour = .cluster)) +<br/>    <strong class="mv iu">geom_point</strong>() +<br/>    <strong class="mv iu">geom_label_repel</strong>(<strong class="mv iu">aes</strong>(label = label_text), size = 3) +<br/>    <strong class="mv iu">theme_light</strong>() +<br/>    <strong class="mv iu">labs</strong>(title    = 'UMAP 2D Projections of K-Means Clusters',<br/>         caption  = "") +<br/>    <strong class="mv iu">theme</strong>(legend.position = 'none')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/8576db15e4d4f1803f5cebef71087e44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vmKgDPElom_MVj2W7YcaGQ.png"/></div></div></figure><h1 id="d656" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">评估集群</h1><p id="c84f" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">现在我们终于可以更仔细地观察单个聚类，看看 K-Means 识别出了什么。</p><p id="ca6a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">但是，让我们首先将所有信息放在一个数据框中。</p><pre class="kj kk kl km gt my mv mz na aw nb bi"><span id="c549" class="nc la it mv b gy nd ne l nf ng">cluster_trends_tbl &lt;- wine_tbl %&gt;%<br/>    <strong class="mv iu">left_join</strong>(umap_kmeans_5_tbl) %&gt;%<br/>    <strong class="mv iu">arrange</strong>(.cluster) %&gt;%<br/>    <strong class="mv iu">select</strong>(.cluster, offer:past_peak)</span></pre><h1 id="3e58" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">群组 1 和 2</h1><p id="84ad" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated"><strong class="lt iu">集群 1 </strong>中的顾客购买<strong class="lt iu">大量的起泡酒</strong>(香槟和普罗塞克)，而<strong class="lt iu">第二细分市场</strong>中的顾客喜欢购买<strong class="lt iu">不同品种的少量</strong>。</p><pre class="kj kk kl km gt my mv mz na aw nb bi"><span id="e8d5" class="nc la it mv b gy nd ne l nf ng">cluster_trends_tbl %&gt;% <br/>    <strong class="mv iu">filter</strong>(.cluster ==1 | .cluster ==2) %&gt;% <br/>    <strong class="mv iu">count</strong>(.cluster, varietal, origin, min_qty_kg, disc_pct) %&gt;%<br/>    <strong class="mv iu">select</strong>(-n)</span><span id="4676" class="nc la it mv b gy nh ne l nf ng">## # A tibble: 9 x 5<br/>##   .cluster varietal     origin       min_qty_kg disc_pct<br/>##   &lt;fct&gt;    &lt;chr&gt;        &lt;chr&gt;             &lt;dbl&gt;    &lt;dbl&gt;<br/>## 1 1        Champagne    France               72       48<br/>## 2 1        Champagne    New Zealand          72       88<br/>## 3 1        Prosecco     Chile               144       86<br/>## 4 2        Espumante    Oregon                6       50<br/>## 5 2        Espumante    South Africa          6       45<br/>## 6 2        Malbec       France                6       54<br/>## 7 2        Merlot       Chile                 6       43<br/>## 8 2        Pinot Grigio France                6       87<br/>## 9 2        Prosecco     Australia             6       40</span></pre><h1 id="2300" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">群组 3 和 4</h1><p id="673f" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">当谈到葡萄酒时，这些群体中的顾客有非常特殊的口味:那些在第三部分的顾客偏爱黑皮诺，而第四组的顾客只购买大量的法国香槟。</p><pre class="kj kk kl km gt my mv mz na aw nb bi"><span id="5842" class="nc la it mv b gy nd ne l nf ng">cluster_trends_tbl %&gt;% <br/>    <strong class="mv iu">filter</strong>(.cluster ==3 | .cluster ==4 ) %&gt;% <br/>    <strong class="mv iu">group_by</strong>() %&gt;%<br/>    <strong class="mv iu">count</strong>(.cluster, varietal, origin, min_qty_kg, disc_pct) %&gt;%<br/>    <strong class="mv iu">select</strong>(-n)</span><span id="d874" class="nc la it mv b gy nh ne l nf ng">## # A tibble: 6 x 5<br/>##   .cluster varietal   origin    min_qty_kg disc_pct<br/>##   &lt;fct&gt;    &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt;    &lt;dbl&gt;<br/>## 1 3        Pinot Noir Australia        144       83<br/>## 2 3        Pinot Noir France            72       17<br/>## 3 3        Pinot Noir Germany           12       47<br/>## 4 3        Pinot Noir Italy              6       34<br/>## 5 4        Champagne  France            72       63<br/>## 6 4        Champagne  France            72       89</span></pre><h1 id="4ef3" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">第 5 组</h1><p id="5acd" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated"><strong class="lt iu">第五部分</strong>更难分类，因为它包含许多不同的属性。唯一明显的趋势是，这一细分市场的顾客选择了所有可用的赤霞珠葡萄酒。</p><pre class="kj kk kl km gt my mv mz na aw nb bi"><span id="21fc" class="nc la it mv b gy nd ne l nf ng">cluster_trends_tbl %&gt;% <br/>    <strong class="mv iu">filter</strong>(.cluster ==5 ) %&gt;% <br/>    <strong class="mv iu">count</strong>(.cluster, varietal, origin, min_qty_kg, disc_pct) %&gt;%<br/>    <strong class="mv iu">select</strong>(-n)</span><span id="2ffd" class="nc la it mv b gy nh ne l nf ng">## # A tibble: 17 x 5<br/>##    .cluster varietal           origin       min_qty_kg disc_pct<br/>##    &lt;fct&gt;    &lt;chr&gt;              &lt;chr&gt;             &lt;dbl&gt;    &lt;dbl&gt;<br/>##  1 5        Cabernet Sauvignon France               12       56<br/>##  2 5        Cabernet Sauvignon Germany              72       45<br/>##  3 5        Cabernet Sauvignon Italy                72       82<br/>##  4 5        Cabernet Sauvignon Italy               144       19<br/>##  5 5        Cabernet Sauvignon New Zealand         144       44<br/>##  6 5        Cabernet Sauvignon Oregon               72       59<br/>##  7 5        Champagne          California           12       50<br/>##  8 5        Champagne          France               72       85<br/>##  9 5        Champagne          Germany              12       66<br/>## 10 5        Chardonnay         Chile               144       57<br/>## 11 5        Chardonnay         South Africa        144       39<br/>## 12 5        Espumante          Oregon              144       32<br/>## 13 5        Malbec             France               72       56<br/>## 14 5        Merlot             California           72       88<br/>## 15 5        Merlot             Chile                72       64<br/>## 16 5        Prosecco           Australia            72       83<br/>## 17 5        Prosecco           California           72       52</span></pre><h1 id="04f8" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">最后的想法</h1><p id="e2a0" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">虽然它不会给你所有的答案，<strong class="lt iu">聚类</strong>是一个强大的探索性练习，它可以帮助你揭示你的消费者群的模式，尤其是当你有一个全新的市场要探索，并且之前没有任何关于它的知识。</p><p id="bbba" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这很容易实现，甚至在像我在这里使用的小数据集上，你也可以在你的客户群中挖掘出有趣的行为模式。</p><p id="c836" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我们不费吹灰之力就了解到，我们的一些顾客喜欢某些种类的葡萄酒，而另一些顾客则喜欢买高买低。这些信息可以用来针对那些更倾向于做出回应的客户，定制你的<strong class="lt iu">定价策略</strong>和<strong class="lt iu">营销活动</strong>。此外，客户细分允许更有效地分配营销资源，并最大限度地增加交叉销售和追加销售机会。</p><p id="4abc" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">还可以通过叠加客户的<strong class="lt iu">人口统计</strong>(年龄、种族、宗教、性别、家庭规模、种族、收入、教育水平)<strong class="lt iu">地理</strong>(他们生活和工作的地方)<strong class="lt iu">心理</strong>(社会阶层、生活方式和个性特征)等信息来丰富细分，但这些都超出了这个小型项目的范围。</p><h1 id="7459" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">代码库</h1><p id="da13" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">完整的 R 代码可以在<a class="ae ky" href="https://github.com/DiegoUsaiUK/Customer_Segmentation" rel="noopener ugc nofollow" target="_blank">我的 GitHub 档案</a>中找到</p><h1 id="26b8" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">参考</h1><ul class=""><li id="3ce4" class="nj nk it lt b lu lv lx ly ma nl me nm mi nn mm no np nq nr bi translated">有关<a class="ae ky" href="https://medium.com/@kristenkehrer/how-to-use-customer-segmentation-to-learn-f49e82b9a959" rel="noopener">客户细分潜力的更广泛观点</a></li><li id="c08a" class="nj nk it lt b lu ns lx nt ma nu me nv mi nw mm no np nq nr bi translated">对于某些<a class="ae ky" href="https://www.datascience.com/blog/k-means-alternatives" rel="noopener ugc nofollow" target="_blank"> k-means 缺点的批判</a></li><li id="d01e" class="nj nk it lt b lu ns lx nt ma nu me nv mi nw mm no np nq nr bi translated"><a class="ae ky" href="https://www.bain.com/insights/management-tools-customer-segmentation" rel="noopener ugc nofollow" target="_blank">贝恩&amp;公司</a>的客户细分</li></ul></div><div class="ab cl nx ny hx nz" role="separator"><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc"/></div><div class="im in io ip iq"><p id="7554" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><em class="mx">原载于 2019 年 5 月 25 日</em><a class="ae ky" href="https://diegousai.io/2019/05/a-gentle-introduction-to-customer-segmentation/" rel="noopener ugc nofollow" target="_blank"><em class="mx">https://diegousei . io</em></a><em class="mx">。</em></p></div></div>    
</body>
</html>