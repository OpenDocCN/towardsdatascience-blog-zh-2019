<html>
<head>
<title>Learning SQL the Hard Way</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">艰难地学习 SQL</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/learning-sql-the-hard-way-4173f11b26f1?source=collection_archive---------5-----------------------#2019-12-08">https://towardsdatascience.com/learning-sql-the-hard-way-4173f11b26f1?source=collection_archive---------5-----------------------#2019-12-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/f6ebe40c912fa796493749a26704d61d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t6tneqUa6Fm87gYdJB6hkg.png"/></div></div><figcaption class="jc jd gj gh gi je jf bd b be z dk"><a class="ae jg" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=1246836" rel="noopener ugc nofollow" target="_blank">Pixabay</a></figcaption></figure><div class=""/><div class=""><h2 id="924b" class="pw-subtitle-paragraph kg ji jj bd b kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dk translated">通过写它</h2></div><p id="529b" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk"> <em class="lu">一个不懂 SQL 的数据科学家不值他的盐</em> </strong> <em class="lu">。</em></p><p id="a6d7" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在我看来，这在任何意义上都是正确的。虽然我们觉得创建模型和提出不同的假设更有成就，但数据管理的作用不能低估。</p><p id="4f66" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">当谈到 ETL 和数据准备任务时，SQL 无处不在，每个人都应该知道一点，至少是有用的。</p><p id="ad55" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我仍然记得我第一次接触 SQL 的时候。这是我学会的第一种语言(如果你可以这么说的话)。这对我产生了影响。我能够将事情自动化，这是我以前从未想过的。</p><p id="f222" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在使用 SQL 之前，我曾经使用 Excel——VLOOKUPs 和 pivots。我在创建报告系统，一次又一次地做着同样的工作。SQL 让这一切烟消云散。现在我可以写一个大的脚本，一切都将自动化——所有的交叉表和分析都是动态生成的。</p><p id="3ce7" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这就是 SQL 的强大之处。尽管你可以使用<a class="ae jg" rel="noopener" target="_blank" href="/minimal-pandas-subset-for-data-scientists-6355059629ae"> Pandas </a>做任何你用 SQL 做的事情，你仍然需要学习 SQL 来处理像 HIVE，Teradata，有时还有<a class="ae jg" rel="noopener" target="_blank" href="/the-hitchhikers-guide-to-handle-big-data-using-spark-90b9be0fe89a"> Spark </a>这样的系统。</p><p id="dab1" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la jk"> <em class="lu">这个帖子是关于安装 SQL，讲解 SQL，运行 SQL 的。</em> </strong></p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="7e46" class="mc md jj bd me mf mg mh mi mj mk ml mm kp mn kq mo ks mp kt mq kv mr kw ms mt bi translated">设置 SQL 环境</h1><p id="b785" class="pw-post-body-paragraph ky kz jj la b lb mu kk ld le mv kn lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">现在，学习 SQL 的最好方法是用它来弄脏你的手(对于你想学的任何其他东西，我也可以这么说)</p><p id="6356" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我建议不要使用像 w3schools/tutorialspoint for SQL 这样的基于网络的菜谱，因为你不能用这些菜谱来使用你的数据。</p><p id="b9b9" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">此外，我会建议您学习 MySQL 风格的 SQL，因为它是开源的，易于在您的笔记本电脑上安装，并且有一个名为 MySQL Workbench 的优秀客户端，可以让您的生活更加轻松。</p><p id="b9de" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们已经解决了这些问题，下面是一步一步地设置 MySQL:</p><ul class=""><li id="876c" class="mz na jj la b lb lc le lf lh nb ll nc lp nd lt ne nf ng nh bi translated">您可以从<a class="ae jg" href="http://dev.mysql.com/downloads/mysql/" rel="noopener ugc nofollow" target="_blank">下载 MySQL 社区服务器</a>为您的特定系统(MACOSX、Linux、Windows)下载 MySQL。就我而言，我下载了 DMG 档案。之后，双击并安装文件。你可能需要设置一个密码。记住这个密码，因为以后连接到 MySQL 实例时会用到它。 </li></ul><figure class="nj nk nl nm gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ni"><img src="../Images/e005db125eb7287cb9876f06ed3e323f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PnlgDW5kI-b8tUlP0Dydhg.png"/></div></div></figure><ul class=""><li id="92aa" class="mz na jj la b lb lc le lf lh nb ll nc lp nd lt ne nf ng nh bi translated">创建一个名为<code class="fe nn no np nq b">my.cnf</code>的文件，并将以下内容放入其中。这是向 SQL 数据库授予本地文件读取权限所必需的。</li></ul><pre class="nj nk nl nm gt nr nq ns nt aw nu bi"><span id="a2eb" class="nv md jj nq b gy nw nx l ny nz">[client]<br/>port= 3306<br/>[mysqld]<br/>port= 3306<br/>secure_file_priv=''<br/>local-infile=1</span></pre><ul class=""><li id="68f4" class="mz na jj la b lb lc le lf lh nb ll nc lp nd lt ne nf ng nh bi translated">打开<code class="fe nn no np nq b">System Preferences&gt;MySQL</code>。转到<code class="fe nn no np nq b">Configuration</code>并使用选择按钮浏览到<code class="fe nn no np nq b">my.cnf</code>文件。</li></ul><figure class="nj nk nl nm gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oa"><img src="../Images/e4142255f7ae70063142822c6f3290b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QGlonLif577TPxZaABHNeA.png"/></div></div></figure><ul class=""><li id="9699" class="mz na jj la b lb lc le lf lh nb ll nc lp nd lt ne nf ng nh bi translated">通过点击停止和启动，从<code class="fe nn no np nq b">Instances</code>选项卡重启服务器。</li></ul><figure class="nj nk nl nm gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oa"><img src="../Images/d8546511d804bed0ca9e9920ee00d3e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fRp_3lbCdmfSilG_AbrBwA.png"/></div></div></figure><ul class=""><li id="1650" class="mz na jj la b lb lc le lf lh nb ll nc lp nd lt ne nf ng nh bi translated">一旦服务器开始运行，下载并安装 MySQL 工作台:<a class="ae jg" href="https://dev.mysql.com/downloads/workbench/" rel="noopener ugc nofollow" target="_blank">下载 MySQL 工作台</a>。工作台为您提供了一个编辑器来编写 SQL 查询并以结构化的方式获得结果。</li></ul><figure class="nj nk nl nm gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ob"><img src="../Images/6c85dfc7a0dd28dd1a07bbc0951cd438.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lKNO4vsQxPywA-vor8Z07A.png"/></div></div></figure><ul class=""><li id="84bc" class="mz na jj la b lb lc le lf lh nb ll nc lp nd lt ne nf ng nh bi translated">现在打开 MySQL 工作台，通过它连接到 SQL。您将看到如下所示的内容。</li></ul><figure class="nj nk nl nm gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oc"><img src="../Images/f152a90a6fac6c4bb3a5788458f8c07e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ua36LkMOmyos-vLYMxoaXg.png"/></div></div></figure><ul class=""><li id="0768" class="mz na jj la b lb lc le lf lh nb ll nc lp nd lt ne nf ng nh bi translated">您可以看到本地实例连接已经预先为您设置好了。现在，您只需点击该连接，并开始使用我们之前为 MySQL 服务器设置的密码(如果您有地址、端口号、用户名和密码，您还可以创建一个到现有 SQL 服务器的连接，该服务器可能不在您的计算机上)。</li></ul><figure class="nj nk nl nm gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi od"><img src="../Images/ea2872a799f929ab4a8d01ae5a587666.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v2bp64wvzPB0Yj84Ov7Zww.png"/></div></div></figure><ul class=""><li id="bc2e" class="mz na jj la b lb lc le lf lh nb ll nc lp nd lt ne nf ng nh bi translated">你会得到一个编辑器来编写你对特定数据库的查询。</li></ul><figure class="nj nk nl nm gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oe"><img src="../Images/f841569e5a66a2db4a54bac0c5e22832.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Jnuc9A4jzImC1DzGL9a_aA.png"/></div></div></figure><ul class=""><li id="31bc" class="mz na jj la b lb lc le lf lh nb ll nc lp nd lt ne nf ng nh bi translated">检查左上方的<code class="fe nn no np nq b">Schemas</code>选项卡，查看显示的表格。表<code class="fe nn no np nq b">sys_config</code>中只有一个<code class="fe nn no np nq b">sys</code>模式。不是学习 SQL 的有趣数据源。所以还是装一些数据来练习吧。</li><li id="7990" class="mz na jj la b lb of le og lh oh ll oi lp oj lt ne nf ng nh bi translated">如果你有自己的数据要处理。那就很好。您可以使用以下命令创建一个新的模式(数据库)并将其上传到表中。(您可以使用<code class="fe nn no np nq b">Cmd+Enter</code>或点击⚡️lightning 按钮来运行命令)</li></ul><figure class="nj nk nl nm gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ok"><img src="../Images/8639241d8a0ee1ca4d0e497cfd1ee8c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fBESNu1um-8unAD-XJfjYA.png"/></div></div></figure><p id="37eb" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然而，在本教程中，我将使用 Sakila 电影数据库，您可以通过以下步骤安装该数据库:</p><ul class=""><li id="1b4f" class="mz na jj la b lb lc le lf lh nb ll nc lp nd lt ne nf ng nh bi translated">转到<a class="ae jg" href="https://dev.mysql.com/doc/index-other.html" rel="noopener ugc nofollow" target="_blank"> MySQL 文档</a>并下载 Sakila ZIP 文件。</li><li id="da52" class="mz na jj la b lb of le og lh oh ll oi lp oj lt ne nf ng nh bi translated">解压文件。</li><li id="864c" class="mz na jj la b lb of le og lh oh ll oi lp oj lt ne nf ng nh bi translated">现在转到 MySQL 工作台，选择文件&gt;运行 SQL 脚本&gt;选择位置<code class="fe nn no np nq b">sakila-db/sakila-schema.sql</code></li><li id="1d61" class="mz na jj la b lb of le og lh oh ll oi lp oj lt ne nf ng nh bi translated">转到 MySQL 工作台，选择文件&gt;运行 SQL 脚本&gt;选择位置<code class="fe nn no np nq b">sakila-db/sakila-data.sql</code></li></ul><p id="f2c8" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">完成后，您将看到模式列表中添加了一个新的数据库。</p><figure class="nj nk nl nm gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ol"><img src="../Images/c9f436d76729eb756cf20afbb3479f22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T23MkpDoqoLCXMhzKEzSgg.png"/></div></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="3173" class="mc md jj bd me mf mg mh mi mj mk ml mm kp mn kq mo ks mp kt mq kv mr kw ms mt bi translated">玩弄数据</h1><p id="982e" class="pw-post-body-paragraph ky kz jj la b lb mu kk ld le mv kn lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">现在我们有了一些数据。最后。</p><p id="e054" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们从编写一些查询开始。</p><p id="eb33" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您可以尝试使用<a class="ae jg" href="https://dev.mysql.com/doc/sakila/en/sakila-structure.html" rel="noopener ugc nofollow" target="_blank"> Sakila Sample Database </a>文档详细了解 Sakila 数据库的模式。</p><figure class="nj nk nl nm gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi om"><img src="../Images/44988c70c407c185a6eaf4d2730fc1d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A7MWLidLItxLrflc5fM5Cw.png"/></div></div><figcaption class="jc jd gj gh gi je jf bd b be z dk">Schema Diagram</figcaption></figure><p id="9069" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">任何 SQL 查询的基本语法都是:</p><pre class="nj nk nl nm gt nr nq ns nt aw nu bi"><span id="5ee0" class="nv md jj nq b gy nw nx l ny nz">SELECT col1, SUM(col2) as col2sum, AVG(col3) as col3avg <br/>FROM table_name <br/>WHERE col4 = 'some_value' <br/>GROUP BY col1 <br/>ORDER BY col2sum DESC;</span></pre><p id="fb24" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">该查询中有四个元素:</p><ol class=""><li id="9cff" class="mz na jj la b lb lc le lf lh nb ll nc lp nd lt on nf ng nh bi translated"><strong class="la jk">选择</strong>:选择哪些列？在这里，我们选择<code class="fe nn no np nq b">col1</code>，在<code class="fe nn no np nq b">col2</code>上进行总和聚合，在<code class="fe nn no np nq b">col3</code>上进行 AVG 聚合。我们还通过使用<code class="fe nn no np nq b">as</code>关键字给<code class="fe nn no np nq b">SUM(col2)</code>起了一个新名字。这就是所谓的混叠。</li><li id="1e82" class="mz na jj la b lb of le og lh oh ll oi lp oj lt on nf ng nh bi translated"><strong class="la jk"> FROM </strong>:我们应该从哪个表中选择？</li><li id="f329" class="mz na jj la b lb of le og lh oh ll oi lp oj lt on nf ng nh bi translated"><strong class="la jk"> WHERE </strong>:我们可以使用 WHERE 语句过滤数据。</li><li id="7220" class="mz na jj la b lb of le og lh oh ll oi lp oj lt on nf ng nh bi translated"><strong class="la jk">分组依据</strong>:不在聚合中的所有选定列都应该在分组依据中。</li><li id="02bd" class="mz na jj la b lb of le og lh oh ll oi lp oj lt on nf ng nh bi translated"><strong class="la jk">排序依据</strong>:排序依据<code class="fe nn no np nq b">col2sum</code></li></ol><p id="ff37" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">上面的查询将帮助您在数据库中找到大多数简单的东西。</p><p id="2570" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">例如，我们可以使用以下方法找出不同审查级别的电影在不同时间播放的差异:</p><pre class="nj nk nl nm gt nr nq ns nt aw nu bi"><span id="b23c" class="nv md jj nq b gy nw nx l ny nz">SELECT rating, avg(length) as length_avg <br/>FROM sakila.film <br/>GROUP BY rating <br/>ORDER BY length_avg desc;</span></pre><figure class="nj nk nl nm gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oo"><img src="../Images/a427dc43ae531e31ddd7a1803c480080.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xyn274M8szjiJB9TJcI_3w.png"/></div></div></figure><h2 id="f512" class="nv md jj bd me op oq dn mi or os dp mm lh ot ou mo ll ov ow mq lp ox oy ms oz bi translated">练习:提出一个问题</h2><p id="9e9b" class="pw-post-body-paragraph ky kz jj la b lb mu kk ld le mv kn lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">你现在应该提出一些你自己的问题。</p><p id="5f23" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">例如，你可以试着找出 2006 年发行的所有电影。或者试图找到分级为 PG 且长度大于 50 分钟的所有电影。</p><p id="8884" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您可以通过在 MySQL Workbench 上运行以下命令来实现这一点:</p><pre class="nj nk nl nm gt nr nq ns nt aw nu bi"><span id="2fd8" class="nv md jj nq b gy nw nx l ny nz">SELECT * FROM sakila.film WHERE release_year = 2006; <br/>SELECT * FROM sakila.film WHERE length&gt;50 and rating="PG";</span></pre></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="e639" class="mc md jj bd me mf mg mh mi mj mk ml mm kp mn kq mo ks mp kt mq kv mr kw ms mt bi translated">SQL 中的联接</h1><p id="8f86" class="pw-post-body-paragraph ky kz jj la b lb mu kk ld le mv kn lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">到目前为止，我们已经学习了如何使用单个表。但实际上，我们需要处理多个表。</p><p id="9b94" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">接下来我们要学习的是如何连接。</p><p id="34bc" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在连接是 MySQL 数据库不可或缺的一部分，理解它们是必要的。下图讲述了 SQL 中存在的大多数连接。我通常最后只使用左连接和内连接，所以我将从左连接开始。</p><figure class="nj nk nl nm gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pa"><img src="../Images/2453386f12eef4274be193fad388fdd0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*v5TDi8G9FNJgKH6D.jpg"/></div></div></figure><p id="a2d8" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">当您希望保留左表(A)中的所有记录并在匹配记录上合并 B 时，可以使用左连接。在 B 没有被合并的地方，A 的记录在结果表中保持为 NULL。MySQL 的语法是:</p><pre class="nj nk nl nm gt nr nq ns nt aw nu bi"><span id="262c" class="nv md jj nq b gy nw nx l ny nz">SELECT A.col1, A.col2, B.col3, B.col4 <br/>FROM A <br/>LEFT JOIN B <br/>ON A.col2=B.col3</span></pre><p id="440e" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这里，我们从表 A 中选择 col1 和 col2，从表 b 中选择 col3 和 col4。</p><p id="895f" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">当您想要合并 A 和 B，并且只保留 A 和 B 中的公共记录时，可以使用内部联接。</p><h2 id="a230" class="nv md jj bd me op oq dn mi or os dp mm lh ot ou mo ll ov ow mq lp ox oy ms oz bi translated">示例:</h2><p id="485a" class="pw-post-body-paragraph ky kz jj la b lb mu kk ld le mv kn lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">为了给你一个用例，让我们回到我们的 Sakila 数据库。假设我们想知道我们的库存中每部电影有多少拷贝。您可以通过使用以下命令来获得:</p><pre class="nj nk nl nm gt nr nq ns nt aw nu bi"><span id="cfe3" class="nv md jj nq b gy nw nx l ny nz">SELECT film_id,count(film_id) as num_copies <br/>FROM sakila.inventory <br/>GROUP BY film_id <br/>ORDER BY num_copies DESC;</span></pre><figure class="nj nk nl nm gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pb"><img src="../Images/7d08080ef7e9bb58151a7dd69824f202.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dKh5ue8QSEUH4-xVz64jgQ.png"/></div></div></figure><p id="648e" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这个结果看起来有趣吗？不完全是。id 对我们人类来说没有意义，如果我们能得到电影的名字，我们就能更好地处理信息。所以我们四处窥探，发现表<code class="fe nn no np nq b">film</code>和电影<code class="fe nn no np nq b">title</code>都有<code class="fe nn no np nq b">film_id</code>。</p><p id="a4db" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">所以我们有所有的数据，但是我们如何在一个视图中得到它呢？</p><p id="cec9" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">来加入救援。我们需要将<code class="fe nn no np nq b">title</code>添加到我们的库存表信息中。我们可以用——</p><pre class="nj nk nl nm gt nr nq ns nt aw nu bi"><span id="820d" class="nv md jj nq b gy nw nx l ny nz">SELECT A.*, B.title <br/>FROM sakila.inventory A <br/>LEFT JOIN sakila.film B <br/>ON A.film_id = B.film_id</span></pre><figure class="nj nk nl nm gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pc"><img src="../Images/a0743c960ef71f75b47bb39b7b0e18a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d8AIrUXAVHPIoG0cdF0JRg.png"/></div></div></figure><p id="a1ea" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这将向您的库存表信息中添加另一列。正如你可能注意到的，有些电影在<code class="fe nn no np nq b">film</code>表中，而我们在<code class="fe nn no np nq b">inventory</code>表中没有。我们使用了一个左连接，因为我们希望保留库存表中的所有内容，并将其与<code class="fe nn no np nq b">film</code>表中对应的内容连接，而不是与<code class="fe nn no np nq b">film</code>表中的所有内容连接。</p><p id="5bb4" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因此，现在我们将标题作为数据中的另一个字段。这正是我们想要的，但我们还没有解决整个难题。我们想要库存中标题的<code class="fe nn no np nq b">title</code>和<code class="fe nn no np nq b">num_copies</code>。</p><p id="ef41" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">但是在我们继续深入之前，我们应该首先理解内部查询的概念。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="f671" class="mc md jj bd me mf mg mh mi mj mk ml mm kp mn kq mo ks mp kt mq kv mr kw ms mt bi translated">内部查询:</h1><p id="1602" class="pw-post-body-paragraph ky kz jj la b lb mu kk ld le mv kn lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">现在您有了一个可以给出上述结果的查询。您可以做的一件事是使用</p><pre class="nj nk nl nm gt nr nq ns nt aw nu bi"><span id="6495" class="nv md jj nq b gy nw nx l ny nz">CREATE TABLE sakila.temp_table as <br/>SELECT A.*, B.title FROM sakila.inventory A <br/>LEFT JOIN sakila.film B <br/>ON A.film_id = B.film_id;</span></pre><p id="338a" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">然后使用简单的 group by 操作:</p><pre class="nj nk nl nm gt nr nq ns nt aw nu bi"><span id="0ab4" class="nv md jj nq b gy nw nx l ny nz">SELECT title, count(title) as num_copies <br/>FROM sakila.temp_table <br/>GROUP BY title <br/>ORDER BY num_copies desc;</span></pre><figure class="nj nk nl nm gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pd"><img src="../Images/69c8ac4f7bbdf14941ebc4350fcf87dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9IEW6hyDI7ymRyNM2g30nw.png"/></div></div></figure><p id="4ff0" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">但这是多走了一步。我们必须创建一个临时表，它最终会占用系统空间。</p><p id="ab06" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">SQL 为我们提供了针对这类问题的内部查询的概念。相反，您可以在一个查询中编写所有这些内容，使用:</p><pre class="nj nk nl nm gt nr nq ns nt aw nu bi"><span id="2298" class="nv md jj nq b gy nw nx l ny nz">SELECT temp.title, count(temp.title) as num_copies <br/>FROM (<br/>SELECT A.*, B.title <br/>FROM sakila.inventory A <br/>LEFT JOIN sakila.film B <br/>ON A.film_id = B.film_id) temp <br/>GROUP BY title <br/>ORDER BY num_copies DESC;</span></pre><figure class="nj nk nl nm gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pe"><img src="../Images/073edbdf4bac180c0cb2d15b558e6a81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jM3PUCCOYK4Oj8G-VLrzPA.png"/></div></div></figure><p id="3e8b" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们在这里做的是将我们的第一个查询放在括号中，并给这个表一个别名<code class="fe nn no np nq b">temp</code>。然后我们按照操作进行分组，考虑<code class="fe nn no np nq b">temp</code>，就像我们考虑任何表一样。正是因为有了内部查询的概念，我们才能编写有时跨越多个页面的 SQL 查询。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="2de3" class="mc md jj bd me mf mg mh mi mj mk ml mm kp mn kq mo ks mp kt mq kv mr kw ms mt bi translated">从句</h1><p id="5177" class="pw-post-body-paragraph ky kz jj la b lb mu kk ld le mv kn lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">HAVING 是另一个有助于理解的 SQL 结构。所以我们已经得到了结果，现在我们想得到拷贝数小于或等于 2 的影片。</p><p id="1486" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们可以通过使用内部查询概念和 WHERE 子句来做到这一点。这里我们将一个内部查询嵌套在另一个内部查询中。相当整洁。</p><figure class="nj nk nl nm gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pc"><img src="../Images/c44cd5e9adf7f23041b168c68b1531f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pPptgEfGCA9KUgqa9g3ENA.png"/></div></div></figure><p id="26b9" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">或者，我们可以使用 HAVING 子句。</p><figure class="nj nk nl nm gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pf"><img src="../Images/88f50581f677de96b8d61a4fdbd26114.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LjAy9tnGrftBaY2aOyE37Q.png"/></div></div></figure><p id="16e9" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">HAVING 子句用于过滤最终的聚合结果。它不同于 where，因为 WHERE 用于筛选 from 语句中使用的表。在分组发生后，对最终结果进行过滤。</p><p id="97fc" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">正如您在上面的例子中已经看到的，有很多方法可以用 SQL 做同样的事情。我们需要尽量想出最不冗长的，因此在许多情况下有意义的。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="747b" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你能做到这一步，你已经比大多数人知道更多的 SQL。</p><p id="27ed" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">接下来要做的事情:<strong class="la jk"> <em class="lu">练习</em> </strong>。</p><p id="634f" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">尝试在数据集上提出您的问题，并尝试使用 SQL 找到答案。</p><p id="d8b7" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">首先，我可以提供一些问题:</p><ol class=""><li id="7351" class="mz na jj la b lb lc le lf lh nb ll nc lp nd lt on nf ng nh bi translated"><strong class="la jk"> <em class="lu">在我们的盘点中，哪位演员的电影最鲜明？</em>T15】</strong></li><li id="9a83" class="mz na jj la b lb of le og lh oh ll oi lp oj lt on nf ng nh bi translated"><strong class="la jk"> <em class="lu">在我们的盘点中，哪些类型片的租借率最高？</em>T19】</strong></li></ol></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="1a13" class="mc md jj bd me mf mg mh mi mj mk ml mm kp mn kq mo ks mp kt mq kv mr kw ms mt bi translated">继续学习</h1><p id="77ad" class="pw-post-body-paragraph ky kz jj la b lb mu kk ld le mv kn lg lh mw lj lk ll mx ln lo lp my lr ls lt im bi translated">这只是一个关于如何使用 SQL 的简单教程。如果你想了解更多关于 SQL 的知识，我想向你推荐一门来自加州大学的关于数据科学的优秀课程。请务必阅读它，因为它讨论了其他 SQL 概念，如联合、字符串操作、函数、日期处理等。</p><p id="67b8" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">将来我也会写更多初学者友好的帖子。在<a class="ae jg" href="https://medium.com/@rahul_agarwal" rel="noopener"> <strong class="la jk">中</strong> </a>关注我，或者订阅我的<a class="ae jg" href="http://eepurl.com/dbQnuX" rel="noopener ugc nofollow" target="_blank"> <strong class="la jk">博客</strong> </a>了解他们。一如既往，我欢迎反馈和建设性的批评，可以通过 Twitter <a class="ae jg" href="https://twitter.com/MLWhiz" rel="noopener ugc nofollow" target="_blank"> @mlwhiz </a>联系到我。</p><p id="b462" class="pw-post-body-paragraph ky kz jj la b lb lc kk ld le lf kn lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">此外，一个小小的免责声明——这篇文章中可能会有一些相关资源的附属链接，因为分享知识从来都不是一个坏主意。</p></div></div>    
</body>
</html>