<html>
<head>
<title>Robot following a walkway with OpenCV and Tensorflow</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于 OpenCV 和 Tensorflow 的机器人行走</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/robot-following-a-walkway-with-opencv-and-tensorflow-a631eb72cb8c?source=collection_archive---------13-----------------------#2019-03-08">https://towardsdatascience.com/robot-following-a-walkway-with-opencv-and-tensorflow-a631eb72cb8c?source=collection_archive---------13-----------------------#2019-03-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="412e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何用树莓 Pi，计算机视觉，卷积神经网络制作自动驾驶机器人？</h2></div><p id="05d7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在<a class="ae le" href="https://medium.com/@const.toporov/raspberry-pi-photo-tank-robot-cf5ca7288adf" rel="noopener">我的机器人</a>学会了<a class="ae le" href="https://medium.com/@const.toporov/line-following-robot-with-opencv-and-contour-based-approach-417b90f2c298" rel="noopener">如何跟随一条线</a>之后，一个新的挑战出现了。我决定走到户外，让机器人沿着人行道移动。如果机器人像狗一样跟着主人穿过公园就好了。</p><p id="35c3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">行为克隆给出了实现思路。当人工智能学习提供的行为输入和输出，然后对新的输入做出决定时，这是自动驾驶汽车非常受欢迎的方法。有一篇来自 Nvidia 的文章<a class="ae le" href="https://devblogs.nvidia.com/deep-learning-self-driving-cars/" rel="noopener ugc nofollow" target="_blank">介绍了这种方法。</a></p><p id="41f0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">许多好文章都在描述这种想法:</p><ul class=""><li id="c881" class="lf lg it kk b kl km ko kp kr lh kv li kz lj ld lk ll lm ln bi translated"><a class="ae le" href="https://medium.com/@ksakmann/behavioral-cloning-make-a-car-drive-like-yourself-dc6021152713" rel="noopener">一个</a></li><li id="d8ba" class="lf lg it kk b kl lo ko lp kr lq kv lr kz ls ld lk ll lm ln bi translated"><a class="ae le" href="https://medium.com/deep-learning-turkey/behavioral-cloning-udacity-self-driving-car-project-generator-bottleneck-problem-in-using-gpu-182ee407dbc5" rel="noopener">两个</a></li><li id="e5ad" class="lf lg it kk b kl lo ko lp kr lq kv lr kz ls ld lk ll lm ln bi translated"><a class="ae le" rel="noopener" target="_blank" href="/implementing-neural-network-used-for-self-driving-cars-from-nvidia-with-interactive-code-manual-aa6780bc70f4">三个</a></li></ul><p id="d673" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">更令人兴奋的实现是在现实生活中。最好的例子就是<a class="ae le" href="http://www.donkeycar.com/" rel="noopener ugc nofollow" target="_blank"> DonkeyCar </a>和它的<a class="ae le" href="https://wroscoe.github.io/keras-lane-following-autopilot.html" rel="noopener ugc nofollow" target="_blank">神经网络</a>。</p><p id="c675" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">不幸的是，一种天真的方法——在彩色照片上训练神经网络——没有成功。秋天的公园照片大多是灰色的，所以对调整大小和模糊的照片进行训练的神经网络没有提供可靠的结果。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi lt"><img src="../Images/41183637df169068b618d9d811efb3d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YNIo_4o9XP8MIctgDxviVw.jpeg"/></div></div></figure><p id="4fd7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了简化人工智能的任务，我决定用计算机视觉技术对图像进行预处理。OpenCV 库有许多功能，当我需要检测地板上的白线时，它工作得很好。</p><p id="1bf0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这项任务结果并不容易。照片大部分是灰色的，主要问题是“哪种灰色是走道的颜色”。观察发现，人行道就像“完美的灰色”——其 RGB 值之间的差异极小。</p><p id="05a7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">亮度是另一个标准。很难自动确定走道的亮度，所以第一张图片用于调整颜色参数。然后根据参数进行颜色过滤，我们得到了一个带有人行道轮廓的蒙版。</p><p id="160e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">轮廓的形状不精确，并且取决于颜色过滤参数。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi mf"><img src="../Images/f7e8349a13c5bd7433b3c20614c81165.png" data-original-src="https://miro.medium.com/v2/resize:fit:512/format:webp/1*Iw8dGpwo6baoPaRdyJvQ8Q.jpeg"/></div></figure><p id="51b3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下一步是根据走道遮罩做出决定(直走还是左转/右转)。分类的总体思路是查看人行道的右侧边缘:如果边缘更靠左，那么我们需要向左转向。如果没有边缘——向右转向。如果边缘从右下角以一个适中的角度向上——什么也不做，只是开车。</p><p id="bc9a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">考虑到模糊的斑点形状，仅使用几何图形很难识别边缘特征。然后我依靠神经网络来寻找模式。所以我把走道面具放在三个不同的文件夹里，并在上面训练 NN。</p><p id="13dc" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">左、右和直遮罩的示例:</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi mg"><img src="../Images/ec067c2a16635d351d06d5c820416ef9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7-_obSCuQqLt_wMNXyO4CA.png"/></div></div></figure><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi mh"><img src="../Images/7722bd3b56cf3956f4d917e2ef0280b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VxipElwiYdxKLc1PaSx6Mw.png"/></div></div></figure><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="gh gi mi"><img src="../Images/df497d083bf392388885b9fc0b4606eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-ajpO17qCLXBBsO6Z_A4_w.png"/></div></div></figure><p id="8b7c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">从机器学习的角度来说，这是一个具有三类的图像分类任务。灰度图像是理想的输入数据，因此即使是最简单的卷积网络也能显示出出色的结果。我用 Keras over Tensorflow 来教网。</p><pre class="lu lv lw lx gt mj mk ml mm aw mn bi"><span id="c165" class="mo mp it mk b gy mq mr l ms mt">model = Sequential()</span><span id="cded" class="mo mp it mk b gy mu mr l ms mt">activation = "relu"</span><span id="5b62" class="mo mp it mk b gy mu mr l ms mt">model.add(Conv2D(20, 5, padding="same", input_shape=input_shape))<br/>    model.add(Activation(activation))<br/>    model.add(MaxPooling2D(pool_size=(2, 2), strides=(2, 2)))</span><span id="6a1b" class="mo mp it mk b gy mu mr l ms mt">model.add(Conv2D(50, 5, padding="same"))<br/>    model.add(Activation(activation))<br/>    model.add(MaxPooling2D(pool_size=(2, 2), strides=(2, 2)))</span><span id="4fee" class="mo mp it mk b gy mu mr l ms mt">model.add(Flatten())<br/>    model.add(Dense(500))<br/>    model.add(Activation(activation))</span><span id="b4a5" class="mo mp it mk b gy mu mr l ms mt">model.add(Dense(cls_n))</span><span id="28d6" class="mo mp it mk b gy mu mr l ms mt">opt = SGD(lr=0.01)</span><span id="7a04" class="mo mp it mk b gy mu mr l ms mt">model.add(Activation("softmax"))</span><span id="52a1" class="mo mp it mk b gy mu mr l ms mt">model.compile(loss="categorical_crossentropy", optimizer=opt,       metrics=["accuracy"])</span></pre><p id="1c82" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下一个挑战是在 Raspberry Pi 上运行一切。</p><p id="ecd1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我用的是旧 Tensorflow 的 Raspbian 8 Jessie，由<a class="ae le" href="https://github.com/samjabrahams/tensorflow-on-raspberry-pi" rel="noopener ugc nofollow" target="_blank"> Sam Abrahams </a>和 OpenCV 3.4 构建(我必须自己构建)。该版本的 Tensorflow 相当旧，无法与 Keras 模型一起工作。</p><p id="06eb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">好在最近 Google 支持了 Tensorflow 的 Raspberry Pi，但是需要 Raspbian 9 Stretch 和 python 3。所以我不得不把所有的机器人固件都移植到新的平台上。OpenCV 也是在那一年开发的，我必须构建 OpenCV 4.0。</p><p id="5b1a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">把一切放在一起——机器人正在公园里散步。</p><figure class="lu lv lw lx gt ly gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/496590391ed7d43ff859d0c1091933b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*kt2d7nFmRaWps-Vj2IsqIw.gif"/></div></figure><h1 id="c27a" class="mw mp it bd mx my mz na nb nc nd ne nf jz ng ka nh kc ni kd nj kf nk kg nl nm bi translated">结论</h1><p id="2555" class="pw-post-body-paragraph ki kj it kk b kl nn ju kn ko no jx kq kr np kt ku kv nq kx ky kz nr lb lc ld im bi translated">最难的是认路。没有台词使这项任务变得困难。识别参数必须根据光线和当地条件进行调整。但是灰度掩模是完美的材料，即使是简单的 CNN 也能得到可预测的结果。</p><h1 id="965d" class="mw mp it bd mx my mz na nb nc nd ne nf jz ng ka nh kc ni kd nj kf nk kg nl nm bi translated">链接</h1><p id="a47a" class="pw-post-body-paragraph ki kj it kk b kl nn ju kn ko no jx kq kr np kt ku kv nq kx ky kz nr lb lc ld im bi translated"><a class="ae le" href="https://github.com/tprlab/pitanq" rel="noopener ugc nofollow" target="_blank"> GitHub repo 与 python 上的完整坦克固件</a></p><p id="8deb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae le" href="https://github.com/tprlab/pitanq-selfwalk" rel="noopener ugc nofollow" target="_blank">神经网络的数据和代码</a></p><p id="6eb2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae le" href="https://github.com/tprlab/pi-opencv" rel="noopener ugc nofollow" target="_blank">为 Raspbian 预建 OpenCV deb 包</a></p><p id="a518" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae le" href="https://github.com/tprlab/pitanq-prod" rel="noopener ugc nofollow" target="_blank">油箱装配说明</a></p><p id="4d70" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae le" href="http://pitanq.com" rel="noopener ugc nofollow" target="_blank">关于坦克的更多信息</a></p></div></div>    
</body>
</html>