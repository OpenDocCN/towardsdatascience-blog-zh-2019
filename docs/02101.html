<html>
<head>
<title>Ranking Programming Languages by Wikipedia Page Views</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过维基百科页面浏览量对编程语言进行排名</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/ranking-programming-languages-by-wikipedia-page-views-f810a04ec55b?source=collection_archive---------20-----------------------#2019-04-06">https://towardsdatascience.com/ranking-programming-languages-by-wikipedia-page-views-f810a04ec55b?source=collection_archive---------20-----------------------#2019-04-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6f96" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在 python 中使用 API 和绘图的演示</h2></div><p id="4dd6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对编程语言的流行程度进行排名有许多不同的方法。Tiobe Index 是一个流行的网站，它根据流行程度对编程语言进行排名。我还看过一些文章，人们通过查看工作列表的数量或堆栈溢出问题的数量来对编程语言的受欢迎程度进行排名。</p><p id="6f52" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">今天，我将利用<a class="ae le" href="https://wikimedia.org/api/rest_v1/#/Pageviews%20data" rel="noopener ugc nofollow" target="_blank">维基媒体应用编程接口</a>，根据 2018 年初以来的总页面浏览量，对一系列编程语言进行排名。</p><p id="4aaf" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">幸运的是，python 自带了方便的内置请求库，这使得从 API 获取数据变得非常容易。我定义了一个简单的函数来从<a class="ae le" href="https://wikimedia.org/api/rest_v1/" rel="noopener ugc nofollow" target="_blank">页面视图 API </a>获取页面视图数据。</p><p id="1c6f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu"> API 请求函数:</strong></p><pre class="lf lg lh li gt lj lk ll lm aw ln bi"><span id="9cc9" class="lo lp it lk b gy lq lr l ls lt">import requests<br/>import numpy as np<br/>import pandas as pd</span><span id="005c" class="lo lp it lk b gy lu lr l ls lt">def wikimedia_request(page_name, start_date, end_date = None):<br/>    '''<br/>    A fucntion that makes requests to the wikimedia pagecveiws API</span><span id="b740" class="lo lp it lk b gy lu lr l ls lt">Parameters<br/>    ----------<br/>    page_name : string<br/>    A string containing the name of the wikipeida page you would like pageviews for<br/>    <br/>    start_date : string<br/>    a date string YYYY/MM/DD indicating the first date that the request should return<br/>    <br/>    end_date : string<br/>    a date string YYYY/MM/DD indicating the last date that the request should return. defaults to system date<br/>    Returns<br/>    -------<br/>    df : pandas DataFrame<br/>    A dataframe with the article name and the number of pageviews.<br/>    '''<br/>    <br/>    # get rid of the / in the date<br/>    sdate = start_date.split("/")<br/>    # join together the text that was split<br/>    sdate = ''.join(sdate)<br/>    # if an end date is not specified<br/>    if end_date == None:<br/>        #get the current date<br/>        end_date = str(datetime.datetime.now())[0:10].split("-")<br/>        edate = ''.join(end_date)<br/>    else:<br/>        # use date from end_date argument<br/>        edate = end_date.split("/")<br/>        edate = edate[0] + edate[1] + edate[2]<br/>    # use these elements to make an api request<br/>    r = requests.get(<br/>        "<a class="ae le" href="https://wikimedia.org/api/rest_v1/metrics/pageviews/per-article/en.wikipedia.org/all-access/all-agents/{}/daily/{}/{" rel="noopener ugc nofollow" target="_blank">https://wikimedia.org/api/rest_v1/metrics/pageviews/per-article/en.wikipedia.org/all-access/all-agents/{}/daily/{}/{</a>}".format(page_name,sdate, edate)<br/>    )<br/>    # get the json<br/>    result = r.json()<br/>    # convert to dateframe<br/>    df = pd.DataFrame(result['items'])<br/>    # the wikimedia api returns 2 extra zeros at the end of the timestamp for some reason<br/>    df['timestamp'] = [i[:-2] for i in df.timestamp]<br/>    # convert to datetime<br/>    df['timestamp'] = pd.to_datetime(df['timestamp'])<br/>    # set timestamp as index<br/>    df.set_index('timestamp', inplace = True)<br/>    # return the article and views columns<br/>    return df[['article', 'views']]</span></pre><p id="b3f0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一旦定义了这个函数，就可以很容易地与 list comprehension 结合使用，为多个页面创建页面视图的数据框架。我定义了一个我感兴趣的 20 种编程语言的列表(诚然这是一个有点随意的列表，这篇文章主要是为了演示一种技术)，然后就这么做。</p><pre class="lf lg lh li gt lj lk ll lm aw ln bi"><span id="28f7" class="lo lp it lk b gy lq lr l ls lt">names = ['Python (programming language)', 'R (programming language)', 'Java (programming language)', <br/>         'Scala (programming_language)', 'JavaScript', 'Swift (programming language)', 'C++', <br/>         'C (programming language)', 'Clojure', 'C Sharp (programming language)', 'F Sharp (programming language)',<br/>        'Julia (programming language)', 'Visual Basic .NET', 'Perl', 'Haskell (programming language)',<br/>        'Go (programming language)', 'Ruby (programming language)', 'PHP', 'Bash (Unix shell)', 'TypeScript']</span><span id="ed12" class="lo lp it lk b gy lu lr l ls lt">dfs = pd.concat([wikimedia_request(x, start_date) for x in names])</span></pre><p id="ba58" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我个人喜欢 python 列表理解，因为它们允许代码简洁、可读。本文中的大部分内容在其他语言中需要更多的代码。</p><h1 id="a029" class="lv lp it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">图形流行度:</h1><p id="bf0e" class="pw-post-body-paragraph ki kj it kk b kl mm ju kn ko mn jx kq kr mo kt ku kv mp kx ky kz mq lb lc ld im bi translated">现在我有了编程语言的数据，我可以使用 pandas 和 matplotlib 创建一个简单的图，看看自 2018 年初以来，哪些语言的搜索量最多。</p><pre class="lf lg lh li gt lj lk ll lm aw ln bi"><span id="fbf5" class="lo lp it lk b gy lq lr l ls lt">means = dfs.groupby('article').mean()['views']<br/>means.sort_values(ascending = False).plot(kind = 'barh', color ='C0', figsize = (12,6))<br/>plt.title('Total Wikipedia Page Views')<br/>sns.despine()<br/>plt.xlabel('Count of Page Views')<br/>plt.ylabel("")<br/>plt.show()</span></pre><figure class="lf lg lh li gt ms gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi mr"><img src="../Images/836f9de759ba5c42bc317495e3edb735.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cXD6VxW6LAr6rWZaYwUV1A.png"/></div></div></figure><ul class=""><li id="fec0" class="mz na it kk b kl km ko kp kr nb kv nc kz nd ld ne nf ng nh bi translated">在大多数语言排行榜上，python、java、javascript 和 C 争夺榜首</li><li id="a97b" class="mz na it kk b kl ni ko nj kr nk kv nl kz nm ld ne nf ng nh bi translated">从我的数据来看，python 是最受欢迎的</li><li id="0782" class="mz na it kk b kl ni ko nj kr nk kv nl kz nm ld ne nf ng nh bi translated">Python 的使用在过去几年里一直在增长</li><li id="bbb6" class="mz na it kk b kl ni ko nj kr nk kv nl kz nm ld ne nf ng nh bi translated">这对我有好处，因为 python 是我使用的主要语言</li></ul><p id="b967" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我还对每种语言的页面每月搜索量的趋势感兴趣。哪些语言在兴趣上呈上升趋势？哪些语言呈现兴趣下降趋势？</p><p id="53a0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我想制作简单的回归图来评估语言兴趣的时间趋势。这在 python 中有点难做到，因为 seaborn 的 regplot 不接受 datetime 对象。我改编了这个<a class="ae le" href="https://stackoverflow.com/questions/29308729/can-i-plot-a-linear-regression-with-datetimes-on-the-x-axis-with-seaborn" rel="noopener ugc nofollow" target="_blank">堆栈溢出</a>答案的代码，用 python 创建了时间序列回归图。</p><pre class="lf lg lh li gt lj lk ll lm aw ln bi"><span id="8801" class="lo lp it lk b gy lq lr l ls lt">def tsregplot(series, ax = None, days_forward = 10, color = 'C0'):<br/>        '''<br/>    A fucntion that makes requests to the wikimedia pagecveiws API</span><span id="315f" class="lo lp it lk b gy lu lr l ls lt">Parameters<br/>    ----------<br/>    series : Pandas datetime index Series<br/>    A pandas Series with datetime index<br/>    <br/>    ax : matplotlib axes object<br/>    A matplotlib axes obect<br/>    <br/>    days_forward : int<br/>    An integer indicating how many days to extend the regression line. This is set at 10 by default so that all points can show. increasing it can be used to forecast regression line foreward<br/>    <br/>    color : string<br/>    A matplotlib color string <br/>    <br/>    Returns<br/>    -------<br/>    ax : matplotlib axes object<br/>    returns a matplotlib axes object with regplot<br/>    '''<br/>    series = series.reset_index()<br/>    series.columns = ['date', 'value']<br/>    if ax == None:<br/>        series['date_ordinal'] = pd.to_datetime(series['date']).apply(lambda date: date.toordinal())<br/>        ax = sns.regplot(<br/>        data=series,<br/>        x='date_ordinal',<br/>        y='value',<br/>        color = color<br/>        )<br/>        ax.set_xlim(series['date_ordinal'].min() - 2, series['date_ordinal'].max() + days_forward)<br/>        ax.set_ylim(series['value'].min() - 1000, series['value'].max() + 1000)<br/>        ax.set_xlabel('date')<br/>        new_labels = [date.fromordinal(int(item)) for item in ax.get_xticks()]<br/>        ax.set_xticklabels(new_labels)<br/>    else:<br/>        series['date_ordinal'] = pd.to_datetime(series['date']).apply(lambda date: date.toordinal())<br/>        ax = sns.regplot(<br/>        data=series,<br/>        x='date_ordinal',<br/>        y='value',<br/>        ax = ax, <br/>        color = color<br/>        )<br/>    <br/>        ax.set_xlim(series['date_ordinal'].min() - 5, series['date_ordinal'].max() + days_forward)<br/>        ax.set_ylim(series['value'].min() * 0.9 , series['value'].max()* 1.1)<br/>        ax.set_xlabel('date')<br/>        new_labels = [date.fromordinal(int(item)).strftime("%m/%Y") for item in ax.get_xticks()]<br/>        ax.set_xticklabels(new_labels)<br/>        return ax</span></pre><p id="6e2a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我可以创建一个简单的 for 循环，为 20 种语言中的每一种绘制时间序列回归图:</p><pre class="lf lg lh li gt lj lk ll lm aw ln bi"><span id="6387" class="lo lp it lk b gy lq lr l ls lt">fig, ax = plt.subplots(10,2, figsize = (16, 20))<br/>ax = ax.ravel()<br/>counter = 0<br/>for i, j in zip(dfs.article.unique(), names):<br/>    string = i<br/>    selected = dfs.query("article == '{}'".format(string))<br/>    tsregplot(selected['views'].resample('M').sum()[:-1], ax = ax[counter])<br/>    ax[counter].set_title(j)<br/>    plt.tight_layout()<br/>    counter += 1<br/>plt.savefig('trendplots.png')</span></pre><figure class="lf lg lh li gt ms gh gi paragraph-image"><div role="button" tabindex="0" class="mt mu di mv bf mw"><div class="gh gi nn"><img src="../Images/101c0315857db6e35e3678c3854dc730.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5vPdOfVGIdXTJa4igw5hGQ.png"/></div></div></figure><p id="285b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">需要注意的几件事:</strong></p><ul class=""><li id="f9c6" class="mz na it kk b kl km ko kp kr nb kv nc kz nd ld ne nf ng nh bi translated">基于维基百科的页面浏览量，<strong class="kk iu"> python 的兴趣实际上一直在下降</strong>。</li><li id="ff82" class="mz na it kk b kl ni ko nj kr nk kv nl kz nm ld ne nf ng nh bi translated">根据维基百科的页面浏览量，对朱莉娅感兴趣的人可能会增加，但这看起来更像是噪音。</li><li id="0ebc" class="mz na it kk b kl ni ko nj kr nk kv nl kz nm ld ne nf ng nh bi translated">基于维基百科页面浏览量，对 Java 的兴趣在增长，对 Scala 的兴趣在萎缩。<a class="ae le" href="https://medium.com/skedulo-engineering/scala-programming-a-skeptics-journey-ac680053780f" rel="noopener"> Scala 是 Java </a>的一个更简单、更现代的替代品。这让我有点吃惊。</li><li id="9041" class="mz na it kk b kl ni ko nj kr nk kv nl kz nm ld ne nf ng nh bi translated">人们对打字稿的兴趣急剧增长，这已经在<a class="ae le" href="https://medium.com/javascript-scene/the-typescript-tax-132ff4cb175b" rel="noopener">的许多文章</a>中有所记载</li><li id="8acb" class="mz na it kk b kl ni ko nj kr nk kv nl kz nm ld ne nf ng nh bi translated">根据维基百科的页面浏览量，人们对围棋的兴趣一直在适度增加。GO 经常被认为是服务器语言的 python 杀手。我自己也玩过一点围棋，但并不觉得它对我的工作(主要是数据科学)非常有用。</li></ul><p id="66d9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">结论:</strong></p><p id="483c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">有许多不同的方法来排列编程语言。我目前找不到任何其他人使用维基百科页面浏览量来对编程语言进行排名(是的，有人可能已经这样做了，但这还不足以找到关于它的文章)。</p><p id="bc36" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我认为维基百科的页面浏览量是衡量人们对编程语言或其他公众感兴趣的话题的一种非常合理的方式。当我对一门新的编程语言感兴趣时，维基百科通常是我首先查看的地方。我认为也可以有把握地假设许多其他人也这样做。</p><p id="c36e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae le" href="https://github.com/pysr1/wikimediaProgrammingLanguages" rel="noopener ugc nofollow" target="_blank"> <strong class="kk iu">代码可以在这里找到</strong> </a></p></div></div>    
</body>
</html>