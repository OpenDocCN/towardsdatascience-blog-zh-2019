# 使用 Python 中的随机优化来拟合神经网络

> 原文：<https://towardsdatascience.com/fitting-a-neural-network-using-randomized-optimization-in-python-71595de4ad2d?source=collection_archive---------9----------------------->

![](img/9c54dd5b039156a57962a8559b801829.png)

## 如何使用随机化优化来为机器学习模型(如神经网络和回归模型)找到最佳权重

Python 的 *mlrose* 包提供了实现一些最流行的随机化和搜索算法的功能，并将它们应用于一系列不同的优化问题领域。

在本教程中，我们将讨论如何使用 *mlrose* 来寻找机器学习模型的最佳权重，如神经网络和回归模型。即解决机器学习权重优化问题。

这是关于使用 *mlrose* 解决随机优化问题的三个系列教程中的第三个。**第 1 部分可以在这里找到**[](/getting-started-with-randomized-optimization-in-python-f7df46babff0)****，第 2 部分可以在这里找到**[](/solving-travelling-salesperson-problems-with-python-5de7e883d847)****。******

# ****什么是机器学习权重优化问题？****

****对于许多不同的机器学习模型，拟合模型参数的过程包括找到最小化给定训练集的预先指定的损失函数的参数值。****

****这种模型的例子包括神经网络、线性回归模型和逻辑回归模型，并且这种模型的最佳模型权重通常使用诸如梯度下降的方法来找到。****

****然而，拟合机器学习模型的参数(或权重)的问题也可以被视为连续状态优化问题，其中损失函数充当适应度函数的角色，并且目标是最小化该函数。****

****通过以这种方式构建问题，我们可以使用任何适用于连续状态优化问题的随机优化算法来拟合模型参数。****

# ****用 mlrose 解决机器学习权重优化问题****

*****mlrose* 包含内置功能，用于解决三种机器学习模型的权重优化问题:(标准)神经网络、线性回归模型和逻辑回归模型。这是分别使用`NeuralNetwork()`、`LinearRegression()`和`LogisticRegression()`类完成的。****

****这些类中的每一个都包括一个`fit`方法，该方法实现了在前面的教程中为给定的训练集定义的解决优化问题的三个步骤。也就是说，****

1.  ****定义一个适应度函数对象。****
2.  ****定义一个优化问题对象。****
3.  ****选择并运行随机优化算法。****

****然而，在拟合机器学习模型时，找到最佳模型权重仅仅是达到目的的一种手段。****

****我们希望找到最佳的模型权重，以便我们可以使用拟合的模型尽可能准确地预测未来观测值的标签，而不是因为我们实际上对知道最佳权重值感兴趣。****

****因此，上面提到的类还包括一个`predict`方法，如果在`fit`方法之后调用，它将使用拟合的模型预测给定测试集的标签。****

****使用 *mlrose* 解决机器学习权重优化问题所涉及的步骤通常是:****

1.  ****初始化机器学习权重优化问题对象。****
2.  ****通过调用在步骤 1 中初始化的对象的`fit`方法，找到给定训练集的最佳模型权重。****
3.  ****通过调用在步骤 1 中初始化的对象的`predict`方法来预测测试集的标签。****

****为了拟合模型权重，用户可以选择使用随机爬山、模拟退火、遗传算法或梯度下降。****

****【在 *mlrose* 中，梯度下降算法仅可用于解决机器学习权重优化问题，主要用于基准测试，因为这是拟合神经网络和回归模型时最常用的算法之一。]****

****我们现在将通过一个示例来说明如何使用 *mlrose* 来将神经网络和回归模型拟合到给定的数据集。****

****在开始这个例子之前，您需要导入 *mlrose* 和 *Numpy* Python 包。****

```
**import mlrose
import numpy as np**
```

## ****示例:虹膜数据集****

****Iris 数据集是一个著名的多元分类数据集，由统计学家和生物学家罗纳德·费雪在 1936 年的一篇研究论文中首次提出。****

****![](img/87bb6de46a8980e991ee6655e4644965.png)****

****Irises (1889) by Vincent Van Gogh****

****它包含鸢尾花的三个类(种)的 150 个观察值(每个类 50 个观察值)，每个观察值提供所考虑的每个花的萼片长度、萼片宽度、花瓣长度和花瓣宽度(即特征值)，以及类标签(即目标值)。****

****虹膜数据集包含在 Python 的 *sklearn* 包中。****

****数据集中第一个观测值的特征值和标注以及每个要素的最大值和最小值和唯一标注值如下所示:****

```
**The feature values for Obs 0 are:  [5.1 3.5 1.4 0.2]The feature names are:  ['sepal length (cm)', 'sepal width (cm)', 'petal length (cm)', 'petal width (cm)']The target value for Obs 0 is: 0The target name for Obs 0 is: setosaThe minimum values of the four features are: [4.3 2\.  1\.  0.1]The maximum values of the four features are: [7.9 4.4 6.9 2.5]The unique target values are: [0 1 2]**
```

****由此我们可以看出，虹膜数据集中的所有特征都是数字的，尽管范围不同，并且类别标签已经由整数表示。****

****在接下来的几节中，我们将展示如何使用 *mlrose* 将神经网络和逻辑回归模型拟合到该数据集，从而根据其特征值预测鸢尾花的种类。****

# ****数据预处理****

****在我们可以将任何类型的机器学习模型拟合到数据集之前，有必要将我们的数据处理成 *mlrose* 所期望的形式。****

****由 *mlrose* 支持的三个机器学习模型中的每一个都期望以 *Numpy* 数组的形式接收特征数据，每个观察值一行，并且只有数字特征(任何分类特征在传递到机器学习模型之前必须被一键编码)。****

****模型还期望接收以下目标值:数值列表(用于回归数据)；0-1 指标值的列表(针对二元分类数据)；或者作为独热编码标签的 *Numpy* 数组，每个观察值一行(用于多类分类数据)。****

****在虹膜数据集的例子中，我们所有的特征都是数字的，所以不需要一次性编码。然而，有必要对类别标签进行一次性编码。****

****为了与标准的机器学习实践保持一致，还需要将数据分成训练和测试子集，并且由于虹膜数据的范围从特征到特征变化很大，因此需要标准化我们的特征变量的值。****

****这些预处理步骤实现如下:****

# ****神经网络****

****一旦数据经过预处理，在 *mlrose* 中拟合神经网络只需遵循上面列出的步骤。****

****假设我们希望将神经网络分类器适配到具有一个包含 2 个节点的隐藏层和一个 ReLU 激活函数的 Iris 数据集( *mlrose* 支持 ReLU、identity、sigmoid 和 tanh 激活函数)。****

****对于此示例，我们将使用随机爬山算法来查找最佳权重，该算法最多迭代 1000 次，并且在每一步尝试 100 次来查找更好的权重集。****

****我们还将包括一个偏差项；使用步长(学习率)0.0001(查找当前权重集的邻居)；并将我们的权重限制在-5 到 5 的范围内(以减少算法为了找到最佳权重而必须搜索的范围)。****

****该模型已初始化，并符合我们的预处理数据，如下所示:****

****模型拟合后，我们可以使用它来预测我们的训练集和测试集的标签，并使用这些预测来评估模型的训练和测试准确性。****

```
**Training accuracy: 0.45Test accuracy: 0.533333333333**
```

****在这种情况下，我们的模型实现了 45%的训练精度和 53.3%的测试精度。这些精度水平比随机选择标签要好，但仍有改进的空间。****

****我们可以通过调整初始化神经网络对象时设置的参数来提高模型的准确性。假设我们决定将优化算法改为梯度下降，但保持所有其他模型参数不变。****

```
**Training accuracy: 0.625Test accuracy: 0.566666666667**
```

****这导致训练准确率提高了 39%，达到 62.5%，但测试准确率的提高要小得多，达到 56.7%。****

# ****线性和逻辑回归模型****

****线性和逻辑回归模型是神经网络的特例。线性回归是没有隐藏层和身份激活函数的回归神经网络，而逻辑回归是没有隐藏层和 sigmoid 激活函数的分类神经网络。****

****因此，我们可以使用`NeuralNetwork()`类，通过适当地设置参数，将这些模型中的任何一个与我们的数据相匹配。****

****例如，假设我们希望使用随机爬山算法和上一节示例中设置的所有其他参数对虹膜数据进行逻辑回归拟合。我们可以这样初始化一个`NeuralNetwork()`对象:****

****然而，为了方便起见， *mlrose* 提供了`LinearRegression()`和`LogisticRegression()`包装类，它们简化了模型初始化。****

****因此，在 Iris 数据集示例中，我们可以如下初始化和拟合我们的逻辑回归模型:****

```
**Training accuracy: 0.191666666667Test accuracy: 0.0666666666667**
```

****该模型实现了 19.2%的训练精度和 6.7%的测试精度，这比我们通过随机选择值来预测标签的情况更差。****

****尽管如此，如前一节所述，我们可以通过调整初始化时设置的参数来提高模型的准确性。****

****假设我们把学习率提高到 0.01。****

```
**Training accuracy: 0.683333333333Test accuracy: 0.7**
```

****这极大地提高了训练和测试的准确性，现在训练的准确性达到了 68.3%，测试的准确性达到了 70%。****

# ****摘要****

****在本教程中，我们讨论了如何使用 *mlrose* 来寻找三种机器学习模型的最佳权重:神经网络、线性回归模型和逻辑回归模型。****

****将随机优化算法应用于机器学习权重优化问题肯定不是解决该问题的最常见方法。然而，它用来展示 *mlrose* 软件包和一般随机优化算法的多功能性。****

*******要了解更多关于 mlrose 的信息，请访问这个包的 GitHub 资源库，这里有***[](https://github.com/gkhayes/mlrose)****。********

******Genevieve Hayes 博士是数据科学家、教育家和人工智能及分析专家，拥有*[*Genevieve Hayes Consulting*](https://www.genevievehayes.com/)*。你可以在*[*LinkedIn*](https://www.linkedin.com/in/gkhayes/)*或者*[*Twitter*](https://twitter.com/genevievekhayes)*上关注她。她还是* [*价值驱动数据科学*](https://www.genevievehayes.com/episodes/) *的主持人，这是一个每月两次的播客，面向希望最大化其数据和数据团队价值的企业。******

******想要发掘企业数据的价值，但不知道从哪里开始？**[***下载免费的数据科学项目发现指南。***](https://www.genevievehayes.com/discovery-guide/)******