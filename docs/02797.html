<html>
<head>
<title>Creating your unique image data set</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">创建您独特的图像数据集</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/creating-your-unique-image-data-set-90f7d58d3a4d?source=collection_archive---------25-----------------------#2019-05-06">https://towardsdatascience.com/creating-your-unique-image-data-set-90f7d58d3a4d?source=collection_archive---------25-----------------------#2019-05-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="dc97" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用谷歌视觉和谷歌照片创建我自己的数据集</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/813affb75c695dc26599c7de8ed822c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_Kh8TzABRb5lAqAz69Ftnw.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Photo by <a class="ae ky" href="https://unsplash.com/photos/FwF_fKj5tBo?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Alice Achterhof</a> on <a class="ae ky" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="5511" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在进行我的第一个 ML 项目时，我需要一个特定的数据集。我用我两个女儿的面部图像做了一个二元分类模型。</p><p id="bcd0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我开始手工裁剪我的私人照片目录。这既乏味又怪异(坐在会议上剪小女孩的照片)</p><p id="75d0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在网上搜索人脸识别和裁剪代码，我找到了不同的解决方案。但是因为我的主要目标是体验机器学习，所以我寻找一种更优雅的方式——一种利用 ML 能力的方式。</p><p id="735b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">谷歌视觉 API 是我的答案。对我来说，这是一个有点棘手的开始，所以我想我应该写下我的经历。</p><p id="93b4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">如果你想直接进入代码，它就在<a class="ae ky" href="https://github.com/alonlavian/FaceCrop" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><h1 id="1ed7" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">从阴霾的心到阴霾的心</h1><p id="5d62" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">为了使用谷歌云平台(GCP)，我必须设置一些小的环境先决条件:</p><ol class=""><li id="485a" class="ms mt it lb b lc ld lf lg li mu lm mv lq mw lu mx my mz na bi translated"><a class="ae ky" href="https://cloud.google.com/resource-manager/docs/creating-managing-projects" rel="noopener ugc nofollow" target="_blank">打造一个 GCP 项目</a>——小菜一碟。</li><li id="c89c" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated"><a class="ae ky" href="https://cloud.google.com/vision/docs/before-you-begin" rel="noopener ugc nofollow" target="_blank">启用视觉应用编程接口</a> —简单易行。</li><li id="6633" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated"><a class="ae ky" href="https://cloud.google.com/billing/docs/how-to/modify-project" rel="noopener ugc nofollow" target="_blank">启用计费</a> —无需动脑筋。</li><li id="c745" class="ms mt it lb b lc nb lf nc li nd lm ne lq nf lu mx my mz na bi translated"><a class="ae ky" href="https://cloud.google.com/docs/authentication/production#obtaining_and_providing_service_account_credentials_manually" rel="noopener ugc nofollow" target="_blank">创建服务帐户</a> —漫步公园。</li></ol><p id="a8df" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">太好了，一次性搞定。它也可能在未来的项目中有用。时间花得值。</p><h1 id="3c35" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">一个有远见的合作实验室</h1><p id="6f03" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">我喜欢使用 google colab，这是一个云中的 jupyter 笔记本，甚至可以给你一个免费的 GPU。它有 Python 2 或 3 和一堆原生预装库，如果你不知道，看看这篇可爱的文章。让我们开门见山:</p><ol class=""><li id="7cf4" class="ms mt it lb b lc ld lf lg li mu lm mv lq mw lu mx my mz na bi translated">安装视觉</li></ol><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="79d0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">2.安装 google drive:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="171f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">3.通过设置环境变量 GOOGLE_APPLICATION_CREDENTIALS，为您的应用程序代码提供您之前获得的身份验证凭证。你也可以使用代码来完成，但我发现这种方式更容易，我已经将文件上传到我的驱动器，并且我正在以这种方式使用它，而不是直接上传到 colab。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="faa0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在是有趣的部分。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ni"><img src="../Images/a461d286d6e15622c84cfe262bbea58c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-OWcHXRUwFGlVoUOMK6kXg.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">The fun part</figcaption></figure><h1 id="5df0" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">像热的一样修剪它</h1><p id="2cd1" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated"><a class="ae ky" href="https://googleapis.github.io/google-cloud-python/latest/vision/gapic/v1/api.html" rel="noopener ugc nofollow" target="_blank"> vision 客户端 API </a>很大，所以我将把重点放在这个任务所需的最低限度上。我的裁剪代码是来自 vision 教程网站的两个例子的合并。<a class="ae ky" href="https://cloud.google.com/vision/docs/face-tutorial" rel="noopener ugc nofollow" target="_blank">人脸检测教程</a>和<a class="ae ky" href="https://cloud.google.com/vision/docs/crop-hints" rel="noopener ugc nofollow" target="_blank">裁剪提示教程</a>。</p><p id="3b26" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们先来看看人脸检测代码。这非常简单:我们创建一个服务对象，然后从<em class="nj"> Image </em>资源请求 face_detection 注释。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="ac68" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">返回值是一个<em class="nj">面标注</em>对象的数组。这些对象包含<a class="ae ky" href="https://cloud.google.com/vision/docs/reference/rest/v1/images/annotate#FaceAnnotation" rel="noopener ugc nofollow" target="_blank">大量的</a>数据，但是我们感兴趣的是<a class="ae ky" href="https://cloud.google.com/vision/docs/reference/rest/v1/projects.locations.products.referenceImages#BoundingPoly" rel="noopener ugc nofollow" target="_blank"><em class="nj">BoundingPoly</em></a><em class="nj"/>对象(有两个版本:bounding poly 和 fdBoundingPoly，它是多边形的一个更紧凑的版本，只有皮肤)。</p><p id="2e97" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在你已经有了检测到的人脸的坐标，你可以做任何你想做的事情，在它们周围画一个矩形，裁剪它们或者添加胡子。</p><p id="e89b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们在这里有一个任务，所以让我们看看作物代码。我们使用枕头库根据我们从检测方法中得到的顶点来裁剪面，并将每个面保存在不同的文件中。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure><h1 id="b578" class="lv lw it bd lx ly lz ma mb mc md me mf jz mg ka mh kc mi kd mj kf mk kg ml mm bi translated">用照片标记照片</h1><p id="b004" class="pw-post-body-paragraph kz la it lb b lc mn ju le lf mo jx lh li mp lk ll lm mq lo lp lq mr ls lt lu im bi translated">创建我们的数据集现在很容易，我们需要做的就是将一个装满图片和代码的库流式传输，我们很快就会有一个很好的数据集。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="a78e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">但是，唉，许多不同的面孔。我的照片不仅仅是我孩子的照片。有时候一张友好的脸是你最不想看到的。我们需要把小麦从谷壳中分离出来等等。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nk"><img src="../Images/d54fb83a7dc6f07beb8ca77dd42feb93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1334/format:webp/1*n5W1PFVCD8R-UrxKR_lkgg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">I just need this one.</figcaption></figure><p id="447c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让谷歌再一次帮助我们。使用 Google 相册强大的 ML 功能，我们可以轻松地标记我们的数据。请注意，我将所有裁剪的面保存到了我驱动器上的一个文件夹中。这样，照片可以自动索引并标记它们。</p><p id="01df" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，如果我只想要我儿子的微笑，我只需要在搜索框中搜索组合。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/fa3053d0f1125d77ea0bc8253f7e9d94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1334/format:webp/1*dZyVksXHJb2j4UPosq139g.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">name + smile</figcaption></figure><p id="dbd5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就这样，你现在可以选择所有带标签的图片并一次性下载。瞧——很快(很短的时间)就有了一组带标签的图像。</p><p id="c009" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你可以很容易地安排它，并把它送给 Keras ImageDataGenerator <a class="ae ky" href="https://medium.com/@lavian.alon/binary-classification-a-naive-approach-b38ce6e718f5?source=friends_link&amp;sk=828572a0cca4ace721d2711496bd8cff" rel="noopener">例如</a>。</p></div></div>    
</body>
</html>