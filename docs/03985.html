<html>
<head>
<title>Business Analysis in R</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">R 中的业务分析</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/business-analysis-in-r-part-1-advanced-filtering-and-conditional-calculations-c6b3ef7eb7a2?source=collection_archive---------8-----------------------#2019-06-23">https://towardsdatascience.com/business-analysis-in-r-part-1-advanced-filtering-and-conditional-calculations-c6b3ef7eb7a2?source=collection_archive---------8-----------------------#2019-06-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/24cec40be27404f7b2c3cb507b9a78e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8WBBfoxmAl0FAk6h"/></div></div></figure><p id="8cf7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您会发现许多关于人们分析不同数据集的优秀文章，但很难在 R 中找到与业务分析相关的材料。这是我在 R 系列中开始这篇<strong class="ka ir">业务分析的主要原因之一，这样我就可以分享一些有用的方法，让您可以更有效地分析工作中的数据。在我们继续之前，我建议您对 r 中的<strong class="ka ir"> Tidyverse </strong>包有一个基本的了解</strong></p><p id="f010" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这个<a class="ae kw" href="https://www.kaggle.com/aungpyaeap/supermarket-sales" rel="noopener ugc nofollow" target="_blank">数据集</a>中，我将尝试复制我在工作中做的一些任务，你会发现这些真的很有用。您将会看到 R 与 Excel 相比有多么强大。</p></div><div class="ab cl kx ky hu kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ij ik il im in"><h2 id="9c97" class="le lf iq bd lg lh li dn lj lk ll dp lm kj ln lo lp kn lq lr ls kr lt lu lv lw bi translated">加载库</h2><p id="13f2" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv ij bi translated">加载我们将用于数据管理和分析的以下库</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="a194" class="le lf iq mh b gy ml mm l mn mo">library(tidyverse) ## A set of tools for Data manipulation and visualization<br/>library(lubridate) ## for date time manipulation<br/>library(scales) ## Formatting numbers and values<br/>library(hrbrthemes)# For changing ggplot theme<br/>library(extrafont) # More font options</span></pre><h2 id="fa06" class="le lf iq bd lg lh li dn lj lk ll dp lm kj ln lo lp kn lq lr ls kr lt lu lv lw bi translated">读取数据</h2><p id="f3a6" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv ij bi translated">我使用<strong class="ka ir"> read_csv </strong>函数读入数据。只需将文件的路径复制到机器上的任何位置，并将“\”替换为“\\”。我总是将<strong class="ka ir"> trim_ws </strong>参数设置为 TRUE，以防数据中有任何空白。如果它保存为 excel 文件，您可以从<strong class="ka ir"> readxl </strong>包中调用<strong class="ka ir"> read_excel </strong>函数，基本上遵循相同的原则</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="0696" class="le lf iq mh b gy ml mm l mn mo">supermarket_sales &lt;- read_csv("C:\\Users\\Hamza\\Downloads\\supermarket_sales - Sheet1.csv",trim_ws = TRUE)</span></pre><p id="8ece" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">查看数据</strong></p><p id="1e18" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir"> View() </strong>是一个非常方便的功能，它允许你以类似 excel 电子表格的格式查看你的数据，如下所示。我还将使用<strong class="ka ir"> glimpse </strong>函数来检查数据类型</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="a39c" class="le lf iq mh b gy ml mm l mn mo">supermarket_sales %&gt;% View()</span><span id="30bd" class="le lf iq mh b gy mp mm l mn mo">glimpse(supermarket_sales)</span></pre><figure class="mc md me mf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mq"><img src="../Images/4d1885a0463215eee184ca509034ad10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a_RPsaMZEmqa2bvvP7CAMg.png"/></div></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk">Output from View function</figcaption></figure><figure class="mc md me mf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mv"><img src="../Images/3ec2d2a5b35ef30e5de5a84149f7c5bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*56F0QnwiOF3yECVJb1qBHA.png"/></div></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk">Output of glimpse function</figcaption></figure><p id="a974" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">看起来我需要修复我的<strong class="ka ir">日期</strong>和<strong class="ka ir">时间</strong>列，并将它们转换成正确的格式。我将把<strong class="ka ir">时间</strong>列四舍五入到最近的小时，并将<strong class="ka ir">日期</strong>列转换为日期格式。之后，我们将创建一个显示星期几的新列。</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="926f" class="le lf iq mh b gy ml mm l mn mo">supermarket_sales &lt;- supermarket_sales %&gt;% <br/>  mutate(Time=as.POSIXct(Time),Time=hour(Time),<br/>         Date=mdy(Date),weekday = wday(Date,label = TRUE))</span></pre><p id="8d6b" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我首先将<strong class="ka ir">时间</strong>列改为日期-时间类型，并从中提取小时。<strong class="ka ir"> Lubridate </strong>包中的<strong class="ka ir"> mdy </strong>函数允许我将<strong class="ka ir"> Date </strong>列格式化为我从中提取工作日的日期类型</p><h1 id="7e22" class="mw lf iq bd lg mx my mz lj na nb nc lm nd ne nf lp ng nh ni ls nj nk nl lv nm bi translated">分析</h1><p id="505a" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv ij bi translated">让我们从一些探索性的数据分析开始。虽然我们将揭示数据中的不同见解，但这里的主要焦点是让您了解如何在 r 中获得期望的结果。一旦您了解了代码是如何工作的，您就可以以任何方式分析和探索它。</p><h2 id="d778" class="le lf iq bd lg lh li dn lj lk ll dp lm kj ln lo lp kn lq lr ls kr lt lu lv lw bi translated">条形图和多面条形图</h2><p id="a51c" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv ij bi translated">我们将绘制一些条形图，以深入了解与一周中的某一天和某个时间相关的总销售额</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="37d0" class="le lf iq mh b gy ml mm l mn mo">## Creating a summary<br/>sales_by_day &lt;- supermarket_sales %&gt;% group_by(weekday) %&gt;%<br/>                summarise(Total_Sales=sum(Total)) %&gt;% ungroup</span><span id="298a" class="le lf iq mh b gy mp mm l mn mo">##Visualizing summary data</span><span id="a245" class="le lf iq mh b gy mp mm l mn mo">sales_by_day %&gt;% <br/> ggplot(aes(reorder(weekday,Total_Sales),Total_Sales,fill=weekday))+<br/>  geom_col(show.legend = FALSE,color="black")+<br/>geom_text(aes(label=comma(Total_Sales)),size=3,hjust=1,color="black")+<br/>  scale_y_comma()+<br/>  scale_fill_brewer(palette = "Paired")+<br/>  coord_flip()+<br/>  theme_classic()+<br/>  labs(title = "Total Sales breakdown by Weekday and Time",x="Hour of the day",y= "Total sales")</span></pre><figure class="mc md me mf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nn"><img src="../Images/7067cb3e7191ac30c9d38a3c93f08654.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tWwf2BUP15mPgzfQ4jjhzA.png"/></div></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk">Sales by day</figcaption></figure><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="2516" class="le lf iq mh b gy ml mm l mn mo">## Summarizing by day and hour</span><span id="1d80" class="le lf iq mh b gy mp mm l mn mo">sales_by_day_hour &lt;- supermarket_sales %&gt;% group_by(weekday,Time) %&gt;%<br/>  summarise(Total_Sales=sum(Total)) %&gt;% ungroup()</span><span id="6bf6" class="le lf iq mh b gy mp mm l mn mo">## Visualizing</span><span id="3d24" class="le lf iq mh b gy mp mm l mn mo">sales_by_day_hour %&gt;% <br/>  mutate(Time=fct_reorder(Time,Total_Sales)) %&gt;% <br/>  ggplot(aes(Time,Total_Sales,fill=weekday))+<br/>  geom_col(show.legend = FALSE,color="black")+<br/>  geom_text(aes(label=comma(Total_Sales)),size=3,hjust=1,color="black")+<br/>  scale_y_comma()+<br/>  scale_fill_brewer(palette = "Paired")+<br/>  facet_wrap(~weekday,scales="free_y")+<br/>  coord_flip()+<br/>  theme_classic()+<br/>  labs(title = "Total Sales breakdown by Weekday and Time",x="Hour of the day",y= "Total sales")</span></pre><figure class="mc md me mf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi no"><img src="../Images/5b4d26277bb28cd03a831ecf8d35cee6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*obIECX1DCNSGIi8XQG6LGQ.png"/></div></div></figure><h2 id="8f1e" class="le lf iq bd lg lh li dn lj lk ll dp lm kj ln lo lp kn lq lr ls kr lt lu lv lw bi translated">曲线图</h2><p id="48a5" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv ij bi translated">我们现在将探讨不同性别的销售额如何随着时间的推移而变化。</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="cf3b" class="le lf iq mh b gy ml mm l mn mo">supermarket_sales %&gt;%<br/>  group_by(Monthly=floor_date(Date,unit = "1 weeks"),Gender) %&gt;% <br/>  summarise(Total_Sales=sum(Total)) %&gt;% <br/>  ggplot(aes(Monthly,Total_Sales))+<br/>  geom_line(aes(color=Gender),size=1)+<br/>  theme_light()+<br/>  scale_y_comma()+<br/>  labs(title = "Total Sales over time by Gender",subtitle = "Sales for men increased over time",y="Total Sales",x="")</span></pre><figure class="mc md me mf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi np"><img src="../Images/72256f23f67d9d204a34881408027acd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DzeVPu3BRHyHANczhXFpug.png"/></div></div></figure><h2 id="046b" class="le lf iq bd lg lh li dn lj lk ll dp lm kj ln lo lp kn lq lr ls kr lt lu lv lw bi translated">高级过滤</h2><p id="51ab" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv ij bi translated">r 有一些真正强大的数据过滤选项，是其他工具如 Excel 所没有的。例如，我想筛选高于女性平均销售额的销售额。</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="92aa" class="le lf iq mh b gy ml mm l mn mo">supermarket_sales %&gt;% <br/>  filter(Total &gt; mean(Total[Gender=="Female"]))</span></pre><figure class="mc md me mf gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nq"><img src="../Images/4172e54bf748650150b71ea532a3addb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uJF-KXcZuprfLAoVsitH4Q.png"/></div></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk">All sales greater than the average sale of females</figcaption></figure><p id="9022" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你甚至可以更进一步。让我们筛选出高于女性健康和美容产品平均销售额的销售额。</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="93e1" class="le lf iq mh b gy ml mm l mn mo">supermarket_sales %&gt;% <br/>  filter(Total &gt; mean(Total[Gender=="Female"&amp;`Product line`=="Health and beauty"]))</span></pre><p id="494c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这很简单。我所要做的就是在计算平均值时为<strong class="ka ir">产品线</strong>添加一个额外的过滤上下文。</p><p id="825a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">有时，您不知道基于字符的列中的确切字符串，具体地键入每个字符串会很痛苦。这是您可以使用正则表达式来简化事情的地方。</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="e68e" class="le lf iq mh b gy ml mm l mn mo">supermarket_sales %&gt;% <br/>  filter(str_detect(`Product line`,regex("sport|beauty",ignore_case = TRUE)))</span></pre><p id="d72d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">基本上，我过滤的数据在<strong class="ka ir">产品线</strong>列中包含以下字符串。还有一个<strong class="ka ir">否定</strong>参数，您可以将其设置为<strong class="ka ir">真</strong>，它将只显示不包含这些字符串的结果。</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="f44a" class="le lf iq mh b gy ml mm l mn mo">supermarket_sales %&gt;% <br/>  filter(str_detect(`Product line`,regex("sport|beauty",ignore_case = TRUE),negate = TRUE))</span></pre><p id="f818" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">分组依据和汇总</strong></p><p id="b3ca" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这可能是你最常使用的功能。你可能在 R 中看到过很多教程，在那里人们使用这些函数，但是它们只显示了基本的内容，比如<strong class="ka ir"> sum，mean，</strong>或<strong class="ka ir"> count。</strong>但是在现实中，你要计算很多我很少看到任何教程涵盖的条件计算。我将从基本计算开始，然后转向条件计算。</p><p id="21da" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们按城市来看看我们的销售情况。</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="417c" class="le lf iq mh b gy ml mm l mn mo">supermarket_sales %&gt;%<br/>  group_by(City) %&gt;%<br/>  summarise(Total_Sales= sum(Total)) %&gt;% <br/>  arrange(desc(Total_Sales))</span></pre><figure class="mc md me mf gt jr gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/6ec165ffc63074c5e5c008ce0bce69c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:368/format:webp/1*tQ0avOd2HBz3JQmakm8WOg.png"/></div></figure><p id="edce" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是一个简单的计算。我只是将数据按城市分组，计算总销售额，并按最大销售额排列。</p><p id="9bc4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，如果我们想计算每个城市的<strong class="ka ir">分支机构 A </strong>的销售额，我们将这样做。</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="889c" class="le lf iq mh b gy ml mm l mn mo">supermarket_sales %&gt;%<br/>  group_by(City) %&gt;%<br/>  summarise(Total_Sales= sum(Total[Branch=="A"])) %&gt;% <br/>  arrange(desc(Total_Sales))</span></pre><p id="fe80" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我们使用<strong class="ka ir"> [] </strong>来添加一个过滤上下文，与我们之前过滤数据的方式相同。这是我如何计算我所有的条件计算。让我们针对不同的产品和支付类型再做一次</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="2778" class="le lf iq mh b gy ml mm l mn mo">supermarket_sales %&gt;%<br/>  group_by(City) %&gt;%<br/>  summarise(Total_Sales= sum(Total[Payment %in%c("Cash","Credit card")&amp;<br/>                                     str_detect(`Product line`,regex("sport|beauty",ignore_case = TRUE))])) %&gt;% <br/>  arrange(desc(Total_Sales))</span></pre><p id="3a1a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这可能看起来有点复杂，但是当我们分解它时，它是非常简单的。我做了一个条件求和，其中<strong class="ka ir">付款</strong>等于<strong class="ka ir">现金</strong> <em class="ns"> </em>或<strong class="ka ir">信用卡</strong>以及名称中包含<strong class="ka ir">运动</strong>或<strong class="ka ir">美容</strong>的产品。我像以前一样使用<strong class="ka ir"> str_detect </strong>，结合<strong class="ka ir"> regex </strong>来获得我想要的产品，因为我懒得输入它们的长名称。</p><figure class="mc md me mf gt jr gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/e5542b6e4c12b223af9644f5bf0d8fb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:426/format:webp/1*vqXJClWh2dSRmkHR7OhwDg.png"/></div></figure><p id="9673" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这些条件计算的可能性是无限的，我在工作中一直在使用它们。有时你还必须在工作中进行基于时间的计算。例如，<strong class="ka ir">本年销售额</strong>和<strong class="ka ir">去年同期销售额</strong>。我们可以通过遵循与上面相同的原则并结合 L <strong class="ka ir"> ubridate </strong>包的帮助来实现，这个包允许我们操作日期值。</p><pre class="mc md me mf gt mg mh mi mj aw mk bi"><span id="445b" class="le lf iq mh b gy ml mm l mn mo">supermarket_sales %&gt;%<br/>  group_by(City) %&gt;%<br/>  summarise(Total_Sales= sum(Total[Date %within% interval("2019-01-01","2019-03-31")]),<br/>            Same_period_LY=sum(Total[Date %within% interval("2018-01-01","2018-03-31")]))</span></pre><p id="e7c8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这里，我使用了% 内的<strong class="ka ir">%和<strong class="ka ir">间隔</strong>函数来指定我想要聚合的日期。不要担心没有 2018 年的数据，因为没有，但我只是想让你理解这个概念。我真的很喜欢这些“时间智能”计算，因为这些功能让我可以随心所欲地具体。</strong></p><figure class="mc md me mf gt jr gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/3cdd4cc4c99221bd508ee9da817680cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:676/format:webp/1*fBwS_yVjHb8q5AiOjuPaCg.png"/></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk">Time intelligence calculation</figcaption></figure><h1 id="ed10" class="mw lf iq bd lg mx my mz lj na nb nc lm nd ne nf lp ng nh ni ls nj nk nl lv nm bi translated"><strong class="ak">结论</strong></h1><p id="fcad" class="pw-post-body-paragraph jy jz iq ka b kb lx kd ke kf ly kh ki kj lz kl km kn ma kp kq kr mb kt ku kv ij bi translated">这些是我在工作中用来分析数据的一些函数。我将在 R 系列中继续我的<strong class="ka ir">业务分析，分享一些非常酷和有用的方法，告诉你如何在 R 中更有效地分析你的业务数据。</strong></p></div></div>    
</body>
</html>