<html>
<head>
<title>Where did I put my loss values?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我把损失值放在哪里了？</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/where-did-i-put-my-loss-values-acf6264ea347?source=collection_archive---------23-----------------------#2019-05-31">https://towardsdatascience.com/where-did-i-put-my-loss-values-acf6264ea347?source=collection_archive---------23-----------------------#2019-05-31</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="82f4" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何将 PyTorch 中训练深度学习模型时生成的指标和键值添加到您的检查点。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/e0f2967bc726fc5c9e5b3e7c5656d357.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*k0UsBCyh-kWDEroLQNYBvw.jpeg"/></div></figure><p id="fe46" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">保存和加载<a class="ae lm" href="https://pytorch.org/" rel="noopener ugc nofollow" target="_blank"> PyTorch </a>模型非常简单直观。</p><p id="2aae" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">保存模型权重:</p><pre class="kj kk kl km gt ln lo lp lq aw lr bi"><span id="3948" class="ls lt it lo b gy lu lv l lw lx">torch.save(model.state_dict(), PATH)</span></pre><p id="a880" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">负载模型重量:</p><pre class="kj kk kl km gt ln lo lp lq aw lr bi"><span id="1b8d" class="ls lt it lo b gy lu lv l lw lx">model = TheModelClass()<br/>model.load_state_dict(torch.load(PATH))</span></pre><p id="acfb" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">这个 PyTorch <a class="ae lm" href="https://pytorch.org/tutorials/beginner/saving_loading_models.html" rel="noopener ugc nofollow" target="_blank">教程</a>还解释了如何保存优化器状态和其他关于这个主题的好技巧。</p><h1 id="8ea5" class="ly lt it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">但是其他参数呢？</h1><p id="4299" class="pw-post-body-paragraph kq kr it ks b kt mp ju kv kw mq jx ky kz mr lb lc ld ms lf lg lh mt lj lk ll im bi translated">上面的保存和加载示例是加载您的模型的好方法，以便在测试时使用它进行推理，或者如果您使用预训练的模型进行微调。</p><p id="8661" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">现在，假设你在一个非常大的数据集上训练一个非常深的模型，这将花费很多时间，如果你使用<a class="ae lm" href="https://aws.amazon.com/ec2/" rel="noopener ugc nofollow" target="_blank">云实例</a>，这也需要很多钱。一个省钱的好办法是使用<a class="ae lm" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-spot-instances.html" rel="noopener ugc nofollow" target="_blank">现货实例</a>，这样会有很大的折扣。在训练过程中，您可能会丢失实例。仅仅使用模型权重和优化器状态来恢复训练是不够的。您还需要测量的所有指标，例如每个集合的损失和精度值、验证集合的最佳 top-k 精度、到停止点为止的时期数、样本数或迭代数，以及您跟踪的任何其他特殊值。</p><p id="f5f0" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">为了在您恢复培训后继续报告<a class="ae lm" href="https://en.wikipedia.org/wiki/Learning_curve" rel="noopener ugc nofollow" target="_blank">学习进度曲线</a>，以及基于<a class="ae lm" href="https://pytorch.org/docs/stable/optim.html#how-to-adjust-learning-rate" rel="noopener ugc nofollow" target="_blank">停止改进</a>的验证损失等其他动态决策，这些都是必需的。</p><p id="e94e" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">完全恢复一个学习实验也很重要，因为它具有可重复性，发表一篇论文和一个代码库。此外，能够从收敛曲线上的任何“点”开始，在改变或不改变任何超参数的情况下继续学习过程对于新任务或领域的研究是至关重要的。</p></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><p id="b48e" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">我正在使用 PyTorch，处理大型视频数据集，例如<a class="ae lm" href="https://deepmind.com/research/open-source/open-source-datasets/kinetics/" rel="noopener ugc nofollow" target="_blank"> Kinetics </a>。在为我的研究寻找完整的检查点解决方案的过程中，我开始为 PyTorch 开发这样的检查点处理程序，最近发布了 Python 包索引(PyPI)的一个包:<a class="ae lm" href="https://pypi.org/project/pytorchcheckpoint/" rel="noopener ugc nofollow" target="_blank">https://pypi.org/project/pytorchcheckpoint/</a><br/>和一个 GitHub 库:<br/><a class="ae lm" href="https://github.com/bomri/pytorch-checkpoint" rel="noopener ugc nofollow" target="_blank">https://github.com/bomri/pytorch-checkpoint</a>。</p><p id="6a49" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">为了安装软件包:</p><p id="4ad1" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated"><code class="fe nb nc nd lo b">pip install pytorchcheckpoint</code></p><p id="44a3" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">然后，在培训代码开头的某个地方启动课程:</p><pre class="kj kk kl km gt ln lo lp lq aw lr bi"><span id="dff0" class="ls lt it lo b gy lu lv l lw lx">from pytorchcheckpoint.checkpoint import CheckpointHandler<br/>checkpoint_handler = CheckpointHandler()</span></pre><p id="f649" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">现在，除了保存您的模型权重和优化器状态之外，您还可以在学习过程的任何步骤中添加任何其他值。</p><p id="a45f" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">例如，为了节省您可以运行的类的数量:</p><pre class="kj kk kl km gt ln lo lp lq aw lr bi"><span id="3116" class="ls lt it lo b gy lu lv l lw lx"># saving<br/>checkpoint_handler.store_var(var_name='n_classes', value=1000)</span><span id="94d2" class="ls lt it lo b gy ne lv l lw lx"># restoring<br/>n_classes = checkpoint_handler.get_var(var_name='n_classes')</span></pre><p id="7eb3" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">此外，您可以存储值和指标:</p><ul class=""><li id="9be7" class="nf ng it ks b kt ku kw kx kz nh ld ni lh nj ll nk nl nm nn bi translated">每套:培训/验证/测试</li><li id="438c" class="nf ng it ks b kt no kw np kz nq ld nr lh ns ll nk nl nm nn bi translated">对于每个时期/样本/迭代次数</li></ul><p id="d8b6" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">例如，每个历元的训练集和验证集的最高 1 精度值可以通过使用以下来存储:</p><pre class="kj kk kl km gt ln lo lp lq aw lr bi"><span id="b7d9" class="ls lt it lo b gy lu lv l lw lx"># train set - top1<br/>checkpoint_handler.store_running_var_with_header(header=’train’, var_name=’top1', iteration=0, value=80)<br/>checkpoint_handler.store_running_var_with_header(header=’train’, var_name=’top1', iteration=1, value=85)<br/>checkpoint_handler.store_running_var_with_header(header=’train’, var_name=’top1', iteration=2, value=90)<br/>checkpoint_handler.store_running_var_with_header(header=’train’, var_name=’top1', iteration=3, value=91)</span><span id="0d5e" class="ls lt it lo b gy ne lv l lw lx"># valid set - top1<br/>checkpoint_handler.store_running_var_with_header(header=’valid’, var_name=’top1', iteration=0, value=70)<br/>checkpoint_handler.store_running_var_with_header(header=’valid’, var_name=’top1', iteration=1, value=75)<br/>checkpoint_handler.store_running_var_with_header(header=’valid’, var_name=’top1', iteration=2, value=80)<br/>checkpoint_handler.store_running_var_with_header(header=’valid’, var_name=’top1', iteration=3, value=85)</span></pre><p id="b2b5" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">保存和加载完整的检查点只需一行代码:</p><pre class="kj kk kl km gt ln lo lp lq aw lr bi"><span id="6ca3" class="ls lt it lo b gy lu lv l lw lx"># save checkpoint<br/>checkpoint_handler.save_checkpoint(checkpoint_path=path, iteration=25, model=model)</span><span id="8bd2" class="ls lt it lo b gy ne lv l lw lx"># load checkpoint<br/>checkpoint_handler = checkpoint_handler.load_checkpoint(path)</span></pre><p id="f981" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">您可以查看 py torch-check point<a class="ae lm" href="https://github.com/bomri/pytorch-checkpoint#pytorch-checkpoint" rel="noopener ugc nofollow" target="_blank">README</a>以获得更多有用的示例。</p><p id="e02d" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">所以下次你开始训练的时候，确保你手头有这些损失值以备不时之需。</p></div></div>    
</body>
</html>