<html>
<head>
<title>Design Principles for Big Data Performance</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">大数据性能的设计原则</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/design-principles-for-big-data-performance-cd2c0e9e92bd?source=collection_archive---------11-----------------------#2019-09-30">https://towardsdatascience.com/design-principles-for-big-data-performance-cd2c0e9e92bd?source=collection_archive---------11-----------------------#2019-09-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/35a71bbeac8cee3049fb4d8d0e951c94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T-Bt31fc1k0tOHC7mmDzpQ.png"/></div></div></figure><div class=""/><p id="0e56" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">过去 20 年来，大数据技术的发展呈现了一部与不断增长的数据量进行斗争的历史。大数据的挑战尚未解决，这一努力肯定会继续，未来几年数据量将继续增长。原始的关系数据库系统(RDBMS)和相关联的 OLTP(在线事务处理)使得在所有方面使用 SQL 处理数据变得如此容易，只要数据大小足够小以便管理。然而，当数据达到相当大的数量时，处理起来就变得非常困难，因为成功地读取、写入和处理数据需要很长时间，有时甚至是不可能的。</p><p id="05ca" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">总的来说，处理大量数据是数据工程师和数据科学家的普遍问题。这个问题在许多新技术(Hadoop、NoSQL 数据库、Spark 等)中都有体现。)在过去十年中蓬勃发展，这一趋势将继续下去。本文致力于在设计和实现大数据量的数据密集型流程时要记住的主要原则，这可能是为您的机器学习应用程序准备数据，或者从多个来源提取数据并为您的客户生成报告或仪表板。</p><p id="5712" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">事实上，处理大数据的根本问题是资源问题。因为数据量越大，就内存、处理器和磁盘而言，所需的资源就越多。性能优化的目标是减少资源的使用，或者提高充分利用可用资源的效率，从而减少读取、写入或处理数据的时间。任何优化的最终目标应该包括:</p><ol class=""><li id="db32" class="kz la je kd b ke kf ki kj km lb kq lc ku ld ky le lf lg lh bi translated">最大限度地利用可用内存</li><li id="1643" class="kz la je kd b ke li ki lj km lk kq ll ku lm ky le lf lg lh bi translated">减少了磁盘 I/O</li><li id="f0ad" class="kz la je kd b ke li ki lj km lk kq ll ku lm ky le lf lg lh bi translated">最小化网络上的数据传输</li><li id="d2eb" class="kz la je kd b ke li ki lj km lk kq ll ku lm ky le lf lg lh bi translated">并行处理，充分利用多处理器</li></ol><p id="fd50" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">因此，在处理大数据性能时，一个好的架构师不仅仅是一名程序员，还应该具备服务器架构和数据库系统方面的知识。考虑到这些目标，让我们看看设计或优化您的数据流程或应用程序的 4 个关键原则，无论您使用哪种工具、编程语言或框架。</p><p id="bb1c" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd jf">原则 1。基于您的数据量进行设计</strong></p><p id="1620" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在开始构建任何数据流程之前，您需要知道您正在处理的数据量:从什么数据量开始，以及数据量将增长到什么程度。如果数据总是很小，那么设计和实现会更简单、更快。如果数据开始时很大，或者开始时很小但会快速增长，则设计需要考虑性能优化。对于大数据表现良好的应用程序和流程通常会给小数据带来过多的开销，并导致负面影响，从而降低流程速度。另一方面，对于大数据来说，为小数据设计的应用程序需要太长时间才能完成。换句话说，对于小数据和大数据，应用程序或流程的设计应该有所不同。下面详细列出了原因:</p><ol class=""><li id="3f69" class="kz la je kd b ke kf ki kj km lb kq lc ku ld ky le lf lg lh bi translated">因为从端到端处理大型数据集非常耗时，所以中间需要更多的分解和检查点。目标是双重的:首先，在整个流程结束之前，允许用户检查即时结果或在流程的早期提出异常；第二，在作业失败的情况下，允许从最后一个成功的检查点重新开始，避免从头重新开始，这是更昂贵的。对于小数据，相反，由于运行时间短，通常 1 次执行所有步骤的效率更高。</li><li id="03b9" class="kz la je kd b ke li ki lj km lk kq ll ku lm ky le lf lg lh bi translated">在处理小数据时，流程中任何低效率的影响也往往很小，但同样的低效率可能会成为大数据集的主要资源问题。</li><li id="268b" class="kz la je kd b ke li ki lj km lk kq ll ku lm ky le lf lg lh bi translated">并行处理和数据分区(见下文)不仅需要额外的设计和开发时间来实现，而且还会在运行时占用更多的资源，因此，对于小数据应该跳过这些。</li><li id="3ddc" class="kz la je kd b ke li ki lj km lk kq ll ku lm ky le lf lg lh bi translated">当处理大量数据时，性能测试应该包含在单元测试中；这通常不是小数据的问题。</li><li id="426f" class="kz la je kd b ke li ki lj km lk kq ll ku lm ky le lf lg lh bi translated">利用可用的硬件可以快速完成小数据的处理，而当处理大量数据时，由于耗尽内存或磁盘空间，相同的过程可能会失败。</li></ol><p id="0163" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">底线是同一流程设计不能同时用于小数据和大数据处理。大数据处理需要不同的思维方式、以前处理大数据量的经验，以及在初始设计、实现和测试方面的额外努力。另一方面，不要对为大数据设计的流程采取“一刀切”的做法，这可能会损害小数据的性能。</p><p id="806b" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">原则 2:在流程的早期减少数据量。</p><p id="f157" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">当处理大型数据集时，在处理过程的早期减小数据大小始终是获得良好性能的最有效方法。无论投入多少资源和硬件，都没有解决大数据问题的灵丹妙药。因此，在开始真正的工作之前，一定要尽量减少数据量。根据不同的用例，有许多方法可以实现这一点。下面列出了一些常见的技术，以及其他一些技术:</p><ol class=""><li id="e595" class="kz la je kd b ke kf ki kj km lb kq lc ku ld ky le lf lg lh bi translated">当字段为空值时，不要占用存储空间(例如，空间或固定长度字段)。</li><li id="c52d" class="kz la je kd b ke li ki lj km lk kq ll ku lm ky le lf lg lh bi translated">经济地选择数据类型。例如，如果一个数从不为负，则使用整数类型，但不使用无符号整数；如果没有小数，就不要用浮点数。</li><li id="d8d8" class="kz la je kd b ke li ki lj km lk kq ll ku lm ky le lf lg lh bi translated">使用整数中的唯一标识符对文本数据进行编码，因为文本字段会占用更多的空间，应该避免在处理中使用。</li><li id="8914" class="kz la je kd b ke li ki lj km lk kq ll ku lm ky le lf lg lh bi translated">当不需要较低粒度的数据时，数据聚集总是减少数据量的有效方法。</li><li id="d84e" class="kz la je kd b ke li ki lj km lk kq ll ku lm ky le lf lg lh bi translated">尽可能压缩数据。</li><li id="94ab" class="kz la je kd b ke li ki lj km lk kq ll ku lm ky le lf lg lh bi translated">减少字段的数量:只阅读那些真正需要的字段。</li><li id="637e" class="kz la je kd b ke li ki lj km lk kq ll ku lm ky le lf lg lh bi translated">利用复杂的数据结构减少数据重复。一个例子是使用数组结构将一个字段存储在同一个记录中，而不是在字段共享许多其他公共键字段时将每个字段存储在单独的记录中。</li></ol><p id="5e77" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我希望上面的列表能给你一些关于如何减少数据量的想法。事实上，相同的技术已经在许多数据库软件和物联网边缘计算中使用。您对数据和业务逻辑理解得越好，在处理数据之前尝试减少数据的大小时，您就越有创造力。最终的结果是，利用可用的内存、磁盘和处理器，工作效率会高得多。</p><p id="1436" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd jf">原则 3:根据处理逻辑合理划分数据</strong></p><p id="ce87" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">启用数据并行是快速数据处理的最有效方式。随着数据量的增长，并行进程的数量也在增长，因此，添加更多硬件将扩展整体数据处理，而无需更改代码。对于数据工程师来说，一个常用的方法是数据分区。关于数据分区技术有很多细节，这超出了本文的范围。一般来说，有效的分区应该导致以下结果:</p><ol class=""><li id="bdde" class="kz la je kd b ke kf ki kj km lb kq lc ku ld ky le lf lg lh bi translated">允许下游数据处理步骤(如连接和聚合)在同一个分区中进行。例如，如果数据处理逻辑在一个月内是独立的，那么按时间段划分通常是一个好主意。</li><li id="e221" class="kz la je kd b ke li ki lj km lk kq ll ku lm ky le lf lg lh bi translated">每个分区的大小应该是均匀的，以确保处理每个分区所需的时间相同。</li><li id="dd3c" class="kz la je kd b ke li ki lj km lk kq ll ku lm ky le lf lg lh bi translated">随着数据量的增长，分区的数量应该增加，而处理程序和逻辑保持不变。</li></ol><p id="566a" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">此外，根据需要对数据执行的操作，应该考虑在处理的不同阶段更改分区策略以提高性能。例如，在处理用户数据时，用户 ID 的散列分区是一种有效的分区方式。然后，在处理用户的事务时，按时间段(如月或周)进行划分可以使聚合过程更快、更具可伸缩性。</p><p id="82e6" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">Hadoop 和 Spark 将数据存储到数据块中作为默认操作，这使得并行处理能够在本机进行，而不需要程序员进行自我管理。然而，因为他们的框架非常通用，以同样的方式对待所有的数据块，所以它阻止了一个有经验的数据工程师在他或她自己的程序中可以做的更好的控制。因此，了解本文中陈述的原则将有助于您基于可用的工具和您正在使用的工具或软件来优化流程性能。</p><p id="66f9" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd jf">原则 4:尽可能避免不必要的耗费资源的处理步骤</strong></p><p id="7153" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如原则 1 所述，为大数据设计流程与为小数据设计流程有很大不同。设计的一个重要方面是尽可能避免不必要的耗费资源的操作。这需要高技能的数据工程师，他们不仅要很好地理解软件如何与操作系统和可用的硬件资源一起工作，还要全面了解数据和业务用例。在本文中，我只关注为了提高数据处理效率，我们应该避免的前两个过程:数据排序和磁盘 I/O。</p><p id="3a90" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">当 1)与另一个数据集连接时，通常需要将数据记录按一定顺序排列；2)聚合；3)扫描；4)重复数据删除等。但是，当输入数据集远大于可用内存时，排序是最昂贵的操作之一，需要内存和处理器以及磁盘。为了获得良好的性能，按照以下原则非常节俭地进行排序是很重要的:</p><ol class=""><li id="8834" class="kz la je kd b ke kf ki kj km lb kq lc ku ld ky le lf lg lh bi translated">如果数据已经在上游或源系统中排序，则不要再次排序。</li><li id="9152" class="kz la je kd b ke li ki lj km lk kq ll ku lm ky le lf lg lh bi translated">通常，两个数据集的连接需要对两个数据集进行排序，然后合并。将大数据集与小数据集联接时，将小数据集更改为哈希查找。这可以避免对大型数据集进行排序。</li><li id="7194" class="kz la je kd b ke li ki lj km lk kq ll ku lm ky le lf lg lh bi translated">仅在数据大小减小后(原则 2)并在一个分区内(原则 3)进行排序。</li><li id="0cae" class="kz la je kd b ke li ki lj km lk kq ll ku lm ky le lf lg lh bi translated">设计流程时，将需要相同排序的步骤放在一起，以避免重新排序。</li><li id="cfde" class="kz la je kd b ke li ki lj km lk kq ll ku lm ky le lf lg lh bi translated">使用最佳排序算法(例如，合并排序或快速排序)。</li></ol><p id="85cc" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">另一个普遍考虑的因素是减少磁盘 I/O。这方面有许多技术，超出了本文的范围。下面列出了这方面需要考虑的 3 个常见原因:</p><ol class=""><li id="ddbe" class="kz la je kd b ke kf ki kj km lb kq lc ku ld ky le lf lg lh bi translated">数据压缩</li><li id="fc5e" class="kz la je kd b ke li ki lj km lk kq ll ku lm ky le lf lg lh bi translated">数据索引</li><li id="ea47" class="kz la je kd b ke li ki lj km lk kq ll ku lm ky le lf lg lh bi translated">在写入磁盘之前，在内存中执行多个处理步骤</li></ol><p id="5774" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在处理大数据时，数据压缩是必不可少的，因为它允许更快的读写以及更快的网络传输。快速数据访问需要数据文件索引，但代价是写入磁盘的时间更长。仅在必要时对表或文件进行索引，同时牢记它对写入性能的影响。最后，在将输出写入磁盘之前，尽可能在内存中执行多个处理步骤。这种技术不仅用于 Spark，还用于许多数据库技术。</p><h1 id="5785" class="ln lo je bd lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk bi translated"><strong class="ak">总结</strong></h1><p id="750c" class="pw-post-body-paragraph kb kc je kd b ke ml kg kh ki mm kk kl km mn ko kp kq mo ks kt ku mp kw kx ky im bi translated">设计具有良好性能的大数据流程和系统是一项具有挑战性的任务。本文中阐述的 4 个基本原则将为您提供一个指南，让您在处理大数据和其他数据库或系统时，积极主动地和创造性地思考<strong class="kd jf">。最初的设计往往不会带来最佳性能，这主要是因为开发和测试环境中的硬件和数据量有限。因此，在生产中运行流程后，需要多次反复进行性能优化。此外，优化的数据流程通常是为特定的业务用例定制的。当使用新特性增强流程以满足新用例时，某些优化可能会变得无效，需要重新考虑。总而言之，提高大数据的性能是一项永无止境的任务，它将随着数据的增长以及发现和实现数据价值的持续努力而不断发展。</strong></p></div></div>    
</body>
</html>