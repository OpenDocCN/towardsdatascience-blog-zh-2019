<html>
<head>
<title>How Many Guns Were Within 1,000 Feet of Schools in Baltimore in 2018?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">2018 年巴尔的摩学校 1000 英尺范围内有多少枪？</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-many-guns-were-within-1-000-feet-of-schools-in-baltimore-in-2018-16deb60ff9db?source=collection_archive---------49-----------------------#2019-12-13">https://towardsdatascience.com/how-many-guns-were-within-1-000-feet-of-schools-in-baltimore-in-2018-16deb60ff9db?source=collection_archive---------49-----------------------#2019-12-13</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/><div class=""><h2 id="c814" class="pw-subtitle-paragraph jr it iu bd b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki dk translated">对巴尔的摩枪支暴力公开数据的分析显示，数量惊人的枪支犯罪非常接近这座迷人城市的一些最脆弱的居民</h2></div><p id="43b7" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">根据 1990 年的无枪校园法案，如果枪支穿越州界到达学校【1,000 英尺范围内的人不得拥有枪支(因为国会可以通过监管州际商业来监管枪支)，如果持枪者没有获得许可，也不得拥有枪支。想到这一点，我对巴尔的摩发生了多少起持枪杀人案感到好奇。这是我论文的一部分，但由于内容和时间的限制，它不得不从<a class="ae lf" href="https://epidemiological.net/doctoral-dissertation/" rel="noopener ugc nofollow" target="_blank">论文和陈述</a>中删除。</p><p id="968e" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">我的论文数据分析只到 2017 年，所以我很好奇 2018 年发生了什么。我们来看看，用 R 来看看发生了什么？(请注意，在学校 1000 英尺范围内发生的枪支杀人案或枪击案不一定是使用无证枪支进行的。)</p><h1 id="2f25" class="lg lh iu bd li lj lk ll lm ln lo lp lq ka lr kb ls kd lt ke lu kg lv kh lw lx bi translated">数据</h1><p id="744b" class="pw-post-body-paragraph kj kk iu kl b km ly jv ko kp lz jy kr ks ma ku kv kw mb ky kz la mc lc ld le in bi translated">首先，我们从<a class="ae lf" href="https://data.baltimorecity.gov/" rel="noopener ugc nofollow" target="_blank">巴尔的摩城市开放数据门户</a>获得 2018 年巴尔的摩枪支杀人和枪击的数据:</p><figure class="me mf mg mh gu mi gi gj paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gi gj md"><img src="../Images/ab15f51f4a3c62a1ea2d60aee62bf3d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*7uwSQECRMCzhlr63.png"/></div></div></figure><p id="5623" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">这给了我一份 5343 起事件的清单，在这些事件中使用了枪支，并且注明了地点。他们归结为这一点。(注:这些都是举报的罪行。实际数字可能不同。):</p><p id="7ab0" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">犯罪类型|罪名<br/>严重伤害罪| 1474<br/>杀人罪| 273 <br/>抢劫—劫车| 337 <br/>抢劫—商业| 533 <br/>抢劫—住宅| 121 <br/>抢劫—街头| 1928<br/>枪击| 677</p><p id="f1ca" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">有了这些信息，包括经度和纬度，我们把它们放到地图上，看看它们发生在哪里。为了创建这张地图，我使用了来自城市开放数据门户的社区统计区域(CsA)的形状文件。</p><p id="5c34" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">当然，我可以在 QGIS 或 ArcGIS 中完成所有这些操作，它会生成这样的地图:</p><figure class="me mf mg mh gu mi gi gj paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gi gj mp"><img src="../Images/c8a1ac04a947dd419087a0cc8693d640.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*LC8QwbrRBReaMggh.png"/></div></div></figure><p id="a34e" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">这里非常拥挤，因为有很多与枪支有关的犯罪。在 QGIS 和其他使用点击式界面的程序中这样做的问题是，你并没有准确地记录你刚刚做了什么。你必须花时间写一本操作手册来精确地复制上面的地图。或者你可以录下画面。</p><p id="0fc0" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">这就是像 R 这样的程序的用武之地。有了它，你在编写代码的同时也在编写操作手册。注释良好的代码允许下一个人抓取你的代码并精确地复制你的结果，而不需要花什么力气去弄清楚你做了什么以及你是怎么做的。所以让我们用 R 复制上面的地图，甚至得到一些关于哪个学校的枪支犯罪数量最多的统计数据。</p><h1 id="4d41" class="lg lh iu bd li lj lk ll lm ln lo lp lq ka lr kb ls kd lt ke lu kg lv kh lw lx bi translated">代码</h1><p id="503d" class="pw-post-body-paragraph kj kk iu kl b km ly jv ko kp lz jy kr ks ma ku kv kw mb ky kz la mc lc ld le in bi translated">首先，我们要加载一些库。我已经评论了每个库的使用。</p><pre class="me mf mg mh gu mq mr ms mt aw mu bi"><span id="6880" class="mv lh iu mr b gz mw mx l my mz"># Load the required libraries ----</span><span id="0872" class="mv lh iu mr b gz na mx l my mz">library(rgdal) # To manage spatial data<br/>library(tigris) # To manage spatial data<br/>library(tmap) # To create the maps<br/>library(tmaptools) # To add more functionality to the maps created with tmap<br/>library(raster) # To manipulate spatial data<br/>library(sp) # To manipulate spatial data<br/>library(rgeos) # To manipulate spatial data<br/>library(sf) # To manipulate spatial data<br/>library(spatialEco) # To join the layers<br/>library(dplyr) # To manage data (make tables and summarize values)</span></pre><p id="2379" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">现在，让我们输入数据。</p><pre class="me mf mg mh gu mq mr ms mt aw mu bi"><span id="2ade" class="mv lh iu mr b gz mw mx l my mz"># Import the data and make it readable ----</span><span id="ffb6" class="mv lh iu mr b gz na mx l my mz">crimes &lt;-<br/>  read.csv("data/gun_crimes_2018.csv", stringsAsFactors = F) # Import gun crime data<br/>crimes &lt;-<br/>  as.data.frame(lapply(crimes, function(x)<br/>    x[!is.na(crimes$Latitude)])) # Remove crimes without spatial data (i.e. addresses)<br/>csas &lt;-<br/>  readOGR("data", "community_statistical_area") # Import Community Statistical Area shapefiles<br/>schools &lt;- readOGR("data", "bcpss_school") # Import Schools</span></pre><p id="6051" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">现在，让我们把<em class="nb">犯罪</em>从一个数据帧变成一个合适的形状文件，并给它正确的投影。</p><pre class="me mf mg mh gu mq mr ms mt aw mu bi"><span id="cba1" class="mv lh iu mr b gz mw mx l my mz"># Create point shapefile from dataframe ----</span><span id="2754" class="mv lh iu mr b gz na mx l my mz">coordinates(crimes) &lt;-<br/>  ~ Longitude + Latitude # Assign the variables that are the coordinates<br/>writeOGR(crimes, "data", "guncrimes", driver = "ESRI Shapefile") # Write it as a shapefile<br/>guncrimes &lt;- readOGR("data", "guncrimes") # Read it back in<br/>proj4string(guncrimes) &lt;-<br/>  CRS("+proj=longlat +datum=WGS84 +unit=us-ft") # Give the right projection</span></pre><p id="c2b2" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">一行简单的代码来查看不同类型的枪支犯罪数量。</p><pre class="me mf mg mh gu mq mr ms mt aw mu bi"><span id="d426" class="mv lh iu mr b gz mw mx l my mz">table(crimes$Description)</span></pre><p id="b114" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">接下来，因为我们要把层放在彼此之上，我们需要确保它们都有正确的投影(<a class="ae lf" href="https://docs.qgis.org/2.8/en/docs/gentle_gis_introduction/coordinate_reference_systems.html" rel="noopener ugc nofollow" target="_blank">坐标参考系统</a>)。</p><pre class="me mf mg mh gu mq mr ms mt aw mu bi"><span id="5367" class="mv lh iu mr b gz mw mx l my mz"># Fix the projections of the other layers ---</span><span id="969b" class="mv lh iu mr b gz na mx l my mz">pro &lt;- sp::CRS("+proj=longlat +datum=WGS84 +unit=us-ft")<br/>csas &lt;- sp::spTransform(csas, pro)<br/>schools &lt;- sp::spTransform(schools, pro)</span></pre><p id="6316" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">所有的图层都在同一个投影上，让我们使用<em class="nb"> tmap </em>来构建我们的第一张地图。</p><pre class="me mf mg mh gu mq mr ms mt aw mu bi"><span id="bf77" class="mv lh iu mr b gz mw mx l my mz"># Create map of Firearm Crimes ----</span><span id="d406" class="mv lh iu mr b gz na mx l my mz">tmap_mode("plot") # Set tmap to "plot" (instead of "view")</span><span id="edb9" class="mv lh iu mr b gz na mx l my mz">baltimore1 &lt;-<br/>  tm_shape(csas) + # Adds the Community Statistical Areas layer<br/>  tm_borders("black", lwd = .5) + # Makes those borders black and thin<br/>  tm_shape(guncrimes) + # Adds the layer of gun-related crimes<br/>  tm_dots("Dscrptn", # Creates a dot for each gun-related crime, color-coded by type of crime<br/>          title = "Crime Type",<br/>          size = 0.1) +<br/>  tm_compass() + # Adds the north star compass<br/>  tm_legend() + # Adds the legend<br/>  tm_layout( # Controls the layout of the different elements of the map<br/>    main.title = "Map of Firearm Crimes in Baltimore, 2018",<br/>    main.title.size = 1,<br/>    legend.position = c("left", "bottom"),<br/>    compass.type = "4star",<br/>    legend.text.size = 0.7,<br/>    legend.title.size = 0.9<br/>  ) +<br/>  tm_scale_bar( # Adds the scale bar<br/>    size = 0.5,<br/>    color.dark = "black",<br/>    color.light = "white",<br/>    lwd = 1<br/>  ) +<br/>  tmap_options(unit = "mi") # Makes sure the scale bar is in miles</span><span id="02ff" class="mv lh iu mr b gz na mx l my mz">baltimore1 # Let's look at the map</span><span id="6265" class="mv lh iu mr b gz na mx l my mz">tmap_save(tm = baltimore1, # Saves the map<br/>          filename = "Maps/baltimore1.bmp", # File name of the image<br/>          dpi = 600) # Resolution of the image saved</span></pre><p id="f7e5" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">这是我们创造的:</p><figure class="me mf mg mh gu mi gi gj paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gi gj mp"><img src="../Images/88970e195fb76f073585da9c30fab5cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ut1nG1DAMBGqzbKT.jpg"/></div></div></figure><p id="e13b" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">让我们建立第二个学校位置地图。(在这里，我没有太多的评论，因为它是上面第一张图的复制。):</p><pre class="me mf mg mh gu mq mr ms mt aw mu bi"><span id="692f" class="mv lh iu mr b gz mw mx l my mz"># Create map of School locations ----</span><span id="8d24" class="mv lh iu mr b gz na mx l my mz">baltimore2 &lt;-<br/>  tm_shape(csas) +<br/>  tm_borders("black", lwd = .5) +<br/>  tm_shape(schools) +<br/>  tm_dots(<br/>    "CATEGORY",<br/>    shape = 17,<br/>    size = 0.1,<br/>    title = "School Type",<br/>    col = "red",<br/>    legend.show = T<br/>  ) +<br/>  tm_legend() +<br/>  tm_compass() +<br/>  tm_layout(<br/>    main.title = "Map of School Locations in Baltimore, 2018",<br/>    main.title.size = 1,<br/>    legend.position = c("left", "bottom"),<br/>    compass.type = "4star",<br/>    legend.text.size = 0.7,<br/>    legend.title.size = 0.9<br/>  ) +<br/>  tm_scale_bar(<br/>    size = 0.5,<br/>    color.dark = "black",<br/>    color.light = "white",<br/>    lwd = 1<br/>  ) +<br/>  tm_add_legend(<br/>    "symbol",<br/>    col = "red",<br/>    shape = 17,<br/>    size = 0.5,<br/>    labels = "SCHOOL"<br/>  ) +<br/>  tmap_options(unit = "mi")</span><span id="0b40" class="mv lh iu mr b gz na mx l my mz">baltimore2</span><span id="c8be" class="mv lh iu mr b gz na mx l my mz">tmap_save(tm = baltimore2,<br/>          filename = "Maps/baltimore2.jpg",<br/>          dpi = 600)</span></pre><p id="0326" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">这是我们得到的结果:</p><figure class="me mf mg mh gu mi gi gj paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gi gj mp"><img src="../Images/53c136169f7bb48283c8cc01865c27ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*DgzAffwOnAMeHYvS.jpg"/></div></div></figure><p id="0fd2" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">现在，让我们创建一个与枪支相关的犯罪和学校位置的地图:</p><pre class="me mf mg mh gu mq mr ms mt aw mu bi"><span id="5ab3" class="mv lh iu mr b gz mw mx l my mz"># Create map of school locations and firearm crimes locations ----</span><span id="c34d" class="mv lh iu mr b gz na mx l my mz">baltimore3 &lt;-<br/>  tm_shape(csas) +<br/>  tm_borders("black", lwd = .5) +<br/>  tm_shape(schools) +<br/>  tm_dots(<br/>    "CATEGORY",<br/>    shape = 17,<br/>    size = 0.1,<br/>    title = "School Type",<br/>    col = "red",<br/>    legend.show = T<br/>  ) +<br/>  tm_shape(guncrimes) +<br/>  tm_dots("Dscrptn",<br/>          title = "Crime Type",<br/>          size = 0.08) +<br/>  tm_compass() +<br/>  tm_layout(<br/>    main.title = "Map of Firearm Crimes and Schools in Baltimore, 2018",<br/>    main.title.size = 1,<br/>    legend.position = c("left", "bottom"),<br/>    compass.type = "4star",<br/>    legend.text.size = 0.7,<br/>    legend.title.size = 0.9<br/>  ) +<br/>  tm_scale_bar(<br/>    size = 0.5,<br/>    color.dark = "black",<br/>    color.light = "white",<br/>    lwd = 1<br/>  ) +<br/>  tm_add_legend(<br/>    "symbol",<br/>    col = "red",<br/>    shape = 17,<br/>    size = 0.5,<br/>    labels = "SCHOOL"<br/>  ) +<br/>  tmap_options(unit = "mi")</span><span id="3da0" class="mv lh iu mr b gz na mx l my mz">baltimore3</span><span id="5e94" class="mv lh iu mr b gz na mx l my mz">tmap_save(tm = baltimore3,<br/>          filename = "Maps/baltimore3.jpg",<br/>          dpi = 600)</span></pre><p id="e546" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">这是地图:</p><figure class="me mf mg mh gu mi gi gj paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gi gj mp"><img src="../Images/1dda608ecb809965b07574e8071db968.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ZdYPXWS5aK45c1jw.jpg"/></div></div></figure><p id="0104" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">现在，我们要在学校周围建立一个 1000 英尺的缓冲区:</p><pre class="me mf mg mh gu mq mr ms mt aw mu bi"><span id="0fd6" class="mv lh iu mr b gz mw mx l my mz"># Create a 1,000-foot buffer around the schools ----<br/># https://www.rdocumentation.org/packages/raster/versions/2.8-19/topics/buffer</span><span id="fc76" class="mv lh iu mr b gz na mx l my mz">buf &lt;- buffer(schools, # Layer for buffers<br/>              width = 304.8, # Buffer in meters<br/>              dissolve = F)<br/>plot(buf) # Take a look at the result</span></pre><p id="cbeb" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">确保将英尺转换为米，并确保验证您创建的是您正在寻找的东西。</p><p id="c0e5" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">现在，让我们在地图上看看学校周围的缓冲区:</p><pre class="me mf mg mh gu mq mr ms mt aw mu bi"><span id="f391" class="mv lh iu mr b gz mw mx l my mz"># Create map with buffers and schools only ----</span><span id="da88" class="mv lh iu mr b gz na mx l my mz">baltimore4 &lt;-<br/>  tm_shape(csas) +<br/>  tm_borders("black", lwd = .5) +<br/>  tm_shape(buf) +<br/>  tm_borders("blue", lwd = .5) +<br/>  tm_shape(schools) +<br/>  tm_dots(<br/>    "CATEGORY",<br/>    shape = 17,<br/>    size = 0.1,<br/>    title = "School Type",<br/>    col = "red"<br/>  ) +<br/>  tm_compass() +<br/>  tm_layout(<br/>    main.title = "Map of 1000-ft Buffers Around Schools in Baltimore, 2018",<br/>    main.title.size = 1,<br/>    legend.position = c("left", "bottom"),<br/>    compass.type = "4star",<br/>    legend.text.size = 0.7,<br/>    legend.title.size = 0.9<br/>  ) +<br/>  tm_scale_bar(<br/>    size = 0.5,<br/>    color.dark = "black",<br/>    color.light = "white",<br/>    lwd = 1<br/>  ) +<br/>  tm_add_legend(<br/>    "symbol",<br/>    col = "red",<br/>    shape = 17,<br/>    size = 0.5,<br/>    labels = "SCHOOL"<br/>  ) +<br/>  tm_add_legend("line",<br/>                col = "blue",<br/>                size = 0.1,<br/>                labels = "1000-ft Buffer") +<br/>  tmap_options(unit = "mi")</span><span id="733b" class="mv lh iu mr b gz na mx l my mz">baltimore4</span><span id="ed1c" class="mv lh iu mr b gz na mx l my mz">tmap_save(tm = baltimore4,<br/>          filename = "Maps/baltimore4.jpg",<br/>          dpi = 600)</span></pre><p id="8c9a" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">它看起来是这样的:</p><figure class="me mf mg mh gu mi gi gj paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gi gj mp"><img src="../Images/80512341b9282eb5c7f16143fcc28be8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*SU-2S1Xe6ZLrI8cY.jpg"/></div></div></figure><p id="b76b" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">现在，让我们创建最终的地图:</p><pre class="me mf mg mh gu mq mr ms mt aw mu bi"><span id="49d9" class="mv lh iu mr b gz mw mx l my mz"># Create map with buffer, schools and crimes. This is the final map. ----</span><span id="889c" class="mv lh iu mr b gz na mx l my mz">baltimore5 &lt;-<br/>  tm_shape(csas) +<br/>  tm_borders("black", lwd = .5) +<br/>  tm_shape(buf) +<br/>  tm_borders("blue", lwd = .5) +<br/>  tm_shape(schools) +<br/>  tm_dots(<br/>    "CATEGORY",<br/>    title = "Schools",<br/>    shape = 17,<br/>    size = 0.1,<br/>    col = "red"<br/>  ) +<br/>  tm_shape(guncrimes) +<br/>  tm_dots("Dscrptn",<br/>          title = "Crime Type",<br/>          size = 0.08) +<br/>  tm_compass() +<br/>  tm_layout(<br/>    main.title = "Map of Firearm Crimes, Schools and 1,000-ft Buffers in Baltimore, 2018",<br/>    main.title.size = 0.8,<br/>    legend.position = c("left", "bottom"),<br/>    compass.type = "4star",<br/>    legend.text.size = 0.7,<br/>    legend.title.size = 0.9<br/>  ) +<br/>  tm_scale_bar(<br/>    size = 0.5,<br/>    color.dark = "black",<br/>    color.light = "white",<br/>    lwd = 1<br/>  ) +<br/>  tm_add_legend(<br/>    "symbol",<br/>    col = "red",<br/>    shape = 17,<br/>    size = 0.5,<br/>    labels = "SCHOOL"<br/>  ) +<br/>  tm_add_legend("line",<br/>                col = "blue",<br/>                size = 0.1,<br/>                labels = "1000-ft Buffer") +<br/>  tmap_options(unit = "mi")</span><span id="ba89" class="mv lh iu mr b gz na mx l my mz">baltimore5</span><span id="dd57" class="mv lh iu mr b gz na mx l my mz">tmap_save(tm = baltimore5,<br/>          filename = "Maps/baltimore5.jpg",<br/>          dpi = 600)</span></pre><p id="46ea" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">这是它的样子:</p><figure class="me mf mg mh gu mi gi gj paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="gi gj mp"><img src="../Images/97f143a133d6041eeadd350f0b4bb13a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*f1ZJ_5F57SOgujIG.jpg"/></div></div></figure><p id="7a0c" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">那看起来像是在 QGIS 中创建的地图吗？绝对的。只是对标记的样子和大小做了一些调整，我们得到了两张相似的地图。</p><p id="1bcb" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">tmap 的好处是它允许你用一行代码创建一个交互式地图。(另一个 R 包，<em class="nb">传单</em>，做了一些类似的事情，在我看来，甚至可能更“健壮”。)</p><pre class="me mf mg mh gu mq mr ms mt aw mu bi"><span id="d4b2" class="mv lh iu mr b gz mw mx l my mz"># View the final map in interactive mode ---</span><span id="414c" class="mv lh iu mr b gz na mx l my mz">tmap_mode("view") # Set the mode to view in order to create an interactive map<br/>baltimore5<br/>tmap_mode("plot") # Return to plotting if further maps are going to be made</span></pre><p id="31f0" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">现在，为了分析数据，让我们通过将所有点连接到缓冲区来创建一个数据帧。</p><pre class="me mf mg mh gu mq mr ms mt aw mu bi"><span id="ab4d" class="mv lh iu mr b gz mw mx l my mz"># Now to create a dataframe of the gun crimes within the buffer zones ----</span><span id="4a69" class="mv lh iu mr b gz na mx l my mz">crimespoints &lt;- as.data.frame(point.in.poly(guncrimes, # Points<br/>                                            buf)) # Polygons<br/>crimesbuffer &lt;-<br/>  subset(crimespoints, NAME != "NA") # Creating a dataframe of only the points inside the polygons (NAME is not NA)</span></pre><p id="8491" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">如果“<em class="nb"> NAME </em>”是 NA(不可用)，那么这意味着该点不在缓冲区内。我将它细分到“<em class="nb"> crimesbuffer </em>”中，在那里我将对 182 所学校进行分析，这些学校在 1000 英尺范围内至少发生了一起(1)与枪支有关的犯罪，我甚至可以对发生在学校 1000 英尺范围内的 2485 起犯罪进行分析。</p><pre class="me mf mg mh gu mq mr ms mt aw mu bi"><span id="423d" class="mv lh iu mr b gz mw mx l my mz"># Finally, let's see which school had the most gun crimes within 1,000 feet from it ----</span><span id="d803" class="mv lh iu mr b gz na mx l my mz">table &lt;-<br/>  count(crimesbuffer,<br/>        NAME,<br/>        sort = T) # Create a table of names and numbers and sorts it descending<br/>sort(table$n,<br/>     decreasing = T) # Sorting the table<br/>table # View the table<br/>hist(table$n) # Histogram of crime counts (Notice a distribution?)<br/>sum(table$n)</span></pre><p id="b4c2" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">由此，我发现 1000 英尺范围内与枪支相关的犯罪最多的学校是位于莱克伍德大街 200 号的威廉帕卡小学。</p><figure class="me mf mg mh gu mi gi gj paragraph-image"><div class="gi gj nc"><img src="../Images/8f8381aaf85c00b7fc785db1f85d5ddf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1380/format:webp/0*PNMLHkSAd-uGMLUL.png"/></div></figure><p id="c508" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">那所学校方圆 1000 英尺内有 81 起与枪支有关的犯罪。</p><h1 id="11ac" class="lg lh iu bd li lj lk ll lm ln lo lp lq ka lr kb ls kd lt ke lu kg lv kh lw lx bi translated">进一步分析？</h1><p id="7c6d" class="pw-post-body-paragraph kj kk iu kl b km ly jv ko kp lz jy kr ks ma ku kv kw mb ky kz la mc lc ld le in bi translated">从这里开始，你能做的分析类型只受你的数据和想象力的限制。您可以从 CSA shapefiles 中提取社会经济数据，并进行回归，看看是否有任何东西可以预测学校 1000 英尺范围内与枪支相关的犯罪数量。(请记住，您正在处理计数数据，因此您需要使用泊松分布，甚至可能是负二项式回归。还有，记得处理<a class="ae lf" href="https://cran.r-project.org/web/packages/lctools/vignettes/SpatialAutocorrelation.pdf" rel="noopener ugc nofollow" target="_blank">空间自相关</a>。)</p><p id="b587" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated">至少，你现在可以去找决策者或家长教师协会，告诉他们哪些学校附近发生枪支相关犯罪的风险更高。如果你真的雄心勃勃，你可以使用犯罪数据上的时间代码，比较上学期间的犯罪和放学后的犯罪。最后，您可以将缓冲区扩大或缩小到对您的受众有意义的内容。</p><p id="d82e" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated"><a class="ae lf" href="https://epidemiological.net/2019/05/19/how-many-guns-were-within-1000-feet-of-schools-in-baltimore-in-2018/" rel="noopener ugc nofollow" target="_blank"> <em class="nb">这篇博文的上一个版本</em> </a> <em class="nb">出现在我的博客上，</em> <a class="ae lf" href="http://www.epidemiological.net/" rel="noopener ugc nofollow" target="_blank"> <em class="nb">流行病学</em> </a> <em class="nb">，2019 年 5 月 19 日。</em></p><p id="15ff" class="pw-post-body-paragraph kj kk iu kl b km kn jv ko kp kq jy kr ks kt ku kv kw kx ky kz la lb lc ld le in bi translated"><em class="nb"> René F. Najera，公共卫生硕士，是一名流行病学家，</em> <a class="ae lf" href="http://najera.photography/" rel="noopener ugc nofollow" target="_blank"> <em class="nb">业余摄影师</em> </a> <em class="nb">，跑步/骑自行车/游泳爱好者，父亲，以及“无所不在的伟大家伙”(据了解他大脑内部运作的机密消息来源)。你可以发现他是一名流行病学家，在弗吉尼亚州当地的卫生部门工作，在你当地的塔克里餐厅买墨西哥玉米卷，或者在世界上最好的公共卫生学院的校园里，他是流行病学系的助理。</em></p></div></div>    
</body>
</html>