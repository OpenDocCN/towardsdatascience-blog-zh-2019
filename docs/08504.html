<html>
<head>
<title>How To Engineer Features with Geography</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何利用地理信息设计要素</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/datasciencegeography-29a12667c22c?source=collection_archive---------31-----------------------#2019-11-17">https://towardsdatascience.com/datasciencegeography-29a12667c22c?source=collection_archive---------31-----------------------#2019-11-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="4f89" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">理论和真实数据科学示例</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/00b051ab68092c007b61aaff4ab93b2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*zu00uiOI_Wd1ZliK"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Photo by <a class="ae ky" href="https://unsplash.com/@marjan_blan?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Марьян Блан | @marjanblan</a> on <a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="9261" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">每一个销售商品或服务的企业都有一个实际地址。毫无疑问，地理位置可以决定一家企业的成败。对于数据科学家来说，提取<a class="ae ky" href="https://en.wikipedia.org/wiki/Geodesy" rel="noopener ugc nofollow" target="_blank">测地</a>特征，即与地球几何形状相关的特征，可以提供清晰的见解，并显著提高机器学习模型的性能。</p><p id="f2cd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本文中，我们将使用<a class="ae ky" href="https://www.yelp.com/dataset" rel="noopener ugc nofollow" target="_blank"> Yelp 数据集</a>，特别是<code class="fe lv lw lx ly b"><a class="ae ky" href="https://www.yelp.com/dataset/documentation/main" rel="noopener ugc nofollow" target="_blank">business.json</a></code>文件来提取依赖于位置的特征。</p><p id="42ea" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还将从布朗施泰因、塞门迪亚耶夫、穆西奥尔、穆利格(链接到 PDF )的<a class="ae ky" href="https://www.amazon.com/Handbook-Mathematics-I-N-Bronshtein/dp/3540721215" rel="noopener ugc nofollow" target="_blank">数学手册和简菲利普马图切克</a><a class="ae ky" href="http://janmatuschek.de/Contact" rel="noopener ugc nofollow" target="_blank">的</a><a class="ae ky" href="http://janmatuschek.de/LatitudeLongitudeBoundingCoordinates#RefBronstein" rel="noopener ugc nofollow" target="_blank">摘要</a>中汲取经验</p><h1 id="0cc6" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated">数据概述</h1><p id="398a" class="pw-post-body-paragraph kz la it lb b lc mr ju le lf ms jx lh li mt lk ll lm mu lo lp lq mv ls lt lu im bi translated">Yelp <a class="ae ky" href="https://www.yelp.com/dataset/documentation/main" rel="noopener ugc nofollow" target="_blank">文档</a>很好地概述了这些特性，下面是一个简短的片段。</p><pre class="kj kk kl km gt mw ly mx my aw mz bi"><span id="6362" class="na ma it ly b gy nb nc l nd ne">{<br/>    // string, 22 character unique string business id<br/>    <strong class="ly iu">"business_id": "tnhfDv5Il8EaGSXZGiuQGg",</strong><br/><br/>    // string, the business's name<br/>    <strong class="ly iu">"name": "Garaje",</strong><br/><br/>    // string, the full address of the business<br/>    <strong class="ly iu">"address": "475 3rd St",</strong><br/><br/>    // string, the city<br/>    <strong class="ly iu">"city": "San Francisco",</strong><br/><br/>    // string, 2 character state code, if applicable<br/>    <strong class="ly iu">"state": "CA",</strong><br/><br/>    // string, the postal code<br/>    <strong class="ly iu">"postal code": "94107",</strong><br/><br/>    // float, latitude<br/>    <strong class="ly iu">"latitude": 37.7817529521,</strong><br/><br/>    // float, longitude<br/>    <strong class="ly iu">"longitude": -122.39612197,</strong><br/><br/>    // float, star rating, rounded to half-stars<br/>    <strong class="ly iu">"stars": 4.5,</strong><br/><br/>    // integer, number of reviews<br/>    <strong class="ly iu">"review_count": 1198</strong></span></pre><p id="9fe7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">某些地区往往高度发达，有很多企业。此外，相似的企业往往聚集在一起。</p><p id="ee2c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">例如，上面的商店位于旧金山的 SoMA 社区(<em class="nf">有很棒的鳄梨色拉酱</em>)，周围聚集了许多其他餐馆。</p><p id="7219" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将使用纬度和经度来查询其周围企业的数据框架。为此，我们需要一个地理复习员。</p><h1 id="48e9" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated">球面坐标系</h1><p id="1d8f" class="pw-post-body-paragraph kz la it lb b lc mr ju le lf ms jx lh li mt lk ll lm mu lo lp lq mv ls lt lu im bi translated">地球是一个不完美的球体，半径大约为 6357 公里。<a class="ae ky" href="https://en.wikipedia.org/wiki/Geographic_coordinate_system" rel="noopener ugc nofollow" target="_blank">地理坐标系</a>是一种允许在球体上定位点的方法，在<a class="ae ky" href="https://en.wikipedia.org/wiki/Surveying" rel="noopener ugc nofollow" target="_blank">土地测量</a>以及其他专业中经常使用。</p><p id="8002" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将纬度定义为从赤道零度到两极 90 度的角度。相反，<a class="ae ky" href="https://en.wikipedia.org/wiki/Longitude" rel="noopener ugc nofollow" target="_blank">经度</a>从一极到另一极，范围从 0 度到 180 度。下图在一个球体上说明了这两个概念。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/114e6ae6d9691252eb305bb24243fb2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:870/format:webp/0*sEB8nzCE0xnkvw58.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Source: <a class="ae ky" href="https://en.wikipedia.org/wiki/Geographic_coordinate_system" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/Geographic_coordinate_system</a></figcaption></figure><h1 id="32f0" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated">查询邻域中的点</h1><p id="d6ef" class="pw-post-body-paragraph kz la it lb b lc mr ju le lf ms jx lh li mt lk ll lm mu lo lp lq mv ls lt lu im bi translated">现在我们已经定义了坐标系，我们需要一种方法来定义感兴趣点周围的边界框，并抓取它周围的定界区域中的所有点。</p><h2 id="6fe8" class="na ma it bd mb nh ni dn mf nj nk dp mj li nl nm ml lm nn no mn lq np nq mp nr bi translated">球面上的两点</h2><p id="dab4" class="pw-post-body-paragraph kz la it lb b lc mr ju le lf ms jx lh li mt lk ll lm mu lo lp lq mv ls lt lu im bi translated">作为第一种方法，我们可以计算半径为<code class="fe lv lw lx ly b">R</code>的球体上两点<code class="fe lv lw lx ly b">P(lat1, long1)</code>和<code class="fe lv lw lx ly b">Q(lat2, long2)</code>之间的<a class="ae ky" href="https://en.wikipedia.org/wiki/Great-circle_distance" rel="noopener ugc nofollow" target="_blank">顺行距离</a>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/6d4402044aefc93af410bf436fdf59d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uZMzzN4R5bw4KXGc2kYM9w.png"/></div></div></figure><p id="4df8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这种方法非常慢，因为它意味着计算数据集中所有点与所有其他点之间的距离。</p><h2 id="e5e8" class="na ma it bd mb nh ni dn mf nj nk dp mj li nl nm ml lm nn no mn lq np nq mp nr bi translated">角半径</h2><p id="b6d5" class="pw-post-body-paragraph kz la it lb b lc mr ju le lf ms jx lh li mt lk ll lm mu lo lp lq mv ls lt lu im bi translated">一个更好的方法是用<a class="ae ky" href="https://en.wikipedia.org/wiki/Angular_diameter" rel="noopener ugc nofollow" target="_blank">角半径</a>来描述从给定的角度看一个<a class="ae ky" href="https://en.wikipedia.org/wiki/Sphere" rel="noopener ugc nofollow" target="_blank">球体</a>或<a class="ae ky" href="https://en.wikipedia.org/wiki/Circle" rel="noopener ugc nofollow" target="_blank">圆</a>有多大。例如，如果我们想在半径为<code class="fe lv lw lx ly b">R</code>的球体上覆盖距离<code class="fe lv lw lx ly b">d</code>，那么角半径<code class="fe lv lw lx ly b">r</code>为:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/55e6ce9c10bf00503409ae395f784a53.png" data-original-src="https://miro.medium.com/v2/resize:fit:200/format:webp/1*Gs8YDT57AfTno_MWNa3vSA.png"/></div></figure><h2 id="6e48" class="na ma it bd mb nh ni dn mf nj nk dp mj li nl nm ml lm nn no mn lq np nq mp nr bi translated">包围盒</h2><p id="2d17" class="pw-post-body-paragraph kz la it lb b lc mr ju le lf ms jx lh li mt lk ll lm mu lo lp lq mv ls lt lu im bi translated">然后，我们定义完全包围由角半径捕获的区域的节点。沿着纬度移动意味着我们可以沿着子午线移动，保持经度不变。因此，边界纬度定义为:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/dd287ab8b6adc2d778a789c785b9e1c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:404/format:webp/1*f6yQH0FuiFQ2oChUKWjJzA.png"/></div></figure><p id="2bae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">沿着纬度圈移动以找到边界经度的方式与上面的方式不同。在下图中，点<code class="fe lv lw lx ly b">T1</code>和<code class="fe lv lw lx ly b">T2</code>分别具有最大和最小经度。它们与兴趣点<code class="fe lv lw lx ly b">M</code>不在同一纬度圈上，而是更靠近极点。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/c2443217a8305fc531a33ec094431347.png" data-original-src="https://miro.medium.com/v2/resize:fit:464/0*UTv8FzYHyAt4FV0V.gif"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Source: <a class="ae ky" href="http://janmatuschek.de/Contact" rel="noopener ugc nofollow" target="_blank">Jan Philip Matuschek</a></figcaption></figure><p id="367a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe lv lw lx ly b">T1</code>和<code class="fe lv lw lx ly b">T2</code>的纬度是:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/09a7e9ff0fc6abb45b0f9050758239cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:554/format:webp/1*T0YsyS9lswkJpRQJMwpzzw.png"/></div></figure><p id="d46d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，极限经度计算如下:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/079e7301388b290790a3e60c38e01db9.png" data-original-src="https://miro.medium.com/v2/resize:fit:520/format:webp/1*z8Oq3HuqbL49Fa5mihsZHw.png"/></div></figure><p id="12b0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">其中:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/7bec386dbecee4969d04888c75fd4a48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1010/format:webp/1*i6ImywanMQVwAeOnOdtugg.png"/></div></figure><h2 id="b610" class="na ma it bd mb nh ni dn mf nj nk dp mj li nl nm ml lm nn no mn lq np nq mp nr bi translated">数学到 Python</h2><p id="83c4" class="pw-post-body-paragraph kz la it lb b lc mr ju le lf ms jx lh li mt lk ll lm mu lo lp lq mv ls lt lu im bi translated">我们可以用 python 代码来解释上面的方法:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="78ac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在 Garaje 的示例中，我们的代码将返回一个 dataframe，列出 Garaje 半径范围内的所有企业，如下图所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ob"><img src="../Images/aaf0bd001d060a09967ffa808256a5be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bLxpCkAvwntJFE3ujabuQg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Source: <a class="ae ky" href="https://www.mapdevelopers.com/draw-circle-tool.php" rel="noopener ugc nofollow" target="_blank">https://www.mapdevelopers.com/draw-circle-tool.php</a></figcaption></figure><h1 id="d97b" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated">特征工程</h1><p id="5bf6" class="pw-post-body-paragraph kz la it lb b lc mr ju le lf ms jx lh li mt lk ll lm mu lo lp lq mv ls lt lu im bi translated">给定一个像我们这样的数据帧，我们可以编写一个代码来返回一个地理上有界的数据帧的副本(<em class="nf">注意:不是视图</em>)</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nz oa l"/></div></figure><p id="2579" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们能从这些信息中提取什么？事实证明，我们可以学到很多东西:</p><ul class=""><li id="41f1" class="oc od it lb b lc ld lf lg li oe lm of lq og lu oh oi oj ok bi translated">附近有多少商家(<em class="nf">密度</em></li><li id="7020" class="oc od it lb b lc ol lf om li on lm oo lq op lu oh oi oj ok bi translated">价格范围比较</li><li id="793d" class="oc od it lb b lc ol lf om li on lm oo lq op lu oh oi oj ok bi translated">星级比较</li><li id="af06" class="oc od it lb b lc ol lf om li on lm oo lq op lu oh oi oj ok bi translated">审核计数</li><li id="1cdf" class="oc od it lb b lc ol lf om li on lm oo lq op lu oh oi oj ok bi translated">等等…</li></ul><p id="5896" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">进行比较时，缩放特征通常是个好主意。例如，在比较价格时，我们可以通过使用查询数据框架的平均值和标准差来<a class="ae ky" href="https://en.wikipedia.org/wiki/Feature_scaling#Standardization_(Z-score_Normalization)" rel="noopener ugc nofollow" target="_blank">标准化</a> ( <em class="nf"> z 得分标准化</em>)价格。</p><h2 id="45fd" class="na ma it bd mb nh ni dn mf nj nk dp mj li nl nm ml lm nn no mn lq np nq mp nr bi translated">星级评定</h2><p id="2866" class="pw-post-body-paragraph kz la it lb b lc mr ju le lf ms jx lh li mt lk ll lm mu lo lp lq mv ls lt lu im bi translated">作为第一个特征，我们可以绘制每个条目相对于其最近邻居的标准化星级。这似乎是一种高斯分布，一个街区的大多数企业在评级方面都相当同质。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/0879b14ebb5c90ee3d748a99978949ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:810/format:webp/1*T-JzQ30sel2M4jEYvCVJ9A.png"/></div></figure><h2 id="74ec" class="na ma it bd mb nh ni dn mf nj nk dp mj li nl nm ml lm nn no mn lq np nq mp nr bi translated">价格幅度</h2><p id="f7d4" class="pw-post-body-paragraph kz la it lb b lc mr ju le lf ms jx lh li mt lk ll lm mu lo lp lq mv ls lt lu im bi translated">价格比较似乎是<a class="ae ky" href="https://en.wikipedia.org/wiki/Multimodal_distribution" rel="noopener ugc nofollow" target="_blank">双峰</a>，更详细的分析可能会使查询更严格，只包括相同类型的企业。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/d5ae4a4a2ca3aca608e108ad7cb69771.png" data-original-src="https://miro.medium.com/v2/resize:fit:810/format:webp/1*og2UI8Q2n33-258ZD9WKTg.png"/></div></figure><h2 id="c9df" class="na ma it bd mb nh ni dn mf nj nk dp mj li nl nm ml lm nn no mn lq np nq mp nr bi translated">密度计数</h2><p id="b3db" class="pw-post-body-paragraph kz la it lb b lc mr ju le lf ms jx lh li mt lk ll lm mu lo lp lq mv ls lt lu im bi translated">我们将密度定义为有界框内的企业数量。这个特性不需要做任何标准化。</p><p id="e9d5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，根据查询半径和该地区的开发量，下图会有很大变化。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi or"><img src="../Images/89bf43c3c1c1d43750f332e344948b26.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*E69SF8PkTJC8yedcZMAErQ.png"/></div></figure><h1 id="093d" class="lz ma it bd mb mc md me mf mg mh mi mj jz mk ka ml kc mm kd mn kf mo kg mp mq bi translated">结论</h1><p id="a783" class="pw-post-body-paragraph kz la it lb b lc mr ju le lf ms jx lh li mt lk ll lm mu lo lp lq mv ls lt lu im bi translated">适当的特征工程可以为您的机器学习模型提供更好地执行所需的优势。通过考虑地理因素，我们可以推导出依赖于位置的特征。</p><p id="d8b4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在 Yelp 数据集的情况下，当插入大地测量特征时，每个模型的 AUC 至少提高了<strong class="lb iu"> 5% </strong>。在所有算法中，它们在最重要的前 5 个特性中至少出现过一次！</p></div></div>    
</body>
</html>