<html>
<head>
<title>Joining Data Sources</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">联接数据源</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/joining-data-sources-8ca72f19747?source=collection_archive---------21-----------------------#2019-05-03">https://towardsdatascience.com/joining-data-sources-8ca72f19747?source=collection_archive---------21-----------------------#2019-05-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/4e9d4dc067e4faf837a783c42aca2785.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IDGZRKhnsPzPr7kipEFeIg.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">Photo by <a class="ae kf" href="https://unsplash.com/photos/Wiu3w-99tNg?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Christopher Burns</a> on <a class="ae kf" href="https://unsplash.com/search/photos/welding?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="08ef" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现实世界中的大多数“数据科学”都涉及到创建一个数据集、一个可视化、一个需要从非常不同的来源提取和连接数据来讲述一个连贯故事的应用程序。</p><p id="8358" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">跳过玩具数据集，让我们来看一个将不同数据源连接成一个综合地图的完整应用程序。具体来说，我们将回答这个问题:</p><blockquote class="le lf lg"><p id="609a" class="kg kh lh ki b kj kk kl km kn ko kp kq li ks kt ku lj kw kx ky lk la lb lc ld im bi translated"><strong class="ki iu"> <em class="it">洛杉机县哪个邮政编码区的人均星巴克门店最多？</em> </strong></p></blockquote><p id="078c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">举例来说，如果你的工作是在洛杉矶县寻找新星巴克店的最佳地点，你可能会对这个问题的答案非常感兴趣。</p></div><div class="ab cl ll lm hx ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="im in io ip iq"><h1 id="9fd9" class="ls lt it bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">定义最终目标</h1><p id="ae55" class="pw-post-body-paragraph kg kh it ki b kj mq kl km kn mr kp kq kr ms kt ku kv mt kx ky kz mu lb lc ld im bi translated">我们的最终目标是创建洛杉矶县的地图。我们的 choropleth 地图基本上满足以下要求:</p><blockquote class="le lf lg"><p id="9c23" class="kg kh lh ki b kj kk kl km kn ko kp kq li ks kt ku lj kw kx ky lk la lb lc ld im bi translated"><em class="it"> -所有的</em> <strong class="ki iu"> <em class="it">邮政编码边界</em> </strong> <em class="it">都要画出来</em></p><p id="997c" class="kg kh lh ki b kj kk kl km kn ko kp kq li ks kt ku lj kw kx ky lk la lb lc ld im bi translated"><em class="it"> -每个邮政编码应根据人均星巴克门店数量</em>以可变强度  <em class="it">着色</em> <strong class="ki iu"> <em class="it"/></strong></p></blockquote></div><div class="ab cl ll lm hx ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="im in io ip iq"><h1 id="5793" class="ls lt it bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">我们需要什么类型的数据？</h1><p id="b3d5" class="pw-post-body-paragraph kg kh it ki b kj mq kl km kn mr kp kq kr ms kt ku kv mt kx ky kz mu lb lc ld im bi translated">好的，所以我们肯定需要某种地理数据来绘制邮政编码的形状。我们还需要洛杉矶县每家星巴克的位置信息。当然，我们需要一些邮政编码为的 LA 县的人口信息。总而言之，我们需要:</p><blockquote class="le lf lg"><p id="0057" class="kg kh lh ki b kj kk kl km kn ko kp kq li ks kt ku lj kw kx ky lk la lb lc ld im bi translated"><strong class="ki iu"> <em class="it"> 1。</em> </strong> <em class="it">洛杉矶县邮政编码边界的地理数据(最好是 GeoJSON 文件，是描述复杂形状的 JSON)</em></p><p id="833f" class="kg kh lh ki b kj kk kl km kn ko kp kq li ks kt ku lj kw kx ky lk la lb lc ld im bi translated"><strong class="ki iu"> <em class="it"> 2。</em> </strong> <em class="it">洛杉机郡每家星巴克店的位置(最好是带有每家店邮政编码的电子表格)</em></p><p id="0ce9" class="kg kh lh ki b kj kk kl km kn ko kp kq li ks kt ku lj kw kx ky lk la lb lc ld im bi translated"><strong class="ki iu">3<em class="it">。</em> </strong> <em class="it">洛杉矶县人口按邮政编码(最好是电子表格)</em></p></blockquote></div><div class="ab cl ll lm hx ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="im in io ip iq"><h1 id="f691" class="ls lt it bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">我们可以在哪里找到数据？</h1><p id="c1e5" class="pw-post-body-paragraph kg kh it ki b kj mq kl km kn mr kp kq kr ms kt ku kv mt kx ky kz mu lb lc ld im bi translated">厉害！我们已经确定了我们理想中需要的数据类型。现在，让我们考虑一下<strong class="ki iu"> <em class="lh">在哪里</em> </strong>我们会得到这些数据集。</p><p id="8241" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">地理数据似乎很容易，在谷歌上搜索“<em class="lh"> la county zipcode geojson </em>”最终让我找到了合适的 geojson，存储在我的 GitHub <a class="ae kf" href="https://github.com/ritvikmath/StarbucksStoreScraping/blob/master/laZips.geojson" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><p id="cecf" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">事实证明，星巴克门店的位置数据要复杂得多。我发现的数据集要么是<strong class="ki iu">过时了</strong>，要么只是<strong class="ki iu">特定的州而不是特定的县</strong>。为了获得这些数据，我必须对官方的<a class="ae kf" href="https://www.starbucks.com/store-locator" rel="noopener ugc nofollow" target="_blank">星巴克商店定位器</a>做一些非常仔细的 API 查询。事实上，这个过程非常有趣，足以让我单独写一篇关于它的文章:</p><div class="mv mw gp gr mx my"><a rel="noopener follow" target="_blank" href="/quick-and-dirty-data-gathering-with-python-9d3d4b8cba13"><div class="mz ab fo"><div class="na ab nb cl cj nc"><h2 class="bd iu gy z fp nd fr fs ne fu fw is bi translated">使用 Python 快速收集脏数据</h2><div class="nf l"><h3 class="bd b gy z fp nd fr fs ne fu fw dk translated">洛杉矶县有多少家星巴克？</h3></div><div class="ng l"><p class="bd b dl z fp nd fr fs ne fu fw dk translated">towardsdatascience.com</p></div></div><div class="nh l"><div class="ni l nj nk nl nh nm jz my"/></div></div></a></div><p id="04b2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对于人口数据集，我在网上找到了一些我想要的预制电子表格，但老实说，我不确定它们的有效性。我认为直接从美国人口普查局获得人口数据要安全得多。获取这些数据需要非常具体地调用人口普查局 API，我有一整篇文章专门介绍这个过程:</p><div class="mv mw gp gr mx my"><a rel="noopener follow" target="_blank" href="/getting-census-data-in-5-easy-steps-a08eeb63995d"><div class="mz ab fo"><div class="na ab nb cl cj nc"><h2 class="bd iu gy z fp nd fr fs ne fu fw is bi translated">通过 5 个简单的步骤获得人口普查数据</h2><div class="nf l"><h3 class="bd b gy z fp nd fr fs ne fu fw dk translated">为您的项目收集人口数据的简明指南</h3></div><div class="ng l"><p class="bd b dl z fp nd fr fs ne fu fw dk translated">towardsdatascience.com</p></div></div><div class="nh l"><div class="nn l nj nk nl nh nm jz my"/></div></div></a></div><p id="4393" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您可以在我的 GitHub 上找到所有三个结果数据集:</p><ul class=""><li id="3109" class="no np it ki b kj kk kn ko kr nq kv nr kz ns ld nt nu nv nw bi translated">洛城县的 GeoJSON 是<a class="ae kf" href="https://github.com/ritvikmath/StarbucksStoreScraping/blob/master/laZips.geojson" rel="noopener ugc nofollow" target="_blank">这里的</a></li><li id="4466" class="no np it ki b kj nx kn ny kr nz kv oa kz ob ld nt nu nv nw bi translated">洛杉矶县星巴克位置数据集是<a class="ae kf" href="https://github.com/ritvikmath/StarbucksStoreScraping/blob/master/starbucksInLACounty.csv" rel="noopener ugc nofollow" target="_blank">这里是</a></li><li id="9d97" class="no np it ki b kj nx kn ny kr nz kv oa kz ob ld nt nu nv nw bi translated">洛杉矶县人口(按邮政编码)数据集是<a class="ae kf" href="https://github.com/ritvikmath/StarbucksStoreScraping/blob/master/laZipPopulations.csv" rel="noopener ugc nofollow" target="_blank">这里是</a></li></ul></div><div class="ab cl ll lm hx ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="im in io ip iq"><h1 id="602b" class="ls lt it bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">我们将如何连接数据集？</h1><p id="b3cd" class="pw-post-body-paragraph kg kh it ki b kj mq kl km kn mr kp kq kr ms kt ku kv mt kx ky kz mu lb lc ld im bi translated">好了，我们已经得到了想要的数据。现在，让我们想出一个策略，如何将所有这些结合在一起，制作出我们想要的地图。为了制作地图，我们需要洛杉矶县每个邮政编码的人均星巴克门店数量。目前，我们有创建该指标所需的两个部分，人口数据和商店数据，但需要将它们结合在一起。</p><p id="f203" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">因此，使用<strong class="ki iu">两阶段方法</strong>是有意义的。第一阶段将把人口数据与商店位置数据结合起来，第二阶段将把产生的<strong class="ki iu">人均商店</strong>数据集与地理数据结合起来。</p><p id="d62e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">大概是这样的:</p><figure class="od oe of og gt ju gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/a7c669ae4d37f85dca7e82070dc151fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1196/format:webp/1*rpLGzLWxPyQ2oRd8NofLkA.png"/></div></figure><h1 id="cdb1" class="ls lt it bd lu lv oh lx ly lz oi mb mc md oj mf mg mh ok mj mk ml ol mn mo mp bi translated"><strong class="ak">第一阶段:加入人口和店铺位置数据</strong></h1><p id="dcf0" class="pw-post-body-paragraph kg kh it ki b kj mq kl km kn mr kp kq kr ms kt ku kv mt kx ky kz mu lb lc ld im bi translated">让我们看一下这两个电子表格的快照，以确定如何将它们连接起来。</p><h2 id="69af" class="om lt it bd lu on oo dn ly op oq dp mc kr or os mg kv ot ou mk kz ov ow mo ox bi translated">人口数据</h2><figure class="od oe of og gt ju gh gi paragraph-image"><div class="gh gi oy"><img src="../Images/51bfd85a96c206f9013e5ac6603649e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:582/format:webp/1*AZrcX-kdCxk6xBaS9kijUQ.png"/></div></figure><h2 id="54ff" class="om lt it bd lu on oo dn ly op oq dp mc kr or os mg kv ot ou mk kz ov ow mo ox bi translated">存储位置数据</h2><figure class="od oe of og gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oz"><img src="../Images/196c48029b46e014a1def2bcfb415a33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_0iRtkn4w-pbxaIB4n3sBw.png"/></div></div></figure><p id="4c38" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">看起来我们应该能够将邮政编码列上的两个数据集连接起来，但是有一个问题。商店位置数据包含洛杉矶县每家星巴克商店的一行，但我们真的希望每个邮政编码占一行，商店总数占另一列。让我们使用 python 来做一些<strong class="ki iu">快速和肮脏的数据转换</strong>！</p><figure class="od oe of og gt ju"><div class="bz fp l di"><div class="pa pb l"/></div></figure><p id="ae95" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一旦我们转换了商店位置数据集，它就包含邮政编码作为索引，邮政编码中的星巴克商店数量作为列。</p><figure class="od oe of og gt ju gh gi paragraph-image"><div class="gh gi pc"><img src="../Images/9727c6d0946589c6e974edc5cf7c3b21.png" data-original-src="https://miro.medium.com/v2/resize:fit:546/format:webp/1*IhabQ6tXpluny99ccaiUbA.png"/></div></figure><p id="8202" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，让我们将两个数据集连接在一起:</p><figure class="od oe of og gt ju"><div class="bz fp l di"><div class="pa pb l"/></div></figure><p id="5c0c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">随后，<strong class="ki iu"> <em class="lh"> joinedDf </em> </strong>看起来是这样的:</p><figure class="od oe of og gt ju gh gi paragraph-image"><div class="gh gi pd"><img src="../Images/02abb4bfa4cc26b5db88947aaa830aaa.png" data-original-src="https://miro.medium.com/v2/resize:fit:798/format:webp/1*GZSpquqfCn9XutKIKid9uQ.png"/></div></figure><blockquote class="le lf lg"><p id="98cc" class="kg kh lh ki b kj kk kl km kn ko kp kq li ks kt ku lj kw kx ky lk la lb lc ld im bi translated"><strong class="ki iu"> <em class="it">怎么有些词条是南？</em> </strong> <em class="it">好吧，如果某个邮政编码存在于人口数据集中，而不存在于商店数据集中，那么它的</em><strong class="ki iu">numStores<em class="it"/></strong><em class="it">值就会缺失，反之亦然。我们马上会处理这个问题。</em></p></blockquote><p id="30c2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，让我们通过将商店数量除以每个邮政编码的总人口来创建人均商店指标。我们还将删除所有人均商店为空或无穷大的邮政编码(如果邮政编码的人口为零)。</p><figure class="od oe of og gt ju"><div class="bz fp l di"><div class="pa pb l"/></div></figure><p id="5ce0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">由此产生的<strong class="ki iu"> <em class="lh"> joinedDf </em> </strong>看起来像是:</p><figure class="od oe of og gt ju gh gi paragraph-image"><div class="gh gi pe"><img src="../Images/f3acb213629118056b4040f34742ce3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*GN6aszsrdiqEaJFgRqokgg.png"/></div></figure><p id="91e9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">不错！第一阶段已经完成。我们有一个数据框架，其中包含每个邮政编码的人均商店数。</p></div><div class="ab cl ll lm hx ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="im in io ip iq"><h1 id="4f02" class="ls lt it bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">阶段 2:使用地理数据绘制人均商店地图</h1><p id="5727" class="pw-post-body-paragraph kg kh it ki b kj mq kl km kn mr kp kq kr ms kt ku kv mt kx ky kz mu lb lc ld im bi translated">现在我们有了包含人均商店的数据集，我们可以在洛杉矶县的地图上绘制这些值，其形状细节存储在我们的地理数据中。让我们创建我们的 choropleth 地图吧！</p><figure class="od oe of og gt ju"><div class="bz fp l di"><div class="pa pb l"/></div></figure><p id="0b0e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你生成的<strong class="ki iu"><em class="lh">laChoropleth.html</em></strong>地图将是交互式的，当你打开它时，你将能够点击、拖动和缩放。我们来看看结果如何。</p><figure class="od oe of og gt ju gh gi paragraph-image"><div class="gh gi pf"><img src="../Images/6ab1a728b9b2781345ab86528887534f.png" data-original-src="https://miro.medium.com/v2/resize:fit:970/format:webp/1*n56_QV9SYLq6W6ifz_vYdw.png"/></div></figure><p id="41c4" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们确实在地图上看到一些不同深浅的绿色，但是似乎没有太多的变化。这通常发生在 choropleth 图中，当所讨论的变量存在较大的异常值时。对于我们的例子，这意味着对于<strong class="ki iu"> <em class="lh">商店人均</em> </strong>来说，有一些邮政编码的<strong class="ki iu"> <em class="lh">值非常大，而大多数邮政编码的值相对较小。</em></strong></p><p id="5d20" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们将在这里做一个折衷，<strong class="ki iu">通过<strong class="ki iu"> <em class="lh"> storesPerCapita 删除邮政编码的前 10% </em></strong>。 </strong>在生成的地图中会有更多缺失的邮政编码，但保留下来的邮政编码会显示出更好的色谱。我们还将缺失的邮政编码涂成灰色，这样我们就可以知道它们确实缺失了。这是我们最后的舞蹈。</p><figure class="od oe of og gt ju gh gi paragraph-image"><div class="gh gi pg"><img src="../Images/04c1b44493107e7322f387432c198114.png" data-original-src="https://miro.medium.com/v2/resize:fit:968/format:webp/1*SRvxsUI3252Us11lU3w--g.png"/></div></figure><p id="2f52" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">正如我们所看到的，由于各种原因，<strong class="ki iu">有相当多的邮政编码</strong>缺失。这可能是因为缺少人口或商店数量的值，或者可能是因为人口为零，或者可能是因为我们在上一步中选择了将其删除。不管怎样，留下的邮政编码显示出比原来的 choropleth 更好的颜色渐变<strong class="ki iu">。你绘制地图的确切方式<strong class="ki iu">完全取决于你</strong>！</strong></p></div><div class="ab cl ll lm hx ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="im in io ip iq"><p id="bec6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">希望本指南演示了如何收集、连接并最终可视化不同的数据源，对您未来的数据工作有所帮助。<strong class="ki iu">感谢阅读！</strong></p></div></div>    
</body>
</html>