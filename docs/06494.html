<html>
<head>
<title>Easy Machine Learning in the Browser: Real-time Image Classification</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">浏览器中的简易机器学习:实时图像分类</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/easy-machine-learning-in-the-browser-31b225d6cee0?source=collection_archive---------24-----------------------#2019-09-17">https://towardsdatascience.com/easy-machine-learning-in-the-browser-31b225d6cee0?source=collection_archive---------24-----------------------#2019-09-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/></div><div class="ab cl jq jr hx js" role="separator"><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv"/></div><div class="im in io ip iq"><figure class="jy jz ka kb gt kc gh gi paragraph-image"><div role="button" tabindex="0" class="kd ke di kf bf kg"><div class="gh gi jx"><img src="../Images/31a52a825ce117f1cf23dc975433cb8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*rMgMX0zBR3BvXUPB"/></div></div><figcaption class="kj kk gj gh gi kl km bd b be z dk">Photo by <a class="ae kn" href="https://unsplash.com/@kasya?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Kasya Shahovskaya</a> on <a class="ae kn" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><blockquote class="ko kp kq"><p id="3636" class="kr ks kt ku b kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">利用 Tensorflow.js KNN 模块和 Angular 在浏览器中训练实时图像识别模型</p></blockquote><p id="c977" class="pw-post-body-paragraph kr ks it ku b kv kw kx ky kz la lb lc lq le lf lg lr li lj lk ls lm ln lo lp im bi translated">将机器学习应用部署到生产环境中曾经是一个令人望而生畏的过程，因为它需要在许多不同的环境中处理复杂的操作。随着 Tensorflow.js 的引入，使用 javascript 在 web 浏览器中开发、训练和部署机器学习应用程序变得超级容易。</p><p id="4f3e" class="pw-post-body-paragraph kr ks it ku b kv kw kx ky kz la lb lc lq le lf lg lr li lj lk ls lm ln lo lp im bi translated">为了演示这一点，我将使用 Angular 创建一个简化版本的<a class="ae kn" href="https://teachablemachine.withgoogle.com" rel="noopener ugc nofollow" target="_blank">可示教机器</a>演示应用程序。这个演示应用程序教你的计算机使用你的网络摄像头在网络浏览器中实时识别图像。</p><p id="d820" class="pw-post-body-paragraph kr ks it ku b kv kw kx ky kz la lb lc lq le lf lg lr li lj lk ls lm ln lo lp im bi translated">为了实现这一点，我将使用 Tensorflow.js 提供的 KNN 模块。该模块使用<a class="ae kn" href="https://en.wikipedia.org/wiki/K-nearest_neighbors_algorithm" rel="noopener ugc nofollow" target="_blank">的 K-最近邻</a>算法创建一个分类器。它不是为模型提供权重，而是使用另一个模型的激活来创建 KNN 模型。</p><p id="6bf9" class="pw-post-body-paragraph kr ks it ku b kv kw kx ky kz la lb lc lq le lf lg lr li lj lk ls lm ln lo lp im bi translated">为此，mobilenet 图像分类模型是一个非常好的选择，因为它是轻量级的，可以在 Tensorflow 中使用。机器学习中的这一过程被称为迁移学习，因为我们使用的是另一种机器学习模型的表示。</p><figure class="jy jz ka kb gt kc gh gi paragraph-image"><div role="button" tabindex="0" class="kd ke di kf bf kg"><div class="gh gi lt"><img src="../Images/8d79fc33a229b0079ecf2c040d93f6a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_tmWw6dHuV_kqUk0"/></div></div><figcaption class="kj kk gj gh gi kl km bd b be z dk">Photo by <a class="ae kn" href="https://unsplash.com/@yirage?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Andrii Podilnyk</a> on <a class="ae kn" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="8003" class="pw-post-body-paragraph kr ks it ku b kv kw kx ky kz la lb lc lq le lf lg lr li lj lk ls lm ln lo lp im bi translated">在深入细节之前，让我们首先更好地了解应用程序中遵循的步骤是什么；</p><p id="7c98" class="pw-post-body-paragraph kr ks it ku b kv kw kx ky kz la lb lc lq le lf lg lr li lj lk ls lm ln lo lp im bi translated"><strong class="ku iu"> <em class="kt"> Step1: </em> </strong></p><p id="0a97" class="pw-post-body-paragraph kr ks it ku b kv kw kx ky kz la lb lc lq le lf lg lr li lj lk ls lm ln lo lp im bi translated">用户应提供并标记用于训练的 3 组输入图像。网络摄像头和浏览器上的按钮可用于此目的。</p><p id="4cf1" class="pw-post-body-paragraph kr ks it ku b kv kw kx ky kz la lb lc lq le lf lg lr li lj lk ls lm ln lo lp im bi translated"><strong class="ku iu"> <em class="kt">第二步</em> </strong>:</p><p id="8782" class="pw-post-body-paragraph kr ks it ku b kv kw kx ky kz la lb lc lq le lf lg lr li lj lk ls lm ln lo lp im bi translated">一旦为所有输入图像提供了标签，将通过将输入图像转储到 mobilenet 模型中来预测激活张量。然后，这些激活张量将被用作 KNN 分类器的输入，以创建具有分配给所提供的每个激活张量的标签的数据集。培训过程将在这一步完成。</p><p id="8ae7" class="pw-post-body-paragraph kr ks it ku b kv kw kx ky kz la lb lc lq le lf lg lr li lj lk ls lm ln lo lp im bi translated"><strong class="ku iu"> <em class="kt">步骤三:</em> </strong></p><p id="3bb6" class="pw-post-body-paragraph kr ks it ku b kv kw kx ky kz la lb lc lq le lf lg lr li lj lk ls lm ln lo lp im bi translated">对于预测，从网络摄像头捕捉的图像将被实时输入 mobilenet 模型，以获得激活张量。这些将被输入到训练好的 KNN 模型中，以识别图像的类别。</p><p id="378d" class="pw-post-body-paragraph kr ks it ku b kv kw kx ky kz la lb lc lq le lf lg lr li lj lk ls lm ln lo lp im bi translated">一开始看起来有点复杂，但是一旦用例子一步一步地解释，就很容易理解了。</p><figure class="jy jz ka kb gt kc gh gi paragraph-image"><div role="button" tabindex="0" class="kd ke di kf bf kg"><div class="gh gi lu"><img src="../Images/5c792e441ca062279c2d52288a10e391.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*IpqB-18h05l9fsGc"/></div></div><figcaption class="kj kk gj gh gi kl km bd b be z dk">Photo by <a class="ae kn" href="https://unsplash.com/@vegasphotog?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Robert Baker</a> on <a class="ae kn" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="2fba" class="pw-post-body-paragraph kr ks it ku b kv kw kx ky kz la lb lc lq le lf lg lr li lj lk ls lm ln lo lp im bi translated">在开始编码之前，让我们进一步了解 K-最近邻算法和 Tensorflow.js KNN 模块是如何工作的。</p></div><div class="ab cl jq jr hx js" role="separator"><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv"/></div><div class="im in io ip iq"><h1 id="9d70" class="lv lw it bd lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms bi translated">K 近邻算法是如何工作的？</h1><p id="5ba9" class="pw-post-body-paragraph kr ks it ku b kv mt kx ky kz mu lb lc lq mv lf lg lr mw lj lk ls mx ln lo lp im bi translated">k 近邻(KNN)是一种简单、易于实现的机器学习算法，在推荐系统和基于相似性的分类任务中有许多实际用途。</p><p id="f71f" class="pw-post-body-paragraph kr ks it ku b kv kw kx ky kz la lb lc lq le lf lg lr li lj lk ls lm ln lo lp im bi translated">它将示例存储为带标签的类。当你需要预测一个新例子的类别时，它会计算这个新例子和所有其他已经被标记和已知的例子之间的距离。k 是最近邻居的数量。此时，通过邻居的多数投票来完成分类。</p><p id="07ee" class="pw-post-body-paragraph kr ks it ku b kv kw kx ky kz la lb lc lq le lf lg lr li lj lk ls lm ln lo lp im bi translated">你可以点击<a class="ae kn" href="https://www.datacamp.com/community/tutorials/k-nearest-neighbor-classification-scikit-learn" rel="noopener ugc nofollow" target="_blank">这个链接</a>获得更多关于 KNN 算法的信息。</p><figure class="jy jz ka kb gt kc gh gi paragraph-image"><div role="button" tabindex="0" class="kd ke di kf bf kg"><div class="gh gi my"><img src="../Images/dd6c3511e11da2ec67b643ba7283b747.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*dkaqpac2kl6zr7xF"/></div></div><figcaption class="kj kk gj gh gi kl km bd b be z dk">Photo by <a class="ae kn" href="https://unsplash.com/@ninastrehl?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Nina Strehl</a> on <a class="ae kn" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="d0f9" class="lv lw it bd lx ly mz ma mb mc na me mf mg nb mi mj mk nc mm mn mo nd mq mr ms bi translated">Tensorflow.js KNN 模块</h1><p id="3a3d" class="pw-post-body-paragraph kr ks it ku b kv mt kx ky kz mu lb lc lq mv lf lg lr mw lj lk ls mx ln lo lp im bi translated">要使用 Tensorflow.js KNN 模块，必须将已知示例添加到分类器中。这是通过<strong class="ku iu"> addExample </strong>方法完成的。在我们的例子中，已知的例子将通过身体姿态图像生成，这些图像是从实时网络摄像头获取的。这将是 KNN 算法的训练阶段。一旦完成，我们将能够用<strong class="ku iu">预测类</strong>方法预测未知的身体姿势。</p><pre class="jy jz ka kb gt ne nf ng nh aw ni bi"><span id="8e40" class="nj lw it nf b gy nk nl l nm nn"><strong class="nf iu"><em class="kt">//importing tensorflow.js KNN module</em></strong><br/>import * as knnClassifier from ‘@tensorflow-models/knn-classifier’;</span><span id="67a2" class="nj lw it nf b gy no nl l nm nn"><strong class="nf iu"><em class="kt">//instantiating the classifier</em></strong><br/>classifier = knnClassifier.<strong class="nf iu">create()</strong></span><span id="bd5d" class="nj lw it nf b gy no nl l nm nn"><strong class="nf iu"><em class="kt">//adding examples to the KNN model for training</em></strong><br/>classifier.<strong class="nf iu">addExample</strong>(example: tf.Tensor,label: number|string): void;</span><span id="85eb" class="nj lw it nf b gy no nl l nm nn"><strong class="nf iu"><em class="kt">//predicting unknown examples with the trained KNN classifier</em></strong><br/>classifier.<strong class="nf iu">predictClass</strong>(input: tf.Tensor,k = 3): Promise&lt;{label: string, classIndex: number, confidences: {[classId: number]: number}}&gt;;</span></pre></div><div class="ab cl jq jr hx js" role="separator"><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv"/></div><div class="im in io ip iq"><p id="62f8" class="pw-post-body-paragraph kr ks it ku b kv kw kx ky kz la lb lc lq le lf lg lr li lj lk ls lm ln lo lp im bi translated">这是足够的理论！</p><p id="c17c" class="pw-post-body-paragraph kr ks it ku b kv kw kx ky kz la lb lc lq le lf lg lr li lj lk ls lm ln lo lp im bi translated">让我们把这个理论付诸实践吧！</p><figure class="jy jz ka kb gt kc gh gi paragraph-image"><div role="button" tabindex="0" class="kd ke di kf bf kg"><div class="gh gi np"><img src="../Images/6501660d5cffca517db4fea16dc7bf68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*CwCOtqsMVFJ6wko0"/></div></div><figcaption class="kj kk gj gh gi kl km bd b be z dk">Photo by <a class="ae kn" href="https://unsplash.com/@jakobowens1?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Jakob Owens</a> on <a class="ae kn" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="a976" class="pw-post-body-paragraph kr ks it ku b kv kw kx ky kz la lb lc lq le lf lg lr li lj lk ls lm ln lo lp im bi translated">此时，我们必须生成我们的 Angular WebApp。下面介绍的所有打字稿代码都必须在<strong class="ku iu"> app.component.ts. </strong>中</p><p id="284e" class="pw-post-body-paragraph kr ks it ku b kv kw kx ky kz la lb lc lq le lf lg lr li lj lk ls lm ln lo lp im bi translated">如果你想了解更多关于如何生成 Angular WebApp，你可以查看我以前的帖子。</p><div class="nq nr gp gr ns nt"><a href="https://medium.com/@erdemisbilen/building-realtime-object-detection-webapp-with-tensorflow-js-and-angular-a4ff5062bdf1" rel="noopener follow" target="_blank"><div class="nu ab fo"><div class="nv ab nw cl cj nx"><h2 class="bd iu gy z fp ny fr fs nz fu fw is bi translated">使用 Tensorflow.js 和 Angular 构建实时对象检测 WebApp</h2><div class="oa l"><h3 class="bd b gy z fp ny fr fs nz fu fw dk translated">张量流。射流研究…</h3></div><div class="ob l"><p class="bd b dl z fp ny fr fs nz fu fw dk translated">medium.com</p></div></div><div class="oc l"><div class="od l oe of og oc oh kh nt"/></div></div></a></div><p id="73cc" class="pw-post-body-paragraph kr ks it ku b kv kw kx ky kz la lb lc lq le lf lg lr li lj lk ls lm ln lo lp im bi translated">让我们首先启动网络摄像头和模型。</p><pre class="jy jz ka kb gt ne nf ng nh aw ni bi"><span id="dfb4" class="nj lw it nf b gy nk nl l nm nn">init_webcam()<br/>{<br/><strong class="nf iu"><em class="kt">// Get the HTMLVideoElement<br/></em></strong>this.video = &lt;HTMLVideoElement&gt; document.getElementById("vid");</span><span id="0bc2" class="nj lw it nf b gy no nl l nm nn"><strong class="nf iu"><em class="kt">// Start webcam stream</em></strong><br/>navigator.mediaDevices.getUserMedia({audio: false, video: {facingMode: "user"}}).then(<em class="kt">stream</em> <em class="kt">=&gt;</em>{<br/>this.video.srcObject = stream;<br/>this.video.onloadedmetadata = () <em class="kt">=&gt;</em> {this.video.play();};});<br/>}</span><span id="5cfa" class="nj lw it nf b gy no nl l nm nn">async init_models()<br/>{<br/><strong class="nf iu"><em class="kt">// Initiate the KNN classifier</em></strong><br/>this.classifier = await knnClassifier.create();<br/><em class="kt">console</em>.log('KNN classifier is loaded')</span><span id="aa67" class="nj lw it nf b gy no nl l nm nn"><strong class="nf iu"><em class="kt">// Load mobilenet model</em></strong><br/><em class="kt">const</em> mobilenet =  await tf.loadLayersModel('https://storage.googleapis.com/tfjs-models/tfjs/mobilenet_v1_0.25_224/model.json');<br/><em class="kt">console</em>.log('Mobilenet model is loaded')</span><span id="3690" class="nj lw it nf b gy no nl l nm nn"><strong class="nf iu"><em class="kt">// Modify the mobilenet model so that we can get the activations from 'conv_preds' layer</em></strong><em class="kt"><br/>const</em> outputLayer=mobilenet.getLayer('conv_preds');<br/>this.mobilenetModified = tf.model({inputs: mobilenet.inputs, outputs: outputLayer.output, name: 'modelModified' });<br/><em class="kt">console</em>.log('MobilenetModified model is generated')<br/>}</span></pre><p id="a45a" class="pw-post-body-paragraph kr ks it ku b kv kw kx ky kz la lb lc lq le lf lg lr li lj lk ls lm ln lo lp im bi translated">下一步是创建一个函数，将示例添加到我们刚刚启动的 KNN 分类器中。这个函数接受定义我们添加的示例类的参数<strong class="ku iu"> className </strong>。</p><pre class="jy jz ka kb gt ne nf ng nh aw ni bi"><span id="b761" class="nj lw it nf b gy nk nl l nm nn">addExample(<em class="kt">className</em>)<br/>{<br/><strong class="nf iu"><em class="kt">// Get the image from the video feed and convert it to tensor<br/></em></strong><em class="kt">let</em> img=tf.browser.fromPixels(&lt;HTMLVideoElement&gt; document.getElementById("vid"));</span><span id="675b" class="nj lw it nf b gy no nl l nm nn"><strong class="nf iu"><em class="kt">// Get the activations from the mobilenet model<br/></em></strong><em class="kt">let</em> logits = &lt;tf.Tensor&gt; this.mobilenetModified.predict(img.expandDims());</span><span id="cc45" class="nj lw it nf b gy no nl l nm nn"><strong class="nf iu"><em class="kt">// Add the activations as an example into the KNN model with a class name assigned<br/></em></strong>this.classifier.addExample(logits, className);</span><span id="fb7f" class="nj lw it nf b gy no nl l nm nn"><strong class="nf iu"><em class="kt">// Show the stored image on the browser<br/></em></strong><em class="kt">let</em> canvas = &lt;HTMLCanvasElement&gt; document.getElementById("canvas");<br/><em class="kt">let</em> ctx = canvas.getContext("2d");<br/>ctx.drawImage(&lt;HTMLVideoElement&gt; document.getElementById("vid"),0,0,224,224)<br/><em class="kt">console</em>.log('KNN example added')<br/>}</span></pre><p id="2ba5" class="pw-post-body-paragraph kr ks it ku b kv kw kx ky kz la lb lc lq le lf lg lr li lj lk ls lm ln lo lp im bi translated">然后我们需要创建一个函数来预测未知的例子。</p><pre class="jy jz ka kb gt ne nf ng nh aw ni bi"><span id="5759" class="nj lw it nf b gy nk nl l nm nn"><strong class="nf iu"><em class="kt">// Calls detectFrame with video, mobilenet and KNN arguments</em></strong><br/>predict()<br/>{<strong class="nf iu"><em class="kt"><br/></em></strong>this.detectFrame(this.video,this.mobilenetModified, this.classifier);<br/>}</span><span id="0df1" class="nj lw it nf b gy no nl l nm nn"><strong class="nf iu"><em class="kt">// Performs real-time predictions continuously by generating the activations of images produced from video feed. Then it predicts the class of the image based on the similarity with stored examples.</em></strong></span><span id="96fc" class="nj lw it nf b gy no nl l nm nn">detectFrame = (<em class="kt">video</em>, <em class="kt">mobileNetModel</em>, <em class="kt">KNNModel</em>) <em class="kt">=&gt;</em> {</span><span id="8eab" class="nj lw it nf b gy no nl l nm nn"><em class="kt">const</em> predictions= &lt;tf.Tensor&gt; mobileNetModel.predict(tf.browser.fromPixels(video).expandDims());</span><span id="148a" class="nj lw it nf b gy no nl l nm nn">KNNModel.predictClass(predictions).then(<em class="kt">result=&gt;</em> {this.renderPredictions(result);</span><span id="f540" class="nj lw it nf b gy no nl l nm nn">requestAnimationFrame(() <em class="kt">=&gt;</em> {<br/>this.detectFrame(video, mobileNetModel, KNNModel);});</span><span id="6031" class="nj lw it nf b gy no nl l nm nn">});<br/>}</span><span id="aa7d" class="nj lw it nf b gy no nl l nm nn"><strong class="nf iu"><em class="kt">//Writes KNNClassifier results to the console</em></strong><br/>renderPredictions = <em class="kt">result</em> <em class="kt">=&gt;</em> {<em class="kt">console</em>.log(result)};</span></pre><p id="b241" class="pw-post-body-paragraph kr ks it ku b kv kw kx ky kz la lb lc lq le lf lg lr li lj lk ls lm ln lo lp im bi translated">最后一步是修改<strong class="ku iu">app.component.html</strong>，将必要的<strong class="ku iu"> </strong> UI 元素放到应用程序中。</p><pre class="jy jz ka kb gt ne nf ng nh aw ni bi"><span id="6755" class="nj lw it nf b gy nk nl l nm nn">&lt;h1&gt;Easy Machine Learning in the Browser: Real-time Image Classification&lt;/h1&gt;</span><span id="4677" class="nj lw it nf b gy no nl l nm nn">&lt;video  id="vid" width="224" height="224"&gt;&lt;/video&gt;<br/>&lt;canvas id="canvas" width="224" height="224"&gt;&lt;/canvas&gt;</span><span id="187d" class="nj lw it nf b gy no nl l nm nn">&lt;button mat-button (click)="addExample('0')"&gt;Add Example Class1&lt;/button&gt;<br/>&lt;button mat-button (click)="addExample('1')"&gt;Add Example Class2&lt;/button&gt;<br/>&lt;button mat-button (click)="addExample('2')"&gt;Add Example Class3&lt;/button&gt;</span><span id="ad2f" class="nj lw it nf b gy no nl l nm nn">&lt;button mat-button (click)="predict()"&gt;Predict&lt;/button&gt;</span></pre></div><div class="ab cl jq jr hx js" role="separator"><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv"/></div><div class="im in io ip iq"><p id="e821" class="pw-post-body-paragraph kr ks it ku b kv kw kx ky kz la lb lc lq le lf lg lr li lj lk ls lm ln lo lp im bi translated">干得好！</p><p id="00a9" class="pw-post-body-paragraph kr ks it ku b kv kw kx ky kz la lb lc lq le lf lg lr li lj lk ls lm ln lo lp im bi translated">您已经做了这么多，并且创建了一个 web 应用程序来对浏览器中的图像进行分类。</p></div></div>    
</body>
</html>