<html>
<head>
<title>Long, Wide Data and How to Efficiently Plot Them</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">长而宽的数据以及如何有效地绘制它们</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/long-wide-data-and-how-to-efficiently-plot-them-7a96887e309d?source=collection_archive---------16-----------------------#2019-12-23">https://towardsdatascience.com/long-wide-data-and-how-to-efficiently-plot-them-7a96887e309d?source=collection_archive---------16-----------------------#2019-12-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="438b" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">与实例的比较</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/9bcaa97741951b60d2606cfafc87ad14.png" data-original-src="https://miro.medium.com/v2/resize:fit:1212/format:webp/1*FK1XbW7l08CddXmsJ-sZ_Q.png"/></div></figure><h1 id="029b" class="kn ko iq bd kp kq kr ks kt ku kv kw kx jw ky jx kz jz la ka lb kc lc kd ld le bi translated">介绍</h1><p id="7d30" class="pw-post-body-paragraph lf lg iq lh b li lj jr lk ll lm ju ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">很多时候，当我们处理数据时，它有不同的格式。如果你从一个网站上删除了这些数据，很可能是以<strong class="lh ir">宽格式</strong>。事实上，我们实际看到的大多数数据都是这种格式，因为宽数据非常直观，也更容易理解。一个很好的例子就是这个来自 ESPN 的<a class="ae mb" href="https://www.espn.com/nba/stats/player/_/table/offensive/sort/avgPoints/dir/desc" rel="noopener ugc nofollow" target="_blank"> NBA 统计页面。</a></p><p id="3769" class="pw-post-body-paragraph lf lg iq lh b li mc jr lk ll md ju ln lo me lq lr ls mf lu lv lw mg ly lz ma ij bi translated">另一方面，<strong class="lh ir">长格式的</strong>数据不太经常看到。然而，它有自己的优势，如:</p><ul class=""><li id="4e72" class="mh mi iq lh b li mc ll md lo mj ls mk lw ml ma mm mn mo mp bi translated">快速处理(使用矢量化运算)</li><li id="e8d9" class="mh mi iq lh b li mq ll mr lo ms ls mt lw mu ma mm mn mo mp bi translated">某些高级统计分析和绘图所要求的</li></ul><p id="c7c0" class="pw-post-body-paragraph lf lg iq lh b li mc jr lk ll md ju ln lo me lq lr ls mf lu lv lw mg ly lz ma ij bi translated">在这本笔记本中，我将展示如何在两种格式之间转换数据，长格式如何更快地处理，以及如何有效地绘制每种格式。我们将使用旧金山和萨克拉门托的月降水量数据作为例子。</p></div><div class="ab cl mv mw hu mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="ij ik il im in"><p id="d5e8" class="pw-post-body-paragraph lf lg iq lh b li mc jr lk ll md ju ln lo me lq lr ls mf lu lv lw mg ly lz ma ij bi translated"><em class="nc">注:天气数据取自</em> <a class="ae mb" href="https://w2.weather.gov/climate/xmacis.php?wfo=mtr" rel="noopener ugc nofollow" target="_blank"> <em class="nc">本网站</em> </a> <em class="nc">。</em></p><h1 id="6506" class="kn ko iq bd kp kq kr ks kt ku kv kw kx jw ky jx kz jz la ka lb kc lc kd ld le bi translated">准备数据集</h1><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="484d" class="pw-post-body-paragraph lf lg iq lh b li mc jr lk ll md ju ln lo me lq lr ls mf lu lv lw mg ly lz ma ij bi translated">以下是我们对数据的观察:</p><ol class=""><li id="153b" class="mh mi iq lh b li mc ll md lo mj ls mk lw ml ma nf mn mo mp bi translated">对于每个城市，数据都是宽格式的。</li><li id="629c" class="mh mi iq lh b li mq ll mr lo ms ls mt lw mu ma nf mn mo mp bi translated">前十一个月的数据以浮点形式存储，但是十二月份和年度总计则不是</li><li id="3625" class="mh mi iq lh b li mq ll mr lo ms ls mt lw mu ma nf mn mo mp bi translated">是因为我们还在今年 12 月…数据还没有</li><li id="41e9" class="mh mi iq lh b li mq ll mr lo ms ls mt lw mu ma nf mn mo mp bi translated">我们需要将它们转换为浮点型，并找到一种方法来填充 2019 年的数据</li><li id="16fc" class="mh mi iq lh b li mq ll mr lo ms ls mt lw mu ma nf mn mo mp bi translated">降水量的单位是英寸(来自网站)</li></ol><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="a4c3" class="pw-post-body-paragraph lf lg iq lh b li mc jr lk ll md ju ln lo me lq lr ls mf lu lv lw mg ly lz ma ij bi translated">我们使用前 19 年的平均值填充了 12 月的降水数据，然后计算 2019 年的年总和。</p><p id="a420" class="pw-post-body-paragraph lf lg iq lh b li mc jr lk ll md ju ln lo me lq lr ls mf lu lv lw mg ly lz ma ij bi translated">现在我们可以开始处理和绘制数据。</p><h1 id="af17" class="kn ko iq bd kp kq kr ks kt ku kv kw kx jw ky jx kz jz la ka lb kc lc kd ld le bi translated">数据处理和转换</h1><p id="8c20" class="pw-post-body-paragraph lf lg iq lh b li lj jr lk ll lm ju ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">接下来，我们将对数据进行一些操作，以显示长数据和宽数据之间的差异。</p><p id="2719" class="pw-post-body-paragraph lf lg iq lh b li mc jr lk ll md ju ln lo me lq lr ls mf lu lv lw mg ly lz ma ij bi translated">首先，让我们将它们转换成长数据，并将两个数据帧连接(或合并)成一个。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="7e18" class="pw-post-body-paragraph lf lg iq lh b li mc jr lk ll md ju ln lo me lq lr ls mf lu lv lw mg ly lz ma ij bi translated">现在假设我们要计算每年的月降雨量百分比。</p><p id="9000" class="pw-post-body-paragraph lf lg iq lh b li mc jr lk ll md ju ln lo me lq lr ls mf lu lv lw mg ly lz ma ij bi translated">我们从广泛的数据开始。由于我们需要对每一列进行操作，我们可以使用<code class="fe ng nh ni nj b">apply</code>函数。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="5029" class="pw-post-body-paragraph lf lg iq lh b li mc jr lk ll md ju ln lo me lq lr ls mf lu lv lw mg ly lz ma ij bi translated">正如我们在上面看到的，对于长数据来说要容易得多。事实上，它也更快，因为它使用向量化操作。</p><h1 id="3e18" class="kn ko iq bd kp kq kr ks kt ku kv kw kx jw ky jx kz jz la ka lb kc lc kd ld le bi translated">使用宽而长的数据绘图</h1><p id="29bd" class="pw-post-body-paragraph lf lg iq lh b li lj jr lk ll lm ju ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">我们想看看近二十年来每个月降水量的变化和分布。一个好的方法是使用方框图。对于每个日历月，我们将绘制成一个方框来显示不同年份的变化。总的来说，在一个单独的地块上将有 12 个盒子。</p><p id="110c" class="pw-post-body-paragraph lf lg iq lh b li mc jr lk ll md ju ln lo me lq lr ls mf lu lv lw mg ly lz ma ij bi translated">让我们先用宽数据把它画在旧金山。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="acfb" class="pw-post-body-paragraph lf lg iq lh b li mc jr lk ll md ju ln lo me lq lr ls mf lu lv lw mg ly lz ma ij bi translated">使用<em class="nc">熊猫</em>中的内置函数制作剧情相当容易。如果我们想并排绘制萨克拉门托的数据呢？对于宽数据来说，这是一项相当复杂的任务。</p><p id="ccce" class="pw-post-body-paragraph lf lg iq lh b li mc jr lk ll md ju ln lo me lq lr ls mf lu lv lw mg ly lz ma ij bi translated">正如您在下面看到的，我们必须分别绘制两个数据帧，指定每个数据帧的宽度和位置(否则它们会重叠)，并将 xticks 放在两个框的中心。有一些调整，使它看起来正确。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="399e" class="pw-post-body-paragraph lf lg iq lh b li mc jr lk ll md ju ln lo me lq lr ls mf lu lv lw mg ly lz ma ij bi translated">现在让我们试着用长格式来达到同样的效果。在这种情况下，我使用了<em class="nc"> Seaborn </em>包。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="ab83" class="pw-post-body-paragraph lf lg iq lh b li mc jr lk ll md ju ln lo me lq lr ls mf lu lv lw mg ly lz ma ij bi translated">使用长数据和<em class="nc"> Seaborn </em>进行并排比较要容易得多。在<code class="fe ng nh ni nj b">R</code>中，<code class="fe ng nh ni nj b">ggplot</code>也使用长格式，下划线语法与<em class="nc"> Seaborn </em>非常相似。</p><h1 id="959d" class="kn ko iq bd kp kq kr ks kt ku kv kw kx jw ky jx kz jz la ka lb kc lc kd ld le bi translated">思想</h1><p id="704b" class="pw-post-body-paragraph lf lg iq lh b li lj jr lk ll lm ju ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">来自<code class="fe ng nh ni nj b">R</code>，在我的大学里广泛使用过<code class="fe ng nh ni nj b">MATLAB</code>，相比 Python 的<code class="fe ng nh ni nj b">matplotlib</code>(类似于 MATLAB)，我更喜欢<code class="fe ng nh ni nj b">ggplot</code>。一个原因是我可以很容易地利用不同的变量来定制情节。在上面的例子中，我使用了<code class="fe ng nh ni nj b">hue</code>(颜色)来显示一个分类变量。我也可以在可视化中包含连续变量，例如:符号的大小等。我真的很高兴找到 Python 中的<em class="nc"> Seaborn </em>包。</p><p id="a35f" class="pw-post-body-paragraph lf lg iq lh b li mc jr lk ll md ju ln lo me lq lr ls mf lu lv lw mg ly lz ma ij bi translated"><em class="nc">你可以在这里找到代码</em><a class="ae mb" href="https://github.com/JunWorks/Long_and_wide" rel="noopener ugc nofollow" target="_blank"><em class="nc">https://github.com/JunWorks/Long_and_wide</em></a></p></div></div>    
</body>
</html>