<html>
<head>
<title>How To Analyze Survey Data With Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用 Python 分析调查数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-analyze-survey-data-with-python-84eff9cc9568?source=collection_archive---------7-----------------------#2019-07-21">https://towardsdatascience.com/how-to-analyze-survey-data-with-python-84eff9cc9568?source=collection_archive---------7-----------------------#2019-07-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="cf7b" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何使用 Python 读取 SPSS/SAV 数据，使用权重并执行典型的 SPSS 命令作为频率和交叉表</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/70abf57c5f029d795079316151743078.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5PLF0lH14NLVgmV6HUqtzg.png"/></div></div></figure><p id="0e2f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果你从事市场调研，你可能还需要处理调查数据。通常这些都是 SAV 或 SPSS 文件。SPSS 对于调查数据的统计分析非常有用，因为变量、变量标签、值和值标签都集成在一个数据集中。使用 SPSS，分类变量易于分析:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lr"><img src="../Images/b05263d54b14581f98f429ce97d7a4c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IiHGtjOKKFjsppGLvnMKqA.png"/></div></div></figure><p id="4c40" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><em class="lq">不幸的是，SPSS 在处理较大的数据集时速度较慢，自动化的宏系统不够直观，与 Python 相比提供的选项很少。因此，我将向您展示如何使用 Python 分析调查数据。</em></p><h2 id="efd3" class="ls lt it bd lu lv lw dn lx ly lz dp ma ld mb mc md lh me mf mg ll mh mi mj mk bi translated">设置</h2><p id="e83b" class="pw-post-body-paragraph ku kv it kw b kx ml ju kz la mm jx lc ld mn lf lg lh mo lj lk ll mp ln lo lp im bi translated">首先，我们安装<code class="fe mq mr ms mt b">pyreadstat</code>模块，它允许我们将 SPSS 文件作为数据帧<code class="fe mq mr ms mt b">pip install pyreadstat</code>导入。如果您想手动安装它，您可以从这里下载软件包:</p><div class="mu mv gp gr mw mx"><a href="https://pypi.org/project/pyreadstat/" rel="noopener  ugc nofollow" target="_blank"><div class="my ab fo"><div class="mz ab na cl cj nb"><h2 class="bd iu gy z fp nc fr fs nd fu fw is bi translated">pyreadstat</h2><div class="ne l"><h3 class="bd b gy z fp nc fr fs nd fu fw dk translated">将 SAS、SPSS 和 Stata 文件读写到 pandas 数据帧中。</h3></div><div class="nf l"><p class="bd b dl z fp nc fr fs nd fu fw dk translated">pypi.org</p></div></div><div class="ng l"><div class="nh l ni nj nk ng nl ks mx"/></div></div></a></div><h2 id="73e6" class="ls lt it bd lu lv lw dn lx ly lz dp ma ld mb mc md lh me mf mg ll mh mi mj mk bi translated">读取数据</h2><p id="7e7a" class="pw-post-body-paragraph ku kv it kw b kx ml ju kz la mm jx lc ld mn lf lg lh mo lj lk ll mp ln lo lp im bi translated">现在，我们将模块导入 Jupyter 笔记本并加载数据集:</p><pre class="kj kk kl km gt nm mt nn no aw np bi"><span id="9d94" class="ls lt it mt b gy nq nr l ns nt">import numpy as np<br/>import pandas as pd<br/>import pyreadstat</span><span id="ed65" class="ls lt it mt b gy nu nr l ns nt">df, meta = pyreadstat.read_sav('...path\\Surveydata.sav')<br/>df.head(5)</span></pre><p id="6754" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">让我们看一下数据框:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/7838234b49c5f3bb2c17b2956e0341c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:712/format:webp/1*mPCrNZFKNi1CDw5U-KHyKg.png"/></div><figcaption class="nw nx gj gh gi ny nz bd b be z dk">Our DataFrame</figcaption></figure><p id="886f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们不能从中读出太多，因为我们不知道变量和数字信息意味着什么。元容器包括所有其他数据，如标签和值标签。用<code class="fe mq mr ms mt b">meta.column_labels</code>我们可以打印变量标签:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/eeb02a6746bf89b2f4780f026d224940.png" data-original-src="https://miro.medium.com/v2/resize:fit:644/format:webp/1*dWSJSmywfhIKZOUIBVVC4Q.png"/></div></figure><p id="24b6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">对于列<code class="fe mq mr ms mt b">Sat_overall</code>,匹配的标签是“您的总体满意度如何？”。通过几个变量，你可以很容易地从列表中分配它。如果我们有数百个变量，整个事情会很混乱。因此，我们首先创建一个字典，以便在必要时可以有选择地显示某一列的正确标签。</p><pre class="kj kk kl km gt nm mt nn no aw np bi"><span id="91cf" class="ls lt it mt b gy nq nr l ns nt">meta_dict = dict(zip(meta.column_names, meta.column_labels))</span></pre><p id="1681" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">有了<code class="fe mq mr ms mt b">meta_dict['Sat_overall']</code>，我们现在得到了匹配的标签。</p><h2 id="ed75" class="ls lt it bd lu lv lw dn lx ly lz dp ma ld mb mc md lh me mf mg ll mh mi mj mk bi translated">未加权数据</h2><p id="c412" class="pw-post-body-paragraph ku kv it kw b kx ml ju kz la mm jx lc ld mn lf lg lh mo lj lk ll mp ln lo lp im bi translated">在调查中，我们通常对选择特定答案类别的受访者的百分比感兴趣:</p><pre class="kj kk kl km gt nm mt nn no aw np bi"><span id="cd12" class="ls lt it mt b gy nq nr l ns nt">df['Age'].value_counts(normalize=True).sort_index()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/0e9edeb80523417598fd4d27205a25c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:390/format:webp/1*N1xnvyL6qBDak1XU8UN4oA.png"/></div></figure><p id="cb5b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">从输出中，我们只能看到 29%的人投票支持类别 1，33%的人支持类别 2，几乎 38%的人支持类别 3。然而，在字典<code class="fe mq mr ms mt b">meta.value_labels</code>中，我们有所有的值标签:</p><pre class="kj kk kl km gt nm mt nn no aw np bi"><span id="c473" class="ls lt it mt b gy nq nr l ns nt">df['Age'].map(meta.variable_value_labels['Age']).value_counts(normalize=True)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/820036b59d7124e42624060ecc52932c.png" data-original-src="https://miro.medium.com/v2/resize:fit:382/format:webp/1*eDsgR-WbZin4NBz73YgT3w.png"/></div></figure><p id="ab11" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这样看起来更好！38%的受访者超过 50 岁，33%在 30 至 50 岁之间，其余的在 30 岁以下。我个人更喜欢按照价值标签的顺序排序。目前，这些值只是按比例大小排序:</p><pre class="kj kk kl km gt nm mt nn no aw np bi"><span id="bb36" class="ls lt it mt b gy nq nr l ns nt">df['Age'].map(meta.variable_value_labels['Age']).value_counts(normalize=True).loc[meta.variable_value_labels['Age'].values()]</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi od"><img src="../Images/575a005461343683b538bb7984fe47f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:394/format:webp/1*vnHfqiTLBKf_LDkQYp9l6Q.png"/></div></figure><p id="f9eb" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">完美！这就是我们所需要的，结果与 SPSS“频率”的输出非常匹配。通常，调查数据是根据社会人口特征进行评估的。例如，满意度如何因年龄组而异？为此，我们可以简单地使用交叉表函数:</p><pre class="kj kk kl km gt nm mt nn no aw np bi"><span id="10fe" class="ls lt it mt b gy nq nr l ns nt">pd.crosstab(df['Sat_overall'], df['Age'], dropna=True, normalize='columns')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/7bfadda365597f3f36705138a10c9abd.png" data-original-src="https://miro.medium.com/v2/resize:fit:490/format:webp/1*spoLHejlUFJpX1OPFTgUQg.png"/></div></figure><p id="f5e6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">同样，我们不能对输出做太多，所以让我们首先映射值标签:</p><pre class="kj kk kl km gt nm mt nn no aw np bi"><span id="0cc6" class="ls lt it mt b gy nq nr l ns nt">pd.crosstab(df['Sat_overall'].\<br/>        map(meta.variable_value_labels['Sat_overall']), \<br/>        df['Age'].map(meta.variable_value_labels['Age']), \<br/>        dropna=True, normalize='columns'). \<br/>        loc[meta.variable_value_labels['Sat_overall'].values()]. \<br/>        loc[:,meta.variable_value_labels['Age'].values()]*100</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi of"><img src="../Images/4eacf339a0ecfba9232a3dc09122598e.png" data-original-src="https://miro.medium.com/v2/resize:fit:634/format:webp/1*FfLKMS9tcwmR6ZThNJcYdQ.png"/></div></figure><p id="21dd" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在，我们能够解释输出。对于 50 岁以上的人，有最完全满意的顾客。相比之下，30 岁以下的顾客最不满意。使用<code class="fe mq mr ms mt b">.loc</code>功能，我们可以再次在此指定顺序。</p><h2 id="f7fb" class="ls lt it bd lu lv lw dn lx ly lz dp ma ld mb mc md lh me mf mg ll mh mi mj mk bi translated">加权数据</h2><p id="e3ce" class="pw-post-body-paragraph ku kv it kw b kx ml ju kz la mm jx lc ld mn lf lg lh mo lj lk ll mp ln lo lp im bi translated">在调查中，事后通常会发现社会人口特征的分布与客户群的分布并不一致。一开始我们看到三个组几乎是平均分布的。然而，我们知道 50%的顾客年龄在 30 岁以下，25%在 30 到 50 岁之间，其余的在 50 岁以上。因此，我们对数据进行加权以反映这种分布:</p><pre class="kj kk kl km gt nm mt nn no aw np bi"><span id="ab80" class="ls lt it mt b gy nq nr l ns nt">weight = np.NaN<br/>df.loc[(df['Age'] == 1), 'weight'] = 0.5/(67/230)<br/>df.loc[(df['Age'] == 2), 'weight'] = 0.25/(76/230)<br/>df.loc[(df['Age'] == 3), 'weight'] = 0.25/(87/230)</span></pre><p id="0809" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">但是我们现在如何在计算中考虑这个重量呢？对于频率分布，我们编写一个小的辅助函数:</p><pre class="kj kk kl km gt nm mt nn no aw np bi"><span id="4d55" class="ls lt it mt b gy nq nr l ns nt">def weighted_frequency(x,y):<br/>    a = pd.Series(df[[x,y]].groupby(x).sum()[y])/df[y].sum()<br/>    b = a.index.map(meta.variable_value_labels[x])<br/>    c = a.values<br/>    df_temp = pd.DataFrame({'Labels': b, 'Frequency': c})<br/>    return df_temp</span></pre><p id="067e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">因此，我们得到一个数据帧，其中包含相应的标签(按照从小到大的数字顺序)和相应的百分比频率:</p><pre class="kj kk kl km gt nm mt nn no aw np bi"><span id="f4ad" class="ls lt it mt b gy nq nr l ns nt">weighted_frequency('Age','weight')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/8a432d818c857bbce80f12d0d242be12.png" data-original-src="https://miro.medium.com/v2/resize:fit:282/format:webp/1*7Gf7KP7f2b5ro5Jb7aUl0w.png"/></div></div></figure><p id="072d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">加权分布现在符合我们的客户结构。让我们再来看看满意度分布:</p><pre class="kj kk kl km gt nm mt nn no aw np bi"><span id="c507" class="ls lt it mt b gy nq nr l ns nt">weighted_frequency('Sat_overall','weight')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/8f9db2e2612480f5c3c649c0753f33b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nrhzuPVyGTXdyjxXWPv8HA.png"/></div></div></figure><p id="d138" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">例如，我们看到在加权分布中，更多的客户不满意。如果我们没有加权，我们会低估我们客户群中的奇怪之处。通过交叉表，可以轻松整合权重:</p><pre class="kj kk kl km gt nm mt nn no aw np bi"><span id="404f" class="ls lt it mt b gy nq nr l ns nt">pd.crosstab(df['Sat_overall']. \<br/>        map(meta.variable_value_labels['Sat_overall']), \<br/>        df['Age'].map(meta.variable_value_labels['Age']), <br/>        df.weight, aggfunc = sum, dropna=True, \<br/>        normalize='columns'). \<br/>        loc[meta.variable_value_labels['Sat_overall'].values()]. \<br/>        loc[:,meta.variable_value_labels['Age'].values()]*100</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/a797d8e2f324ec9efd17b2f977061324.png" data-original-src="https://miro.medium.com/v2/resize:fit:614/format:webp/1*C9vLWMeGShuNtVOiMdxSoA.png"/></div></figure><p id="8483" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我们所要做的就是添加权重参数(例如<code class="fe mq mr ms mt b">df.weight</code>)和函数参数<code class="fe mq mr ms mt b">aggfunc=sum</code>。在本例中，加权分布对应于未加权分布，因为组内病例的比率没有变化。</p><h2 id="473f" class="ls lt it bd lu lv lw dn lx ly lz dp ma ld mb mc md lh me mf mg ll mh mi mj mk bi translated">结论</h2><p id="40b9" class="pw-post-body-paragraph ku kv it kw b kx ml ju kz la mm jx lc ld mn lf lg lh mo lj lk ll mp ln lo lp im bi translated">第一步，我们安装了<code class="fe mq mr ms mt b">pyreadstat</code>，一个我们可以将 sav 文件读入 Python 并进一步处理它们的模块。之后，我们看了标签和价值标签是如何分配的，以及分析是如何以一种易于理解的方式呈现的。我们看到 Python 很好地处理了分类数据，并且易于使用。</p><h2 id="bd1e" class="ls lt it bd lu lv lw dn lx ly lz dp ma ld mb mc md lh me mf mg ll mh mi mj mk bi translated">开源代码库</h2><p id="1f72" class="pw-post-body-paragraph ku kv it kw b kx ml ju kz la mm jx lc ld mn lf lg lh mo lj lk ll mp ln lo lp im bi translated">资料馆:<br/><a class="ae oj" href="https://github.com/bd317/surveydata_with_python" rel="noopener ugc nofollow" target="_blank">https://github.com/bd317/surveydata_with_python</a><br/>笔记本:<br/><a class="ae oj" href="https://github.com/bd317/surveydata_with_python/blob/master/Github_Survey_Data_Upload.ipynb" rel="noopener ugc nofollow" target="_blank">https://Github . com/BD 317/Survey Data _ with _ python/blob/master/Github _ Survey _ Data _ upload . ipynb</a><br/>SPSS-Dataset:<br/><a class="ae oj" href="https://github.com/bd317/surveydata_with_python/blob/master/Surveydata.sav" rel="noopener ugc nofollow" target="_blank">https://Github . com/BD 317/Survey Data _ with _ python/blob/master/Survey Data . sav</a></p></div><div class="ab cl ok ol hx om" role="separator"><span class="on bw bk oo op oq"/><span class="on bw bk oo op oq"/><span class="on bw bk oo op"/></div><div class="im in io ip iq"><p id="c26d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><a class="ae oj" href="https://medium.com/@droste.benedikt/membership" rel="noopener">如果您喜欢中级和高级数据科学，并且还没有注册，请随时使用我的推荐链接加入社区。</a></p></div></div>    
</body>
</html>