<html>
<head>
<title>Data Analysis for Cyber Security 101: Detecting Data Exfiltration</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">网络安全 101 数据分析:检测数据泄露</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/data-analysis-for-cybersecurity-101-detecting-data-exfiltration-ae887594f675?source=collection_archive---------6-----------------------#2019-10-08">https://towardsdatascience.com/data-analysis-for-cybersecurity-101-detecting-data-exfiltration-ae887594f675?source=collection_archive---------6-----------------------#2019-10-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/126df56a6457cd47b5651a0706c26fed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DouxCQQ0sdizukTNiQQxsA.jpeg"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk"><a class="ae jd" href="https://www.pexels.com/@padrinan?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">Miguel Á. Padriñán </a>from <a class="ae jd" href="https://www.pexels.com/photo/paper-boats-on-solid-surface-194094/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">Pexels</a>,</figcaption></figure><div class=""/><div class=""><h2 id="fa99" class="pw-subtitle-paragraph kd jf jg bd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dk translated">使用网络流量数据创建基本警报来检测数据盗窃</h2></div><p id="22e1" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这既是最近<a class="ae jd" href="https://ctf.trendmicro.com" rel="noopener ugc nofollow" target="_blank"> 2019 趋势科技 CTF </a>中通配符 400 挑战解决方案的演练，也是网络安全监控的一些注意事项。我建议你先试试这里的挑战<a class="ae jd" href="https://www.kaggle.com/hawkcurry/data-analysis-for-network-security-101-questions" rel="noopener ugc nofollow" target="_blank"/>。所有解决方案的实现都可以在<a class="ae jd" href="https://www.kaggle.com/hawkcurry/data-analysis-for-network-security-101-solution" rel="noopener ugc nofollow" target="_blank">这个内核</a>中找到。</p><h1 id="ca0e" class="lr ls jg bd lt lu lv lw lx ly lz ma mb km mc kn md kp me kq mf ks mg kt mh mi bi translated">前提</h1><blockquote class="mj mk ml"><p id="7204" class="kv kw mm kx b ky kz kh la lb lc kk ld mn lf lg lh mo lj lk ll mp ln lo lp lq ij bi translated">您是中型企业 XYZcorp 的网络安全管理员。你经常使用网络流量数据来发现异常的安全事件。该挑战提供了一些关于流的样本聚合数据，并使用异常事件的答案来构建标记。</p></blockquote><p id="a66d" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这里的数据是合成的，不模拟典型的网络协议和行为。因此，这些挑战不需要深入了解网络协议。</p><h1 id="48b2" class="lr ls jg bd lt lu lv lw lx ly lz ma mb km mc kn md kp me kq mf ks mg kt mh mi bi translated">我们要找什么？</h1><p id="3389" class="pw-post-body-paragraph kv kw jg kx b ky mq kh la lb mr kk ld le ms lg lh li mt lk ll lm mu lo lp lq ij bi translated">本次挑战中的所有问题都与<strong class="kx jh">后利用活动</strong>有关，这些<strong class="kx jh"> </strong>构成了<a class="ae jd" href="https://www.lockheedmartin.com/en-us/capabilities/cyber/cyber-kill-chain.html" rel="noopener ugc nofollow" target="_blank">网络杀戮链</a>的后半部分。</p><p id="23ed" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><em class="mm"> &lt;插入强制杀伤链图和说明&gt; </em></p><p id="39ee" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">网络安全的现代方法并不仅仅停留在试图防止利用。利用漏洞只是攻击的第一步，最终目标通常是*数据窃取。</p><p id="f1b5" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><em class="mm">*勒索软件攻击等攻击除外</em></p><h2 id="0a26" class="mv ls jg bd lt mw mx dn lx my mz dp mb le na nb md li nc nd mf lm ne nf mh ng bi translated">攻击者如何从最初的立足点获取您的数据？</h2><ol class=""><li id="bb20" class="nh ni jg kx b ky mq lb mr le nj li nk lm nl lq nm nn no np bi translated">为了获取数据，<strong class="kx jh">攻击者需要破解数据</strong></li><li id="3653" class="nh ni jg kx b ky nq lb nr le ns li nt lm nu lq nm nn no np bi translated">为了泄露数据，<strong class="kx jh">攻击者需要到达数据</strong> ( <em class="mm">横向移动</em>)</li><li id="b33d" class="nh ni jg kx b ky nq lb nr le ns li nt lm nu lq nm nn no np bi translated">为了横向移动，<strong class="kx jh">攻击者需要与他们的立足点</strong> ( <em class="mm">命令和控制)</em>相协调</li></ol><figure class="nw nx ny nz gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nv"><img src="../Images/0126c93d9b25faed42cad3a8a6934871.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0wxC57JISeSG-smadvc1eQ.png"/></div></div></figure><p id="a3bc" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果我们能够在这些阶段中的任何一个阶段检测并阻止攻击者，那么我们可以认为这是一次胜利！</p><blockquote class="oa"><p id="c185" class="ob oc jg bd od oe of og oh oi oj lq dk translated">“预防是理想的，但检测是必须的”——埃里克·科尔博士</p></blockquote><p id="4288" class="pw-post-body-paragraph kv kw jg kx b ky ok kh la lb ol kk ld le om lg lh li on lk ll lm oo lo lp lq ij bi translated">当然，这是一系列更复杂事件的简化版本。如果你想在这方面了解更多，你可以浏览一下<a class="ae jd" href="https://attack.mitre.org/resources/enterprise-introduction/" rel="noopener ugc nofollow" target="_blank"> ATT &amp; CK 矩阵</a></p></div><div class="ab cl op oq hu or" role="separator"><span class="os bw bk ot ou ov"/><span class="os bw bk ot ou ov"/><span class="os bw bk ot ou"/></div><div class="ij ik il im in"><h1 id="2c07" class="lr ls jg bd lt lu ow lw lx ly ox ma mb km oy kn md kp oz kq mf ks pa kt mh mi bi translated">数据泄漏</h1><figure class="nw nx ny nz gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi pb"><img src="../Images/317e820ab685256e67ba5fcc7966436b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KwJoT3xeldD5QbWmQVnvvg.jpeg"/></div></div></figure><p id="8940" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">数据泄露是数据盗窃的一种奇特说法<em class="mm">。</em> <strong class="kx jh">在某一点上，数据必须从您的网络内部流向攻击者手中*。</strong></p><p id="bc64" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><em class="mm">*当然也有例外，比如数据的物理泄露</em></p><h2 id="e5a5" class="mv ls jg bd lt mw mx dn lx my mz dp mb le na nb md li nc nd mf lm ne nf mh ng bi translated">公然渗透</h2><blockquote class="mj mk ml"><p id="7950" class="kv kw mm kx b ky kz kh la lb lc kk ld mn lf lg lh mo lj lk ll mp ln lo lp lq ij bi translated">我们的知识产权正大量离开这栋大楼。里面的一台机器被用来发送我们所有的小工具设计。一台主机从企业中发出的数据比其他主机多得多。它的 IP 是什么？</p></blockquote><p id="a57b" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这里我们可以假设攻击者没有试图隐藏。他们试图传输尽可能多的数据，而不对数据传输设置限制。让我们看看出站网络流量最大的主机。</p><figure class="nw nx ny nz gt is gh gi paragraph-image"><div class="gh gi pc"><img src="../Images/8b5d72a0b6f9e0a96ecfd6ff83dfb608.png" data-original-src="https://miro.medium.com/v2/resize:fit:880/format:webp/1*4C92uWRxEqqsQm6SfSXTLg.png"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">13.37.84.125 looks like a bad IP</figcaption></figure><p id="bd73" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们将<code class="fe pd pe pf pg b">13.37.84.125</code>识别为不良 IP，并观察流量出站的分布，发现这是非典型的。</p><figure class="nw nx ny nz gt is gh gi paragraph-image"><div class="gh gi ph"><img src="../Images/b101cb7c45cf0a89864314e5651c18a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:784/format:webp/1*x_0uhCZbMQDBPI3xXpXG5Q.png"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">13.37.84.125 is clearly an outlier</figcaption></figure><p id="345a" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这是你能发出的最简单的警告。查看您的出站流量的每日分布，并找到一个阈值进行警告。攻击者在一个小时内将 50GB 数据上传到 Google Drive，三天后才发现数据泄露，这将是一件令人尴尬的事情。</p><p id="62b8" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">您可能会发现正常的异常值！<strong class="kx jh">成为局外人不一定等同于恶意</strong>。您可以找到与网络其余部分相比出站流量非常大的主机，但却发现它们是正常的。</p><p id="dd49" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">假设您的公司使用一个<em class="mm"> web 代理服务器，</em>并要求 HTTPS 流量通过该服务器进行代理。那么我们会期望这个<em class="mm">代理服务器</em>的流量比网络的其余部分大几个数量级。我们从中观察到的流量是数百个用户的 HTTPS 流量的总和。</p><p id="ab9b" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx jh">在这种情况下，您应该记录这些特殊的服务器，并分别进行分析。</strong>同时，您可能还想检查那些产生或试图产生直接出站 HTTPS 流量的台式机，即使它们不消耗高带宽，因为它们应该通过代理。</p><h2 id="1c17" class="mv ls jg bd lt mw mx dn lx my mz dp mb le na nb md li nc nd mf lm ne nf mh ng bi translated">业余活动</h2><blockquote class="mj mk ml"><p id="aa92" class="kv kw mm kx b ky kz kh la lb lc kk ld mn lf lg lh mo lj lk ll mp ln lo lp lq ij bi translated"><em class="jg">另一个攻击者计划导出我们内部 wiki 的内容。一台主机在非工作时间从企业发送的数据比其他主机多得多。它的 IP 是什么？</em></p></blockquote><p id="2943" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">通常，我们应该对工作时间和下班时间有一些概念。对于这个挑战，我们首先必须推断出营业时间</p><figure class="nw nx ny nz gt is gh gi paragraph-image"><div class="gh gi pi"><img src="../Images/c1d7408913554b1f8781bd3468fea98b.png" data-original-src="https://miro.medium.com/v2/resize:fit:778/format:webp/1*3MBqNVcG_R2j0RyRt07RLg.png"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Office hours are between 16:00 to 23:00</figcaption></figure><p id="07b7" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在我们已经确定了公司的营业时间，我们只过滤 0:00 到 16:00 之间产生的流量，并查看在非营业时间具有最多出站流量的主机。</p><figure class="nw nx ny nz gt is gh gi paragraph-image"><div class="gh gi pc"><img src="../Images/e17278b51c1755b7605b9039c8fa38f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:880/format:webp/1*QbRzhNKgLwvGPzxvPXZihg.png"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">12.55.77.96 looks suspicious</figcaption></figure><p id="d4b2" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这一次，我们看到<code class="fe pd pe pf pg b">12.55.77.96</code>可能是我们的坏 IP。我们查看了非工作时间总出站流量的分布，我们也看到这是一个异常值。</p><figure class="nw nx ny nz gt is gh gi paragraph-image"><div class="gh gi ph"><img src="../Images/7b76bf9ff5d3771670dd212aa927575b.png" data-original-src="https://miro.medium.com/v2/resize:fit:784/format:webp/1*5H5sRLV0G8K9CDqOqVbq8w.png"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">12.55.77.96 is an outlier</figcaption></figure><p id="78dc" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">只查看非工作时间的流量很重要，因为如果只查看整体出站流量，我们可能检测不到这一点。</p><figure class="nw nx ny nz gt is gh gi paragraph-image"><div class="gh gi ph"><img src="../Images/c3c7d174d7acc454ce9e5d4b01a50bcf.png" data-original-src="https://miro.medium.com/v2/resize:fit:784/format:webp/1*zFvyGT6VR3wZ2HS-Pli5Ng.png"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">12.55.77.96 looks normal if we include traffic from “on” hours</figcaption></figure><p id="1ab0" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">很明显，我们应该分别模拟“开”和“关”的时间。这很直观，你期望在白天看到的活动类型和晚上看到的不同。这包括周末和特殊假期。</p><p id="33b9" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这些间歇期也是你基线的良好起点。你对你的网络的“背景辐射”有一个概念。</p><p id="5686" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">通常在营业时间出现的糟糕交通状况，可能会在非营业时间凸显出来。</p><p id="160a" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">你可能还会发现内部威胁。“<em class="mm">在休假、生病或在非正常时间远程访问网络</em>”、“<em class="mm">在非正常时间工作</em>”是内部威胁的行为指标[1]。人们对身体监视更加敏感；他们更有可能在没有人的时候尝试做坏事，而没有意识到他们的行为在网络层面是显而易见的。</p><blockquote class="oa"><p id="6b2d" class="ob oc jg bd od oe of og oh oi oj lq dk translated">休息时间是有价值的。如果我想识别呼叫总部、文件泄露和其他可疑活动，我喜欢在下班后观察。车流量少了，人也少了……这就是我喜欢记录一家公司自己的特殊下班时间的原因。对于某人来说，通过将所有活动保持在 9-5/M-F 来隐藏他的流量是很容易的，但是如果攻击者不知道公司给圣斯威辛放假，那么他就更有可能坚持到底。</p><p id="2cf3" class="ob oc jg bd od oe of og oh oi oj lq dk translated">迈克尔·柯林斯[2]</p></blockquote><p id="54db" class="pw-post-body-paragraph kv kw jg kx b ky ok kh la lb ol kk ld le om lg lh li on lk ll lm oo lo lp lq ij bi translated">尽管如此，如果你去打猎，你会发现这里有许多合法的(可能没有记录的)业务流程，比如那些试图在晚上卸载以在白天对业务产生最小影响的流程。例如，您可能会发现数据库团队已经安排了每周午夜 12 点将您的数据库备份到您的亚马逊 S3 存储桶。这些绝对是你应该能够察觉的事情。</p><h2 id="5327" class="mv ls jg bd lt mw mx dn lx my mz dp mb le na nb md li nc nd mf lm ne nf mh ng bi translated">使用通用协议的隧道</h2><blockquote class="mj mk ml"><p id="9afe" class="kv kw mm kx b ky kz kh la lb lc kk ld mn lf lg lh mo lj lk ll mp ln lo lp lq ij bi translated">一些攻击者正在获取所有员工和供应商的电子邮件地址，并通过通常用于其他用途的通道发送出去。这类似于攻击者滥用 DNS 进行数据泄露。一台主机在企业的某个端口上发送的数据比其他主机多得多。它的港口是哪里？</p></blockquote><p id="5931" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">DNS 隧道是一种用于通过 DNS 协议的功能来渗透数据的技术。如果一台主机试图通过 DNS 过滤数据，那么我们预计发送到端口 53 的请求数量会比其他只使用 DNS 解析域 IP 地址的主机多得多。因此，我们要寻找的是该特定端口的异常流量。</p><p id="5e29" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">实际上，我们可以使用与前面部分类似的方法，查看流量的主要来源，并根据端口的单变量分布查看它们是否是异常值。然而，当您现在必须查看许多端口时，这种方法的扩展性不好。</p><p id="80c7" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">让我们首先看几个端口，我们看到它们中的大多数是“好的”(也许太好了)，但是有不同的均值和方差。</p><figure class="nw nx ny nz gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi pj"><img src="../Images/c66b31b9f0a16536869ee517d917a8d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2Qn383zG5sV75cMmRfU1RA.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Note that these are from synthetic data</figcaption></figure><p id="90ea" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在查看了一些分布后，它们看起来是钟形的，因此使用 Z 分数可能是合适的。然而，如果你发现分布是高度倾斜的，那么你可能想做一些变换，比如<em class="mm">对数变换</em>，使分布更像<em class="mm">钟形。</em></p><p id="af0b" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">对于每个端口，我们对出站流量进行标准化，并获得每个端口的最高 z 值。</p><figure class="nw nx ny nz gt is gh gi paragraph-image"><div class="gh gi pk"><img src="../Images/597840598efb4b4bc259c5c23362a7b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:790/format:webp/1*wEVE-_bd4zVngJtQAQsUwQ.png"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Clearly port 124 has the “most outlying outlier”</figcaption></figure><p id="8e59" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">并且调查 124 端口的分布，我们看到<code class="fe pd pe pf pg b">12.30.96.87</code>看起来像是我们的不良 IP。</p><figure class="nw nx ny nz gt is gh gi paragraph-image"><div class="gh gi ph"><img src="../Images/a2e6b99cb38ceb62f82582981c30629e.png" data-original-src="https://miro.medium.com/v2/resize:fit:784/format:webp/1*JeWHC4vkTVTOyEriYe5OLw.png"/></div></figure><p id="59bb" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果我们将端口 124 的总出站流量与其他端口进行比较，我们会发现，如果我们使用全局阈值，这是无法检测到的。</p><figure class="nw nx ny nz gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi pl"><img src="../Images/e725d8ac1eebf71686860788ee0f1f41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LIbmLt6lSoswQyJfVJjJvQ.jpeg"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">If looking at the long tail, then maybe</figcaption></figure><p id="c913" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">那么我们如何检测到这一点呢？与上一节相似，有一个重复出现的主题:分别对不同类型的网络活动建模。如果您可以在网络流量中识别出不同的组，那么尝试分别分析它们。如果数据是同分布的，则更容易检测出异常值。</p><p id="8fb0" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">还有，<strong class="kx jh">也要考虑分析长尾。</strong>如果您看到不常用端口的出站流量，那么您应该调查它是什么。如果合法使用，请记录下来。否则，<strong class="kx jh">你一开始就不应该允许未知端口的出站连接</strong>。</p><p id="3529" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">然而，对于诸如 DNS 流量之类的协议，它们是必不可少的。所以你会发现这些端口是对外开放的。类似于<em class="mm"> web 代理，为了让我们的生活更轻松，<em class="mm"> </em>您应该要求所有 DNS 查询都通过内部 DNS 服务器，并阻止端口 53 上除内部 DNS 服务器之外的所有出站流量。通过来自 DNS 服务器的日志，您可以获得丰富的信息，使 DNS 隧道等检测技术变得更加容易。您不必将警报限制在频率和连接大小上，因为您可以使用唯一子域的数量或查询的唯一域的数量。</em></p><p id="5dc8" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果你想了解更多关于 DNS 隧道的信息，你可以阅读 Akamai 的博客。另一种类似且有趣的隧道方式是通过<a class="ae jd" href="http://www.cs.uit.no/~daniels/PingTunnel/" rel="noopener ugc nofollow" target="_blank"> ICMP </a>。</p><h1 id="4fad" class="lr ls jg bd lt lu lv lw lx ly lz ma mb km mc kn md kp me kq mf ks mg kt mh mi bi translated">保护您的数据</h1><figure class="nw nx ny nz gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi pb"><img src="../Images/4d09920719c03e259f21674836cdb5f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YspHzqFnUyIlp98x8rbuXg.jpeg"/></div></div></figure><p id="5df3" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">想到<strong class="kx jh">当您在出站网络流量中检测到数据泄漏时，可能已经太晚了，这有点可笑！</strong>为了检测高出站流量，攻击者必须先窃取大量数据。</p><p id="91f1" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">为了减轻这种情况，您必须考虑您真正关心的数据:</p><ul class=""><li id="3298" class="nh ni jg kx b ky kz lb lc le pm li pn lm po lq pp nn no np bi translated">数据在哪里？</li><li id="7cc5" class="nh ni jg kx b ky nq lb nr le ns li nt lm nu lq pp nn no np bi translated">谁可以访问它？</li><li id="42dc" class="nh ni jg kx b ky nq lb nr le ns li nt lm nu lq pp nn no np bi translated">他们如何访问它？</li></ul><p id="c93c" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">假设一个攻击者想要从您的 SQL 数据库中窃取 50GB 的数据。他首先必须将您的 SQL server 的表转储到他的主机，然后将这些表上传到一些外部云存储中。</p><p id="e14c" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果您能够在以下任一方面发出警报，您甚至可以在攻击者泄漏数据之前就检测到他:</p><ul class=""><li id="6513" class="nh ni jg kx b ky kz lb lc le pm li pn lm po lq pp nn no np bi translated">未经授权的 SQL 数据库转储</li><li id="a2b5" class="nh ni jg kx b ky nq lb nr le ns li nt lm nu lq pp nn no np bi translated">从 SQL server 传输的异常高的流量</li></ul><p id="bd13" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">例如，您查看您的 SQL server 通常会做些什么，并发现 SQL server 的大部分流量通常会与 web 应用程序服务器、一些 ETL 进程以及一些备份进程相关联。那么从 SQL server 到 SQL admin 工作站的高数据传输可能被认为是异常的。</p><p id="933b" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">通过一点分析，您可以集中精力于网络中的几个组件，而不是监控网络中的所有流量来寻找“任何奇怪的东西”。</p><p id="5153" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">将您的一些警报范围缩小到一些关键用户或系统，可以使您的模型更加高效，并且您能够检测到更微妙的高影响攻击。</p><h1 id="a31f" class="lr ls jg bd lt lu lv lw lx ly lz ma mb km mc kn md kp me kq mf ks mg kt mh mi bi translated">下一个:横向运动</h1><figure class="nw nx ny nz gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi pb"><img src="../Images/c247924631ed6423579bf5cce6a9c1cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eoWBUOxWe2n0L3aVj-j6YQ.jpeg"/></div></div></figure><p id="10e9" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在下一篇博文中，我们将讨论一些关于寻找<a class="ae jd" rel="noopener" target="_blank" href="/data-analysis-for-cyber-security-101-detecting-lateral-movement-2026216de439"> <strong class="kx jh">横向运动的问题。</strong>T3】</a></p><p id="07ab" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">攻击者控制的初始主机可能无法访问攻击者想要的数据。然后，攻击者必须在网络中探索和导航，通过不同的主机和帐户，直到他达到最终目标。如果有合适的有利位置，这可能是我们可以探测到的</p></div><div class="ab cl op oq hu or" role="separator"><span class="os bw bk ot ou ov"/><span class="os bw bk ot ou ov"/><span class="os bw bk ot ou"/></div><div class="ij ik il im in"><h1 id="47bd" class="lr ls jg bd lt lu ow lw lx ly ox ma mb km oy kn md kp oz kq mf ks pa kt mh mi bi translated">参考</h1><p id="85b3" class="pw-post-body-paragraph kv kw jg kx b ky mq kh la lb mr kk ld le ms lg lh li mt lk ll lm mu lo lp lq ij bi translated">[1] US-CERT，<a class="ae jd" href="https://www.us-cert.gov/sites/default/files/publications/Combating%20the%20Insider%20Threat_0.pdf" rel="noopener ugc nofollow" target="_blank">对抗内部威胁</a> (2014)</p><p id="636d" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">[2] M. Collins，通过数据分析实现网络安全(2014 年)</p><p id="eb01" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">[3] <a class="ae jd" href="https://www.sans.org/course/continuous-monitoring-security-operations" rel="noopener ugc nofollow" target="_blank"> SEC511:持续监控和安全操作</a></p><p id="c4dd" class="pw-post-body-paragraph kv kw jg kx b ky kz kh la lb lc kk ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx jh">照片</strong> : <a class="ae jd" href="https://www.pexels.com/@joshsorenson?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">乔希·索伦森</a>来自<a class="ae jd" href="https://www.pexels.com/photo/boat-deep-ocean-idyllic-leisure-570987/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">派克斯</a>，<a class="ae jd" href="https://www.pexels.com/@skitterphoto?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">迅猎兽照片</a>来自<a class="ae jd" href="https://www.pexels.com/photo/sea-clouds-boat-ship-16513/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">派克斯</a></p></div></div>    
</body>
</html>