# 实践中的推荐系统

> 原文：<https://towardsdatascience.com/recommender-systems-in-practice-cef9033bb23a?source=collection_archive---------1----------------------->

## 公司如何推荐产品

![](img/419025785e95a5f3759b3186f561c140.png)

by @rocinante_11

亚马逊、网飞、Linkedin 和 Pandora 等公司利用推荐系统帮助用户发现新的相关项目(产品、视频、工作、音乐)，创造令人愉快的用户体验，同时推动收入增长。

在这里，我们提供了一个实用的推荐系统概述。首先，回顾了三个主要的系统:基于内容的、协同过滤的和混合的，随后讨论了冷启动、可扩展性、可解释性和开发/探索。

## 基于内容的推荐

在潘多拉，一个音乐团队给每首音乐贴上了 400 多种属性的标签。然后当用户选择一个音乐电台时，匹配该电台属性的歌曲将被添加到播放列表中(音乐基因组计划|Pandora，Howe|Pandora)。

这是基于内容的推荐。用户或项目具有描述其特征的简档，并且如果两个简档匹配，系统将向用户推荐项目。Stitch Fix 的时尚盒子是另一个基于内容推荐的例子。收集用户的属性(身高、体重等。)和搭配的时尚产品放在一个盒子里交付给用户(Stitch Fix|2013)。

对于潘多拉来说，创造音乐属性需要人工的努力/成本，但也有很多情况下没有这样的需求。Stitch Fix 的客户提供他们自己的偏好，Linkedin 用户提供他们自己的工作经验和技能，亚马逊上的商家提供他们的产品信息，所有这些都可以免费用于基于内容的推荐。

匹配用户和项目的一种简单方法是关键字匹配。例如，对于工作推荐，可以将工作描述与求职者的简历进行匹配。术语频率-逆文档频率通常用于为对项目或用户唯一的关键字赋予更大的权重。

一种更系统的方法是建立一个监督模型，估计用户喜欢看不见的物品的倾向。在该模型中，特征是来自用户和项目的属性(例如，工作和求职者是否在同一行业的指示变量)，响应变量是用户是否喜欢该项目(例如，求职者是否会申请该工作)。

基于内容的方法计算速度快且可解释。它们可以很容易地适应新的项目或新的用户。然而，项目/用户的一些特征可能不容易捕捉或明确描述。Stitch Fix 通过让机器学习处理结构化数据，让人类处理非结构化数据(例如，用户的 Pinterest board)来解决这一问题。

## 协同过滤

协同过滤系统基于历史用户对项目的偏好(点击、观看、购买、喜欢、评级等)来做出推荐。).偏好可以被呈现为用户项目矩阵。下面是一个描述 4 个用户对 5 个项目的偏好的矩阵示例，其中 p_{12}是用户 1 对项目 2 的偏好。

![](img/b34771a0baa8e220f2e37f1e42cc0a14.png)

虽然条目可以是数字的，例如网飞的电影分级预测挑战(分级范围从 1 到 5)，但是在大多数应用中，它们是二进制的(例如，点击、观看、购买)。

在现实中，用户-项目矩阵可能超过数百万*数百万(例如，亚马逊、Youtube)，并且大多数条目是缺失的——推荐系统的目标是填充那些缺失的条目。

![](img/d7f42bf515ac632dd93ef3f9ba45708d.png)

在这里，我们描述了三种协同过滤相关的方法，最近邻法，以及两种创建新的潜在空间的方法:矩阵分解和深度学习。

## 最近邻

基于最近邻的方法基于成对的项目或用户之间的相似性。余弦相似性常用于度量距离。

![](img/059e4b25d4026a563886fe461217cbc2.png)

偏好矩阵可以表示为项目向量

![](img/6b19908071104357aa2d8e49bdcd252d.png)

项目 *I1* 和项目 *I2* 的相似度计算为 *cos(I1，I2)* 。该矩阵也可以表示为用户向量

![](img/98277f4a101a055cd514adc9b4d1a7d7.png)

*U1* 和 *U2* 的相似度计算为 *cos(U1，U2)* 。注意，偏好矩阵中缺失的值通常用零填充。

对于 user_i，我们可以推荐 user_i 最相似用户喜欢的物品(user-to-user)或者 user_i 最相似物品的物品(item-to-item)。

亚马逊(Amazon|2003)、Youtube (Youtube|2010)、Linkedin (Linkedin|2014)等在实践中普遍采用了项目对项目的方法。当客户喜欢一个项目时，项目到项目系统可以快速显示与之相似的项目(每个项目的相似项目都是预先计算好的，并保存在键值数据存储中)。此外，项目对项目的推荐比用户对用户的推荐更容易解释，例如，系统可以解释为什么推荐一个项目，因为“*你喜欢 X* ”。

有可能与一个项目相似的项目的数量太小(在对相似性分数应用阈值之后)。人们可以通过包括相似物品的相似物品来扩展相似物品列表(Youtube|2010)。

在获得最相似的项目后，后处理步骤会很有用。(Youtube|2010)根据视频质量(例如，通过评级来测量)、多样性(例如，限制来自一个频道的推荐)和用户特异性(例如，与用户观看更多的视频相似的视频应该对用户排名更高)来对相似的项目进行排名。这三个要素与一个线性模型相结合，提供了一个最终排名。

## 潜在因素法

潜在因素方法创建了原始用户或项目向量的新的且通常减少的特征空间，导致实时的减少的噪声和更快的计算。

下面，我们介绍两种潜在因素方法——矩阵分解和深度学习。

## *矩阵分解*

矩阵分解在网飞推荐挑战赛中被广泛使用，特别是奇异值分解和推荐系统的一个更实用的版本。

奇异值分解 *(* SVD)将偏好矩阵分解为

![](img/38288612552696959a94706c30b500b1.png)

*U* 和 *V* 是酉矩阵。对于 4 个用户和 5 个项目，它看起来像

![](img/0f1dfd30a5b5897d8be9e5579fedf6fd.png)

其中*西格玛 _1 >西格玛 _2 >西格玛 _3 >西格玛 _4* 。

第一用户对第一项目的偏好可以写成

![](img/284126889be974e54295a522f445310b.png)

这可以用向量来表示

![](img/98a86b592b1735f0ab4f20fb1920bfeb.png)

在 sigma 向量和第一个用户向量之间应用 entrywise 乘积，然后与第一个项目向量应用点积。可以看出 *u* 和 *v* 具有相同的长度，即它们在相同的潜在特征空间中。西格玛向量代表每个特征的重要性。

现在，让我们根据 sigmas 选择前两个特征

![](img/71931c34fbf60eb09fb9a57343ed5f02.png)

其可以表示为项目和用户向量，每个向量的长度为 2。

## *西蒙·芬克的奇异值分解*

偏好矩阵中的许多条目可能会丢失，常规 SVD 存在以下问题:( 1)丢失值的估算方式可能会对结果产生不良影响。(2)考虑到所有条目，训练的计算复杂度可能很高。

在网飞挑战赛中，西蒙·芬克提出了一个可行的解决方案

![](img/8f23dd8b2f5bebeb56ed68529eaf9da0.png)

在公式中，仅考虑非缺失条目 *p_{ij}* 。来自 *i^{th}* 用户的 *j^{th}* 项目的预计得分为

![](img/82a21c8da425c54094e02c15a004efb9.png)

注意，用户和项目向量没有 SVD 中的单位长度，但这无关紧要，因为误差的平方和被最小化了。芬克的方法在网飞挑战赛中取得了巨大的成功，这个想法由网飞实施(网飞|2012)。

## *深度学习嵌入*

深度学习在将各种因素纳入建模和创建嵌入方面更灵活(比矩阵分解更灵活)。例如，深度学习通过利用 skip-gram 模型来对序列信息进行建模，该模型最初用于计算单词相似度。(Airbnb|2018，Zillow|2018)

比如说，一个用户的项目序列是 item1 -> item2 -> item 3 -> item4 ->直觉是用序列中的每一个项目来预测它的相邻项目，公式化为一个分类问题，其中每一个项目都是一个类。训练数据包括每个项目的相邻 K 个项目(左 K 和右 K 个项目)。下图说明了 K = 1 的项目对。

![](img/5ac4723121e2b03a5a7b6f8b7d8f22d1.png)

此外，每个项目被表示为一个独热向量，其长度等于项目的数量。类神经网络将项目 one-hot 向量作为输入，并输出其相似项目之一的向量，如下图所示，使用(Item2，Item1)作为训练示例。

隐藏层是新的特征空间(或潜在空间)，可以使用输入层和隐藏层之间的权重将每个项目转移到新的特征空间(本质上是原始特征的线性组合)。

![](img/e025661d7c0396edf47b3240eb26b764.png)

在现实中，可能有数百万个项目，数十亿个示例用于训练网络。为了简化计算，可以应用*负采样*的思想。其思想是只更新输出项(项 1)和少量随机抽样的其他项的权重。在下面，我们突出显示需要更新的项目和权重。这使得计算速度更快。

![](img/e0b9e1e7b9c8d9e6fa3abe426ee567c3.png)

一旦在新的特征空间中表示了每个项目，就可以计算项目之间的相似性，并且可以基于相似性分数来进行推荐。

在一些情况下，用户在转换之前访问一系列项目，例如，亚马逊用户在一系列页面浏览之后进行购买；Airbnb 用户在查看了几个房源后预订了一个房源。可以通过将购买的物品添加到每个物品的训练对(Airbnb|2018)来包含这些信息，如下图所示。以这种方式推荐的项目可以提高转化率。

![](img/55310e3796c671781d398374caee6070.png)

## 混合方法

混合方法使用来自用户-项目交互和用户/项目特征的信息。

Linkedin 的“你可能想关注的公司”功能使用了内容和协作过滤信息(Linkedin|2014)。为了确定用户是否想要关注某个公司，逻辑回归分类器建立在一组特征上。协同过滤信息被包括在指示该公司是否与用户已经关注的公司相似的特征中。内容信息包括是否行业、地点等。用户和公司之间的匹配。

深度学习模型在结合协作过滤和基于内容的信息方面可以是强大的。Youtube 推荐系统(Youtube|2016)建立了深度学习模型，根据用户以前的活动(搜索查询和观看的视频)和静态信息(性别、位置等)来预测用户的观看。).观看的视频和查询被表示为嵌入。由于神经网络通常采用固定长度的输入，用户观看的视频或查询向量被平均，并与其他静态特征连接。建议将多个类别的特征嵌入到一个小得多的空间中(大致与唯一值个数的对数成正比)，连续特征在 0 到 1 之间归一化(Youtube|2016)。

当用户/项目没有或很少活动时，混合方法可以依赖于基于内容的推荐，并且随着更多数据可用而变得更加准确。

## 冷启动、可扩展性、可解释性和开发探索

对于没有信息或信息很少的新用户/项目，无法做出准确的推荐。这被称为**冷启动**问题。这是依赖于用户-项目交互的协同过滤系统的典型问题。可以使用一些试探法。对于新用户，可以推荐用户区域中最受欢迎的项目。对于新项目，可以定义一些基于规则的相似性标准。例如，Airbnb 使用相同类型和价格范围的 3 个地理上最接近的房源的平均值来近似一个新房源(Airbnb|2018)。

**在决定使用哪种类型的推荐系统时，可扩展性**是一个关键因素。更复杂的系统需要更多的人，可能更难雇用，以更高的硬件成本来构建/维护。这可能是一个长期的承诺，因此企业应该了解增加的业务收益与增加的成本。也就是说，这里有一些构建可伸缩系统的关键要素。

*离线批量计算和在线上菜*。有了大量的用户和项目，人们必须离线批量计算容易获取的推荐。例如，Linkedin 使用 Hadoop 来批量处理用户项目事件数据，然后将建议加载到键值存储中进行低延迟实时查询。(领英|2014)

*采样*。当处理数百万用户和项目时，可以考虑抽样，随机抽样项目或用户，或者在没有显著用户参与的情况下删除项目。

*利用稀疏度*。在推荐系统中，用户项目偏好矩阵通常非常稀疏，大多数条目都丢失了。利用稀疏性可以显著降低计算复杂度(Amazon|2003)。

*多阶段建模*。Youtube 推荐系统将建模过程分为两步。在第一阶段，仅使用用户项目活动数据从数百万个候选项中选择数百个。在第二阶段，使用关于候选视频的更多信息用于进一步的选择和排序是可行的。(Youtube|2016)

*规模化深度人脉*。虽然在输出层中使用 softmax 或其他函数进行训练，但是在实时服务时间期间，不必计算概率，并且可以对来自最后一个隐藏层的输出使用最近邻方法。也可以考虑前面提到的负采样，以便对于每个训练示例，只更新少量的类的权重。

**可解释性**。从客户的角度来看，陈述为什么提出建议是有帮助的。在向用户推荐视频时，Youtube 添加了用户观看的视频的链接，并触发了推荐(Youtube|2010)。

从建模的角度来看，可解释性有助于开发人员理解和调试系统。基于内容的方法很容易理解，而协作过滤模型很难理解，尤其是在潜在空间。可以基于项目或用户的原始特征空间或潜在空间(矩阵分解和深度学习)对其进行聚类，并检查来自同一聚类的对象是否共享相似的特征。

此外，t-SNE 算法(Maaten|2018)可用于将高维空间投影到二维空间进行可视化(Zillow|2018)。拥有一个工具也是有用的，这样人们可以快速查看建议作为健全检查，例如 Airbnb 开发了一个内部探索工具来验证建议(Airbnb|2018)。

**开采——勘探。**推荐系统不应该过度拟合历史用户项目偏好数据(利用)，以避免陷入局部最优。

首先，应该避免训练数据完全受到先前建议的影响。Youtube 包括嵌入在其他网站中用于培训的视频。在 Youtube 站点外观看的视频并非来自推荐系统，可以有效地浮出新内容(Youtube|2016)。还可以考虑将随机性注入系统中(例如，进行随机推荐)。

可以将简单的规则添加到系统中，以增加推荐的多样性。例如，在 Youtube 推荐(Youtube|2010)中，删除了彼此过于相似的视频，并且限制了来自同一频道的视频数量。

也可以应用来自多武装匪徒的方法。优步 eats 应用了*置信上限*，以增加推荐餐厅/菜肴的多样性(优步|2018)。置信上限的思想是使用估计成功率的上限(例如，订单率、点击率、观看率)。当一个新项目到达时没有任何信息，置信区间很宽，因此上限很高。因此，新项目将有很高的机会被推荐。随着项目获得更多的印象，估计会更准确，上限会更接近其实际价值。

## 关闭

本文讨论了构建推荐系统的方法和关键观点。在实践中，公司应根据准确性、复杂性和业务影响等多种因素，在现实的资源限制(例如，工程师和软件/硬件成本)下做出选择。

> 参考文献
> 【1】音乐基因组计划。潘多拉|维基百科
> 【2】潘多拉的音乐推荐器。迈克尔·豪|潘多拉
> [3]Amazon.com 推荐:单品对单品协同过滤，格雷格、史密斯和约克|亚马逊| 2003
> [4]YouTube 视频推荐系统。Davidson，Liebald，Liu，Nandy，Vleet，Gargi，Gupta 等人。
> [5]浏览器地图:LinkedIn 的协同过滤。吴，山姆，肖恩，米图，波塞| Linkedin | 2014
> [6]推荐:超越 5 星。网飞科技博客| 2012
> 【7】网飞更新:在家试试这个。Simon Funk | 2006
> [8]列出搜索排名中的嵌入。mihajlo Grbovic | Airbnb | 2018
> 【9】YouTube 推荐的深度神经网络。Paul Covington，Jay Adams 和 Emre Sargin | Youtube | 2016
> 【10】类似住宅推荐的住宅嵌入。桑迪林|Zillow|2018
> [11]使用 t-SNE 可视化数据。Maaten，Laurens van der，和 Geoffrey Hinton|2008
> [12]用 Uber Eats 发现食物:向市场推荐。Yuyan Wang，Ning，Isaac Liu，和 Xian |优步|2018
> [13]在推荐系统中使用人机处理。埃里克·科尔森|缝合修复|2013