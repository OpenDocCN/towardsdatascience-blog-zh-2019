<html>
<head>
<title>Deploy a Streamlit Web App with Azure App Service</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Azure 应用服务部署 Streamlit Web 应用</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/deploying-a-streamlit-web-app-with-azure-app-service-1f09a2159743?source=collection_archive---------4-----------------------#2019-12-15">https://towardsdatascience.com/deploying-a-streamlit-web-app-with-azure-app-service-1f09a2159743?source=collection_archive---------4-----------------------#2019-12-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="80e7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">继<a class="ae ko" href="https://docs.microsoft.com/en-us/learn/modules/deploy-run-container-app-service" rel="noopener ugc nofollow" target="_blank">微软官方文档之后。</a></p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi kp"><img src="../Images/c1645e91a54650b0007c12f628b3c315.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iwyvpHWogyqrNmNFI2qb9g.jpeg"/></div></div><figcaption class="lb lc gj gh gi ld le bd b be z dk">Photo by <a class="ae ko" href="https://unsplash.com/@betagamma?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Daniil Silantev</a> on <a class="ae ko" href="https://unsplash.com/s/photos/stream?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="1076" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">细流</h1><p id="4f0c" class="pw-post-body-paragraph jq jr it js b jt md jv jw jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn im bi translated"><a class="ae ko" href="https://streamlit.io/docs/" rel="noopener ugc nofollow" target="_blank"> Streamlit </a>是一个开源的 python 库，非常适合显示图表和使用小部件与可视化仪表板进行交互。凭借简单的语言和直观的控件，Streamlit 可以帮助您快速创建能够显示<a class="ae ko" href="https://streamlit.io/docs/api.html" rel="noopener ugc nofollow" target="_blank">文本、数据帧、图表、地图和更多</a>内容的 web 应用。将 Streamlit web 应用部署到实际互联网的第一步是编写 app.py 脚本并在本地启动，以确保它看起来像预期的那样。</p><p id="3343" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您可以通过从我的<a class="ae ko" href="https://github.com/rchardptrsn/Census-Data-Streamlit-App" rel="noopener ugc nofollow" target="_blank"> GitHub repo 克隆来部署这个 docker 容器！</a></p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi mi"><img src="../Images/d5a711304eca0db311113c0b5af3ec6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S4cMt2tF_kqn-N0_OoYqOg.png"/></div></div></figure><p id="617c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">通过在 shell 中从保存 app.py 文件的文件夹运行<code class="fe mj mk ml mm b">streamlit run app.py</code>来启动您的 streamlit 应用程序。每当保存 app.py 文件时，本地 web 应用程序都会自动更新。Streamlit 有一个广泛的图形 API，允许 Seaborn/Matplotlib，Plotly 和 Altair 图表。结合 Streamlit 的复选框和其他小部件，您可以构建一个交互式绘图仪表板，而无需了解前端或后端 web 开发。这使得它成为研究人员和数据科学家的一个优秀工具，他们希望快速将研究结果发布到互联网上，或者在互联网上的可访问 web 应用程序中创建演示文稿。</p><p id="ff3e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Streamlit 的<a class="ae ko" href="https://streamlit.io/docs/getting_started.html" rel="noopener ugc nofollow" target="_blank">入门</a>教程是学习 API 的最佳途径，所以我将直接跳到 Streamlit web 应用程序的部署。对于这个例子，我将发表对美国人口普查局收集的<a class="ae ko" href="https://www.census.gov/programs-surveys/acs" rel="noopener ugc nofollow" target="_blank">美国 5 年调查数据</a>的探索性分析。下面是我的 streamlit 应用程序文件。使用<a class="ae ko" href="https://pypi.org/project/CensusData/" rel="noopener ugc nofollow" target="_blank"> CensusData </a> pip 包查询数据。</p><figure class="kq kr ks kt gt ku"><div class="bz fp l di"><div class="mn mo l"/></div></figure><h1 id="952a" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">Azure 容器注册表</h1><p id="0bb4" class="pw-post-body-paragraph jq jr it js b jt md jv jw jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn im bi translated">当你准备好发布一个 web 应用时，你将创建一个托管在 Azure 容器注册中心的 docker 容器。这个容器将包含 web 应用程序运行所需的一切。</p><p id="e7d9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">首先，登录到<a class="ae ko" href="https://portal.azure.com/" rel="noopener ugc nofollow" target="_blank">https://portal.azure.com/</a>。另外，安装<a class="ae ko" href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest" rel="noopener ugc nofollow" target="_blank"> Azure CLI </a>。</p><p id="3eff" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在您的电脑上，打开存储应用程序的文件夹中的 shell。通过键入以下内容登录 Azure</p><pre class="kq kr ks kt gt mp mm mq mr aw ms bi"><span id="cbbe" class="mt lg it mm b gy mu mv l mw mx">az login</span></pre><p id="eda0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">接下来，创建一个资源组来存放容器注册中心和我们将在下面的步骤中创建的 Web App 服务。</p><pre class="kq kr ks kt gt mp mm mq mr aw ms bi"><span id="55e8" class="mt lg it mm b gy mu mv l mw mx">az group create -l eastus -n CensusApp</span></pre><p id="20f1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><a class="ae ko" href="https://docs.microsoft.com/en-us/learn/modules/deploy-run-container-app-service/3-exercise-build-images?pivots=csharp" rel="noopener ugc nofollow" target="_blank">在 CensusApp 资源组下创建一个容器注册表</a>。</p><pre class="kq kr ks kt gt mp mm mq mr aw ms bi"><span id="4598" class="mt lg it mm b gy mu mv l mw mx">az acr create --name CensusAppRegistry --resource-group CensusApp --sku basic --admin-enabled true</span></pre><h2 id="1873" class="mt lg it bd lh my mz dn ll na nb dp lp kb nc nd lt kf ne nf lx kj ng nh mb ni bi translated">Dockerfile、配置文件和 requirements.txt</h2><p id="133d" class="pw-post-body-paragraph jq jr it js b jt md jv jw jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn im bi translated">对于此应用程序，有 6 个文件是此应用程序运行所必需的。census_app.py 文件是 streamlit 应用程序文件。Censusimg.jpg 是网站顶部图像的文件。您需要创建一个 Docker 文件，它给出了容器构建的说明，一个 config.toml 文件用于应用程序设置，一个 credentials.toml 文件用于防止 Docker 容器在启动时崩溃，还有一个 requirements.txt 文件用于 app.py 文件所需的 python 包。</p><p id="d271" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">您可以访问我的 GitHub 查看完整的项目。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi nj"><img src="../Images/b5c3247f2cb5ab5158d31f1248fc813b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9oS5c1DrJaysEtx0mZ34Yg.png"/></div></div><figcaption class="lb lc gj gh gi ld le bd b be z dk">files that complete the docker build</figcaption></figure><h2 id="d334" class="mt lg it bd lh my mz dn ll na nb dp lp kb nc nd lt kf ne nf lx kj ng nh mb ni bi translated">Dockerfile 文件</h2><pre class="kq kr ks kt gt mp mm mq mr aw ms bi"><span id="02f4" class="mt lg it mm b gy mu mv l mw mx">FROM python:3.7-slim<br/>COPY . /app<br/>WORKDIR /app<br/>RUN pip install -r requirements.txt<br/>EXPOSE 80<br/>RUN mkdir ~/.streamlit<br/>RUN cp config.toml ~/.streamlit/config.toml<br/>RUN cp credentials.toml ~/.streamlit/credentials.toml<br/>WORKDIR /app<br/>ENTRYPOINT ["streamlit", "run"]<br/>CMD ["census_app.py"]</span></pre><h2 id="2ed7" class="mt lg it bd lh my mz dn ll na nb dp lp kb nc nd lt kf ne nf lx kj ng nh mb ni bi translated">和 credentials.toml</h2><p id="c35f" class="pw-post-body-paragraph jq jr it js b jt md jv jw jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn im bi translated">我推荐从他的<a class="ae ko" href="https://github.com/MarcSkovMadsen/awesome-streamlit/tree/master/.streamlit" rel="noopener ugc nofollow" target="_blank"> awesome-streamlit 存储库中复制<a class="ae ko" href="https://github.com/MarcSkovMadsen/awesome-streamlit/commits?author=MarcSkovMadsen" rel="noopener ugc nofollow" target="_blank"> MarcSkovMadsen </a>的 config.toml 文件。</a></p><p id="b9f3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> requirements.txt </strong></p><pre class="kq kr ks kt gt mp mm mq mr aw ms bi"><span id="1d55" class="mt lg it mm b gy mu mv l mw mx">streamlit<br/>pandas<br/>numpy<br/>seaborn<br/>matplotlib<br/>psycopg2-binary</span></pre><h1 id="3111" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">构建 docker 映像并保存到 Azure 容器注册表</h1><p id="f788" class="pw-post-body-paragraph jq jr it js b jt md jv jw jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn im bi translated">在 shell 中保存文件的文件夹中，运行:</p><pre class="kq kr ks kt gt mp mm mq mr aw ms bi"><span id="1909" class="mt lg it mm b gy mu mv l mw mx">az acr build --registry CensusAppRegistry --resource-group CensusApp --image census-app .</span></pre><p id="225f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果构建成功，您应该会看到带有 sha256 的映像描述，输出类似于:<strong class="js iu"> Run ID: ca1 在 2m36s 秒后成功</strong>。通过登录 Azure 门户并导航到您的资源组，仔细检查以确保图像在您的容器注册表中，单击您的容器注册表，在服务刀片下，单击存储库。</p><h1 id="5601" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">从容器映像部署 Web 应用程序</h1><p id="5f5e" class="pw-post-body-paragraph jq jr it js b jt md jv jw jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn im bi translated">为您的 web 应用创建应用服务计划。这将决定运行 docker 映像的虚拟机的大小。在这里，我选择了 B1 的 sku，这是 free 上面的第一层。在写这篇文章的时候，B1 服务计划是 12.41 英镑/月。<a class="ae ko" href="https://docs.microsoft.com/en-us/cli/azure/appservice/plan?view=azure-cli-latest#az-appservice-plan-create" rel="noopener ugc nofollow" target="_blank">在门户内创建应用服务计划</a>或运行:</p><pre class="kq kr ks kt gt mp mm mq mr aw ms bi"><span id="2371" class="mt lg it mm b gy mu mv l mw mx">az appservice plan create -g CensusApp -n CensusAppServicePlan -l eastus --is-linux --sku B1</span></pre><p id="c784" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><a class="ae ko" href="https://docs.microsoft.com/en-us/cli/azure/webapp?view=azure-cli-latest#az-webapp-create" rel="noopener ugc nofollow" target="_blank">通过运行下面的命令从容器注册表中的 docker 容器创建 Azure web app </a>，<a class="ae ko" href="https://docs.microsoft.com/en-us/learn/modules/deploy-run-container-app-service/5-exercise-deploy-web-app?pivots=csharp" rel="noopener ugc nofollow" target="_blank">或者从门户创建。</a></p><pre class="kq kr ks kt gt mp mm mq mr aw ms bi"><span id="b194" class="mt lg it mm b gy mu mv l mw mx">az webapp create -g CensusApp -p CensusAppServicePlan -n census-web-app -i censusappregistry.azurecr.io/census-app:latest</span></pre><p id="b545" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">若要查看您的新网站，请转到您的新 web 应用程序资源并选择“浏览”。第一次查看时，会有冷启动延迟，大约 5 分钟后可能会没有响应。回到资源并再次单击 browse，您的 web 应用程序应该会出现在您的浏览器中！</p><p id="f679" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，您应该可以在资源组中看到 3 个资源。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi nk"><img src="../Images/9ac9980acbd76e2eca0cee7cab0d3093.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hh21Wgt--aV8S1M55mGkPg.png"/></div></div></figure><h1 id="a714" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">重新部署您的 web 应用程序</h1><p id="2519" class="pw-post-body-paragraph jq jr it js b jt md jv jw jx me jz ka kb mf kd ke kf mg kh ki kj mh kl km kn im bi translated">这种 web 应用交付方法的美妙之处在于，您可以通过重新构建容器来重新部署应用。</p><p id="1db4" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">只需对您的 streamlit app.py 文件进行更改，并通过运行我们之前运行的命令在容器注册表中构建初始映像来重新构建您的容器。</p><pre class="kq kr ks kt gt mp mm mq mr aw ms bi"><span id="7e5d" class="mt lg it mm b gy mu mv l mw mx">az acr build --registry CensusAppRegistry --resource-group CensusApp --image census-app .</span></pre><p id="a1c6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">浏览器地址栏中将显示新 web 应用的链接。看看那个漂亮的应用程序！现在您已经完成了部署，您可以重新访问应用程序，进行更改并添加功能。干得好！</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi nl"><img src="../Images/b0499725268f4ff6e05cd29d647349b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*577Q25f2RGOGAnMyWnCuAA.png"/></div></div></figure><p id="a90a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><a class="ae ko" href="https://github.com/rchardptrsn/Census-Data-Streamlit-App" rel="noopener ugc nofollow" target="_blank">请访问我的 GitHub </a>获取用于构建这个容器化 web 应用程序的文件！</p><p id="ae03" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">感谢您的阅读！</p><p id="6ef0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">**编辑:将 SQL 请求更改为实际的<a class="ae ko" href="https://pypi.org/project/CensusData/" rel="noopener ugc nofollow" target="_blank"> CensusData API </a>请求！</p></div></div>    
</body>
</html>