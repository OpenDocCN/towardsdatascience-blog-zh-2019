<html>
<head>
<title>Enhancing Static Plots with Animations</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用动画增强静态图</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/enhancing-static-plots-with-animations-ca987801a6b0?source=collection_archive---------24-----------------------#2019-08-30">https://towardsdatascience.com/enhancing-static-plots-with-animations-ca987801a6b0?source=collection_archive---------24-----------------------#2019-08-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7a4e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用 gganimate 增加 ggplot2 的可视化效果</h2></div><p id="2d7b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这篇文章旨在向你介绍使用托马斯·林·彼得森的<code class="fe le lf lg lh b">gganimate</code>包在 r 语言中制作<code class="fe le lf lg lh b">ggplot2</code>可视化动画。</p><p id="ec35" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果我按照我在这篇<a class="ae li" href="https://www.dontblamethedata.com/blog/simplifying-afl-tipping/" rel="noopener ugc nofollow" target="_blank">帖子</a>中解释的简单模型来预测(或在澳大利亚称为 tip)AFL 的获胜者，这篇帖子将会可视化我将会获得的理论奖金。分析中使用的数据是从 AFL Tables 网站上收集的，是我写的关于 AFL 人群的一个更大系列的一部分。更广泛的项目可以在这里找到<a class="ae li" href="https://github.com/JaseZiv/AFL-Crowd-Analytics" rel="noopener ugc nofollow" target="_blank">。</a></p><pre class="lj lk ll lm gt ln lh lo lp aw lq bi"><span id="0250" class="lr ls it lh b gy lt lu l lv lw">library(tidyverse)<br/>library(lubridate)<br/>library(scales)<br/>library(gganimate)</span><span id="edd7" class="lr ls it lh b gy lx lu l lv lw"># set themes<br/>theme_set(theme_minimal() +<br/> theme(axis.title.x = element_text(size = 16, hjust = 1), <br/> axis.title.y = element_text(size = 16), <br/> axis.text = element_text(size = 13),<br/> plot.title = element_text(size = 19)))</span><span id="6a76" class="lr ls it lh b gy lx lu l lv lw"># create a colour pallette<br/>colours &lt;- c(“#5EB296”, “#4E9EBA”, “#F29239”, “#C2CE46”, “#FF7A7F”, “#4D4D4D”)</span><span id="e2c9" class="lr ls it lh b gy lx lu l lv lw"># — — — Read in data — — -#<br/>afl &lt;- read.csv("<a class="ae li" href="https://raw.githubusercontent.com/JaseZiv/AFL-Crowd-Analytics/master/data/cleaned_data/afl_model_data.csv" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/JaseZiv/AFL-Crowd-Analytics/master/data/cleaned_data/afl_model_data.csv</a>", stringsAsFactors = F)</span><span id="7020" class="lr ls it lh b gy lx lu l lv lw"># Data pre-processing — — — — — — — — — — — — — — — — — — — — — — — — — — -</span><span id="f7e2" class="lr ls it lh b gy lx lu l lv lw"># make all variables character type to make splitting and string manipulation easier<br/>afl &lt;- afl %&gt;% <br/> mutate_if(is.factor, as.character) %&gt;% <br/> mutate(team1_score = as.numeric(team1_score),<br/> team2_score = as.numeric(team2_score)) %&gt;% <br/> mutate(fav_team = ifelse(AwayLineClose &lt; 0, team2, team1)) %&gt;% <br/> mutate(winning_team = ifelse(winner == “Home”, team1, ifelse(winner == “Away”, team2, “Draw”))) %&gt;% <br/> mutate(fav_win = ifelse(fav_team == winning_team, “Yes”, “No”)) %&gt;% <br/> filter(season &gt;= 2014,<br/> !str_detect(round, “F”)) %&gt;%<br/> mutate(tip = ifelse(abs(AwayLineClose) &lt; 3, team1, fav_team))</span><span id="deeb" class="lr ls it lh b gy lx lu l lv lw"># function to calculate odds<br/>calculate_odds_available &lt;- function(tip, winning_team, team1, team2, HomeOddsClose, AwayOddsClose) {<br/> if(tip == winning_team) {<br/> odds_available &lt;- ifelse(tip == team1, HomeOddsClose, AwayOddsClose)<br/> } else {<br/> odds_available &lt;- 0<br/> }<br/>}</span><span id="2891" class="lr ls it lh b gy lx lu l lv lw"># apply function and calculate returns<br/>afl &lt;- afl %&gt;% <br/> mutate(odds_available = mapply(calculate_odds_available, tip, winning_team, team1, team2, HomeOddsClose, AwayOddsClose),<br/> game_return = odds_available * 10,<br/> game_profit = game_return — 10)</span><span id="5665" class="lr ls it lh b gy lx lu l lv lw"># create a df that calculates total winnings per round<br/>money_per_round &lt;- afl %&gt;% <br/> group_by(season, round) %&gt;% <br/> summarise(total_profit = sum(game_profit)) %&gt;% ungroup()</span><span id="2984" class="lr ls it lh b gy lx lu l lv lw"># add a round 0, where all seasons start at $0<br/>zeros &lt;- data.frame(season = (2014:2019), round = 0, total_profit = 0)</span><span id="7178" class="lr ls it lh b gy lx lu l lv lw"># join zeros df on to money_per_round<br/>money_per_round &lt;- money_per_round %&gt;% rbind(zeros)</span><span id="6a95" class="lr ls it lh b gy lx lu l lv lw"># create a df that sums up winnings cumulatively<br/>total_money &lt;- money_per_round %&gt;% <br/> arrange(season, round) %&gt;% <br/> group_by(season) %&gt;% <br/> mutate(cumulating_winnings = cumsum(total_profit)) %&gt;% ungroup()</span></pre><h2 id="49c1" class="lr ls it bd ly lz ma dn mb mc md dp me kr mf mg mh kv mi mj mk kz ml mm mn mo bi translated">我们开始吧</h2><p id="2b52" class="pw-post-body-paragraph ki kj it kk b kl mp ju kn ko mq jx kq kr mr kt ku kv ms kx ky kz mt lb lc ld im bi translated">好的，所以当我写第一篇文章的时候，我采取的第一步是创建一个 ggplot2 可视化来绘制我使用我的简单策略会得到的收益(或损失)。</p><p id="5940" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是结果:</p><pre class="lj lk ll lm gt ln lh lo lp aw lq bi"><span id="4a5b" class="lr ls it lh b gy lt lu l lv lw">total_money %&gt;%<br/> ggplot(aes(x= round, y= cumulating_winnings, <br/> group = season, colour = as.character(season))) +<br/> geom_line(size = 1) +<br/> geom_point(size = 2, colour = “black”) +<br/> labs(x= “Round”, y= “Cumulative Wins/Losses”, colour = “Season”) +<br/> scale_x_continuous(limits = c(0, 27), <br/> labels = c(0, 3, 6, 9, 12, 15, 18, 21, 24), <br/> breaks = c(0, 3, 6, 9, 12, 15, 18, 21, 24)) +<br/> scale_colour_manual(values = colours) +<br/> ggtitle(“2017 WOULD’VE BEEN A BAD YEAR”) +<br/> theme(legend.position = “bottom”)</span></pre><figure class="lj lk ll lm gt mv gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi mu"><img src="../Images/2717270e0347c8fd0c9472bc90c98d95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*dUFs66b0zGyMMZzg.png"/></div></div><figcaption class="nc nd gj gh gi ne nf bd b be z dk">The legend is hard to follow here</figcaption></figure><p id="c09e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">还不错，但肯定可以改进。在我看来，随着六季的绘制，这个传说很难映射到这条线本身。还有，除了 2017 赛季特别差，其他赛季轮次之间的变化很难看到。</p><p id="a494" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">此外，以这种方式绘制数据，如果不花费太多精力关注我在哪里会赚钱，在哪里会赔钱，就很难实现。</p><h2 id="ff25" class="lr ls it bd ly lz ma dn mb mc md dp me kr mf mg mh kv mi mj mk kz ml mm mn mo bi translated">标签和注释</h2><p id="fdf6" class="pw-post-body-paragraph ki kj it kk b kl mp ju kn ko mq jx kq kr mr kt ku kv ms kx ky kz mt lb lc ld im bi translated">呸——你不能简单地把季节加为标签——你什么都看不到！</p><pre class="lj lk ll lm gt ln lh lo lp aw lq bi"><span id="a6ff" class="lr ls it lh b gy lt lu l lv lw">total_money %&gt;%   <br/>ggplot(aes(x= round, y= cumulating_winnings, <strong class="lh iu">group</strong> = season, colour = <strong class="lh iu">as</strong>.character(season))) +   <br/>geom_line(size = 1) +   <br/>geom_point(size = 2, colour = "black") +   <br/>geom_hline(yintercept = 0, linetype = 2, size = 2) + <strong class="lh iu"># added in horizontal line at $0</strong>   <br/>geom_text(aes(label = season), hjust = -1, size = 6) + <strong class="lh iu"># season labels added</strong>   <br/>scale_colour_manual(values = colours) +   <br/>labs(x= "Round", y= "Cumulative Wins/Losses") +   scale_x_continuous(limits = c(0, 27), labels = c(1, 3, 6, 9, 12, 15, 18, 21, 24), breaks = c(1, 3, 6, 9, 12, 15, 18, 21, 24)) +   scale_y_continuous(labels = dollar) + <strong class="lh iu"># y-axis formatted to dollar format using scales</strong>   <br/>annotate("text", x= 26, y= 6, label = "Break Even $", size = 6) + <strong class="lh iu"># added text to break even line</strong>   <br/>ggtitle("2017 WOULD'VE BEEN A BAD YEAR") +   <br/>theme(legend.position = "none") <strong class="lh iu"># turned legend off</strong></span></pre><figure class="lj lk ll lm gt mv gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi mu"><img src="../Images/1f0b6665623e04cada2877507fc95501.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*k6ZGvdu8UDfnD9eR.png"/></div></div><figcaption class="nc nd gj gh gi ne nf bd b be z dk">That didn’t work!</figcaption></figure><p id="71fe" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">相反，只有一个季节标签适用，并适用于每条线的运行结束。这个看起来好多了。</p><p id="bcf4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如我们所见，静态图表中添加了更多元素，包括:</p><ul class=""><li id="8ca4" class="ng nh it kk b kl km ko kp kr ni kv nj kz nk ld nl nm nn no bi translated">添加盈亏平衡线；</li><li id="eb48" class="ng nh it kk b kl np ko nq kr nr kv ns kz nt ld nl nm nn no bi translated">将 y 轴格式化为美元格式；和</li><li id="beef" class="ng nh it kk b kl np ko nq kr nr kv ns kz nt ld nl nm nn no bi translated">添加标签和移除图例</li></ul><p id="2f18" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这大大提高了剧情的可读性。</p><pre class="lj lk ll lm gt ln lh lo lp aw lq bi"><span id="ceb4" class="lr ls it lh b gy lt lu l lv lw">total_money %&gt;% <br/>ggplot(aes(x= round, y= cumulating_winnings, <strong class="lh iu">group</strong> = season, colour = <strong class="lh iu">as</strong>.character(season))) + <br/>geom_line(size = 1) + <br/>geom_point(size = 2, colour = “black”) + <br/>geom_hline(yintercept = 0, linetype = 2, size = 2) + <strong class="lh iu"># added in horizontal line at $0</strong> <br/>geom_text(data = total_money %&gt;% filter(round == max(round)), aes(label = season), hjust = -0.3, size = 6) + <strong class="lh iu"># season labels added, but only one label per season</strong> <br/>scale_colour_manual(values = colours) + <br/>labs(x= “Round”, y= “Cumulative Wins/Losses”) + scale_x_continuous(limits = c(0, 27), labels = c(1, 3, 6, 9, 12, 15, 18, 21, 24), breaks = c(1, 3, 6, 9, 12, 15, 18, 21, 24)) + scale_y_continuous(labels = dollar) + <strong class="lh iu"># y-axis formatted to dollar format using scales</strong> <br/>annotate(“text”, x= 26, y= 6, label = “Break Even $”, size = 6) + <strong class="lh iu"># added text to break even line</strong> <br/>ggtitle(“2017 WOULD’VE BEEN A BAD YEAR”) + <br/>theme(legend.position = “none”) <strong class="lh iu"># turned legend off</strong></span></pre><figure class="lj lk ll lm gt mv gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi mu"><img src="../Images/d49643e6098cee4e2d311bf84689cddf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*636bPX5mfhElW-ww.png"/></div></div><figcaption class="nc nd gj gh gi ne nf bd b be z dk">Looking better…</figcaption></figure><h2 id="e018" class="lr ls it bd ly lz ma dn mb mc md dp me kr mf mg mh kv mi mj mk kz ml mm mn mo bi translated">你好动画！</h2><p id="5444" class="pw-post-body-paragraph ki kj it kk b kl mp ju kn ko mq jx kq kr mr kt ku kv ms kx ky kz mt lb lc ld im bi translated">虽然上面的图表看起来好多了，但没有夸张！</p><p id="d3f5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">输入来自<code class="fe le lf lg lh b">gganimate</code>的动画！</p><p id="d7cb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">使用动画情节允许我们删除更多的元素。通过标签和动画的正确组合，y 轴不再是必要的——在每一轮中，我们可以跟踪我们的输赢，而盈亏平衡线为我们提供了一个参考点。</p><p id="51bd" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这里做的其他事情包括使用<code class="fe le lf lg lh b">fps</code>(每秒帧数)减慢帧的速度，并将<code class="fe le lf lg lh b">transition_reveal()</code>中的<code class="fe le lf lg lh b">range</code>调整为比它转换的回合长(即调整范围为<code class="fe le lf lg lh b">c(0,25)</code>)。这允许动画在完成循环后暂停。</p><p id="e405" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最后，为了增加输出的大小，根据您的喜好调整<code class="fe le lf lg lh b">width</code>和<code class="fe le lf lg lh b">height</code>参数。</p><pre class="lj lk ll lm gt ln lh lo lp aw lq bi"><span id="aaba" class="lr ls it lh b gy lt lu l lv lw">total_money_anim &lt;-  total_money %&gt;%   <br/>ggplot(aes(x= round, y= cumulating_winnings, <strong class="lh iu">group</strong> = season, colour = <strong class="lh iu">as</strong>.character(season))) +   <br/>geom_line(size = 2) +   <br/>geom_point(size = 3, colour = "black") +   <br/>geom_hline(yintercept = 0, linetype = 2, size = 2) +   geom_text(aes(label = paste0(season, ": ", dollar(cumulating_winnings))), hjust = -0.3, size = 6) +   scale_colour_manual(values = colours) +   <br/>labs(x= "Round", y= "Cumulative Wins/Losses") +   scale_x_continuous(limits = c(0, 27), labels = c(1, 3, 6, 9, 12, 15, 18, 21, 24), breaks = c(1, 3, 6, 9, 12, 15, 18, 21, 24)) +   scale_y_continuous(labels = dollar) +   <br/>annotate("text", x= 26, y= 6, label = "Break Even $", size = 6) +   ggtitle("2017 WOULD'VE BEEN A BAD YEAR") +   <br/>theme(legend.position = "none", axis.text.y = element_blank(),          axis.title.y = element_blank(), panel.grid.major.y = element_blank(), panel.grid.minor.y = element_blank()) +   transition_reveal(round, range = c(0, 25)) <br/></span><span id="86e3" class="lr ls it lh b gy lx lu l lv lw">animate(total_money_anim, width = 900, height = 900, fps = 5)</span></pre><figure class="lj lk ll lm gt mv gh gi paragraph-image"><div role="button" tabindex="0" class="mw mx di my bf mz"><div class="gh gi nu"><img src="../Images/e5d4f8d88c452af4f2d5a1063be80cae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*BQ2T1a1cUTk3j4XKtKAbtQ.gif"/></div></div><figcaption class="nc nd gj gh gi ne nf bd b be z dk">Animations make things so much better</figcaption></figure><p id="5c77" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">希望这给了你一些灵感，让你开始制作一些你自己的动画形象。</p><p id="81fe" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你有任何问题或建议，请在评论中告诉我。</p><p id="0efd" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu"> <em class="nv">本帖原创，发布在不怪数据博客</em></strong><a class="ae li" href="https://www.dontblamethedata.com/" rel="noopener ugc nofollow" target="_blank"><strong class="kk iu"><em class="nv">【https://www.dontblamethedata.com】</em></strong></a></p></div></div>    
</body>
</html>