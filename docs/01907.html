<html>
<head>
<title>Graphing Brexit</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">描绘英国退出欧盟</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/graphing-brexit-bbe4314cf70?source=collection_archive---------9-----------------------#2019-03-29">https://towardsdatascience.com/graphing-brexit-bbe4314cf70?source=collection_archive---------9-----------------------#2019-03-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="12db" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我和我的许多同胞一起，在周三晚上观看了英国议员对一系列潜在的英国退出欧盟选项投“不”票，然后阅读了不同个人和政党在各种网站上投票的分析。</p><p id="3113" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">虽然非常有趣，但所有的分析对我来说都是非常表格化的(T4)，我很好奇我们是否可以通过将数据放到图表中来学习新的东西。</p><h1 id="846e" class="kp kq it bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">获取数据</h1><p id="d910" class="pw-post-body-paragraph jq jr it js b jt ln jv jw jx lo jz ka kb lp kd ke kf lq kh ki kj lr kl km kn im bi translated">我四处搜索了一下，试图找到选票背后的数据，虽然有官方记录，但我发现《卫报》的“你的议员如何投票表”是最容易处理的。</p><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="gh gi ls"><img src="../Images/a7006607ab5a94d0122e345fc8b6ec1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NN0u15SWpV3j3PQwp-qe9g.png"/></div></div><figcaption class="me mf gj gh gi mg mh bd b be z dk">Guardian Voting Table</figcaption></figure><p id="7cdc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我编写了一个 scraper，将这些数据放入 CSV 文件中，我们可以使用<a class="ae ko" href="https://neo4j.com/docs/cypher-manual/current/clauses/load-csv/" rel="noopener ugc nofollow" target="_blank"> LOAD CSV </a>工具将这些文件导入 Neo4j。</p><p id="fa15" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你可以在<a class="ae ko" href="https://github.com/mneedham/graphing-brexit" rel="noopener ugc nofollow" target="_blank">mneedham/graphing-英国退出欧盟</a> GitHub 资源库中找到 scrapper 和原始 CSV 文件。下面是其中一个文件的示例:</p><figure class="lt lu lv lw gt lx"><div class="bz fp l di"><div class="mi mj l"/></div><figcaption class="me mf gj gh gi mg mh bd b be z dk">Sample of mps.csv</figcaption></figure><h1 id="48bf" class="kp kq it bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">导入数据</h1><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/aee94d4a11c9eeacacb87f064d0ce778.png" data-original-src="https://miro.medium.com/v2/resize:fit:586/format:webp/1*x01aEN66cD6p858eq2aR_Q.png"/></div><figcaption class="me mf gj gh gi mg mh bd b be z dk">Enable multi statement query editor</figcaption></figure><p id="90bb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们可以通过将以下脚本粘贴到 Neo4j 浏览器中，将数据导入到 Neo4j 中。如果您在家里跟进，请确保启用了多语句查询编辑器。</p><p id="6068" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你还需要确保你已经安装了流行的<a class="ae ko" href="https://neo4j.com/developer/neo4j-apoc/" rel="noopener ugc nofollow" target="_blank"> APOC </a>库，因为我们用它来创建表明议员投票方式的关系。</p><pre class="lt lu lv lw gt ml mm mn mo aw mp bi"><span id="9506" class="mq kq it mm b gy mr ms l mt mu">// Create one node per motion<br/>LOAD CSV WITH HEADERS FROM "<a class="ae ko" href="https://github.com/mneedham/graphing-brexit/raw/master/data/motions.csv" rel="noopener ugc nofollow" target="_blank">https://github.com/mneedham/graphing-brexit/raw/master/data/motions.csv</a>" AS row<br/>MERGE (m:Motion {id: toInteger(row.id)})<br/>SET m.name = row.name;</span><span id="e93b" class="mq kq it mm b gy mv ms l mt mu">// Create nodes for each MP and each party and connect them<br/>LOAD CSV WITH HEADERS FROM "<a class="ae ko" href="https://github.com/mneedham/graphing-brexit/raw/master/data/mps.csv" rel="noopener ugc nofollow" target="_blank">https://github.com/mneedham/graphing-brexit/raw/master/data/mps.csv</a>" AS row<br/>MERGE (person:Person {name: row.mp})<br/>MERGE (party:Party {name: row.party})<br/>MERGE (person)-[:MEMBER_OF]-&gt;(party);</span><span id="1433" class="mq kq it mm b gy mv ms l mt mu">// Create a relationship between each MP and each motion<br/>LOAD CSV WITH HEADERS FROM "<a class="ae ko" href="https://github.com/mneedham/graphing-brexit/raw/master/data/votes.csv" rel="noopener ugc nofollow" target="_blank">https://github.com/mneedham/graphing-brexit/raw/master/data/votes.csv</a>" AS row<br/>MATCH (person:Person {name: row.person})<br/>MATCH (motion:Motion {id: toInteger(row.motionId)})<br/>CALL apoc.create.relationship(person, row.vote, {}, motion) <br/>YIELD rel<br/>RETURN rel;</span></pre><p id="9667" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们可以通过执行<code class="fe mw mx my mm b">CALL db.schema()</code>命令来查看图表的模式:</p><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/61899323cc825922cf9dfe0380907620.png" data-original-src="https://miro.medium.com/v2/resize:fit:752/format:webp/1*NN1KwYZic6dB3lfmERQ1pg.png"/></div><figcaption class="me mf gj gh gi mg mh bd b be z dk">Graph model for the Brexit votes</figcaption></figure><h1 id="96db" class="kp kq it bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">分析数据</h1><p id="bb96" class="pw-post-body-paragraph jq jr it js b jt ln jv jw jx lo jz ka kb lp kd ke kf lq kh ki kj lr kl km kn im bi translated">既然我们已经加载了数据，让我们来分析它。我们将从支持和反对不同运动的总次数的概述开始。我们可以通过运行以下查询来做到这一点:</p><pre class="lt lu lv lw gt ml mm mn mo aw mp bi"><span id="5a1f" class="mq kq it mm b gy mr ms l mt mu">MATCH (motion:Motion)<br/>RETURN motion.name,<br/>       size((motion)&lt;-[:FOR]-()) AS for,<br/>       size((motion)&lt;-[:AGAINST]-()) AS against<br/>ORDER BY motion.id</span></pre><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="gh gi na"><img src="../Images/a41d854864a971431a61d92cca8fea12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FXdCLWCmWnwbr_emwt0eXg.png"/></div></div><figcaption class="me mf gj gh gi mg mh bd b be z dk">Total votes for each motion</figcaption></figure><p id="fc73" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">对于那些熟知这些数字的人来说，你会注意到有些数字差了一位。这是因为<strong class="js iu">守护表好像少了一个 MP </strong>！我不确定是谁，但如果你发现了它，请告诉我，我会更新 CSV 文件。</p><p id="a201" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">从数据中我们还能发现什么？</p><h2 id="51b4" class="mq kq it bd kr nb nc dn kv nd ne dp kz kb nf ng ld kf nh ni lh kj nj nk ll nl bi translated">47 个人什么都没投</h2><pre class="lt lu lv lw gt ml mm mn mo aw mp bi"><span id="d88f" class="mq kq it mm b gy mr ms l mt mu">MATCH (person:Person)--&gt;(party:Party)<br/>WHERE not((person)-[:FOR]-&gt;()) AND not ((person)-[:AGAINST]-&gt;())<br/>RETURN party.name, count(*) AS count<br/>ORDER BY count DESC</span></pre><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/f3e1794de2fdac0e62db9ea3ea5ecc8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1342/format:webp/1*6lQzk_nSW0htn2tXuQ5Kjg.png"/></div><figcaption class="me mf gj gh gi mg mh bd b be z dk">Non votes by party</figcaption></figure><h2 id="70b9" class="mq kq it bd kr nb nc dn kv nd ne dp kz kb nf ng ld kf nh ni lh kj nj nk ll nl bi translated">其中许多人是保守党的内阁成员</h2><pre class="lt lu lv lw gt ml mm mn mo aw mp bi"><span id="af52" class="mq kq it mm b gy mr ms l mt mu">MATCH (person:Person)<br/>WHERE not((person)-[:FOR]-&gt;()) AND not ((person)-[:AGAINST]-&gt;())<br/>MATCH path = (person)--&gt;(:Motion)<br/>WHERE (:Party {name: "Con"})&lt;--(person)<br/>RETURN path<br/>LIMIT 50</span></pre><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="gh gi nn"><img src="../Images/ef6145dca9ee6808ad417d52f7b91041.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SabdOndy_GHoWvVdZNbdgg.png"/></div></div><figcaption class="me mf gj gh gi mg mh bd b be z dk">Ain’t nobody got time to vote</figcaption></figure><h2 id="7e82" class="mq kq it bd kr nb nc dn kv nd ne dp kz kb nf ng ld kf nh ni lh kj nj nk ll nl bi translated">有保守派投票支持工党的计划吗？</h2><pre class="lt lu lv lw gt ml mm mn mo aw mp bi"><span id="e6b9" class="mq kq it mm b gy mr ms l mt mu">MATCH path = (:Motion {id: 3})&lt;-[:FOR]-()-[:MEMBER_OF]-&gt;(:Party {name: "Con"})<br/>RETURN path</span></pre><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div class="gh gi no"><img src="../Images/de2bdf1af32231a82e02902c55b12cab.png" data-original-src="https://miro.medium.com/v2/resize:fit:928/format:webp/1*oq8lPogWYK3ghBEvvjlm_w.png"/></div><figcaption class="me mf gj gh gi mg mh bd b be z dk">Conservatives voting for Labour’s plan</figcaption></figure><p id="50c0" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">就一个！</p><h1 id="44ae" class="kp kq it bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">用 Neo4j Bloom 可视化数据</h1><p id="0054" class="pw-post-body-paragraph jq jr it js b jt ln jv jw jx lo jz ka kb lp kd ke kf lq kh ki kj lr kl km kn im bi translated">在又写了几个 Cypher 查询之后，我开始好奇我们是否可以做任何视觉分析，所以我打开了<a class="ae ko" href="https://neo4j.com/bloom/" rel="noopener ugc nofollow" target="_blank"> Neo4j Bloom </a>。</p><p id="b0cb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">呼声最高的两个人是 Boris Johnson 和 Jacob Rees-Mogg，通过输入搜索词<code class="fe mw mx my mm b">Boris Johnson Motion Jacob Rees-Mogg</code>，我们得到下面的<strong class="js iu"> BoRees Star </strong>:</p><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="gh gi np"><img src="../Images/4a9dea0a388627f751912ddd3ab72d6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bb3uMdvAeoUQIprRNlItYg.png"/></div></div><figcaption class="me mf gj gh gi mg mh bd b be z dk">The BoRees Star</figcaption></figure><p id="8698" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如我们所见，他们对每一项动议都投了相同的票。</p><h1 id="e341" class="kp kq it bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">使用图算法寻找相似的投票者</h1><p id="3da3" class="pw-post-body-paragraph jq jr it js b jt ln jv jw jx lo jz ka kb lp kd ke kf lq kh ki kj lr kl km kn im bi translated">在比较了几个这样的 MP 之后，我想尝试自动化这个过程，这个问题对于<a class="ae ko" href="https://neo4j.com/docs/graph-algorithms/current/" rel="noopener ugc nofollow" target="_blank"> Neo4j 图算法库</a>中的<a class="ae ko" href="https://neo4j.com/docs/graph-algorithms/current/algorithms/similarity/" rel="noopener ugc nofollow" target="_blank"> <strong class="js iu">相似性算法</strong> </a>来说是完美的。</p><p id="dd27" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们想找出不同人的投票模式有多相似。最初我认为我们可以使用 Jaccard 相似性来做到这一点，但意识到它不会工作得很好，因为虽然<strong class="js iu">两个人可以连接到同一个动议，但这并不意味着他们是相似的</strong>-他们可能以不同的方式投票！</p><p id="1e5b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">相反，我们会认为投票是给一个动议打分。如果你投票:</p><ul class=""><li id="a48c" class="nq nr it js b jt ju jx jy kb ns kf nt kj nu kn nv nw nx ny bi translated">因为这意味着你喜欢它。得分为 1</li><li id="1d45" class="nq nr it js b jt nz jx oa kb ob kf oc kj od kn nv nw nx ny bi translated">没有投票，这意味着你不确定。0.5 分</li><li id="31ec" class="nq nr it js b jt nz jx oa kb ob kf oc kj od kn nv nw nx ny bi translated">反对那就说明你不喜欢。得分为 0</li></ul><p id="986f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果我们像这样对投票进行评分，这意味着我们可以使用一种基于权重的相似性算法。余弦相似性算法通常用于计算推荐引擎中项目之间的相似性，因此我们将尝试使用该算法。</p><h2 id="267f" class="mq kq it bd kr nb nc dn kv nd ne dp kz kb nf ng ld kf nh ni lh kj nj nk ll nl bi translated">谁的选票最像鲍里斯？</h2><pre class="lt lu lv lw gt ml mm mn mo aw mp bi"><span id="dd33" class="mq kq it mm b gy mr ms l mt mu">MATCH (p1Party:Party)&lt;-[:MEMBER_OF]-(p1:Person)-[r1]-&gt;(m:Motion)<br/>WHERE p1.name = "Boris Johnson"<br/>MATCH (p2Party:Party)&lt;-[:MEMBER_OF]-(p2:Person)-[r2]-&gt;(m) <br/>WHERE p2 &lt;&gt; p1<br/>WITH p1, p2, p2Party,<br/>     CASE WHEN type(r1) = "FOR" THEN 5 <br/>          WHEN type(r1) = "DID_NOT_VOTE" THEN 0.5 <br/>          ELSE 0 END AS r1Score,<br/>     CASE WHEN type(r2) = "FOR" THEN 5 <br/>          WHEN type(r2) = "DID_NOT_VOTE" THEN 0.5 <br/>          ELSE 0 END AS r2Score <br/>WITH p2.name AS to,<br/>     p2Party.name AS party,<br/>     algo.similarity.cosine(collect(r1Score), collect(r2Score)) <br/>     AS similarity<br/>WHERE similarity &gt; 0<br/>RETURN to, party, similarity<br/>ORDER BY similarity DESC</span></pre><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="gh gi oe"><img src="../Images/5dd598a56e640d0898833bb9243ccdb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zWlSLODYZSf7sORTsA11lA.png"/></div></div></figure><p id="687f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">也许不足为奇的是，保守党中的许多人也投了相同的票。</p><h2 id="13a7" class="mq kq it bd kr nb nc dn kv nd ne dp kz kb nf ng ld kf nh ni lh kj nj nk ll nl bi translated">如果排除同党的人呢？</h2><pre class="lt lu lv lw gt ml mm mn mo aw mp bi"><span id="8513" class="mq kq it mm b gy mr ms l mt mu">MATCH (p1Party:Party)&lt;-[:MEMBER_OF]-(p1:Person)-[r1]-&gt;(m:Motion)<br/>WHERE p1.name = "Boris Johnson"<br/>MATCH (p2Party:Party)&lt;-[:MEMBER_OF]-(p2:Person)-[r2]-&gt;(m) <br/>WHERE p2 &lt;&gt; p1<br/>WITH p1, p2, p2Party,<br/>     CASE WHEN type(r1) = "FOR" THEN 5 <br/>          WHEN type(r1) = "DID_NOT_VOTE" THEN 0.5 <br/>          ELSE 0 END AS r1Score,<br/>     CASE WHEN type(r2) = "FOR" THEN 5 <br/>          WHEN type(r2) = "DID_NOT_VOTE" THEN 0.5 <br/>          ELSE 0 END AS r2Score<br/>WHERE p1Party &lt;&gt; p2Party <br/>WITH p2.name AS to,<br/>     p2Party.name AS party,<br/>     algo.similarity.cosine(collect(r1Score), collect(r2Score)) <br/>     AS similarity<br/>WHERE similarity &gt; 0<br/>RETURN to, party, similarity<br/>ORDER BY similarity DESC</span></pre><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="gh gi of"><img src="../Images/8a0432f14e3c9663c118ef29ce5196ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JN8ptzyhSULBA_9Cf0g_XQ.png"/></div></div></figure><p id="a23c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">有趣的是，凯特·霍伊是一个选区的议员，该选区有 78%的人投票支持留欧，但她的投票方式与支持脱欧的人相似。</p><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="gh gi og"><img src="../Images/d112dddad7f91dd1ddea462d113adaeb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ubPHjjy8Di2oBJnn_5ciYQ.png"/></div></div></figure><h1 id="8b65" class="kp kq it bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">接下来呢？</h1><p id="b6f7" class="pw-post-body-paragraph jq jr it js b jt ln jv jw jx lo jz ka kb lp kd ke kf lq kh ki kj lr kl km kn im bi translated">这确实为一些潜在的未来分析铺平了道路。我们能否根据这些选项对脱欧/留欧立场的支持程度对它们进行排序，并计算出哪些议员的投票方式最符合其选区的投票结果？</p><p id="7616" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们可以做的另一件事是创建一个 MPs 的相似图，然后在其上运行一些<a class="ae ko" href="https://neo4j.com/docs/graph-algorithms/current/algorithms/community/" rel="noopener ugc nofollow" target="_blank">社区检测算法</a>。</p><p id="8457" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你对数据的图形分析感兴趣，你可能会喜欢我和艾米·霍德勒在过去 9 个月里一直在研究的《奥莱利图形算法》一书。我们正处于最后的审查阶段，它应该在未来几周内可用。</p><p id="2ca7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你可以从 Neo4j 网站注册获得免费的电子版，网址:<a class="ae ko" href="https://neo4j.com/graph-algorithms-book/" rel="noopener ugc nofollow" target="_blank">neo4j.com/graph-algorithms-book</a>。</p><figure class="lt lu lv lw gt lx gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/be89f2dbd51a46d7b3d24829b894d859.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*eDvf9cjqXYTjhRbDnIxjWQ.png"/></div><figcaption class="me mf gj gh gi mg mh bd b be z dk">O’Reilly Graph Algorithms Book</figcaption></figure></div></div>    
</body>
</html>