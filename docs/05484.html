<html>
<head>
<title>Practical Tips for Training a Music Model</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">训练音乐模型的实用技巧</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/practical-tips-for-training-a-music-model-755c62560ec2?source=collection_archive---------6-----------------------#2019-08-13">https://towardsdatascience.com/practical-tips-for-training-a-music-model-755c62560ec2?source=collection_archive---------6-----------------------#2019-08-13</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="9059" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是“构建人工智能音乐生成器”系列的第二部分。我们将更深入地构建在第一部分中介绍的音乐模型。</p><p id="0402" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里有一个简单的概述:</p><p id="51af" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">数据编码</strong>及如何处理:</p><ul class=""><li id="715c" class="km kn iq jp b jq jr ju jv jy ko kc kp kg kq kk kr ks kt ku bi translated">复调音乐</li><li id="8eb6" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk kr ks kt ku bi translated">音符音高/持续时间</li></ul><p id="97d8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">培训</strong>最佳实践:</p><ul class=""><li id="4167" class="km kn iq jp b jq jr ju jv jy ko kc kp kg kq kk kr ks kt ku bi translated">数据扩充</li><li id="d408" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk kr ks kt ku bi translated">位置编码</li><li id="a898" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk kr ks kt ku bi translated">教师强迫</li><li id="e041" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk kr ks kt ku bi translated">TransformerXL 架构</li></ul><p id="cbf1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="la">注意:这是一个更技术性的帖子，对于理解</em> <a class="ae kl" href="https://medium.com/@andrew.t.shaw/a-multitask-music-model-with-bert-transformer-xl-and-seq2seq-3d80bd2ea08e" rel="noopener"> <em class="la">第三部分</em> </a> <em class="la"> / </em> <a class="ae kl" href="https://medium.com/@andrew.t.shaw/how-to-remix-the-chainsmokers-with-a-music-bot-6b920359248c" rel="noopener"> <em class="la">第四部分</em> </a> <em class="la">并不重要。请随意跳过前面！</em></p><h1 id="91ac" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">快速重复。</h1><p id="579c" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">在前一篇文章中，我提到了训练音乐模型的两个基本步骤:</p><p id="67e6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">步骤一。</strong>将音乐文件转换成一系列标记:</p><figure class="mf mg mh mi gt mj gh gi paragraph-image"><div class="gh gi me"><img src="../Images/0e156c0d52b45667c729b1f47dbc5c68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1376/format:webp/1*gKf4hrXp5ypjl_mLQA92RA.png"/></div></figure><p id="a453" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">第二步。</strong>建立并训练语言模型，预测下一个令牌:</p><figure class="mf mg mh mi gt mj gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi mm"><img src="../Images/0f3177e418062d5a4c31450dbf5e5759.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pmRsrJ18X12WBc_zfXsDiA.png"/></div></div></figure><p id="a621" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个职位将被分割在完全相同的步骤。只是这一次，我们不会掩饰细节。</p><h1 id="6e22" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">第一步。将音乐转换为代币</h1><h2 id="74a4" class="mr lc iq bd ld ms mt dn lh mu mv dp ll jy mw mx lp kc my mz lt kg na nb lx nc bi translated">从原始数据开始</h2><p id="3c12" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">我们将使用一个主要由 MIDI 文件组成的数据集。这是最流行的数字音乐格式之一，互联网上有大量这样的文件。更多的数据是深度学习最好的朋友。</p><p id="f120" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">原始 MIDI 以字节表示。即使转换成文本也不是很容易读懂。</p><p id="bc82" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我不会显示 MIDI，而是向您展示如下内容:</p><figure class="mf mg mh mi gt mj gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/394ebca38d825715fcc59b4411062ff9.png" data-original-src="https://miro.medium.com/v2/resize:fit:484/format:webp/1*KCvSmrAWEBZVTrhLdw1JsA.png"/></div><figcaption class="ne nf gj gh gi ng nh bd b be z dk">Even if you can’t read music, it makes more sense than <a class="ae kl" href="https://gist.github.com/bearpelican/d123f61bbffba4005b4c6aee3dbf9195" rel="noopener ugc nofollow" target="_blank">this</a></figcaption></figure><h2 id="415a" class="mr lc iq bd ld ms mt dn lh mu mv dp ll jy mw mx lp kc my mz lt kg na nb lx nc bi translated">标记化</h2><p id="83b6" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">事实证明，在将音乐文件编码为令牌时，需要记住几个问题。对于文本，这是一个非常简单的转换。</p><p id="8bb0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面是如何将文本编码为一系列标记:</p><pre class="mf mg mh mi gt ni nj nk nl aw nm bi"><span id="5575" class="mr lc iq nj b gy nn no l np nq">Vocabulary: { <br/>  'a': 1, <br/>  'is': 2, <br/>  'language': 3,<br/>  'like': 4,<br/>  'model': 5,<br/>  'music': 6<br/>}</span><span id="77db" class="mr lc iq nj b gy nr no l np nq">Text:      “a  music model is like a  language model”<br/>Tokenized: [1, 6,    5,    2, 4,   1  3,       5]</span></pre><p id="7afe" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是一种直接的一对一映射——单词到单词。您可以进行其他类型的编码，如拆分缩写或字节对编码，但这仍然是一种顺序转换。</p><p id="de4f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然而，音乐在 2D 最具代表性:</p><figure class="mf mg mh mi gt mj gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/394ebca38d825715fcc59b4411062ff9.png" data-original-src="https://miro.medium.com/v2/resize:fit:484/format:webp/1*KCvSmrAWEBZVTrhLdw1JsA.png"/></div></figure><p id="81c6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是看待它的另一种方式:</p><figure class="mf mg mh mi gt mj gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi ns"><img src="../Images/f16529628350e42dad83451f263ff9d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ATGtubYjOd8vRi47Qg4iOA.png"/></div></div></figure><p id="574e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是频率随时间变化的曲线图(也称为钢琴声)。您会注意到这个图表的两点:</p><ol class=""><li id="8d29" class="km kn iq jp b jq jr ju jv jy ko kc kp kg kq kk nt ks kt ku bi translated">一个<em class="la">单个</em>音符是一个<em class="la">值的集合</em>(音高+持续时间)</li><li id="38a4" class="km kn iq jp b jq kv ju kw jy kx kc ky kg kz kk nt ks kt ku bi translated"><em class="la">多个音符</em>可以在一个<em class="la">单个</em>时间点演奏(复调)</li></ol><p id="028f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">用音乐训练变形金刚的诀窍是弄清楚如何将这些 2D 数据符号化为一维。</p><h2 id="28b3" class="mr lc iq bd ld ms mt dn lh mu mv dp ll jy mw mx lp kc my mz lt kg na nb lx nc bi translated">注释—一对多</h2><ol class=""><li id="91f9" class="km kn iq jp b jq lz ju ma jy nu kc nv kg nw kk nt ks kt ku bi translated">一个<em class="la">单个</em>音符代表一个<em class="la">集合</em>的值:<br/> -音高(C，C #…A #，B) <br/> -时长(四分音符，全音符)</li></ol><p id="a642" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="la">注:一个音符实际上有更多的属性，如乐器类型(鼓、小提琴)、力度(响度)和速度(定时)。这些对于生成流行旋律并不重要，但对于生成</em> <a class="ae kl" href="https://magenta.tensorflow.org/performance-rnn" rel="noopener ugc nofollow" target="_blank"> <em class="la">演奏片段</em> </a> <em class="la">却很有帮助。</em></p><p id="1130" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最简单的方法是将一个<em class="la">单个</em>音符编码成一个<em class="la">记号序列</em>:</p><figure class="mf mg mh mi gt mj gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi nx"><img src="../Images/622394daf26f46f0b4d46dab1018e410.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3fUTTumfXD66-S1lyZgO5g.png"/></div></div></figure><p id="269f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="la">注意:另一种选择是</em> <a class="ae kl" href="http://christinemcleavey.com/clara-a-neural-net-music-generator/" rel="noopener ugc nofollow" target="_blank"> <em class="la">将</em> </a> <em class="la">的值组合成一个单独的 token【C:QTR，D:QTR，E:HLF】，但这意味着更大的词汇量，对预测的控制更少。</em></p><h2 id="cce0" class="mr lc iq bd ld ms mt dn lh mu mv dp ll jy mw mx lp kc my mz lt kg na nb lx nc bi translated"><strong class="ak">复调——多对一</strong></h2><blockquote class="ny nz oa"><p id="ae3b" class="jn jo la jp b jq jr js jt ju jv jw jx ob jz ka kb oc kd ke kf od kh ki kj kk ij bi translated">你怎么知道什么时候同时演奏一系列的音符，或者按顺序演奏？</p></blockquote><p id="4c9a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">另一个名为“<a class="ae kl" href="https://github.com/tensorflow/magenta/tree/master/magenta/models/polyphony_rnn" rel="noopener ugc nofollow" target="_blank"> bachbot </a>”的音乐模型对此有一个巧妙的解决方案。如果音符由特殊的“<strong class="jp ir"> SEP </strong>”符号分隔，则按顺序播放音符。如果没有，一次弹奏所有音符。</p><figure class="mf mg mh mi gt mj gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi oe"><img src="../Images/142e1c03920f90a323110a502cdf498b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z7mUigiD_RW15ot1tiNbUQ.png"/></div></div></figure><h2 id="f23c" class="mr lc iq bd ld ms mt dn lh mu mv dp ll jy mw mx lp kc my mz lt kg na nb lx nc bi translated"><strong class="ak">将所有这些放在一起</strong></h2><p id="eda2" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">把这些放在一起，你就有了我们一开始展示的例子:</p><figure class="mf mg mh mi gt mj gh gi paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="gh gi of"><img src="../Images/55758b5e4b0555210cb179fb95b012e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zvr9u1gxzv4z0eBCj6v-pQ.png"/></div></div></figure><p id="770c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="la">如果你喜欢 Python 胜过英语，试试这个</em> <a class="ae kl" href="https://github.com/bearpelican/musicautobot/blob/master/notebooks/data_encoding/Midi2Tensor.ipynb" rel="noopener ugc nofollow" target="_blank"> <em class="la">笔记本</em> </a> <em class="la">。</em></p><h1 id="602b" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">第二步。培训最佳实践</h1><p id="acf7" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">现在，我们准备好对我们的标记化数据进行训练。这将是与第一部分相同的训练代码，但是增加了一些特性。</p><figure class="mf mg mh mi gt mj"><div class="bz fp l di"><div class="og oh l"/></div></figure><p id="76f7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们一行一行地检查代码。</p><h2 id="47e5" class="mr lc iq bd ld ms mt dn lh mu mv dp ll jy mw mx lp kc my mz lt kg na nb lx nc bi translated">数据扩充</h2><blockquote class="ny nz oa"><p id="01af" class="jn jo la jp b jq jr js jt ju jv jw jx ob jz ka kb oc kd ke kf od kh ki kj kk ij bi translated">第 3 行:config['<strong class="jp ir">transpose _ range</strong>']=(0，12)</p></blockquote><p id="a392" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">数据扩充是一个伟大的数据集倍增器。一首歌转化成 12 首不同调的歌！</p><pre class="mf mg mh mi gt ni nj nk nl aw nm bi"><span id="3e98" class="mr lc iq nj b gy nn no l np nq"><em class="la">item.to_text() # Key of C<br/></em><strong class="nj ir">Tokens:    xxbos xxpad n60 d4 n52 d8 n45 d8 xxsep d4 n62 d4</strong></span><span id="c093" class="mr lc iq nj b gy nr no l np nq"><em class="la">item.transpose(4).to_text() # Key of E<br/></em><strong class="nj ir">Transpose: xxbos xxpad n64 d4 n56 d8 n49 d8 xxsep d4 n66 d4</strong></span></pre><p id="5157" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">数据扩充似乎有助于概括关键音阶和节拍。然而，在训练的最后几个时期，我删除了增强，保留了 c 调中的所有内容。</p><p id="4347" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="la">无论是机器还是人类，预测和弹奏全白键都要容易得多。</em></p><h2 id="45c8" class="mr lc iq bd ld ms mt dn lh mu mv dp ll jy mw mx lp kc my mz lt kg na nb lx nc bi translated">位置拍编码</h2><blockquote class="ny nz oa"><p id="1b21" class="jn jo la jp b jq jr js jt ju jv jw jx ob jz ka kb oc kd ke kf od kh ki kj kk ij bi translated">第 2 行:config['encode_position'] = True</p></blockquote><p id="7f39" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">位置节拍编码是我们提供给模型的额外元数据，以使它对音乐定时有更好的感觉。</p><p id="49d7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">正如我们在标记化步骤中看到的，将音符转换成标记并不是一对一的映射。这意味着令牌的位置与它在时间上的实际位置不一致。</p><pre class="mf mg mh mi gt ni nj nk nl aw nm bi"><span id="4c14" class="mr lc iq nj b gy nn no l np nq"><em class="la">item.to_text()<br/></em><strong class="nj ir">Token:  xxbos xxpad n60 d4 n52 d8 n45 d8 xxsep d4 n62 d4</strong></span><span id="ce97" class="mr lc iq nj b gy nr no l np nq"><em class="la">list(range(len(item.data)))</em><br/><strong class="nj ir">Index:   0,    1,    2,  3, 4,  5, 6,  7, 8,    9, 10, 11</strong></span><span id="32b1" class="mr lc iq nj b gy nr no l np nq"><em class="la">item.position//4</em><br/><strong class="nj ir">Beat:    0,    0,    1,  1, 1,  1, 1,  1, 1,    1, 2,  2</strong></span></pre><p id="db29" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在<em class="la">索引</em> 7 的<strong class="jp ir">代币实际上是在<em class="la">节拍</em> 1 上打出的。</strong></p><p id="b3f7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果我们将“节拍”元数据和令牌一起发送给我们的模型，它将包含更多的上下文信息。它不再需要自己计算音乐的节奏。</p><h2 id="9b96" class="mr lc iq bd ld ms mt dn lh mu mv dp ll jy mw mx lp kc my mz lt kg na nb lx nc bi translated"><strong class="ak">老师逼问</strong></h2><blockquote class="ny nz oa"><p id="e090" class="jn jo la jp b jq jr js jt ju jv jw jx ob jz ka kb oc kd ke kf od kh ki kj kk ij bi translated">第 4 行:config[' <strong class="jp ir"> mask_steps </strong> '] = 4</p></blockquote><p id="9c24" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当训练变形金刚时，你通常应用一个注意力面具来防止模型偷看它应该预测的下一个令牌。</p><pre class="mf mg mh mi gt ni nj nk nl aw nm bi"><span id="4d22" class="mr lc iq nj b gy nn no l np nq"><em class="la">lm_mask(x_len=10, device=None)               # 10 = bptt</em></span><span id="5b7f" class="mr lc iq nj b gy nr no l np nq">tensor([[[[0, 1, 1, 1, 1, 1, 1, 1, 1, 1],    # Can only see itself<br/>          [0, 0, 1, 1, 1, 1, 1, 1, 1, 1],<br/>          [0, 0, 0, 1, 1, 1, 1, 1, 1, 1],<br/>          [0, 0, 0, 0, 1, 1, 1, 1, 1, 1],<br/>          [0, 0, 0, 0, 0, 1, 1, 1, 1, 1],<br/>          [0, 0, 0, 0, 0, 0, 1, 1, 1, 1],<br/>          [0, 0, 0, 0, 0, 0, 0, 1, 1, 1],<br/>          [0, 0, 0, 0, 0, 0, 0, 0, 1, 1],<br/>          [0, 0, 0, 0, 0, 0, 0, 0, 0, 1],  <br/>          [0, 0, 0, 0, 0, 0, 0, 0, 0, 0]]]]) # Can see everything</span><span id="0ccd" class="mr lc iq nj b gy nr no l np nq"><strong class="nj ir"># 0 = Can see token </strong><br/><strong class="nj ir"># 1 = Can't see token</strong></span></pre><p id="36cc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="la">每一行代表一个时间步长，它可以看到或看不到哪些标记。</em></p><p id="54d1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">除了屏蔽未来的标记，您还可以屏蔽之前的几个标记。这迫使模型提前预测几个步骤，并在理想情况下产生一个更一般化的模型。</p><pre class="mf mg mh mi gt ni nj nk nl aw nm bi"><span id="3056" class="mr lc iq nj b gy nn no l np nq"><em class="la">window_mask(10, None, size=(2,0))           # Window size of 2</em></span><span id="55dc" class="mr lc iq nj b gy nr no l np nq">tensor([[[[0, 1, 1, 1, 1, 1, 1, 1, 1, 1],   # Only sees itself<br/>          [0, 1, 1, 1, 1, 1, 1, 1, 1, 1],   # Only sees the previou<br/>          [0, 0, 1, 1, 1, 1, 1, 1, 1, 1],<br/>          [0, 0, 1, 1, 1, 1, 1, 1, 1, 1],<br/>          [0, 0, 0, 0, 1, 1, 1, 1, 1, 1],<br/>          [0, 0, 0, 0, 1, 1, 1, 1, 1, 1],<br/>          [0, 0, 0, 0, 0, 0, 1, 1, 1, 1],<br/>          [0, 0, 0, 0, 0, 0, 1, 1, 1, 1],<br/>          [0, 0, 0, 0, 0, 0, 0, 0, 1, 1],<br/>          [0, 0, 0, 0, 0, 0, 0, 0, 1, 1]]]])# Can't see final 2</span></pre><p id="8f34" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">把这个想成是一个反转的“老师逼”。</p><h2 id="0f1a" class="mr lc iq bd ld ms mt dn lh mu mv dp ll jy mw mx lp kc my mz lt kg na nb lx nc bi translated">变压器架构</h2><blockquote class="ny nz oa"><p id="a3d2" class="jn jo la jp b jq jr js jt ju jv jw jx ob jz ka kb oc kd ke kf od kh ki kj kk ij bi translated">第 6 行:model = get _ language _ model(arch =<strong class="jp ir">MusicTransformerXL</strong>…)</p></blockquote><p id="b501" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://ai.googleblog.com/2019/01/transformer-xl-unleashing-potential-of.html" rel="noopener ugc nofollow" target="_blank"> TransformerXL </a>是一种特定风味的变压器型号。它具有相对位置编码和隐藏状态记忆功能。</p><p id="d208" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">变压器内存</strong>实现超快速推理。不必在每次预测时都重新评估整个序列，您只需要评估最后一个预测的标记。先前的令牌已经存储在存储器中</p><p id="d879" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">相对位置— </strong>普通变压器仅使用绝对位置。对于音乐模型来说，知道每个记号<em class="la">相对于另一个</em>的位置非常重要。<em class="la">这是对我们的位置节拍编码</em>的补充</p><h2 id="90c9" class="mr lc iq bd ld ms mt dn lh mu mv dp ll jy mw mx lp kc my mz lt kg na nb lx nc bi translated">训练循环</h2><blockquote class="ny nz oa"><p id="043e" class="jn jo la jp b jq jr js jt ju jv jw jx ob jz ka kb oc kd ke kf od kh ki kj kk ij bi translated">learn.to_fp16(dynamic=True，clip = 0.5)；<br/> learn.fit_one_cycle(4)</p></blockquote><p id="a8bc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">fastai 库免费提供训练代码。我就不赘述了，但是混合精度，一个周期，多 GPU 训练会节省你很多时间。</p><h2 id="3897" class="mr lc iq bd ld ms mt dn lh mu mv dp ll jy mw mx lp kc my mz lt kg na nb lx nc bi translated">结束了。</h2><p id="2009" class="pw-post-body-paragraph jn jo iq jp b jq lz js jt ju ma jw jx jy mb ka kb kc mc ke kf kg md ki kj kk ij bi translated">咻！现在你知道了我所知道的关于音乐变形金刚的一切。现在我们可以在这个概念的基础上创造一个更酷的音乐模型——多任务变压器。</p><p id="4b11" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://medium.com/@andrew.t.shaw/a-multitask-music-model-with-bert-transformer-xl-and-seq2seq-3d80bd2ea08e" rel="noopener"> <strong class="jp ir">第三部分。构建一个多任务音乐模型</strong></a><em class="la"/>——<em class="la">一个增强的 MusicTransformer。它可以和声，产生旋律，并混音歌曲。</em></p><p id="dd4c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://medium.com/@andrew.t.shaw/how-to-remix-the-chainsmokers-with-a-music-bot-6b920359248c" rel="noopener"> <strong class="jp ir">第四部分。用一个音乐机器人重新混合烟雾弹</strong></a>——<em class="la">用音乐机器人重新混合艾伯顿的一个 EDM drop。纯娱乐目的而已。</em></p><h1 id="882e" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated"><em class="oi">感谢阅读！</em></h1><blockquote class="ny nz oa"><p id="7000" class="jn jo la jp b jq jr js jt ju jv jw jx ob jz ka kb oc kd ke kf od kh ki kj kk ij bi translated">特别感谢<a class="ae kl" href="https://www.thehim.com/" rel="noopener ugc nofollow" target="_blank">耶鲁安·克斯滕</a>和<a class="ae kl" href="https://www.fast.ai/" rel="noopener ugc nofollow" target="_blank">杰瑞米·霍华德</a>的指导，<a class="ae kl" href="https://medium.com/@southparkcommons" rel="noopener">南方公园公地</a>和<a class="ae kl" href="https://www.palapavc.com/" rel="noopener ugc nofollow" target="_blank">帕拉帕维克</a>的支持。</p></blockquote></div></div>    
</body>
</html>