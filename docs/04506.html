<html>
<head>
<title>Implementing time series ARIMA</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">实施时间序列 ARIMA</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/implementing-time-series-arima-38fd77fc1d79?source=collection_archive---------16-----------------------#2019-07-11">https://towardsdatascience.com/implementing-time-series-arima-38fd77fc1d79?source=collection_archive---------16-----------------------#2019-07-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="e8c5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们听说过很多时间序列分析中基于 ARIMA 的模型，这是一种用于预测各种时间序列数据的流行工具。也就是说，不建议在不了解数据及其潜在趋势的情况下盲目使用 ARIMA 模型。</p><p id="e1a7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">本文讨论 ARIMA 及其一般应用。ARIMA 是非季节性的，萨里玛具有季节性。SARIMA 扩展了 ARIMA 模型的适用性:它在建模和预测中包括了数据的季节性。但是等等，什么是 ARIMA 呢？</p><p id="d85a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">ARIMA 阿玛简介:</strong></p><p id="3dd8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当数据已经稳定时，使用 ARMA(即自回归移动平均模型)。</p><p id="6cff" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当数据不稳定且具有趋势成分时，使用 ARIMA(即，与移动平均模型集成的自回归)。因为有一个差分组件(d)将数据转换为静态数据，然后应用其他顺序。(p，q)</p><p id="aea1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">p:自动回归项的阶数(时间步长滞后的数量)</p><p id="9f8e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">问:移动平均项的顺序</p><p id="5d18" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">d:获得平稳性的差分阶</p><p id="0284" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">本文不包括应用每种方法的统计描述；它只是涵盖了我们如何在 python 中应用 ARIMA 和萨里玛模型，并对其有一个大致的了解。因此，让我们一步一步地将这些模型与我们的数据相匹配。</p><p id="6aed" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">分步骤实施 ARIMA 的一般方法:</strong></p><p id="35de" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">第一步</strong>:加载数据集，绘制源数据。(检查数据是否有任何季节性模式、周期性模式、一般趋势)</p><ul class=""><li id="b393" class="ko kp it js b jt ju jx jy kb kq kf kr kj ks kn kt ku kv kw bi translated">处理缺失值:ARIMA 模型不适用于有 NAs 的数据。</li></ul><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi kx"><img src="../Images/431d8adf6dd097b25329ba93360eb672.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q17ScG1tc-TU6R7VSTfrqQ.png"/></div></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk">Plotting the data*</figcaption></figure><p id="d48d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">步骤 2 </strong>:应用扩展的 Dickey Fuller 检验(以确认数据的平稳性)</p><p id="c06f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">实现:adfuller()</p><ul class=""><li id="fdb8" class="ko kp it js b jt ju jx jy kb kq kf kr kj ks kn kt ku kv kw bi translated">如果数据是平稳的，则进行 ARMA 或 ARIMA。(这是你的选择！)</li><li id="101f" class="ko kp it js b jt ln jx lo kb lp kf lq kj lr kn kt ku kv kw bi translated">如果数据不是稳定的，继续 ARIMA。(因为，需要对数据进行差分以使其稳定:ARIMA 的“I”组件就是这样做的)</li></ul><p id="f94b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">步骤 3 </strong>:对数据进行 ETS 分解(检查数据的季节性)</p><p id="5abb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">实现:季节性分解()</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div class="gh gi ls"><img src="../Images/d6b557d2902209594d0a2b58ee8a1e36.png" data-original-src="https://miro.medium.com/v2/resize:fit:848/format:webp/1*WOfR8zNpjkussPMyf7DiPQ.png"/></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk">Seasonal Decomposition components</figcaption></figure><ul class=""><li id="95e7" class="ko kp it js b jt ju jx jy kb kq kf kr kj ks kn kt ku kv kw bi translated">如果季节性与趋势成分相比很小，我们就不需要考虑它。在这种情况下，我们可以采用非季节性 ARIMA 模型。例如，在上面的示例图中，与趋势成分范围相比，季节性范围非常小。</li></ul><figure class="ky kz la lb gt lc gh gi paragraph-image"><div class="gh gi lt"><img src="../Images/ca0d04a232ecd39900d8b2920de1f872.png" data-original-src="https://miro.medium.com/v2/resize:fit:792/format:webp/1*YYUUFEAE1jjDqUQfvWQXSA.png"/></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk">ACF Plot</figcaption></figure><p id="5b91" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">ACF -可用于确定毫安顺序(q)。</p><p id="064e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">PACF -可用于确定 AR 顺序(p)。</p><ul class=""><li id="426b" class="ko kp it js b jt ju jx jy kb kq kf kr kj ks kn kt ku kv kw bi translated">同样，如果数据中的季节性很明显，则使用季节性 ARIMA 或萨里玛。</li></ul><figure class="ky kz la lb gt lc gh gi paragraph-image"><div class="gh gi lu"><img src="../Images/c5f9c72c561610943c1ff22a9aa81405.png" data-original-src="https://miro.medium.com/v2/resize:fit:822/format:webp/1*aDEw8sxmCfam7sopvC_L0Q.png"/></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk">PACF plot</figcaption></figure><p id="38ef" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">上述 ACF 和 PACF 图解释如下:ACF-MA 的顺序取为“1”，因为只有第 1 点(实际上是第 0 点和第 1 点)位于 95%置信区间(阴影区域)之外。PACF-AR 的顺序取为“1 ”,因为在第一个点之后值会急剧下降。</p><p id="6bf6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">通常情况下，这些情节并不像我们在上面的例子中那样容易理解。这就是为什么我们使用 auto_arima()来确定订单。</p><p id="99c5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">步骤 4 </strong>:使用自动金字塔 ARIMA 方法确定 ARIMA 的订单(P，D，Q)和萨里玛的订单(P，D，Q，P，D，Q)。(自动型号选择)</p><p id="04ea" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">实现:auto_arima()</p><p id="fbe2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这些系数也可以通过查看 ACF/PACF 图(自相关/部分自相关图)来确定。使用这种技术通常很难确定顺序，而使用 auto_arima()则更好。</p><p id="2e8f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">auto_arima()使用 p、d、q 值的不同组合运行不同的 arima(或 SARIMA)模型，并使用 AIC 和 BIC 指标比较它们的性能。</p><p id="50eb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">AIC 和 BIC 是如何工作的:这个度量标准的优点是，它提供了为防止过度拟合而使用的参数数量的惩罚。假设您有一个性能相对较好的简单模型和一个性能略好于前一个模型的复杂模型。如果这两个模型之间有微小的性能改进，那么 AIC 会考虑这一点，并告诉你选择简单的模型，而不是复杂的模型。在这种情况下，复杂模型将比简单模型具有更低的信息标准值。在某种程度上，AIC 惩罚了使用太多参数的模型。</p><p id="d98a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">此外，我们可以通过对我们的数据再次应用 Dickey Fuller 测试来验证 auto_arima()获得的“d”顺序。</p><p id="ba8a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">步骤 5 </strong> : <em class="lv">将数据集分割成训练集和测试集。</em>一旦我们应用了 auto_arima()，我们就获得了一组(p，d，q)订单，我们可以将这些订单直接分配给我们的 arima 模型。但是在拟合模型之前，我们首先要拆分数据。</p><ul class=""><li id="74fd" class="ko kp it js b jt ju jx jy kb kq kf kr kj ks kn kt ku kv kw bi translated">在时间序列建模中，我们通常认为分割数据的百分比为 70:30(训练:测试)。但我们必须注意，测试数据的大小必须等于预测期。例如，如果我们想预测未来 6 个月的情况，那么我们必须至少采用<em class="lv">6 个月的测试数据量。</em></li><li id="a5ee" class="ko kp it js b jt ln jx lo kb lp kf lq kj lr kn kt ku kv kw bi translated">另一个需要注意的要点是，我们<em class="lv">不需要</em>对数据进行采样来进行时间序列预测。这是因为在时间序列中，新值比旧值具有更大的权重。</li></ul><p id="8c41" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">第六步</strong> : <em class="lv">拟合 ARIMA 模型</em>。将步骤 4 中获得的 p、d、q 系数值分配给该模型。</p><p id="dd7c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">执行:ARIMA()</p><p id="0e07" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">步骤 7 </strong> : <em class="lv">根据测试数据测试模型拟合。</em></p><ul class=""><li id="e7d1" class="ko kp it js b jt ju jx jy kb kq kf kr kj ks kn kt ku kv kw bi translated">预测测试值。</li></ul><p id="c6e6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">实现:预测()</p><ul class=""><li id="ac87" class="ko kp it js b jt ju jx jy kb kq kf kr kj ks kn kt ku kv kw bi translated">将预测值与实际测试值进行比较。(绘制两个图表，并使用误差指标(如 MSE、RMSE)来衡量模型性能。)</li></ul><p id="9eef" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">第 8 步</strong>:根据完整数据重新训练模型</p><p id="093a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们需要用整个数据来拟合模型。这样做是为了将最近的值和旧的值纳入我们的建模过程。此外，较新的值具有较高的权重。因此，我们必须在整个数据集上重新训练模型。</p><p id="fe2a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">第九步</strong>:预测未来！</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi kx"><img src="../Images/3f82fb636ff1dede8283ea29a7b2b9f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kSECPYqTNtEKW39PSWBz0w.png"/></div></div></figure><p id="83c1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如前所述，预测周期必须等于或小于测试数据的大小。</p><p id="0fbb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">实现:预测()</p><p id="5928" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">(很少有时间序列模型使用 forecast()来预测未来，也很少有像 ARIMA 这样的模型使用 predict()来预测未来)</p><p id="61a8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">此外，绘制数据及其预测。</p><p id="b365" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">萨里玛:</strong>季节性 ARIMA 模型有一组额外的参数(P，D，Q)</p><p id="85d9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">p:季节性 AR 条款的顺序</p><p id="e378" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">d:达到平稳性的差分阶</p><p id="290c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">问:季节 MA 术语的顺序</p><p id="f905" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">萨里玛的实施与 ARIMA 相似。除了在步骤 4 中，我们获得 3 个值:ARIMA 的 P，D，Q，这里，我们获得 6 个值:萨里玛的 P，D，Q，P，D，Q。我们应用 SARIMA()进行模型拟合，并继续进行与 ARIMA 相同的过程。</p><p id="a51f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">感谢您阅读本文！</p></div></div>    
</body>
</html>