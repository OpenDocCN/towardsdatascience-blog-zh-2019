<html>
<head>
<title>In R Shiny, when is an error really an error?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在 R Shiny 中，什么时候一个错误才是真正的错误？</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/in-r-shiny-when-is-an-error-really-an-error-702205ebb5d5?source=collection_archive---------18-----------------------#2019-01-25">https://towardsdatascience.com/in-r-shiny-when-is-an-error-really-an-error-702205ebb5d5?source=collection_archive---------18-----------------------#2019-01-25</a></blockquote><div><div class="fc ij ik il im in"/><div class="io ip iq ir is"><div class=""/><div class=""><h2 id="076a" class="pw-subtitle-paragraph js iu iv bd b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj dk translated">如何测试你的服务器端输出并阻止不必要的红色死亡错误信息出现在你的用户界面上</h2></div><p id="6f26" class="pw-post-body-paragraph kk kl iv km b kn ko jw kp kq kr jz ks kt ku kv kw kx ky kz la lb lc ld le lf io bi translated">对于 R 用户和整个世界来说，R Shiny 是一个真正的超级礼物。本质上，它允许你以一种用户友好的方式向他人公开你的代码，这意味着非 R-coder 可以利用你开发的功能。</p><p id="60a2" class="pw-post-body-paragraph kk kl iv km b kn ko jw kp kq kr jz ks kt ku kv kw kx ky kz la lb lc ld le lf io bi translated">但是当 R 的红色死亡错误消息从服务器端流过并出现在不必要的用户界面时，它看起来会有点不专业和“不整洁”。例如，这对最终用户来说非常糟糕:</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi lg"><img src="../Images/3253c4f24468e779a42cc0c0e66bdd01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1292/format:webp/1*IF4upkKTFyw7Hg1flSFCJw.png"/></div></div></figure><p id="4776" class="pw-post-body-paragraph kk kl iv km b kn ko jw kp kq kr jz ks kt ku kv kw kx ky kz la lb lc ld le lf io bi translated">有两种方法可以轻松改善最终用户体验，并避免用户向您反映并非真正错误的错误，而只是用户输入选择的结果。</p><p id="6463" class="pw-post-body-paragraph kk kl iv km b kn ko jw kp kq kr jz ks kt ku kv kw kx ky kz la lb lc ld le lf io bi translated">假设您创建了一个应用程序，该应用程序根据某些用户输入过滤一个数据集，然后对过滤后的数据进行一些统计。</p><p id="b50b" class="pw-post-body-paragraph kk kl iv km b kn ko jw kp kq kr jz ks kt ku kv kw kx ky kz la lb lc ld le lf io bi translated">假设在服务器端创建了一个用于计算统计数据的反应式过滤数据帧，我们称之为<code class="fe ls lt lu lv b">filtered_df()</code>。一种常见的可能性是用户选择了太多的过滤器，以至于在<code class="fe ls lt lu lv b">filtered_df()</code>中没有留下任何数据，事实上它是一个没有任何行的数据帧。</p><h2 id="c11d" class="lw lx iv bd ly lz ma dn mb mc md dp me kt mf mg mh kx mi mj mk lb ml mm mn mo bi translated"><strong class="ak">选项 1 —编写特定的错误信息</strong></h2><p id="aafc" class="pw-post-body-paragraph kk kl iv km b kn mp jw kp kq mq jz ks kt mr kv kw kx ms kz la lb mt ld le lf io bi translated">如何处理这个问题的一个选择是使用<code class="fe ls lt lu lv b">stop()</code>函数为这个事件写一个特定的错误消息。例如，您可以这样做:</p><pre class="lh li lj lk gt mu lv mv mw aw mx bi"><span id="993a" class="lw lx iv lv b gy my mz l na nb">checked_filtered_df &lt;- shiny::reactive({<br/>  <br/>  if (nrow(filtered_df()) == 0) {<br/>    stop("No data available for chosen filters!")<br/>  } else {  <br/>    filtered_df()<br/>  }</span><span id="1979" class="lw lx iv lv b gy nc mz l na nb">})</span></pre><p id="acbb" class="pw-post-body-paragraph kk kl iv km b kn ko jw kp kq kr jz ks kt ku kv kw kx ky kz la lb lc ld le lf io bi translated">在用户过滤掉所有数据的情况下，这将返回一个红色的错误消息，就像上面的一样，除了它将包含特定的语言“错误:没有可用于所选过滤器的数据！”。这稍微好了一点，但在我看来，对最终用户来说还是很糟糕。另外，这真的是一个错误吗？我不这么认为——你的代码实际上没有任何问题。我不是这样使用<code class="fe ls lt lu lv b">stop()</code>的粉丝。</p><h2 id="b4e3" class="lw lx iv bd ly lz ma dn mb mc md dp me kt mf mg mh kx mi mj mk lb ml mm mn mo bi translated">选项 2——使用 Shiny 强大的验证功能</h2><p id="28eb" class="pw-post-body-paragraph kk kl iv km b kn mp jw kp kq mq jz ks kt mr kv kw kx ms kz la lb mt ld le lf io bi translated">闪亮的<code class="fe ls lt lu lv b">validate()</code>功能非常适合这种情况。它可以对您的服务器输出执行测试，您可以告诉它在测试失败时显示什么。它用不那么可怕的灰色文本显示，重要的是，它不称之为错误。</p><p id="55e0" class="pw-post-body-paragraph kk kl iv km b kn ko jw kp kq kr jz ks kt ku kv kw kx ky kz la lb lc ld le lf io bi translated">在<code class="fe ls lt lu lv b">validate()</code>中，您可以使用<code class="fe ls lt lu lv b">need()</code>功能设置测试标准，并编写一条消息，在测试失败时显示。重写上面的代码以使用<code class="fe ls lt lu lv b">validate()</code>而不是<code class="fe ls lt lu lv b">stop()</code>看起来像这样:</p><pre class="lh li lj lk gt mu lv mv mw aw mx bi"><span id="7aff" class="lw lx iv lv b gy my mz l na nb">checked_filtered_df &lt;- shiny::reactive({</span><span id="8169" class="lw lx iv lv b gy nc mz l na nb">  shiny::validate(<br/>    shiny::need(nrow(filtered_df()) != 0, <br/>         "No data available for chosen filters!")<br/>  )</span><span id="3775" class="lw lx iv lv b gy nc mz l na nb">  filtered_df()</span><span id="be71" class="lw lx iv lv b gy nc mz l na nb">})</span></pre><p id="3256" class="pw-post-body-paragraph kk kl iv km b kn ko jw kp kq kr jz ks kt ku kv kw kx ky kz la lb lc ld le lf io bi translated">现在，当用户向下筛选到一个空数据集时，UI 中将出现以下内容:</p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/fb82e8b9fcc8bb069401a842ace23cf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:522/format:webp/1*NFTa_2tzrRycDR18MCw83Q.png"/></div></figure><p id="9e07" class="pw-post-body-paragraph kk kl iv km b kn ko jw kp kq kr jz ks kt ku kv kw kx ky kz la lb lc ld le lf io bi translated">这就不那么令人担忧了，而且对于最终用户来说，他们已经将数据集过滤得一无所有，这一点也更清楚了。</p><p id="9d38" class="pw-post-body-paragraph kk kl iv km b kn ko jw kp kq kr jz ks kt ku kv kw kx ky kz la lb lc ld le lf io bi translated">如果你以前没有在 Shiny 中做过类似的事情，那么这是值得进一步研究的。随着每个新版本的发布，Shiny 包含了越来越多的方法来平滑用户界面和控制预期的问题。这里有更多关于<code class="fe ls lt lu lv b">validate()</code> <a class="ae ne" href="https://shiny.rstudio.com/articles/validation.html" rel="noopener ugc nofollow" target="_blank">的技术细节</a>。</p><p id="18f9" class="pw-post-body-paragraph kk kl iv km b kn ko jw kp kq kr jz ks kt ku kv kw kx ky kz la lb lc ld le lf io bi translated">最初我是一名纯粹的数学家，后来我成为了一名心理计量学家和数据科学家。我热衷于将所有这些学科的严谨性应用到复杂的人的问题上。我也是一个编码极客和日本 RPG 的超级粉丝。在 <a class="ae ne" href="https://www.linkedin.com/in/keith-mcnulty/" rel="noopener ugc nofollow" target="_blank"> <em class="nf"> LinkedIn </em> </a> <em class="nf">或</em><a class="ae ne" href="https://twitter.com/dr_keithmcnulty" rel="noopener ugc nofollow" target="_blank"><em class="nf">Twitter</em></a><em class="nf">上找我。</em></p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="gh gi ng"><img src="../Images/05b70068be352def1937381f7690ca20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WIZCKgkdAv6nOzGR_btRgg.jpeg"/></div></div></figure></div></div>    
</body>
</html>