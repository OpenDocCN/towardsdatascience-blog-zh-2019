# 关注混杂因素:计算偏相关矩阵的演练

> 原文：<https://towardsdatascience.com/keeping-an-eye-on-confounds-a-walk-through-for-calculating-a-partial-correlation-matrix-2ac6b831c5b6?source=collection_archive---------15----------------------->

## 一个 R 演示程序，演示了计算部分相关矩阵的两种方法

![](img/34b1348ea19da4e44337f581d85e50fc.png)

Don’t forget about potential confounding variables! Photo from [Wikimedia Commons](https://commons.wikimedia.org/wiki/File:Partial_correlation.svg)

分析师在数据管理/预处理后执行的最常见步骤之一是运行相关性分析，以标准化的方式检查变量之间的成对关联。这是一种快速且相当轻松的方式来感受您的数据。然而，如果在您的数据集中潜伏着与两个感兴趣的变量相关的其他混淆变量，那么孤立地查看两个变量之间的关系可能会产生误导。

因此，在某些情况下，计算偏相关矩阵可能是更好的选择。这种矩阵将允许人们快速测量和观察 2 个变量之间的关联，同时控制数据集中的所有其他变量。下面，我们将从头开始讨论计算部分相关矩阵的两种方法，并说明如何使用“ppcor”软件包。

对于这个示例，我们将使用空气质量数据集的一部分，该数据集包含 1973 年部分时间内纽约每日空气质量水平的信息。

![](img/cf1709de8a023e319cddc84a3794eb42.png)

Manhattan in 1970\. Photo from [Wikimedia Commons](https://commons.wikimedia.org/wiki/File:Manhattan,_New_York,_1970,_view_from_Hudson_River_-_panoramio.jpg)

![](img/cdd91ca6675ee27e489ed6c17c0df21c.png)

Overview of the “airquality” data set

首先，我们将运行相关性分析来检查这些质量度量之间的关系。谈到一些结果，我们可以看到较高水平的臭氧与气温上升有关，而较高的风速与较低水平的臭氧有关。风和太阳辐射几乎相互垂直。

我们可以使用“corrplot”包改进可视化。

![](img/22170c130eb9c10a865cf7f5ed608dcb.png)

现在我们已经看了相关结构，让我们继续计算一个*部分相关*矩阵。这里的想法与运行多元线性回归并试图“控制”其他混杂变量(如 X2 和 X3)的想法相同，同时查看感兴趣的预测变量 X1 对结果变量 y 的影响。偏相关矩阵的好处是可以在标准化矩阵中获得所有这些关联，以便于查看。

我们将介绍的计算偏相关矩阵的第一种方法是求解一系列(等于数据集中变量的数量)两个相关的线性回归模型。我们从这些结果模型中提取残差，并计算它们之间的相关性。为了澄清，让我们说，我们要计算臭氧和太阳之间的部分相关性。

我们有两个模型:
1)模型 1:臭氧~风+温度
2)模型 2:太阳能。风+温度

并对残差进行相关以计算偏相关，结果为 0.242。

我们将概括这一点，在下面的空气质量数据集中以成对的方式找到偏相关。

我们可以并排查看相关矩阵和部分相关矩阵，以了解系数是如何变化的。考虑到我们在“控制”数据集中的其他变量，所有系数的大小都有所降低，这并不奇怪。这种减少在某些情况下更加明显。例如，温度和风之间的相关性是-.5。温度和风之间的偏相关，考虑到了太阳。r 和臭氧，只有 0.13。

![](img/88ed841acdd219eb03cd9ab8be53535f.png)

我们要研究的第二种计算偏相关的方法使用矩阵代数，而且更简洁。

从相关矩阵 *R* 开始，我们首先需要找到反镜像协方差矩阵 *AICOV* 。为了找到 *AICOV* ，我们需要 *D* ，即 *R* 的逆的对角元素的逆。有了 *D* ，我们可以计算出 *AICOV* 如下: *AICOV* = *DR⁻ D* 。

利用 *AICOV* 矩阵，我们可以计算反图像相关矩阵 *AICOR。*这里， *D* 等于 *AICOV* 的对角线，平方根，求逆。 *AICOR* = *D / AICOV D /。*

在 *AICOR* 的对角线上是负的部分相关值。我们可以将一个负数乘以 *AICOR* 的非对角元素，得到偏相关矩阵。下面是一个函数，它可以接受数据集或相关矩阵，并返回部分相关矩阵。

最后，为了确保所有之前的计算都是正确的，我们
可以使用“ppcor”包和“pcor”函数来轻松计算
偏相关系数，并获得用于显著性
测试的指标。

在本演示中，我们查看了从头开始计算偏相关的两种不同方法，并观察了在考虑数据集中的其他变量时，系数(之前在相关中观察到的)会发生怎样的剧烈变化。

希望这是有用的，如果合适的话，你可以在查看数据时检查偏相关！