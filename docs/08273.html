<html>
<head>
<title>From Dev to Prod - All you need to know to get your Flask application running on AWS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从开发到生产——让 Flask 应用程序在 AWS 上运行所需要知道的一切</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/from-dev-to-prod-all-you-need-to-know-to-get-your-flask-application-running-on-aws-ecedd4eec55?source=collection_archive---------24-----------------------#2019-11-11">https://towardsdatascience.com/from-dev-to-prod-all-you-need-to-know-to-get-your-flask-application-running-on-aws-ecedd4eec55?source=collection_archive---------24-----------------------#2019-11-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a0af" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">获得正确的配置，确保它是安全的，确保通过端点访问资源，并有一个漂亮的渲染，…所有这些都是因为 AWS 而变得容易！</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/938d11579378016d5908204df03827a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1154/format:webp/1*S34FdX34WBqruwNFbejL0Q.jpeg"/></div></figure><p id="7d00" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi lm translated">作为一名机器学习工程师，我从未真正面临过把我的算法发布出去的问题。嗯，直到最近，当我决定开始我的多重创业之旅…不幸的是，当你开始时，你没有 DevOps 或软件工程团队。这些人对客户使用这些服务的世界很有经验，他们知道如何跨越最后一步，让你的产品从零到一。</p><p id="dfc3" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">现在，我不得不花几个小时阅读教程和文档来学习基础知识，最后，将我自己的算法作为全球可用的独立容器化服务。出于可复制性的明显原因，我对这些步骤进行了模板化，我非常乐意与您分享这些模板！:)【模板托管<a class="ae lv" href="https://github.com/Coricos/Challenger/tree/master/templates/beanstalk" rel="noopener ugc nofollow" target="_blank">这里</a>。]</p><h1 id="9e91" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">准备战场！</h1><p id="7910" class="pw-post-body-paragraph kq kr it ks b kt mo ju kv kw mp jx ky kz mq lb lc ld mr lf lg lh ms lj lk ll im bi lm translated">他的初始化步骤至关重要，取决于你的实践。在这里，我揭露了我做这件事的方式，但是你可以自由地创新。到目前为止，我唯一的假设是，你有一个适当的 AWS 帐户，并且你知道如何在服务之间导航！</p><ul class=""><li id="878a" class="mt mu it ks b kt ku kw kx kz mv ld mw lh mx ll my mz na nb bi translated">安装并配置 AWS CLI: <a class="ae lv" href="https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-configure.html" rel="noopener ugc nofollow" target="_blank"> AWS 教程</a>。</li><li id="9b4b" class="mt mu it ks b kt nc kw nd kz ne ld nf lh ng ll my mz na nb bi translated">安装并配置 AWS Elastic Beanstalk CLI: <a class="ae lv" href="https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/eb-cli3-install-advanced.html" rel="noopener ugc nofollow" target="_blank"> AWS 教程</a>。</li><li id="6d5c" class="mt mu it ks b kt nc kw nd kz ne ld nf lh ng ll my mz na nb bi translated">下载模板:您目前有三种选择:您可以从<a class="ae lv" href="https://github.com/Coricos/Challenger/tree/master/templates/beanstalk" rel="noopener ugc nofollow" target="_blank">文件夹</a>模板中单独下载每个文件；您可以克隆 project <a class="ae lv" href="https://github.com/Coricos/Challenger" rel="noopener ugc nofollow" target="_blank"> Challenger </a>的整个存储库，这是我存放模板的地方；您可以使用 subversion 通过以下命令下载特定的文件夹:</li></ul><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="f3ed" class="nm lx it ni b gy nn no l np nq">sudo apt install subversion<br/>svn checkout <a class="ae lv" href="https://github.com/Coricos/Challenger/trunk/templates/beanstalk" rel="noopener ugc nofollow" target="_blank">https://github.com/Coricos/Challenger/trunk/templates/beanstalk</a></span></pre><ul class=""><li id="5670" class="mt mu it ks b kt ku kw kx kz mv ld mw lh mx ll my mz na nb bi translated">定义您的开发环境:</li></ul><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="40f2" class="nm lx it ni b gy nn no l np nq">virtualenv -p python3 beanstalk<br/>cd beanstalk<br/>source bin/activate<br/>pip install -r requirements.txt</span></pre><ul class=""><li id="ed8c" class="mt mu it ks b kt ku kw kx kz mv ld mw lh mx ll my mz na nb bi translated">在<code class="fe nr ns nt ni b">application.py</code>中构建您的 flask 服务器！首先在您的本地机器上试一试，检查一下一切都运行正常，并确保将服务器启动封装在<code class="fe nr ns nt ni b">__main__</code>中。另外，这是 AWS 的特定要求，但是您的应用程序的名称应该明确为<code class="fe nr ns nt ni b">application</code> …</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/c177190139b2eb2fa14b83f5c2471d73.png" data-original-src="https://miro.medium.com/v2/resize:fit:1152/format:webp/1*0bDmrO7Ff9YnCSPy0UGRQA.jpeg"/></div></figure><h1 id="9e9b" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">有用！现在怎么办？</h1><p id="e2c7" class="pw-post-body-paragraph kq kr it ks b kt mo ju kv kw mp jx ky kz mq lb lc ld mr lf lg lh ms lj lk ll im bi lm translated"><span class="l ln lo lp bm lq lr ls lt lu di"> B </span>因为我发现<strong class="ks iu"> AWS Elastic Beanstalk </strong>是运行我的应用程序的最佳服务，我天生就愿意展示它。为什么？主要是因为在 beanstalk 实例上运行的内容可以在任何其他类似的服务和云提供商上产生。这给了您无限的灵活性(我甚至没有说使用 Docker 来获得更好的可部署性)。</p><p id="a377" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">该服务由一个运行在 EC2 实例上的基本容器组成，该容器链接到一个 S3 存储桶。在我们的例子中，应用程序本身不需要大量的计算能力(到目前为止我们没有谈到深度学习)，所以我们将选择<em class="nv"> t2.micro </em>实例(单个虚拟内核和 4gb RAM)。从那以后，它将只与配置有关，因为 AWS 使我们的生活更容易:您不必考虑子网、安全组、VPC、IP 网关、NAT 这是在您生成实例时自动创建和定义的。尽管如此，对于那些需要控制它们的人(在 VPC 工作或使用 RDS)，你可以通过<code class="fe nr ns nt ni b">.ebextensions</code>文件夹中的<code class="fe nr ns nt ni b">security.config</code>来配置一切。关键配置以<code class="fe nr ns nt ni b">.elasticbeanstalk</code>文件夹中的<code class="fe nr ns nt ni b">config.yml</code>文件结束:</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="7e7b" class="nm lx it ni b gy nn no l np nq">environment-defaults:<br/>  {flask-app}:<br/>    branch: null<br/>    repository: null<br/>global:<br/>  application_name: {my-app}<br/>  default_ec2_keyname: {my-ec2-key}<br/>  default_region: {region}<br/>  profile: {my-profile}<br/>  workspace_type: Application</span></pre><p id="0a69" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">对于配置部分，没有太多事情要做:给应用程序和服务起一个好听的名字(~ environment)；如果需要，定义它的 EC2 键名，否则使用缺省值；选择要在其中生成实例的区域；选择了您的用户配置文件；使用<code class="fe nr ns nt ni b">Application</code>负载平衡器(这是我的建议)。</p><p id="d646" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">从那里，您已经可以访问并可视化您的在线运行的应用程序，使用一个名称，例如<em class="nv"> {flask-app}。{id}。{zone}.aws.com </em>。然而，这缺少了一些东西:信息传输过程中的加密。你可能不是我，但我真的不喜欢使用不使用<strong class="ks iu"> HTTPS </strong>的网站或终端…</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/921aabd9282af31ccb7bdccd58fb43b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1332/format:webp/1*kT6yFJ5HyWQVKuClxx3Hpw.jpeg"/></div></figure><h1 id="042a" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">把公主带到城堡里！</h1><p id="53af" class="pw-post-body-paragraph kq kr it ks b kt mo ju kv kw mp jx ky kz mq lb lc ld mr lf lg lh ms lj lk ll im bi lm translated">不幸的是，没有<strong class="ks iu"> SSL 证书</strong>，您的实例无法使用 HTTPS。通常，人们会使用 OpenSSL，这非常简单，但是在我们的例子中，AWS 通过他们的<strong class="ks iu">证书管理器</strong>服务又一次让它变得简单。如果你想让它更有趣，可以通过 53 号路线服务购买一个域名。然后，您可以使用 AWS 为您的 beanstalk 创建自己的证书，或者与您新获得的域名相关(我向您保证，这样看起来更专业)。现在，必须配置两个对象来重定向请求:一个是<code class="fe nr ns nt ni b">Canonical Name</code>，比如<em class="nv"> {cname}。将您的 EB 实例作为值的域名</em>;一个<code class="fe nr ns nt ni b">Alias</code>，比如{ <em class="nv">别名</em> } <em class="nv">。您的 EB 实例的域名</em>。有了这两张唱片，你就可以上路了！</p><h1 id="a2cc" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">请用 HTTPS！</h1><p id="e866" class="pw-post-body-paragraph kq kr it ks b kt mo ju kv kw mp jx ky kz mq lb lc ld mr lf lg lh ms lj lk ll im bi lm translated">您错过的是信使:HTTPS 请求到您的实例的特定重定向。这个信使被称为<strong class="ks iu">监听器</strong>，有一个简单的配置:将外部世界的 HTTPS 定向到实例上的 HTTP。(可在<code class="fe nr ns nt ni b">listener.config</code>买到！)</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="96f1" class="nm lx it ni b gy nn no l np nq">option_settings:<br/>  aws:elb:listener:443:<br/>    InstancePort: 80<br/>    ListenerEnabled: true<br/>    InstanceProtocol: HTTP<br/>    ListenerProtocol: HTTPS<br/>    SSLCertificateId: {certificate}</span></pre><p id="0b1c" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">但这还不是全部！为了确保您的实例接受 HTTPS，您必须配置服务器:这就是<code class="fe nr ns nt ni b">https.config</code>为您做的！；)</p><h1 id="af1a" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">部署部署部署。</h1><p id="5285" class="pw-post-body-paragraph kq kr it ks b kt mo ju kv kw mp jx ky kz mq lb lc ld mr lf lg lh ms lj lk ll im bi translated">一旦你弄清楚了你的 Flask 应用程序，如何填充所有缺失的配置设置，如何获得你的 SSL 证书，是时候部署了！(不需要初始化，我们已经为此构建了配置文件。)</p><pre class="kj kk kl km gt nh ni nj nk aw nl bi"><span id="218e" class="nm lx it ni b gy nn no l np nq">eb create flask-app</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ny nz di oa bf ob"><div class="gh gi nx"><img src="../Images/c225efea660c9226b4e09141fa5736d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7fBalp8M_JSdeaZy7OlmDA.jpeg"/></div></div></figure><h1 id="99f4" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">想要更多吗？给你！</h1><p id="8204" class="pw-post-body-paragraph kq kr it ks b kt mo ju kv kw mp jx ky kz mq lb lc ld mr lf lg lh ms lj lk ll im bi translated">以下是我不想在之前的教程中介绍的一些内容，但对于接下来的步骤同样重要:</p><ul class=""><li id="503b" class="mt mu it ks b kt ku kw kx kz mv ld mw lh mx ll my mz na nb bi translated">使用<strong class="ks iu">环境变量</strong>！当你在生产环境中工作时，记得要多疑；)我的做法通常是用我的变量填充一个<code class="fe nr ns nt ni b">environment.json</code>文件，并用<code class="fe nr ns nt ni b">deploy-env.sh prod</code>将它们部署在弹性 Beanstalk 实例上。</li><li id="3a0f" class="mt mu it ks b kt nc kw nd kz ne ld nf lh ng ll my mz na nb bi translated">如果您使用<strong class="ks iu">标题</strong>(例如<code class="fe nr ns nt ni b">Flask-JWT</code>)，请确保将<code class="fe nr ns nt ni b">headers.config</code>添加到您的<code class="fe nr ns nt ni b">.ebextensions</code>文件夹中。</li><li id="1d76" class="mt mu it ks b kt nc kw nd kz ne ld nf lh ng ll my mz na nb bi translated">如果你使用<strong class="ks iu"> websockets </strong>(例如<code class="fe nr ns nt ni b">Flask-sockets</code>)，你将不得不使用 Docker 镜像并使用<code class="fe nr ns nt ni b">websocket.config</code>。我可能要为那部分做另一个模板(如果那是你要找的，就同时 ping 我)，因为我花了不止几个小时才弄明白…</li></ul><div class="kj kk kl km gt ab cb"><figure class="oc kn od oe of og oh paragraph-image"><div role="button" tabindex="0" class="ny nz di oa bf ob"><img src="../Images/3b6e787e69c9f98ba7ec2322ca24a8d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1006/format:webp/1*q407ho9NWz9x-6uZQhpL6Q.png"/></div></figure><figure class="oc kn oi oe of og oh paragraph-image"><div role="button" tabindex="0" class="ny nz di oa bf ob"><img src="../Images/279481255bc28d38ae0d499055779c84.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/format:webp/1*StFl7e2mE_YSlnTUF9DPDQ.png"/></div><figcaption class="oj ok gj gh gi ol om bd b be z dk on di oo op">Examples using such Configurations: <a class="ae lv" href="https://www.project-element.com/" rel="noopener ugc nofollow" target="_blank">project-element</a> &amp; <a class="ae lv" href="https://www.project-aster.com/" rel="noopener ugc nofollow" target="_blank">project-aster</a></figcaption></figure></div><p id="65c4" class="pw-post-body-paragraph kq kr it ks b kt ku ju kv kw kx jx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated"><em class="nv">有兴趣保持联系吗？</em>:D<a class="ae lv" href="https://twitter.com/DindinMeryll" rel="noopener ugc nofollow" target="_blank">Twitter</a>|<a class="ae lv" href="https://www.linkedin.com/in/dindin-meryll/" rel="noopener ugc nofollow" target="_blank">LinkedIn</a>|<a class="ae lv" href="https://github.com/Coricos" rel="noopener ugc nofollow" target="_blank">Github</a>|<a class="ae lv" href="https://medium.com/@merylldin" rel="noopener">Medium</a></p></div></div>    
</body>
</html>