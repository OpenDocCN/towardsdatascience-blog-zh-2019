<html>
<head>
<title>Deep Zip: An Open Zipper Detector</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">深拉链:一个打开的拉链探测器</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/deep-zip-83eb78f9963e?source=collection_archive---------14-----------------------#2019-04-21">https://towardsdatascience.com/deep-zip-83eb78f9963e?source=collection_archive---------14-----------------------#2019-04-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="6a98" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">用你手机的磁强计来探测一个打开的传单。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/8f0bd90795d368bd9a46f34687025970.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*O28Cf-3BeuEcqria"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Photo by <a class="ae kv" href="https://unsplash.com/@stairhopper?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Alex Holyoake</a> on <a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="e737" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">拉链:1851 年获得专利，从 20 年代开始被广泛采用，直到今天仍然让我们失望。在这个飞行汽车的时代，科技能帮助我们吗？当你的传单被打开而不应该被打开的时候，除了一个被逗乐的同事之外，我们能得到一个提醒吗？</p><h1 id="624c" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">金属</h1><p id="2615" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">我们信任的智能手机上布满了传感器，其中一个就是磁力计。如果你的拉链是由金属制成的，当拉链形成的金属环在打开和关闭状态之间改变形状时，其附近(如你的口袋中)的磁力计捕捉到的磁场应该受到干扰。</p><p id="f9bf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">很可能，磁场的绝对值无法追溯到一个国家。然而，动态变化，如行走时捕捉到的变化(触发拉链两侧之间的距离变化)，应该会给你一个可识别的信号。</p><p id="67e2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在这篇文章中，我用这个想法描述了我的实验。从捕捉和处理信号到拟合和优化 3 种不同的模型:梯度推进机、卷积神经网络(ZipNet)和 RNN。</p><h1 id="03d5" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">捕捉信号</h1><p id="bd38" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">一个小的 iOS 应用程序将捕获磁力计和加速计数据，并将其导出到 csv 进行分析。这里可以找到<a class="ae kv" href="https://github.com/jeanfredericplante/lowflyer" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="ba0c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了验证最初的假设，我在打开和关闭拉链时取样。我也做了同样的手势，但没有碰到拉链，以确保这不是我扭曲了磁场。乍一看，好像有信号(见下文)。</p><div class="kg kh ki kj gt ab cb"><figure class="mp kk mq mr ms mt mu paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/21ecbf7d188d572e8f8cc5068e46be33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1008/format:webp/1*vwp3cit3KJxKMedbHHUiUw.png"/></div></figure><figure class="mp kk mv mr ms mt mu paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/0e746baa36d2581bf0773eb856a48776.png" data-original-src="https://miro.medium.com/v2/resize:fit:994/format:webp/1*bIw92jeZ5zs7kzJuyuyppg.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk mw di mx my">Left moving the hands only not the zipper. Right opening and closing the zipper and corresponding x axis signal</figcaption></figure></div><p id="f028" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">生成真实生活数据是一件令人兴奋的事情。我会掩饰这一点，但我为 4 个象限生成了 60 集，分别是行走时或不行走时，以及开放时或不开放时，总共 95K 长的时间序列。</p><p id="4b78" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">以下是 4 象限信号的一个例子(<a class="ae kv" href="https://www.kaggle.com/blocks/zipper-data-exploration-and-processing" rel="noopener ugc nofollow" target="_blank">笔记本</a>)。行走(左)与不行走(右)应该很容易察觉。如果磁信号上的频率模式差异(分别为 x、y 和 z 轴的橙色、蓝色和绿色线条)是一致的，则行走时的打开与关闭(左)看起来似乎是合理的。特别是在不同的样品上，mz 在峰值后出现小的隆起，闭合时比打开时更明显。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi mz"><img src="../Images/b7d58cbbaf44aa01807e7038de027a09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L5yGZnXHjRUqhk46KQ35uw.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">mx (orange), my(blue), mz(green). More high frequency in mz when closed?</figcaption></figure><h1 id="7b00" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">机器学习拯救世界</h1><p id="2c5b" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">在检测磁信号形状变化的前提下，我们希望连续检测用户是静止还是运动——然后，只有在运动的情况下，才评估拉链打开时磁信号是否像一个信号。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi na"><img src="../Images/7e524e60504e6ebdfb89cd64d4c7ff93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Cil0v14y-E4JECEkKalkbg.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">model serialization</figcaption></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nb"><img src="../Images/8e677fc2c6c4677c87732e795806ee85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AJhKHUD4RUaUCJ15Vq6ECQ.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">raw data from the app</figcaption></figure><h2 id="179b" class="nc lt iq bd lu nd ne dn ly nf ng dp mc lf nh ni me lj nj nk mg ln nl nm mi nn bi translated">为培训准备时间序列</h2><p id="c166" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">除了设置验证集和规范化数据之外，还有一个额外的预处理步骤来为时间序列分类准备数据。我们使用一个滑动时间窗口来分块数据，该窗口涉及两个超参数:窗口大小和每个训练样本之间的步长增量。</p><p id="65cd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">直觉上，我们希望窗口大小足够大以捕捉几个周期，但又足够小以使检测器快速反应。根据这些数据，我测试了各种窗口，在 128 个样本之外，没有发现太大的差异。对于步骤，我选择了 10。</p><p id="cbec" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="no">数据扩充:</em>让我们添加“窗口扭曲”来挤压或扩展时间序列(人工创建样本，其中你会走得更快或更慢)。让我们也添加噪声到输入信号(高斯)，帮助模型区分噪声和信号。</p><div class="kg kh ki kj gt ab cb"><figure class="mp kk np mr ms mt mu paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/77720deb5c359f3ed54b0cec00ca4efe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*pUq34zrrGlFoCZfW9eQPjQ.png"/></div></figure><figure class="mp kk np mr ms mt mu paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/bbcc8d3e694d361498187b154e7fdbe5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*2a2IDcURfGknYKDsR-Y5MA.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk nq di nr my">Left: window slicing Xn and Xn+1 input training tensors. Right: window warping</figcaption></figure></div><p id="a97f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="no">特征工程</em>:为了帮助我们的分类器，让我们用傅立叶变换处理输入数据，并将其添加到输入中。我们去除 0 频率，这是已经在原始数据中捕获的平均值。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ns"><img src="../Images/bc23d708cca43d6f7c0787f2a1a7f1e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iFrW6Cq71SIXKVwbUdH4Cw.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Left, ‘mx’ normalized signal. Right, FFT of normalized ‘mx’. 0 freq is indeed removed on the right.</figcaption></figure><p id="a0a9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">如果我们考虑加速度计和磁信号，这将为我们提供总共 12 个维度的输入特征。</p><p id="80a9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="no">避免验证数据污染</em>:对于经过上述预处理的数据，我们不能按照 80%，20%的规则在训练和验证之间随意分割。如果其中一个采样片段被分割，由于窗口重叠，训练将会看到一些验证数据。因此，训练和验证首先按集分开，试图保持类的平衡，然后进行处理。</p><h1 id="948a" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">梯度推进</h1><p id="17bb" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">我们先测试一下现在流行的 LGBM 算法(<a class="ae kv" href="https://www.kaggle.com/blocks/zipper-training" rel="noopener ugc nofollow" target="_blank">笔记本</a>)。为此，我们需要用形状的训练张量(样本数、特征数)来整形。</p><h2 id="7405" class="nc lt iq bd lu nd ne dn ly nf ng dp mc lf nh ni me lj nj nk mg ln nl nm mi nn bi translated">行走还是静止</h2><p id="f716" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">如前所述，我们可以观察行走和站立发作之间的差异，我们的分类器也是如此。使用默认分类器，我们获得了接近 100%的准确率(下图的标题显示了准确率、f1 分数和召回率)。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nt"><img src="../Images/dac6fa7b3b1ad3e622c516c4bee29e61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1RnLM2xJ4cj9iBj3aApTrQ.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Confusion matrices, Left: training, Right validation (with accuracy, f1 and recall scores in the title)</figcaption></figure><h2 id="8307" class="nc lt iq bd lu nd ne dn ly nf ng dp mc lf nh ni me lj nj nk mg ln nl nm mi nn bi translated">行走时，打开还是关闭</h2><p id="2c92" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">这更具挑战性，在这种情况下，对时间序列进行仔细的预处理对于获得良好的结果至关重要。使用默认的 LGBM 设置，并根据剧集的采样，我们通常可以获得 80%的准确率(见下面的 dist)。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nu"><img src="../Images/cb40c8d73228d91410ce566d4917e1b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EkdtOainOoVonw-ulh75sQ.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">accuracy and recall distribution over different sampling of the episodes</figcaption></figure><p id="ff16" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下面是一个相当典型的性能样本，分类器预测 86%的拉链是打开的(回忆)，准确率为 82%。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nv"><img src="../Images/58ea29bdc091ee62e510873e2128e6d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B5LlwRf54h7oRP79riTOBA.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Confusion matrices: Left training, Right validation (accuracy 82%, recall 86%)</figcaption></figure><p id="7592" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这是在添加了加速度和磁场之后，磁场似乎提高了性能，可能允许模型区分行走和拉链的磁场变化。</p><p id="188c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">数据增强似乎也有所帮助，下面是在标准化信号上添加 5%的时间变量和 2%的高斯噪声。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nw"><img src="../Images/f31cf9705ff13e7be3404117a8e0e073.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0gBa6nBA8Y8oVbS6QM1m_g.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">After data augmentation: 2% boost on scores</figcaption></figure><p id="2f5c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">另一个 1-2%的增量改进来自超参数优化(请查看<a class="ae kv" href="https://www.kaggle.com/willkoehrsen/automated-model-tuning" rel="noopener ugc nofollow" target="_blank"> Will Koerhsen 关于该主题的精彩文章</a>，我在笔记本中大量复制了该文章)。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nx"><img src="../Images/6885fe4d18d30a7046a190d84855deb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*52ItCgRrmS49qiKf32FX5Q.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">With hyper-parameters optimization, getting to 90% recall, 85% accuracy</figcaption></figure><h1 id="389a" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">ZipNet</h1><p id="efb6" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">让我们尝试一个卷积神经网络作为分类器。我将使用 PyTorch 和非常棒的 fast.ai 库进行训练(<a class="ae kv" href="https://www.kaggle.com/blocks/zipper-training" rel="noopener ugc nofollow" target="_blank">笔记本</a>)。该自定义 convnet 仅对时序输入使用卷积，并将 fft 输入直接旁路至密集层。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="7f09" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">对于与 LGBM(和增强版)相同的剧集样本，这里是比较性能。准确率低，召回率高。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oa"><img src="../Images/27d57a8c74a917404b112d04fd53a3ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WF2HrWRz_cEUURDEpmIH4A.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Zipnet overfit: validation accuracy 73%, recall 95%</figcaption></figure><p id="748c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">虽然我在创建 ZipNet 时很开心，但 LGBM 在大多数情况下表现得更好。让我们检查一个香草 LSTM。</p><h1 id="0421" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">LSTM</h1><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ny nz l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ob"><img src="../Images/9eae093e3a8fd2436b84e493342b0924.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J6h7r9wPSCdS46VSjkVitg.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">This vanilla LSTM performed worst than LGBM</figcaption></figure><p id="f44c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">香草 LSTM 也一样，LGBM 在这个小数据集上胜出，尽管可以说我没有花太多时间优化它。</p><p id="ea31" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">组装三个模型没有帮助。你可以在附带的<a class="ae kv" href="https://www.kaggle.com/blocks/zipper-training/" rel="noopener ugc nofollow" target="_blank">笔记本</a>中找到尝试。</p><h1 id="05b9" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">最后</h1><p id="0955" class="pw-post-body-paragraph kw kx iq ky b kz mk jr lb lc ml ju le lf mm lh li lj mn ll lm ln mo lp lq lr ij bi translated">你的手机变得更私人了。在(笔记本)纸上，在我测试的环境中，用我的手机，用我的牛仔裤，用你手机的磁力计来检测一个打开的传单似乎工作得不错(80%的准确率)。我怀疑它会用我收集的少量数据来概括，所以这里是一个新的众包数据集和 Kaggle 竞争。</p><p id="1c69" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">感谢阅读。</p></div></div>    
</body>
</html>