<html>
<head>
<title>Market Response Models</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">市场反应模型</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/market-response-models-baf9f9913298?source=collection_archive---------3-----------------------#2019-07-28">https://towardsdatascience.com/market-response-models-baf9f9913298?source=collection_archive---------3-----------------------#2019-07-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/f4d3487a2011968d5000de079e56b123.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X8VSCoNbBoqQCF1Z2S48QQ.jpeg"/></div></div></figure><h2 id="f9bd" class="jc jd je bd b dl jf jg jh ji jj jk dk jl translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsdatascience.com/tagged/data-driven-growth" rel="noopener" target="_blank">使用 Python 实现数据驱动的增长</a></h2><div class=""/><div class=""><h2 id="8e20" class="pw-subtitle-paragraph kk jn je bd b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb dk translated">预测促销活动的增量收益</h2></div><p id="c99c" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">这一系列文章旨在解释如何以一种简单的方式使用 Python，通过将预测方法应用于您的所有行动来推动您公司的发展。它将是编程、数据分析和机器学习的结合。</p><p id="88d2" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">我将在以下九篇文章中讨论所有主题:</p><p id="fc17" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">1- <a class="ae ly" rel="noopener" target="_blank" href="/data-driven-growth-with-python-part-1-know-your-metrics-812781e66a5b">了解你的衡量标准</a></p><p id="6f26" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">2- <a class="ae ly" rel="noopener" target="_blank" href="/data-driven-growth-with-python-part-2-customer-segmentation-5c019d150444">客户细分</a></p><p id="4c47" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">3- <a class="ae ly" rel="noopener" target="_blank" href="/data-driven-growth-with-python-part-3-customer-lifetime-value-prediction-6017802f2e0f">客户终身价值预测</a></p><p id="34c7" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">4- <a class="ae ly" rel="noopener" target="_blank" href="/churn-prediction-3a4a36c2129a">流失预测</a></p><p id="07f1" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated"><a class="ae ly" rel="noopener" target="_blank" href="/predicting-next-purchase-day-15fae5548027"> 5-预测下一个购买日</a></p><p id="c028" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated"><a class="ae ly" rel="noopener" target="_blank" href="/predicting-sales-611cb5a252de"> 6-预测销售额</a></p><p id="57a8" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated"><strong class="le jo"> 7-市场反应模型</strong></p><p id="65de" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated"><a class="ae ly" rel="noopener" target="_blank" href="/uplift-modeling-e38f96b1ef60"> 8-隆起建模</a></p><p id="fddb" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated"><a class="ae ly" rel="noopener" target="_blank" href="/a-b-testing-design-execution-6cf9e27c6559"> 9- A/B 测试设计和执行</a></p><p id="706e" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">文章将有自己的代码片段，使您可以轻松地应用它们。如果你是编程的超级新手，你可以在这里很好地介绍一下<a class="ae ly" href="https://www.kaggle.com/learn/python" rel="noopener ugc nofollow" target="_blank"> Python </a>和<a class="ae ly" href="https://www.kaggle.com/learn/pandas" rel="noopener ugc nofollow" target="_blank"> Pandas </a>(一个我们将在任何事情上使用的著名库)。但是仍然没有编码介绍，您可以学习概念，如何使用您的数据并开始从中产生价值:</p><blockquote class="lz"><p id="6af7" class="ma mb je bd mc md me mf mg mh mi lx dk translated">有时候你必须先跑，然后才能走——托尼·斯塔克</p></blockquote><p id="045d" class="pw-post-body-paragraph lc ld je le b lf mj ko lh li mk kr lk ll ml ln lo lp mm lr ls lt mn lv lw lx im bi translated">作为先决条件，确保你的电脑上安装了 J <a class="ae ly" href="https://jupyter.readthedocs.io/en/latest/install.html" rel="noopener ugc nofollow" target="_blank"> upyter Notebook </a>和 P <a class="ae ly" href="https://www.python.org/downloads/" rel="noopener ugc nofollow" target="_blank"> ython </a>。代码片段只能在 Jupyter 笔记本上运行。</p><p id="e732" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">好吧，我们开始吧。</p><h1 id="a438" class="mo mp je bd mq mr ms mt mu mv mw mx my kt mz ku na kw nb kx nc kz nd la ne nf bi translated">第 7 部分:市场反应模型</h1><p id="7cae" class="pw-post-body-paragraph lc ld je le b lf ng ko lh li nh kr lk ll ni ln lo lp nj lr ls lt nk lv lw lx im bi translated">通过使用我们在以前的文章中建立的模型，我们可以轻松地<a class="ae ly" rel="noopener" target="_blank" href="/data-driven-growth-with-python-part-2-customer-segmentation-5c019d150444">细分客户</a>和<a class="ae ly" rel="noopener" target="_blank" href="/data-driven-growth-with-python-part-3-customer-lifetime-value-prediction-6017802f2e0f">预测他们的终身价值</a> (LTV)以达到目标。顺便提一下，我们也知道<a class="ae ly" rel="noopener" target="_blank" href="/predicting-sales-611cb5a252de">我们的销售数字</a>会是多少。但是我们怎样才能增加销售额呢？如果我们今天打折，预计会有多少增量交易？</p><p id="e34a" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">细分客户和进行 A/B 测试使我们能够尝试许多不同的想法来增加销售额。这是增长黑客技术的基石之一。你需要不断地思考和实验来寻找成长的机会。</p><p id="b9b4" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">将我们要向其发送产品的客户分为测试组和对照组，有助于我们计算增量收益。</p><p id="2550" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">让我们看看下面的例子:</p><figure class="nm nn no np gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nl"><img src="../Images/577d50c6604fe938cecf3c20c562883e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z87SfYsRHLutMhuiE9nZ7g.png"/></div></div></figure><p id="5a9d" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">在此设置中，目标群体被分为三组，以寻找以下问题的答案:</p><p id="abb8" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">1-提供报价会增加转化率吗？</p><p id="6722" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">2-如果是，什么样的报价表现最好？打折还是买一送一？</p><p id="db6a" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">假设结果具有统计学意义，折扣(A 组)看起来最好，因为它比对照组增加了 3%的转化率，比买一送一多带来了 1%的转化率。</p><p id="3563" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">当然，在现实世界中，事情要复杂得多。一些优惠在特定的细分市场表现更好。因此，您需要为选定的细分市场创建一个产品组合。而且，不能指望转化是成功的唯一标准。总会有成本的权衡。一般来说，当转换率上升时，成本也会增加。这就是为什么有时你需要选择一个成本友好但转化较少的报价。</p><p id="2bce" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">现在，通过实验，我们知道了哪个报价比其他报价表现得更好。但是预测呢？如果我们预测给出一个报价的效果，我们可以很容易地最大化我们的交易，并对成本有一个预测。市场反应模型帮助我们建立这个框架。但是做这件事的方法不止一种。我们可以把它们分成两类:</p><p id="04ea" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">1-如果你没有一个控制组(想象你对每个人做了一次公开推广，并在社交媒体上公布)，那么你就无法计算增量。对于这种情况，最好建立一个预测整体销售的回归模型。之前的假设是，该模型将为促销日提供更高的销售数字。</p><p id="2d93" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">为了建立这种模型，您的数据集应该包括促销和非促销日销售数字，以便机器学习模型可以计算增量。</p><p id="6b3a" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">2-如果您有一个控制组，您可以基于细分或个人级别建立响应模型。对他们两人来说，假设是一样的。给出要约应该会增加转化的概率。个人转化概率的上升会给我们带来增量转化。</p><p id="c4e3" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">让我们开始编码，看看我们如何建立一个个体水平的反应模型。在本例中，我们将在这里使用营销数据集<a class="ae ly" href="https://blog.minethatdata.com/2008/03/minethatdata-e-mail-analytics-and-data.html" rel="noopener ugc nofollow" target="_blank">和</a>。但是我做了一些修改，使它与我们的案例更相关(你可以在这里找到<a class="ae ly" href="https://gist.github.com/karamanbk/ef1a118592e2f7954e5bb582e09bdde3" rel="noopener ugc nofollow" target="_blank"><strong class="le jo"/></a><strong class="le jo">)。</strong>)</p><p id="872c" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">让我们导入我们需要的库并导入我们的数据:</p><figure class="nm nn no np gt iv"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="2a8a" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">我们数据的前 10 行:</p><figure class="nm nn no np gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ns"><img src="../Images/850e1764c421565e23ba467110d97bfd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BLwXoYn0Z5enJJeCbWaYJA.png"/></div></div></figure><p id="6a84" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">我们的前 8 列提供个人级别的数据，转换列<strong class="le jo">是我们预测的标签:</strong></p><ul class=""><li id="a945" class="nt nu je le b lf lg li lj ll nv lp nw lt nx lx ny nz oa ob bi translated">最近:自上次购买以来的月数</li><li id="1e83" class="nt nu je le b lf oc li od ll oe lp of lt og lx ny nz oa ob bi translated">历史:历史采购的价值</li><li id="9c22" class="nt nu je le b lf oc li od ll oe lp of lt og lx ny nz oa ob bi translated">used_discount/used_bogo:指示客户是否使用了折扣或先买一送一</li><li id="0a90" class="nt nu je le b lf oc li od ll oe lp of lt og lx ny nz oa ob bi translated">zip_code:邮政编码的分类，如郊区/城市/农村</li><li id="ddfe" class="nt nu je le b lf oc li od ll oe lp of lt og lx ny nz oa ob bi translated">is_referral:指示客户是否是从推荐渠道获得的</li><li id="6c33" class="nt nu je le b lf oc li od ll oe lp of lt og lx ny nz oa ob bi translated">渠道:客户使用的渠道，电话/网络/多渠道</li><li id="cff4" class="nt nu je le b lf oc li od ll oe lp of lt og lx ny nz oa ob bi translated">报价:发送给客户的报价，折扣/买一送一/无报价</li></ul><p id="321f" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">我们将建立一个二元分类模型，对所有客户的转换概率进行评分。为此，我们将遵循以下步骤:</p><ul class=""><li id="907c" class="nt nu je le b lf lg li lj ll nv lp nw lt nx lx ny nz oa ob bi translated">构建提升公式</li><li id="6a80" class="nt nu je le b lf oc li od ll oe lp of lt og lx ny nz oa ob bi translated">探索性数据分析(EDA)和特征工程</li><li id="c466" class="nt nu je le b lf oc li od ll oe lp of lt og lx ny nz oa ob bi translated">对转换概率进行评分</li><li id="f70a" class="nt nu je le b lf oc li od ll oe lp of lt og lx ny nz oa ob bi translated">观察测试集上的结果</li></ul><h2 id="b039" class="oh mp je bd mq oi oj dn mu ok ol dp my ll om on na lp oo op nc lt oq or ne jk bi translated"><strong class="ak">隆起公式</strong></h2><p id="2c33" class="pw-post-body-paragraph lc ld je le b lf ng ko lh li nh kr lk ll ni ln lo lp nj lr ls lt nk lv lw lx im bi translated">首先，我们需要构建一个函数来计算我们的提升。为了简单起见，我们假设每次转换意味着 1 个订单，平均订单价值为 25 美元。</p><p id="c62f" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">我们将计算三种类型的抬升:</p><blockquote class="os ot ou"><p id="6734" class="lc ld ov le b lf lg ko lh li lj kr lk ow lm ln lo ox lq lr ls oy lu lv lw lx im bi translated">转化率提升:试验组转化率-对照组转化率</p><p id="167e" class="lc ld ov le b lf lg ko lh li lj kr lk ow lm ln lo ox lq lr ls oy lu lv lw lx im bi translated">订单提升:转换提升* #测试组中已转换的客户</p><p id="a4f2" class="lc ld ov le b lf lg ko lh li lj kr lk ow lm ln lo ox lq lr ls oy lu lv lw lx im bi translated">收入增加:订单增加*平均订单金额</p></blockquote><p id="702c" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">让我们构建我们的<strong class="le jo">calc _ upgrade</strong>函数:</p><pre class="nm nn no np gt oz pa pb pc aw pd bi"><span id="166c" class="oh mp je pa b gy pe pf l pg ph">def calc_uplift(df):<br/>    #assigning 25$ to the average order value<br/>    avg_order_value = 25<br/>    <br/>    #calculate conversions for each offer type<br/>    base_conv = df[df.offer == 'No Offer']['conversion'].mean()<br/>    disc_conv = df[df.offer == 'Discount']['conversion'].mean()<br/>    bogo_conv = df[df.offer == 'Buy One Get One']['conversion'].mean()<br/>    <br/>    #calculate conversion uplift for discount and bogo<br/>    disc_conv_uplift = disc_conv - base_conv<br/>    bogo_conv_uplift = bogo_conv - base_conv<br/>    <br/>    #calculate order uplift<br/>    disc_order_uplift = disc_conv_uplift * len(df[df.offer == 'Discount']['conversion'])<br/>    bogo_order_uplift = bogo_conv_uplift * len(df[df.offer == 'Buy One Get One']['conversion'])<br/>    <br/>    #calculate revenue uplift<br/>    disc_rev_uplift = disc_order_uplift * avg_order_value<br/>    bogo_rev_uplift = bogo_order_uplift * avg_order_value<br/>    <br/>    <br/>    print('Discount Conversion Uplift: {0}%'.format(np.round(disc_conv_uplift*100,2)))<br/>    print('Discount Order Uplift: {0}'.format(np.round(disc_order_uplift,2)))<br/>    print('Discount Revenue Uplift: ${0}\n'.format(np.round(disc_rev_uplift,2)))<br/>          <br/>    print('-------------- \n')</span><span id="9b83" class="oh mp je pa b gy pi pf l pg ph">print('BOGO Conversion Uplift: {0}%'.format(np.round(bogo_conv_uplift*100,2)))<br/>    print('BOGO Order Uplift: {0}'.format(np.round(bogo_order_uplift,2)))<br/>    print('BOGO Revenue Uplift: ${0}'.format(np.round(bogo_rev_uplift,2)))</span></pre><p id="5727" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">如果我们将这个函数应用到我们的数据帧，我们将看到下面的结果:</p><figure class="nm nn no np gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pj"><img src="../Images/29b525286b2504523c3acf40e9ca0e68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sJPN3QJh_o-cLITbhX80Aw.png"/></div></div></figure><p id="6d59" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">如果我们想获得更多的转化率，折扣似乎是一个更好的选择。与没有收到任何优惠的客户相比，这带来了 7.6%的增长。BOGO(买一送一)也上涨了 4.5%。</p><p id="c43a" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">让我们开始探索哪些因素是这种增量变化的驱动因素。</p><h2 id="3712" class="oh mp je bd mq oi oj dn mu ok ol dp my ll om on na lp oo op nc lt oq or ne jk bi translated">EDA 和特征工程</h2><p id="9b4f" class="pw-post-body-paragraph lc ld je le b lf ng ko lh li nh kr lk ll ni ln lo lp nj lr ls lt nk lv lw lx im bi translated">我们逐一检查每个特性，找出它们对转化率的影响</p><p id="3047" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated"><strong class="le jo"> 1-新近度</strong></p><p id="3b82" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">理想情况下，转换率应该下降，而新近度上升，因为不活跃的客户不太可能再次购买:</p><pre class="nm nn no np gt oz pa pb pc aw pd bi"><span id="6459" class="oh mp je pa b gy pe pf l pg ph">df_plot = df_data.groupby('recency').conversion.mean().reset_index()<br/>plot_data = [<br/>    go.Bar(<br/>        x=df_plot['recency'],<br/>        y=df_plot['conversion'],<br/>    )<br/>]</span><span id="aee0" class="oh mp je pa b gy pi pf l pg ph">plot_layout = go.Layout(<br/>        xaxis={"type": "category"},<br/>        title='Recency vs Conversion',<br/>        plot_bgcolor  = 'rgb(243,243,243)',<br/>        paper_bgcolor  = 'rgb(243,243,243)',<br/>    )<br/>fig = go.Figure(data=plot_data, layout=plot_layout)<br/>pyoff.iplot(fig)</span></pre><figure class="nm nn no np gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pk"><img src="../Images/31857fb582823896cd9ffec7ecd93f50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9wI7PdP3aMVXeoJzB2Gy2Q.png"/></div></div></figure><p id="27ba" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">直到最近 11 个月，一切都如预期的那样。然后就增加了。这可能是由于许多原因，如在这些桶中的客户数量较少或给定优惠的影响。</p><p id="8d2e" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated"><strong class="le jo"> 2-历史记录</strong></p><p id="7301" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">我们将创建一个历史集群并观察其影响。让我们应用 k 均值聚类来定义历史上的重要群体:</p><pre class="nm nn no np gt oz pa pb pc aw pd bi"><span id="cb0a" class="oh mp je pa b gy pe pf l pg ph">kmeans = KMeans(n_clusters=5)<br/>kmeans.fit(df_data[['history']])<br/>df_data['history_cluster'] = kmeans.predict(df_data[['history']])</span><span id="ed0e" class="oh mp je pa b gy pi pf l pg ph">#order the cluster numbers <br/>df_data = order_cluster('history_cluster', 'history',df_data,True)</span><span id="f6c9" class="oh mp je pa b gy pi pf l pg ph">#print how the clusters look like<br/>df_data.groupby('history_cluster').agg({'history':['mean','min','max'], 'conversion':['count', 'mean']})</span><span id="79e4" class="oh mp je pa b gy pi pf l pg ph">#plot the conversion by each cluster<br/>df_plot = df_data.groupby('history_cluster').conversion.mean().reset_index()<br/>plot_data = [<br/>    go.Bar(<br/>        x=df_plot['history_cluster'],<br/>        y=df_plot['conversion'],<br/>    )<br/>]</span><span id="171f" class="oh mp je pa b gy pi pf l pg ph">plot_layout = go.Layout(<br/>        xaxis={"type": "category"},<br/>        title='History vs Conversion',<br/>        plot_bgcolor  = 'rgb(243,243,243)',<br/>        paper_bgcolor  = 'rgb(243,243,243)',<br/>    )<br/>fig = go.Figure(data=plot_data, layout=plot_layout)<br/>pyoff.iplot(fig)</span></pre><p id="ccfa" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">聚类和图与转换的概述:</p><figure class="nm nn no np gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pl"><img src="../Images/aca27365999f47c42694a14e5fee8420.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MHlQvHr_Van0jgwZiB0Mtg.png"/></div></div></figure><figure class="nm nn no np gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pm"><img src="../Images/141f6c95f288278ab774e13a5db3f669.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w1g7QtRg4j4vKXlNywXmXA.png"/></div></div></figure><p id="2410" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">历史价值较高的客户更有可能转化。</p><p id="95c3" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated"><strong class="le jo"> 3-二手折扣&amp; BOGO </strong></p><p id="8b92" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">我们将结合下面的代码行来检查这两个特性:</p><pre class="nm nn no np gt oz pa pb pc aw pd bi"><span id="8c4f" class="oh mp je pa b gy pe pf l pg ph">df_data.groupby(['used_discount','used_bogo','offer']).agg({'conversion':'mean'})</span></pre><p id="3dae" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">输出:</p><figure class="nm nn no np gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pn"><img src="../Images/fc44481f1b17a6ce56d33b048a322bf4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t1P-LpLmJByrJ7e3_gMq4A.png"/></div></div></figure><p id="baa6" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">之前使用过这两种产品的客户拥有最高的转化率。</p><p id="d463" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated"><strong class="le jo"> 4-邮政编码</strong></p><p id="24e3" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">与其他地区相比，农村地区的转化率更高:</p><pre class="nm nn no np gt oz pa pb pc aw pd bi"><span id="516a" class="oh mp je pa b gy pe pf l pg ph">df_plot = df_data.groupby('zip_code').conversion.mean().reset_index()<br/>plot_data = [<br/>    go.Bar(<br/>        x=df_plot['zip_code'],<br/>        y=df_plot['conversion'],<br/>        marker=dict(<br/>        color=['green', 'blue', 'orange'])<br/>    )<br/>]</span><span id="6873" class="oh mp je pa b gy pi pf l pg ph">plot_layout = go.Layout(<br/>        xaxis={"type": "category"},<br/>        title='Zip Code vs Conversion',<br/>        plot_bgcolor  = 'rgb(243,243,243)',<br/>        paper_bgcolor  = 'rgb(243,243,243)',<br/>    )<br/>fig = go.Figure(data=plot_data, layout=plot_layout)<br/>pyoff.iplot(fig)</span></pre><figure class="nm nn no np gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi po"><img src="../Images/1afb17eabfb4c8b085e6390908e569d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wM3w4f3RrhVFJn3IwPlaPQ.png"/></div></div></figure><p id="67d4" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated"><strong class="le jo"> 5-转介</strong></p><p id="f371" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">如下所示，来自推荐渠道的客户转化率较低:</p><figure class="nm nn no np gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pm"><img src="../Images/b57e910435d9164357e77cd8a0bb965f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VLuZYhbZJFPRlT594T_niQ.png"/></div></div></figure><p id="f262" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">它们显示出几乎少了 5%的转化率。</p><p id="105f" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated"><strong class="le jo"> 6 通道</strong></p><figure class="nm nn no np gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pk"><img src="../Images/5c5df221c6541404a78b63b2f1149175.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2qBU_aV9Jhz_w3TDkcZydQ.png"/></div></div></figure><p id="5745" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">正如我们预期的那样，多通道显示了更高的转化率。使用多个渠道是高参与度的标志。</p><p id="ecaf" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated"><strong class="le jo"> 7-报价类型</strong></p><figure class="nm nn no np gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pm"><img src="../Images/b5b2b20c1eb06342e7e570ec20f34dd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I9_Td2K2iU7OhS8bnkrnrg.png"/></div></div></figure><p id="c1a7" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">获得折扣优惠的客户显示出约 18%的转化率，而 BOGO 的转化率为约 15%。如果客户没有得到优惠，他们的转化率下降约 4%。</p><p id="3fa7" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">这些数据的特征工程将非常简单。我们将应用<strong class="le jo">。get_dummies() </strong>将分类列转换为数字列:</p><pre class="nm nn no np gt oz pa pb pc aw pd bi"><span id="039e" class="oh mp je pa b gy pe pf l pg ph">df_model = df_data.copy()<br/>df_model = pd.get_dummies(df_model)</span></pre><p id="58c4" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">是时候建立我们的机器学习模型来评估转换概率了。</p><h2 id="62fc" class="oh mp je bd mq oi oj dn mu ok ol dp my ll om on na lp oo op nc lt oq or ne jk bi translated">评分转换概率</h2><p id="cf77" class="pw-post-body-paragraph lc ld je le b lf ng ko lh li nh kr lk ll ni ln lo lp nj lr ls lt nk lv lw lx im bi translated">为了构建我们的模型，我们需要遵循我们在文章前面提到的步骤。</p><p id="0c09" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">让我们从分割特征和标签开始:</p><pre class="nm nn no np gt oz pa pb pc aw pd bi"><span id="c20a" class="oh mp je pa b gy pe pf l pg ph">#create feature set and labels<br/>X = df_model.drop(['conversion'],axis=1)<br/>y = df_model.conversion</span></pre><p id="870f" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">创建训练集和测试集:</p><pre class="nm nn no np gt oz pa pb pc aw pd bi"><span id="f827" class="oh mp je pa b gy pe pf l pg ph">X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=56)</span></pre><p id="294c" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">我们将拟合模型并得到转换概率。<strong class="le jo">我们模型的 predit_proba() </strong>函数为每一行分配概率:</p><pre class="nm nn no np gt oz pa pb pc aw pd bi"><span id="4e8b" class="oh mp je pa b gy pe pf l pg ph">xgb_model = xgb.XGBClassifier().fit(X_train, y_train)<br/>X_test['proba'] = xgb_model.predict_proba(X_test)[:,1]</span></pre><p id="07ee" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">让我们看看概率栏是什么样子的:</p><figure class="nm nn no np gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pp"><img src="../Images/7f6de1aaa45cfca435bfd942c04fe51e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Lw2whBRNMKThMKOpLEBoQA.png"/></div></div></figure><p id="1a4e" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">从上面可以看出，我们的模型为每个客户分配了转换概率(从 0 到 1)。</p><p id="8a04" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">最后，我们需要了解我们的模型是否运行良好。</p><h2 id="9020" class="oh mp je bd mq oi oj dn mu ok ol dp my ll om on na lp oo op nc lt oq or ne jk bi translated">测试集的结果</h2><p id="9cd9" class="pw-post-body-paragraph lc ld je le b lf ng ko lh li nh kr lk ll ni ln lo lp nj lr ls lt nk lv lw lx im bi translated">现在我们假设，折现概率、bogo 和控制组的差异应该类似于它们之间的转换差异。</p><p id="627e" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">我们需要使用我们的测试集来找出答案。</p><p id="2bbd" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">让我们计算折扣的预测和实际订单增长:</p><pre class="nm nn no np gt oz pa pb pc aw pd bi"><span id="f47a" class="oh mp je pa b gy pe pf l pg ph">real_disc_uptick = len(X_test)*(X_test[X_test['offer_Discount'] == 1].conversion.mean() - X_test[X_test['offer_No Offer'] == 1].conversion.mean())</span><span id="3cb3" class="oh mp je pa b gy pi pf l pg ph">pred_disc_uptick = len(X_test)*(X_test[X_test['offer_Discount'] == 1].proba.mean() - X_test[X_test['offer_No Offer'] == 1].proba.mean())</span></pre><p id="5666" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">对于实际上涨计算，我们使用了<strong class="le jo">转换</strong>列。对于预测的那个，我们换成了<strong class="le jo"> proba </strong>。</p><figure class="nm nn no np gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pq"><img src="../Images/75c8c6721e6a77e505a519bb40d564d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*giiKR_fM5C-U4STdz5EVeA.png"/></div></div></figure><p id="7836" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">结果相当不错。真正的订单上升是<strong class="le jo"> 966 </strong>，模型预测为<strong class="le jo"> 948 </strong> (1.8%误差)<strong class="le jo">。</strong></p><p id="00f2" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">收入上涨预测对比:<strong class="le jo"> 24150 </strong> vs <strong class="le jo"> 23700。</strong></p><p id="7941" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">我们需要检查结果是否对 BOGO 有利:</p><pre class="nm nn no np gt oz pa pb pc aw pd bi"><span id="baed" class="oh mp je pa b gy pe pf l pg ph">real_bogo_uptick = len(X_test)*(X_test[X_test['offer_Buy One Get One'] == 1].conversion.mean() - X_test[X_test['offer_No Offer'] == 1].conversion.mean())</span><span id="d496" class="oh mp je pa b gy pi pf l pg ph">pred_bogo_uptick = len(X_test)*(X_test[X_test['offer_Buy One Get One'] == 1].proba.mean() - X_test[X_test['offer_No Offer'] == 1].proba.mean())</span></pre><figure class="nm nn no np gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pr"><img src="../Images/2b878545d13a2670e61de7427dcec045.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rreQ8F15oCtb1qhUZ5XJ2g.png"/></div></div></figure><p id="5e23" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">BOGO 有希望的结果:</p><p id="19d3" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">订单上升-实际与预测:<strong class="le jo"> 563 </strong>与<strong class="le jo"> 595 </strong></p><p id="df13" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">收入增长—实际与预测:<strong class="le jo"> 14075 </strong>对<strong class="le jo"> 14875 </strong></p><p id="7a87" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">误差率在 5.6%左右。该模型可以受益于提高对 BOGO 要约类型的预测分数。</p><p id="de79" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">计算转换概率在不同领域对我们也有很大帮助。我们已经预测了不同类型优惠的回报，但它也可以帮助我们找到最大限度提升的目标客户。在下一篇文章中，我们将构建自己的<a class="ae ly" rel="noopener" target="_blank" href="/uplift-modeling-e38f96b1ef60">提升模型</a>。</p><p id="958d" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">你可以在这里找到这篇文章的 Jupyter 笔记本。</p></div><div class="ab cl ps pt hx pu" role="separator"><span class="pv bw bk pw px py"/><span class="pv bw bk pw px py"/><span class="pv bw bk pw px"/></div><div class="im in io ip iq"><p id="71e0" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">需要帮助来发展你的公司吗？点击此处与我预约免费课程<a class="ae ly" href="https://app.growthmentor.com/mentors/baris-karaman" rel="noopener ugc nofollow" target="_blank">。</a></p></div></div>    
</body>
</html>