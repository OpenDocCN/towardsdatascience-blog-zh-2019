<html>
<head>
<title>Piping data from Salesforce to MySQL without external connectors</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从 Salesforce 到 MySQL 的管道数据，无需外部连接器</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/piping-data-from-salesforce-to-mysql-without-external-connectors-57a822b1d75b?source=collection_archive---------24-----------------------#2019-10-27">https://towardsdatascience.com/piping-data-from-salesforce-to-mysql-without-external-connectors-57a822b1d75b?source=collection_archive---------24-----------------------#2019-10-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/a858c8be16857ed2e4d82b1fa6f65437.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*5RKdAbXFzVQAq0wr.png"/></div></div></figure><p id="a488" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我希望这篇文章可以拯救那些需要在没有外部连接器的情况下将数据从 salesforce 传输到 MySQL 的人，因为您的上级要求您这样做。我自己在找到一个简单的方法之前遭受了很长时间，所以现在让我们走吧！</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="aed4" class="lg lh it bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated">你需要什么</h1><ol class=""><li id="ef82" class="me mf it kd b ke mg ki mh km mi kq mj ku mk ky ml mm mn mo bi translated">Salesforce lightning 帐户(以及一些关于 Salesforce 对象的知识)</li><li id="3d16" class="me mf it kd b ke mp ki mq km mr kq ms ku mt ky ml mm mn mo bi translated">MySQL 凭证</li><li id="cd60" class="me mf it kd b ke mp ki mq km mr kq ms ku mt ky ml mm mn mo bi translated">使用 npm 安装的 jsforce(以及 node.js 的一些知识)</li><li id="8e8d" class="me mf it kd b ke mp ki mq km mr kq ms ku mt ky ml mm mn mo bi translated">一个好的代码编辑器(:</li></ol><p id="979b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">别担心，我会和你一起检查零件！</p></div><div class="ab cl kz la hx lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="im in io ip iq"><h1 id="3d92" class="lg lh it bd li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md bi translated"><strong class="ak"> 1。Salesforce lightning 帐户</strong></h1><p id="af4c" class="pw-post-body-paragraph kb kc it kd b ke mg kg kh ki mh kk kl km mu ko kp kq mv ks kt ku mw kw kx ky im bi translated">因此，如果您还不知道，salesforce 将帐户、案例等项目存储到对象中。对象由字段组成，每个字段都有一个类型。我们今天要做的是将所有账户数据导入 MySQL。</p><p id="12a2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">获取您的安全令牌</strong></p><figure class="my mz na nb gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mx"><img src="../Images/5ede1c08db575ee4272b86a7996f8c5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s5rxXnoGizFLaEet4Jaigw.png"/></div></div><figcaption class="nc nd gj gh gi ne nf bd b be z dk">security token from salesforce lightning page</figcaption></figure><p id="7abc" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">稍后需要安全令牌来使用 node.js 连接到 salesforce</p><p id="ba4f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在这一部分已经完成，让我们转移到 mySQL</p><h1 id="0656" class="lg lh it bd li lj ng ll lm ln nh lp lq lr ni lt lu lv nj lx ly lz nk mb mc md bi translated">2.MySQL 凭证</h1><p id="ddc6" class="pw-post-body-paragraph kb kc it kd b ke mg kg kh ki mh kk kl km mu ko kp kq mv ks kt ku mw kw kx ky im bi translated">如果你现在用的是 mySQL，你会知道有用户名和密码以及主机。因此，您将需要这些信息来连接到您的帐户+您想要连接的数据库。</p><p id="a47a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">你需要进入 MySQL，点击数据库</p><figure class="my mz na nb gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nl"><img src="../Images/5399541eadab09dae5824b2a729046d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zTdU0ta7fikjZNu9FKsYQg.png"/></div></div></figure><p id="8ea5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后，从下拉列表中，单击“管理连接”</p><p id="07ac" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">查看您的连接参数。</p><figure class="my mz na nb gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nm"><img src="../Images/c62e2e678801a27617495665ae45fcb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4E2KiBwbJrxillDTZKp1UQ.png"/></div></div></figure><p id="724c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在，让我们使用“创建数据库 test_db”和随后的“创建表 test_table 值”创建一个新的数据库<strong class="kd iu"> test_db </strong>(我们将在其中存储 test_table 以加载 salesforce 数据。</p><figure class="my mz na nb gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nn"><img src="../Images/7abb176f5d8f61cb1186c861be16cce3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ex_Dd3Z1qj8OrwAE8LpC0g.png"/></div></div></figure><h1 id="941b" class="lg lh it bd li lj ng ll lm ln nh lp lq lr ni lt lu lv nj lx ly lz nk mb mc md bi translated">3.节点 js 脚本</h1><p id="37b9" class="pw-post-body-paragraph kb kc it kd b ke mg kg kh ki mh kk kl km mu ko kp kq mv ks kt ku mw kw kx ky im bi translated">创建一个您选择的目录，并执行 npm init 来获取所有需要设置的文件。如果没有，您需要安装 npm！</p><p id="5893" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在创建一个 config.js 文件来存放这些凭证。</p><figure class="my mz na nb gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi no"><img src="../Images/74830eff7c1008d685f860f0e0d53d8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*euMWh_dJ4A_8rkkDW3JjhQ.png"/></div></div><figcaption class="nc nd gj gh gi ne nf bd b be z dk">How the config file should look like</figcaption></figure><p id="0df2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这样，我们将使用<strong class="kd iu">‘NPS install jsforce’安装 js force。</strong></p><p id="5262" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在让我们对 jsforce 做一个测试连接。</p><figure class="my mz na nb gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi np"><img src="../Images/0e60d5f1e39d507ef109a0d1ebc19de1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K3M9ns5po72cCXZZy-jcFQ.png"/></div></div></figure><p id="7673" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">基于文档，使用 conn.login，conn.login(用户名、密码+ salesforce 安全令牌)。然后，您应该不会得到任何错误代码(:</p><figure class="my mz na nb gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nq"><img src="../Images/a61dea02f7dd75383b1ad661dfd87b0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vMBQasoZ0Nd1rcnx34k26Q.png"/></div></div></figure><p id="3276" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">是时候把所有东西放在一起了。我们的想法是，首先要连接到 mySQL，并确保它是连接的。接下来，我们将连接到 salesforce 并使用 jsforce wrapper 来查询数据，如使用 SQL langauge，然后将其导入 mySQL(:</p><pre class="my mz na nb gt nr ns nt nu aw nv bi"><span id="8231" class="nw lh it ns b gy nx ny l nz oa">var jsforce = require('jsforce')</span><span id="1884" class="nw lh it ns b gy ob ny l nz oa">var connection = require('./config.js')</span><span id="9600" class="nw lh it ns b gy ob ny l nz oa">connection.connect(function (err) {</span><span id="07b6" class="nw lh it ns b gy ob ny l nz oa">if (err) {</span><span id="3a8d" class="nw lh it ns b gy ob ny l nz oa">return console.error('error:' + err.message);</span><span id="6e85" class="nw lh it ns b gy ob ny l nz oa">}</span><span id="b022" class="nw lh it ns b gy ob ny l nz oa">//console.log('Connected to MySQL');</span><span id="045d" class="nw lh it ns b gy ob ny l nz oa">var conn = new jsforce.Connection({</span><span id="73ed" class="nw lh it ns b gy ob ny l nz oa">});</span><span id="064d" class="nw lh it ns b gy ob ny l nz oa">// password + security token</span><span id="38e9" class="nw lh it ns b gy ob ny l nz oa">conn.login('&lt;login email&gt;', '&lt;password + security token&gt;', function (err, userInfo) {</span><span id="6a3f" class="nw lh it ns b gy ob ny l nz oa">if (err) { return console.error(err); }</span><span id="816e" class="nw lh it ns b gy ob ny l nz oa">// Now you can get the access token and instance URL information.</span><span id="1eb0" class="nw lh it ns b gy ob ny l nz oa">// Save them to establish connection next time.</span><span id="9507" class="nw lh it ns b gy ob ny l nz oa">//console.log(conn.accessToken);</span><span id="d206" class="nw lh it ns b gy ob ny l nz oa">//console.log(conn.instanceUrl);</span><span id="ade1" class="nw lh it ns b gy ob ny l nz oa">// logged in user property</span><span id="4a40" class="nw lh it ns b gy ob ny l nz oa">//console.log("User ID: " + userInfo.id);</span><span id="1561" class="nw lh it ns b gy ob ny l nz oa">//console.log("Org ID: " + userInfo.organizationId);</span><span id="b2d8" class="nw lh it ns b gy ob ny l nz oa">var records = []</span><span id="dd27" class="nw lh it ns b gy ob ny l nz oa">var query = conn.query("Select Id,Name FROM Account")</span><span id="9097" class="nw lh it ns b gy ob ny l nz oa">.on("record", function (record) {</span><span id="b27b" class="nw lh it ns b gy ob ny l nz oa">records.push(record);</span><span id="4513" class="nw lh it ns b gy ob ny l nz oa">console.log(record.Id)</span><span id="5657" class="nw lh it ns b gy ob ny l nz oa">let sql = 'INSERT INTO test_table VALUES (?,?)';</span><span id="b2b3" class="nw lh it ns b gy ob ny l nz oa">let data = [record.Id, record.Name]</span><span id="4533" class="nw lh it ns b gy ob ny l nz oa">connection.query(sql, data, (err, res, fields) =&gt; {</span><span id="7af3" class="nw lh it ns b gy ob ny l nz oa">if (err) {</span><span id="cb0b" class="nw lh it ns b gy ob ny l nz oa">return console.error(err.message);</span><span id="53ce" class="nw lh it ns b gy ob ny l nz oa">}</span><span id="7a19" class="nw lh it ns b gy ob ny l nz oa">console.log('Rows affected:', res.affectedRows);</span><span id="b093" class="nw lh it ns b gy ob ny l nz oa">})</span><span id="f216" class="nw lh it ns b gy ob ny l nz oa">})</span><span id="3a14" class="nw lh it ns b gy ob ny l nz oa">.on("end", function () {</span><span id="92d0" class="nw lh it ns b gy ob ny l nz oa">connection.end(function (err) {</span><span id="24e9" class="nw lh it ns b gy ob ny l nz oa">if (err) {</span><span id="18af" class="nw lh it ns b gy ob ny l nz oa">return console.log('error:' + err.message);</span><span id="ec43" class="nw lh it ns b gy ob ny l nz oa">}</span><span id="83d1" class="nw lh it ns b gy ob ny l nz oa">console.log('Close the database connection.');</span><span id="17ad" class="nw lh it ns b gy ob ny l nz oa">});</span><span id="31f1" class="nw lh it ns b gy ob ny l nz oa">//console.log(records[0].Id);</span><span id="c3e3" class="nw lh it ns b gy ob ny l nz oa">//console.log("total records is :" + query.totalSize);</span><span id="103e" class="nw lh it ns b gy ob ny l nz oa">//console.log("total fetched is :" + query.totalFetched);</span><span id="abc7" class="nw lh it ns b gy ob ny l nz oa">})</span><span id="8f26" class="nw lh it ns b gy ob ny l nz oa">.on("error", function (err) {</span><span id="c3f0" class="nw lh it ns b gy ob ny l nz oa">console.log(err);</span><span id="9423" class="nw lh it ns b gy ob ny l nz oa">})</span><span id="e9b5" class="nw lh it ns b gy ob ny l nz oa">.run({ autoFetch: true, maxFetch: 4000 });</span><span id="524e" class="nw lh it ns b gy ob ny l nz oa">});</span><span id="d790" class="nw lh it ns b gy ob ny l nz oa">})</span><span id="3972" class="nw lh it ns b gy ob ny l nz oa">//let sql = 'INSERT into test_db VALUES (xxx)  '</span></pre><p id="1dd7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">有了那个，你应该得到这个。</p><figure class="my mz na nb gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oc"><img src="../Images/049601d276edae47118430e57a25cd77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EP8a8JcoeVo91-Qecz4cIw.png"/></div></div></figure><p id="aad2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这并不难，对吧！</p><p id="4339" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我希望这在某种程度上帮助了你！如果你也有这个问题，请分享给你的朋友！</p></div></div>    
</body>
</html>