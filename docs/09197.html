<html>
<head>
<title>Advanced Model Building Using the Pipeline Estimator</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用管道估计器的高级模型构建</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/advanced-model-building-using-the-pipeline-estimator-59581244386c?source=collection_archive---------27-----------------------#2019-12-05">https://towardsdatascience.com/advanced-model-building-using-the-pipeline-estimator-59581244386c?source=collection_archive---------27-----------------------#2019-12-05</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/28d5651aa4683d85f92e78f829698b28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WPHGNUzOzlyyFD8pjN1LpA.png"/></div></div></figure><p id="bd23" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在本文中，我们展示了 sci-kit learn 中的 Pipeline 估计器如何用于高效的机器学习模型构建、测试和评估。我们将使用游轮数据集来说明我们的示例，以构建一个线性回归模型来推荐船只的船员人数。</p><p id="7d15" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在上一篇文章中(<a class="ae kz" href="https://medium.com/towards-artificial-intelligence/feature-selection-and-dimensionality-reduction-using-covariance-matrix-plot-b4c7498abd07" rel="noopener"> <strong class="kd iu">使用协方差矩阵图进行特征选择和降维</strong> </a>)，我们已经展示了协方差矩阵图可以用于特征选择和降维。</p><p id="260a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">使用游轮数据集<a class="ae kz" href="https://github.com/bot13956/ML_Model_for_Predicting_Ships_Crew_Size" rel="noopener ugc nofollow" target="_blank"><strong class="kd iu">cruise _ ship _ info . CSV</strong></a><strong class="kd iu">，</strong>我们发现，在 6 个预测特征[' <strong class="kd iu">年龄</strong>'、<strong class="kd iu">吨位</strong>'、<strong class="kd iu">乘客</strong>'、<strong class="kd iu">长度</strong>'、<strong class="kd iu">舱室</strong>、<strong class="kd iu">乘客密度</strong> ]中，如果我们假设重要特征的相关系数为 0 那么目标变量“<strong class="kd iu">乘员</strong>”与 4 个预测变量:“<strong class="kd iu">吨位</strong>”、“<strong class="kd iu">乘客</strong>”、“<strong class="kd iu">长度</strong>、“<strong class="kd iu">车厢</strong>”强相关。 因此，我们能够将特征空间的维数从 6 降低到 4。</p><p id="2f9c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在，假设我们想在新的特征空间上建立一个模型来预测船员变量。我们的模型可以用以下形式表示:</p><figure class="lb lc ld le gt ju gh gi paragraph-image"><div class="gh gi la"><img src="../Images/0acd777ea7a86fc3c841b9022931f10b.png" data-original-src="https://miro.medium.com/v2/resize:fit:626/format:webp/0*__hZfMTsT3gt2tI_.png"/></div></figure><p id="208a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在本文中，我们展示了如何使用 scikit-learn 的<strong class="kd iu">管道估算器以有效的方式训练、测试和评估我们的模型。</strong></p><h1 id="9ab8" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">什么是管道估算器？</h1><p id="29e5" class="pw-post-body-paragraph kb kc it kd b ke md kg kh ki me kk kl km mf ko kp kq mg ks kt ku mh kw kx ky im bi translated">流水线估计器是一种将几个估计器和转换器组合在一起的方法。这有助于我们编写高效的代码。在下图中，管道估计器在输入数据集中执行 3 项重要任务:(1)使用<strong class="kd iu"> StandardScaler() </strong>转换器进行特征缩放；(2)使用<strong class="kd iu"> PCA() </strong>变换器的特征工程和维数减少；以及(3)使用<strong class="kd iu">线性回归()</strong>估计器建立模型。</p><figure class="lb lc ld le gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mi"><img src="../Images/ff11afefd8fa9a5bddd678fce1580921.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NOKepDWoKVSC_Hi9b-GNMw.png"/></div></div></figure><h1 id="6d1f" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">为什么要使用管道估算器？</h1><p id="d203" class="pw-post-body-paragraph kb kc it kd b ke md kg kh ki me kk kl km mf ko kp kq mg ks kt ku mh kw kx ky im bi translated">作为数据科学家，重要的是我们要高效地编码。包含较少行的高效代码更容易捕捉可能存在的任何错误。所采用的流水线使得模型构建非常高效和健壮。</p><p id="cd59" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们现在将考虑一个示例，该示例说明如何使用流水线估计器来构建、测试和评估线性回归模型，该线性回归模型用于基于 4 个预测变量，即“<strong class="kd iu">吨位</strong>”、“<strong class="kd iu">乘客</strong>”、“<strong class="kd iu">长度</strong>和“<strong class="kd iu">舱室</strong>”，来推荐船只的船员人数。</p><h1 id="bc42" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">1.导入必要的库</h1><pre class="lb lc ld le gt mj mk ml mm aw mn bi"><span id="3056" class="mo lg it mk b gy mp mq l mr ms">import numpy as np</span><span id="2b38" class="mo lg it mk b gy mt mq l mr ms">import pandas as pd</span><span id="d77a" class="mo lg it mk b gy mt mq l mr ms">from sklearn.metrics import r2_score</span><span id="dd4b" class="mo lg it mk b gy mt mq l mr ms">from sklearn.model_selection import train_test_split</span><span id="c2c5" class="mo lg it mk b gy mt mq l mr ms">from sklearn.preprocessing import StandardScaler</span><span id="f30b" class="mo lg it mk b gy mt mq l mr ms">from sklearn.decomposition import PCA</span><span id="748b" class="mo lg it mk b gy mt mq l mr ms">from sklearn.linear_model import LinearRegression</span><span id="2ceb" class="mo lg it mk b gy mt mq l mr ms">from sklearn.pipeline import Pipeline</span><span id="eed1" class="mo lg it mk b gy mt mq l mr ms">pipe_lr = Pipeline([('scl', StandardScaler()),('pca', <br/>                  PCA(n_components=4)),('slr', LinearRegression())])</span></pre><h1 id="0b2d" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">2.读取数据集并选择预测值和目标变量</h1><pre class="lb lc ld le gt mj mk ml mm aw mn bi"><span id="67b9" class="mo lg it mk b gy mp mq l mr ms">df=pd.read_csv("cruise_ship_info.csv")</span><span id="bee8" class="mo lg it mk b gy mt mq l mr ms">cols_selected = ['Tonnage', 'passengers', 'length', 'cabins','crew']</span><span id="d088" class="mo lg it mk b gy mt mq l mr ms">X = df[cols_selected].iloc[:,0:4].values <br/>    <br/>y = df[cols_selected]['crew']  </span><span id="4e2a" class="mo lg it mk b gy mt mq l mr ms">sc_y = StandardScaler()</span><span id="ae32" class="mo lg it mk b gy mt mq l mr ms">train_score = []</span><span id="d08e" class="mo lg it mk b gy mt mq l mr ms">test_score =  []</span></pre><h1 id="fdd8" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">3.使用管道估算器进行模型构建、测试和评估(交叉验证)</h1><pre class="lb lc ld le gt mj mk ml mm aw mn bi"><span id="c183" class="mo lg it mk b gy mp mq l mr ms">for i in range(10):</span><span id="6fe8" class="mo lg it mk b gy mt mq l mr ms">    X_train, X_test, y_train, y_test = train_test_split( X, y, <br/>                                  test_size=0.4, random_state=i)</span><span id="abd7" class="mo lg it mk b gy mt mq l mr ms">    y_train_std = sc_y.fit_transform(y_train[:, <br/>                                     np.newaxis]).flatten()</span><span id="4d41" class="mo lg it mk b gy mt mq l mr ms">    pipe_lr.fit(X_train, y_train_std)</span><span id="40ed" class="mo lg it mk b gy mt mq l mr ms">    y_train_pred = sc_y.inverse_transform(pipe_lr.predict(X_train))</span><span id="97e6" class="mo lg it mk b gy mt mq l mr ms">    y_test_pred = sc_y.inverse_transform(pipe_lr.predict(X_test))</span><span id="57e9" class="mo lg it mk b gy mt mq l mr ms">    train_score = np.append(train_score, r2_score(y_train, <br/>                            y_train_pred))</span><span id="1611" class="mo lg it mk b gy mt mq l mr ms">    test_score = np.append(test_score, r2_score(y_test, <br/>                            y_test_pred))</span></pre><h1 id="c524" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">4.我们代码的输出</h1><figure class="lb lc ld le gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mu"><img src="../Images/c1aa05211833801454a3954f9341752b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*giFFScg3eaXny8Sl.png"/></div></div></figure><p id="9190" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">总之，我们已经展示了如何通过将几个基本的转换器和估计器组合在一起，使用非常少的代码行来使用管道估计器来构建、测试和评估机器学习模型。</p><h1 id="0a40" class="lf lg it bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">参考</h1><ol class=""><li id="b1e2" class="mv mw it kd b ke md ki me km mx kq my ku mz ky na nb nc nd bi translated"><a class="ae kz" href="https://medium.com/towards-artificial-intelligence/training-a-machine-learning-model-on-a-dataset-with-highly-correlated-features-debddf5b2e34" rel="noopener">在具有高度相关特征的数据集上训练机器学习模型</a>。</li><li id="94f4" class="mv mw it kd b ke ne ki nf km ng kq nh ku ni ky na nb nc nd bi translated"><a class="ae kz" href="https://medium.com/towards-artificial-intelligence/feature-selection-and-dimensionality-reduction-using-covariance-matrix-plot-b4c7498abd07" rel="noopener">使用协方差矩阵图进行特征选择和降维</a>。</li><li id="3166" class="mv mw it kd b ke ne ki nf km ng kq nh ku ni ky na nb nc nd bi translated">Raschka、Sebastian 和 Vahid Mirjalili <strong class="kd iu">。</strong> <em class="nj"> Python 机器学习，第二版</em>。帕克特出版社，2017 年。</li><li id="31aa" class="mv mw it kd b ke ne ki nf km ng kq nh ku ni ky na nb nc nd bi translated">Benjamin O. Tayo，<em class="nj">预测船只船员规模的机器学习模型</em>，<a class="ae kz" href="https://github.com/bot13956/ML_Model_for_Predicting_Ships_Crew_Size" rel="noopener ugc nofollow" target="_blank">https://github . com/bot 13956/ML _ Model _ for _ Predicting _ Ships _ Crew _ Size</a>。</li></ol></div></div>    
</body>
</html>