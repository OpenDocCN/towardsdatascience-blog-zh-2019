<html>
<head>
<title>Kepler.GL &amp; Jupyter Notebooks: Geospatial Data Visualization with Uber’s opensource Kepler.GL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">开普勒。GL &amp; Jupyter 笔记本:优步开源开普勒的地理空间数据可视化。标距长度</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/kepler-gl-jupyter-notebooks-geospatial-data-visualization-with-ubers-opensource-kepler-gl-b1c2423d066f?source=collection_archive---------0-----------------------#2019-10-16">https://towardsdatascience.com/kepler-gl-jupyter-notebooks-geospatial-data-visualization-with-ubers-opensource-kepler-gl-b1c2423d066f?source=collection_archive---------0-----------------------#2019-10-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="767f" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在 Jupyter 笔记本中绘制地理空间数据&amp;轻松地与开普勒的用户界面交互以调整可视化。</h2></div><p id="973c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">kepler.gl for Jupyter 是一款优秀的大地理空间数据可视化工具。将世界一流的可视化工具、易于使用的用户界面(UI)以及 python 和 Jupyter 笔记本的灵活性结合起来(下面是 3D 可视化 GIF，文章中有更多内容)。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi lf"><img src="../Images/4d1f43ab25767a4b8bc16afd0a0825b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*hLtE6nJecAl9gILO5iaDnQ.gif"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk">3D building footprints</figcaption></figure><p id="dae0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae le" href="https://kepler.gl/" rel="noopener ugc nofollow" target="_blank"> kepler.gl </a>是基于网络的大型地理空间数据集可视化工具，构建在<a class="ae le" href="http://deck.gl/" rel="noopener ugc nofollow" target="_blank"> deck.gl </a>之上。优步去年将其开源，其功能令人印象深刻。您可以轻松地拖放您的数据集，并在 web 上立即调整它，以便轻松地可视化大规模地理空间数据集。看看下面这张展示开普勒网络应用的 GIF。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi lv"><img src="../Images/6c05f07056ee5018c59d0d6623ee0f13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*JkAwLNwTJ1BOPZkr27GmJw.gif"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk">Kepler.gl <a class="ae le" href="http://kepler.gl" rel="noopener ugc nofollow" target="_blank">Source</a></figcaption></figure><p id="c28f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我喜欢在 Jupyter 笔记本中工作，Kepler.gl 的相同功能在 Jupyter 笔记本环境中也是可用的。在本教程中，我将重点介绍如何在笔记本中集成<a class="ae le" href="https://github.com/keplergl/kepler.gl/blob/master/docs/keplergl-jupyter/user-guide.md" rel="noopener ugc nofollow" target="_blank"> kepler.gl for Jupyter </a>可视化工具。</p><p id="973b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">使用开普勒 Jupyter 笔记本的优点是，你既可以获得作为开普勒伟大的可视化工具的 Jupyter 笔记本的灵活性。</p><h2 id="8315" class="lw lx it bd ly lz ma dn mb mc md dp me kr mf mg mh kv mi mj mk kz ml mm mn mo bi translated">在 Kelpler Jupyter 笔记本中显示数据</h2><p id="b58a" class="pw-post-body-paragraph ki kj it kk b kl mp ju kn ko mq jx kq kr mr kt ku kv ms kx ky kz mt lb lc ld im bi translated">我们在本教程中使用的数据集来自<a class="ae le" href="https://opendata.cityofnewyork.us/" rel="noopener ugc nofollow" target="_blank">纽约开放数据</a>门户。都是 2018 年纽约报道的事件。</p><pre class="lg lh li lj gt mu mv mw mx aw my bi"><span id="1b13" class="lw lx it mv b gy mz na l nb nc">import pandas as pd<br/>from keplergl import KeplerGl<br/>import geopandas as gpd</span><span id="248f" class="lw lx it mv b gy nd na l nb nc">df = gpd.read_file("NYPD_complaints_2018.csv")<br/>df.head()</span></pre><p id="45c0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">数据集的前几行如下。事件数据、类别和事件发生地的坐标是该数据集中可用的列。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi ne"><img src="../Images/410f08ac2566f120c8179b2101af766e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VGw-9FjourMD15TQPL6mhw.png"/></div></div></figure><p id="e134" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要使用开普勒绘制数据，首先需要创建一张地图。让我们只用一行代码就能做到。</p><pre class="lg lh li lj gt mu mv mw mx aw my bi"><span id="539b" class="lw lx it mv b gy mz na l nb nc">#Create a basemap <br/>map = KeplerGl(height=600, width=800)</span><span id="4002" class="lw lx it mv b gy nd na l nb nc">#show the map<br/>map</span></pre><p id="ceb4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">笔记本中会出现带有深色底图的默认地图。如果你愿意，你可以很容易地改变它。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi nf"><img src="../Images/555d925f7fc6c84012849b06d0501468.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pUG1bmxRjAn0R7o_mmFiIQ.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk">Empty base map</figcaption></figure><p id="ca98" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，让我们将数据添加到地图中。将数据直接添加到 Kepler.gl 的最简单方法是将其转换为地理数据框架，我们可以使用 Geopandas 快速完成此操作。</p><pre class="lg lh li lj gt mu mv mw mx aw my bi"><span id="4e68" class="lw lx it mv b gy mz na l nb nc"># Create a gepdataframe<br/>gdf = gpd.GeoDataFrame(df, geometry=gpd.points_from_xy(df.Longitude, df.Latitude))</span><span id="b407" class="lw lx it mv b gy nd na l nb nc"># Add data to Kepler<br/>map.add_data(data=gdf, name=”crimes”)</span></pre><p id="8410" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们将数据添加到我们创建的第一个地图中(您可以再次调用 map 来显示在下面的单元格中，但这不是必需的)。这些点出现在上面创建的底图的顶部。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi ne"><img src="../Images/25184be589f61a5969927d5bd8c9fa24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kShbbaPa4PhC359tdp0HPA.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk">Points plotted in Kepler Jupyter</figcaption></figure><p id="bcbc" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">地图点多，乱。让我们做一些调整。</p><h2 id="7b3a" class="lw lx it bd ly lz ma dn mb mc md dp me kr mf mg mh kv mi mj mk kz ml mm mn mo bi translated">UI:在 Jupyter 笔记本中调整和交互地图</h2><p id="3a7d" class="pw-post-body-paragraph ki kj it kk b kl mp ju kn ko mq jx kq kr mr kt ku kv ms kx ky kz mt lb lc ld im bi translated">下面是有趣的部分，你可以用开普勒的用户界面轻松地调整可视化的类型、颜色和大小。让我们改变地图的颜色和大小(见下面的 GIF 图)。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi ng"><img src="../Images/69afacfb8f5dfcb67ede4b155088e409.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*EyjGwotwIaXKw9H_Ig_O1g.gif"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk">Kepler.gl Jupyter notebook User Interface</figcaption></figure><p id="8665" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">上面我们只展示了一种可视化的方式，这通常取决于手边的数据集。不过，以下是 Kepler.gl 现在提供的功能(见下图)。您可以将您的数据可视化为点、六边形、热图、弧形或带有线数据的线，以及具有 3D 可用性的建筑物可视化。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi nh"><img src="../Images/0bcf92dd43f05beb96c8994ae1771382.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1hrmrhtzLVDG50wJKkkygQ.png"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk">Kepler visualisation types. <a class="ae le" href="https://kepler.gl/" rel="noopener ugc nofollow" target="_blank">Source</a></figcaption></figure><p id="2c1c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们来看看更多的数据可视化(见 GIF 下面的六边形可视化)。开普勒自动计算每个六边形并将其可视化。请从下面的地图中查看周边地区如何减少事故。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi ni"><img src="../Images/35ea933ef76ea7ca752a31941fbdf139.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*pwvvkhs838FbmkSW2MD7Yw.gif"/></div></div></figure><p id="4c46" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Kepler.gl Jupyter notebook 中的另一个很棒的工具是内置的时间序列动画。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi nj"><img src="../Images/c79e64b6f47d7f507d3a41b5492bd4b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*u0Byv01Gr_i40fFjiha_Rg.gif"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk">Time-series animation</figcaption></figure><h2 id="842b" class="lw lx it bd ly lz ma dn mb mc md dp me kr mf mg mh kv mi mj mk kz ml mm mn mo bi translated">处理您的数据，可视化，永远不要离开 Jupyter 笔记本</h2><p id="9c77" class="pw-post-body-paragraph ki kj it kk b kl mp ju kn ko mq jx kq kr mr kt ku kv ms kx ky kz mt lb lc ld im bi translated">它的美妙之处在于，你不用离开 Jupyter 笔记本就能获得开普勒的功能。假设我们对将数据聚合到社区中感兴趣。我下载了邻域文件并执行了一个简单的空间连接来计算每个邻域内有多少个事件。</p><p id="a6f1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我创建了一个函数来实现这一功能:空间连接、分组，然后返回地理数据框架。</p><pre class="lg lh li lj gt mu mv mw mx aw my bi"><span id="4e41" class="lw lx it mv b gy mz na l nb nc">def count_incidents_neighborhood(data, neighb):<br/> # spatial join and group by to get count of incidents in each poneighbourhood <br/> joined = gpd.sjoin(gdf, neighb, op=”within”)<br/> grouped = joined.groupby(‘ntaname’).size()<br/> df = grouped.to_frame().reset_index()<br/> df.columns = [‘ntaname’, ‘count’]<br/> merged = Neighborhood.merge(df, on=’ntaname’, how=’outer’)<br/> merged[‘count’].fillna(0,inplace=True)<br/> merged[‘count’] = merged[‘count’].astype(int)<br/> return merged</span><span id="a0ce" class="lw lx it mv b gy nd na l nb nc">merged_gdf = count_incidents_neighborhood(gdf, Neighborhood)</span></pre><p id="09e1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一旦我们有了想要绘制的数据，我们就可以创建开普勒地图。让我们在一个单独的地图中这样做；我们称之为地图 2。我们添加刚刚创建的数据来可视化它。</p><pre class="lg lh li lj gt mu mv mw mx aw my bi"><span id="a976" class="lw lx it mv b gy mz na l nb nc">map2 = KeplerGl(height=600, width=800)<br/># Add data to Kepler<br/>map2.add_data(data=merged_gdf, name=”NeighborhoodCrimes”)<br/>map2</span></pre><p id="2768" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是最初的地图，你可以如何调整它。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi ni"><img src="../Images/76b72425b9b7a3a37cf51b5c1467cd6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*07FubYw9AkJaSSbKG7l-fQ.gif"/></div></div><figcaption class="lr ls gj gh gi lt lu bd b be z dk">Polygon visualisation</figcaption></figure><h2 id="505a" class="lw lx it bd ly lz ma dn mb mc md dp me kr mf mg mh kv mi mj mk kz ml mm mn mo bi translated">三维可视化</h2><p id="c5ee" class="pw-post-body-paragraph ki kj it kk b kl mp ju kn ko mq jx kq kr mr kt ku kv ms kx ky kz mt lb lc ld im bi translated">开普勒也有方便的三维可视化。这是一个使用旧金山开放数据构建足迹的示例。</p><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi lf"><img src="../Images/4d1f43ab25767a4b8bc16afd0a0825b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*hLtE6nJecAl9gILO5iaDnQ.gif"/></div></div></figure><h2 id="1665" class="lw lx it bd ly lz ma dn mb mc md dp me kr mf mg mh kv mi mj mk kz ml mm mn mo bi translated">装置</h2><p id="d485" class="pw-post-body-paragraph ki kj it kk b kl mp ju kn ko mq jx kq kr mr kt ku kv ms kx ky kz mt lb lc ld im bi translated">要安装 Keplergl Jupyter notebook，只需在终端上运行这三行代码。</p><pre class="lg lh li lj gt mu mv mw mx aw my bi"><span id="f73e" class="lw lx it mv b gy mz na l nb nc">pip install ipywidgets<br/>pip install keplergl<br/>jupyter nbextension install --py --sys-prefix keplergl</span></pre><h2 id="5296" class="lw lx it bd ly lz ma dn mb mc md dp me kr mf mg mh kv mi mj mk kz ml mm mn mo bi translated">结论</h2><p id="b752" class="pw-post-body-paragraph ki kj it kk b kl mp ju kn ko mq jx kq kr mr kt ku kv ms kx ky kz mt lb lc ld im bi translated">我们已经介绍了 Kepler.gl Jupyter notebook 可视化地理空间数据的一些用例。我发现这个工具非常有用，因为它在 Jupyter notebook 中提供了令人印象深刻的功能。尝试一下，让我知道你是否尝试过。</p></div></div>    
</body>
</html>