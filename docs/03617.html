<html>
<head>
<title>Predicting Sales</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">预测销售额</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/predicting-sales-611cb5a252de?source=collection_archive---------0-----------------------#2019-06-09">https://towardsdatascience.com/predicting-sales-611cb5a252de?source=collection_archive---------0-----------------------#2019-06-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/6dd43489060cac9d1f95fc3069673666.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T4ohgor8-7h6263xDFYDyw.jpeg"/></div></div></figure><h2 id="d5a0" class="jc jd je bd b dl jf jg jh ji jj jk dk jl translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsdatascience.com/tagged/data-driven-growth" rel="noopener" target="_blank">使用 Python 实现数据驱动的增长</a></h2><div class=""/><div class=""><h2 id="8e20" class="pw-subtitle-paragraph kk jn je bd b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb dk translated">与 LSTM 一起预测月销售额</h2></div><p id="dd12" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">这一系列文章旨在解释如何以一种简单的方式使用 Python，通过将预测方法应用于您的所有行动来推动您公司的发展。它将是编程、数据分析和机器学习的结合。</p><p id="9348" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">我将在以下九篇文章中讨论所有主题:</p><p id="4f41" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">1- <a class="ae ly" rel="noopener" target="_blank" href="/data-driven-growth-with-python-part-1-know-your-metrics-812781e66a5b?source=post_page---------------------------">了解你的衡量标准</a></p><p id="addc" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">2- <a class="ae ly" rel="noopener" target="_blank" href="/data-driven-growth-with-python-part-2-customer-segmentation-5c019d150444?source=post_page---------------------------">客户细分</a></p><p id="e9e0" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">3- <a class="ae ly" rel="noopener" target="_blank" href="/data-driven-growth-with-python-part-3-customer-lifetime-value-prediction-6017802f2e0f?source=post_page---------------------------">客户终身价值预测</a></p><p id="2cff" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">4- <a class="ae ly" rel="noopener" target="_blank" href="/churn-prediction-3a4a36c2129a?source=post_page---------------------------">流失预测</a></p><p id="56a4" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated"><a class="ae ly" rel="noopener" target="_blank" href="/predicting-next-purchase-day-15fae5548027?source=post_page---------------------------"> 5-预测下一个购买日</a></p><p id="4c49" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">6- <strong class="le jo">预测销售额</strong></p><p id="1ba2" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated"><a class="ae ly" rel="noopener" target="_blank" href="/market-response-models-baf9f9913298"> 7-市场反应模型</a></p><p id="1ee5" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated"><a class="ae ly" rel="noopener" target="_blank" href="/uplift-modeling-e38f96b1ef60"> 8-隆起建模</a></p><p id="f534" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated"><a class="ae ly" rel="noopener" target="_blank" href="/a-b-testing-design-execution-6cf9e27c6559"> 9- A/B 测试设计和执行</a></p><p id="8451" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">文章将有自己的代码片段，使您可以轻松地应用它们。如果你是编程的超级新手，你可以在这里很好地介绍一下<a class="ae ly" href="https://www.kaggle.com/learn/python?source=post_page---------------------------" rel="noopener ugc nofollow" target="_blank"> Python </a>和<a class="ae ly" href="https://www.kaggle.com/learn/pandas?source=post_page---------------------------" rel="noopener ugc nofollow" target="_blank"> Pandas </a>(一个我们将在任何事情上使用的著名库)。但是仍然没有编码介绍，您可以学习概念，如何使用您的数据并开始从中产生价值:</p><blockquote class="lz"><p id="87e0" class="ma mb je bd mc md me mf mg mh mi lx dk translated">有时候你得先跑，然后才能走——托尼·斯塔克</p></blockquote><p id="0b00" class="pw-post-body-paragraph lc ld je le b lf mk ko lh li ml kr lk ll mm ln lo lp mn lr ls lt mo lv lw lx im bi translated">作为先决条件，确保你的电脑上安装了 J <a class="ae ly" href="https://jupyter.readthedocs.io/en/latest/install.html?source=post_page---------------------------" rel="noopener ugc nofollow" target="_blank"> upyter Notebook </a>和 P <a class="ae ly" href="https://www.python.org/downloads/?source=post_page---------------------------" rel="noopener ugc nofollow" target="_blank"> ython </a>。代码片段只能在 Jupyter 笔记本上运行。</p><p id="e732" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">好吧，我们开始吧。</p><h1 id="6733" class="mp mq je bd mr ms mt mu mv mw mx my mz kt na ku nb kw nc kx nd kz ne la nf ng bi translated">第 6 部分:预测销售额</h1><p id="857d" class="pw-post-body-paragraph lc ld je le b lf nh ko lh li ni kr lk ll nj ln lo lp nk lr ls lt nl lv lw lx im bi translated">在本节之前，我们几乎所有的预测模型都是基于客户层面的(例如，流失预测、下一个购买日等)。).缩小视野，看看更广阔的图景也是有用的。通过考虑我们在客户方面的所有努力，我们如何影响销售？</p><p id="2b6d" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">时间序列预测是机器学习的主要组成部分之一。文献中有许多方法可以实现这一点，如自回归综合移动平均(ARIMA)、季节自回归综合移动平均(SARIMA)、向量自回归(VAR)等。</p><p id="a4e2" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">在本文中，我们将重点关注长短期记忆(LSTM)方法，如果你想使用深度学习，这是一种非常流行的方法。我们将在我们的项目中使用<a class="ae ly" href="https://keras.io/" rel="noopener ugc nofollow" target="_blank"> Keras </a>来实现 LSTM。</p><p id="cc19" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated"><strong class="le jo">最后，了解未来销售对我们的业务有什么帮助？</strong></p><p id="3727" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">首先，它是一个标杆。如果我们的战略没有任何变化，我们可以将它作为我们将要实现的业务照常水平。此外，我们可以在这个基准之上计算我们新行动的增量价值。</p><p id="b0ca" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">第二，它可以用于规划。我们可以通过查看预测来计划我们的需求和供应行动。这有助于了解在哪些方面投资更多。</p><p id="512a" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">最后但同样重要的是，它是一个规划预算和目标的优秀指南。</p><p id="7296" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">现在是时候跳入编码，建立我们的第一个深度学习模型了。我们模型的实施将有 3 个步骤:</p><ul class=""><li id="11be" class="nm nn je le b lf lg li lj ll no lp np lt nq lx nr ns nt nu bi translated">数据争论</li><li id="5a0b" class="nm nn je le b lf nv li nw ll nx lp ny lt nz lx nr ns nt nu bi translated">数据转换，使其稳定并受到监督</li><li id="8f96" class="nm nn je le b lf nv li nw ll nx lp ny lt nz lx nr ns nt nu bi translated">建立 LSTM 模型和评估</li></ul><h2 id="82d6" class="oa mq je bd mr ob oc dn mv od oe dp mz ll of og nb lp oh oi nd lt oj ok nf jk bi translated">数据争论</h2><p id="57fb" class="pw-post-body-paragraph lc ld je le b lf nh ko lh li ni kr lk ll nj ln lo lp nk lr ls lt nl lv lw lx im bi translated">在这个例子中，我们使用来自 Kaggle 竞赛的数据集<a class="ae ly" href="https://www.kaggle.com/c/demand-forecasting-kernels-only" rel="noopener ugc nofollow" target="_blank">。它表示每个商店和商品的每日销售额。</a></p><p id="58f4" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">像往常一样，我们从导入所需的库和从 CSV 导入数据开始:</p><figure class="ol om on oo gt iv"><div class="bz fp l di"><div class="op oq l"/></div></figure><p id="bde6" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">我们的数据如下所示:</p><figure class="ol om on oo gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi or"><img src="../Images/16edb9e60bf4e6028cec244e6d4eda44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2JUE1-okjy9lJeMbsW4Owg.png"/></div></div></figure><p id="cfe8" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">我们的任务是预测每月的总销售额。我们需要按月汇总我们的数据，并对<em class="os">销售</em>列求和。</p><pre class="ol om on oo gt ot ou ov ow aw ox bi"><span id="3122" class="oa mq je ou b gy oy oz l pa pb">#represent month in date field as its first day<br/>df_sales['date'] = df_sales['date'].dt.year.astype('str') + '-' + df_sales['date'].dt.month.astype('str') + '-01'<br/>df_sales['date'] = pd.to_datetime(df_sales['date'])</span><span id="c4fd" class="oa mq je ou b gy pc oz l pa pb">#groupby date and sum the sales<br/>df_sales = df_sales.groupby('date').sales.sum().reset_index()</span></pre><p id="cbeb" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">应用上面的代码后，<strong class="le jo"> df_sales </strong>现在显示了我们需要的总销售额:</p><figure class="ol om on oo gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pd"><img src="../Images/6c92b44685609c602e0c268c189d3f8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wL6rkOqDOL5_rgVGcGOmRw.png"/></div></div></figure><h2 id="b834" class="oa mq je bd mr ob oc dn mv od oe dp mz ll of og nb lp oh oi nd lt oj ok nf jk bi translated">数据转换</h2><p id="892d" class="pw-post-body-paragraph lc ld je le b lf nh ko lh li ni kr lk ll nj ln lo lp nk lr ls lt nl lv lw lx im bi translated">为了更容易、更准确地模拟我们的预测，我们将进行以下转换:</p><ul class=""><li id="5c3d" class="nm nn je le b lf lg li lj ll no lp np lt nq lx nr ns nt nu bi translated">如果不是，我们将把数据转换成静态的</li><li id="5fc4" class="nm nn je le b lf nv li nw ll nx lp ny lt nz lx nr ns nt nu bi translated">从时间序列转换为受监督的，以获得我们的 LSTM 模型的特征集</li><li id="b672" class="nm nn je le b lf nv li nw ll nx lp ny lt nz lx nr ns nt nu bi translated">缩放数据</li></ul><p id="85ef" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">首先，我们如何检查数据是否不稳定？让我们画出来看看:</p><pre class="ol om on oo gt ot ou ov ow aw ox bi"><span id="7811" class="oa mq je ou b gy oy oz l pa pb">#plot monthly sales<br/>plot_data = [<br/>    go.Scatter(<br/>        x=df_sales['date'],<br/>        y=df_sales['sales'],<br/>    )<br/>]</span><span id="3906" class="oa mq je ou b gy pc oz l pa pb">plot_layout = go.Layout(<br/>        title='Montly Sales'<br/>    )<br/>fig = go.Figure(data=plot_data, layout=plot_layout)<br/>pyoff.iplot(fig)</span></pre><p id="ad72" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">月度销售图表:</p><figure class="ol om on oo gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pe"><img src="../Images/5769e742c9e68a4ecf9c4a0efa50a453.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b4QfvGJj9_yYf-_P4aJKOA.png"/></div></div><figcaption class="pf pg gj gh gi ph pi bd b be z dk"><strong class="bd pj">Monthly Sales </strong>— not stationary</figcaption></figure><p id="aada" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">显然，它不是静止不变的，在几个月内有增加的趋势。一种方法是获得与前一个月相比的销售差额，并在此基础上建立模型:</p><pre class="ol om on oo gt ot ou ov ow aw ox bi"><span id="dd3c" class="oa mq je ou b gy oy oz l pa pb">#create a new dataframe to model the difference<br/>df_diff = df_sales.copy()</span><span id="c115" class="oa mq je ou b gy pc oz l pa pb">#add previous sales to the next row<br/>df_diff['prev_sales'] = df_diff['sales'].shift(1)</span><span id="1f46" class="oa mq je ou b gy pc oz l pa pb">#drop the null values and calculate the difference<br/>df_diff = df_diff.dropna()<br/>df_diff['diff'] = (df_diff['sales'] - df_diff['prev_sales'])</span><span id="8fb7" class="oa mq je ou b gy pc oz l pa pb">df_diff.head(10)</span></pre><p id="8f1d" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">现在我们有了建模差异所需的数据框架:</p><figure class="ol om on oo gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pk"><img src="../Images/1d6c6a50b8f8adbda49741b15e519485.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6jOqHGuT8DAFbR_OAGTPKg.png"/></div></div></figure><p id="8b2f" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">让我们画出它并检查它现在是否是静止的:</p><pre class="ol om on oo gt ot ou ov ow aw ox bi"><span id="9ed8" class="oa mq je ou b gy oy oz l pa pb">#plot sales diff<br/>plot_data = [<br/>    go.Scatter(<br/>        x=df_diff['date'],<br/>        y=df_diff['diff'],<br/>    )<br/>]</span><span id="65cb" class="oa mq je ou b gy pc oz l pa pb">plot_layout = go.Layout(<br/>        title='Montly Sales Diff'<br/>    )<br/>fig = go.Figure(data=plot_data, layout=plot_layout)<br/>pyoff.iplot(fig)</span></pre><figure class="ol om on oo gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pl"><img src="../Images/3badcf100c587027ce294eb4bf0fde45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z0K2gdge0xl7U1YIeoq4Sg.png"/></div></div><figcaption class="pf pg gj gh gi ph pi bd b be z dk"><strong class="bd pj">Monthly Sales Difference </strong>— stationary</figcaption></figure><p id="469c" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">完美！现在我们可以开始构建我们的特性集了。我们需要用以前的月度销售数据来预测下一个月。每个型号的回顾期可能会有所不同。在这个例子中，我们的将是 12。</p><p id="c4d3" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">所以我们需要做的是创建从 lag_1 到 lag_12 的列，并通过使用<strong class="le jo"> shift() </strong>方法赋值:</p><pre class="ol om on oo gt ot ou ov ow aw ox bi"><span id="a00c" class="oa mq je ou b gy oy oz l pa pb">#create dataframe for transformation from time series to supervised<br/>df_supervised = df_diff.drop(['prev_sales'],axis=1)</span><span id="1499" class="oa mq je ou b gy pc oz l pa pb">#adding lags<br/>for inc in range(1,13):<br/>    field_name = 'lag_' + str(inc)<br/>    df_supervised[field_name] = df_supervised['diff'].shift(inc)</span><span id="2070" class="oa mq je ou b gy pc oz l pa pb">#drop null values<br/>df_supervised = df_supervised.dropna().reset_index(drop=True)</span></pre><p id="17ba" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">查看我们名为 df_supervised 的新数据框架:</p><figure class="ol om on oo gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pm"><img src="../Images/4862ee3bc0f3d8c2032f3a2c9245ec53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*svNzc5md23CTfzEufc6ztg.png"/></div></div></figure><p id="7429" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">我们现在有了自己的功能集。让我们再好奇一点，问这个问题:</p><p id="3ab2" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated"><strong class="le jo">我们的特征对预测有多大用处？</strong></p><p id="8ca3" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated"><em class="os">调整后的 R 平方</em>就是答案。它告诉我们我们的特征如何很好地解释了我们标签中的变化(在我们的例子中，对于 diff，从 lag_1 到 lag_12)。</p><p id="70ce" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">让我们看一个例子:</p><pre class="ol om on oo gt ot ou ov ow aw ox bi"><span id="12c1" class="oa mq je ou b gy oy oz l pa pb"># Import statsmodels.formula.api<br/>import statsmodels.formula.api as smf</span><span id="3039" class="oa mq je ou b gy pc oz l pa pb"># Define the regression formula<br/>model = smf.ols(formula='diff ~ lag_1', data=df_supervised)</span><span id="22ff" class="oa mq je ou b gy pc oz l pa pb"># Fit the regression<br/>model_fit = model.fit()</span><span id="042c" class="oa mq je ou b gy pc oz l pa pb"># Extract the adjusted r-squared<br/>regression_adj_rsq = model_fit.rsquared_adj<br/>print(regression_adj_rsq)</span></pre><p id="53a8" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">那么上面发生了什么？</p><p id="a1a4" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">基本上，我们拟合一个线性回归模型(OLS——普通最小二乘法)，并计算调整后的 R 平方。对于上面的例子，我们只是使用了<strong class="le jo"> lag_1 </strong>来看看它在多大程度上解释了列<strong class="le jo"> diff </strong>中的变化。这个代码块的输出是:</p><figure class="ol om on oo gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pn"><img src="../Images/a9c00c40e3f5d4a6671ec288b3399d1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fwN8SLLao-CWP6zzmP135Q.png"/></div></div></figure><p id="9670" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">lag_1 解释了 3%的变异。让我们看看其他的:</p><figure class="ol om on oo gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi po"><img src="../Images/463d6346b32ab7c75e837d05bf636351.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p--6IWhdJgUg0SvI3SJtng.png"/></div></div></figure><p id="c30c" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">再增加四个功能，得分从 3%增加到 44%。</p><p id="47fd" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">如果我们使用整个功能集，得分如何:</p><figure class="ol om on oo gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pp"><img src="../Images/d29efd30457d1fd0ce49c55c3f17a82d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zCscLi3Hix8FxAOBxJQ4Tw.png"/></div></div></figure><p id="24c0" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">结果令人印象深刻，因为分数是 98%。现在，我们可以在扩展数据后自信地构建我们的模型。但是在缩放之前还有一个步骤。我们应该将数据分成训练集和测试集。作为测试集，我们选择了过去 6 个月的销售额。</p><pre class="ol om on oo gt ot ou ov ow aw ox bi"><span id="d554" class="oa mq je ou b gy oy oz l pa pb">#import MinMaxScaler and create a new dataframe for LSTM model<br/>from sklearn.preprocessing import MinMaxScaler<br/>df_model = df_supervised.drop(['sales','date'],axis=1)</span><span id="87ee" class="oa mq je ou b gy pc oz l pa pb">#split train and test set<br/>train_set, test_set = df_model[0:-6].values, df_model[-6:].values</span></pre><p id="a2a6" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">作为缩放器，我们将使用 MinMaxScaler，它将在-1 和 1:</p><pre class="ol om on oo gt ot ou ov ow aw ox bi"><span id="f8ef" class="oa mq je ou b gy oy oz l pa pb">#apply Min Max Scaler<br/>scaler = MinMaxScaler(feature_range=(-1, 1))<br/>scaler = scaler.fit(train_set)<br/># reshape training set<br/>train_set = train_set.reshape(train_set.shape[0], train_set.shape[1])<br/>train_set_scaled = scaler.transform(train_set)</span><span id="6ef0" class="oa mq je ou b gy pc oz l pa pb"># reshape test set<br/>test_set = test_set.reshape(test_set.shape[0], test_set.shape[1])<br/>test_set_scaled = scaler.transform(test_set)</span></pre><h2 id="0b43" class="oa mq je bd mr ob oc dn mv od oe dp mz ll of og nb lp oh oi nd lt oj ok nf jk bi translated">建立 LSTM 模式</h2><p id="7e56" class="pw-post-body-paragraph lc ld je le b lf nh ko lh li ni kr lk ll nj ln lo lp nk lr ls lt nl lv lw lx im bi translated">一切准备就绪，构建我们的第一个深度学习模型。让我们从缩放数据集创建要素和标注集:</p><pre class="ol om on oo gt ot ou ov ow aw ox bi"><span id="3da4" class="oa mq je ou b gy oy oz l pa pb">X_train, y_train = train_set_scaled[:, 1:], train_set_scaled[:, 0:1]<br/>X_train = X_train.reshape(X_train.shape[0], 1, X_train.shape[1])</span><span id="60c1" class="oa mq je ou b gy pc oz l pa pb">X_test, y_test = test_set_scaled[:, 1:], test_set_scaled[:, 0:1]<br/>X_test = X_test.reshape(X_test.shape[0], 1, X_test.shape[1])</span></pre><p id="6d9b" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">让我们来拟合我们的 LSTM 模型:</p><pre class="ol om on oo gt ot ou ov ow aw ox bi"><span id="7053" class="oa mq je ou b gy oy oz l pa pb">model = Sequential()<br/>model.add(LSTM(4, batch_input_shape=(1, X_train.shape[1], X_train.shape[2]), stateful=True))<br/>model.add(Dense(1))<br/>model.compile(loss='mean_squared_error', optimizer='adam')<br/>model.fit(X_train, y_train, nb_epoch=100, batch_size=1, verbose=1, shuffle=False)</span></pre><p id="8c9d" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">上面的代码块显示了模型如何自我改进并减少每个时期的误差:</p><figure class="ol om on oo gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pq"><img src="../Images/0972e2f9f78b7fa86ccf5afe515f965f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NPktS0rI-fxL2xbO6eyzTg.png"/></div></div></figure><p id="5c2a" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">让我们做预测，看看结果是什么样的:</p><pre class="ol om on oo gt ot ou ov ow aw ox bi"><span id="e76b" class="oa mq je ou b gy oy oz l pa pb">y_pred = model.predict(X_test,batch_size=1)</span><span id="b7a0" class="oa mq je ou b gy pc oz l pa pb">#for multistep prediction, you need to replace X_test values with the predictions coming from t-1</span></pre><div class="ol om on oo gt ab cb"><figure class="pr iv ps pt pu pv pw paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><img src="../Images/9e78fab8ec2927180c6ce36dfa70dee0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1018/format:webp/1*rlj-NIMpDN8bUCmTM-rJgA.png"/></div></figure><figure class="pr iv px pt pu pv pw paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><img src="../Images/b2283a296cf1b40b33683a0962428bf8.png" data-original-src="https://miro.medium.com/v2/resize:fit:984/format:webp/1*1xfrry0jQFuNhSiwa2eAbA.png"/></div><figcaption class="pf pg gj gh gi ph pi bd b be z dk py di pz qa"><strong class="bd pj">y_pred</strong> <strong class="bd pj">vs</strong> <strong class="bd pj">y_test</strong></figcaption></figure></div><p id="9c8b" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">结果看起来相似，但它并没有告诉我们太多，因为这些是显示差异的缩放数据。我们如何能看到实际的销售预测？</p><p id="a038" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">首先，我们需要进行缩放的逆变换:</p><pre class="ol om on oo gt ot ou ov ow aw ox bi"><span id="e7e4" class="oa mq je ou b gy oy oz l pa pb">#reshape y_pred<br/>y_pred = y_pred.reshape(y_pred.shape[0], 1, y_pred.shape[1])</span><span id="000a" class="oa mq je ou b gy pc oz l pa pb">#rebuild test set for inverse transform<br/>pred_test_set = []<br/>for index in range(0,len(y_pred)):<br/>    print np.concatenate([y_pred[index],X_test[index]],axis=1)<br/>    pred_test_set.append(np.concatenate([y_pred[index],X_test[index]],axis=1))</span><span id="3f4d" class="oa mq je ou b gy pc oz l pa pb">#reshape pred_test_set<br/>pred_test_set = np.array(pred_test_set)<br/>pred_test_set = pred_test_set.reshape(pred_test_set.shape[0], pred_test_set.shape[2])</span><span id="ef41" class="oa mq je ou b gy pc oz l pa pb">#inverse transform<br/>pred_test_set_inverted = scaler.inverse_transform(pred_test_set)</span></pre><p id="eda6" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">第二，我们需要建立一个有日期和预测的数据框架。转变后的预测显示了不同之处。我们应该计算预测的销售数字:</p><pre class="ol om on oo gt ot ou ov ow aw ox bi"><span id="91b2" class="oa mq je ou b gy oy oz l pa pb">#create dataframe that shows the predicted sales<br/>result_list = []<br/>sales_dates = list(df_sales[-7:].date)<br/>act_sales = list(df_sales[-7:].sales)<br/>for index in range(0,len(pred_test_set_inverted)):<br/>    result_dict = {}<br/>    result_dict['pred_value'] = int(pred_test_set_inverted[index][0] + act_sales[index])<br/>    result_dict['date'] = sales_dates[index+1]<br/>    result_list.append(result_dict)<br/>df_result = pd.DataFrame(result_list)</span><span id="6780" class="oa mq je ou b gy pc oz l pa pb">#for multistep prediction, replace act_sales with the predicted sales</span></pre><p id="b74d" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">输出:</p><figure class="ol om on oo gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi qb"><img src="../Images/b86d7035a606c2ea14a5bb3b2ccc74e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mlQv5pIfv1EvCEI2Yz5zYw.png"/></div></div></figure><p id="502a" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">太好了！我们已经预测了未来六个月的销售数字。让我们在图中检查它们，看看我们的模型有多好:</p><pre class="ol om on oo gt ot ou ov ow aw ox bi"><span id="5276" class="oa mq je ou b gy oy oz l pa pb">#merge with actual sales dataframe<br/>df_sales_pred = pd.merge(df_sales,df_result,on='date',how='left')</span><span id="0894" class="oa mq je ou b gy pc oz l pa pb">#plot actual and predicted<br/>plot_data = [<br/>    go.Scatter(<br/>        x=df_sales_pred['date'],<br/>        y=df_sales_pred['sales'],<br/>        name='actual'<br/>    ),<br/>        go.Scatter(<br/>        x=df_sales_pred['date'],<br/>        y=df_sales_pred['pred_value'],<br/>        name='predicted'<br/>    )<br/>    <br/>]</span><span id="caae" class="oa mq je ou b gy pc oz l pa pb">plot_layout = go.Layout(<br/>        title='Sales Prediction'<br/>    )<br/>fig = go.Figure(data=plot_data, layout=plot_layout)<br/>pyoff.iplot(fig)</span></pre><p id="ad77" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">实际与预测:</p><figure class="ol om on oo gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi qc"><img src="../Images/1d269ca5b3cf814f0007a0c976529e46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UnE3nID1G8SW8h8STHLe9A.png"/></div></div></figure><p id="e5b0" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">对于一个简单的模型来说看起来相当不错。</p><p id="ba61" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">我们可以对这个模型做的一个改进是添加假期、休息和其他季节性影响。它们可以简单地作为新功能添加。</p><p id="f5bf" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">通过使用这个模型，我们有了基线销售预测。但是我们如何预测促销对销售的影响呢？我们将在第 7 部分对此进行研究。</p><p id="e909" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">你可以在这里找到这篇文章的 Jupyter 笔记本。</p></div><div class="ab cl qd qe hx qf" role="separator"><span class="qg bw bk qh qi qj"/><span class="qg bw bk qh qi qj"/><span class="qg bw bk qh qi"/></div><div class="im in io ip iq"><p id="42e9" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">需要帮助来发展你的公司吗？点击这里，与我<a class="ae ly" href="https://app.growthmentor.com/mentors/baris-karaman" rel="noopener ugc nofollow" target="_blank">一起预订免费课程。</a></p></div></div>    
</body>
</html>