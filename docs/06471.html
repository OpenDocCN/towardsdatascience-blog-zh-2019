<html>
<head>
<title>Building a Topic Modeling Pipeline with spaCy and Gensim</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 spaCy 和 Gensim 构建主题建模管道</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/building-a-topic-modeling-pipeline-with-spacy-and-gensim-c5dc03ffc619?source=collection_archive---------1-----------------------#2019-09-17">https://towardsdatascience.com/building-a-topic-modeling-pipeline-with-spacy-and-gensim-c5dc03ffc619?source=collection_archive---------1-----------------------#2019-09-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/03a19b75eb1ca6b765bbba451c76ed53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f5AXwTyl0ZYOdMYxsUd3hQ.png"/></div></div></figure><p id="1cbc" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">像大多数编程语言一样，Python 有大量优秀的库和模块可供选择。当然，总的来说，这绝对是个好主意，但这也意味着有时模块之间并不总是能很好地配合。在这个简短的教程中，我将向您展示如何将 spaCy 与 Gensim 连接起来，以创建一个连贯的主题建模管道。</p><p id="0d3b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">是啊，太好了。什么是主题模型？</p><p id="a31a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">好问题。我想过重写维基百科的定义，然后我想我可能应该给你维基百科的定义:</p><blockquote class="kz la lb"><p id="a6b6" class="kb kc lc kd b ke kf kg kh ki kj kk kl ld kn ko kp le kr ks kt lf kv kw kx ky im bi translated">在<a class="ae lg" href="https://en.wikipedia.org/wiki/Machine_learning" rel="noopener ugc nofollow" target="_blank">机器学习</a>和<a class="ae lg" href="https://en.wikipedia.org/wiki/Natural_language_processing" rel="noopener ugc nofollow" target="_blank">自然语言处理</a>中，<strong class="kd iu">主题模型</strong>是一种<a class="ae lg" href="https://en.wikipedia.org/wiki/Statistical_model" rel="noopener ugc nofollow" target="_blank">统计模型</a>，用于发现文档集合中出现的抽象“主题”。</p></blockquote><p id="b222" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">基本上，我们在寻找与讨论语料库的内容最相关的词或主题的集合。对于本教程，我们将使用潜在的狄利克雷分配(LDA)。</p><p id="14d4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">关于库的简短说明</strong></p><p id="311a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">对于那些不知道的人来说，<a class="ae lg" href="https://radimrehurek.com/gensim/" rel="noopener ugc nofollow" target="_blank"> Gensim </a>是主题建模的杰出库之一。同时，<a class="ae lg" href="https://spacy.io/" rel="noopener ugc nofollow" target="_blank"> spaCy </a>是一个强大的自然语言处理库，在过去几年中赢得了许多崇拜者。</p></div><div class="ab cl lh li hx lj" role="separator"><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm"/></div><div class="im in io ip iq"><p id="1601" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">建造管道</strong></p><figure class="lp lq lr ls gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi lo"><img src="../Images/1b96f9006caa7e60de8950d8248b5a14.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*jxprZPyhDxjvlsbIYlhBcg.gif"/></div></div></figure><p id="a0e5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">首先，让我们导入我们的库:</p><figure class="lp lq lr ls gt ju"><div class="bz fp l di"><div class="lt lu l"/></div></figure><p id="f24f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这里需要注意一些事情:</p><ul class=""><li id="bf88" class="lv lw it kd b ke kf ki kj km lx kq ly ku lz ky ma mb mc md bi translated">如果你是数据科学的新手，特别是 Python，注意你必须 pip 安装 Gensim 和 spaCy。</li><li id="7473" class="lv lw it kd b ke me ki mf km mg kq mh ku mi ky ma mb mc md bi translated">spaCy 有几种不同的型号可供选择。为了便于说明，我使用了大型的通用 web 模块，但是请使用对您有意义的内容。这需要通过命令行下载。查看模型页面<a class="ae lg" href="https://spacy.io/models" rel="noopener ugc nofollow" target="_blank">点击</a>了解更多信息。</li><li id="18c3" class="lv lw it kd b ke me ki mf km mg kq mh ku mi ky ma mb mc md bi translated">如果你以前没有使用过 tqdm，它是一个允许你创建进度条来跟踪你的代码处理时间的模块。</li><li id="0bcc" class="lv lw it kd b ke me ki mf km mg kq mh ku mi ky ma mb mc md bi translated">pprint 是为了让我们看的时候主题的格式更好一点。</li></ul><p id="daf8" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们将使用纽约时报头版文章的数据集。实际的文章本身在我们的数据框架的“内容”栏中。</p><figure class="lp lq lr ls gt ju"><div class="bz fp l di"><div class="lt lu l"/></div></figure><p id="4b04" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在是有趣的部分——我们将建立管道！默认空间管道的布局如下:</p><ul class=""><li id="e80a" class="lv lw it kd b ke kf ki kj km lx kq ly ku lz ky ma mb mc md bi translated"><strong class="kd iu">记号赋予器</strong>:将全文分解成单独的记号。</li><li id="1d62" class="lv lw it kd b ke me ki mf km mg kq mh ku mi ky ma mb mc md bi translated"><strong class="kd iu">标记器</strong>:用词性来标记每个标记。</li><li id="da3c" class="lv lw it kd b ke me ki mf km mg kq mh ku mi ky ma mb mc md bi translated"><strong class="kd iu">解析器</strong>:解析成名词块等。</li><li id="c3e6" class="lv lw it kd b ke me ki mf km mg kq mh ku mi ky ma mb mc md bi translated"><strong class="kd iu">命名实体识别器(NER) </strong>:标记命名实体，如美国</li></ul><p id="303e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们并不真的需要所有这些元素，因为我们最终不会传递 spaCy 的本机输出。文档由组成。令牌)，因此标记的信息不会通过。无论如何，NER 将会对我们有用。现在我将把它们都留在这里，同样是为了说明的目的，尽管这会使管道的效率有所降低。</p><p id="a46a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">除了现成的功能之外，spaCy 还允许您使用自己的功能构建自定义管道，这就是我们将获得真正价值的地方。spaCy 有一个健壮的停用词列表和内置的 lemmatizer，但是我们需要将该功能添加到管道中。</p><p id="e279" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">对于那些不熟悉停用词的人来说，它们基本上是普通的词，不会真正为您的模型增加很多预测价值。例如，如果你不把单词“the”从你的语料库中删除，它可能会出现在你生成的每个主题中，考虑到“the”在英语中的使用频率。</p><p id="63ef" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">请注意，没有一个词，即使是像“the”这样无处不在的词，会自动成为停用词。停用词通常由手头的特定任务决定。例如，我的任务是给《纽约时报》的头版文章做主题模型，我会用一些你在不同的上下文中不会想到的停用词。我可以将它们添加到 spaCy 的默认停用词列表中，如下所示:</p><figure class="lp lq lr ls gt ju"><div class="bz fp l di"><div class="lt lu l"/></div></figure><p id="3caa" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我没有太疯狂地更新我的停用词，只是添加了一些精选的停用词，以向您展示我的思维过程:</p><ul class=""><li id="29ff" class="lv lw it kd b ke kf ki kj km lx kq ly ku lz ky ma mb mc md bi translated">《纽约时报》通常在文章中使用敬语，所以我们会得到很多我们不需要的“先生”、“夫人”等。</li><li id="f68e" class="lv lw it kd b ke me ki mf km mg kq mh ku mi ky ma mb mc md bi translated">由于文章中会充满引用，我们也将“说”添加到我们的列表中。</li><li id="4294" class="lv lw it kd b ke me ki mf km mg kq mh ku mi ky ma mb mc md bi translated">许多文章都有署名，因为大多数是政治性的，“华盛顿”经常出现。</li><li id="b335" class="lv lw it kd b ke me ki mf km mg kq mh ku mi ky ma mb mc md bi translated">最后，spaCy 足够聪明，可以在词汇化时将一些缩写分解成它们的组成词(比如“不是”分解成“是”和“不是”)，但“' s”却不是这样。所以那个也要拿走。</li><li id="20e8" class="lv lw it kd b ke me ki mf km mg kq mh ku mi ky ma mb mc md bi translated">另一个重要的警告是，我在这里没有做任何语法分析，这是当你在寻找文本中最常见的两个以上的单词短语时。在这种情况下，我可能会做出稍微不同的选择。</li></ul><p id="6c34" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们还需要对文本进行词汇化，也就是简单地将每个单词简化为它的词根。所以比如“going”和“goes”都简化为“go”。“更好”会被简化为“好”。</p><p id="3a30" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">好了，现在让我们构建我们的管道，为词汇化和停用词移除添加函数:</p><figure class="lp lq lr ls gt ju"><div class="bz fp l di"><div class="lt lu l"/></div></figure><p id="d548" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这里重要的一点是要确保为最终输出返回 token.text。这将把每个令牌对象转换成一个字符串对象，因此它可以在 Gensim 中使用。</p><p id="d899" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">对于 Gensim，我最终需要创建一个列表列表:</p><figure class="lp lq lr ls gt ju"><div class="bz fp l di"><div class="lt lu l"/></div></figure><p id="8a53" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">下面是其中一篇文章在通过管道后的样子:</p><figure class="lp lq lr ls gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mj"><img src="../Images/ba417d22278915841cd65d6280f0b83e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KDwKe_t0ZZ3XpEQ78cKRrg.png"/></div></div></figure><p id="c9d5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在我们已经处理了文章，我们需要创建主题模型所需的输入:</p><figure class="lp lq lr ls gt ju"><div class="bz fp l di"><div class="lt lu l"/></div></figure><p id="6bc3" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">最后，我们可以运行模型本身:</p><figure class="lp lq lr ls gt ju"><div class="bz fp l di"><div class="lt lu l"/></div></figure><p id="2c31" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">最后，一些示例主题(注意 pprint 以帮助格式化):</p><figure class="lp lq lr ls gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mk"><img src="../Images/c18c578c57e852977be3b1c6fe3f2eaa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nPoOCoArLalIUqC0LgHezA.png"/></div></div></figure><p id="bd46" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">就是这样！希望对你有帮助！</p></div></div>    
</body>
</html>