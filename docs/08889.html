<html>
<head>
<title>Telco Customer Churn Prediction</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">电信客户流失预测</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/telco-customer-churn-prediction-72f5cbfb8964?source=collection_archive---------8-----------------------#2019-11-27">https://towardsdatascience.com/telco-customer-churn-prediction-72f5cbfb8964?source=collection_archive---------8-----------------------#2019-11-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="761c" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">为流失预测建立机器学习模型</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/74b5db0ad5d1e4e96084b6f001327f65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qiLMpHZZ9DHPMceajckxgg.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Photo by <a class="ae ky" href="https://unsplash.com/@kmuza?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Carlos Muza</a> on <a class="ae ky" href="https://unsplash.com/s/photos/data?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="1b78" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">客户流失，也称为客户流失，发生在客户停止与公司做生意或停止使用公司的服务时。通过了解和监控流失率，公司能够确定他们的客户保持成功率，并确定改进策略。我们将使用机器学习模型来理解准确的客户行为和属性，这些行为和属性标志着客户流失的风险和时机。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="1fa9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">了解我们的数据集:</strong></p><p id="fb4d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将使用 Kaggle 的电信客户流失数据集。原始数据集包含 7043 个条目。所有条目都有几个特征和一列说明客户是否搅拌过。<br/>为了更好地理解数据，我们将首先把它加载到 pandas 中，并在一些非常基本的命令的帮助下探索它。</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="dbda" class="mh mi it md b gy mj mk l ml mm">import numpy as np<br/>import pandas as pd<br/>from sklearn.preprocessing import MinMaxScaler<br/>from sklearn.cluster import KMeans<br/>import matplotlib.pyplot as plt <br/>import seaborn as sns</span><span id="7e79" class="mh mi it md b gy mn mk l ml mm">%matplotlib inline<br/>from sklearn.model_selection import train_test_split</span><span id="7801" class="mh mi it md b gy mn mk l ml mm">#Loading the data<br/>df = pd.read_csv(r’...Churn\telco_customer.csv’)<br/></span><span id="9730" class="mh mi it md b gy mn mk l ml mm">df.info() </span><span id="f2a5" class="mh mi it md b gy mn mk l ml mm">&lt;class ‘pandas.core.frame.DataFrame’&gt; <br/>RangeIndex: 7043 entries, 0 to 7042 <br/>Data columns (total 21 columns): <br/>customerID 7043 non-null object <br/>gender 7043 non-null object <br/>SeniorCitizen 7043 non-null int64 <br/>Partner 7043 non-null object<br/>Dependents 7043 non-null object<br/>tenure 7043 non-null int64 <br/>PhoneService 7043 non-null object <br/>MultipleLines 7043 non-null object <br/>InternetService 7043 non-null object <br/>OnlineSecurity 7043 non-null object <br/>OnlineBackup 7043 non-null object <br/>DeviceProtection 7043 non-null object <br/>TechSupport 7043 non-null object <br/>StreamingTV 7043 non-null object <br/>StreamingMovies 7043 non-null object <br/>Contract 7043 non-null object <br/>PaperlessBilling 7043 non-null object <br/>PaymentMethod 7043 non-null object <br/>MonthlyCharges 7043 non-null float64 <br/>TotalCharges 7043 non-null object <br/>Churn 7043 non-null object <br/>dtypes: float64(1), int64(2), object(18) memory usage: 1.1+ MB</span></pre><p id="1122" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">df.info()为我们提供了每一列的详细信息。我们可以看到我们的数据分为三种类型；</p><ul class=""><li id="d0be" class="mo mp it lb b lc ld lf lg li mq lm mr lq ms lu mt mu mv mw bi translated">对象:对象格式意味着变量是分类的。我们数据集中的分类变量包括:客户 ID、性别、合作伙伴、家属、电话服务、多条线路、互联网服务、在线安全、在线备份、设备保护、技术支持、流媒体电视、流媒体电影、合同、无纸化账单、支付方式、总费用和客户流失。</li><li id="da94" class="mo mp it lb b lc mx lf my li mz lm na lq nb lu mt mu mv mw bi translated">int64:代表整数变量。老年公民和终身职位都是这种格式。</li><li id="7539" class="mo mp it lb b lc mx lf my li mz lm na lq nb lu mt mu mv mw bi translated">float64:表示包含一些小数值的变量。它们也是数字变量。在我们的数据集中，这种格式只有一个变量，即每月费用。</li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="26cf" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">探索性数据分析</strong></p><p id="2ca9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">本节的<strong class="lb iu"> </strong>目标是熟悉我们的数据。我们将进行双变量分析。这是分析数据的最简单的形式，我们检查每个变量与流失率的关系。对于分类特征，我们可以使用频率表或柱状图来计算特定变量中每个类别的数量。对于数字特征，概率密度图可用于查看变量的分布。</p><p id="4242" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">分类变量的所有可视化将在 tableau public 中完成。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/d6e1494012cf529c9cb0c8feeb67f7f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1298/format:webp/1*VfESSmMotFH8q8tWjY83FQ.png"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/5c69159f7bdd5868f882c3f81fd99996.png" data-original-src="https://miro.medium.com/v2/resize:fit:1298/format:webp/1*jeBMVGkL_Ee1Xx9KMj53NQ.png"/></div></figure><p id="fe36" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从上面的柱状图可以得出以下推论:</p><p id="4b33" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">男性和女性的流失率几乎相等。</p><p id="35f9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">老年人的流失率更高。</p><p id="2df2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">拥有电话服务的客户流失率更高。</p><p id="5d4f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">与没有合作伙伴&amp;家属的客户相比，有<strong class="lb iu"> </strong>合作伙伴<strong class="lb iu"> </strong>和家属的客户流失率较低。</p><p id="4035" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">与其他支付方式相比，使用电子支付方式的客户流失率更高。</p><p id="58b2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">没有互联网服务的客户流失率较低。</p><p id="5ab1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">光纤互联网服务的流失率要高得多。没有 OnlineSecurity、OnlineBackup 和 TechSupport 等服务的客户在过去的一个月里离开了该平台。</p><p id="1261" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在让我们看看数字变量。</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="93fe" class="mh mi it md b gy mj mk l ml mm">plt.figure(1), plt.subplot(121), sns.distplot(df['tenure']);<br/>plt.figure(1), plt.subplot(121), sns.distplot(df['MonthlyCharges']);<br/>plt.figure(1), plt.subplot(121), sns.distplot(df['TotalCharges']);</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/cb80c3bb913d5ec18670b6e5ce0f525a.png" data-original-src="https://miro.medium.com/v2/resize:fit:396/format:webp/1*_CAnKm_OUEcnUnqYFZu8Jg.png"/></div></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/1a4e76548d995c9ee919bb7271f402a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:396/format:webp/1*tohf1G1FyBtY_hY_wpVI1w.png"/></div></figure><p id="3b11" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">资料准备&amp;特色工程:</strong></p><p id="6ad1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这部分是机器学习的基础部分。如果这一部分做得不好，我们的模型就不会工作。在这一节中，我们将通过删除不相关的数据、处理丢失的值以及将变量转换为适当的数据类型来清理数据集。</p><p id="531e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">处理无关数据和缺失值</p><p id="f05c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们的数据集中，我们可以看到我们的模型不需要客户 ID，所以我们删除了变量。我们不需要处理缺失值，因为该数据集中没有缺失值。</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="f8b2" class="mh mi it md b gy mj mk l ml mm">df.drop([‘customerID’], axis=1, inplace=True)</span></pre><p id="7404" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将分类数据转换为数字数据</p><p id="459d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">机器学习只处理数值。因此，我们需要将我们的分类值转换成数值。通过使用熊猫函数“get_dummies()”，我们可以用“gender_Female”和“gender_Male”替换性别列。我们将使用 df.info()向我们展示哪些是分类的，哪些是数字的。</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="1727" class="mh mi it md b gy mj mk l ml mm">df.info()</span><span id="6534" class="mh mi it md b gy mn mk l ml mm">&lt;class ‘pandas.core.frame.DataFrame’&gt; <br/>RangeIndex: 7043 entries, 0 to 7042<br/>Data columns (total 21 columns): </span><span id="6ceb" class="mh mi it md b gy mn mk l ml mm">customerID 7043 non-null object <br/>gender 7043 non-null object <br/>SeniorCitizen 7043 non-null int64 <br/>Partner 7043 non-null object <br/>Dependents 7043 non-null object <br/>tenure 7043 non-null int64 <br/>PhoneService 7043 non-null object<br/>MultipleLines 7043 non-null object<br/>InternetService 7043 non-null object <br/>OnlineSecurity 7043 non-null object <br/>OnlineBackup 7043 non-null object <br/>DeviceProtection 7043 non-null object <br/>TechSupport 7043 non-null object <br/>StreamingTV 7043 non-null object <br/>StreamingMovies 7043 non-null object <br/>Contract 7043 non-null object <br/>PaperlessBilling 7043 non-null object <br/>PaymentMethod 7043 non-null object <br/>MonthlyCharges 7043 non-null float64 <br/>TotalCharges 7043 non-null object <br/>Churn 7043 non-null object <br/>dtypes: float64(1), int64(2), object(18) memory usage: 1.1+ MB</span></pre><p id="9ae9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从上面的结果中，我们可以看到数据类型为 object 的变量需要转换为 numerical。</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="cc0e" class="mh mi it md b gy mj mk l ml mm">df = pd.get_dummies(df, columns = [‘gender’, ‘Partner’,   ‘Dependents’,’PhoneService’,’MultipleLines’,’InternetService’,<br/>‘OnlineSecurity’,’OnlineBackup’,’DeviceProtection’,’TechSupport’,’StreamingTV’,‘StreamingMovies’,’Contract’,’PaperlessBilling’,’PaymentMethod’,’Churn’], drop_first = True)</span></pre><p id="ca66" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用 df.info()来检查我们所有的变量是否都被转换为适当的数据类型是明智的。在这一步之后，我注意到 total charges 仍然有一个 object 数据类型。因此，我将使用 pd.numeric()函数将其转换为浮点数。</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="b172" class="mh mi it md b gy mj mk l ml mm">df[‘TotalCharges’] = pd.to_numeric(df.TotalCharges, errors = ‘coerce’)<br/>df.drop([‘TotalCharges’], axis = 1, inplace = True)</span></pre><p id="a434" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">分割数据集。</p><p id="df36" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先我们的模型需要被训练，其次我们的模型需要被测试。因此，最好有两个不同的数据集。至于现在我们只有一个，相应拆分数据是很常见的。x 是自变量的数据，Y 是因变量的数据。测试大小变量决定了数据的分割比例。在 80 的训练/ 20 的测试比例中这样做是很常见的。</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="73ee" class="mh mi it md b gy mj mk l ml mm">df[‘Churn_Yes’] = df[‘Churn_Yes’].astype(int)<br/>Y = df[“Churn_Yes”].values<br/>X = df.drop(labels = [“Churn_Yes”],axis = 1)<br/># Create Train &amp; Test Data<br/>from sklearn.model_selection import train_test_split<br/>X_train, X_test, y_train, y_test = train_test_split(X, Y, test_size=0.2, random_state=101)</span></pre><h1 id="f255" class="ne mi it bd nf ng nh ni nj nk nl nm nn jz no ka np kc nq kd nr kf ns kg nt nu bi translated">逻辑回归和模型测试</h1><p id="9b91" class="pw-post-body-paragraph kz la it lb b lc nv ju le lf nw jx lh li nx lk ll lm ny lo lp lq nz ls lt lu im bi translated">让我们制作第一个模型来预测目标变量。我们将从用于预测二元结果的逻辑回归开始。</p><p id="576d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们将使用 scikit-learn (sklearn)来制作不同的模型，这是 Python 的一个开源库。它是最有效的工具之一，包含许多可用于 Python 建模的内置函数。</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="f64d" class="mh mi it md b gy mj mk l ml mm">from sklearn.linear_model import LogisticRegression<br/>model = LogisticRegression()<br/>result = model.fit(X_train, y_train)</span></pre><p id="b5cb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">数据集分为训练和验证两部分。让我们从 sklearn 导入 LogisticRegression 和 accuracy_score 并拟合逻辑回归模型。</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="8eb9" class="mh mi it md b gy mj mk l ml mm">from sklearn import metrics<br/>prediction_test = model.predict(X_test)# Print the prediction accuracy<br/>print (metrics.accuracy_score(y_test, prediction_test))</span></pre><p id="9aef" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi">0.800567778566</p><p id="ad23" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">因此，我们的预测几乎 81%准确，也就是说，我们已经正确识别了 80%的流失率。因此，为了减少流失并及时采取正确的预防措施，我们想知道哪些独立变量对我们的预测结果影响最大。因此，我们将模型中的系数设置为零，并查看每个变量的权重。</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="c225" class="mh mi it md b gy mj mk l ml mm"><br/>weights = pd.Series(model.coef_[0],<br/> index=X.columns.values)<br/>weights.sort_values(ascending = False)</span></pre><p id="a5b5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">结果如下:</p><pre class="kj kk kl km gt mc md me mf aw mg bi"><span id="6fbc" class="mh mi it md b gy mj mk l ml mm">InternetService_Fiber optic 0.800533 <br/>PaperlessBilling_Yes 0.417392 <br/>PaymentMethod_Electronic check 0.293135 <br/>StreamingTV_Yes 0.267554 <br/>MultipleLines_Yes 0.253773 <br/>SeniorCitizen 0.247112 <br/>StreamingMovies_Yes 0.197304 <br/>MultipleLines_No phone service 0.120019 <br/>PaymentMethod_Mailed check 0.019744 <br/>gender_Male 0.018991 <br/>MonthlyCharges 0.004611 <br/>Partner_Yes 0.000535 <br/>DeviceProtection_Yes -0.021993 <br/>tenure -0.035615 <br/>StreamingTV_No internet service -0.095143 <br/>TechSupport_No internet service -0.095143 <br/>DeviceProtection_No internet service -0.095143 <br/>StreamingMovies_No internet service -0.095143 <br/>OnlineBackup_No internet service -0.095143 <br/>OnlineSecurity_No internet service -0.095143 <br/>InternetService_No -0.095143 <br/>PaymentMethod_Credit card (automatic) -0.156123 <br/>Dependents_Yes -0.182597 <br/>OnlineBackup_Yes -0.190353 <br/>OnlineSecurity_Yes -0.335387 <br/>TechSupport_Yes -0.337772 <br/>PhoneService_Yes -0.551735 <br/>Contract_One year -0.591394 <br/>Contract_Two year -1.257341 <br/>dtype: float64</span></pre><p id="4938" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">可以观察到，一些变量与我们预测的变量成正相关，而一些变量则成负相关。负值的客户表明他们不太可能流失，而正值的客户表明他们可能流失。这些</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="28f6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我写的大部分内容都让我忙于自己的创业公司 analyx。<br/>期待听到你的经历:)</p></div></div>    
</body>
</html>