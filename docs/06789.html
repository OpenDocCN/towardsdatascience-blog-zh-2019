<html>
<head>
<title>Quick Install Guide: Nvidia RAPIDS + BlazingSQL on AWS SageMaker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">快速安装指南:AWS SageMaker 上的 Nvidia RAPIDS + BlazingSQL</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/quick-install-guide-nvidia-rapids-blazingsql-on-aws-sagemaker-cb4ddd809bf5?source=collection_archive---------19-----------------------#2019-09-27">https://towardsdatascience.com/quick-install-guide-nvidia-rapids-blazingsql-on-aws-sagemaker-cb4ddd809bf5?source=collection_archive---------19-----------------------#2019-09-27</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/4624e1fc5747e08ef8e8a682de94bdd3.png" data-original-src="https://miro.medium.com/v2/resize:fit:890/format:webp/1*vNvKOCoNe-_dL3XxEHO6IA.png"/></div></figure></div><div class="ab cl ju jv hu jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="ij ik il im in"><p id="6162" class="pw-post-body-paragraph kb kc iq kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ij bi translated"><a class="ae kz" href="https://rapids.ai/index.html" rel="noopener ugc nofollow" target="_blank"> RAPIDS </a>于 2018 年 10 月 10 日<a class="ae kz" href="https://nvidianews.nvidia.com/news/nvidia-introduces-rapids-open-source-gpu-acceleration-platform-for-large-scale-data-analytics-and-machine-learning" rel="noopener ugc nofollow" target="_blank">发布</a>，从那时起，NVIDIA 的人们夜以继日地工作，为每个版本添加了令人印象深刻的功能。当前版本(<a class="ae kz" href="https://medium.com/rapids-ai/rapids-0-9-a-model-built-to-scale-dafbf4c1e1cb" rel="noopener"> 0.9 </a>)支持的首选安装方法是 Conda 和 Docker ( <a class="ae kz" href="https://medium.com/rapids-ai/rapids-0-7-release-drops-pip-packages-47fc966e9472" rel="noopener"> pip 支持在 0.7 </a>中被取消)。此外，在<a class="ae kz" href="https://rapids.ai/start.html" rel="noopener ugc nofollow" target="_blank"> Google Colab </a>中可以免费获得 RAPIDS it，并且还支持微软的<a class="ae kz" href="https://azure.microsoft.com/en-us/blog/azure-machine-learning-service-now-supports-nvidia-s-rapids/" rel="noopener ugc nofollow" target="_blank"> Azure 机器学习服务</a>。</p><p id="f893" class="pw-post-body-paragraph kb kc iq kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ij bi translated">然而，可能有像我一样的人想要/需要在 AWS SageMaker 中使用 RAPIDS(主要是因为我们的数据已经在 S3 上了)。<strong class="kd ir"> <em class="la">本指南旨在作为快速安装指南。它远非完美，但它可能会为您节省几个小时的试错时间。</em>T15】</strong></p><p id="40d9" class="pw-post-body-paragraph kb kc iq kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ij bi translated">我还将包括<a class="ae kz" href="https://blog.blazingdb.com/blazingsql-install-just-got-easier-363005c81dc5" rel="noopener ugc nofollow" target="_blank"> BlazingSQL </a>，一个基于 cuDF 的 SQL 引擎。作为一名数据科学家，查询数据的能力非常有用！</p><h1 id="51fb" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">要求:</h1><p id="38da" class="pw-post-body-paragraph kb kc iq kd b ke lz kg kh ki ma kk kl km mb ko kp kq mc ks kt ku md kw kx ky ij bi translated">在 SageMaker 上安装 RAPIDS 有两个主要要求:</p><ol class=""><li id="7a62" class="me mf iq kd b ke kf ki kj km mg kq mh ku mi ky mj mk ml mm bi translated">显然你需要一个 GPU 实例。目前在 SageMaker 中只有两种类型的加速实例:ml.p2 (NVIDIA K80)和 ml.p3 (V100)实例。然而，由于 RAPIDS 需要 NVIDIA Pascal 架构或更新的架构，我们只能使用 ml.p3 实例。</li><li id="21fa" class="me mf iq kd b ke mn ki mo km mp kq mq ku mr ky mj mk ml mm bi translated">RAPIDS 需要 NVIDIA 驱动 v410.48+(在 CUDA 10 中)。<a class="ae kz" href="https://aws.amazon.com/about-aws/whats-new/2019/05/new-in-aws-deep-learning-amis-pytorch-1-1-chainer-5-4-cuda10-for-mxnet/" rel="noopener ugc nofollow" target="_blank">AWS 5 月更新了驱动</a>。因此，RAPIDS v0.7 是可以安装在 SageMaker 中的第一个版本。</li></ol><h1 id="b185" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">安装程序</h1><p id="82ae" class="pw-post-body-paragraph kb kc iq kd b ke lz kg kh ki ma kk kl km mb ko kp kq mc ks kt ku md kw kx ky ij bi translated">当前 RAPIDS 稳定版(0.9)的安装过程如下:</p><ol class=""><li id="d56a" class="me mf iq kd b ke kf ki kj km mg kq mh ku mi ky mj mk ml mm bi translated">启动或创建您的 ml.p3 SageMaker 实例。一旦实例被<em class="la">服务</em>打开它。在本指南的剩余部分，我将使用 JupyterLab。</li><li id="5e35" class="me mf iq kd b ke mn ki mo km mp kq mq ku mr ky mj mk ml mm bi translated">在 JupyterLab 中:<em class="la"> Git - &gt;打开终端</em>，打开 shell 并执行以下命令:</li></ol><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="25a8" class="nb lc iq mx b gy nc nd l ne nf">source /home/ec2-user/anaconda3/etc/profile.d/conda.sh<br/>conda create --name rapids_blazing python=3.7<br/>conda activate rapids_blazing </span></pre><p id="fe7c" class="pw-post-body-paragraph kb kc iq kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ij bi translated">我强烈建议创造一个新的环境。如果您尝试在 SageMaker conda python3 环境中安装 RAPIDS，将需要数小时来解决环境问题，并且还可能会产生奇怪的操作(例如，安装 RAPIDS 不支持的 python 2，等等。).</p><p id="de53" class="pw-post-body-paragraph kb kc iq kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ij bi translated">3.Conda 安装了 RAPIDS (0.9)和 BlazingSQL (0.4.3)以及一些其他的包(特别是需要 boto3 和 s3fs 来处理 S3 文件)以及 Sagemaker 包的一些依赖项，sage maker 包将在下一步进行 pip 安装。在 RAPIDS 版本中，dask-cudf 被合并到 cudf 分支中。<em class="la">解决这个环境大概需要 8 分钟</em>:</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="11d2" class="nb lc iq mx b gy nc nd l ne nf">conda install -c rapidsai -c nvidia -c numba -c conda-forge \<br/>              -c anaconda -c rapidsai/label/xgboost \<br/>              -c blazingsql/label/cuda10.0 -c blazingsql \<br/>              "blazingsql-calcite" "blazingsql-orchestrator" \<br/>              "blazingsql-ral" "blazingsql-python" \<br/>              "rapidsai/label/xgboost::xgboost=&gt;0.9" "cudf=0.9" \<br/>              "cuml=0.9" "cugraph=0.9" "dask-cudf=0.9" \<br/>              "python=3.7" "ipykernel" "boto3" \<br/>              "PyYAML&gt;=3.10,&lt;4.3" "urllib3&lt;1.25,&gt;=1.21" \<br/>              "idna&lt;2.8,&gt;=2.5" "boto" "s3fs" "dask" \<br/>              "anaconda::cudatoolkit=10.0"</span></pre><p id="6a88" class="pw-post-body-paragraph kb kc iq kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ij bi translated">4.安装 Sagemaker 和 flatbuffers 包，并注册要在 JupyterLab 中使用的内核:</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="9468" class="nb lc iq mx b gy nc nd l ne nf">pip install flatbuffers sagemaker<br/>ipython kernel install --user --name=rapids_blazing</span></pre><p id="114e" class="pw-post-body-paragraph kb kc iq kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ij bi translated">5.等待大约一分钟，然后打开或创建一个新的笔记本，你应该能够选择新的内核:<em class="la">内核- &gt;改变内核- &gt;康达 _ 急流 _ 炽热。</em>注意:请不要使用 rapids _ flashing 内核来代替 conda _ rapids _ blazing，因为如果使用该内核，BlazinSQL 将无法运行。</p><p id="6a9f" class="pw-post-body-paragraph kb kc iq kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ij bi translated">6.让我们首先导入 RAPIDS 和 BlazingSQL 包:</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="12ab" class="nb lc iq mx b gy nc nd l ne nf">import cudf<br/>import cuml<br/>import dask<br/>import pandas as pd<br/>import dask_cudf<br/>from blazingsql import BlazingContext<br/>bc = BlazingContext()</span></pre><p id="398a" class="pw-post-body-paragraph kb kc iq kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ij bi translated">我们应该得到一个“<em class="la">连接建立</em>消息。</p><p id="60f2" class="pw-post-body-paragraph kb kc iq kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ij bi translated">7.让我们做第一个测试来检查 cuDF 是否正常工作:</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="591d" class="nb lc iq mx b gy nc nd l ne nf">df = cudf.DataFrame()<br/>df[‘key’] = [0, 1, 2, 3, 4]<br/>df[‘val’] = [float(i + 10) for i in range(5)]<br/>print(df)</span></pre><p id="63ec" class="pw-post-body-paragraph kb kc iq kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ij bi translated">8.测试累计:</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="2020" class="nb lc iq mx b gy nc nd l ne nf">df_float = cudf.DataFrame()<br/>df_float[‘0’] = [1.0, 2.0, 5.0]<br/>df_float[‘1’] = [4.0, 2.0, 1.0]<br/>df_float[‘2’] = [4.0, 2.0, 1.0]<br/>dbscan_float = cuml.DBSCAN(eps=1.0, min_samples=1)<br/>dbscan_float.fit(df_float)<br/>print(dbscan_float.labels_)</span></pre><p id="992a" class="pw-post-body-paragraph kb kc iq kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ij bi translated">9.如果没有错误，我们已经成功导入并使用了基本的 cuDF 和 cuML 功能。下一步是读取和使用存储在 S3 的数据。例如，使用 gzip 压缩读取一些 csv 文件:</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="1b4d" class="nb lc iq mx b gy nc nd l ne nf">import boto3<br/>import sagemaker<br/>from sagemaker import get_execution_role<br/>role = get_execution_role()<br/>df= dask_cudf.read_csv(‘s3://your-bucket/your-path-to-files/files*.csv.gz’, compression=’gzip’)<br/>df2=df.compute()</span></pre><p id="b2d0" class="pw-post-body-paragraph kb kc iq kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ij bi translated">9.现在我们可以使用 BlazinSQL 来查询我们的数据:</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="f804" class="nb lc iq mx b gy nc nd l ne nf">bc.create_table(‘test’, df2)<br/>result = bc.sql(‘SELECT count(*) FROM test’).get()<br/>result_gdf = result.columns<br/>print(result_gdf)</span></pre><p id="05cc" class="pw-post-body-paragraph kb kc iq kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ij bi translated">我将尝试在安装过程之外更新和扩展这个指南。同时，我得到了三个有趣的结果:</p><ul class=""><li id="985e" class="me mf iq kd b ke kf ki kj km mg kq mh ku mi ky ng mk ml mm bi translated"><em class="la">与 pandas read_csv 相比，cuDF (v0.10) read_csv 提高了 7 倍。</em></li><li id="df80" class="me mf iq kd b ke mn ki mo km mp kq mq ku mr ky ng mk ml mm bi translated"><em class="la">与 sklearn LogisticRegression 相比，cuML LogisticRegression 提高了 32 倍。</em></li><li id="4e39" class="me mf iq kd b ke mn ki mo km mp kq mq ku mr ky ng mk ml mm bi translated"><em class="la">与非 GPU xgboost(' tree _ method ':' GPU _ hist ')相比，GPU xgboost ('tree_method':'hist ')性能提高了 7 倍。</em></li></ul><h1 id="9f16" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论:</h1><p id="fe3d" class="pw-post-body-paragraph kb kc iq kd b ke lz kg kh ki ma kk kl km mb ko kp kq mc ks kt ku md kw kx ky ij bi translated">展望未来，RAPIDS 版本将为 AWS 用户提供一些不错的特性。例如，cudf.read_csv 将能够直接读取 s3 文件，dask-cudf.read_parquet 在读取 s3 文件时的一个错误已被修复，并将包含在 0.10 中。我感谢 RAPIDS 团队对我报告的一些 github 问题的迅速关注和解决。</p><p id="4337" class="pw-post-body-paragraph kb kc iq kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ij bi translated">欢迎对本指南提出任何意见。<em class="la">愿 GPU 加速您的分析！</em>！</p></div><div class="ab cl ju jv hu jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="ij ik il im in"><p id="79e6" class="pw-post-body-paragraph kb kc iq kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ij bi translated"><em class="la">推特:@艾文佐</em></p><p id="1c98" class="pw-post-body-paragraph kb kc iq kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky ij bi translated"><em class="la">领英:</em><a class="ae kz" href="https://www.linkedin.com/in/dr-iván-venzor-64322732/" rel="noopener ugc nofollow" target="_blank">【https://www.linkedin.com/in/dr-iván-venzor-64322732/】T21</a></p></div></div>    
</body>
</html>