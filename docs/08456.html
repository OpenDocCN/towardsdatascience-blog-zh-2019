<html>
<head>
<title>Product Category Prediction with Time-series Using ARIMA</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于 ARIMA 的时间序列产品类别预测</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/product-category-prediction-with-time-series-using-arima-58dc4d3a7ae2?source=collection_archive---------27-----------------------#2019-11-16">https://towardsdatascience.com/product-category-prediction-with-time-series-using-arima-58dc4d3a7ae2?source=collection_archive---------27-----------------------#2019-11-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/c22889fd2b1f3b09b7775747a28f8810.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8-WnTYSho5cTX1Rq3P4jZQ.jpeg"/></div></div></figure><p id="89fc" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi kz translated">假设我们手头有现有数据，可以告诉我们某一特定产品类别的市场现状。现在，我们能够看到趋势和运动，以及每个时期的重大事件，这些事件对事件的积极或消极转变产生了影响。</p><p id="34ba" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">下面的图表显示了美国销售的新车总数。从 2002 年到 2019 年。从这张简单的图表中，我们可以看到，由于 2008 年 3 月开始的金融危机，这一趋势从 2008 年开始逐渐下降，并在 2009 年达到最低点。</p><figure class="lj lk ll lm gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi li"><img src="../Images/220ef8c14f7855079fef3ce05954be75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bXEb-GZj2KNubwq4Qv6WeA.png"/></div></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk"># of new cars sold in the U.S. from 2002–2019</figcaption></figure><p id="e594" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果我们想进一步分析汽车类别，预测消费者是否会像过去一样继续购买新车，该怎么办？这就是我们可以用 ARIMA 来回答这类问题的地方。</p><p id="a55b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">自回归综合移动平均线</strong>或 ARIMA，最简单的说法是使用自己的历史数据告知未来结果的方法，条件是数据是稳定的，即不受趋势、周期性、季节性或不规则性的影响。为什么？因为 ARIMA 研究的时间序列的性质并不依赖于观察时间。预测是困难的，因为时间序列本质上是不确定的。在我们上面的例子中，2008 年的金融危机影响了新车销售总量，这可以被视为一种不规则的变化，不会在一段时间内以特定的模式重复出现——这不是静态的。如果时间序列是平稳的，我们可以通过预测其统计特性，如均值、方差、自相关，使我们的问题变得简单一点。</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><p id="2eb2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">ARIMA 由建模中的三个部分组成:</p><p id="e007" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> AR( <em class="ly"> p </em>)模型(自回归)</strong> =作为预测因子的自身滞后值或<strong class="kd iu"><em class="ly"/></strong></p><p id="0d25" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> I(d)(积分)</strong> =平稳性所需的非季节性差异数，也称为<strong class="kd iu"> <em class="ly">差异度</em> </strong></p><p id="700e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> MA( <em class="ly"> q </em>)模型(移动平均)</strong> =过去预测误差的类回归模型，顺序称为<strong class="kd iu"> <em class="ly">顺序的移动平均</em> </strong></p><p id="87e1" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果时间序列是平稳的，那么预测某个时间<strong class="kd iu"> 𝑡 </strong>的𝑦值的 ARIMA 方程为<em class="ly"> AR + I + MA </em>表示为:</p><p id="e3a9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">预测为<strong class="kd iu"> 𝑦 </strong>时<strong class="kd iu"> 𝘵 </strong> = <strong class="kd iu">常数</strong> +加权求和的最后一个<strong class="kd iu">𝑝</strong>𝑦值+加权求和的最后一个<strong class="kd iu"> <em class="ly"> q </em> </strong>预测误差。</p><p id="d638" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">相同的等式用希腊字母正式表示为:</p><p id="b06e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">ŷ_𝑡= 𝑢+<em class="ly">𝜑_₁𝑦_</em>𝑡-<em class="ly">₁+…+𝜑_𝑝𝑦_</em>𝑡-𝑝-𝜃<em class="ly">_₁𝑒_</em>𝑡-<em class="ly">̿-…-</em>_</strong></p><p id="bd46" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">其中𝑢为常数，<em class="ly"> 𝜑_𝑘 </em>为滞后<em class="ly"> 𝑘时的 AR 系数，</em> 𝜃_ <em class="ly"> 𝑘 </em>为滞后<em class="ly"> 𝑘 </em>时的 MA 系数，而<em class="ly"> 𝑒_ </em> 𝑡- <em class="ly">是在时间段- <em class="ly">时产生的预测误差</em></em></p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><p id="5194" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在应用程序中，首先，我们必须确定数据是否稳定，这可以通过使用<a class="ae lz" href="https://en.wikipedia.org/wiki/Augmented_Dickey–Fuller_test" rel="noopener ugc nofollow" target="_blank"> <strong class="kd iu">增强的 Dickey-Fuller 测试</strong> </a> <strong class="kd iu">来实现。</strong>在测试中，我们想看看我们是否能拒绝陈述时间序列不是平稳的零假设(𝐻₀)。第二，可以用滚动均值和滚动标准差进行数学变换，直观地检验时间序列是否平稳。我们可以创建一个函数供将来使用。请注意，我们使用 12 年(或 1 年)作为数据评估的窗口期。</p><figure class="lj lk ll lm gt ju"><div class="bz fp l di"><div class="ma mb l"/></div></figure><p id="af57" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们通过调用新创建的函数<em class="ly">test _ stationary()</em>来查看原始时间序列</p><figure class="lj lk ll lm gt ju"><div class="bz fp l di"><div class="ma mb l"/></div></figure><figure class="lj lk ll lm gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mc"><img src="../Images/a0739324fa065218cd264bc926067e3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R-2Nr7de4Ka4TF2CBB-YHA.png"/></div></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk">A Dickey-Fuller Test on the original time-series</figcaption></figure><p id="c5d9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">不出所料，p 值高于 5%，表明我们不能拒绝零假设，ADF 检验统计高于所有临界值，因此，结果不显著。请注意，所有临界值都会导致负数，这意味着更强烈地拒绝零假设。</p><p id="63f9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">另一种方法是绘制自相关图来可视化时间序列的平稳性——如果时间是非平稳的，我们将看到非常缓慢的衰减。</p><figure class="lj lk ll lm gt ju"><div class="bz fp l di"><div class="ma mb l"/></div></figure><figure class="lj lk ll lm gt ju gh gi paragraph-image"><div class="gh gi md"><img src="../Images/8967971ca435079ea32cbfce6e5b9be4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*3IeNSUCvsvkxY2NeHr62FA.png"/></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk">ACF of original non-stationary time series shows slow decay</figcaption></figure><h2 id="c196" class="me mf it bd mg mh mi dn mj mk ml dp mm km mn mo mp kq mq mr ms ku mt mu mv mw bi translated">数据转换实现静止</h2><p id="ad8d" class="pw-post-body-paragraph kb kc it kd b ke mx kg kh ki my kk kl km mz ko kp kq na ks kt ku nb kw kx ky im bi translated">由于大多数统计预测方法都是基于这样一个假设，即时间序列在经过数学变换后可以近似平稳，因此我们将尝试几种类型的变换，然后用 ADF 测试来检验时间序列是否已经平稳。</p><p id="0b40" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们可以使用 numpy 包中的对数标度变换，将时间序列变换成对数标度。</p><figure class="lj lk ll lm gt ju"><div class="bz fp l di"><div class="ma mb l"/></div></figure><figure class="lj lk ll lm gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nc"><img src="../Images/f44eb1259597b3e58a63f2904503b7a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tnM82iXiV26MopkmmQ8N6A.png"/></div></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk">A Dickey-Fuller Test on the logarithmic scale of ts.</figcaption></figure><p id="9cce" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">从对数标度变换中，我们可以观察到滚动平均值和滚动标准差的更平滑趋势，这表明时间序列正在接近平稳性。然而，p 值仍然大于 5%,测试统计仍然大于所有临界值，因此我们将继续进一步区分转换后的数据。</p><figure class="lj lk ll lm gt ju"><div class="bz fp l di"><div class="ma mb l"/></div></figure><figure class="lj lk ll lm gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nd"><img src="../Images/7f1112508b671cbe195a2a757dd5fdd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1IhWz3euuE1J-U_IIboaUQ.png"/></div></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk">A Dickey-Fuller Test on the differenced logarithmic scale of ts.</figcaption></figure><p id="9cbb" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在我们可以看到 ADF 检验统计量小于 10%和 5%的临界值，表明时间序列是平稳的，分别有 90%和 95%的置信度。为了获得更好的 ADF 检验统计，我们可以尝试其他类型的数学变换。但为了简单起见，我们将继续以对数标度为例。</p><h2 id="836b" class="me mf it bd mg mh mi dn mj mk ml dp mm km mn mo mp kq mq mr ms ku mt mu mv mw bi translated">选择型号规格</h2><p id="f4e9" class="pw-post-body-paragraph kb kc it kd b ke mx kg kh ki my kk kl km mz ko kp kq na ks kt ku nb kw kx ky im bi translated">这里，当选择<em class="ly"> p </em>和<em class="ly"> q </em>时，最常见的方法是通过<strong class="kd iu">自相关函数(ACF) </strong>和<strong class="kd iu">偏自相关函数(PACF) </strong>将其可视化。ACF 测量时间序列和其自身滞后版本之间的相似性。请注意，系数也捕捉二手影响。这意味着<em class="ly"> t </em>捕捉滞后系列的直接和间接方式；<em class="ly"> t-1 </em>，<em class="ly"> t-2 </em>影响原。如果我们只想知道时间序列和它的滞后版本之间的直接关系，那么我们使用 PACF 来确定这种影响。</p><p id="f52c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们现在将使用 ACF 和 PACF 图来查看模型规格。</p><figure class="lj lk ll lm gt ju"><div class="bz fp l di"><div class="ma mb l"/></div></figure><figure class="lj lk ll lm gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ne"><img src="../Images/7c9b385916cbe1091e11efd8f8fb428a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kvj1bKEcWSgOwzDkwM_fPw.png"/></div></div></figure><p id="7393" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">从 ACF 测试中，我们注意到在 h = 12，24，36 处有多个重复出现的峰值，这是由于每年的循环效应。但是我们不会考虑季节性因素。对于 PACF 检验，我们将尝试用 AR(1)，MA(0)和 ARIMA(1，1，0)来拟合模型，以解释滞后数，从而解释时间序列中的自相关模式。</p><p id="8d64" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">请注意，理论上，实际情况是两个(p，q)中的一个应该是非零的，并且对于业务应用程序，两者之和通常小于 3。还建议避免使用既有 AR 系数又有 MA 系数的混合模型，除非您正在处理来自物理或工程应用程序的数据。最后但同样重要的是，经验法则是你应该总是得到一个更简单的模型。有关于<a class="ae lz" href="https://people.duke.edu/~rnau/411arim3.htm#unitroot" rel="noopener ugc nofollow" target="_blank">规格选择</a>的指南，其中 AR 和 MA 参数考虑单位根。</p><figure class="lj lk ll lm gt ju"><div class="bz fp l di"><div class="ma mb l"/></div></figure><figure class="lj lk ll lm gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nf"><img src="../Images/f5caea67586e619a021fc698b5b91e53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HmFhfJ3e29sBDO6Eg76fug.png"/></div></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk">AR(1) Model</figcaption></figure><figure class="lj lk ll lm gt ju"><div class="bz fp l di"><div class="ma mb l"/></div></figure><figure class="lj lk ll lm gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ng"><img src="../Images/c4dea03b831b5f9cabdb7e00ffc2c48f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8_5SabxRxhECLbLIrbKzWw.png"/></div></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk">MA(0)</figcaption></figure><p id="a59f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">最后，我们使用 ARIMA(1，1，0)将 AR + I + MA 与 d = 1 组合起来。</p><figure class="lj lk ll lm gt ju"><div class="bz fp l di"><div class="ma mb l"/></div></figure><figure class="lj lk ll lm gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nh"><img src="../Images/d3cf380405005220c0a02f5f0755175f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WyqNhmQltiHtu7YFzr_12Q.png"/></div></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk">ARIMA(1,1,0)</figcaption></figure><figure class="lj lk ll lm gt ju"><div class="bz fp l di"><div class="ma mb l"/></div></figure><figure class="lj lk ll lm gt ju gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/3367cfdb5a87b92ee9d59057b5115927.png" data-original-src="https://miro.medium.com/v2/resize:fit:1370/format:webp/1*nQC_fI0ev7PEzxdK58v3Dg.png"/></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk">Summary of ARIMA(1,1,0)</figcaption></figure><p id="01cd" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们还可以参考<a class="ae lz" href="https://en.wikipedia.org/wiki/Akaike_information_criterion" rel="noopener ugc nofollow" target="_blank">赤池信息准则</a> (AIC)来衡量我们比较不同模型时的拟合优度——AIC 数越小，模型拟合越好。最后，我们使用<em class="ly"> plot_predict() </em>方法，根据实际时间序列来绘制我们的预测。</p><figure class="lj lk ll lm gt ju"><div class="bz fp l di"><div class="ma mb l"/></div></figure><figure class="lj lk ll lm gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nj"><img src="../Images/a3123056397740100c08fe5efafde7c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*61KoiwW_7Jp57BoOR-Jjlw.jpeg"/></div></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk">ARIMA forecast vs actual</figcaption></figure><h2 id="809e" class="me mf it bd mg mh mi dn mj mk ml dp mm km mn mo mp kq mq mr ms ku mt mu mv mw bi translated">概括起来</h2><ol class=""><li id="59c6" class="nk nl it kd b ke mx ki my km nm kq nn ku no ky np nq nr ns bi translated">在本例中，我们只尝试了对数标度的时间序列转换。在实际应用中，可以使用指数衰减或时移等其他算术运算来平稳化时间序列，这可能会产生更好的 ADF 测试统计。</li><li id="1b5a" class="nk nl it kd b ke nt ki nu km nv kq nw ku nx ky np nq nr ns bi translated">其次，我们肯定应该尝试使用不同的参数来降低每个模型的 RSS 分数——这可以通过拟合不同的 p 和 q 值来实现。</li><li id="c9c7" class="nk nl it kd b ke nt ki nu km nv kq nw ku nx ky np nq nr ns bi translated">最后，我们所做的测试没有考虑季节性，在我们的时间序列中，我们看到每年有 12 个月的周期性影响，这可以通过季节性 ARIMA 来解决。</li></ol><p id="3748" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">参考资料:</p><ol class=""><li id="8cf0" class="nk nl it kd b ke kf ki kj km ny kq nz ku oa ky np nq nr ns bi translated"><a class="ae lz" href="http://people.cs.pitt.edu/~milos/courses/cs3750/lectures/class16.pdf" rel="noopener ugc nofollow" target="_blank">http://people . cs . Pitt . edu/~ Milos/courses/cs 3750/lections/class 16 . pdf</a></li><li id="ece1" class="nk nl it kd b ke nt ki nu km nv kq nw ku nx ky np nq nr ns bi translated">https://otexts.com/fpp2/arima.html<a class="ae lz" href="https://otexts.com/fpp2/arima.html" rel="noopener ugc nofollow" target="_blank"/></li><li id="171f" class="nk nl it kd b ke nt ki nu km nv kq nw ku nx ky np nq nr ns bi translated"><a class="ae lz" href="http://people.duke.edu/%7Ernau/Notes_on_nonseasonal_ARIMA_models--Robert_Nau.pdf" rel="noopener ugc nofollow" target="_blank">http://people . duke . edu/% 7 ernau/Notes _ on _ non seasonal _ ARIMA _ models-Robert _ nau . pdf</a></li><li id="f0dc" class="nk nl it kd b ke nt ki nu km nv kq nw ku nx ky np nq nr ns bi translated"><a class="ae lz" href="https://people.duke.edu/~rnau/411arim3.htm#unitroot" rel="noopener ugc nofollow" target="_blank">https://people.duke.edu/~rnau/411arim3.htm#unitroot</a></li></ol></div></div>    
</body>
</html>