<html>
<head>
<title>Move Data from On-Premise SQL Server to Azure Blob Storage Using Azure Data Factory</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Azure 数据工厂将数据从本地 SQL Server 移动到 Azure Blob 存储</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/move-data-from-on-premise-sql-server-to-azure-blob-storage-using-azure-data-factory-bbf67e4e5fde?source=collection_archive---------12-----------------------#2019-11-18">https://towardsdatascience.com/move-data-from-on-premise-sql-server-to-azure-blob-storage-using-azure-data-factory-bbf67e4e5fde?source=collection_archive---------12-----------------------#2019-11-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/2b9d21a56f1aba08e34b31d2d3b0e959.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x3nB2FAeGCenAKH9XXI8mg@2x.png"/></div></div></figure><div class=""/><p id="6e83" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">虽然有一个将数据从本地 SQL Server 复制到 Azure Blob 存储的官方教程(<a class="ae kz" href="https://docs.microsoft.com/en-us/azure/data-factory/tutorial-hybrid-copy-portal" rel="noopener ugc nofollow" target="_blank">https://docs . Microsoft . com/en-us/Azure/data-factory/tutorial-hybrid-copy-portal</a>)，但本文将重点讨论该教程中没有涉及的一些细节。举个例子，</p><ul class=""><li id="2d70" class="la lb je kd b ke kf ki kj km lc kq ld ku le ky lf lg lh li bi translated">如何手动设置自托管集成运行时(SIR)？</li><li id="c0c1" class="la lb je kd b ke lj ki lk km ll kq lm ku ln ky lf lg lh li bi translated">SQL Server 安全配置提示</li><li id="42e3" class="la lb je kd b ke lj ki lk km ll kq lm ku ln ky lf lg lh li bi translated">安全气囊系统连接绳配置提示</li><li id="ba82" class="la lb je kd b ke lj ki lk km ll kq lm ku ln ky lf lg lh li bi translated">将 Azure Blob 存储添加为接收器的提示</li></ul><p id="7e11" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">本教程不会从创建 Azure 数据工厂(ADF)实例开始。如果你还没有，并希望从那里开始，使用上面的官方教程就足够了。</p><p id="4d12" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在，我假设您已经准备好了本地 SQL Server 和 ADF 实例。现在我们应该开始了。</p><h1 id="98ba" class="lo lp je bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">准备数据源</h1><p id="ee90" class="pw-post-body-paragraph kb kc je kd b ke mm kg kh ki mn kk kl km mo ko kp kq mp ks kt ku mq kw kx ky im bi translated">让我们创建一个测试数据库，将本地 SQL Server 中的测试应用表作为数据源。因此，首先转到您的 SQL Server Management Studio (SSMS)来创建数据库和表。</p><figure class="ms mt mu mv gt iv gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/1320188f4b36a00c4582767ab260c0b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:706/format:webp/1*3QRiCN1odSSHZ4DrOrmRPA.png"/></div><figcaption class="mw mx gj gh gi my mz bd b be z dk">Right-click “Databases” and select “New Database…”</figcaption></figure><figure class="ms mt mu mv gt iv gh gi paragraph-image"><div class="gh gi na"><img src="../Images/1733fa67dd4e760d65a6062af0f47eb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1378/format:webp/1*jZjXoozeoOuKmAPF23GwAQ.png"/></div><figcaption class="mw mx gj gh gi my mz bd b be z dk">Input a database name</figcaption></figure><figure class="ms mt mu mv gt iv gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/53e29a637fa6d5b4979c16d7ae297a48.png" data-original-src="https://miro.medium.com/v2/resize:fit:524/format:webp/1*RviL5BCbFMGXulU7ryqzLw.png"/></div><figcaption class="mw mx gj gh gi my mz bd b be z dk">Right-click the database select “New Query”</figcaption></figure><p id="fcd3" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">复制粘贴下面的 SQL 脚本来创建表并插入一些测试条目。这段代码来自上面的官方教程</p><pre class="ms mt mu mv gt nc nd ne nf aw ng bi"><span id="426d" class="nh lp je nd b gy ni nj l nk nl">CREATE TABLE dbo.emp<br/>(<br/>     ID int IDENTITY(1,1) NOT NULL,<br/>     FirstName varchar(50),<br/>     LastName varchar(50)<br/>)<br/>GO</span><span id="9af5" class="nh lp je nd b gy nm nj l nk nl">INSERT INTO emp (FirstName, LastName) VALUES ('John', 'Doe')<br/>INSERT INTO emp (FirstName, LastName) VALUES ('Jane', 'Doe')<br/>GO</span></pre><h1 id="6507" class="lo lp je bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">创建 SQL Server 用户</h1><p id="b5cb" class="pw-post-body-paragraph kb kc je kd b ke mm kg kh ki mn kk kl km mo ko kp kq mp ks kt ku mq kw kx ky im bi translated">在实践中，我们应该让 SIR 使用 root 用户或任何具有 admin 权限的用户。相反，出于安全原因，我们希望为目标数据库创建一个只读用户。让我们创建这个用户。</p><figure class="ms mt mu mv gt iv gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/2c77ade0eceaeb3fd3dbdd3c4ee3cfa9.png" data-original-src="https://miro.medium.com/v2/resize:fit:572/format:webp/1*BwWJPbtocQF6ax25qugSHA.png"/></div><figcaption class="mw mx gj gh gi my mz bd b be z dk">Right-click “Security” -&gt; “Logins” under the SQL Server and select “New Login”</figcaption></figure><figure class="ms mt mu mv gt iv gh gi paragraph-image"><div class="gh gi no"><img src="../Images/b924fcf1f002ca7de72d12a0a77b23e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1386/format:webp/1*4TnqxQUWUKm_pmZ5IAYZNw.png"/></div><figcaption class="mw mx gj gh gi my mz bd b be z dk">Create the user called “adfuser”, input password</figcaption></figure><p id="1454" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">请注意，我们不想为此用户选中“用户必须在下次登录时更改密码”，因为它不应该提供给任何“用户”，而只能由 ADF 服务使用。</p><p id="6c88" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后，让我们将这个用户添加到我们刚刚创建的数据库中。</p><figure class="ms mt mu mv gt iv gh gi paragraph-image"><div class="gh gi np"><img src="../Images/947d106ffee45935db96a2126bf79772.png" data-original-src="https://miro.medium.com/v2/resize:fit:656/format:webp/1*DUwf5uQFPKG6t3iqPmKUEw.png"/></div><figcaption class="mw mx gj gh gi my mz bd b be z dk">Right-click “Security” -&gt; “Users” under the new database and select “New User”</figcaption></figure><figure class="ms mt mu mv gt iv gh gi paragraph-image"><div class="gh gi na"><img src="../Images/6179cbbe62f8745984ddbb9c5f102013.png" data-original-src="https://miro.medium.com/v2/resize:fit:1378/format:webp/1*4pzZPxqAmXIGGVqjOQ2OCA.png"/></div><figcaption class="mw mx gj gh gi my mz bd b be z dk">Input user name and default schema</figcaption></figure><figure class="ms mt mu mv gt iv gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/45e695ab7f73788c5be8ee0d74d3cc8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1384/format:webp/1*tuCNGlqx9u21p33co3J1Rg.png"/></div><figcaption class="mw mx gj gh gi my mz bd b be z dk">In the “Membership” tab, enable “db_datareader”</figcaption></figure><p id="ace3" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">之后，很重要的一步就是检查你的 SQL Server 是否已经启用了“SQL Server 身份验证模式”。否则，您创建的用户将永远无法访问。</p><figure class="ms mt mu mv gt iv gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/62351bcc9673274f2d6706493e674a17.png" data-original-src="https://miro.medium.com/v2/resize:fit:794/format:webp/1*lAHZf4BPPC2UAuZ2DOl9hw.png"/></div><figcaption class="mw mx gj gh gi my mz bd b be z dk">Right-click the SQL Server Instance and go to “Properties”</figcaption></figure><figure class="ms mt mu mv gt iv gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/9f906953ab06bba1ff25bf5eef1c635f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1388/format:webp/1*dnYH2JiMjoA8TsWHBkJDQg.png"/></div><figcaption class="mw mx gj gh gi my mz bd b be z dk">Go to the “Security” tab and make sure “SQL Server and Windows Authentication mode” is enabled</figcaption></figure><h1 id="dc36" class="lo lp je bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">创建 ADF 管道</h1><p id="7114" class="pw-post-body-paragraph kb kc je kd b ke mm kg kh ki mn kk kl km mo ko kp kq mp ks kt ku mq kw kx ky im bi translated">转到 ADF Author 选项卡，单击<code class="fe nt nu nv nd b">Pipelines</code>旁边的“…”按钮，并在下拉列表中选择<code class="fe nt nu nv nd b">New pipeline</code>。</p><figure class="ms mt mu mv gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nw"><img src="../Images/d0c909dea7ffd0f6be2e604d3c96c97a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R7ymh6amHYuVImZIIvvtHg.png"/></div></div></figure><p id="80d0" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后，在右窗格的主视图中，为管道命名。姑且称之为<code class="fe nt nu nv nd b">OnPremSQLEmpToBlob_Pipeline</code>。</p><figure class="ms mt mu mv gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nx"><img src="../Images/bac600086e223fd5932b7057322f0bb7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aE4SrLCInO8FLDTTLVidwg.png"/></div></div></figure><p id="9dac" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">展开<code class="fe nt nu nv nd b">Move &amp; transform</code>部分，将<code class="fe nt nu nv nd b">Copy data</code>拖动到右侧主区域，重命名为<code class="fe nt nu nv nd b">SQLEmpToBlobEmp_Activity</code>。</p><figure class="ms mt mu mv gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ny"><img src="../Images/f7f8eeb8cfbaed958eaafcd95518a8ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rT2D7MQ8T9HA-nTRoh3Kag.png"/></div></div></figure><p id="6ad2" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">之后，转到<code class="fe nt nu nv nd b">Source</code>选项卡，点击<code class="fe nt nu nv nd b">New</code>创建一个新的数据集作为源。</p><figure class="ms mt mu mv gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nz"><img src="../Images/d308e690b588d711d186a325df079510.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g3VKRJ2Di8jQ_z6FpWOY8g.png"/></div></div></figure><p id="623f" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">搜索“sql server”以获取 SQL Server 连接。选择它并点按“继续”。</p><figure class="ms mt mu mv gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oa"><img src="../Images/940106e1194cb8b47402bd631547d9c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tzYvy87FTr9HyiOI6H2Rvg.png"/></div></div></figure><p id="9046" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">让我们称这个数据集为<code class="fe nt nu nv nd b">OnPremSQLServerEmp</code>，然后我们需要为这个数据集创建一个新的链接服务。</p><figure class="ms mt mu mv gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ob"><img src="../Images/9bbf3c0fadc0fd3206fbd9f9432cb486.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dcL2NcAgVjVVr8Z3OxSFFw.png"/></div></div></figure><p id="fd45" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">让我们将新的链接服务命名为<code class="fe nt nu nv nd b">OnPremSQLServer_LinkedService</code>，然后为这个本地资源创建一个集成时间。</p><figure class="ms mt mu mv gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oa"><img src="../Images/6e8bb7eccea18b7d811bf857735a640b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oVyjQCWsA863czwEtX3h_w.png"/></div></div></figure><h1 id="9dd6" class="lo lp je bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">手动设置自承载集成运行时</h1><p id="a744" class="pw-post-body-paragraph kb kc je kd b ke mm kg kh ki mn kk kl km mo ko kp kq mp ks kt ku mq kw kx ky im bi translated">在上一步之后，我们为集成运行时选择“New”。然后，我们选择“自托管”并单击继续。</p><figure class="ms mt mu mv gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oc"><img src="../Images/a07d44c3a4326b163cfef8e26911d1b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a4tAb01-0iTNBK8s4UhE9g.png"/></div></div></figure><p id="0e6c" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">输入 SIR 的名称。我想将其命名为<code class="fe nt nu nv nd b">DevVmIntegrationRuntime</code>,因为我将在我的开发虚拟机上设置它。</p><figure class="ms mt mu mv gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ob"><img src="../Images/744672d0ea212af2e206949279018c1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zRIXTGceZy4boPBlwehkiw.png"/></div></div></figure><p id="16e7" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在这里，我们来到了重要的一步。在官方教程中，建议使用快速设置，这样肯定简单很多。然而，这在某些情况下可能是不可行的，例如，系统安全策略不允许这个自动脚本在这台机器上运行，当您想要使用快速设置时，经常会看到这个错误。</p><figure class="ms mt mu mv gt iv gh gi paragraph-image"><div class="gh gi od"><img src="../Images/d674a7faeffcb0df7310c411e2f9ba43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1112/format:webp/1*Nclwu7eJJwFSTxBGckX-7w.png"/></div></figure><p id="09c2" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">因此，我们需要使用选项 2:手动设置。因此，请下载 SIR 安装程序，并在您想要托管 SIR 的机器上运行它。</p><figure class="ms mt mu mv gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oe"><img src="../Images/3364702af381e4a1efa7bde7604489d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Omao8-Q_p9WA0RLRHz2nvg.png"/></div></div></figure><p id="82ef" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">只需等待 SIR 安装完成，然后复制密钥并粘贴到已安装的 SIR 中，将它们连接在一起。</p><figure class="ms mt mu mv gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi of"><img src="../Images/0277d60eaeaaa563da4059fd41975073.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0AEZh74yDHdVDEXtAqX9fA.png"/></div></div></figure><figure class="ms mt mu mv gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi og"><img src="../Images/39d8d08cecadc469169ffe05c03ff2e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YB2jfWCWILF_RE0Vy7_sCA.png"/></div></div></figure><p id="7574" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">它应该会自动相互连接，并且运行 SIR 的机器名称会自动填充为节点名称。你可以重命名它，但对我来说，这没关系。</p><p id="4b03" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">单击“完成”并等待它自己注册，然后单击“启动配置管理器”，您应该能够看到如下屏幕。</p><figure class="ms mt mu mv gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oh"><img src="../Images/e86fce71f91a6474651b9f9ea4282674.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rl4TNBoKYEz2ipVtZkpp3g.png"/></div></div></figure><p id="ec12" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后，我们可以在<code class="fe nt nu nv nd b">Diagnostics</code>选项卡中测试 SQL Server 连接，如下所示。请注意，我在本地 SQL Server 的同一台机器上运行 SIR，因此我使用<code class="fe nt nu nv nd b">localhost</code>作为服务器名称。然而，出于安全考虑，在实践中不建议这样做。如果您将一台独立的机器与 SQL Server 实例连接，只需用机器名和实例名替换<code class="fe nt nu nv nd b">localhost</code>。</p><p id="fafd" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">另一个重要的提示是，在这个连接测试中，我们需要使用双斜杠<code class="fe nt nu nv nd b">\\</code>来分隔服务器名和实例名。</p><figure class="ms mt mu mv gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oi"><img src="../Images/ea6875a175463a9d3b1d63f54c27cfdd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RW14TuSNZRR-xkrDtFhZXw.png"/></div></div></figure><p id="9080" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后，我们回到 ADF。应用并关闭安全气囊系统配置面板。现在，我们也想测试这里的连接。请看下面的截图。</p><figure class="ms mt mu mv gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oj"><img src="../Images/65c42e6198fc107bc0f30870524e4267.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-EpRcoAmvv_4aK218377wA.png"/></div></div></figure><p id="3194" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">另一个非常重要的提示是，我在其他地方没有找到任何详细说明。也就是说，这里的服务器名不应该是双斜杠。这将导致您测试连接时出错。相反，您应该使用单斜线<code class="fe nt nu nv nd b">\</code>来分割服务器名和实例名。我相信这是因为 SIR 依靠反斜杠来转义斜杠字符，但 ADF 不需要转义，但它会将双斜杠转换为实际上与服务器名和实例名不匹配的两个斜杠符号。因此，您可能会得到以下错误:</p><blockquote class="ok"><p id="dc74" class="ol om je bd on oo op oq or os ot ky dk translated">连接失败</p><p id="2242" class="ol om je bd on oo op oq or os ot ky dk translated">无法连接到 SQL Server:“localhost \ \ SQLEXPRESS”，数据库:“testdb”，用户:“adfuser”。实例失败。活动 ID: xxxxxx-xxxxx-xxxxx。</p></blockquote><p id="bff8" class="pw-post-body-paragraph kb kc je kd b ke ou kg kh ki ov kk kl km ow ko kp kq ox ks kt ku oy kw kx ky im bi translated">现在，我们已经有了一个到本地 SQL Server 的有效链接服务器。让我们选择要从中提取数据的表，即<code class="fe nt nu nv nd b">dbo.emp</code>，然后单击 OK。</p><figure class="ms mt mu mv gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oz"><img src="../Images/0b8fb5d0aa05122bf742a67cd4e5a83f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HQNpF_3t8xWSypK6Hmdz4w.png"/></div></div></figure><h1 id="ce37" class="lo lp je bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">在 Azure Blob 存储中创建接收器数据集</h1><p id="0990" class="pw-post-body-paragraph kb kc je kd b ke mm kg kh ki mn kk kl km mo ko kp kq mp ks kt ku mq kw kx ky im bi translated">转到管道配置面板上的接收器选项卡，单击“新建”以添加新数据集。</p><figure class="ms mt mu mv gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ca"><img src="../Images/aa73e25eb0bb2ea293f7b4186963ea95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hm_Z39QQ_sJD5cwymx_EaQ.png"/></div></div></figure><p id="0918" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后，选择 Azure Blob 存储并单击继续。</p><figure class="ms mt mu mv gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pa"><img src="../Images/72f2db6e465bf11b362398d6820d7d90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4-J6bcSXSVQ_GexNpw9BsQ.png"/></div></div></figure><p id="4b3c" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在这里，我将使用<code class="fe nt nu nv nd b">DelimitedText</code>作为一个例子，因为它是最可读的。</p><figure class="ms mt mu mv gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pb"><img src="../Images/930886e5f5b390753cc321eb6d97d7f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mPjF6F4w1GcrGcs-wycggQ.png"/></div></div></figure><p id="f00a" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后，按照说明创建新的链接服务。这次我们将使用<code class="fe nt nu nv nd b">AutoResolveIntegrationRuntime</code>，它将是 Azure Integration Runtime (AIR)，因为 Azure Blob 存储是 Azure Cloud 中的原生服务。</p><figure class="ms mt mu mv gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pc"><img src="../Images/d1be73c61f3c22e063097edc183cca2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1CCH_sve01hGzZ6u95psBg.png"/></div></div></figure><p id="7284" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在下一步中，将自动选择创建的链接服务。我们需要输入接收器数据集的文件路径。这里我已经创建了一个名为<code class="fe nt nu nv nd b">test-container</code>的 blob 容器，但是文件夹<code class="fe nt nu nv nd b">output</code>和文件<code class="fe nt nu nv nd b">emp.csv</code>目前并不存在。ADF 会自动为我们创建它们。</p><figure class="ms mt mu mv gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oj"><img src="../Images/8194a0d4ac930e196c49f41262c5e171.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O3r7ppGFg0SUxhHKe6SxuA.png"/></div></div></figure><p id="d45b" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">提示 1:如果您想在 CSV 文件中包含字段标题，请选择“首行作为标题”。</p><p id="4850" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">提示 2:我们需要为<code class="fe nt nu nv nd b">Import schema</code>选择“None ”,否则，由于模式导入失败错误，您将无法进入下一步:</p><blockquote class="ok"><p id="0f2f" class="ol om je bd on oo op oq or os ot ky dk translated">架构导入失败:缺少所需的 Blob。container name:<a class="ae kz" href="https://ctstoragetest.blob.core.windows.net/test-container," rel="noopener ugc nofollow" target="_blank">https://xxxxx.blob.core.windows.net/test-container,</a>container exist:True，BlobPrefix: emp.csv，BlobCount: 0。\r\n .活动 ID: xxxxx-xxxxx-xxxxx</p></blockquote><h1 id="4647" class="lo lp je bd lq lr ls lt lu lv lw lx ly lz pd mb mc md pe mf mg mh pf mj mk ml bi translated">执行管道</h1><p id="b515" class="pw-post-body-paragraph kb kc je kd b ke mm kg kh ki mn kk kl km mo ko kp kq mp ks kt ku mq kw kx ky im bi translated">现在，我们应该准备好运行这个数据移动管道了。让发布一切，然后到管道面板顶部工具栏，点击“添加触发器”-&gt;“立即触发”。</p><figure class="ms mt mu mv gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ca"><img src="../Images/c802529354f4e4d84dc76bfdd0c556e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3FIFeZwsxJuBQfTOpVVkig.png"/></div></div></figure><h1 id="dec1" class="lo lp je bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">核实结果</h1><p id="7cb6" class="pw-post-body-paragraph kb kc je kd b ke mm kg kh ki mn kk kl km mo ko kp kq mp ks kt ku mq kw kx ky im bi translated">等到通知说管道成功，然后转到 Blob 存储检查输出文件。我更喜欢使用 Azure Storage Explorer，因为我可以直接下载并轻松打开 CSV 文件，但如果你更喜欢 Azure Portal 中的 web 视图，这也没问题。</p><figure class="ms mt mu mv gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi pg"><img src="../Images/3c214c7575dd94482b6e241d0b8e168b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g-SCEkXOVHNJO01H6Iyxlg.png"/></div></div></figure><div class="is it gp gr iu ph"><a href="https://medium.com/@qiuyujx/membership" rel="noopener follow" target="_blank"><div class="pi ab fo"><div class="pj ab pk cl cj pl"><h2 class="bd jf gy z fp pm fr fs pn fu fw jd bi translated">通过我的推荐链接加入灵媒-陶</h2><div class="po l"><h3 class="bd b gy z fp pm fr fs pn fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="pp l"><p class="bd b dl z fp pm fr fs pn fu fw dk translated">medium.com</p></div></div><div class="pq l"><div class="pr l ps pt pu pq pv ja ph"/></div></div></a></div><p id="0b15" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果你觉得我的文章有帮助，请考虑加入 Medium 会员来支持我和成千上万的其他作者！(点击上面的链接)</p><h1 id="96c3" class="lo lp je bd lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml bi translated">资源:</h1><p id="d1f7" class="pw-post-body-paragraph kb kc je kd b ke mm kg kh ki mn kk kl km mo ko kp kq mp ks kt ku mq kw kx ky im bi translated">Azure 文档，将数据从本地 SQL Server 数据库复制到 Azure Blob 存储:<a class="ae kz" href="https://docs.microsoft.com/en-us/azure/data-factory/tutorial-hybrid-copy-portal" rel="noopener ugc nofollow" target="_blank">https://docs . Microsoft . com/en-us/Azure/data-factory/tutorial-hybrid-Copy-portal</a></p><p id="119d" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">SQL Server 2017:<a class="ae kz" href="https://www.microsoft.com/en-in/sql-server/sql-server-downloads" rel="noopener ugc nofollow" target="_blank">https://www . Microsoft . com/en-in/SQL-Server/SQL-Server-downloads</a></p><p id="8f2b" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">Azure 存储浏览器:<a class="ae kz" href="https://azure.microsoft.com/en-gb/features/storage-explorer/" rel="noopener ugc nofollow" target="_blank">https://azure . Microsoft . com/en-GB/features/Storage-Explorer/</a></p></div></div>    
</body>
</html>