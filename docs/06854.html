<html>
<head>
<title>Working On a Databricks Cluster From A Remote Machine</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从远程机器上处理 Databricks 集群</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/working-on-a-databricks-cluster-from-a-remote-machine-c09d5a468ae3?source=collection_archive---------19-----------------------#2019-09-29">https://towardsdatascience.com/working-on-a-databricks-cluster-from-a-remote-machine-c09d5a468ae3?source=collection_archive---------19-----------------------#2019-09-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6cca" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">简单的方法。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/1f195bf7b6590f6f4aa0da5d62870d2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RcuPyN1o8Jofw3FqWXz6Qw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk"><a class="ae ky" href="https://databricks.com/" rel="noopener ugc nofollow" target="_blank">Databricks</a>.com</figcaption></figure><p id="6ff4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">想象一下下面的场景，您有一台专用的机器，并且希望在 Databricks 集群上远程运行您的作业。如果您在 Databricks 平台上工作，通常在 Databricks 集群上运行作业是相当容易的，因为集群已经配置好了。但是，从远程机器上运行作业需要一些设置。在这篇文章中，我将解释如何成功地远程运行集群作业。</p><p id="b507" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">就可用性而言，配置很简单，<a class="ae ky" rel="noopener" target="_blank" href="/how-to-install-pyspark-on-a-remote-machine-a3c86e76729d">以前</a>我必须在我的机器上安装 PySpark，这需要在 shell 中进行大量的修改。此外，这并没有给我在 Databricks 集群上运行作业的能力。</p><p id="c34b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">以下是使用<a class="ae ky" href="https://docs.databricks.com/user-guide/dev-tools/db-connect.html" rel="noopener ugc nofollow" target="_blank"> Databricks 文档</a>的总结。它几乎被埋没了，没有立即在谷歌上出现。所以，希望这个帖子有所帮助。</p><h2 id="05c4" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">安装和配置</h2><blockquote class="mo mp mq"><p id="b14a" class="kz la mr lb b lc ld ju le lf lg jx lh ms lj lk ll mt ln lo lp mu lr ls lt lu im bi translated">1.pip 卸载 pyspark <br/> 2。pip 安装-用户数据块-cli <br/> 3。pip install-user-U data bricks-connect = = 5.5。*</p></blockquote><p id="cf29" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">确保你安装的版本和你的集群一样，对我来说，是 5.5。您可以在集群页面上查看它们，查看运行时列，如图 1 所示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mv"><img src="../Images/8aa607f4ddf4b14b605c3c5c2c5e8f71.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dv9CUVweWmVS1m_XYNNdkQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Figure 1: Clusters page, Logs monitoring is using runtime version 3.1.</figcaption></figure><p id="4f68" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">注意:如果您的运行时是如图 3 所示的用户 toke。</p><blockquote class="mo mp mq"><p id="51b0" class="kz la mr lb b lc ld ju le lf lg jx lh ms lj lk ll mt ln lo lp mu lr ls lt lu im bi translated">3.集群 ID:您创建的集群的 ID。您可以从 URL 获取集群 ID。这里，橙色框 中的集群 ID 是<strong class="lb iu"> <em class="mr">，如图 4 所示。</em></strong></p></blockquote><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mw"><img src="../Images/2e13b9faaed00f157428a9d9461c1109.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*kvWLs2ISkOJSJxnQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Figure 2: special configuration for runtime&lt;5.3.</figcaption></figure><ol class=""><li id="063c" class="mx my it lb b lc ld lf lg li mz lm na lq nb lu nc nd ne nf bi translated">安装</li></ol><p id="ed7f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">配置<strong class="lb iu"><em class="mr">data bricks-connect</em></strong>客户端将非常容易，您需要接受协议，输入 url(包括<a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/),"> https://)，</a>输入令牌，输入集群 ID 并按两次 enter 键以接受 Org ID 和端口问题的默认值。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nk"><img src="../Images/b1c1dd84e79e7b40dc824c4ad3773fe1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0NEx6ar5ixIu_2fjmYjYiA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Figure 3: User Token Creation, Databricks Documentation.</figcaption></figure><p id="7d9a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你接受上述协议吗？[y/N] y <br/>设置新的配置值(将输入留空以接受默认值):<br/>数据块主机[无当前值，必须以 https://]开头:&lt;数据块-url &gt; <br/>数据块令牌[无当前值]: &lt;数据块-令牌&gt; <br/>集群 id(例如 0221-009411-jello 819)[无当前值]: &lt;集群 id &gt; <br/>组织 IDo = URL 中的 orgId)[0]:&lt;org-id&gt;<br/>Port【15001】:&lt;Port&gt;</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/3e3e8ec89d40ff7ad6ca1be504f0b7ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YEgn4eeR26IMApmyCw4hHg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Figure 4: Cluster ID</figcaption></figure></div><div class="ab cl nm nn hx no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="im in io ip iq"><h2 id="b921" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">下一步是测试连接客户机。</h2><p id="12a2" class="pw-post-body-paragraph kz la it lb b lc nt ju le lf nu jx lh li nv lk ll lm nw lo lp lq nx ls lt lu im bi translated">数据块-连接配置</p><blockquote class="mo mp mq"><p id="2c3e" class="kz la mr lb b lc ld ju le lf lg jx lh ms lj lk ll mt ln lo lp mu lr ls lt lu im bi translated">对我来说，这导致了一个错误:</p></blockquote><p id="5dd0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">/home/username/。local/lib/python 3.5/site-packages/pyspark/bin/spark-class:第 71 行:/usr/lib/java/bin/java:没有这样的文件或目录</p><blockquote class="mo mp mq"><p id="3c13" class="kz la mr lb b lc ld ju le lf lg jx lh ms lj lk ll mt ln lo lp mu lr ls lt lu im bi translated">我通过添加安装 java 8 并在~/中添加下面一行来解决这个问题。bashrc</p></blockquote><p id="5711" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">sudo 安装 openjdk-8-jdk</p><blockquote class="mo mp mq"><p id="784b" class="kz la mr lb b lc ld ju le lf lg jx lh ms lj lk ll mt ln lo lp mu lr ls lt lu im bi translated">导出 JAVA_HOME=/usr/</p></blockquote><p id="2cc0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后:</p><blockquote class="mo mp mq"><p id="79d4" class="kz la mr lb b lc ld ju le lf lg jx lh ms lj lk ll mt ln lo lp mu lr ls lt lu im bi translated">来源~/。bashrc</p><p id="17ed" class="kz la mr lb b lc ld ju le lf lg jx lh ms lj lk ll mt ln lo lp mu lr ls lt lu im bi translated">测试</p></blockquote><p id="40c9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，您需要运行以下命令:</p><blockquote class="mo mp mq"><p id="0afd" class="kz la mr lb b lc ld ju le lf lg jx lh ms lj lk ll mt ln lo lp mu lr ls lt lu im bi translated">数据块连接测试</p></blockquote><h2 id="1fbd" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated">如果一切工作正常，它将参与集群，在启动它并进行几次测试后，您应该准备好从您的机器向您的集群发送作业。</h2><p id="b557" class="pw-post-body-paragraph kz la it lb b lc nt ju le lf nu jx lh li nv lk ll lm nw lo lp lq nx ls lt lu im bi translated">密码</p><blockquote class="mo mp mq"><p id="227e" class="kz la mr lb b lc ld ju le lf lg jx lh ms lj lk ll mt ln lo lp mu lr ls lt lu im bi translated">从 pyspark.sql 导入 spark session<br/>spark = spark session . builder . getor create()</p></blockquote><p id="3331" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从 IPython.core.magic 导入 line_magic，line_cell_magic，magics_class</p><h2 id="8334" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated"><a class="ae ky" href="http://twitter.com/magics_class" rel="noopener ugc nofollow" target="_blank">@ Magics _ class</a><br/>class databrickconnectmagics(Magics):</h2><blockquote class="mo mp mq"><p id="fc97" class="kz la mr lb b lc ld ju le lf lg jx lh ms lj lk ll mt ln lo lp mu lr ls lt lu im bi translated"><a class="ae ky" href="http://twitter.com/line_cell_magic" rel="noopener ugc nofollow" target="_blank">@ line _ cell _ magic</a><br/>def SQL(self，Line，cell = None):<br/>if cell and Line:<br/>raise value error(" Line 必须为空才能进行单元格魔术"，Line)<br/>try:<br/>from autovizwidget . widget . utils import display _ data frame<br/>import error:<br/>print("请运行` pip install autovizwidget `以启用可视化小部件。")<br/>display _ data frame = lambda x:x<br/>返回 display _ data frame(self . get _ spark()。sql(单元格或行)。toPandas())</p><p id="bb5c" class="kz la mr lb b lc ld ju le lf lg jx lh ms lj lk ll mt ln lo lp mu lr ls lt lu im bi translated">def get _ spark(self):<br/>user _ ns = get _ ipython()。user_ns <br/>如果 user_ns 中的" spark ":<br/>返回 user_ns["spark"]<br/>else:<br/>from pyspark . SQL 导入 spark session<br/>user _ ns[" spark "]= spark session . builder . getorcreate()<br/>返回 user _ ns[" spark "]</p><p id="bfe5" class="kz la mr lb b lc ld ju le lf lg jx lh ms lj lk ll mt ln lo lp mu lr ls lt lu im bi translated">IP = get _ ipython()<br/>IP . register _ magics(databrickconnectmagics)</p><p id="1320" class="kz la mr lb b lc ld ju le lf lg jx lh ms lj lk ll mt ln lo lp mu lr ls lt lu im bi translated">从 pyspark.sql 导入 spark session<br/>spark = spark session \<br/>。构建器\ <br/>。getOrCreate()</p><p id="d06e" class="kz la mr lb b lc ld ju le lf lg jx lh ms lj lk ll mt ln lo lp mu lr ls lt lu im bi translated">print(" Testing simple count ")<br/># Spark 代码将在 Databricks 集群上执行。<br/>打印(spark.range(1000)。count())</p><p id="0dbb" class="kz la mr lb b lc ld ju le lf lg jx lh ms lj lk ll mt ln lo lp mu lr ls lt lu im bi translated">输出应该是:</p><p id="5c8d" class="kz la mr lb b lc ld ju le lf lg jx lh ms lj lk ll mt ln lo lp mu lr ls lt lu im bi translated">测试简单计数<br/> 1000</p><p id="c400" class="kz la mr lb b lc ld ju le lf lg jx lh ms lj lk ll mt ln lo lp mu lr ls lt lu im bi translated">非常感谢你阅读这篇文章，希望它能帮助你设置你的系统而不会有太多的问题。</p></blockquote><p id="4d10" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">参考</p><blockquote class="mo mp mq"><p id="ba77" class="kz la mr lb b lc ld ju le lf lg jx lh ms lj lk ll mt ln lo lp mu lr ls lt lu im bi translated"><a class="ae ky" href="https://datathirst.net/blog/2019/3/7/databricks-connect-finally" rel="noopener ugc nofollow" target="_blank">数据渴求</a></p></blockquote><p id="6e63" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><a class="ae ky" href="https://docs.databricks.com/user-guide/dev-tools/db-connect.html" rel="noopener ugc nofollow" target="_blank">数据库连接</a></p><h2 id="c398" class="lv lw it bd lx ly lz dn ma mb mc dp md li me mf mg lm mh mi mj lq mk ml mm mn bi translated"><a class="ae ky" href="https://docs.databricks.com/api/latest/authentication.html#token-management" rel="noopener ugc nofollow" target="_blank">数据库认证</a></h2><ol class=""><li id="b2fa" class="mx my it lb b lc nt lf nu li ny lm nz lq oa lu nc nd ne nf bi translated"><a class="ae ky" href="https://stackoverflow.com/questions/52012006/databricks-cli-not-installing-on-ubuntu-18-04" rel="noopener ugc nofollow" target="_blank">所以</a></li><li id="0ec1" class="mx my it lb b lc ob lf oc li od lm oe lq of lu nc nd ne nf bi translated"><a class="ae ky" href="https://www.digitalocean.com/community/tutorials/how-to-install-java-with-apt-on-ubuntu-18-04" rel="noopener ugc nofollow" target="_blank">安装 java 8 </a></li><li id="fcdb" class="mx my it lb b lc ob lf oc li od lm oe lq of lu nc nd ne nf bi translated"><a class="ae ky" href="https://www.baeldung.com/find-java-home" rel="noopener ugc nofollow" target="_blank">找到 java 主页</a></li><li id="198d" class="mx my it lb b lc ob lf oc li od lm oe lq of lu nc nd ne nf bi translated">Ori Cohen 博士拥有计算机科学博士学位，主要研究机器学习。他是 TLV 新遗迹公司的首席数据科学家，从事 AIOps 领域的机器和深度学习研究。</li><li id="8db9" class="mx my it lb b lc ob lf oc li od lm oe lq of lu nc nd ne nf bi"><a class="ae ky" href="https://www.digitalocean.com/community/tutorials/how-to-install-java-with-apt-on-ubuntu-18-04" rel="noopener ugc nofollow" target="_blank">install java 8</a></li><li id="2e20" class="mx my it lb b lc ob lf oc li od lm oe lq of lu nc nd ne nf bi"><a class="ae ky" href="https://www.baeldung.com/find-java-home" rel="noopener ugc nofollow" target="_blank">Find java home</a></li></ol></div><div class="ab cl nm nn hx no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="im in io ip iq"><p id="dc39" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi">Dr. Ori Cohen has a Ph.D. in Computer Science with a focus on machine-learning. He is a lead data-scientist at New Relic TLV, doing machine and deep learning research in the field of AIOps.</p></div></div>    
</body>
</html>