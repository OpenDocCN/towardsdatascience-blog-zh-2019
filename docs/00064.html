<html>
<head>
<title>Movie genre classifier using a dataset created using Google Images</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用使用谷歌图像创建的数据集的电影流派分类器</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/building-a-movie-genre-classifier-using-a-dataset-created-using-google-images-4752f75a1d79?source=collection_archive---------20-----------------------#2019-01-03">https://towardsdatascience.com/building-a-movie-genre-classifier-using-a-dataset-created-using-google-images-4752f75a1d79?source=collection_archive---------20-----------------------#2019-01-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="410f" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用 fast-ai</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/671874c8bbcd08310f19936423481639.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jbfWuj3RSAAvmJeBwLWbsw.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">source: <a class="ae kv" href="https://www.wallpaperup.com/205901/movies_digital_art_collage_movie_posters_fan_art.html" rel="noopener ugc nofollow" target="_blank">wallpaperup</a></figcaption></figure><p id="8455" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在为分类问题构建数据库时,“谷歌图片”是找到相关图片的绝佳来源。就拿电影海报按流派分类的问题来说吧。我们将选三门重叠最少的课:爱情、恐怖和超级英雄。</p><h1 id="0b0f" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">创建数据集</h1><h2 id="0181" class="mk lt iq bd lu ml mm dn ly mn mo dp mc lf mp mq me lj mr ms mg ln mt mu mi mv bi translated">获取 URL 列表:</h2><p id="1502" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated">第一步是获取一个我们可以下载图片的 URL 列表。为此，进入<a class="ae kv" href="http://images.google.com/" rel="noopener ugc nofollow" target="_blank">谷歌图片</a>，搜索你感兴趣的图片。向下滚动，直到你看到所有你想下载的图片，或者直到你看到一个按钮，上面写着“显示更多结果”。你滚动过的所有图片现在都可以下载了。要了解更多信息，请点击按钮，然后继续滚动。Google Images 显示的最大图片数量为 700 张。</p><p id="9da8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在 Windows/Linux 中按 Ctrl+Shift+J，在 Mac 中按 Cmd+Opt+J，打开 JavaScript 控制台。使用以下几行 JS 代码获取 URL 并将它们保存到一个文件中:</p><pre class="kg kh ki kj gt nb nc nd ne aw nf bi"><span id="bf65" class="mk lt iq nc b gy ng nh l ni nj">urls <strong class="nc ir">=</strong> Array.from(document.querySelectorAll('.rg_di .rg_meta')).map(el<strong class="nc ir">=&gt;</strong>JSON.parse(el.textContent).ou);<br/>window.open('data:text/csv;charset=utf-8,' <strong class="nc ir">+</strong> escape(urls.join('\n')));</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nk"><img src="../Images/47d5e29975a828a079df068003d79458.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NaKm914mfOisrMBNu1oZ1A.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Source: Horror movie posters on <a class="ae kv" href="https://www.google.com/imghp?hl=en" rel="noopener ugc nofollow" target="_blank">Google images</a></figcaption></figure><p id="1c6e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，我们将 URL 的文件上传到我们的工作目录，在为我们的电影数据集创建的文件夹中:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nl"><img src="../Images/0e602dc98cfaf70dfd483989a290b8da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hjKErwEN_oPokSrdHcJ-rg.png"/></div></div></figure><h2 id="eabd" class="mk lt iq bd lu ml mm dn ly mn mo dp mc lf mp mq me lj mr ms mg ln mt mu mi mv bi translated">下载图像和查看数据:</h2><p id="69be" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated">我们可以使用 fast.ai 提供的<code class="fe nm nn no nc b">download_images</code>函数下载所有使用 URL 文件的图像，并使用‘show _ batch’函数查看它们:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="np nq l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/fe07f3f3dc1a4e861aa436d6cd1f4c7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1078/format:webp/1*jjA1WArMPl8OK-0kmr8_7Q.png"/></div></figure><h1 id="f00b" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">训练模型</h1><p id="e789" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated">既然我们的数据集已经准备好了，我们就可以训练模型了。我使用 ResNet-34 模型的预训练权重进行迁移学习。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="np nq l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/c664bc15242d7a3862a8bb7a4ee22b0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:834/format:webp/1*goNpdW0EH6FdGXZ4eDK7DA.png"/></div></figure><p id="2b17" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们现在有 80.5%的准确率。</p><h1 id="a747" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">解释</h1><p id="206a" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated">很多时候，低准确性是由于数据集的问题，例如训练或验证集中的错误标记的图像、可能属于多个高概率类的图像等。我们可以按如下方式查看混淆矩阵和最混淆的图像:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="np nq l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/3c2b39eeffd726394301eead6183b980.png" data-original-src="https://miro.medium.com/v2/resize:fit:764/format:webp/1*P00dbRqNeRBsRelg0o_9BA.png"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nu"><img src="../Images/e401d3f8795a348e8a04d4bb4142ba48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NKGByYJ8wx47h60nq8Ju1A.png"/></div></div></figure><p id="d339" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在大多数情况下，我们可以清楚地看到分类器混淆的原因。例如，第一张电影海报(银河护卫队)在我们的数据集中被错误地标记为“浪漫”，第二张图像没有任何恐怖的成分，因此被标记为“恐怖”，第五张海报(蝙蝠侠)看起来很像“恐怖”电影海报，第六张海报似乎有点不相关，第八张海报(侠探杰克)甚至对于一个人来说，仅仅看一眼海报(没有任何其他背景)并将其归类为“超级英雄”电影是不可能的。</p><h1 id="9720" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">清理</h1><p id="3272" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated">既然我们已经确定了导致问题的图像，我们可以通过删除问题图像来清理我们的数据集。我们可以使用 fast.ai 提供的“<a class="ae kv" href="https://github.com/fastai/fastai/blob/master/fastai/widgets/image_cleaner.py#L81" rel="noopener ugc nofollow" target="_blank"> ImageCleaner </a>”小部件，或者编写一个自定义函数来查看损失最大的图像，并删除我们认为有问题的图像(确保不要删除您认为分类器分类错误的图像，尽管它们显然属于给定的标签)。此外，创建原始数据集的副本，以防万一你想回到旧版本。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="np nq l"/></div></figure><p id="bff9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">完成清洁后，再次训练模型，看看是否有任何改进。</p><p id="ad22" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">以下是我清理数据集并再次训练后的结果:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/edbf2b37e2829385d3d428f6848f3dc2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1116/format:webp/1*20qL2BnMP8iEYSLWLVr28A.png"/></div></figure><h1 id="66d7" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">测试我们的分类器</h1><p id="6f1a" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated">找到一个不属于数据集的图像来测试您的分类器。将其上传到您的工作目录，并按如下方式进行测试:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="np nq l"/></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi gj"><img src="../Images/4c85028eb119ac7b8ad53c5fdd200a1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rWEez-K7KGJEZQW4rtQN0w.png"/></div></div></figure><h1 id="6db0" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">实验:</h1><p id="f4d2" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated">为了尝试和改进分类器，我想到并尝试了一些技术:</p><ol class=""><li id="4b63" class="nw nx iq ky b kz la lc ld lf ny lj nz ln oa lr ob oc od oe bi translated"><strong class="ky ir">减少训练图片的数量</strong>:这背后的动机是当你在谷歌图片搜索中向下滚动时，图片变得不那么相关。因此，为了确保我不会在我的数据集中看到许多不相关的图片，我将每个类的图片数量限制为 80 张。解冻前我得到了 68.8%的准确率，解冻后得到了 82.2%的准确率。即使在清理之后，准确率也没有提高多少，事实上，因为图像的数量更少，所以准确率更低了。这清楚地表明，为了有一个训练有素的模型，我们需要有大量的数据。</li></ol><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi of"><img src="../Images/ae4a3c29538e48f60af23025a39a17c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:722/format:webp/1*7osWWqQlaks0u23DVlj4FA.png"/></div></figure><p id="892f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">2.<strong class="ky ir">增加训练图像的数量</strong>:通过使用 600 张图像，我注意到不解冻的准确率下降到 43%，解冻一次清理后，我能达到的最高准确率是 49.4%。低精度很可能是因为存在更多的不相关图像，如前一点所述。事实证明，最好有较少但相关的图片。</p><p id="773e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">3.<strong class="ky ir">精选图片:</strong>尽管在大多数情况下非常不切实际，但尝试在每个类别中精选大约 100 张图片并观察结果会很有趣。</p><p id="61e8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">4.<strong class="ky ir">用 resnet50 代替 resnet34 进行迁移学习</strong>:在迁移学习中，我们使用的基础模型非常重要。我们可以尝试不同的模型，挑选最好的一个。</p><p id="1bf8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">5.<strong class="ky ir">增加/改变课程</strong>:在这个实验中，我注意到恐怖和超级英雄电影海报有一个非常相似的主题(黑暗、阴郁、严肃)，尝试更多互斥的课程可能会得到更好的结果。</p><h1 id="1ace" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">观察</h1><p id="c5a9" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated">我们的分类器已经大致了解了这三种类型的典型电影海报的外观。虽然我们已经尽量减少重叠课，但事实证明，很多超级英雄电影海报看起来很恐怖，恐怖电影海报看起来很浪漫等等。然而，87.2%的准确率已经相当不错了，因为我们是从零开始构建数据集的，而且类别重叠的几率很高。</p></div></div>    
</body>
</html>