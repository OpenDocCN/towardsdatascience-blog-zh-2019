<html>
<head>
<title>Basic Principles to Create a Time Series Forecast</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">创建时间序列预测的基本原则</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/basic-principles-to-create-a-time-series-forecast-6ae002d177a4?source=collection_archive---------3-----------------------#2019-05-28">https://towardsdatascience.com/basic-principles-to-create-a-time-series-forecast-6ae002d177a4?source=collection_archive---------3-----------------------#2019-05-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="12d6" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">解释创建<em class="ki">时间序列预测</em>的基本步骤。</h2></div><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/b00d89c3301cc357900b03c8eb8975e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_z1sNNnWnjFR1EVDc7drvA.jpeg"/></div></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk">Photo by <a class="ae kz" href="https://unsplash.com/photos/XS7q-baZrmE?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Adrian Schwarz</a> on <a class="ae kz" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="e6de" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我们被随处可见的模式所包围，人们可以注意到与天气有关的四季模式；指交通流量的高峰时间模式；在你的心跳中，在股票市场的股票中，也在某些产品的销售周期中。</p><p id="ec5d" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">分析时间序列数据对于检查这些模式和创建未来预测非常有用。创建这些预测有几种方法，在这篇文章中，我将介绍最基本和传统的方法。</p><p id="81a8" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">所有代码都是用 Python 写的，另外，任何附加信息都可以在我的<a class="ae kz" href="https://nbviewer.jupyter.org/github/leandrovrabelo/tsmodels/blob/master/notebooks/english/Basic%20Principles%20for%20Time%20Series%20Forecasting.ipynb" rel="noopener ugc nofollow" target="_blank"> Github </a>上看到。</p><p id="09bc" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">那么让我们开始评论分析<em class="lw">时间序列</em>的初始条件:</p><h1 id="5dcc" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">平稳序列</h1><p id="21be" class="pw-post-body-paragraph la lb it lc b ld mp ju lf lg mq jx li lj mr ll lm ln ms lp lq lr mt lt lu lv im bi translated">平稳时间序列的统计特性，如均值、方差和自相关，在一段时间内相对恒定。因此，非平稳序列是其统计特性随时间而变化的序列。</p><p id="e52c" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在开始任何预测建模之前，有必要验证这些统计属性是否恒定，我将在下面解释这些要点:</p><ul class=""><li id="a471" class="mu mv it lc b ld le lg lh lj mw ln mx lr my lv mz na nb nc bi translated">常数平均值</li><li id="b3bf" class="mu mv it lc b ld nd lg ne lj nf ln ng lr nh lv mz na nb nc bi translated">恒定方差</li><li id="4d7d" class="mu mv it lc b ld nd lg ne lj nf ln ng lr nh lv mz na nb nc bi translated">自相关的</li></ul><h1 id="ad52" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">常数平均值</h1><p id="62ad" class="pw-post-body-paragraph la lb it lc b ld mp ju lf lg mq jx li lj mr ll lm ln ms lp lq lr mt lt lu lv im bi translated">平稳序列有一个相对恒定的平均值，没有看涨或看跌趋势。有一个恒定的平均值，周围有小的变化，更容易推断未来。</p><p id="b22a" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在有些情况下，方差相对于平均值较小，使用它来预测未来可能是一个很好的指标，下面的图表显示了相对恒定的平均值与方差之间的关系:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi ni"><img src="../Images/0911e71345ea057d2b0777c85ba5c595.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Hby5MHttu_-VAUyJPlTGjw.png"/></div></div></figure><p id="1b68" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在这种情况下，如果序列不是稳定的，对未来的预测将是无效的，因为平均值周围的变化会显著偏离，如下图所示:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi ni"><img src="../Images/981aa0a2f995bf91d9e1586017fbd890.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pLtMOEphEigX2GiagURHlQ.png"/></div></div></figure><p id="1320" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在上面的图表中，很明显有一个看涨的趋势，均值在逐渐上升。在这种情况下，如果用平均值来预测未来，误差会很大，因为预测价格总是低于实际价格。</p><h1 id="024b" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">恒定方差</h1><p id="732a" class="pw-post-body-paragraph la lb it lc b ld mp ju lf lg mq jx li lj mr ll lm ln ms lp lq lr mt lt lu lv im bi translated">当序列具有恒定的方差时，我们对相对于平均值的标准方差有一个概念，当方差不恒定时(如下图),预测在某些时期可能会有较大的误差，这些时期将是不可预测的，预计方差将随着时间的推移保持不变，包括在未来。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi ni"><img src="../Images/0bfaa7ae2f6539fef8e44788d4026e18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HU5boFGU36NB5EECFTyx_Q.png"/></div></div></figure><p id="89e3" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">为了减少方差影响，可以应用对数变换。在这种情况下，也可以使用指数变换，如 Box-Cox 方法，或使用通货膨胀调整。</p><h1 id="0995" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">自相关序列</h1><p id="95ca" class="pw-post-body-paragraph la lb it lc b ld mp ju lf lg mq jx li lj mr ll lm ln ms lp lq lr mt lt lu lv im bi translated">当两个变量在一段时间内相对于标准偏差具有相似的变化时，你可以说这些变量是相关的，例如，当体重随着心脏疾病而增加时，体重越大，心脏问题的发生率就越高。在这种情况下，相关性为正，图表看起来如下所示:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi ni"><img src="../Images/06ac8383518151dae988e4083561c1b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rK0W4gseKH-WLmucN9QoMA.png"/></div></div></figure><p id="2e75" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">负相关的一个例子是:对工作安全措施的投资越大，与工作相关的事故就越少。</p><p id="1d62" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">以下是几个具有相关级别的散点图示例:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nj"><img src="../Images/44963ad6172440c643310c9b4f37791f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PBHqyCWH8DtuBa8iIdqDzQ.png"/></div></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk">source: <a class="ae kz" href="https://upload.wikimedia.org/wikipedia/commons/d/d4/Correlation_examples2.svg" rel="noopener ugc nofollow" target="_blank">wikipedia</a></figcaption></figure><p id="f207" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">当主题为<strong class="lc iu">自相关</strong>时，表示某些之前的时段与当前时段存在相关性，具有这种相关性的时段被命名为<strong class="lc iu"><em class="lw"/></strong>，例如，在一个每小时都有测量值的序列中，今天 12:00 的温度与 24 小时前 12:00 的温度非常相似。如果你比较这 24 宫时间范围内的温度变化，将会有一个自相关，在这种情况下，我们将有一个与第 24 宫时间范围的自相关。</p><p id="bd03" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">自相关是用单个变量创建预测的条件，因为如果没有相关性，就不能使用过去的值来预测未来，当有多个变量时，就可以验证因变量和自变量的滞后之间是否存在相关性。</p><p id="8908" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">如果一个序列不具有自相关性，那么它就是一个具有随机和不可预测序列的序列，进行预测的最佳方法通常是使用前一天的值。下面我会用更详细的图表和解释。</p><p id="19b1" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">从这里我将分析 Esalq 的每周含水乙醇价格(这是在巴西谈判含水乙醇的价格参考)，数据可以在这里下载<a class="ae kz" href="https://www.cepea.esalq.usp.br/br/indicador/etanol.aspx" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="3f32" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">价格以每立方米巴西雷亚尔(BRL/m3)为单位。</p><p id="183d" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在开始任何分析之前，让我们在训练和测试集上分割数据</p><h1 id="0f10" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">在培训和测试的基础上划分数据</h1><p id="4767" class="pw-post-body-paragraph la lb it lc b ld mp ju lf lg mq jx li lj mr ll lm ln ms lp lq lr mt lt lu lv im bi translated">当我们要创建时间序列预测模型时，将数据分成两部分至关重要:</p><p id="bb2a" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated"><strong class="lc iu">训练集</strong>:这些数据将是定义模型系数/参数的主要依据；</p><p id="fb4f" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated"><strong class="lc iu">测试集</strong>:这些数据将被分离出来，不会被模型看到，以测试模型是否工作(一般情况下，这些值与一个向前移动的方法进行比较，最后测量平均误差)。</p><p id="3319" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">测试集的大小通常约为总样本的 20%,尽管该百分比取决于您拥有的样本大小以及您希望提前多长时间进行预测。理想情况下，测试集应该至少与所需的最大预测范围一样大。</p><p id="3dd8" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">与其他预测方法不同，例如不受时间影响的分类和回归，在时间序列中我们不能用来自数据任何部分的随机样本来划分训练和测试数据，我们必须遵循序列的时间标准，其中训练数据应该总是在测试数据之前。</p><p id="0b49" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在这个 Esalq 含水价格的例子中，我们有 856 周，我们将使用前 700 周作为训练集，最后 156 周(3 年~ 18%)作为测试集:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nk"><img src="../Images/7759e716c2a5674692825ee7192fabef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y-bUfTjlmEYFxw9YSGe8Vw.png"/></div></div></figure><p id="8a1a" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">从现在开始，我们将只使用训练集来进行研究，测试集将只用于验证我们将做出的预测。</p><p id="71d1" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">每个时间序列都可以分解成 3 个部分:<strong class="lc iu">趋势、季节性</strong>和<strong class="lc iu">残差</strong>，这是从序列中去除前两个部分后剩余的部分，低于这些部分的分离:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nk"><img src="../Images/80499b6d41277d82bedde7e54345afa9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rj2ptmLW1zNa-cga5ge23g.png"/></div></div></figure><p id="982c" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">很明显，该系列呈上升趋势，峰值出现在每年的年末和年初，最小值出现在 4 月和 9 月(巴西中南部甘蔗压榨开始)。</p><p id="63a2" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">然而，它表明使用统计测试来确认序列是否是平稳的，我们将使用两个测试:T4 迪基-富勒测试和 KPSS 测试。</p><p id="a6a2" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">首先，我们将使用 Dickey-Fuller 检验，我将使用基数为 5%的 P 值，也就是说，如果 P 值低于这 5%,这意味着该序列在统计上是平稳的。</p><p id="e9fa" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">此外，还有模型的<strong class="lc iu">统计测试</strong>，其中这些值可以与 1%、5%和 10%的<strong class="lc iu">临界值</strong>进行比较，如果统计测试低于某个选定的临界值，序列将是稳定的:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nl"><img src="../Images/87d71dacedd198f6a115c26c88088510.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X6JUdhdqklxQtcGWA_Ichg.png"/></div></div></figure><p id="3352" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在这种情况下，Dickey-Fuller 检验表明序列不是平稳的(P 值 36%和临界值 5%小于统计检验)。</p><p id="d96e" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">现在，我们将使用 KPSS 检验来分析该序列，与迪基-富勒检验不同，KPSS 检验已经假设该序列是平稳的，只有当 P 值小于 5%或统计检验小于某个值时才不会是平稳的:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nl"><img src="../Images/167e88a7a21c3d914d1ffdbd46a6dfdb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LVJ6moCibulL_TNmJn5gOA.png"/></div></div></figure><p id="014f" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">KPSS 检验证实了迪基-富勒检验，也表明序列不是平稳的，因为 P 值为 1%，统计检验高于任何临界值。</p><p id="d16e" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">接下来，我将演示将数列转化为平稳数列的方法。</p><h1 id="fac2" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">将该系列转变为静止的</h1><h1 id="dd51" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">区别</h1><p id="06cd" class="pw-post-body-paragraph la lb it lc b ld mp ju lf lg mq jx li lj mr ll lm ln ms lp lq lr mt lt lu lv im bi translated">差分用于移除趋势信号并减少方差，它只是周期<strong class="lc iu"> T </strong>的值与前一周期<strong class="lc iu"> T-1 </strong>的值的差。</p><p id="f1a7" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">为了更容易理解，下面我们只得到乙醇价格的一小部分，以便更好地可视化，请注意，从 2005 年 5 月到 2006 年 5 月中旬，价格开始上涨，这些价格每周上涨，累积起来形成一个上升趋势，在这种情况下，我们有一个非平稳序列。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nm"><img src="../Images/0d488a070ad423129f669a5340fe7b54.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qPei4XC-FdTLgGZ7x47fGA.png"/></div></div></figure><p id="e82c" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在进行第一次微分时(如下图)，我们移除了系列的累积效应，仅显示了整个系列中期间<strong class="lc iu"> T </strong>相对于期间<strong class="lc iu"> T-1 </strong>的变化，因此，如果 3 天前的价格是 BRL 800.00，并更改为 BRL 850.00，微分的值将是 BRL 50.00，如果今天的值是 BRL 860.00，则差值将是-BRL 10.00。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nm"><img src="../Images/c844bcc54ead399081c7dfda3a635a4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m7hzrB8HgIshjBMJ6G1k9Q.png"/></div></div></figure><p id="79a2" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">通常只需要一次微分就可以将一个数列转化为平稳数列，但是如果有必要，可以进行第二次微分，在这种情况下，将对第一次微分的值进行微分(很少有超过两次微分的情况)。</p><p id="f897" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">使用相同的例子，为了进行第二次微分，我们必须对<strong class="lc iu"> T </strong>减去<strong class="lc iu"> T-1 </strong>进行微分:BRL 2.9—BRL 5.5 =—BRL 2.6，以此类推。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nn"><img src="../Images/60e3183fc0378193d1dfb6d85b0683ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9fmdrkJSvhtjWuFYymwyiA.png"/></div></div></figure><p id="e8fb" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">让我们做一下 Dickey-fuller 检验，看看这个级数在第一次微分时是否是平稳的:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi no"><img src="../Images/8233e7ca68ad3c7d4e8ebf12ae5bdee8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qlUmOuS5wWR46QAzbKGOIg.png"/></div></div></figure><p id="a535" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在这种情况下，我们确认序列是平稳的，P 值为零，当我们比较统计测试的值时，它远低于临界值。</p><p id="d0f6" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在下一个示例中，我们将尝试使用通货膨胀调整将序列转换为平稳序列。</p><h1 id="cdda" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">通货膨胀调整</h1><p id="6bcc" class="pw-post-body-paragraph la lb it lc b ld mp ju lf lg mq jx li lj mr ll lm ln ms lp lq lr mt lt lu lv im bi translated">价格是相对于交易时间而言的，2002 年乙醇的价格是 BRL 680.00，如果这种产品的价格在今天以这个价格交易，肯定会有许多工厂关闭，因为这是一个非常低的价格。</p><p id="af15" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">为了使系列平稳，我将使用 IPCA 指数(巴西<a class="ae kz" href="https://en.wikipedia.org/wiki/Consumer_price_index" rel="noopener ugc nofollow" target="_blank"> CPI 指数</a>)根据当前值调整整个系列，该指数从培训期结束(2016 年 4 月)一直累积到研究开始，数据来源在<a class="ae kz" href="https://agenciadenoticias.ibge.gov.br/agencia-detalhe-de-midia.html?view=mediaibge&amp;catid=2102&amp;id=2807" rel="noopener ugc nofollow" target="_blank">巴西地理统计局</a>网站上。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi np"><img src="../Images/8fa9e58ab6d98fe8105197b8e59236ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*px8IYKkaL1lSKsdyy7huRQ.png"/></div></div></figure><p id="b377" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">现在让我们看看级数是如何变得，以及它是否变得平稳。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nq"><img src="../Images/201a4e565bdf61ab89944c957eb8ceca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NaIhNbzHXJF_2Bc1c9kURg.png"/></div></div></figure><p id="04bf" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">可以看出，上升趋势已经消失，只剩下季节性振荡，迪基-富勒测试也证实了该系列现在是平稳的。</p><p id="3540" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">出于好奇，请看下图，图中显示了相对于原始系列的通货膨胀调整后的价格。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi nj"><img src="../Images/bb96a20fb8db4e7d199b84fbd6281e72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8q7R0MTmEUAv1pnSfiiJLQ.png"/></div></div></figure><h1 id="c02b" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">减少方差</h1><h1 id="9024" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">对数</h1><p id="69d5" class="pw-post-body-paragraph la lb it lc b ld mp ju lf lg mq jx li lj mr ll lm ln ms lp lq lr mt lt lu lv im bi translated">对数通常用于将具有指数增长值的序列转换为更具线性增长的序列，在本例中，我们将使用自然对数(NL)，其中底数为 2.718，这种对数广泛用于经济模型中。</p><p id="d59e" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">转换为 NL 的值的差异大约等于原始系列值的百分比变化，这是减少不同价格系列差异的有效基础，请参见下面的示例:</p><pre class="kk kl km kn gt nr ns nt nu aw nv bi"><span id="e7f6" class="nw ly it ns b gy nx ny l nz oa">If we have a product that had a price increase in 2000 and went from BRL 50.00 to 52.50, some years later (2019) the price was already BRL 100.00 and changed to BRL 105.00, the absolute difference between prices is BRL 2.50 and BRL 5.00 respectively, however the percentage difference of both is 5%.</span></pre><p id="511c" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">当我们在这些价格中使用 LN 时，我们得到:NL (52，50)-NL(50，00) = 3，96–3，912 = 0，048 或 4.8%，以同样的方式在第二个价格序列中使用 LN，我们得到:NL(105)-NL(100)= 4.654–4.605 = 0.049 或 4.9%。</p><p id="c92f" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在这个例子中，我们可以通过将几乎所有东西放在同一个基础上来减少值的变化。</p><p id="3364" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">下面同一个例子:</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="ob oc l"/></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk">Result: <strong class="ak">The percentage variation of the first example is 4.9 and the second is 4.9</strong></figcaption></figure><p id="76f5" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">下表比较了 X 的百分比变化值与 NL (X)的变化值:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi od"><img src="../Images/b1412b5d5f134b17871ebe0c9f74000d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r3TGDFRXrDnn6Yad4y9FVQ.png"/></div></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk"><a class="ae kz" href="http://people.duke.edu/~rnau/411log.htm" rel="noopener ugc nofollow" target="_blank">Source</a></figcaption></figure><p id="1566" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">让我们绘制原始序列和 NL 变换序列之间的对比图:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi oe"><img src="../Images/293f53659cbf87309b754d95f21d55a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZUQwBlta0ZBdgcRSuxZIaQ.png"/></div></div></figure><h1 id="8514" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">Box-Cox 变换(幂变换)</h1><p id="925e" class="pw-post-body-paragraph la lb it lc b ld mp ju lf lg mq jx li lj mr ll lm ln ms lp lq lr mt lt lu lv im bi translated">BOX COX 变换也是一种变换级数的方法，λ(λ)值是用于变换级数的参数。</p><p id="5b36" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">简而言之，该函数是几个指数变换函数的结合点，在这里我们搜索变换级数的最佳λ值，使其具有更接近正态高斯分布的分布。使用此变换的一个条件是序列只有正值，公式为:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi of"><img src="../Images/854096367a48e748148fc2e600b4b267.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OtjAVb8m8idr8LDwp7AbMw.png"/></div></div></figure><p id="3024" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">下面，我将绘制原始序列及其分布，然后绘制具有最佳λ值的变换序列及其新分布，为了找到λ值，我们将使用库<a class="ae kz" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.boxcox.html" rel="noopener ugc nofollow" target="_blank"> Scipy </a>的函数<strong class="lc iu"> boxcox </strong>，它生成变换序列和理想λ:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi og"><img src="../Images/d539ad72c7054134cf99bbec5a6b64d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*so1SHfEjleql6guHodQB2w.png"/></div></div></figure><p id="446a" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">下面是一个交互式图表，您可以在其中更改 lambda 值并检查图表中的更改:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi oh"><img src="../Images/c9331576ff961146a22b04982a958ad5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*ECmaKH-v9cTakayjjY4Uog.gif"/></div></div></figure><p id="aa67" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">此工具通常用于提高模型的性能，因为它使模型更符合正态分布，请记住，在完成模型的预测后，您必须返回到原始基数，根据下面的公式对变换进行反演:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi oi"><img src="../Images/bf5cc1b6d538ece2b218fbb093490454.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F3cd46seiPalCSnfeBL_iQ.png"/></div></div></figure><h1 id="438f" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">寻找相关的滞后</h1><p id="aa90" class="pw-post-body-paragraph la lb it lc b ld mp ju lf lg mq jx li lj mr ll lm ln ms lp lq lr mt lt lu lv im bi translated">要想预测，单变量序列必须具有自相关性，也就是说，当前周期必须基于更早的周期进行解释(一个<strong class="lc iu">滞后</strong>)。</p><p id="fafa" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">由于该系列具有周周期，1 年大约是 52 周，我将使用显示 60 个滞后周期的自相关函数来验证当前周期与这些滞后的相关性。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi oj"><img src="../Images/92ffd511d31d3356833868c02e96affd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xr0jMRJI6H0n3GMD57yc6g.png"/></div></div></figure><p id="a24a" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">分析上面的自相关图表，似乎所有的滞后都可以用于创建对未来事件的预测，因为它们具有接近 1 的正相关性，并且它们也在置信区间之外，但是该特征是非平稳序列。</p><p id="17c9" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">另一个非常重要的功能是部分自相关功能，其中先前滞后对当前周期的影响被移除，并且仅在当前周期上被分析的滞后的影响被保留，例如:第四个滞后的部分自相关将移除第一、第二和第三个滞后的影响。</p><p id="e861" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在部分自相关图下面:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi oj"><img src="../Images/5e32e229def8d5c2ef57999475d873ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mU3t2PllWhqeV97hSxhPJA.png"/></div></div></figure><p id="4f75" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">可以看出，几乎没有滞后对当前周期产生影响，但是如前所述，没有微分的序列不是稳定的，我们现在将绘制这两个函数与具有一个微分的序列的关系，以了解其工作原理:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi oj"><img src="../Images/e63bd9620905785b18579c65b45351c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vok_3eK0n_JOLggAaybO5Q.png"/></div></div></figure><p id="2d2c" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">自相关图发生了显著变化，表明该序列仅在第一个滞后期具有显著相关性，在第 26 个月(半年)左右具有负相关的季节性效应。</p><p id="4aa8" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">要创建预测，我们必须注意一个关于寻找相关滞后的极其重要的细节，这种相关性背后有一个原因是很重要的，因为如果没有逻辑原因，这可能只是一个机会，当您包含更多数据时，这种相关性可能会消失。</p><p id="d368" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">另一个要点是，自相关和部分自相关图对异常值非常敏感，因此分析时间序列本身并与两个自相关图进行比较非常重要。</p><p id="3062" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在这个例子中，第一个滞后与当前周期具有高相关性，因为前一周的价格历史上没有显著变化，在相同的情况下，第 26 个滞后呈现负相关性，表明与当前周期相反的趋势，这可能是由于一年中供应和需求的不同周期。</p><p id="a4b0" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">由于通货膨胀调整后的序列已经稳定，我们将使用它来创建我们的预测，在调整后的序列的自相关和部分自相关图下方:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi oj"><img src="../Images/67b00e700656e43c6874f0b4b463d3f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1IGk8ozCgBKoO10AJALw_g.png"/></div></div></figure><p id="a78f" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我们将只使用前两个滞后作为自回归序列的预测值。</p><p id="bf47" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">要了解更多信息，杜克大学教授罗伯特·瑙的<a class="ae kz" href="http://people.duke.edu/~rnau/411home.htm" rel="noopener ugc nofollow" target="_blank">网站</a>是与该主题相关最好的网站之一。</p><h1 id="df00" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">评估模型的指标</h1><p id="2640" class="pw-post-body-paragraph la lb it lc b ld mp ju lf lg mq jx li lj mr ll lm ln ms lp lq lr mt lt lu lv im bi translated">为了分析预测值是否接近当前值，必须测量误差，这种情况下的误差(或残差)基本上是 Yreal YpredYreal Ypred。</p><p id="6d7e" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">评估训练数据中的错误以验证模型是否具有良好的断言性，并通过检查测试数据中的错误(模型“看不到”的数据)来验证模型。</p><p id="a1aa" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">当您将训练数据与测试数据进行比较时，检查错误对于验证您的模型是过拟合还是欠拟合非常重要。</p><p id="ebf0" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">以下是用于评估时序模型的关键指标:</p><h1 id="bd6f" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">平均预测误差—(偏差)</h1><p id="b8be" class="pw-post-body-paragraph la lb it lc b ld mp ju lf lg mq jx li lj mr ll lm ln ms lp lq lr mt lt lu lv im bi translated">它只不过是被评估系列误差的平均值，值可以是正的也可以是负的。这一指标表明模型倾向于做出高于真实值(负误差)或低于真实值(正误差)的预测，因此也可以说<strong class="lc iu">平均预测误差</strong>是模型的偏差。</p><h1 id="4c6a" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">平均绝对误差</h1><p id="db68" class="pw-post-body-paragraph la lb it lc b ld mp ju lf lg mq jx li lj mr ll lm ln ms lp lq lr mt lt lu lv im bi translated">这个度量非常类似于上面提到的预测的平均误差，唯一的区别是将负值误差转换为正值，然后计算平均值。</p><p id="1b6b" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">此指标广泛用于时间序列，因为在某些情况下，负误差可以抵消正误差，从而表明模型是准确的，但在 MAE 的情况下，这种情况不会发生，因为此指标显示了预测值与实际值的差距，无论是高于还是低于实际值，请参见下面的情况:</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="ob oc l"/></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk">Result: <strong class="ak">The error of each model value looks like this: [-4 -2 0 2 4]<br/>The MFE error was 0.0, the MAE error was 2.4</strong></figcaption></figure><h1 id="6094" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">MSE——均方误差</h1><p id="1acd" class="pw-post-body-paragraph la lb it lc b ld mp ju lf lg mq jx li lj mr ll lm ln ms lp lq lr mt lt lu lv im bi translated">该指标对较大的误差给予更大的权重，因为每个误差值都是平方的，然后计算平均值。因此，该指标对异常值非常敏感，并对具有更大误差的预测给予很大权重。</p><p id="7e3a" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">与 MAE 和 MFE 不同，MSE 值采用二次单位，而不是模型的单位。</p><h1 id="375e" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">RMSE —均方根误差</h1><p id="e85c" class="pw-post-body-paragraph la lb it lc b ld mp ju lf lg mq jx li lj mr ll lm ln ms lp lq lr mt lt lu lv im bi translated">此指标是 MSE 的平方根，其中误差返回到模型的测量单位(BRL/立方米)，它在时间序列中非常常用，因为它对源于平方过程的较大误差更敏感。</p><h1 id="2d1f" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">MAPE —平均绝对百分比误差</h1><p id="3621" class="pw-post-body-paragraph la lb it lc b ld mp ju lf lg mq jx li lj mr ll lm ln ms lp lq lr mt lt lu lv im bi translated">这是另一个有趣的指标，通常用在管理报告中，因为误差是以百分比来衡量的，所以产品 X 的误差可以与产品 y 的误差进行比较。</p><p id="8976" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">此指标的计算采用误差的绝对值除以当前价格，然后计算平均值:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi oj"><img src="../Images/81f70913a26c2a060a646c5d7e9b6a4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uHZP5Rzst1wUyHPEo5sXOA.png"/></div></div></figure><p id="f2d1" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">让我们创建一个函数，用几个评估指标来评估训练和测试数据的错误:</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="ob oc l"/></div></figure><h1 id="4a40" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">检查残值</h1><p id="9879" class="pw-post-body-paragraph la lb it lc b ld mp ju lf lg mq jx li lj mr ll lm ln ms lp lq lr mt lt lu lv im bi translated">根据所选的度量标准创建模型并检查误差值是不够的，您还必须分析残差本身的特征，因为在有些情况下，模型无法捕获做出良好预测所必需的信息，从而导致用于改进预测的信息出现错误。</p><p id="b425" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">为了验证该残差，我们将检查:</p><ul class=""><li id="6bb8" class="mu mv it lc b ld le lg lh lj mw ln mx lr my lv mz na nb nc bi translated"><strong class="lc iu">当前值与预测值(顺序图)</strong>；</li><li id="4169" class="mu mv it lc b ld nd lg ne lj nf ln ng lr nh lv mz na nb nc bi translated"><strong class="lc iu">残差与预测值(离差图)</strong>:</li></ul><p id="71ce" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">分析此图非常重要，因为在其中我们可以检查模式，这些模式可以告诉我们模型中是否需要一些修改，理想情况是误差沿着预测序列线性分布。</p><ul class=""><li id="5db5" class="mu mv it lc b ld le lg lh lj mw ln mx lr my lv mz na nb nc bi translated"><a class="ae kz" href="https://en.wikipedia.org/wiki/Q%E2%80%93Q_plot" rel="noopener ugc nofollow" target="_blank"><strong class="lc iu">【QQ 剧情】</strong> </a> <strong class="lc iu">【残(散图)】</strong>:</li></ul><p id="0be7" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">总结一下，这张图显示了残差在理论上的分布，遵循高斯分布，而实际上是如何分布的。</p><ul class=""><li id="d24b" class="mu mv it lc b ld le lg lh lj mw ln mx lr my lv mz na nb nc bi translated"><strong class="lc iu">残差自相关(顺序图):</strong></li></ul><p id="f217" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">其中不应有超出置信界限的值，或者模型将信息排除在模型之外。</p><p id="e443" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我们需要创建另一个函数来绘制这些图形:</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="ob oc l"/></div></figure><h1 id="6f04" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">最基本的预测方法</h1><p id="816f" class="pw-post-body-paragraph la lb it lc b ld mp ju lf lg mq jx li lj mr ll lm ln ms lp lq lr mt lt lu lv im bi translated">从现在开始，我们将创建一些含水乙醇的价格预测模型，下面是我们将为每个模型遵循的步骤:</p><ul class=""><li id="9edb" class="mu mv it lc b ld le lg lh lj mw ln mx lr my lv mz na nb nc bi translated">根据训练数据创建预测，然后根据测试数据进行验证；</li><li id="54a2" class="mu mv it lc b ld nd lg ne lj nf ln ng lr nh lv mz na nb nc bi translated">根据上述指标检查每个模型的误差；</li><li id="b59e" class="mu mv it lc b ld nd lg ne lj nf ln ng lr nh lv mz na nb nc bi translated">用剩余比较值绘制模型。</li></ul><p id="08f8" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">让我们看看模特们:</p><h1 id="2f7f" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">天真的方法:</h1><p id="6a16" class="pw-post-body-paragraph la lb it lc b ld mp ju lf lg mq jx li lj mr ll lm ln ms lp lq lr mt lt lu lv im bi translated">进行预测的最简单方法是使用前期的值，这是在某些情况下可以做到的最佳方法，与其他预测方法相比，这种方法的误差较低。</p><p id="90da" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">一般来说，这种方法不能很好地预测未来的许多时期，因为相对于实际值，误差往往会增加。</p><p id="5731" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">许多人也使用这种方法作为基线，试图改进更复杂的模型。</p><p id="b4dd" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">下面我们将使用训练和测试数据进行模拟:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi ok"><img src="../Images/98a463d097c3e191842daecaabb9065d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Rp8hcM77y41-RINSsU3rPQ.png"/></div></div></figure><p id="4379" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">QQ 图显示，存在一些比理论上应该的更大的(上下)残差，这些是所谓的异常值，并且在第一、第六和第七滞后中仍然存在显著的自相关，这可以用于改进模型。</p><p id="6320" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">同样，我们现在将在测试数据中进行预测。预测系列的第一个值将是训练数据的最后一个值，然后这些值将由测试的当前值逐步更新，依此类推:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi ok"><img src="../Images/cc6b681960265ad26dccb3903e51ceb1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HwIeQAL0FSJ2PVwwGLy5xw.png"/></div></div></figure><p id="bef8" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">RMSE 和梅误差与训练数据相似，QQ 图的残差更符合理论上的情况，这可能是由于与训练数据相比样本值较少。</p><p id="7e21" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在比较残差与预测值的图表中，注意到当价格增加时，误差的绝对值有增加的趋势，也许对数调整会减少这种误差扩大，最终确定残差相关图表明仍有改进的空间，因为在第一个滞后中有很强的相关性，其中可能会添加基于第一个滞后的回归以改进预测。下一个模型是简单平均值:</p><h1 id="b5ca" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">简单平均值:</h1><p id="f50c" class="pw-post-body-paragraph la lb it lc b ld mp ju lf lg mq jx li lj mr ll lm ln ms lp lq lr mt lt lu lv im bi translated">另一种进行预测的方法是使用序列平均值，通常这种形式的预测适用于值在平均值附近波动、方差恒定且没有上升或下降趋势的情况，但是也可以使用更好的方法，其中可以使用季节模式进行预测。</p><p id="d258" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">该模型使用数据开始时的平均值，直到前一个分析周期，并且每天扩展，直到数据结束，最后，趋势是直线，我们现在将比较该模型与第一个模型的误差:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi ol"><img src="../Images/6f9f7eb0d36dc3bd1b995fc40b605475.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VNdHD4OgsZl1P6BegxlM0A.png"/></div></div></figure><p id="dae2" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在测试数据中，我将继续使用从训练数据开始的平均值，并使用将添加到测试数据中的值来扩展平均值:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi ok"><img src="../Images/5e30249f626c84ae6a7f20c0c1efc8b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qm6OtmB07qwpqPFF2gF1kg.png"/></div></div></figure><p id="a9a3" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">简单均值模型未能捕捉到序列的相关信息，这可以从实际与预测图以及相关和残差与预测图中看出。</p><h1 id="d59a" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">简单移动平均线:</h1><p id="489a" class="pw-post-body-paragraph la lb it lc b ld mp ju lf lg mq jx li lj mr ll lm ln ms lp lq lr mt lt lu lv im bi translated">移动平均值是为给定期间(例如 5 天)计算的平均值，并且是移动的，并且总是使用该特定期间进行计算，在这种情况下，我们将总是使用过去 5 天的平均值来预测第二天的值。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi ol"><img src="../Images/55528e942a83a2302d72e3e81942e28d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SlyYP9obKvfOOJ1mxMsEzg.png"/></div></div></figure><p id="cee2" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">误差低于简单平均值，但仍高于简单模型，低于测试模型:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi ok"><img src="../Images/274928833e87328ecd5e2c6b7f9f7f41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Hqa8rHsrDOjOmNGaHOlppQ.png"/></div></div></figure><p id="c54d" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">与训练数据类似，移动平均线模型优于简单平均线模型，但是它们还没有从简单模型中获益。</p><p id="df5c" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">预测在两个滞后中具有自相关，并且误差相对于预测值具有非常高的方差。</p><h1 id="2191" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">指数移动平均线:</h1><p id="b8c3" class="pw-post-body-paragraph la lb it lc b ld mp ju lf lg mq jx li lj mr ll lm ln ms lp lq lr mt lt lu lv im bi translated">上面描述的<strong class="lc iu">简单移动平均</strong>模型具有平等对待最后 X 个观察值并完全忽略所有先前观察值的特性。直觉上，过去的数据应该逐渐被忽略，例如，最近的观察结果理论上应该比第二最近的稍微重要一点，第二最近的应该比第三最近的稍微重要一点，以此类推，<strong class="lc iu">指数移动平均线(EMM) </strong>模型就是这样做的。</p><p id="9bda" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">由于<strong class="lc iu">α</strong>(α)是一个介于 0 和 1 之间的常数，我们将使用以下公式计算预测值:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi om"><img src="../Images/586a6d8b91af667d63c27a8eb2af5bd9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l9z-qJKkEmm6SXgjrLWEnQ.png"/></div></div></figure><p id="1a13" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">当预测的第一个值是相应的当前值时，其他值将被更新为实际值与前一时段的预测值之差的<strong class="lc iu"> α </strong>倍。当<strong class="lc iu"> α </strong>为零时，我们有一个基于第一个预测值的常数，当<strong class="lc iu"> α </strong>为 1 时，我们有一个采用<strong class="lc iu">简单方法</strong>的模型，因为结果是前一个真实周期的值。</p><p id="d88d" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">下图是几个<strong class="lc iu"> α </strong>值的图表:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi on"><img src="../Images/7ea00de830a2498b98193865ada0fba7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GDA60nu3mJq7GGJdCRcXCA.png"/></div></div></figure><p id="674d" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">EMM 预报的平均数据周期为 1 / <strong class="lc iu"> α </strong>。比如当<strong class="lc iu"> α </strong> = 0.5 时，滞后相当于 2 个周期；当<strong class="lc iu"> α </strong> = 0.2 时，滞后 5 个周期；当<strong class="lc iu"> α </strong> = 0.1 时，滞后为 10 个周期，以此类推。</p><p id="2dd7" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在这个模型中，我们将任意使用 0.50 的<strong class="lc iu"> α </strong>，但是您可以执行<em class="lw">网格搜索</em>来寻找<strong class="lc iu"> α </strong>，这减少了训练和验证中的误差，我们将看到它看起来是什么样子:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi oo"><img src="../Images/6431efea96c0afdf5b283972aa207927.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VAp5-vG9SE-4byn9aCHmzA.png"/></div></div></figure><p id="210d" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">该模型的误差类似于移动平均线的误差，但是，我们必须在测试库中验证该模型:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi op"><img src="../Images/26a7352cc5a4c92a78c183f13681945d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*icxJg4znhr1fIGR9Fa6kAQ.png"/></div></div></figure><p id="ca13" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">在验证数据中，迄今为止的误差是我们已经训练的模型中第二好的，但是残差的图形特征与 5 天移动平均模型的图形非常相似。</p><h1 id="9629" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">自回归:</h1><p id="0bc7" class="pw-post-body-paragraph la lb it lc b ld mp ju lf lg mq jx li lj mr ll lm ln ms lp lq lr mt lt lu lv im bi translated">自回归模型基本上是具有显著相关滞后的线性回归，其中自相关和偏自相关图表应首先绘制以验证是否有任何相关。</p><p id="e70e" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">以下是训练序列的自相关和偏自相关图表，显示了具有显著相关性的两个滞后的自回归模型的特征:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi oq"><img src="../Images/e131fc62c9c3490b4d4d481220d7155c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8OmQCEyKOUSVzm72XpnG0g.png"/></div></div></figure><p id="9b4b" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">下面，我们将基于训练数据创建模型，在获得模型的系数后，我们将它们乘以测试数据所执行的值:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi or"><img src="../Images/3d65566e8d62d344e0351d2a480fde20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YqWU3cyYGBp8zXyU89ofdA.png"/></div></div></figure><p id="8ae7" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">与我们训练的所有其他模型相比，此模型中的误差最低，现在让我们使用其系数来逐步预测训练数据:</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi os"><img src="../Images/2bbdb70671c76118e8fba5c4870b1cf5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6xxasZZLz3gyPKp8yad1JA.png"/></div></div></figure><p id="1e16" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">请注意，在测试数据中，误差没有保持稳定，甚至比<strong class="lc iu">简单模型</strong>更差，请注意，在图表中，预测值几乎总是低于当前值，偏差测量显示实际值比预测值高 BRL 50.19，可能调整训练模型中的一些参数，这种差异会减小。</p><p id="0478" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">为了改进这些模型，你可以应用一些转换，比如本文中解释的那些，你也可以添加外部变量作为预测源，但是，这是另一篇文章的主题。</p><h1 id="8459" class="lx ly it bd lz ma mb mc md me mf mg mh jz mi ka mj kc mk kd ml kf mm kg mn mo bi translated">最终考虑</h1><p id="2ad5" class="pw-post-body-paragraph la lb it lc b ld mp ju lf lg mq jx li lj mr ll lm ln ms lp lq lr mt lt lu lv im bi translated">每个时间序列模型都有自己的特点，应该单独分析，以便我们可以提取尽可能多的信息，做出良好的预测，减少未来的不确定性。</p><p id="5155" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">检查平稳性、转换数据、在训练数据中创建模型、验证测试数据以及检查残差是创建良好的时间序列预测的关键步骤。</p><p id="250a" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">另见我关于<a class="ae kz" href="https://www.kaggle.com/leandrovrabelo/climate-change-forecast-sarima-model" rel="noopener ugc nofollow" target="_blank"> ARIMA 车型</a>的帖子。</p><p id="41de" class="pw-post-body-paragraph la lb it lc b ld le ju lf lg lh jx li lj lk ll lm ln lo lp lq lr ls lt lu lv im bi translated">我希望你喜欢这篇文章，如果你有任何问题或你需要的信息，不要犹豫，通过我的<a class="ae kz" href="https://www.linkedin.com/in/leandro-rabelo-08722824" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>联系我，也可以在这里评论。</p></div></div>    
</body>
</html>