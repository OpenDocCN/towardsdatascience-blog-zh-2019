<html>
<head>
<title>Deploy a Kafka Cluster with Terraform and Ansible</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Terraform 和 Ansible 部署 Kafka 集群</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/deploy-a-kafka-cluster-with-terraform-and-ansible-21bee1ee4fb?source=collection_archive---------3-----------------------#2019-11-03">https://towardsdatascience.com/deploy-a-kafka-cluster-with-terraform-and-ansible-21bee1ee4fb?source=collection_archive---------3-----------------------#2019-11-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c27e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">供应、部署和管理 Kafka 平台的简单方法</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/e97f9f6ba8a4fdceb11c910d1aee75e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*P9bEFY2jpmNd1gKe"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Photo by <a class="ae ky" href="https://unsplash.com/@lucabravo?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Luca Bravo</a> on <a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="ee8a" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">概观</h1><p id="af95" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在我之前的<a class="ae ky" rel="noopener" target="_blank" href="/install-a-kafka-cluster-on-ubuntu-in-aws-17c951287284">帖子——在 AWS 中的 Ubuntu 上安装 Kafka 集群</a>中，我已经详细描述了在 AWS 中手动设置消息传递主干的步骤。这是理解卡夫卡如何工作的伟大一步，但这需要很长时间，并且不可扩展。</p><p id="64f8" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">一个 Kafka 集群有几个组件，如代理、动物园管理员、运行在多个实例上的工人，如下例所示。供应、部署和管理您的平台的最简单方法是使用可自动执行此任务的工具。</p><p id="fd2a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在这篇文章中，我将解释如何使用 Terraform 快速提供多个实例，然后使用 Ansible 在这些实例上安装 Kafka 来设置您的集群。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ms"><img src="../Images/39df5c490057d18b3288cb9fa5e269ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sJtrzB4UE6TKh8O7Q5c0vQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">from AWS: <a class="ae ky" href="https://aws.amazon.com/quickstart/architecture/confluent-platform/" rel="noopener ugc nofollow" target="_blank">https://aws.amazon.com/quickstart/architecture/confluent-platform/</a></figcaption></figure><p id="2749" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">首先，让我们从高层次的角度快速理解什么是 Terraform 和 Ansible</p><h1 id="c9ee" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">将（行星）地球化（以适合人类居住）</h1><p id="0a81" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated"><strong class="lt iu"> Terraform </strong>是<a class="ae ky" href="https://en.wikipedia.org/wiki/Open-source_software" rel="noopener ugc nofollow" target="_blank">开源</a> <a class="ae ky" href="https://en.wikipedia.org/wiki/Infrastructure_as_code" rel="noopener ugc nofollow" target="_blank">基础设施 as code </a>软件工具，由<a class="ae ky" href="https://en.wikipedia.org/wiki/HashiCorp" rel="noopener ugc nofollow" target="_blank"> HashiCorp </a>打造。它使用户能够使用被称为 Hashicorp 配置语言(HCL)的高级配置语言或可选的<a class="ae ky" href="https://en.wikipedia.org/wiki/JSON" rel="noopener ugc nofollow" target="_blank"> JSON </a>来定义和配置基础设施。</p><p id="091f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">Terraform 支持许多云基础设施提供商，如<a class="ae ky" href="https://en.wikipedia.org/wiki/Amazon_Web_Services" rel="noopener ugc nofollow" target="_blank">亚马逊网络服务</a>、<a class="ae ky" href="https://en.wikipedia.org/wiki/Google_Cloud_Platform" rel="noopener ugc nofollow" target="_blank">谷歌云平台</a>、<a class="ae ky" href="https://en.wikipedia.org/wiki/Microsoft_Azure" rel="noopener ugc nofollow" target="_blank">微软 Azure </a>。</p><p id="904c" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">Terraform 生成一个执行计划，描述它将做什么来达到期望的状态，然后执行它来构建所描述的基础设施。随着配置的变化，Terraform 能够确定发生了什么变化，并创建可以应用的增量执行计划。</p><p id="968f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">使用高级配置语法来描述基础结构。这允许对数据中心的蓝图进行版本控制，并像对待任何其他代码一样对待它。此外，基础架构可以共享和重复使用。</p><h1 id="0866" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">Ansible</h1><p id="ca2c" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">Ansible 是一个非常简单的 IT 自动化平台，使您的应用程序和系统更容易部署。避免编写脚本或自定义代码来部署和更新您的应用程序——使用一种接近简单英语的语言，使用 SSH 来实现自动化，无需在远程系统上安装代理。</p><h1 id="a3a3" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">我们开始吧</h1><p id="6e25" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">首先，让我们安装 Terraform 和 Ansible</p><p id="3c08" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu">地形</strong></p><p id="13b1" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">您可以按照下面的说明进行操作，或者如果您使用的是 Mac，最简单的方法是使用 brew:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="ca3b" class="my la it mu b gy mz na l nb nc">brew install terraform</span></pre><div class="nd ne gp gr nf ng"><a href="https://learn.hashicorp.com/terraform/getting-started/install.html" rel="noopener  ugc nofollow" target="_blank"><div class="nh ab fo"><div class="ni ab nj cl cj nk"><h2 class="bd iu gy z fp nl fr fs nm fu fw is bi translated">安装 Terraform</h2><div class="nn l"><h3 class="bd b gy z fp nl fr fs nm fu fw dk translated">Terraform 必须首先安装在您的机器上。Terraform 以二进制包的形式发布，适用于所有受支持的…</h3></div><div class="no l"><p class="bd b dl z fp nl fr fs nm fu fw dk translated">learn.hashicorp.com</p></div></div><div class="np l"><div class="nq l nr ns nt np nu ks ng"/></div></div></a></div><p id="6d86" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">确认 Terraform 正确安装了:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="a03b" class="my la it mu b gy mz na l nb nc">terraform -v</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/41a6fcb30072e53a0ff939fbe8e2ee36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_spy7DhJjbHOWUEZj0mrNg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">from: Marcos Lombog console Screenshot</figcaption></figure><p id="469f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">可回答的</p><p id="884c" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">使用 pip <a class="ae ky" href="https://crunchify.com/my-favorite-linux-commands-list-of-basic-linux-commands-and-cheat-sheet/" rel="noopener ugc nofollow" target="_blank">命令</a>安装 Ansible。PIP 是 Python 包的一个<code class="fe nw nx ny mu b">package manager</code>。<a class="ae ky" href="https://crunchify.com/have-you-noticed-missing-library-folder-in-mac-os-x-lion/" rel="noopener ugc nofollow" target="_blank"> macOS </a>默认没有安装 pip。你必须先安装它。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="5204" class="my la it mu b gy mz na l nb nc">sudo easy_install pip</span></pre><p id="421d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">使用 pip 安装 Ansible</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="5d56" class="my la it mu b gy mz na l nb nc">sudo pip install ansible</span></pre><p id="5b40" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">让我们验证是否安装了 Ansible</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="2e1a" class="my la it mu b gy mz na l nb nc">ansible --version</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/68b9379017c0bb567fc5504f34c33003.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iXknM8zB7VsUvRJrGKQ6Sw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">from: Marcos Lombog console Screenshot</figcaption></figure><p id="1326" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">对于其他操作系统，请使用下面的参考:</p><div class="nd ne gp gr nf ng"><a href="https://docs.ansible.com/ansible/latest/installation_guide/intro_installation.html" rel="noopener  ugc nofollow" target="_blank"><div class="nh ab fo"><div class="ni ab nj cl cj nk"><h2 class="bd iu gy z fp nl fr fs nm fu fw is bi translated">安装指南-翻译文档</h2><div class="nn l"><h3 class="bd b gy z fp nl fr fs nm fu fw dk translated">欢迎使用 Ansible 安装指南！默认情况下，Ansible 通过 SSH 协议管理机器。一旦 Ansible 是…</h3></div><div class="no l"><p class="bd b dl z fp nl fr fs nm fu fw dk translated">docs.ansible.com</p></div></div><div class="np l"><div class="nz l nr ns nt np nu ks ng"/></div></div></a></div><p id="44b3" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">恭喜你！安装完成！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/1d4652bed7e67213ecf973b0698448f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:128/format:webp/0*o8dw1tUjlurv2KT2.png"/></div></figure></div><div class="ab cl ob oc hx od" role="separator"><span class="oe bw bk of og oh"/><span class="oe bw bk of og oh"/><span class="oe bw bk of og"/></div><div class="im in io ip iq"><h1 id="70ac" class="kz la it bd lb lc oi le lf lg oj li lj jz ok ka ll kc ol kd ln kf om kg lp lq bi translated">使用 Terraform 调配您的基础架构</h1><p id="7e3a" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">现在，让我们使用 Terraform HCL 构建 Kafka 基础架构。</p><p id="e187" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">该设置基于使用公共 VPC 和子网的企业汇合 Kafka。</p><p id="ee91" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">所有代码都可以在<a class="ae ky" href="https://github.com/mlomboglia/kafka-cluster-infra" rel="noopener ugc nofollow" target="_blank">我的 GitHub </a>中找到</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="4812" class="my la it mu b gy mz na l nb nc">git clone <a class="ae ky" href="mailto:git@github.com" rel="noopener ugc nofollow" target="_blank">git@github.com</a>:mlomboglia/kafka-cluster-infra.git</span></pre><p id="9954" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在 terraform 文件夹中，有以下文件:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi on"><img src="../Images/39056c5b44c395f77b085aa60fa98ab1.png" data-original-src="https://miro.medium.com/v2/resize:fit:608/format:webp/1*kJQQjc8tb_jPMNxJFMTDRg.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">from: Marcos Lombog console Screenshot</figcaption></figure><p id="c47e" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu"> gateway.tf </strong> →互联网网关创建。没有必要更改这个文件</p><p id="9551" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu"> instances.tf </strong> →要创建的实例。没有必要更改这个文件</p><p id="da47" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">有五种类型的实例在括号中有一个短名称:</p><ul class=""><li id="3c6c" class="oo op it lt b lu mn lx mo ma oq me or mi os mm ot ou ov ow bi translated">Kafka Brokers (broker) →托管 Kafka broker 服务并维护主题数据</li><li id="f9d5" class="oo op it lt b lu ox lx oy ma oz me pa mi pb mm ot ou ov ow bi translated">zookeeper(zookeeper)→托管定额管理服务并管理主题元数据</li><li id="ca73" class="oo op it lt b lu ox lx oy ma oz me pa mi pb mm ot ou ov ow bi translated">Kafka Connect REST API(Connect)→Kafka Connect 是 Kafka 的一个开源组件，是连接 Kafka 与数据库、键值存储、搜索索引、文件系统等外部系统的框架。</li><li id="3784" class="oo op it lt b lu ox lx oy ma oz me pa mi pb mm ot ou ov ow bi translated">REST 代理(rest) → REST 和对附加融合平台服务的 HTTP/HTTPS 访问</li><li id="3f8f" class="oo op it lt b lu ox lx oy ma oz me pa mi pb mm ot ou ov ow bi translated">KSQL 服务器 REST API (ksql) →KSQL 是支持实时数据处理的流 SQL 引擎</li><li id="eb77" class="oo op it lt b lu ox lx oy ma oz me pa mi pb mm ot ou ov ow bi translated">Schema Registry REST API(Schema)→Schema Registry REST 服务器使用请求和响应的内容类型来指示数据的序列化格式以及正在使用的 API 的版本</li><li id="c7dd" class="oo op it lt b lu ox lx oy ma oz me pa mi pb mm ot ou ov ow bi translated">控制中心(control_center) →汇合控制中心是一个基于 web 的工具，用于管理和监控 Apache Kafka。控制中心有助于构建和监控生产数据管道和流式应用程序。</li></ul><p id="1322" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu"> public.tf </strong> →子网创建。对于本例，我使用的是公共子网</p><p id="7dc7" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu"> route.tf </strong> →路由表信息</p><p id="35f2" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu"> security_group.tf </strong> →允许必要的网络流量进入实例的安全组设置。对于这个例子，不需要修改这个文件。</p><p id="0307" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">请记住，ingress 允许 0.0.0.0/0，所以这是对公共互联网开放的。您需要将其限制在生产环境中使用。</p><p id="ddcc" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu"> vpc.tf → </strong> VPC 创作</p><p id="759f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu"> variables.tf </strong>包含我们的地形的参数。您可以对此进行修改。对于我的例子，我将在 AWS 中提供 7 个实例。</p><p id="4c69" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">" rest " = 1<br/>" connect " = 1<br/>" ksql " = 1<br/>" schema " = 1<br/>" control _ center " = 1<br/>" broker " = 1<br/>" zookeeper " = 1</p><p id="adba" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">前缀为“staging”</p><p id="776d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">实例类型“t2.small”。</p><p id="3c63" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">重要提示:Confluent 推荐一个最小实例类型“t2.large”来运行 Kafka，因此如果您修改它，它将超出 AWS 免费层，并且会花费您的钱</p><p id="f5ea" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu">密钥对。</strong></p><p id="afed" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">您将需要一个 AWS 密钥对来创建您的实例。如果您还没有，请登录您的 AWS 帐户</p><p id="a818" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><strong class="lt iu"> EC2 - &gt;创建密钥对</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pc"><img src="../Images/8d0314799625abd5d932dfbb6b1b2d31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ieDbhpPLLgc0aUq-mt4eFA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">from: Marcos Lombog AWS</figcaption></figure><p id="9064" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">给一个名字，点击<strong class="lt iu">创建。</strong></p><p id="59c6" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">下载您的密钥，复制到安全文件夹并更新权限</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="613f" class="my la it mu b gy mz na l nb nc">chmod 400 ~/.ssh/&lt;Key Name&gt;.pem</span></pre><p id="a256" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">用您的<strong class="lt iu">键名</strong>更新<strong class="lt iu"> variables.tf </strong>下面的部分</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="dd9d" class="my la it mu b gy mz na l nb nc">variable "key_name" {<br/>  description = "Key Pair"<br/>  default     = "&lt;Your Key Name&gt;"<br/>}</span></pre><p id="5107" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">现在，我们可以走了。</p><p id="8ebd" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">Terraform init 将下载您的依赖项</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="11de" class="my la it mu b gy mz na l nb nc">cd kafka-cluster-infra<br/>terraform init</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pd"><img src="../Images/07147420b7df321abdbdf27e4327e6ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EhGd8MDB8gBE-SnV_HBtkw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">from: Marcos Lombog console Screenshot</figcaption></figure><p id="9fda" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">Terraform plan 将创建您的部署计划</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="7651" class="my la it mu b gy mz na l nb nc">terraform plan</span></pre><p id="6061" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">现在，小心下一步。根据您的配置，这将花费您一些钱。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="77a1" class="my la it mu b gy mz na l nb nc">terraform apply</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pd"><img src="../Images/2a0204dcccbaa5848cddbf0123b276a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8-JFKDGuz3aeF-3UbaEU1g.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">from: Marcos Lombog console Screenshot</figcaption></figure><p id="f669" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">用“是”确认</p><p id="6797" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果出现错误:找不到 ami，请转到 EC2 控制台，启动实例并使用最新的 ami 标签进行更新:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pe"><img src="../Images/7dd4c601044e456afa1d678c0b09de3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rcqmAm-qRDPHYWGOG2jufQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">from: Marcos Lombog AWS</figcaption></figure><p id="2809" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">现在，您已经在 AWS 中提供了所有实例。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pf"><img src="../Images/aa1b4cb6431ff4d8e1f5202a9c514589.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wFByNxFPr4llgJuLGPe4JA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">from: Marcos Lombog console Screenshot</figcaption></figure><p id="02a1" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">进入 AWS，查看所有正在运行的实例，并记下每个实例的公共 DNS (IPv4)。在下一节中，您将需要用到它。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pg"><img src="../Images/433c1f193e09bb11044b532dca6eeffc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r0LfYaX1XSxbt1umyTEo6g.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">from: Marcos Lombog AWS</figcaption></figure><p id="a60d" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">现在，让我们继续使用 Ansible 安装 Kafka</p></div><div class="ab cl ob oc hx od" role="separator"><span class="oe bw bk of og oh"/><span class="oe bw bk of og oh"/><span class="oe bw bk of og"/></div><div class="im in io ip iq"><h1 id="1ae1" class="kz la it bd lb lc oi le lf lg oj li lj jz ok ka ll kc ol kd ln kf om kg lp lq bi translated">使用 Ansible 安装 Kafka</h1><p id="2d56" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">安装卡夫卡，我就用合流版。</p><p id="6e9b" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">1.创建一个<code class="fe nw nx ny mu b">hosts_example.yml</code>文件的副本。</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="7516" class="my la it mu b gy mz na l nb nc">cd ..<br/>cd cp<strong class="mu iu">-</strong>ansible<br/><br/>cp hosts_example<strong class="mu iu">.</strong>yml hosts<strong class="mu iu">.</strong>yml</span></pre><p id="c797" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">2.使用您最喜欢的 IDE 并编辑 hosts.yml 文件，按照每个实例类型的标签，从上面的 AWS Terraform 安装中输入主机，看起来与您的公共 DNS 类似。</p><p id="426e" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">非常小心地在 YML 文件上使用正确的缩进:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ph"><img src="../Images/586e438c18a217eab2f6c019ce197336.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ADo8kaSR-KDFv7dpMVte-g.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">from: Marcos Lombog console Screenshot</figcaption></figure><p id="821f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">取消 hosts.yml 文件中以下行的注释，添加您的密钥路径</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="7805" class="my la it mu b gy mz na l nb nc">ansible_ssh_private_key_file: '~/.ssh/&lt;Key Path&gt;.pem'</span></pre><p id="4cf9" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">3.确认 Ansible 可以通过 SSH 连接</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="0ce1" class="my la it mu b gy mz na l nb nc">ansible <strong class="mu iu">-</strong>i hosts<strong class="mu iu">.</strong>yml all <strong class="mu iu">-</strong>m ping</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pi"><img src="../Images/850d81662e3a562902b54847662abc42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0NI87sS1-TG8PEU2S9ckzg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">from: Marcos Lombog console Screenshot</figcaption></figure><p id="ac02" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">键入“是”信任所有服务器。</p><p id="309a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">如果连接到实例时出现问题，请尝试使用以下命令手动 SSH:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="29ce" class="my la it mu b gy mz na l nb nc">ssh -i &lt;Key Path&gt; <a class="ae ky" href="mailto:ec2-user@ec2-63-33-204-58.eu-west-1.compute.amazonaws.com" rel="noopener ugc nofollow" target="_blank">ec2-user@&lt;</a>Instance Public DNS&gt;</span></pre><p id="9aa3" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">4.运行<code class="fe nw nx ny mu b">all.yml</code>行动手册</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="2fd7" class="my la it mu b gy mz na l nb nc">ansible<strong class="mu iu">-</strong>playbook <strong class="mu iu">-</strong>i hosts<strong class="mu iu">.</strong>yml all<strong class="mu iu">.</strong>yml</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pj"><img src="../Images/6c24d5238c1354907b5a3c50c95f84f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_ryiXvd-Dhvsnln2cjVxQw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">from: Marcos Lombog console Screenshot</figcaption></figure><p id="df08" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">Ansible playbook 将在您的所有实例上执行 Kafka 安装。</p><p id="41d3" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">一段时间后，您应该会看到上面的这条消息。所有东西都装好了！</p><p id="612f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">现在，让我们测试安装:</p><ol class=""><li id="3f52" class="oo op it lt b lu mn lx mo ma oq me or mi os mm pk ou ov ow bi translated">您可以使用 SSH 连接到您的任何实例，以检查服务是否正在运行:</li></ol><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="5f45" class="my la it mu b gy mz na l nb nc">systemctl status confluent*</span></pre></div><div class="ab cl ob oc hx od" role="separator"><span class="oe bw bk of og oh"/><span class="oe bw bk of og oh"/><span class="oe bw bk of og"/></div><div class="im in io ip iq"><h1 id="2835" class="kz la it bd lb lc oi le lf lg oj li lj jz ok ka ll kc ol kd ln kf om kg lp lq bi translated">恭喜你！</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/3184d534e61f54b7e2d23ad171f7cd13.png" data-original-src="https://miro.medium.com/v2/resize:fit:128/format:webp/0*CK-d9BZRiKh7gJLT.png"/></div></figure><p id="6d4b" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">要继续，你可以用我的另一篇文章构建你的第一个 Kafka 应用程序:</p><div class="nd ne gp gr nf ng"><a rel="noopener follow" target="_blank" href="/your-first-kafka-application-9b1358ccb870"><div class="nh ab fo"><div class="ni ab nj cl cj nk"><h2 class="bd iu gy z fp nl fr fs nm fu fw is bi translated">你的第一个 Kafka 应用</h2><div class="nn l"><h3 class="bd b gy z fp nl fr fs nm fu fw dk translated">创建您的第一个生产和消费消息的 Kafka 应用程序</h3></div><div class="no l"><p class="bd b dl z fp nl fr fs nm fu fw dk translated">towardsdatascience.com</p></div></div><div class="np l"><div class="pl l nr ns nt np nu ks ng"/></div></div></a></div><h1 id="763c" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">(可选)销毁集群</h1><p id="8d50" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">不要忘记销毁您的群集并终止您的实例，运行以下命令:</p><pre class="kj kk kl km gt mt mu mv mw aw mx bi"><span id="ec01" class="my la it mu b gy mz na l nb nc">terraform destroy</span></pre><p id="6d23" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">快乐短信！</p></div></div>    
</body>
</html>