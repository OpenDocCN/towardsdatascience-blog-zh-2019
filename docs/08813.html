<html>
<head>
<title>Time-Series and Correlations with Stock Market Data using Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Python 实现时间序列和与股票市场数据的相关性</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/time-series-and-correlations-with-stock-market-data-using-python-e66774e3a16f?source=collection_archive---------16-----------------------#2019-11-25">https://towardsdatascience.com/time-series-and-correlations-with-stock-market-data-using-python-e66774e3a16f?source=collection_archive---------16-----------------------#2019-11-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="566d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我最近在金融数据服务公司 IEX 云上开了一个账户。由于我一直在学习这种新数据源(对我来说是新的)的特性，并在我的 Jupyter 笔记本上进行试验，我认为下面的内容可能对其他人也有帮助。因此，我正在创建我的第一篇媒体文章，并将它集中在金融时间序列数据上。</p><p id="ff69" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">关于定义相关性以及相关性和因果关系之间的区别，有相当多的文章和资料来源；因此，下面你会发现，将主要显示一些方法来测试相关性和结果意味着什么。如果你想使用<strong class="js iu"> IEX 云</strong>，如果你想用 Python 做相关性测试，如果你对时间序列数据感兴趣，你会发现这篇文章很有帮助！</p><p id="6916" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你正在遵循这个并且自己编码，去 https://iexcloud.io/<a class="ae ko" href="https://iexcloud.io/" rel="noopener ugc nofollow" target="_blank">给自己弄一个 API 密匙！接下来你会需要它的！此外，不要忘记安装一个 IEX Python 库:【https://addisonlynch.github.io/iexfinance/】</a><a class="ae ko" href="https://addisonlynch.github.io/iexfinance/" rel="noopener ugc nofollow" target="_blank">(林奇，2019)。使用以下方式安装此库:</a></p><p id="beea" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> $ pip3 安装 iexfinance </strong></p><pre class="kp kq kr ks gt kt ku kv kw aw kx bi"><span id="3cb7" class="ky kz it ku b gy la lb l lc ld"><strong class="ku iu">import</strong> <strong class="ku iu">config</strong><br/><strong class="ku iu">import</strong> <strong class="ku iu">os</strong></span><span id="0fb8" class="ky kz it ku b gy le lb l lc ld"><em class="lf">#os.environ['IEX_API_VERSION'] = "iexcloud-sandbox"</em><br/>os.environ['IEX_TOKEN'] = config.iex_api_key  <em class="lf"># Replace "config.iex_api_key" with your API Key from IEX Cloud!</em></span></pre><p id="d9ad" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们将加载一些我们接下来需要的库。此外，我们将使用 2017 年 1 月 1 日至 2019 年 11 月 22 日之间的数据。</p><pre class="kp kq kr ks gt kt ku kv kw aw kx bi"><span id="6408" class="ky kz it ku b gy la lb l lc ld"><strong class="ku iu">from</strong> <strong class="ku iu">datetime</strong> <strong class="ku iu">import</strong> datetime<br/><strong class="ku iu">from</strong> <strong class="ku iu">iexfinance.stocks</strong> <strong class="ku iu">import</strong> get_historical_data<br/><strong class="ku iu">import</strong> <strong class="ku iu">matplotlib.pyplot</strong> <strong class="ku iu">as</strong> <strong class="ku iu">plt</strong><br/>%matplotlib inline</span><span id="d184" class="ky kz it ku b gy le lb l lc ld">start = datetime(2017, 1, 1)<br/>end = datetime(2019, 11, 22)</span></pre><p id="5a39" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">为了简单起见，我们将<strong class="js iu">任意</strong>选择‘close’。从这个 API 数据响应中，您还可以选择开盘价、最高价、最低价和成交量。我们将尝试使用“close”</p><p id="1f24" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，让我们进行一个 API 调用并下载更多数据，“SPDR 标准普尔 500 信托 ETF”，它跟踪标准普尔 500。我们稍后会在一些相关性测试中用到它。</p><pre class="kp kq kr ks gt kt ku kv kw aw kx bi"><span id="31de" class="ky kz it ku b gy la lb l lc ld">SPY = get_historical_data("SPY", start, end, output_format='pandas')</span><span id="9b59" class="ky kz it ku b gy le lb l lc ld">plt.figure(figsize=(10, 4))<br/>plt.plot(SPY.index, SPY['close'])<br/>plt.title('Daily Times Series for the SPY');</span></pre><figure class="kp kq kr ks gt lh gh gi paragraph-image"><div class="gh gi lg"><img src="../Images/3ad6160ee907e638655da0c27caee726.png" data-original-src="https://miro.medium.com/v2/resize:fit:1226/format:webp/1*IQ4QNmQ7051BYvR_DlDr9A.png"/></div></figure><p id="dfa8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，让我们继续通过下载 FAANG 股票(脸书、亚马逊、苹果、网飞和谷歌)(Kenton，2019)的数据来探索 API，并添加我的一个兴趣，Tesla。还有，把这些都记录下来。仔细注意图表，并与上面的间谍图进行比较。其中一些看起来很像间谍图，一些则不像。</p><pre class="kp kq kr ks gt kt ku kv kw aw kx bi"><span id="adb7" class="ky kz it ku b gy la lb l lc ld">FAANGT = get_historical_data(["FB","AMZN","AAPL","NFLX","GOOG","TSLA"], start, end, output_format='pandas')<br/>print(FAANGT.head())</span><span id="9089" class="ky kz it ku b gy le lb l lc ld">FB                                      AMZN                  \<br/>              open    high     low   close    volume    open    high     low   <br/>date                                                                           <br/>2017-01-03  116.03  117.84  115.51  116.86  20663912  757.92  758.76  747.70   <br/>2017-01-04  117.55  119.66  117.29  118.69  19630932  758.39  759.68  754.20   <br/>2017-01-05  118.86  120.95  118.32  120.67  19492150  761.55  782.40  760.26   <br/>2017-01-06  120.98  123.88  120.03  123.41  28545263  782.36  799.44  778.48   <br/>2017-01-09  123.55  125.43  123.04  124.90  22880360  798.00  801.77  791.77   </span><span id="b9c2" class="ky kz it ku b gy le lb l lc ld">                             ...    GOOG                                   \<br/>             close   volume  ...    open    high     low   close   volume   <br/>date                         ...                                            <br/>2017-01-03  753.67  3521066  ...  778.81  789.63  775.80  786.14  1657268   <br/>2017-01-04  757.18  2510526  ...  788.36  791.34  783.16  786.90  1072958   <br/>2017-01-05  780.45  5830068  ...  786.08  794.48  785.02  794.02  1335167   <br/>2017-01-06  795.99  5986234  ...  795.26  807.90  792.20  806.15  1640170   <br/>2017-01-09  796.92  3446109  ...  806.40  809.97  802.83  806.65  1274645   </span><span id="96d0" class="ky kz it ku b gy le lb l lc ld">              TSLA                                    <br/>              open    high     low   close    volume  <br/>date                                                  <br/>2017-01-03  214.86  220.33  210.96  216.99   5923254  <br/>2017-01-04  214.75  228.00  214.31  226.99  11213471  <br/>2017-01-05  226.42  227.48  221.95  226.75   5911695  <br/>2017-01-06  226.93  230.31  225.45  229.01   5527893  <br/>2017-01-09  228.97  231.92  228.00  231.28   3979484  </span><span id="e27f" class="ky kz it ku b gy le lb l lc ld">[5 rows x 30 columns]</span><span id="28a7" class="ky kz it ku b gy le lb l lc ld">plt.figure(figsize=(15, 4))<br/>#FB<br/>plt.subplot(1, 2, 1)<br/>plt.plot(FAANGT.index, FAANGT['FB']['close'])<br/>plt.title('Daily Times Series for the FB')</span><span id="4941" class="ky kz it ku b gy le lb l lc ld">#AMZN<br/>plt.subplot(1, 2, 2)<br/>plt.plot(FAANGT.index, FAANGT['AMZN']['close'])<br/>plt.title('Daily Times Series for the AMZN');<br/></span><span id="899a" class="ky kz it ku b gy le lb l lc ld">plt.figure(figsize=(15, 4))<br/>#AAPL<br/>plt.subplot(1, 2, 1)<br/>plt.plot(FAANGT.index, FAANGT['AAPL']['close'])<br/>plt.title('Daily Times Series for the AAPL');</span><span id="12ac" class="ky kz it ku b gy le lb l lc ld">#GOOG<br/>plt.subplot(1, 2, 2)<br/>plt.plot(FAANGT.index, FAANGT['GOOG']['close'])<br/>plt.title('Daily Times Series for the GOOG');</span><span id="6089" class="ky kz it ku b gy le lb l lc ld">plt.figure(figsize=(15, 4))<br/>#TSLA<br/>plt.subplot(1, 2, 1)<br/>plt.plot(FAANGT.index, FAANGT['TSLA']['close'])<br/>plt.title('Daily Times Series for the TSLA');</span></pre><figure class="kp kq kr ks gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi lk"><img src="../Images/ecf61b41ba1bd0f2bd300558d17ac094.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aq-vn9aen11wveiVmuZheQ.png"/></div></div></figure><figure class="kp kq kr ks gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi lk"><img src="../Images/0056403b49a66bd6c9fc9e82462cd568.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cH_D_apI9Als4p0zFAJMtA.png"/></div></div></figure><figure class="kp kq kr ks gt lh gh gi paragraph-image"><div class="gh gi lp"><img src="../Images/e4e995b835c66950b2a995358d11e2cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:874/format:webp/1*6r6NYbc9uHqW1irtlm5lyg.png"/></div></figure><p id="0b17" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在我们有了 FAANG 股票(和 TSLA)和标准普尔 500 的数据，我们把它们画出来，这样我们就知道它们看起来像什么了；我们来做个实验吧！我们将尝试皮尔逊相关性测试，测试所有这些股票和标准普尔 500 的相关性。你怎么想呢?基于对图表的观察和直觉，它们会有关联吗？</p><p id="5e51" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当皮尔逊相关系数在-1 和+1 之间时，将显示相关性。如果接近+1，我们会看到正相关。如果皮尔逊相关性更接近-1，则为负相关(Cheong，2019)。</p><pre class="kp kq kr ks gt kt ku kv kw aw kx bi"><span id="06ff" class="ky kz it ku b gy la lb l lc ld"><strong class="ku iu">import</strong> <strong class="ku iu">pandas</strong> <strong class="ku iu">as</strong> <strong class="ku iu">pd<br/>import scipy.stats as stats</strong></span><span id="f577" class="ky kz it ku b gy le lb l lc ld"><em class="lf"># Slice this up to make it easier to work with.</em><br/>indx = pd.IndexSlice<br/>df1 = FAANGT.loc[:, (indx[:],'close')]<br/><br/>c, p = stats.pearsonr(df1['FB'].dropna()['close'], SPY.dropna()['close'])<br/>print(f"FB vs SPY Pearson Correlation: <strong class="ku iu">{c}\n</strong>")<br/><br/>c, p = stats.pearsonr(df1['AMZN'].dropna()['close'], SPY.dropna()['close'])<br/>print(f"AMZN vs SPY Pearson Correlation: <strong class="ku iu">{c}\n</strong>")<br/><br/>c, p = stats.pearsonr(df1['AAPL'].dropna()['close'], SPY.dropna()['close'])<br/>print(f"AAPL vs SPY Pearson Correlation: <strong class="ku iu">{c}\n</strong>")<br/><br/>c, p = stats.pearsonr(df1['GOOG'].dropna()['close'], SPY.dropna()['close'])<br/>print(f"GOOG vs SPY Pearson Correlation: <strong class="ku iu">{c}\n</strong>")<br/><br/>c, p = stats.pearsonr(df1['TSLA'].dropna()['close'], SPY.dropna()['close'])<br/>print(f"TSLA vs SPY Pearson Correlation: <strong class="ku iu">{c}</strong>")</span><span id="1f4c" class="ky kz it ku b gy le lb l lc ld">FB vs SPY Pearson Correlation: 0.7325442525842248<br/><br/>AMZN vs SPY Pearson Correlation: 0.910899729798812<br/><br/>AAPL vs SPY Pearson Correlation: 0.9176098570966427<br/><br/>GOOG vs SPY Pearson Correlation: 0.9485878709468345<br/><br/>TSLA vs SPY Pearson Correlation: -0.26968006350226387</span></pre><p id="9612" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">截至 2019 年 11 月 22 日，在所有这些选项中，谷歌(Google)的皮尔逊相关系数最高。此外，特斯拉(TSLA)与标准普尔 500 负相关。你可以在上面的图表中找到许多，并将这些图表与标准普尔 500 图表进行比较；但是现在你有了一个定量的关联方法！</p><p id="1aef" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在，为了更深入地探索 API，让我们看看<strong class="js iu">社交情感</strong>特性是什么样子的。我们来看看昨天(2019 年 11 月 22 日)，对于特斯拉来说。</p><pre class="kp kq kr ks gt kt ku kv kw aw kx bi"><span id="06f2" class="ky kz it ku b gy la lb l lc ld"><strong class="ku iu">from</strong> <strong class="ku iu">iexfinance.altdata</strong> <strong class="ku iu">import</strong>  get_social_sentiment, get_ceo_compensation<br/><br/>period='minute'<br/>specDay="20191122"<br/><br/>TSLA_Sent = get_social_sentiment("TSLA", period, specDay, output_format='pandas')<br/>print(TSLA_Sent.head())</span><span id="413a" class="ky kz it ku b gy le lb l lc ld">minute  negative  positive  sentiment  totalScores<br/>0   0000      0.12      0.88   0.084958           26<br/>1   0001      0.12      0.88   0.160624           17<br/>2   0002      0.11      0.89   0.061056           18<br/>3   0003      0.29      0.71  -0.180071           17<br/>4   0004      0.07      0.93   0.066293           15</span></pre><p id="f1f5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">昨天，特斯拉最积极和最消极的社会情绪的最高分是多少？</p><pre class="kp kq kr ks gt kt ku kv kw aw kx bi"><span id="77e4" class="ky kz it ku b gy la lb l lc ld">TSLA_Sent_Pos = TSLA_Sent['sentiment'].max()<br/>TSLA_Sent_Neg = TSLA_Sent['sentiment'].min()</span><span id="6d8f" class="ky kz it ku b gy le lb l lc ld">print("Highest Social Sentiment on 11/22/2019:", TSLA_Sent_Pos)<br/>print("Lowest Social Sentiment on 11/22/2019:", TSLA_Sent_Neg)</span><span id="add6" class="ky kz it ku b gy le lb l lc ld">Highest Social Sentiment on 11/22/2019: 0.9785<br/>Lowest Social Sentiment on 11/22/2019: -0.9487</span></pre><p id="7c01" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这个 API 还有 CEO 信息！让我们来看看我们之前研究的 FAANG 和 TSLA 股票的 CEO 信息。我们将使用 df1，它是在执行相关性测试时为了简化而创建的。</p><pre class="kp kq kr ks gt kt ku kv kw aw kx bi"><span id="75af" class="ky kz it ku b gy la lb l lc ld"><strong class="ku iu">import</strong> <strong class="ku iu">pprint</strong><br/><br/><strong class="ku iu">for</strong> n, q <strong class="ku iu">in</strong> df1:<br/>    pprint.pprint(get_ceo_compensation(n))</span><span id="0ad1" class="ky kz it ku b gy le lb l lc ld">{'bonus': 0,<br/> 'companyName': 'Facebook Inc. Class A',<br/> 'location': 'Menlo Park, CA',<br/> 'name': 'Mark Zuckerberg',<br/> 'nonEquityIncentives': 0,<br/> 'optionAwards': 0,<br/> 'otherComp': 22554542,<br/> 'pensionAndDeferred': 0,<br/> 'salary': 1,<br/> 'stockAwards': 0,<br/> 'symbol': 'FB',<br/> 'total': 22554543,<br/> 'year': '2018'}<br/>{'bonus': 0,<br/> 'companyName': 'Amazon.com Inc.',<br/> 'location': 'Seattle, WA',<br/> 'name': 'Jeffrey Bezos',<br/> 'nonEquityIncentives': 0,<br/> 'optionAwards': 0,<br/> 'otherComp': 1600000,<br/> 'pensionAndDeferred': 0,<br/> 'salary': 81840,<br/> 'stockAwards': 0,<br/> 'symbol': 'AMZN',<br/> 'total': 1681840,<br/> 'year': '2018'}<br/>{'bonus': 0,<br/> 'companyName': 'Apple Inc.',<br/> 'location': 'Cupertino, CA',<br/> 'name': 'Timothy Cook',<br/> 'nonEquityIncentives': 12000000,<br/> 'optionAwards': 0,<br/> 'otherComp': 682219,<br/> 'pensionAndDeferred': 0,<br/> 'salary': 3000000,<br/> 'stockAwards': 0,<br/> 'symbol': 'AAPL',<br/> 'total': 15682219,<br/> 'year': '2018'}<br/>{'bonus': 0,<br/> 'companyName': 'Netflix Inc.',<br/> 'location': 'Los Gatos, CA',<br/> 'name': 'Reed Hastings',<br/> 'nonEquityIncentives': 0,<br/> 'optionAwards': 35380417,<br/> 'otherComp': 0,<br/> 'pensionAndDeferred': 0,<br/> 'salary': 700000,<br/> 'stockAwards': 0,<br/> 'symbol': 'NFLX',<br/> 'total': 36080417,<br/> 'year': '2018'}<br/>{'bonus': 0,<br/> 'companyName': 'Alphabet Inc. Class A',<br/> 'location': 'Mountain View, CA',<br/> 'name': 'Larry Page',<br/> 'nonEquityIncentives': 0,<br/> 'optionAwards': 0,<br/> 'otherComp': 0,<br/> 'pensionAndDeferred': 0,<br/> 'salary': 1,<br/> 'stockAwards': 0,<br/> 'symbol': 'GOOG',<br/> 'total': 1,<br/> 'year': '2018'}<br/>{'bonus': 0,<br/> 'companyName': 'Tesla Inc',<br/> 'location': 'Palo Alto, CA',<br/> 'name': 'Elon Musk',<br/> 'nonEquityIncentives': 0,<br/> 'optionAwards': 2283988504,<br/> 'otherComp': 0,<br/> 'pensionAndDeferred': 0,<br/> 'salary': 56380,<br/> 'stockAwards': 0,<br/> 'symbol': 'TSLA',<br/> 'total': 2284044884,<br/> 'year': '2018'}</span></pre><p id="b26b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">还有很多东西需要探索和分析。在下一篇文章中，我计划探索 IEX 云的一些“实时”数据，例如书籍。此外，我可能会继续时间序列分析，并转移到一些基本的预测。我希望您发现这个探索有用！</p><h1 id="132c" class="lq kz it bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">参考</h1><ul class=""><li id="025a" class="mn mo it js b jt mp jx mq kb mr kf ms kj mt kn mu mv mw mx bi translated">西肯顿(2019 年 11 月 18 日)。FAANG 股票是什么？检索于 2019 年 11 月 28 日，发自 https://www.investopedia.com/terms/f/faang-stocks.asp<a class="ae ko" href="https://www.investopedia.com/terms/f/faang-stocks.asp" rel="noopener ugc nofollow" target="_blank"/>。</li><li id="fd8d" class="mn mo it js b jt my jx mz kb na kf nb kj nc kn mu mv mw mx bi translated">林奇，A. (2019 年 10 月 24 日)。addisonlynch/iexfinance。检索于 2019 年 11 月 28 日，发自 https://github.com/addisonlynch/iexfinance<a class="ae ko" href="https://github.com/addisonlynch/iexfinance" rel="noopener ugc nofollow" target="_blank"/>。</li><li id="6102" class="mn mo it js b jt my jx mz kb na kf nb kj nc kn mu mv mw mx bi translated">Cheong，J. H. (2019 年 5 月 13 日)。量化时间序列数据同步性的四种方法。检索于 2019 年 11 月 28 日，来自<a class="ae ko" rel="noopener" target="_blank" href="/four-ways-to-quantify-synchrony-between-time-series-data-b99136c4a9c9">https://towardsdatascience . com/four-way-to-quantify-synchrony-between-time-series-data-b 99136 C4 a9 c 9</a>。</li></ul></div></div>    
</body>
</html>