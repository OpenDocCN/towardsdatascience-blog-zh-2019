<html>
<head>
<title>Word Embedding Using BERT In Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python 中使用 BERT 的单词嵌入</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/word-embedding-using-bert-in-python-dd5a86c00342?source=collection_archive---------3-----------------------#2019-12-16">https://towardsdatascience.com/word-embedding-using-bert-in-python-dd5a86c00342?source=collection_archive---------3-----------------------#2019-12-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="f887" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用深度学习 NLP 模型(BERT)将单词嵌入向量，只需几行 Python 代码</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/4398fb46521d0a1974df8296e47bbab6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aqyD9wau4lFI14Vmtr2RTQ.jpeg"/></div></div></figure><h1 id="93a0" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">单词嵌入:它们是什么？</h1><p id="d852" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">在 NLP 的世界中，以向量形式或单词嵌入来表示单词或句子打开了各种潜在应用的大门。这种将单词编码成向量的功能是 NLP 任务的强大工具，例如计算单词之间的语义相似度，利用它可以构建语义搜索引擎。例如，这里有一个单词嵌入的应用程序，通过它<a class="ae mi" href="https://www.blog.google/products/search/search-language-understanding-bert/" rel="noopener ugc nofollow" target="_blank"> Google 可以更好地理解使用 BERT 的搜索查询。可以说，它是最强大的语言模型之一，在机器学习社区中变得非常流行。</a></p><p id="46a5" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">使用大的句子语料库对 BERT(来自变压器的双向编码器表示)模型进行预训练。简而言之，训练是通过屏蔽句子中的几个单词(根据论文作者的说法，大约 15%的单词)并让模型预测被屏蔽的单词来完成的。随着模型训练预测，它学习产生单词的强大内部表示，如单词嵌入。今天，我们将看到如何轻松地建立和运行 BERT 模型，并将单词编码到单词嵌入中。</p><h1 id="e796" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">BERT 单词嵌入模型设置</h1><p id="658e" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">使用 Pytorch 和 Tensorflow 运行 BERT 模型有一套可用的选项。但是，为了让您非常容易地接触到 BERT 模型，我们将使用 Python 库来帮助我们快速设置它！</p></div><div class="ab cl mo mp hx mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="im in io ip iq"><p id="1f66" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">B <em class="mv"> ert-as-a-service </em>是一个 Python 库，它使我们能够在本地机器上部署预先训练好的 BERT 模型并运行推理。它可以用于服务于任何已发布的模型类型，甚至是针对特定下游任务进行微调的模型。此外，它需要后端的 Tensorflow 来处理预训练的模型。因此，我们将继续在控制台中安装 Tensorflow 1.15。</p><pre class="kj kk kl km gt mw mx my mz aw na bi"><span id="7938" class="nb kv it mx b gy nc nd l ne nf">pip3 install tensorflow-gpu==1.15</span></pre><p id="31c7" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">接下来，我们将安装 bert 即服务客户端和服务器。同样，这个库不支持 Python 2。因此，请确保您拥有 Python 3.5 或更高版本。</p><pre class="kj kk kl km gt mw mx my mz aw na bi"><span id="8beb" class="nb kv it mx b gy nc nd l ne nf">pip3 install -U bert-serving-server bert-serving-client</span></pre><p id="4970" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">BERT 服务器将模型部署在本地机器上，客户端可以订阅它。此外，用户可以在同一台机器上安装这两个服务器，或者在一台机器上部署服务器，然后从另一台机器上进行订阅。安装完成后，下载您选择的 BERT 模型。你可以在这里找到<a class="ae mi" href="https://github.com/google-research/bert#pre-trained-models" rel="noopener ugc nofollow" target="_blank">所有车型的列表</a>。</p><h1 id="16b2" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">部署模型</h1><p id="d964" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">现在初始设置已经完成，让我们用下面的命令启动模型服务。</p><pre class="kj kk kl km gt mw mx my mz aw na bi"><span id="aa8c" class="nb kv it mx b gy nc nd l ne nf">bert-serving-start -model_dir /path_to_the_model/ -num_worker=1</span></pre><p id="65cf" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">例如，如果模型的名称是 uncased_L-24_H-1024_A-16，并且它位于“/model”目录中，则该命令如下所示</p><pre class="kj kk kl km gt mw mx my mz aw na bi"><span id="74ad" class="nb kv it mx b gy nc nd l ne nf">bert-serving-start -model_dir /model/uncased_L-24_H-1024_A-16/ -num_worker=1</span></pre><p id="71f6" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">“num_workers”参数用于初始化服务器可以处理的并发请求的数量。然而，只需使用 num_workers=1，因为我们只是在用单个客户端来处理我们的模型。如果您正在部署多个客户端进行订阅，请相应地选择“num_workers”参数。</p><h1 id="75f3" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">通过 BERT 客户端订阅</h1><p id="ae99" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">我们可以运行一个 Python 脚本，从中使用 BERT 服务将我们的单词编码成单词嵌入。鉴于此，我们只需导入 BERT-client 库并创建一个 client 类的实例。一旦我们这样做了，我们就可以输入我们想要编码的单词或句子的列表。</p><pre class="kj kk kl km gt mw mx my mz aw na bi"><span id="5457" class="nb kv it mx b gy nc nd l ne nf">from bert_serving.client import BertClient()</span><span id="53e6" class="nb kv it mx b gy ng nd l ne nf">client = BertClient()</span><span id="f089" class="nb kv it mx b gy ng nd l ne nf">vectors = client.encode([“dog”],[“cat”],[“man”])</span></pre><p id="863f" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">我们应该将想要编码的单词输入 Python 列表。上面，我输入了三个列表，每个列表都有一个单词。因此,“vectors”对象的形状为(3，embedding_size)。通常，嵌入大小是 BERT 模型编码的单词向量的长度。事实上，它将任意长度的单词编码成一个恒定长度的向量。但是这可能在不同的 BERT 模型之间有所不同。</p><h1 id="a9b1" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">计算单词之间的相似度</h1><p id="63dd" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">好的，目前为止一切顺利！如何处理只有一些数字的向量？它们不仅仅是数字。我前面说过，这些向量代表了单词在 1024 维超空间中的编码位置(这个模型的 1024 uncased _ L-24 _ H-1024 _ A-16)。此外，用某种相似度函数来比较不同单词的向量，将有助于确定它们的相关程度。</p><p id="379c" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">余弦相似性就是这样一个函数，它给出 0.0 到 1.0 之间的相似性得分。假设 1.0 表示单词意思相同(100%匹配)，0 表示它们完全不同。下面是单词嵌入之间余弦相似性的 scikit-learn 实现。</p><pre class="kj kk kl km gt mw mx my mz aw na bi"><span id="a810" class="nb kv it mx b gy nc nd l ne nf"><strong class="mx iu">from</strong> sklearn.metrics.pairwise <strong class="mx iu">import</strong> cosine_similarity</span><span id="d0fc" class="nb kv it mx b gy ng nd l ne nf">cos_lib = cosine_similarity(vectors[1,:],vectors[2,:]) #similarity between #cat and dog</span></pre><h1 id="a0e9" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">伯特完成单词嵌入！</h1><p id="ffdc" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">你也可以输入一个完整的句子而不是单个单词，服务器会处理好的。有多种方式可以将单词嵌入组合起来，以形成像连接这样的句子嵌入。</p><p id="b727" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated">查看其他关于<a class="ae mi" href="https://hackerstreak.com/yolo-made-simple-interpreting-the-you-only-look-once-paper/" rel="noopener ugc nofollow" target="_blank">物体检测</a>、<a class="ae mi" href="https://hackerstreak.com/siamese-neural-network-for-signature-verification/" rel="noopener ugc nofollow" target="_blank">真伪验证</a>和<a class="ae mi" href="https://hackerstreak.com/posts/" rel="noopener ugc nofollow" target="_blank">更多</a>的文章！</p><p id="a9db" class="pw-post-body-paragraph lm ln it lo b lp mj ju lr ls mk jx lu lv ml lx ly lz mm mb mc md mn mf mg mh im bi translated"><em class="mv">原载于</em><a class="ae mi" href="https://hackerstreak.com/" rel="noopener ugc nofollow" target="_blank"><em class="mv">https://hackerstreak.com</em></a></p></div></div>    
</body>
</html>