<html>
<head>
<title>Version Control ML Model</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">版本控制 ML 模型</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/version-control-ml-model-4adb2db5f87c?source=collection_archive---------1-----------------------#2019-08-11">https://towardsdatascience.com/version-control-ml-model-4adb2db5f87c?source=collection_archive---------1-----------------------#2019-08-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/725a41dd59bfeb7df875bc2399a31f56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VIES1isu2zvmlZhJgIefYA.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">dvc workflow from <a class="ae kf" href="https://dvc.org/" rel="noopener ugc nofollow" target="_blank">https://dvc.org</a></figcaption></figure><p id="f3cc" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">机器学习操作(姑且称之为<strong class="ki iu"> <em class="le"> mlOps </em> </strong>在当前的流行语格局 xxOps 下)与传统的软件开发操作(<strong class="ki iu"> <em class="le"> devOps </em> </strong>)有很大的不同。原因之一是 ML 实验除了代码(小的纯文本文件)之外，还需要大的数据集和模型工件。</p><p id="3781" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这篇帖子提出了一个用 git 和 dvc ( <a class="ae kf" href="https://dvc.org/doc/tutorial" rel="noopener ugc nofollow" target="_blank">数据版本控制</a>)对机器学习模型进行版本控制的解决方案。</p><p id="fc0a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">此解决方案将提供以下功能:</p><ol class=""><li id="b366" class="lf lg it ki b kj kk kn ko kr lh kv li kz lj ld lk ll lm ln bi translated">ML 模型具有可伸缩性、安全性、可用性和几乎无限的存储空间</li><li id="1635" class="lf lg it ki b kj lo kn lp kr lq kv lr kz ls ld lk ll lm ln bi translated">ML 模型受版本控制，即它的任何特定版本都可以被方便地标记和访问</li><li id="72e3" class="lf lg it ki b kj lo kn lp kr lq kv lr kz ls ld lk ll lm ln bi translated">ML 模型的可审计性、透明性和可再现性可以通过版本控制数据集和分析代码来保证</li><li id="e5f9" class="lf lg it ki b kj lo kn lp kr lq kv lr kz ls ld lk ll lm ln bi translated">基于现有的模型设置，新的实验可以被快速和协作地初始化</li></ol><h1 id="31d6" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">吉特和 DVC</h1><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/3ca783c8696b9fe5f3c4f6273f4e2095.png" data-original-src="https://miro.medium.com/v2/resize:fit:908/format:webp/1*SbjfXMneLmwjjG4cTQPxBw.png"/></div></figure><p id="0037" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">该解决方案包括两层版本控制:</p><ol class=""><li id="3288" class="lf lg it ki b kj kk kn ko kr lh kv li kz lj ld lk ll lm ln bi translated"><strong class="ki iu"> <em class="le"> git </em> </strong>:处理代码和元数据(数据集和模型工件的)</li><li id="bef0" class="lf lg it ki b kj lo kn lp kr lq kv lr kz ls ld lk ll lm ln bi translated"><strong class="ki iu"> <em class="le"> dvc </em> </strong>:处理大型数据集和模型工件</li></ol><p id="90b0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">首先，我们准备好项目文件夹并安装好工具。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="0f74" class="nb lu it mx b gy nc nd l ne nf"># Download code<br/>git clone <a class="ae kf" href="https://github.com/iterative/example-versioning.git" rel="noopener ugc nofollow" target="_blank">https://github.com/iterative/example-versioning.git</a><br/>cd example-versioning</span><span id="b5a2" class="nb lu it mx b gy ng nd l ne nf"># install and initialize git<br/># install and initialize dvc (<a class="ae kf" href="https://dvc.org/doc/get-started/install" rel="noopener ugc nofollow" target="_blank">https://dvc.org/doc/get-started/install</a>)</span></pre><p id="735e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后将 dvc 连接到后端存储，数据集和模型工件将实际存储在这里(在本例中为<strong class="ki iu"> <em class="le"> AWS S3 </em> </strong>)。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="8242" class="nb lu it mx b gy nc nd l ne nf">dvc remote add -d s3remote s3://<a class="ae kf" href="https://console.aws.amazon.com/s3/#" rel="noopener ugc nofollow" target="_blank">my-test-bucket-dvc</a>/myproject<!-- --> </span></pre><p id="9dfc" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，在我们将进行 ML 实验的示例版本化文件夹中，应该包含两个元数据子文件夹。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="9377" class="nb lu it mx b gy nc nd l ne nf">.dvc/<br/>.git/</span></pre><h1 id="06f0" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">工作流程</h1><p id="abad" class="pw-post-body-paragraph kg kh it ki b kj nh kl km kn ni kp kq kr nj kt ku kv nk kx ky kz nl lb lc ld im bi translated">下一步，我们使用来自 dvc.org 的数据和脚本训练一个模型</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="bb30" class="nb lu it mx b gy nc nd l ne nf">cd example-versioning</span><span id="9173" class="nb lu it mx b gy ng nd l ne nf"># Install dependencies<br/>pip install -r requirements.txt</span><span id="aa1f" class="nb lu it mx b gy ng nd l ne nf"># Download data<br/>cd example-versioning<br/>wget <a class="ae kf" href="https://dvc.org/s3/examples/versioning/data.zip" rel="noopener ugc nofollow" target="_blank">https://dvc.org/s3/examples/versioning/data.zip</a><br/>unzip data.zip<br/>rm -f data.zip</span><span id="9b32" class="nb lu it mx b gy ng nd l ne nf"># Build the ML model<br/>python train.py</span></pre><p id="efee" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">获得模型(model.h5)后，使用 dvc + git 工作流将其置于版本控制之下。</p><p id="47e3" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">步骤 1:向 dvc 添加模型元数据</strong></p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="f828" class="nb lu it mx b gy nc nd l ne nf">dvc add model.h5</span></pre><p id="4f9a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">输出:</p><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nm"><img src="../Images/2981101397f3d58df832ebf240d96419.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g1d0SBZsmCHDLokcGZuhIw.png"/></div></div></figure><p id="7439" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">可以观察到:</p><ul class=""><li id="6466" class="lf lg it ki b kj kk kn ko kr lh kv li kz lj ld nn ll lm ln bi translated">“真实”模型存储在。dvc/cache/40</li><li id="71bd" class="lf lg it ki b kj lo kn lp kr lq kv lr kz ls ld nn ll lm ln bi translated">模型元数据 model.h5.dvc 记录它在哪里</li></ul><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi no"><img src="../Images/502c918af64a17fc423c28e32246c8c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NeXMFLHzDxYBLYQBQC3fuA.png"/></div></div></figure><p id="89da" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">步骤 2:通过将模型推送到后端存储来持久化模型</strong></p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="5275" class="nb lu it mx b gy nc nd l ne nf">dvc push model.h5.dvc</span></pre><p id="0780" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在 s3 中，我们可以在模型元数据的指导下检查模型是否被正确存储</p><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi np"><img src="../Images/7b61beb1f8a8ddc5b69fd74981984252.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UwQhKk0Z2_Kst0Y4_SxItA.png"/></div></div></figure><p id="7622" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">步骤 3:用 git 持久化模型元数据</strong></p><p id="4609" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">模型元数据可以引导我们找到存储在后端存储中的真正的模型对象。为了防止丢失元数据，应该使用 git 将它添加到版本控制中。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="4704" class="nb lu it mx b gy nc nd l ne nf">git add .gitignore model.h5.dvc data.dvc metrics.json<br/>git commit -m "model first version, 1000 images"<br/>git tag -a "v1.0" -m "model v1.0, 1000 images"</span></pre><p id="17a1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这里可以使用“git 标签”来记录模型的版本。</p><p id="6aa7" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">第四步:随时访问模型</strong></p><p id="27eb" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">通过搜索 git branch 上的标签，很容易获取模型的特定版本。从 git 中，我们可以检查模型元数据。</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="9c95" class="nb lu it mx b gy nc nd l ne nf">git checkout tags/&lt;tag_name&gt; -b &lt;branch_name&gt;</span></pre><p id="bd01" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">根据元数据，我们可以找到模型对象，并使用命令将其下载到当前工作区</p><pre class="ms mt mu mv gt mw mx my mz aw na bi"><span id="9aab" class="nb lu it mx b gy nc nd l ne nf">dvc pull model.h5.dvc</span></pre><figure class="ms mt mu mv gt ju gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/d18765a1e837d8c5a2d00b7f5df53078.png" data-original-src="https://miro.medium.com/v2/resize:fit:1286/format:webp/1*xcKTNUphlxoKWlbGMoZZPA.png"/></div></figure><h1 id="96d6" class="lt lu it bd lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq bi translated">结论</h1><p id="0ae4" class="pw-post-body-paragraph kg kh it ki b kj nh kl km kn ni kp kq kr nj kt ku kv nk kx ky kz nl lb lc ld im bi translated">同理，也可以解决机器学习实验的大数据集版本控制问题。解决 ML 管道挑战的其他类似工具例如有<a class="ae kf" href="https://mlflow.org/" rel="noopener ugc nofollow" target="_blank"><strong class="ki iu"><em class="le">ML flow</em></strong></a><a class="ae kf" href="https://www.datanami.com/" rel="noopener ugc nofollow" target="_blank"><strong class="ki iu"><em class="le">datanami</em></strong></a>和<a class="ae kf" href="https://github.com/IDSIA/sacred" rel="noopener ugc nofollow" target="_blank"> <strong class="ki iu"> <em class="le">神圣</em> </strong> </a>。</p></div></div>    
</body>
</html>