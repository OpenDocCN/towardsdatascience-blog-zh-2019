<html>
<head>
<title>Overview of CycleGAN architecture and training.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">CycleGAN 架构和培训概述。</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/overview-of-cyclegan-architecture-and-training-afee31612a2f?source=collection_archive---------12-----------------------#2019-12-02">https://towardsdatascience.com/overview-of-cyclegan-architecture-and-training-afee31612a2f?source=collection_archive---------12-----------------------#2019-12-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/b4cf38e4c30c8dc9a5be8106592ea3c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fKBQTjo5qbKzb62U-x1WSA.jpeg"/></div></div></figure><h1 id="4fb1" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">0.介绍</h1><p id="5779" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">生成对抗模型由两个神经网络组成:一个生成器和一个鉴别器。一个<a class="ae lu" href="https://arxiv.org/abs/1703.10593" rel="noopener ugc nofollow" target="_blank"> CycleGAN </a>由 2 个 GAN 组成，总共有 2 个发生器和 2 个鉴别器。</p><p id="59b1" class="pw-post-body-paragraph kw kx iq ky b kz lv lb lc ld lw lf lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">给定两组不同的图像，例如马和斑马，一个生成器将马转换成斑马，另一个生成器将斑马转换成马。在训练阶段，鉴别器在这里检查生成器计算出的图像是真是假。通过这个过程，生成器可以随着各自鉴别器的反馈而变得更好。在 CycleGAN 的情况下，一个发电机从另一个发电机获得额外的反馈。这种反馈确保由生成器生成图像是循环一致的，这意味着在图像上连续应用两个生成器应该产生相似的图像。</p><figure class="mb mc md me gt jr gh gi paragraph-image"><div class="gh gi ma"><img src="../Images/f632061a49fda2d307496b930261c647.png" data-original-src="https://miro.medium.com/v2/resize:fit:1218/format:webp/1*KyVhzMgZtEr03ceHhRwAtQ.png"/></div></figure><p id="00ec" class="pw-post-body-paragraph kw kx iq ky b kz lv lb lc ld lw lf lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">训练一个 CycleGAN 非常方便的一点是，我们不需要标记它的训练样本(数据是不成对的)。</p><h1 id="c283" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">1.数据</h1><p id="d9fb" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">CycleGAN 的一个训练样本由马的随机图片和斑马的随机图片构成。</p><figure class="mb mc md me gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mf"><img src="../Images/b27d081df740795ad63a27a3bf2081d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ul1-VNAVsWHLzJUt-VyOCA.png"/></div></div></figure><h1 id="07e9" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">2.模型</h1><p id="1e34" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">两个生成器都具有以下架构(除了规范层和激活层) :</p><figure class="mb mc md me gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mg"><img src="../Images/c61f6336877450566271f1d0a80da6ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IPAXkl4Cz2RsDwHPHck7Xw.png"/></div></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk">Residual Block on the left, all convolutional layer inside it have 256 filters, stride 2 and padding 1.</figcaption></figure><p id="c478" class="pw-post-body-paragraph kw kx iq ky b kz lv lb lc ld lw lf lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">生成器将大小为 256x256 的图像作为输入，对其进行下采样，然后将其上采样回 256x256，从而创建生成的图像。</p><p id="a957" class="pw-post-body-paragraph kw kx iq ky b kz lv lb lc ld lw lf lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">至于鉴别器，它们具有以下架构(规范和激活层除外):</p><figure class="mb mc md me gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ml"><img src="../Images/deac53b269700823f677f7e58bcbb64c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FUpwJ-355GlGY85MlmVmxA.png"/></div></div></figure><p id="0bd1" class="pw-post-body-paragraph kw kx iq ky b kz lv lb lc ld lw lf lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">鉴别器将大小为 256x256 的图像作为输入，并输出大小为 30x30 的张量。</p><p id="2de8" class="pw-post-body-paragraph kw kx iq ky b kz lv lb lc ld lw lf lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">输出张量的每个神经元(值)保存输入图像的 70×70 区域的分类结果。通常，GANs 的鉴别器输出一个值来指示输入图像的分类结果。通过返回大小为 30x30 的张量，鉴别器检查输入图像的每个 70x70 区域(这些区域相互重叠)是真实的还是虚假的。这样做相当于手动选择这些 70x70 区域中的每一个，并让鉴别器反复检查它们。最后整幅图像的分类结果是 30×30 个值的分类结果的平均值。</p><h1 id="cdf7" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">3.培养</h1><p id="65de" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">生成器和鉴别器都使用 Adam 解算器(默认参数)进行优化，它们都具有相同的学习速率(2e-4)，并且批处理大小被选择为 1(这意味着这里不能使用批处理规范化，而是使用实例规范化)。</p><figure class="mb mc md me gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mm"><img src="../Images/6edb36dfc73af9bd6dca5938b2b6bddd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eTXyQiw2AtiQSECmSfv93g.png"/></div></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk">generated images are from a CycleGAN trained during 30 epochs.</figcaption></figure><p id="8474" class="pw-post-body-paragraph kw kx iq ky b kz lv lb lc ld lw lf lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">G <em class="mn"> {H- &gt; Z </em> }是将马图像转换成斑马图像的生成器，G <em class="mn"> {Z- &gt; H </em> }是将斑马图像转换成马图像的生成器。</p><p id="316f" class="pw-post-body-paragraph kw kx iq ky b kz lv lb lc ld lw lf lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">给定一个训练样本(<em class="mn"> h，z </em>)，这就是该样本如何更新 CycleGAN 的权重。</p><ul class=""><li id="ee40" class="mo mp iq ky b kz lv ld lw lh mq ll mr lp ms lt mt mu mv mw bi translated">从<em class="mn"> h，</em> G <em class="mn"> {H- &gt; Z </em> }生成<em class="mn">假 _z </em>一个假斑马图像。从<em class="mn"> z，</em>G<em class="mn">{ H-&gt;Z</em>}<em class="mn"/>生成<em class="mn"> id_z </em>应该与<em class="mn">Z</em>相同</li><li id="d393" class="mo mp iq ky b kz mx ld my lh mz ll na lp nb lt mt mu mv mw bi translated">从<em class="mn"> z，</em> G <em class="mn"> {Z- &gt; </em> H}生成<em class="mn"> fake_h </em>一个假马图像。从<em class="mn"> h，</em>G<em class="mn">{ Z-&gt;</em>H }<em class="mn"/>生成应该与<em class="mn"> h. </em>相同的<em class="mn"> id_h </em></li><li id="351a" class="mo mp iq ky b kz mx ld my lh mz ll na lp nb lt mt mu mv mw bi translated">从<em class="mn"> fake_z </em>，G <em class="mn"> {Z- &gt; </em> H}生成<em class="mn"> rec_h </em>一个与<em class="mn"> h </em>相似的<em class="mn"> h </em>的重建图像。</li><li id="58ec" class="mo mp iq ky b kz mx ld my lh mz ll na lp nb lt mt mu mv mw bi translated">从<em class="mn"> fake_h </em>，G <em class="mn"> {H- &gt; Z </em> }生成<em class="mn"> rec_z </em>一个应该类似于<em class="mn"> z </em>的重构图像。</li></ul><p id="0979" class="pw-post-body-paragraph kw kx iq ky b kz lv lb lc ld lw lf lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">然后，通过最小化跟随损失来更新发电机的权重。在 G <em class="mn"> {H- &gt; Z </em> }的情况下，可以写成:</p><figure class="mb mc md me gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nc"><img src="../Images/5c292fca0e66892e4d756dbcb8d0024b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OUEJgPALbiYC35zunFKaOQ.png"/></div></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk">where D_z(fake_z)(i,j) is the scalar value at coordinate (i,j) of D_z output tensor.</figcaption></figure><ul class=""><li id="8edb" class="mo mp iq ky b kz lv ld lw lh mq ll mr lp ms lt mt mu mv mw bi translated"><em class="mn"> D_z </em> ( <em class="mn"> fake_z </em>)和<em class="mn"> 1 </em>之间的均方误差(MSE)。即<a class="ae lu" href="https://arxiv.org/pdf/1703.10593.pdf" rel="noopener ugc nofollow" target="_blank">原图</a>中的最小二乘损失。<em class="mn"> D_z </em>是与 G <em class="mn"> {H- &gt; Z </em> }关联的鉴别器，如果输入—<em class="mn">fake _ Z</em>—看起来像一个真正的斑马 else <em class="mn"> 0 </em>时，它输出<em class="mn"> 1 </em>。</li></ul><figure class="mb mc md me gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nd"><img src="../Images/e571757c695814a2ff98855a3f2e5dbe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bAOZWoLniUzD9CYd-aBVjg.png"/></div></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk">pixel to pixel absolute difference of the two images.</figcaption></figure><ul class=""><li id="3eb4" class="mo mp iq ky b kz lv ld lw lh mq ll mr lp ms lt mt mu mv mw bi translated"><em class="mn"> rec_h </em>和<em class="mn"> h </em>之间的平均绝对误差(MAE)。即<a class="ae lu" href="https://arxiv.org/pdf/1703.10593.pdf" rel="noopener ugc nofollow" target="_blank">原纸中的循环一致性损失。这个损失被赋予了很大的重要性，并且更新了 10 倍于 MSE 损失的发电机权重。</a></li></ul><figure class="mb mc md me gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ne"><img src="../Images/2c832aefc03c19911a908d9be610af19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FAMGXG2pxLGOAXHmcSLR5Q.png"/></div></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk">pixel to pixel absolute difference of the two images.</figcaption></figure><ul class=""><li id="f02c" class="mo mp iq ky b kz lv ld lw lh mq ll mr lp ms lt mt mu mv mw bi translated"><em class="mn"> id_h </em>和<em class="mn"> h </em>之间的平均绝对误差(MAE)。即<a class="ae lu" href="https://arxiv.org/pdf/1703.10593.pdf" rel="noopener ugc nofollow" target="_blank">原文</a>中的身份丧失。没有必要包括这种损失，但它通常有助于获得更好的结果。</li></ul><p id="00ed" class="pw-post-body-paragraph kw kx iq ky b kz lv lb lc ld lw lf lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">然后，通过最小化跟随损失来更新鉴别器的权重。在<em class="mn"> D_z </em>的情况下，可以写成:</p><figure class="mb mc md me gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nf"><img src="../Images/96add46bad46c03d5797c1482bc1898f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GK5sz-fqgOJuG5K1aLnXaw.png"/></div></div></figure><ul class=""><li id="160f" class="mo mp iq ky b kz lv ld lw lh mq ll mr lp ms lt mt mu mv mw bi translated"><em class="mn"> D_z </em> ( <em class="mn"> fake_z </em>)与<em class="mn"> 0 </em>之间均方误差(MSE)的一半加上<em class="mn"> D_z </em> ( <em class="mn"> z </em>)与<em class="mn"> 1 </em>之间 MSE 的一半。</li></ul><p id="cf56" class="pw-post-body-paragraph kw kx iq ky b kz lv lb lc ld lw lf lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">鉴别器的损耗减半。这样做相当于使用 MSE 在每次更新生成器权重两次时更新鉴别器权重一次。</p><h1 id="7f10" class="jy jz iq bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">4.结果</h1><p id="a87b" class="pw-post-body-paragraph kw kx iq ky b kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt ij bi translated">复制这些结果的代码可以从<a class="ae lu" href="https://colab.research.google.com/gist/feiwu77777/3de4782dc9fbc3efa5d9131a48d8dfdc/cyclegan.ipynb" rel="noopener ugc nofollow" target="_blank"> colab 笔记本</a>中获得。</p><p id="ba94" class="pw-post-body-paragraph kw kx iq ky b kz lv lb lc ld lw lf lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">然后，CycleGAN 被训练 200 个周期。在前 100 个时期，学习速率固定为 2e-4，在后 100 个时期，学习速率从 2e-4 到 2e-6 线性退火。下面显示了一些生成的图像。</p><p id="ef34" class="pw-post-body-paragraph kw kx iq ky b kz lv lb lc ld lw lf lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">通常有非常好的结果(左:原始图像，右:生成的图像) :</p><figure class="mb mc md me gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ng"><img src="../Images/d5d488690dabb80cb07a06363489dc49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0T3G87VZQGmOUQY3rrcsYA.png"/></div></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk">original images / generated images</figcaption></figure><p id="3781" class="pw-post-body-paragraph kw kx iq ky b kz lv lb lc ld lw lf lg lh lx lj lk ll ly ln lo lp lz lr ls lt ij bi translated">但也有失败的情况(左:原始图像，右:生成的图像) :</p><figure class="mb mc md me gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ng"><img src="../Images/735b0b42ea97cc0d897b1e90e0b502eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PKV4NREo8P4GH60GmnbeAA.png"/></div></div></figure></div></div>    
</body>
</html>