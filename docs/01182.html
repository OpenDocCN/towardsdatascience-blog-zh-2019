<html>
<head>
<title>How to run a Notebook for Data Science on Google Cloud with a Database and a GPU in 15min.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在 15 分钟内用一个数据库和一个 GPU 在 Google Cloud 上运行一个数据科学的笔记本？</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-run-a-notebook-for-data-science-on-google-cloud-with-a-database-and-a-gpu-in-15min-f662f36c3a66?source=collection_archive---------12-----------------------#2019-02-23">https://towardsdatascience.com/how-to-run-a-notebook-for-data-science-on-google-cloud-with-a-database-and-a-gpu-in-15min-f662f36c3a66?source=collection_archive---------12-----------------------#2019-02-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/821a5d1aaa0f6cc5ea4920263fe0843b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hOg5yzFdn4Y7oURdhS6jQg.png"/></div></div></figure><h2 id="c361" class="jy jz iq bd ka kb kc dn kd ke kf dp kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated"><strong class="ak">设置您的云外壳</strong></h2><p id="db05" class="pw-post-body-paragraph ku kv iq kw b kx ky kz la lb lc ld le kh lf lg lh kl li lj lk kp ll lm ln lo ij bi translated">首先，你需要有一个谷歌账户，并访问你的谷歌云控制台<a class="ae lp" href="https://console.cloud.google.com" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><p id="ea58" class="pw-post-body-paragraph ku kv iq kw b kx lq kz la lb lr ld le kh ls lg lh kl lt lj lk kp lu lm ln lo ij bi translated">登录后，如果您是第一次使用 google cloud，您需要创建您的项目，方法是点击弹出窗口右上角的“<em class="lv">选择一个项目</em>，然后点击“<em class="lv">新建项目</em>，并按照几个简单的步骤创建您的第一个项目:</p><figure class="lx ly lz ma gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lw"><img src="../Images/1f72eb17b7c4b5d13aef1d215b031d32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ML1Zpn2_f0bUZvKvkFIuRA.png"/></div></div></figure><p id="22dc" class="pw-post-body-paragraph ku kv iq kw b kx lq kz la lb lr ld le kh ls lg lh kl lt lj lk kp lu lm ln lo ij bi translated">完成后，你应该会在谷歌云控制台窗口的顶部横幅中看到你的项目名称，而不是<em class="lv">新项目</em>。</p><p id="5640" class="pw-post-body-paragraph ku kv iq kw b kx lq kz la lb lr ld le kh ls lg lh kl lt lj lk kp lu lm ln lo ij bi translated">现在，点击 Google Cloud 控制台窗口右上角的图标，打开您的云外壳(如果是第一次点击，您需要激活它，只需点击“启动云外壳”)。</p><figure class="lx ly lz ma gt jr gh gi paragraph-image"><div class="gh gi mb"><img src="../Images/44731d1bcbcdc7d572ec2f3fb307247e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1052/format:webp/1*La4t3mUedWJrsr1ml_Jg0w.png"/></div></figure><p id="b448" class="pw-post-body-paragraph ku kv iq kw b kx lq kz la lb lr ld le kh ls lg lh kl lt lj lk kp lu lm ln lo ij bi translated">你的云外壳窗口应该出现在当前谷歌云控制台窗口的底部。彩色文本是你的项目的名称，例如我的项目在这里是名称“first proj”+一个由谷歌提供的 id:</p><figure class="lx ly lz ma gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mc"><img src="../Images/3e4fdfcb09c3ed4d360779e6fa59bb8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r7PxPIqgeOvYMYpH4qiVKg.png"/></div></div></figure><p id="2273" class="pw-post-body-paragraph ku kv iq kw b kx lq kz la lb lr ld le kh ls lg lh kl lt lj lk kp lu lm ln lo ij bi translated">确保您的 ggcloud 组件保持最新并准备就绪:</p><pre class="lx ly lz ma gt md me mf mg aw mh bi"><span id="a53b" class="jy jz iq me b gy mi mj l mk ml">sudo gcloud components update</span></pre><h1 id="2f53" class="mm jz iq bd ka mn mo mp kd mq mr ms kg mt mu mv kk mw mx my ko mz na nb ks nc bi translated">安装和设置数据实验室</h1><h2 id="3560" class="jy jz iq bd ka kb kc dn kd ke kf dp kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">激活 API</h2><p id="c52f" class="pw-post-body-paragraph ku kv iq kw b kx ky kz la lb lc ld le kh lf lg lh kl li lj lk kp ll lm ln lo ij bi translated">Google Cloud console 要求您激活 API 以允许它们在您的项目上运行，如果您不这样做，您将不得不处理一个<em class="lv">HTTPError 403:Access Not Configured</em>错误。去那里，让我们激活所需的 API:<a class="ae lp" href="https://console.developers.google.com/apis/library" rel="noopener ugc nofollow" target="_blank">https://console.developers.google.com/apis/library</a></p><p id="d9cb" class="pw-post-body-paragraph ku kv iq kw b kx lq kz la lb lr ld le kh ls lg lh kl lt lj lk kp lu lm ln lo ij bi translated">搜索计算引擎 API 并启用它(<strong class="kw ir">如果尚未创建计费帐户</strong>，您将需要创建计费帐户)，确保 Google 云存储 API 已经启用:</p><figure class="lx ly lz ma gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nd"><img src="../Images/f6be00f561b4c57f5d3c4dcacb43e9b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4x4kLMzXaZDKznZ5ntrw1w.png"/></div></div></figure><h2 id="9c6c" class="jy jz iq bd ka kb kc dn kd ke kf dp kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">安装 DataLab</h2><pre class="lx ly lz ma gt md me mf mg aw mh bi"><span id="18df" class="jy jz iq me b gy mi mj l mk ml">gcloud components install datalab</span></pre><p id="d7ea" class="pw-post-body-paragraph ku kv iq kw b kx lq kz la lb lr ld le kh ls lg lh kl lt lj lk kp lu lm ln lo ij bi translated">现在，我们将创建一个数据实验室，该命令将创建一个具有数据科学基本要求的实例(我在这里选择了 n1-highmen-8，带有 8 个 vCPUs 和 52 GB 内存，请不要犹豫更改机器类型。要查看机器详情，请点击<a class="ae lp" href="https://cloud.google.com/compute/docs/machine-types" rel="noopener ugc nofollow" target="_blank">此处</a>并点击<a class="ae lp" href="https://cloud.google.com/compute/pricing#machinetype" rel="noopener ugc nofollow" target="_blank">此处</a>):</p><pre class="lx ly lz ma gt md me mf mg aw mh bi"><span id="ea41" class="jy jz iq me b gy mi mj l mk ml">datalab beta create-gpu your-datalab-instance-name --machine-type n1-highmem-8</span></pre><p id="fb18" class="pw-post-body-paragraph ku kv iq kw b kx lq kz la lb lr ld le kh ls lg lh kl lt lj lk kp lu lm ln lo ij bi translated">您必须接受<em class="lv"> NVidia GPU 驱动程序安装</em>，然后<em class="lv"> </em>选择一个区域，并按照查看步骤使用 SSH 访问您的 datalab 实例。</p><blockquote class="ne nf ng"><p id="0290" class="ku kv lv kw b kx lq kz la lb lr ld le nh ls lg lh ni lt lj lk nj lu lm ln lo ij bi translated">重要说明:默认情况下，create-gpu 命令使用 Nvidia Tesla K80 创建一个实例，该实例仅在那些选定的区域上可用:</p></blockquote><pre class="lx ly lz ma gt md me mf mg aw mh bi"><span id="cd30" class="jy jz iq me b gy mi mj l mk ml">us-west1-b<br/>us-central1-a<br/>us-central1-c<br/>us-east1-c<br/>us-east1-d<br/>europe-west1-b<br/>europe-west1-d<br/>asia-east1-a<br/>asia-east1-b</span></pre><p id="90a1" class="pw-post-body-paragraph ku kv iq kw b kx lq kz la lb lr ld le kh ls lg lh kl lt lj lk kp lu lm ln lo ij bi translated">安装完成后，您可以通过在云 Shell 中键入以下命令，在 windows 浏览器中运行您的 datalab:</p><pre class="lx ly lz ma gt md me mf mg aw mh bi"><span id="023a" class="jy jz iq me b gy mi mj l mk ml">datalab connect your-datalab-instance-name</span></pre><p id="55cd" class="pw-post-body-paragraph ku kv iq kw b kx lq kz la lb lr ld le kh ls lg lh kl lt lj lk kp lu lm ln lo ij bi translated">然后通过点击<em class="lv">改变端口:</em>将<strong class="kw ir">端口设置为 8081 </strong>打开一个窗口浏览器</p><figure class="lx ly lz ma gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nk"><img src="../Images/7855e6b1c41e04002c241bc295373ea9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PqFnZZZJO7enwWMYRuCgrA.png"/></div></div></figure><blockquote class="ne nf ng"><p id="80a7" class="ku kv lv kw b kx lq kz la lb lr ld le nh ls lg lh ni lt lj lk nj lu lm ln lo ij bi translated">给你！您刚刚安装了您的 Datalab Google 实例，它看起来应该如下图所示。你现在可以像使用普通的 Jupyter 笔记本一样使用它了。</p></blockquote><figure class="lx ly lz ma gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nl"><img src="../Images/377f37157a49814c1a3e25bab7b96b8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8x4lqv-vSLsxZ55h5FjL-g.png"/></div></div></figure><h1 id="7f66" class="mm jz iq bd ka mn mo mp kd mq mr ms kg mt mu mv kk mw mx my ko mz na nb ks nc bi translated"><strong class="ak">设置你的谷歌云存储</strong></h1><p id="8898" class="pw-post-body-paragraph ku kv iq kw b kx ky kz la lb lc ld le kh lf lg lh kl li lj lk kp ll lm ln lo ij bi translated">一个实例不应该被用作一个存储环境这就是为什么 Google Cloud 提供了许多不同服务来提供不同种类的存储服务。这里我们就用最简单的一个:<a class="ae lp" href="https://cloud.google.com/storage/" rel="noopener ugc nofollow" target="_blank">谷歌云存储</a>。</p><p id="bd2f" class="pw-post-body-paragraph ku kv iq kw b kx lq kz la lb lr ld le kh ls lg lh kl lt lj lk kp lu lm ln lo ij bi translated">点击左侧菜单，进入谷歌云的“存储”服务。</p><p id="6a3c" class="pw-post-body-paragraph ku kv iq kw b kx lq kz la lb lr ld le kh ls lg lh kl lt lj lk kp lu lm ln lo ij bi translated">创建存储桶:</p><figure class="lx ly lz ma gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nm"><img src="../Images/c9a1097fbdc36a147df144ce21563143.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AqsaZspYQTiTlP8a-Z2Saw.png"/></div></div></figure><p id="6937" class="pw-post-body-paragraph ku kv iq kw b kx lq kz la lb lr ld le kh ls lg lh kl lt lj lk kp lu lm ln lo ij bi translated">一切就绪，谷歌云存储非常简单，只需像通常的操作系统一样点击即可访问:</p><figure class="lx ly lz ma gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nn"><img src="../Images/9b5cfc8da8d541dfbf647fbd131e0fc7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8YIXCYXV79Pdbp2zJ2KjCw.png"/></div></div></figure><h1 id="e051" class="mm jz iq bd ka mn mo mp kd mq mr ms kg mt mu mv kk mw mx my ko mz na nb ks nc bi translated">在你的数据实验室使用你的谷歌云存储</h1><p id="c93b" class="pw-post-body-paragraph ku kv iq kw b kx ky kz la lb lc ld le kh lf lg lh kl li lj lk kp ll lm ln lo ij bi translated">这是一个简单的示例函数，从 bucket 中读取一个文件和一个 csv。</p><pre class="lx ly lz ma gt md me mf mg aw mh bi"><span id="aab8" class="jy jz iq me b gy mi mj l mk ml">import google.datalab.storage as storage<br/>import pandas as pd from io<br/>import BytesIO<br/></span><span id="9417" class="jy jz iq me b gy no mj l mk ml">def get_bucket(bucket_target):<br/>    shared_bucket = storage.Bucket(str(bucket_name))<br/>   return shared_bucket</span><span id="cc67" class="jy jz iq me b gy no mj l mk ml">def read_file_from_bucket(file_target):<br/>    shared_bucket = get_bucket(bucket_target)<br/>    sample_object = shared_bucket.object(str(file_target)<br/>    sample_text = sample_object.read_stream()<br/>    return sample_text</span><span id="3dfe" class="jy jz iq me b gy no mj l mk ml">def read_csv_from_bucket(bucket_name,csv_file_name):  <br/>   %gcs read --object gs://+bucket_name+/+file_name --variable   csv_as_bytes<br/>   df = pd.read_csv(BytesIO(csv_as_bytes))<br/>   return df</span></pre><p id="ec56" class="pw-post-body-paragraph ku kv iq kw b kx lq kz la lb lr ld le kh ls lg lh kl lt lj lk kp lu lm ln lo ij bi translated">要打印存储桶的内容，请执行以下操作:</p><pre class="lx ly lz ma gt md me mf mg aw mh bi"><span id="dec7" class="jy jz iq me b gy mi mj l mk ml">shared_bucket = get_bucket(bucket_name)<br/>for obj in shared_bucket.objects():<br/>    if obj.key.find('/') &lt; 0:<br/>        print(obj.key)</span></pre><p id="72ed" class="pw-post-body-paragraph ku kv iq kw b kx lq kz la lb lr ld le kh ls lg lh kl lt lj lk kp lu lm ln lo ij bi translated">例如，要打印文本文件:</p><pre class="lx ly lz ma gt md me mf mg aw mh bi"><span id="afc2" class="jy jz iq me b gy mi mj l mk ml">sample_text = read_file_from_bucket(file_name)<br/>print(sample_text)</span></pre><p id="8dbc" class="pw-post-body-paragraph ku kv iq kw b kx lq kz la lb lr ld le kh ls lg lh kl lt lj lk kp lu lm ln lo ij bi translated">要获取 csv 表格作为数据帧:</p><pre class="lx ly lz ma gt md me mf mg aw mh bi"><span id="fd93" class="jy jz iq me b gy mi mj l mk ml">df = read_csv_from_bucket(bucket_target,file_target) <br/>df.head()</span></pre><p id="56f4" class="pw-post-body-paragraph ku kv iq kw b kx lq kz la lb lr ld le kh ls lg lh kl lt lj lk kp lu lm ln lo ij bi translated">现在，您已经有了一台连接到存储云的高性能笔记本电脑，可以用于您的数据科学项目了！</p><p id="d471" class="pw-post-body-paragraph ku kv iq kw b kx lq kz la lb lr ld le kh ls lg lh kl lt lj lk kp lu lm ln lo ij bi translated">尽情享受吧！:-)</p></div></div>    
</body>
</html>