<html>
<head>
<title>Illustration with Python: Confidence Interval</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python 插图:置信区间</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/illustration-with-python-confidence-interval-ee4736cc3dc2?source=collection_archive---------6-----------------------#2019-10-28">https://towardsdatascience.com/illustration-with-python-confidence-interval-ee4736cc3dc2?source=collection_archive---------6-----------------------#2019-10-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="90c6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">本文使用了<a class="ae ko" href="https://medium.com/@c.chaipitakporn/illustration-with-python-central-limit-theorem-aa4d81f7b570" rel="noopener">中的知识，中心极限定理</a>，还有<a class="ae ko" href="https://medium.com/@c.chaipitakporn/illustration-with-python-weak-law-of-large-numbers-2a644b862985" rel="noopener">的概念，弱大数定律</a>和<a class="ae ko" href="https://medium.com/analytics-vidhya/illustration-with-python-chebyshevs-inequality-b34be151c547" rel="noopener">的切比雪夫不等式</a>，你可以通过访问链接来复习这些题目。如果你想继续下去，你可以从这个链接获得代码:<a class="ae ko" href="https://github.com/chaipi-chaya/Illustration-with-Python/blob/master/Illustration%20with%20Python%20Confidence%20Interval.ipynb" rel="noopener ugc nofollow" target="_blank"> Jupyter 笔记本</a>。</p><p id="79a3" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在我看来，这个话题是最令人困惑的定理，甚至维基百科的文章也提到了对它的误解，所以我会尽力解释它。</p><p id="d798" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在深入研究之前，请记住，总体的均值(我们要估计的东西)是一个常数，这个数字没有随机性。</p><p id="aa71" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">置信区间是我们用来估计总体参数值的估计量。间隔将创建一个可能包含这些值的范围。当我们创建区间时，我们使用样本均值。回想一下中心极限定理，如果我们多次采样，样本均值将呈正态分布。</p><p id="6fea" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我创建了样本均值分布来演示这个估计量。</p><pre class="kp kq kr ks gt kt ku kv kw aw kx bi"><span id="32af" class="ky kz it ku b gy la lb l lc ld"># use gamma distribution<br/>shape, scale = 2.0, 2.0  # mean=4, std=2*sqrt(2)<br/>s = np.random.gamma(shape, scale, 1000000)<br/>mu = shape*scale # mean and standard deviation<br/>sigma = scale*np.sqrt(shape)</span><span id="3577" class="ky kz it ku b gy le lb l lc ld"># create sample mean distribution<br/>meansample = []<br/># sample size<br/>samplesize = 500<br/>for j in range(0,50000):<br/>    # sampling 500 sample from population<br/>    rc = random.choices(s, k=samplesize)<br/>    # collect mean of each sample<br/>    meansample.append(sum(rc)/len(rc))</span><span id="19f7" class="ky kz it ku b gy le lb l lc ld">plt.figure(figsize=(20,10))<br/>plt.hist(meansample, 200, density=True, color='lightblue')<br/>plt.show()</span></pre><figure class="kp kq kr ks gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi lf"><img src="../Images/53ec69f8412556ebae7d5a8d68e1be21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HqtZTc_DSUOg0-BKvba2Lg.jpeg"/></div></div></figure><p id="18d9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">样本均值分布是正态分布，均值等于总体均值 4。我们可以把这个分布改成标准的正态分布，用 Z 表来计算概率。</p><p id="3e91" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我使用 Z 表创建一个覆盖样本平均值 95%的范围，如下图所示。</p><pre class="kp kq kr ks gt kt ku kv kw aw kx bi"><span id="0441" class="ky kz it ku b gy la lb l lc ld"># set mean and 95% probability<br/>plt.figure(figsize=(20,10))<br/>plt.hist(meansample, 200, density=True, color='lightblue')<br/>plt.plot([mu,mu],[0, 3.2], 'k-', lw=4, color='green')<br/>plt.plot([mu-(1.96*sigma/np.sqrt(samplesize)),mu-(1.96*sigma/np.sqrt(samplesize))],[0, 3.2], 'k-', lw=2, color='navy')<br/>plt.plot([mu+(1.96*sigma/np.sqrt(samplesize)),mu+(1.96*sigma/np.sqrt(samplesize))],[0, 3.2], 'k-', lw=2, color='navy')<br/>plt.show()</span></pre><figure class="kp kq kr ks gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi ln"><img src="../Images/2186ff36e36e5f7ebfc60b54817e949a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8XjivdCHfgD__RRzBAKn5g.jpeg"/></div></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk">The green line is the true mean or population mean. The two blue lines are a 95% border.</figcaption></figure><p id="e0b6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果我们从总体中取样并计算平均值，在 95%的情况下，我们将得到两条蓝线内的平均值。</p><p id="ba0d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">不幸的是，我们无法采样 50，000 次并创建这个分布。假设我们只能采样 1 次，我们得到的样本平均值为 3.85。我们得到的平均值是黑线。</p><pre class="kp kq kr ks gt kt ku kv kw aw kx bi"><span id="4572" class="ky kz it ku b gy la lb l lc ld"># suppose that we sample 500 data that has a mean as 3.85<br/># Xbar mean = 3.85, sigma = sigma/np.sqrt(samplesize)<br/>m, ss = 3.85, sigma/np.sqrt(samplesize) # mean and standard deviation<br/>plt.figure(figsize=(20,10))<br/>plt.hist(meansample, 200, density=True, color='lightblue')<br/>plt.plot([mu,mu],[0, 3.2], 'k-', lw=4, color='green')<br/>plt.plot([mu-(1.96*sigma/np.sqrt(samplesize)),mu-(1.96*sigma/np.sqrt(samplesize))],[0, 3.2], 'k-', lw=2, color='navy')<br/>plt.plot([mu+(1.96*sigma/np.sqrt(samplesize)),mu+(1.96*sigma/np.sqrt(samplesize))],[0, 3.2], 'k-', lw=2, color='navy')<br/>plt.plot([m,m],[0, 3.2], 'k-', lw=2, color='black')<br/>plt.show()</span></pre><figure class="kp kq kr ks gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi lf"><img src="../Images/5bcd258769fdc85b5340c56bfb41b22b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S6O3mYqOeWezWxE-0zq9JQ.jpeg"/></div></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk">The black line is the mean we got from sampling.</figcaption></figure><p id="fdfb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">根据我们得到的平均值，我们希望创建一个估计量来估计真实平均值的值，因此我们使用 95%的范围(黄色区域)创建一个区间。稍后我会解释为什么我们使用 95%的范围。</p><pre class="kp kq kr ks gt kt ku kv kw aw kx bi"><span id="833e" class="ky kz it ku b gy la lb l lc ld"># the interval we create cover the population mean because it is within 95% range from population mean<br/>plt.figure(figsize=(20,10))</span><span id="d364" class="ky kz it ku b gy le lb l lc ld">plt.hist(meansample, 200, density=True, color='lightblue')<br/>plt.plot([mu,mu],[0, 3.2], 'k-', lw=4, color='green')<br/>plt.plot([mu-(1.96*sigma/np.sqrt(samplesize)),mu-(1.96*sigma/np.sqrt(samplesize))],[0, 3.2], 'k-', lw=1, color='navy')<br/>plt.plot([mu+(1.96*sigma/np.sqrt(samplesize)),mu+(1.96*sigma/np.sqrt(samplesize))],[0, 3.2], 'k-', lw=1, color='navy')<br/>plt.plot([m,m],[0, 3.2], 'k-', lw=4, color='black')<br/>plt.plot([m-(1.96*ss),m-(1.96*ss)],[0, 3.2], 'k-', lw=2, color='red')<br/>plt.plot([m+(1.96*ss),m+(1.96*ss)],[0, 3.2], 'k-', lw=2, color='red')<br/># Create a Rectangle patch<br/>plt.gca().add_patch(plt.Rectangle((m-(1.96*ss), 0),2*(1.96*ss),3.21, fill=True, linewidth=3, fc=(1,1,0,0.3)))<br/>plt.xlim(3.43, 4.67) <br/>plt.show()</span></pre><figure class="kp kq kr ks gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi ln"><img src="../Images/7d867a5d8314e8b9200b8f18ea7e660f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n-rLAQtJvICd3uEzKtPLbQ.jpeg"/></div></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk">The yellow area is an interval of the sample mean.</figcaption></figure><p id="2d0b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们可以看到区间覆盖了真实均值(绿线)。区间(黄色区域)覆盖了真实平均值，因为样本平均值落在总体平均值(绿线)的 95%范围内。</p><p id="e40b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">由于样本均值是随机的，因此有 5%的概率均值会超出 95%的范围。当样本平均值超出 95%范围时，就会出现这种情况。</p><pre class="kp kq kr ks gt kt ku kv kw aw kx bi"><span id="30bb" class="ky kz it ku b gy la lb l lc ld"># if the interval is not within 95% range from population mean the interval will not cover the true population mean<br/>plt.figure(figsize=(20,10))<br/>m = 3.72<br/>plt.hist(meansample, 200, density=True, color='lightblue')<br/>plt.plot([mu,mu],[0, 3.2], 'k-', lw=4, color='green')<br/>plt.plot([mu-(1.96*sigma/np.sqrt(samplesize)),mu-(1.96*sigma/np.sqrt(samplesize))],[0, 3.2], 'k-', lw=1, color='navy')<br/>plt.plot([mu+(1.96*sigma/np.sqrt(samplesize)),mu+(1.96*sigma/np.sqrt(samplesize))],[0, 3.2], 'k-', lw=1, color='navy')<br/>plt.plot([m,m],[0, 3.2], 'k-', lw=4, color='black')<br/>plt.plot([m-(1.96*ss),m-(1.96*ss)],[0, 3.2], 'k-', lw=2, color='red')<br/>plt.plot([m+(1.96*ss),m+(1.96*ss)],[0, 3.2], 'k-', lw=2, color='red')<br/># Create a Rectangle patch<br/>plt.gca().add_patch(plt.Rectangle((m-(1.96*ss), 0),2*(1.96*ss),3.21, fill=True, linewidth=3, fc=(1,1,0,0.3)))<br/>plt.xlim(3.43, 4.67) <br/>plt.show()</span></pre><figure class="kp kq kr ks gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi ls"><img src="../Images/4f6f6cc387f102f3ac7bd699d002d466.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PAzvecCegWGrqakZJwpF0w.jpeg"/></div></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk">If we sample and get the mean that falls outside blue lines, the interval will not cover the true mean.</figcaption></figure><p id="e31c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">黄色区域不包含人口平均值。</p><p id="e9eb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们使用 95%的范围，因为它与样本均值的概率相匹配。如果样本均值在概率的边界上，则该范围仍然覆盖真实均值，但如果再远一点，则不会覆盖真实均值。样本均值落在两条蓝线内的概率为 95%，因此两条线外 5%的区间不会覆盖真实均值。</p><p id="45d6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">95%这个数字是一个任意的数字，你可以把它设置成任意的数字。例如，我们可以将其设置为 90%的范围。</p><pre class="kp kq kr ks gt kt ku kv kw aw kx bi"><span id="9e3e" class="ky kz it ku b gy la lb l lc ld"># use 90% instead of 95%<br/>plt.figure(figsize=(20,10))<br/>m = 3.72<br/>plt.hist(meansample, 200, density=True, color='lightblue')<br/>plt.plot([mu,mu],[0, 3.2], 'k-', lw=4, color='green')<br/>plt.plot([mu-(1.645*sigma/np.sqrt(samplesize)),mu-(1.645*sigma/np.sqrt(samplesize))],[0, 3.2], 'k-', lw=1, color='navy')<br/>plt.plot([mu+(1.645*sigma/np.sqrt(samplesize)),mu+(1.645*sigma/np.sqrt(samplesize))],[0, 3.2], 'k-', lw=1, color='navy')<br/>plt.plot([m,m],[0, 3.2], 'k-', lw=4, color='black')<br/>plt.plot([m-(1.645*ss),m-(1.645*ss)],[0, 3.2], 'k-', lw=2, color='red')<br/>plt.plot([m+(1.645*ss),m+(1.645*ss)],[0, 3.2], 'k-', lw=2, color='red')<br/># Create a Rectangle patch<br/>plt.gca().add_patch(plt.Rectangle((m-(1.645*ss), 0),2*(1.645*ss),3.21, fill=True, linewidth=3, fc=(1,1,0,0.3)))<br/>plt.xlim(3.43, 4.67) <br/>plt.show()</span></pre><figure class="kp kq kr ks gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi lf"><img src="../Images/b0839ed53f1fa92b14097339a6d74353.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C8PuXQIgJqceb9-ibPUEcw.jpeg"/></div></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk">When we change the confidence from 95% to 90%, the interval becomes narrower.</figcaption></figure><p id="2e9b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">因此，当我们说 95%的置信度时，意味着我们确信 95%的样本的平均值在真实平均值的 95%范围内(两条蓝线内)。问题是如果我们知道真正的意思，我们就不会这么做了。为了解决这个问题，我们将解释改为“我们确信 95%的抽样，样本将具有一个平均值，该平均值可以创建覆盖真实平均值的区间”。</p><p id="f314" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">就像我上面提到的，这里唯一随机的是样本均值，所以我们不能说真均值的概率在区间内，因为总体均值不是随机变量，真均值是一个数字。</p><p id="699a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">理论上，如果我们采样 100 次，95 次，我们将得到一个样本均值，其区间覆盖真实均值，因此我使用 python 模拟 100 次采样，这就是所发生的情况。</p><pre class="kp kq kr ks gt kt ku kv kw aw kx bi"><span id="54da" class="ky kz it ku b gy la lb l lc ld"># simulate 100 interval with 5,000 sample size<br/>mu = shape*scale # mean<br/>sigma = scale*np.sqrt(shape) # standard deviation<br/>intervallist = []<br/>k = 1.96<br/># sample size<br/>samplesize = 5000<br/># start count<br/>c = 0<br/>for i in range(0,100):<br/>    # sample 100 sample<br/>    rs = random.choices(s, k=samplesize)<br/>    # calculate mean<br/>    mean = np.mean(rs)<br/>    upbound = mean + k*sigma/np.sqrt(samplesize)<br/>    lowbound = mean - k*sigma/np.sqrt(samplesize)<br/>    # collect difference between sample mean and mu<br/>    intervallist.append([lowbound,mean,upbound])<br/>    if upbound &gt;= mu and lowbound &lt;= mu:<br/>        c += 1<br/>        <br/>print("number of interval that cover the expected values:", c)<br/># set figure size.<br/>plt.figure(figsize=(20,10))<br/># plot box plots of each sample mean.<br/>plt.boxplot(intervallist)<br/>plt.plot([1, 100],[mu,mu], 'k-', lw=2, color='red')<br/># show plot.<br/>plt.show()</span></pre><figure class="kp kq kr ks gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi lf"><img src="../Images/aa35b27bc6437479af28f4c73f24925f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yHwoU4eMoFZ_YyHJRScMrg.jpeg"/></div></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk">The red line is a true mean, the box plots are intervals.</figcaption></figure><p id="dabb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这个数字可能不是精确的 95，因为它毕竟是一个概率。</p><p id="0858" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最后一点，样本大小对这个话题有巨大的影响。如果样本量增加，样本均值的方差会减小。因此，间隔范围也减小。</p><pre class="kp kq kr ks gt kt ku kv kw aw kx bi"><span id="af26" class="ky kz it ku b gy la lb l lc ld"># simulate 100 interval with 20,000 sample size<br/>intervallist = []<br/># sample size<br/>samplesize = 20000<br/># start count<br/>c = 0<br/>for i in range(0,100):<br/>    # sample 100 sample<br/>    rs = random.choices(s, k=samplesize)<br/>    # calculate mean<br/>    mean = np.mean(rs)<br/>    upbound = mean + k*sigma/np.sqrt(samplesize)<br/>    lowbound = mean - k*sigma/np.sqrt(samplesize)<br/>    # collect difference between sample mean and mu<br/>    intervallist.append([lowbound,mean,upbound])<br/>    if upbound &gt;= mu and lowbound &lt;= mu:<br/>        c += 1<br/>        <br/>print("number of interval that cover the expected values:", c)<br/># set figure size.<br/>plt.figure(figsize=(20,10))<br/># plot box plots of each sample mean.<br/>plt.boxplot(intervallist)<br/>plt.plot([1, 100],[mu,mu], 'k-', lw=2, color='red')<br/># show plot.<br/>plt.show()</span></pre><figure class="kp kq kr ks gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi ln"><img src="../Images/64a3cacba1ad38d1958df8f9403a0b4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qtsQR1eez0liloWnb8abRg.jpeg"/></div></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk">Notice the y-axis scale is smaller.</figcaption></figure><p id="131a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果我们的样本量很大，估计量会更精确。</p><p id="3f62" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">代码可以在这个链接找到:<a class="ae ko" href="https://github.com/chaipi-chaya/Illustration-with-Python/blob/master/Illustration%20with%20Python%20Confidence%20Interval.ipynb" rel="noopener ugc nofollow" target="_blank"> Jupyter 笔记本</a>。</p></div></div>    
</body>
</html>