<html>
<head>
<title>Use Pyspark with a Jupyter Notebook in an AWS EMR cluster</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在 AWS EMR 群集中使用 Pyspark 和 Jupyter 笔记本电脑</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/use-pyspark-with-a-jupyter-notebook-in-an-aws-emr-cluster-e5abc4cc9bdd?source=collection_archive---------4-----------------------#2019-01-11">https://towardsdatascience.com/use-pyspark-with-a-jupyter-notebook-in-an-aws-emr-cluster-e5abc4cc9bdd?source=collection_archive---------4-----------------------#2019-01-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="ee79" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Jupyter Notebook 是学习和解决代码问题的一个不可思议的工具。这里有一个博客来展示如何在学习 Spark 时利用这个强大的工具！</p><p id="d375" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您正在做任何可以并行化的计算密集型工作，Spark 会很有帮助。查看<a class="ae kl" href="https://www.quora.com/Why-is-Apache-Spark-used" rel="noopener ugc nofollow" target="_blank">这个 Quora 问题</a>获取更多信息。</p><p id="a12c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这篇博客将通过 AWS Elastic Map Reduce (AWS EMR)和 Jupyter Notebook 来设置使用 Spark 的基础设施。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/80de5786d7cbad2247df496274a029e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9RM7QQL5QgRqFFCnXVEOTg.png"/></div></div></figure><h2 id="590f" class="ky kz iq bd la lb lc dn ld le lf dp lg jy lh li lj kc lk ll lm kg ln lo lp lq bi translated">导航至 AWS EMR</h2><p id="7ced" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">您将在屏幕顶部看到以下内容:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi lw"><img src="../Images/b91b60aa54784f836e85c45fa5378717.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*hXwh7c_rUl9ZTzOH"/></div></div><figcaption class="lx ly gj gh gi lz ma bd b be z dk">Click ‘Create cluster’</figcaption></figure><h2 id="c099" class="ky kz iq bd la lb lc dn ld le lf dp lg jy lh li lj kc lk ll lm kg ln lo lp lq bi translated">选择高级选项</h2><p id="18df" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">在屏幕的顶部</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi mb"><img src="../Images/4012180e9c918455a0a3f641392081ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1370/0*AqFSF0J93vWMo2_V"/></div></figure><h2 id="968d" class="ky kz iq bd la lb lc dn ld le lf dp lg jy lh li lj kc lk ll lm kg ln lo lp lq bi translated">复制以下截图</h2><p id="0a04" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">我用黄色突出显示了需要更改的默认项目，除了第 2 步中的节点类型。这将取决于你的任务的计算强度。如果你只是在测试，资源可能会很少。以' g-'开头的实例是 GPU 实例，最适合运行 Spark。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mc"><img src="../Images/038581cf963cca1a25827a7b6d83bb27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*aGPSCRSuqvX1_XmO"/></div></div></figure><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi md"><img src="../Images/c0f36dcdf07dd7c33e94d76a24eb2371.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sgn1PbgHDJktEkLCtKOrZw.png"/></div></div><figcaption class="lx ly gj gh gi lz ma bd b be z dk">For more information about how to choose which types of instances to use, check out the AWS docs: <a class="ae kl" href="https://docs.aws.amazon.com/emr/latest/ManagementGuide/emr-plan-instances-guidelines.html" rel="noopener ugc nofollow" target="_blank">https://docs.aws.amazon.com/emr/latest/ManagementGuide/emr-plan-instances-guidelines.html</a></figcaption></figure><p id="7ba9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您计划从 S3 存储桶调入数据或文件，请确保您与 S3 存储桶位于同一个 VPC。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi me"><img src="../Images/142715e914dd8e03554338f1942f8ae3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1BIkifO6eKAK6vGX"/></div></div><figcaption class="lx ly gj gh gi lz ma bd b be z dk">See the “Add bootstrap action” ?</figcaption></figure><p id="a656" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">好的，这里是你安装引导动作的地方。默认情况下，引导操作以 Hadoop 用户的身份执行。您可以使用 sudo 以 root 权限执行引导操作。</p><p id="308b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">引导操作是将额外的 Python 包安装到其他内核的最有效方式。根据我们在软件配置中选择安装的软件，Anaconda 已经安装在它们上面了。对于我希望运行的脚本，我需要的附加包是 xmltodict。</p><p id="2377" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了安装 python 库 xmltodict，我需要保存一个包含以下脚本的引导操作，并将其存储在 S3 桶中。这就是在您将要引用的 S3 所在的 VPC 上安装 EMR 集群的重要性所在。这是一个 shell 脚本，将在 S3 保存为. sh 文件:</p><pre class="kn ko kp kq gt mf mg mh mi aw mj bi"><span id="7ebc" class="ky kz iq mg b gy mk ml l mm mn">sudo pip install xmltodict</span></pre><p id="7e3f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一定要包括须藤！</p><p id="db29" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你需要比<code class="fe mo mp mq mg b">xmltodict</code>更多的包，你可以把它们放在同一行代码中，用空格隔开。示例:<code class="fe mo mp mq mg b">sudo pip install xmltodict s3fs</code></p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mr"><img src="../Images/f84311f8b50c9e5caf86ddddd8756a76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZoGhZPWS7rqmHR6CUw__jw.png"/></div></div><figcaption class="lx ly gj gh gi lz ma bd b be z dk">Make sure you choose an EC2 key pair you have access to</figcaption></figure><p id="2319" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">`为什么选择这些安全组？：</p><p id="8b46" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在 EC2 仪表板中，应该有以下入站规则。</p><p id="b94c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本例中，源是 0.0.0.0/0，这是所有的 IP 地址。为了更加安全，请输入您自己的 IP 地址。</p><p id="77dc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如何检查:转到 EC2 仪表板，单击安全组，找到您的组并添加自定义规则:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="ab gu cl ms"><img src="../Images/1df8587ef23187891fe801809789f3d1.png" data-original-src="https://miro.medium.com/v2/format:webp/1*irggLsV_FsdWKqzWcb8hgQ.png"/></div><figcaption class="lx ly gj gh gi lz ma bd b be z dk">The 22 one allows you to SSH in from a local computer, the 888x one allows you to see Jupyter Notebook. As a note, this is an old screenshot; I made mine 8880 for this example.</figcaption></figure><p id="049a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">关于入境交通规则的更多信息，<a class="ae kl" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-network-security.html" rel="noopener ugc nofollow" target="_blank">查看 AWS 文档</a>。</p><h2 id="78fa" class="ky kz iq bd la lb lc dn ld le lf dp lg jy lh li lj kc lk ll lm kg ln lo lp lq bi translated">现在转到您的本地命令行；我们将通过 SSH 进入 EMR 集群。</h2><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/66ef2ae00bf1e068ec73e518657b6a5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1224/0*BXMWHC-Cg5p5UKCq"/></div><figcaption class="lx ly gj gh gi lz ma bd b be z dk">In general, don’t share your public DNS on the internet. This is one of my old ones.</figcaption></figure><p id="5c6c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">结果:现在你在 EMR 命令行中。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mu"><img src="../Images/59469e4bfb8ae10e547e8f197307d082.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*BDCpKMNgZza3kg15"/></div></div></figure><h2 id="e1e4" class="ky kz iq bd la lb lc dn ld le lf dp lg jy lh li lj kc lk ll lm kg ln lo lp lq bi translated">找到你的蟒蛇版本</h2><p id="ecbc" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated"><a class="ae kl" href="https://repo.continuum.io/archive/" rel="noopener ugc nofollow" target="_blank">https://repo.continuum.io/archive/</a>并在下一步复制/粘贴文件路径。选择 Python 3.6 或更低版本，因为在这个时候，我认为不可能将 worker 节点一直更新到 3.7。如果是的话，请在评论中给我留言吧！</p><h2 id="60f8" class="ky kz iq bd la lb lc dn ld le lf dp lg jy lh li lj kc lk ll lm kg ln lo lp lq bi translated">安装 Anaconda</h2><p id="cf33" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">将上一步中的文件路径放在这里:</p><pre class="kn ko kp kq gt mf mg mh mi aw mj bi"><span id="3747" class="ky kz iq mg b gy mk ml l mm mn">wget <a class="ae kl" href="https://repo.continuum.io/archive/Anaconda2-2018.12-Linux-x86_64.sh" rel="noopener ugc nofollow" target="_blank">https://repo.continuum.io/archive/Anaconda2-2018.12-Linux-x86_64.sh</a></span></pre><p id="8c30" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">按回车键</p><pre class="kn ko kp kq gt mf mg mh mi aw mj bi"><span id="7e83" class="ky kz iq mg b gy mk ml l mm mn">bash Anaconda2–2018.12-Linux-x86_64.sh</span></pre><p id="fb94" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">按 enter 键，并继续按 enter 键浏览条款和条件</p><p id="db18" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">键入 yes，</p><p id="057b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">按回车键确认位置</p><p id="c8fb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">等待软件包安装。</p><p id="cc36" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">键入 yes 添加到环境变量中，以便 Python 能够工作</p><pre class="kn ko kp kq gt mf mg mh mi aw mj bi"><span id="f99f" class="ky kz iq mg b gy mk ml l mm mn">which python /usr/bin/python</span></pre><p id="f569" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">按回车键</p><pre class="kn ko kp kq gt mf mg mh mi aw mj bi"><span id="1028" class="ky kz iq mg b gy mk ml l mm mn">source .bashrc</span></pre><h2 id="783c" class="ky kz iq bd la lb lc dn ld le lf dp lg jy lh li lj kc lk ll lm kg ln lo lp lq bi translated">配置带 Jupyter 的火花</h2><p id="8b34" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">在 EMR 命令提示符下键入以下每一行，并在每一行之间按 enter 键:</p><pre class="kn ko kp kq gt mf mg mh mi aw mj bi"><span id="3c6e" class="ky kz iq mg b gy mk ml l mm mn">export PYSPARK_DRIVER_PYTHON=jupyter</span><span id="bdd2" class="ky kz iq mg b gy mv ml l mm mn">export PYSPARK_DRIVER_PYTHON_OPTS='notebook --no-browser --port=8888'</span><span id="398a" class="ky kz iq mg b gy mv ml l mm mn">source .bashrc</span></pre><h2 id="58bc" class="ky kz iq bd la lb lc dn ld le lf dp lg jy lh li lj kc lk ll lm kg ln lo lp lq bi translated">在 EMR 命令提示符下键入 pyspark</h2><p id="f3b9" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">结果:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mw"><img src="../Images/e0829d31a67fcda4ca6b6e31dbd54815.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jDIvmGXahrKOKjqY"/></div></div><figcaption class="lx ly gj gh gi lz ma bd b be z dk">See that highlighted token? copy it.</figcaption></figure><h2 id="3a98" class="ky kz iq bd la lb lc dn ld le lf dp lg jy lh li lj kc lk ll lm kg ln lo lp lq bi translated">在网络浏览器中打开 Jupyter 笔记本</h2><p id="a421" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">在地址栏中键入以下内容:localhost:8880 <br/>结果:粘贴上一步中的令牌并登录的页面。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/5f63f1ee1002b4db3733010d16fff271.png" data-original-src="https://miro.medium.com/v2/resize:fit:1088/format:webp/1*zGoMTy6k2Ld8xdsxv1m99w.png"/></div></figure><p id="7210" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">耶！你做到了！</p><p id="a318" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，您可以在 Jupyter 笔记本中查看您的 spark 上下文:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi my"><img src="../Images/52471a611a1f63124f2cfd678e48ccfc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HpAJ3fInPXlaFp8d35nr1w.png"/></div></div></figure><h1 id="5cb3" class="mz kz iq bd la na nb nc ld nd ne nf lg ng nh ni lj nj nk nl lm nm nn no lp np bi translated">资源:</h1><p id="d8fb" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated"><a class="ae kl" href="https://medium.com/@alexjsanchez/python-3-notebooks-on-aws-ec2-in-15-mostly-easy-steps-2ec5e662c6c6" rel="noopener">https://medium . com/@ alexjsanchez/python-3-notebooks-on-AWS-ec2-in-15-mosely-easy-steps-2e C5 e 662 C6</a></p><p id="4058" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://medium.com/@Vatsal410/running-pyspark-on-an-aws-cluster-through-jupyter-notebook-fe28f6ef47a4" rel="noopener">https://medium . com/@ vats al 410/running-py spark-on-an-AWS-cluster-through-jupyter-notebook-Fe 28 f 6 ef 47 a 4</a></p><p id="09f8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Python 错误的版本错误:</p><p id="2b11" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" href="https://aws.amazon.com/premiumsupport/knowledge-center/emr-pyspark-python-3x/" rel="noopener ugc nofollow" target="_blank">https://AWS . Amazon . com/premium support/knowledge-center/EMR-pyspark-python-3x/</a></p></div></div>    
</body>
</html>