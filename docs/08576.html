<html>
<head>
<title>Using RandomForest to Predict Medical Appointment No-shows</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 RandomForest 预测医疗预约失约</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/using-randomforest-to-predict-medical-appointment-no-shows-b33575e3ff42?source=collection_archive---------27-----------------------#2019-11-19">https://towardsdatascience.com/using-randomforest-to-predict-medical-appointment-no-shows-b33575e3ff42?source=collection_archive---------27-----------------------#2019-11-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/49391552178ddfe48b3157e8c142b5e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*D3tGExP2prvShNv8"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@adhy?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Adhy Savala</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="8a15" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对医疗机构来说，失约或错过预约的患者很常见，而且代价高昂。美国一项研究发现，多达 30%的患者会错过他们的预约，每年因此损失 1500 亿美元。</p><p id="478f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">识别潜在的失约可以帮助医疗机构采取有针对性的干预措施(例如，提醒电话、重复预约预约时段)来减少失约和财务损失。</p><h1 id="62f8" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">资料组</h1><p id="6ee4" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated"><a class="ae kc" href="https://www.kaggle.com/joniarroba/noshowappointments" rel="noopener ugc nofollow" target="_blank"> Kaggle 数据集</a>包含了来自巴西一个城市的公共医疗机构的 11 万份预约记录。这些约会发生在 2016 年的 6 周内。</p><p id="1d7e" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">以下是数据集功能的总结:</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi me"><img src="../Images/250f7b3beb2cb7467d8d9e72ace946b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CJfIt8KHBlMC81XhEnebvQ.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Table summarising the dataset’s original variables</figcaption></figure><p id="8aaa" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">患者 id 是不唯一的，这表明同一患者在 6 周内有多次预约。为了避免数据泄露(如果将同一患者的数据用于验证和测试，就会发生这种情况)，我们将只在模型中包含患者的最新预约。</p><h1 id="49d1" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">数据清理</h1><p id="59e4" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">有两个主要的清洁步骤:</p><ol class=""><li id="1889" class="mj mk iq kf b kg kh kk kl ko ml ks mm kw mn la mo mp mq mr bi translated">二进制编码(1，0)失约，性别和障碍。我假设障碍应该是二进制的，因为它在 Kaggle 上有描述。</li><li id="7969" class="mj mk iq kf b kg ms kk mt ko mu ks mv kw mw la mo mp mq mr bi translated">删除逻辑不一致的观察结果，如负年龄，以及计划日期晚于预约日期。</li></ol><h1 id="4978" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">特征工程</h1><p id="1b57" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">特征工程用于记录日期时间特征，并保留从以前的约会(最近的约会之前的约会)中捕获的信息。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mx"><img src="../Images/3270fbe0ba1f80c2552ca3e7118275ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vSKOhAztjOQ-elLbbYpx_g.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">List of original dataset features and engineered features. Colours indicate the features from which the engineered features were created from.</figcaption></figure><p id="6984" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">通过从每个患者的失约和预约总数中分别减去 1 来计算先前失约和先前预约。</p><p id="8f49" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">计划日期和约会日期分为星期几(DoW)和月几。预定时间也被分成一天中的几个小时。</p><p id="5081" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">天数差是指预定日期和约会日期之间的天数差。</p><p id="baf1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">总病情是高血压、糖尿病、残疾和酒精中毒的总和。换句话说，它显示了病人所患疾病的数量。</p><h1 id="64e2" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">特征选择</h1><p id="74a2" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">特征是根据它们的<a class="ae kc" href="https://medium.com/@sundarstyles89/weight-of-evidence-and-information-value-using-python-6f05072e83eb" rel="noopener">信息值(IV) </a>选择的，这些信息值根据它们对目标的预测程度对特征进行排序和评分。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi my"><img src="../Images/fee4875750b66db29193679fe0f56405.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rtRLaJYc1xn2UhXVty8NRg.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Selected features and their Information Value (IV) scores.</figcaption></figure><p id="c6df" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">IV 分数&lt; 0.02(非常差的预测因子的阈值)的特征被丢弃。使用保守阈值有助于确保有用的特征不会过早地从模型中排除。</p><p id="e7a3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">事实证明，大多数特征对目标的预测能力很差。</p><p id="0ae5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">此外，还去除了 ID 特征、冗余特征和邻域。邻域被删除是因为我找不到关于它们的额外信息，而且在模型中包含 80 个虚拟变量是不可取的。</p><p id="e87c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在数据清理和特征选择之后，大约 62k 的观测值仍然存在。其中 20%没有出现。</p><h1 id="ffad" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">五重交叉验证</h1><p id="2a66" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">数据集被分成 20%的测试数据集和 80%的交叉验证数据集。</p><p id="1971" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">使用 5 个训练-验证折叠，数据适合四个监督学习算法:</p><ol class=""><li id="4ff9" class="mj mk iq kf b kg kh kk kl ko ml ks mm kw mn la mo mp mq mr bi translated">逻辑回归</li><li id="73ce" class="mj mk iq kf b kg ms kk mt ko mu ks mv kw mw la mo mp mq mr bi translated">朴素贝叶斯</li><li id="13e8" class="mj mk iq kf b kg ms kk mt ko mu ks mv kw mw la mo mp mq mr bi translated">k-最近邻(KNN)</li><li id="467f" class="mj mk iq kf b kg ms kk mt ko mu ks mv kw mw la mo mp mq mr bi translated">随机森林</li></ol><p id="70c4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">RandomCVSearch (5 倍，10 次迭代，50 次拟合)用于调整 KNN 和随机森林的超参数。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mz"><img src="../Images/64368ce00c1e804e65b4b7e50b2dba0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cTQ9hSrNuVMbvIC3sXghuw.png"/></div></div></figure><p id="e521" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">根据模型的平均准确性和受试者工作特征曲线下面积(ROC AUC)评分对模型进行评估。</p><p id="3eeb" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">不幸的是，这些型号的性能相似，我无法选择最佳型号。</p><p id="d13d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="na">注意:我没有使用 F1 分数，因为它取决于所选的分类阈值，我打算在选择模型后对其进行调整。我使用 ROC AUC 评分和准确性，因为我想要最好的模型，而不考虑阈值。</em></p><h1 id="d6ff" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">使用更多数据进行验证。</h1><p id="c94d" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">由于交叉验证对模型选择没有用，用于训练和验证的 80%被重新分成 60%训练和 20%验证。(以前交叉验证使用 64%用于训练，16%用于每个折叠的验证)。希望有一个更大的验证集会使模型之间的差异更加明显。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nb"><img src="../Images/4f6ed9e86790f450b21dfb39ddee90ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*15XVpZMtqF-ARLf1upZKQw.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Graph depicting models’ ROC curves, and table of models’ accuracy scores</figcaption></figure><p id="dc51" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">从 ROC 曲线分析，我们可以看到 RandomForest 优于其他算法。它的精确度也与其他的相当。我们将使用 RandomForest 作为未来的模型。</p><h1 id="f105" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">调整分类阈值</h1><p id="a901" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">RandomForest 的分类阈值是基于这样的假设进行调整的，即医疗机构希望在大规模推广干预措施之前对其进行测试。因此，精确度优先于回忆。</p><p id="aba3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我选择的阈值是 0.38，因为这大约是两条曲线逐渐变细的时间。这个阈值意味着 74%的时间(精确度)可以正确识别未出现者，并且大约四分之一的未出现者可以被识别(回忆)。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nc"><img src="../Images/77e580814712842f8aa6179b2131ee5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v65xI-wl_X-3CBFFCinsJg.png"/></div></div></figure><h1 id="ae8a" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">测试</h1><p id="2e2f" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">使用 80%的数据重新训练该模型，并对剩余的 20%进行测试。</p><p id="545b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">测试分数与验证分数相似，这表明该模型概括得很好。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nd"><img src="../Images/11ee81003f6782f764bba5a0bac76255.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CKh6ZftW4yEb6tUHwdKznA.png"/></div></div></figure><h1 id="6fd2" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">近距离观察 RandomForest</h1><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/5cfb8cfd5157d7afdb1976304ca140f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1046/format:webp/1*vF2oHB0DWhr5zroNds0XAg.png"/></div></figure><p id="5c85" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">RandomForest 的特征重要性表明，时差和先前的未出现在预测未出现中是重要的。</p><figure class="mf mg mh mi gt jr gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/1b46dd9abce23cc2324e6ab1786979f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:750/format:webp/1*sDaGqkpcMfXNgOOlkRZ2SA.png"/></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Histograms depicting the differences in distributions for shows and no-shows, for prior no shows and day difference.</figcaption></figure><p id="738c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">特别是，失约者的预定日期和约定日期之间的差异更大，而且有失约的历史。</p><p id="1993" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">特征重要性的知识对于选择干预措施是有用的。例如，那些提前预约的病人可能会忘记他们的预约。一个可能的干预措施是建立更多的个人患者接触点(例如电话，因为短信似乎没有效果)。</p><p id="50ae" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">另一方面，对于有失约史的患者来说，原因可能更习惯性。如果机构无法说服这些病人出现，重复预约他们的位置可能是一个可行的解决方案。</p><h1 id="b5d6" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="16f6" class="pw-post-body-paragraph kd ke iq kf b kg lz ki kj kk ma km kn ko mb kq kr ks mc ku kv kw md ky kz la ij bi translated">总之，似乎可以从患者信息和预约数据中预测失约。更多关于诊所位置(如交通便利)、寻求的护理类型(如初级、专科)和患者(如教育、收入)的信息可能会改进模型。该模型还可以受益于对可能的干预措施的成本效益分析，以实现最具商业意义的精确度和召回率之间的平衡。</p><p id="9aa0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="na">* * *查看我的</em><a class="ae kc" href="https://github.com/adelweiss/MedicalAppt" rel="noopener ugc nofollow" target="_blank"><em class="na">GitHub</em>T5】上的代码</a></p></div></div>    
</body>
</html>