<html>
<head>
<title>Python and Google APIs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python 和 Google APIs</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/python-and-google-apis-bd9b5a861edd?source=collection_archive---------16-----------------------#2019-10-22">https://towardsdatascience.com/python-and-google-apis-bd9b5a861edd?source=collection_archive---------16-----------------------#2019-10-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9a03" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">或者如何让网上的数据变得有用。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/010f42033be193df093f18dca02b0d40.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ezxbn1dpcCZRTATuWB_pvQ.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Simple structure</figcaption></figure><p id="1be5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在这个简单的指南中，你将学会使用<a class="ae lu" href="https://cloud.google.com" rel="noopener ugc nofollow" target="_blank">谷歌云平台</a>及其 API 从网络上收集一些数据。要使用 python，你可以在<a class="ae lu" href="https://repl.it/languages/python3" rel="noopener ugc nofollow" target="_blank">这个网页</a>上运行本文的代码，在线免费，不需要安装任何东西。无论如何，如果你想更深入，成为 python 专家，我们推荐你安装<a class="ae lu" href="https://www.anaconda.com/distribution/" rel="noopener ugc nofollow" target="_blank"> Anaconda </a>。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="ca81" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">但首先，一些基本的概念，所以我们都在同一点上。你需要知道什么是 API，什么是 JSON。</p><p id="da89" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们从更简单的开始:JSON 就是一种在文本中组织信息的方式，这样许多编程语言，特别是 JavaScript 和其他许多语言，都可以阅读和理解这些信息。典型的 JSON 使用<strong class="la iu"> " <em class="mc"> key": "value" </em> </strong>格式。下面是一个 JSON 对象的例子:</p><pre class="kj kk kl km gt md me mf mg aw mh bi"><span id="7c6a" class="mi mj it me b gy mk ml l mm mn">{<br/>'image': 'King.jpg',<br/>'firstname': 'John',<br/>'lastname': 'Snow',<br/>'company': 'Dragons Inc.'<br/>}<br/>...</span></pre><p id="074f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在我们知道了，什么是 API？嗯，API 代表应用编程接口。我理解这些词的意思的方式是，当一些(软件)开发者制作了一个非常酷的程序/应用程序时，他们有时会认为其他开发者可能也想使用它，或者至少是它的一些部分，所以他们创建了 API——程序的一部分，你可以与之交互。简言之，API 或多或少等同于程序，但是你可以在脚本中使用它。有许多免费使用的 API，但也有许多其他的不是。</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="cfd6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在要开始使用谷歌 API，你必须去<a class="ae lu" href="https://cloud.google.com" rel="noopener ugc nofollow" target="_blank">谷歌云平台</a>并创建一个免费账户。这些步骤非常简单，所以我将跳过它们，但是在您完成这些步骤后，当您点击您的 Google 控制台时，您应该会看到类似以下内容:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mo"><img src="../Images/66ba1fa01a58c4e565a231b65d47d84d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7cxpf_S8MDGbFq1E1-d8TA.png"/></div></div></figure><p id="d059" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，如果您点击左侧的<strong class="la iu">三栏</strong>图标、<strong class="la iu">API 和服务</strong>以及<strong class="la iu">库</strong>，您将会看到 Google 提供的所有 API。为简单起见，我们将重点关注与谷歌地图相关的内容，但我们鼓励您探索和尝试任何其他引起您注意的内容。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mp"><img src="../Images/cefdc546326c1a5fbafe1e6fbe489c67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CJ39DSAkAEl606fofOurDQ.png"/></div></div></figure><p id="5131" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">一旦我们点击<strong class="la iu">地图</strong>部分右侧的<strong class="la iu">查看全部</strong>，我们就可以看到与<a class="ae lu" href="https://www.google.com/maps" rel="noopener ugc nofollow" target="_blank">谷歌地图</a>相关的所有 API，所以让我们使用<strong class="la iu">距离矩阵 API。</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mq"><img src="../Images/f5a503378f68a233f0793aabb68be92d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NMB-c3RbbvRWGBMSsCOlOQ.png"/></div></div></figure><p id="af99" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">确保您启用了 API。如果没有，只需点击启用，你就可以走了。之后，点击<strong class="la iu">文档</strong>，因为这里有你学习这个 API 如何工作所需要的所有信息。</p><p id="beee" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">一旦进入<strong class="la iu">文档</strong>，点击左侧打开<strong class="la iu">开发者指南</strong>。请注意，这些步骤对于所有的 API 都是相同的。</p><p id="7a75" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在我们需要两样东西:我们必须构建的<strong class="la iu"> API 键</strong>和<strong class="la iu"> url </strong>。你会在左边的<strong class="la iu">三栏</strong>图标上找到你的<strong class="la iu"> API 密匙</strong>、API&amp;服务、<strong class="la iu">凭证</strong>。现在让我们开始构建<strong class="la iu"> url </strong>，这有点复杂。所有的 API 的工作方式大致相同，你构建一个<strong class="la iu"> url </strong>并用你的<strong class="la iu"> API 键</strong>发送它来请求一些信息，然后你捕获这些信息。需要构建 url 的方式在 API 的开发人员文档中指定。在我们的例子中，我们的 url 将如下所示:</p><pre class="kj kk kl km gt md me mf mg aw mh bi"><span id="3820" class="mi mj it me b gy mk ml l mm mn">https://maps.googleapis.com/maps/api/distancematrix/<strong class="me iu">outputFormat</strong>?<strong class="me iu">parameters</strong></span></pre><p id="072a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">其中<em class="mc"> outputFormat </em>需要更改为其中一个选项，要么是<em class="mc"> json </em>(推荐的)，要么是<em class="mc"> xml </em>，API 接受的参数在下面指定，在我们的例子中是我们想要获得距离的<em class="mc">起点</em>和<em class="mc">目的地</em>点，表示为<code class="fe mr ms mt me b">latitude,longitude</code>，最后是指向 Maps API 实例的<em class="mc">键</em>参数。通常你必须构建一个<strong class="la iu"> url </strong>的字符串，用一个<em class="mc"> &amp; </em>将<em class="mc">参数</em>分开，但幸运的是<em class="mc"> python </em>用一个<code class="fe mr ms mt me b">requests</code>包覆盖了我们的背部，这个包会自动将参数添加到 url 中。所以如果你去 to <a class="ae lu" href="https://repl.it/languages/python3" rel="noopener ugc nofollow" target="_blank"> Repl </a>粘贴下面的代码，你会得到这些点之间的距离。确保使用上一步中获得的 API 密钥来更改<strong class="la iu"> API 密钥。</strong></p><pre class="kj kk kl km gt md me mf mg aw mh bi"><span id="78ac" class="mi mj it me b gy mk ml l mm mn">import json<br/>import requests</span><span id="97f5" class="mi mj it me b gy mu ml l mm mn">params = {<br/>'key': 'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX',<br/>'origins': '40.398585,-3.683520',<br/>'destinations': '40.419643,-3.688804'<br/>}</span><span id="0890" class="mi mj it me b gy mu ml l mm mn">url ='https://maps.googleapis.com/maps/api/distancematrix/json?'</span><span id="06b2" class="mi mj it me b gy mu ml l mm mn">response = requests.get(url,params)<br/>print(response.status_code == 200)</span><span id="a1df" class="mi mj it me b gy mu ml l mm mn">print(response.text)<br/>result = json.loads(response.text)</span></pre><p id="5a4f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">请注意，我们改变了<em class="mc">输出格式</em>，在我们的例子中，我们使用了坐标，但是正如文档所指出的，还有其他的可能性。尝试将<code class="fe mr ms mt me b">origins</code>和<code class="fe mr ms mt me b">destinations</code>坐标更改到不同的位置，并查看输出。运行代码后，您应该会看到类似下面的内容:</p><pre class="kj kk kl km gt md me mf mg aw mh bi"><span id="ca70" class="mi mj it me b gy mk ml l mm mn">{<br/>   "destination_addresses" : [ "Calle de Alfonso XII, 0, 28001 Madrid, Spain" ],<br/>   "origin_addresses" : [ "Calle de Alpedrete, 51, 28045 Madrid, Spain" ],<br/>   "rows" : [<br/>      {<br/>         "elements" : [<br/>            {<br/>               "distance" : {<br/>                  "text" : "3.0 km",<br/>                  "value" : 3027<br/>               },<br/>               "duration" : {<br/>                  "text" : "8 mins",<br/>                  "value" : 495<br/>               },<br/>               "status" : "OK"<br/>            }<br/>         ]<br/>      }<br/>   ],<br/>   "status" : "OK"<br/>}</span></pre><p id="8fe1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在让我们添加一些代码解释:第一部分导入用于获取 API 信息的 python 包，接下来我们定义 url 的参数和 url 本身，之后我们在<code class="fe mr ms mt me b">requests</code>包中使用<code class="fe mr ms mt me b">get</code>函数，给它 url 和参数来检索信息。我们还添加了一个检查来验证一切正常(如果代码是 200，它就是)。最后，我们打印得到的信息，并将其转换为 python 字典，这是一个与 JSON 非常相似的 python 对象，但区别在于 python 可以更容易地访问它的键。现在请注意<code class="fe mr ms mt me b">[ ]</code>和<code class="fe mr ms mt me b">{ }</code>在输出中的不同用法。这里我们使用方括号为一个<strong class="la iu">键</strong>创建一个<strong class="la iu">值</strong>列表，并用花括号嵌套那些<strong class="la iu">键</strong>。</p><p id="35f4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">您可以尝试访问字典中的一个键。只要在控制台<code class="fe mr ms mt me b">result['destination_addresses']</code>上键入，你就会得到存储在那个键里的信息(值)。</p><p id="88ad" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在本指南中，我们使用了 Distance Matrix API，因为它易于使用和理解，但您也可以使用其他工具来获取方向、海拔、地点信息，还有其他与谷歌分析、谷歌云架构甚至机器学习相关的工具！</p><p id="9dca" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我希望这篇指南能帮助你理解 API 是多么的简单易用和强大，并给你一些在未来的项目中如何组合它们的想法。如果你有任何想分享的问题或想法，请在评论中告诉我。</p></div></div>    
</body>
</html>