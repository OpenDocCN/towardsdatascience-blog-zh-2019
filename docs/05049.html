<html>
<head>
<title>36 Ways Pytorch Lightning Can Supercharge Your AI Research</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Pytorch 闪电的 36 种方式可以增强你的人工智能研究</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/supercharge-your-ai-research-with-pytorch-lightning-337948a99eec?source=collection_archive---------14-----------------------#2019-07-29">https://towardsdatascience.com/supercharge-your-ai-research-with-pytorch-lightning-337948a99eec?source=collection_archive---------14-----------------------#2019-07-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/0fd284f34ef3a05eef9e73dd5b5718e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*4N0scHe4i0_HaNYXOtT2Hg.gif"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk">Come at me AGI</figcaption></figure><p id="c1c5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">AGI 不会自己解决问题(在内心深处你知道我们是另一个人工智能的 AGI🤯).</p><p id="25c5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">但是让我们假设它做到了…</p><p id="9245" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">想象一下，翻开你的笔记本电脑，你会发现一个为你编写的这样的算法。</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="0390" class="lf lg iq lb b gy lh li l lj lk">def AGI(data):<br/>    data = clean(data)<br/>    agi = magic(data)<br/>    return agi</span></pre><p id="3470" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">嗯好的🤔。让我们看看这是怎么回事。你说服你的研究小组你需要对此进行一些试验。</p><p id="9601" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">但是 obvs 这不会像写的那样运行。首先，我们需要一个训练循环:</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="28bf" class="lf lg iq lb b gy lh li l lj lk">for epoch in range(10):<br/>    for batch in data:<br/>        agi = AGI(batch)<br/>        agi.backward()<br/>        ...</span></pre><p id="8c95" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">好了，现在我们算是训练了。但是我们仍然需要添加一个验证循环…</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="56c6" class="lf lg iq lb b gy lh li l lj lk">def validate(dataset):<br/>   # more magic</span></pre><p id="500f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">毒品。但是 LOL AGI 在一个 CPU 上？</p><p id="67ee" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你想得美。</p><p id="3c3a" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">让我们在多个 GPU 上运行这个…但是等等，你也已经<a class="ae ll" rel="noopener" target="_blank" href="/9-tips-for-training-lightning-fast-neural-networks-in-pytorch-8e63a502f565">读到过</a>16 位可以加速你的训练。天哪，但是有 3 种方法可以进行 GPU 分布式训练。</p><p id="7682" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">所以你花了一周的时间编写代码。但是仍然很慢，所以您决定使用计算集群。现在事情变得有点复杂了。</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/0253cf9791744d713ca7dc352d902ce6.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*MDDJL7yRKtlyLWG1GDS6Hw.gif"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk">Sad times</figcaption></figure><p id="85d9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">与此同时，你的 AGI 有一个 bug，但你不确定这是你的 GPU 分配代码，还是你如何加载你的数据，或者其他任何你可能编码错误的事情。</p><p id="21b6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你决定你不太想处理所有的训练细节，你尝试 Keras，但是它不能让你很好地实现 AGI 函数，因为你需要对训练有更多的控制。Fast.ai 也是不可能的，因为这不是现成的算法。</p><p id="5f77" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">好吧，那太糟糕了，现在你已经自己编码了…</p><p id="f0a9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">没有。</p></div><div class="ab cl lm ln hu lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="ij ik il im in"><h1 id="88a2" class="lt lg iq bd lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp bi translated">Pytorch 闪电</h1><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/9f48d9bc577bc4c8fa56dea7e7fe577b.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/1*C3VAuvscWbc39twNyPwSNQ.gif"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk">How you feel when running a single model on 200 GPUs</figcaption></figure><p id="994f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae ll" href="https://github.com/williamFalcon/pytorch-lightning" rel="noopener ugc nofollow" target="_blank"> Pytorch Lightning </a>已经为你编写了所有这些代码，包括<a class="ae ll" href="https://travis-ci.org/williamFalcon/pytorch-lightning" rel="noopener ugc nofollow" target="_blank">测试</a>到<strong class="ka ir">保证</strong>程序的那部分没有错误。</p><p id="8c66" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这意味着你可以专注于研究的核心，而不必担心所有繁琐的工程细节，如果你不必专注于核心研究理念，处理这些细节会很有趣。</p><p id="bf4f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这里有一个清晰的图表，显示了什么是自动化的。灰色部分是自动化的，通过教练旗控制。你可以使用你想要的任何底层模型(你自己的、预训练的东西、fast.ai 架构等等)，将蓝色部分定义为你想要的任意复杂。</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="ms mt di mu bf mv"><div class="gh gi mr"><img src="../Images/bde86d83846ddb89e160740f03ef469f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5H6pJX8pejhywN72WsDogQ.jpeg"/></div></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk">You own the blue. Lightning owns the rest.</figcaption></figure><h1 id="cf83" class="lt lg iq bd lu lv mw lx ly lz mx mb mc md my mf mg mh mz mj mk ml na mn mo mp bi translated">闪电模型</h1><p id="8173" class="pw-post-body-paragraph jy jz iq ka b kb nb kd ke kf nc kh ki kj nd kl km kn ne kp kq kr nf kt ku kv ij bi translated">Lightning 的核心是两件事，一个 LightningModel，一个 Trainer。LightningModel 是你 90%的时间花在这里的地方。</p><figure class="kw kx ky kz gt jr"><div class="bz fp l di"><div class="ng nh l"/></div><figcaption class="ju jv gj gh gi jw jx bd b be z dk">Lightning Module Template</figcaption></figure><p id="97b4" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">请注意，您正在定义培训循环中发生的事情</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="0b07" class="lf lg iq lb b gy lh li l lj lk">for epoch in range(10):<br/>    for batch in data:<br/>      # training_step above is what happens here<br/>      # lightning handles the rest (backward, gradient clip, etc...)</span></pre><p id="825d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">验证也是一样</p><pre class="kw kx ky kz gt la lb lc ld aw le bi"><span id="96c1" class="lf lg iq lb b gy lh li l lj lk">for val_batch in data:<br/>    # validation_step above is what happens here<br/>    # with no grad, eval, etc... all handled for you automatically</span></pre><p id="5af1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">上面这两个函数会变得非常复杂。事实上，您可以在这两个函数中定义一个完整的 transformer，seq-2-seq，fairseq 模型。</p><h1 id="997d" class="lt lg iq bd lu lv mw lx ly lz mx mb mc md my mf mg mh mz mj mk ml na mn mo mp bi translated"><strong class="ak">培训师</strong></h1><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div class="gh gi jn"><img src="../Images/0208d0f54ddf816a1ba975f9ab04ad42.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*LHGfN-Ws1Cq0Wsyr5BLYGg.gif"/></div></figure><p id="c767" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">培训师处理您不想编码的东西的所有核心逻辑，但是您需要保证它被正确地完成并且使用最新的最佳实践。</p><figure class="kw kx ky kz gt jr"><div class="bz fp l di"><div class="ng nh l"/></div></figure><p id="9971" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">只需设置几个标志，你就可以在 CPU、<a class="ae ll" href="https://williamfalcon.github.io/pytorch-lightning/Trainer/Distributed%20training/#Multi-GPU" rel="noopener ugc nofollow" target="_blank">多 GPU</a>或<a class="ae ll" href="https://williamfalcon.github.io/pytorch-lightning/Trainer/Distributed%20training/#Multi-node" rel="noopener ugc nofollow" target="_blank">多节点</a>集群上训练你的 AGI。不仅如此，您还可以启用<a class="ae ll" href="https://williamfalcon.github.io/pytorch-lightning/Trainer/Training%20Loop/#gradient-clipping" rel="noopener ugc nofollow" target="_blank">渐变裁剪</a>、<a class="ae ll" href="https://williamfalcon.github.io/pytorch-lightning/Trainer/Training%20Loop/#accumulated-gradients" rel="noopener ugc nofollow" target="_blank">累积渐变</a>、<a class="ae ll" href="https://williamfalcon.github.io/pytorch-lightning/Trainer/Distributed%20training/#16-bit-mixed-precision" rel="noopener ugc nofollow" target="_blank"> 16 位精度</a>、<a class="ae ll" href="https://williamfalcon.github.io/pytorch-lightning/Trainer/Distributed%20training/#Multi-node" rel="noopener ugc nofollow" target="_blank">自动聚类保存</a>、<a class="ae ll" href="https://williamfalcon.github.io/pytorch-lightning/Trainer/Logging/#save-a-snapshot-of-all-hyperparameters" rel="noopener ugc nofollow" target="_blank">超参数快照</a>、<a class="ae ll" href="https://williamfalcon.github.io/pytorch-lightning/Trainer/Logging/#tensorboard-support" rel="noopener ugc nofollow" target="_blank">张量板可视化</a>等</p><p id="e8cc" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你明白了。</p><p id="6370" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">你不仅可以获得训练人工智能系统的最新和最棒的技巧，还可以保证它们能够正常工作并且经过正确的测试。</p><p id="a478" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这意味着你只需要担心你的部分——新算法——是否正确。如何加载数据以及在培训的核心部分做些什么由你决定。</p><p id="1a8f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">那么，Pytorch 闪电的 36 种帮助方式呢？大约有 36 个你通常自己实现的东西可能会有 bug。Lightning 会做并测试它，所以您不必这样做！</p><p id="1a37" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">点击这里查看完整列表</p></div><div class="ab cl lm ln hu lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="ij ik il im in"><p id="5090" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">恭喜你。你可以利用刚刚回来的所有空闲时间来完成你正在做的兼职项目(可能是你小狗的聊天机器人，或者是优步的瑜伽裤)。</p><figure class="kw kx ky kz gt jr gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/a6f759fb705079bef4540552beabb169.png" data-original-src="https://miro.medium.com/v2/resize:fit:490/1*PUAxRGV81dfsph3ByTxj5w.gif"/></div></figure></div></div>    
</body>
</html>