<html>
<head>
<title>Taking Google Sheets to (a) Class.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">带着谷歌床单去上课。</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/taking-google-sheets-to-a-class-47f7f5f4ed98?source=collection_archive---------17-----------------------#2019-03-17">https://towardsdatascience.com/taking-google-sheets-to-a-class-47f7f5f4ed98?source=collection_archive---------17-----------------------#2019-03-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="7080" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我目前正在为教师构建一个 Flask 应用程序。由于谷歌驱动已经被老师们采用，谷歌表单也被他们使用。我的应用程序的一个功能是允许教师轻松地将工作表链接复制并粘贴到应用程序中，并通过表单提交。然后，它会将其转换为 pandas 数据框，并删除空行和空列。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ko"><img src="../Images/28247afc5c457ed21b63e6144936111c.png" data-original-src="https://miro.medium.com/v2/resize:fit:570/format:webp/0*TDvI2wLl5V0FRxkI.jpg"/></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk">Google Sheets Icon</figcaption></figure><p id="d03d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这是一项正在进行中的工作，但是我想分享到目前为止制作的类，因为我没有找到很多用于数据收集或预处理的 Python 类示例。我所看到的许多例子对于教授类的概念是有用的。但是大多数时候它们对于数据科学或者 ML 来说不够实用或者不够具体。毕竟，我们总是可以使用更实际的 Python 类的例子。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi la"><img src="../Images/26552671b76e6cd3e3a17ecf33bba5b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*iEte23ZZ9uOK7VUV.jpg"/></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk">See, Yoda knows. (Self-made on imgflip.com)</figcaption></figure><h1 id="dd0a" class="lb lc it bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">但是你为什么需要一门课呢？你就不能写代码就 ok 了吗？</h1><p id="a2d0" class="pw-post-body-paragraph jq jr it js b jt lz jv jw jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn im bi translated">如果这是为了分析的目的，那么…是的。但是生产代码，据我所知，遵循的是面向对象的编程方法。这意味着您的代码在脚本之间是分开的。这些脚本主要由类和函数组成。以这种方式编写的代码也更容易重用于其他目的。以我在本帖中使用的 ecdf 函数为例。</p><div class="me mf gp gr mg mh"><a rel="noopener follow" target="_blank" href="/data-science-code-refactoring-example-14c3ec858e0c"><div class="mi ab fo"><div class="mj ab mk cl cj ml"><h2 class="bd iu gy z fp mm fr fs mn fu fw is bi translated">数据科学代码重构示例</h2><div class="mo l"><h3 class="bd b gy z fp mm fr fs mn fu fw dk translated">当学习为数据科学编码时，我们通常不会考虑修改我们的代码来获得特定的…</h3></div><div class="mp l"><p class="bd b dl z fp mm fr fs mn fu fw dk translated">towardsdatascience.com</p></div></div><div class="mq l"><div class="mr l ms mt mu mq mv ku mh"/></div></div></a></div><p id="8f8d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">有了这个函数，您可以立即快速重现这个图，而不是一遍又一遍地重新键入相同的 matplotlib 模板代码。</p><h1 id="6a68" class="lb lc it bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">太好了！给我看看你的例子！</h1><p id="e2bb" class="pw-post-body-paragraph jq jr it js b jt lz jv jw jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn im bi translated">当然啦！我将分块分享这个例子，并解释每一部分。</p><pre class="kp kq kr ks gt mw mx my mz aw na bi"><span id="6df3" class="nb lc it mx b gy nc nd l ne nf"># Import necessary libraries<br/>import gspread<br/>import pandas as pd<br/>from gspread_dataframe import get_as_dataframe<br/>from oauth2client.service_account import ServiceAccountCredentials</span></pre><p id="96ac" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">是用来处理我们的 Google 表单的输入和操作的库。我们将使用<a class="ae nj" href="http://pandas.pydata.org/pandas-docs/stable/" rel="noopener ugc nofollow" target="_blank">熊猫</a>来删除工作表中所有的空行和空列。gspread-dataframe 是我们将表格转换成数据框的关键库。最后，oauth2client 是 gspread 建议用来认证我们的凭证的库。如果您不熟悉这种类型的认证，您可以在这里<a class="ae nj" href="https://gspread.readthedocs.io/en/latest/oauth2.html" rel="noopener ugc nofollow" target="_blank">看到它是如何执行的</a>。</p><pre class="kp kq kr ks gt mw mx my mz aw na bi"><span id="aa26" class="nb lc it mx b gy nc nd l ne nf"># Create class name and init function<br/>class GoogleSheetProcessor:<br/><br/>    def __init__(self):<br/>        self.scope = ['https://spreadsheets.google.com/feeds', 'https://www.googleapis.com/auth/drive']<br/>        self.credentials = ServiceAccountCredentials.from_json_keyfile_name(<br/>                                                      'Credentials.json', self.scope)<br/>        self.gc = gspread.authorize(self.credentials)</span></pre><p id="931a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">首先，我们给我们的班级命名。根据<a class="ae nj" href="https://www.python.org/dev/peps/pep-0008/#class-names" rel="noopener ugc nofollow" target="_blank">约定</a>，使用 CapWords 约定命名类。在这里，我们创建 init 函数来告诉这个类设置分配给这个类的变量。在我们的例子中，我们将让类初始化认证 credentials.json 文件所需的三个变量。</p><pre class="kp kq kr ks gt mw mx my mz aw na bi"><span id="5c88" class="nb lc it mx b gy nc nd l ne nf"># Get google sheet method<br/>def obtain_google_sheet(self, link):<br/>    sheet = self.gc.open_by_url(link)<br/>    sheet = sheet.get_worksheet(0)<br/>    return sheet</span></pre><p id="6a58" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这里我们创建了一个方法(也就是类的函数),它将 Google sheet 链接作为一个参数。然后，它使用我们的实例<code class="fe ng nh ni mx b">self.gc</code>获取链接，然后获取 Google sheet 文件中的第一个工作表。最后，它返回我们想要的工作表作为<code class="fe ng nh ni mx b">sheet</code>。</p><pre class="kp kq kr ks gt mw mx my mz aw na bi"><span id="b751" class="nb lc it mx b gy nc nd l ne nf"># Convert sheet to data frame and drop unnecessary rows and columns<br/>@staticmethod<br/>def worksheet_to_df(worksheet):<br/>    # adjust input so nan rows and columns are not imported<br/>    df = get_as_dataframe(worksheet, parse_dates=True, header=0)<br/>    df.dropna(axis='columns', how='all', inplace=True)<br/>    df.dropna(axis='rows', how='all', inplace=True)<br/>    return df</span></pre><p id="2cf1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们的第二种方法将一个工作表作为输入，并将其转换成 pandas 数据框。它有<code class="fe ng nh ni mx b"><a class="ae nj" href="https://www.geeksforgeeks.org/class-method-vs-static-method-python/" rel="noopener ugc nofollow" target="_blank">@staticmethod</a></code>类装饰器，因为我们不需要将类实例<code class="fe ng nh ni mx b">self </code>作为参数来使用它。然后，我们使用熊猫<code class="fe ng nh ni mx b">dropna</code>数据框方法删除不包含任何值的行和列。</p><p id="9670" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在让我们退后一步，把整个班级作为一个整体来欣赏。</p><pre class="kp kq kr ks gt mw mx my mz aw na bi"><span id="df5e" class="nb lc it mx b gy nc nd l ne nf"># Create class name and init function<br/>class GoogleSheetProcessor:<br/><br/>    def __init__(self):<br/>        self.scope = ['https://spreadsheets.google.com/feeds', 'https://www.googleapis.com/auth/drive']<br/>        self.credentials = ServiceAccountCredentials.from_json_keyfile_name(<br/>                                                      'Credentials.json', self.scope)<br/>        self.gc = gspread.authorize(self.credentials)</span><span id="03ed" class="nb lc it mx b gy nk nd l ne nf"># Get google sheet method<br/>def obtain_google_sheet(self, link):<br/>    sheet = self.gc.open_by_url(link)<br/>    sheet = sheet.get_worksheet(0)<br/>    return sheet</span><span id="e070" class="nb lc it mx b gy nk nd l ne nf"># Convert sheet to data frame and drop unnecessary rows and columns<br/>@staticmethod<br/>def worksheet_to_df(worksheet):<br/>    # adjust input so nan rows and columns are not imported<br/>    df = get_as_dataframe(worksheet, parse_dates=True, header=0)<br/>    df.dropna(axis='columns', how='all', inplace=True)<br/>    df.dropna(axis='rows', how='all', inplace=True)<br/>    return df</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/4188c885025c176a43f174f6a55a73cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1224/format:webp/0*F28mJ42Vo-y2t7px.jpg"/></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk">It’s possible! (Self-made from imgflip.com)</figcaption></figure><h1 id="e28d" class="lb lc it bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">那么如何使用这个类呢？</h1><p id="ad6c" class="pw-post-body-paragraph jq jr it js b jt lz jv jw jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn im bi translated">我用它作为一个烧瓶表单的处理的一部分。下面是利用我们的类的路由功能。</p><pre class="kp kq kr ks gt mw mx my mz aw na bi"><span id="91a1" class="nb lc it mx b gy nc nd l ne nf">@app.route('/upload/&lt;email&gt;', methods=['GET', 'POST'])<br/>@login_required<br/>def upload(email):<br/>    user = User.query.filter_by(email=email).first_or_404()<br/>    form = DataInputForm()<br/>    if form.validate_on_submit():<br/>        if form.google_sheet.data is None and form.excel_sheet.data is None:<br/>            flash('Form Empty. Please enter a Google Sheet link or load an Excel file')<br/>            return redirect(url_for('upload'))<br/><br/>        elif form.google_sheet.data and form.excel_sheet.data:<br/>            flash('Cannot Submit Both Form Types. Only Google Sheet OR Excel File')<br/>            return redirect(url_for('upload'))<br/><br/>        elif form.google_sheet.data:<br/>            gp = GoogleSheetProcessor()<br/>            data = gp.obtain_google_sheet(form.google_sheet.data)<br/>            data = gp.worksheet_to_df(data)<br/><br/>        flash('Upload Successful')<br/>        return render_template('dashboard.html', data=data)<br/>    return render_template('upload.html', title='Data_Upload', user=user, form=form)</span></pre><p id="9cc9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你不熟悉<a class="ae nj" href="http://flask.pocoo.org/" rel="noopener ugc nofollow" target="_blank">砂箱</a>或<a class="ae nj" href="https://flask-wtf.readthedocs.io/en/stable/" rel="noopener ugc nofollow" target="_blank">砂箱形式</a>，这可能会让人感到困惑。让我们把重点放在实现类的部分。</p><pre class="kp kq kr ks gt mw mx my mz aw na bi"><span id="3c09" class="nb lc it mx b gy nc nd l ne nf">elif form.google_sheet.data:<br/>    gp = GoogleSheetProcessor()<br/>    data = gp.obtain_google_sheet(form.google_sheet.data)<br/>    data = gp.worksheet_to_df(data)</span></pre><p id="2f67" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在我们初始化这个类之后，我们将工作表分配给变量<code class="fe ng nh ni mx b">data</code>。<code class="fe ng nh ni mx b">form.google_sheet.data</code>是应用程序从之前在路线功能中启动的<code class="fe ng nh ni mx b">DataInputForm</code>获取输入链接的地方。然后链接被传递到我们的<code class="fe ng nh ni mx b">worksheet_to_df</code>方法中进行转换和精简。</p><h1 id="d83c" class="lb lc it bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">我注意到有<code class="fe ng nh ni mx b">form.excel_sheet.data in your route function</code>。你用 Excel 文件做什么？</h1><p id="8f01" class="pw-post-body-paragraph jq jr it js b jt lz jv jw jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn im bi translated">这实际上是部分完成的路由功能。我现在不能透露太多，但将有教师上传 Excel 文件的功能。一旦 MVP 版本的应用程序推出，我会写更多与此类相关的文章。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="nn no di np bf nq"><div class="gh gi nm"><img src="../Images/a3c32bb21cb725bc67c8e8b11dc65f16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*V16Af99aiOVI8Igd.jpg"/></div></div><figcaption class="kw kx gj gh gi ky kz bd b be z dk">Picture by <a class="ae nj" href="https://www.flickr.com/photos/damongman/with/6274878152/" rel="noopener ugc nofollow" target="_blank">DaMongMan</a> on Flickr</figcaption></figure><h1 id="f613" class="lb lc it bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">走之前最后一个想法…</h1><p id="abff" class="pw-post-body-paragraph jq jr it js b jt lz jv jw jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn im bi translated">写作课会让人望而生畏。如果你正在学习成为一名数据科学家或分析师，这不是一个常见的概念。甚至编写函数的想法看起来都很可怕。但是你可以做到，这是一个有用的技能。</p><p id="76dd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果您至少可以构建函数，那么您就可以为您的可视化和 ML 模型减少一些重复的代码编写。更好的是，如果你的模型将被集成到一个产品中，当你的工程师将你的代码添加到他们的产品代码中时，他们会感谢你让他们的生活变得更容易。</p><p id="cef5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">感谢阅读！我希望这个 Python 类示例能帮助您构建自己的数据相关类。尝试使用您选择的数据类型自己做一个。你先从哪个开始？数据可以来自 CSV 或 SQL server。如果你还不习惯创建一个类，试着先把这些过程转化成函数，然后围绕这些函数构建一个完整的类。</p><p id="7a31" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">直到下一次，</p><p id="151f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">约翰·德杰苏斯</p></div></div>    
</body>
</html>