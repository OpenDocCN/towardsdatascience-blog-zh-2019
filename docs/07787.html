<html>
<head>
<title>Sports Analytics: an exploratory analysis of international football matches-Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">体育分析:国际足球比赛的探索性分析-第二部分</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/sports-analytics-an-exploratory-analysis-of-international-football-matches-part-2-a20674cca78c?source=collection_archive---------18-----------------------#2019-10-28">https://towardsdatascience.com/sports-analytics-an-exploratory-analysis-of-international-football-matches-part-2-a20674cca78c?source=collection_archive---------18-----------------------#2019-10-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/c6bea8552ca37c61379b288b3f7d075a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*j9oyMmitcAo6DscD.jpg"/></div></div></figure><div class=""/><p id="03c3" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在我之前的<a class="ae kz" rel="noopener" target="_blank" href="/sports-analytics-an-exploratory-analysis-of-international-football-matches-part-1-e133798295f7">文章</a>(本系列的第 1 部分)中，我已经为一个有意义的探索性分析实现了一些有趣的可视化工具。然后，用 Python 包<a class="ae kz" href="https://streamlit.io/docs/" rel="noopener ugc nofollow" target="_blank"> Streamlit </a>，我让他们以网络应用的形式互动。</p><p id="7cfd" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在本文中，我将像以前一样继续处理相同的数据集，这次重点关注两个团队之间的交互。我将继续使用<a class="ae kz" href="https://plot.ly/python/" rel="noopener ugc nofollow" target="_blank"> Plotly </a>作为可视化工具，因为它提供了与图形交互和收集相关信息的可能性。由于我不会附上我以前的<a class="ae kz" rel="noopener" target="_blank" href="/sports-analytics-an-exploratory-analysis-of-international-football-matches-part-1-e133798295f7">文章</a>的代码，如果你是 Streamlit 的新手，我强烈建议你在开始之前阅读它。</p><p id="c0a1" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在，正如预期的那样，我想详细谈谈两支感兴趣的球队之间的比赛。因此，让我们首先用用户的多选来过滤我们的初始数据集(这里有<a class="ae kz" href="https://www.kaggle.com/martj42/international-football-results-from-1872-to-2017" rel="noopener ugc nofollow" target="_blank">可用</a>):</p><pre class="la lb lc ld gt le lf lg lh aw li bi"><span id="768a" class="lj lk je lf b gy ll lm l ln lo">import streamlit as st<br/>import pandas as pd<br/>import numpy as np<br/>import plotly.express as px<br/>import seaborn as sns<br/>import matplotlib.pyplot as plt<br/>import plotly.graph_objects as go<br/>from plotly.subplots import make_subplots</span><span id="0a1e" class="lj lk je lf b gy lp lm l ln lo">st.title('Internationa Football matches')<br/>df = pd.read_csv("results.csv")</span><span id="4eff" class="lj lk je lf b gy lp lm l ln lo">st.subheader('Comparing 2 teams')<br/>teams_to_compare = st.multiselect('Pick your teams', df['home_team'].unique())</span><span id="58aa" class="lj lk je lf b gy lp lm l ln lo">comparison = df[(df['home_team'].isin(teams)) &amp; (df['away_team'].isin(teams)) ]  <br/>comparison = comparison.reset_index(drop=True)<br/>st.write(comparison)<br/>st.write('Number of matches: ', len(comparison))</span></pre><p id="094b" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">对象' teams_to_compare '将是两个队的列表，我对分析两个队之间的比赛感兴趣(不管哪一个队在主场比赛)。然后，我让我的应用程序显示新过滤的数据集以及匹配的数量:</p><figure class="la lb lc ld gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi lq"><img src="../Images/6064db59e626d9a6abe60437d70f7a7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*np6_C45ksdDixmcP"/></div></div></figure><p id="a7c0" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在这里，我对英格兰对苏格兰的所有比赛都感兴趣，这是我最终的数据集。</p><p id="2c93" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在让我们对这两个团队进行一些分析。</p><p id="85b6" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">首先，我想知道哪场比赛的比赛强度最高，我决定将它量化为进球总数。因此，我创建了一个新的熊猫系列，作为两个“分数”列的总和，然后计算该系列的最大值的指数。</p><pre class="la lb lc ld gt le lf lg lh aw li bi"><span id="3010" class="lj lk je lf b gy ll lm l ln lo">st.subheader('Highest intensity of play')</span><span id="685a" class="lj lk je lf b gy lp lm l ln lo">out_c = comparison.iloc[np.argmax(np.array(comparison['home_score']+comparison['away_score']))]<br/>st.write(out_c)</span></pre><figure class="la lb lc ld gt iv gh gi paragraph-image"><div class="gh gi lr"><img src="../Images/255462aa3ec835dafc72c9a7636b245e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1378/0*Xa2jiI-CbUEz4vmy"/></div></figure><p id="2dd2" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">所以，打得最多的比赛是 1961 年 4 月 15 日的英国锦标赛。同样的道理，你可以调查任何一种表现。也就是说，您可以要求显示两个队之间得分差距最大的比赛。</p><p id="d8be" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在，我想可视化我的团队之间的胜败比例。为此，我将使用一个 Plotly 饼图:</p><pre class="la lb lc ld gt le lf lg lh aw li bi"><span id="ae95" class="lj lk je lf b gy ll lm l ln lo">team1_w = 0<br/>team2_w = 0<br/>teams_draw=0<br/>team1_cum=[]<br/>team2_cum=[]</span><span id="21a3" class="lj lk je lf b gy lp lm l ln lo">for i in range(len(comparison)):<br/>    if comparison['home_team'][i]==teams_to_compare[0]:<br/>        if comparison['home_score'][i]&gt;comparison['away_score'][i]:<br/>            team1_w+=1<br/>            team1_cum.append(1)<br/>            team2_cum.append(0)<br/>        elif comparison['home_score'][i]&lt;comparison['away_score'][i]:<br/>            team2_w+=1<br/>            team1_cum.append(0)<br/>            team2_cum.append(1)<br/>        else:<br/>            teams_draw+=1<br/>            team1_cum.append(0)<br/>            team2_cum.append(0)<br/>    else:<br/>        if comparison['home_score'][i]&lt;comparison['away_score'][i]:<br/>            team1_w+=1<br/>            team1_cum.append(1)<br/>            team2_cum.append(0)<br/>        elif comparison['home_score'][i]&gt;comparison['away_score'][i]:<br/>            team2_w+=1<br/>            team1_cum.append(0)<br/>            team2_cum.append(1)<br/>        else:<br/>            teams_draw+=1<br/>            team1_cum.append(0)<br/>            team2_cum.append(0)<br/>            <br/>            <br/>            <br/>comparison_labels = ['Team 1 wins','Team 2 wins','Draws']<br/>comparison_values = [team1_w, team2_w, teams_draw]</span><span id="d658" class="lj lk je lf b gy lp lm l ln lo">fig5 = go.Figure(data=[go.Pie(labels=comparison_labels, values=comparison_values)])<br/>st.plotly_chart(fig5)</span></pre><figure class="la lb lc ld gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi lq"><img src="../Images/cd2457e8012151deba11d94ea6b87b3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*kuD-zNbuXKQT_l0m"/></div></div></figure><p id="52d1" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在上面的代码中，我还定义了两个列表，team1_cum 和 team2_cum，这样我就可以检查我的两个团队的获胜路径。因此，让我们构建一个带有按钮和滑块的折线图:</p><pre class="la lb lc ld gt le lf lg lh aw li bi"><span id="beaf" class="lj lk je lf b gy ll lm l ln lo">st.subheader('Cumulative wins of two teams')</span><span id="0d4e" class="lj lk je lf b gy lp lm l ln lo">fig6 = go.Figure()</span><span id="be99" class="lj lk je lf b gy lp lm l ln lo">fig6.add_trace(go.Scatter(x=list(new_df_wins['date']), y=np.cumsum(np.array(team1_cum)), name='team 1'))<br/>fig6.add_trace(go.Scatter(x=list(new_df_wins['date']), y=np.cumsum(np.array(team2_cum)), name='team 2'))</span><span id="69ff" class="lj lk je lf b gy lp lm l ln lo">fig6.update_layout(<br/>    xaxis=go.layout.XAxis(<br/>        rangeselector=dict(<br/>            buttons=list([<br/>                dict(count=1,<br/>                     label="1m",<br/>                     step="month",<br/>                     stepmode="backward"),<br/>                dict(count=6,<br/>                     label="6m",<br/>                     step="month",<br/>                     stepmode="backward"),<br/>                dict(count=1,<br/>                     label="YTD",<br/>                     step="year",<br/>                     stepmode="todate"),<br/>                dict(count=1,<br/>                     label="1y",<br/>                     step="year",<br/>                     stepmode="backward"),<br/>                dict(step="all")<br/>            ])<br/>        ),<br/>        rangeslider=dict(<br/>            visible=True<br/>        ),<br/>        type="date"<br/>    )<br/>)</span><span id="e286" class="lj lk je lf b gy lp lm l ln lo">st.plotly_chart(fig6)</span></pre><figure class="la lb lc ld gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi lq"><img src="../Images/d6822452e8aaad2919881ac52e25cfe4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*do3GyvQUG1XOhFBX"/></div></div></figure><p id="521e" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">注意:在饼图中，看起来第二队(英格兰)赢了第一队(苏格兰)的大部分比赛。那么，为什么从上面的线形图来看，似乎在大部分时间里，苏格兰统治着英格兰呢？好吧，原因在于数据集:英格兰和苏格兰在 1910 年后打了大部分比赛，因此这与之前收集的信息一致。</p><p id="4505" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">此外，这个图表是有意义的。事实上，我们看到，直到 1910 年(或多或少)，苏格兰一直统治着英格兰。这种趋势反转的原因是什么？人们可能会对这一特定事件感兴趣:</p><figure class="la lb lc ld gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi lq"><img src="../Images/16af6c29627c0aa3a148dbbcb96d8101.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xevu1Pv-Xu11WOF4"/></div></div></figure><p id="0345" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我还想检索另外两个元素。首先，我想知道这些比赛在每个城市进行了多少次。为此，我将构建一个条形图，显示每个城市在我的过滤数据集中出现的次数:</p><pre class="la lb lc ld gt le lf lg lh aw li bi"><span id="340e" class="lj lk je lf b gy ll lm l ln lo">st.subheader('Frequency of city of matches')</span><span id="a545" class="lj lk je lf b gy lp lm l ln lo">cities = comparison.groupby('city').count()['country'].index.values<br/>occurrences = comparison.groupby('city').count()['country'].values<br/>occurrences.sort()</span><span id="f5b9" class="lj lk je lf b gy lp lm l ln lo">fig7 = go.Figure(go.Bar(<br/>            x=occurrences,<br/>            y=cities,<br/>            orientation='h'))</span><span id="de5d" class="lj lk je lf b gy lp lm l ln lo">st.plotly_chart(fig7)</span></pre><figure class="la lb lc ld gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi lq"><img src="../Images/36ce85a052905b59c3fe2f853f6450bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*tPypTzfIbtSNeo24"/></div></div></figure><p id="873b" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">其次，我想收集一些关于锦标赛类型的信息。这个想法是绘制一个气泡图，其 x 和 y 坐标是主客场得分，大小代表比赛的强度(进球总数)，颜色代表锦标赛的类型。另外，为了知道我的哪支球队在主场比赛，我将把主场球队设置为 hover_name，它将显示在每个气泡的顶部。</p><pre class="la lb lc ld gt le lf lg lh aw li bi"><span id="1447" class="lj lk je lf b gy ll lm l ln lo">st.subheader('Tournament information')</span><span id="d902" class="lj lk je lf b gy lp lm l ln lo">comparison['challenge']=np.array(comparison['home_score']+comparison['away_score'])<br/>fig8 = px.scatter(comparison, x="home_score", y="away_score",<br/>          size="challenge", color="tournament",<br/>                 hover_name="home_team")</span><span id="9b3d" class="lj lk je lf b gy lp lm l ln lo">st.plotly_chart(fig8)</span></pre><figure class="la lb lc ld gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi lq"><img src="../Images/34f087785d8bf1fd0ed56989f1b0e39a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jA29k2ANHQjrYKIw"/></div></div></figure><p id="a543" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这张图表的第一瞥显示了进球数最高的比赛似乎是英国锦标赛。最后，让我们将这些信息与每对球队的锦标赛类型的频率结合起来:</p><pre class="la lb lc ld gt le lf lg lh aw li bi"><span id="0436" class="lj lk je lf b gy ll lm l ln lo">tour = st.selectbox('Select a tournament', comparison['tournament'].unique())</span><span id="852f" class="lj lk je lf b gy lp lm l ln lo">comparison_t = comparison[comparison['tournament']==tour] <br/>per = len(comparison_t)/len(comparison)</span><span id="41f5" class="lj lk je lf b gy lp lm l ln lo">st.write(f"{round(per*100,2)}% of matches between the 2 teams have been played as {tour} matches")</span></pre><figure class="la lb lc ld gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi lq"><img src="../Images/c71e76890a7a5b85925aade5496a5124.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*R9eNj8FfiucCRvyu"/></div></div></figure><p id="c98a" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">因此，不仅英国锦标赛举办了最高强度的比赛，而且英格兰和苏格兰之间的比赛也是最多的。</p><p id="1773" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">同样，正如我在上一篇文章中所预期的，这些只是你可以在数据集上构建的一小部分分析。这真的取决于你需要的信息，然而第一个解释性的洞察力总是一个好的起点，因为它可能会提供新的直觉和分析的角度。</p><p id="ba08" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我希望你喜欢阅读！</p><p id="1518" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd jf">参考文献:</strong></p><ul class=""><li id="3934" class="ls lt je kd b ke kf ki kj km lu kq lv ku lw ky lx ly lz ma bi translated"><a class="ae kz" href="https://www.kaggle.com/martj42/international-football-results-from-1872-to-2017" rel="noopener ugc nofollow" target="_blank">https://www . ka ggle . com/martj 42/international-football-results-from-1872-to-2017</a></li><li id="044c" class="ls lt je kd b ke mb ki mc km md kq me ku mf ky lx ly lz ma bi translated">【https://streamlit.io/docs/ T4】</li><li id="7032" class="ls lt je kd b ke mb ki mc km md kq me ku mf ky lx ly lz ma bi translated"><a class="ae kz" href="https://plot.ly/python/" rel="noopener ugc nofollow" target="_blank">https://plot.ly/python/</a></li></ul></div><div class="ab cl mg mh hx mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="im in io ip iq"><p id="c247" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="mn">原载于 2019 年 10 月 28 日</em><a class="ae kz" href="https://datasciencechalktalk.com/2019/10/28/sports-analytics-an-exploratory-analysis-of-international-football-matches-part-2/" rel="noopener ugc nofollow" target="_blank"><em class="mn">http://datasciencechalktalk.com</em></a><em class="mn">。</em></p></div></div>    
</body>
</html>