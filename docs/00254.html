<html>
<head>
<title>How to build a non-geographical map #2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何构建非地理地图#2</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-build-a-non-geographical-map-2-340256ad9f16?source=collection_archive---------14-----------------------#2019-01-11">https://towardsdatascience.com/how-to-build-a-non-geographical-map-2-340256ad9f16?source=collection_archive---------14-----------------------#2019-01-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="8edd" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">或者如何将散点图变成交互式地图(使用传单和 JavaScript)</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/28ee6db8dfff15aa648264b29b2efa7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OyDngHAOswm4ogMq8xI-IA.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">This guy’s body may seem odd and his chair disproportionate, but aren’t maps a distortion of reality, anyway? :)</figcaption></figure><p id="9465" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">地图是数据可视化的强大设计对象。他们强调元素之间的空间关系和变量的比较。在非地理数据的背景下，web 地图可以增强传统的散点图。</p><p id="18c0" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><em class="lr">🔗链接到</em><a class="ae ls" rel="noopener" target="_blank" href="/how-to-build-a-non-geographical-map-1-8d3373e83d6c"><em class="lr">#第 1 部分:如何用降维映射相似性</em> </a></p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="c740" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">#第 2 部分:从散点图到交互式地图</h1><p id="1d87" class="pw-post-body-paragraph kv kw iq kx b ky ms jr la lb mt ju ld le mu lg lh li mv lk ll lm mw lo lp lq ij bi translated">数据可视化的核心是通信。将吓人的桌子变成引人入胜的故事的能力。通常，最终目标是推动解决问题或决策的洞察力。在大多数情况下，用户不会玩弄数据，而是采取被动的态度。但是，如果你想授权给你的观众，激发他们的好奇心，并允许他们探索数据呢？</p><p id="fb37" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们用地图来探索未知。他们给了我们走出人迹罕至的道路的信心。我们偏离了最初的路线，在一家咖啡馆停下来，或者绕道经过一个博物馆。这也是我们使用网络的方式。我们进行搜索，一个链接指向另一个，最终我们对一些我们点击几下之前甚至不知道存在的东西产生了兴趣。</p><p id="e77e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们能以同样偶然的方式传递数据吗？T11】</p><p id="cb67" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在本系列的第一部分<a class="ae ls" rel="noopener" target="_blank" href="/how-to-build-a-non-geographical-map-1-8d3373e83d6c">中，我们使用了降维技术来绘制 2D 空间中的相似性。我们最终得到了一个新的坐标系统，使我们能够在散点图中可视化我们的数据(见</a><a class="ae ls" href="https://plot.ly/~fanny_kassapian/1/#/" rel="noopener ugc nofollow" target="_blank">图(Plotly) </a>)。</p><p id="b77f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在本文中，我们将把它转换成一个交互式地图，包括一个搜索栏和一个侧面板。我们将使用传单和一些额外的 JavaScript。</p><blockquote class="mx my mz"><p id="4fcd" class="kv kw lr kx b ky kz jr la lb lc ju ld na lf lg lh nb lj lk ll nc ln lo lp lq ij bi translated"><strong class="kx ir">无论数据类型如何，本文可能对任何想要构建 web 地图的人都有用。如果是这种情况，请跳到第 2 步。</strong></p></blockquote><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/bf4e3ff587f2b33cc20e899b73ad8d59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1154/1*Rt0GmMiIffHocHiqFEKM8Q.gif"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">&gt;&gt; <a class="ae ls" href="https://codepen.io/fannykassapian/pen/qJOvbB" rel="noopener ugc nofollow" target="_blank">See code &amp; end result (CodePen)</a></figcaption></figure></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="b310" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">第一步。建立一个坐标的 JSON</h1><p id="01c2" class="pw-post-body-paragraph kv kw iq kx b ky ms jr la lb mt ju ld le mu lg lh li mv lk ll lm mw lo lp lq ij bi translated">如果您遵循非地理数据映射的<a class="ae ls" rel="noopener" target="_blank" href="/how-to-build-a-non-geographical-map-1-8d3373e83d6c"/>，您现在有一个嵌入——一个(非常非常长的)Numpy 坐标数组，代表您在 2D 的数据。</p><p id="52d2" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir"> <em class="lr">为了在传单地图上绘制所有这些数据点，我们需要将它们存储到一个 JavaScript 对象中。</em> </strong></p><p id="f360" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">为此，我们可以将 DataFrame 转换成 JSON 字符串，并用 JavaScript 处理它。</p><p id="2489" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果您只有几个数据点要绘制，那么您可能想跳过这一步，手动将它们存储在您的 JavaScript 中。</p><p id="5eec" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">另外，请记住，每个用户每次打开页面时都会“加载”整个 JSON。这会影响你网站的表现。根据您拥有的数据量和流量，您可能更喜欢从数据库中动态加载内容。</p><p id="36ba" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir"> 1/创建一个数据帧</strong></p><p id="981f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在本例中，我将使用:</p><ul class=""><li id="0258" class="ne nf iq kx b ky kz lb lc le ng li nh lm ni lq nj nk nl nm bi translated">基于技能和知识相似性的职业映射产生的<a class="ae ls" rel="noopener" target="_blank" href="/how-to-build-a-non-geographical-map-1-8d3373e83d6c">嵌入</a>和</li><li id="bb45" class="ne nf iq kx b ky nn lb no le np li nq lm nr lq nj nk nl nm bi translated"><a class="ae ls" href="https://www.onetcenter.org/database.html" rel="noopener ugc nofollow" target="_blank"> ONET 开放数据库</a>。</li></ul><p id="cd5c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们的 JSON 必须包含每个标记的坐标和一些数据，比如它的标题和描述，我们将用它们来更新面板的内容。</p><p id="c745" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">下面是我创建数据框所遵循的步骤的简要描述。你可以在这里找到<a class="ae ls" href="https://github.com/fannykassapian/python_json_coordinates/blob/master/UMAP.ipynb" rel="noopener ugc nofollow" target="_blank">完整笔记本(Github) </a>:</p><ul class=""><li id="19fa" class="ne nf iq kx b ky kz lb lc le ng li nh lm ni lq nj nk nl nm bi translated">从 O*NET 加载了<a class="ae ls" href="https://www.onetcenter.org/dictionary/23.1/excel/occupation_data.html" rel="noopener ugc nofollow" target="_blank"> Occupation Data.xlsx </a>文件后，我创建了两个系列。我使用 O*NET SOC 代码作为他们的公共索引，使用职业头衔和描述作为他们各自的值。然后，我将它们组合成一个单一的数据帧。</li><li id="ed30" class="ne nf iq kx b ky nn lb no le np li nq lm nr lq nj nk nl nm bi translated">最后，我创建了一个所有职业标题及其各自坐标数组的字典(基于 UMAP 嵌入)，并将其映射到数据框的标题列。</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ns"><img src="../Images/c20e76b2a9c6415d8684b8d80c8a2440.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sETEjB0itnSiELpy1Icyjw.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">This is what your DataFrame should look like.</figcaption></figure><p id="eddf" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir"> 2/转换成 JSON </strong></p><ul class=""><li id="3105" class="ne nf iq kx b ky kz lb lc le ng li nh lm ni lq nj nk nl nm bi translated">Pandas 有一个内置函数，可以将对象转换为 JSON 字符串:</li></ul><pre class="kg kh ki kj gt nt nu nv nw aw nx bi"><span id="43a9" class="ny mb iq nu b gy nz oa l ob oc">yourdataframe.to_json('newfile.json', orient='index')</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi od"><img src="../Images/188b9fe6baa82a8b4e510b6ae4c30f63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QyVignTJ8Lr2uc5VlM7saw.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">This is what the JSON looks like.</figcaption></figure><p id="96d3" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">更多详情可以在这里找到<a class="ae ls" href="https://github.com/fannykassapian/python_json_coordinates/blob/master/UMAP.ipynb" rel="noopener ugc nofollow" target="_blank">完整笔记本(Github) </a>。</p></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="8a67" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">第二步。用传单创建地图</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oe"><img src="../Images/650c4d0220804c28e2d101f62066fa81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oCnDlju_lObf4u21VYteIQ.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk"><a class="ae ls" href="https://leafletjs.com/" rel="noopener ugc nofollow" target="_blank">Leaflet.js</a> is an open-source JavaScript library for responsive &amp; interactive maps. It offers wonderful features and a beautiful default design.</figcaption></figure><p id="b672" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">创建这张地图需要<a class="ae ls" href="https://leafletjs.com/download.html" rel="noopener ugc nofollow" target="_blank"> <strong class="kx ir">传单</strong> </a> <strong class="kx ir">，</strong> <a class="ae ls" href="https://getbootstrap.com/docs/4.1/getting-started/introduction/" rel="noopener ugc nofollow" target="_blank"> <strong class="kx ir">自举</strong> </a> <strong class="kx ir">，</strong><a class="ae ls" href="https://code.jquery.com/" rel="noopener ugc nofollow" target="_blank"><strong class="kx ir">jQuery</strong></a><strong class="kx ir">和</strong><a class="ae ls" href="https://cdnjs.com/libraries/jqueryui" rel="noopener ugc nofollow" target="_blank"><strong class="kx ir">jQuery-ui</strong></a>。确保在您的代码中包含指向它们的 CSS 和 JS 库的链接。</p><p id="5a34" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir"> 1/创建地图</strong></p><p id="0eb5" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在这篇文章中，我将只使用非常基本的传单设置，并侧重于面板与地图的交互性。然而，你可以用传单做很多令人惊奇的事情，值得一看。</p><p id="a2f5" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">下面是一个快速设置。或者，你可以遵循他们的<a class="ae ls" href="https://leafletjs.com/examples/quick-start/" rel="noopener ugc nofollow" target="_blank">快速入门指南</a>。</p><ul class=""><li id="e898" class="ne nf iq kx b ky kz lb lc le ng li nh lm ni lq nj nk nl nm bi translated">在您的 HTML 中，创建一个空容器:<code class="fe of og oh nu b">&lt;div id="mapDemo"&gt; &lt;/div&gt;</code></li><li id="280e" class="ne nf iq kx b ky nn lb no le np li nq lm nr lq nj nk nl nm bi translated">地图容器必须具有定义的高度。在这里，我将其设置为 100%的查看器屏幕:<code class="fe of og oh nu b">#mapDemo {width: 100vw; height: 100vh;}</code></li><li id="ec4f" class="ne nf iq kx b ky nn lb no le np li nq lm nr lq nj nk nl nm bi translated">在你的 JS 中，创建地图:<code class="fe of og oh nu b">map = L.map('mapDemo');</code>。因为我们在左边有一个面板，所以我们把缩放控件放在屏幕的右下角:<code class="fe of og oh nu b">map.zoomControl.setPosition('bottomright');</code></li></ul><p id="2fcf" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir"> 2/地块标记</strong></p><p id="84ae" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">数据存储在一个 JSON 文件中，其结构与 JavaScript 字典相同。请注意，我的<a class="ae ls" href="https://codepen.io/fannykassapian/pen/qJOvbB" rel="noopener ugc nofollow" target="_blank"> codePen 示例</a>基于一个只有 3 个元素和 3 个特性(“标题”、“坐标”和“描述”)的 JavaScript 字典。</p><ul class=""><li id="037d" class="ne nf iq kx b ky kz lb lc le ng li nh lm ni lq nj nk nl nm bi translated">首先，将 JSON 文件存储在 JavaScript 字典<code class="fe of og oh nu b">var markers = {}</code>中:</li></ul><pre class="kg kh ki kj gt nt nu nv nw aw nx bi"><span id="6d7c" class="ny mb iq nu b gy nz oa l ob oc">var markers = $.getJSON("map_data.json");</span></pre><ul class=""><li id="8f3b" class="ne nf iq kx b ky kz lb lc le ng li nh lm ni lq nj nk nl nm bi translated">然后，遍历字典，将每个标记的特征存储在<code class="fe of og oh nu b">markerOptions</code>下。用<code class="fe of og oh nu b">addTo(map)</code>绘制它们:</li></ul><pre class="kg kh ki kj gt nt nu nv nw aw nx bi"><span id="af2b" class="ny mb iq nu b gy nz oa l ob oc">$.each(markers, function(key, val) {<br/>  var markerOptions = {markerId: key,<br/>                       markerTitle: val['title'],<br/>                       markerText: val['description']};</span><span id="ba58" class="ny mb iq nu b gy oi oa l ob oc">  var marker = L.marker(val['coords'], markerOptions).addTo(map);<br/>});</span></pre><ul class=""><li id="bb4b" class="ne nf iq kx b ky kz lb lc le ng li nh lm ni lq nj nk nl nm bi translated">要查看标记，请在数据坐标范围内设置地图视图:</li></ul><pre class="kg kh ki kj gt nt nu nv nw aw nx bi"><span id="9b74" class="ny mb iq nu b gy nz oa l ob oc">var bounds = [[-10,-10], [10,10]];<br/>map.fitBounds(bounds);</span></pre></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="f6e3" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">第三步。奠定基础</h1><p id="85d4" class="pw-post-body-paragraph kv kw iq kx b ky ms jr la lb mt ju ld le mu lg lh li mv lk ll lm mw lo lp lq ij bi translated">在处理交互性之前，让我们先把 HTML 和 CSS 放在一边。</p><p id="ceb2" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir"> 1/ HTML </strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oj"><img src="../Images/53ecded51570499d8bb1aa4c232abed6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e2BvYmZOiNyQ9d5_kAFK4g.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Main elements and their ids. &gt;&gt; <a class="ae ls" href="https://codepen.io/fannykassapian/pen/qJOvbB" rel="noopener ugc nofollow" target="_blank">See CodePen</a></figcaption></figure><ul class=""><li id="416e" class="ne nf iq kx b ky kz lb lc le ng li nh lm ni lq nj nk nl nm bi translated">在 HTML 的<code class="fe of og oh nu b">&lt;body&gt;</code>中，创建一个带有表单控件(<code class="fe of og oh nu b">#searchTerm</code>)和按钮(<code class="fe of og oh nu b">#searchBtn</code>)的输入组。</li><li id="9eab" class="ne nf iq kx b ky nn lb no le np li nq lm nr lq nj nk nl nm bi translated">下面，添加一个按钮(<code class="fe of og oh nu b">#panelBtn</code>)。它将允许用户随时打开/关闭面板。</li><li id="c489" class="ne nf iq kx b ky nn lb no le np li nq lm nr lq nj nk nl nm bi translated">对于面板，添加一个带有关闭按钮(<code class="fe of og oh nu b">#closeBtn</code>)的<code class="fe of og oh nu b">&lt;div&gt;</code>和将用标记数据更新的内容(如标题和段落)。</li></ul><p id="aad2" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir"> 2/ CSS </strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ok"><img src="../Images/79ef3bf73c07a600624b77ac4987550b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zdmn2n5kDpE8a8MiB4Ql0w.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">This map is mobile first. I only included a media query for screens that are 500px wide and above, but you may want to refine that.</figcaption></figure><ul class=""><li id="280c" class="ne nf iq kx b ky kz lb lc le ng li nh lm ni lq nj nk nl nm bi translated">在你的 CSS 中，确保所有应该位于地图顶部的元素都有一个大于 400 的<code class="fe of og oh nu b">z-index</code>(400 是地图的<code class="fe of og oh nu b">z-index</code>)。</li><li id="c502" class="ne nf iq kx b ky nn lb no le np li nq lm nr lq nj nk nl nm bi translated">默认情况下，<code class="fe of og oh nu b">#panel</code>是隐藏的，只有在<code class="fe of og oh nu b">.active</code>时才显示。将<code class="fe of og oh nu b">left</code>属性设置为与<code class="fe of og oh nu b">#panel</code>元素宽度相同的大小以隐藏它，当<code class="fe of og oh nu b">#panel.active</code>时切换为 0(显示它)。</li><li id="12e1" class="ne nf iq kx b ky nn lb no le np li nq lm nr lq nj nk nl nm bi translated">对于面板高度，使用<code class="fe of og oh nu b">top</code>和<code class="fe of og oh nu b">bottom</code>属性定义元素的开始和结束位置。请注意，如果您没有设置<code class="fe of og oh nu b">bottom</code>，而是定义了一个<code class="fe of og oh nu b">height</code>，滚动将不会像您预期的那样工作。<code class="fe of og oh nu b">#panel</code>将继续位于可见屏幕的“外部”(尽管有<code class="fe of og oh nu b">overflow-y:scroll;</code>)。</li><li id="48a2" class="ne nf iq kx b ky nn lb no le np li nq lm nr lq nj nk nl nm bi translated">在移动和小屏幕上，面板和输入组占据整个宽度。所以，我设置了<code class="fe of og oh nu b">width:100vw;</code>，但是对于超过 500 像素宽的屏幕，我把它改成了<code class="fe of og oh nu b">width:500px;</code>。</li></ul><p id="7962" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">你可以在这里找到<a class="ae ls" href="https://codepen.io/fannykassapian/pen/qJOvbB" rel="noopener ugc nofollow" target="_blank">完整代码(codePen) </a>。</p><p id="2f16" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">3/数据结构</p><p id="6a11" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们必须向前跳一点，考虑我们需要访问哪些数据来显示正确的输出。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ol"><img src="../Images/6fd41a996227a31e57f0c217fa9b39f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7NPk_K_VZEYiQIY9NNdugg.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Overview of the events that require access to markers’ data. In blue are the functions and in turquoise their respective arguments.</figcaption></figure><h2 id="325b" class="ny mb iq bd mc om on dn mg oo op dp mk le oq or mm li os ot mo lm ou ov mq ow bi translated">字典</h2><p id="9fae" class="pw-post-body-paragraph kv kw iq kx b ky ms jr la lb mt ju ld le mu lg lh li mv lk ll lm mw lo lp lq ij bi translated">让我们将点击标记时调用的函数称为<code class="fe of og oh nu b">markerOnClick()</code>，将进入搜索后调用的函数称为<code class="fe of og oh nu b">search()</code>(通过点击建议的标记标题或点击搜索按钮)。</p><p id="1747" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这些功能有许多共同的步骤。为了避免两次编写相同的代码，我们将这些步骤包含在<code class="fe of og oh nu b">updatePanel()</code>函数中。</p><p id="122e" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">为了用附加到每个<code class="fe of og oh nu b">markerId</code>的标题和文本更新面板，<code class="fe of og oh nu b">updatePanel()</code>必须能够访问一些其他标记特征。同样，<code class="fe of og oh nu b">search()</code>是<code class="fe of og oh nu b">markerTitle</code>的一个函数，但是需要访问<code class="fe of og oh nu b">markerId</code>来调用<code class="fe of og oh nu b">updatePanel()</code>。</p><p id="3e65" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">为了让函数能够访问这些特性，我们需要字典。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ox"><img src="../Images/62090bf45277859a4c38d1e1d21a0fef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OyksBUBiQTDSxYMPxnxUdA.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">These are the key-value pairs that we need.</figcaption></figure><ul class=""><li id="0222" class="ne nf iq kx b ky kz lb lc le ng li nh lm ni lq nj nk nl nm bi translated">创建 3 个字典:<code class="fe of og oh nu b">var titleToId = {}; var idToTitle = {}; var idToText = {};</code></li><li id="992a" class="ne nf iq kx b ky nn lb no le np li nq lm nr lq nj nk nl nm bi translated">然后，在遍历<code class="fe of og oh nu b">markers{}</code>字典时追加它们:</li></ul><pre class="kg kh ki kj gt nt nu nv nw aw nx bi"><span id="f3a1" class="ny mb iq nu b gy nz oa l ob oc">$.each(markers, function(key, val) {<br/>...<br/>  titleToId[val['title']] = key;<br/>  idToTitle[key] = val['title'];  <br/>  idToText[key] = val['description'];<br/>...<br/>});</span></pre><h2 id="fdc2" class="ny mb iq bd mc om on dn mg oo op dp mk le oq or mm li os ot mo lm ou ov mq ow bi translated">目录</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oy"><img src="../Images/c20745c3c90296800d9a3f451fa59c36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2soGh0R1DLEOZUrDkNaAaw.png"/></div></div></figure><p id="ad54" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">当用户输入一个搜索时，它调用<code class="fe of og oh nu b">autocomplete()</code>，根据用户输入给出所有可能的标记标题。因此，此函数的数据源必须是标记标题列表:</p><ul class=""><li id="a103" class="ne nf iq kx b ky kz lb lc le ng li nh lm ni lq nj nk nl nm bi translated">创建您在标记循环中附加的标记标题<code class="fe of og oh nu b">var titlesList =[];</code>列表:</li></ul><pre class="kg kh ki kj gt nt nu nv nw aw nx bi"><span id="27d3" class="ny mb iq nu b gy nz oa l ob oc">$.each(markers, function(key, val) {<br/>...<br/>titlesList.push(val['title']);<br/>...<br/>});</span></pre></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="75e1" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">第四步。协调互动</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oz"><img src="../Images/b24a1361057117d70bef92f8d207a255.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IAGJ-Gx77DUrML-54ZDJ3w.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Overview of the functions associated with panel interactivity.</figcaption></figure><p id="a8e8" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir"> 1/点击标记</strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pa"><img src="../Images/82f3e6066290c0adeffd1c94f92b1760.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Sl1RWzvrF83yKAqMkGX0tQ.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">When a marker is clicked: the search bar is updated with the marker’s title, the “open panel” button changes to “close panel”, and the panel opens and displays some content attached to that marker.</figcaption></figure><h2 id="11d5" class="ny mb iq bd mc om on dn mg oo op dp mk le oq or mm li os ot mo lm ou ov mq ow bi translated"><strong class="ak"><em class="pb"/></strong></h2><ul class=""><li id="9d38" class="ne nf iq kx b ky ms lb mt le pc li pd lm pe lq nj nk nl nm bi translated">定义<strong class="kx ir"> </strong> <code class="fe of og oh nu b">updatePanel()</code>:</li></ul><pre class="kg kh ki kj gt nt nu nv nw aw nx bi"><span id="2a91" class="ny mb iq nu b gy nz oa l ob oc">var updatePanel = function(mId){<br/>  $('#panel').addClass('active');<br/>  $("#panelBtn").text('&lt; Close Panel');<br/>  var markerTitle = idToTitle[mId];<br/>  var markerText = idToText[mId];<br/>  $('#panelTitle').text(markerTitle);<br/>  $('#panelText').text(markerText);<br/>};</span></pre><h2 id="d385" class="ny mb iq bd mc om on dn mg oo op dp mk le oq or mm li os ot mo lm ou ov mq ow bi translated"><strong class="ak"><em class="pb">marker onclick()</em></strong></h2><ul class=""><li id="f483" class="ne nf iq kx b ky ms lb mt le pc li pd lm pe lq nj nk nl nm bi translated">并在<code class="fe of og oh nu b">markerOnClik()</code>内呼叫<code class="fe of og oh nu b">updatePanel()</code>:</li></ul><pre class="kg kh ki kj gt nt nu nv nw aw nx bi"><span id="5889" class="ny mb iq nu b gy nz oa l ob oc">var markerOnClick = function(){<br/>  var mId = this.options.markerId;<br/>  var markerTitle = idToTitle[mId];<br/>  $('#searchTerm').val(markerTitle);<br/>  updatePanel(mId);<br/>};</span></pre><ul class=""><li id="5abf" class="ne nf iq kx b ky kz lb lc le ng li nh lm ni lq nj nk nl nm bi translated">在循环中，将 onClick 事件添加到所有标记中。设置弹出选项(popupContent)并将弹出绑定到标记单击:</li></ul><pre class="kg kh ki kj gt nt nu nv nw aw nx bi"><span id="be44" class="ny mb iq nu b gy nz oa l ob oc">$.each(markers, function(key, val) {<br/>...<br/>  marker.on('click', markerOnClick);<br/>  var popupContent = val['title'];<br/>  marker.bindPopup(popupContent);<br/>...<br/>});</span></pre><p id="97a0" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">现在，当用户点击一个标记时，相应的弹出窗口就会打开。</p><p id="ad37" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir"> 2/搜索输入</strong></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pf"><img src="../Images/9cafda2928809caad6d67778bd0a317f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9k0wg9_Jp9RsKzXx0lKqKQ.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">When the user types in the search bar, the autocomplete suggests a few marker titles. From there, the user can either select one of those suggestions or confirm her search. Either way, the output is the same as when a user clicks on a marker (see 1/ Click on marker).</figcaption></figure><h2 id="5baf" class="ny mb iq bd mc om on dn mg oo op dp mk le oq or mm li os ot mo lm ou ov mq ow bi translated"><strong class="ak"><em class="pb">autocomplete()</em></strong></h2><ul class=""><li id="d231" class="ne nf iq kx b ky ms lb mt le pc li pd lm pe lq nj nk nl nm bi translated">这里，我们定义了 autocomplete()的选项。同样，当从自动完成中选择一个条目时，我们将其值存储在<code class="fe of og oh nu b">#searchTerm</code>中并调用<code class="fe of og oh nu b">search()</code>:</li></ul><pre class="kg kh ki kj gt nt nu nv nw aw nx bi"><span id="08f2" class="ny mb iq nu b gy nz oa l ob oc">$(function() {<br/>   $("#searchTerm").autocomplete({<br/>     source: titlesList,<br/>     minLength: 1,<br/>     select: function(event, ui) { <br/>       $("#searchTerm").val(ui.item.label);<br/>       console.log(ui.item.label);<br/>       search();<br/>     }<br/>   });<br/> });</span></pre><h2 id="7f49" class="ny mb iq bd mc om on dn mg oo op dp mk le oq or mm li os ot mo lm ou ov mq ow bi translated"><strong class="ak"> <em class="pb">搜索()</em> </strong></h2><p id="43d2" class="pw-post-body-paragraph kv kw iq kx b ky ms jr la lb mt ju ld le mu lg lh li mv lk ll lm mw lo lp lq ij bi translated">现在，如果用户点击一个建议的<code class="fe of og oh nu b">markerTitle</code>，就会调用<code class="fe of og oh nu b">search()</code>和<code class="fe of og oh nu b">updatePanel()</code>。但是，如果没有实际点击标记，弹出窗口就不会显示。</p><p id="dc8b" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">一种解决方案是给每个标记附加不同的层。然后我们可以将 fleet 的 openPopup()方法应用于<code class="fe of og oh nu b">search()</code>函数中的层。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pg"><img src="../Images/d4fbf0d925bc0ebc7d0a38d6e2b478e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iBtOAcqJvVM7dbG9TzrDKg.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">LayerGroup is a method from the Layer class used to group several layers and handle them as one &gt;&gt; see <a class="ae ls" href="https://leafletjs.com/reference-1.4.0.html#layergroup" rel="noopener ugc nofollow" target="_blank">documentation</a></figcaption></figure><ul class=""><li id="0a5a" class="ne nf iq kx b ky kz lb lc le ng li nh lm ni lq nj nk nl nm bi translated">创建一组图层<code class="fe of og oh nu b">var layers = L.layerGroup().addTo(map);</code>并在标记循环<code class="fe of og oh nu b">layers.addLayer(marker)</code>中更新</li><li id="420d" class="ne nf iq kx b ky nn lb no le np li nq lm nr lq nj nk nl nm bi translated">每个标记都有一个层，但是我们需要一个字典来允许我们根据标记的<code class="fe of og oh nu b">markerId</code> : <code class="fe of og oh nu b">var idToLayer = {};</code>检索标记的层:</li></ul><pre class="kg kh ki kj gt nt nu nv nw aw nx bi"><span id="e2b9" class="ny mb iq nu b gy nz oa l ob oc">$.each(fgLayers._layers, function(key,val){<br/>  idToLayer[val.options.markerId] = key;<br/>});</span></pre><ul class=""><li id="4a7e" class="ne nf iq kx b ky kz lb lc le ng li nh lm ni lq nj nk nl nm bi translated">我们终于可以定义<code class="fe of og oh nu b">search()</code>函数了。它从搜索字段中获取<code class="fe of og oh nu b">markerTitle</code>，找到它对应的标记，打开它的弹出窗口并调用<code class="fe of og oh nu b">updatePanel()</code>:</li></ul><pre class="kg kh ki kj gt nt nu nv nw aw nx bi"><span id="877b" class="ny mb iq nu b gy nz oa l ob oc">var search = function(){<br/> $("#searchTerm").blur(); <br/> var markerTitle = $("#searchTerm").val();<br/> var markerId = titleToId[markerTitle];<br/> var layerId = idToLayer[markerId];<br/> var layer = layers._layers[layerId];<br/> layer.openPopup();</span><span id="c967" class="ny mb iq nu b gy oi oa l ob oc"> updatePanel(markerId);<br/>}</span></pre><p id="7274" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><strong class="kx ir"> 3/打开-关闭面板</strong></p><p id="ae78" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在用户进行搜索或点击标记后，我们希望他们能够关闭面板并随时返回地图。我们还想让他们直接从地图上重新打开面板。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ph"><img src="../Images/f9a9026719bda1339131f17bbbd5f7da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KYNVZtyTKmTHd8a8CytONw.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">To close the panel, the user can either click the close button of the panel or click the “close panel” button on the map.</figcaption></figure><h2 id="0bb3" class="ny mb iq bd mc om on dn mg oo op dp mk le oq or mm li os ot mo lm ou ov mq ow bi translated">togglePanel()</h2><p id="e7d8" class="pw-post-body-paragraph kv kw iq kx b ky ms jr la lb mt ju ld le mu lg lh li mv lk ll lm mw lo lp lq ij bi translated"><code class="fe of og oh nu b">#panelBtn</code>按钮允许用户连续打开或关闭面板。它的内容应该根据它允许用户接下来做的动作(打开或关闭)而改变。我们可以通过使用 jQuery 的 toggleClass 方法来实现这一点。</p><ul class=""><li id="d400" class="ne nf iq kx b ky kz lb lc le ng li nh lm ni lq nj nk nl nm bi translated">给按钮添加一个 onClick 事件:<code class="fe of og oh nu b">&lt;button onClick = "togglePanel()";&gt;</code>并定义<code class="fe of og oh nu b">togglePanel()</code>:</li></ul><pre class="kg kh ki kj gt nt nu nv nw aw nx bi"><span id="cf62" class="ny mb iq nu b gy nz oa l ob oc">var togglePanel = function() {<br/>  $('#panel').toggleClass('active');             <br/>  $("#panelBtn").text(($("#panelBtn").text() == 'Open Panel &gt;') ? '&lt; Close Panel' : 'Open Panel &gt;'); <br/>}</span></pre><h2 id="f1ef" class="ny mb iq bd mc om on dn mg oo op dp mk le oq or mm li os ot mo lm ou ov mq ow bi translated">关闭面板()</h2><p id="4352" class="pw-post-body-paragraph kv kw iq kx b ky ms jr la lb mt ju ld le mu lg lh li mv lk ll lm mw lo lp lq ij bi translated"><code class="fe of og oh nu b">#closeBtn</code>按钮允许用户在面板打开时关闭面板，并更新<code class="fe of og oh nu b">#panelBtn</code>内部 HTML。</p><ul class=""><li id="2165" class="ne nf iq kx b ky kz lb lc le ng li nh lm ni lq nj nk nl nm bi translated">给按钮添加一个 onClick 事件:<code class="fe of og oh nu b">&lt;button onClick = "closePanel()";&gt;</code>并定义<code class="fe of og oh nu b">closePanel()</code>:</li></ul><pre class="kg kh ki kj gt nt nu nv nw aw nx bi"><span id="85f9" class="ny mb iq nu b gy nz oa l ob oc">var closePanel = function() {<br/>  $('#panel').removeClass('active');<br/>  $('#panelBtn').text('Open Panel &gt;');<br/>}</span></pre></div><div class="ab cl lt lu hu lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ij ik il im in"><h1 id="62f0" class="ma mb iq bd mc md me mf mg mh mi mj mk jw ml jx mm jz mn ka mo kc mp kd mq mr bi translated">包裹</h1><h2 id="e658" class="ny mb iq bd mc om on dn mg oo op dp mk le oq or mm li os ot mo lm ou ov mq ow bi translated">感谢您的阅读😃</h2><p id="24b5" class="pw-post-body-paragraph kv kw iq kx b ky ms jr la lb mt ju ld le mu lg lh li mv lk ll lm mw lo lp lq ij bi translated">在本系列中，我们介绍了如何使用降维来构建散点图，该散点图使用距离作为相似性的代理，并将其转换为交互式地图。</p><p id="d1c3" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我在撰写这些文章和为它们配插图的过程中获得了很多乐趣，并在此过程中学到了很多东西。我希望你已经发现它是有用的，并且我期待在那里看见更多令人惊奇的地图。</p><h2 id="172e" class="ny mb iq bd mc om on dn mg oo op dp mk le oq or mm li os ot mo lm ou ov mq ow bi translated">🔗链接到<a class="ae ls" rel="noopener" target="_blank" href="/how-to-build-a-non-geographical-map-1-8d3373e83d6c">#第 1 部分:如何通过降维映射相似性</a></h2><h2 id="bddb" class="ny mb iq bd mc om on dn mg oo op dp mk le oq or mm li os ot mo lm ou ov mq ow bi translated">👉看看我是如何在实践中使用它的:<a class="ae ls" href="http://www.tailoredpath.com" rel="noopener ugc nofollow" target="_blank">www.tailoredpath.com</a></h2></div></div>    
</body>
</html>