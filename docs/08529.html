<html>
<head>
<title>Analyzing Yelp Dataset with Scattertext spaCy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">利用散点文本空间分析 Yelp 数据集</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/analyzing-yelp-dataset-with-scattertext-spacy-82ea8bb7a60e?source=collection_archive---------20-----------------------#2019-11-18">https://towardsdatascience.com/analyzing-yelp-dataset-with-scattertext-spacy-82ea8bb7a60e?source=collection_archive---------20-----------------------#2019-11-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="60c0" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用 NLP 对文本数据进行探索性数据分析和可视化</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/ccf2ea6cd7ff21d210c9a3576689d18a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gxtEZ8pLr7UEPs1bjt0TSQ.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Scattertext spaCy</figcaption></figure><p id="5183" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">文本挖掘领域最关键的工作之一是可视化地呈现文本数据的内容。使用自然语言处理(NLP)，数据科学家可以总结文档，创建主题，从不同角度和细节范围探索内容的故事情节。</p><p id="5157" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这篇文章将探索<a class="ae lr" href="https://www.yelp.com/dataset/challenge" rel="noopener ugc nofollow" target="_blank"> Yelp 数据集</a>，然后使用<a class="ae lr" href="https://spacy.io/universe/project/scattertext" rel="noopener ugc nofollow" target="_blank">散点图</a>来可视化和分析文本数据。</p><h1 id="e886" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">什么是分散文本？</h1><blockquote class="mk ml mm"><p id="e5b9" class="kv kw mn kx b ky kz jr la lb lc ju ld mo lf lg lh mp lj lk ll mq ln lo lp lq ij bi translated"><a class="ae lr" href="https://github.com/JasonKessler/scattertext" rel="noopener ugc nofollow" target="_blank"> Scattertext 是一种工具，旨在可视化哪些单词和短语比其他单词和短语更具类别特征。</a></p></blockquote><h2 id="9c1f" class="mr lt iq bd lu ms mt dn ly mu mv dp mc le mw mx me li my mz mg lm na nb mi nc bi translated">数据源</h2><p id="8cbb" class="pw-post-body-paragraph kv kw iq kx b ky nd jr la lb ne ju ld le nf lg lh li ng lk ll lm nh lo lp lq ij bi translated">对于这个例子，我们将关注<a class="ae lr" href="https://www.yelp.com/dataset/challenge" rel="noopener ugc nofollow" target="_blank"> Yelp 数据集</a>中与 RV 相关的类别。完整的 Yelp 数据集包含 1000 多个类别和 600 万条评论。我们编辑过的 CSV 文件可以在我的<a class="ae lr" href="https://github.com/gyhou/yelp_dataset" rel="noopener ugc nofollow" target="_blank"> GitHub repo </a>中找到，还有关于我如何将 Yelp 数据集 JSON 文件转换成 CSV 文件的 Jupyter 笔记本。一篇<a class="ae lr" href="https://link.medium.com/0k0DEb3Qy1" rel="noopener">媒体文章</a>也贴出来了，对转换过程给出了更详尽的解释。</p><p id="1342" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">这个编辑过的 csv 由 Yelp 数据集中的 5 个类别组成:<br/><code class="fe ni nj nk nl b">RV Repair</code><code class="fe ni nj nk nl b">RV Dealers</code><code class="fe ni nj nk nl b">RV Rental</code><code class="fe ni nj nk nl b">RV Parks</code><code class="fe ni nj nk nl b">Campgrounds</code>。</p><h2 id="62ee" class="mr lt iq bd lu ms mt dn ly mu mv dp mc le mw mx me li my mz mg lm na nb mi nc bi translated">加载并清理数据集</h2><pre class="kg kh ki kj gt nm nl nn no aw np bi"><span id="baf4" class="mr lt iq nl b gy nq nr l ns nt">import pandas as pd</span><span id="defc" class="mr lt iq nl b gy nu nr l ns nt">df = pd.read_csv('yelp_reviews_RV_categories.csv')</span></pre><p id="5bff" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在开始之前，我们想知道如何对评级进行分组。通过使用 seaborn distplot，我们可以检查评级在该数据集中的分布情况。</p><pre class="kg kh ki kj gt nm nl nn no aw np bi"><span id="3f3a" class="mr lt iq nl b gy nq nr l ns nt">import seaborn as sns<br/>sns.distplot(df['review_stars']);</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/c5cfdc7f12d2067c1dc06c146850ae5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:930/format:webp/1*1P9pXkD0ICGKpM3aaU_clg.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">A <a class="ae lr" href="https://seaborn.pydata.org/generated/seaborn.distplot.html" rel="noopener ugc nofollow" target="_blank">seaborn distplot</a> plots a univariate distribution of observations</figcaption></figure><p id="5393" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">该图显示大多数评论被评为 1 星或 5 星，而我们只能比较 5 星和 1 星之间的评论，这将忽略 2-4 星的评论。相反，让我们将评级合并为高或低。</p><pre class="kg kh ki kj gt nm nl nn no aw np bi"><span id="7597" class="mr lt iq nl b gy nq nr l ns nt">df['rating'] = df['review_stars'].replace(<br/>               {1:'Low Rating', 2:'Low Rating', 3:'Low Rating',<br/>                4:'High Rating', 5:'High Rating'})</span></pre><p id="a33c" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">因为我们知道这个数据集有 5 个不同的类别，我们可以进一步将相似的类别组合在一起。让我们只使用<code class="fe ni nj nk nl b">RV parks</code>和<code class="fe ni nj nk nl b">Campgrounds</code>，暂时忽略<code class="fe ni nj nk nl b">RV Repair</code>、<code class="fe ni nj nk nl b">RV Dealers</code>和<code class="fe ni nj nk nl b">RV Rental</code>。</p><pre class="kg kh ki kj gt nm nl nn no aw np bi"><span id="1228" class="mr lt iq nl b gy nq nr l ns nt">df_Parks_Camp = df[df['categories'].str.contains(<br/>                'RV Parks|Campgrounds', na=False)]</span></pre><h1 id="0e99" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">NLP 分析—使用散点图和空间</h1><p id="b8b0" class="pw-post-body-paragraph kv kw iq kx b ky nd jr la lb ne ju ld le nf lg lh li ng lk ll lm nh lo lp lq ij bi translated">既然我们已经预处理了数据集，我们可以开始一些分析了。确保你已经在你的内核中下载了一个空间英语模型。</p><blockquote class="mk ml mm"><p id="556a" class="kv kw mn kx b ky kz jr la lb lc ju ld mo lf lg lh mp lj lk ll mq ln lo lp lq ij bi translated"><code class="fe ni nj nk nl b">en_core_web_sm</code> <a class="ae lr" href="https://spacy.io/models#conventions" rel="noopener ugc nofollow" target="_blank">是一个在书面网络文本(博客、新闻、评论)上训练的小型英语模型，包括词汇、向量、句法和实体。</a></p></blockquote><pre class="kg kh ki kj gt nm nl nn no aw np bi"><span id="19ce" class="mr lt iq nl b gy nq nr l ns nt">import spacy<br/>import scattertext</span><span id="6c47" class="mr lt iq nl b gy nu nr l ns nt">nlp = spacy.load('en_core_web_sm')</span></pre><p id="a6c3" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">如果没有，可以下载！</p><pre class="kg kh ki kj gt nm nl nn no aw np bi"><span id="bfca" class="mr lt iq nl b gy nq nr l ns nt">!python -m spacy download en_core_web_sm</span></pre><p id="e2a7" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">接下来，我们将使用下面的函数来:</p><ul class=""><li id="3ac3" class="nw nx iq kx b ky kz lb lc le ny li nz lm oa lq ob oc od oe bi translated">建立我们的语料库，从数据集中收集文本</li><li id="79a8" class="nw nx iq kx b ky of lb og le oh li oi lm oj lq ob oc od oe bi translated">获取术语频率和<a class="ae lr" href="https://github.com/JasonKessler/scattertext#understanding-scaled-f-score" rel="noopener ugc nofollow" target="_blank">比例 f 值</a></li><li id="90d9" class="nw nx iq kx b ky of lb og le oh li oi lm oj lq ob oc od oe bi translated">为<code class="fe ni nj nk nl b">High Rating</code> &amp; <code class="fe ni nj nk nl b">Low Rating</code>按降序创建数据帧</li></ul><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ok ol l"/></div></figure><pre class="kg kh ki kj gt nm nl nn no aw np bi"><span id="029e" class="mr lt iq nl b gy nq nr l ns nt">Parks_Camp_high, Parks_Camp_low = term_freq(df_Parks_Camp)</span></pre><div class="kg kh ki kj gt ab cb"><figure class="om kk on oo op oq or paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/c77fbc51519b8ac1e352d792455543bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1010/format:webp/1*mmyiPUH3gghAZmkQvPWAmA.png"/></div></figure><figure class="om kk os oo op oq or paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/9a5a31aab500ea68939c08a24a16f6d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:992/format:webp/1*5TXmW5h8W97pB-9CjijMSQ.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk ot di ou ov"><strong class="bd ow">Left </strong>— Sorted by High Rating. <strong class="bd ow">Right </strong>— Sorted by Low Rating</figcaption></figure></div><h1 id="fa5d" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">了解评分系统</h1><p id="9592" class="pw-post-body-paragraph kv kw iq kx b ky nd jr la lb ne ju ld le nf lg lh li ng lk ll lm nh lo lp lq ij bi translated">Scattertext 使用<a class="ae lr" href="https://github.com/JasonKessler/scattertext#understanding-scaled-f-score" rel="noopener ugc nofollow" target="_blank">缩放的 f-score </a>，它考虑了类别特定的精度和术语频率。虽然一个术语可能在两个类别中频繁出现(<code class="fe ni nj nk nl b">High</code>和<code class="fe ni nj nk nl b">Low</code>评级)，但是缩放的 f 分数确定该术语是否比其他术语更具有类别特征(<code class="fe ni nj nk nl b">High</code>或<code class="fe ni nj nk nl b">Low</code>评级)。</p><p id="4254" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">例如，虽然术语<code class="fe ni nj nk nl b">park</code>在<code class="fe ni nj nk nl b">High</code>和<code class="fe ni nj nk nl b">Low</code>评级中出现频率很高，但缩放后的 f 分数得出的结论是<code class="fe ni nj nk nl b">park</code>与<code class="fe ni nj nk nl b">High</code> 0.90 的关联度高于<code class="fe ni nj nk nl b">Low</code> 0.10 的评级。因此，当评论包含术语<code class="fe ni nj nk nl b">park</code>时，它更具有<code class="fe ni nj nk nl b">High</code>评级类别的特征。</p><h1 id="3754" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">停止言语</h1><p id="c38d" class="pw-post-body-paragraph kv kw iq kx b ky nd jr la lb ne ju ld le nf lg lh li ng lk ll lm nh lo lp lq ij bi translated">请注意，有些术语不在列表中，如<code class="fe ni nj nk nl b">in the</code>、<code class="fe ni nj nk nl b">of the</code>、<code class="fe ni nj nk nl b">to the</code>、<code class="fe ni nj nk nl b">it was</code>，这些是可以删除的停用词<strong class="kx ir">、</strong>的一些示例。</p><p id="fa91" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">在进行自然语言处理时，停用词是一些非常常见的词，这些词在帮助选择文档时似乎没有什么价值，它们被完全排除在词汇表之外，例如<code class="fe ni nj nk nl b">the</code>、<code class="fe ni nj nk nl b">them</code>和<code class="fe ni nj nk nl b">they</code>。</p><pre class="kg kh ki kj gt nm nl nn no aw np bi"><span id="1862" class="mr lt iq nl b gy nq nr l ns nt">remove_terms(nlp.Defaults.stop_words, ignore_absences=True)</span></pre><p id="3bf4" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">spaCy 有 326 个默认停用词，我们已经使用上面的代码从语料库中删除了这些词，但我们可以添加更多。</p><p id="9c93" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们可以从自然语言工具包(NLTK)中添加更多的停用词。</p><pre class="kg kh ki kj gt nm nl nn no aw np bi"><span id="eb35" class="mr lt iq nl b gy nq nr l ns nt">from nltk.corpus import stopwords<br/>stopWords = set(stopwords.words('english'))<br/>nlp.Defaults.stop_words |= stopWords</span></pre><p id="502f" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">我们也可以通过创建一个<code class="fe ni nj nk nl b">stopwords.txt</code>文件来设置我们自己的停用词。<br/>将文本文件中的任何内容(包括符号、数字、术语)作为停用词从语料库中删除。<br/>随意使用我的<a class="ae lr" href="https://github.com/gyhou/yelp_dataset" rel="noopener ugc nofollow" target="_blank"> GitHub repo </a>里面的<code class="fe ni nj nk nl b">stopwords.txt</code>文件。</p><pre class="kg kh ki kj gt nm nl nn no aw np bi"><span id="bd66" class="mr lt iq nl b gy nq nr l ns nt">with open('stopwords.txt', 'r') as f:<br/>    str_f = f.read()<br/>    set_stopwords = set(str_f.split('\n'))<br/>nlp.Defaults.stop_words |= set_stopwords</span></pre><p id="115d" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">每当我们完成文本文件的更新时，记得通过运行上面的代码来保存它，以便它更新到原始的停用词集。</p><p id="dc66" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">一旦添加了更多的停用词，我们可以再次运行<code class="fe ni nj nk nl b">term_freq</code>功能。</p><pre class="kg kh ki kj gt nm nl nn no aw np bi"><span id="3907" class="mr lt iq nl b gy nq nr l ns nt">Parks_Camp_high, Parks_Camp_low = term_freq(df_Parks_Camp)</span></pre><div class="kg kh ki kj gt ab cb"><figure class="om kk ox oo op oq or paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/9850e83073b92c2dff6b112d72d1542f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1002/format:webp/1*0sRaRE0fPsTNS79j3AjWgQ.png"/></div></figure><figure class="om kk oy oo op oq or paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/33b12d282e4992a1e529d86922b88eb6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*Pw6OMMSX7Kty8wnBCaUvIA.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk oz di pa ov">Term frequency and score after removing more stop words.</figcaption></figure></div><h1 id="a129" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">分散文本可视化</h1><p id="4bd6" class="pw-post-body-paragraph kv kw iq kx b ky nd jr la lb ne ju ld le nf lg lh li ng lk ll lm nh lo lp lq ij bi translated">数据表很好，但是可视化更好！<br/>我们可以创建一个散点图，直观显示 Yelp 数据集中评论的高评分和低评分之间的术语关联。</p><pre class="kg kh ki kj gt nm nl nn no aw np bi"><span id="b6fe" class="mr lt iq nl b gy nq nr l ns nt">corpus_dataframe = df_Park_Camp<br/>html = scattertext.produce_scattertext_explorer(<br/>                   corpus,<br/>                   category='Low Rating',<br/>                   category_name='Low Rating',<br/>                   not_category_name='High Rating',<br/>                   width_in_pixels=1000,<br/>                   metadata=corpus_dataframe['name'])</span></pre><h2 id="2507" class="mr lt iq bd lu ms mt dn ly mu mv dp mc le mw mx me li my mz mg lm na nb mi nc bi translated">交互式 HTML</h2><p id="da51" class="pw-post-body-paragraph kv kw iq kx b ky nd jr la lb ne ju ld le nf lg lh li ng lk ll lm nh lo lp lq ij bi translated"><a class="ae lr" href="https://gyhou.com/RV-Parks-Campgrounds-Yelp-Reviews-Scattertext.html" rel="noopener ugc nofollow" target="_blank">https://gyhou . com/RV-Parks-Campgrounds-Yelp-Reviews-scattertext . html</a></p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pb"><img src="../Images/529e3643fe349d220fc5ef2449c3c094.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R9uNVsZZJTKujSoFKyZ_fA.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk">Searching for a term will show the name of the business and reviews.</figcaption></figure><h2 id="4da1" class="mr lt iq bd lu ms mt dn ly mu mv dp mc le mw mx me li my mz mg lm na nb mi nc bi translated">理解散点图</h2><p id="e6ba" class="pw-post-body-paragraph kv kw iq kx b ky nd jr la lb ne ju ld le nf lg lh li ng lk ll lm nh lo lp lq ij bi translated">在散点图的右侧，我们有一个评级最高的术语的概述和一个无序的术语列表(在特征下)。如果我们点击该术语，它将向我们显示数据集中的特定评论，显示为<code class="fe ni nj nk nl b">Low</code>或<code class="fe ni nj nk nl b">High</code>评级。我们也可以在左下角手动搜索一个术语。</p><p id="86a1" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">从散点图中，我们可以快速浏览一下评论中使用的术语。图右侧的红点表示与<code class="fe ni nj nk nl b">High</code>评级更相关的术语，而左侧的蓝点表示与<code class="fe ni nj nk nl b">Low</code>评级更相关的术语。</p><p id="1b97" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">有了这个散点图，我们可以很容易地搜索可能对 Yelp 业务有用的术语。我们不仅可以看到一个术语是否与正面或负面评价更密切相关，还可以阅读每个单独的评论。</p><h2 id="3dc7" class="mr lt iq bd lu ms mt dn ly mu mv dp mc le mw mx me li my mz mg lm na nb mi nc bi translated">保存并共享为 HTML 文件</h2><p id="d6ef" class="pw-post-body-paragraph kv kw iq kx b ky nd jr la lb ne ju ld le nf lg lh li ng lk ll lm nh lo lp lq ij bi translated">我们现在可以将它保存为 HTML 文件，以便在浏览器上查看和共享！</p><pre class="kg kh ki kj gt nm nl nn no aw np bi"><span id="050a" class="mr lt iq nl b gy nq nr l ns nt">html_file_name = "RV-Parks-Campgrounds-Yelp-Review-Scattertext.html"<br/>open(html_file_name, 'wb').write(html.encode('utf-8'))</span></pre><p id="2379" class="pw-post-body-paragraph kv kw iq kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated">感谢阅读！我很乐意听到你的想法，在这里评论或给我发消息。用于此的代码位于我的<a class="ae lr" href="https://github.com/gyhou/yelp_dataset" rel="noopener ugc nofollow" target="_blank"> GitHub 库</a>中。</p></div></div>    
</body>
</html>