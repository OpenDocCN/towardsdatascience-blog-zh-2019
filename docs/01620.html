<html>
<head>
<title>How do pre-trained models work?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">预先训练好的模型是如何工作的？</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-do-pretrained-models-work-11fe2f64eaa2?source=collection_archive---------4-----------------------#2019-03-16">https://towardsdatascience.com/how-do-pretrained-models-work-11fe2f64eaa2?source=collection_archive---------4-----------------------#2019-03-16</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/3faf7f979edadf8fcf253c20c0ffe7d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wUkdGuYpzGSfQFTHcDYoIQ.jpeg"/></div></div></figure><h2 id="e132" class="jy jz iq bd ka kb kc dn kd ke kf dp kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">介绍</h2><p id="7dda" class="pw-post-body-paragraph ku kv iq kw b kx ky kz la lb lc ld le kh lf lg lh kl li lj lk kp ll lm ln lo ij bi translated">在我的大多数深度学习项目中，我都使用过预训练的模型。我也提到过，从他们开始而不是从头开始训练通常是个好主意。在本文中，我将对此进行详细解释，并在此过程中帮助您理解大部分代码片段。在文章的最后，我还将谈到计算机视觉中的一种技术，它有助于提高您的模型的性能。</p><p id="6c6c" class="pw-post-body-paragraph ku kv iq kw b kx lp kz la lb lq ld le kh lr lg lh kl ls lj lk kp lt lm ln lo ij bi translated">让我们开始吧。</p><h2 id="3344" class="jy jz iq bd ka kb kc dn kd ke kf dp kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">训练神经网络</h2><p id="26cd" class="pw-post-body-paragraph ku kv iq kw b kx ky kz la lb lc ld le kh lf lg lh kl li lj lk kp ll lm ln lo ij bi translated">当我们训练神经网络时，网络的初始层可以识别非常简单的事情。说一条直线或者一条斜的。一些非常基本的东西。</p><figure class="lv lw lx ly gt jr gh gi paragraph-image"><div class="gh gi lu"><img src="../Images/2bc29278ba9fdfd01eb624d824b7974d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1380/format:webp/1*o6VS2gllSZsO9BZq3Z8RjA.jpeg"/></div></figure><p id="72a9" class="pw-post-body-paragraph ku kv iq kw b kx lp kz la lb lq ld le kh lr lg lh kl ls lj lk kp lt lm ln lo ij bi translated">随着我们深入网络，我们可以识别更复杂的东西。</p><figure class="lv lw lx ly gt jr gh gi paragraph-image"><div class="gh gi lu"><img src="../Images/787f3f97e004dec5541bf0225a6fe88f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1380/format:webp/1*du1K84yAHnEg3HZUlypZjw.jpeg"/></div></figure><p id="37db" class="pw-post-body-paragraph ku kv iq kw b kx lp kz la lb lq ld le kh lr lg lh kl ls lj lk kp lt lm ln lo ij bi translated">第二层可以识别像正方形或圆形这样的形状。</p><figure class="lv lw lx ly gt jr gh gi paragraph-image"><div class="gh gi lu"><img src="../Images/5b97a4b8f3d5a29402db80682bc374fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1380/format:webp/1*kdOBBm2xtBeR0tJpo2dh7A.png"/></div></figure><p id="a271" class="pw-post-body-paragraph ku kv iq kw b kx lp kz la lb lq ld le kh lr lg lh kl ls lj lk kp lt lm ln lo ij bi translated">第三层可以识别复杂的模式。</p><figure class="lv lw lx ly gt jr gh gi paragraph-image"><div class="gh gi lu"><img src="../Images/ec6f2be559c4f18084edf97f851ebb88.png" data-original-src="https://miro.medium.com/v2/resize:fit:1380/format:webp/1*pn-G499Jn-LcjEX5Q7sX3Q.jpeg"/></div></figure><p id="1124" class="pw-post-body-paragraph ku kv iq kw b kx lp kz la lb lq ld le kh lr lg lh kl ls lj lk kp lt lm ln lo ij bi translated">最后，网络的最深层可以识别像狗脸这样的东西。它可以识别这些东西，因为我们的模型的权重被设置为某些值。</p><p id="9a9c" class="pw-post-body-paragraph ku kv iq kw b kx lp kz la lb lq ld le kh lr lg lh kl ls lj lk kp lt lm ln lo ij bi translated">Resnet34 就是这样一个模型。它被训练对 1000 种图像进行分类。</p><h2 id="bb97" class="jy jz iq bd ka kb kc dn kd ke kf dp kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">使用预训练模型的直觉</h2><p id="c8ff" class="pw-post-body-paragraph ku kv iq kw b kx ky kz la lb lc ld le kh lf lg lh kl li lj lk kp ll lm ln lo ij bi translated">现在想想这个。如果你想训练一个分类器，任何分类器，不管你想分类什么，初始层都会检测斜线。因此，每次创建神经网络时都训练它们是没有意义的。</p><p id="2a53" class="pw-post-body-paragraph ku kv iq kw b kx lp kz la lb lq ld le kh lr lg lh kl ls lj lk kp lt lm ln lo ij bi translated">这只是我们网络的最后几层，这些层学习识别需要培训的项目特定的类。</p><p id="25e3" class="pw-post-body-paragraph ku kv iq kw b kx lp kz la lb lq ld le kh lr lg lh kl ls lj lk kp lt lm ln lo ij bi translated">因此，我们所做的是，我们采取 Resnet34，并删除其最终层。然后，我们向它添加一些我们自己的层(随机初始化),并训练这个新模型。</p><p id="36d1" class="pw-post-body-paragraph ku kv iq kw b kx lp kz la lb lq ld le kh lr lg lh kl ls lj lk kp lt lm ln lo ij bi translated">在我们看如何在代码中做到这一点之前，我想提一下，预训练模型通常是在大量数据上训练的，并使用通常不是每个人都可用的资源。以 ImageNet 为例。它包含超过 1400 万张图片，其中 120 万张图片属于 1000 个类别中的一个。因此，使用这些模型对我们来说是非常有益的。</p><h2 id="a05f" class="jy jz iq bd ka kb kc dn kd ke kf dp kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">代码</h2><p id="3fc8" class="pw-post-body-paragraph ku kv iq kw b kx ky kz la lb lc ld le kh lf lg lh kl li lj lk kp ll lm ln lo ij bi translated">现在让我们看看在 fastai 中我们是如何做到这一点的。我们首先加载一个预训练的模型。</p><figure class="lv lw lx ly gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi lz"><img src="../Images/f59928a318e22e2d2fcf7c8b07b87845.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aGEVL0P3bJuNtcBXNWl57w.png"/></div></div></figure><p id="c675" class="pw-post-body-paragraph ku kv iq kw b kx lp kz la lb lq ld le kh lr lg lh kl ls lj lk kp lt lm ln lo ij bi translated">最初，我们只训练增加的层。我们这样做是因为这些层的权重被初始化为随机值，并且比 ResNet 层需要更多的训练。因此，我们只训练 ResNet 和网络的其余部分。</p><figure class="lv lw lx ly gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi me"><img src="../Images/11747c9284ed15b7642d373fed661036.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XQFvlK3gZISjDXyVMGg-oA.png"/></div></div></figure><p id="c9a1" class="pw-post-body-paragraph ku kv iq kw b kx lp kz la lb lq ld le kh lr lg lh kl ls lj lk kp lt lm ln lo ij bi translated">一旦我们稍微训练了最后几层，我们就可以<code class="fe ma mb mc md b">unfreeze</code>resnet 34 的各层了。然后我们为整个模型找到一个好的<a class="ae mf" href="https://medium.com/@dipam44/learning-rate-and-golf-87c8d4697e31" rel="noopener">学习率</a>并训练它。</p><figure class="lv lw lx ly gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mg"><img src="../Images/21c14b9debb8fc5c02322590aafe2935.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6ftVgTKij-eEi1unU1kuzg.png"/></div></div></figure><p id="ef6e" class="pw-post-body-paragraph ku kv iq kw b kx lp kz la lb lq ld le kh lr lg lh kl ls lj lk kp lt lm ln lo ij bi translated">我们的学习率与损失的关系如下图所示。</p><figure class="lv lw lx ly gt jr gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/9e461b124d6108f954c576763b0aefdd.png" data-original-src="https://miro.medium.com/v2/resize:fit:778/format:webp/1*YP8ERnwI1kL2-_2AvVgcIQ.png"/></div></figure><p id="7c5b" class="pw-post-body-paragraph ku kv iq kw b kx lp kz la lb lq ld le kh lr lg lh kl ls lj lk kp lt lm ln lo ij bi translated">我们不希望我们的损失增加。因此，我们选择一个<a class="ae mf" href="https://medium.com/@dipam44/learning-rate-and-golf-87c8d4697e31" rel="noopener">学习率</a>刚好在图形开始上升之前(这里是 1e-04)。另一个选项，也是我用过的选项，是选择一个切片。</p><figure class="lv lw lx ly gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mi"><img src="../Images/27abc10b810f3d42ab84398500ac2160.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hM2gJddU-kR4eOVFhX1JHA.png"/></div></div></figure><p id="a54c" class="pw-post-body-paragraph ku kv iq kw b kx lp kz la lb lq ld le kh lr lg lh kl ls lj lk kp lt lm ln lo ij bi translated">这意味着，如果我们的网络中只有 3 层，第一层将以学习速率= 1e-6 进行训练，第二层以 1e-5 进行训练，最后一层以 1e-4 进行训练。框架通常将网络的层分成组，在这种情况下，切片意味着不同的组以不同的学习速率训练。</p><p id="d765" class="pw-post-body-paragraph ku kv iq kw b kx lp kz la lb lq ld le kh lr lg lh kl ls lj lk kp lt lm ln lo ij bi translated">我们这样做是因为我们不想大量更新初始图层的值，但我们希望大量更新最终图层的值。因此有了切片。</p><p id="62e9" class="pw-post-body-paragraph ku kv iq kw b kx lp kz la lb lq ld le kh lr lg lh kl ls lj lk kp lt lm ln lo ij bi translated">这种以不同的学习速率训练神经网络不同部分的概念被称为<strong class="kw ir"> <em class="mj">【区别学习】</em> </strong>，是深度学习中相对较新的概念。</p><p id="af4b" class="pw-post-body-paragraph ku kv iq kw b kx lp kz la lb lq ld le kh lr lg lh kl ls lj lk kp lt lm ln lo ij bi translated">我们继续解冻层的过程，找到一个好的<a class="ae mf" href="https://becominghuman.ai/learning-rate-and-golf-87c8d4697e31" rel="noopener ugc nofollow" target="_blank">学习率</a>并训练更多的层，直到我们得到好的结果。</p><p id="3a9e" class="pw-post-body-paragraph ku kv iq kw b kx lp kz la lb lq ld le kh lr lg lh kl ls lj lk kp lt lm ln lo ij bi translated">最后，预训练模型不仅可用于计算机视觉应用，还可用于其他领域，如自然语言处理。</p><p id="9bfb" class="pw-post-body-paragraph ku kv iq kw b kx lp kz la lb lq ld le kh lr lg lh kl ls lj lk kp lt lm ln lo ij bi translated">我们现在可以继续讨论计算机视觉项目的技巧了。</p></div><div class="ab cl mk ml hu mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="ij ik il im in"><h2 id="d659" class="jy jz iq bd ka kb kc dn kd ke kf dp kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">渐进式图像缩放</h2><p id="0acb" class="pw-post-body-paragraph ku kv iq kw b kx ky kz la lb lc ld le kh lf lg lh kl li lj lk kp ll lm ln lo ij bi translated">提高计算机视觉模型性能的一个技巧是为较低分辨率的图像(例如大小= 128)训练一个模型，并使用这些权重作为较高分辨率图像(大小= 256，然后 512，以此类推)的初始值。这种技巧被称为<strong class="kw ir"> <em class="mj">渐进式图像缩放</em> </strong>。我在我的一个项目中使用了它，我的模型的性能提高了 2%。</p><p id="5755" class="pw-post-body-paragraph ku kv iq kw b kx lp kz la lb lq ld le kh lr lg lh kl ls lj lk kp lt lm ln lo ij bi translated">现在，从 92%增加到 94%可能听起来没什么大不了的，但如果我们处理医疗应用，我们希望尽可能准确。正是这些小技巧将优秀的模特与竞赛获奖的模特区分开来。<a class="ae mf" href="https://arxiv.org/abs/1812.01187" rel="noopener ugc nofollow" target="_blank">阅读这篇研究论文，了解更多类似的技巧</a>。不是所有的方法每次都有效，但是你真的必须尝试和试验什么有效，什么无效，直到你有了感觉。</p><p id="5886" class="pw-post-body-paragraph ku kv iq kw b kx lp kz la lb lq ld le kh lr lg lh kl ls lj lk kp lt lm ln lo ij bi translated">这就是本文的全部内容</p><p id="548e" class="pw-post-body-paragraph ku kv iq kw b kx lp kz la lb lq ld le kh lr lg lh kl ls lj lk kp lt lm ln lo ij bi translated">如果你想了解更多关于深度学习的知识，可以看看我在这方面的系列文章:</p><div class="mr ms gp gr mt mu"><a href="https://medium.com/@dipam44/deep-learning-series-30ad108fbe2b" rel="noopener follow" target="_blank"><div class="mv ab fo"><div class="mw ab mx cl cj my"><h2 class="bd ir gy z fp mz fr fs na fu fw ip bi translated">深度学习系列</h2><div class="nb l"><h3 class="bd b gy z fp mz fr fs na fu fw dk translated">我所有关于深度学习的文章的系统列表</h3></div><div class="nc l"><p class="bd b dl z fp mz fr fs na fu fw dk translated">medium.com</p></div></div><div class="nd l"><div class="ne l nf ng nh nd ni jw mu"/></div></div></a></div><p id="75e1" class="pw-post-body-paragraph ku kv iq kw b kx lp kz la lb lq ld le kh lr lg lh kl ls lj lk kp lt lm ln lo ij bi translated">~快乐学习。</p></div></div>    
</body>
</html>