<html>
<head>
<title>Tips for cost-effective machine learning project</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">经济高效的机器学习项目提示</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/tips-for-cost-effective-machine-learning-project-6dbc715e7c59?source=collection_archive---------19-----------------------#2019-10-26">https://towardsdatascience.com/tips-for-cost-effective-machine-learning-project-6dbc715e7c59?source=collection_archive---------19-----------------------#2019-10-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="48f5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">剧透:你不需要一个 24/7 运行的虚拟机一天处理 16 个请求。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/9206be65be2c6a04c5d4845709ee5512.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*brUgDS6JHsbhCElssV0ebA.jpeg"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk">Street art by <a class="ae lb" href="https://www.instagram.com/MikeMozart/" rel="noopener ugc nofollow" target="_blank">Mike Mozart</a></figcaption></figure><p id="e142" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你刚刚发布了一个机器学习项目。它可以是你刚起步的新产品，可以是客户演示的概念验证，也可以是丰富你的投资组合的个人项目。你不是在寻找一个生产级网站；你想完成工作。为了便宜。这样一些用户就可以测试你的产品。</p><p id="ca65" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="lc">如何经济高效地提供您的项目？</em></p><p id="bc1f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这篇文章是对<a class="ae lb" rel="noopener" target="_blank" href="/how-to-build-and-deploy-a-lyrics-generation-model-framework-agnostic-589f3026fd53?source=friends_link&amp;sk=654cb3e2e52eccb7aead2a374311d13a">这篇</a>前一篇文章的后续和更新，在那篇文章中，我介绍了<a class="ae lb" href="https://raplyrics.eu/?utm_source=medium&amp;utm_medium=cost-effective-ml&amp;utm_campaign=medium-october" rel="noopener ugc nofollow" target="_blank"> raplyrics.eu </a>，这是一个使用 ML 生成说唱音乐歌词的文本生成网络应用。</p><p id="0c8f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">到目前为止，这个项目已经提供了一年的笑点。我在此分享更新的架构，它使我们将云提供商的账单从每月 50 美元减少到每月不到 1 美元。</p><p id="138a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我使用这个项目作为例子，但是这里讨论的建议适用于每个具有灵活延迟需求的类似项目。</p><h2 id="5124" class="ld le iq bd lf lg lh dn li lj lk dp ll jy lm ln lo kc lp lq lr kg ls lt lu lv bi translated">期待什么？</h2><p id="8e16" class="pw-post-body-paragraph jn jo iq jp b jq lx js jt ju ly jw jx jy lz ka kb kc ma ke kf kg mb ki kj kk ij bi translated">首先，我描述了服务的架构以及我们想要交付的内容。然后，我定义实现我们目标的可能方法。最后，我重点介绍了我们如何使用无服务器功能大幅降低计算成本。</p><h1 id="1f33" class="mc le iq bd lf md me mf li mg mh mi ll mj mk ml lo mm mn mo lr mp mq mr lu ms bi translated">服务剖析</h1><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mt"><img src="../Images/fef665754344f51e97b724126211385d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O_npKinc0EhKxAEfL_xHyw.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk">First the user fetches the static assets, then locally executes the JS that calls the prediction server to generate lyrics.</figcaption></figure><ol class=""><li id="a0ab" class="mu mv iq jp b jq jr ju jv jy mw kc mx kg my kk mz na nb nc bi translated">首先，用户获取静态文件。</li><li id="c1c9" class="mu mv iq jp b jq nd ju ne jy nf kc ng kg nh kk mz na nb nc bi translated">然后，用户在本地调用预测服务器。</li><li id="cbda" class="mu mv iq jp b jq nd ju ne jy nf kc ng kg nh kk mz na nb nc bi translated">最后，服务器返回预测。</li></ol><p id="8bd7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在最初的解决方案和下面介绍的新解决方案之间，关注点的逻辑分离保持不变。我们只更新底层技术。</p><h1 id="a719" class="mc le iq bd lf md me mf li mg mh mi ll mj mk ml lo mm mn mo lr mp mq mr lu ms bi translated">初始解决方案设计</h1><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ni"><img src="../Images/b7297292030d41f6c80278e8cb8cae91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wlwiLumffCop3tiHnrwmhw.jpeg"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk">What paying 600$ a year for a porftolio project feels like — Photo by <a class="ae lb" href="https://unsplash.com/@jpvalery?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Jp Valery</a> on <a class="ae lb" href="https://unsplash.com/collections/8753032/cost-effective-ml-project/e9374c4c44b5cb16687580df803c7459?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="9be4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当我们开发 raplyrics 时，我们希望它非常简单。它最初是一个在我们的机器上构建和测试的项目。然后，我们把它推到了云端。</p><p id="044e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">目前，有几种服务于机器学习模型的方法。以前，我们想弄脏自己的手，所以我们实施了<em class="lc">我们的</em>服务策略。</p><p id="12f1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">建议:不要开发<em class="lc">你自己的</em>机器学习模型服务框架——成熟的解决方案，如<a class="ae lb" href="https://www.tensorflow.org/tfx/guide/serving" rel="noopener ugc nofollow" target="_blank"> tensorflow serving </a>已经存在。TF Serving 有详尽的文档，会比自己动手更有效率。</p><p id="e1fa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">话虽如此，让我们回到我们的项目。我们把前面和后面分开；</p><ol class=""><li id="7f36" class="mu mv iq jp b jq jr ju jv jy mw kc mx kg my kk mz na nb nc bi translated">客户端层是一个 Apache Http 服务器</li><li id="a112" class="mu mv iq jp b jq nd ju ne jy nf kc ng kg nh kk mz na nb nc bi translated">服务器层是运行歌词生成模型的 Python flask 应用程序。</li></ol><p id="c705" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们购买了一个领域模型，将我们的代码部署到一个 EC2 上，并且准备好为用户服务。</p><h2 id="7704" class="ld le iq bd lf lg lh dn li lj lk dp ll jy lm ln lo kc lp lq lr kg ls lt lu lv bi translated">问题是</h2><p id="8878" class="pw-post-body-paragraph jn jo iq jp b jq lx js jt ju ly jw jx jy lz ka kb kc ma ke kf kg mb ki kj kk ij bi translated">在<em class="lc">免费试用期到期</em>之前，一切都是乐趣和游戏。在最初的 12 个月之后，在 2019 年 9 月为 32 个用户服务时，这个单个项目的每月账单飙升至<strong class="jp ir"> ~每月 45/50 美元</strong>。</p><p id="5a81" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">事实是，我们有一个 2GB Ram 的虚拟机，全天候运行，为几十个用户提供服务。</p><h1 id="643d" class="mc le iq bd lf md me mf li mg mh mi ll mj mk ml lo mm mn mo lr mp mq mr lu ms bi translated">更新的解决方案设计</h1><p id="da60" class="pw-post-body-paragraph jn jo iq jp b jq lx js jt ju ly jw jx jy lz ka kb kc ma ke kf kg mb ki kj kk ij bi translated">在免费试用之后，很明显我们处理这个项目的方式中有些地方<em class="lc">出了问题</em>。</p><p id="896f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们服务的典型用户知道这个网站是一个个人项目；它设定了期望的水平。</p><p id="f444" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">典型的用户生成一打歌词，然后离开。</p><p id="f0f1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们知道<em class="lc">我们想要实现什么</em>，服务一个两层架构，前端处理调用服务生成歌词的用户输入。前后松耦合。(仅指前端的后端端点)。</p><p id="f622" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有哪些可能性，可能的<em class="lc">如何？</em></p><h2 id="0074" class="ld le iq bd lf lg lh dn li lj lk dp ll jy lm ln lo kc lp lq lr kg ls lt lu lv bi translated"><strong class="ak">列出选项</strong></h2><ul class=""><li id="65c7" class="mu mv iq jp b jq lx ju ly jy nj kc nk kg nl kk nm na nb nc bi translated">A —将同一个项目部署到另一个提供免费积分的云提供商。重复一遍。</li></ul><p id="aa7d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">那是可能的。例如，如果你来自 AWS，GCP 的 300 美元信用可以让你运行一段时间。也许你只需要在有限的时间内为客户提供这个投资组合项目或概念证明。</p><p id="643e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们想把我们的项目保留一段时间；选项 A 不太适合。</p><ul class=""><li id="f2e3" class="mu mv iq jp b jq jr ju jv jy mw kc mx kg my kk nm na nb nc bi translated">B —为客户端层使用静态网站，通过对<a class="ae lb" href="https://en.wikipedia.org/wiki/Serverless_computing" rel="noopener ugc nofollow" target="_blank">无服务器计算</a>的 API 调用来服务请求。</li></ul><p id="b087" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">什么是无服务器计算？</strong></p><blockquote class="nn no np"><p id="a63d" class="jn jo lc jp b jq jr js jt ju jv jw jx nq jz ka kb nr kd ke kf ns kh ki kj kk ij bi translated">无服务器计算是一种按需提供后端服务的方法。服务器仍在使用，但从无服务器供应商那里获得后端服务的公司是根据使用情况收费的，而不是固定的带宽量或服务器数量。—来自<a class="ae lb" href="https://www.cloudflare.com/learning/serverless/what-is-serverless/" rel="noopener ugc nofollow" target="_blank"> CloudFare </a></p></blockquote><p id="c7e3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们选择了选项 B，使用静态网站并在无服务器计算服务上公开我们的 API。选项 B 的缺点是增加了冷启动时的延迟。冷启动是无服务器计算服务的第一次运行；它通常需要比 W <em class="lc">臂启动</em>更长的时间。</p><h2 id="6be6" class="ld le iq bd lf lg lh dn li lj lk dp ll jy lm ln lo kc lp lq lr kg ls lt lu lv bi translated">静态网站和运行中无服务器计算机</h2><p id="cc48" class="pw-post-body-paragraph jn jo iq jp b jq lx js jt ju ly jw jx jy lz ka kb kc ma ke kf kg mb ki kj kk ij bi translated">既然我们已经定义了我们想要如何去做，我们可以专注于技术的选择。</p><p id="8cd0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">托管静态页面</strong></p><p id="c01d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">存在多种静态托管解决方案。我们选择了 Netlify。很容易在最少的时间内完成这项工作。在 Netlify 上，使用自定义域名的基本主机和 SSL 证书是免费的。</p><p id="0aac" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">用无服务器计算服务 API</strong></p><p id="03e7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">每个云提供商都提供无服务器计算服务；我们选择了谷歌云及其云功能。</p><p id="e86c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Google cloud 有一个<a class="ae lb" href="https://cloud.google.com/blog/products/ai-machine-learning/how-to-serve-deep-learning-models-using-tensorflow-2-0-with-cloud-functions" rel="noopener ugc nofollow" target="_blank">教程</a>是关于如何通过云功能来服务机器学习模型的。以本教程为基础，我们可以通过一点点重构来服务我们的模型。</p><p id="29c3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">每个云提供商倾向于以略微不同的方式处理他们如何提供云功能。谷歌云还提供基于 Dockerfile 的无服务器计算服务 Cloud Run。使用 Dockerfiles 可以更容易地将项目从一个云提供商转移到另一个云提供商。</p><p id="fa50" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">冷启动延迟</strong></p><p id="e9cb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于冷启动，我们必须从桶中装载模型重量(150Mb)。然后，python 应用程序加载权重。在这些情况下，响应时间最长可达 40 秒。对于热启动，响应时间通常低于 2 秒。对于投资组合项目，我们可以接受这种成本/延迟权衡。<br/>我们在前端添加了一些用户界面元素，使第一次预测更加清晰，这可能需要一些时间。</p><h1 id="5151" class="mc le iq bd lf md me mf li mg mh mi ll mj mk ml lo mm mn mo lr mp mq mr lu ms bi translated">外卖食品</h1><p id="f60b" class="pw-post-body-paragraph jn jo iq jp b jq lx js jt ju ly jw jx jy lz ka kb kc ma ke kf kg mb ki kj kk ij bi translated">你不需要一个完整的生产规模来为你的小项目服务。以最具成本效益的解决方案为目标。</p><ul class=""><li id="943f" class="mu mv iq jp b jq jr ju jv jy mw kc mx kg my kk nm na nb nc bi translated">投资组合项目的延迟需求与生产服务的延迟需求不同。</li><li id="6ddd" class="mu mv iq jp b jq nd ju ne jy nf kc ng kg nh kk nm na nb nc bi translated">静态网站和使用基于无服务器计算的 API 是服务于你的项目的一个划算的解决方案。</li></ul><p id="4d3c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">需要一些技巧来处理状态，有效地从网络加载资源，但是这样做的经济性值得一试。</p><p id="b32e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">感谢 Cyril 对这篇文章的深思熟虑的反馈。</p><h2 id="b2af" class="ld le iq bd lf lg lh dn li lj lk dp ll jy lm ln lo kc lp lq lr kg ls lt lu lv bi translated">资源</h2><p id="477a" class="pw-post-body-paragraph jn jo iq jp b jq lx js jt ju ly jw jx jy lz ka kb kc ma ke kf kg mb ki kj kk ij bi translated">Raplyrics 源代码可在<a class="ae lb" href="https://github.com/cyrilou242/RapLyrics-Back/tree/fast_lyricst" rel="noopener ugc nofollow" target="_blank"> GithHub </a>上获得。</p><p id="37e1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">托管静态网站</strong></p><ul class=""><li id="0f61" class="mu mv iq jp b jq jr ju jv jy mw kc mx kg my kk nm na nb nc bi translated">在亚马逊 S3 上托管一个静态网站，<a class="ae lb" href="https://docs.aws.amazon.com/AmazonS3/latest/dev/WebsiteHosting.html" rel="noopener ugc nofollow" target="_blank"> aws doc </a></li><li id="8f7e" class="mu mv iq jp b jq nd ju ne jy nf kc ng kg nh kk nm na nb nc bi translated">您和您的项目的网站，<a class="ae lb" href="https://pages.github.com" rel="noopener ugc nofollow" target="_blank"> GitHub 页面</a></li><li id="5aef" class="mu mv iq jp b jq nd ju ne jy nf kc ng kg nh kk nm na nb nc bi translated">托管一个静态网站，<a class="ae lb" href="https://cloud.google.com/storage/docs/hosting-static-website" rel="noopener ugc nofollow" target="_blank"> gcloud doc </a></li><li id="a4b9" class="mu mv iq jp b jq nd ju ne jy nf kc ng kg nh kk nm na nb nc bi translated">在几秒钟内部署您的站点，<a class="ae lb" href="https://www.netlify.com" rel="noopener ugc nofollow" target="_blank"> netlify </a></li></ul><p id="3358" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">无服务器计算服务</strong></p><ul class=""><li id="aac0" class="mu mv iq jp b jq jr ju jv jy mw kc mx kg my kk nm na nb nc bi translated">AWS——运行代码时不考虑 AWS 上的服务器，<a class="ae lb" href="https://aws.amazon.com/lambda/" rel="noopener ugc nofollow" target="_blank"/></li><li id="549e" class="mu mv iq jp b jq nd ju ne jy nf kc ng kg nh kk nm na nb nc bi translated">Google Cloud——事件驱动的无服务器计算平台，<a class="ae lb" href="https://cloud.google.com/functions/" rel="noopener ugc nofollow" target="_blank"> gcloud functions </a></li><li id="4859" class="mu mv iq jp b jq nd ju ne jy nf kc ng kg nh kk nm na nb nc bi translated">Azure——事件驱动的无服务器计算，<a class="ae lb" href="https://azure.microsoft.com/en-us/services/functions/" rel="noopener ugc nofollow" target="_blank"> Azure functions </a></li><li id="bfee" class="mu mv iq jp b jq nd ju ne jy nf kc ng kg nh kk nm na nb nc bi translated">阿里巴巴——全托管无服务器运行环境，<a class="ae lb" href="https://www.alibabacloud.com/products/function-compute" rel="noopener ugc nofollow" target="_blank">函数计算</a></li></ul></div></div>    
</body>
</html>