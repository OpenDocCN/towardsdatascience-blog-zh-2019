<html>
<head>
<title>Automatic Speech Recognition as a Microservice on AWS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">自动语音识别作为 AWS 上的微服务</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/automatic-speech-recognition-as-a-microservice-on-aws-6da646631fdb?source=collection_archive---------20-----------------------#2019-11-04">https://towardsdatascience.com/automatic-speech-recognition-as-a-microservice-on-aws-6da646631fdb?source=collection_archive---------20-----------------------#2019-11-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/ddd097b87e35e1b0007556371d29dcba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lxzUAlYPGuapEkS54qJSWw.jpeg"/></div></div></figure><p id="d573" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">本文将帮助您在 AWS 基础设施上使用 Kaldi Toolkit 建立自己的 ASR 管道，为您提供可伸缩性和高可用性的选择。</p><p id="bd4b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">本文假设读者对云计算和相关术语有必要的了解，此外，任何实际经验都可以帮助您在一个小时内完成所有工作！</p><p id="c894" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在我开始阅读设置这个管道的指导手册之前，让我们先来看一下三个基本问题</p><blockquote class="kz la lb"><p id="b48a" class="kb kc lc kd b ke kf kg kh ki kj kk kl ld kn ko kp le kr ks kt lf kv kw kx ky im bi translated">这个工具是做什么的？</p><p id="f9c1" class="kb kc lc kd b ke kf kg kh ki kj kk kl ld kn ko kp le kr ks kt lf kv kw kx ky im bi translated">简而言之，用户上传任何英语音频文件，该工具将提供相同的转录并存储到数据库中，然后可用于各种用例</p><p id="0fa4" class="kb kc lc kd b ke kf kg kh ki kj kk kl ld kn ko kp le kr ks kt lf kv kw kx ky im bi translated"><strong class="kd iu">为什么要打造这个工具？</strong></p><p id="ae13" class="kb kc lc kd b ke kf kg kh ki kj kk kl ld kn ko kp le kr ks kt lf kv kw kx ky im bi translated">对于那些业务围绕音频/音频形式的对话的人来说，构建这样一个工具不仅会在文本分析方面开辟无限的可能性，还能让他们开发自己的自助产品。</p><p id="796f" class="kb kc lc kd b ke kf kg kh ki kj kk kl ld kn ko kp le kr ks kt lf kv kw kx ky im bi translated">请注意，在语音转文本领域，这种技术非常少！</p></blockquote><h2 id="d6d0" class="lg lh it bd li lj lk dn ll lm ln dp lo km lp lq lr kq ls lt lu ku lv lw lx ly bi translated"><strong class="ak">平视</strong></h2><p id="5219" class="pw-post-body-paragraph kb kc it kd b ke lz kg kh ki ma kk kl km mb ko kp kq mc ks kt ku md kw kx ky im bi translated">这个工具利用了<a class="ae me" href="https://kaldi-asr.org/models/m1" rel="noopener ugc nofollow" target="_blank"> Kaldi 预先训练好的神经网络</a>英语模型来转录成文本。虽然这个模型的词汇量相当大，但是仍然不足以为您的用例选择非常罕见/特定的单词。</p><figure class="mg mh mi mj gt ju gh gi paragraph-image"><div class="gh gi mf"><img src="../Images/f85ce6e42ab1ded20e9d9dd4e26d20c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:498/format:webp/1*fozY-xjc-9zAj8CNyJ5Fmw.png"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk">Kaldi Logo</figcaption></figure><p id="bb96" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">有没有可能<br/> </strong>有，是开源项目。如果你在定制方面需要帮助，请随时联系我</p><h2 id="5fa6" class="lg lh it bd li lj lk dn ll lm ln dp lo km lp lq lr kq ls lt lu ku lv lw lx ly bi translated"><strong class="ak">架构</strong></h2><p id="ec72" class="pw-post-body-paragraph kb kc it kd b ke lz kg kh ki ma kk kl km mb ko kp kq mc ks kt ku md kw kx ky im bi translated">介绍完毕，让我们深入应用程序的数据流。该架构本质上为您提供了我们使用 AWS 基础设施的工具的鸟瞰图</p><figure class="mg mh mi mj gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mo"><img src="../Images/d42df5c2c8d2906ada7d91c854877e30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F9kMQ1OXT8rB600J9_DUNg.png"/></div></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk">AWS Architecture of the Tool we will develop. Repeated numbers depict that some processes happen in parallel to others. By the time time steps [2 &gt; 3 &gt; 8] happen, [3 &gt; 4 &gt; 5 &gt; 6 &gt; 7] will have finished processing</figcaption></figure><h2 id="db7d" class="lg lh it bd li lj lk dn ll lm ln dp lo km lp lq lr kq ls lt lu ku lv lw lx ly bi translated"><strong class="ak">合适的工具</strong></h2><p id="3a42" class="pw-post-body-paragraph kb kc it kd b ke lz kg kh ki ma kk kl km mb ko kp kq mc ks kt ku md kw kx ky im bi translated">我们可以在一台服务器上从头到尾执行每一个动作，就这样！当设计作为几乎所有产品核心组件的数据管道时，我们需要开始研究数据工程的基础知识</p><p id="f13e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">从技术的角度来看，对于一个产品，并且最终会被大量用户使用的东西来说，这三条规则是必不可少的</p><ol class=""><li id="d086" class="mp mq it kd b ke kf ki kj km mr kq ms ku mt ky mu mv mw mx bi translated">成本效益:有没有更便宜的方法来做这件事，而又不影响质量？</li><li id="ec09" class="mp mq it kd b ke my ki mz km na kq nb ku nc ky mu mv mw mx bi translated"><strong class="kd iu">高可用性:</strong>如果其中一台服务器崩溃，那么整个产品会崩溃吗？</li><li id="39a0" class="mp mq it kd b ke my ki mz km na kq nb ku nc ky mu mv mw mx bi translated">可伸缩性:我们能让这个工具自己处理峰值负载吗？</li></ol><p id="fbe5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">即使你的工具只是另一个 MVP，不遵守这 3 条规则可能会成为你的产品的一个昂贵的错误。于是，<a class="ae me" href="https://aws.amazon.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="kd iu"> AWS 云</strong> </a></p><p id="1de6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">虽然 AWS 有一套广泛的工具，但明智地选择它们就更有道理了。以下是我们用来开发工具的 AWS 工具列表，其中大多数工具都包含在<a class="ae me" href="https://aws.amazon.com/free/" rel="noopener ugc nofollow" target="_blank"> <strong class="kd iu"> AWS 自由层</strong> </a>中。不过，在某些时候，你的使用可能会收费。我建议你在开始实施之前留意一下价格。</p><ol class=""><li id="4bb5" class="mp mq it kd b ke kf ki kj km mr kq ms ku mt ky mu mv mw mx bi translated"><strong class="kd iu"> S3: </strong>简单的仓储服务。你能得到的最便宜的存储</li><li id="dced" class="mp mq it kd b ke my ki mz km na kq nb ku nc ky mu mv mw mx bi translated"><strong class="kd iu"> EC2: </strong>计算服务器。<em class="lc"> t3a.xlarge 实例</em></li><li id="81c7" class="mp mq it kd b ke my ki mz km na kq nb ku nc ky mu mv mw mx bi translated"><strong class="kd iu">动力数据库:</strong> NoSQL 数据库</li><li id="1dc2" class="mp mq it kd b ke my ki mz km na kq nb ku nc ky mu mv mw mx bi translated"><strong class="kd iu"> Lambda: </strong>大规模处理小脚本执行的计算服务</li><li id="0774" class="mp mq it kd b ke my ki mz km na kq nb ku nc ky mu mv mw mx bi translated"><strong class="kd iu"> AWS API: </strong>很好的选择，因为很难编写可伸缩的 API 服务</li></ol><h2 id="a71c" class="lg lh it bd li lj lk dn ll lm ln dp lo km lp lq lr kq ls lt lu ku lv lw lx ly bi translated"><strong class="ak">建立基础设施</strong></h2><p id="f940" class="pw-post-body-paragraph kb kc it kd b ke lz kg kh ki ma kk kl km mb ko kp kq mc ks kt ku md kw kx ky im bi translated">你可以利用 GitHub 上的代码让你的 Infra 马上发挥作用！</p><p id="633f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">Github:</strong>T24】https://github.com/purijs/kaldi-asr-aws</p><p id="f52f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">请参考 Github 上的<a class="ae me" href="https://github.com/purijs/kaldi-asr-aws/blob/master/README.md" rel="noopener ugc nofollow" target="_blank"> <strong class="kd iu"> README.md </strong> </a>文件，它详细解释了如何在 EC2 实例上设置一切。</p><p id="e5f7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">你可以自由选择任何一种 EC2 机器。然而，我发现下面的配置足以实现这个管道</p><ol class=""><li id="5d21" class="mp mq it kd b ke kf ki kj km mr kq ms ku mt ky mu mv mw mx bi translated">EC2: <strong class="kd iu"> t3a.xlarge </strong></li><li id="096d" class="mp mq it kd b ke my ki mz km na kq nb ku nc ky mu mv mw mx bi translated">50GB 磁盘空间</li><li id="df70" class="mp mq it kd b ke my ki mz km na kq nb ku nc ky mu mv mw mx bi translated">图片:<strong class="kd iu">亚马逊 Linux 2 AMI (HVM) </strong></li><li id="7137" class="mp mq it kd b ke my ki mz km na kq nb ku nc ky mu mv mw mx bi translated">安全组:<strong class="kd iu">打开端口 80 (HTTP)、8080 (FLASK)和 22 (SSH) </strong></li></ol><blockquote class="nd"><p id="0e2d" class="ne nf it bd ng nh ni nj nk nl nm ky dk translated">由于这种类型的 EC2 实例不包括在<strong class="ak">自由层</strong>中，您可能会在这一点上产生成本。如果您无论如何都要获得它，请确保它处于<strong class="ak">停止状态</strong>，因为我们不会马上使用它</p></blockquote><p id="e4cb" class="pw-post-body-paragraph kb kc it kd b ke nn kg kh ki no kk kl km np ko kp kq nq ks kt ku nr kw kx ky im bi translated">继续使用上面的配置获取 EC2 实例，并将上面的 Git 存储库克隆到您的服务器中。一旦您做好了设置，我们将在 AWS 控制台上完成以下步骤</p><blockquote class="kz la lb"><p id="8243" class="kb kc lc kd b ke kf kg kh ki kj kk kl ld kn ko kp le kr ks kt lf kv kw kx ky im bi translated">-创建一个具有 S3 读/写权限的 IAM 角色并将其附加到您的实例<br/> -为 lambda 函数创建一个 IAM 角色以读取/写入 DynamoDB <br/> -配置 S3 桶<br/> -编写第一个 Lambda 函数以读取音频文件的元数据<br/> -设置 AWS API 以触发我们的第一个 Lambda 函数<br/> -使用 Kaldi ASR 配置 EC2 实例(此时克隆 git 代码！)<br/> -编写第二个 lambda 函数来读取/写入脚本到 DB <br/> -设置 DynamoDB <br/> -用 Flask App 链接管道</p></blockquote></div><div class="ab cl ns nt hx nu" role="separator"><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx"/></div><div class="im in io ip iq"><h1 id="fc5b" class="nz lh it bd li oa ob oc ll od oe of lo og oh oi lr oj ok ol lu om on oo lx op bi translated"><strong class="ak">实用</strong></h1><ol class=""><li id="f0e9" class="mp mq it kd b ke lz ki ma km oq kq or ku os ky mu mv mw mx bi translated"><strong class="kd iu">为 S3 制作 IAM 角色</strong></li></ol><div class="mg mh mi mj gt ab cb"><figure class="ot ju ou ov ow ox oy paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><img src="../Images/512e74dd512e84698229b64c4dbb08f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1006/format:webp/1*kjvIeOX7m1SXvbLx47zitA.png"/></div></figure><figure class="ot ju oz ov ow ox oy paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><img src="../Images/d5c265c709674f1f72b6d4163ea0371b.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/format:webp/1*QKq3NAlBoxLvMkyUlMT8TQ.png"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk pa di pb pc">Go to IAM from AWS Console, select “Create Role” and choose EC2 and “Next” | 2. Choose “S3FullAccess” in Policies | 3. Tags are optional, name this role and click “Create”</figcaption></figure></div><div class="ab cb"><figure class="ot ju pd ov ow ox oy paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><img src="../Images/037cf84015fce60475c674a63768b2b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:664/format:webp/1*GXvGu-8A-WZZPdgYdEqHtg.png"/></div></figure><figure class="ot ju pe ov ow ox oy paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><img src="../Images/b3edd619cefef134bf45539f6cd8a544.png" data-original-src="https://miro.medium.com/v2/resize:fit:1338/format:webp/1*jeF94gsAoSYpcaW3At15kg.png"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk pf di pg pc">To attach this role to your EC2 instance, 1. Go to the EC2 dashboard, select your instance, and choose “Actions” &gt; “Instance Settings” &gt; “Attach/Replace IAM Role” | 2. Select your role and continue.</figcaption></figure></div><p id="f842" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在，您可以运行“AWS s3”CLI 命令并从 EC2 访问 S3 存储桶，而无需使用/存储帐户密钥</p><p id="3d05" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> 2。为 Lambda 函数设置 IAM 角色</strong></p><div class="mg mh mi mj gt ab cb"><figure class="ot ju ph ov ow ox oy paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><img src="../Images/f69b9e50651d62efcfa4a68eb2acd261.png" data-original-src="https://miro.medium.com/v2/resize:fit:902/format:webp/1*Zi0DDnnIl1Ldxu2tfysFZQ.png"/></div></figure><figure class="ot ju pi ov ow ox oy paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><img src="../Images/3067dcdde93ff281527164d56c46a0c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*vYxXdfKQG5Kbou7sLrbmzA.png"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk pj di pk pc">Similarly, create a role for “Lambda”. Make sure you add permissions for DynamoDBFullAccess and S3FullAccess (Refer the screens above)</figcaption></figure></div><p id="bb3d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">【更新】:</strong>除了以上两个策略，还要加上这些:</p><ul class=""><li id="4797" class="mp mq it kd b ke kf ki kj km mr kq ms ku mt ky pl mv mw mx bi translated">CloudWatchFullAccess</li><li id="852c" class="mp mq it kd b ke my ki mz km na kq nb ku nc ky pl mv mw mx bi translated">LambdaFullAccess</li></ul><p id="3964" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> 3。配置 S3 铲斗</strong></p><p id="f6a7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在，我们已经为不同的 AWS 服务设置了必要的访问权限，接下来我们将设置第一个服务，即 S3</p><p id="7d0c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">目的:<br/></strong></p><p id="dcbb" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">传入:</strong>存储用户上传的音频文件，一经 EC2 处理将被删除</p><p id="bf31" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">传出:</strong>存储音频的抄本。txt 文件，稍后 Lambda 函数会读取该文件，然后将内容转储到 DynamoDB 中</p><div class="mg mh mi mj gt ab cb"><figure class="ot ju pm ov ow ox oy paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><img src="../Images/2a2ec6112cb42b0594bc4f4650e3e6cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1140/format:webp/1*OTDvTajBT5aIpyWUBQiUsQ.png"/></div></figure><figure class="ot ju pn ov ow ox oy paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><img src="../Images/593609bf062847f5f2d5fce45fbabfcc.png" data-original-src="https://miro.medium.com/v2/resize:fit:862/format:webp/1*TZ1js4yyanbPXElirNhK_w.png"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk po di pp pc">Go to S3 from console, create a new S3 Bucket, keeping all other settings to default (Changing region is fine, but make sure your Lambda Functions are also in the same region). Once created, make two directories as explained above</figcaption></figure></div><p id="8717" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> 4。第一个λ函数</strong></p><p id="c6f7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">简单来说，AWS Lambda 允许你运行<strong class="kd iu"> Python/NodeJS/Bash/etc。就像在 EC2 机器上运行一样编码。唯一的区别是，除了一些技术上的，你只在这段代码运行时才被收费，也就是说，对于每个触发器，它的伸缩性也很好！</strong></p><p id="8ca4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这个 lambda 函数将运行一个 Python 代码，该代码将读取存储在 S3 中的文件名，并将它们转储到 DynamoDB 中。</p><blockquote class="kz la lb"><p id="b175" class="kb kc lc kd b ke kf kg kh ki kj kk kl ld kn ko kp le kr ks kt lf kv kw kx ky im bi translated">这是参考架构图的步骤<strong class="kd iu"> 5、6 和 7 </strong></p><p id="e52a" class="kb kc lc kd b ke kf kg kh ki kj kk kl ld kn ko kp le kr ks kt lf kv kw kx ky im bi translated">注意我们是如何尽可能地去耦合组件的</p></blockquote><p id="c9eb" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">从 AWS 控制台的服务部分选择“Lambda”。确保您已经选择了“从头开始创作”框</p><div class="mg mh mi mj gt ab cb"><figure class="ot ju pq ov ow ox oy paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><img src="../Images/f029470c9553734ee947f5bdf6982fd0.png" data-original-src="https://miro.medium.com/v2/resize:fit:894/format:webp/1*9qy9lCc1tHLbKPvdhrLWag.png"/></div></figure><figure class="ot ju pr ov ow ox oy paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><img src="../Images/30dbc9c38711e9f2d408d03b827037d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1108/format:webp/1*TJgceqHcPzN0slHlTJyBEQ.png"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk ps di pt pc">1. Choose the runtime as “Python 3.6” as our code will be .py file | 2. In execution role, what all permissions your lambda function can have, choose ‘use existing role’ | 3. In the dropdown, select the role you previously created for <strong class="bd pu">Lambda</strong> in the 2nd step. Once done, you’ll see a screen like on the right</figcaption></figure></div><p id="463d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果向下滚动一点，您会看到一个集成的代码编辑器，其中包含一些虚拟 python 代码。继续替换下面 Git 链接中的代码:</p><div class="pv pw gp gr px py"><a href="https://github.com/purijs/kaldi-asr-aws/blob/master/lambda/incoming-lambda-handler.py" rel="noopener  ugc nofollow" target="_blank"><div class="pz ab fo"><div class="qa ab qb cl cj qc"><h2 class="bd iu gy z fp qd fr fs qe fu fw is bi translated">普里吉斯/卡尔迪-阿斯尔-aws</h2><div class="qf l"><h3 class="bd b gy z fp qd fr fs qe fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="qg l"><p class="bd b dl z fp qd fr fs qe fu fw dk translated">github.com</p></div></div></div></a></div><p id="af85" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">下一步，我们将有一个 AWS API 作为这个函数的触发器。</p><p id="d768" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">由于这是我们管道中的第一个执行阶段，当用户单击我们 web 页面上的“Submit”按钮时，会发生两个系列的事件。</p><ol class=""><li id="b026" class="mp mq it kd b ke kf ki kj km mr kq ms ku mt ky mu mv mw mx bi translated">文件被上传到你在上面创建的 S3 桶</li><li id="0e51" class="mp mq it kd b ke my ki mz km na kq nb ku nc ky mu mv mw mx bi translated">AWS API 被称为[POST],其中用户的文件名和电子邮件作为 JSON 值传递</li></ol><p id="8e7a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> 5。部署 AWS API </strong></p><p id="0490" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">从 AWS 控制台转到<strong class="kd iu"> API 网关</strong>部分，并按照下面共享的屏幕进行操作</p><div class="mg mh mi mj gt ab cb"><figure class="ot ju qh ov ow ox oy paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><img src="../Images/7dca56c29f2151f77b199bc8d2f8a03f.png" data-original-src="https://miro.medium.com/v2/resize:fit:778/format:webp/1*bHCEJ4CjTJSY1RnLAmJ5Rw.png"/></div></figure><figure class="ot ju qi ov ow ox oy paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><img src="../Images/969ec26bb9d220c6b1b741ae3ab5ad93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1224/format:webp/1*n2DumMgRZx2Mgz66Vi4zTw.png"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk qj di qk pc">1. On clicking the “Create API’ button, keep everything default. | 2. Click on ‘Actions” and choose ‘Create Resource’. Give it a name and enable CORS</figcaption></figure></div><div class="ab cb"><figure class="ot ju ql ov ow ox oy paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><img src="../Images/b7f0594aa5cb6bbd9dd16bd81a60c03f.png" data-original-src="https://miro.medium.com/v2/resize:fit:852/format:webp/1*lIbfEwBJivaY6-b_3c-rrg.png"/></div></figure><figure class="ot ju qm ov ow ox oy paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><img src="../Images/a8430a05c2aa2da8db7fa775d0f5ccf0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1150/format:webp/1*pJQw95OZrLeRH4mmAQaxMg.png"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk qn di qo pc">Once done, click on “Actions” again and choose “Create Method”. A dropdown will appear, select “POST” like in the screen on the left. 1. Set the integration type to “Lambda Function”, enable the “Proxy Integration”, finally, enter your Lambda Function’s name.</figcaption></figure></div><p id="f3c7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">再走几步…</p><div class="mg mh mi mj gt ab cb"><figure class="ot ju qp ov ow ox oy paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><img src="../Images/e839c91abf21c2b2799e0bf8717ba835.png" data-original-src="https://miro.medium.com/v2/resize:fit:1272/format:webp/1*7-kygBM9j67qqKsOyqxbBA.png"/></div></figure><figure class="ot ju qq ov ow ox oy paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><img src="../Images/f8131f30c052ad3706a086fa938a0f32.png" data-original-src="https://miro.medium.com/v2/resize:fit:730/format:webp/1*NoaOGI7Wz4APDtUSloeWeQ.png"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk qr di qs pc">Once you’ve created the resource and the screen like on the left is visible, click on “Method Request” and set <strong class="bd pu">API Key Required </strong>to <strong class="bd pu">True</strong></figcaption></figure></div><div class="ab cb"><figure class="ot ju qt ov ow ox oy paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><img src="../Images/c9897d7f246c1b3f3286b96be133b9e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:852/format:webp/1*FSgzhQlXPMLEdZwNgChoxQ.png"/></div></figure><figure class="ot ju qu ov ow ox oy paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><img src="../Images/e27ffc6159f5e91b5e38e71bf0f5e584.png" data-original-src="https://miro.medium.com/v2/resize:fit:1150/format:webp/1*klDc-O2WOSLdaQE0RbsnSA.png"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk qn di qo pc">Finally, click on “Actions” and select “Deploy API”. Give this stage a name eg: <strong class="bd pu">prod, dev, test. </strong>On clicking <strong class="bd pu">Deploy, </strong>you’ll see your API URL in front of the <strong class="bd pu">Invoke URL</strong> text</figcaption></figure></div><p id="6461" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">至此，您已经配置好了 API，并将其作为触发器添加到 Lambda 函数中。为了使这个 API 安全，这样你的 API 就不会在一夜之间暴露或耗尽，我们还必须设置一个 API 密钥。</p><p id="baf5" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><em class="lc">这一点至关重要，因为任何人都可以不断点击 API 的网址，很快，你的成本就会飙升。</em></p><div class="mg mh mi mj gt ab cb"><figure class="ot ju qv ov ow ox oy paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><img src="../Images/c485ae947f0ea19637d5c78af32e0120.png" data-original-src="https://miro.medium.com/v2/resize:fit:738/format:webp/1*NgM6kD3BPB92mgaaNjsdyQ.png"/></div></figure><figure class="ot ju qw ov ow ox oy paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><img src="../Images/b5382821a582f01150cbdb635762c93a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1264/format:webp/1*8t0bJWOjq2iVhCkD_imHFA.png"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk qx di qy pc">1. On the left side Navigation panel, click on “Usage Plan” and then “Create”. Most of the settings are self-explanatory. However, you may choose to keep the settings as in the left image. | 2. Click “Next” and select the correct <strong class="bd pu">API &amp; Stage</strong> you configured previously. Hit “Next” and then “Create API Key and add to Usage Plan”</figcaption></figure></div><div class="ab cb"><figure class="ot ju qz ov ow ox oy paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><img src="../Images/f25c39b2127ed28be4561393556c342d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1042/format:webp/1*SjHC8nUrYu_vqD-flSzkgw.png"/></div></figure><figure class="ot ju ra ov ow ox oy paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><img src="../Images/2e86e28a66b20b36462b05dccef6a7ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/1*Uf8ZUYlpdo29Ywbs1C9T5A.png"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk rb di rc pc">Give the Key a name and hit “Next”. You may click “API Keys” on the left navigation panel to view the <strong class="bd pu">key</strong></figcaption></figure></div><p id="79e8" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">就是这样！我们现在已经完成了管道，直到音频文件被传递到我们的 EC2 机器</p><blockquote class="kz la lb"><p id="2bf4" class="kb kc lc kd b ke kf kg kh ki kj kk kl ld kn ko kp le kr ks kt lf kv kw kx ky im bi translated">这些是参考架构图的步骤<strong class="kd iu"> 3 和 4 </strong></p></blockquote><p id="ef08" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">到目前为止，你在 AWS 上设置的所有东西都不会花你一分钱，因为有两个主要原因:</p><ol class=""><li id="2bbc" class="mp mq it kd b ke kf ki kj km mr kq ms ku mt ky mu mv mw mx bi translated">你在免费层(如果你第一次注册)</li><li id="e683" class="mp mq it kd b ke my ki mz km na kq nb ku nc ky mu mv mw mx bi translated">如果不是，没问题，服务 S3、Lambda 和 API 是按使用付费的。除非你使用它们，否则你不会被收费。</li></ol></div><div class="ab cl ns nt hx nu" role="separator"><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx"/></div><div class="im in io ip iq"><h1 id="041e" class="nz lh it bd li oa ob oc ll od oe of lo og oh oi lr oj ok ol lu om on oo lx op bi translated">卡尔迪·阿斯尔</h1><p id="7e19" class="pw-post-body-paragraph kb kc it kd b ke lz kg kh ki ma kk kl km mb ko kp kq mc ks kt ku md kw kx ky im bi translated">Kaldi 是一个强大的语音识别工具包，作为开源产品提供。该工具包或多或少是用 C/C++/Python 语言编写的，在 google groups 上也有一个非常活跃的支持/讨论社区。如果你有问题的话，这个工具包的创始人丹尼尔·波维是最会回答你的问题的人。</p><p id="63e7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">就像任何 ML 模型一样，ASR 模型可以针对您的特定语言/音频进行训练，或者我们可以使用在<a class="ae me" href="http://kaldi-asr.org/models.html" rel="noopener ugc nofollow" target="_blank"> <strong class="kd iu"> Kaldi 网站</strong> </a>上提供的预训练模型</p><p id="c20b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">虽然训练一个模型超出了本文的范围，但是我们将利用一个<strong class="kd iu">英语训练的神经网络模型。</strong>对于所有的神经网络爱好者来说，典型的 ASR 模型具有以下训练参数:</p><ul class=""><li id="1c55" class="mp mq it kd b ke kf ki kj km mr kq ms ku mt ky pl mv mw mx bi translated">大约 10 个时代</li><li id="5030" class="mp mq it kd b ke my ki mz km na kq nb ku nc ky pl mv mw mx bi translated">大约 10 到 13 个隐藏层，每个层有 1024 个维度</li></ul><p id="4795" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们场景中使用的预训练模型的 WER(单词错误率)约为<strong class="kd iu"> 15.6%，</strong>的意思，精确度约为<strong class="kd iu"> 85% </strong>。</p><h2 id="bd86" class="lg lh it bd li lj lk dn ll lm ln dp lo km lp lq lr kq ls lt lu ku lv lw lx ly bi translated"><strong class="ak"> ASR 解码</strong></h2><p id="b215" class="pw-post-body-paragraph kb kc it kd b ke lz kg kh ki ma kk kl km mb ko kp kq mc ks kt ku md kw kx ky im bi translated">让我们快速了解一下我们的 ASR 模型实际上是如何理解音频，然后能够组成有意义的句子的。ASR 解码利用训练时输入的多种资源，例如:</p><figure class="mg mh mi mj gt ju gh gi paragraph-image"><div class="gh gi rd"><img src="../Images/209a92462e2d6254af8318dfe91b0088.png" data-original-src="https://miro.medium.com/v2/resize:fit:1282/format:webp/1*Va2Y9AYiAuXen57rJTaOsw.png"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk">Source: One of the lectures from <a class="ae me" href="https://www.danielpovey.com/" rel="noopener ugc nofollow" target="_blank">https://www.danielpovey.com/</a></figcaption></figure><ul class=""><li id="a868" class="mp mq it kd b ke kf ki kj km mr kq ms ku mt ky pl mv mw mx bi translated"><strong class="kd iu">词库</strong>:带有各自<a class="ae me" href="https://www.dyslexia-reading-well.com/44-phonemes-in-english.html" rel="noopener ugc nofollow" target="_blank">音素</a>的单词列表，将音频与一个音素进行映射。一组音素组成一个单词</li><li id="e882" class="mp mq it kd b ke my ki mz km na kq nb ku nc ky pl mv mw mx bi translated">Ngrams :很多上升到 4 克，预测下一个可能的单词</li><li id="749e" class="mp mq it kd b ke my ki mz km na kq nb ku nc ky pl mv mw mx bi translated"><strong class="kd iu"> WFST:加权有限状态转换器:</strong>组合音素和单词并形成句子</li><li id="872e" class="mp mq it kd b ke my ki mz km na kq nb ku nc ky pl mv mw mx bi translated"><strong class="kd iu">好多数学！</strong></li></ul><p id="5803" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">虽然 Kaldi 必须提供许多模型，如<strong class="kd iu">单音、三音、SAT 模型</strong>，但链(神经网络)模型明显优于其他模型。</p><p id="dd85" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们将使用卡迪的<strong class="kd iu"> ASpIRE 链模型和已经编译好的 HCLG。</strong>这个包含在<a class="ae me" href="https://github.com/purijs/kaldi-asr-aws" rel="noopener ugc nofollow" target="_blank"> Github </a>上的<strong class="kd iu"> <em class="lc"> model.zip </em> </strong>文件中</p></div><div class="ab cl ns nt hx nu" role="separator"><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx"/></div><div class="im in io ip iq"><h1 id="0685" class="nz lh it bd li oa ob oc ll od oe of lo og oh oi lr oj ok ol lu om on oo lx op bi translated">实用的</h1><p id="a9a2" class="pw-post-body-paragraph kb kc it kd b ke lz kg kh ki ma kk kl km mb ko kp kq mc ks kt ku md kw kx ky im bi translated">让我们快速回到我们的实验室工作，用几个简单的步骤实现这个高度复杂的工作。此时，您应该已经启动 EC2 并进入其中。</p><p id="7e7e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">请参考<a class="ae me" href="https://github.com/purijs/kaldi-asr-aws" rel="noopener ugc nofollow" target="_blank"> <strong class="kd iu"> Github 资源库</strong> </a>中任何缺失的资源/链接</p><ol class=""><li id="f186" class="mp mq it kd b ke kf ki kj km mr kq ms ku mt ky mu mv mw mx bi translated">在您的主目录[ <strong class="kd iu"> /home/ec2-user </strong> ]中，维护以下目录结构</li></ol><pre class="mg mh mi mj gt re rf rg rh aw ri bi"><span id="4eec" class="lg lh it rf b gy rj rk l rl rm">D -&gt; Represents Directory<br/>F -&gt; Represents File</span><span id="c6b8" class="lg lh it rf b gy rn rk l rl rm">cd /home/ec2-user/</span><span id="4dd3" class="lg lh it rf b gy rn rk l rl rm">  -audios D [ Files from S3 will be synced here ]<br/>  -audiosKaldi D <br/>    -processing D [ Files ready for Transcription are moved here ]<br/>    -sendWavToProcess.sh F<br/>  -kaldi D<br/>    -Dockerfile F<br/>  -models D<br/>    -model.zip F (unzip here)<br/>    -transcriptMaster.sh F<br/>    -transcriptWorker.sh F<br/>  -output D [ Transcription in .txt file will be store here]<br/>  ffmpeg F<br/>  getConvertAudios.sh F<br/>  uploadOutput.sh F</span></pre><p id="5c82" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">帮助您快速入门的命令列表</p><pre class="mg mh mi mj gt re rf rg rh aw ri bi"><span id="1fb1" class="lg lh it rf b gy rj rk l rl rm">mkdir audios kaldi models output<br/>mkdir -p audiosKaldi/processing</span><span id="d821" class="lg lh it rf b gy rn rk l rl rm">wget -P /home/ec2-user/ <a class="ae me" href="https://johnvansickle.com/ffmpeg/releases/ffmpeg-release-amd64-static.tar.xz" rel="noopener ugc nofollow" target="_blank">https://johnvansickle.com/ffmpeg/releases/ffmpeg-release-amd64-static.tar.xz</a></span><span id="565f" class="lg lh it rf b gy rn rk l rl rm">tar -xvf ffmpeg-release-amd64-static.tar.xz</span><span id="d9ab" class="lg lh it rf b gy rn rk l rl rm">mv ffmpeg-4.2.1-amd64-static/ffmpeg ~/<br/>sudo chmod 755 ~/ffmpeg</span><span id="c171" class="lg lh it rf b gy rn rk l rl rm">wget -P /home/ec2-user/models/ <a class="ae me" href="https://crossregionreplpuri.s3.ap-south-1.amazonaws.com/model.zip" rel="noopener ugc nofollow" target="_blank">https://crossregionreplpuri.s3.ap-south-1.amazonaws.com/model.zip</a></span><span id="a840" class="lg lh it rf b gy rn rk l rl rm">unzip /home/ec2-user/models/model.zip -d /home/ec2-user/models/</span><span id="ed2b" class="lg lh it rf b gy rn rk l rl rm">sudo yum install -y git<br/>sudo yum install -y docker<br/>sudo service docker start<br/>alias docker='sudo docker'</span></pre><p id="a064" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> 2。接下来，我们需要在 crontab </strong>中创建一个条目</p><p id="e167" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">Crontab 会以固定的时间间隔自动运行我们的一些脚本。</p><pre class="mg mh mi mj gt re rf rg rh aw ri bi"><span id="5525" class="lg lh it rf b gy rj rk l rl rm">crontab -e</span><span id="bfca" class="lg lh it rf b gy rn rk l rl rm"># PASTE THESE 2 LINES</span><span id="e35f" class="lg lh it rf b gy rn rk l rl rm">*/1 * * * * sh ~/getConvertAudios.sh<br/>*/2 * * * * sh ~/uploadOutput.sh</span></pre><p id="7d13" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> 3。卡尔迪很严格</strong></p><p id="1a6a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在训练模型时作为输入给出的音频文件的属性需要在对新数据进行测试时得到维护。在我们的例子中，Kaldi 也将接受一种非常特殊的音频文件格式，主要是</p><ul class=""><li id="5bda" class="mp mq it kd b ke kf ki kj km mr kq ms ku mt ky pl mv mw mx bi translated">。wav 声音文件</li><li id="eaf2" class="mp mq it kd b ke my ki mz km na kq nb ku nc ky pl mv mw mx bi translated">8000 比特率</li></ul><p id="fb8f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">为了确保我们每次都有正确的格式，因为用户可以上传任何类型的音频文件，我们使用了<strong class="kd iu"> ffmpeg </strong>来转换音频文件。</p><p id="0eb2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">关于正在使用的<strong class="kd iu">外壳脚本</strong>的一些信息</p><pre class="mg mh mi mj gt re rf rg rh aw ri bi"><span id="f14a" class="lg lh it rf b gy rj rk l rl rm"><strong class="rf iu">getConvertAudios.sh</strong> -&gt; This script syncs files from S3 into audios/ directory and using ffmpeg converted and stored into audiosKaldi/</span><span id="191e" class="lg lh it rf b gy rn rk l rl rm"><strong class="rf iu">uploadOutput.sh </strong>-&gt; This script syncs the .txt files in output/ directory into S3 bucket</span><span id="91f8" class="lg lh it rf b gy rn rk l rl rm"><strong class="rf iu">sendWavToProcess.sh</strong> -&gt; This script limits the number of files for processing to the number of cores on the VM for parallel processing</span><span id="d1d7" class="lg lh it rf b gy rn rk l rl rm"><strong class="rf iu">transcriptMaster.sh</strong> -&gt; This script calls transcriptWorker.sh for every audio file placed in the <strong class="rf iu">processing</strong> folder and ensures at any time only <em class="lc">#no. of cores</em> amount of files are running</span><span id="4a10" class="lg lh it rf b gy rn rk l rl rm"><strong class="rf iu">transcriptWorker.sh </strong>-&gt; Where the magic happens, actual transcription happens through this file.</span></pre><p id="dab1" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> 4。设置 Kaldi Docker </strong></p><p id="e6a1" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们需要使用<strong class="kd iu"> Dockerfile </strong>构建 Kaldi 映像，这意味着安装 Kaldi 运行所需的依赖项。</p><pre class="mg mh mi mj gt re rf rg rh aw ri bi"><span id="1e86" class="lg lh it rf b gy rj rk l rl rm">cd kaldi/<br/>docker build -t kaldi . &amp;</span></pre><p id="2070" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这可能需要一个小时，所以是时候喝杯咖啡了！</p><p id="6b25" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">完成后，运行这个命令来启动 Kaldi 容器</p><pre class="mg mh mi mj gt re rf rg rh aw ri bi"><span id="83da" class="lg lh it rf b gy rj rk l rl rm">docker run -d -it --name kaldi -v ~/models:/models/ -v ~/audiosKaldi/processing:/audios/ -v ~/output:/output/ kaldi bash</span></pre><p id="437f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">最后，我们需要启动<strong class="kd iu"> sendWavToProcess.sh </strong>脚本，这样脚本就可以继续向 Kaldi 容器发送文件</p><pre class="mg mh mi mj gt re rf rg rh aw ri bi"><span id="0f3f" class="lg lh it rf b gy rj rk l rl rm">cd /home/ec2-user/audiosKaldi/<br/>sudo chmod 755 sendWavToProcess.sh<br/>./sendWavToProcess.sh &amp;</span><span id="9376" class="lg lh it rf b gy rn rk l rl rm"># Ignore any errors you see on your terminal</span></pre><p id="a92f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">确保您已经更新了这些文件中的存储桶名称:</p><pre class="mg mh mi mj gt re rf rg rh aw ri bi"><span id="11b6" class="lg lh it rf b gy rj rk l rl rm">getConvertAudios.sh<br/>uploadOutput.sh</span></pre><p id="0536" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> 5。第二λ函数</strong></p><p id="0358" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">由于 DynamoDB 支持动态模式，这意味着我们可以在数据库中动态创建新的字段/列，该函数将更新数据库中的当前记录，并添加一个名为<strong class="kd iu">抄本</strong>的新列</p><p id="5946" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果你还记得，我们创建了两个文件夹<strong class="kd iu">传入</strong> &amp;传出<strong class="kd iu">，</strong>在我们的 S3 桶中。输出即文本文件存储在<strong class="kd iu">外发</strong>文件夹中。我们新的 lambda 函数将和我们的第一个一样，唯一的区别是触发点。</p><p id="c215" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">任何时候，一个<strong class="kd iu">。txt </strong>上传/创建在<strong class="kd iu"> s3://bucketname/outgoing </strong>文件夹中，lambda 函数将被触发</p><div class="mg mh mi mj gt ab cb"><figure class="ot ju ro ov ow ox oy paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><img src="../Images/0f6ed2d3562c9a31c879d0b9e16bbbfa.png" data-original-src="https://miro.medium.com/v2/resize:fit:658/format:webp/1*1wH3NbQJnuVpSP-122to6w.png"/></div></figure><figure class="ot ju rp ov ow ox oy paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><img src="../Images/ac8d509c93ec3c344ee27fb86a029be5.png" data-original-src="https://miro.medium.com/v2/resize:fit:744/format:webp/1*xTBcWskUqPXhwE18YBqF5w.png"/></div></figure><figure class="ot ju rq ov ow ox oy paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><img src="../Images/139d875c3154b72916d215739eb1e169.png" data-original-src="https://miro.medium.com/v2/resize:fit:602/format:webp/1*cDdChq7uxRm6uEdEXpEW0w.png"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk rr di rs pc">Note the configuration in the right-most screen. The trigger is explicitly set for “output/” directory and “.txt” files only</figcaption></figure></div><p id="6793" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">此 lambda 函数的 Python 代码可从以下网址获得:</p><div class="pv pw gp gr px py"><a href="https://github.com/purijs/kaldi-asr-aws/blob/master/lambda/outgoing-lambda-handler.py" rel="noopener  ugc nofollow" target="_blank"><div class="pz ab fo"><div class="qa ab qb cl cj qc"><h2 class="bd iu gy z fp qd fr fs qe fu fw is bi translated">普里吉斯/卡尔迪-阿斯尔-aws</h2><div class="qf l"><h3 class="bd b gy z fp qd fr fs qe fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="qg l"><p class="bd b dl z fp qd fr fs qe fu fw dk translated">github.com</p></div></div></div></a></div><p id="98bc" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> 6。DynamoDB:一键 DB 设置</strong></p><p id="5d5d" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">从 AWS 控制台转到 DynamoDB，创建第一个表。将<strong class="kd iu"> audioAnalytics </strong>设置为您的表名，或者在两个 Lambda 函数的代码中更改名称</p><figure class="mg mh mi mj gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi rt"><img src="../Images/cd6e5d18fd296ff71a35a3db245278d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H25s2JvNQEQ_WseqZRk8cQ.png"/></div></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk">The <strong class="bd pu">Table Name</strong> &amp; <strong class="bd pu">Primary Key</strong> you set here should be in sync with the code in both the Lambda Functions</figcaption></figure><p id="a139" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> 7。最后，网页界面</strong></p><p id="d21a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们的 web 应用程序只是另一个 Flask 应用程序，您可能想查看 Github 链接，了解如何在 EC2 服务器上设置/安装 Flask/Python。</p><p id="cfbf" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">一旦你在虚拟环境中，尽管不建议用于生产工作流程，你可以简单地将<strong class="kd iu"> flask-app 目录</strong>克隆到你的工作目录中，例如:<strong class="kd iu"> /var/www/html/ </strong></p><pre class="mg mh mi mj gt re rf rg rh aw ri bi"><span id="45b7" class="lg lh it rf b gy rj rk l rl rm">python app.py &amp;</span></pre><p id="20e4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这将在后台运行 flask 应用程序。</p><blockquote class="kz la lb"><p id="cfd5" class="kb kc lc kd b ke kf kg kh ki kj kk kl ld kn ko kp le kr ks kt lf kv kw kx ky im bi translated">在浏览器中，键入 EC2 的 IP，端口号为 8080</p><p id="ef1b" class="kb kc lc kd b ke kf kg kh ki kj kk kl ld kn ko kp le kr ks kt lf kv kw kx ky im bi translated"><strong class="kd iu"> http:// &lt;您的 IP &gt; :8080/ </strong></p></blockquote><p id="1c8c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在文本字段中，键入有效的电子邮件，然后上传。wav/.mp3 音频文件</p><figure class="mg mh mi mj gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ru"><img src="../Images/b5c19087689fb89c62649edd48272f49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Idjl1SvrQ9rCdRSYSiR_LQ.png"/></div></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk">A snapshot of the DynamoDB table, you can see some of the transcripts have started to stream in!</figcaption></figure><p id="f116" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在运行以下两个命令时，一旦音频文件位于<strong class="kd iu"><em class="lc">/home/ec2-user/audiosKaldi/processing</em></strong>文件夹中，Kaldi 将开始转录这些音频文件</p><pre class="mg mh mi mj gt re rf rg rh aw ri bi"><span id="15bc" class="lg lh it rf b gy rj rk l rl rm">docker exec -it kaldi bash</span><span id="6ef8" class="lg lh it rf b gy rn rk l rl rm"># Once you can see some files in the /audios/ folder, run:<br/>/models/transcriptMaster.sh</span></pre></div><div class="ab cl ns nt hx nu" role="separator"><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx"/></div><div class="im in io ip iq"><blockquote class="nd"><p id="23a0" class="ne nf it bd ng nh rv rw rx ry rz ky dk translated">请随意联系或者把你的问题/反馈贴在这里，因为我相信这是很多实用的东西，通常第一次尝试不会很顺利！</p></blockquote></div></div>    
</body>
</html>