# 黑洞成像的最优实时调度

> 原文：<https://towardsdatascience.com/optimal-real-time-scheduling-for-black-hole-imaging-4d3518d2ad14?source=collection_archive---------23----------------------->

## 为了观测黑洞，如何协调 11 台望远镜？

队员:、、子怡()周

![](img/aafcb9c6809758e30218072592656b97.png)

本文的主要目的是分享作者在哈佛大学应用计算科学研究所(IACS)John a . Paulson 工程和应用科学学院的[顶点课程](https://www.capstone.iacs.seas.harvard.edu)项目中的发现和贡献。他们的顾问是[塞西莉亚·加拉夫](https://www.ceciliagarraffo.com)和[帕夫洛斯·普罗托帕帕斯](https://iacs.seas.harvard.edu/people/pavlos-protopapas)。在这个跨越整个学期的项目中，我们与[事件视界望远镜](https://eventhorizontelescope.org) (EHT)合作，对人类发现宇宙产生影响。

你可能以前见过这张著名的图片——人类历史上第一张黑洞的图片。2019 年 4 月 10 日，EHT 发布了这张照片，他们获得了 2020 年基础物理学突破奖。

谢泼德·多勒曼是 EHT 的创始董事之一。在拍摄完黑洞的照片后，他找到了顶点计划的主要指导者 Pavlos Protopapas，寻求帮助。

![](img/2e5aab9337c1b8248b4bc2cdc8ebb848.png)

他说，为了实现黑洞图像的高分辨率，他们使用了甚长基线干涉测量技术，其中全球各地的无线电碟形天线同步形成一个虚拟望远镜，具有目前从地球表面可能达到的最高角分辨率。这个分辨率有多高？这相当于坐在波士顿时能够在洛杉矶阅读一份报纸，或者相当于能够看到一臂之遥的一个原子。为了以这种方式运行,“EHT”号要求阵列的大部分地区同时有相当好的天气。目前该阵列中有 11 个天线。一些地方的观测条件可能非常好，但是如果由于其他地方天气不好，没有足够的望远镜可以参与，观测就无法进行，因为它们不会产生高质量的数据。

然而，操作这些巨型望远镜非常昂贵，科学家们不断争夺观测时间，因此 EHT 每年只有 10 天的时间，可供望远镜一起使用。每一年，10 天的窗口都是不同的。不仅如此，在这 10 天的窗口中，由于其他一些限制，他们只能触发 5-6 晚。目前，他们团队中的一个人，也就是 Shep，手动决定是否触发夜晚。他通过给他在每台望远镜前工作的朋友打电话，问他们:“你对天气有什么看法？”

![](img/10d47373695a868f45523201a6c8cfa7.png)

你可能知道，当前的决策过程并没有达到应有的效率和深度。因此，Shep 希望我们建立一些实时算法，可以促进他的决策过程。我们的目标是最大化高质量黑洞照片的数量。给定天气数据和日期信息，算法应该随时提出建议，即是否在当天触发，以及未来剩余几天的最佳策略。总的来说，我们只能从连续 10 天中选择 5 天。

如果可能的话，EHT 还希望我们的模型输出置信水平和次优策略。

下面是这个问题的一个演示。x 轴表示 10 天窗口中的日期，而 y 轴表示到目前为止已经触发的天数。在每一天，如果我们决定在第二天触发，我们在对角线上向上移动，如果我们建议跳过第二天，我们在水平方向上移动。最终，我们必须到达顶线中的一个点。这里的绿线显示了一条可能的路径，建议触发 10 月 6、8、10、13 和 14 日。

![](img/c02c8952c399c390492986b42e49d955.png)

Solution Space

**动机**

我们的动机是双重的。目前，EHT 由人类做出决定。如果我们的模型成功了，他们肯定会用它来帮助他们做决定。这对我们来说是一个巨大的动力，因为我们知道通过增加捕捉黑洞的机会，我们也为人类发现宇宙做出了贡献。

**数据**

我们从 [GFS](https://www.ncdc.noaa.gov/data-access/model-data/model-datasets/global-forcast-system-gfs) 收集数据，这是国家环境信息中心制作的天气预报模型。它是公开可用的。它提供全球逐层大气预报。你可以把它的数据想象成一个 3D 的形状。每 6 个小时，GFS 产生一组预测，我们提取与我们相关的数据:每个望远镜位置的天气情况。我们通过指定望远镜的经度、纬度和高度来做到这一点。

在我们提取了一些数据后，我们开始了探索性的数据分析过程，并绘制了这张图表。这里有五个图，因为 GFS 一次预测五个变量。在每张图上，你可以看到有一条黑线和七条灰线。这对应于每 6 小时预报的每组天气预报数据。黑线代表最新的预测数据，而灰线是在过去 48 小时内做出的预测。每次预测涵盖未来 16 天。我们可以看到，前 5 天的预报相当准确，但之后就变得非常不确定了。专家告诉我们，第一个变量 Tau-225 是表明大气透明度的最重要的变量，因为它是头顶上方的吸收率。较小的 Tau-225 比较大的 Tau-225 更优选。

![](img/e542a384e0304cf2ee969509f6ad57c3.png)

Only the first graph of Tau-225 is relevant.

这就是我们得到的所有数据。在与合作伙伴会面和查看数据之前，我们考虑使用强化学习来解决这个问题。然而，在我们与合作伙伴会面并看到数据后，我们意识到这是一个优化问题，我们必须创造性地设计出非常适合它的模型。当我们找不到任何做类似事情的文献或以前的作品时，我们设计了这个基线模型，它作为我们后来创建的所有其他模型的基本框架。

**基线模型**

我们从强化学习中借鉴了奖励函数的概念。每个望远镜将根据其天气状况获得一个奖励值。每个望远镜的奖励函数被称为小 f。每天都被分配一个奖励值，奖励函数被称为大 f。在基线模型中，我们使用 Tau-225 的预测构建奖励函数。小 f 被定义为在望远镜的观察窗上τ-225 的负期望值。(负号的原因是因为直觉上我们希望奖励值越大越好，但是 Tau-225 总是正的，接近零的时候是最好的。)大 F 被定义为小 F 的一些加权平均值。我们用望远镜的大小作为权重的一部分，因为更大的望远镜在阵列中更重要。我们还在公式中加入了距离矩阵，因为我们希望望远镜分布在地球表面。

![](img/efd07453b3543b6474ff7c25874b00a0.png)

Baseline model: formula of the reward functions. Each telescope is represented as i. T_i is the observation of the telescope i. r_i is the diameter of the telescope i. D is the baseline length matrix, which includes pairwise telescopes’ distance information.

一旦我们计算出每天的奖励值，我们就想解决最优化问题。例如，在第 0 天，我们计算从第 1 天到第 10 天的奖励值。由于我们有 5 天的触发时间，并且我们没有使用其中的任何一天，我们找到五个最大的奖励，并查看第 1 天是否是其中的一天。这里，粉色方框代表最大的五个值。在第 1 天，我们有从第 2 天到第 10 天的奖励值。请注意，这些值会更新，因为已经进行了新的天气预报。因为我们已经触发了第一天，我们还有四天的触发时间。我们找到奖励值最大的四天。我们看到第二天在其中一个，所以建议触发第二天。在第 2 天，我们希望在剩余的几天中找到前 3 名奖励。我们看到第三天不在其中。然后在第 3 天，我们继续寻找前 3 个奖励，看看第 4 天是否在其中。

这些是基线模型的基础。现在我们转向考虑不确定性的更先进的模型。不确定性意味着我们只能在一定程度上相信政府统计处的预测数据。我们的合作伙伴多次强调，为了将风险降至最低，他们宁愿早一点而不是晚一点触发观察。

![](img/400e865c2fdcc574f1a612e42b037889.png)

Example for solving the optimization problem

**方法一:单一折扣系数**

我们考虑的第一种不确定性仅取决于 GFS 对未来多远的预测，即时滞。为了体现这一点，我们可以将每天的奖励乘以一个折扣因子来获得现值。然后执行我们在基线模型中使用的相同优化技术。单一折扣因子被认为是一个超参数，需要从交叉验证中进行调整。

![](img/960e3f5618f0db8bc1bf51b39477423e.png)

Method 1: Example

**方法二:预测罚款**

我们认为单一的贴现因子不足以解释未来的不确定性，因此我们引入了不同的不确定性量化来构建第二种方法。在这种方法中，我们基于时间滞后来寻找 GFS 模型准确性的模式。因此，我们使用历史数据来计算基于未来多少天预测的平均误差。我们将结果绘制在左侧，其中 x 轴是未来的天数，y 轴是误差的度量。我们看到，GFS 模型在超过六天后就不那么准确了。就像前面模型中的折扣因子一样，我们对奖励值使用了一个乘法惩罚项。(我们可以通过小 F 值或大 F 值来实现这一点)。惩罚项取决于时滞和一个称为“惩罚水平”的超参数。

![](img/7d3ddc0fa26d2b5ea30d374c6ce65c63.png)

Method 2: formula used

**方法三:具体时间的预测难度**

前两个模型假设不确定性来自时滞。这个模型和下一个模型假设不确定性与预测的具体日期有关。还记得 GFS 在接下来的 16 天中每 6 小时进行一次预测吗？因此，对于每个时间点，都有多个预测。图中的黄色区域以 Tau-225 的最小和最大预测数据为界。

对于这种方法，我们希望找到某个时间点的最新预测，并计算其他预测相对于该最新预测的均方根误差(RMSE)。然后，我们使用与之前类似的公式来获得奖励值，但是这次奖励和惩罚都是针对时间点定制的。

![](img/fa80ac4cd3babbfd94697db5e08a99c8.png)

Method 3: formula used

**方法 4:正态分布抽样**

最后，我们仍然假设每个时间点的不确定性不同，但是我们希望获得与我们建议的最佳路径相关联的置信度。我们假设真实的天气来自正态分布。在蒙特卡罗方法的指导下，我们从分布中随机抽取每个时间点的奖励值足够多的次数，每次都找到一条最优路径。最后，我们总结了路径的频率，得出最佳路径是频率最高的路径。我们还使用它的频率来表示我们对建议路径的置信度。我们相信，如果我们的合作伙伴看到这个数字，他们可以做出更明智的决定。

![](img/abdd1bd976e382c9bc90df677de874e2.png)

Method 4: formula used

**车型评测**

我们通过将不同模型给出的建议路径与实际路径进行比较，对我们的模型进行了回溯测试。这是一个例子。我们对 11 月 9 日至 11 月 18 日的预测数据进行了模拟，因此每个模型都会给我们一个建议路径。我们也知道基本事实路径，所以我们比较了每个模型的平均奖励和最佳路径的分数。在本例中，只有基线法和分布抽样法未能生成最佳路径。缺乏进一步的惩罚导致了一天后的预测。

![](img/abb1a5459cbc655edae48d338fd4a931.png)

Example of outputs from models

我们收集了从 10 月 25 日到 11 月 30 日的 GFS 数据，并在每个连续的 10 天窗口中运行模拟。总共有 26 个 10 天的窗口。人们可以把我们在一个 10 天的窗口中收到的所有数据想象成 x，当我们回头看时的平均回报想象成预测的 y。我们可以自然地将我们预测的 y 与最佳路径进行比较，并计算均方误差。我们还计算一个分数，该分数在下面的公式中定义。这是一个相对分数。如果我们的预测路径等于最佳路径，那么它将等于 1。如果我们的预测路径等于随机路径，得分将为 0。

![](img/0ec55e41e745194cda5fc32009544dee.png)

Metrics used to compare models

有了这两个指标，我们就能够决定每种方法的最佳惩罚级别，以及最佳模型。在这里，方法 3 是性能最好的模型，这是意料之中的，因为它包含了每天天气预测方差的不确定性。方法 2 是第二好的方法，因为它只考虑了天气预报在未来多远的不确定性。这里的抽样方法和基线一样好，因为它不包含任何惩罚。然而，它仍然是有用的，因为它是输出所选路径的置信度的唯一模型。

![](img/9d9c56fbb61fd648917ad5f7dc7bafce.png)

Comparison among models

**软件**

我们制作了一个软件包，供 EHT 将来使用。该软件包括处理数据、运行优化模型和利用提供的不确定性测量提出建议的程序。

以下是如何使用该软件的演示:

Software Demo

**结论**

这个项目发展到现在这个阶段并不容易。最初，当我们得到分配的项目时，我们想到了奇特的机器学习模型来解决问题。然而，在看到数据并与合作伙伴会面后，我们意识到一个更简单的模型更适合解决这个问题。有一段时间，从 GFS 中提取的数据中有意外的零，我们花了相当长的时间在合作伙伴的帮助下解决这个问题。构建软件需要我们构建一个图形用户界面(GUI ),并将 GUI 与所有的模型输入和输出连接起来。我们以前没有任何做这种建模的经验，但我们能够学到很多东西，并在最后征服每个概念。我们为这个项目感到非常自豪，并希望它对其他人有用。