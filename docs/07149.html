<html>
<head>
<title>Deploying a React App on Heroku: the Python perspective</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在 Heroku 上部署 React 应用程序:Python 视角</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/deploying-a-react-app-on-heroku-the-python-perspective-256deeec788f?source=collection_archive---------14-----------------------#2019-10-09">https://towardsdatascience.com/deploying-a-react-app-on-heroku-the-python-perspective-256deeec788f?source=collection_archive---------14-----------------------#2019-10-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="8e6e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">如何部署与 Flask 后端配对的 React 前端</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/7677413a1633f7c86df36feeca8feff5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oMDXbLJsAfGZj4vCLod1jA.png"/></div></div></figure><p id="954e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">Heroku 来自 Python 背景，是一个非常适合部署的地方。我有各种各样的静态和基于 Flask 的网站，这些网站配置起来很简单，并且很容易与 Github 集成，以实现平稳的持续部署。这篇文章是<em class="lq">而不是</em>关于使用烧瓶部署的——<a class="ae lr" href="https://devcenter.heroku.com/articles/deploying-python" rel="noopener ugc nofollow" target="_blank">Heroku 指南</a>对此很有帮助，你可以在这里<a class="ae lr" href="https://github.com/archydeberker/ski-monitor" rel="noopener ugc nofollow" target="_blank">和这里</a>和<a class="ae lr" href="https://github.com/archydeberker/burnsbot" rel="noopener ugc nofollow" target="_blank">看到一些例子。</a></p><p id="bbbc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在我最近的项目中，我学习了 Javascript——特别是，<a class="ae lr" href="https://reactjs.org/tutorial/tutorial.html" rel="noopener ugc nofollow" target="_blank"> React </a>(如果你想做同样的事情，我发现<a class="ae lr" href="https://flaviocopes.com" rel="noopener ugc nofollow" target="_blank"> Flavio Copes </a>博客很有帮助)。这带来了一系列令人眼花缭乱的新单词要学习，许多不同的方法来做同样的事情(与 Python 的法则相反)，以及让我迷惑不解的异步范例。</p><p id="3ff9" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我正在用 Flask 后端构建一个 React 应用程序。在黑进了本地看起来合理的东西并部署了后端之后，我开始和我信任的朋友 Heroku 一起部署 React 部分。这就是麻烦开始的地方。</p><h1 id="d545" class="ls lt it bd lu lv lw lx ly lz ma mb mc jz md ka me kc mf kd mg kf mh kg mi mj bi translated"><strong class="ak">我用什么来服务一个 React app？</strong></h1><p id="5834" class="pw-post-body-paragraph ku kv it kw b kx mk ju kz la ml jx lc ld mm lf lg lh mn lj lk ll mo ln lo lp im bi translated">我是数据科学家，不是开发人员，所以我和服务器的关系是功利的。Flask 给了我一个轻量级的 Python 服务器，如果我误以为我的网站会有大流量，我可以升级到<code class="fe mp mq mr ms b">gunicorn</code>。当我部署到 Heroku 时，我可以使用一个<code class="fe mp mq mr ms b"><a class="ae lr" href="https://devcenter.heroku.com/articles/procfile" rel="noopener ugc nofollow" target="_blank">Procfile</a></code>来告诉 Heroku 运行什么命令来服务我的应用程序——通常是一个命令行程序。幸运的是，我用来在本地运行我的应用程序的命令和 Heroku 使用的命令是相同的:</p><pre class="kj kk kl km gt mt ms mu mv aw mw bi"><span id="294e" class="mx lt it ms b gy my mz l na nb">python app.py</span></pre><p id="5079" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">但是 React 的等价词是什么呢？</p><p id="740f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">当您在本地开发时，您可以使用类似以下的内容:</p><pre class="kj kk kl km gt mt ms mu mv aw mw bi"><span id="7c5a" class="mx lt it ms b gy my mz l na nb">npm run start</span></pre><p id="f71a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">来运行您的开发服务器，但是稍微搜索一下就会发现没有人用它来为生产服务。相反，有很多关于所谓的<code class="fe mp mq mr ms b">Express.js</code>的讨论。</p><h2 id="3d50" class="mx lt it bd lu nc nd dn ly ne nf dp mc ld ng nh me lh ni nj mg ll nk nl mi nm bi translated"><strong class="ak">express . js 到底是什么？</strong></h2><p id="f17f" class="pw-post-body-paragraph ku kv it kw b kx mk ju kz la ml jx lc ld mm lf lg lh mn lj lk ll mo ln lo lp im bi translated">Express 将自己描述为“Node.js 的快速、非个性化、极简主义的网络框架”。所有这些听起来对我来说都很好，但我真的不在乎——我只是想要一些允许其他人看到我在本地运行<code class="fe mp mq mr ms b">npm run start </code>时看到的东西。</p><p id="1e5b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">事实证明，对此使用 Express 是完全没有必要的，尽管有许多关于它的博客文章。</p><p id="5678" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">困惑的产生是因为很多人也对基于 Javascript 部署后端感兴趣，所以很多关于部署 JS 的普通建议都是基于可以服务前端和后端资产的服务器。但是你，我的朋友，已经有了一个后端，由可信的 Flask 提供服务:所以我们可以坚持一些更简单的东西。</p><h2 id="fe49" class="mx lt it bd lu nc nd dn ly ne nf dp mc ld ng nh me lh ni nj mg ll nk nl mi nm bi translated"><strong class="ak">服务一个反应前端</strong></h2><p id="3bd5" class="pw-post-body-paragraph ku kv it kw b kx mk ju kz la ml jx lc ld mm lf lg lh mn lj lk ll mo ln lo lp im bi translated">React 中大多数旅程的实际起点<code class="fe mp mq mr ms b">create-react-app</code>建议，如果你在提供一个“静态应用”，你可以使用一个叫做<code class="fe mp mq mr ms b">serve</code>的东西，这相当于一个两行程序:</p><pre class="kj kk kl km gt mt ms mu mv aw mw bi"><span id="a6e2" class="mx lt it ms b gy my mz l na nb">npm install -g serve<br/>serve -s build</span></pre><p id="fc90" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">这对我来说听起来相当不错，除了我不确定我是否在服务一个“静态应用程序”，在我看来这是由几个 HTML 页面组成的，而不是一个所有人都在唱歌所有人都在跳舞的 React 应用程序，在商店里到处都有旋转的小发明和跳跃的模态。</p><p id="f2d0" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">但是仔细想想，我的应用程序确实是静态的。如果你在 Flask 中创建一个后端，而你的 React 应用仅仅是一个前端，那么你的应用是静态的。从部署的角度来看，这是个好消息。</p><p id="2326" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">旁白:<code class="fe mp mq mr ms b">serve</code>是来自<a class="ae lr" href="https://zeit.co" rel="noopener ugc nofollow" target="_blank"> ZEIT </a>的一个库，他们实际上有一个 Heroku 的竞争对手叫<code class="fe mp mq mr ms b">now</code>，它已经获得了一些非常有利的<a class="ae lr" href="https://www.google.com/search?client=safari&amp;rls=en&amp;q=NOW+vs.+heroku&amp;ie=UTF-8&amp;oe=UTF-8" rel="noopener ugc nofollow" target="_blank">写</a>写<a class="ae lr" href="https://www.benstanfield.io/projects/deploy.html" rel="noopener ugc nofollow" target="_blank"> ups </a>，可能值得仔细看看。</p><h2 id="a696" class="mx lt it bd lu nc nd dn ly ne nf dp mc ld ng nh me lh ni nj mg ll nk nl mi nm bi translated"><strong class="ak">最后一公里</strong></h2><p id="7cf7" class="pw-post-body-paragraph ku kv it kw b kx mk ju kz la ml jx lc ld mm lf lg lh mn lj lk ll mo ln lo lp im bi translated">需要一些小的修正来让这个<strong class="kw iu">在本地</strong>工作:</p><ol class=""><li id="cfa3" class="nn no it kw b kx ky la lb ld np lh nq ll nr lp ns nt nu nv bi translated"><code class="fe mp mq mr ms b">serve</code>将服务于已经构建的任何东西，而不是您的开发代码，所以请确保您已经运行了<code class="fe mp mq mr ms b">npm run build</code>来将您的 Javascript 编译成部署版本。如果您像我一样来自 Python 背景，您会忘记这样做，并且想知道当您在本地测试系统时，为什么对代码的更改没有反映在您的浏览器中。</li><li id="0328" class="nn no it kw b kx nw la nx ld ny lh nz ll oa lp ns nt nu nv bi translated">如果您使用<code class="fe mp mq mr ms b">npm</code>遵循了<a class="ae lr" href="https://create-react-app.dev" rel="noopener ugc nofollow" target="_blank"> create-react-app </a>框架，您可能已经向您的<code class="fe mp mq mr ms b">package.json</code>添加了一个<code class="fe mp mq mr ms b">proxy</code>字段，这允许您通过类似<code class="fe mp mq mr ms b">/api/v1</code>的路径访问您的 API，而不是显式地指定主机。虽然<a class="ae lr" href="https://github.com/zeit/serve/issues/315" rel="noopener ugc nofollow" target="_blank">显然在<code class="fe mp mq mr ms b">serve</code>中有一些功能</a>来复制它，但我无法让它工作，所以我只是定义了一个环境变量并使用它(<a class="ae lr" href="https://medium.com/@trekinbami/using-environment-variables-in-react-6b0a99d83cf5" rel="noopener">见本指南</a>)。</li></ol><p id="0d97" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">最后，让 Heroku<strong class="kw iu">的东西飞起来</strong>(如果你不熟悉 Heroku 的 Github 工作流程，我真的推荐你，<a class="ae lr" href="https://devcenter.heroku.com/articles/git" rel="noopener ugc nofollow" target="_blank">看看他们的快速入门</a>):</p><ol class=""><li id="8e64" class="nn no it kw b kx ky la lb ld np lh nq ll nr lp ns nt nu nv bi translated">来自<code class="fe mp mq mr ms b">create-react-app</code>的文档将<code class="fe mp mq mr ms b">serve</code>与<code class="fe mp mq mr ms b">npm install -g serve</code>一起安装，但是您实际上想要使用<code class="fe mp mq mr ms b">npm install serve --save</code>将其添加到您的生产依赖项中(我花了一段时间试图弄清楚为什么 Heroku 会因为缺少<code class="fe mp mq mr ms b">serve</code>依赖项而崩溃)。</li><li id="55fa" class="nn no it kw b kx nw la nx ld ny lh nz ll oa lp ns nt nu nv bi translated">一旦 Heroku 意识到你已经获得了一个 NPM 应用程序(由检测到一个<code class="fe mp mq mr ms b">package.json</code>触发)，它将尝试用<code class="fe mp mq mr ms b">npm run build</code>构建你的应用程序，然后用<code class="fe mp mq mr ms b">npm run start</code>运行它。为了让后者工作，您需要将默认的<code class="fe mp mq mr ms b">create-react-app</code>从</li></ol><pre class="kj kk kl km gt mt ms mu mv aw mw bi"><span id="1fa5" class="mx lt it ms b gy my mz l na nb">“scripts”: {“start”: “react-scripts start”, ...</span></pre><p id="ee17" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">到</p><pre class="kj kk kl km gt mt ms mu mv aw mw bi"><span id="8237" class="mx lt it ms b gy my mz l na nb">“scripts”: {“dev”: “react-scripts start”,</span><span id="267e" class="mx lt it ms b gy ob mz l na nb">            “start”: “serve -s build”,</span></pre><p id="dcb2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然后，您可以使用<code class="fe mp mq mr ms b">npm run dev</code>在本地运行您的开发服务器，但是 Heroku 将能够在调用<code class="fe mp mq mr ms b">npm run start</code>时运行您的生产服务器。</p><p id="032b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">最后，如果你按照我的建议用<code class="fe mp mq mr ms b">ENV</code>来设置你的后端 URL，确保通过<code class="fe mp mq mr ms b">Settings &gt; Config Vars</code>在 Heroku 中设置 env。</p></div><div class="ab cl oc od hx oe" role="separator"><span class="of bw bk og oh oi"/><span class="of bw bk og oh oi"/><span class="of bw bk og oh"/></div><div class="im in io ip iq"><p id="96d7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">理论上就是这样！你可以在<a class="ae lr" href="https://github.com/archydeberker/wildly-monitor/tree/deploy-static" rel="noopener ugc nofollow" target="_blank"> this repo </a>的 React 应用中看到这是什么样子。如果您对此工作流程有任何问题，或者您找到了在 Heroku 上部署 React 应用程序的更简单方法，请告诉我🤖🎉👯‍♀️</p></div></div>    
</body>
</html>