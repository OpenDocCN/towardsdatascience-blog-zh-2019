<html>
<head>
<title>Build a Realtime Object Detection Web App in 30 Minutes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在 30 分钟内构建一个实时对象检测 Web 应用程序</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/build-a-realtime-object-detection-web-app-in-30-minutes-7ad0cb2231fb?source=collection_archive---------7-----------------------#2019-09-29">https://towardsdatascience.com/build-a-realtime-object-detection-web-app-in-30-minutes-7ad0cb2231fb?source=collection_archive---------7-----------------------#2019-09-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/28a827bff1e160256668b32fa6ddb538.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZeDQGWRoERxO9dW9Sqgc_w.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">Image Credit: <a class="ae kf" href="https://github.com/tensorflow/models/tree/master/research/object_detection" rel="noopener ugc nofollow" target="_blank">https://github.com/tensorflow/models/tree/master/research/object_detection</a></figcaption></figure><h1 id="178d" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">张量流。射流研究…</h1><p id="8725" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">Tensorflow.js 是一个开源库，使我们能够使用 Javascript 在浏览器中定义、训练和运行机器学习模型。我将使用 Angular 中的<a class="ae kf" href="https://www.tensorflow.org/js/" rel="noopener ugc nofollow" target="_blank"> Tensorflow.js 框架</a>来构建一个 Web 应用程序，该应用程序可以检测网络摄像头视频馈送上的多个对象。</p><h1 id="8e8d" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">COCO-SSD 型号</h1><p id="e9c1" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">首先，我们必须选择我们将用于对象检测的预训练模型。Tensorflow.js 提供了几个预训练模型，用于分类、姿态估计、语音识别和对象检测目的。查看所有<a class="ae kf" href="https://github.com/tensorflow/tfjs-models" rel="noopener ugc nofollow" target="_blank"> Tensoflow.js 预训练模型</a>了解更多信息。</p><p id="ed3c" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">COCO-SSD 模型是一种预训练的对象检测模型，旨在定位和识别图像中的多个对象，是我们将用于对象检测的模型。</p><figure class="mi mj mk ml gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mh"><img src="../Images/8bc826b321d6feeed17ba1ffc3cf21a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*b8YpEgw9it-NgVOs"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">Photo by <a class="ae kf" href="https://unsplash.com/@brookecagle?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Brooke Cagle</a> on <a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="9fc0" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">原<a class="ae kf" href="http://download.tensorflow.org/models/object_detection/ssd_mobilenet_v2_coco_2018_03_29.tar.gz" rel="noopener ugc nofollow" target="_blank"> ssd_mobilenet_v2_coco </a>模型大小为 187.8 MB，可从 TensorFlow 模型动物园下载。与原始模型相比，Tensorflow.js 版本的模型非常轻量级，并针对浏览器执行进行了优化。</p><p id="76ba" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">Tensorflow.js COCO-SSD 默认的物体检测模型是<strong class="lg iu">‘lite _ mobilenet _ v2’</strong>体积非常小，1MB 以下，推理速度最快。如果您想要更好的分类准确性，您可以使用<strong class="lg iu">‘mobilenet _ v2’</strong>，在这种情况下，模型的大小增加到 75 MB，这不适合 web 浏览器体验。</p><p id="19d8" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated"><strong class="lg iu">“model . detect”</strong>直接从 HTML 中获取图像或视频输入，因此在使用之前，您无需将输入转换为张量。它返回检测到的对象的类、概率分数以及边界框坐标的数组。</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="82b1" class="mr kh it mn b gy ms mt l mu mv">model.detect(<br/> img: tf.Tensor3D | ImageData | HTMLImageElement |<br/>   HTMLCanvasElement | HTMLVideoElement, maxDetectionSize: number<br/>)<br/>[{<br/> bbox: [x, y, width, height],<br/> class: "person",<br/> score: 0.8380282521247864<br/>}, {<br/> bbox: [x, y, width, height],<br/> class: "kite",<br/> score: 0.74644153267145157<br/>}]</span></pre><figure class="mi mj mk ml gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mw"><img src="../Images/7c5d8de4e0b25cf1d659e996aea02c36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*tnwMkUvIRcA4NuBB"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">Photo by <a class="ae kf" href="https://unsplash.com/@marckleen?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Marc Kleen</a> on <a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="d59b" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">ANGULAR WEB 应用正在初始化</h1><p id="a923" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">在我们清楚了模型之后，是时候使用 Angular 命令行界面来初始化<a class="ae kf" href="https://angular.io/" rel="noopener ugc nofollow" target="_blank"> Angular </a> web 应用程序了。</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="14e7" class="mr kh it mn b gy ms mt l mu mv">npm install -g @angular/cli<br/>ng new TFJS-ObjectDetection<br/>cd TFJS-ObjectDetection</span></pre><p id="f133" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">然后我将使用 NMP 包管理器加载 Tensorflow.js 和 COCO-SSD 库。</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="b4c4" class="mr kh it mn b gy ms mt l mu mv">TFJS-ObjectDetection <strong class="mn iu">npm install @tensorflow/tfjs --save<br/></strong>TFJS-ObjectDetection <strong class="mn iu">npm install @tensorflow-models/coco-ssd --save</strong></span></pre><p id="37e7" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">现在都准备好了。所以我们可以开始编码了。我先从<strong class="lg iu">‘app . component . ts’</strong>导入 COCO-SSD 模型开始。</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="0c6b" class="mr kh it mn b gy ms mt l mu mv">import { Component, OnInit } from '@angular/core';</span><span id="1d5e" class="mr kh it mn b gy mx mt l mu mv"><strong class="mn iu">//import COCO-SSD model as cocoSSD</strong><br/>import * as cocoSSD from '@tensorflow-models/coco-ssd';</span></pre></div><div class="ab cl my mz hx na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="im in io ip iq"><h1 id="3076" class="kg kh it bd ki kj nf kl km kn ng kp kq kr nh kt ku kv ni kx ky kz nj lb lc ld bi translated">开始网络摄像机馈送</h1><p id="e28c" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">然后，我将使用以下代码启动网络摄像头。</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="58bc" class="mr kh it mn b gy ms mt l mu mv">webcam_init()<br/>{<br/>  this.video = &lt;HTMLVideoElement&gt; document.getElementById("vid");<br/>  navigator.mediaDevices<br/>  .getUserMedia({<br/>  audio: false,<br/>  video: {facingMode: "user",}<br/>  })<br/>  .then(stream =&gt; {<br/>  this.video.srcObject = stream;<br/>  this.video.onloadedmetadata = () =&gt; {<br/>  this.video.play();};<br/>  });<br/>}</span></pre><h1 id="69e4" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">物体检测功能</h1><p id="27c9" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">我们需要另一个函数来加载 COCO-SSD 模型，该模型也调用<strong class="lg iu">‘detect frame’</strong>函数来使用来自网络摄像头馈送的图像进行预测。</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="ccd2" class="mr kh it mn b gy ms mt l mu mv">public async predictWithCocoModel()<br/>{<br/>  const model = await cocoSSD.load('lite_mobilenet_v2');<br/>  this.detectFrame(this.video,model);<br/>  <br/>}</span></pre><p id="93a1" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated"><strong class="lg iu">‘detect frame’</strong>函数使用<strong class="lg iu"> requestAnimationFrame </strong>通过确保视频馈送尽可能平滑来反复循环预测。</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="e0dd" class="mr kh it mn b gy ms mt l mu mv">detectFrame = (video, model) =&gt; {<br/>  model.detect(video).then(predictions =&gt; {<br/>  this.renderPredictions(predictions);<br/>  requestAnimationFrame(() =&gt; {<br/>  this.detectFrame(video, model);});<br/>  });<br/>}</span></pre></div><div class="ab cl my mz hx na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="im in io ip iq"><figure class="mi mj mk ml gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nk"><img src="../Images/e32ac9ad22239beec025eb1ff21f44de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*cpOoOGaxbAccp1na"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">Photo by <a class="ae kf" href="https://unsplash.com/@miklevasilyev?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Mikhail Vasilyev</a> on <a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="23d4" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">渲染预测</h1><p id="e3fa" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">同时，<strong class="lg iu">‘render predictions’</strong>函数将检测到的对象的边界框和类名绘制到屏幕上。</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="a37b" class="mr kh it mn b gy ms mt l mu mv">renderPredictions = predictions =&gt; {</span><span id="a1b8" class="mr kh it mn b gy mx mt l mu mv">const canvas = &lt;HTMLCanvasElement&gt; document.getElementById     ("canvas");<br/>  <br/>  const ctx = canvas.getContext("2d");  <br/>  canvas.width  = 300;<br/>  canvas.height = 300;<br/>  ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);  <br/>  <br/>  <strong class="mn iu">// Fonts</strong><br/>  const font = "16px sans-serif";<br/>  ctx.font = font;<br/>  ctx.textBaseline = "top";<br/>  ctx.drawImage(this.video,0,0,300,300);<br/>  <br/>  predictions.forEach(prediction =&gt; {  <br/>   <br/>   <strong class="mn iu">// Bounding boxes's coordinates and sizes</strong><br/>   const x = prediction.bbox[0];<br/>   const y = prediction.bbox[1];<br/>   const width = prediction.bbox[2];<br/>   const height = prediction.bbox[3];</span><span id="9c19" class="mr kh it mn b gy mx mt l mu mv"><strong class="mn iu">// Bounding box style</strong><br/>   ctx.strokeStyle = "#00FFFF";<br/>   ctx.lineWidth = 2;</span><span id="7272" class="mr kh it mn b gy mx mt l mu mv"><strong class="mn iu">// Draw the bounding<br/></strong>   ctx.strokeRect(x, y, width, height);  <br/>   <br/>   <strong class="mn iu">// Label background</strong><br/>   ctx.fillStyle = "#00FFFF";<br/>   const textWidth = ctx.measureText(prediction.class).width;<br/>   const textHeight = parseInt(font, 10); // base 10<br/>   ctx.fillRect(x, y, textWidth + 4, textHeight + 4);<br/>   });<br/>   <br/>   predictions.forEach(prediction =&gt; {<br/>    <strong class="mn iu">// Write prediction class names</strong><br/>    const x = prediction.bbox[0];<br/>    const y = prediction.bbox[1];  <br/>    ctx.fillStyle = "#000000";<br/>    ctx.fillText(prediction.class, x, y);});   <br/>   };</span></pre><p id="8f7f" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">现在，在浏览器上执行对象检测所需的所有功能都已准备就绪。</p><p id="7f4d" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">我们只需要在<strong class="lg iu">【ngOnInit】</strong>上调用<strong class="lg iu">‘web cam _ init’</strong>和<strong class="lg iu">‘predictwithcocomoodel’</strong>就可以在启动时初始化 app。</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="9a79" class="mr kh it mn b gy ms mt l mu mv">ngOnInit()<br/>{<br/>  this.webcam_init();<br/>  this.predictWithCocoModel();<br/>}</span></pre></div><div class="ab cl my mz hx na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="im in io ip iq"><figure class="mi mj mk ml gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nl"><img src="../Images/ed291037b2ce1ed4b22fdec8c0b2a5a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*SmK8QIq6iX3STXXg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">Photo by <a class="ae kf" href="https://unsplash.com/@angur?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Andrew Umansky</a> on <a class="ae kf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="0551" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">用于对象检测的 HTML 元素</h1><p id="2396" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">剩下的最后一步是修改<strong class="lg iu"> 'app.component.html' </strong>，以包含上述功能工作所需的<em class="nm"> &lt; video &gt; </em>和<em class="nm"> &lt; canvas &gt; </em> HTML 元素。</p><pre class="mi mj mk ml gt mm mn mo mp aw mq bi"><span id="8e25" class="mr kh it mn b gy ms mt l mu mv">&lt;div style="text-align:center"&gt;<br/>  &lt;h1&gt;Tensorflow.js Real Time Object Detection&lt;/h1&gt;<br/>  &lt;video hidden id="vid" width="300" height="300"&gt;&lt;/video&gt;<br/>  &lt;canvas id="canvas"&gt;&lt;/canvas&gt;<br/>&lt;/div&gt;</span></pre></div><div class="ab cl my mz hx na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="im in io ip iq"><h1 id="1728" class="kg kh it bd ki kj nf kl km kn ng kp kq kr nh kt ku kv ni kx ky kz nj lb lc ld bi translated">完整代码</h1><p id="8439" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">访问我的<a class="ae kf" href="https://github.com/eisbilen/TFJS-ObjectDetection" rel="noopener ugc nofollow" target="_blank"> GitHub 资源库</a>获取该项目的完整代码。</p></div><div class="ab cl my mz hx na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="im in io ip iq"><h1 id="681d" class="kg kh it bd ki kj nf kl km kn ng kp kq kr nh kt ku kv ni kx ky kz nj lb lc ld bi translated">演示 WEB 应用程序</h1><p id="3571" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">访问<a class="ae kf" href="https://tfjs-objectdetection.firebaseapp.com/" rel="noopener ugc nofollow" target="_blank">现场演示</a>应用程序，查看运行中的代码。该应用程序在 Google Chrome 浏览器中运行没有任何问题。如果您使用任何其他浏览器，请确保您使用的浏览器支持'<strong class="lg iu"> requestAnimationFrame' </strong>。</p></div></div>    
</body>
</html>