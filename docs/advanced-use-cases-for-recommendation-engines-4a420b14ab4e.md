# å¦‚ä½•å»ºç«‹ä¸€ä¸ªå…ˆè¿›çš„æ¨èå¼•æ“

> åŸæ–‡ï¼š<https://towardsdatascience.com/advanced-use-cases-for-recommendation-engines-4a420b14ab4e?source=collection_archive---------4----------------------->

## å½“å¿«é€Ÿç®€å•çš„ååŒè¿‡æ»¤å·²ç»ä¸å¤Ÿå¥½çš„æ—¶å€™è¯¥æ€ä¹ˆåŠã€‚

# çŸ¥é“ä½ çš„èµ·ç‚¹

é‡è¦çš„æ˜¯è¦è®°ä½ï¼Œä½ ä¸åº”è¯¥ä»æ¨èå¼•æ“çš„é«˜çº§ç”¨ä¾‹å¼€å§‹ã€‚åœ¨å¿«é€Ÿç®€å•åœ°å®ç°ç‰ˆæœ¬ 1 ä¹‹åï¼Œä½ çš„æ¨èå¼•æ“å˜å¾—éå¸¸é€‚åˆä½ çš„ä¸šåŠ¡é—®é¢˜ã€äº§å“å’Œç”¨æˆ·ã€‚ä¸ºäº†æ„å»ºè¿™æ ·ä¸€ä¸ªå®šåˆ¶çš„æ¨¡å‹ï¼Œæ‚¨å°†éœ€è¦æ¥è‡ªç‰ˆæœ¬ 1 çš„åé¦ˆå¾ªç¯å’ŒåŸºçº¿æ¥å†³å®šæ‚¨çš„æ¨èå¼•æ“çš„æ”¹è¿›æ–¹å‘ã€‚å¯¹äºå®šåˆ¶çš„è§£å†³æ–¹æ¡ˆï¼Œæ•æ·æ˜¯æˆåŠŸå®ç°è¿™ä¸€ç›®æ ‡çš„æœ€ä½³æ–¹æ³•ã€‚å®é™…ä¸Šï¼Œè¿™æ„å‘³ç€åœ¨æ‚¨å¼€å§‹ä»»ä½•ç‰ˆæœ¬ 2 çš„å·¥ä½œä¹‹å‰ï¼Œæ‚¨å·²ç»æ„å»ºäº†ç‰ˆæœ¬ 1.1ã€1.2 å’Œ 1.3ã€‚

![](img/1282c94dff357fa518927fd0355e6722.png)

[OC]

å¯¹äºç¬¬ 1 ç‰ˆæ¨èå¼•æ“ï¼Œæ ¹æ®æ‚¨çš„èµ·ç‚¹ï¼Œæ‚¨æœ‰å¤šç§é€‰æ‹©:

*   å¦‚æœæ‚¨äº†è§£æ‚¨çš„äº§å“æˆ–è€…æ‚¨çš„äº§å“æœ‰ä¸°å¯Œçš„å…ƒæ•°æ®ï¼Œæ‚¨å¯ä»¥é¦–å…ˆæ„å»ºä¸€ä¸ªç®€å•çš„è§„åˆ™å¼•æ“æ¥æ•è·ä¸šåŠ¡é€»è¾‘ã€‚è€ƒè™‘åˆ°æ•æ·å’Œå®ç”¨çš„äº¤ä»˜ç„¦ç‚¹ï¼ŒçŸ¥é“ä»€ä¹ˆæ—¶å€™ä¸éœ€è¦æœºå™¨å­¦ä¹ æ˜¯å¾ˆé‡è¦çš„ã€‚
*   å¦‚æœæ‚¨ç¢°å·§ä¹Ÿè®¤è¯†æ‚¨çš„ç”¨æˆ·ï¼Œé‚£ä¹ˆæ‚¨ç”šè‡³å¯ä»¥ä½¿ç”¨ä¸€äº›åŸºæœ¬çš„ç”¨æˆ·ç»†åˆ†æ¥ä¸ªæ€§åŒ–æ‚¨çš„è§„åˆ™å¼•æ“ï¼Œä¾‹å¦‚ RFMã€‚
*   ä½†æ˜¯å¤§å¤šæ•°æ—¶å€™ä½ å¯¹ä½ çš„ç”¨æˆ·å’Œäº§å“ä¸å¤Ÿäº†è§£ï¼Œç”šè‡³ä¸€æ— æ‰€çŸ¥ã€‚ä½ æ‰€æ‹¥æœ‰çš„åªæ˜¯æ¥è‡ªç”¨æˆ·ä¸ä½ çš„ç½‘ç«™æˆ–äº§å“äº’åŠ¨çš„è¡Œä¸ºç‚¹å‡»æµæ•°æ®ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨åº”è¯¥è€ƒè™‘ä½¿ç”¨ååŒè¿‡æ»¤æ¥æ„å»ºæ‚¨çš„ç¬¬ 1 ç‰ˆæ¨èå¼•æ“ã€‚æ­¤ä½¿ç”¨æ¡ˆä¾‹åœ¨ä¸­æœ‰è¯¦ç»†è¯´æ˜:

[](/how-to-build-a-recommendation-engine-quick-and-simple-aec8c71a823e) [## å¦‚ä½•å¿«é€Ÿç®€å•åœ°æ„å»ºæ¨èå¼•æ“

### ç¬¬ 1 éƒ¨åˆ†:ç®€ä»‹ï¼Œå¦‚ä½•åœ¨ä¸€å‘¨å†…æŠ•å…¥ç”Ÿäº§ï¼Œä¹‹åå»å“ªé‡Œ

towardsdatascience.com](/how-to-build-a-recommendation-engine-quick-and-simple-aec8c71a823e) 

# æ‚¨è¿ˆå‘ç‰ˆæœ¬ 2 çš„é“è·¯

ç¥è´ºæ‚¨ï¼Œåœ¨æ‚¨éƒ¨ç½²äº†æ¨èå¼•æ“çš„ç¬¬ 1 ç‰ˆä¹‹åï¼Œæ˜¯æ—¶å€™åº†ç¥æ‚¨çš„æˆå°±äº†ï¼ä½ çš„ç¬¬ä¸€ä¸ªæ¨èå¼•æ“å·²ç»ä¸Šçº¿äº†ï¼Œå®ƒçš„è¡¨ç°è¶³å¤Ÿå¥½ï¼Œåˆ©ç›Šç›¸å…³è€…å¸Œæœ›ä½ æ”¹è¿›å®ƒï¼Œè€Œä¸æ˜¯è®©å®ƒä¸‹çº¿ã€‚ğŸ‰

ä¸å¹¸çš„æ˜¯ï¼Œå¯¹äºå¦‚ä½•ä»è¿™é‡Œæ”¹è¿›ä½ çš„æ¨èå¼•æ“ï¼Œæ²¡æœ‰ä»€ä¹ˆçµä¸¹å¦™è¯ã€‚ä½ å°†æ…¢æ…¢åœ°æ„å»ºä¸€ä¸ªé«˜åº¦å®šåˆ¶çš„è§£å†³æ–¹æ¡ˆï¼Œè€Œç°å®ä¸­çš„æˆåŠŸä¹‹è·¯çœ‹èµ·æ¥æ›´åƒæ˜¯ä¸€åœºç«çš„æ´—ç¤¼ã€‚ä½ å°†é€šè¿‡å¤§é‡çš„å®éªŒå’Œä»å¤±è´¥ä¸­å­¦ä¹ æ¥äº¤ä»˜è§£å†³æ–¹æ¡ˆã€‚)ï¼Œå¯èƒ½æ˜¯è¿«äºåˆ©ç›Šç›¸å…³è€…ã€ä½ çš„è€æ¿å’Œæ„¤æ€’çš„ç”¨æˆ·è¶Šæ¥è¶Šå¤§çš„å‹åŠ›ã€‚

![](img/291dc7b400effde23a60f93259bc8df9.png)

[OC]

æ‚¨å°†åœ¨ç‰ˆæœ¬ 1 ä¸­é¢ä¸´çš„é—®é¢˜:

*   æ–°å†…å®¹å’Œç”¨æˆ·çš„å†·å¯åŠ¨é—®é¢˜
*   åå‘äºç‚¹å‡»è¯±é¥µå†…å®¹:è‰¯å¥½çš„å“åº”æŒ‡æ ‡ï¼Œéšååœ¨æ¼æ–—ä¸­æ€¥å‰§ä¸‹é™
*   æ‚¨çš„å»ºè®®åœ¨è´¨é‡å’Œæ•°é‡ä¹‹é—´éš¾ä»¥å–èˆ
*   å·´ç‰¹ UX
*   ETL å’Œ elasticsearch é›†ç¾¤çš„æ˜‚è´µè´¹ç”¨

è®©æˆ‘ä»¬çœ‹çœ‹æˆ‘ä»¬åœ¨ç¬¬ 1 éƒ¨åˆ†ä¸­å®é™…æ„å»ºäº†ä»€ä¹ˆï¼Œä»¥åŠå®ƒä¸æ›´å¤æ‚çš„æ¨èç³»ç»Ÿç›¸æ¯”å¦‚ä½•:

![](img/cede85a2e2152173a41e4bcd070f3a1d.png)

[OC]

æˆ‘ä»¬ä»æœ€ç®€å•çš„æ¨¡å‹å¼€å§‹:åŸºäºé¡¹ç›®åˆ°é¡¹ç›®å…±ç°çš„æ¨èå¼•æ“ã€‚å°±å¦‚ä½•è§£é‡Šåˆ†æ•°è€Œè¨€ï¼Œè¿™ä¸ªæ¨¡å‹éå¸¸ç±»ä¼¼äºä¸€ä¸ªåˆ†ç±»å™¨ï¼Œæˆ‘ä»¬è·ç¦»ä¸ªæ€§åŒ–çš„é¡¹ç›®æ’åè¿˜æœ‰å¾ˆé•¿çš„è·¯è¦èµ°ã€‚è¿™æ˜¯ä¸€ä¸ªå¸¸è§çš„è¯¯è§£ï¼Œå½“å°†æ¨èæ•´åˆåˆ°äº§å“ä¸­æ—¶ï¼Œå‡è®¾åˆ†æ•°åæ˜ äº†ä¸ªæ€§åŒ–çš„æ’åæˆ–è€ƒè™‘/ç›¸å…³æ€§åˆ†æ•°ï¼Œè¿™å¯èƒ½ä¼šæŸå®³ç”¨æˆ·ä½“éªŒã€‚

# ä½¿æ‚¨çš„æ¨¡å‹æœ‰çŠ¶æ€ï¼Œä»¥è·å¾—æ›´å¥½çš„æ¨¡å‹è¯„åˆ†

å¦‚æœä½ æŒ‰ç…§å‰é¢çš„æ­¥éª¤ç”¨ Elasticsearch æ„å»ºäº†ä¸€ä¸ªå¿«é€Ÿç®€å•çš„ååŒè¿‡æ»¤æ¨èç³»ç»Ÿï¼Œé‚£ä¹ˆä½ çš„ç¬¬ 1 ç‰ˆæ¨¡å‹å¯èƒ½å¹¶ä¸å®Œç¾ï¼Œä½†åœ¨æŸç§ç¨‹åº¦ä¸Šæ˜¯å¯è¡Œçš„ã€‚åœ¨æ”¹å˜æ•´ä¸ªå®ç°ä¹‹å‰ï¼Œå°è¯•ç®€å•åœ°æ”¹è¿›å½“å‰ç‰ˆæœ¬çš„è¯„åˆ†è¯·æ±‚å¯èƒ½æ˜¯å€¼å¾—çš„ã€‚

ä½ åœ¨[ç¬¬ 1 éƒ¨åˆ†](/how-to-build-a-recommendation-engine-quick-and-simple-aec8c71a823e)ä¸­æ„å»ºçš„æ˜¯ä¸€ä¸ª**æ— çŠ¶æ€æ¨¡å‹**ã€‚æ— çŠ¶æ€æ¨¡å‹ä¸è®°å¾—ä¹Ÿä¸å…³å¿ƒä¹‹å‰çš„äº‹ä»¶ã€‚æ¯ä¸ªç”¨æˆ·äº¤äº’å’Œè¯„åˆ†è¯·æ±‚éƒ½æ˜¯å®Œå…¨ç‹¬ç«‹çš„ã€‚å› æ­¤ï¼Œæ— çŠ¶æ€æ¨¡å‹éå¸¸å®¹æ˜“ç®¡ç†ï¼Œä¾‹å¦‚ï¼Œå…è®¸åœ¨ç®€å•çš„è´Ÿè½½å¹³è¡¡å™¨åé¢è¿›è¡Œæ°´å¹³æ‰©å±•ã€‚

è¿™æä¾›äº†ç¬¬ä¸€ä¸ªæ˜æ˜¾çš„æ”¹è¿›:å°†ä¸€ä¸ªçŠ¶æ€åˆå¹¶åˆ°æ‚¨çš„æ¨¡å‹ä¸­ã€‚ç”¨æˆ·ä¸ç½‘ç«™ä¸Šçš„ä¸€ç³»åˆ—äº§å“å’Œå†…å®¹è¿›è¡Œäº’åŠ¨ã€‚å‘æ‚¨çš„æ¨¡å‹æ·»åŠ ä¸€ä¸ª**çŠ¶æ€å†…å­˜**å…è®¸æ‚¨ä½¿ç”¨ä¸€ä¸ª**äº¤äº’ç³»åˆ—**ä¸ºç”¨æˆ·æŸ¥è¯¢ Elasticsearchï¼Œè¿™æ‰©å±•äº†åŒ¹é…çš„å¯èƒ½æ€§ã€‚ä¸€æ–¹é¢ï¼Œæ‚¨å¯ä»¥ç®€å•åœ°ä½¿ç”¨å®ƒæ¥æ‰©å±•å‰å°æ•°æ®é›†ä¸­æ½œåœ¨çš„åŒç°æ•°é‡ã€‚å¦ä¸€æ–¹é¢ï¼Œæ‚¨å¯ä»¥åœ¨æ›´å¤æ‚çš„è§„åˆ™ä¸­ä½¿ç”¨å®ƒæ¥è¿‡æ»¤ç›¸å…³çš„æ¨èï¼Œä¾‹å¦‚åˆ é™¤ç”¨æˆ·ä»¥å‰å·²ç»çœ‹è¿‡çš„æ¨èã€‚

![](img/a0f1f8a38a109a4011e514d379dc0b47.png)

[OC]

ä½†æ˜¯ï¼Œæ‚¨å¸Œæœ›é¿å…å‘æ¨¡å‹æœ¬èº«æ·»åŠ çŠ¶æ€ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œæ‚¨æ€»æ˜¯å°†çŠ¶æ€ç®¡ç†å™¨ä»æ¨¡å‹çš„å…¶ä½™éƒ¨åˆ†ä¸­åˆ†ç¦»å‡ºæ¥ã€‚çŠ¶æ€ç®¡ç†å™¨åº”è¯¥æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å¾®æœåŠ¡ï¼Œå®ƒä½¿ç”¨æŸç§å½¢å¼çš„ç¼“å­˜æ¥ä¸°å¯Œæ¥è‡ªç½‘ç«™æˆ–åº”ç”¨ç¨‹åºçš„æ— çŠ¶æ€ä¼ å…¥è¯·æ±‚ã€‚å°†çŠ¶æ€ä½œä¸ºç‹¬ç«‹çš„å¾®æœåŠ¡æ¥ç®¡ç†æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„è®¾è®¡åŸåˆ™ï¼Œä¹Ÿæ˜¯æˆ‘ä¹‹å‰åœ¨åšå®¢ä¸­æåˆ°çš„ Rendezvous æ¶æ„è®¾è®¡çš„ä¸€éƒ¨åˆ†(æˆ‘åœ¨é‚£ç¯‡åšå®¢ä¸­ç§°ä¹‹ä¸ºæ¨¡å‹æ•°æ®ä¸°å¯Œå™¨):

[](/rendezvous-architecture-for-data-science-in-production-79c4d48f12b) [## ç”Ÿäº§ä¸­æ•°æ®ç§‘å­¦çš„ä¼šåˆä½“ç³»ç»“æ„

### å¦‚ä½•æ„å»ºä¸€ä¸ªå‰æ²¿çš„æ•°æ®ç§‘å­¦å¹³å°æ¥è§£å†³æ•°æ®ç§‘å­¦ä¸­çš„çœŸæ­£æŒ‘æˆ˜:ç”Ÿäº§åŒ–ã€‚

towardsdatascience.com](/rendezvous-architecture-for-data-science-in-production-79c4d48f12b) 

Redis æ˜¯å¤„ç†æ¨èç³»ç»ŸçŠ¶æ€çš„ä¸€ä¸ªå¾ˆå¥½çš„è§£å†³æ–¹æ¡ˆã€‚å®ƒé€Ÿåº¦å¿«ï¼Œé‡é‡è½»ï¼Œåœ¨ä»»ä½•äº‘ä¸­éƒ½æ˜¯å®Œå…¨æ‰˜ç®¡çš„æœåŠ¡ï¼Œä¾‹å¦‚ Redis çš„ AWS ElasticCacheã€‚ä¸‹é¢çš„ä»£ç ä½¿ç”¨ä¸€ä¸ª**æ»‘åŠ¨çª—å£ TTL** æ¥å­˜å‚¨ç”¨æˆ·äº¤äº’ï¼Œå¹¶è‡ªåŠ¨ä»ç¼“å­˜ä¸­åˆ é™¤æ—§çš„äº¤äº’ã€‚è¯·éšæ„æ ¹æ®æ‚¨çš„éœ€æ±‚è¿›è¡Œè°ƒæ•´:

[](https://gitlab.com/jan-teichmann/redis_user_interaction_cache) [## ç®€Â·æ³°å¸Œæ›¼/ redis_user_interaction_cache

### GitLab.com

gitlab.com](https://gitlab.com/jan-teichmann/redis_user_interaction_cache) 

**è¿™ä¸ªé€‰é¡¹çš„å¥½å¤„**:ä½ è·å¾—äº†æ›´å¤§æ•°é‡çš„åŒç°ä¿¡å·ï¼Œå¹¶ä¸”æœ‰æœºä¼šè¿‡æ»¤æ‰ç”¨æˆ·å·²ç»çœ‹è¿‡çš„æ¨èã€‚è¿™å¯ä»¥åœ¨ä¸å¢åŠ é¢å¤–å·¥ä½œçš„æƒ…å†µä¸‹æé«˜æ•°é‡å’Œè´¨é‡ã€‚

**è¿™ä¸ªé€‰é¡¹çš„ç¼ºç‚¹**:ä¸è¦æœŸå¾…å¥‡è¿¹:ä½ ä»ç„¶åªæ˜¯ç”¨åŒæ ·çš„åŸå§‹æ•°æ®å·¥ä½œã€‚å›æŠ¥æ˜¯é€’å‡çš„ï¼Œä½ èƒ½ä»åŒæ ·çš„æ•°æ®ä¸­è·å¾—çš„é™„åŠ å€¼ä¹Ÿæ˜¯æœ‰é™çš„ã€‚

# æ·»åŠ è¶Šæ¥è¶Šå¤šçš„æ•°æ®

å› ä¸ºä½ åªèƒ½ä»ç›¸åŒçš„æ•°æ®ä¸­è·å¾—å¦‚æ­¤å¤šçš„é¢å¤–ä»·å€¼ï¼Œæ‰€ä»¥æˆ‘ä»¬æœ‰å¦ä¸€ä¸ªæ˜æ˜¾çš„æ–¹æ³•æ¥æ”¹è¿›æˆ‘ä»¬çš„æ¨èç³»ç»Ÿã€‚ä½ çš„ç”¨æˆ·å¯èƒ½ä¼šä»¥å¤šç§ä¸åŒçš„æ–¹å¼ä¸ä½ çš„ç½‘ç«™ã€åº”ç”¨å’Œäº§å“äº’åŠ¨:

*   æœç´¢äº§å“
*   æŸ¥çœ‹äº§å“è¯¦æƒ…
*   è´­ä¹°äº§å“å’Œé€€è´§
*   è¯„ä»·å’Œåˆ†äº«äº§å“
*   å‚ä¸è¥é”€ï¼Œä½¿ç”¨æŠ˜æ‰£ä»£ç 

ä½ çš„æ¨èå¼•æ“çš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬åªä½¿ç”¨äº†ä¸€ä¸ªç”¨æˆ·äº¤äº’ï¼Œå¹¶ä¸”åŸºäºéšå¼åé¦ˆæ¥æœ€å¤§åŒ–æ¨èè´¨é‡çš„ä¿¡å·é‡ã€‚åŠ å…¥é¢å¤–çš„æ•°æ®æ˜¯å€¼å¾—çš„ï¼Œç‰¹åˆ«æ˜¯ä¸ºäº†æé«˜æ¨èçš„è´¨é‡å’Œè·å–æ‰€éœ€çš„ä¸šåŠ¡é€»è¾‘ã€‚

æœ€ç®€å•çš„é€‰æ‹©æ˜¯ï¼ŒæŒ‰ç…§ä¸ç¬¬ä¸€ä¸ªæŒ‡æ ‡å®Œå…¨ç›¸åŒçš„é€»è¾‘ï¼Œå‘ç°æœ‰çš„ Elasticsearch é›†ç¾¤**æ·»åŠ ä¸€ä¸ªé¢å¤–çš„æ–‡æ¡£ç±»å‹ã€‚Elasticsearch ä¸­çš„æ–‡æ¡£ç±»å‹ç±»ä¼¼äº RDBs ä¸­çš„è¡¨ã€‚ç„¶åï¼Œå¯¹æ¯ç§æ–‡æ¡£ç±»å‹åˆ†åˆ«è¿è¡Œä¸¤ä¸ªå¹¶è¡ŒæŸ¥è¯¢ï¼Œè¿™ä¸¤ä¸ªæŸ¥è¯¢å¯ä»¥ç‹¬ç«‹è°ƒæ•´ï¼Œä»¥åæ˜ åº¦é‡çš„è´¨é‡ã€‚æ‚¨å¯ä»¥é€šè¿‡è°ƒæ•´ Elasticsearch çš„ significant_terms èšåˆä¸­çš„â€œmin_doc_countâ€è®¾ç½®æˆ–åˆ‡æ¢ç”¨äºå®šä¹‰é‡è¦æ¨èçš„ç»Ÿè®¡æ•°æ®æ¥å®ç°è¿™ä¸€ç‚¹ã€‚æ‚¨å¯ä»¥é˜…è¯»[æ–‡æ¡£](https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-bucket-significantterms-aggregation.html#_parameters)ä¸­çš„å¯ç”¨é€‰é¡¹ï¼Œå¹¶æŸ¥çœ‹æˆ‘çš„å¦ä¸€ç¯‡æ–‡ç« ä¸­çš„ä»£ç ç¤ºä¾‹:**

[](/how-to-build-a-recommendation-engine-quick-and-simple-aec8c71a823e) [## å¦‚ä½•å¿«é€Ÿç®€å•åœ°æ„å»ºæ¨èå¼•æ“

### ç¬¬ 1 éƒ¨åˆ†:ç®€ä»‹ï¼Œå¦‚ä½•åœ¨ä¸€å‘¨å†…æŠ•å…¥ç”Ÿäº§ï¼Œä¹‹åå»å“ªé‡Œ

towardsdatascience.com](/how-to-build-a-recommendation-engine-quick-and-simple-aec8c71a823e) 

æ­¤é€‰é¡¹çš„ä¼˜åŠ¿:æ˜“äºå®æ–½ï¼Œå› ä¸ºæ‚¨åªéœ€é‡æ–°åˆ©ç”¨ç°æœ‰çš„è§£å†³æ–¹æ¡ˆå’Œä»£ç ï¼Œå°†é¢å¤–çš„æ•°æ®ä½œä¸ºç‹¬ç«‹çš„æ–‡æ¡£ç±»å‹æ¥æ”¶ã€‚è¿™ä¸ºåœ¨å¼¹æ€§æœç´¢æ¨èçš„åŸºç¡€ä¸Šæ„å»ºå¤æ‚çš„è§„åˆ™å¼•æ“æä¾›äº†å¹¿æ³›çš„é€‰æ‹©ï¼Œä»¥çº³å…¥æ‰€éœ€çš„ä¸šåŠ¡é€»è¾‘ï¼Œä¾‹å¦‚ï¼Œå¯¹ä¿ƒé”€çš„åå¥½ã€‚

**è¿™ä¸ªé€‰é¡¹çš„ç¼ºç‚¹**:å¢åŠ äº†å¼¹æ€§æœç´¢é›†ç¾¤çš„æˆæœ¬ã€‚

éšç€æ‚¨å‘æ¨¡å‹ä¸­æ·»åŠ è¶Šæ¥è¶Šå¤šçš„æŒ‡æ ‡ï¼Œæ‚¨å°†ä¼šæ³¨æ„åˆ°ï¼Œä¸ä»…æ‚¨çš„ Elasticsearch é›†ç¾¤çš„æˆæœ¬å¤±æ§ï¼Œæ‚¨çš„è§„åˆ™å¼•æ“ä¸­å¤„ç†ä¿¡å·çš„æ—¶é—´å’Œ CPU èµ„æºä¹ŸåŒæ ·æ€¥å‰§å¢åŠ ã€‚æ‚¨çš„è§„åˆ™å¼•æ“å°†ä¿¡å·è½¬æ¢æˆæœ€ç»ˆçš„å»ºè®®å¼€å§‹å˜å¾—éå¸¸å¤æ‚ã€‚å¯¹è§„åˆ™å¼•æ“çš„å›é¡¾å¯èƒ½ä¼šå¾—å‡ºè¿™æ ·çš„ç»“è®º:æ‚¨æ­£åœ¨å¤„ç†æ•°æ®ä¹‹é—´çš„å¤æ‚å…³ç³»ï¼Œå¯¹äºè¿™äº›ç”¨ä¾‹æœ‰æ›´å¥½çš„è§£å†³æ–¹æ¡ˆ:å¯èƒ½æ˜¯æ—¶å€™è€ƒè™‘ä¸€ä¸ª**å›¾å½¢æ•°æ®åº“äº†ï¼**

![](img/7e6de8081387f41d43bab840c62f24ec.png)

Apache Tinkerpop 3 logo. Fair usage

å›¾å½¢æ•°æ®åº“æ˜¯é«˜åº¦ç›¸å…³æ•°æ®çš„å®Œç¾è§£å†³æ–¹æ¡ˆï¼Œä¾‹å¦‚å¤§é‡çš„å…³ç³»ä»¥åŠå¤æ‚çš„å…³ç³»ã€‚graph DB å°†è¿™äº›å…³ç³»å…·ä½“åŒ–ä¸ºå›¾ä¸­çš„è¾¹ï¼Œä»è€Œå¤§å¤§åŠ å¿«äº†åŸºäºæ•°æ®(èŠ‚ç‚¹)ä¹‹é—´çš„å…³ç³»çš„æŸ¥è¯¢é€Ÿåº¦ï¼Œè€Œä¸æ˜¯åœ¨æ¯ä¸ªæŸ¥è¯¢ä¸­åŠ¨æ€åœ°è§£å†³è¿™äº›å…³ç³»ã€‚graph DBs æœ‰è®¸å¤šä¾›åº”å•†ï¼Œç»™å‡ºä»»ä½•å»ºè®®éƒ½è¶…å‡ºäº†è¿™ç¯‡åšå®¢çš„èŒƒå›´ã€‚è¿™å¯èƒ½æ˜¯ä¸€ç¯‡å³å°†å‘è¡¨çš„åšæ–‡çš„ä¸»é¢˜ã€‚

![](img/2b872358ae636bf80a6ef4d3e98e0535.png)

Taken from the Apache Tinkerpop documentation: [https://tinkerpop.apache.org/docs/current/tutorials/the-gremlin-console/](https://tinkerpop.apache.org/docs/current/tutorials/the-gremlin-console/) Fair usage

æ­¤é€‰é¡¹çš„ä¼˜åŠ¿:å¯ä»¥å¿«é€Ÿå¤„ç†å¤æ‚çš„å…³ç³»ï¼Œç”¨å¤æ‚çš„ä¸šåŠ¡é€»è¾‘æ‰“å¼€å¤æ‚çš„ç”¨ä¾‹ã€‚

è¿™ä¸ªé€‰é¡¹çš„ç¼ºç‚¹æ˜¯:ä½ å¿…é¡»å°†ä½ çš„æ¨èé€»è¾‘è½¬æ¢æˆå›¾å½¢æŸ¥è¯¢ã€‚

# æ”¹å–„æ‚¨çš„ç”¨æˆ·å®šä¹‰

ååŒè¿‡æ»¤å»ºç«‹åœ¨ç”¨æˆ·äº¤äº’æ•°æ®ä¸­çš„å…±ç°ä¹‹ä¸Šã€‚å¦‚æœä½ çš„ä¼ä¸šæ²¡æœ‰ä¸€ä¸ªå¼ºå¤§çš„å•ä¸€ç”¨æˆ·å®šä¹‰ï¼Œé‚£ä¹ˆå°±å¾ˆéš¾åˆ›å»ºä¸€ä¸ªå¥½çš„è®°å½•é•¿æœŸç”¨æˆ·äº¤äº’çš„å†å²çŸ©é˜µã€‚

![](img/b822cb8546b77b323d4f447787135641.png)

Recreation of illustration in â€œPractical Machine Learning, Ted Dunning & Ellen Friedman, Oâ€™Reilly 2014

ç»“æœï¼Œåœ¨æ ¹æ®ç”¨æˆ·äº¤äº’çš„å†å²å»ºç«‹çš„åŒç°çŸ©é˜µä¸­å°†æœ‰å°‘å¾—å¤šçš„ä¿¡å·ã€‚

å½“æ‚¨çš„ç”¨æˆ·ä½¿ç”¨å¤šç§è®¾å¤‡ï¼Œå¹¶ä¸”æ²¡æœ‰åŠ¨åŠ›åˆ›å»ºå¸æˆ·æˆ–ç™»å½•ä»¥ä½¿ç”¨æ‚¨çš„æœåŠ¡æ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°è¿™ç§æƒ…å†µã€‚å¦‚æœä½ çš„ç½‘ç«™ä¸Šæœ‰å¾ˆå¤§æ¯”ä¾‹çš„åŒ¿åæµé‡ï¼Œé‚£ä¹ˆçœ‹çœ‹ä¸€ä¸ªæ¦‚ç‡æ¨¡å‹æ¥è¯†åˆ«ä¸€æ®µæ—¶é—´å†…è·¨è®¾å¤‡çš„å•ä¸ªç”¨æˆ·æ˜¯å€¼å¾—çš„ã€‚

![](img/8812391d323bf9f69d7076ca166f14c6.png)

Public domain image, [Pxhere](https://pxhere.com/en/photo/1444327)

Gartner å°†è·¨è®¾å¤‡è¯†åˆ«(XDID)ç§°ä¸ºå€¼å¾—å…³æ³¨çš„æ–°å…´æŠ€æœ¯ï¼Œæ•°æ®ç§‘å­¦å¯ä»¥æä¾›å¸®åŠ©ã€‚è¯†åˆ«ç”¨æˆ·çš„ä¸åŒé€‰é¡¹æœ‰:å¸æˆ·ç™»å½•ã€Cookie è¯†åˆ«ã€è®¾å¤‡æŒ‡çº¹è¯†åˆ«å’Œ IP åŒ¹é…ã€‚

**IP åŒ¹é…**æ˜¯è¾ƒä½è´¨é‡çš„æ¦‚ç‡é€‰é¡¹ï¼Œç”¨äºè¯†åˆ«å•ä¸ªç”¨æˆ·ã€‚ç„¶è€Œï¼ŒIP æ˜¯è·¨è®¾å¤‡å¯ç”¨çš„ã€‚ä¸ 4G ç½‘ç»œæˆ–å…¬å…± Wifi ä¸€æ ·ï¼ŒåŠ¨æ€å…±äº« IP ä¹Ÿå­˜åœ¨é—®é¢˜ã€‚æ— è®ºå¦‚ä½•ï¼ŒIP æ˜¯æœ€å¯è¡Œçš„é€‰æ‹©ã€‚æˆ‘å†™äº†ä¸€æ•´ç¯‡å…³äºä½¿ç”¨ IP å’Œæ—¶é—´æˆ³çš„å›¾è¡¨æ¥åŒ¹é…å•ä¸ªç”¨æˆ·å’Œ Spark çš„ GraphX å¼•æ“çš„æ–‡ç« :

[](/single-userid-matching-for-anonymous-users-across-devices-with-graphx-72fe111ac44b) [## ä½¿ç”¨ GraphX è·¨è®¾å¤‡ä¸ºåŒ¿åç”¨æˆ·åŒ¹é…å•ä¸ªç”¨æˆ·æ ‡è¯†

### å¦‚ä½•å®ç°æ¦‚ç‡ä¼šè¯ç›¸ä¼¼æ€§æ¥ä¸ºè·¨è®¾å¤‡å’ŒåŒ¿åç”¨æˆ·åˆ›å»ºå•ä¸ªç”¨æˆ· IDâ€¦

towardsdatascience.com](/single-userid-matching-for-anonymous-users-across-devices-with-graphx-72fe111ac44b) 

**è¿™ä¸ªé€‰é¡¹çš„å¥½å¤„**:è·¨è®¾å¤‡åŒ¹é…å•ä¸ªç”¨æˆ·å¯ä»¥æ˜¾è‘—æé«˜åŒç°ä¿¡å·çš„è´¨é‡ï¼Œå¹¶ä¸”å…·æœ‰è¿œè¿œè¶…å‡ºå•ç‹¬æ¨èçš„ç”¨ä¾‹ã€‚

**è¿™ä¸ªé€‰é¡¹çš„ç¼ºç‚¹**:å•ç”¨æˆ·åŒ¹é…æœ¬èº«å°±æ˜¯ä¸€ä¸ªå¤æ‚çš„è¯é¢˜ã€‚è¿™æ—¢æ˜¯ä¸€ä¸ªæœ‰è¶£çš„æ•°æ®ç§‘å­¦é—®é¢˜ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªéš¾ä»¥è§£å†³çš„æ•°æ®å·¥ç¨‹æŒ‘æˆ˜ã€‚

# æ‰¹é‡è®¡ç®—ä¿¡å·

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬ä¸€ç›´ä½¿ç”¨ Elasticsearch ä½œä¸ºåç«¯ï¼Œå®æ—¶è®¡ç®—æ¨èä¿¡å·ã€‚è¿™åœ¨å»ºè®®è·¯çº¿å›¾çš„æ—©æœŸé˜¶æ®µå¾ˆæœ‰ä»·å€¼ï¼Œå¯ä»¥è¿›è¡Œçµæ´»çš„å®éªŒï¼Œä¾‹å¦‚åœ¨æ•°é‡å’Œè´¨é‡ä¹‹é—´è¿›è¡Œæƒè¡¡ã€‚ä»¥è¿™ç§æ–¹å¼ä½¿ç”¨ Elasticsearch çš„ç¼ºç‚¹æ˜¯æ¯ä¸ªæŸ¥è¯¢éƒ½æœ‰å¾ˆå¤§çš„ CPU å¼€é”€ã€‚å¦‚æœååŒè¿‡æ»¤å¯¹æ‚¨çš„ä½¿ç”¨æƒ…å†µå¾ˆæœ‰æ•ˆï¼Œé‚£ä¹ˆæœ€å¥½é€‰æ‹©ä¸€ä¸ªæ›´å¥½çš„ååŒè¿‡æ»¤ç®—æ³•ï¼Œå¹¶æ‰¹é‡è®¡ç®—æ¨èä¿¡å·ï¼Œè€Œä¸æ˜¯åŒ†å¿™è®¡ç®—ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬åªå°† Elasticsearch ä½œä¸ºå‘ç”¨æˆ·æä¾›æ¨èçš„è¡¨ç¤ºå±‚ã€‚

æˆ‘ä»¬å¯ä»¥ç®€å•åœ°æ‰¹é‡è®¡ç®—é¡¹ç›®-é¡¹ç›®å…±ç°ä¿¡å·ã€‚è¿™å¯ä»¥é€šè¿‡ CLI ä¸­å­˜åœ¨çš„ Mahout çš„ spark-itemsimilarity å®ç°æ¥å®Œæˆã€‚è¿™ä½¿å¾—è°ƒç”¨ Mahout åº“ä¸­çš„ spark ç¨‹åºå¹¶ä¸ºå…¶æä¾›ç›¸å…³æ•°æ®çš„è·¯å¾„å˜å¾—éå¸¸ç®€å•ã€‚ä½ å¯ä»¥åœ¨ [Mahout ç½‘ç«™](https://mahout.apache.org/users/algorithms/intro-cooccurrence-spark.html)ä¸Šæ‰¾åˆ°è¯¦ç»†çš„æ–‡æ¡£ã€‚æ‚¨è¿˜å¯ä»¥çœ‹åˆ° Mahout çš„è§£å†³æ–¹æ¡ˆæ¶æ„ä¸æˆ‘ä»¬çš„ç›¸ä¼¼ä¹‹å¤„ã€‚æˆ‘ä»¬ä½¿ç”¨ Elasticsearch è€Œä¸æ˜¯ Solr å’Œ Redis ä½œä¸ºç”¨æˆ·äº¤äº’çš„ç¼“å­˜ã€‚å…¶ä½™éƒ¨åˆ†éµå¾ªå®Œå…¨ç›¸åŒçš„è§£å†³æ–¹æ¡ˆæ¶æ„ã€‚

![](img/96fcd6d9cd9cd601376d81fca04e5ee6.png)

[https://mahout.apache.org/docs/latest/algorithms/recommenders/](https://mahout.apache.org/docs/latest/algorithms/recommenders/)

```
**spark-itemsimilarity Mahout 1.0****Usage: spark-itemsimilarity [options]****Input, output options**-i <value> | --input <value>Input path, may be a filename, directory name, or comma delimited list of HDFS supported URIs (required)-i2 <value> | --input2 <value>Secondary input path for cross-similarity calculation, same restrictions as "--input" (optional). Default: empty.-o <value> | --output <value>Path for output, any local or HDFS supported URI (required)**Algorithm control options:**-mppu <value> | --maxPrefs <value>Max number of preferences to consider per user (optional). Default: 500-m <value> | --maxSimilaritiesPerItem <value>Limit the number of similarities per item to this number (optional). Default: 100Note: Only the Log Likelihood Ratio (LLR) is supported as a similarity measure.**Input text file schema options:**-id <value> | --inDelim <value>Input delimiter character (optional). Default: "[,\t]"-f1 <value> | --filter1 <value>String (or regex) whose presence indicates a datum for the primary item set (optional). Default: no filter, all data is used-f2 <value> | --filter2 <value>String (or regex) whose presence indicates a datum for the secondary item set (optional). If not present no secondary dataset is collected-rc <value> | --rowIDColumn <value>Column number (0 based Int) containing the row ID string (optional). Default: 0-ic <value> | --itemIDColumn <value>Column number (0 based Int) containing the item ID string (optional). Default: 1-fc <value> | --filterColumn <value>Column number (0 based Int) containing the filter string (optional). Default: -1 for no filterUsing all defaults the input is expected of the form: "userID<tab>itemId" or "userID<tab>itemID<tab>any-text..." and all rows will be used**File discovery options:**-r | --recursiveSearched the -i path recursively for files that match --filenamePattern (optional), Default: false-fp <value> | --filenamePattern <value>Regex to match in determining input files (optional). Default: filename in the --input option or "^part-.*" if --input is a directory**Output text file schema options:**-rd <value> | --rowKeyDelim <value>Separates the rowID key from the vector values list (optional). Default: "\t"-cd <value> | --columnIdStrengthDelim <value>Separates column IDs from their values in the vector values list (optional). Default: ":"-td <value> | --elementDelim <value>Separates vector element values in the values list (optional). Default: " "-os | --omitStrengthDo not write the strength to the output files (optional), Default: false.This option is used to output indexable data for creating a search engine recommender.Default delimiters will produce output of the form: "itemID1<tab>itemID2:value2<space>itemID10:value10..."**Spark config options:**-ma <value> | --master <value>Spark Master URL (optional). Default: "local". Note that you can specify the number of cores to get a performance improvement, for example "local[4]"-sem <value> | --sparkExecutorMem <value>Max Java heap available as "executor memory" on each node (optional). Default: 4g-rs <value> | --randomSeed <value>-h | --helpprints this usage text
```

**æ­¤é€‰é¡¹çš„ä¼˜åŠ¿**:æ›´ä¾¿å®œçš„æ‰¹é‡è¯„åˆ†ç‰ˆæœ¬ï¼ŒåŒæ—¶ä»ç„¶æ˜“äºä½¿ç”¨å’Œæ“ä½œã€‚

è¿™ä¸ªé€‰é¡¹çš„ç¼ºç‚¹:æ²¡æœ‰å¤ªå¤šçš„çµæ´»æ€§å’Œå¤æ‚æ€§ã€‚è¿™å°†ä½¿æ‚¨çš„å¼¹æ€§æœç´¢æˆæœ¬å¾—åˆ°æ§åˆ¶ï¼Œä½†ä¸ä¼šæé«˜æ‚¨çš„æ¨èçš„æ€§èƒ½ï¼Œå¦‚æœè¿™æ˜¯æ‚¨çš„ç‰ˆæœ¬ 1 å®æ–½çš„ä¸€ä¸ªé—®é¢˜ã€‚

# ä½¿ç”¨æ½œåœ¨å› ç´ æ¨¡å‹æ”¹è¿›æ‚¨çš„ç®—æ³•é€‰æ‹©

åœ¨æˆ‘ä»¬å†³å®šæ‰¹é‡åˆ›å»ºæˆ‘ä»¬çš„æ¨èä¹‹åï¼Œæˆ‘ä»¬å°†æ¨¡å‹çš„è®­ç»ƒã€è¯„åˆ†å’ŒæœåŠ¡åˆ†ç¦»ä¸ºå¤šä¸ªæ­¥éª¤ã€‚è¿™ä¹Ÿä¸ºæˆ‘ä»¬ç ”ç©¶æ›´å¤æ‚çš„æ¨èç®—æ³•æ‰“å¼€äº†å¤§é—¨ï¼Œè€Œä¸ä»…ä»…æ˜¯æˆ‘ä»¬ç›®å‰ä½¿ç”¨çš„åŸºäºå…±ç°çš„æ¨¡å‹ã€‚ä¸‹ä¸€æ­¥å°†æ˜¯ä½¿ç”¨çŸ©é˜µåˆ†è§£çš„åŸºäºæ½œåœ¨å› ç´ æ¨¡å‹çš„æ¨èç³»ç»Ÿã€‚

![](img/175ae0b10842ac86fea05a5fcf6d249d.png)

[OC]

æ½œåœ¨å› ç´ æ¨¡å‹å°†å…è®¸æˆ‘ä»¬åˆ›å»º(1)ä½¿ç”¨äº§å“å› ç´ ç›¸ä¼¼æ€§çš„é¡¹ç›®-é¡¹ç›®æ¨¡å‹å’Œ(2)é¡¹ç›®-ç”¨æˆ·æ¨¡å‹ã€‚

![](img/afd9c618b379a45a6559d295a441ec95.png)

[OC]

æ‰¹é‡æ½œåœ¨å› ç´ æ¨¡å‹çš„ä¸€ä¸ªå¥½çš„è§£å†³æ–¹æ¡ˆæ˜¯ Spark ä¸­çš„ ALS(äº¤æ›¿æœ€å°äºŒä¹˜æ³•)å®ç°ï¼Œè¿™æ˜¯ä¸€ç§ç”¨äºæ¨èå¼•æ“çš„çŸ©é˜µåˆ†è§£æŠ€æœ¯ã€‚å®ƒè¢«ç§°ä¸ºäº¤æ›¿æœ€å°äºŒä¹˜æ³•ï¼Œå› ä¸ºè¯¥ç®—æ³•åˆ†åˆ«åœ¨æ”¹å–„é¡¹ç›®å’Œç”¨æˆ·å› å­ä¹‹é—´äº¤æ›¿:è¯¥ç®—æ³•é¦–å…ˆå›ºå®šç”¨æˆ·å› å­ï¼Œç„¶åå¯¹é¡¹ç›®å› å­è¿è¡Œæ¢¯åº¦ä¸‹é™ã€‚ç„¶åï¼Œå®ƒåˆ‡æ¢å’Œå›ºå®šé¡¹ç›®å› ç´ ï¼Œä»¥æ”¹å–„ç”¨æˆ·å› ç´ ã€‚ALS ç®—æ³•å…·æœ‰å¾ˆå¼ºçš„å¯æ‰©å±•æ€§ï¼Œå¯ä»¥ä»¥åˆ†å¸ƒå¼æ–¹å¼å¹¶è¡Œè¿è¡Œï¼Œå¹¶ä½¿ç”¨ Spark ML éå¸¸é«˜æ•ˆåœ°å¤„ç†å¤§å‹æ•°æ®é›†ã€‚

ä½ å¯ä»¥åœ¨[æ–‡æ¡£](https://spark.apache.org/docs/2.2.0/ml-collaborative-filtering.html)ä¸­æ‰¾åˆ°ä¸€ä¸ªç”¨ Spark ML å®ç° ALS çš„ä¾‹å­ã€‚æˆ‘ä»¬ä»ç„¶ä½¿ç”¨å‰é¢è®¨è®ºè¿‡çš„ç›¸åŒçš„è§£å†³æ–¹æ¡ˆæ¶æ„ï¼ŒSpark ML æä¾›äº†ä¸ºç”¨æˆ·é¡¹ç›®æ¨¡å‹åˆ›å»ºå»ºè®®çš„æ–¹æ³•ã€‚

![](img/9529ff1cc2957d5a2c1b8b324fed62ab.png)

[OC]

ä½†æ˜¯ï¼Œæˆ‘ä»¬å¿…é¡»ç¼–å†™ä¸€äº›è‡ªå®šä¹‰ä»£ç æ¥è®¡ç®—ä¸€ä¸ª**é¡¹ç›®-é¡¹ç›®æ¨¡å‹**çš„äº§å“å› ç´ çš„ç›¸ä¼¼æ€§ã€‚è®¡ç®—äº§å“ä¹‹é—´æ‰€æœ‰å¯¹çš„ç›¸ä¼¼æ€§ä¸é€‚ç”¨äºå¤§å‹äº§å“ç›®å½•ã€‚ä¸æ–­å¢é•¿çš„ç»„åˆæ•°é‡ **O(n^2)** å¾ˆå¿«å¯¼è‡´ä»£ä»·è¿‡é«˜çš„æ´—ç‰Œæ“ä½œå’Œä¸å¯è¡Œçš„è®¡ç®—æ—¶é—´ã€‚Spark æä¾›äº†ä¸€ä¸ªä½¿ç”¨**ä½ç½®æ•æ„Ÿæ•£åˆ—æ³•** ( [LSH](https://spark.apache.org/docs/latest/ml-features#locality-sensitive-hashing) )çš„è§£å†³æ–¹æ¡ˆï¼Œè¿™æ˜¯ä¸€ä¸ªæ›´åŠ æœ‰æ•ˆçš„è¯†åˆ«**è¿‘ä¼¼æœ€è¿‘é‚»å±…**çš„æ–¹æ³•ã€‚LSH ä½¿ç”¨ä¸€ç§ç‰¹æ®Šçš„**å“ˆå¸Œå‡½æ•°**æ¥é™ä½æ•°æ®çš„ç»´åº¦ï¼ŒåŒæ—¶æ•°æ®è¶Šç›¸ä¼¼ï¼Œå“ˆå¸Œå†²çªçš„å¯èƒ½æ€§å°±è¶Šå¤§ã€‚è¿™æ„å‘³ç€ç›¸ä¼¼çš„æ•°æ®å¯èƒ½ä¼šå‡ºç°åœ¨åŒä¸€ä¸ªå­˜å‚¨æ¡¶ä¸­ï¼Œè€Œä¸ä¼šå‡ºç°åœ¨å…·æœ‰ä¸åŒæ•°æ®çš„å­˜å‚¨æ¡¶ä¸­ã€‚LSH æ˜¯ä¸€ç§æ¦‚ç‡è¿‘ä¼¼å€¼ï¼Œå®ƒæä¾›äº†é€Ÿåº¦å’Œå‡†ç¡®æ€§ä¹‹é—´çš„æƒè¡¡ã€‚å¯¹äºæˆ‘ä»¬çš„é¡¹ç›®-é¡¹ç›®æ¨èæ¨¡å‹çš„é¡¹ç›®æ½œåœ¨å› ç´ çš„èšç±»é—®é¢˜ï¼Œæˆ‘ä»¬ä½¿ç”¨ [**éšæœºæŠ•å½±**](https://en.wikipedia.org/wiki/Locality-sensitive_hashing) ä½œä¸ºæˆ‘ä»¬çš„æ•£åˆ—å‡½æ•°ï¼Œå…¶è¿‘ä¼¼ä¸º**ä½™å¼¦ç›¸ä¼¼åº¦**ç”¨äºæˆ‘ä»¬çš„äº§å“å‘é‡çš„åˆ†å—ã€‚

ä»¥ä¸‹ä»£ç æ˜¯ä¸€ä¸ªä½¿ç”¨ Spark ML ALS è¿›è¡ŒååŒè¿‡æ»¤å’Œ LSHï¼Œæ ¹æ®é¡¹ç›®ç›¸ä¼¼æ€§åˆ›å»ºé¡¹ç›®-é¡¹ç›®æ¨¡å‹çš„ç¤ºä¾‹:

```
import pyspark.sql.functions as F
from pyspark.ml.evaluation import RegressionEvaluator
from pyspark.ml.recommendation import ALS
from pyspark.sql import Row# ALS Example from the Spark Documentationlines = spark.read.text("sample_movielens_ratings.txt").rdd
parts = lines.map(lambda row: row.value.split("::"))
ratingsRDD = parts.map(
    lambda p: Row(
        userId=int(p[0]), movieId=int(p[1]),
        rating=float(p[2]), timestamp=int(p[3])
    )
)ratings = spark.createDataFrame(ratingsRDD)
(training, test) = ratings.randomSplit([0.8, 0.2])

# Build the recommendation model using ALS on the training data
# Note we set cold start strategy to 'drop' to ensure we don't get NaN evaluation metricsals = ALS(
    maxIter=5, regParam=0.01, userCol="userId", itemCol="movieId", 
    ratingCol="rating", coldStartStrategy="drop"
)
model = als.fit(training)# Evaluate the model by computing the RMSE on the test data
predictions = model.transform(test)
evaluator = RegressionEvaluator(
    metricName="rmse", labelCol="rating", predictionCol="prediction"
)
rmse = evaluator.evaluate(predictions)
# Root-mean-square error = 1.7866152217057665**####################################################
# User-Item model predictions using latent factors #
####################################################**# Generate top 10 movie recommendations for each user
userRecs = model.recommendForAllUsers(10)
# Generate top 10 user recommendations for each movie
movieRecs = model.recommendForAllItems(10)
userRecs.show(1, False)
â€œâ€â€
+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|userId|recommendations                                                                                                                                                      |
+------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|28    |[[12, 4.987671], [81, 4.968367], [92, 4.862609], [31, 4.0329857], [49, 4.024806], [2, 3.8403687], [82, 3.7117398], [62, 3.4866638], [61, 3.4003847], [24, 3.1223223]]|
+------+-------------------------------------------------------------
â€œâ€â€**#####################################################
# Item-Item Model based on latent factor similarity #
#####################################################**from pyspark.ml.feature import BucketedRandomProjectionLSH
from pyspark.ml.linalg import Vectors, VectorUDTvector_udf = F.udf(lambda l: Vectors.dense(l), VectorUDT())itemFactors = model.itemFactors.withColumn(
    'itemVector', vector_udf(F.col('features'))
)brp = BucketedRandomProjectionLSH(
    inputCol="itemVector", outputCol="hashes", bucketLength=2.0,
    numHashTables=3
)# Hashes of factors match with a probability proportional to their
# cosine similarity
brp_model = brp.fit(itemFactors)recommendations = (
   brp_model
    .approxSimilarityJoin(itemFactors, itemFactors, 2.0,
         distCol="dist")
    .select(
        F.col("datasetA.id").alias("idA"),
        F.col("datasetB.id").alias("idB"),
        F.col("dist")
    )
    .filter('idA != idB')
    .withColumn('recommendation', F.concat_ws('-',
        F.when(F.col('idA') < F.col('idB'),
        F.col('idA')).otherwise(F.col('idB')),
        F.when(F.col('idA') < F.col('idB'),
        F.col('idB')).otherwise(F.col('idA')))
    )
    .select('recommendation', 'dist').distinct()
    .orderBy(F.col('dist'))
)recommendations.show()
â€œâ€â€
+--------------+------------------+
|recommendation|              dist|
+--------------+------------------+
|         15-99|0.6752175108957209|
|         78-86| 0.766118452902565|
|         17-46|1.1002650472525193|
|         15-97|1.1036687784393326|
|         15-78|1.1089519518538236|
â€œâ€â€
```

å®Œæ•´çš„ä»£ç ç¤ºä¾‹å¯åœ¨æ­¤å¤„æ‰¾åˆ°:

[](https://gitlab.com/snippets/1915919) [## Spark ALS é¡¹ç›®-é¡¹ç›®ç›¸ä¼¼æ€§(1915919 ç¾å…ƒ)ç‰‡æ®µ

### GitLab.com

gitlab.com](https://gitlab.com/snippets/1915919) 

**æ­¤é€‰é¡¹çš„ä¼˜åŠ¿**:æ›´ä¾¿å®œä¸”å¯æ‰©å±•çš„æ‰¹å¤„ç†æ¨¡å‹ï¼ŒåŒæ—¶æä¾›ç”¨æˆ·-é¡¹ç›®å’Œé¡¹ç›®-é¡¹ç›®æ¨¡å‹ã€‚

**è¿™ä¸ªé€‰é¡¹çš„ç¼ºç‚¹**:æ›´å¤æ‚çš„æ¨¡å‹ï¼Œæœ‰æ›´å¤šçš„**è¶…å‚æ•°**æ¥è°ƒæ•´ ALS å’Œ LSHã€‚

# ä¸ºæ‚¨çš„æ•°æ®å’Œæ¨¡å‹æ‰¾åˆ°æ›´å¤šåº”ç”¨

è¿„ä»Šä¸ºæ­¢ï¼Œä½ çš„æ¨¡å‹äº§ç”Ÿäº†ä¸€äº›å»ºè®®ï¼Œä½†è¿™ä¸ä¸€å®šæ˜¯ä½¿ç”¨ä½ çš„è¡Œä¸ºæ•°æ®å’Œæ½œåœ¨å› ç´ æ¨¡å‹çš„å”¯ä¸€æ–¹å¼ã€‚ä½ çš„å…¬å¸å¯èƒ½æœ‰ä¸€ä¸ªå®¢æˆ·å…³ç³»ç®¡ç†æˆ–è¥é”€å›¢é˜Ÿï¼Œä»–ä»¬ä¼šå–œæ¬¢ä¸€äº›**ç»†åˆ†**ä½œä¸ºä»–ä»¬çš„ç›®æ ‡ã€‚è¡Œä¸ºæ•°æ®å¯ä»¥æˆä¸ºäº§å“å’Œç”¨æˆ·ç»†åˆ†çš„çœŸæ­£èµ„äº§ã€‚

![](img/fad4158f2246842e64febb03a1200b9d.png)

[OC]

ä½ å¯ä»¥åœ¨æˆ‘ä¹‹å‰å…³äºè¿™ä¸ªä¸»é¢˜çš„æ–‡ç« ä¸­è¯»åˆ°å…³äºä½¿ç”¨ä½ å½“å‰æ¨èå¼•æ“çš„æ•°æ®å’Œç®—æ³•è¿›è¡Œç»†åˆ†çš„å†…å®¹:

[](/data-science-powered-segmentation-models-ae89f9bd405f) [## äººå·¥æ™ºèƒ½ç¬¦åˆè¥é”€ç»†åˆ†æ¨¡å‹

### æ–°çš„é»„é‡‘æ ‡å‡†:ä½¿ç”¨æœºå™¨å­¦ä¹ ä»è¡Œä¸ºæ•°æ®ä¸­è·å¾—ç”¨æˆ·å’Œäº§å“åˆ†ç±»ï¼Œä¸ºä¸€ä¸ªâ€¦

towardsdatascience.com](/data-science-powered-segmentation-models-ae89f9bd405f) 

è¿™ä¸ªé€‰æ‹©çš„å¥½å¤„:ä½ è®©æ›´å¤šçš„åˆ©ç›Šç›¸å…³è€…å‚ä¸è¿›æ¥ï¼Œå¹¶ä¸”ç”¨ä½ çš„æ¨¡å¼åˆ›é€ æ›´å¤§çš„å•†ä¸šå½±å“ã€‚è¿™é™ä½äº†ä¼ä¸šæç½®é¡¹ç›®çš„å¯èƒ½æ€§ã€‚

**è¿™ä¸ªé€‰é¡¹çš„ç¼ºç‚¹**:ä½ æœ‰æ›´å¤šçš„æ¶‰ä¼—å‚ä¸åˆ°ä»–ä»¬ç‹¬ç‰¹çš„éœ€æ±‚å’Œä¸æ–­å¢é•¿çš„æ”¹è¿›å‹åŠ›ä¸­ã€‚æ•°æ®ç§‘å­¦å›¢é˜Ÿéœ€è¦èƒ½å¤Ÿéšç€éœ€æ±‚çš„å¢é•¿è€Œæ‰©å±•ã€‚

# å–ä»£ååŒè¿‡æ»¤ä½œä¸ºæ‚¨çš„ç®—æ³•

ååŒè¿‡æ»¤ä¸€ç›´æ˜¯ä¸€ä¸ªå¼ºå¤§çš„æ¨èç®—æ³•ï¼Œå› ä¸ºæˆ‘ä»¬ä¸éœ€è¦äº†è§£æˆ‘ä»¬çš„äº§å“æˆ–ç”¨æˆ·ã€‚ä¸€æ–¹é¢ï¼Œæˆ‘ä»¬ä»…åŸºäºæ˜¾å¼æˆ–éšå¼åé¦ˆæ¥å­¦ä¹ æ¨èã€‚ä½†å¦ä¸€æ–¹é¢ï¼Œæ¯ä¸ªæ¨èéƒ½ä¸ç‰¹å®šçš„äº§å“æˆ–ç”¨æˆ·ç›¸å…³è”ã€‚è¿™æœ‰ä¸€äº›ç¼ºç‚¹:

*   **å†·å¯åŠ¨**:ä»»ä½•æ–°äº§å“æˆ–æ–°ç”¨æˆ·éƒ½éœ€è¦åé¦ˆï¼Œæˆ‘ä»¬æ‰èƒ½å¼€å§‹æ¨èã€‚
*   æ‰€æœ‰é¡¹ç›®å®Œå…¨**ç‹¬ç«‹**ã€‚çº¢è‹¹æœå’Œç»¿è‹¹æœåœ¨ååŒè¿‡æ»¤ä¸­ä¸å…±äº«ä»»ä½•åé¦ˆæˆ–å…±ç°ä¿¡å·ï¼Œå³ä½¿å®ƒä»¬åœ¨äº§å“ç©ºé—´ä¸­æ¦‚å¿µä¸Šç›¸ä¼¼ã€‚
*   å½“äº§å“ä»ç›®å½•ä¸­åˆ é™¤æ—¶ï¼Œæˆ‘ä»¬ä¹Ÿ**å¤±å»äº†é’ˆå¯¹è¯¥äº§å“çš„æ‰€æœ‰ä¿¡å·**å’ŒæŒ‡æ ‡ã€‚

ä¸ºäº†å…‹æœè¿™äº›é—®é¢˜ï¼Œæˆ‘ä»¬å¿…é¡»å°†æˆ‘ä»¬çš„å»ºè®®çš„ä¿¡å·å’ŒæŒ‡æ ‡ä¸èƒ½å¤Ÿæ¯”äº§å“æˆ–ç”¨æˆ·æœ¬èº«å¯¿å‘½æ›´é•¿çš„åŠŸèƒ½è”ç³»èµ·æ¥ï¼Œå¹¶åœ¨æ›´å¹¿æ³›çš„ç±»ä¼¼äº§å“å’Œç”¨æˆ·ä¸­æ¨å¹¿ã€‚æˆ‘ä»¬éœ€è¦ç§¯ç´¯å…³äºæˆ‘ä»¬äº§å“å’Œç”¨æˆ·çš„åŠŸèƒ½å’ŒçŸ¥è¯†:

![](img/eb03894fd2dfa949a07d5ae50bf816b8.png)

[OC]

æ„å»ºæè¿°äº§å“çš„ç‰¹æ€§é€šå¸¸æ¯”æè¿°ç”¨æˆ·æ›´å®¹æ˜“:

*   ä½¿ç”¨è®¡ç®—æœºè§†è§‰å¯¹äº§å“å›¾åƒè¿›è¡ŒæŒ‡çº¹è¯†åˆ«
*   ä½¿ç”¨ NLP ä¸»é¢˜å»ºæ¨¡ã€å•è¯å’Œæ–‡æ¡£å‘é‡åµŒå…¥äº§å“æè¿°
*   åœ°ç†ä½ç½®äº§å“çš„åœ°ç†åŒºåŸŸåµŒå…¥(æ´»åŠ¨ã€é—¨ç¥¨ã€ç‰©ä¸šåˆ—è¡¨)
*   äº§å“å…ƒæ•°æ®ï¼Œå¦‚ä»·æ ¼ã€å°ºå¯¸ã€é‡é‡ã€ç±»åˆ«ã€å…³é”®è¯ã€å­£èŠ‚ã€æˆ¿äº§åˆ—è¡¨çš„å§å®¤æ•°é‡ç­‰ã€‚

æˆ‘ä¹‹å‰å‘è¡¨äº†ä¸€ç¯‡åšæ–‡ï¼Œè®²è¿°äº†ä½¿ç”¨æœç´¢åµŒå…¥åˆ›å»ºåœ°ç†åŒºåŸŸåµŒå…¥çš„ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­:

[](/location-location-location-ec2cc8a223b1) [## ä½ç½®ä½ç½®ä½ç½®

### Zoopla.co.uk å¤§å­¦ä½¿ç”¨æœºå™¨å­¦ä¹ (Skip-Gram)å’Œä¸€ç‚¹é»‘é­”æ³•è¿›è¡Œåœ°ç†åŒºåŸŸåµŒå…¥ã€‚

towardsdatascience.com](/location-location-location-ec2cc8a223b1) 

åœ¨æˆ‘ä»¬åˆ›å»ºäº†å¹¿æ³›çš„ç‰¹å¾æ¥æè¿°äº§å“å’Œæ½œåœ¨ç”¨æˆ·ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç¥ç»ç½‘ç»œæ¥å­¦ä¹ æˆ‘ä»¬åŸºäºååŒè¿‡æ»¤çš„æ¨èå’Œæˆ‘ä»¬çš„æ–°äº§å“ç‰¹å¾ä¹‹é—´çš„ä¿¡å·ã€‚

![](img/85e5f391d22190c04f5f8f7a9c3ed20e.png)

[OC]

æˆ‘ä»¬ä½¿ç”¨**è¿ä½“ç¥ç»ç½‘ç»œ**æ¥å­¦ä¹ äº§å“æˆ–ç”¨æˆ·ç‰¹å¾ä»**é¡¹ç›®åµŒå…¥ç©ºé—´**åˆ°**æ¨èåµŒå…¥ç©ºé—´**çš„æ˜ å°„ã€‚é¡¹ç›®æˆ–ç”¨æˆ·çš„æ¨èåµŒå…¥å…·æœ‰æ¯” NN è¾“å…¥ä½å¾—å¤šçš„ç»´åº¦ï¼Œå¹¶ä¸”å…·æœ‰é€šè¿‡æ¨èåµŒå…¥ç©ºé—´ä¸­çš„ä½™å¼¦ç›¸ä¼¼æ€§æ¥æµ‹é‡çš„ç›¸ä¼¼çš„æœŸæœ›è¡Œä¸ºã€‚è¿ä½“ç¥ç»ç½‘ç»œçš„ç‰¹ç‚¹æ˜¯ä¸¤ä¸ªç½‘ç»œçš„æƒé‡ç›¸åŒï¼Œå¹¶ä¸”ä¸¤ä¸ªç¥ç»ç½‘ç»œçš„æ¢¯åº¦ä¸‹é™è€¦åˆåœ¨ä¸€èµ·ã€‚åœ¨å®è·µä¸­ï¼Œè¿™æ˜¯é€šè¿‡ä½¿ç”¨å•ä¸ªç¥ç»ç½‘ç»œå¹¶ä¾æ¬¡å¯¹ä¸¤ä¸ªè¾“å…¥è¿›è¡Œè¯„åˆ†æ¥å®ç°çš„:

![](img/d2bd1ad8b9108b982a0c7f8014a67ef5.png)

[OC]

æˆ‘ä»¬ä½¿ç”¨ä½™å¼¦ç›¸ä¼¼æ€§ä½œä¸ºæˆ‘ä»¬çš„è¿ä½“ç¥ç»ç½‘ç»œæ¨¡å‹çš„è¾“å‡º:

```
[@staticmethod](http://twitter.com/staticmethod)
def pairwise_cosine_sim(y1, y2):
    """Calculates the pairwise cosine similarity.
    """
    y1_norm = tf.nn.l2_normalize(y1,1)        
    y2_norm = tf.nn.l2_normalize(y2,1)
    return tf.matmul(y1_norm, y2_norm, transpose_b=True)
```

é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬çš„ç¥ç»ç½‘ç»œå’Œå…¶ä»–ä»»ä½•ç¥ç»ç½‘ç»œéƒ½æ²¡æœ‰å¤ªå¤§åŒºåˆ«ã€‚ä¸ºäº†è®­ç»ƒæˆ‘ä»¬çš„æš¹ç½—ç¥ç»ç½‘ç»œï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ªæŸå¤±å‡½æ•°:**å¯¹æ¯”æŸå¤±**ä¼˜åŒ–ä¸€å¯¹è¾“å…¥ä¹‹é—´çš„ç»å¯¹ä½™å¼¦ç›¸ä¼¼æ€§ï¼Œä»¥æœ€å¤§åŒ–æ­£å¯¹çš„ä½™å¼¦ç›¸ä¼¼æ€§ï¼Œä½†æœ€å°åŒ–è´Ÿå¯¹çš„ç›¸ä¼¼æ€§ã€‚

```
def contrastive_loss(cos_similarity, label, margin=1.0):
    """Contrastive loss function
    """
    distance = 1.0 - cos_similarity
    similarity = label * distance                                           
    dissimilarity = (1 - label) * tf.square(tf.maximum((margin - distance), 0))
    return 0.5 * tf.reduce_mean(dissimilarity + similarity)
```

è£•åº¦(åœ¨ 0 å’Œ 2 ä¹‹é—´)å¯ä»¥ç”¨ä½œè®­ç»ƒåº”è¯¥åœ¨å¤šå¤§ç¨‹åº¦ä¸Šé›†ä¸­äºæ”¹å–„é…å¯¹çš„ç›¸ä¼¼æ€§è€Œä¸æ˜¯ç›¸å¼‚åº¦çš„æƒé‡ã€‚

![](img/7546e30af15ec8088980b710d21286b7.png)

[OC]

æˆ‘ä»¬è¿˜éœ€è¦ç”¨äºè®­ç»ƒçš„æ ‡è®°æ•°æ®ã€‚æˆ‘ä»¬å¯ä»¥ä»ç‰ˆæœ¬ 1 ä¸­ä½¿ç”¨çš„ Elasticsearch é›†ç¾¤ä¸­è·å–æ ‡ç­¾ã€‚å‰æ™¯ä¸­æ»¡è¶³æˆ‘ä»¬è´¨é‡è¦æ±‚çš„é¡¹ç›®æ˜¯æ­£å¯¹ï¼Œè€Œå…¶ä»–é¡¹ç›®å¯ä»¥å……å½“è´Ÿå¯¹ã€‚

è¿ä½“ç¥ç»ç½‘ç»œçš„è®­ç»ƒå¾ªç¯éå¸¸ç®€å•:

![](img/45e6c1f7e6ab96b191ad117e858b035e.png)

```
epochs = 10
optimizer = tf.keras.optimizers.Adam(learning_rate=1e-3)
for epoch in range(epochs):
    accuracy = tf.keras.metrics.BinaryAccuracy()
    epoch_loss = tf.keras.metrics.Mean()
    for item_pairs, labels in ds_train:
        with tf.GradientTape() as tape:
            item_similarities = model(np.array(item_pairs[0]), np.array(item_pairs[1]))
            loss = contrastive_loss(item_similarities, tf.reshape(labels, (1,-1)), margin=1.0)
            grad = tape.gradient(loss, model.trainable_variables)
        optimizer.apply_gradients(zip(grad, model.trainable_variables))
        epoch_loss.update_state(loss)
        accuracy.update_state(tf.reshape(labels, (1,-1)), item_similarities)

    print(
        "Epoch {:03d}: Loss: {:.3f} Accuraccy: {:.3f}".format(
            epoch,
            epoch_loss.result(),
            accuracy.result()
        )    
    )
```

æœ€ç»ˆå›¾æ˜¾ç¤ºäº†æ¥è‡ª Spark ç¤ºä¾‹ç”µå½±é•œå¤´æ•°æ®é›†çš„ç›¸ä¼¼ç”µå½±çš„è®­ç»ƒ 2D æ¨èåµŒå…¥ç©ºé—´:

![](img/172a509018828677b542c4d088640ca3.png)

[OC]

æ­¤é€‰é¡¹çš„ä¼˜ç‚¹:ä¸å†æœ‰å†·å¯åŠ¨é—®é¢˜ï¼

è¿™ä¸ªé€‰é¡¹çš„ç¼ºç‚¹:ä½ éœ€è¦å¹¿æ³›çš„æœ‰ç”¨çš„é¡¹ç›®åµŒå…¥ä½œä¸ºä½ çš„è¿ä½“ç¥ç»ç½‘ç»œçš„è¾“å…¥ã€‚å®šä¹‰è®­ç»ƒæ ‡ç­¾éœ€è¦å®éªŒ:å¯¹äºæ‚¨çš„ä¸šåŠ¡é—®é¢˜ï¼Œä»€ä¹ˆå®šä¹‰äº†ä¸€ä¸ªå¥½çš„æ­£é¢æˆ–è´Ÿé¢é¡¹ç›®å¯¹ï¼Ÿå¯¹æ¯”æŸå¤±å‡½æ•°æ˜“äºå®ç°ï¼Œä½†æ˜¯æ­£è´Ÿé¡¹ç›®å¯¹çš„ä¸å¹³è¡¡å¯èƒ½éœ€è¦åˆ‡æ¢åˆ°æ›´å¤æ‚çš„æŸå¤±å‡½æ•°ï¼Œä¾‹å¦‚[ä¸‰é‡æŸå¤±](https://gombru.github.io/2019/04/03/ranking_loss/)ã€‚

![](img/b40fa03f9762d1ec3c427365a4c45786.png)

Jan æ˜¯å…¬å¸æ•°æ®è½¬å‹æ–¹é¢çš„æˆåŠŸæ€æƒ³é¢†è¢–å’Œé¡¾é—®ï¼Œæ‹¥æœ‰å°†æ•°æ®ç§‘å­¦å¤§è§„æ¨¡åº”ç”¨äºå•†ä¸šç”Ÿäº§çš„è®°å½•ã€‚ä»–æœ€è¿‘è¢« dataIQ è¯„ä¸ºè‹±å›½ 100 ä½æœ€å…·å½±å“åŠ›çš„æ•°æ®å’Œåˆ†æä»ä¸šè€…ä¹‹ä¸€ã€‚

**åœ¨ LinkedIn ä¸Šè¿æ¥:**[**https://www.linkedin.com/in/janteichmann/**](https://www.linkedin.com/in/janteichmann/)

**é˜…è¯»å…¶ä»–æ–‡ç« :**[**ã€https://medium.com/@jan.teichmannã€‘**](https://medium.com/@jan.teichmann)