<html>
<head>
<title>Avoid Data Leakage — Split Your Data Before Processing</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">避免数据泄露—在处理之前拆分您的数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/avoid-data-leakage-split-your-data-before-processing-a7f172632b00?source=collection_archive---------23-----------------------#2019-10-22">https://towardsdatascience.com/avoid-data-leakage-split-your-data-before-processing-a7f172632b00?source=collection_archive---------23-----------------------#2019-10-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a936" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">生产中模型失败的一个潜在原因</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/33db45288aadc13c8e6606e605d09fca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I3jQRB9kofhpv3_KJJBbrA.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Kai Kai @ River Safari Singapore</figcaption></figure></div><div class="ab cl ky kz hx la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="im in io ip iq"><blockquote class="lf lg lh"><p id="8c3b" class="li lj lk ll b lm ln ju lo lp lq jx lr ls lt lu lv lw lx ly lz ma mb mc md me im bi translated"><strong class="ll iu">经验法则:</strong>在对数据进行任何处理之前，将数据集分成训练集和测试集。否则可能会有数据泄漏，使模型评估过于乐观。</p></blockquote></div><div class="ab cl ky kz hx la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="im in io ip iq"><p id="72c0" class="pw-post-body-paragraph li lj it ll b lm ln ju lo lp lq jx lr mf lt lu lv mg lx ly lz mh mb mc md me im bi translated">你们中的一些人可能有这样的经历:</p><ul class=""><li id="ffe0" class="mi mj it ll b lm ln lp lq mf mk mg ml mh mm me mn mo mp mq bi translated">您的模型在您的本地测试集上得分很高，但在 Kaggle 排行榜上表现不佳</li><li id="596a" class="mi mj it ll b lm mr lp ms mf mt mg mu mh mv me mn mo mp mq bi translated">您的模型在概念验证期间正常工作，但在生产环境中会急剧下降</li></ul><p id="db96" class="pw-post-body-paragraph li lj it ll b lm ln ju lo lp lq jx lr mf lt lu lv mg lx ly lz mh mb mc md me im bi translated">这些可能是由于<strong class="ll iu">数据泄露</strong>造成的。</p></div><div class="ab cl ky kz hx la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="im in io ip iq"><h2 id="0325" class="mw mx it bd my mz na dn nb nc nd dp ne mf nf ng nh mg ni nj nk mh nl nm nn no bi translated">什么是数据泄露？</h2><p id="e85f" class="pw-post-body-paragraph li lj it ll b lm np ju lo lp nq jx lr mf nr lu lv mg ns ly lz mh nt mc md me im bi translated">数据泄漏是指训练数据集和测试数据集之间意外共享信息。这种信息共享会给模型一个关于测试数据集的“提示”,并生成看似最佳的评估分数。然而，由于模型过度拟合测试数据，它无法准确预测未来的未知数据集，即 Kaggle 测试数据或生产实况数据。</p><p id="4dce" class="pw-post-body-paragraph li lj it ll b lm ln ju lo lp lq jx lr mf lt lu lv mg lx ly lz mh mb mc md me im bi translated">数据泄露的一个常见原因是由于<strong class="ll iu">列车数据处理后的测试分割。</strong></p></div><div class="ab cl ky kz hx la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="im in io ip iq"><h2 id="8df2" class="mw mx it bd my mz na dn nb nc nd dp ne mf nf ng nh mg ni nj nk mh nl nm nn no bi translated">示例:处理后由于分割导致的数据泄漏</h2><p id="1eed" class="pw-post-body-paragraph li lj it ll b lm np ju lo lp nq jx lr mf nr lu lv mg ns ly lz mh nt mc md me im bi translated">假设我们有以下数据集，并希望使用列 1 和列 2 来预测目标。</p><p id="c689" class="pw-post-body-paragraph li lj it ll b lm ln ju lo lp lq jx lr mf lt lu lv mg lx ly lz mh mb mc md me im bi translated">按顺序执行以下步骤:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/eae5b1e9020e9c09f3ae9d0b152f51d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:732/format:webp/1*iKtMFuaun48zJ0z2A10XoQ.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Example: raw dataset for classification</figcaption></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/076afb4f838e782a117d8ad530781833.png" data-original-src="https://miro.medium.com/v2/resize:fit:736/format:webp/1*vuJXz6O0sFAjj2PKINj22A.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Example: train test split after processing</figcaption></figure><ol class=""><li id="e39f" class="mi mj it ll b lm ln lp lq mf mk mg ml mh mm me nw mo mp mq bi translated">将第 1 列中的 Y 和 N 替换为其各自的目标平均值。</li><li id="92b0" class="mi mj it ll b lm mr lp ms mf mt mg mu mh mv me nw mo mp mq bi translated">标签根据词汇顺序对列 2 进行编码。</li><li id="8c2f" class="mi mj it ll b lm mr lp ms mf mt mg mu mh mv me nw mo mp mq bi translated">分割数据集。前 7 行用于训练，后 3 行用于测试。</li><li id="26c9" class="mi mj it ll b lm mr lp ms mf mt mg mu mh mv me nw mo mp mq bi translated">使用训练数据训练模型，并根据测试数据进行验证。</li></ol><p id="61fb" class="pw-post-body-paragraph li lj it ll b lm ln ju lo lp lq jx lr mf lt lu lv mg lx ly lz mh mb mc md me im bi translated"><strong class="ll iu">发生数据泄露！</strong></p><p id="9a26" class="pw-post-body-paragraph li lj it ll b lm ln ju lo lp lq jx lr mf lt lu lv mg lx ly lz mh mb mc md me im bi translated">对于步骤 1，Y 的值是用 4 / 6 计算的，这表明数据集中有 6 个 Y，其中 4 个有正目标。由于数据在处理后被拆分，这些信息会在训练数据集和测试数据集之间意外共享。在第 4 步中，模型从 4 个 y 开始训练，并以某种方式“期望”测试数据中的两个 y，其中一个具有正目标。这会导致对模型性能的预期过于乐观。</p><p id="21ec" class="pw-post-body-paragraph li lj it ll b lm ln ju lo lp lq jx lr mf lt lu lv mg lx ly lz mh mb mc md me im bi translated">类似地，对于步骤 2，第 5 行的字母<em class="lk">‘e’</em>被编码为 5，因为它知道完整的数据集具有’<em class="lk">‘a’</em>，‘<em class="lk">b’</em>，<em class="lk">‘c’</em>和<em class="lk">‘d’。</em>这些信息也在训练和测试数据之间泄露。</p></div><div class="ab cl ky kz hx la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="im in io ip iq"><h2 id="5640" class="mw mx it bd my mz na dn nb nc nd dp ne mf nf ng nh mg ni nj nk mh nl nm nn no bi translated">简单的解决方案:在处理前拆分</h2><p id="d8c2" class="pw-post-body-paragraph li lj it ll b lm np ju lo lp nq jx lr mf nr lu lv mg ns ly lz mh nt mc md me im bi translated">上面提到的问题有非常大的负面影响，但是解决方案很简单——在处理之前分割。让我们用相同的例子，但不同的步骤:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/fdfef8fd978b0dbe7e133721a77d46fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:732/format:webp/1*vqIjuAZ4t1cPVx7vt17QoA.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Example: train test split before processing</figcaption></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/4cacce83211793aba51220baf8bc2e47.png" data-original-src="https://miro.medium.com/v2/resize:fit:736/format:webp/1*CS8sK-LdEJUIbO-xN345_g.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Example: transform train and test data with same encoders</figcaption></figure><ol class=""><li id="bd9e" class="mi mj it ll b lm ln lp lq mf mk mg ml mh mm me nw mo mp mq bi translated">分割数据集。前 7 行用于训练，后 3 行用于测试。</li><li id="fac6" class="mi mj it ll b lm mr lp ms mf mt mg mu mh mv me nw mo mp mq bi translated">对于训练数据:将第 1 列中的 Y 和 N 替换为它们各自的目标平均值。标签根据词汇顺序对列 2 进行编码。保存这些编码器。</li><li id="2b94" class="mi mj it ll b lm mr lp ms mf mt mg mu mh mv me nw mo mp mq bi translated">对于测试数据:用相同的编码器转换数据。</li><li id="b2b3" class="mi mj it ll b lm mr lp ms mf mt mg mu mh mv me nw mo mp mq bi translated">使用训练数据训练模型，并根据测试数据进行验证。</li></ol><p id="e90d" class="pw-post-body-paragraph li lj it ll b lm ln ju lo lp lq jx lr mf lt lu lv mg lx ly lz mh mb mc md me im bi translated">请注意，Y 被替换为 0.75，因为训练数据中有 4 个 Y，其中 3 个有正目标。字母<em class="lk">‘e’</em>编码为 4，因为训练数据中没有<em class="lk">‘c’</em>。测试数据被认为是前所未见的，并遵循类似的模式。因此，它们用来自训练数据的相同编码器进行变换。</p><p id="b0c4" class="pw-post-body-paragraph li lj it ll b lm ln ju lo lp lq jx lr mf lt lu lv mg lx ly lz mh mb mc md me im bi translated">首先拆分数据有两个主要好处:</p><ol class=""><li id="728d" class="mi mj it ll b lm ln lp lq mf mk mg ml mh mm me nw mo mp mq bi translated">降低数据泄露的风险。</li><li id="965b" class="mi mj it ll b lm mr lp ms mf mt mg mu mh mv me nw mo mp mq bi translated">未来看不见的数据将以与测试数据完全相同的方式处理，从而确保模型性能的一致性。</li></ol><p id="3dcc" class="pw-post-body-paragraph li lj it ll b lm ln ju lo lp lq jx lr mf lt lu lv mg lx ly lz mh mb mc md me im bi translated">感谢阅读！</p></div></div>    
</body>
</html>