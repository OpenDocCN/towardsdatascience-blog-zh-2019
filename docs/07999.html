<html>
<head>
<title>Recommendation System PART 1 — Use of Collaborative Filtering and Hybrid Collaborative — Content in Retail using LightFM library on Instacart Dataset</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">推荐系统第 1 部分——使用协同过滤和混合协同——在 Instacart 数据集上使用 LightFM 库的零售内容</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/recommendation-system-part-1-use-of-collaborative-filtering-and-hybrid-collaborative-content-in-6137ba64ad58?source=collection_archive---------9-----------------------#2019-11-04">https://towardsdatascience.com/recommendation-system-part-1-use-of-collaborative-filtering-and-hybrid-collaborative-content-in-6137ba64ad58?source=collection_archive---------9-----------------------#2019-11-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><h1 id="afe9" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">介绍</h1><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/045e0158aa2bc00e4a01be74f7b3b935.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*odUh97pfcs2PHOW8AeFujA.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk">Recommender systems shown in Amazon</figcaption></figure><p id="9ff6" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">声明:我在正文和代码中交替提到了<strong class="lg iu">项目</strong>和<strong class="lg iu">产品</strong>。他们俩是一样的。</p><p id="3603" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">当你打开亚马逊等一些在线市场时，你会发现一些推荐，如经常一起购买，买了这个的客户也买了这个，类似的商品，等等。你会在网站上更容易找到你想要的东西。目前，推荐系统广泛用于在线市场，一些零售商正在使用这项技术来改善用户体验、用户保留率和转化率。</p><p id="5867" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">在本教程中，我将向您展示如何使用 Instacart 数据集创建一个模拟真实业务问题的产品推荐，适用于“交互”数据丰富的热启动问题。数据集可以在 Kaggle 上找到。我们还希望提供纯协作过滤方法与混合协作-基于内容的方法之间的比较，以解决我们的热启动问题。</p><p id="9b73" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">在讨论细节之前，我们需要使用 pip 安装 LightFM 库</p><p id="19d1" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated"><code class="fe mc md me mf b">pip install lightfm</code></p><p id="ff51" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">安装完成后，您可以导入所有必要的东西，包括交叉验证术语和指标</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mg mh l"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk">importing libraries including standard pandas, numpy, and the lightfm’s model and cross-validation stacks</figcaption></figure><h1 id="0e33" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">如何为 LightFM 库准备数据</h1><p id="d548" class="pw-post-body-paragraph le lf it lg b lh mi lj lk ll mj ln lo lp mk lr ls lt ml lv lw lx mm lz ma mb im bi translated">在使用 LightFM 库时，我们需要一个稀疏矩阵，称为用户-项目交互矩阵。对于混合协作内容推荐的情况，我们还可以考虑项目-特征矩阵:</p><ol class=""><li id="5118" class="mn mo it lg b lh li ll lm lp mp lt mq lx mr mb ms mt mu mv bi translated"><strong class="lg iu">用户-物品互动矩阵</strong>定义了用户(客户)与物品(产品)之间的互动，这可以显示为客户投票的电影评级。然而，在零售案例中，我们无法从历史数据中获得明确的评级。在这种情况下，我隐含地将<strong class="lg iu">“购买数量”作为评级</strong>考虑在内。如果顾客 A 购买了产品 B 10 次，那么我们可以说顾客 A 给产品 B 的评分是 10。您还可以考虑二进制评分，其中 1 表示客户 A 购买过产品 b，0 表示从未购买过产品 b。用户-项目交互矩阵表示<strong class="lg iu">协同过滤对模型</strong>的贡献。</li><li id="2b0f" class="mn mo it lg b lh mw ll mx lp my lt mz lx na mb ms mt mu mv bi translated"><strong class="lg iu">物品-特征交互矩阵</strong>定义物品的特征。项目到功能可以表示为产品到它的元数据，例如产品的类别、子类别，甚至任何信息。使用 Instacart 的数据集，我会使用“过道”和“部门”作为产品的特征。如果产品 A 位于通道 B，那么我们可以说通道 B 中产品 A 的矩阵元素为 1，否则为 0。这个矩阵可以向模型添加基于内容的贡献。</li></ol><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nb"><img src="../Images/b44a923052810ce9d0fafc043d96e14b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SHki7Z_fNhEzjGuAwIuLmQ.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk"><strong class="bd nc">User-item interaction matrix</strong>. User Id represents the customers and product rated represents how many times a specific user id bought the products. The matrix is sparse.</figcaption></figure><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/bb671265c614fbb4c046291206e754b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1206/format:webp/1*2Nw_QDXt6hwib0VefuRJXQ.png"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk">item-feature matrix. Item id represents the products and features refer to the metadata embedded to an item such as category, sub-category, and so on.</figcaption></figure><h1 id="1384" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">使用 Instacart 零售数据集构建矩阵</h1><p id="c700" class="pw-post-body-paragraph le lf it lg b lh mi lj lk ll mj ln lo lp mk lr ls lt ml lv lw lx mm lz ma mb im bi translated">我们将从 Instacart 市场购物篮分析 Kaggle 竞争(<a class="ae ne" href="https://www.kaggle.com/c/instacart-market-basket-analysis/data" rel="noopener ugc nofollow" target="_blank">https://www . ka ggle . com/c/insta cart-Market-Basket-Analysis/data</a>)中创建两个矩阵，并形成适用于 LightFM 库的数据集。在此之前，我们需要从 Kaggle 下载所需的数据集，并为我们的推荐系统读取必要的数据集</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="26c6" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">数据集的显示如下所示:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mg mh l"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk">datasets preview</figcaption></figure><p id="de22" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">我们还需要删除<code class="fe mc md me mf b">aisles</code>和<code class="fe mc md me mf b">departments</code>中带有<code class="fe mc md me mf b">aisle == missing</code>或<code class="fe mc md me mf b">aisle == other</code>和<code class="fe mc md me mf b">department == missing</code>或<code class="fe mc md me mf b">department == other</code>的行:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mg mh l"/></div></figure><ol class=""><li id="b683" class="mn mo it lg b lh li ll lm lp mp lt mq lx mr mb ms mt mu mv bi translated">构造一个<strong class="lg iu">用户-项目交互</strong> <strong class="lg iu">矩阵</strong>。我们需要考虑到，LightFM 库只能读取一个稀疏的 coo 矩阵，可以使用<code class="fe mc md me mf b">scipy.sparse</code>中的<code class="fe mc md me mf b">coo_matrix</code>来构造，其中我们需要将<code class="fe mc md me mf b">item_id</code>转换成<code class="fe mc md me mf b">integer index</code>。因此，我构建了<strong class="lg iu">用户-项目交互矩阵</strong>，将<code class="fe mc md me mf b">user_id</code>转换为表示矩阵的行的索引<strong class="lg iu">，将<strong class="lg iu">转换为列</strong>的索引。另外，不要忘记为 user_id 到 index、index 到 user_id、item_id 到 index 和 index 到 item_id 创建字典映射。</strong></li><li id="9038" class="mn mo it lg b lh mw ll mx lp my lt mz lx na mb ms mt mu mv bi translated">构建一个<strong class="lg iu">项目-特征矩阵</strong>。用户-项目交互矩阵也是同样的情况，通过将<strong class="lg iu">项目/产品</strong>和<strong class="lg iu">功能</strong>映射到<strong class="lg iu">索引中，</strong>我们可以尝试将<strong class="lg iu">项目/产品</strong> <strong class="lg iu">和功能交互</strong>转换成稀疏矩阵。</li></ol><p id="6d5c" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">下面显示了矩阵生成器和一些用于索引等的辅助函数</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="a6fa" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">将所有<code class="fe mc md me mf b">users</code>、<code class="fe mc md me mf b">items</code>和<code class="fe mc md me mf b">features</code>分配到列表中</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="2c3a" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">显示在<code class="fe mc md me mf b">users</code>、<code class="fe mc md me mf b">items</code>和<code class="fe mc md me mf b">features</code>列表的下方</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nf"><img src="../Images/f066cc1f64ce694606a0c78bf7659243.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Km94tjTrM-lU-KoDhcc62w.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk">displaying users, items (products), and features (departments and aisles)</figcaption></figure><p id="d16a" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">LightFM 库不能读取未索引的对象，因此我们需要为<code class="fe mc md me mf b">users</code>、<code class="fe mc md me mf b">items</code>和<code class="fe mc md me mf b">features</code>创建映射到它们相应的索引中。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="8fde" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">在生成交互矩阵之前，我将 t <strong class="lg iu"> rain、test 和 product_features 数据</strong>准备成它们相应的名称</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/8ed7e4728903353f92c33fd7e1192ff4.png" data-original-src="https://miro.medium.com/v2/resize:fit:924/format:webp/1*DScLYzUagHrj7Bgee8-p-w.png"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk">Showing the table of users with their corresponding purchased products/items. I also regard <strong class="bd nc">count </strong>as the ratings of the products/items or features</figcaption></figure><p id="e976" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">将每个表转换成交互矩阵</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="eccc" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">导致</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nh"><img src="../Images/fe102beda4860ff3e45eee51c3e8c91d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dJnijD1n807uwc6u5NDRHQ.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk">Sparse matrices representing interactions of users to products/items and products to features. The non-zero elements consist of <strong class="bd nc">product count</strong> as the number of products a user has bought</figcaption></figure><h1 id="0503" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">模型选择和交叉验证</h1><p id="4753" class="pw-post-body-paragraph le lf it lg b lh mi lj lk ll mj ln lo lp mk lr ls lt ml lv lw lx mm lz ma mb im bi translated">在这个问题中，我将通过测量<strong class="lg iu">测试数据集</strong>的 AUC(范围从 0 到 1)来尝试使用 LightFM 库进行交叉验证。我使用了“WARP”损失函数，它通常在 LightFM 库中提供最佳性能选项。通过使用 Instacart 数据集，我将<code class="fe mc md me mf b">prior</code>数据集作为<code class="fe mc md me mf b">training dataset</code>，将<code class="fe mc md me mf b">train</code>数据集作为<code class="fe mc md me mf b">testing dataset.</code>，通过拟合<code class="fe mc md me mf b">training dataset</code>并在<code class="fe mc md me mf b">test dataset</code>上测试，我们可以尝试评估测试数据集的 AUC 分数。</p><p id="8a49" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">下面我们尝试使用 LightFM 库对<strong class="lg iu">纯协同过滤方法</strong>进行交叉验证</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="c765" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">上面的输出是</p><pre class="kp kq kr ks gt ni mf nj nk aw nl bi"><span id="f112" class="nm jr it mf b gy nn no l np nq">time taken = 118.23 seconds<br/>time taken = 1088.21 seconds<br/>average AUC without adding item-feature interaction = 0.95</span></pre><p id="7252" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">从上面的结果中，我们知道，使用我的 8 GB RAM 笔记本电脑，培训大约需要 1 分钟，验证需要 10 分钟。翘曲损失功能可以很慢，但性能非常好。AUC = 0.95 很神奇的告诉我们，Instacart 数据集是一个热启动问题，交易数据丰富。</p><p id="ac09" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated"><strong class="lg iu">混合协作——基于内容的</strong>,通过添加<strong class="lg iu">产品/项目和功能交互</strong>,代码如下</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="c8df" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">上面的输出是</p><pre class="kp kq kr ks gt ni mf nj nk aw nl bi"><span id="5102" class="nm jr it mf b gy nn no l np nq">time taken = 154.22 seconds<br/>time taken = 1709.78 seconds<br/>average AUC with adding item-feature interaction = 0.80</span></pre><p id="1935" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">从混合情况下记录的 AUC 来看，AUC 比纯协作情况下的 AUC 差。这是一个具有丰富交易数据的热启动问题，纯协作过滤将提供更好的推荐。</p><h1 id="f8be" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">请求产品/项目推荐</h1><p id="177e" class="pw-post-body-paragraph le lf it lg b lh mi lj lk ll mj ln lo lp mk lr ls lt ml lv lw lx mm lz ma mb im bi translated">我们需要通过下面的函数将训练和测试数据集合并成一个</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="a4f1" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">并创建用户到产品的交互矩阵</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="f605" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">导致</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nr"><img src="../Images/bba0c575b90d18a45f2d2a6f0711a1ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wLWMqueB2oBOaR2ip94GdQ.png"/></div></div></figure><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="d18b" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">回来了</p><pre class="kp kq kr ks gt ni mf nj nk aw nl bi"><span id="d36a" class="nm jr it mf b gy nn no l np nq">time taken = 68.50 seconds</span></pre><p id="bce4" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">并且询问推荐的类对象由下式给出</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="3af3" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">使用最终模型调用建议</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="mg mh l"/></div></figure><p id="7293" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">为用户 2 和用户 10 打印了一些建议</p><pre class="kp kq kr ks gt ni mf nj nk aw nl bi"><span id="8005" class="nm jr it mf b gy nn no l np nq">User 2<br/>     Known positives:<br/>                  Organic Turkey Burgers<br/>                  Wild Albacore Tuna No Salt Added<br/>                  Cherry Pomegranate Greek Yogurt<br/>     Recommended:<br/>                  Organic Garlic<br/>                  Organic Baby Spinach<br/>                  Organic Hass Avocado</span><span id="b3a8" class="nm jr it mf b gy ns no l np nq">User 10<br/>     Known positives:<br/>                  Cantaloupe<br/>                  Parsley, Italian (Flat), New England Grown<br/>                  Seedless Red Grapes<br/>     Recommended:<br/>                  Organic Baby Spinach<br/>                  Organic Strawberries<br/>                  Bag of Organic Bananas</span></pre><h1 id="5378" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">结论</h1><p id="fe7a" class="pw-post-body-paragraph le lf it lg b lh mi lj lk ll mj ln lo lp mk lr ls lt ml lv lw lx mm lz ma mb im bi translated">LightFM library 可以为交易数据提供混合协作和基于内容的推荐系统。然而，对于热启动问题，纯协同过滤提供了更好的性能。</p><h1 id="373a" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated"><strong class="ak">Github 上完整的 Jupyter 笔记本</strong></h1><p id="d1e2" class="pw-post-body-paragraph le lf it lg b lh mi lj lk ll mj ln lo lp mk lr ls lt ml lv lw lx mm lz ma mb im bi translated"><a class="ae ne" href="https://github.com/danirisdiandita/lightfm_recommendation/blob/master/recommendation_system_part_01.ipynb" rel="noopener ugc nofollow" target="_blank">https://github . com/danirisdiandita/light FM _ re commendation/blob/master/re commendation _ system _ part _ 01 . ipynb</a></p><h1 id="e13f" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">文献学</h1><p id="8859" class="pw-post-body-paragraph le lf it lg b lh mi lj lk ll mj ln lo lp mk lr ls lt ml lv lw lx mm lz ma mb im bi translated">[1] LightFM 文档—<a class="ae ne" href="https://lyst.github.io/lightfm/docs/home.html" rel="noopener ugc nofollow" target="_blank">https://lyst.github.io/lightfm/docs/home.html</a></p><p id="ed7d" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">[2] Instacart Kaggle 比赛—【https://www.kaggle.com/c/instacart-market-basket-analysis T2】</p><p id="5495" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">[2]推荐系统—学习数据科学的 Python # 3【https://www.youtube.com/watch?v=9gBC9R-msAk T4】</p></div></div>    
</body>
</html>