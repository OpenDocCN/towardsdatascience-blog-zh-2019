<html>
<head>
<title>Docker for Python Development?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python 开发的 Docker？</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/docker-for-python-development-83ae714468ac?source=collection_archive---------5-----------------------#2019-02-17">https://towardsdatascience.com/docker-for-python-development-83ae714468ac?source=collection_archive---------5-----------------------#2019-02-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="d130" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae kl" rel="noopener" target="_blank" href="/why-you-should-care-about-docker-9622725a5cb8"> <em class="km">第 1 部分</em> </a> <em class="km">涵盖了什么是 docker。</em></p><p id="129b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在本文中，我们将讨论如何开始使用 Docker 进行 python 开发。</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div class="gh gi kn"><img src="../Images/584293074de41a2b5f650fe6cb8d8e7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1102/format:webp/0*b_b7YNPHXalG21LW.jpeg"/></div></figure><p id="4486" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一个标准的 python 安装包括设置环境变量，如果你在处理不同版本的 python，无论是 Windows 还是 Linux，都有大量的环境变量需要处理。</p><p id="5105" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您正在处理对 python 版本非常挑剔的产品，您需要确保您的程序在该版本上经过测试，并且没有您可能在本地系统上认为理所当然的额外和缺失的依赖项。</p><p id="e3c0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">同时处理 Python 2 和 3 仍然是可管理的，但是想想如果你必须处理已经安装的 python 3.6 并且需要试用 python 3.7。</p><h1 id="9e25" class="kv kw iq bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">码头工人来救援了！</h1><p id="d630" class="pw-post-body-paragraph jn jo iq jp b jq lt js jt ju lu jw jx jy lv ka kb kc lw ke kf kg lx ki kj kk ij bi translated">改变 python 版本就像<code class="fe ly lz ma mb b">FROM python:3.6.7</code>到<code class="fe ly lz ma mb b">FROM python:3.7</code>一样简单。</p><p id="74c7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Docker 不仅允许进行快速实验，而且有助于限制保持稳定性所需的特定包版本。</p><p id="73d4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">可以把它想象成 Anaconda 中的一个虚拟环境。</p><p id="ba71" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">但是，当您配置了 Anaconda 之后，大多数包已经预安装在系统上，当您尝试部署它时，您可能会认为它们是理所当然的。</p><p id="e123" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">此外，python 3.7 版的 Anaconda 占用了超过 3GB 的磁盘空间。</p><p id="bdec" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">另一方面，docker 图像几乎不占用千兆字节。</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="gh gi mc"><img src="../Images/5ee89073a281ecd9349a0f74534626a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6VZPnqwjMBjN_Q5Nzc4Q6w.png"/></div></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk">Sizes of Python Full and Alpine Images</figcaption></figure><h1 id="3837" class="kv kw iq bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">准备文档</h1><p id="5974" class="pw-post-body-paragraph jn jo iq jp b jq lt js jt ju lu jw jx jy lv ka kb kc lw ke kf kg lx ki kj kk ij bi translated">决定你需要的 python 版本，如果你只是在寻找最新版本，就写<code class="fe ly lz ma mb b">python:latest</code>。</p><p id="32f2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">图像的方式通常被命名为<code class="fe ly lz ma mb b">image_name:tag</code>，当您使用<code class="fe ly lz ma mb b">docker build -t image_name:tag .</code>构建图像时需要提供这个名称。如果您在构建过程中没有提供任何标签，docker 会自动分配给它<code class="fe ly lz ma mb b">latest</code>。</p><p id="02d3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在 docker hub 上，<a class="ae kl" href="https://hub.docker.com/_/python/" rel="noopener ugc nofollow" target="_blank"> Python </a>提供了不同的图片供选择，从 Alpine 版本(这是一个非常小的图片)到完整版本。</p><pre class="ko kp kq kr gt ml mb mm mn aw mo bi"><span id="fbfb" class="mp kw iq mb b gy mq mr l ms mt"># Python 3.6.7</span><span id="8260" class="mp kw iq mb b gy mu mr l ms mt">FROM python:3.6.7-alpine3.6</span><span id="dc5c" class="mp kw iq mb b gy mu mr l ms mt"># author of file<br/>LABEL maintainer=”Chinmay Shah &lt;<a class="ae kl" href="mailto:chinmayshah3899@gmail.com" rel="noopener ugc nofollow" target="_blank">chinmayshah3899@gmail.com</a>&gt;”</span></pre><p id="2c67" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe ly lz ma mb b">RUN</code> —该指令将在当前图像之上的新层中执行任何命令，并提交结果。生成的提交图像将用于<code class="fe ly lz ma mb b">Dockerfile</code>中的下一步，通常以外壳形式，除非指定<a class="ae kl" href="https://docs.docker.com/engine/reference/builder/#run" rel="noopener ugc nofollow" target="_blank">或</a>。</p><pre class="ko kp kq kr gt ml mb mm mn aw mo bi"><span id="c565" class="mp kw iq mb b gy mq mr l ms mt"># Packages that we need <br/>COPY requirement.txt /app/<br/>WORKDIR /app</span><span id="3816" class="mp kw iq mb b gy mu mr l ms mt"># instruction to be run during image build<br/>RUN pip install -r requirement.txt</span><span id="dd46" class="mp kw iq mb b gy mu mr l ms mt"># Copy all the files from current source duirectory(from your system) to</span><span id="7cf2" class="mp kw iq mb b gy mu mr l ms mt"># Docker container in /app directory <br/>COPY . /app</span></pre><p id="2735" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可能会注意到，在中我们复制了<code class="fe ly lz ma mb b">requirement.txt</code>两次。这是为了构建优化。</p><p id="dcb0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Dockerfile 中的每一行都作为一个单独的步骤执行，并创建一个新的容器。</p><p id="68f4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是非常低效的，因为您并不总是希望在每个构建命令期间从头开始重新构建一切。</p><p id="d2dc" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了解决这个问题，Docker 使用了一种被称为<strong class="jp ir">层缓存</strong>的东西，这是一种奇特的说法，它不是每次都重新创建一个容器，而是重用在以前的构建中创建的容器并存储它。因此，除非您在前面的步骤中进行了更改，否则构建过程可以重用旧的容器。</p><p id="c4eb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个想法是，需求几乎不会改变，但是代码经常会改变，因此使用缓存是一个更好的方法，而不是每次构建映像时都下载需求包。</p><figure class="ko kp kq kr gt ks gh gi paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="gh gi mv"><img src="../Images/da6449e996cd9284d1160f26b70d28b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AweqZ5uM0Uck47Iijb59XQ.png"/></div></div><figcaption class="mh mi gj gh gi mj mk bd b be z dk">The build process</figcaption></figure><p id="d945" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">请注意，dockerfile 中的每一行都是一个单独的步骤，而且每个步骤都有一个唯一的字母数字名称。</p><p id="ee0d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe ly lz ma mb b">ENTRYPOINT</code> —指定容器启动时将始终执行的命令。</p><p id="4f18" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe ly lz ma mb b">CMD</code> —指定将提供给<code class="fe ly lz ma mb b">ENTRYPOINT</code>的参数。当您想将容器作为可执行文件运行时，可以使用它。</p><blockquote class="mw mx my"><p id="c456" class="jn jo km jp b jq jr js jt ju jv jw jx mz jz ka kb na kd ke kf nb kh ki kj kk ij bi translated">如果没有 entrypoint，默认参数是执行的命令。</p><p id="9843" class="jn jo km jp b jq jr js jt ju jv jw jx mz jz ka kb na kd ke kf nb kh ki kj kk ij bi translated">对于 entrypoint，<code class="fe ly lz ma mb b">CMD</code>作为参数传递给 entrypoint。</p></blockquote><p id="d614" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">更多关于它的<a class="ae kl" href="https://aboullaite.me/dockerfile-run-vs-cmd-vs-entrypoint/" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><pre class="ko kp kq kr gt ml mb mm mn aw mo bi"><span id="e839" class="mp kw iq mb b gy mq mr l ms mt"># Specifies a command that will always be executed when the  <br/># container starts.<br/># In this case we want to start the python interpreter</span><span id="3c8f" class="mp kw iq mb b gy mu mr l ms mt">ENTRYPOINT [“python”]</span><span id="3e5b" class="mp kw iq mb b gy mu mr l ms mt"># We want to start app.py file. (change it with your file name) </span><span id="9f33" class="mp kw iq mb b gy mu mr l ms mt"># Argument to python command<br/>CMD [“app.py”]</span></pre><h1 id="bdc1" class="kv kw iq bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">运行 python 文件</h1><p id="2e40" class="pw-post-body-paragraph jn jo iq jp b jq lt js jt ju lu jw jx jy lv ka kb kc lw ke kf kg lx ki kj kk ij bi translated">构建文件:</p><pre class="ko kp kq kr gt ml mb mm mn aw mo bi"><span id="adf4" class="mp kw iq mb b gy mq mr l ms mt">docker build -t python:test .</span></pre><p id="2b02" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用 cmd 或 bash 启动容器:</p><pre class="ko kp kq kr gt ml mb mm mn aw mo bi"><span id="2ca5" class="mp kw iq mb b gy mq mr l ms mt">docker run — rm -it -v /c/Users/chinm/Desktop/python_run:/teste pythontest:alpine</span></pre><p id="d770" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe ly lz ma mb b">-v</code>或<code class="fe ly lz ma mb b">--volume</code>用于附加一个卷。</p><blockquote class="mw mx my"><p id="ab95" class="jn jo km jp b jq jr js jt ju jv jw jx mz jz ka kb na kd ke kf nb kh ki kj kk ij bi translated">什么是体积？</p><p id="ef5b" class="jn jo km jp b jq jr js jt ju jv jw jx mz jz ka kb na kd ke kf nb kh ki kj kk ij bi translated">卷是保存 Docker 容器生成和使用的数据的首选机制。它们完全由 Docker 管理。</p></blockquote><p id="c9b4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要将目录连接到 Docker 容器:</p><p id="8850" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><code class="fe ly lz ma mb b">-v source_on_local_machine:destination_on_docker_container</code></p><p id="1af0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您想要创建一个卷，以便可以跨不同的 docker 容器访问它，那么创建一个 docker 卷将是一个不错的选择。更多关于它的<a class="ae kl" href="https://docs.docker.com/storage/volumes/" rel="noopener ugc nofollow" target="_blank">在这里</a>。</p><p id="2632" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您试图将 Python 用于数据科学，您可能会使用 volume，这样您就可以与容器共享原始数据，对其进行一些操作，并将清理后的数据写回主机。</p><p id="5b8c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">注意:如果你使用 docker Toolbox 来使用 Docker，那么<code class="fe ly lz ma mb b">-v</code>会将你的容器映射到 VM，VM 映射了你本地机器的 C 目录，因此很难将你的其他逻辑驱动器作为 Docker 上的卷来使用。</p><h1 id="0256" class="kv kw iq bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">结论</h1><p id="aa8c" class="pw-post-body-paragraph jn jo iq jp b jq lt js jt ju lu jw jx jy lv ka kb kc lw ke kf kg lx ki kj kk ij bi translated">我希望您已经具备了在 docker 上开始使用 Python 的基础知识。黑客快乐！</p></div><div class="ab cl nc nd hu ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="ij ik il im in"><p id="dd29" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可以随时联系 Twitter、T2、Linkedin 或 T4 的电子邮件。</p></div></div>    
</body>
</html>