<html>
<head>
<title>How to load Matlab .mat files in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何加载 Matlab？Python 中的 mat 文件</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-load-matlab-mat-files-in-python-1f200e1287b5?source=collection_archive---------1-----------------------#2019-05-29">https://towardsdatascience.com/how-to-load-matlab-mat-files-in-python-1f200e1287b5?source=collection_archive---------1-----------------------#2019-05-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/5f6e8b8a2c86b8424e7682ab8f19b089.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6L2qQvKPbxrzVYEb9T_hnA.jpeg"/></div></div></figure><p id="f58c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">Matlab 是学术界非常流行的科学计算平台。我在攻读工程学位的过程中一直在使用它，有可能你会遇到。大学发布的数据集的 mat 文件。</p><p id="cd7f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这是一个简短的帖子，解释了如何使用 python 加载这些文件，python 是当今最流行的机器学习语言。</p><h1 id="59c7" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">数据</h1><p id="e5e9" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">我想建立一个分类器来检测不同型号和品牌的汽车，所以斯坦福汽车数据集似乎是一个很好的起点。来自学术界，数据集的注释在。mat 格式。你可以在这里获得这篇文章<a class="ae mc" href="https://ai.stanford.edu/~jkrause/cars/car_devkit.tgz" rel="noopener ugc nofollow" target="_blank">中使用的文件。</a></p><h1 id="bfce" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">正在加载。mat 文件</h1><p id="b441" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">Scipy 是一个非常流行的用于科学计算的 python 库，很自然地，他们有一个方法可以让你读入。mat 文件。阅读它们绝对是最简单的部分。您可以用一行代码完成它:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="fce7" class="mm la it mi b gy mn mo l mp mq">from scipy.io import loadmat<br/>annots = loadmat('cars_train_annos.mat')</span></pre><p id="48b9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">嗯，真的就这么简单。但是让我们继续，实际上试着从这本字典中得到我们需要的数据。</p><h1 id="3b86" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">格式化数据</h1><p id="13e5" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">loadmat 方法返回一个更熟悉的数据结构，一个 python 字典。如果我们看一下这些键，我们会发现与处理. mat 文件相比，我们现在感觉就像在家里一样:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="0c9e" class="mm la it mi b gy mn mo l mp mq">annots.keys()<br/>&gt; dict_keys(['__header__', '__version__', '__globals__', 'annotations'])</span></pre><p id="34c9" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">查看这个数据集的文档，我们将了解它的真正构成。README.txt 为我们提供了以下信息:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="c17b" class="mm la it mi b gy mn mo l mp mq">This file gives documentation for the cars 196 dataset.<br/>(<a class="ae mc" href="http://ai.stanford.edu/~jkrause/cars/car_dataset.html" rel="noopener ugc nofollow" target="_blank">http://ai.stanford.edu/~jkrause/cars/car_dataset.html</a>)</span><span id="0da9" class="mm la it mi b gy mr mo l mp mq"> — — — — — — — — — — — — — — — — — — — — <br/>Metadata/Annotations<br/> — — — — — — — — — — — — — — — — — — — — <br/>Descriptions of the files are as follows:</span><span id="72ff" class="mm la it mi b gy mr mo l mp mq">-cars_meta.mat:<br/> Contains a cell array of class names, one for each class.</span><span id="f0e2" class="mm la it mi b gy mr mo l mp mq">-cars_train_annos.mat:<br/> Contains the variable ‘annotations’, which is a struct array of length<br/> num_images and where each element has the fields:<br/> bbox_x1: Min x-value of the bounding box, in pixels<br/> bbox_x2: Max x-value of the bounding box, in pixels<br/> bbox_y1: Min y-value of the bounding box, in pixels<br/> bbox_y2: Max y-value of the bounding box, in pixels<br/> class: Integral id of the class the image belongs to.<br/> fname: Filename of the image within the folder of images.</span><span id="a920" class="mm la it mi b gy mr mo l mp mq">-cars_test_annos.mat:<br/> Same format as ‘cars_train_annos.mat’, except the class is not provided.</span><span id="cdb7" class="mm la it mi b gy mr mo l mp mq"> — — — — — — — — — — — — — — — — — — — — <br/>Submission file format<br/> — — — — — — — — — — — — — — — — — — — — <br/>Files for submission should be .txt files with the class prediction for<br/>image M on line M. Note that image M corresponds to the Mth annotation in<br/>the provided annotation file. An example of a file in this format is<br/>train_perfect_preds.txt</span><span id="9521" class="mm la it mi b gy mr mo l mp mq">Included in the devkit are a script for evaluating training accuracy,<br/>eval_train.m. Usage is:</span><span id="a7bf" class="mm la it mi b gy mr mo l mp mq">(in MATLAB)<br/>&gt;&gt; [accuracy, confusion_matrix] = eval_train(‘train_perfect_preds.txt’)</span><span id="3e58" class="mm la it mi b gy mr mo l mp mq">If your training predictions work with this function then your testing<br/>predictions should be good to go for the evaluation server, assuming<br/>that they’re in the same format as your training predictions.</span></pre><p id="a935" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们感兴趣的是'<em class="ms">注解</em>'变量，因为它包含了我们的类标签和边界框。它是一种结构，一种人们非常熟悉的数据类型，来自 C 或 java 风格的强类型语言。</p><p id="3e44" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">稍微挖掘一下这个对象，我们就会发现一些有趣的东西:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="a38c" class="mm la it mi b gy mn mo l mp mq">type(annots[‘annotations’]),annots[‘annotations’].shape<br/>&gt;(numpy.ndarray, (1, 8144))</span><span id="d6f1" class="mm la it mi b gy mr mo l mp mq">type(annots['annotations'][0][0]),annots['annotations'][0][0].shape<br/>&gt;(numpy.void, ())</span></pre><p id="bb21" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">注释以 numpy.ndarray 格式存储，但是这个数组中项目的数据类型是<strong class="kd iu"> numpy.void </strong>，numpy 似乎并不知道它们的形状。</p><p id="9b14" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu"> loadmat </strong>方法的<a class="ae mc" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.io.loadmat.html" rel="noopener ugc nofollow" target="_blank">文档页面</a>告诉我们它如何将 matlab 结构加载到<a class="ae mc" href="https://docs.scipy.org/doc/numpy-1.14.0/user/basics.rec.html" rel="noopener ugc nofollow" target="_blank"> numpy 结构化数组</a>中。您可以使用键来访问结构的成员:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="5767" class="mm la it mi b gy mn mo l mp mq">annots[‘annotations’][0][0][‘bbox_x1’], annots[‘annotations’][0][0][‘fname’]</span><span id="e324" class="mm la it mi b gy mr mo l mp mq">&gt; (array([[39]], dtype=uint8), array(['00001.jpg'], dtype='&lt;U9'))</span></pre><p id="3ca2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在我们知道了如何访问结构的成员，我们可以遍历所有的成员并将它们存储在一个列表中:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="b9b8" class="mm la it mi b gy mn mo l mp mq">[item.flat[0] for item in annots[‘annotations’][0][0]]</span><span id="dbd1" class="mm la it mi b gy mr mo l mp mq">&gt; [39, 116, 569, 375, 14, '00001.jpg']</span></pre><p id="4edb" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这里，我们可以使用<a class="ae mc" href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.ndarray.flat.html" rel="noopener ugc nofollow" target="_blank"> flat </a>方法从数组中挤出值。</p><h1 id="3818" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">你好熊猫</h1><p id="8b7f" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">现在我们知道了如何用 python 处理 matlab 文件，让我们把它转换成 pandas 数据框。我们可以使用列表列表轻松做到这一点:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="e042" class="mm la it mi b gy mn mo l mp mq">data = [[row.flat[0] for row in line] for line in annots[‘annotations’][0]]</span><span id="5c9f" class="mm la it mi b gy mr mo l mp mq">columns = [‘bbox_x1’, ‘bbox_y1’, ‘bbox_x2’, ‘bbox_y2’, ‘class’, ‘fname’]<br/>df_train = pd.DataFrame(data, columns=columns)</span></pre><figure class="md me mf mg gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mt"><img src="../Images/247a528a29d213e13377ddbba86d3e87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DR8bZ3edT9nSYhd0JIb_rQ.png"/></div></div></figure><p id="6473" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">终于，熟悉的领地！</p><p id="6f40" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这个帖子的代码可以在<a class="ae mc" href="https://colab.research.google.com/github/ashiquem/vault/blob/master/python/Matlab%20Data%20Demo.ipynb" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p></div></div>    
</body>
</html>