<html>
<head>
<title>Introduction to Solving Basic Bayesian Networks with OpenBUGS in R</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 R 语言中的 OpenBUGS 求解基本贝叶斯网络简介</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/intro-to-solving-basic-bayesian-networks-with-openbugs-in-r-51def271f3ed?source=collection_archive---------31-----------------------#2019-11-05">https://towardsdatascience.com/intro-to-solving-basic-bayesian-networks-with-openbugs-in-r-51def271f3ed?source=collection_archive---------31-----------------------#2019-11-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="cf0d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">贝叶斯网络是一种概率图形模型，它通过有向无环图表示一组变量及其条件依赖关系。“定向的”意味着连接图的节点的箭头是定向的(即具有方向)，因此条件依赖具有单向方向。“无环”是指不可能通过网络循环。它只能上升或下降。</p><p id="5e68" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们从一个例子开始:</p><blockquote class="kl km kn"><p id="b52c" class="jn jo ko jp b jq jr js jt ju jv jw jx kp jz ka kb kq kd ke kf kr kh ki kj kk ij bi translated">曼彻斯特联队正在参加英格兰超级联赛。在俱乐部历史上最成功的教练弗格森爵士退休后，他们一直在努力保持他们作为世界上最大的俱乐部之一的形象。去年，他们在联赛中只获得了第 6 名。因此，在 2019/20 赛季开始时，球迷们认为俱乐部将以 0.2 的概率排名联盟前 3，以 0.3 的概率排名第 4，以 0.5 的概率排名前 4。</p><p id="688c" class="jn jo ko jp b jq jr js jt ju jv jw jx kp jz ka kb kq kd ke kf kr kh ki kj kk ij bi translated">这些可能性只有在俱乐部的关键球员马库斯·拉什福德整个赛季都没有严重受伤的情况下才成立。他受重伤的概率是 0.2。如果发生这种情况，上述季末头寸的概率分别为 0.1、0.2 和 0.7。</p><p id="14fb" class="jn jo ko jp b jq jr js jt ju jv jw jx kp jz ka kb kq kd ke kf kr kh ki kj kk ij bi translated">如果他们以前 3 名结束，他们将获得明年冠军联赛小组赛的资格。如果他们获得第四名，他们将不得不通过冠军联赛资格赛，因此他们进入冠军联赛小组赛的概率降低到 0.7。</p><p id="17ef" class="jn jo ko jp b jq jr js jt ju jv jw jx kp jz ka kb kq kd ke kf kr kh ki kj kk ij bi translated">曼联也在参加欧洲联赛，欧洲冠军联赛的第二梯队。作为前冠军，如果拉什福德身体健康，他们有 0.6 的概率再次赢得欧联杯。如果拉什福德受伤，概率降低到 0.4。如果他们赢得欧联杯，那么他们即使进不了前 3，也保证以 0.99 的概率在明年的欧冠小组赛中占有一席之地，除非欧足联改变明年的规则。</p><p id="2190" class="jn jo ko jp b jq jr js jt ju jv jw jx kp jz ka kb kq kd ke kf kr kh ki kj kk ij bi translated">如果俱乐部获得了明年冠军联赛小组赛的资格，他们将有 0.7 的机会签下他们的首要转会目标之一，来自里斯本竞技的布鲁诺·费尔南德斯。如果没有，签下费尔南德斯的几率降低到 0.4。</p><p id="5288" class="jn jo ko jp b jq jr js jt ju jv jw jx kp jz ka kb kq kd ke kf kr kh ki kj kk ij bi translated">2020/2021 赛季初，布鲁诺·费尔南德斯是曼联球员。</p><p id="e19e" class="jn jo ko jp b jq jr js jt ju jv jw jx kp jz ka kb kq kd ke kf kr kh ki kj kk ij bi translated">-拉什福德受伤的概率有多大？</p><p id="b9c4" class="jn jo ko jp b jq jr js jt ju jv jw jx kp jz ka kb kq kd ke kf kr kh ki kj kk ij bi translated">-俱乐部获得欧冠资格的概率有多大？</p><p id="42ad" class="jn jo ko jp b jq jr js jt ju jv jw jx kp jz ka kb kq kd ke kf kr kh ki kj kk ij bi translated">-俱乐部进入前 3 名的概率有多大？</p><p id="8c95" class="jn jo ko jp b jq jr js jt ju jv jw jx kp jz ka kb kq kd ke kf kr kh ki kj kk ij bi translated">-俱乐部获得第四名的概率有多大？</p><p id="b6f3" class="jn jo ko jp b jq jr js jt ju jv jw jx kp jz ka kb kq kd ke kf kr kh ki kj kk ij bi translated">-俱乐部赢得欧联杯的概率有多大？</p></blockquote><p id="fec4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当涉及的变量和依赖项的数量很小时，这种类型的一些问题可以直接使用贝叶斯定理公式来解析求解。然而，对于像上面的例子这样的问题，使用贝叶斯分析的软件应用程序来找到有问题的概率要容易得多。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi ks"><img src="../Images/491ae2a664f3ad3681e9198a726e64fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AVN53gLUXMhnfSxgEe2V3g.png"/></div></div></figure><p id="0109" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里，我们将使用 R 中的库“R2OpenBUGS”来求解这些概率。该库基于<a class="ae le" href="https://en.wikipedia.org/wiki/OpenBUGS" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir"> OpenBUGS </strong> </a>软件，用于使用<a class="ae le" href="https://en.wikipedia.org/wiki/Markov_chain_Monte_Carlo" rel="noopener ugc nofollow" target="_blank">马尔可夫链蒙特卡罗(MCMC </a>)方法对复杂统计模型进行贝叶斯分析。“bug”代表(<a class="ae le" href="https://en.wikipedia.org/wiki/Bayesian_inference" rel="noopener ugc nofollow" target="_blank">贝叶斯推断</a>使用<a class="ae le" href="https://en.wikipedia.org/wiki/Gibbs_sampling" rel="noopener ugc nofollow" target="_blank">吉布斯采样</a>)。因此，要运行这个库，需要安装 OpenBUGS。安装说明可以在<a class="ae le" href="http://www.openbugs.net/w/Downloads" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">这里</strong> </a>找到。</p><p id="739b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">首先，我们导入库“R2OpenBUGS ”,并定义 OpenBUGS 程序的安装路径。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi lf"><img src="../Images/ac8c2669c0ca70f7b920a51bbb9c5a8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vyHS_hw9H4B6ORs8E5Qw4Q.png"/></div></div></figure><p id="bf93" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后，我们将定义我们的模型</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div class="gh gi lg"><img src="../Images/d6f8f9c9bbd4418ca7faed912d67c433.png" data-original-src="https://miro.medium.com/v2/resize:fit:906/format:webp/1*qwlG0vH5a_H58ERbm9UTVw.png"/></div></figure><p id="c8af" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里，先生表示马库斯·拉什福德，当先生大约为 2 时，拉什福德受伤，我们将该事件分配给受伤先生。请注意，在这种情况下，当先生在 1 左右返回时，拉什福德是合适的。这些事件的顺序可能会改变，这取决于我们以后如何分配概率。在这种情况下，我们几乎可以映射像(MRfit，MRinjured) -&gt; (1，2)这样的事件。</p><p id="5e20" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">类似地，还定义了其他变量。请注意，由于曼联在英超(EPL)的表现取决于马库斯·拉什福德的状况，因此在我们定义 EPL 变量时，“先生”变量也包括在内。其他依赖项也遵循类似的方式。</p><p id="b142" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，我们分配我们拥有的数据(即概率、确凿证据)。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi lh"><img src="../Images/d1590a3ad061b78ce7e47e3107800d4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VBOzBxr4xnWY3Wn1-jQfBA.png"/></div></div></figure><p id="3aae" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们看到 BF 被设置为 1。这是因为我们从这个问题中知道布鲁诺·费尔南德斯将在本赛季结束后与曼联签约。因此，这是确凿的证据，我们将 BF 变量赋值为 1。</p><p id="e901" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">其余的数据是给定的概率。具有相关性的概率具有矩阵的形式。请注意，这里定义矩阵的方式不同于 OpenBUGS 本身的原生矩阵配置。更多关于如何在 OpenBUGS 软件上定义矩阵的信息可以在<a class="ae le" href="http://www.openbugs.net/Manuals/ModelSpecification.html" rel="noopener ugc nofollow" target="_blank"> <strong class="jp ir">这里</strong> </a>找到。</p><p id="498d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">接下来，我们需要遵循一个默认的强制步骤，称为初始化。然而，这更适用于涉及连续随机分布的问题，我们不需要在这里初始化任何值。但是，如果我们没有给初始化步骤赋值，那么这个包会返回一个错误，所以我们把它赋值为 NULL。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div class="gh gi li"><img src="../Images/02d4aa672bbbf244670eb2ab2b7c00a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:298/format:webp/1*FjzjQVzUcPxUnmNGdbDR1w.png"/></div></figure><p id="0fa4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，我们可以运行模型来计算有确凿证据的概率。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi lj"><img src="../Images/8d299a15f429e57e22d23fffb48da5f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Rr_LgR5tu2h_KdlcxHspzA.png"/></div></div></figure><p id="8505" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">“调试”默认为假。但是，建议将其切换为 True，因为在模型不运行的情况下更容易看到错误。我们现在可以运行代码让模型运行起来。这里，我们将运行并迭代模型 100，000 次，然后丢弃前 1，000 个结果，以确保不包括任何大的初始变化。</p><p id="71ba" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">当模型运行时，OpenBUGS 将打开并显示一个类似上面的窗口。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gh gi lk"><img src="../Images/89cb848a66879d023cf195f0573ccc11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SfkqDd9i8_yNxJo5LrD1Gw.png"/></div></div></figure><p id="8ae0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">它包含了我们正在寻找的所有答案，但是如果我们希望一切都在 R 中，我们将需要关闭应用程序，以便 R 代码可以完成运行。然后我们使用下面的代码在 r 中显示结果。</p><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div class="gh gi ll"><img src="../Images/77b194003133ef0dee4dd8cdc98ce28d.png" data-original-src="https://miro.medium.com/v2/resize:fit:420/format:webp/1*vu9Zhdp8hiZwL5p-lS5Ljw.png"/></div></figure><figure class="kt ku kv kw gt kx gh gi paragraph-image"><div class="gh gi lm"><img src="../Images/68bae81c274a957b07a19c1e1136e1c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1096/format:webp/1*_RxZXfOmMw-1cd6P-tUL3w.png"/></div></figure><p id="28df" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">鉴于布鲁诺-费尔南德斯与曼联签约的消息，曼联获得明年欧冠参赛资格的概率为 81%。他们赢得欧联杯的概率也提高到了 62.5%。他们在英超联赛中获得前 3 名或第 4 名的概率也略高，分别为 20.8%和 30.3%。</p><p id="8efb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">值得注意的是，马库斯·拉什福德受伤的概率降低到了 17.6%，因为他对球队的表现起着重要作用，并直接影响到球队是否有资格参加 UCL 的比赛，这直接影响到费尔南德斯是否决定与曼联签约。</p><pre class="kt ku kv kw gt ln lo lp lq aw lr bi"><span id="5476" class="ls lt iq lo b gy lu lv l lw lx">library(R2OpenBUGS)<br/>OpenBUGS.pgm = "c:/Program Files (x86)/OpenBUGS/OpenBUGS323/OpenBUGS.exe"</span><span id="056a" class="ls lt iq lo b gy ly lv l lw lx">#Setting up the model<br/>model &lt;- function() {<br/>  <br/> MR ~ dcat(p.MR[]);<br/> MRinjured &lt;- equals(MR, 2);<br/> <br/> EPL ~ dcat(p.EPL[MR,]);<br/> EPLTop3 &lt;- equals(EPL,1);<br/> EPL4th &lt;- equals(EPL,2);<br/> EPLElse &lt;- equals(EPL,3);<br/> <br/> Europa ~ dcat(p.Europa[MR,]);<br/> WonEL &lt;- equals(Europa,1);<br/> <br/> UCL ~ dcat(p.UCL[EPL,Europa,]);<br/> InUCL &lt;- equals(UCL,1);<br/> <br/> BF ~ dcat(p.BF[UCL,])<br/>}</span><span id="b72f" class="ls lt iq lo b gy ly lv l lw lx">#Hard evidence: 1 is TRUE and 2 is FALSE</span><span id="b4ca" class="ls lt iq lo b gy ly lv l lw lx">data &lt;- list( BF = 1,</span><span id="90ef" class="ls lt iq lo b gy ly lv l lw lx">p.MR = c(0.8,0.2),</span><span id="84ca" class="ls lt iq lo b gy ly lv l lw lx">p.Europa = structure(.Data =  c(0.6,0.3,<br/>                         0.4,0.7), .Dim = c(2,2)),</span><span id="5db8" class="ls lt iq lo b gy ly lv l lw lx">p.EPL = structure(.Data = c(0.2,   0.1,    <br/>                   0.3,   0.2, <br/>                   0.5,   0.7), .Dim = c(2,3)),</span><span id="7588" class="ls lt iq lo b gy ly lv l lw lx">p.UCL = structure(.Data = c(1, 0.99, 0.99,     1, 0.7, 0,<br/>                    0, 0.01, 0.01,     0, 0.3, 1), .Dim = c(3,2,2)),</span><span id="d7dc" class="ls lt iq lo b gy ly lv l lw lx">p.BF = structure(.Data = c( 0.7,  0.4,<br/>                            0.3,  0.6), .Dim = c(2,2)) <br/>)</span><span id="18c8" class="ls lt iq lo b gy ly lv l lw lx">#Initialization<br/>inits &lt;- NULL</span><span id="1eaf" class="ls lt iq lo b gy ly lv l lw lx">#Run BUGS and save results</span><span id="a566" class="ls lt iq lo b gy ly lv l lw lx">out &lt;- bugs(data = data, <br/>                inits = inits, <br/>                parameters.to.save = c("MRinjured", "EPLTop3", "EPL4th", "EPLElse", "WonEL", "InUCL"),<br/>                model.file = model, <br/>                digits = 5,<br/>                n.chains = 1,<br/>                n.burnin = 1000,<br/>                n.iter = 100000,<br/>                OpenBUGS.pgm=OpenBUGS.pgm, <br/>                WINE = WINE, <br/>                WINEPATH = WINEPATH,<br/>                useWINE=F,<br/>                debug = T,<br/>                working.directory=getwd(),<br/>                DIC = F<br/>                )</span><span id="8a3e" class="ls lt iq lo b gy ly lv l lw lx">print(out$summary)</span></pre></div></div>    
</body>
</html>