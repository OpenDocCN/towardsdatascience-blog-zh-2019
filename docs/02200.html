<html>
<head>
<title>Heart Disease Prediction in TensorFlow 2 | TensorFlow for Hackers (Part II)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">TensorFlow 2 |面向黑客的 TensorFlow 中的心脏病预测(下)</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/heart-disease-prediction-in-tensorflow-2-tensorflow-for-hackers-part-ii-378eef0400ee?source=collection_archive---------6-----------------------#2019-04-11">https://towardsdatascience.com/heart-disease-prediction-in-tensorflow-2-tensorflow-for-hackers-part-ii-378eef0400ee?source=collection_archive---------6-----------------------#2019-04-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="460a" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用 TensorFlow 2 中的神经网络对患者数据中的心脏病进行分类</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/8fa20eb7e4fd694898f8bf6a0b801bad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z2BLdvyNXtfL9N9Nvy97fg.jpeg"/></div></div></figure><blockquote class="kr ks kt"><p id="4ac2" class="ku kv kw kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><em class="iq">TL；DR 在 TensorFlow 2 中建立并训练一个深度神经网络用于二进制分类。使用该模型从患者数据中预测心脏病的存在。</em></p></blockquote><p id="910f" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld lr lf lg lh ls lj lk ll lt ln lo lp lq ij bi translated">机器学习已经被用于解决许多领域的现实问题。医学也不例外。虽然有争议，但已经提出了多种模型并取得了一些成功。谷歌和其他公司的一些著名项目:</p><ul class=""><li id="03cf" class="lu lv iq kx b ky kz lb lc lr lw ls lx lt ly lq lz ma mb mc bi translated"><a class="ae md" href="https://ai.googleblog.com/2016/11/deep-learning-for-detection-of-diabetic.html" rel="noopener ugc nofollow" target="_blank">诊断糖尿病眼病</a></li><li id="c224" class="lu lv iq kx b ky me lb mf lr mg ls mh lt mi lq lz ma mb mc bi translated"><a class="ae md" href="https://ai.googleblog.com/2017/03/assisting-pathologists-in-detecting.html" rel="noopener ugc nofollow" target="_blank">协助病理学家检测癌症</a></li></ul><p id="e824" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld lr lf lg lh ls lj lk ll lt ln lo lp lq ij bi translated">今天，我们来看看一个特定的领域——心脏病预测。</p><blockquote class="kr ks kt"><p id="8ecd" class="ku kv kw kx b ky kz jr la lb lc ju ld le lf lg lh li lj lk ll lm ln lo lp lq ij bi translated"><em class="iq">在美国，每年约有 61 万人死于心脏病，也就是说，每 4 例死亡中就有一例。心脏病是男性和女性死亡的主要原因。2009 年因心脏病死亡的一半以上是男性。— </em> <a class="ae md" href="https://www.cdc.gov/heartdisease/facts.htm" rel="noopener ugc nofollow" target="_blank"> <em class="iq">心脏病事实&amp;统计| cdc.gov</em></a></p></blockquote><p id="58d6" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld lr lf lg lh ls lj lk ll lt ln lo lp lq ij bi translated"><em class="kw">请注意，此处给出的模型非常有限，并且不适用于现实情况。我们的数据集非常小，这里得出的结论绝不是一般化的。心脏病预测是一个比本文描述的复杂得多的问题。</em></p><p id="4489" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld lr lf lg lh ls lj lk ll lt ln lo lp lq ij bi translated"><a class="ae md" href="https://colab.research.google.com/drive/13EThgYKSRwGBJJn_8iAvg-QWUWjCufB1" rel="noopener ugc nofollow" target="_blank">谷歌合作笔记本中的完整源代码</a></p><p id="c4ad" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld lr lf lg lh ls lj lk ll lt ln lo lp lq ij bi translated">计划是这样的:</p><ol class=""><li id="8fcc" class="lu lv iq kx b ky kz lb lc lr lw ls lx lt ly lq mj ma mb mc bi translated">浏览患者数据</li><li id="7efb" class="lu lv iq kx b ky me lb mf lr mg ls mh lt mi lq mj ma mb mc bi translated">数据预处理</li><li id="6072" class="lu lv iq kx b ky me lb mf lr mg ls mh lt mi lq mj ma mb mc bi translated">在 TensorFlow 2 中创建您的神经网络</li><li id="31c2" class="lu lv iq kx b ky me lb mf lr mg ls mh lt mi lq mj ma mb mc bi translated">训练模型</li><li id="24dc" class="lu lv iq kx b ky me lb mf lr mg ls mh lt mi lq mj ma mb mc bi translated">根据患者数据预测心脏病</li></ol><h1 id="3056" class="mk ml iq bd mm mn mo mp mq mr ms mt mu jw mv jx mw jz mx ka my kc mz kd na nb bi translated">患者数据</h1><p id="3aef" class="pw-post-body-paragraph ku kv iq kx b ky nc jr la lb nd ju ld lr ne lg lh ls nf lk ll lt ng lo lp lq ij bi translated">我们的数据来自<a class="ae md" href="https://www.kaggle.com/ronitf/heart-disease-uci" rel="noopener ugc nofollow" target="_blank">这个数据集</a>。它包含了 303 份病人记录。每个记录包含<em class="kw"> 14 个</em>属性。</p><p id="2e8d" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld lr lf lg lh ls lj lk ll lt ln lo lp lq ij bi translated">有多少病历显示有心脏病？</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nh"><img src="../Images/75dc0be9286bf3272d7b898d67bba4f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*86Z1Z_BvZ14wJHbv.png"/></div></div></figure><p id="f709" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld lr lf lg lh ls lj lk ll lt ln lo lp lq ij bi translated">考虑到行数，这看起来是一个分布相当均匀的数据集。</p><p id="34d9" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld lr lf lg lh ls lj lk ll lt ln lo lp lq ij bi translated">让我们来看看心脏病是如何影响不同性别的:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nh"><img src="../Images/a6c72c26a4c83534116b97c55057d523.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*MlqYyl_wHzSE615x.png"/></div></div></figure><p id="e98c" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld lr lf lg lh ls lj lk ll lt ln lo lp lq ij bi translated">以下是这些特征之间的皮尔逊相关热图:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ni"><img src="../Images/46707f96e4080ad7e0066934a2b1bde7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*QBHFgdxp_h0qh5RF.png"/></div></div></figure><p id="e7d3" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld lr lf lg lh ls lj lk ll lt ln lo lp lq ij bi translated"><code class="fe nj nk nl nm b">thalach</code>(“最大心率”)与<code class="fe nj nk nl nm b">age</code>如何影响疾病的存在:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nh"><img src="../Images/7f437d2a6e0ea219f6905e10ed02cbfa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Rb4oNmdxO6s7Ibx9.png"/></div></div></figure><p id="abcc" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld lr lf lg lh ls lj lk ll lt ln lo lp lq ij bi translated">看起来最大心率可以很好地预测疾病的存在，与年龄无关。</p><p id="4377" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld lr lf lg lh ls lj lk ll lt ln lo lp lq ij bi translated">不同类型的胸痛如何影响心脏病的存在:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nh"><img src="../Images/0912731ac3428da8c78d997ffcd1d024.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Y0G_dRUXMYEFNdEm.png"/></div></div></figure><p id="cb9f" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld lr lf lg lh ls lj lk ll lt ln lo lp lq ij bi translated">胸痛可能不是心脏病的征兆。</p><h1 id="aeff" class="mk ml iq bd mm mn mo mp mq mr ms mt mu jw mv jx mw jz mx ka my kc mz kd na nb bi translated">数据预处理</h1><p id="b501" class="pw-post-body-paragraph ku kv iq kx b ky nc jr la lb nd ju ld lr ne lg lh ls nf lk ll lt ng lo lp lq ij bi translated">我们的数据混合了分类数据和数字数据。让我们使用 TensorFlow 的<a class="ae md" href="https://www.tensorflow.org/guide/feature_columns" rel="noopener ugc nofollow" target="_blank">功能列</a>。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nn"><img src="../Images/f1b7aa5eeea78a5942fc06823d3aecfd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*fIxat53O6WTx5rit.jpg"/></div></div><figcaption class="no np gj gh gi nq nr bd b be z dk"><a class="ae md" href="https://www.tensorflow.org/" rel="noopener ugc nofollow" target="_blank">https://www.tensorflow.org/</a></figcaption></figure><p id="c1da" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld lr lf lg lh ls lj lk ll lt ln lo lp lq ij bi translated">要素列允许您桥接/处理数据集中的原始数据，以满足模型输入数据的要求。此外，您可以将模型构建过程与数据预处理分离开来。让我们来看看:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="6a88" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld lr lf lg lh ls lj lk ll lt ln lo lp lq ij bi translated">除了数字特征，我们将患者<code class="fe nj nk nl nm b">age</code>放入离散的范围(桶)。此外，<code class="fe nj nk nl nm b">thal</code>、<code class="fe nj nk nl nm b">sex</code>、<code class="fe nj nk nl nm b">cp</code>和<code class="fe nj nk nl nm b">slope</code>是绝对的，我们把它们映射成这样。</p><p id="8f67" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld lr lf lg lh ls lj lk ll lt ln lo lp lq ij bi translated">接下来，让我们将熊猫数据帧转换成张量流数据集:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="41fd" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld lr lf lg lh ls lj lk ll lt ln lo lp lq ij bi translated">并将数据分为训练和测试:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ns nt l"/></div></figure><h1 id="2e02" class="mk ml iq bd mm mn mo mp mq mr ms mt mu jw mv jx mw jz mx ka my kc mz kd na nb bi translated">模型</h1><p id="9e04" class="pw-post-body-paragraph ku kv iq kx b ky nc jr la lb nd ju ld lr ne lg lh ls nf lk ll lt ng lo lp lq ij bi translated">让我们在 TensorFlow 中使用深度神经网络构建一个二元分类器:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="d8bf" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld lr lf lg lh ls lj lk ll lt ln lo lp lq ij bi translated">我们的模型使用我们在预处理步骤中创建的特性列。请注意，我们不再需要指定输入层的大小。</p><p id="3114" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld lr lf lg lh ls lj lk ll lt ln lo lp lq ij bi translated">我们还在两个密集层之间使用了<a class="ae md" href="https://www.tensorflow.org/versions/r2.0/api_docs/python/tf/keras/layers/Dropout" rel="noopener ugc nofollow" target="_blank">下降</a>层。我们的输出层包含 2 个神经元，因为我们正在构建一个二元分类器。</p><h1 id="ceb9" class="mk ml iq bd mm mn mo mp mq mr ms mt mu jw mv jx mw jz mx ka my kc mz kd na nb bi translated">培养</h1><p id="ab9c" class="pw-post-body-paragraph ku kv iq kx b ky nc jr la lb nd ju ld lr ne lg lh ls nf lk ll lt ng lo lp lq ij bi translated">我们的损失函数是二元交叉熵，定义如下:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/b57baf77d613f9d955b0c19ef92e4655.png" data-original-src="https://miro.medium.com/v2/resize:fit:1110/format:webp/1*EaQ5v9TX6vMnyBxAq8JRpQ.png"/></div></figure><p id="4a0c" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld lr lf lg lh ls lj lk ll lt ln lo lp lq ij bi translated">其中，y 是二进制指示符，表示预测类别对于当前观察值是否正确，p 是预测概率。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="2d1b" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld lr lf lg lh ls lj lk ll lt ln lo lp lq ij bi translated">以下是培训过程的一个示例:</p><pre class="kg kh ki kj gt nv nm nw nx aw ny bi"><span id="57c1" class="nz ml iq nm b gy oa ob l oc od">Epoch 95/100<br/>0s 42ms/step - loss: 0.3018 - accuracy: 0.8430 - val_loss: 0.4012 - val_accuracy: 0.8689<br/>Epoch 96/100<br/>0s 42ms/step - loss: 0.2882 - accuracy: 0.8547 - val_loss: 0.3436 - val_accuracy: 0.8689<br/>Epoch 97/100<br/>0s 42ms/step - loss: 0.2889 - accuracy: 0.8732 - val_loss: 0.3368 - val_accuracy: 0.8689<br/>Epoch 98/100<br/>0s 42ms/step - loss: 0.2964 - accuracy: 0.8386 - val_loss: 0.3537 - val_accuracy: 0.8770<br/>Epoch 99/100<br/>0s 43ms/step - loss: 0.3062 - accuracy: 0.8282 - val_loss: 0.4110 - val_accuracy: 0.8607<br/>Epoch 100/100<br/>0s 43ms/step - loss: 0.2685 - accuracy: 0.8821 - val_loss: 0.3669 - val_accuracy: 0.8852</span></pre><p id="d81a" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld lr lf lg lh ls lj lk ll lt ln lo lp lq ij bi translated">测试集的精确度:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ns nt l"/></div></figure><pre class="kg kh ki kj gt nv nm nw nx aw ny bi"><span id="a7e3" class="nz ml iq nm b gy oa ob l oc od">0s 24ms/step - loss: 0.3669 - accuracy: 0.8852<br/>[0.3669000566005707, 0.8852459]</span></pre><p id="acda" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld lr lf lg lh ls lj lk ll lt ln lo lp lq ij bi translated">所以，我们在测试集上有<em class="kw"> ~88% </em>的准确率。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oe"><img src="../Images/62d4b042b22c4b0847f43caba51b2883.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*sv6MD9M6UeKcZT_Y.png"/></div></div></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oe"><img src="../Images/f4f5d83fb3f5e784a93c4390da651964.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*8ZVwXG1v8ojOB2lF.png"/></div></div></figure><h1 id="d8eb" class="mk ml iq bd mm mn mo mp mq mr ms mt mu jw mv jx mw jz mx ka my kc mz kd na nb bi translated">预测心脏病</h1><p id="d3c8" class="pw-post-body-paragraph ku kv iq kx b ky nc jr la lb nd ju ld lr ne lg lh ls nf lk ll lt ng lo lp lq ij bi translated">现在，我们已经有了一个在测试集上具有一定准确性的模型，让我们尝试基于数据集中的特征来预测心脏病。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ns nt l"/></div></figure><p id="114a" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld lr lf lg lh ls lj lk ll lt ln lo lp lq ij bi translated">因为我们对做出二元决策感兴趣，所以我们采用输出层的最大概率。</p><pre class="kg kh ki kj gt nv nm nw nx aw ny bi"><span id="7086" class="nz ml iq nm b gy oa ob l oc od">                  precision recall    f1-score    support<br/><br/>           0       0.59      0.66      0.62        29<br/>           1       0.66      0.59      0.62        32<br/><br/>   micro avg       0.62      0.62      0.62        61<br/>   macro avg       0.62      0.62      0.62        61<br/>weighted avg       0.63      0.62      0.62        61</span></pre><p id="23a6" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld lr lf lg lh ls lj lk ll lt ln lo lp lq ij bi translated">不考虑精度，可以看到我们模型的精度、召回率、f1-score 都没有那么高。让我们来看看混淆矩阵:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi of"><img src="../Images/a23b2600fbe49bf4b4b046b9564f9c5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*qKiMjTaQ-RaoaG8v.png"/></div></div></figure><p id="b248" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld lr lf lg lh ls lj lk ll lt ln lo lp lq ij bi translated">我们的模型看起来有点混乱。你能改进它吗？</p><h1 id="b2b7" class="mk ml iq bd mm mn mo mp mq mr ms mt mu jw mv jx mw jz mx ka my kc mz kd na nb bi translated">结论</h1><p id="57d8" class="pw-post-body-paragraph ku kv iq kx b ky nc jr la lb nd ju ld lr ne lg lh ls nf lk ll lt ng lo lp lq ij bi translated"><a class="ae md" href="https://colab.research.google.com/drive/13EThgYKSRwGBJJn_8iAvg-QWUWjCufB1" rel="noopener ugc nofollow" target="_blank">谷歌合作笔记本中的完整源代码</a></p><p id="406d" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld lr lf lg lh ls lj lk ll lt ln lo lp lq ij bi translated">你做到了！你使用深度神经网络和 TensorFlow 制作了一个二元分类器，并使用它从患者数据中预测心脏病。</p><p id="f353" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld lr lf lg lh ls lj lk ll lt ln lo lp lq ij bi translated">接下来，我们将看看 TensorFlow 2 在应用于计算机视觉时为我们准备了什么。</p></div><div class="ab cl og oh hu oi" role="separator"><span class="oj bw bk ok ol om"/><span class="oj bw bk ok ol om"/><span class="oj bw bk ok ol"/></div><div class="ij ik il im in"><p id="ae03" class="pw-post-body-paragraph ku kv iq kx b ky kz jr la lb lc ju ld lr lf lg lh ls lj lk ll lt ln lo lp lq ij bi translated"><em class="kw">原载于</em><a class="ae md" href="https://www.curiousily.com/posts/heart-disease-prediction-in-tensorflow-2/" rel="noopener ugc nofollow" target="_blank"><em class="kw">www.curiousily.com</em></a><em class="kw">。</em></p></div></div>    
</body>
</html>