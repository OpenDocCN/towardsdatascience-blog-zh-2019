# 用机器学习和深度学习预测 Airbnb 价格

> 原文：<https://towardsdatascience.com/predicting-airbnb-prices-with-machine-learning-and-deep-learning-f46d44afb8a6?source=collection_archive---------11----------------------->

## XGBoost 实验和调整神经网络

![](img/dfec39c9c8281c4800a03bddc36990bb.png)

Source: plumguide.com

# 项目目标和背景

Airbnb 是一个房屋共享平台，允许房主和租户(房东)将他们的房产(房源)放在网上，这样客人就可以付费入住。主办方应该为他们的列表设定自己的价格。虽然 Airbnb 和其他网站提供了一些一般性的指导，但目前还没有免费和准确的服务来帮助房东利用广泛的数据点为他们的房产定价。

付费的第三方定价软件是可用的，但通常你需要输入你自己的预期平均每夜价格(“底价”)，算法将根据一周中的某一天、季节性、日期的远近以及其他因素，围绕该底价改变每天的价格。

Airbnb 的定价很重要，尤其是在伦敦这样的大城市，那里竞争激烈，即使价格上的微小差异也会造成很大差异。这也是一件很难做到正确的事情——价格太高，没有人会预订。价格太低，你会错过很多潜在的收入。

这个项目旨在解决这个问题，通过使用机器学习和深度学习来预测伦敦房产的基础价格。我在之前的帖子中已经探索了 Airbnb 数据的[准备和清理，并进行了一些](/predicting-airbnb-prices-with-deep-learning-part-1-how-to-clean-up-airbnb-data-a5d58e299f6c)[探索性数据分析](/predicting-airbnb-prices-with-deep-learning-part-2-how-to-improve-your-nightly-price-50ea8bc2bd29)。这篇文章是关于创建模型来预测 Airbnb 价格的。

# 数据集

这个项目使用的数据集来自 Insideairbnb.com，这是一个反 Airbnb 的游说团体，从全球多个城市搜集 Airbnb 房源、评论和日历数据。该数据集是在 2019 年 4 月 9 日抓取的，包含了当天该网站上所有伦敦 Airbnb 房源的信息(约 80，000)。

这些数据相当混乱，而且有一些局限性。主要的一点是，它只包括广告价格(有时称为“标签”价格)。标价是向潜在客人宣传的每晚总价格，而不是之前客人每晚支付的实际平均金额。主人可以将广告价格设置为任意值。

尽管如此，这个数据集仍然可以用作概念验证。一个更准确的版本可以使用客人支付的实际平均每晚费用的数据来构建，例如从像 AirDNA 这样的网站收集和出售更高质量的 Airbnb 数据。

清理和删除共线列后，模型中的特征为:

*   该物业容纳的人数
*   浴室的数量
*   物业类型(如公寓)和房间类型(如整个住宅)
*   财产的位置(在自治市的层面上(在[之前的帖子](/predicting-airbnb-prices-with-deep-learning-part-1-how-to-clean-up-airbnb-data-a5d58e299f6c)中进一步讨论)，或者在纬度和经度的层面上的一个模型中——在下面进一步讨论)
*   保证金、清洁费和额外人员费
*   最短和最长住宿时间
*   未来 90 天内可预订的天数
*   评论总数
*   审查每个类别的评级(准确性、清洁度、入住、沟通、位置、价值和总体)
*   自第一次和最近一次审核以来的时间
*   取消政策的类型
*   酒店是否可即时预订
*   是否有各种各样的便利设施(在[之前的帖子](/predicting-airbnb-prices-with-deep-learning-part-1-how-to-clean-up-airbnb-data-a5d58e299f6c)中有更深入的讨论，但包括电视、咖啡机、阳台、互联网和停车场等项目，无论该物业是否适合儿童入住，是否允许自助入住或允许宠物入住，等等)
*   主机响应时间和速率
*   主机是否是超级主机(质量的标志，需要满足各种条件)或其身份是否经过验证(例如，通过验证政府 ID、电话号码和电子邮件地址)
*   主持人总共负责多少个列表
*   主持人在 Airbnb 上挂牌多少天了

# 构建机器学习模型

出于篇幅的考虑，我将在这里跳过数据准备阶段，但是如果你感兴趣，可以在我的 [GitHub repo](https://github.com/L-Lewis/Airbnb-neural-network-price-prediction) 中找到这个项目的所有代码。总之，在清理数据、检查多重共线性和移除共线特征后，除非另有说明，否则使用 sklearn 的`StandardScaler()`对数据进行标准化。使用`pd.get_dummies()`对分类特征进行一次性编码。以 0.2 的测试规模执行了训练测试分割。

虽然我热衷于实验深度学习模型进行价格预测，但我首先构建了一个香草(未调优)XGBoost 机器学习模型(具体来说就是`xgb.XGBRegressor()`)。这是为了提供一个基线水平的准确性，也是为了衡量特征的重要性(众所周知，一旦你进入深度学习领域，这是很难的)。XGBoost 可能会使用机器学习模型提供最佳的可实现精度(除了超参数调整带来的可能的小精度增加)，因为它具有卓越的性能和在 Kaggle 比赛中观察到的普遍出色性。

因为这是一项回归任务，所以选择的评估指标是均方误差(MSE)。我还对精确度感兴趣，所以我也查看了每个生产模型的 r 平方值。

下面是我用来拟合和评估模型的代码:

结果:

```
Training MSE: 0.1576
Validation MSE: 0.159

Training r2: 0.7321
Validation r2: 0.7274
```

对于一个未经调整的模型来说还不错。现在谈谈特性的重要性:

![](img/6b4dd8153fdc07f3a59c4657bfbbc882.png)

**十大最重要的功能是:**

*   该房产可容纳多少人
*   清洁费
*   主机有多少其他列表(以及它们是否是多列表主机)
*   未来 90 天中有多少天可以预订
*   额外每人的费用
*   评论的数量
*   浴室的数量
*   保证金
*   如果房产在威斯敏斯特
*   最短住宿时间

毫不奇怪，**最重要的特征是酒店能容纳多少人**，因为这是你首先用来搜索酒店的主要因素之一。与位置和评论相关的**功能位列前十**也不足为奇。

或许更令人惊讶的是**第三个最重要的功能与主人在 Airbnb 上管理的其他房源数量有关，而不是房源本身**。然而，这并不意味着管理更多物业的主机将导致房源获得更高的价格(尽管这确实是关系的方向)。首先，数据似乎被一些非常大的房地产管理公司扭曲了。其次，这种关系是与广告设定的价格，而不是实际达到的价格，这表明，如果有什么更有经验的主人往往会设定(而不一定达到)更高的价格。第三，我们不能必然地暗示因果关系——这可能是更有经验的多清单主机倾向于采取更昂贵的财产(这确实是一些情况，例如一个罚款停留)。

同样值得注意的是，其他三种费用类型——清洁费、保安费和额外人员费——都在十大费用清单中。很可能当主人为每晚住宿设定较高的价格时，他们也可能将其他价格设定得较高，反之亦然。

# 构建深度学习模型

接下来，我决定用神经网络(NN)进行实验，看看我是否能提高 XGBoost 模型的分数。我从一个具有密集连接层的相对较浅的三层 NN 开始，对隐藏层使用 relu 激活函数，对输出层使用线性激活函数(因为它正用于回归任务)。损失函数是均方误差(同样，因为这是用于回归)。

这是我的代码:

这是总结和想象:

![](img/2cf8fd70e1612f3ca1fb110fb3f7095e.png)

为了在评估多种方法时节省时间，我构建了一个方便的函数来打印测试集和训练集的 MSE 和 r 平方结果，并为测试集和训练集生成每个时期的损失线图以及预测值与实际值的散点图:

结果如下:

```
Training MSE: 0.0331
Validation MSE: 0.2163

Training r2: 0.9438
Validation r2: 0.6292
```

![](img/ad643885e95df2a4935fa7c5d603e408.png)![](img/84b0e1e1ec8907487ce2bfd42571a892.png)

与 XGBoost 模型相比，神经网络的性能更差。过度拟合似乎也是一个问题，从训练和测试 MSE 和 r 平方结果之间的差异，以及线图中训练和测试损失之间的差异，以及散点图中值更接近线的事实可以看出。

然后，我迭代了该模型的各种其他版本，以尝试消除过度拟合并提高准确性。尽管精确度有所不同，但其他版本都消除了过度拟合。我尝试的调整是:

*   添加第四层和第五层——第四层提高了精确度，但第五层没有帮助。
*   使用 L1 正则化——这被证明是对精确度的最大提升。
*   在 30%和 50%的辍学率下使用辍学正规化——50%被证明是一个可怕的想法，并显著增加了 MSE。30%表现更好，但不如 L1 正则化。
*   使用随机梯度下降(SGD)优化器而不是 Adam——这表现稍差。
*   改变批量大小——这没有太大的区别。
*   为更多的时期训练——这对一些模型有一点帮助，但大多数模型无论如何都相当快地最小化了损失函数。
*   删除大部分评论评级列——一个类别中的高评论评级与其他类别高度相关，因此我尝试删除除总体评级之外的所有评论评级。然后，我使用这个新的截断数据集来训练之前性能最高的模型架构(使用 L1 正则化和 Adam 优化器)。其性能基本相同，但少了 18 列，因此在选择将哪个模型投入生产时，它将是首选模型，因为它需要的数据更少，计算成本也更低。
*   使用纬度和经度而不是区——同样，这个调整后的数据集与我迄今为止提出的最佳模型架构一起使用。这个表现稍差。
*   用`MinMaxScaler()`代替`StandardScaler()`。这也表现的略差。

最后，最好的神经网络是具有 L1 正则化和 Adam 优化器的四层模型，去掉了额外的审查列:

![](img/85a30f2261c52762a7bc417c41abc511.png)

My best performing neural network architecture

结果:

```
Training MSE: 0.1708
Validation MSE: 0.1689

Training r2: 0.7096
Validation r2: 0.7105
```

![](img/4fb1d659c7975b7327706c83f270921c.png)![](img/5ca037755eba1f3262127cfe52e7eff6.png)

I still haven’t gotten to the bottom of why the NN is unable to predict values for the log-transformed price lower than about 3.1, but I’m pretty sure it’s something to do with the use of regularization

然而，即使是这种模型架构的性能也不如 XGBoost 模型。总的来说，XGBoost 模型是首选模型，因为它的性能比最好的神经网络稍好，并且计算成本更低。通过超参数调整，它可能会得到进一步的改进。

# 结论

这是深度学习对于预测来说根本不必要的情况之一，机器学习模型表现得一样好。

然而，即使在表现最好的模型中，该模型也只能解释 73%的价格变化。剩下的 27%可能由数据中不存在的特征组成。这种无法解释的差异很大一部分可能是由于列表照片的变化造成的。Airbnb 上的房产照片在鼓励客人预订方面非常重要，因此预计也会对价格产生重大影响——更好的照片(主要是质量更好的房产和家具，但也包括质量更好的摄影)等于更高的价格。

## 未来工作的潜在方向

*   找到将图像质量纳入模型的方法，例如通过使用卷积神经网络的输出来评估图像质量，作为定价模型的输入。
*   使用质量更好/更准确的数据，包括每晚支付的实际平均价格。
*   包括更广泛的地理区域，例如英国的其他地方或世界上的其他主要城市。
*   用列表描述和/或评论的自然语言处理(NLP)来增强模型，例如用于情感分析或寻找关键词。
*   除了预测基价之外，还可以创建一个序列模型，使用季节性和入住率数据来计算每日价格，这将允许创建实际定价软件。
*   通过删除当时不为人知的功能，例如其他费用、可用性和评论，更具体地针对新房源定制模型，以帮助主办方设定新房产的价格。

我希望你觉得这篇文章有趣和/或有帮助。感谢阅读！