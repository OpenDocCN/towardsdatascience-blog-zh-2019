<html>
<head>
<title>An Overview of Python’s Datatable package</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python 的数据表包概述</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/an-overview-of-pythons-datatable-package-5d3a97394ee9?source=collection_archive---------2-----------------------#2019-06-01">https://towardsdatascience.com/an-overview-of-pythons-datatable-package-5d3a97394ee9?source=collection_archive---------2-----------------------#2019-06-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0144" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">用于高效多线程数据处理的 Python 库，支持内存不足的数据集。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/3aef4d6ba5743bef8df130be88ad2527.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*puMQx9zbEaXCmwFN"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Photo by <a class="ae ky" href="https://unsplash.com/@followhansi?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Johannes Groll</a> on <a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><blockquote class="kz"><p id="e1e8" class="la lb it bd lc ld le lf lg lh li lj dk translated"><strong class="ak"/></p></blockquote><p id="e65c" class="pw-post-body-paragraph ll lm it ln b lo lp ju lq lr ls jx lt lu lv lw lx ly lz ma mb mc md me mf lj im bi translated">如果你是一个 R 用户，很可能你已经在使用<code class="fe mg mh mi mj b">data.table</code>包了。<code class="fe mg mh mi mj b"><a class="ae ky" href="https://cran.r-project.org/web/packages/data.table/data.table.pdf" rel="noopener ugc nofollow" target="_blank">Data.table</a></code>是 R 中<code class="fe mg mh mi mj b"><a class="ae ky" href="https://www.rdocumentation.org/packages/base/versions/3.6.0/topics/data.frame" rel="noopener ugc nofollow" target="_blank">data.frame</a></code>包的扩展，也是 R 用户快速聚合大数据(包括 100GB 内存)的首选包。</p><p id="5527" class="pw-post-body-paragraph ll lm it ln b lo mk ju lq lr ml jx lt lu mm lw lx ly mn ma mb mc mo me mf lj im bi translated">R 的<code class="fe mg mh mi mj b">data.table</code>包是一个非常通用和高性能的包，因为它易于使用，方便和编程速度。这是 R 社区中一个相当著名的软件包，每月下载量超过 40 万次，几乎有 650 个 CRAN 和 Bioconductor 软件包使用它(<a class="ae ky" href="https://github.com/Rdatatable/data.table/wiki" rel="noopener ugc nofollow" target="_blank"> source </a>)。</p><p id="9d7a" class="pw-post-body-paragraph ll lm it ln b lo mk ju lq lr ml jx lt lu mm lw lx ly mn ma mb mc mo me mf lj im bi translated">那么，这对 Python 用户有什么好处呢？好消息是,<code class="fe mg mh mi mj b">data.table</code>包也有一个 Python 对应物，叫做<code class="fe mg mh mi mj b">datatable </code>,它明确关注大数据支持、高性能、内存和内存外数据集以及多线程算法。在某种程度上，可以称之为<a class="ae ky" href="https://github.com/Rdatatable/data.table" rel="noopener ugc nofollow" target="_blank"><strong class="ln iu"><em class="mp">data . table</em></strong></a><strong class="ln iu"><em class="mp">的</em> </strong>弟弟妹妹。</p></div><div class="ab cl mq mr hx ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="im in io ip iq"><h1 id="2825" class="mx my it bd mz na nb nc nd ne nf ng nh jz ni ka nj kc nk kd nl kf nm kg nn no bi translated">数据表</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><a href="https://datatable.readthedocs.io/en/latest/?badge=latest"><div class="gh gi np"><img src="../Images/9a5dd99815115e365e5e143835faea03.png" data-original-src="https://miro.medium.com/v2/resize:fit:892/format:webp/0*w7dsjAY9CKNY7owL.png"/></div></a></figure><p id="d57e" class="pw-post-body-paragraph ll lm it ln b lo mk ju lq lr ml jx lt lu mm lw lx ly mn ma mb mc mo me mf lj im bi translated">现代机器学习应用程序需要处理海量数据，并生成多种特征。为了更准确地构建模型，这是必要的。Python 的<code class="fe mg mh mi mj b">datatable</code>模块就是为了解决这个问题而创建的。它是一个工具包，用于在单节点机器上以最大可能的速度执行大数据(高达 100GB)操作。datatable 的开发由<a class="ae ky" href="https://www.h2o.ai/" rel="noopener ugc nofollow" target="_blank"> H2O.ai </a>赞助，<code class="fe mg mh mi mj b">datatable</code>的第一个用户是<a class="ae ky" href="https://www.h2o.ai/driverless-ai/" rel="noopener ugc nofollow" target="_blank"> Driverless.ai </a>。</p><p id="84c6" class="pw-post-body-paragraph ll lm it ln b lo mk ju lq lr ml jx lt lu mm lw lx ly mn ma mb mc mo me mf lj im bi translated">该工具包与<a class="ae ky" href="https://github.com/pandas-dev/pandas" rel="noopener ugc nofollow" target="_blank">熊猫</a>非常相似，但更侧重于速度和大数据支持。<em class="mp"> </em> Python 的<em class="mp"> </em> <code class="fe mg mh mi mj b">datatable</code>也努力实现良好的用户体验，有用的错误消息，强大的 API。在本文中，我们将了解如何使用 datatable，以及它在处理大型数据集时如何优于 pandas。</p></div><div class="ab cl mq mr hx ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="im in io ip iq"><h1 id="a406" class="mx my it bd mz na nb nc nd ne nf ng nh jz ni ka nj kc nk kd nl kf nm kg nn no bi translated">装置</h1><p id="fe9b" class="pw-post-body-paragraph ll lm it ln b lo nq ju lq lr nr jx lt lu ns lw lx ly nt ma mb mc nu me mf lj im bi translated">在 MacOS 上，可以使用 pip 轻松安装 datatable:</p><pre class="kj kk kl km gt nv mj nw nx aw ny bi"><span id="d971" class="nz my it mj b gy oa ob l oc od">pip install datatable</span></pre><p id="2da3" class="pw-post-body-paragraph ll lm it ln b lo mk ju lq lr ml jx lt lu mm lw lx ly mn ma mb mc mo me mf lj im bi translated">在 Linux 上，安装通过二进制发行版实现，如下所示:</p><pre class="kj kk kl km gt nv mj nw nx aw ny bi"><span id="d790" class="nz my it mj b gy oa ob l oc od"># If you have Python 3.5<br/>pip install <a class="ae ky" href="https://s3.amazonaws.com/h2o-release/datatable/stable/datatable-0.8.0/datatable-0.8.0-cp35-cp35m-linux_x86_64.whl" rel="noopener ugc nofollow" target="_blank">https://s3.amazonaws.com/h2o-release/datatable/stable/datatable-0.8.0/datatable-0.8.0-cp35-cp35m-linux_x86_64.whl</a></span><span id="f124" class="nz my it mj b gy oe ob l oc od"># If you have Python 3.6<br/>pip install <a class="ae ky" href="https://s3.amazonaws.com/h2o-release/datatable/stable/datatable-0.8.0/datatable-0.8.0-cp36-cp36m-linux_x86_64.whl" rel="noopener ugc nofollow" target="_blank">https://s3.amazonaws.com/h2o-release/datatable/stable/datatable-0.8.0/datatable-0.8.0-cp36-cp36m-linux_x86_64.whl</a></span></pre><p id="b877" class="pw-post-body-paragraph ll lm it ln b lo mk ju lq lr ml jx lt lu mm lw lx ly mn ma mb mc mo me mf lj im bi translated"><em class="mp">目前，datatable 不能在 Windows 上运行，但也在努力增加对 Windows 的支持。</em></p><p id="d2a6" class="pw-post-body-paragraph ll lm it ln b lo mk ju lq lr ml jx lt lu mm lw lx ly mn ma mb mc mo me mf lj im bi translated">更多信息参见<a class="ae ky" href="https://datatable.readthedocs.io/en/latest/install.html" rel="noopener ugc nofollow" target="_blank">构建说明</a>。</p></div><div class="ab cl mq mr hx ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="im in io ip iq"><p id="2602" class="pw-post-body-paragraph ll lm it ln b lo mk ju lq lr ml jx lt lu mm lw lx ly mn ma mb mc mo me mf lj im bi translated">这篇文章的代码可以从相关的<a class="ae ky" href="https://github.com/parulnith/An-Overview-of-Python-s-Datatable-package" rel="noopener ugc nofollow" target="_blank"> Github 库</a>中获得，或者可以通过点击下面的图片在我的文件夹中查看。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><a href="https://mybinder.org/v2/gh/parulnith/An-Overview-of-Python-s-Datatable-package/master?filepath=An%20Overview%20of%20Python's%20Datatable%20package.ipynb"><div class="gh gi of"><img src="../Images/e461d679b57313eea1aa05abe1a1e75a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*diXEGUjFEsKvBrHdiB2htA.png"/></div></a></figure></div><div class="ab cl mq mr hx ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="im in io ip iq"><h1 id="3ec0" class="mx my it bd mz na nb nc nd ne nf ng nh jz ni ka nj kc nk kd nl kf nm kg nn no bi translated">读取数据</h1><p id="696d" class="pw-post-body-paragraph ll lm it ln b lo nq ju lq lr nr jx lt lu ns lw lx ly nt ma mb mc nu me mf lj im bi translated">正在使用的数据集取自 Kaggle，属于<a class="ae ky" href="https://www.kaggle.com/wendykan/lending-club-loan-data#loan.csv" rel="noopener ugc nofollow" target="_blank"> <em class="mp"> Lending Club 贷款数据集</em> </a> <em class="mp">。</em>该数据集由 2007 年至 2015 年发放的所有贷款的完整贷款数据组成，包括当前贷款状态(当前、逾期、完全支付等。)和最新付款信息。该文件由<strong class="ln iu">226 万行</strong>和<strong class="ln iu"> 145 列</strong>组成。数据大小非常适合展示数据表库的功能。</p><pre class="kj kk kl km gt nv mj nw nx aw ny bi"><span id="4646" class="nz my it mj b gy oa ob l oc od"># Importing necessary Libraries</span><span id="49c9" class="nz my it mj b gy oe ob l oc od">import numpy as np<br/>import pandas as pd<br/>import datatable as dt</span></pre><p id="25fd" class="pw-post-body-paragraph ll lm it ln b lo mk ju lq lr ml jx lt lu mm lw lx ly mn ma mb mc mo me mf lj im bi translated">让我们将数据加载到<code class="fe mg mh mi mj b">Frame</code>对象中。数据表中的基本分析单位是一个<code class="fe mg mh mi mj b">Frame</code>。这与 pandas DataFrame 或 SQL 表的概念是一样的:数据排列在具有行和列的二维数组中。</p><p id="1182" class="pw-post-body-paragraph ll lm it ln b lo mk ju lq lr ml jx lt lu mm lw lx ly mn ma mb mc mo me mf lj im bi translated"><strong class="ln iu">带数据表</strong></p><pre class="kj kk kl km gt nv mj nw nx aw ny bi"><span id="47c8" class="nz my it mj b gy oa ob l oc od">%%time<br/>datatable_df = dt.fread("data.csv")<br/>____________________________________________________________________</span><span id="8d4a" class="nz my it mj b gy oe ob l oc od">CPU times: user 30 s, sys: 3.39 s, total: 33.4 s                                <br/>Wall time: 23.6 s</span></pre><p id="06ff" class="pw-post-body-paragraph ll lm it ln b lo mk ju lq lr ml jx lt lu mm lw lx ly mn ma mb mc mo me mf lj im bi translated">上面的<code class="fe mg mh mi mj b">fread()</code>功能既强大又极快。它可以自动检测和解析大多数文本文件的参数，从。压缩档案或网址，阅读 Excel 文件，等等。</p><p id="34f5" class="pw-post-body-paragraph ll lm it ln b lo mk ju lq lr ml jx lt lu mm lw lx ly mn ma mb mc mo me mf lj im bi translated">此外，数据表解析器:</p><ul class=""><li id="9ac9" class="og oh it ln b lo mk lr ml lu oi ly oj mc ok lj ol om on oo bi translated">可以自动检测分隔符、标题、列类型、引用规则等。</li><li id="6b51" class="og oh it ln b lo op lr oq lu or ly os mc ot lj ol om on oo bi translated">可以从多个来源读取数据，包括文件、URL、shell、原始文本、归档和 glob。</li><li id="5c6a" class="og oh it ln b lo op lr oq lu or ly os mc ot lj ol om on oo bi translated">提供多线程文件读取，实现最高速度</li><li id="0fd5" class="og oh it ln b lo op lr oq lu or ly os mc ot lj ol om on oo bi translated">读取大文件时包括进度指示器</li><li id="bc9f" class="og oh it ln b lo op lr oq lu or ly os mc ot lj ol om on oo bi translated">可以读取符合和不符合<a class="ae ky" href="https://tools.ietf.org/html/rfc4180" rel="noopener ugc nofollow" target="_blank"> RFC4180 </a>的文件。</li></ul><p id="c012" class="pw-post-body-paragraph ll lm it ln b lo mk ju lq lr ml jx lt lu mm lw lx ly mn ma mb mc mo me mf lj im bi translated"><strong class="ln iu">与熊猫</strong></p><p id="901f" class="pw-post-body-paragraph ll lm it ln b lo mk ju lq lr ml jx lt lu mm lw lx ly mn ma mb mc mo me mf lj im bi translated">现在，让我们计算一下熊猫读同一个文件所用的时间。</p><pre class="kj kk kl km gt nv mj nw nx aw ny bi"><span id="05d9" class="nz my it mj b gy oa ob l oc od">%%time<br/>pandas_df= pd.read_csv("data.csv")<br/>___________________________________________________________</span><span id="2cb4" class="nz my it mj b gy oe ob l oc od">CPU times: user 47.5 s, sys: 12.1 s, total: 59.6 s<br/>Wall time: 1min 4s</span></pre><p id="c6cf" class="pw-post-body-paragraph ll lm it ln b lo mk ju lq lr ml jx lt lu mm lw lx ly mn ma mb mc mo me mf lj im bi translated">结果表明，在读取大型数据集时，datatable 明显优于 pandas。熊猫需要一分多钟，而数据表只需要几秒钟。</p></div><div class="ab cl mq mr hx ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="im in io ip iq"><h1 id="c646" class="mx my it bd mz na nb nc nd ne nf ng nh jz ni ka nj kc nk kd nl kf nm kg nn no bi translated">帧转换</h1><p id="cbf2" class="pw-post-body-paragraph ll lm it ln b lo nq ju lq lr nr jx lt lu ns lw lx ly nt ma mb mc nu me mf lj im bi translated">现有帧也可以转换为 numpy 或 pandas 数据帧，如下所示:</p><pre class="kj kk kl km gt nv mj nw nx aw ny bi"><span id="47f1" class="nz my it mj b gy oa ob l oc od">numpy_df = datatable_df.to_numpy()<br/>pandas_df = datatable_df.to_pandas()</span></pre><p id="6168" class="pw-post-body-paragraph ll lm it ln b lo mk ju lq lr ml jx lt lu mm lw lx ly mn ma mb mc mo me mf lj im bi translated">让我们将现有的帧转换成熊猫数据帧对象，并比较所用的时间。</p><pre class="kj kk kl km gt nv mj nw nx aw ny bi"><span id="a29a" class="nz my it mj b gy oa ob l oc od">%%time<br/>datatable_pandas = datatable_df.to_pandas()<br/>___________________________________________________________________<br/>CPU times: user 17.1 s, sys: 4 s, total: 21.1 s<br/>Wall time: 21.4 s</span></pre><p id="0fab" class="pw-post-body-paragraph ll lm it ln b lo mk ju lq lr ml jx lt lu mm lw lx ly mn ma mb mc mo me mf lj im bi translated">似乎将文件作为数据表帧读取，然后将其转换为 pandas 数据帧比读取 pandas 数据帧花费的时间要少。<strong class="ln iu"> <em class="mp">因此，通过 datatable 导入一个大的数据文件，然后将其转换成 pandas dataframe 可能是一个好主意。</em>T9】</strong></p><pre class="kj kk kl km gt nv mj nw nx aw ny bi"><span id="c752" class="nz my it mj b gy oa ob l oc od">type(datatable_pandas)<br/>___________________________________________________________________<br/>pandas.core.frame.DataFrame</span></pre></div><div class="ab cl mq mr hx ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="im in io ip iq"><h1 id="f776" class="mx my it bd mz na nb nc nd ne nf ng nh jz ni ka nj kc nk kd nl kf nm kg nn no bi translated">基本框架属性</h1><p id="1a04" class="pw-post-body-paragraph ll lm it ln b lo nq ju lq lr nr jx lt lu ns lw lx ly nt ma mb mc nu me mf lj im bi translated">让我们看看数据表框架的一些基本属性，它们与熊猫的属性相似:</p><pre class="kj kk kl km gt nv mj nw nx aw ny bi"><span id="30f4" class="nz my it mj b gy oa ob l oc od">print(datatable_df.shape)       # (nrows, ncols)<br/>print(datatable_df.names[:5])   # top 5 column names<br/>print(datatable_df.stypes[:5])  # column types(top 5)<br/>______________________________________________________________</span><span id="6595" class="nz my it mj b gy oe ob l oc od">(2260668, 145)</span><span id="0f76" class="nz my it mj b gy oe ob l oc od">('id', 'member_id', 'loan_amnt', 'funded_amnt', 'funded_amnt_inv')</span><span id="51e9" class="nz my it mj b gy oe ob l oc od">(stype.bool8, stype.bool8, stype.int32, stype.int32, stype.float64)</span></pre><p id="6d9b" class="pw-post-body-paragraph ll lm it ln b lo mk ju lq lr ml jx lt lu mm lw lx ly mn ma mb mc mo me mf lj im bi translated">我们也可以使用<code class="fe mg mh mi mj b">head</code>命令输出前‘n’行。</p><pre class="kj kk kl km gt nv mj nw nx aw ny bi"><span id="3fa4" class="nz my it mj b gy oa ob l oc od">datatable_df.head(10)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/f668266eb48005d57459dab831014a9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1342/format:webp/1*hgMH-aKTyU7UF43rf6n_Zg.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">A glimpse of the first 10 rows of the datatable frame</figcaption></figure><p id="88c9" class="pw-post-body-paragraph ll lm it ln b lo mk ju lq lr ml jx lt lu mm lw lx ly mn ma mb mc mo me mf lj im bi translated">颜色表示数据类型，其中<strong class="ln iu">红色</strong>表示字符串，<strong class="ln iu">绿色</strong>表示整型，<strong class="ln iu">蓝色</strong>表示浮点型。</p></div><div class="ab cl mq mr hx ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="im in io ip iq"><h1 id="c3d1" class="mx my it bd mz na nb nc nd ne nf ng nh jz ni ka nj kc nk kd nl kf nm kg nn no bi translated">汇总统计数据</h1><p id="a8d9" class="pw-post-body-paragraph ll lm it ln b lo nq ju lq lr nr jx lt lu ns lw lx ly nt ma mb mc nu me mf lj im bi translated">在 pandas 中计算汇总统计数据是一个消耗内存的过程，但现在有了 datatable 就不会了。我们可以使用 datatable 计算以下每列汇总统计信息:</p><pre class="kj kk kl km gt nv mj nw nx aw ny bi"><span id="7636" class="nz my it mj b gy oa ob l oc od">datatable_df.sum()      datatable_df.nunique()<br/>datatable_df.sd()       datatable_df.max()<br/>datatable_df.mode()     datatable_df.min()<br/>datatable_df.nmodal()   datatable_df.mean()</span></pre><p id="8970" class="pw-post-body-paragraph ll lm it ln b lo mk ju lq lr ml jx lt lu mm lw lx ly mn ma mb mc mo me mf lj im bi translated">让我们使用 datatable 和 pandas 来计算这些列的平均值。</p><p id="8e44" class="pw-post-body-paragraph ll lm it ln b lo mk ju lq lr ml jx lt lu mm lw lx ly mn ma mb mc mo me mf lj im bi translated"><strong class="ln iu">带数据表</strong></p><pre class="kj kk kl km gt nv mj nw nx aw ny bi"><span id="6e4a" class="nz my it mj b gy oa ob l oc od">%%time<br/>datatable_df.mean()<br/>_______________________________________________________________<br/>CPU times: user 5.11 s, sys: 51.8 ms, total: 5.16 s<br/>Wall time: 1.43 s</span></pre><p id="1714" class="pw-post-body-paragraph ll lm it ln b lo mk ju lq lr ml jx lt lu mm lw lx ly mn ma mb mc mo me mf lj im bi translated">与熊猫在一起</p><pre class="kj kk kl km gt nv mj nw nx aw ny bi"><span id="d106" class="nz my it mj b gy oa ob l oc od">pandas_df.mean()<br/>__________________________________________________________________<br/>Throws memory error.</span></pre><p id="d11c" class="pw-post-body-paragraph ll lm it ln b lo mk ju lq lr ml jx lt lu mm lw lx ly mn ma mb mc mo me mf lj im bi translated">上述命令无法在 pandas 中完成，因为它开始抛出内存错误。</p></div><div class="ab cl mq mr hx ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="im in io ip iq"><h1 id="d7e0" class="mx my it bd mz na nb nc nd ne nf ng nh jz ni ka nj kc nk kd nl kf nm kg nn no bi translated">数据操作</h1><p id="63b2" class="pw-post-body-paragraph ll lm it ln b lo nq ju lq lr nr jx lt lu ns lw lx ly nt ma mb mc nu me mf lj im bi translated">像 dataframes 这样的数据表是列数据结构。在 datatable 中，所有这些操作的主要载体是受传统矩阵索引启发的方括号符号<strong class="ln iu">和更多功能。</strong></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ov"><img src="../Images/c898da6a21f652502fb4fb1d62bdf21b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PI7NS0fRaqmY2rXnrmL_Lg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">datatable’s <strong class="bd ow">square-bracket notation</strong></figcaption></figure><p id="938f" class="pw-post-body-paragraph ll lm it ln b lo mk ju lq lr ml jx lt lu mm lw lx ly mn ma mb mc mo me mf lj im bi translated">同样的 DT[i，j]符号在数学中用于索引矩阵，在 C/C++，在 R，在 pandas，在 numpy 等等。让我们看看如何使用 datatable 执行常见的数据操作活动:</p><h2 id="9f56" class="nz my it bd mz ox oy dn nd oz pa dp nh lu pb pc nj ly pd pe nl mc pf pg nn ph bi translated">#选择行/列的子集</h2><p id="016f" class="pw-post-body-paragraph ll lm it ln b lo nq ju lq lr nr jx lt lu ns lw lx ly nt ma mb mc nu me mf lj im bi translated">下面的代码从数据集中选择所有行和<code class="fe mg mh mi mj b">funded_amnt</code>列。</p><pre class="kj kk kl km gt nv mj nw nx aw ny bi"><span id="dc8d" class="nz my it mj b gy oa ob l oc od">datatable_df[:,'funded_amnt']</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pi"><img src="../Images/c02540c996dae27575b728610abbf05d.png" data-original-src="https://miro.medium.com/v2/resize:fit:298/format:webp/1*SZlPQlYJTwYLph21H3wSFQ.png"/></div></figure><p id="f773" class="pw-post-body-paragraph ll lm it ln b lo mk ju lq lr ml jx lt lu mm lw lx ly mn ma mb mc mo me mf lj im bi translated">下面是我们如何选择前 5 行和前 3 列</p><pre class="kj kk kl km gt nv mj nw nx aw ny bi"><span id="f78d" class="nz my it mj b gy oa ob l oc od">datatable_df[:5,:3]</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pj"><img src="../Images/d7b0b6c7449908f222dcd78c18848b19.png" data-original-src="https://miro.medium.com/v2/resize:fit:426/format:webp/1*k5cpYdqWb0ZYprBZIlmoYw.png"/></div></figure><h2 id="7a1a" class="nz my it bd mz ox oy dn nd oz pa dp nh lu pb pc nj ly pd pe nl mc pf pg nn ph bi translated">#对框架进行排序</h2><p id="c68e" class="pw-post-body-paragraph ll lm it ln b lo nq ju lq lr nr jx lt lu ns lw lx ly nt ma mb mc nu me mf lj im bi translated"><strong class="ln iu">带数据表</strong></p><p id="cc30" class="pw-post-body-paragraph ll lm it ln b lo mk ju lq lr ml jx lt lu mm lw lx ly mn ma mb mc mo me mf lj im bi translated">按特定列对帧进行排序可以通过<code class="fe mg mh mi mj b">datatable</code>完成，如下所示:</p><pre class="kj kk kl km gt nv mj nw nx aw ny bi"><span id="abad" class="nz my it mj b gy oa ob l oc od">%%time<br/>datatable_df.sort('funded_amnt_inv')<br/>_________________________________________________________________<br/>CPU times: user 534 ms, sys: 67.9 ms, total: 602 ms<br/>Wall time: 179 ms</span></pre><p id="3f60" class="pw-post-body-paragraph ll lm it ln b lo mk ju lq lr ml jx lt lu mm lw lx ly mn ma mb mc mo me mf lj im bi translated"><strong class="ln iu">与熊猫:</strong></p><pre class="kj kk kl km gt nv mj nw nx aw ny bi"><span id="623e" class="nz my it mj b gy oa ob l oc od">%%time<br/>pandas_df.sort_values(by = 'funded_amnt_inv')<br/>___________________________________________________________________<br/>CPU times: user 8.76 s, sys: 2.87 s, total: 11.6 s<br/>Wall time: 12.4 s</span></pre><p id="5f21" class="pw-post-body-paragraph ll lm it ln b lo mk ju lq lr ml jx lt lu mm lw lx ly mn ma mb mc mo me mf lj im bi translated">请注意“可约会”和“熊猫”之间的巨大时差。</p><h2 id="29cc" class="nz my it bd mz ox oy dn nd oz pa dp nh lu pb pc nj ly pd pe nl mc pf pg nn ph bi translated">#删除行/列</h2><p id="ef51" class="pw-post-body-paragraph ll lm it ln b lo nq ju lq lr nr jx lt lu ns lw lx ly nt ma mb mc nu me mf lj im bi translated">下面是我们如何删除名为<code class="fe mg mh mi mj b">member_id</code>的列:</p><pre class="kj kk kl km gt nv mj nw nx aw ny bi"><span id="f9b6" class="nz my it mj b gy oa ob l oc od">del datatable_df[:, 'member_id']</span></pre><h2 id="158b" class="nz my it bd mz ox oy dn nd oz pa dp nh lu pb pc nj ly pd pe nl mc pf pg nn ph bi translated">#分组依据</h2><p id="af26" class="pw-post-body-paragraph ll lm it ln b lo nq ju lq lr nr jx lt lu ns lw lx ly nt ma mb mc nu me mf lj im bi translated">就像在 pandas 中一样，datatable 也有 groupby 功能。让我们看看如何获得按<code class="fe mg mh mi mj b">grade</code>列分组的<code class="fe mg mh mi mj b">funded_amount</code>列的平均值。</p><p id="c044" class="pw-post-body-paragraph ll lm it ln b lo mk ju lq lr ml jx lt lu mm lw lx ly mn ma mb mc mo me mf lj im bi translated"><strong class="ln iu">带数据表</strong></p><pre class="kj kk kl km gt nv mj nw nx aw ny bi"><span id="595d" class="nz my it mj b gy oa ob l oc od">%%time<br/>for i in range(100):<br/>    datatable_df[:, dt.sum(dt.f.funded_amnt), dt.by(dt.f.grade)]<br/>____________________________________________________________________<br/>CPU times: user 6.41 s, sys: 1.34 s, total: 7.76 s<br/>Wall time: 2.42 s</span></pre><p id="6138" class="pw-post-body-paragraph ll lm it ln b lo mk ju lq lr ml jx lt lu mm lw lx ly mn ma mb mc mo me mf lj im bi translated"><strong class="ln iu">与熊猫</strong></p><pre class="kj kk kl km gt nv mj nw nx aw ny bi"><span id="a7db" class="nz my it mj b gy oa ob l oc od">%%time<br/>for i in range(100):<br/>    pandas_df.groupby("grade")["funded_amnt"].sum()<br/>____________________________________________________________________<br/>CPU times: user 12.9 s, sys: 859 ms, total: 13.7 s<br/>Wall time: 13.9 s</span></pre><p id="6f2f" class="pw-post-body-paragraph ll lm it ln b lo mk ju lq lr ml jx lt lu mm lw lx ly mn ma mb mc mo me mf lj im bi translated"><strong class="ln iu">有什么用。f 代表什么？</strong></p><p id="542f" class="pw-post-body-paragraph ll lm it ln b lo mk ju lq lr ml jx lt lu mm lw lx ly mn ma mb mc mo me mf lj im bi translated"><code class="fe mg mh mi mj b">f </code>代表<code class="fe mg mh mi mj b">frame proxy</code>，提供了一种简单的方法来引用我们当前操作的框架。在我们的例子中，<code class="fe mg mh mi mj b">dt.f</code>仅仅代表<code class="fe mg mh mi mj b">dt_df</code>。</p><h2 id="89e2" class="nz my it bd mz ox oy dn nd oz pa dp nh lu pb pc nj ly pd pe nl mc pf pg nn ph bi translated">#筛选行</h2><p id="ced8" class="pw-post-body-paragraph ll lm it ln b lo nq ju lq lr nr jx lt lu ns lw lx ly nt ma mb mc nu me mf lj im bi translated">过滤行的语法与 GroupBy 非常相似。让我们过滤掉那些<code class="fe mg mh mi mj b">loan_amnt</code>的值大于<code class="fe mg mh mi mj b">funded_amnt</code>的<code class="fe mg mh mi mj b">loan_amnt</code>行。</p><pre class="kj kk kl km gt nv mj nw nx aw ny bi"><span id="1fcc" class="nz my it mj b gy oa ob l oc od">datatable_df[dt.f.loan_amnt&gt;dt.f.funded_amnt,"loan_amnt"]</span></pre></div><div class="ab cl mq mr hx ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="im in io ip iq"><h1 id="d9f7" class="mx my it bd mz na nb nc nd ne nf ng nh jz ni ka nj kc nk kd nl kf nm kg nn no bi translated">保存帧</h1><p id="f8e6" class="pw-post-body-paragraph ll lm it ln b lo nq ju lq lr nr jx lt lu ns lw lx ly nt ma mb mc nu me mf lj im bi translated">也可以将帧的内容写入一个<code class="fe mg mh mi mj b">csv</code>文件，以便将来使用。</p><pre class="kj kk kl km gt nv mj nw nx aw ny bi"><span id="8e7f" class="nz my it mj b gy oa ob l oc od">datatable_df.to_csv('output.csv')</span></pre><p id="076c" class="pw-post-body-paragraph ll lm it ln b lo mk ju lq lr ml jx lt lu mm lw lx ly mn ma mb mc mo me mf lj im bi translated">更多数据操作功能，请参见<a class="ae ky" href="https://datatable.readthedocs.io/en/latest/using-datatable.html" rel="noopener ugc nofollow" target="_blank"> <strong class="ln iu">文档</strong> </a>页。</p></div><div class="ab cl mq mr hx ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="im in io ip iq"><h1 id="ea61" class="mx my it bd mz na nb nc nd ne nf ng nh jz ni ka nj kc nk kd nl kf nm kg nn no bi translated">结论</h1><p id="cacf" class="pw-post-body-paragraph ll lm it ln b lo nq ju lq lr nr jx lt lu ns lw lx ly nt ma mb mc nu me mf lj im bi translated">与默认的 pandas 相比，datatable 模块无疑加快了执行速度，这在处理大型数据集时无疑是一个福音。然而，数据表在功能上落后于熊猫。但由于 datatable 仍在积极开发中，我们可能会在未来看到该库的一些主要新增内容。</p></div><div class="ab cl mq mr hx ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="im in io ip iq"><h1 id="fe84" class="mx my it bd mz na nb nc nd ne nf ng nh jz ni ka nj kc nk kd nl kf nm kg nn no bi translated">参考</h1><ul class=""><li id="447f" class="og oh it ln b lo nq lr nr lu pk ly pl mc pm lj ol om on oo bi translated">r 的<a class="ae ky" href="https://github.com/Rdatatable/data.table/wiki" rel="noopener ugc nofollow" target="_blank">数据表</a></li><li id="4890" class="og oh it ln b lo op lr oq lu or ly os mc ot lj ol om on oo bi translated"><a class="ae ky" href="https://datatable.readthedocs.io/en/latest/index.html" rel="noopener ugc nofollow" target="_blank">数据表文档</a></li><li id="e924" class="og oh it ln b lo op lr oq lu or ly os mc ot lj ol om on oo bi translated"><a class="ae ky" href="https://www.kaggle.com/sudalairajkumar/getting-started-with-python-datatable" rel="noopener ugc nofollow" target="_blank">Python 数据表入门</a>:关于数据表使用的精彩 Kaggle 内核</li><li id="3c00" class="og oh it ln b lo op lr oq lu or ly os mc ot lj ol om on oo bi translated"><a class="ae ky" href="https://github.com/vopani/datatableton" rel="noopener ugc nofollow" target="_blank"/></li></ul></div></div>    
</body>
</html>