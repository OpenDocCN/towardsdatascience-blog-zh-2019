<html>
<head>
<title>Classifying Products as Banned Or Approved using Text Mining- Part II</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用文本挖掘将产品分类为禁止或批准-第二部分</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/classifying-products-as-banned-or-approved-using-text-mining-part-ii-1cdd9b7ebc6e?source=collection_archive---------20-----------------------#2019-04-25">https://towardsdatascience.com/classifying-products-as-banned-or-approved-using-text-mining-part-ii-1cdd9b7ebc6e?source=collection_archive---------20-----------------------#2019-04-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="fd54" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在这一部分，我们将解释如何优化<a class="ae ki" rel="noopener" target="_blank" href="/classifying-products-as-banned-or-approved-using-text-mining-5b48d2eb1544"> Part I </a>中已有的机器学习模型，以及使用 Flask 部署这个 ML 模型。</h2></div><figure class="kk kl km kn gt ko gh gi paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="gh gi kj"><img src="../Images/a29562fda23a3d14650fe03c934aff30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jbfAi9yVWv7J4FtdwSZnpw.png"/></div></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk">Connecting the dots -moving from M to L in Machine Learning</figcaption></figure><p id="9e4a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在本系列的前一篇文章中，我们已经讨论了这个业务问题，展示了如何使用 fastText 训练模型，以及如何根据诸如(<em class="lv">产品名称、产品描述和规格</em>)等信息对禁止或批准的产品进行分类。<strong class="lb iu">要在</strong><a class="ae ki" href="https://dir.indiamart.com/" rel="noopener ugc nofollow" target="_blank"><strong class="lb iu">Indiamart</strong></a><strong class="lb iu">的背景下理解一个产品，请参考这篇</strong> <a class="ae ki" rel="noopener" target="_blank" href="/classifying-products-as-banned-or-approved-using-text-mining-5b48d2eb1544"> <strong class="lb iu">文章</strong> </a> <strong class="lb iu">。</strong></p><h1 id="b496" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">从 85%提高到 98%,目标更高…..</h1><p id="774a" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">当我们将结果与人类审计员进行匹配时，上一篇文章中提到的模型的准确性是 85%。</p><p id="9f70" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了提高该模型的准确性，我们在训练该模型时加入了一些附加数据，并进行超参数调整。在机器学习中，更精确的训练数据给出更好的结果<em class="lv">(我们可以说对于机器来说，垃圾进就是垃圾出，反之亦然)。</em></p><h1 id="87a9" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated"><strong class="ak">超参数调谐:</strong></h1><p id="3a14" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">在 fastText 中，有一些调优参数<em class="lv">(像学习率(LR)、wordN-grams、character _ n grams(Minn)、迭代次数(epoch)等。)</em>可以在训练模型的同时对其进行优化以提高分类器的性能。这些调整参数因情况而异。</p><p id="093b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们的案例中，我们在训练模型时对这些超参数进行了多种排列和组合，然后从中选择了最佳的。使用下面的命令获得具有多种调整参数组合的模型。</p><pre class="kk kl km kn gt mt mu mv mw aw mx bi"><span id="5959" class="my lx it mu b gy mz na l nb nc">while read p; do while read q; do while read r; do while read s; do fasttext  supervised -input ~/Desktop/Banned_Model/train.txt -output ~/Desktop/Banned_Model/hypertuned/$p.$q.$r.$s -lr $p -minn $q -epoch $r -wordNgrams $s -thread 4 -loss hs -lrUpdateRate 100; done ; done</span></pre><p id="69c2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这个阶段，我们已经创建了超过 2k 个独特的模型。下一步是从中选出最好的一个。根据精确度、召回率和准确度选择最佳模型的测试命令如下:</p><pre class="kk kl km kn gt mt mu mv mw aw mx bi"><span id="d134" class="my lx it mu b gy mz na l nb nc">for b in ~/Desktop/Banned_Model/hypertuned/*.bin ;do ( echo Test results with $b &amp;&amp; fasttext test $b /home/Desktop/test\val.txt ); done &gt;&gt; /home/Desktop/banned_hyper_parameters_test.txt</span></pre><p id="936c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用这种方法，我们能够根据最合适的超参数组合选择最佳模型。这些超参数可能因不同的用例而异。</p><p id="a681" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">模型精度:</strong></p><p id="d04e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这个阶段，当我们将结果与人类审计员进行匹配时，该模型能够以 98%以上的准确率进行正确预测，并且我们已经完成了我们的机器学习模型，并将其保存为。“bin”文件。下一个目标是将这个机器学习模型投入生产。</p><h1 id="1856" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated"><strong class="ak">模型部署:让事情活起来</strong></h1><p id="1d66" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">这里的简单方法是调用 REST API 并从模型中获取预测。正如我们所知，有许多 web 开发框架是用 javascript、ASP.net、PHP 等编写的。但是在我们的例子中，我们已经使用 python 创建了我们的机器学习模型，并且我们正在 python 本身中寻找一个基于 web 的接口。在这里<a class="ae ki" href="http://flask.pocoo.org/" rel="noopener ugc nofollow" target="_blank">烧瓶</a>进入画面。</p><figure class="kk kl km kn gt ko gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/2bdab8d0cacfa604dd99b2131c9bde05.png" data-original-src="https://miro.medium.com/v2/resize:fit:626/format:webp/1*1nwAzh8UAQT3yeH8N7KX0g.png"/></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk">ML Model deployment using Flask</figcaption></figure><blockquote class="ne nf ng"><p id="2c65" class="kz la lv lb b lc ld ju le lf lg jx lh nh lj lk ll ni ln lo lp nj lr ls lt lu im bi translated"><strong class="lb iu">什么是烧瓶？</strong></p></blockquote><p id="73e7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Flask 是一个基于 python 的<strong class="lb iu">微框架</strong>，可以用来开发 web 应用、网站，部署 ML 模型相当容易。<strong class="lb iu">微框架</strong>烧瓶基于 Pocoo 项目 Werkzeug 和 Jinja2。Werkzeug 是一个用于 Web 服务器网关接口(WSGI)应用程序的工具包，并获得了<a class="ae ki" href="http://flask.pocoo.org/docs/1.0/license/" rel="noopener ugc nofollow" target="_blank"> BSD 许可</a>。在进行部署之前，我们需要下载 flask 和其他一些库。</p><pre class="kk kl km kn gt mt mu mv mw aw mx bi"><span id="29ce" class="my lx it mu b gy mz na l nb nc"><strong class="mu iu">pip install flask</strong></span></pre><p id="a33d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们创建一个文件夹<strong class="lb iu"> Flask_Deploy </strong>并将机器学习模型复制到其中。</p><pre class="kk kl km kn gt mt mu mv mw aw mx bi"><span id="5b00" class="my lx it mu b gy mz na l nb nc"><strong class="mu iu">mkdir Flask_Deploy</strong></span></pre><p id="dc28" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下一步是创建两个 python 脚本，一个用于处理数据预处理/清理，另一个用于获取基于文本输入预测结果的请求。</p><p id="12dc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">用 python 导入 flask。</p><blockquote class="ne nf ng"><p id="6d16" class="kz la lv lb b lc ld ju le lf lg jx lh nh lj lk ll ni ln lo lp nj lr ls lt lu im bi translated"><strong class="lb iu"> app =烧瓶。Flask(__name__) : </strong>创建 Flask 的实例</p><p id="9e51" class="kz la lv lb b lc ld ju le lf lg jx lh nh lj lk ll ni ln lo lp nj lr ls lt lu im bi translated"><strong class="lb iu">@ app . route("/predict "):</strong><em class="it">用于指定 flask app 在 web 上的路由。例如:http://0.0.0.0:5000/predict？msg =输入字符串。</em> <strong class="lb iu"> <em class="it">【预测与消息】这里的关键是</em> </strong> <em class="it">。</em></p></blockquote><p id="6d7b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要访问 URL(？msg =输入字符串)我们使用以下属性:</p><pre class="kk kl km kn gt mt mu mv mw aw mx bi"><span id="5eb4" class="my lx it mu b gy mz na l nb nc"><strong class="mu iu">Input = flask.request.args.get("msg")</strong></span></pre><blockquote class="ne nf ng"><p id="82cb" class="kz la lv lb b lc ld ju le lf lg jx lh nh lj lk ll ni ln lo lp nj lr ls lt lu im bi translated"><strong class="lb iu">flask . jasonify(data):</strong><em class="it">用于返回 JSON 格式的 python 字典。</em></p><p id="ead4" class="kz la lv lb b lc ld ju le lf lg jx lh nh lj lk ll ni ln lo lp nj lr ls lt lu im bi translated"><strong class="lb iu">app . run(host = 0 . 0 . 0 . 0)</strong><em class="it">:用于在主机地址上运行 flask app。在本例中，我们在本地主机上运行它。</em></p></blockquote><p id="3a8a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">创建 web 应用程序后，我们将获得一个指向 flask 端点的 URL。感谢 Shantanu Aggarwal  @阿洛克·库马尔在这么短的时间内帮助编写代码。为了处理数据预处理，我们创建了一个脚本 preprocess.py，并保存在保存 ML 模型文件的同一目录下(Flask_Deploy ),以便我们可以在需要时轻松调用它。</p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="nm nn l"/></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk">script to get requests and predict results.</figcaption></figure><p id="3b08" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我们的例子中，我们得到了许多不必要的数据，如特殊字符、超链接、一些停用词、重复词等。为了处理这些问题，我们根据我们的用例创建了下面的脚本，并将其保存为 preprocess.py</p><p id="b814" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">处理数据清理和预处理的脚本:</strong></p><figure class="kk kl km kn gt ko"><div class="bz fp l di"><div class="nm nn l"/></div><figcaption class="kv kw gj gh gi kx ky bd b be z dk">preprocess.py script</figcaption></figure><h1 id="bd74" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated"><strong class="ak">最后一轮:</strong></h1><pre class="kk kl km kn gt mt mu mv mw aw mx bi"><span id="7677" class="my lx it mu b gy mz na l nb nc"><strong class="mu iu">cd Flask_Deploy<br/>python3 flask_banned_model.py</strong></span></pre><p id="db47" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">部署模型后，我们能够检查预测、模型准确性、延迟以及模型的负载处理时间。我们还可以记录结果、数据输入、延迟等。按照我们的要求做成表格。</p><h1 id="389f" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated"><strong class="ak">结论:</strong></h1><p id="dbb6" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">任何机器学习模型的最终目标都是不需要太多麻烦就能投入使用。在投入了大量团队努力和辛勤工作后，最终部署了上述简单但有效的模型。此外，我们很高兴地提到，我们能够为上述模型实现大约 4 毫秒的显著延迟。我们正在对该模型进行全面测试，以发现任何问题，本系列的下一篇文章将分享该模型的性能，以及该模型在时间和金钱方面为我们带来的优化。</p><h1 id="2abb" class="lw lx it bd ly lz ma mb mc md me mf mg jz mh ka mi kc mj kd mk kf ml kg mm mn bi translated">当团队工作创造奇迹的时候！！</h1><p id="b3ec" class="pw-post-body-paragraph kz la it lb b lc mo ju le lf mp jx lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">这个模型是整个团队不断努力的成果。感谢@ <a class="nk nl ep" href="https://medium.com/u/47a096395dd5?source=post_page-----1cdd9b7ebc6e--------------------------------" rel="noopener" target="_blank">维克拉姆·瓦什尼</a>、<a class="nk nl ep" href="https://medium.com/u/f3022f1424ae?source=post_page-----1cdd9b7ebc6e--------------------------------" rel="noopener" target="_blank">苏尼尔·帕罗莉亚</a>发起项目、<a class="nk nl ep" href="https://medium.com/u/a9b6c476fde?source=post_page-----1cdd9b7ebc6e--------------------------------" rel="noopener" target="_blank">普拉奇·贾因</a>进行模型训练和超参数调优、<a class="nk nl ep" href="https://medium.com/u/7012b8be20c2?source=post_page-----1cdd9b7ebc6e--------------------------------" rel="noopener" target="_blank">帕拉德普·乔普拉</a>、@里蒂卡·阿加瓦尔确保对模型进行全面测试、@梅达·塔亚吉@安基塔·萨拉斯瓦特提供所有产品方面的知识@阿洛克·库马尔、@普内特·阿加瓦尔、<a class="nk nl ep" href="https://medium.com/u/ba9d2ef2623c?source=post_page-----1cdd9b7ebc6e--------------------------------" rel="noopener" target="_blank">尚塔努·阿加瓦尔</a>、@希普拉·古普塔、@阿布</p></div></div>    
</body>
</html>