<html>
<head>
<title>The Easy Way to Extend Pandas API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">扩展 Pandas API 的简单方法</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/ready-the-easy-way-to-extend-pandas-api-dcf4f6612615?source=collection_archive---------22-----------------------#2019-11-10">https://towardsdatascience.com/ready-the-easy-way-to-extend-pandas-api-dcf4f6612615?source=collection_archive---------22-----------------------#2019-11-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><h1 id="23ba" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">写出你自己的熊猫味道</h1><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/988a36b1fa852815db102c7e65097042.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BnWHZiVzJSOS8_VogfkyGg.jpeg"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk">Photo by <a class="ae le" href="https://unsplash.com/@zachr1992?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Zach Rowlandson</a> on <a class="ae le" href="https://unsplash.com/s/photos/pandas-food?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="7969" class="pw-post-body-paragraph lf lg it lh b li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">在本文中，您将通过使用<a class="ae le" href="https://github.com/Zsailer/pandas_flavor" rel="noopener ugc nofollow" target="_blank">pandas _ flavor</a>，学习如何根据您的业务、研究或个人工作流程定制 pandas API。</p><p id="8577" class="pw-post-body-paragraph lf lg it lh b li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated"><a class="ae le" href="https://github.com/Zsailer/pandas_flavor" rel="noopener ugc nofollow" target="_blank"> Pandas-flavor </a>是一个引入 API 来扩展 Pandas 的库。这个 API 处理将定制的<strong class="lh iu">访问器/方法</strong>注册到 Pandas 对象上的样板代码。</p><p id="c46f" class="pw-post-body-paragraph lf lg it lh b li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">但是在本文中，我将展示如何使用它来扩展功能。为简单起见，我将使用泰坦尼克号数据集:</p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="a907" class="mi jr it me b gy mj mk l ml mm"><strong class="me iu">import pandas</strong></span><span id="5aef" class="mi jr it me b gy mn mk l ml mm">df = pd.read_csv("titanic.csv")</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mo"><img src="../Images/01af80881bbdc3885c770d51efe60a73.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vKhWSE4hEMAhmu-sqkzvXA.png"/></div></div></figure></div><div class="ab cl mp mq hx mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="im in io ip iq"><h1 id="52c4" class="jq jr it bd js jt mw jv jw jx mx jz ka kb my kd ke kf mz kh ki kj na kl km kn bi translated">注册方法</h1><p id="74e2" class="pw-post-body-paragraph lf lg it lh b li nb lk ll lm nc lo lp lq nd ls lt lu ne lw lx ly nf ma mb mc im bi translated"><a class="ae le" href="https://github.com/Zsailer/pandas_flavor" rel="noopener ugc nofollow" target="_blank"> Pandas-flavor </a>将以下自定义方法<em class="ng">直接</em>添加到 Pandas 的 DataFrame/Series 上:</p><ul class=""><li id="836e" class="nh ni it lh b li lj lm ln lq nj lu nk ly nl mc nm nn no np bi translated">允许将方法附加到数据帧。</li><li id="ac76" class="nh ni it lh b li nt lm nu lq nv lu nw ly nx mc nm nn no np bi translated"><code class="fe nq nr ns me b">register_series_accessor()</code>允许将方法附加到序列。</li></ul><p id="97db" class="pw-post-body-paragraph lf lg it lh b li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">这两个装饰器允许你我们可以调整上面的例子，将“<code class="fe nq nr ns me b">is_old_lady</code>”方法直接附加到 DataFrame 上。</p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="a988" class="mi jr it me b gy mj mk l ml mm"><strong class="me iu">from</strong> <strong class="me iu">pandas_flavor</strong> <strong class="me iu">import</strong> register_dataframe_method</span><span id="9cfd" class="mi jr it me b gy mn mk l ml mm"><strong class="me iu">@register_dataframe_method</strong><br/><strong class="me iu">def</strong> is_old_lady(df):<br/>   <!-- -->is_lady = df["Sex"] == "female"<br/>   <!-- -->is_old = df["Age"] &gt; 70<br/>   <strong class="me iu">return</strong> df[is_old &amp; is_lady]</span><span id="11e1" class="mi jr it me b gy mn mk l ml mm">df.is_old_lady()</span></pre><p id="3502" class="pw-post-body-paragraph lf lg it lh b li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">但这可能会导致一些问题，例如，如果许多包开始用自定义方法对数据帧进行猴子式修补，可能会出现重复和混乱。</p><p id="5664" class="pw-post-body-paragraph lf lg it lh b li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">通过使用隔离(名称空间),注册一个包含自定义方法的访问器，可以很容易地解决这个问题。</p></div><div class="ab cl mp mq hx mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="im in io ip iq"><h1 id="1454" class="jq jr it bd js jt mw jv jw jx mx jz ka kb my kd ke kf mz kh ki kj na kl km kn bi translated">注册访问者</h1><p id="a2b5" class="pw-post-body-paragraph lf lg it lh b li nb lk ll lm nc lo lp lq nd ls lt lu ne lw lx ly nf ma mb mc im bi translated">熊猫数据框架/系列的访问者注册也是如此:</p><ul class=""><li id="1612" class="nh ni it lh b li lj lm ln lq nj lu nk ly nl mc nm nn no np bi translated"><code class="fe nq nr ns me b">register_dataframe_accessor()</code>允许将访问器附加到数据帧。</li><li id="00e8" class="nh ni it lh b li nt lm nu lq nv lu nw ly nx mc nm nn no np bi translated"><code class="fe nq nr ns me b">register_series_accessor()</code>允许将访问器附加到序列。</li></ul><p id="8306" class="pw-post-body-paragraph lf lg it lh b li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">作为一个例子，这里有一个简单的“titanic”访问器，它有一个“<code class="fe nq nr ns me b">is_old_lad</code>”方法:</p><pre class="kp kq kr ks gt md me mf mg aw mh bi"><span id="ab44" class="mi jr it me b gy mj mk l ml mm"><strong class="me iu">from</strong> <strong class="me iu">pandas_flavor</strong> <strong class="me iu">import</strong> register_dataframe_accessor</span><span id="fa6b" class="mi jr it me b gy mn mk l ml mm"><strong class="me iu">@register_dataframe_accessor</strong>("titanic")<br/><strong class="me iu">class</strong> <strong class="me iu">TitanicAccessor</strong>:<br/>    <strong class="me iu">def</strong> __init__(self, df):<br/>        self._df = df<br/>        <br/>    <strong class="me iu">def</strong> is_old_lady(self):<br/>        df = self._df<br/>        <!-- -->is_lady = df["Sex"] == "female"<br/>        <!-- -->is_old = df["Age"] &gt; 70<br/>        <strong class="me iu">return</strong> df[is_old &amp; is_lady]</span><span id="d043" class="mi jr it me b gy mn mk l ml mm">df.titanic.is_old_lady()</span></pre></div><div class="ab cl mp mq hx mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="im in io ip iq"><h1 id="d536" class="jq jr it bd js jt mw jv jw jx mx jz ka kb my kd ke kf mz kh ki kj na kl km kn bi translated">但是熊猫有自己的 API</h1><p id="5098" class="pw-post-body-paragraph lf lg it lh b li nb lk ll lm nc lo lp lq nd ls lt lu ne lw lx ly nf ma mb mc im bi translated">在本文中，我选择展示 pandas-flavor，尽管 pandas 有自己的 API<a class="ae le" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.api.extensions.register_dataframe_accessor.html ?" rel="noopener ugc nofollow" target="_blank">来扩展 DataFrame/Series 功能，您可能应该在注册访问器时使用这些功能。</a></p><p id="6ca3" class="pw-post-body-paragraph lf lg it lh b li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">但是有一些限制:</p><ul class=""><li id="fa92" class="nh ni it lh b li lj lm ln lq nj lu nk ly nl mc nm nn no np bi translated">您使用较旧的 pandas 版本，因为它只在 0.24.x 中引入</li><li id="2668" class="nh ni it lh b li nt lm nu lq nv lu nw ly nx mc nm nn no np bi translated">您希望注册方法而不是访问器，一个用例可以是覆盖 pandas 自己的方法，如<a class="ae le" href="https://github.com/eyaltrabelsi/pandas-log" rel="noopener ugc nofollow" target="_blank"> pandas-log </a>。</li><li id="6210" class="nh ni it lh b li nt lm nu lq nv lu nw ly nx mc nm nn no np bi translated">您希望将访问器/方法注册到其他包，如 xarray。</li></ul><p id="1908" class="pw-post-body-paragraph lf lg it lh b li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">出于简洁的原因，我选择为所有用例展示熊猫风味。</p><h1 id="23f3" class="jq jr it bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">遗言</h1><p id="f1c5" class="pw-post-body-paragraph lf lg it lh b li nb lk ll lm nc lo lp lq nd ls lt lu ne lw lx ly nf ma mb mc im bi translated">当您想要扩展 Pandas 的功能并使您的代码更好时，Pandas flavor 非常有用。这篇文章的灵感来自 Zach Sailer 的<a class="ae le" href="https://zsailer.github.io/software/pandas-flavor/" rel="noopener ugc nofollow" target="_blank">博客</a>(熊猫风味作者)。</p><p id="e923" class="pw-post-body-paragraph lf lg it lh b li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">我希望你觉得有趣和有用。我乐于接受任何建设性的反馈。</p></div></div>    
</body>
</html>