<html>
<head>
<title>Life of a model after deployment</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">部署后模型的生命周期</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/life-of-a-model-after-deployment-bae52eb83b75?source=collection_archive---------24-----------------------#2019-08-09">https://towardsdatascience.com/life-of-a-model-after-deployment-bae52eb83b75?source=collection_archive---------24-----------------------#2019-08-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/e9b7891a64561097e60776f3f6175bce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E9arbDMjeCsYduiZKOWqrA.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Example dashboard used to monitor models — <a class="ae kc" href="https://stakion.io" rel="noopener ugc nofollow" target="_blank">Stakion</a></figcaption></figure><p id="2e44" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">应用程序监控是在生产中运行软件的关键部分。没有它，找到问题的唯一方法是通过运气或者因为客户报告了它。至少可以说这两者都不太理想！</p><blockquote class="lb lc ld"><p id="b558" class="kd ke le kf b kg kh ki kj kk kl km kn lf kp kq kr lg kt ku kv lh kx ky kz la ij bi translated">你不会在没有监控的情况下部署应用程序，那么为什么要为机器学习模型部署呢？</p></blockquote><p id="d268" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为了尽量保持帖子的可管理长度，我们将只关注几个关键主题:</p><ul class=""><li id="487e" class="li lj iq kf b kg kh kk kl ko lk ks ll kw lm la ln lo lp lq bi translated">监控所需的数据</li><li id="33d5" class="li lj iq kf b kg lr kk ls ko lt ks lu kw lv la ln lo lp lq bi translated">要跟踪和提醒的关键指标</li><li id="a026" class="li lj iq kf b kg lr kk ls ko lt ks lu kw lv la ln lo lp lq bi translated">训练和推理分布之间的相似性度量</li></ul></div><div class="ab cl lw lx hu ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ij ik il im in"><h1 id="0680" class="md me iq bd mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na bi translated">监控所需的数据</h1><p id="732d" class="pw-post-body-paragraph kd ke iq kf b kg nb ki kj kk nc km kn ko nd kq kr ks ne ku kv kw nf ky kz la ij bi translated">为了准确地监控机器学习模型，在进行预测时需要记录粒度数据。这些日志可用于调试为什么做出某个预测，一旦汇总，将使我们能够监控模型。</p><p id="0c37" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">良好测井的关键部分:</p><ul class=""><li id="4885" class="li lj iq kf b kg kh kk kl ko lk ks ll kw lm la ln lo lp lq bi translated"><strong class="kf ir">由调用 ML 模型的系统提供的每个请求的唯一 Id</strong>。这个唯一标识符将与每个日志一起存储，并允许我们在 ML 模型之前、期间和之后跟踪预测的路径。</li><li id="be79" class="li lj iq kf b kg lr kk ls ko lt ks lu kw lv la ln lo lp lq bi translated"><strong class="kf ir">在特征工程之前输入特征</strong></li><li id="6fd4" class="li lj iq kf b kg lr kk ls ko lt ks lu kw lv la ln lo lp lq bi translated"><strong class="kf ir">输入特征工程后的特征</strong></li><li id="662c" class="li lj iq kf b kg lr kk ls ko lt ks lu kw lv la ln lo lp lq bi translated"><strong class="kf ir">输出概率</strong></li><li id="df8e" class="li lj iq kf b kg lr kk ls ko lt ks lu kw lv la ln lo lp lq bi translated"><strong class="kf ir">预测值</strong></li></ul><p id="6325" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">虽然这看起来像是大量的日志记录，但是如果没有它，我们将看不到模型是如何处理某些输入的。</p></div><div class="ab cl lw lx hu ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ij ik il im in"><h1 id="bb71" class="md me iq bd mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na bi translated">要跟踪的关键指标</h1><p id="bb1b" class="pw-post-body-paragraph kd ke iq kf b kg nb ki kj kk nc km kn ko nd kq kr ks ne ku kv kw nf ky kz la ij bi translated">在最好的情况下，我们会近乎实时地将地面实况标签与我们的预测进行比较。不幸的是，这通常是不可能的，因为对于大多数应用程序来说，基本事实标签直到做出预测后很长时间才可用。例如，当试图预测下一年的收入或预测交易是否欺诈时，就是这种情况。</p><blockquote class="lb lc ld"><p id="5ba9" class="kd ke le kf b kg kh ki kj kk kl km kn lf kp kq kr lg kt ku kv lh kx ky kz la ij bi translated">如果无法实时追踪模型的准确性，请改为追踪输入和输出要素的分布。</p></blockquote><p id="b639" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">监视模型功能背后的假设是，当要求模型对不属于定型集的新数据进行预测时，模型的性能将会改变。</p><p id="3381" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们可以通过跟踪一些指标来很好地了解模型的健康状况:</p><ul class=""><li id="58cd" class="li lj iq kf b kg kh kk kl ko lk ks ll kw lm la ln lo lp lq bi translated">预测次数</li><li id="d029" class="li lj iq kf b kg lr kk ls ko lt ks lu kw lv la ln lo lp lq bi translated">预测延迟—进行预测需要多长时间</li><li id="1c3e" class="li lj iq kf b kg lr kk ls ko lt ks lu kw lv la ln lo lp lq bi translated">输入和输出特征分布的变化</li></ul><p id="3eb3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在特征级别，我们将想要跟踪在训练期间计算的分布(<em class="le">训练分布</em>)和在推理期间计算的分布(<em class="le">推理分布</em>)之间的相似性度量。</p></div><div class="ab cl lw lx hu ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ij ik il im in"><h1 id="82fa" class="md me iq bd mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na bi translated">训练和推理分布之间的相似性度量</h1><p id="51ee" class="pw-post-body-paragraph kd ke iq kf b kg nb ki kj kk nc km kn ko nd kq kr ks ne ku kv kw nf ky kz la ij bi translated">为了监控一个特性，我们需要计算一个度量来比较训练和推理分布。有许多不同的相似性分布可供选择，但很少能同时适用于分类变量和数值变量。</p><h2 id="dec9" class="ng me iq bd mf nh ni dn mj nj nk dp mn ko nl nm mr ks nn no mv kw np nq mz nr bi translated">计算相似性度量</h2><p id="3446" class="pw-post-body-paragraph kd ke iq kf b kg nb ki kj kk nc km kn ko nd kq kr ks ne ku kv kw nf ky kz la ij bi translated">Wasserstein 距离[1]是一种相似性度量，可以针对数字和分类特征进行计算，其定义为:</p><figure class="nt nu nv nw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ns"><img src="../Images/5642799dee59ab3d13649fe4fe3045d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:752/format:webp/1*LdAoQhmVNXONOdTN1IjxUQ@2x.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Wasserstein distance with U as the training CDF and V the inference CDF</figcaption></figure><p id="ed75" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">从图形上看，Wasserstein 距离是两个累积分布函数之间的面积。因此，如果训练和推理分布是相同的，那么它将是 0。当它们开始发散时，距离会增加，并且没有上限。</p><figure class="nt nu nv nw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nx"><img src="../Images/f5473a253a1906f515df298803a3364c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WF2wRCEvalDkQAb4vYV-FQ.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Graphical representation of the Wasserstein distance.</figcaption></figure><p id="8316" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">要计算分类变量的 Wasserstein 距离，您必须对每个类别的频率差异的绝对值求和。</p><h2 id="2bec" class="ng me iq bd mf nh ni dn mj nj nk dp mn ko nl nm mr ks nn no mv kw np nq mz nr bi translated">存储分布</h2><p id="0fbd" class="pw-post-body-paragraph kd ke iq kf b kg nb ki kj kk nc km kn ko nd kq kr ks ne ku kv kw nf ky kz la ij bi translated">为了计算 Wasserstein 距离，我们需要存储连续分布和离散分布。</p><p id="db4c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">连续分布可以用 t-Digests 来表示[2]。不涉及细节，t-Digests 是一种新的数据结构，它存储 CDF 的稀疏版本，并具有许多属性(容易序列化、并行化等)。</p><p id="af63" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">离散分布更容易存储，我们只需要存储类别和它们各自的频率。如果类别总数很高，那么我们可以只存储前 1000 个。</p><p id="6512" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">可视化离散分布可能很棘手，我们可以做的一件事是将类别分组到桶中，每个桶至少包含<em class="le"> x </em> %的数据(见下文)。鉴于这是在训练数据上完成的，我们预计每个桶的大小在推断过程中会略有波动。</p><figure class="nt nu nv nw gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ny"><img src="../Images/ac387dce9f3e2d8d34a8463111984b8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dDGKL8huXG20h197oWt4GQ.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Bucketing categories into buckets of frequency of 10%.</figcaption></figure></div><div class="ab cl lw lx hu ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ij ik il im in"><h1 id="278a" class="md me iq bd mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na bi translated">结论</h1><p id="d9f0" class="pw-post-body-paragraph kd ke iq kf b kg nb ki kj kk nc km kn ko nd kq kr ks ne ku kv kw nf ky kz la ij bi translated">通过一点规划，监控机器学习模型并不复杂。</p><p id="098c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">监控模型归结为跟踪预测的数量以及训练和推理分布之间的相似性度量。如果你已经准备好了，你就可以高枕无忧了，如果出了问题，你会是第一个知道的人！</p><p id="dc28" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kf ir">参考文献:</strong></p><p id="99b7" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">[1]瓦瑟斯坦米制，【https://en.wikipedia.org/wiki/Wasserstein_metric】T4</p><p id="c002" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">[2]使用 t-Digests 计算极其精确的分位数，<a class="ae kc" href="https://arxiv.org/abs/1902.04023" rel="noopener ugc nofollow" target="_blank">https://arxiv.org/abs/1902.04023</a></p></div></div>    
</body>
</html>