<html>
<head>
<title>Preparing EHR &amp; Tabular Data for Neural Networks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为神经网络准备 EHR 和表格数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/everything-you-need-to-know-about-preparing-tabular-data-for-machine-learning-code-included-d1b6779b934f?source=collection_archive---------18-----------------------#2019-06-01">https://towardsdatascience.com/everything-you-need-to-know-about-preparing-tabular-data-for-machine-learning-code-included-d1b6779b934f?source=collection_archive---------18-----------------------#2019-06-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="2a0e" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">包含 Python 代码！</h2></div><p id="c110" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这篇文章也可以叫做“我在博士第一年研究大量电子健康记录数据集时学到的一切”在这里，我将概述分类变量和数量变量之间的差异，并解释如何为神经网络模型准备表格数据，包括:</p><ul class=""><li id="e49b" class="le lf it kk b kl km ko kp kr lg kv lh kz li ld lj lk ll lm bi translated">分类变量的正确表示(热点向量介绍)</li><li id="0b21" class="le lf it kk b kl ln ko lo kr lp kv lq kz lr ld lj lk ll lm bi translated">连续变量的规范化</li><li id="5f68" class="le lf it kk b kl ln ko lo kr lp kv lq kz lr ld lj lk ll lm bi translated">填充缺失值(插补介绍)</li></ul><p id="bb7f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最棒的是，提供了广泛适用的代码来对<em class="ls">您的</em>表格数据执行上述所有操作！可以在 GitHub 上下载本教程的代码:<a class="ae lt" href="https://github.com/rachellea/glassboxmedicine/blob/master/2019-06-01-dataprocessing.py" rel="noopener ugc nofollow" target="_blank">rachellea/glassbox medicine/2019–06–01-data processing . py</a>。</p><h1 id="1ac0" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated"><strong class="ak">分类变量</strong></h1><p id="5c4d" class="pw-post-body-paragraph ki kj it kk b kl mm ju kn ko mn jx kq kr mo kt ku kv mp kx ky kz mq lb lc ld im bi translated"><a class="ae lt" href="https://stattrek.com/statistics/dictionary.aspx?definition=categorical%20variable" rel="noopener ugc nofollow" target="_blank">分类变量</a>是采用不同类别名称的变量。以下是分类变量的一些例子:</p><figure class="ms mt mu mv gt mw gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/3fcb6aa0a54dda3cb4dee3599d0340ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1232/0*q-Rdwui4A_Eidoo_"/></div></figure><p id="4b0d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">图片来源:<a class="ae lt" href="https://en.wikipedia.org/wiki/Fruit#/media/File:Culinary_fruits_front_view.jpg" rel="noopener ugc nofollow" target="_blank">水果</a>，<a class="ae lt" href="https://en.wikipedia.org/wiki/London#/media/File:Palace_of_Westminster_from_the_dome_on_Methodist_Central_Hall.jpg" rel="noopener ugc nofollow" target="_blank">伦敦</a>，<a class="ae lt" href="https://commons.wikimedia.org/wiki/File:BeachDog2.jpg" rel="noopener ugc nofollow" target="_blank">沙滩狗</a></p><p id="6ef5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">分类变量进一步细分为<a class="ae lt" href="https://bolt.mph.ufl.edu/6050-6052/preliminaries/types-of-variables/" rel="noopener ugc nofollow" target="_blank">名义变量和顺序变量</a>:</p><ul class=""><li id="f35e" class="le lf it kk b kl km ko kp kr lg kv lh kz li ld lj lk ll lm bi translated"><em class="ls">名义变量</em>在类别之间没有自然排序。上面的例子(水果、地点和动物)是“名义上的”变量，因为在类别之间没有内在的顺序；</li><li id="b191" class="le lf it kk b kl ln ko lo kr lp kv lq kz lr ld lj lk ll lm bi translated"><em class="ls">序数变量</em>有自然排序。例如，字母等级(A、B、C、D、F)或等级量表(疼痛等级为 1-10)是顺序变量。</li></ul><p id="37c7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">医学中的名义分类变量</strong></p><p id="d375" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">以下是医疗数据集中的一些名义变量(无自然排序)示例，以及一些示例值:</p><ul class=""><li id="af00" class="le lf it kk b kl km ko kp kr lg kv lh kz li ld lj lk ll lm bi translated"><em class="ls">性别</em>:女，男；</li><li id="5e64" class="le lf it kk b kl ln ko lo kr lp kv lq kz lr ld lj lk ll lm bi translated"><a class="ae lt" href="https://grants.nih.gov/grants/guide/notice-files/not-od-15-089.html" rel="noopener ugc nofollow" target="_blank"> <em class="ls">种族</em> </a>:美国印第安人或阿拉斯加土著、亚裔、黑人或非裔、西班牙裔或拉丁裔、夏威夷土著或其他太平洋岛民、白人；</li><li id="c9d7" class="le lf it kk b kl ln ko lo kr lp kv lq kz lr ld lj lk ll lm bi translated"><em class="ls">诊断</em>:糖尿病、高血压、高血脂、肺癌、肺炎、心肌梗死、狼疮、肠易激综合征、中风；</li><li id="cca4" class="le lf it kk b kl ln ko lo kr lp kv lq kz lr ld lj lk ll lm bi translated"><em class="ls">手术</em>:阑尾切除术、胆囊切除术、乳房切除术、CABG *；</li><li id="f956" class="le lf it kk b kl ln ko lo kr lp kv lq kz lr ld lj lk ll lm bi translated"><a class="ae lt" href="https://www.drugs.com/drug_information.html" rel="noopener ugc nofollow" target="_blank"> <em class="ls">用药</em> </a>:对乙酰氨基酚、阿普唑仑、阿米替林、氨氯地平、阿莫西林、阿托伐他汀；</li><li id="dbc5" class="le lf it kk b kl ln ko lo kr lp kv lq kz lr ld lj lk ll lm bi translated"><em class="ls">实验室检查:</em>全血细胞计数(CBC)、凝血酶原时间(PT)、基础代谢板(BMP)、综合代谢板(CMP)、血脂板、肝板、血红蛋白 A1c (HbA1c)。</li></ul><p id="f4b9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">*旁注:CABG 代表“冠状动脉旁路移植术”，这是一种心脏直视手术。医生把这个缩写念成“白菜”(认真)。</p><figure class="ms mt mu mv gt mw gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/0c21a30dcbf727193ed09a7dbd0f9809.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/0*0bBglCblqTv4bxE_"/></div></figure><p id="8df6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae lt" href="https://en.wikipedia.org/wiki/Cabbage#/media/File:Chou_1.jpg" rel="noopener ugc nofollow" target="_blank">卷心菜</a>，不要与<a class="ae lt" href="https://en.wikipedia.org/wiki/Coronary_artery_bypass_surgery" rel="noopener ugc nofollow" target="_blank"> CABG </a>混淆</p><p id="dcf0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">医学中的有序分类变量</strong></p><p id="eeb9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">以下是医疗数据集中顺序变量(固有排序)的一些示例:</p><p id="2d2c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">助记符:</p><ul class=""><li id="d178" class="le lf it kk b kl km ko kp kr lg kv lh kz li ld lj lk ll lm bi translated">序数变量是有序的；</li><li id="d286" class="le lf it kk b kl ln ko lo kr lp kv lq kz lr ld lj lk ll lm bi translated">名义变量只有 NOMS(名字)，没有顺序。</li></ul><h1 id="1d76" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated"><strong class="ak">数量变量</strong></h1><p id="e5ac" class="pw-post-body-paragraph ki kj it kk b kl mm ju kn ko mn jx kq kr mo kt ku kv mp kx ky kz mq lb lc ld im bi translated"><a class="ae lt" href="https://bolt.mph.ufl.edu/6050-6052/preliminaries/types-of-variables/" rel="noopener ugc nofollow" target="_blank">定量</a>变量具有通常代表测量结果的数值。有两种定量变量:</p><ul class=""><li id="e2a2" class="le lf it kk b kl km ko kp kr lg kv lh kz li ld lj lk ll lm bi translated">离散的变量有可计数的数值。例如:患者服用的处方数量、患者被诊断患有的疾病数量、患者接受的手术数量；</li><li id="313e" class="le lf it kk b kl ln ko lo kr lp kv lq kz lr ld lj lk ll lm bi translated"><em class="ls">连续</em>变量在特定的取值范围内取任意值。例如:身高、体重、体重指数、肿瘤直径、腰臀比。</li></ul><p id="1c7f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">实验室测试的附带说明</strong></p><p id="ac68" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果您的变量是实验室测试的名称，那么它就是一个名义(分类)变量，因为它可以采用不同实验室测试的不同名称，例如“全血细胞计数”、“基础代谢组”、“全代谢组”</p><p id="c35d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果您的变量是实验室测试的结果，它可能是:</p><ul class=""><li id="55f1" class="le lf it kk b kl km ko kp kr lg kv lh kz li ld lj lk ll lm bi translated">分类/标称:例如<a class="ae lt" href="https://emedicine.medscape.com/article/2074001-overview" rel="noopener ugc nofollow" target="_blank">尿液分析中的颜色</a>；</li><li id="4a64" class="le lf it kk b kl ln ko lo kr lp kv lq kz lr ld lj lk ll lm bi translated">定量/离散:例如白细胞数量的计数；</li><li id="fae1" class="le lf it kk b kl ln ko lo kr lp kv lq kz lr ld lj lk ll lm bi translated">定量/连续:例如血糖水平。大多数实验室测试结果都属于这一类，因为它们是某种物质(血液、脑脊液、尿液等)的测量结果。)</li></ul><h1 id="513e" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated"><strong class="ak">表示分类变量:独热向量</strong></h1><p id="b663" class="pw-post-body-paragraph ki kj it kk b kl mm ju kn ko mn jx kq kr mo kt ku kv mp kx ky kz mq lb lc ld im bi translated">在机器学习中，分类变量通常被表示为“独热向量”独热向量是这样一种向量，其中除了一个之外，所有条目都是零，即只有一个元素是“热的”(非零)。以下是一些热点媒介:</p><p id="f2db" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">独热向量的酷之处在于，它们允许你表示你的分类变量，而不需要假设它们之间有任何特定的关系。</p><p id="7f21" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">假设您想要表示分类变量“动物”,该变量的值为狗、猫和鱼。</p><ul class=""><li id="d3b8" class="le lf it kk b kl km ko kp kr lg kv lh kz li ld lj lk ll lm bi translated">如果你说狗= 1，猫= 2，鱼= 3，这意味着狗是鱼的三分之一，猫是狗的两倍，以及其他各种没有意义的数字关系；</li><li id="5c34" class="le lf it kk b kl ln ko lo kr lp kv lq kz lr ld lj lk ll lm bi translated">然而，如果你说狗= [1，0，0]，猫= [0，1，0]，鱼= [0，0，1]，你并没有对这些动物之间的关系做出任何假设，因为这些单热点向量是垂直的:</li></ul><figure class="ms mt mu mv gt mw gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/14cd579f636228bfbd34ae24389ee0f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1232/0*R_7ZgGWJ2bRjKL8Z"/></div></figure><p id="d41e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你想要表现 20 种不同的动物，那没问题:只需使用长度为 20 的单键向量。由此产生的 20 个不同的独热向量在 20 维空间中仍然是相互垂直的(你会很高兴地知道，我将<em class="ls">而不是</em>试图勾画):</p><ul class=""><li id="fe02" class="le lf it kk b kl km ko kp kr lg kv lh kz li ld lj lk ll lm bi translated">狗，狗，狗，狗</li><li id="215f" class="le lf it kk b kl ln ko lo kr lp kv lq kz lr ld lj lk ll lm bi translated">猫[0，1，0，0，0，0，0，0，0，0，0，0，0，0</li><li id="f848" class="le lf it kk b kl ln ko lo kr lp kv lq kz lr ld lj lk ll lm bi translated">鱼，鱼，鱼，鱼，鱼，鱼</li><li id="1e97" class="le lf it kk b kl ln ko lo kr lp kv lq kz lr ld lj lk ll lm bi translated">马[0，0，0，1，0，0，0，0，0，0，0，0，0，0，0</li><li id="982b" class="le lf it kk b kl ln ko lo kr lp kv lq kz lr ld lj lk ll lm bi translated">蜥蜴[0，0，0，0，1，0，0，0，0，0，0，0，0，0，0</li><li id="7030" class="le lf it kk b kl ln ko lo kr lp kv lq kz lr ld lj lk ll lm bi translated">等等</li></ul><p id="a836" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一般来说，你需要的独热向量的长度等于你的分类变量可以取的不同可能值的数量。如果它可以取 5 个值，那么独热向量的长度应该是 5。如果它可以取 1，298 个值，那么您的独热向量的长度应该是 1，298。</p><p id="c957" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">如果我的数据集中有很多分类变量怎么办？</strong></p><p id="c7cd" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">只需为每个分类变量创建一个不同的独热向量。假设你做了一个调查，问了三个人他们最喜欢的动物、地点和水果。最后，您的调查回答数据集包括分类变量“动物”(3 个可能值)、“位置”(4 个可能值)和“水果”(2 个可能值)。因此，您应该:</p><ul class=""><li id="8ddc" class="le lf it kk b kl km ko kp kr lg kv lh kz li ld lj lk ll lm bi translated">使用长度为 3 的独热向量表示“动物”;</li><li id="1e5a" class="le lf it kk b kl ln ko lo kr lp kv lq kz lr ld lj lk ll lm bi translated">将“位置”表示为长度为 4 的单独的独热码向量；</li><li id="2dca" class="le lf it kk b kl ln ko lo kr lp kv lq kz lr ld lj lk ll lm bi translated">将“水果”表示为长度为 2 的另一个独热向量。</li></ul><p id="5893" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">可视化，</p><figure class="ms mt mu mv gt mw gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/26a26809b1afc44794d02d7043935475.png" data-original-src="https://miro.medium.com/v2/resize:fit:1232/0*iIJz4Ap1bNrbXETy"/></div></figure><p id="6ef1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果我的分类变量可以同时取多个值，该怎么办？</p><p id="a27e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果在之前的调查中，你让人们选择多种动物、地点或水果，会怎么样？您可以使用“多热向量”，它与单热向量完全相同，只是多个条目可以等于 1。下面是一个例子(修改了前面的例子；附加条目以黄色突出显示):</p><figure class="ms mt mu mv gt mw gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/a232d83328b2b7b72afabe1ef7028698.png" data-original-src="https://miro.medium.com/v2/resize:fit:1232/0*2ciRxltv7YsXTeX0"/></div></figure><p id="acc5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">像这样可以取多个值的分类变量在医学中很常见。例如，从患者十年的病历中提取的诊断、程序和药物很可能具有不止一个值。许多患者会有几个过去的诊断，几个过去的程序，和几个过去的药物。因此，您将需要一个用于诊断的多热点向量，另一个用于程序的多热点向量，以及另一个用于药物的多热点向量。</p><p id="74af" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下面是提供的代码中<a class="ae lt" href="https://github.com/rachellea/glassboxmedicine/blob/master/2019-06-01-dataprocessing.py" rel="noopener ugc nofollow" target="_blank">的一个片段，它使用</a><a class="ae lt" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.get_dummies.html" rel="noopener ugc nofollow" target="_blank">熊猫函数 get_dummies() </a>将每个分类变量转换成一个单热点或多热点向量:</p><pre class="ms mt mu mv gt na nb nc nd aw ne bi"><span id="61b2" class="nf lv it nb b gy ng nh l ni nj">def _one_hotify(self):<br/>    """Modify self.clean_data so that each categorical <br/>    column is turned into many columns that together form a <br/>    one-hot vector for that variable. E.g. if you have a column <br/>    'Gender' with values 'M' and 'F', split it into two binary <br/>    columns 'Gender_M' and 'Gender_F'"""</span><span id="4f23" class="nf lv it nb b gy nk nh l ni nj">    print('Onehotifying', str(len( <br/>        self.one_hotify_these_categorical)),'categorical variables')<br/>    print('\tData shape before onehotifying:', <br/>        str(self.clean_data.shape))<br/>    #one hotify the categorical variables<br/>    self.clean_data = pd.get_dummies(data = self.clean_data,<br/>                 columns = self.one_hotify_these_categorical,<br/>                                         dummy_na = False)<br/>    print('\tData shape after one-hotifying:', <br/>        str(self.clean_data.shape))</span></pre><h1 id="a3a2" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated"><strong class="ak">代表量化变量:规范化的重要性</strong> <strong class="ak">(即“如何喂养你的神经网络”)</strong></h1><p id="3268" class="pw-post-body-paragraph ki kj it kk b kl mm ju kn ko mn jx kq kr mo kt ku kv mp kx ky kz mq lb lc ld im bi translated">现在我们要换个话题，谈谈表示数量变量。看起来你可以直接把这些变量扔进模型，而不需要任何额外的工作，因为它们已经是数字了。然而，如果您正在构建一个神经网络模型，您不希望输入原始的定量变量，因为它们可能具有非常不同的标度，并且为神经网络提供不同标度的数字会使它变得令人难过(即，神经网络学习任何东西都会更加困难。)</p><p id="abb4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我所说的“不同尺度”是指一些变量可能取小值(例如肿瘤直径= 0.5 厘米)，而其他变量可能取大值(例如体重= 350 磅)。)如果只给神经网络输入较小的标准化值，它的训练会更有效。</p><p id="7b15" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">以下是在训练神经网络之前对定量变量进行归一化的常见步骤:</p><ol class=""><li id="02a7" class="le lf it kk b kl km ko kp kr lg kv lh kz li ld nl lk ll lm bi translated">将数据分成训练集、验证集和测试集。</li><li id="34aa" class="le lf it kk b kl ln ko lo kr lp kv lq kz lr ld nl lk ll lm bi translated">计算训练集中定量变量的平均值；</li><li id="54f3" class="le lf it kk b kl ln ko lo kr lp kv lq kz lr ld nl lk ll lm bi translated">计算训练集中定量变量的标准差；</li><li id="91ed" class="le lf it kk b kl ln ko lo kr lp kv lq kz lr ld nl lk ll lm bi translated">使用您刚刚在训练集上计算的平均值和标准偏差，标准化所有数据(训练、验证和测试)中定量变量的每个原始值:</li></ol><figure class="ms mt mu mv gt mw gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/d20e86d7b364ef865e91cc7b19644952.png" data-original-src="https://miro.medium.com/v2/resize:fit:1232/0*fWd2r8ZTg-ufppsc"/></div></figure><p id="f73d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您必须为数据集中的每个定量变量分别执行此操作(例如，分别为“肿瘤直径”和“重量”)，因为每个定量变量将具有不同的平均值和不同的标准差。</p><p id="09fe" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">执行上述步骤的效果是，您所有的量化变量现在都将表示为以 0 为中心的小数字，这将使它们成为您的神经网络的良好食物。</p><p id="5866" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为什么我们只使用训练集来计算均值和标准差？为什么不使用整个数据集？回答:如果我们在计算平均值和标准偏差时包括测试集，我们会将测试集的信息泄露到我们的训练数据中，这是作弊。</p><p id="4781" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下面是提供的代码中<a class="ae lt" href="https://github.com/rachellea/glassboxmedicine/blob/master/2019-06-01-dataprocessing.py" rel="noopener ugc nofollow" target="_blank">的一个片段，它使用 scikit-learn 的</a><a class="ae lt" href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.StandardScaler.html" rel="noopener ugc nofollow" target="_blank">标准缩放器</a>对连续变量进行归一化:</p><pre class="ms mt mu mv gt na nb nc nd aw ne bi"><span id="065f" class="nf lv it nb b gy ng nh l ni nj">def _normalize(self):<br/>    """Provide the features specified in <br/>    self.normalize_these_continuous<br/>    with approximately zero mean and unit variance, based on the<br/>    training dataset only."""<br/>    train_data = ( <br/>        self.clean_data[self.normalize_these_continuous].values<br/>        )[0:self.trainidx,:]<br/>    scaler = sklearn.preprocessing.StandardScaler().fit(train_data)<br/>    print('Normalizing data:\n\tscaler.mean_',str(scaler.mean_),<br/>          '\n\tscaler.scale_',str(scaler.scale_))<br/>    assert (len(self.normalize_these_continuous)<br/>            ==scaler.mean_.shape[0]<br/>            ==scaler.scale_.shape[0](<br/>    self.clean_data[self.normalize_these_continuous] = <br/>        scaler.transform((<br/>        self.clean_data[self.normalize_these_continuous]).values)</span></pre><h1 id="f592" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated"><strong class="ak">插补处理缺失数据</strong></h1><p id="afc4" class="pw-post-body-paragraph ki kj it kk b kl mm ju kn ko mn jx kq kr mo kt ku kv mp kx ky kz mq lb lc ld im bi translated">数据值经常丢失。也许调查参与者没有回答所有的问题，或者患者在不同的州接受治疗，他们的诊断、程序和药物没有记录在当地的医疗记录中。</p><p id="4aaa" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果我们读入一个带有缺失值的数据文件，这些值将是“NaNs”，或者“不是一个数字”为了训练，我们必须用一个数字来代替它们。填补缺失值被称为“插补”</p><p id="7262" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">有不同的插补策略。这里有一个合理的策略:</p><ul class=""><li id="9c2e" class="le lf it kk b kl km ko kp kr lg kv lh kz li ld lj lk ll lm bi translated">用训练集模式替换分类变量的所有缺失值。因此，如果动物的模式(最常选择的值)是“狗”，我们将替换“你最喜欢的动物是什么？”用“狗”；</li><li id="d7ff" class="le lf it kk b kl ln ko lo kr lp kv lq kz lr ld lj lk ll lm bi translated">用训练集中值替换连续变量的所有缺失值。因此，如果中值高度是 5.2 英尺，我们用 5.2 替换所有缺失的“高度”条目。</li></ul><p id="09b8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下面是提供的代码的一个片段<a class="ae lt" href="https://github.com/rachellea/glassboxmedicine/blob/master/2019-06-01-dataprocessing.py" rel="noopener ugc nofollow" target="_blank">，它使用</a><a class="ae lt" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.fillna.html" rel="noopener ugc nofollow" target="_blank">熊猫函数 fillna() </a>对缺失值进行插补:</p><pre class="ms mt mu mv gt na nb nc nd aw ne bi"><span id="4135" class="nf lv it nb b gy ng nh l ni nj">def _impute(self):<br/>    """Impute categorical variables using the mode of the <br/>    training data and continuous variables using the median <br/>    of the training data."""<br/>    #impute missing categorical values with the training data mode<br/>    print('Imputing categorical variables with mode:\n',<br/>          str(self.impute_these_categorical))<br/>    training_data = self.clean_data.iloc[0:self.trainidx,:]<br/>    imputed_with_modes = (<br/>        self.clean_data[self.impute_these_categorical]).fillna((<br/>       training_data[self.impute_these_categorical]).mode().iloc[0])<br/>    self.clean_data[self.impute_these_categorical] =\<br/>        imputed_with_modes  <br/>    <br/>    #impute missing continuous values with the training data median<br/>    print('Imputing continuous variables with median:\n',<br/>          str(self.impute_these_continuous))<br/>    imputed_with_medians = (<br/>        self.clean_data[self.impute_these_continuous]<br/>        ).fillna((training_data[self.impute_these_continuous]<br/>        ).median())<br/>    self.clean_data[self.impute_these_continuous] = <br/>        imputed_with_medians</span></pre><h1 id="3b23" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">摘要</h1><ul class=""><li id="06ff" class="le lf it kk b kl mm ko mn kr nm kv nn kz no ld lj lk ll lm bi translated">仔细的数据准备对于你的神经网络达到良好的性能是至关重要的；</li><li id="8049" class="le lf it kk b kl ln ko lo kr lp kv lq kz lr ld lj lk ll lm bi translated">One-hot vectors 允许您输入分类变量，而无需假设不同类别之间的任何特定数字关系；</li><li id="c777" class="le lf it kk b kl ln ko lo kr lp kv lq kz lr ld lj lk ll lm bi translated">将你的量化变量归一化为以零为中心的小数字，将有助于你的神经网络更有效地训练；</li><li id="bfb2" class="le lf it kk b kl ln ko lo kr lp kv lq kz lr ld lj lk ll lm bi translated">真实数据集往往是不完整的。使用相关变量的中位数或众数来输入缺失值将允许您在这些数据集上构建模型。</li></ul><p id="c2a1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">关于特色图片</strong></p><figure class="ms mt mu mv gt mw gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/a38ed8fff78dc2d990ff8839957ac766.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/0*7NQXJELOUBRV_xRX"/></div></figure><p id="4b34" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">特色图片是<a class="ae lt" href="https://commons.wikimedia.org/wiki/File:BeachDog2.jpg" rel="noopener ugc nofollow" target="_blank">一只萨摩耶犬</a>，恰好是我一直以来最喜欢的一种狗。这只狗在“分类变量示例”表中客串了一次。<a class="ae lt" href="https://en.wikipedia.org/wiki/Samoyed_dog" rel="noopener ugc nofollow" target="_blank">关于萨摩耶的趣闻</a>:</p><ul class=""><li id="593d" class="le lf it kk b kl km ko kp kr lg kv lh kz li ld lj lk ll lm bi translated">萨摩耶犬是西伯利亚的游牧驯鹿牧民饲养的；</li><li id="3caa" class="le lf it kk b kl ln ko lo kr lp kv lq kz lr ld lj lk ll lm bi translated">萨摩耶犬是最古老的犬种之一；</li><li id="bc15" class="le lf it kk b kl ln ko lo kr lp kv lq kz lr ld lj lk ll lm bi translated">脱落的萨摩耶毛皮可以用来编织衣物；</li><li id="8061" class="le lf it kk b kl ln ko lo kr lp kv lq kz lr ld lj lk ll lm bi translated">由于它们厚厚的皮毛，萨摩耶犬可以在远低于冰点的温度下保持温暖。</li></ul></div><div class="ab cl np nq hx nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="im in io ip iq"><p id="dbab" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="ls">原载于 2019 年 6 月 1 日</em><a class="ae lt" href="https://glassboxmedicine.com/2019/06/01/everything-you-need-to-know-about-preparing-tabular-data-for-machine-learning-code-included/" rel="noopener ugc nofollow" target="_blank"><em class="ls">http://glassboxmedicine.com</em></a><em class="ls">。</em></p></div></div>    
</body>
</html>