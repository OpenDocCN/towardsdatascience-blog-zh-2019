<html>
<head>
<title>The King of Serving: Tennis Web Scraping with Selenium</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">发球之王:硒网球刮网</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/the-king-of-serving-tennis-web-scraping-with-selenium-ae92ade2f017?source=collection_archive---------18-----------------------#2019-08-07">https://towardsdatascience.com/the-king-of-serving-tennis-web-scraping-with-selenium-ae92ade2f017?source=collection_archive---------18-----------------------#2019-08-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="981a" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">硒、Excel 和熊猫的力量</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/2049e7afb69c57cd73f42e24be56535e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PUOA5E0m46XVIXQR7Zvdjg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk"><a class="ae ky" href="https://unsplash.com/@joshcala" rel="noopener ugc nofollow" target="_blank">Josh Calabrese</a> via unsplash</figcaption></figure><h1 id="1813" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">介绍</h1><p id="519a" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">网球比赛中的发球往往决定了比赛的结果。在一盘比赛的关键时刻，发球的中断或发球的保持将最终决定是否能赢得奖杯。</p><p id="ce83" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">通过将测量的网络抓取与适当放置的显式等待相结合，可以提取网球服务数据，将其导出到 Excel，并使用 Pandas 库进行相应的过滤。</p><p id="d37a" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这篇教程将演示如何通过一些巧妙的部署，让抓取脚本平稳运行，并以一种方便、易于分析的格式返回数据。</p><p id="c472" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">由于网球运动员的发球比赛可以决定在球场上获得荣耀或提前出局的区别，我将收集当前参加 ATP 巡回赛的前 20 名男子网球运动员的数据。具体来说，我想收集数据，这将使网球运动员之间的区别仅基于他们的发球。</p><h1 id="e8e9" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">寻找数据</h1><p id="fdac" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">要提取数据，我首先需要找到一个来源，这是最新的数据。ATP 巡回赛网站有超过 1000 名网球运动员的全面信息，似乎是一个声誉良好的来源。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ms"><img src="../Images/0b157701c704b07115442e91371f08ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6lY2aUURVI_UQwxPiXVPsQ.png"/></div></div></figure><p id="497c" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated"><em class="mt">最重要的是</em>，当点击每个球员的链接文本时，可以看到特定于发球的数据，如下图的下半部分所示。正是这些信息，可以被提取出来用于比较前 20 名网球运动员。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mu"><img src="../Images/abc8f71b3bfa78b15ec2f7caf6d2c947.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lQ2im_U-4Et3SSE9psTC4g.png"/></div></div></figure><h1 id="b6cd" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">代码工作流</h1><p id="9e36" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在提取之前，确定代码工作流是很有用的。具体来说，我想:</p><p id="b966" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">遍历 ATP 巡回赛上排名前 20 位的男子网球运动员，提取他们的名字，他们转为职业选手的年份，以及上面显示的“单打服务记录”中的表格数据。</p><h1 id="b2b9" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">导入硒类</h1><p id="1a05" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated"><strong class="lt iu"> <em class="mt">和</em>tqdm</strong></p><p id="d413" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">首先，我将包含 selenium 类的各种导入语句。我需要导入 webdriver 来导航到网页，导入 By 类来帮助查找 web 元素定位器，导入 options 类来实例化 options 对象，这样我就可以拥有一个无头浏览器。</p><p id="dd9f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">除此之外，我还需要导入 WebDriverWait 类和 expected_conditions 类，它们协同工作。关于所有这些 selenium 类的信息可以通过这个<a class="ae ky" href="https://seleniumhq.github.io/selenium/docs/api/py/api.html" rel="noopener ugc nofollow" target="_blank">链接</a>找到。它们的使用示例如下所示。</p><p id="1993" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">最后，虽然<em class="mt">不是</em>绝对必要，但我将导入 tqdm，这样我可以在我的集成开发环境(IDE)的控制台中实时跟踪我的脚本的进度。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mv mw l"/></div></figure><h1 id="0b64" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">将提取的输出写入 Excel</h1><p id="df69" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">在每次迭代中，数据被传输到一个逗号分隔值(CSV)文件中。首先，我创建了一个名为“Tennis _ player _ details _ scrape . CSV”的文件，并以“w”模式打开这个新创建的文件。</p><p id="fb25" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在获取数据并将特定于服务的信息添加到 CSV 文件之前，我为 CSV 文件创建了一些合理命名的标题(列标题),并包含了一个换行符。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mv mw l"/></div></figure><h1 id="fdc2" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">查找数据并将其添加到不断增长的 CSV 文件中</h1><p id="c30d" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">第一个目标是找到第一个网球运动员。通过右键单击，然后检查，可以在 HTML 中找到网球运动员。使用 Chrome 中 developers 选项卡中的控制台工具，可以检查这个 Xpath 是否对应于诺瓦克·德约科维奇。Xpath 返回一个包含一个链接的列表。索引这个元素(第零个元素)，并使用 innerText 函数提取文本，返回网球运动员诺瓦克·德约科维奇。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mx"><img src="../Images/927abc52a42e473326af40a7e99699b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AAOKofqvBvpVar-KsVxaVw.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi my"><img src="../Images/f6ceee3ad9aa4d2f72c843ccc138b741.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*THxKZCq4d1Ged9nmUjV6WQ.png"/></div></div></figure><h1 id="4904" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">找到模式，找到所有玩家</h1><p id="7801" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">如图所示，特定于诺瓦克·德约科维奇的 Xpath 对应于第 1 行。通过简单地将这个数字改为 3，参数 sack 的(tr[3])应该返回罗杰·费德勒。控制台中的结果证实了这一点。进一步验证；如果表排是 5，tr[5]，网球选手应该是 Stefanos Tsitsipas。可以利用这种关系来收集前 20 名网球运动员的名字。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mz"><img src="../Images/c2eee913cc244235855caf7733774c00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RBk6DY7Dd2XWjsuqR4Jxqg.png"/></div></div></figure><p id="7d15" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这可以通过创建一个范围为 1 到 21 的 for 循环并用 I 替换数字来实现。</p><p id="6b64" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">为了进一步强化代码并防止任何超时异常，在网页加载缓慢的情况下，我将使用 WebDriverWait 类设置一个 20 秒的显式等待。在这里，浏览器和时间是这个类的必需参数。此外，我将一直等到 web 元素可见，然后使用带有 visibility_of_element_located 方法集的 expected conditions 类提取文本。</p><p id="ca22" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">此方法将定位器作为必需的参数。这是使用“By”指定的。xpath，后跟引号中的 XPATH。</p><p id="4540" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我把玩家名字写到 CSV 文件中，点击每个玩家的链接。然后，我提取球员转为职业球员的时间，并从这个数字中提取 2019 年，以确定他们迄今为止的职业生涯长度。同样，我将这些信息写入 CSV 文件。</p><p id="3fda" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在所有情况下，当我想要提取信息时，我会等到我感兴趣的特定元素是 web 页面上的可见性。这可以防止引发超时异常。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mv mw l"/></div></figure><h1 id="ef64" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">玩家统计</h1><p id="610e" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">为了收集球员的统计数据，我点击了球员统计选项卡，与该球员的“单一服务记录”相关的数据被返回。搜集这些数据很简单。同样，唯一改变的部分是表格行[]中的数字，例如 tr[1]告诉我德约科维奇发球得分多少，而 tr[10]告诉我德约科维奇赢得的发球得分总数。</p><p id="0f7e" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">我简单地遍历这些有组织的表格数据，提取所有球员的统计数据，并使用嵌套的 for 循环将它们写入 excel。为了使后面的工作更容易，我替换了所有的逗号字符或%符号字符，这样数字数据操作就更容易了。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi na"><img src="../Images/5a3e92c483f1b568ecd69061e0d31ce1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4nozxaGsFbc1A80u_Fhjag.png"/></div></div></figure><p id="08ec" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在这些数据被抓取并写入 Excel 后，我导航回到 singles 页面开始另一个迭代。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="4fb6" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">为了让我了解脚本的进度，我导入了<strong class="lt iu"> tqdm </strong>，它打印了一个动态更新的进度条，并在我的范围内包装了这个函数。在下面的例子中，我可以看到进度是 40 %, 20 次迭代中有 8 次已经完成，还剩 1:17 分钟。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nb"><img src="../Images/b63856759b7f1fd5494d606e0512c9c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pj1GRUXfDDDrhuRUKX1ZsA.png"/></div></div></figure><p id="7428" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">在 Excel 中打开 Tennis _ player _ details _ scrape . CSV 文件，显示已经获得了所有数据。现在可以使用 Pandas 库过滤数据。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nc"><img src="../Images/6a0ec058f16f0330f78abb8722312935.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PQKu-eJAMl6uh7BeUSgnmg.png"/></div></div></figure><h1 id="ea35" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">熊猫服务数据过滤</h1><p id="4734" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">单打发球数据现在可以修改进行分析。首先，我读入 Dataframe，检查它的形状和列，并使用 head()方法打印前 10 行。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mv mw l"/></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nd"><img src="../Images/d9b2ffebb31a189fa853846cc667838f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ntq-rcM7d51GH3NI1vtgoA.png"/></div></div></figure><p id="1068" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">为了确认所有数据都正确对齐，我执行了一些验证。举个例子，让我们以亚历山大·兹维列夫为例，检查一下他的一发率是否真的是 63%,在他的网球生涯中，到目前为止他已经面临了 1815 个破发点。事实上，这些信息结合在一起，如上面和下面突出显示的部分所示。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ne"><img src="../Images/65e14109c514a5f49d47462da0913998.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wI-r7wO-LlN3JYkOjchMhg.png"/></div></div></figure><h1 id="b789" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">按获胜的发球游戏排序</h1><p id="a64b" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">当决定谁是最好的发球者时，一个关键的决定因素是根据发球得分对网球运动员进行分类。</p><p id="e16f" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">为此，我将从抓取的 Dataframe 中提取两列，名为 df，创建一个名为 rankings 的新列，然后使用 sort_values 方法根据“Service_Games_won”列中的值对网球运动员进行排序。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="7145" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">返回的名为“网球发球”的数据显示，尽管目前世界排名第 15 位，但约翰·伊斯内尔的发球胜率最高。Milos Roanic 的发球胜率位居第二，但世界排名第 19 位。</p><p id="0aa4" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">世界排名第一的诺瓦克·德约科维奇排名第五，而罗杰·费德勒和大卫·戈芬各自的世界排名与他们在发球比赛获胜百分比表中的位置相匹配。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nf"><img src="../Images/e66c2a86b706f99e64b72c734adc99a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-NXEx71gDyvxdtmcON5gSw.png"/></div></div></figure><h1 id="11cd" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">服务指数</h1><p id="815a" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">虽然发球胜率最高的网球运动员可能是 ATP 巡回赛男子最佳发球者的最佳决定因素，但让我们使用一些其他收集的数据，创建一个简单的发球指数</p><p id="fd58" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">这个指数将合并和平均；第一发球、赢得的第一发球得分、赢得的第二发球得分和挽救的破发点百分比。我在原始数据帧 df 中为此创建了一个新列，然后获取球员列和新创建的发球指数列，添加排名列，最后根据发球指数对前 20 名网球运动员进行排序。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mv mw l"/></div></figure><p id="4174" class="pw-post-body-paragraph lr ls it lt b lu mn ju lw lx mo jx lz ma mp mc md me mq mg mh mi mr mk ml mm im bi translated">约翰·伊斯内尔再次位居榜首，世界排名第一，诺瓦克·德约科维奇排名第六。显然，德约科维奇比赛的其他方面肯定让他成为目前的 ATP 世界第一。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/412f94eef1561b2a932bd620360d7f04.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OEeBCS-k3oQv5YpvuWrUXw.png"/></div></div></figure><h1 id="ee0f" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">摘要</h1><p id="cf59" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">这个抓取教程演示了如何将抓取的数据制成数据帧，以便使用 Pandas 库进行查询。在这里，洞察最好的网球发球在男子比赛中可以确定。</p></div></div>    
</body>
</html>