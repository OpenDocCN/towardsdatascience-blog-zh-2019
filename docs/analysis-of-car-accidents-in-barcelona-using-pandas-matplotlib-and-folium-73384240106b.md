# 使用 Pandas、Matplotlib 和 lyum 分析巴塞罗那的车祸

> 原文：<https://towardsdatascience.com/analysis-of-car-accidents-in-barcelona-using-pandas-matplotlib-and-folium-73384240106b?source=collection_archive---------3----------------------->

巴塞罗那开放数据是巴塞罗那的数据服务，包含约 400 个数据集，涵盖广泛的主题，如人口，商业或住房。该项目诞生于 2010 年，主要目标是最大限度地利用可用的公共资源，允许公司、公民、研究人员和其他公共机构利用生成的数据。

在本文中，我们采用了包含 2017 年巴塞罗那市当地警方管理的**起事故的数据集。该数据集包括按严重程度划分的受伤人数、涉及的车辆数量、日期和事故的地理位置等信息。**

[](https://opendata-ajuntament.barcelona.cat/data/en/dataset/accidents-gu-bcn) [## 巴塞罗那市地方警察管理的事故-巴塞罗那开放数据

### 巴塞罗那市当地警方处理的事故清单。将受伤人数纳入…

open data-a jument . Barcelona . cat](https://opendata-ajuntament.barcelona.cat/data/en/dataset/accidents-gu-bcn) 

由于数据集是加泰罗尼亚语的，我们将使用 Kaggle 中可用的英语版本。

[](https://www.kaggle.com/xvivancos/barcelona-data-sets#accidents_2017.csv) [## 巴塞罗那数据集

### 下载数千个项目的开放数据集+在一个平台上共享项目。探索热门话题，如政府…

www.kaggle.com](https://www.kaggle.com/xvivancos/barcelona-data-sets#accidents_2017.csv) 

# 探索性数据分析和数据清理

**探索性数据分析**包括分析数据集的主要特征，通常采用**可视化方法**和**汇总统计**。目标是理解数据，发现模式和异常，并在我们执行进一步评估之前检查假设。

从 Kaggle 下载 csv 文件后，我们可以使用[**Pandas . read _ CSV**](https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.read_csv.html)函数将其加载到 Pandas dataframe 中，并使用 [**pandas 可视化前 5 行。data frame . head**](https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.head.html)**方法。**

**![](img/fdec0dca13ac3f1f9db44b021a1b9dc2.png)**

**正如我们所观察到的，数据帧包含 15 列:Id、地区名称、邻居、街道、工作日、月、日、小时、一天的一部分、轻伤、重伤、受害者、涉及的车辆、经度、纬度。**

**我们可以很容易地使用 [**熊猫来打印带有列名的列表。**data frame . columns](https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.columns.html)方法。另外，[号**熊猫。DataFrame.info**](https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.info.html) 方法提供关于 DataFrame 的信息，包括列类型、非空值和内存使用情况。**

**![](img/2f5c2b2ff9c18405daa316d5d74d8559.png)**

**显然，没有空值，因为所有列都有 10339 个条目。但是，有些条目包含字符串 Unknown。我们可以用非数字替换这个字符串，并通过使用 [**熊猫来再次评估空值的数量。DataFrame.info**](https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.info.html) 方法。**

**![](img/e3d2e37e427c53b5760b2ad3abca71df.png)**

**正如我们所看到的，只有列 District Name 和 Neighborhood Name 包含空值。因为我们在进一步的分析中不打算使用这些列，所以我们不需要考虑空值。我们不会用区名和街坊名来分析事故发生在哪里，而是用经纬度来分析。**

**在我们开始使用我们的数据得出结论之前，我们要清理它。第一步清理包括删除不必要的列以简化数据帧。**

**删除列后，我们修改了一些数据类型。我们可以通过使用 [**pandas 来查阅数据类型。data frame . info**](https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.info.html)**方法或**熊猫。DataFrame.dtypes** 属性。后者返回包含每列数据类型的序列。****

****![](img/3a85eba7ae5bd0aa3f01b0ac04db2221.png)****

****正如我们所观察到的，月、日和小时不是日期时间对象。我们可以使用[**pandas . to _ datetime**](https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.to_datetime.html)函数轻松地将这些列合并成一列。在使用这个函数之前，我们修改列名，用下划线代替空格，用小写字母代替大写字母。此外，我们还包括一个年份栏。****

****![](img/92840fc3922e5f89aa14808a80558e5f.png)****

****现在，我们可以将工作日、月、日、小时和年合并到一个名为 date 的列中。为了避免值错误，我们必须在使用[**pandas . to _ datetime**](https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.to_datetime.html)函数之前将月份名称转换成整数。****

****转换后，我们可以使用上述函数获得日期时间列，如下所示:****

****![](img/d95ef2b505dd34faebf7d9630ea73b38.png)****

****通过使用**熊猫，我们可以很容易地检查日期列的数据类型。DataFrame.dtypes** 属性。****

****要访问日期的单个元素，如月、日或小时，我们可以使用 [**熊猫。Series.dt** 属性。我们甚至可以通过使用](https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.dt.html) [**熊猫来访问星期几。Series.dt.dayofweek**](https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.dt.dayofweek.html) 属性，其中星期一=0，星期日=6。💪****

****![](img/f36334124037f8d25d81e6c88020bda5.png)****

****因为我们可以使用 [**pandas 访问我们需要的与事故日期相关的所有信息。Series.dt**](https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.dt.html) 属性，我们可以删除月、年、小时、日和星期几列，因为不再需要它们。****

****最后，我们也可以删除街道列，因为我们将只使用经度和纬度来可视化事故发生的位置。****

****![](img/5413059a795844d60074f957eef9f4ef.png)****

****如上所示，获得的数据帧包含 8 列:id、轻伤、重伤、受害者、涉及的车辆、经度、纬度和日期。****

****为了方便地访问有关车祸的信息，我们将把 id 设置为数据帧的索引，删除 id 条目前面的尾随空格。****

****![](img/95687dd8587f8405732e14b7c6c19281.png)****

****最后的清理步骤包括评估数据帧中是否有重复条目。如果是这样，我们将从数据框中移除这些重复的条目，因为它们代表相同的车祸。****

****![](img/bb19e0fd9112f4557b3246841f1afa5b.png)****

****数据清理完成！！👏现在！我们准备回答问题，并利用我们的数据得出结论。👌 🍀****

# ****回答问题并得出结论****

******探索性数据分析**和**数据清理**是让我们对数据集有所了解并准备好数据集以便使用它轻松得出结论的步骤。现在！我们准备使用数据集回答以下问题。****

# ****时间分析****

## ****2017 年巴塞罗那警方登记了多少起事故？****

****我们用 [**熊猫就能轻松获得巴塞罗那登记的事故总数。DataFrame.shape**](https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.shape.html) 属性，因为数据帧的每个条目都代表一次不同的车祸。****

****2017 年，巴塞罗那警方登记了 10330 起事故。****

## ****每月车祸分布****

****为了分析每月车祸的分布，我们雇佣了 [**熊猫。DataFrame.groupby** 函数。groupby 操作包括拆分对象、应用函数和组合结果的组合。首先，我们按月分组，然后我们计算每个月的事故数量。我们可以通过使用如下柱状图轻松解释结果:](https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.groupby.html)****

****![](img/e6dcc2834066de022447d68e2034dcbf.png)********![](img/ff43e8e8c4acdf44625fc45105d1ade0.png)****

****正如我们所观察到的，事故数量在八月和十二月减少了。一个原因可能是这几个月开车上班的人少了。****

## ****一周中每天的车祸分布****

****正如我们对月份所做的那样，我们也可以通过使用条形图来分析车祸在一周中的分布情况。****

****![](img/760ceb8f49c33cae8aaad2640665f616.png)****

****如上图所示，周末车祸数量减少了。工作日平均每天发生 1656 起车祸，比周末多 600 起左右(平均每天 1025 起车祸)。****

****下一幅图描绘了一年中每天的事故数量。正如我们所观察到的，每天有 10-50 起事故，周五的事故数量通常比周日的事故数量高得多。****

****![](img/ff58862a0994c0028f5b090641c1934e.png)****

## ****每小时车祸分布****

****按照与之前相同的程序，我们根据时间绘制这次车祸的分布。****

****![](img/3a6e6f60dcb1b395197d163973b86f45.png)****

****正如我们在图中所观察到的，更多的事故发生在清晨 8-9 点和 12-20 点之间。****

## ****一周内每天和每小时的车祸分布****

****我们还可以使用并排条形图来分析一周中每天和每小时的事故数量。在这种特殊情况下，我们使用一个水平图来更好地可视化。****

****![](img/520b933517c284e9e2c2af4e27d13c66.png)****

****正如我们很容易观察到的，周末晚上发生的事故比平日多。相反，工作日从清晨(8)到下午(19)的交通事故比周末多得多。****

## ****时间分析—结论****

1.  ****8 月份是 2017 年车祸数量最低的月份，为 651 起。接下来的几个月里会发生 800-900 起事故。****
2.  ****周末车祸的数量减少了。****
3.  ****更多的车祸发生在(8-9)和(12-20)。****
4.  ****大多数事故发生在周末的晚上。****

****我们总是可以根据不同的时间变量进行分组，并创建更复杂的图，以便提取关于时间相关性的更复杂的模式和结论。****

# ****事故分析的类型****

****我们正在分析的数据包含与(1)事故日期，(2)事故类型，(3)事故地点相关的信息。关于事故类型，数据框包括诸如受害者人数、事故中涉及的车辆数量以及伤害类型(轻微或严重)等信息。和以前一样，我们可以用柱状图来检验所有这些变量的分布。****

## ****涉及的车辆****

****前面的图按照涉及车辆的数量描绘了 2017 年的事故数量。在大多数事故中，涉及两辆车(2017 年 7028 起事故)。此外，警方记录了涉及多达 14 辆车的车祸；但是，车辆多的车祸并不常见。****

****![](img/bdc277c9902fffa6e8b3fb2bde9f3d06.png)****

## ****轻度——严重伤害****

****数据框包括关于在每起车祸中有多少受害者遭受轻度和重度伤害的信息。我们可以很容易地用饼图表示轻度和重度伤害的百分比，如下所示:****

****![](img/29828146fd0a59fa6a6c725367d9a24b.png)****

****剧情显示只有 2%的伤是重伤。虽然车祸中的大多数伤害都是轻微的，但分析在何种情况下(时间、日期、地点)严重伤害更频繁会很有趣。****

****下图显示了一周中各天的受伤百分比。轻度伤害遵循一个预期的模式，因为在工作日，当更多的事故发生时，他们呈现较高的比率。然而，尽管周末的平均事故数量(1656 起)低于平日(1025 起)，但严重伤害在周末的发生率很高。这表明周末的事故往往比平日更严重。****

****![](img/87f9691b5b214fcd23ae644c6457d187.png)****

****我们还可以根据小时绘制受伤的百分比。****

****![](img/0a12a52fbb5265a49ec898e82772928b.png)****

****正如我们所观察到的，事故往往在深夜和夜间更加严重。****

## ****事故分析类型——结论****

****(1)在大多数事故中，涉及 1、2 或 3 辆车。巴塞罗那警方在 2017 年登记的车祸中，涉及的车辆多达 14 辆。****

****(2)2017 年车祸受伤的人，大部分是轻伤(98%)。****

****(3)事故往往在夜间、深夜和周末更加严重。****

# ****位置分析****

****分析空间数据的最佳方式是使用地图。**follow**是一个 python 库，可以帮助你创建几种类型的传单地图。我们可以很容易地生成巴塞罗纳的地图，创建一个**叶子地图对象**。**位置**参数允许将地图置于特定位置的中心(在我们的例子中是巴塞罗纳)。我们还可以提供一个**初始缩放级别**到那个位置，将地图缩放到中心。****

****![](img/090eadc4acdf1dc9c1a2e26c3f8c62c4.png)****

****尽管有初始缩放级别，但生成的地图是交互式的，这意味着您可以轻松地放大和缩小。****

****数据集包括每起车祸的经纬度。我们可以很容易地用圆圈标记来形象化它们。下图显示了造成严重伤害的事故，通过弹出标签显示了严重伤害的数量。****

****![](img/bf89e35442c5def9b0f38f9dcbc35c4c.png)****

****在 flour 中，我们还可以使用 **MarkerCluster** 对象将标记分组到不同的簇中。下面的情节描述了和以前一样的有严重受伤的受害者的车祸，但是这次事故被分组。****

****![](img/3bf44d0239b9e93f933c7a235f0ef460.png)****

******叶子**的一个显著特点是可以创建动画热图，根据特定维度(如小时)改变显示的数据。我们可以通过使用 **HeatMapWithTime()** 类方法轻松实现这一点。首先，我们创建一个嵌套列表，其中每个位置都包含特定小时内所有车祸的经度和纬度。例如，hour_list[0]包含从 00:00:00 到 00:59:00 发生的车祸(例如，hour_list[0] → [[lat1，lon1]，[lat2，lon2]，[lat3，lon3]，…，[latn，logn])。然后，我们调用方法并将其添加到地图中。****

****![](img/2c9305bcd9e4b6837ca29b07acef78f2.png)****

****查看上面的时间线，我们可以观察到事故数量如何从 8 小时开始增加，一直保持高水平，直到 21 小时开始下降。****

****感谢阅读！！！😊 🍀****