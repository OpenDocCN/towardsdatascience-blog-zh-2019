# 数据科学家如何买车

> 原文：<https://towardsdatascience.com/how-a-data-scientist-buys-a-car-822fffbe384d?source=collection_archive---------15----------------------->

在荷兰生活和工作多年后，我和我的家人是时候搬回美国，用自行车换汽车了。

在美国没有车是很难生活的，因为我们在移居国外之前已经卖掉了我们的车，所以我们现在想买一辆新车。我决定像任何优秀的数据科学家一样，通过使用数据来解决这个问题。

**获取数据**

很多时候，数据科学项目最困难的部分是获取数据。尤其是如果只是一个副业的话。很可能你无法从网上下载 CSV 文件，没有任何数据，你就无法建立任何模型或做出任何预测。

*网页抓取拯救*

![](img/9b9d6b370a1d4c748a1fce171639a765.png)

Developer tools in google chrome

网络抓取是以自动化的方式从网站获取数据的过程。我不是网络抓取的专家，这篇文章也不是设计成如何抓取网站的教程。但是通过一点点实践和理解某些 python 模块是如何工作的，您可以实现您最疯狂的数据幻想。

在这个项目中，我使用了一个叫做 *Selenium* 的 python 包，这是一个无头浏览器。这意味着它会打开一个网页，并以类似于真实用户的方式与之交互(*与 BeautifulSoup 之类的只是读取 HTML 代码的东西相反)。*

Google chrome 的开发工具使这个过程变得非常简单，因为你可以右键单击网页中你感兴趣的项目，并轻松复制 xpath、element_id 或任何其他你想要的内容，所有这些都与 Selenium 包配合得非常好。有时需要一点尝试和错误来找到您真正需要的元素和文本。

你可以在这里找到我用来刮几百辆车[的代码。](https://github.com/willcasey/car_buying)

**清理数据**

网络抓取数据的一个问题是，最终结果很可能非常混乱，需要你做大量的清理工作，因为你受网站设计的支配，网站设计是为了呈现信息而不是数据存储。很多时候你需要解析字符串来得到你想要的东西。

在将我的 web 抓取过程的结果保存到 CSV 之后，我现在可以将数据加载到 pandas dataframe 中并开始清理了。

![](img/19e869a77c573a16b2a72ee797c5fb24.png)

随着 lambda 和 regex 函数的大量使用，我可以开始提取有用的信息，并开始创建特性来探索和建模。

首先，我创建了一个可重用的正则表达式函数，可以将它传递给。应用熊猫法。

A reusable regex function

“name”列有很多有用的数据，我可以使用我创建的函数从中创建四个新的特性。

我现在得到了一个类似这样的数据帧:

![](img/95bc720b24c977078dba7c370128eb9f.png)

**探索数据**

现在是时候开始做一些更有趣的事情了，那就是探索数据。这是数据科学过程中至关重要的一步，这样您就可以开始了解您的数据及其趋势和相互作用。价格将是我的目标变量，所以我在设计我的图表时会考虑到这一点。

![](img/fd75581107b1cba9c87b29a14a4039db.png)![](img/27ffa29705a3a42bbdb0ba7a51ec218b.png)

这些箱线图在我的一些分类变量中显示了非常清晰的信号，表明根据车辆的年份和类型，价格有很大的差异。

![](img/9fcab62ea758e4858f020198b7e508ff.png)

同样，我发现我的一个解释变量(里程)和目标变量之间有很强的相关性。随着里程数的增加，价格下降，两者之间有很强的负相关关系。知道了我们对汽车世界的了解，这很有意义。

通过查看我们的一些解释变量和目标变量之间的关系，我们可以开始很好地了解哪些特性将是重要的，以及我们以后应该使用哪种类型的模型。

*编码分类特征*

建模前的另一步是对我的分类特征进行编码。*【4wd】*和*【认证】*已经是布尔特征，不再需要任何预处理，但是*【类型】*和【年份】应该被编码。我用的是熊猫一热编码法(。get_dummies)来实现这一点。

Pandas 足够聪明，允许我传递所有的特征，它将只对分类特征进行编码，并允许我选择删除一个新创建的列，以避免完全相关的特征。这将导致我的模型输出和解释出现错误。(*请注意，只有两个年份列，因为 year_2015 已被删除。同样适用于“类型”栏*

![](img/a348540856d890ecb89b8a9a504de2fa.png)

我的数据现在是我可以建模的格式。

**建模数据**

从上面的图表和汽车行业的先验知识来看，线性模型似乎很可能会很好地处理这些数据。

为了对此建模，我使用了 *OLS(普通最小二乘法)线性回归模型*和 *statsmodel* python 包。

![](img/cf5d80a869d4b04baff08296d5097fcf.png)

This model resulted in a RSME of 1556.09

所得到的系数与探索性分析期间图中显示的故事相一致。里程与价格成反比。平均每增加 1000 英里，车辆价格就会降低 1600 美元(这适用于 GMC Yukons，可能并非所有车辆)。可能最令人震惊的数字是 SLE(Yukon 的最低等级)和 Denali(Yukon 的最高等级)之间的差异超过 9000 美元。这意味着你最好真的喜欢你从更高阶层获得的额外功能和奢侈品，因为你肯定为此付出了代价。

综合考虑，我应该买哪辆车？

到目前为止，我已经收集、清理、解析、探索、可视化和建模了这些数据。但问题仍然存在，我怎么知道买哪辆车？我如何知道我是否得到了一笔好交易？

方法很简单，使用模型进行预测，并计算每辆车的预测价格和要价之间的差异。然后根据差异对列表进行排序，在顶部显示最被低估的工具。这应该给你的车辆是最好的交易。

在优化了一些其他约束条件(例如，我的个人预算和我妻子的偏好)后，我能够创建一个排序列表，并开始给经销商打电话。

![](img/5d5962f5cf7c837945f5a2452f73d8e2.png)

The car we bought is highlighted in blue

我们最终以 32，000 美元的价格买了一辆 2015 款 GMC Yukon Denali，比我的模型预测的价格便宜了大约 3，000 美元。

虽然有一些潜在的更好的交易，我们决定购买的汽车是本地的，使整个过程更容易和更快。考虑到我们当时根本没有车，轻松和快捷对我们来说是一个重要因素。

![](img/56724c3d057331720a36d5477012e794.png)

最后，我们现在可以重温之前的情节，从视觉上确认我们确实得到了一笔好交易！

我妻子非常喜欢她的新车，我对它的价格也很满意。总的来说，这是成功的。