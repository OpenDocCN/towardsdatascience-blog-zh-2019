<html>
<head>
<title>Automate Your ML Model Tuning and Selection using AutoML in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Python 中的 AutoML 自动调整和选择 ML 模型</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/automate-your-ml-model-tuning-and-selection-2f8c0b6992ce?source=collection_archive---------31-----------------------#2019-10-21">https://towardsdatascience.com/automate-your-ml-model-tuning-and-selection-2f8c0b6992ce?source=collection_archive---------31-----------------------#2019-10-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="78c1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在同一数据集上测试不同的 ML 方法以评估模型性能可能是一项单调乏味的任务。此外，正确调整深度学习模型可能需要几个小时，如果不是几天的话。幸运的是，在过去的十年中，人们一直在努力开发自动化 ML 模型选择和调整的方法。虽然目前可用的开源解决方案并不是银弹(也不应该这样对待！)，在构建 ML 或 DL 模型时使用 AutoML 可以节省大量的时间，至少可以为您指出最佳模型的正确方向。在这篇文章中，我回顾了 Python 中目前可用的一些 AutoML 实现，并提供了具体的例子(包括代码！).</p><p id="f33d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Python 中目前可用于自动化模型选择和调优的一些选项如下(<a class="ae ko" href="https://www.ml4aad.org/automl/" rel="noopener ugc nofollow" target="_blank"> 1 </a>):</p><ol class=""><li id="2872" class="kp kq it js b jt ju jx jy kb kr kf ks kj kt kn ku kv kw kx bi translated">H2O 一揽子计划</li><li id="46f3" class="kp kq it js b jt ky jx kz kb la kf lb kj lc kn ku kv kw kx bi translated">auto-sklearn 包</li><li id="faec" class="kp kq it js b jt ky jx kz kb la kf lb kj lc kn ku kv kw kx bi translated">TPOT 一揽子计划</li></ol><p id="3051" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在本帖中，我们将回顾 H2O 包和 TPOT 包中的 AutoML 功能。可惜 auto-sklearn 只在 Linux 操作系统上可用(我没有)，所以就不覆盖了。</p><h1 id="bd59" class="ld le it bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">数据</h1><p id="28bc" class="pw-post-body-paragraph jq jr it js b jt mb jv jw jx mc jz ka kb md kd ke kf me kh ki kj mf kl km kn im bi translated">在这篇文章中，我们将使用通过 UCI 机器学习知识库获得的一个众所周知的数据集，<a class="ae ko" href="https://archive.ics.uci.edu/ml/datasets/breast+cancer" rel="noopener ugc nofollow" target="_blank">乳腺癌数据集</a>，根据各种因素对癌症是否复发进行分类(二进制结果为 0 或 1)。潜在的预测变量包括患者的年龄(分类变量——分箱),患者是否已经绝经(分类变量),以及肿瘤大小(分类变量——分箱)等。数据集的快照如下所示:</p><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi mg"><img src="../Images/21bd32b4511125903f5ecf56da5f5441.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Av0V7Kqz60aId9Ws"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk"><em class="mw">Snapshot of the breast cancer data, available via the UCI repository</em></figcaption></figure><p id="cff1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在我们通过任何 autoML 函数运行数据之前，让我们稍微清理一下。主要是，我们使用 sklearn 的 LabelEncoder()函数将所有的分类变量转换成数字(使用标签编码对 H2O 来说不是必需的，但对 TPOT 来说是必需的):</p><figure class="mh mi mj mk gt ml"><div class="bz fp l di"><div class="mx my l"/></div></figure><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi mz"><img src="../Images/95207b6a76d591f868aebe79f37d058d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*XQPbIZL36LT98_wm"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk"><em class="mw">Data after being label-encoded</em></figcaption></figure><p id="2db7" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">现在我们有了一个干净的数据集，可以使用了，让我们对它运行 AutoML。</p><h1 id="63f0" class="ld le it bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">H20 的汽车</h1><p id="de86" class="pw-post-body-paragraph jq jr it js b jt mb jv jw jx mc jz ka kb md kd ke kf me kh ki kj mf kl km kn im bi translated"><a class="ae ko" href="http://docs.h2o.ai/h2o/latest-stable/h2o-docs/welcome.html" rel="noopener ugc nofollow" target="_blank"> H20 </a>是一个开源的 ML 库，允许用户快速构建、测试和生产 ML 模型。H2O 的 AutoML 功能可以自动为训练数据集选择最佳 ML 或 DL 模型。该软件包非常通用和强大。</p><h1 id="8e21" class="ld le it bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">下载 H20</h1><p id="4844" class="pw-post-body-paragraph jq jr it js b jt mb jv jw jx mc jz ka kb md kd ke kf me kh ki kj mf kl km kn im bi translated"><a class="ae ko" href="http://docs.h2o.ai/h2o/latest-stable/h2o-docs/downloading.html" rel="noopener ugc nofollow" target="_blank">这个链接</a>包含了为 Python 下载 H20 的说明。该软件包需要一些必须预先安装的依赖项。提供了使用 Anaconda 和普通 Python 进行安装的指导。</p><h1 id="fe2d" class="ld le it bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">在我们的数据集上运行 H2O 的 AutoML</h1><p id="e6e5" class="pw-post-body-paragraph jq jr it js b jt mb jv jw jx mc jz ka kb md kd ke kf me kh ki kj mf kl km kn im bi translated">我们使用以下代码对数据集执行 H2O AutoML:</p><figure class="mh mi mj mk gt ml"><div class="bz fp l di"><div class="mx my l"/></div></figure><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi na"><img src="../Images/844e0aef381c920d6409a35a7505601c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*mH-PQL1DkG7HsWzM"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk"><em class="mw">A snapshot of the leaderboard for H2O’s AutoML results</em></figcaption></figure><p id="c273" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如上图所示，控制台中会出现最合适型号的排行榜。根据排行榜的结果，我们表现最好的模型是一般线性模型(GLM)，其次是梯度增强模型(GBM)。我们可以通过 H2O 的 model_performance()函数运行我们的测试数据来衡量 GLM 的性能，其中 aml.leader 是性能最好的模型:</p><figure class="mh mi mj mk gt ml"><div class="bz fp l di"><div class="mx my l"/></div></figure><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/4e4b74f188c11f63ed219e2646ef0f19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1298/0*BZEFoeHDF8Y7PFKV"/></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk"><em class="mw">Confusion matrix for test predictions, generated via H2O’s model_performance() function</em></figcaption></figure><p id="0fbd" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">基于上述混淆矩阵，该模型的总体准确率约为 83%，召回率约为 73%，准确率为 87.5%。考虑到我们在通过 AutoML 运行数据集之前实际上没有对其进行预处理，这是一个惊人的结果。</p><h1 id="3047" class="ld le it bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">TPOT 汽车公司</h1><p id="90dd" class="pw-post-body-paragraph jq jr it js b jt mb jv jw jx mc jz ka kb md kd ke kf me kh ki kj mf kl km kn im bi translated">TPOT，或基于树的流水线优化工具，是最早开发的 AutoML 方法之一。兰德尔·奥尔森博士在宾夕法尼亚大学计算遗传学实验室工作时开发了 TPOT。TPOT 的主要目标是通过基因编程实现 ML 流水线的自动化。TPOT 自动化流程图如下所示(<a class="ae ko" href="https://github.com/EpistasisLab/tpot" rel="noopener ugc nofollow" target="_blank"> 3 </a>):</p><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi nc"><img src="../Images/e7d95b0cdbfac88f53b93a79858e9465.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Hpv0tarXquvpWovy"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk"><em class="mw">The ML pipeline as automated by the TPOT package (</em><a class="ae ko" href="https://github.com/EpistasisLab/tpot" rel="noopener ugc nofollow" target="_blank"><em class="mw">3</em></a><em class="mw">)</em></figcaption></figure><p id="4509" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">正如你在上面的示意图中看到的，TPOT 的 AutoML 功能可以自动完成 ML 管道后数据清理。流水线中的具体自动化步骤包括特征选择和预处理、模型选择和参数优化。</p><h1 id="3be6" class="ld le it bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">为 Python 下载 TPOT</h1><p id="1f48" class="pw-post-body-paragraph jq jr it js b jt mb jv jw jx mc jz ka kb md kd ke kf me kh ki kj mf kl km kn im bi translated">TPOT 的功能依赖于 scikit-learn，所以你需要安装 sklearn(如果你还没有)和 TPOT 来使用 TPOT 的 AutoML 功能:</p><pre class="mh mi mj mk gt nd ne nf ng aw nh bi"><span id="372a" class="ni le it ne b gy nj nk l nl nm">pip install sklearn <br/>pip install tpot</span></pre><h1 id="a4a7" class="ld le it bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">使用 TPOT 的 AutoML 函数</h1><p id="41c4" class="pw-post-body-paragraph jq jr it js b jt mb jv jw jx mc jz ka kb md kd ke kf me kh ki kj mf kl km kn im bi translated">我们将使用 H2O 汽车公司示例中使用的相同癌症数据集，再次预测癌症是否会复发(“类别”列)。我们通过 run_tpot_automl()函数运行标签编码的数据集:</p><figure class="mh mi mj mk gt ml"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="5f2a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">该代码输出一个名为 tpot_classifier_pipeline.py 的 python 文件。该文件包含模型的优化 ML 管道:</p><figure class="mh mi mj mk gt ml"><div class="bz fp l di"><div class="mx my l"/></div></figure><p id="75a1" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我们对自动输出文件进行了一些编辑，并返回预测的测试结果以及相关的混淆矩阵:</p><figure class="mh mi mj mk gt ml"><div class="bz fp l di"><div class="mx my l"/></div></figure><figure class="mh mi mj mk gt ml gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/57517a29e6fd0e9513a8d7bc8bc83bb6.png" data-original-src="https://miro.medium.com/v2/resize:fit:486/0*ZtHst5BP3qml_zvo"/></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk"><em class="mw">Confusion matrix of test outputs.</em></figcaption></figure><p id="232e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在检查所选 AutoML 模型的结果时，一个额外的树分类器(一个随机森林的变体)，总的模型精度是 83%。模型召回率为 75%，准确率约为 84%。与 H2O AutoML 模型的结果几乎完全相同，但精度得分较低。</p><h1 id="2ebe" class="ld le it bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">不同的包装如何堆叠</h1><p id="614c" class="pw-post-body-paragraph jq jr it js b jt mb jv jw jx mc jz ka kb md kd ke kf me kh ki kj mf kl km kn im bi translated">如果您正在对一个模型进行 AutoML 采样，我建议尝试这两个包，因为您的结果可能与本文中的结果不同。就每个方案而言，以下是我观察到的利弊:</p><p id="6743" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu"> H2O 汽车</strong></p><p id="f154" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">优点:</p><ol class=""><li id="1721" class="kp kq it js b jt ju jx jy kb kr kf ks kj kt kn ku kv kw kx bi translated">易于下载</li><li id="1597" class="kp kq it js b jt ky jx kz kb la kf lb kj lc kn ku kv kw kx bi translated">几乎不需要数据预处理(标签编码是不必要的，因为它与 TPOT)</li><li id="b3d0" class="kp kq it js b jt ky jx kz kb la kf lb kj lc kn ku kv kw kx bi translated">结果很容易解释</li><li id="b4cf" class="kp kq it js b jt ky jx kz kb la kf lb kj lc kn ku kv kw kx bi translated">选择最佳型号时，对各种 ML 和 DL 类型进行采样</li></ol><p id="08a9" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">缺点:</p><ol class=""><li id="1bbc" class="kp kq it js b jt ju jx jy kb kr kf ks kj kt kn ku kv kw kx bi translated">Spyder 是我的首选 IDE(可以通过 Anaconda 发行版获得)，它不会显示 H2O 输出。H2O 必须在 Jupyter 笔记本或同等电脑上运行，才能显示排行榜结果。</li></ol><p id="ec9f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">TPOT 汽车</p><p id="6bed" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">优点:</p><ol class=""><li id="f128" class="kp kq it js b jt ju jx jy kb kr kf ks kj kt kn ku kv kw kx bi translated">结果是高度可解释的，并且生成包含最佳 ML 管道的自动化文件。</li><li id="f712" class="kp kq it js b jt ky jx kz kb la kf lb kj lc kn ku kv kw kx bi translated">易于下载。</li></ol><p id="742d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">缺点:</p><ol class=""><li id="ec9e" class="kp kq it js b jt ju jx jy kb kr kf ks kj kt kn ku kv kw kx bi translated">需要进行更多的数据预处理，才能将数据集转换成可接受的格式来运行 AutoML。</li><li id="6bf3" class="kp kq it js b jt ky jx kz kb la kf lb kj lc kn ku kv kw kx bi translated">至少在这个例子中，不如 H2O 的 AutoML 精确。<em class="no">然而，这可能是一次性的，当使用其他数据集进行采样时，结果可能会有所不同。</em></li></ol><p id="3975" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">我的 Python AutoML 包教程到此结束。感谢阅读！本教程的完整代码可通过我的个人 Github repo 获得:</strong><a class="ae ko" href="https://github.com/kperry2215/automl_examples/blob/master/automl_example_code.py" rel="noopener ugc nofollow" target="_blank"><strong class="js iu">https://Github . com/kperry 2215/automl _ examples/blob/master/automl _ example _ code . py</strong></a></p><p id="34b8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">看看我的其他一些机器学习文章:</strong></p><div class="np nq gp gr nr ns"><a href="https://techrando.com/2019/08/23/unsupervised-machine-learning-approaches-for-outlier-detection-in-time-series/" rel="noopener  ugc nofollow" target="_blank"><div class="nt ab fo"><div class="nu ab nv cl cj nw"><h2 class="bd iu gy z fp nx fr fs ny fu fw is bi translated">时间序列中离群点检测的无监督机器学习方法</h2><div class="nz l"><h3 class="bd b gy z fp nx fr fs ny fu fw dk translated">包括示例 Python 代码！在这篇文章中，我将介绍一些我最喜欢的检测时间序列中异常值的方法…</h3></div><div class="oa l"><p class="bd b dl z fp nx fr fs ny fu fw dk translated">techrando.com</p></div></div><div class="ob l"><div class="oc l od oe of ob og mq ns"/></div></div></a></div><div class="np nq gp gr nr ns"><a href="https://techrando.com/2019/08/14/a-brief-introduction-to-change-point-detection-using-python/" rel="noopener  ugc nofollow" target="_blank"><div class="nt ab fo"><div class="nu ab nv cl cj nw"><h2 class="bd iu gy z fp nx fr fs ny fu fw is bi translated">使用 Python - Tech Rando 进行变化点检测简介</h2><div class="nz l"><h3 class="bd b gy z fp nx fr fs ny fu fw dk translated">我的很多工作都大量涉及时间序列分析。我使用的一个很棒但不太为人所知的算法是…</h3></div><div class="oa l"><p class="bd b dl z fp nx fr fs ny fu fw dk translated">techrando.com</p></div></div><div class="ob l"><div class="oh l od oe of ob og mq ns"/></div></div></a></div><h1 id="f0e6" class="ld le it bd lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma bi translated">来源</h1><ol class=""><li id="91cb" class="kp kq it js b jt mb jx mc kb oi kf oj kj ok kn ku kv kw kx bi translated">AutoML。从 https://www.ml4aad.org/automl/<a class="ae ko" href="https://www.ml4aad.org/automl/" rel="noopener ugc nofollow" target="_blank">取回</a></li><li id="f0a9" class="kp kq it js b jt ky jx kz kb la kf lb kj lc kn ku kv kw kx bi translated">AutoML:关于自动机器学习的信息。从 http://automl.info/tpot/<a class="ae ko" href="http://automl.info/tpot/" rel="noopener ugc nofollow" target="_blank">取回</a></li><li id="bd18" class="kp kq it js b jt ky jx kz kb la kf lb kj lc kn ku kv kw kx bi translated">TPOT:一个 Python 自动机器学习工具，使用遗传编程优化机器学习管道。从 https://github.com/EpistasisLab/tpot<a class="ae ko" href="https://github.com/EpistasisLab/tpot" rel="noopener ugc nofollow" target="_blank">取回</a></li></ol></div><div class="ab cl ol om hx on" role="separator"><span class="oo bw bk op oq or"/><span class="oo bw bk op oq or"/><span class="oo bw bk op oq"/></div><div class="im in io ip iq"><p id="e15d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="no">原载于 2019 年 10 月 21 日 https://techrando.com</em><em class="no">T21</em><a class="ae ko" href="https://techrando.com/2019/10/21/automate-your-ml-model-tuning-and-selection-a-review-of-different-python-automl-packages/" rel="noopener ugc nofollow" target="_blank">。</a></p></div></div>    
</body>
</html>