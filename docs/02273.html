<html>
<head>
<title>FuzzyWuzzy: How to Measure String Distance on Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">FuzzyWuzzy:如何在 Python 上测量字符串距离</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/fuzzywuzzy-how-to-measure-string-distance-on-python-4e8852d7c18f?source=collection_archive---------14-----------------------#2019-04-15">https://towardsdatascience.com/fuzzywuzzy-how-to-measure-string-distance-on-python-4e8852d7c18f?source=collection_archive---------14-----------------------#2019-04-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/f50d93551cdae4a4a8938a35fdf16016.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fqkZcyIfzFzwCSVCOzthFA.jpeg"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Some fuzzy plant leaves. Source: <a class="ae kc" href="https://pixabay.com/photos/lambs-ear-texture-fuzzy-plant-53664/" rel="noopener ugc nofollow" target="_blank">Pixabay</a>.</figcaption></figure><p id="ae40" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">Python 的<em class="lb"> FuzzyWuzzy </em>库用于测量两个字符串之间的相似性。以下是你也可以开始使用它的方法。</p><p id="4c6d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有时候，我们需要看两个字符串是否相同。当将输入的密码与你的登录数据库中存储的密码进行比较时，“相似性”是不够的。</p><p id="b616" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然而，其他时候，事情会变得有点… <em class="lb">模糊</em>。</p><p id="ea3d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果我的顾客的名字是<em class="lb">艾伯特·汤普森</em>，但是他用一张名为<em class="lb">艾伯特·g·汤普森</em>的信用卡付款，我应该报警举报欺诈吗？《魔戒 2:双塔》和《魔戒 2:双塔》是否应该被一个网站当做两部完全独立的书？奥地利和澳大利亚真的是两个不同的国家吗？</p><p id="8617" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">好吧，我可能被最后一个问题冲昏了头脑，但是你明白了。</p><h1 id="f78f" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">字符串距离度量</h1><p id="4e6b" class="pw-post-body-paragraph kd ke iq kf b kg ma ki kj kk mb km kn ko mc kq kr ks md ku kv kw me ky kz la ij bi translated">我们想要的是一个测量两个字符串有多相似的函数，但是对小的变化是健壮的。这个问题听起来很普通:科学家们已经想出了很长时间的解决方案。</p><h1 id="1bb2" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">雅克卡距离:第一种方法</h1><p id="591d" class="pw-post-body-paragraph kd ke iq kf b kg ma ki kj kk mb km kn ko mc kq kr ks md ku kv kw me ky kz la ij bi translated">最直观的一个就是 Jaccard 距离。它可以推广到任意两个集合的距离度量。它通过以下公式进行测量:</p><figure class="mg mh mi mj gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mf"><img src="../Images/766e3875f053a13a492f8ffa5c052600.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*_arWl5hyO57620y9.png"/></div></div></figure><p id="b50f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">也就是说，有多少个元素在任一集合上，但不被两者共享，除以不同元素的总数。</p><p id="b0b5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">例如，给定字符串“Albert”和“Alberto”，它将报告 85.7%的相似性，因为它们共享总共 7 个字母中的 6 个。</p><p id="c957" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然而，这不是一个专门为字符串定制的措施。</p><p id="bcc0" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它将在许多用例中失败，因为它没有真正考虑排序。例如，两个变位词，如“铁路安全”和“童话”，总是 100%匹配，即使这些字符串完全不同。</p><h1 id="4288" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">莱文斯坦距离</h1><p id="60ba" class="pw-post-body-paragraph kd ke iq kf b kg ma ki kj kk mb km kn ko mc kq kr ks md ku kv kw me ky kz la ij bi translated">俄罗斯科学家 Vladimir Levenshtein 在 60 年代发明了这种方法，这种方法更加直观:它计算需要多少次替换，给定一个字符串<em class="lb"> u </em>，将其转换为<em class="lb"> v </em>。</p><p id="7a28" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">对于这种方法，替代被定义为:</p><ul class=""><li id="1686" class="mk ml iq kf b kg kh kk kl ko mm ks mn kw mo la mp mq mr ms bi translated">擦除字符。</li><li id="c29c" class="mk ml iq kf b kg mt kk mu ko mv ks mw kw mx la mp mq mr ms bi translated">添加一个。</li><li id="9dff" class="mk ml iq kf b kg mt kk mu ko mv ks mw kw mx la mp mq mr ms bi translated">用一个字符替换另一个字符。</li></ul><p id="123b" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">需要对<em class="lb"> u </em>进行的这些操作的最小数量，以便将其转换为<em class="lb"> v，</em>对应于这两个串之间的 Levenshtein 距离。</p><p id="16c4" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">它可以通过以下公式递归获得:</p><figure class="mg mh mi mj gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi my"><img src="../Images/f7ac10dd318a9ba610a969d5c24ef7f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*kWblkNhdDJ7XWthC.jpg"/></div></div></figure><p id="92b5" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">其中<em class="lb"> i </em>和<em class="lb"> j </em>是我们将要比较的子串的最后一个字符的索引。如果这些字符不同，最后一个表达式中的第二项等于 1，如果相同，则等于 0。</p><p id="faf1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这是 Python 的 FuzzyWuzzy 库使用的度量。</p><h1 id="319a" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">在 Python 中使用 FuzzyWuzzy</h1><p id="2651" class="pw-post-body-paragraph kd ke iq kf b kg ma ki kj kk mb km kn ko mc kq kr ks md ku kv kw me ky kz la ij bi translated">要获得两个字符串之间的相似率，我们要做的就是:</p><pre class="mg mh mi mj gt mz na nb nc aw nd bi"><span id="be1c" class="ne ld iq na b gy nf ng l nh ni">from fuzzywuzzy import fuzz</span><span id="20c4" class="ne ld iq na b gy nj ng l nh ni">similarity = fuzz.ratio("hello","world")</span></pre><p id="fdd9" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">你可能注意到了我说的比率。ratio 方法将总是返回一个介于 0 和 100 之间的数字(是的，我更希望它介于 0 和 1 之间，或者称之为百分比，但是各有各的)。</p><p id="56ef" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">可以证明，Levenshtein 距离至多是最长字符串的长度:用较长字符串的第一部分替换较短字符串中的所有字符，然后添加其余的字符。</p><p id="7aac" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这就是我们如何将距离归一化以返回一个比率，以便在给定不同大小的输入的情况下，该数字不会大幅波动。</p><p id="35fa" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这解决了前面提到的一些问题:</p><pre class="mg mh mi mj gt mz na nb nc aw nd bi"><span id="d4e3" class="ne ld iq na b gy nf ng l nh ni">fuzz.ratio("Albert Thompson", "Albert G. Thompson") #91%</span><span id="41b0" class="ne ld iq na b gy nj ng l nh ni">fuzz.ratio("The Lord of the Rings II: The Two Towers",<br/>           "The Lord of the Rings 2: the 2 Towers") #88%</span></pre><p id="6d52" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">即使这可能会带来一些新的问题:</p><pre class="mg mh mi mj gt mz na nb nc aw nd bi"><span id="9c1d" class="ne ld iq na b gy nf ng l nh ni">#88% for two different countries<br/>fuzz.ratio("Austria","Australia")</span><span id="0635" class="ne ld iq na b gy nj ng l nh ni">#57% but it's the same country<br/>fuzz.ratio("Czechia","Czech Republic")</span></pre><h1 id="67a4" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">其他模糊不清的方法</h1><p id="d4dc" class="pw-post-body-paragraph kd ke iq kf b kg ma ki kj kk mb km kn ko mc kq kr ks md ku kv kw me ky kz la ij bi translated">Python 的 FuzzyWuzzy 库不仅为我们提供了普通的 Levenshtein 距离，还提供了一些我们可以利用的其他方法。</p><h2 id="263d" class="ne ld iq bd le nk nl dn li nm nn dp lm ko no np lq ks nq nr lu kw ns nt ly nu bi translated">部分比率</h2><p id="bfdb" class="pw-post-body-paragraph kd ke iq kf b kg ma ki kj kk mb km kn ko mc kq kr ks md ku kv kw me ky kz la ij bi translated"><em class="lb"> partial_ratio </em>方法用较短字符串的长度计算较长字符串的所有子字符串的 FuzzyWuzzy 比率，然后返回最高匹配。</p><p id="1dc6" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">举个例子，</p><pre class="mg mh mi mj gt mz na nb nc aw nd bi"><span id="c08c" class="ne ld iq na b gy nf ng l nh ni">fuzz.partial_ratio("abc","a") == <br/>      min([fuzz.ratio( char, "a") for char in "abc"])</span></pre><p id="0692" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这有一些有趣的影响:</p><pre class="mg mh mi mj gt mz na nb nc aw nd bi"><span id="40ac" class="ne ld iq na b gy nf ng l nh ni">fuzz.partial_ratio("Thomas and His Friends", "Thomas") #100%</span><span id="01d3" class="ne ld iq na b gy nj ng l nh ni">fuzz.partial_ratio("Batman vs Superman", "Batman") #100%</span></pre><p id="8670" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">实际上，partial_ratio 方法可以是对【T2 包含】字符串方法的模糊替换，就像常规比率可以替换【T4 等于】方法一样。</p><p id="5d83" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">但是，对于相似但单词出现顺序不同的字符串，它将失败。即使是轻微的顺序变化也会破坏它。</p><pre class="mg mh mi mj gt mz na nb nc aw nd bi"><span id="edb2" class="ne ld iq na b gy nf ng l nh ni">#72% with basically the same idea<br/>fuzz.partial_ratio("Peanut Butter and Jelly", <br/>                   "Jelly and Peanut Butter")<br/> <br/>#86% with a random (carefully selected) string<br/>fuzz.partial_ratio("Peanut Butter and Jelly", "Otter and Hell")</span></pre><h2 id="4b32" class="ne ld iq bd le nk nl dn li nm nn dp lm ko no np lq ks nq nr lu kw ns nt ly nu bi translated">令牌 _ 排序 _ 比率</h2><p id="032b" class="pw-post-body-paragraph kd ke iq kf b kg ma ki kj kk mb km kn ko mc kq kr ks md ku kv kw me ky kz la ij bi translated">Token Sort Ratio 将两个字符串分成单词，然后在对它们调用常规 Ratio 之前，再次按字母数字顺序将它们连接起来。</p><p id="5277" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这意味着:</p><pre class="mg mh mi mj gt mz na nb nc aw nd bi"><span id="ea28" class="ne ld iq na b gy nf ng l nh ni">fuzz.partial_ratio("Batman vs Superman", "Superman vs Batman") #100%</span><span id="d74b" class="ne ld iq na b gy nj ng l nh ni">fuzz.partial_ratio("a b c", "c b a") #100%</span></pre><h2 id="40ad" class="ne ld iq bd le nk nl dn li nm nn dp lm ko no np lq ks nq nr lu kw ns nt ly nu bi translated">令牌 _ 集合 _ 比率</h2><p id="9882" class="pw-post-body-paragraph kd ke iq kf b kg ma ki kj kk mb km kn ko mc kq kr ks md ku kv kw me ky kz la ij bi translated">记号集比率将每个字符串分成单词，将两个列表都变成集合(丢弃重复的单词)，然后在进行比率之前对它们进行排序。</p><p id="df40" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这样，我们不仅排除了共享单词，还考虑到了重复。</p><pre class="mg mh mi mj gt mz na nb nc aw nd bi"><span id="deac" class="ne ld iq na b gy nf ng l nh ni">fuzz.token_set_ratio("fun","fun fun fun") #100%</span><span id="ea3a" class="ne ld iq na b gy nj ng l nh ni">fuzz.token_set_ratio("Lord the Rings of", "Lord of the Rings") #100%</span></pre><h1 id="56a4" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">结论</h1><p id="cdb8" class="pw-post-body-paragraph kd ke iq kf b kg ma ki kj kk mb km kn ko mc kq kr ks md ku kv kw me ky kz la ij bi translated">Python 的 FuzzyWuzzy 库是一个非常有用的工具。无论是对于客户的姓名匹配，还是充当穷人的单词嵌入，都可以省去你很多麻烦，或者对你的机器学习模型的特征工程有帮助。</p><p id="7673" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然而，由于它需要预处理(比如将两个字符串都转换成小写)，并且不考虑同义词，所以对于可能需要实际 NLP 或<a class="ae kc" href="https://strikingloo.github.io/wiki-articles/machine-learning/clustering" rel="noopener ugc nofollow" target="_blank">聚类方法</a>的情况，它可能不是最佳解决方案。</p><p id="6ae1" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我希望这篇文章对你有所帮助，如果你在工作中发现 FuzzyWuzzy 的其他用途，请告诉我！</p><p id="4b3c" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="lb">关注我的</em><a class="ae kc" href="http://www.twitter.com/strikingloo" rel="noopener ugc nofollow" target="_blank"><em class="lb">Twitter</em></a><em class="lb">或</em><a class="ae kc" href="http://medium.com/@strikingloo" rel="noopener"><em class="lb">Medium</em></a><em class="lb">了解更多 Python 教程、技巧和窍门。</em></p><p id="585f" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="lb">你可以在我的</em> <a class="ae kc" href="https://strikingloo.github.io/blog/" rel="noopener ugc nofollow" target="_blank"> <em class="lb">个人网站</em> </a> <em class="lb">中看到我正在做的事情以及我最近的文章和笔记。</em></p></div></div>    
</body>
</html>