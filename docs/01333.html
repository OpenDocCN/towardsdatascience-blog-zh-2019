<html>
<head>
<title>Feature Engineering Time</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">特征工程时间</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/feature-engineering-time-3934038e0dbe?source=collection_archive---------10-----------------------#2019-03-03">https://towardsdatascience.com/feature-engineering-time-3934038e0dbe?source=collection_archive---------10-----------------------#2019-03-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="be31" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">计算圆形/周期性特征的统计数据。</h2></div><blockquote class="kf kg kh"><p id="572e" class="ki kj kk kl b km kn jr ko kp kq ju kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">在本帖中，我们将讨论一种处理周期性特征的数学方法。<br/>这可用于计算平均值。<br/>(例如 23:50，22:40，00:30 的平均时间是多少？)<br/>它也是聚类的一个有用的距离度量。<br/>(比如 00:01 比 00:10 更接近 23:59，能不能优雅地解决这个？)<br/>同样的方法在特征工程中证明是有用的，例如 ML 模型的圆形特征<strong class="kl ir">“一天中的时间”</strong>或<strong class="kl ir">“一年中的一天”</strong>或<strong class="kl ir">“方位角”</strong>。</p></blockquote><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi lf"><img src="../Images/711bc9a1c5e9fe4bbbf7e9bf83cd8660.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iSI6q8BKD2USFvo-wR_byQ.png"/></div></div></figure><h2 id="ea5a" class="lr ls iq bd lt lu lv dn lw lx ly dp lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">问题:</h2><ol class=""><li id="4b94" class="mn mo iq kl b km mp kp mq ma mr me ms mi mt le mu mv mw mx bi translated">根据事件时间对事件进行聚类。</li><li id="7ab6" class="mn mo iq kl b km my kp mz ma na me nb mi nc le mu mv mw mx bi translated">当一天中的时间是重要特征时，学习一些结果的模型。</li><li id="b653" class="mn mo iq kl b km my kp mz ma na me nb mi nc le mu mv mw mx bi translated">计算每个用户完成一个动作几次的典型时间。</li></ol><h2 id="216d" class="lr ls iq bd lt lu lv dn lw lx ly dp lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">一个有问题的问题:</h2><p id="6056" class="pw-post-body-paragraph ki kj iq kl b km mp jr ko kp mq ju kr ma nd ku kv me ne ky kz mi nf lc ld le ij bi translated">你如何处理集群中跨越到第二天的事件？一些用户可能是夜猫子或来自另一个时区；如果他们的活动持续到午夜，数学就变得更难了。<br/>如果用户在 23:57、23:58 和 23:59 发送消息，计算平均值是简单的。用户迟到一分钟怎么办？显然我们不想把 00:00 加到平均值上。<br/>假设您正试图预测某个依赖于一天中某个时间的结果，一个简单的模型(回归)将在午夜遭遇中断。</p><h1 id="1e11" class="ng ls iq bd lt nh ni nj lw nk nl nm lz jw nn jx md jz no ka mh kc np kd ml nq bi translated">尝试 1，暴力:</h1><p id="321a" class="pw-post-body-paragraph ki kj iq kl b km mp jr ko kp mq ju kr ma nd ku kv me ne ky kz mi nf lc ld le ij bi translated">让我们假设我们的用户必须在某个时刻离线，在某个时刻有一个边界，在其附近没有任何活动。<br/>然后我们可以“移动”到那个时区，添加几个小时来将日期边界放在空白处。</p><h2 id="7e97" class="lr ls iq bd lt lu lv dn lw lx ly dp lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">问题:</h2><p id="efff" class="pw-post-body-paragraph ki kj iq kl b km mp jr ko kp mq ju kr ma nd ku kv me ne ky kz mi nf lc ld le ij bi translated">我们可能有遍布全球的用户，他们有不同的活动模式，我们需要找到每个用户的时移。往好里说，这是非常低效的，往坏里说，这可能是不可能的。更糟糕的是，如果我们的假设是错误的呢？如果我们看不到活动和不活动之间如此清晰的界限，会怎么样？</p><h1 id="48e9" class="ng ls iq bd lt nh ni nj lw nk nl nm lz jw nn jx md jz no ka mh kc np kd ml nq bi translated">灵感:平均风向。</h1><figure class="lg lh li lj gt lk gh gi paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="gh gi nr"><img src="../Images/9c497bff4f8653289ec152517a93b08f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gddtekcMiyyHFu9dC3zEIw.jpeg"/></div></div><figcaption class="ns nt gj gh gi nu nv bd b be z dk">Wind direction off the East coast.</figcaption></figure><p id="e838" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr ma kt ku kv me kx ky kz mi lb lc ld le ij bi translated">看着风的地图，我们对风的平均方向(和大小)有很好的直觉。</p><p id="5f84" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr ma kt ku kv me kx ky kz mi lb lc ld le ij bi translated">359 和 1 之间的任意区别丝毫不会困扰我们，因为我们取的是向量平均值。当我们用手指指向一个方向时，360°的数学跳跃并不重要。</p><p id="2fa7" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr ma kt ku kv me kx ky kz mi lb lc ld le ij bi translated">我们如何将这种直觉形式化？让我们把方向描述为一个二维向量(x，y)，而不是一个单一的标量，也就是“航向”。</p></div><div class="ab cl nw nx hu ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="ij ik il im in"><h1 id="541b" class="ng ls iq bd lt nh od nj lw nk oe nm lz jw of jx md jz og ka mh kc oh kd ml nq bi translated">是的，让我们做那件事，有时间</h1><p id="169f" class="pw-post-body-paragraph ki kj iq kl b km mp jr ko kp mq ju kr ma nd ku kv me ne ky kz mi nf lc ld le ij bi translated">让我们将时间映射到 24 小时制的圆周上</p><div class="lg lh li lj gt ab cb"><figure class="oi lk oj ok ol om on paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><img src="../Images/3a94b9f1374742d2630964cb5743b8dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:656/format:webp/1*dWvUz9Kha-fpFqNE8Or21A.png"/></div></figure><figure class="oi lk oo ok ol om on paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><img src="../Images/6d3e05bd3152086b96783bb567cc75be.png" data-original-src="https://miro.medium.com/v2/resize:fit:702/format:webp/1*Sq5yGYdVxsq5-MbcXUZaBQ.png"/></div></figure><figure class="oi lk op ok ol om on paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><img src="../Images/82795635a40d1f40bd14a9e95fb8324b.png" data-original-src="https://miro.medium.com/v2/resize:fit:646/format:webp/1*vDi3vM_Bz6rauv0fzUppxw.png"/></div><figcaption class="ns nt gj gh gi nu nv bd b be z dk oq di or os">The geometric representation of time of day lends itself to geometric clustering, averaging. (Code to generate these if you want to play around with them is provided in a notebook linked below.)</figcaption></figure></div><p id="a4bb" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr ma kt ku kv me kx ky kz mi lb lc ld le ij bi translated">如果我们想要聚类，我们在 2d 空间(x，y)中聚类。如果要取平均值，就取点(重心)的几何平均值。<br/>如果我们想在模型中使用时间作为特征，我们使用向量，(x，y)。</p><h2 id="477e" class="lr ls iq bd lt lu lv dn lw lx ly dp lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">当平均值不在圆上时会发生什么。</h2><p id="f4dd" class="pw-post-body-paragraph ki kj iq kl b km mp jr ko kp mq ju kr ma nd ku kv me ne ky kz mi nf lc ld le ij bi translated">尽管多于一个点的任何平均值都在圆内；范围越大，平均值离圆周越远。</p><div class="lg lh li lj gt ab cb"><figure class="oi lk ot ok ol om on paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><img src="../Images/7b3ac3ecf4f22e5b42c627109f931f86.png" data-original-src="https://miro.medium.com/v2/resize:fit:644/format:webp/1*dWvUz9Kha-fpFqNE8Or21A.png"/></div></figure><figure class="oi lk ou ok ol om on paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><img src="../Images/ca577fe7c83deeba1a24c5b4eb3e1f62.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*qcD9WgogQLXkI1CiJ-UtdA.png"/></div></figure><figure class="oi lk ov ok ol om on paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><img src="../Images/e3c23ba9602a3f9895011de80a0e2b3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:690/format:webp/1*bgUDG0bQH-BorRr976VIQQ.png"/></div><figcaption class="ns nt gj gh gi nu nv bd b be z dk ow di ox os"><strong class="bd oy">Left</strong>: with small variance, the center is very close to the circle’s edge and shows the average time; <strong class="bd oy">Center</strong>: the high variance of the points puts the center inside the circle. The direction of the center indicates the average time, in this case 3:00. <strong class="bd oy">Right</strong>: A measure that is analogous to standard deviation can be derived by examining the arc defined by the chord that is bisected by that center.</figcaption></figure></div><h1 id="2d80" class="ng ls iq bd lt nh ni nj lw nk nl nm lz jw nn jx md jz no ka mh kc np kd ml nq bi translated">摘要</h1><p id="663b" class="pw-post-body-paragraph ki kj iq kl b km mp jr ko kp mq ju kr ma nd ku kv me ne ky kz mi nf lc ld le ij bi translated">通过将一天中的时间映射到代表 24 小时的 2D 圆，我们可以缓解时针从 23 到 0 时出现的不连续性。<br/>这也适用于一年中的<strong class="kl ir">天</strong>，或者实际的<strong class="kl ir">方向</strong>。</p><p id="8794" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr ma kt ku kv me kx ky kz mi lb lc ld le ij bi translated">这个新的 2D 向量(可以简单地是模型中的两列)表现得非常自然，它定义了一个将 23:59 和 00:01 放在一起的度量。同样，它把 12 月 31 日和 1 月 1 日放在一起。NNE 和 NNW 不关心它们在 360 — (0)的不同侧</p><p id="f7d4" class="pw-post-body-paragraph ki kj iq kl b km kn jr ko kp kq ju kr ma kt ku kv me kx ky kz mi lb lc ld le ij bi translated">这些不连续点一开始是任意的，但是只要我们只用一个维度，它们就一定会出现在某个地方。在 2D，一切又变得美好起来。</p><h1 id="63ee" class="ng ls iq bd lt nh ni nj lw nk nl nm lz jw nn jx md jz no ka mh kc np kd ml nq bi translated">代码:</h1><p id="0ccd" class="pw-post-body-paragraph ki kj iq kl b km mp jr ko kp mq ju kr ma nd ku kv me ne ky kz mi nf lc ld le ij bi translated">你可以克隆这个笔记本来玩代码。(还包含 pySpark 计算平均值的可行示例。)</p><h1 id="0f1f" class="ng ls iq bd lt nh ni nj lw nk nl nm lz jw nn jx md jz no ka mh kc np kd ml nq bi translated">附录，数学和操作方法:</h1><p id="2483" class="pw-post-body-paragraph ki kj iq kl b km mp jr ko kp mq ju kr ma nd ku kv me ne ky kz mi nf lc ld le ij bi translated"><strong class="kl ir">把时间映射</strong>到圆周上很简单。</p><ol class=""><li id="86db" class="mn mo iq kl b km kn kp kq ma pa me pb mi pc le mu mv mw mx bi translated">把时间转换成一个单一的数字[0，24]{或者[0，1]，这可能是免费的}所以 12:36 可能是 12.6 {或者 0.525}。</li><li id="e970" class="mn mo iq kl b km my kp mz ma na me nb mi nc le mu mv mw mx bi translated">然后将这个数字乘以 15，得到 360。{或 360 度}</li><li id="6826" class="mn mo iq kl b km my kp mz ma na me nb mi nc le mu mv mw mx bi translated">然后取<strong class="kl ir"> <em class="kk"> Sin </em> </strong>和<strong class="kl ir"> <em class="kk"> Cos </em> </strong>得到<strong class="kl ir"> <em class="kk"> Y </em> </strong>和<strong class="kl ir"> <em class="kk"> X </em> </strong>坐标。(开心注:SQL 有三角函数，别忘了换算成弧度)</li><li id="0df6" class="mn mo iq kl b km my kp mz ma na me nb mi nc le mu mv mw mx bi translated">要计算平均值，只需独立取<strong class="kl ir"> <em class="kk"> X </em> </strong>和<strong class="kl ir"> <em class="kk"> Y </em> </strong>的平均值。</li><li id="be79" class="mn mo iq kl b km my kp mz ma na me nb mi nc le mu mv mw mx bi translated">使用<strong class="kl ir"><em class="kk"/></strong>(E(<strong class="kl ir"><em class="kk">Y</em></strong>)、E( <strong class="kl ir"> <em class="kk"> X </em> </strong>))变换回时间，然后反向变换(弧度到角度，取消拉伸到 24H)</li></ol><h2 id="815d" class="lr ls iq bd lt lu lv dn lw lx ly dp lz ma mb mc md me mf mg mh mi mj mk ml mm bi translated">奖金，标准发展:</h2><ol class=""><li id="ec23" class="mn mo iq kl b km mp kp mq ma mr me ms mi mt le mu mv mw mx bi translated">用给出的勾股定理<strong class="kl ir"> <em class="kk"> X </em> </strong>和<strong class="kl ir"> <em class="kk"> Y </em> </strong>计算半径，<strong class="kl ir"> <em class="kk"> r </em> </strong>。</li><li id="67fe" class="mn mo iq kl b km my kp mz ma na me nb mi nc le mu mv mw mx bi translated">代表标准差的圆弧由<strong class="kl ir">arccos</strong>(<strong class="kl ir"><em class="kk">r</em></strong>)给出。证明这一点是留给读者的练习。</li></ol></div></div>    
</body>
</html>