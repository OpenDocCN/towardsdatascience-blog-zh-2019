# 特拉维夫艺术家:为自己打造一款地图应用

> 原文：<https://towardsdatascience.com/tel-aviv-artists-build-yourself-a-mapping-app-218c21428915?source=collection_archive---------8----------------------->

![](img/766f812361ef88de93040f76332daf18.png)

TL；dr-I 从尝试地图库到构建可重用的[地图应用](https://compute-5-6-18.appspot.com/)。这是我如何做到的，你也可以如何重复使用它。

# 介绍

作为一名数据科学家，我的大部分工作都停留在幕后。在训练模型时，我接触的最多的是部署一个简单的 flask web-app 作为 REST APIs。

最近，部署工具变得更加友好、快捷和高效。你看，如果你想为用户开发一个应用程序，即使是为了演示的目的，一个最小化的 UI 可以是一个很好的起点。

最近偶然发现了 [**这个**](/building-web-app-for-computer-vision-model-deploying-to-production-in-10-minutes-a-detailed-ec6ac52ec7e4) 的例子，用于机器学习模型部署和 UI。它有许多部署选项的教程，以及一个用于图像识别的基本 UI。您可以找到许多数据科学家正在使用这个例子，并将其用于他们的分类算法。

这一次，我决定走出我的舒适区，并进一步“扩展”这个例子。

# 这个概念

如果你在以色列的特拉维夫漫步，你可能会看到一些标志，比如这个:

![](img/25c684179ae2bec4a4673cb94be3f110.png)

这块纪念牌位于特拉维夫的伊本·格维罗尔街 30 号，上面写着大卫·佩尔洛夫(David Perlov)曾在这座房子里生活和工作，他是以色列艺术家和电影制作人的先驱。

以色列是一个非常年轻的国家，因此，它的许多历史艺术活动都发生在以色列的第一个城市特拉维夫的一个小地方。

如果你对艺术和漫游感兴趣，围绕这些景点做一次自助游可能会很有趣。

不幸的是，我找不到任何提供某种界面的在线页面来让你自己选择一条旅游路线。

所以，我决定去做。

你们中没有多少人知道，但我有一个老想法，至少利用一些网上可获得的海量地理数据，并创建某种虚拟导游，这将自动生成未知城市的步行路线，或已知城市的原始步行路线。这个任务有点雄心勃勃，所以我决定从小处着手:这些记忆牌将是我进入地图世界的机会。

# 步骤 1:高级设计

虽然弄脏你的手总是很诱人，但我首先需要思考这个项目的最终目标是什么:这当然不会是一个成熟的生产应用程序，而是一个原型玩具，允许用户进行某种程度的探索。

![](img/1bd7976050ce6cd95bbe3b8c2791d558.png)

Schematic plot of the project

更准确地说，我希望用户能够:

1.  将斑块视为地图上的标记。
2.  获取一些关于他们的信息。
3.  获得检查站之间的简单**行进路线**。
4.  所有这些都在用户可访问的网络应用程序中(不是 python 笔记本)

所以我需要:

1.  数据分析工具
2.  映射工具
3.  Web 框架:客户端和服务器端。
4.  部署服务。

很多事情要做！

当然，这些定义并不严格，但它们描述了我心目中的最小项目。

也是选择发展战略的好时机。这种高层次的选择将伴随我们整个工作。客观地说，我认为他们最好的选择是客户端语言——JavaScript。然而，作为一名数据科学家，我的强项是 **python** ，所以我选择尽可能多地使用它。这个选择将迫使我使用服务器，因为 python 不能在浏览器中有效使用。

幸运的是，有像样的 pythonic 式 **web 框架**，比如 Flask。

# 第二步:数据分析

为了达到上述目标，我必须解决一些任务:

1.  获取数据
2.  视觉化是
3.  创建 UI 界面

在这一页[http://cafe.themarker.com/post/3124888/](http://cafe.themarker.com/post/3124888/)，有一个相当混乱的所有艺术家及其地址的列表。

很容易将艺术家列表及其地址粘贴到文本文件中，并解析到更友好的表格中。

现在是更难的部分。

我做了以下工作:

1.  将数据保存在 2 个文件中
2.  项目用句号分隔，因此很容易将它们分开。
3.  每个项目都包括名称、地址和简短描述。它们用逗号分开，但比之前的方式更混乱
4.  总共有大约 180 位艺术家上榜
5.  如前所述，大约有 20%的条目用逗号分隔不好。
6.  一些缺少逗号
7.  有些带有额外的逗号，主要是在描述中

**解决方案:**

1.  因为地址应该有数字，所以它可以是一个指示器
2.  将拆分并整理成地址和姓名(可能有一两个遗漏了，但我们必须接受)
3.  将所有清理过的地址发送到地理定位器 API 以获取位置坐标。由于各种原因，并非所有(20)都将被正确返回，因此应该手动检索它们

拿到数据后，接下来的任务就是提取路点的坐标。显然，处理地理数据的正确方法是能够无缝地将用户友好的地址转换成计算机友好的地理位置。

这可以通过 GeoPy 实现——带有一些地理编码(place=> geocode=>place)功能的包，这可以节省一些 google APIs 积分。

![](img/de3a37d7460a80d50f90a41d0b5355c9.png)

Cleaned data with Geo-location

# 第三步:选择我们的武器

处理完大部分数据工作后，下一步就是**映射** **可视化和 UI** 。由于我已经决定使用 python 作为我的后端，我需要一些 python 工具，希望可以翻译成 html。有相当多的软件包可以内联绘制地图并将其另存为(有时是交互式的)。html 文件。但是，它们具有不同的特性和功能。有些需要使用高级谷歌地图 API，这意味着一些限制，除非你付费。

因此，我们希望我们的包装中包含以下内容:

1.  能够制作**交互式** html 地图或类似。
2.  绘图，**工具提示**，**弹出**功能。
3.  简单易用(有很多事情要做，不想浪费我所有的时间在贴图上)。
4.  最好**无限制** API 要求。
5.  **奖励**:额外功能，如搜索和路线

一个简单但健壮的包将使我的工作更快，用户体验更好。

因此，我继续进行了一个关于映射包的小研究。因为我的首选语言是 python，所以映射工具并不是最好的。这些是我体验过的工具，它们很 pythonic 很容易使用:

# 谷歌地图

谷歌地图值得拥有自己的版块，因为它是领先的地图工具。因此，能够通过 API 有效地使用它可以解决我们的大多数问题。然而，这是不可能的。谷歌提供的所有 API 都有一定的局限性:

1.  **谷歌地图服务 python**

这个包更像是 google maps API 的包装器，允许在 google maps 中检索大量可用数据，但我没有找到绘图功能，因此这个库不太相关。

2.**谷歌地图 url API**

这个工具非常容易使用，有动态和静态两种版本:

*   对于这个项目来说，**动态** google maps API 可能是最好的选择，然而，也许令人惊讶的是，它不支持太多选项，除了通过 google maps 用户界面提供的选项。因为我的需求之一是呈现一个有多个标记的地图，所以我在这里无法完全实现。

```
[https://www.google.com/maps/search/pizza+seattle+wa/@47.6257624,-122.331987,12z/data=!3m1!4b1](https://www.google.com/maps/search/pizza+seattle+wa/@47.6257624,-122.331987,12z/data=!3m1!4b1) - search pizza in seatle with google maps dynamic API
```

*   静态的谷歌地图 URL API——和上面的一样简单，有更多的选项，但是它是静态的，因此谷歌地图的一些动态功能被关闭了。然而，我发现这个工具对我来说是最有用的

如果你喜欢使用它，注意它需要一个 API 键，所以如果你不想被计费，你应该限制它(或者让用户插入他自己的)

例如[http://maps.google.com/maps/api/staticmap?center=shenkin，tel+aviv，Israel&zoom = 14&size = 512 x512&map type = roadmap&markers = color:blue | label:S | 32.072283，34.777474&sensor = false&key =<key>将生成此](http://maps.google.com/maps/api/staticmap?center=shenkin,tel+aviv,Israel&zoom=14&size=512x512&maptype=roadmap&markers=color:blue%7Clabel:S%7C32.072283,34.777474&sensor=false&key=AIzaSyCr0CAyB1DAuI0ANBjTjq3MXCkA0E2x0MI)

![](img/4e1199235e0763e97152a02e9cb9d337.png)

**3。我的地图谷歌应用**

谷歌的一个很好且必要的产品是“我的地图”,它允许你创建带有位置、标记等的个性化地图。然而，自从“[不可行](https://stackoverflow.com/questions/40488333/google-my-maps-api)以来，谷歌似乎没有为其提供 API

![](img/e60077dcab8e2ff82e571daaf494b2f4.png)

# Python 包

回到我们最喜欢的独立开源 python 库:

1.  **Gmplot**

一个简单漂亮的 python 包，负责一些基本的绘图功能，并输出一个 HTML 文件。这是唯一一个允许开箱即用绘图(在谷歌地图风格的地图上)的包，但是它的选项是有限的。任何类型的弹出窗口都是不可能的，

主要是所见即所得:圆圈，线条，标记，热图，就是这样。没有文字或路线。

优点——非常简单

缺点——过于简单，需要 Google API

![](img/a02c76a43bd80d87dcdb36d7611fe8a0.png)

回购+快速启动:[https://github.com/vgm64/gmplot](https://github.com/vgm64/gmplot)

**2。散景**

令人惊讶的是，好的结果来自一个与谷歌地图没有直接关系的包。散景映射模块有我们需要的一切，除了外观和感觉不是很光滑。

然而，这里也不可能有用户界面。

**3。叶子**

在几乎放弃 python 并开始使用 JS 之后，我偶然发现了这个伟大的库，它在 GitHub 上拥有超过 3.5K 的星级。基于 fleet . js 地图，看起来很棒，有高级绘图选项，不需要 google API。

leav 包括一些额外好特性:

*   Html 工具提示和弹出窗口
*   祖穆特的标记分组
*   许多不错的绘图选项
*   无缝导出到 html

那么**叶子**就是了！

![](img/6992e07c0ae5ff820121ce54baabb5ad.png)

Folium map

# 第四步:逻辑

所以我们有地图和标记。现在是时候做一些更聪明的事情了:路线规划。

我的任务是允许用户插入一个起始地址，并为他规划一条旅行路线。使用 google API，我们可以获得一条智能步行路线，但我将它留给了用户(换句话说，这超出了本项目的范围)，并且只显示指定位置之间的折线:

![](img/966f6edcfe3b86f19adc80453cccc730.png)

在接收地址时，有不同的算法可以找到最佳路径，但我选择使用简单的贪婪算法来找到最近的检查点。当达到限制(每小时 2 公里)时，脚本结束路线，并添加一条路径返回到起点，并在地图上以折线的形式显示所有内容。

简单不是吗？

你可以在 app.py 文件中找到所有的逻辑，在 [repo](https://github.com/shgidi/ta_mapping_app) 中的 calc_route 函数中。

# 步骤 5:实施/部署

因此，在我们将所有逻辑都准备好之后，就到了最具技术性的部分——部署。

这一部分对 web 开发人员来说很容易，但作为一名数据科学家，这是我尽量避免的部分。我最多是用 flask 应用程序包装我的模型，并把它放在一些云服务上。

在后端部分，我决定使用谷歌应用引擎。我主要使用谷歌云，所以对我来说更容易。尽管将 web-app 加载到这样一个托管服务上要比标准服务器慢得多，但它能处理许多我不愿接触的事情

至于前端，我把这个[回购](https://github.com/pankymathur/keras-vision-app)用于我的目的，做了如下改动:

1.  用 flask 代替 uvicon/starlette，因为我更熟悉 flask。
2.  一些明显的用户界面变化。
3.  我决定添加的功能需要一些 javascript 代码。

Javascript 很复杂:作为编程语言，它非常简单。然而，使用它，尤其是使用 flask，可能会很棘手，因为有许多活动部件。

甚至调试过程也不同，因为它需要在浏览器中来回检查应用程序。

我的策略是从模板开始，在谷歌上搜索我想要做的每一项改变当然并不容易，因为我不熟悉:

*   Iframes 的行为
*   在 html、python 和 javascript 之间来回传递数据，反之亦然

诸如此类。

1.  添加数据-添加标记后，我们想给用户添加一些额外的价值，添加谷歌地图图像和维基百科页面的摘录
2.  路径——目前它只是一个数据地图。我们将如何让它活起来？我认为添加一个简单的自流道路线计算算法会很好。一些我“以后可能会改进”的东西。逻辑将如下:您输入您的当前地址和您想要投入到您的旅行中的时间，系统将计算出满足所需条件的路线。这里的算法是贪婪的，不是最优的，并且路线目前是点之间的直线

# 6.构建您自己的地图

现在你可能会对自己说“我对‘特拉维夫’的艺术家没有任何兴趣。所以我给你准备了一个惊喜:你可以分叉我的[回购](https://github.com/shgidi/ta_mapping_app)，获得自己的地址，更改 **data.json** ，部署自己的映射工具！

你只需要有一个 gcloud 命令行工具，一个活跃的项目，如这里描述的，有了这个命令你就可以开始了:

```
gcloud app deploy
```

如果你做到了，请在评论里发帖。

如果你从笔记本开始，你可以使用位置和描述的列表，你有自己的智能旅行地图。

# 摘要

就是这样！我向您展示了，如果您知道自己在做什么，那么让脏数据集变得生动起来是一件简单而快速的事情。不幸的是，我花了很多时间才知道自己在做什么，或者换句话说，找到**叶**库。

如果你关注了这篇文章，你可能已经看到了为达到 MVP 所做的工作:许多可能的改进被遗漏了。但是，添加它们很容易:

*   更智能的路由算法
*   使用谷歌地图 API 生成实际路线，而不是折线
*   更好的弹出窗口设计等等。

我现在可以想到很多想法，但我不认为我会在未来几周内接触地图或 **js** ，但我鼓励你尝试:)