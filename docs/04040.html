<html>
<head>
<title>Monte Carlo Simulations: The Intersection of Probabilistic and Deterministic</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">蒙特卡罗模拟:概率性和确定性的交叉</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/monte-carlo-simulations-the-intersection-of-probabilistic-and-deterministic-2720a0b541b1?source=collection_archive---------12-----------------------#2019-06-25">https://towardsdatascience.com/monte-carlo-simulations-the-intersection-of-probabilistic-and-deterministic-2720a0b541b1?source=collection_archive---------12-----------------------#2019-06-25</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="789d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">你好，欢迎来到我的博客，我希望你能发现这对于蒙特卡洛模拟的介绍是有帮助的。这是一个简单的蒙特卡罗模拟的数学方法，用简单的图形来说明我的观点。这不是什么，深入到蒙特卡罗模拟非常具体和明确定义的行业问题。</p><p id="e2ed" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">这个蒙特卡洛模拟的数据和前提来自科罗拉多大学教授的 Coursera 的高级商业分析课程。最初，计算是在解析解算器上执行的，但是我决定将这个过程放到一个我(希望你也是)更习惯的环境中，Python。</p><p id="0e01" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">首先，我使用了概率性和确定性这两个词，我应该在本文的上下文中定义它们。</p><p id="d12e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">概率性的:可以用概率分布来量化的事物。有多少人会出现在他们的航班上？</p><p id="edfa" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">确定性的:可以从参数中计算出来的东西。例如，如果 150 人乘坐了一个有 134 个座位的航班，有多少人被挤到下一个航班？</p><p id="ddcc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">蒙特卡洛模拟可以说明确定性模型参数的不确定性(概率性质),产生可能结果的概率分布。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi kp"><img src="../Images/11c8b9c9aa33b98bfce17202b2b32409.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fa9aYaaqqiNfG8ip17-BSA.jpeg"/></div></div></figure><h1 id="fdb2" class="lb lc it bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">问题是</h1><p id="514a" class="pw-post-body-paragraph jq jr it js b jt lz jv jw jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn im bi translated">在任何给定的航班上，并不是所有的乘客都完成了利用他们购买的座位的过程。作为回应，航空公司通常会超额预订航班，以最大限度地提高座位利用率和收入。然而，如果超售率过高，乘客将不得不重新安排航班，航空公司的整体声誉将受到损害。</p><h2 id="8c8a" class="me lc it bd ld mf mg dn lh mh mi dp ll kb mj mk lp kf ml mm lt kj mn mo lx mp bi translated">目标:</h2><ul class=""><li id="d18b" class="mq mr it js b jt lz jx ma kb ms kf mt kj mu kn mv mw mx my bi translated">使用颠簸的乘客和收入成本，确定适当的超额预订率</li><li id="567b" class="mq mr it js b jt mz jx na kb nb kf nc kj nd kn mv mw mx my bi translated">确定任何给定航班的收入</li></ul><h2 id="9ddf" class="me lc it bd ld mf mg dn lh mh mi dp ll kb mj mk lp kf ml mm lt kj mn mo lx mp bi translated">吉文斯:</h2><ul class=""><li id="973c" class="mq mr it js b jt lz jx ma kb ms kf mt kj mu kn mv mw mx my bi translated">此特定的历史数据</li><li id="a5c1" class="mq mr it js b jt mz jx na kb nb kf nc kj nd kn mv mw mx my bi translated">飞机定员:134 人</li><li id="53f8" class="mq mr it js b jt mz jx na kb nb kf nc kj nd kn mv mw mx my bi translated">票价:314 美元</li><li id="0ea0" class="mq mr it js b jt mz jx na kb nb kf nc kj nd kn mv mw mx my bi translated">冲撞乘客的费用:400 美元</li></ul><p id="ac39" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">此时，您可能会尝试使用历史数据的期望值或最大/最小值来计算超售率、颠簸乘客和收入的期望值。然而，有可能出现期望值不是分布的良好近似值的分布。例如多模态的东西或者具有严重偏斜的东西。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi ne"><img src="../Images/f3a5497b184701444a3af0dfd31c7848.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2HnoOui8Qi1OVEgOf9bjfQ.png"/></div></div><figcaption class="nf ng gj gh gi nh ni bd b be z dk">Both distributions have a mean of zero and a variance of 5</figcaption></figure><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi ne"><img src="../Images/2def26e324700d3eb22e6c81ae0f7af5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DLjA6aoiLgl3Ywz4LCs0Hg.png"/></div></div><figcaption class="nf ng gj gh gi nh ni bd b be z dk">Both distributions have a mean of 1 and variance of 1</figcaption></figure><h1 id="028b" class="lb lc it bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">解决方案</h1><p id="140f" class="pw-post-body-paragraph jq jr it js b jt lz jv jw jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn im bi translated">为了解决这个问题，我们需要把它分成以下几个步骤。</p><ol class=""><li id="8a68" class="mq mr it js b jt ju jx jy kb nj kf nk kj nl kn nm mw mx my bi translated">拟合所提供的历史数据的分布(概率输入)</li><li id="00ba" class="mq mr it js b jt mz jx na kb nb kf nc kj nd kn nm mw mx my bi translated">建立航班超售过程的数学模型(确定性)</li><li id="a096" class="mq mr it js b jt mz jx na kb nb kf nc kj nd kn nm mw mx my bi translated">从历史分布中随机选择，计算结果，然后重复(概率输出)</li></ol><h2 id="c127" class="me lc it bd ld mf mg dn lh mh mi dp ll kb mj mk lp kf ml mm lt kj mn mo lx mp bi translated">历史数据的分布拟合</h2><pre class="kq kr ks kt gt nn no np nq aw nr bi"><span id="acd5" class="me lc it no b gy ns nt l nu nv">#############<br/>###IMPORTS###<br/>#############</span><span id="0e3c" class="me lc it no b gy nw nt l nu nv">import numpy as np<br/>import pandas as pd<br/>import matplotlib.pyplot as plt<br/>import seaborn as sns<br/>import fitter</span><span id="857a" class="me lc it no b gy nw nt l nu nv">from scipy.stats import exponnorm , genlogistic</span></pre><p id="46e6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">使用 pandas 将历史数据导入 python 并查看快速摘要</p><pre class="kq kr ks kt gt nn no np nq aw nr bi"><span id="ec35" class="me lc it no b gy ns nt l nu nv">hData = pd.read_csv('data/historicalData.csv')<br/>hData.describe()<br/>hData.shape</span></pre><p id="6809" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">3 个特征的 730 次观察，零缺失数据。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/51e410c72709d2a07b795384de8fc890.png" data-original-src="https://miro.medium.com/v2/resize:fit:1180/format:webp/1*z19dgqYww0UTm0yzhb6z8g.png"/></div></figure><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi ny"><img src="../Images/84f60860a8f65d391a5dcd840b90834f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WeYXhwOFUJTb0d40Df2hEA.png"/></div></div><figcaption class="nf ng gj gh gi nh ni bd b be z dk">Flight Demand, Historical</figcaption></figure><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi ny"><img src="../Images/98413a5db6f1800a4dc3581aae0525ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XipbG62A4t14an9x8eOFOw.png"/></div></div><figcaption class="nf ng gj gh gi nh ni bd b be z dk">Number of People that are Ready to Board, Historical</figcaption></figure><p id="8db2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">让我们使用 Fitter 包来模拟分布。Fitter 使用 scipy 中的 80 个分布来拟合分布，并允许您绘制结果以进行直观检查。</p><pre class="kq kr ks kt gt nn no np nq aw nr bi"><span id="db50" class="me lc it no b gy ns nt l nu nv">f_demand = fitter.Fitter(hData.Demand, timeout= 100)<br/>f_demand.fit()<br/>f_demand.get_best()</span><span id="e41d" class="me lc it no b gy nw nt l nu nv">demand_params = list(f_demand.get_best().values())[0]</span><span id="c0f2" class="me lc it no b gy nw nt l nu nv">f_shows = fitter.Fitter(hData.Shows, timeout =100)<br/>f_shows.fit()<br/>f_shows.get_best()</span><span id="5acc" class="me lc it no b gy nw nt l nu nv">shows_params = list(f_shows.get_best().values())[0]</span></pre><p id="42d6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">来自 f_demand.get_best()和 f_shows.get_best()的 demand fitter 输出以 python 字典的形式呈现如下。最佳的 scipy 分布是键，参数存储在值元组中。</p><pre class="kq kr ks kt gt nn no np nq aw nr bi"><span id="005a" class="me lc it no b gy ns nt l nu nv">{'exponnorm': (0.4319945610366508, 145.53002093494484, 11.26683008052343)}</span><span id="ee5b" class="me lc it no b gy nw nt l nu nv">{‘genlogistic’: (0.03148397254846405, 144.0118676463261, 0.3243429345277982)}</span></pre><h2 id="136b" class="me lc it bd ld mf mg dn lh mh mi dp ll kb mj mk lp kf ml mm lt kj mn mo lx mp bi translated">数学模型</h2><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi nz"><img src="../Images/2e71449b5dd89a4942f6de897fac58ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-7aplFK1FeyVD_GKybrj6A.png"/></div></div><figcaption class="nf ng gj gh gi nh ni bd b be z dk">Graphical Representation of the Deterministic Model</figcaption></figure><p id="b386" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">上述模型中的黄色方框是输入。如果输入存在历史数据，将随机独立地对概率分布进行采样。</p><pre class="kq kr ks kt gt nn no np nq aw nr bi"><span id="3151" class="me lc it no b gy ns nt l nu nv">def Planesim(OverbookingLimit =20):<br/>    PlaneCap = 134<br/>    TicketCost = 314<br/>    BumpCost = 400</span><span id="16c4" class="me lc it no b gy nw nt l nu nv">    BookingCap = OverbookingLimit + PlaneCap<br/>    AcutalDemand =int(exponnorm.rvs(*demand_params))<br/>    Booked = min(BookingCap,AcutalDemand)</span><span id="febe" class="me lc it no b gy nw nt l nu nv">    ReadytoBoard = int(genlogistic.rvs(*shows_params))<br/>    NoShows = Booked - ReadytoBoard</span><span id="d1aa" class="me lc it no b gy nw nt l nu nv">    Flying = min(ReadytoBoard,Booked,PlaneCap)<br/>    Bumped = max(ReadytoBoard - PlaneCap , 0)</span><span id="e38a" class="me lc it no b gy nw nt l nu nv">    Sold = Booked * TicketCost<br/>    Costs = Bumped * BumpCost<br/>    Revenue = Sold - Costs</span><span id="1d85" class="me lc it no b gy nw nt l nu nv">    return Flying, Bumped, Revenue</span></pre><h2 id="8d1c" class="me lc it bd ld mf mg dn lh mh mi dp ll kb mj mk lp kf ml mm lt kj mn mo lx mp bi translated">模拟 10 万次飞行</h2><p id="702b" class="pw-post-body-paragraph jq jr it js b jt lz jv jw jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn im bi translated">既然我们已经有了模型化的分布和数学公式，我们可以开始模拟飞机飞行来确定结果的分布。</p><pre class="kq kr ks kt gt nn no np nq aw nr bi"><span id="1092" class="me lc it no b gy ns nt l nu nv">flyingPassengers = []<br/>bumpedPassengers = []<br/>revenue = []</span><span id="92a4" class="me lc it no b gy nw nt l nu nv">for i in range(100000):<br/> output = Planesim(10)<br/> flyingPassengers.append(output[0])<br/> bumpedPassengers.append(output[1])<br/> revenue.append(output[2])</span></pre><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi oa"><img src="../Images/73ba1a0b5d6e4b51b7d1d83c212683a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NsixhOgQj1Fcs-ORS1NWlw.png"/></div></div></figure><p id="e7fc" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">上图是 10 名乘客超售限额的结果。该航班的平均收入为 43，121 美元。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi ob"><img src="../Images/f3016c591283bd7e0c67af632c6be42e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ux-K5qlL4uLLwL7GVHRjsQ.png"/></div></div></figure><p id="ae16" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">上图是 30 名乘客超售限额的结果。该航班的平均收入为 45，487 美元。</p><h2 id="ffa8" class="me lc it bd ld mf mg dn lh mh mi dp ll kb mj mk lp kf ml mm lt kj mn mo lx mp bi translated">寻找最大收益的超额预订限制</h2><p id="5cac" class="pw-post-body-paragraph jq jr it js b jt lz jv jw jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn im bi translated">让我们通过迭代 1 到 100 的超额预订限制来找到最大收入。我们可以通过在 for 循环中运行超额预订模拟来实现这一点。</p><pre class="kq kr ks kt gt nn no np nq aw nr bi"><span id="6f60" class="me lc it no b gy ns nt l nu nv">expected_rev = []<br/>overbooking_rate = []<br/>for j in range(100):<br/>    flyingPassengers = []<br/>    bumpedPassengers = []<br/>    revenue = []</span><span id="79da" class="me lc it no b gy nw nt l nu nv">for i in range(100000):<br/>        output = Planesim(j)<br/>        flyingPassengers.append(output[0])<br/>        bumpedPassengers.append(output[1])<br/>        revenue.append(output[2])<br/>    overbooking_rate.append(j)<br/>    expected_rev.append(np.mean(revenue))</span></pre><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi oc"><img src="../Images/253f13c7022741558635b51f3b4091d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a5tUoB_m0tMEsx8wFlKw6g.png"/></div></div></figure><p id="95b5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">嗯，看起来没有收入作为超额预订限制的函数的最大解。最有可能的决定将取决于航空公司对重新预订航班的容忍程度。</p><h1 id="8f72" class="lb lc it bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">结论</h1><p id="b56e" class="pw-post-body-paragraph jq jr it js b jt lz jv jw jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn im bi translated">我们演练了如何基于确定性情况建立数学模型，然后在必要的地方添加概率参数。历史数据被拟合在各种 scipy 分布上，以便于随机选择。最后，我们模拟了不同级别的超额预订，以在这种特定情况下实现收入最大化。</p><p id="036b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">要查看这个项目的代码，请查看我的 github。</p></div></div>    
</body>
</html>