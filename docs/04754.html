<html>
<head>
<title>How to put your machine learning in a Docker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将你的机器学习放入 Docker</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-put-your-machine-learning-in-a-docker-6b372849fa93?source=collection_archive---------15-----------------------#2019-07-19">https://towardsdatascience.com/how-to-put-your-machine-learning-in-a-docker-6b372849fa93?source=collection_archive---------15-----------------------#2019-07-19</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/46acea26ad72f2f5f7faa9067232a2ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xHmjB6CaJsJAezqy"/></div></div></figure><p id="62f6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">你是一名数据科学家，你了解业务问题，你收集数据，执行一些功能工程，并提出了一个惊人的机器学习模型，可以在本地 IDE 上很好地预测东西。</p><p id="4f54" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">但是接下来呢？ <br/> <br/>换句话说，如何将您的模型部署到生产环境中，或者轻松地与其他人共享，以便他们可以在本地 PC 上运行和评估它，并在<strong class="kd iu">看不见的数据上运行，</strong>无需安装任何库、依赖项、图形界面(IUPython、Jupyter Notebook..)，或者查看您的代码。</p><p id="5664" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">Docker 是这个问题的答案之一，因此，我们将在接下来的段落中看到如何将你的模型包含在一个<strong class="kd iu"> Docker </strong>中，并将其分发给其他人。</p><p id="fea6" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在这个例子中，我们将使用一个简单的<strong class="kd iu">线性回归模型</strong>。</p><p id="ecc7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">让我们从启动我们的库开始:</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="499a" class="li lj it le b gy lk ll l lm ln">import warnings<br/>warnings.filterwarnings(<strong class="le iu">"ignore"</strong>, category=FutureWarning)<br/><br/>import sys<br/>import pandas as pd<br/>from sklearn.linear_model import LinearRegression</span></pre><p id="4807" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">之后，我们将需要导入数据:<br/> <strong class="kd iu">训练数据:</strong>我们的模型将从中学习的数据。<br/> <strong class="kd iu">测试数据:</strong>将由任何需要根据<strong class="kd iu">看不见的数据评估你的模型的人引入。</strong></p><p id="d836" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">测试数据和训练数据应该有，很明显，与<strong class="kd iu">外形相同的</strong>。</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="20b9" class="li lj it le b gy lk ll l lm ln">TestData = sys.argv[1]<br/># Read the data that will serve for training and the test data<br/>X_full = pd.read_csv(<strong class="le iu">"TrainingData.csv"</strong>, index_col=<strong class="le iu">'x001'</strong>)<br/># Read the data that will serve for testing<br/>X_test = pd.read_csv(<strong class="le iu">TestData</strong>, index_col=<strong class="le iu">'x001'</strong>)</span></pre><p id="88ff" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们将把目标数据从整体数据中分离出来:</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="ccf8" class="li lj it le b gy lk ll l lm ln">#separate target from predictors in both training and test data<br/>y = X_full.y<br/>y_test=X_test.y<br/><br/>X_full.drop([<strong class="le iu">'y'</strong>], axis=1, inplace=True)<br/>X_test.drop([<strong class="le iu">'y'</strong>], axis=1, inplace=True)</span></pre><p id="4f84" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后，我们将应用我们的模型:</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="37e6" class="li lj it le b gy lk ll l lm ln"><br/>model=LinearRegression()<br/>model.fit(X_full,y)<br/>preds = model.predict(X_test)</span></pre><p id="6422" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">接下来，我们将把预测输出结果保存在文件<strong class="kd iu"> outputTest.txt. </strong>中</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="7668" class="li lj it le b gy lk ll l lm ln"># Save test predictions to file<br/>output = pd.DataFrame({<strong class="le iu">'Id'</strong>: X_test.index,<strong class="le iu">'Y Original'</strong>: y_test, <strong class="le iu">'Y predicted'</strong>:preds})<br/>output.to_csv(<strong class="le iu">'/data/outputTest.txt'</strong>, index=False)</span></pre><p id="297b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在我们已经有了基本模型，我们将试着把它放到一个 docker 上。<br/> 为此，我们首先需要创建 docker 映像创建所需的文件，即<strong class="kd iu"> Dockerfile </strong>和<strong class="kd iu"> requirement.txt </strong></p><p id="6dbb" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">#DockerFile:</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="dd05" class="li lj it le b gy lk ll l lm ln">FROM python:3<br/>COPY Your_python_code.py<strong class="le iu"> </strong>./<br/>COPY requirements.txt ./<br/>COPY <strong class="le iu">TrainingData.csv</strong> ./<br/><br/>RUN pip install -r requirements.txt<br/>CMD ["python", "wallet.py", "/data/<strong class="le iu">testData.csv</strong>"]</span></pre><p id="c1e3" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">#requirements.txt(不需要下载数学库，因为它会自动添加 python3)。</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="3719" class="li lj it le b gy lk ll l lm ln">pandas<br/>sklearn</span></pre><p id="2784" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后，我们将<strong class="kd iu"> TrainingData.csv、Your_python_code.py DockerFile 和 requirements.txt </strong>放在同一个文件夹中，打开一个终端，转到该文件夹，启动以下程序:</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="8125" class="li lj it le b gy lk ll l lm ln">docker build -t &lt;your_docker_image_name&gt; .<br/># dont forget the . at the end.</span></pre><p id="79e2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">然后，我们将图像推送到我们在 DockerHub 中的帐户(我们假设您在 docker hub 上有一个帐户，如果没有，您可以免费创建一个，然后在您的 PC/MAC 上启动 docker 应用程序) :</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="9114" class="li lj it le b gy lk ll l lm ln">docker push &lt;your_docker_image_name&gt;</span></pre><p id="a4db" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在你的模型在 Docker hub 中，你可以<strong class="kd iu">与你的朋友分享</strong>它。你可以要求他们做以下事情:</p><p id="08af" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">1-从 Docker Hub 获取图像:</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="7317" class="li lj it le b gy lk ll l lm ln">docker pull &lt;your_docker_image_name&gt;</span></pre><p id="47de" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">2-运行容器:</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="23ab" class="li lj it le b gy lk ll l lm ln">docker run -v &lt;path&gt;:/data/ &lt;your_docker_image_name&gt;</span></pre><p id="5789" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">其中<path>是您的训练数据的本地路径<strong class="kd iu">testdata . CSV .</strong><br/><em class="lo">在这个例子中，您的文件应该按照 requirements.txt </em>命名为<strong class="kd iu"><em class="lo">testdata . CSV</em></strong><em class="lo"/></path></p><p id="6895" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">示例</strong> : <br/>如果您的<strong class="kd iu"> testData.csv </strong>在/var/files/中，那么您应该运行:</p><pre class="kz la lb lc gt ld le lf lg aw lh bi"><span id="957c" class="li lj it le b gy lk ll l lm ln">docker run -v /var/files/:/data/ &lt;your_docker_image_name&gt;</span></pre><p id="e706" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">输出</strong> : <br/>将创建一个输出文本文件<strong class="kd iu"> outputTest.txt </strong>，包含 3 列:<br/> ID、Y 的实际值和 Y 的预测值。<br/>输出将保存在<strong class="kd iu"> &lt;路径&gt; </strong>目录中，在上面的示例<br/>中，输出将保存在<strong class="kd iu"> /var/files/ </strong>中，并命名为<br/> <strong class="kd iu"> outputTest.txt</strong></p><p id="5779" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">请在这个<a class="ae lp" href="https://gist.github.com/abdel1979/a8286b7888c173a0e27f60f991c3fe98" rel="noopener ugc nofollow" target="_blank">要点</a>上找到完整的代码。</p><p id="fa57" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">一如既往，希望你学到了新东西:)</p><p id="214c" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">萨拉姆。</p></div></div>    
</body>
</html>