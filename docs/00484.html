<html>
<head>
<title>Jenkins Events, Logs, and Metrics</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Jenkins 事件、日志和指标</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/jenkins-events-logs-and-metrics-7c3e8b28962b?source=collection_archive---------4-----------------------#2019-01-22">https://towardsdatascience.com/jenkins-events-logs-and-metrics-7c3e8b28962b?source=collection_archive---------4-----------------------#2019-01-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="a14e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如何收集关于 Jenkins 的信息以进行分析和数据可视化</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/302ea9f7beadcb16c9f4726d73cb7122.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rKcJSXj8Qq1H6_xNBlZcEA.jpeg"/></div></div></figure><p id="c3d8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您支持一个相当大的 Jenkins 实例，或者您支持大量的实例，您可能已经面临一个性能问题。像许多持续集成(CI)应用程序一样，Jenkins 在小范围内工作得很好，但如果没有适当的照顾和喂养，可能会严重退化。本文将展示几个例子，说明如何导出 Jenkins 事件、日志和指标，以帮助发现改进的机会。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi kx"><img src="../Images/92b8f5de60edf582b2f0cddeac2c13a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1302/format:webp/1*WE5P_vZt9HSsJQRjvTNOHg.png"/></div></figure><h2 id="b773" class="ky kz iq bd la lb lc dn ld le lf dp lg jy lh li lj kc lk ll lm kg ln lo lp lq bi translated">Jenkins 应用指标</h2><p id="5806" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">Jenkins Prometheus 插件在 Jenkins 中公开了一个 Prometheus 端点，允许 Prometheus 收集 Jenkins 应用程序指标。该插件实际上只是对<a class="ae lw" href="https://wiki.jenkins.io/display/JENKINS/Metrics+Plugin" rel="noopener ugc nofollow" target="_blank">指标插件</a>的包装，通过 REST 端点公开 JVM 指标，该端点以 Prometheus 可以理解的格式返回数据。除了 JVM 信息之外，该插件还公开了关于作业队列、执行器数量的信息，以及其他特定于 Jenkins 的信息。<a class="ae lw" href="https://wiki.jenkins.io/display/JENKINS/Metrics+Plugin" rel="noopener ugc nofollow" target="_blank">指标插件</a>提供了一个通过端点公开的指标列表。</p><p id="71f9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦 Prometheus 插件安装在 Jenkins 中，它所公开的数据可以通过“管理 Jenkins”页面进行配置:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lx"><img src="../Images/89f08105ff0602bbcc18fa41e0bb2dc8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-14B5QldXsNDoB_9NQsufQ.png"/></div></div><figcaption class="ly lz gj gh gi ma mb bd b be z dk">Manage Jenkins -&gt; Configure System -&gt; Prometheus plugin</figcaption></figure><p id="7656" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Prometheus 插件优于大多数其他 metrics 插件，因为它比许多其他插件返回更多的系统信息。如果你需要将数据发送到不同的目的地，你可以使用其中一个<a class="ae lw" href="https://prometheus.io/docs/instrumenting/exporters/" rel="noopener ugc nofollow" target="_blank">普罗米修斯导出器</a>。如果普罗米修斯绝对不是一个选项，但是，有几个替代方案。一个替代方案是<a class="ae lw" href="https://plugins.jenkins.io/metrics-graphite" rel="noopener ugc nofollow" target="_blank">Jenkins Metrics Graphite Reporting</a>插件。这个插件导出的数据远比 Prometheus 插件有限，但它允许您获得关于执行程序计数和 HTTP 响应统计的基本信息。</p><p id="8269" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">与 Prometheus pull 模型不同，Graphite 插件将数据推送到任何能够接受 Graphite 消息的服务器。例如，您可以配置<a class="ae lw" href="https://docs.influxdata.com/influxdb/v1.7/supported_protocols/graphite/" rel="noopener ugc nofollow" target="_blank"> InfluxDB Graphite 插件</a>并将指标直接发送到 InfluxDB。或者您可以配置 Logstash Graphite 输入插件并将指标发送到 Logstash 支持的任何输出位置。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mc"><img src="../Images/eb35c70791cc2c0533a58b1677909053.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uZLN_0bTRZF1lAKnCMkcgg.png"/></div></div></figure><p id="038d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果您管理大量的 Jenkins 实例，通过 UI 配置这些设置可能会很繁琐。在这种情况下，可以使用 Jenkins REST API 向每个实例提交一个 Groovy 脚本:</p><pre class="km kn ko kp gt md me mf mg aw mh bi"><span id="b316" class="ky kz iq me b gy mi mj l mk ml">curl -v -d "script=$(cat /tmp/script.groovy)" --user username:ApiToken <a class="ae lw" href="http://jenkins01.yourcompany.com:8080/scriptText" rel="noopener ugc nofollow" target="_blank">http://jenkins01.yourcompany.com:8080/scriptText</a></span></pre><p id="2427" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面显示的 Groovy 代码提供了一个如何配置 Jenkins Metrics Graphite 插件向外部系统发送数据的例子。</p><pre class="km kn ko kp gt md me mf mg aw mh bi"><span id="9312" class="ky kz iq me b gy mi mj l mk ml">import jenkins.metrics.impl.graphite.GraphiteServer;<br/>import jenkins.metrics.impl.graphite.PluginImpl;<br/>import jenkins.model.*;<br/>import org.codehaus.groovy.runtime.InvokerHelper;</span><span id="cc8b" class="ky kz iq me b gy mm mj l mk ml">// Construct an object to represent the Graphite server<br/>String prefix = "jenkins";<br/>String hostname = "graphite.yourcompany.com";<br/>int port = 2003;<br/>GraphiteServer server = new GraphiteServer(hostname, port, prefix);<br/>List&lt;GraphiteServer&gt; servers = new ArrayList&lt;GraphiteServer&gt;();<br/>servers.add(server);<br/>GraphiteServer.DescriptorImpl descriptor = <br/>Jenkins.getInstance().getDescriptorByType(GraphiteServer.DescriptorImpl.class);<br/>descriptor.setServers(servers);</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mn"><img src="../Images/308be07cae8a6bf979185d880a9a0504.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x1A6NbJ47-B_EebNq2Qhew.png"/></div></div></figure><h2 id="2379" class="ky kz iq bd la lb lc dn ld le lf dp lg jy lh li lj kc lk ll lm kg ln lo lp lq bi translated">詹金斯事件</h2><p id="7b5c" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">Jenkins Statistics Gatherer 插件可用于将每个事件的 JSON 消息发送到外部 REST 端点。其中一个应用是将消息发送到 Elasticsearch，以便在 Kibana web 界面中可视化。Jenkins 事件对应于 Jenkins 主服务器上发生的操作，例如:</p><ul class=""><li id="7cca" class="mo mp iq jp b jq jr ju jv jy mq kc mr kg ms kk mt mu mv mw bi translated">项目创建(创建、删除或更新作业时)</li><li id="7a51" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk mt mu mv mw bi translated">作业执行(当构建开始和完成时)</li><li id="5834" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk mt mu mv mw bi translated">作业步骤执行(当作业中的每个步骤开始和结束时)</li><li id="c2ad" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk mt mu mv mw bi translated">作业队列(当作业进入或改变作业队列中的状态时)</li><li id="f2db" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk mt mu mv mw bi translated">SCM 签出(当作业从源代码管理中签出文件时)</li></ul><p id="a5f4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">有很多方法可以将事件发布到 Elasticsearch。一些受欢迎的选项包括:</p><ul class=""><li id="3d2c" class="mo mp iq jp b jq jr ju jv jy mq kc mr kg ms kk mt mu mv mw bi translated"><a class="ae lw" href="https://www.elastic.co/guide/en/logstash/current/plugins-inputs-http.html" rel="noopener ugc nofollow" target="_blank"> <em class="nc"> Logstash HTTP 输入插件</em></a><code class="fe nd ne nf me b">-&gt;</code><em class="nc">log stash elastic search 输出插件</em></li><li id="fc4a" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk mt mu mv mw bi translated">FluentD HTTP 输入插件<code class="fe nd ne nf me b">-&gt;</code> FluentD Elasticsearch 输出插件</li><li id="1c21" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk mt mu mv mw bi translated">汇合休息代理<code class="fe nd ne nf me b">-&gt;</code>卡夫卡<code class="fe nd ne nf me b">-&gt;</code> Logstash 卡夫卡输入插件<code class="fe nd ne nf me b">-&gt;</code> Logstash Elasticsearch 输出插件</li></ul><p id="b3b8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了简单起见，本文将坚持使用 Elasticsearch 产品，并假设使用 Logstash 作为将事件接收到 Elasticsearch 中的方法。无论您选择哪种解决方案，过程本质上都是一样的。</p><p id="5473" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦在 Jenkins 中安装了 Statistics Gatherer 插件，就可以将其配置为通过 Jenkins UI 发送消息:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ng"><img src="../Images/412818afd8bca20ed7bb86e0674617f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z7ym-WiC4qa840B1TzKY7A.png"/></div></div><figcaption class="ly lz gj gh gi ma mb bd b be z dk">Manage Jenkins -&gt; Configure System -&gt; Statistics Gatherer</figcaption></figure><p id="8632" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">上面的屏幕截图显示了如何配置 Statistics Gatherer 插件，以将 HTTP 消息发送到在<code class="fe nd ne nf me b"><a class="ae lw" href="http://logstash.yourcompany.com/" rel="noopener ugc nofollow" target="_blank">http://logstash.yourcompany.com/</a></code>监听的 Logstash HTTP 输入插件。</p><p id="153a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> <em class="nc">重要提示:</em> </strong></p><ul class=""><li id="abc4" class="mo mp iq jp b jq jr ju jv jy mq kc mr kg ms kk mt mu mv mw bi translated"><em class="nc">启用 HTTP 发布？为了发送消息，必须选择</em>”选项。此选项仅在点击此配置部分中的“<em class="nc">高级… </em>”按钮时可见。</li><li id="b441" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk mt mu mv mw bi translated">末尾的<code class="fe nd ne nf me b">/jenkins-&lt;msg&gt;/</code>路径是可选的，但是可以通过允许在<code class="fe nd ne nf me b">request_path</code>信息上定义 Logstash 过滤器来帮助提供关于哪个 Jenkins 事件类型被提交的一些附加信息。</li><li id="f25b" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk mt mu mv mw bi translated">发布工件的构建可以为每个工件生成唯一的 JSON 字段，这可能超过 Elasticsearch 索引所允许的字段数量。要避免这种情况，请使用 Logstash 过滤器去除任何不需要的字段:</li></ul><pre class="km kn ko kp gt md me mf mg aw mh bi"><span id="6aa6" class="ky kz iq me b gy mi mj l mk ml">filter {<br/>    mutate {<br/>        remove_field =&gt; [ "[build][artifacts]" ]<br/>    }<br/>}</span></pre><p id="808d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如前所述，Jenkins 脚本控制台或 REST 端点可用于自动化插件的配置。Groovy 脚本的内容如下所示:</p><pre class="km kn ko kp gt md me mf mg aw mh bi"><span id="4868" class="ky kz iq me b gy mi mj l mk ml">import org.jenkins.plugins.statistics.gatherer.StatisticsConfiguration;<br/>import jenkins.model.*;</span><span id="1d73" class="ky kz iq me b gy mm mj l mk ml">String baseUrl = "http://logstash.yourcompany.com";</span><span id="f64c" class="ky kz iq me b gy mm mj l mk ml">StatisticsConfiguration descriptor = Jenkins.getInstance()<br/>    .getDescriptorByType(StatisticsConfiguration.class);</span><span id="3644" class="ky kz iq me b gy mm mj l mk ml">descriptor.setQueueUrl("<a class="ae lw" href="http://logstash.yourcompany.com/jenkins-queue/" rel="noopener ugc nofollow" target="_blank">${baseUrl}/jenkins-queue/</a>");<br/>descriptor.setBuildUrl("<a class="ae lw" href="http://logstash.yourcompany.com/jenkins-queue/" rel="noopener ugc nofollow" target="_blank">${baseUrl}</a><a class="ae lw" href="http://logstash.yourcompany.com/jenkins-build/" rel="noopener ugc nofollow" target="_blank">/jenkins-build/</a>");<br/>descriptor.setProjectUrl("<a class="ae lw" href="http://logstash.yourcompany.com/jenkins-queue/" rel="noopener ugc nofollow" target="_blank">${baseUrl}</a><a class="ae lw" href="http://logstash.yourcompany.com/jenkins-project/" rel="noopener ugc nofollow" target="_blank">/jenkins-project/</a>");<br/>descriptor.setBuildStepUrl("<a class="ae lw" href="http://logstash.yourcompany.com/jenkins-queue/" rel="noopener ugc nofollow" target="_blank">${baseUrl}</a><a class="ae lw" href="http://logstash.yourcompany.com/jenkins-step/" rel="noopener ugc nofollow" target="_blank">/jenkins-step/</a>");<br/>descriptor.setScmCheckoutUrl("<a class="ae lw" href="http://logstash.yourcompany.com/jenkins-queue/" rel="noopener ugc nofollow" target="_blank">${baseUrl}</a><a class="ae lw" href="http://logstash.yourcompany.com/jenkins-scm/" rel="noopener ugc nofollow" target="_blank">/jenkins-scm/</a>");</span><span id="3d2e" class="ky kz iq me b gy mm mj l mk ml">descriptor.setQueueInfo(Boolean.TRUE);<br/>descriptor.setBuildInfo(Boolean.TRUE);<br/>descriptor.setProjectInfo(Boolean.TRUE);<br/>descriptor.setBuildStepInfo(Boolean.TRUE);<br/>descriptor.setScmCheckoutInfo(Boolean.TRUE);</span><span id="a707" class="ky kz iq me b gy mm mj l mk ml">descriptor.setShouldSendApiHttpRequests(Boolean.TRUE);</span></pre><p id="9f49" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这个过程的最后，您应该在 Elasticsearch 中拥有一个 Jenkins 事件消息的集合，然后可以在 Kibana 可视化和仪表板中使用它来做出关于构建性能、失败率或各种其他问题的明智决策。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nh"><img src="../Images/be7f7cc4a97c173e882c916055a83518.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FZzTgJFXlX65EfZLpeWviw.png"/></div></div><figcaption class="ly lz gj gh gi ma mb bd b be z dk">Kibana Search = type: build AND jobName: rest_open AND result: SUCCESS</figcaption></figure><h2 id="346d" class="ky kz iq bd la lb lc dn ld le lf dp lg jy lh li lj kc lk ll lm kg ln lo lp lq bi translated">Jenkins 应用程序日志</h2><p id="523f" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">Jenkins 主进程和从进程在文件系统上生成应用程序日志。这些日志包含有关 Jenkins 流程的信息，有助于识别通过用户界面不易识别的问题。通过将这些日志发送到 Elasticsearch，可以使用 Kibana web 界面对信息进行索引和模式搜索。日志的每一行都成为 Elasticsearch 中的一条 JSON 记录。</p><p id="0c22" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将应用程序日志内容传送到 Elasticsearch 的最简单方法是使用 Filebeat，这是一个由 Elastic 提供的日志传送程序。Filebeat 可以配置为使用任意数量的日志，并将它们发送到 Elasticsearch、Logstash 或其他几个输出通道。我建议将日志发送到 Logstash，这样就可以应用适当的 Logstash 过滤器将这些行解析成 JSON 字段。这对于 HTTP 访问日志特别有用，因为它使用可预测的日志记录格式。例如，Logstash 中的<code class="fe nd ne nf me b">COMBINEDAPACHELOG</code> grok 过滤器可用于将访问日志条目解析成结构化的 JSON 数据。</p><p id="4022" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下图显示了 Kibana 的“Discover”界面，该界面对于搜索日志条目非常有用。示例演示了如何过滤主机名与<code class="fe nd ne nf me b">cdptestjml01</code>匹配并且日志行包含单词<code class="fe nd ne nf me b">docker</code>的所有 Jenkins 日志:</p><pre class="km kn ko kp gt md me mf mg aw mh bi"><span id="c701" class="ky kz iq me b gy mi mj l mk ml">filebeat.host.name: cdptestjml01 <br/>AND filebeat.source: jenkins <br/>AND message: docker</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ni"><img src="../Images/f6375fb27b28216e4f3bbdaa221b8378.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FgNd-0jUmJetUGFY5EB94w.png"/></div></div><figcaption class="ly lz gj gh gi ma mb bd b be z dk">Kibana Discover Screen</figcaption></figure><p id="3418" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在最新的 Kibana 6.5.x 版本中，增加了一个“日志”视图，它允许你有一个类似于你在命令提示符下运行<code class="fe nd ne nf me b">tail -f</code>命令得到的视图的日志流视图:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nj"><img src="../Images/0ca6b3672bf814aee07901bf7d6d606d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-UGOXX2UQZwR7o0Isi3w5Q.png"/></div></div><figcaption class="ly lz gj gh gi ma mb bd b be z dk">Kibana Logs Screen</figcaption></figure><h2 id="9fce" class="ky kz iq bd la lb lc dn ld le lf dp lg jy lh li lj kc lk ll lm kg ln lo lp lq bi translated">Jenkins 构建日志</h2><p id="c63f" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">与应用程序日志类似，每个 Jenkins 作业都会生成一个控制台日志。这些也可以运到 Elasticsearch。这可以在 Jenkins master 上使用 Filebeat 来完成，或者根据你的需要使用<a class="ae lw" href="https://plugins.jenkins.io/logstash" rel="noopener ugc nofollow" target="_blank"> Logstash Jenkins 插件</a>来完成。使用 Filebeat 类似于上面所描述的，所以为了便于说明，我将在这里介绍 Logstash Jenkins 插件。</p><p id="8ddf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦安装，插件必须配置为指向中央服务器。有几种“索引器类型”可供选择。此示例显示了 SYSLOG 索引器类型的使用。这还需要 Logstash 服务器启用一个<a class="ae lw" href="https://www.elastic.co/guide/en/logstash/current/plugins-inputs-syslog.html" rel="noopener ugc nofollow" target="_blank"> syslog 输入插件</a>，这样它就可以接收 syslog 消息，如此处所示。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nk"><img src="../Images/a16641d5f5969b6b1451e0dfaa5a2f8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v1LOw5Y3vp-xPA7Na95QmA.png"/></div></div><figcaption class="ly lz gj gh gi ma mb bd b be z dk">Manage Jenkins -&gt; Configure System -&gt; Logstash</figcaption></figure><p id="297d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如前所述，如果您管理多个 Jenkins 实例，使用 Groovy 脚本来配置插件可能会更容易:</p><pre class="km kn ko kp gt md me mf mg aw mh bi"><span id="6d3c" class="ky kz iq me b gy mi mj l mk ml">import jenkins.plugins.logstash.LogstashInstallation;<br/>import jenkins.plugins.logstash.LogstashInstallation.Descriptor;<br/>import jenkins.plugins.logstash.persistence.LogstashIndexerDao.IndexerType;<br/>import jenkins.model.*;</span><span id="317b" class="ky kz iq me b gy mm mj l mk ml">Descriptor descriptor = (Descriptor) <br/>    Jenkins.getInstance().getDescriptor(LogstashInstallation.class);<br/>descriptor.type = IndexerType.SYSLOG;<br/>descriptor.host = "logstash.yourcompany.com";<br/>descriptor.port = 5045;<br/>descriptor.key  = "JenkinsTestEnv";<br/>descriptor.save();</span></pre><p id="8cf3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以下示例显示了如何在单个作业配置页面上启用 Logstash 插件:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nl"><img src="../Images/299d40edaf48740ce6372c235bfa781a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uGGrgj64MTIKPypYbOZcfA.png"/></div></div><figcaption class="ly lz gj gh gi ma mb bd b be z dk">Job Configuration -&gt; Job Notifications</figcaption></figure><p id="1857" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> <em class="nc">重要提示:</em> </strong></p><ul class=""><li id="bba9" class="mo mp iq jp b jq jr ju jv jy mq kc mr kg ms kk mt mu mv mw bi translated">Logstash 插件可以为所有作业全局启用，也可以为每个单独的作业启用。考虑到可能生成的数据量，最好只收集特定作业的日志(尤其是当开发人员碰巧在他们的构建脚本中启用了调试日志记录时)。</li></ul><h1 id="1c99" class="nm kz iq bd la nn no np ld nq nr ns lg nt nu nv lj nw nx ny lm nz oa ob lp oc bi translated">摘要</h1><p id="2692" class="pw-post-body-paragraph jn jo iq jp b jq lr js jt ju ls jw jx jy lt ka kb kc lu ke kf kg lv ki kj kk ij bi translated">有许多插件可以让你发送或检索 Jenkins 的数据。第一步是确定你需要什么数据以及你将如何存储它。如果您希望定期从 Jenkins 收集时间序列数据，那么可以考虑使用时间序列数据库，并使用<a class="ae lw" href="https://grafana.com/" rel="noopener ugc nofollow" target="_blank"> Grafana </a>可视化结果。流行的数据库选项包括:</p><ul class=""><li id="2e86" class="mo mp iq jp b jq jr ju jv jy mq kc mr kg ms kk mt mu mv mw bi translated"><a class="ae lw" href="https://www.influxdata.com/" rel="noopener ugc nofollow" target="_blank"> InfluxDB </a></li><li id="55e7" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk mt mu mv mw bi translated"><a class="ae lw" href="https://prometheus.io/" rel="noopener ugc nofollow" target="_blank">普罗米修斯</a></li><li id="b65d" class="mo mp iq jp b jq mx ju my jy mz kc na kg nb kk mt mu mv mw bi translated"><a class="ae lw" href="https://www.timescale.com/" rel="noopener ugc nofollow" target="_blank">时间刻度 B </a></li></ul><p id="4ca7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对于事件或日志等其他数据，<a class="ae lw" href="https://www.elastic.co/" rel="noopener ugc nofollow" target="_blank"> Elastic </a>产品是目前最受欢迎的选择。Elasticsearch 数据库是存储事件消息的绝佳解决方案，而 Kibana 是一个用户友好的界面，用于创建仪表板来呈现数据。尽管 Elastic 试图将时间序列功能集成到他们的产品中，但与 Grafana 结合的专用时间序列数据库可能更易于使用和管理。一旦您从任何或所有这些来源获得了历史数据，您就可以开始对您的 Jenkins 环境的状态做出明智和理性的决策。</p></div></div>    
</body>
</html>