<html>
<head>
<title>Metrics to Evaluate your Semantic Segmentation Model</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">评估您的语义细分模型的指标</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/metrics-to-evaluate-your-semantic-segmentation-model-6bcb99639aa2?source=collection_archive---------0-----------------------#2019-08-10">https://towardsdatascience.com/metrics-to-evaluate-your-semantic-segmentation-model-6bcb99639aa2?source=collection_archive---------0-----------------------#2019-08-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6243" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">您如何知道您的细分模型表现良好？在这里找到答案。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/5c24ed885756502e9758f8e6f1a76932.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YZudFQ0ChAUV1TycWc3C-A.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Illustration of IoU and Dice Coefficient.</figcaption></figure><p id="7084" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi lu translated">放射分割。我最喜欢的任务。我会做一个深度学习模型，让它变得更好，更训练有素…但是等等。我如何知道我的模型表现良好？换句话说，语义分割最常见的度量标准是什么？这里有一个关于<strong class="la iu">基本指标</strong>的简明指南，你需要知道这些指标以确保你的模型表现良好。我还在下面包含了 Keras 实现。</p><p id="1e09" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">如果你想了解更多关于深度学习的语义分割，请查看 George Seif 的这篇中型文章。</p><div class="md me gp gr mf mg"><a rel="noopener follow" target="_blank" href="/semantic-segmentation-with-deep-learning-a-guide-and-code-e52fc8958823"><div class="mh ab fo"><div class="mi ab mj cl cj mk"><h2 class="bd iu gy z fp ml fr fs mm fu fw is bi translated">基于深度学习的语义分割</h2><div class="mn l"><h3 class="bd b gy z fp ml fr fs mm fu fw dk translated">指南和代码</h3></div><div class="mo l"><p class="bd b dl z fp ml fr fs mm fu fw dk translated">towardsdatascience.com</p></div></div><div class="mp l"><div class="mq l mr ms mt mp mu ks mg"/></div></div></a></div><p id="9aed" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">内容:</strong></p><ol class=""><li id="49c6" class="mv mw it la b lb lc le lf lh mx ll my lp mz lt na nb nc nd bi translated">像素精度</li><li id="8e2a" class="mv mw it la b lb ne le nf lh ng ll nh lp ni lt na nb nc nd bi translated">并集上的交集(雅克卡指数)</li><li id="9c65" class="mv mw it la b lb ne le nf lh ng ll nh lp ni lt na nb nc nd bi translated">骰子系数(F1 分数)</li><li id="5afd" class="mv mw it la b lb ne le nf lh ng ll nh lp ni lt na nb nc nd bi translated">结论、注释、总结</li></ol><h1 id="4e4c" class="nj nk it bd nl nm nn no np nq nr ns nt jz nu ka nv kc nw kd nx kf ny kg nz oa bi translated">1.像素精度</h1><p id="391c" class="pw-post-body-paragraph ky kz it la b lb ob ju ld le oc jx lg lh od lj lk ll oe ln lo lp of lr ls lt im bi translated">像素精度也许是概念上最容易理解的。<em class="og">它是图像中被正确分类的像素的百分比。</em></p><p id="0445" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">虽然很容易理解，但这绝不是最好的指标。</strong></p><p id="0ac4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">乍一看，可能很难看出这个指标的问题。为了揭示这个指标的真实情况，这里有一个场景:假设您通过您的分割模型运行了下面的图像(<em class="og">左</em>)。右边的图像是基础事实，或注释(模型应该分割的内容)。在这种情况下，我们的模型试图在卫星图像中分割船只。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/9b1a4b1fcb0d0d04ffc987cf2630bdd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*AmruarcqPbBG4jUx.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Image from <a class="ae oi" href="https://towardsdatascience.com/@aion.stu?source=post_page-----9a41cb8924f0----------------------" rel="noopener" target="_blank">Vlad Shmyhlo</a> in article: Image Segmentation: Kaggle experience (Part 1 of 2) in TDS</figcaption></figure><p id="a31c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">你看你的分割准确率<strong class="la iu"> 95% </strong>。太棒了。让我们看看你的分段是什么样子的！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oj"><img src="../Images/dc23a264eeaf787a01fbbf18a1069b06.png" data-original-src="https://miro.medium.com/v2/resize:fit:700/format:webp/1*yO-dem7wHFv0zNN1LM0saA.png"/></div></figure><p id="4848" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">不完全是你所希望的，嗯。我们的计算有问题吗？没有。完全正确。只是有一节课是原图的 95%。因此，如果模型将所有像素分类为该类别，则 95%的像素被准确分类，而另外 5%的像素没有被准确分类。因此，尽管你的准确率高达 95%，但你的模型返回的是一个完全无用的预测。这是为了说明高像素精度并不总是意味着优越的分割能力。</p><p id="a78a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这个问题叫做<strong class="la iu">阶层失衡</strong>。当我们的类极度不平衡时，意味着一个类或一些类在图像中占主导地位，而其他一些类只占图像的一小部分。不幸的是，类不平衡在许多真实世界的数据集中普遍存在，因此它不能被忽略。因此，我向您展示了两个更好地处理这个问题的替代指标:</p><h1 id="04a5" class="nj nk it bd nl nm nn no np nq nr ns nt jz nu ka nv kc nw kd nx kf ny kg nz oa bi translated">2.并集交(IoU，Jaccard 索引)</h1><p id="b639" class="pw-post-body-paragraph ky kz it la b lb ob ju ld le oc jx lg lh od lj lk ll oe ln lo lp of lr ls lt im bi translated">交集-并集(IoU)，也称为 Jaccard 指数，是语义分割中最常用的指标之一，这是有充分理由的。欠条是一个非常简单的指标，非常有效。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/6c6114a57bcafaf7d59de994e47b920a.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/0*kraYHnYpoJOhaMzq.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">IoU calculation visualized. Source: Wikipedia</figcaption></figure><p id="9b03" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在阅读下面的陈述之前，先看看左边的图片。简单地说，<strong class="la iu"> IoU 是预测分割和实际情况之间的重叠面积除以预测分割和实际情况之间的联合面积</strong>，如左图所示。该指标的范围为 0–1(0–100%)，0 表示没有重叠，1 表示完全重叠的分段。</p><p id="154c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">对于<strong class="la iu">二值化</strong>(两类)或<strong class="la iu">多类分割</strong>，图像的平均 IoU 是通过<strong class="la iu">取每一类的 IoU 并对它们进行平均</strong>来计算的。(在代码中实现略有不同)。</p><p id="1423" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在，让我们通过使用与第 1 节相同的场景来尝试理解为什么这个度量比像素精度更好。为了简单起见，让我们假设所有的船(彩色盒子)都属于同一个类。</p><p id="853d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">但是等等，<em class="og">在我们的语境中重叠和联合到底是什么？上图展示了一幅非常清晰的画面，但我发现在预测与事实的背景下有点难以理解，因为它们不一定像上图描绘的那样重叠。让我们一起来看看预测的分割和地面的真相。</em></p><div class="kj kk kl km gt ab cb"><figure class="ol kn om on oo op oq paragraph-image"><img src="../Images/dc23a264eeaf787a01fbbf18a1069b06.png" data-original-src="https://miro.medium.com/v2/resize:fit:700/format:webp/1*yO-dem7wHFv0zNN1LM0saA.png"/></figure><figure class="ol kn or on oo op oq paragraph-image"><img src="../Images/5e46db78296362db9c9c73adfe8c81cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:712/format:webp/1*FcuTtRWwHi1zGycFHRdEHg.png"/><figcaption class="ku kv gj gh gi kw kx bd b be z dk os di ot ou">Predicted segmentation (Left) Ground truth annotation (Right)</figcaption></figure></div><p id="4ae3" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">先算船欠条吧。我们假设图像的总面积是 100 (100 像素)。首先，让我们考虑一下船只的重叠部分。我们可以假设我们将预测的分割(左)直接移动到地面真实(右)的上方，并查看是否有任何船像素重叠。因为没有像素被模型分类为船只，所以有 0 个重叠的船只像素。</p><p id="df91" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">Union 包括从<strong class="la iu">两幅</strong>图像中被分类为船只的所有像素，减去重叠/交叉。在这种情况下，有 5 个像素(这是一个任意的数字选择)被分类为船只总数。减去为 0 的重叠/相交，得到 5 作为并集的面积。经过计算，我们得知欠条仅仅是 47.5%！参见下面的计算。</p><p id="81b6" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">详细计算如下:</p><p id="90dc" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">船只:重叠面积= 0，联合面积= (5+0)-0 =5</p><p id="9127" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="og">重叠面积/联合面积= 0% </em></p><p id="d9e9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">现在对于黑色背景，我们做同样的事情。</p><p id="14f4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">背景:重叠面积= 95，联合面积=(95+100)-95 = 100</p><p id="d823" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="og">重叠面积/联合面积=95% </em></p><p id="297e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="og">均值 IoU =(船只+背景)/2 =(0%+95%)/2 =</em><strong class="la iu">47.5%</strong></p><p id="d60a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">哇哦。这比我们计算的 95%的像素精度低了很多。很明显，47.5 是我们细分成功的更好的指标，或者更恰当地说，是缺乏成功的指标。</p><p id="9c7c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">下面是我在自己的项目中使用的一个很好的 Keras 实现:</p><pre class="kj kk kl km gt ov ow ox oy aw oz bi"><span id="9abd" class="pa nk it ow b gy pb pc l pd pe">from keras import backend as K</span><span id="4924" class="pa nk it ow b gy pf pc l pd pe">def iou_coef(y_true, y_pred, smooth=1):<br/>  intersection = K.sum(K.abs(y_true * y_pred), axis=[1,2,3])<br/>  union = K.sum(y_true,[1,2,3])+K.sum(y_pred,[1,2,3])-intersection<br/>  iou = K.mean((intersection + smooth) / (union + smooth), axis=0)<br/>  return iou</span></pre><p id="a330" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">y_true 和 y_pred 都是<strong class="la iu">m</strong>x<strong class="la iu">r</strong>x<strong class="la iu">c</strong>x<strong class="la iu">n</strong>其中 m 是图像的数量，r 是行数，c 是列数，n 是类数。</p><h1 id="1363" class="nj nk it bd nl nm nn no np nq nr ns nt jz nu ka nv kc nw kd nx kf ny kg nz oa bi translated">3.骰子系数(F1 分数)</h1><p id="814a" class="pw-post-body-paragraph ky kz it la b lb ob ju ld le oc jx lg lh od lj lk ll oe ln lo lp of lr ls lt im bi translated">简单地说，<strong class="la iu">骰子系数是 2 *重叠面积除以两幅图像中的总像素数。</strong>(参见第 2 节中对联合区域的解释)。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi pg"><img src="../Images/c3107c2f4dcbb25d028277d93cc017df.png" data-original-src="https://miro.medium.com/v2/resize:fit:858/format:webp/1*yUd5ckecHjWZf6hGrdlwzA.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Illustration of Dice Coefficient. 2xOverlap/Total number of pixels</figcaption></figure><p id="0156" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">因此，对于 1 和 2 中使用的相同场景，我们将执行以下计算:</p><p id="e4a9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">两幅图像的总像素数合计= 200</p><p id="3d3b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">船舶:重叠面积= 0</p><p id="c3b0" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="og"> (2 *重叠面积)/(总像素组合)= 0/200 = 0 </em></p><p id="2c03" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">背景:重叠面积= 95</p><p id="1b11" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="og"> (2 *重叠面积)/(总像素组合)= 95*2/200 = 0.95 </em></p><p id="d5a2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><em class="og">骰子=(船只+背景)/2 =(0%+95%)/2 =</em><strong class="la iu">47.5%</strong></p><p id="1525" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在这种情况下，我们得到了与借据相同的值，但情况不会总是这样。</p><p id="931c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">骰子系数与借据非常相似。它们是正相关的，这意味着如果一个人说模型 A 在分割图像方面比模型 B 好，那么另一个人也会这么说。像欠条一样，它们的范围都是从 0 到 1，1 表示预测和真实之间的最大相似度。</p><p id="7861" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为了更好的理解它们之间的区别，我推荐阅读下面的栈交换答案:</p><div class="md me gp gr mf mg"><a href="https://stats.stackexchange.com/a/276144" rel="noopener  ugc nofollow" target="_blank"><div class="mh ab fo"><div class="mi ab mj cl cj mk"><h2 class="bd iu gy z fp ml fr fs mm fu fw is bi translated">f1/骰子得分与借据</h2><div class="mn l"><h3 class="bd b gy z fp ml fr fs mm fu fw dk translated">begingroup $你的思路是正确的。有几件事很快就发生了。根据这两个指标的定义，我们…</h3></div><div class="mo l"><p class="bd b dl z fp ml fr fs mm fu fw dk translated">stats.stackexchange.com</p></div></div></div></a></div><p id="c7fe" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">下面是 Dice 系数的一个实现，输入条件与第 2 节中指定的相同:</p><pre class="kj kk kl km gt ov ow ox oy aw oz bi"><span id="3f25" class="pa nk it ow b gy pb pc l pd pe">def dice_coef(y_true, y_pred, smooth=1):<br/>  intersection = K.sum(y_true * y_pred, axis=[1,2,3])<br/>  union = K.sum(y_true, axis=[1,2,3]) + K.sum(y_pred, axis=[1,2,3])<br/>  dice = K.mean((2. * intersection + smooth)/(union + smooth), axis=0)<br/>  return dice</span></pre><h1 id="5c8b" class="nj nk it bd nl nm nn no np nq nr ns nt jz nu ka nv kc nw kd nx kf ny kg nz oa bi translated">4.结论、注释、总结</h1><p id="b83f" class="pw-post-body-paragraph ky kz it la b lb ob ju ld le oc jx lg lh od lj lk ll oe ln lo lp of lr ls lt im bi translated">总之，语义分割最常用的指标是 IoU 和 Dice 系数。我已经在 Keras 中包含了代码实现，并将在下一篇文章中更深入地解释它们。</p><p id="e01a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">正如你们中的一些人可能已经注意到的，我故意排除了关于真阳性、真阴性、假阳性和假阴性的讨论和解释。虽然很重要，但我认为它们混淆了我在本文中试图强调的对这些指标的清晰概念理解。</p><p id="dcef" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我希望这篇文章能让你对每个指标有更深入的了解，这样你就可以在实现过程中或阅读文献时有更深的理解。</p></div></div>    
</body>
</html>