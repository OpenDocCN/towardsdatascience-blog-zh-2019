<html>
<head>
<title>Demand Prediction with LSTMs using TensorFlow 2 and Keras in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 TensorFlow 2 和 Keras 在 Python 中使用 LSTMs 进行需求预测</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/demand-prediction-with-lstms-using-tensorflow-2-and-keras-in-python-1d1076fc89a0?source=collection_archive---------5-----------------------#2019-11-28">https://towardsdatascience.com/demand-prediction-with-lstms-using-tensorflow-2-and-keras-in-python-1d1076fc89a0?source=collection_archive---------5-----------------------#2019-11-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="14be" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">了解如何通过深度学习从多元时间序列数据中预测需求</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/60a00a53aa424f32cdda74465a8020de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CMrIPv3J1hg8sfvlO2AS4A.jpeg"/></div></div></figure><blockquote class="ku"><p id="0e85" class="kv kw it bd kx ky kz la lb lc ld le dk translated">TL；DR 学习如何使用多元时间序列数据预测需求。在 Keras 和 TensorFlow 2 中建立一个双向 LSTM 神经网络，并使用它进行预测。</p></blockquote><figure class="lf lg lh li lj kn"><div class="bz fp l di"><div class="lk ll l"/></div></figure><p id="141b" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg le im bi translated">时间序列模型最常见的应用之一是预测未来值。股票市场将会如何变化？明天 1 个比特币值多少钱？下个月你打算卖多少咖啡？</p><p id="9f28" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg le im bi translated"><a class="ae mh" rel="noopener" target="_blank" href="/time-series-forecasting-with-lstms-using-tensorflow-2-and-keras-in-python-6ceee9c6c651">没听说过 LSTMs 和时间序列？阅读前一部分来学习基础知识。</a></p><p id="64aa" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg le im bi translated">本指南将向您展示如何使用多元(许多特征)时间序列数据来预测未来需求。您将学习如何预处理和缩放数据。你要建立一个双向 LSTM 神经网络来进行预测。</p><p id="3e6b" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg le im bi translated"><a class="ae mh" href="https://colab.research.google.com/drive/1k3PLdczAJOIrIprfhjZ-IRXzNhFJ_OTN" rel="noopener ugc nofollow" target="_blank"> <strong class="lo iu">在浏览器中运行完整的笔记本</strong> </a></p><p id="89f3" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg le im bi translated"><a class="ae mh" href="https://github.com/curiousily/Deep-Learning-For-Hackers" rel="noopener ugc nofollow" target="_blank"><strong class="lo iu">GitHub 上的完整项目</strong> </a></p><h1 id="783d" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">数据</h1><p id="6333" class="pw-post-body-paragraph lm ln it lo b lp na ju lr ls nb jx lu lv nc lx ly lz nd mb mc md ne mf mg le im bi translated">我们的数据<a class="ae mh" href="https://www.kaggle.com/hmavrodiev/london-bike-sharing-dataset" rel="noopener ugc nofollow" target="_blank">伦敦自行车共享数据集</a>托管在 Kaggle 上。由<a class="ae mh" href="https://www.kaggle.com/hmavrodiev" rel="noopener ugc nofollow" target="_blank">赫里斯托·马夫罗季耶夫</a>提供。谢谢！</p><blockquote class="nf ng nh"><p id="9520" class="lm ln ni lo b lp lq ju lr ls lt jx lu nj lw lx ly nk ma mb mc nl me mf mg le im bi translated"><em class="it">自行车共享系统、公共自行车计划或公共自行车共享(PBS)计划是一项服务，在该服务中，个人可以付费或免费短期共享自行车。——</em><a class="ae mh" href="https://en.wikipedia.org/wiki/Bicycle-sharing_system" rel="noopener ugc nofollow" target="_blank"><em class="it">维基百科</em> </a></p></blockquote><p id="21c6" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg le im bi translated">我们的目标是根据伦敦自行车份额的历史数据预测未来自行车份额的数量。让我们下载数据:</p><pre class="kj kk kl km gt nm nn no np aw nq bi"><span id="a329" class="nr mj it nn b gy ns nt l nu nv">!gdown --id 1nPw071R3tZi4zqVcmXA6kXVTe43Ex6K3 --output london_bike_sharing.csv</span></pre><p id="3507" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg le im bi translated">并将其加载到熊猫数据框中:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw ll l"/></div></figure><p id="411b" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg le im bi translated">Pandas 足够聪明，可以将时间戳字符串解析为 DateTime 对象。我们有什么？我们有 2 年的自行车共享数据，定期记录(1 小时)。就行数而言:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw ll l"/></div></figure><pre class="kj kk kl km gt nm nn no np aw nq bi"><span id="0f69" class="nr mj it nn b gy ns nt l nu nv">(17414, 9)</span></pre><p id="3007" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg le im bi translated">那也许可以。我们有什么特点？</p><ul class=""><li id="e596" class="nx ny it lo b lp lq ls lt lv nz lz oa md ob le oc od oe of bi translated"><em class="ni">时间戳</em> —用于分组数据的时间戳字段</li><li id="1a6b" class="nx ny it lo b lp og ls oh lv oi lz oj md ok le oc od oe of bi translated"><em class="ni">计数</em> —一辆新自行车股份的计数</li><li id="e5a0" class="nx ny it lo b lp og ls oh lv oi lz oj md ok le oc od oe of bi translated"><em class="ni">t1</em>——实际温度，单位为摄氏度</li><li id="05b4" class="nx ny it lo b lp og ls oh lv oi lz oj md ok le oc od oe of bi translated"><em class="ni">T2</em>——以摄氏度为单位的温度“感觉像”</li><li id="0982" class="nx ny it lo b lp og ls oh lv oi lz oj md ok le oc od oe of bi translated"><em class="ni">嗡嗡声</em>——湿度百分比</li><li id="f222" class="nx ny it lo b lp og ls oh lv oi lz oj md ok le oc od oe of bi translated"><em class="ni">风速</em> —风速，单位为千米/小时</li><li id="ec32" class="nx ny it lo b lp og ls oh lv oi lz oj md ok le oc od oe of bi translated"><em class="ni">天气 _ 代码</em> —天气的类别</li><li id="1e0f" class="nx ny it lo b lp og ls oh lv oi lz oj md ok le oc od oe of bi translated"><em class="ni"> is_holiday </em> —布尔字段— 1 节假日/ 0 非节假日</li><li id="e763" class="nx ny it lo b lp og ls oh lv oi lz oj md ok le oc od oe of bi translated"><em class="ni"> is_weekend </em> —布尔字段—如果当天是周末，则为 1</li><li id="ea6c" class="nx ny it lo b lp og ls oh lv oi lz oj md ok le oc od oe of bi translated"><em class="ni">季节</em> —类别野外气象季节:0-春季；1-夏天；2-摔倒；3-冬天。</li></ul><p id="ea8d" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg le im bi translated">我们能在多大程度上根据数据预测未来的需求？</p><h2 id="a89f" class="nr mj it bd mk ol om dn mo on oo dp ms lv op oq mu lz or os mw md ot ou my ov bi translated">特征工程</h2><p id="d14b" class="pw-post-body-paragraph lm ln it lo b lp na ju lr ls nb jx lu lv nc lx ly lz nd mb mc md ne mf mg le im bi translated">我们会做一点工程设计:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw ll l"/></div></figure><p id="497c" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg le im bi translated">所有新特性都基于时间戳。让我们更深入地研究这些数据。</p><h2 id="6fe5" class="nr mj it bd mk ol om dn mo on oo dp ms lv op oq mu lz or os mw md ot ou my ov bi translated">探测</h2><p id="01bc" class="pw-post-body-paragraph lm ln it lo b lp na ju lr ls nb jx lu lv nc lx ly lz nd mb mc md ne mf mg le im bi translated">让我们从简单的开始。让我们来看看自行车份额的变化情况:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ow"><img src="../Images/aac5005af0c348696b96ec8f8b030a78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*-PvXaQf3SG-_QAik.png"/></div></div></figure><p id="7a02" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg le im bi translated">那有点太拥挤了。让我们来看看每月的相同数据:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ow"><img src="../Images/a12adee8c0b4fd13f6f9f67f0c271774.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*GhYUV_2hHBpPRf-S.png"/></div></div></figure><p id="3a14" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg le im bi translated">我们的数据似乎有很强的季节性成分。夏季对生意有好处。</p><p id="acc9" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg le im bi translated">按小时共享自行车怎么样:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ox"><img src="../Images/73a8c5cfbad964fda41a29db8e2a1d85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*W8YC9pguEaIOtMoL.png"/></div></div></figure><p id="6644" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg le im bi translated">大多数自行车共享的时间根据周末或非周末有很大不同。工作日包含上午和下午晚些时候的两个大高峰(人们假装在中间工作)。周末下午早些时候到晚些时候似乎是最忙的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ox"><img src="../Images/1fd2a28e31d4076150d323050f61e6d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*99CqUUXblGHUx8K_.png"/></div></div></figure><p id="c878" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg le im bi translated">按一周中的某一天来看数据，会发现自行车份额的数量要高得多。</p><p id="d685" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg le im bi translated">我们小小的功能工程努力似乎有了回报。新功能可以很好地分离数据。</p><h2 id="7d9a" class="nr mj it bd mk ol om dn mo on oo dp ms lv op oq mu lz or os mw md ot ou my ov bi translated">预处理</h2><p id="5dfb" class="pw-post-body-paragraph lm ln it lo b lp na ju lr ls nb jx lu lv nc lx ly lz nd mb mc md ne mf mg le im bi translated">我们将使用最后 10%的数据进行测试:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw ll l"/></div></figure><pre class="kj kk kl km gt nm nn no np aw nq bi"><span id="f3c4" class="nr mj it nn b gy ns nt l nu nv">15672 1742</span></pre><p id="997e" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg le im bi translated">我们将扩展建模中使用的一些功能:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw ll l"/></div></figure><p id="f395" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg le im bi translated">我们还将扩大自行车份额的数量:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw ll l"/></div></figure><p id="9ef5" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg le im bi translated">为了准备序列，我们将重用同一个<code class="fe oy oz pa nn b">create_dataset()</code>函数:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw ll l"/></div></figure><p id="976f" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg le im bi translated">每个序列将包含历史记录中的 10 个数据点:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw ll l"/></div></figure><pre class="kj kk kl km gt nm nn no np aw nq bi"><span id="47ca" class="nr mj it nn b gy ns nt l nu nv">(15662, 10, 13) (15662,)</span></pre><p id="1e12" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg le im bi translated">我们的数据格式不适合训练 LSTM 模型。我们能多好地预测自行车份额的数量？</p><h1 id="66d6" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">预测需求</h1><p id="9a88" class="pw-post-body-paragraph lm ln it lo b lp na ju lr ls nb jx lu lv nc lx ly lz nd mb mc md ne mf mg le im bi translated">让我们从一个简单的模型开始，看看效果如何。一层<a class="ae mh" href="https://www.tensorflow.org/api_docs/python/tf/keras/layers/Bidirectional" rel="noopener ugc nofollow" target="_blank">双向</a> LSTM，带<a class="ae mh" href="https://www.tensorflow.org/api_docs/python/tf/keras/layers/Dropout" rel="noopener ugc nofollow" target="_blank">漏层</a>:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw ll l"/></div></figure><p id="861c" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg le im bi translated">记住在训练时不要打乱数据:</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="nw ll l"/></div></figure><h1 id="c721" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">估价</h1><p id="004e" class="pw-post-body-paragraph lm ln it lo b lp na ju lr ls nb jx lu lv nc lx ly lz nd mb mc md ne mf mg le im bi translated">以下是我们为<em class="ni"> 30 </em>个时代训练模型后的结果:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pb"><img src="../Images/2191a6a2b0bc76ae9c4382b87d91c75b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*hjMvPDJeqNgwUcj8.png"/></div></div></figure><p id="03ed" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg le im bi translated">你可以看到这个模型学得很快。大约在第五纪元<em class="ni">和</em>时，它已经开始有点过度适应了。你可以试着调整它，改变单位的数量，等等。但是我们能用它来预测需求吗？</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ow"><img src="../Images/dd9588e8631b4860c61858468aad950c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*elR9tPwREGnVRMsV.png"/></div></div></figure><p id="43f7" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg le im bi translated">那对你的眼睛来说可能太多了。让我们放大预测:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ow"><img src="../Images/03d16f6f3951d0f6fb9bfb14697bdc3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*LZjjQs4DB9X62RoP.png"/></div></div></figure><p id="ee15" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg le im bi translated">请注意，我们的模型只预测未来的一个点。也就是说，它做得很好。虽然我们的模型不能真正捕捉到极值，但它在预测(理解)一般模式方面做得很好。</p><h1 id="f575" class="mi mj it bd mk ml mm mn mo mp mq mr ms jz mt ka mu kc mv kd mw kf mx kg my mz bi translated">结论</h1><p id="aa5d" class="pw-post-body-paragraph lm ln it lo b lp na ju lr ls nb jx lu lv nc lx ly lz nd mb mc md ne mf mg le im bi translated">你只是拿了一个真实的数据集，对它进行预处理，然后用它来预测自行车共享需求。您已经使用双向 LSTM 模型对原始数据集的子序列进行了训练。你甚至得到了一些非常好的结果。</p><p id="e31a" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg le im bi translated"><a class="ae mh" href="https://colab.research.google.com/drive/1k3PLdczAJOIrIprfhjZ-IRXzNhFJ_OTN" rel="noopener ugc nofollow" target="_blank"> <strong class="lo iu">在浏览器中运行完整的笔记本</strong> </a></p><p id="47b7" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg le im bi translated"><a class="ae mh" href="https://github.com/curiousily/Deep-Learning-For-Hackers" rel="noopener ugc nofollow" target="_blank"><strong class="lo iu">GitHub 上的完整项目</strong> </a></p><p id="c903" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg le im bi translated">LSTMs 对于时间序列数据还有其他应用吗？</p></div><div class="ab cl pc pd hx pe" role="separator"><span class="pf bw bk pg ph pi"/><span class="pf bw bk pg ph pi"/><span class="pf bw bk pg ph"/></div><div class="im in io ip iq"><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="pj ll l"/></div></figure></div><div class="ab cl pc pd hx pe" role="separator"><span class="pf bw bk pg ph pi"/><span class="pf bw bk pg ph pi"/><span class="pf bw bk pg ph"/></div><div class="im in io ip iq"><div class="kj kk kl km gt pk"><a href="https://leanpub.com/Hackers-Guide-to-Machine-Learning-with-Python/" rel="noopener  ugc nofollow" target="_blank"><div class="pl ab fo"><div class="pm ab pn cl cj po"><h2 class="bd iu gy z fp pp fr fs pq fu fw is bi translated">用 Python 进行机器学习的黑客指南</h2><div class="pr l"><h3 class="bd b gy z fp pp fr fs pq fu fw dk translated">Scikit-Learn、TensorFlow 和 Keras 深度学习实践指南了解如何解决现实世界的机器学习…</h3></div><div class="ps l"><p class="bd b dl z fp pp fr fs pq fu fw dk translated">leanpub.com</p></div></div><div class="pt l"><div class="pu l pv pw px pt py ks pk"/></div></div></a></div></div><div class="ab cl pc pd hx pe" role="separator"><span class="pf bw bk pg ph pi"/><span class="pf bw bk pg ph pi"/><span class="pf bw bk pg ph"/></div><div class="im in io ip iq"><p id="214d" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg le im bi translated"><em class="ni">最初发表于</em><a class="ae mh" href="https://www.curiousily.com/posts/demand-prediction-with-lstms-using-tensorflow-2-and-keras-in-python/" rel="noopener ugc nofollow" target="_blank"><em class="ni">https://www.curiousily.com</em></a><em class="ni">。</em></p></div></div>    
</body>
</html>