<html>
<head>
<title>Collecting Movie Data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">收集电影数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/collecting-movie-data-445ca1ead8e5?source=collection_archive---------12-----------------------#2019-01-31">https://towardsdatascience.com/collecting-movie-data-445ca1ead8e5?source=collection_archive---------12-----------------------#2019-01-31</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/a7a5eae493db2ac6630adccb2d5cab43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v5fvVabIVpP65OEYs7IxTA.png"/></div></div></figure><div class=""/><div class=""><h2 id="dfbe" class="pw-subtitle-paragraph jy ja jb bd b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp dk translated">使用一堆 API 来组装一个非常简洁的数据集</h2></div><p id="5636" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">我最初的前提是，我可以试着<strong class="ks jc">根据 iTunes 电影</strong>的特点预测它的价格。我知道我们可以通过一个记录良好的公共 API 在 iTunes 中获得电影信息，所以让我们来看看。</p><h1 id="62f7" class="lm ln jb bd lo lp lq lr ls lt lu lv lw kh lx ki ly kk lz kl ma kn mb ko mc md bi translated">iTunes 数据商店中的数据</h1><p id="97d7" class="pw-post-body-paragraph kq kr jb ks b kt me kc kv kw mf kf ky kz mg lb lc ld mh lf lg lh mi lj lk ll ij bi translated">您可以通过两种主要方式在 iTunes API 上从 iTunes store 获取影片信息，即通过关键词调用或按 ID 查找。显然，使用关键字来提取特定的电影通常不是一个好主意。有些关键词会给你多达 50 个匹配项(试试搜索“哈利波特”)。</p><figure class="mk ml mm mn gt is gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/5301ebe2d1150104ef8d0d099cd2d305.png" data-original-src="https://miro.medium.com/v2/resize:fit:982/format:webp/0*SticU1EUbSczYlHj.jpg"/></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk">With an average response time of 2s, 10 billion lookups is gonna take…</figcaption></figure><p id="018b" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">按 ID 查找也没有太大的改进。iTunes ID <code class="fe ms mt mu mv b">trackId</code>字符串<strong class="ks jc">至少有</strong> 10 位数长，这意味着可能有多达 100 亿个可能的 ID，我必须一次查找一个。不是一个好主意。</p><p id="8c29" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">所以我使用了 iTunes RSS 提要来缩小我的搜索范围。下面的代码片段定义了一个函数<code class="fe ms mt mu mv b">collect_rss_movies()</code>来 ping iTunes RSS 提要。我决定依靠 RSS iTunes feed 来获取更多最新的电影和完整的价格信息。从 iTunes RSS 提要获得 iTunes IDs 后，我转向 iTunes API，使用<code class="fe ms mt mu mv b">get_info_by_id()</code>功能从 iTunes store 获得电影信息。</p><figure class="mk ml mm mn gt is"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="0b7d" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">我还定义了一个<code class="fe ms mt mu mv b">settings.py</code>文件，它定义了集合参数。在这里，我指示该函数收集来自 9 个国家和 2 个主要流派的数据。</p><figure class="mk ml mm mn gt is"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="42a2" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">我最终放弃了纪录片的片名，因为相对于主流电影，它们看起来有点模糊<a class="ae mx" href="https://itunes.apple.com/us/movie/bill-murray-stories-life-lessons-learned-from-mythical/id1435996525" rel="noopener ugc nofollow" target="_blank"><em class="mw"/></a><em class="mw"/>，但这里有一个电影记录的片段:</p><pre class="mk ml mm mn gt na mv nb nc aw nd bi"><span id="b086" class="ne ln jb mv b gy nf ng l nh ni">{'artistName': 'Christopher McQuarrie',<br/> 'contentAdvisoryRating': 'PG-13',<br/> 'country': 'USA',<br/> 'currency': 'USD', 'primaryGenreName': 'Action &amp; Adventure',<br/> 'releaseDate': '2018-07-27T07:00:00Z',<br/> 'shortDescription': 'On a dangerous assignment to recover stolen plutonium, Ethan Hunt (Tom Cruise) chooses to save his',<br/> 'trackHdPrice': 19.99,<br/> 'trackHdRentalPrice': 5.99,<br/> 'trackId': 1406515547,<br/> 'trackName': 'Mission: Impossible - Fallout',<br/> 'trackNumber': 6,<br/> 'trackPrice': 14.99,<br/> 'trackRentalPrice': 5.99,<br/> 'trackTimeMillis': 8873322,<br/> 'wrapperType': 'track'}</span></pre><p id="888f" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">这就是它的要点——有一些特性我没有包括在这里，但是数据描述可以在官方的 i <a class="ae mx" href="https://developer.apple.com/library/archive/documentation/AudioVideo/Conceptual/iTuneSearchAPI/index.html" rel="noopener ugc nofollow" target="_blank"> Tunes API 文档</a>中找到，或者你可以在我的<a class="ae mx" href="https://github.com/zacharyang/movies-project/tree/master/data" rel="noopener ugc nofollow" target="_blank"> Github </a>查看数据描述。</p><p id="dc41" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">太好了！我们都准备做一个新的令人兴奋的机器学习项目。对吗？但是电影不仅仅是这些，不是吗？所以我做了更多的调查，想知道如何补充这个数据集。</p><h1 id="043a" class="lm ln jb bd lo lp lq lr ls lt lu lv lw kh lx ki ly kk lz kl ma kn mb ko mc md bi translated">打开电影数据库和电影数据库</h1><p id="4f94" class="pw-post-body-paragraph kq kr jb ks b kt me kc kv kw mf kf ky kz mg lb lc ld mh lf lg lh mi lj lk ll ij bi translated">虽然 IMdb 是所有电影信息的权威来源，但他们没有公共 API，即使我依靠网络搜集，我也很难找到我应该收集的电影。我求助于两个关于电影的开放数据库，即<a class="ae mx" href="http://www.omdbapi.com/" rel="noopener ugc nofollow" target="_blank">开放电影数据库</a> (OMdb)和<a class="ae mx" href="https://developers.themoviedb.org/3/movies/get-movie-details" rel="noopener ugc nofollow" target="_blank">电影数据库</a> (TMdb)。</p><blockquote class="nj nk nl"><p id="7b9b" class="kq kr mw ks b kt ku kc kv kw kx kf ky nm la lb lc nn le lf lg no li lj lk ll ij bi translated">电影数据库(TMDb)是一个社区建立的电影和电视数据库。从 2008 年开始，每一条数据都是由我们这个了不起的社区添加的。TMDb 强大的国际关注度和数据广度在很大程度上是无与伦比的，这是我们难以置信的骄傲。</p></blockquote><p id="330c" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">所以这就是 TMdb 的出处。来自 OMdb 网站:</p><blockquote class="nj nk nl"><p id="5559" class="kq kr mw ks b kt ku kc kv kw kx kf ky nm la lb lc nn le lf lg no li lj lk ll ij bi translated">T4:OMDb API 是一个 RESTful web 服务，用于获取电影信息，网站上的所有内容和图片都是由我们的用户贡献和维护的。</p></blockquote><h2 id="b4c7" class="ne ln jb bd lo np nq dn ls nr ns dp lw kz nt nu ly ld nv nw ma lh nx ny mc nz bi translated">为什么有两个电影数据库？</h2><p id="7d4b" class="pw-post-body-paragraph kq kr jb ks b kt me kc kv kw mf kf ky kz mg lb lc ld mh lf lg lh mi lj lk ll ij bi translated">虽然它们分别得到了很好的维护，但它们各有利弊，我意识到我可能必须利用它们来为我的特性集提取正确的信息。两个数据库都没有在数据库中记录每部电影的 iTunes ID，所以我不得不依靠标题搜索来匹配 iTunes 数据和电影数据库中的每部电影。</p><figure class="mk ml mm mn gt is gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/3e2f24a47981fefcab9b4ea505a70312.png" data-original-src="https://miro.medium.com/v2/resize:fit:454/format:webp/1*pfdLHWPDE80iT5FWxtddIQ.png"/></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk">Methods available to get information on a movie in the TMdb API</figcaption></figure><ul class=""><li id="41cf" class="ob oc jb ks b kt ku kw kx kz od ld oe lh of ll og oh oi oj bi translated"><strong class="ks jc">特色。OMdb 有比我在 TMdb 数据集中找不到的更多的有用信息。例如，OMdb 包含关于电影评级的信息，例如烂番茄评级、Metacritic 评分和 IMdb 评级。OMdb 数据还记录了这部电影的票房表现，我觉得这将是预测一部 iTunes 电影能卖多少钱的一个关键特征。</strong></li><li id="60a8" class="ob oc jb ks b kt ok kw ol kz om ld on lh oo ll og oh oi oj bi translated"><strong class="ks jc"> API 能力</strong>。总的来说，TMdb API 功能更强，提供了更多的方法来查找信息。在 OMdb 中，你只能通过关键字搜索或 IMdb ID 来查找电影。此外，在 TMdb API 上进行关键字搜索通常会产生比 OMdb API 更好的结果。</li><li id="31df" class="ob oc jb ks b kt ok kw ol kz om ld on lh oo ll og oh oi oj bi translated"><strong class="ks jc"> API 比率限值。</strong> OMdb 有一个非常严格的 API 速率限制，每天 1，000 个调用，而 TMdb API 有一个更高的速率限制，每秒 4 个请求(或每天约 340，000 个调用)。</li></ul><p id="02d1" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">所以<strong class="ks jc"/>OMdb API 有<strong class="ks jc">更多我需要的信息，</strong>但是 TMdb API <strong class="ks jc">通常更好使用。</strong>我最终决定，我需要对 OMdb API 进行非常有针对性和具体的调用，通过 ID 查找来获取电影信息。OMdb 使用 IMdb ID 索引他们的电影记录，所以我必须通过关键字搜索找到 iTunes 数据集中每部电影的 IMdb ID，正如我提到的，通过 TMdb API 更好。</p><p id="b091" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">尽管有些复杂，我还是决定采用以下策略:</p><ol class=""><li id="1c97" class="ob oc jb ks b kt ku kw kx kz od ld oe lh of ll op oh oi oj bi translated">将电影标题解析为一个搜索字符串，通过 TMdb API 传递，寻找精确匹配。包括生产年份，以进一步缩小搜索范围。</li></ol><figure class="mk ml mm mn gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi oq"><img src="../Images/e386d2630ec56d432e3084bd9584f14e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-ejZN0ZVfx-HjswKaOLxWQ.png"/></div></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk">Parsed movie titles, transformed into search strings for the TMdb API.</figcaption></figure><p id="ae21" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">2.为了精确匹配，使用 TMdb ID 查找来查找 IMdb ID。对于没有匹配的结果，通过删除生产年份来放宽搜索标准。对于有多个匹配或结果的电影标题，从 Google 搜索的第一个结果中提取 IMdb，格式为“电影标题+制作年份+ IMdb”</p><p id="b2a8" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">3.将每部电影与一个 IMdb ID 进行匹配，并在 OMdb API 中查找每部电影的电影信息。</p><p id="413b" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">按照这个过程，我设法从 OMdb API 中唯一地识别出一个看起来相当健康的 603 部电影的数据集，其中<strong class="ks jc">与我在 iTunes store 上收集的 1800 部电影</strong>中的大约 1500 部相匹配，因此总体来说回报不错，而没有深入到<a class="ae mx" href="https://medium.com/district-data-labs/basics-of-entity-resolution-with-python-and-dedupe-bc87440b64d4" rel="noopener">实体解析</a>的混乱世界中。这里有相当长的一段代码，但是你也可以在我的<a class="ae mx" href="https://github.com/zacharyang/movies-project/blob/master/collect_data.py" rel="noopener ugc nofollow" target="_blank"> Github repo </a>上查看。</p><h1 id="f94e" class="lm ln jb bd lo lp lq lr ls lt lu lv lw kh lx ki ly kk lz kl ma kn mb ko mc md bi translated">票房 Mojo 数据</h1><p id="2cf1" class="pw-post-body-paragraph kq kr jb ks b kt me kc kv kw mf kf ky kz mg lb lc ld mh lf lg lh mi lj lk ll ij bi translated">在我对 OMdb 数据做了一些初步探索之前，我对我拥有的数据非常满意。我注意到我的数据中有一大块票房信息缺失。</p><figure class="mk ml mm mn gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi or"><img src="../Images/e5beb838dee8167a232e00c5da694cdf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Tgq87_ba6iFD5lJlLNjB0w.png"/></div></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk">Over 40% of the movies in the OMdb data had missing box office receipt information.</figcaption></figure><p id="f3b8" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">我可以忍受缺失的评分，但票房表现将是纳入我的模型的一个很好的特征。</p><figure class="mk ml mm mn gt is gh gi paragraph-image"><div class="gh gi os"><img src="../Images/e53a08055050a3fd653b40a768e7c3fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/1*GBJLuEASMUZL2Ey7Qg4atg.gif"/></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk">Dat feeling when you see so many missing values</figcaption></figure><p id="bcbb" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">很明显，我可以很容易地通过公共数据源获得信息。所以我求助于<a class="ae mx" href="https://www.boxofficemojo.com/alltime/" rel="noopener ugc nofollow" target="_blank">票房魔咒</a>，使用曾经可靠的<code class="fe ms mt mu mv b">requests</code>和<code class="fe ms mt mu mv b">BeautifulSoup</code>组合。</p><figure class="mk ml mm mn gt is"><div class="bz fp l di"><div class="my mz l"/></div></figure><p id="f709" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">我找到了大约 7000 部电影，填补了我所有缺失的价值，并补充了全球票房总收入与美国票房总收入的对比。现在的问题是把它们放在一起。</p><figure class="mk ml mm mn gt is gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/f427614ab45af8d703241fdd1e913495.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*FGCNdZRouNBVuewB1UYpAA.gif"/></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk">Merging data: Easy as Pen Pineapple Apple Pen</figcaption></figure><h1 id="c889" class="lm ln jb bd lo lp lq lr ls lt lu lv lw kh lx ki ly kk lz kl ma kn mb ko mc md bi translated">我的数据现在是什么样子</h1><p id="e51e" class="pw-post-body-paragraph kq kr jb ks b kt me kc kv kw mf kf ky kz mg lb lc ld mh lf lg lh mi lj lk ll ij bi translated">在所有这些争论之后，我有一个大约 1500 部电影的数据集，数据来自 4 个不同的来源，通过不同的键和方法连接。它们主要存在于我的存储库中的<a class="ae mx" href="https://github.com/zacharyang/movies-project/tree/master/data/clean" rel="noopener ugc nofollow" target="_blank">两个 csv 文件中，我已经为下面的数据库包含了一个广泛的模式。</a></p><figure class="mk ml mm mn gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ou"><img src="../Images/09874e87b85f29c91154d40fcba338ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*myrfeQpW7_WOCk42LZLmiQ.png"/></div></div></figure></div><div class="ab cl ov ow hu ox" role="separator"><span class="oy bw bk oz pa pb"/><span class="oy bw bk oz pa pb"/><span class="oy bw bk oz pa"/></div><div class="ij ik il im in"><p id="eb18" class="pw-post-body-paragraph kq kr jb ks b kt ku kc kv kw kx kf ky kz la lb lc ld le lf lg lh li lj lk ll ij bi translated">这就结束了我关于收集电影数据的帖子。在接下来的一周左右，我会在这里发布关于建模和数据探索的更新。同时，如果您对我的数据收集过程有任何反馈、建议或改进，请联系我！</p></div></div>    
</body>
</html>