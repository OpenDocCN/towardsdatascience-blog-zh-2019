<html>
<head>
<title>Will my Customer Come Back : Playing with CLV</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我的顾客会回来吗:和 CLV 一起玩</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/will-my-customer-come-back-playing-with-clv-2564cc48849a?source=collection_archive---------14-----------------------#2019-01-09">https://towardsdatascience.com/will-my-customer-come-back-playing-with-clv-2564cc48849a?source=collection_archive---------14-----------------------#2019-01-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="4faa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">自从 Kaggle 的 Olist 数据集上线以来，我已经在过去的几天里修补客户终身价值模型了。特别是，我想探索久经考验的概率模型，BG/NBD 和 GammaGamma 来预测未来的购买和利润。我还想看看机器学习方法是否能做得很好——简单地预测客户是否会重复购买。这些模型做同样的事情——预测客户购买——尽管方式不同。也许在一篇更新的文章中，我可以提出一些衡量标准，在平等的基础上对它们进行比较。不管怎样，我们开始吧。</p><p id="62a4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">笔记本可以在 Kaggle 找到。这里:<a class="ae kl" href="https://www.kaggle.com/krsnewwave/clv-with-lifetimes-and-featuretools" rel="noopener ugc nofollow" target="_blank">https://www . ka ggle . com/krsnewwave/CLV-with-lifetimes-and-feature tools</a></p><p id="d24d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Olist 是一家巴西电子商务网站，它在 2016 年至 2018 年期间如此慷慨地在其网站上分享了 10 万个订单。<a class="ae kl" href="https://www.kaggle.com/olistbr/brazilian-ecommerce/home" rel="noopener ugc nofollow" target="_blank">数据可以在这里找到</a>。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/ef164bfa48cad5cf51377d13390da4e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3UJGaZVCsSQPnf15"/></div></div></figure><h1 id="63c0" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">数据看起来像什么</h1><p id="a370" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">该数据集包括约 95，000 名客户及其在该网站的订单，这些订单是约 73 个类别的约 33，000 种产品的约 100，000 个独特订单。它还包括商品的价格、客户支付的金额、信用卡分期付款，甚至与订单相关的恐惧成本。它的数据应该很像你自己的电子商务公司的数据。😉</p><p id="d483" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">购买模式似乎很正常，定期上涨，并在 2017 年 12 月大幅飙升。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/60fc5c495a325796fa5d443087ded05c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*PXlbSDaz7M-9moyU"/></div></div></figure><p id="e603" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">数据显示，每位顾客的购买模式非常稀疏，每位顾客平均购买 1.03 份订单和 1.07 件商品。</p><h1 id="ce71" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">英国地质调查局/NBD 模型</h1><p id="d732" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated"><a class="ae kl" href="https://www.kaggle.com/dhimananubhav/customer-lifetime-value" rel="noopener ugc nofollow" target="_blank">对于概率模型，我使用了许多这种绅士内核的代码。</a>寿命库对于快速构建这类分析非常有用。它需要 RFM 输入数据，这要求每个客户，我们有他们最近购买的信息，他们购买的频率和他们购买的总货币价值。</p><p id="ac5a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">贝塔几何负二项分布解决了两个问题，1)客户活跃或不活跃的概率(在文献中是活着还是死了！)，以及 2)购买次数的概率。(1)由贝塔分布建模，以及(2)由泊松分布建模。对于这两个预测问题，每个个体或群体都有自己的参数。一个简单的方法是用一枚硬币和一个骰子来模拟(1)和(2)。</p><p id="73fa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这里是衡量我们的模型性能的视觉效果。在校准期(左)和验证期(右)测试中可以看到，由于缺乏关于这一行为的数据，该模型在尝试预测 4 次或更多次购买时失败。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mb"><img src="../Images/bc2f4a1a77a9177aa1cb719d29cca6e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*AePje4g7y-2DWcvy"/></div></div></figure><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi mc"><img src="../Images/a5ef59f36ff36a8a507bec24bf1c6e64.png" data-original-src="https://miro.medium.com/v2/resize:fit:1338/0*CPrIH1EEN5-NO4rv"/></div></figure><p id="47aa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下图描述了 x 轴上的频率和 y 轴上的新近度。经常购买和最近购买的人在图表的最右边。在下图(a)中，未来 120 天的预期购买次数非常低(0.6 次)，即使是最忠实的买家(最近购买且经常购买)。在(b)中，即使是最忠实的买家也只有 60%的机会活跃。这是因为数据中每个客户的购买模式非常稀疏。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi md"><img src="../Images/eafd596f48ac1354ce4de6aebf59686f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1088/0*uSF5STsxZTFDfeoJ"/></div></figure><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi me"><img src="../Images/8fe5e89280011ec76a83b9402907c1f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1052/0*yFOuQnu5s9CX3ZdR"/></div></figure><p id="d965" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">使用该模型，可以根据未来的预期购买次数输出客户的排名。该排名可用于确定不同细分市场的营销策略。这是前 4 名客户的每个购买模式后存活的概率。这些前 4 名是根据半年内的最高预期购买次数计算出来的。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi mf"><img src="../Images/942df34237c836bd15437bd08175354d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1318/format:webp/1*U9Ez9BWtEw0GHRNd8DajbQ.png"/></div></figure><p id="e4a0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我还尝试了一个 GammaGamma 模型，该模型考虑了所购物品的货币价值。然而，预测并不好，在维持集上只有 0.35 的相关性。这可能是因为购买模式的稀疏性。我将把它留给一个更深入的研究，看看 GammaGamma 模型相对于购买的稀疏性在哪里崩溃。</p><h1 id="015d" class="ky kz iq bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">更广阔的视角</h1><p id="a338" class="pw-post-body-paragraph jn jo iq jp b jq lw js jt ju lx jw jx jy ly ka kb kc lz ke kf kg ma ki kj kk ij bi translated">从上一节中，我们抽象出了购买物品的性质和数量、购买的离散时间窗口以及支付的上下文。所有这些都会对重复购买的问题产生影响。在本节中，我们将使用<strong class="jp ir">特征工具</strong>库为我们自动创建特征。</p><p id="6493" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将数据集连接在一起的过程有点乏味，但回报是一个完全自动化的特征工程例程。实体集将如下所示:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/06c1c23f58f742a001f91c858c5f2f15.png" data-original-src="https://miro.medium.com/v2/resize:fit:930/format:webp/1*LppvJR1WKkt_qlvW_SUsIA.png"/></div></figure><p id="5886" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在转换特征之前，我们声明一个截止日期和训练窗口。截止日期之后的交易将被截断，截止日期之前的<em class="mg">训练窗口期将构成我们的训练集。我们将预测客户是否会在截止日期</em>后购买<em class="mg">，因为她在截止日期<em class="mg">前<em class="mg">的所有交易都在</em>训练窗口内。我们的截止日期将是 2018 年 7 月 1 日。</em></em></p><p id="98e5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在 featuretool 的深度要素合成(DFS)的帮助下，数据集将如下所示。DFS 使用关系中声明的索引来创建聚合和基本功能。例如，我们可以有一些简单的东西，如付款总额(深度=1)，也可以有一些复杂的东西，如客户订单最大付款的平均付款额(深度=2)。回想一下，一个订单可以有多次付款，一个客户有多个订单。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/7aff61eff93a29b1bc70b1f4d88eb2a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ETaM98uUQoVM11ZJ"/></div></div></figure><p id="9c05" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">模型的结果如下:</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/4a2fd5cf0dbf95d5cb10b88fabacf86e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1230/format:webp/1*9AsPoJtCpz3Ks_xqsplf_w.png"/></div></figure><p id="0254" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">不算太坏。增加训练窗口显著提高了我们的指标，更复杂的模型并没有带来太多的改进。和以前一样，我们可以得到一个客户留下来的输出概率作为我们的排名。然后，我们可以围绕这些级别制定策略。</p><p id="e497" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后，我们将讨论最重要的特性。通过默认方式获得随机森林和梯度增强树的特征重要性是微不足道的-所有树的基尼系数的平均下降。我将让读者通过抽样来确定排列的重要性。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi mj"><img src="../Images/55ed3783baa9e8dcd295bf1aed0f2e66.png" data-original-src="https://miro.medium.com/v2/resize:fit:772/0*PL5_DkvEHXG6weSk"/></div></figure><p id="be5e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在 2018 年上半年购买的客户可能会在下半年再次购买。购买了许多订单并有许多付款(信用卡分期付款)的客户可能会再次购买。付款类型=未知可能表示全额付款。还有关于特定城市或州的特征，尽管这些仍然是可疑的，因为树偏向于具有许多级别的类别。</p><p id="b748" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">虽然，一些顶级功能是转移视线。谁听说过一个未知的星期几，月份或年份？这些可能是数据中的错误，模型以某种方式利用这些错误来获得优势。这项研究在投入生产之前还需要进一步的清理和完善。</p><p id="cce4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">感谢阅读。</p></div><div class="ab cl mk ml hu mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="ij ik il im in"><p id="fc51" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><em class="mg">原载于 2019 年 1 月 9 日</em><a class="ae kl" href="https://itstherealdyl.wordpress.com/2019/01/09/will-my-customer-come-back-playing-with-clv/" rel="noopener ugc nofollow" target="_blank"><em class="mg">【itstherealdyl.wordpress.com】</em></a><em class="mg">。</em></p></div></div>    
</body>
</html>