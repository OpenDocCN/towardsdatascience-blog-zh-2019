<html>
<head>
<title>Traveling through Europe (in a nerdy way)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">穿越欧洲旅行(以一种书呆子的方式)</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/travel-budget-optimization-5c97501babe0?source=collection_archive---------25-----------------------#2019-11-27">https://towardsdatascience.com/travel-budget-optimization-5c97501babe0?source=collection_archive---------25-----------------------#2019-11-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6fae" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">通过使用 python 库抓取谷歌航班来创建最佳旅行路线</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/ff47567cb275deb36d3b8abb3d3385b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e6qnENgq59o4cCwxfGal3g.jpeg"/></div></div></figure><p id="c8bf" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi lq translated">作为一个旅行爱好者，我明年的目标是尽可能多地旅行。我对目的地不是很挑剔；然而，我确实有一些限制。首先，我只能在周末旅行，因为我从周一到周五都在办公室工作。第二，我想用最少的预算尽可能多地游览不同的城市。第三，我不想在飞机上花太多时间。那么让我们来看看如何自动找到一个最优的旅行路线。</p><p id="2625" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">考虑到我的灵活性和局限性，我尝试了许多航班搜索工具，最终我选择了 https://www.google.com/flights 的 T2。在这里，您可以选择一个出发城市，将目的地留空以探索各种选项。您还可以选择灵活的旅行日期，例如，在未来 6 个月内的所有周末旅行，只需点击几下鼠标:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mb"><img src="../Images/2b6839a9c8b66914ee04831b585b75b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zdfICyWc_gQya9xm2n_-dQ.png"/></div></div><figcaption class="mc md gj gh gi me mf bd b be z dk">Google flights is flexible but not what I’m looking for</figcaption></figure><p id="a610" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">然而，我发现他们对周末<strong class="kw iu"><em class="ma"/></strong>的定义毫无用处。例如，参见上面的截图。你可以看到 4 月 2 日周四飞往布拉格的航班<em class="ma">谢谢你，谷歌，给了我这个便宜的选择，但我周五必须去办公室</em>。同样，它为其他城市提供了一些其他选择，周六晚上出发，周日早上返回，<em class="ma">如果你只是对了解机场感兴趣</em>那就太好了。</p><blockquote class="mg"><p id="a64a" class="mh mi it bd mj mk ml mm mn mo mp lp dk translated">所以，谷歌，伴随着巨大的灵活性而来的是巨大的责任，你对周末旅行的假设是错误的。</p></blockquote><p id="fa10" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">好吧，让我们给谷歌更少的灵活性。让我们告诉谷歌，我想在 2019 年 12 月 13 日至 15 日的周末去欧洲任何地方旅行，从阿姆斯特丹往返，周五在 hs 的<em class="ma"> 18.00 </em>和<em class="ma"> 24.00 </em>之间出发，周日在 hs 的<em class="ma"> 16.00 </em>和<em class="ma"> 24.00 </em>之间返回。这是该搜索的链接:</p><p id="a7c8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><a class="ae lz" href="https://www.google.com/flights#flt=/m/0k3p..2019-12-12*./m/0k3p.2019-12-16;c:EUR;e:1;dt:1800-2400*1600-2400;ls:1w;sd:1;t:e" rel="noopener ugc nofollow" target="_blank">https://www.google.com/flights#flt=AMS..2019-12-13 * . AMS . 2019-12-15；c:欧元；e:1；dt:1800-2400 * 1600-2400；ls:1w；SD:1；t:e </a></p><p id="153c" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">在该 URL 中，AMS 指的是阿姆斯特丹，您也可以在那里看到我们选择的日期和时间限制。</p><p id="ff7f" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">URL 中的搜索逻辑非常简单:</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="1ea1" class="na nb it mw b gy nc nd l ne nf"><a class="ae lz" href="https://www.google.com/flights?hl=en#flt=/m/0k3p..{departure_date}*./m/0k3p.{return_date};c:EUR;e:1;dt:{takeoff_after}-{takeoff_until}*{return_after}-{return_until};ls:1w;p:{max_budget}00.2.EUR;px:1;sd:1;er:296254327.-269199219.671078146.490175781;t:e" rel="noopener ugc nofollow" target="_blank">https://www.google.com/flights?hl=en#flt={city_code}..{departure_date}*.{city_code}.{return_date};c:EUR;e:1;dt:{takeoff_after}-{takeoff_until}*{return_after}-{return_until};ls:1w;p:{max_budget}.0.EUR;px:1;sd:1;er:296254327.-269199219.671078146.490175781;t:e</a></span></pre><p id="886a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">其中<em class="ma">城市 _ 代码</em>为 IATA 机场代码，<em class="ma">出发 _ 日期</em>和<em class="ma">返回 _ 日期</em>格式为<strong class="kw iu"><em class="ma">yyyy-mm-DD</em></strong><em class="ma">；起飞 _ 之后，起飞 _ 直到，返回 _ 之后，</em>和<em class="ma">返回 _ 直到</em>格式为<strong class="kw iu">HHMM</strong>；而<em class="ma"> max_budget </em>格式是一个整数，以欧元为单位定义最高价格。<em class="ma"> er </em>参数定义了寻找目的地的区域。您可以使用缩放功能，将这些数字更改为您感兴趣的任何区域。</p><p id="242b" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">按照这个简单的 URL 逻辑，我创建了一个 python 库，它可以扫描 Google 航班并将行程保存在一个 CSV 文件中。您可以在此回购中找到代码:</p><blockquote class="ng nh ni"><p id="f515" class="ku kv ma kw b kx ky ju kz la lb jx lc nj le lf lg nk li lj lk nl lm ln lo lp im bi translated"><a class="ae lz" href="https://gitlab.com/cintibrus/scrap_flights" rel="noopener ugc nofollow" target="_blank">https://gitlab.com/cintibrus/scrap_flights</a></p></blockquote><p id="f492" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">您可以下载它，导入库，然后通过用 CSV 文件名创建 GoogleFlights 对象来调用它。然后，您可以通过调用 createDataWorldwide 方法扫描任何地方的所有目的地，如下所示:</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="acd6" class="na nb it mw b gy nc nd l ne nf">gs = GoogleFlights(csv_filename)<br/>gs.createDataWorldwide(travel_lenght_list,start_period,end_period,steps_days,takeoff_after,takeoff_until,return_after,return_until,nr_passengers)</span></pre><p id="3dba" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">createDataWorldwide 方法的参数如下。<em class="ma">travel _ length _ list</em>是一个数组，包含您要扫描的住宿天数，例如，[2，3]将扫描包含 2 晚和 3 晚的旅行。<em class="ma"> start_period </em>是开始扫描的第一个出发日期；因此，如果您想扫描周六出发、周日返回的所有往返航班，请确保<em class="ma"> start_period </em>是周六，并且<em class="ma">travel _ length _ list</em>=[1]。<em class="ma"> end_period </em>是扫描的最后一个出发日期；对我来说，是 2020 年 12 月的任何一天。参数<em class="ma"> steps_days </em>是扫描出发日期之间的间隔天数；因此，如果<em class="ma"> steps_days </em> =7，它将扫描每周出发的航班，如果<em class="ma"> steps_days </em> =1，它将扫描每天出发的航班。我使用<em class="ma">起飞 _ 之后</em>和<em class="ma">起飞 _ 直到</em>只扫描 18 小时后出发的行程。因为我想周五下班后去旅游。同样，我使用<em class="ma"> return_after </em>和<em class="ma"> return_until </em>扫描 17 小时后返回阿姆斯特丹的航班。因为我想在周日早上花些时间在城里逛逛。最后可以用<em class="ma"> nr_passengers </em>指定乘客数量。</p><p id="ccdd" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">如果你没有任何限制，并且想去野外，你可以设置 travel _ length _ list =[2，3，7](它可以有你想要的许多持续时间选项)，<em class="ma">start _ period</em>= ' 2020–01–01 '，<em class="ma">end _ period</em>= ' 2020–12–31 '，<em class="ma"> steps_days </em> =1，<em class="ma"> takeoff_after </em> ='000 '，<em class="ma">take off _ out 这将扫描 2020 年任何日期从阿姆斯特丹出发、持续 2、3 或 7 晚的所有往返航班。</em></p></div><div class="ab cl nm nn hx no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="im in io ip iq"><p id="b52d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi lq translated"><span class="l lr ls lt bm lu lv lw lx ly di"> F </span>还是我的用例，我用我的 python 库刮出了 2020 年每个周末从阿姆斯特丹到任何目的地的所有往返，价格低于 300 欧元的 2 位乘客。</p><p id="aa62" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我对周末的定义是 18 小时后的星期五。17 小时后周日返回，但可以很容易地更改。这是我如何使用库来实现我想要的:</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="e26f" class="na nb it mw b gy nc nd l ne nf">gs.createDataWorldwide([2],'2019-12-06','2020-12-01',7,takeoff_after='1800',return_after='1700',nr_passengers=2)</span></pre><p id="c000" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">它会创建一个 CSV 文件。该文件的一个小示例如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nt"><img src="../Images/554f1db48a92098e0414bca776c53e69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R2WQ2hWEk300ilO-UhHYlA.png"/></div></div></figure><p id="01bd" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">目前还没有 2020 年 11 月和 12 月的选项，所以我找到的最后一个周末的航班是 2020 年 10 月 16 日。</p><p id="59e1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">现在我可以称这个方法为 optimum_weekends，来寻找 2020 年最低预算的旅行路线。</p><pre class="kj kk kl km gt mv mw mx my aw mz bi"><span id="c772" class="na nb it mw b gy nc nd l ne nf">gs.optimum_weekends(duration_max,from_start,allow_max_city_duplicates)</span></pre><p id="cd2d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">参数<em class="ma"> duration_max </em>过滤掉超过<code class="fe nu nv nw mw b"><em class="ma">x</em></code>小时的航班。我选择了<em class="ma"> duration_max </em> =7，因为我不想飞行超过 7 个小时。参数 from_start 指定旅程的开始日期。参数<em class="ma">allow _ max _ city _ duplicates</em>过滤掉具有超过<code class="fe nu nv nw mw b"><em class="ma">x</em></code>个重复目的地的路线。该方法通过为 2020 年所有周末的每个日期选择目的地的排列，创建了数千条可能的路线。输出是对于扫描的行程具有最低可能预算的路线。输出如下所示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/1a80c0906c55aa43a9236df55ddc0834.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R5iEI_l-r4MILbOuKi5Plw.jpeg"/></div></div><figcaption class="mc md gj gh gi me mf bd b be z dk">Itinerary of weekend trips for 2020</figcaption></figure><p id="61e5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我需要在 2020 年每个周末旅行(不包括 11 月和 12 月)的总预算是<strong class="kw iu"> 7670 </strong>欧元，2 名乘客，从阿姆斯特丹来回。我将在 42 个周末了解 26 个不同的城市。我也不需要在工作中请假。</p><p id="b207" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">实际上，我对多次访问同一个城市不感兴趣，所以让我们删除重复的城市，让我们保留最便宜的选项。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mb"><img src="../Images/841a006f909c8e8804125216cd2943b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CkcZyp_eQUyOTWfG6yy-WQ.png"/></div></div><figcaption class="mc md gj gh gi me mf bd b be z dk">Itinerary of weekend trips for 2020 to unique destinations</figcaption></figure><h1 id="5062" class="ny nb it bd nz oa ob oc od oe of og oh jz oi ka oj kc ok kd ol kf om kg on oo bi translated">我需要为 2020 年 2 名乘客游览 26 个不同城市的优化预算旅行路线的总预算是 5061 欧元。</h1></div><div class="ab cl nm nn hx no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="im in io ip iq"><p id="8afc" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">我期待人们使用该工具，根据不同的限制或改进建议，提出其他优化策略。在我的头顶上，人们可以使用该工具找到 2020 年前往特定目的地的最便宜的日期；或者调查航班价格是否在一天之内、一周之内或随着 IP 国家发生变化；或者发现票价错误。天空不是极限，是目标:)。</p></div></div>    
</body>
</html>