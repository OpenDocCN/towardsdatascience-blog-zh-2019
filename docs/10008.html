<html>
<head>
<title>An introduction to working with R and Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 R 和 Python 的介绍</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/an-introduction-to-working-with-r-and-python-1c51fac0b16f?source=collection_archive---------9-----------------------#2019-12-31">https://towardsdatascience.com/an-introduction-to-working-with-r-and-python-1c51fac0b16f?source=collection_archive---------9-----------------------#2019-12-31</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><blockquote class="jn jo jp"><p id="2652" class="jq jr js jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ij bi translated">T <!-- -->他的文章旨在介绍如何在 Python 中使用 R</p></blockquote><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi kp"><img src="../Images/1d49e17ae509a612e047789007ac450d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZnMyVIl6BMEJTOOmvch_JQ.jpeg"/></div></div><figcaption class="lb lc gj gh gi ld le bd b be z dk">Image by Mitchell Luo</figcaption></figure><p id="a525" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lf kd ke kf lg kh ki kj lh kl km kn ko ij bi translated">当我还是一名大学生时，统计学课程(生存分析、多变量分析等)是在 r 中教授的。然而，由于我希望学习数据科学，所以我选择了 Python，因为它对我来说似乎很“怪异”。</p><p id="04d5" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lf kd ke kf lg kh ki kj lh kl km kn ko ij bi translated">由于只使用 Python，我偶然发现需要实现一些统计技术，如离群值的 Grubb 检验、模拟的马尔可夫链蒙特卡罗或合成数据的贝叶斯网络。因此，本文旨在作为一篇介绍性的指南，将 R 融入到您作为 Python 数据科学家的工作流程中。如果您想作为一名 R 数据科学家将 Python 集成到您的工作流程中，reticulate 包很有用，请查看[1]。</p><h1 id="a22f" class="li lj iq bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">rpy2</h1><p id="7a15" class="pw-post-body-paragraph jq jr iq jt b ju mg jw jx jy mh ka kb lf mi ke kf lg mj ki kj lh mk km kn ko ij bi translated">我们选择 rpy2 框架，其他选项有<a class="ae ml" href="https://pypi.org/project/pyRserve/" rel="noopener ugc nofollow" target="_blank"> pyRserve </a>或<a class="ae ml" href="http://bioinfo.ihb.ac.cn/softwares/PypeR/" rel="noopener ugc nofollow" target="_blank"> pypeR </a>，因为它运行嵌入式 R。换句话说，它允许 Python 和 R 对象之间通过 rpy2.robjects 进行通信，稍后我们将看到一个将 pandas 数据帧转换为 R 数据帧的特定示例。如果您在以下任何步骤中遇到困难，请阅读<a class="ae ml" href="https://rpy2.github.io/doc/latest/html/index.html" rel="noopener ugc nofollow" target="_blank">官方</a>文档或参考资料。</p><p id="137e" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lf kd ke kf lg kh ki kj lh kl km kn ko ij bi translated">我们将介绍在 Python 中开始使用 R 的三个步骤。最后，我们将做一个实际的例子，并涵盖 rpy2 包允许您处理的更多功能。</p><ol class=""><li id="314b" class="mm mn iq jt b ju jv jy jz lf mo lg mp lh mq ko mr ms mt mu bi translated">安装 R 包。</li><li id="c74f" class="mm mn iq jt b ju mv jy mw lf mx lg my lh mz ko mr ms mt mu bi translated">从 r 导入包和函数。</li><li id="94d3" class="mm mn iq jt b ju mv jy mw lf mx lg my lh mz ko mr ms mt mu bi translated">将 pandas 数据帧转换为 R 数据帧，反之亦然。</li><li id="ffa2" class="mm mn iq jt b ju mv jy mw lf mx lg my lh mz ko mr ms mt mu bi translated">实际例子(运行贝叶斯网络)。</li></ol><p id="034e" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lf kd ke kf lg kh ki kj lh kl km kn ko ij bi translated">但是首先，我们应该安装 rpy2 软件包。</p><pre class="kq kr ks kt gt na nb nc nd aw ne bi"><span id="7e8c" class="nf lj iq nb b gy ng nh l ni nj"># Jupyter Notebook option<br/>!pip install rpy2<br/># Terminal option<br/>pip install rpy2</span></pre><h2 id="5524" class="nf lj iq bd lk nk nl dn lo nm nn dp ls lf no np lw lg nq nr ma lh ns nt me nu bi translated">1.安装 R 包</h2><p id="9a23" class="pw-post-body-paragraph jq jr iq jt b ju mg jw jx jy mh ka kb lf mi ke kf lg mj ki kj lh mk km kn ko ij bi translated">在 R 中，安装包是通过从 CRAN mirrors 下载然后在本地安装来实现的。与 Python 模块类似，可以安装并加载包。</p><pre class="kq kr ks kt gt na nb nc nd aw ne bi"><span id="793a" class="nf lj iq nb b gy ng nh l ni nj"># Choosing a CRAN Mirror<br/>import rpy2.robjects.packages as rpackages<br/>utils = rpackages.importr('utils')<br/>utils.chooseCRANmirror(ind=1)</span><span id="9be7" class="nf lj iq nb b gy nv nh l ni nj"># Installing required packages<br/>from rpy2.robjects.vectors import StrVector<br/>packages = ('bnlearn',...,'other desired packages')<br/>utils.install_packages(StrVector(packages))</span></pre><p id="94dc" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lf kd ke kf lg kh ki kj lh kl km kn ko ij bi translated">通过在<strong class="jt ir"><em class="js"/></strong><code class="fe nw nx ny nb b">chosseCRANmirror</code><strong class="jt ir"><em class="js"/></strong>中选择<code class="fe nw nx ny nb b">ind = 1</code><em class="js"/>，我们保证自动重定向到离我们位置最近的服务器。现在，我们将讨论第二步。</p><h2 id="64c7" class="nf lj iq bd lk nk nl dn lo nm nn dp ls lf no np lw lg nq nr ma lh ns nt me nu bi translated">2.导入包和函数</h2><p id="94b4" class="pw-post-body-paragraph jq jr iq jt b ju mg jw jx jy mh ka kb lf mi ke kf lg mj ki kj lh mk km kn ko ij bi translated">这里，我们将导入在实际例子中执行贝叶斯网络所需的库和函数。</p><pre class="kq kr ks kt gt na nb nc nd aw ne bi"><span id="f2d2" class="nf lj iq nb b gy ng nh l ni nj"># Import packages<br/>from rpy2.robjects.packages import importr<br/>base, bnlearn = importr('base'), importr('bnlearn')</span><span id="a65f" class="nf lj iq nb b gy nv nh l ni nj"># Import Functions<br/>bn_fit, rbn = bnlearn.bn_fit, bnlearn.rbn<br/>hpc, rsmax2, tabu = bnlearn.hpc, bnlearn.rsmax2, bnlearn.tabu</span></pre><p id="d4a0" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lf kd ke kf lg kh ki kj lh kl km kn ko ij bi translated">为了导入任何函数，在每个包的字典中查看“rpy2”键是很方便的，例如，在我们运行的 bnlearn 上查看可导入的函数:</p><pre class="kq kr ks kt gt na nb nc nd aw ne bi"><span id="7633" class="nf lj iq nb b gy ng nh l ni nj">bnlearn.__dict__['_rpy2r']</span><span id="44b4" class="nf lj iq nb b gy nv nh l ni nj">Output:<br/>...<br/>...<br/>'bn_boot': 'bn.boot',<br/>  'bn_cv': 'bn.cv',<br/>  'bn_cv_algorithm': 'bn.cv.algorithm',<br/>  'bn_cv_structure': 'bn.cv.structure',<br/>  'bn_fit': 'bn.fit',<br/>  'bn_fit_backend': 'bn.fit.backend',<br/>  'bn_fit_backend_continuous': 'bn.fit.backend.continuous',<br/>...<br/>...</span></pre><p id="2e1b" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lf kd ke kf lg kh ki kj lh kl km kn ko ij bi translated">有关如何导入函数 checkout [4]或[5]的更多信息。</p><h2 id="93db" class="nf lj iq bd lk nk nl dn lo nm nn dp ls lf no np lw lg nq nr ma lh ns nt me nu bi translated">3.将 pandas 数据帧转换为 R 数据帧，反之亦然</h2><p id="5d85" class="pw-post-body-paragraph jq jr iq jt b ju mg jw jx jy mh ka kb lf mi ke kf lg mj ki kj lh mk km kn ko ij bi translated">就我个人而言，我认为这个功能允许您将可伸缩性(python)与统计工具(R)结合起来。举一个个人的例子，当我使用多处理 python 库实现并行计算时，除了 statsmodels Python 包的函数之外，我还想尝试 forecast R 库中的<code class="fe nw nx ny nb b">auto.arima()</code>函数来进行预测。因此，<code class="fe nw nx ny nb b">robjects.conversion</code>允许人们融合两种编程语言的精华。</p><pre class="kq kr ks kt gt na nb nc nd aw ne bi"><span id="e00e" class="nf lj iq nb b gy ng nh l ni nj"># Allow conversion<br/>import rpy2.robjects as ro<br/>from rpy2.objects import pandas2ri<br/>pandas2ri.activate()</span><span id="4fe6" class="nf lj iq nb b gy nv nh l ni nj"># Convert to R dataframe<br/>r_dt = ro.conversion.py2rpy(dt) # dt is a pd.DataFrame object</span><span id="2785" class="nf lj iq nb b gy nv nh l ni nj"># Convert back to pandas DataFrame        <br/>pd_dt = ro.conversion.rpy2py(r_dt)</span></pre><p id="dd55" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lf kd ke kf lg kh ki kj lh kl km kn ko ij bi translated">当激活熊猫转换(<code class="fe nw nx ny nb b">pandas2ri.activate()</code>)时，许多 R 到熊猫的转换将自动完成。然而，对于显式转换，我们调用<code class="fe nw nx ny nb b">py2rpy</code>或<code class="fe nw nx ny nb b">rpy2py</code>函数。</p><h2 id="9ee8" class="nf lj iq bd lk nk nl dn lo nm nn dp ls lf no np lw lg nq nr ma lh ns nt me nu bi translated">4.贝叶斯网络的实际例子</h2><p id="ec5f" class="pw-post-body-paragraph jq jr iq jt b ju mg jw jx jy mh ka kb lf mi ke kf lg mj ki kj lh mk km kn ko ij bi translated">除了蒙特卡罗方法，贝叶斯网络也是模拟数据的一种选择。然而，到目前为止，Python 中还没有可用于此任务的库。因此，我选择了 bnlearn 包，它可以学习贝叶斯网络的图形结构，并从中进行推理。</p><p id="12c7" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lf kd ke kf lg kh ki kj lh kl km kn ko ij bi translated">在下面的例子中，我们使用混合算法(<code class="fe nw nx ny nb b">rsmax2</code>)来学习网络的结构，因为它允许我们使用基于约束和基于分数的算法的任意组合。然而，根据问题的性质，你应该选择正确的启发式算法，可用算法的完整列表见[7]。一旦网络被学习，我们用<code class="fe nw nx ny nb b">rbn</code>函数从贝叶斯网络中模拟 n 个随机样本。最后，我们执行一个 try-except 结构来处理特定类型的错误。</p><pre class="kq kr ks kt gt na nb nc nd aw ne bi"><span id="85dd" class="nf lj iq nb b gy ng nh l ni nj">r_imputados = robjects.conversion.py2rpy(imputados)                <br/><br/>try:   <br/>    # Learn structure of Network<br/>    structure = rsmax2(data, restrict = 'hpc', maximize = 'tabu')       <br/>    <br/>    fitted = bn_fit(structure, data = data, method = "mle")                                               <br/>    <br/>    # Generate n number of observations<br/>    r_sim = rbn(fitted, n = 10)<br/>    <br/>except rpy2.rinterface_lib.embedded.RRuntimeError:<br/>    print("Error while running R methods")</span></pre><p id="d4a3" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lf kd ke kf lg kh ki kj lh kl km kn ko ij bi translated">当我们不希望函数失败或做一些意想不到的事情时，就会发生 RunTimeError 。在这种情况下，我们捕获这个错误是因为这是一种在出错时通知用户这不是另一种错误的方式(完整的异常参见[9])。作为一个例子，我得到了在运行<code class="fe nw nx ny nb b">rsmax2 </code>函数时没有找到<code class="fe nw nx ny nb b">hybrid.pc.filter</code> hybrid.pc.filter 的错误。</p><h2 id="1fce" class="nf lj iq bd lk nk nl dn lo nm nn dp ls lf no np lw lg nq nr ma lh ns nt me nu bi translated">更多功能</h2><p id="6b10" class="pw-post-body-paragraph jq jr iq jt b ju mg jw jx jy mh ka kb lf mi ke kf lg mj ki kj lh mk km kn ko ij bi translated">使用 rpy2 低级接口和高级接口，您可以做更多的事情。例如，您可以用 R 调用 python 函数，让我们看看如何通过共轭梯度法找到四维 Colville 函数的最小值。</p><pre class="kq kr ks kt gt na nb nc nd aw ne bi"><span id="19dd" class="nf lj iq nb b gy ng nh l ni nj"><strong class="nb ir">from</strong> <strong class="nb ir">rpy2.robjects.vectors</strong> <strong class="nb ir">import</strong> FloatVector<br/><strong class="nb ir">from</strong> <strong class="nb ir">rpy2.robjects.packages</strong> <strong class="nb ir">import</strong> importr<br/><strong class="nb ir">import</strong> <strong class="nb ir">rpy2.rinterface</strong> <strong class="nb ir">as</strong> <strong class="nb ir">ri<br/></strong>stats = importr('stats')<br/><br/><em class="js"># Colville f: R^4 ---&gt; R</em><br/><strong class="nb ir">def</strong> Colville(x):<br/>    x1, x2, x3, x4 = x[0], x[1], x[2], x[3]<br/>    <br/>    <strong class="nb ir">return</strong>   100*(x1**2-x2)**2 + (x1-1)**2+(x3-1)**2 + 90*(x3**2-x4)**2 + 10.1*((x2-1)**2 + (x4-1)**2) + 19.8*(x2-1)*(x4-1)<br/><br/><em class="js"># Expose function to R</em><br/>Colville = ri.rternalize(Colville)<br/><br/><em class="js"># Initial point</em><br/>init_point = FloatVector((3, 3, 3, 3))<br/><br/><em class="js"># Optimization Function</em><br/>res = stats.optim(init_point, Colville, method = c("CG"))</span></pre><blockquote class="jn jo jp"><p id="32df" class="jq jr js jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ij bi translated"><strong class="jt ir">参考文献:</strong></p></blockquote><p id="90e4" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lf kd ke kf lg kh ki kj lh kl km kn ko ij bi translated">[1]马特·布朗。“使用 reticulate 包从 R 运行 Python 代码”。r 酒吧。网址:<a class="ae ml" href="https://rstudio-pubs-static.s3.amazonaws.com/407460_396f867ce3494d479fd700960879e22c.html" rel="noopener ugc nofollow" target="_blank">https://r studio-pubs-static . S3 . amazonaws . com/407460 _ 396 f 867 ce 3494d 479 FD 700960879 e22c . html</a></p><p id="6332" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lf kd ke kf lg kh ki kj lh kl km kn ko ij bi translated">[2] Ajay Ohri。“结合使用 Python 和 r: 3 种主要方法”。KDnuggets。网址:<a class="ae ml" href="https://www.kdnuggets.com/2015/12/using-python-r-together.html" rel="noopener ugc nofollow" target="_blank">https://www . kdnugges . com/2015/12/using-python-r-together . html</a></p><p id="5976" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lf kd ke kf lg kh ki kj lh kl km kn ko ij bi translated">[3] Rpy2 官方文档。网址:【https://rpy2.github.io/doc/latest/html/index.html T2】</p><p id="045f" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lf kd ke kf lg kh ki kj lh kl km kn ko ij bi translated">[4]<a class="ae ml" href="https://stackoverflow.com/questions/59462337/importing-any-function-from-an-r-package-into-python/59462338#59462338" rel="noopener ugc nofollow" target="_blank">https://stack overflow . com/questions/59462337/importing-any-function-from-an-r-package-into-python/59462338 # 59462338</a></p><p id="95a4" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lf kd ke kf lg kh ki kj lh kl km kn ko ij bi translated">[5]<a class="ae ml" href="https://stackoverflow.com/questions/49776568/calling-functions-from-within-r-packages-in-python-using-importr" rel="noopener ugc nofollow" target="_blank">https://stack overflow . com/questions/49776568/calling-functions-from-in-r-packages-in-python-using-importr</a></p><p id="5285" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lf kd ke kf lg kh ki kj lh kl km kn ko ij bi translated">[6]<a class="ae ml" href="https://stackoverflow.com/questions/47306899/how-do-i-catch-an-rpy2-rinterface-rruntimeerror-in-python" rel="noopener ugc nofollow" target="_blank">https://stack overflow . com/questions/47306899/how-do-I-catch-an-rpy 2-rinter face-rruntimeerror-in-python</a></p><p id="53eb" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lf kd ke kf lg kh ki kj lh kl km kn ko ij bi translated">[7]bn 学习官方文档。<a class="ae ml" href="http://www.bnlearn.com/documentation/man/structure.learning.html" rel="noopener ugc nofollow" target="_blank">http://www . bn learn . com/documentation/man/structure . learning . html</a></p><p id="c86e" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lf kd ke kf lg kh ki kj lh kl km kn ko ij bi translated">[8]丹尼尔·厄姆。“贝叶斯网络与 bnlearn 包的例子”。网址:<a class="ae ml" href="http://gradientdescending.com/bayesian-network-example-with-the-bnlearn-package/" rel="noopener ugc nofollow" target="_blank">http://gradient descending . com/Bayesian-network-example-with-the-bn learn-package/</a></p><p id="3fb7" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lf kd ke kf lg kh ki kj lh kl km kn ko ij bi translated">[9] Python 3.8 内置异常。URL:<a class="ae ml" href="https://docs.python.org/3.8/library/exceptions.html#RuntimeError" rel="noopener ugc nofollow" target="_blank">https://docs . python . org/3.8/library/exceptions . html # runtime error</a></p><p id="a7b4" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lf kd ke kf lg kh ki kj lh kl km kn ko ij bi translated">[10]罗伯特，克里斯蒂安；卡塞拉，乔治。介绍蒙特卡罗方法。2010</p><p id="05bb" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb lf kd ke kf lg kh ki kj lh kl km kn ko ij bi translated">[11] Nagarajan，Radhakrishnan 马可·斯库塔里；太棒了，索菲。贝叶斯网络。2013</p></div></div>    
</body>
</html>