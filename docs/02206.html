<html>
<head>
<title>How to Run SQL on PDF Files</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何对 PDF 文件运行 SQL</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-run-sql-on-pdf-files-48d0a4dd151f?source=collection_archive---------12-----------------------#2019-04-11">https://towardsdatascience.com/how-to-run-sql-on-pdf-files-48d0a4dd151f?source=collection_archive---------12-----------------------#2019-04-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="ee86" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">pdf 是今天分发和共享固定布局文档的事实标准。对我的笔记本电脑文件夹的快速调查显示，账户报表、收据、技术论文、书籍章节和演示幻灯片都是 pdf 格式的。许多有价值的信息都可以在各种 PDF 文件中找到。这也是<a class="ae ko" href="https://www.rockset.com/" rel="noopener ugc nofollow" target="_blank"> Rockset </a>支持对 PDF 文件进行 SQL 查询的重要原因，我们的使命是让数据对每个人都更有用。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi kp"><img src="../Images/bbf2ca6ae38e45c40d874a1697a219db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C-ftMCFfIje0Vc2hLgUd-w.jpeg"/></div></div></figure><h1 id="3514" class="lb lc it bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">Rockset 中 pdf 上的快速 SQL</h1><p id="be58" class="pw-post-body-paragraph jq jr it js b jt lz jv jw jx ma jz ka kb mb kd ke kf mc kh ki kj md kl km kn im bi translated">Rockset 使开发人员和数据从业者可以轻松地在各种数据格式的半结构化数据上接收和运行快速 SQL，如 JSON、CSV 和 XLSX，而无需任何前期数据准备。现在将 PDF 添加到混合数据中，用户可以将 PDF 数据与来自不同来源的其他格式的数据组合到他们的 SQL 分析中。或者一起分析多个 pdf 也可能是有价值的，如果你像我一样有一系列的电费账单，我们将在下面的简短例子中看到。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi me"><img src="../Images/046709cee99534fca0340e3e9f70618f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-tc9aGFUcHjBcTdhkcgljA.jpeg"/></div></div></figure><p id="6d12" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">上传 pdf 文件</strong></p><p id="917a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">从现有的<a class="ae ko" href="https://docs.rockset.com/concepts/#collections" rel="noopener ugc nofollow" target="_blank">集合</a>中，点击控制台右上角的<a class="ae ko" href="https://docs.rockset.com/write-api/#upload-a-file" rel="noopener ugc nofollow" target="_blank">上传文件</a>按钮，并指定 PDF 格式以摄取到 Rockset 中。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi mf"><img src="../Images/4fb54242e79a5ac48495f93fb63c183a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*XFByngDVnntZq13r.png"/></div></div></figure><p id="b1f2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">查询 pdf 中的数据</strong></p><p id="4e33" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我上传了 9 个月的电费。我们可以使用<a class="ae ko" href="https://docs.rockset.com/commands/#describe" rel="noopener ugc nofollow" target="_blank"> DESCRIBE </a>命令来查看从 pdf 中提取的字段。</p><pre class="kq kr ks kt gt mg mh mi mj aw mk bi"><span id="c8e3" class="ml lc it mh b gy mm mn l mo mp">&gt; describe "elec-bills";<br/>+--------------------------------------------+---------------+---------+-----------+<br/>| field                                      | occurrences   | total   | type      |<br/>|--------------------------------------------+---------------+---------+-----------|<br/>| ['Author']                                 | 9             | 9       | string    |<br/>| ['CreationDate']                           | 9             | 9       | string    |<br/>| ['Creator']                                | 9             | 9       | string    |<br/>| ['ModDate']                                | 9             | 9       | string    |<br/>| ['Producer']                               | 9             | 9       | string    |<br/>| ['Subject']                                | 9             | 9       | string    |<br/>| ['Title']                                  | 9             | 9       | string    |<br/>| ['_event_time']                            | 9             | 9       | timestamp |<br/>| ['_id']                                    | 9             | 9       | string    |<br/>| ['_meta']                                  | 9             | 9       | object    |<br/>| ['_meta', 'file_upload']                   | 9             | 9       | object    |<br/>| ['_meta', 'file_upload', 'file']           | 9             | 9       | string    |<br/>| ['_meta', 'file_upload', 'file_upload_id'] | 9             | 9       | string    |<br/>| ['_meta', 'file_upload', 'upload_time']    | 9             | 9       | string    |<br/>| ['author']                                 | 9             | 9       | string    |<br/>| ['creation_date']                          | 9             | 9       | int       |<br/>| ['creator']                                | 9             | 9       | string    |<br/>| ['modification_date']                      | 9             | 9       | int       |<br/>| ['producer']                               | 9             | 9       | string    |<br/>| ['subject']                                | 9             | 9       | string    |<br/>| ['text']                                   | 9             | 9       | string    |<br/>| ['title']                                  | 9             | 9       | string    |<br/>+--------------------------------------------+---------------+---------+-----------+</span></pre><p id="3b37" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">Rockset 解析出所有元数据，如<code class="fe mq mr ms mh b">author</code>、<code class="fe mq mr ms mh b">creation_date</code>等。从文档中随同<code class="fe mq mr ms mh b">text</code>。</p><p id="4d0e" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><code class="fe mq mr ms mh b">text</code>字段通常是 PDF 中大多数信息所在的地方，所以让我们检查一下示例<code class="fe mq mr ms mh b">text</code>字段中有什么。</p><pre class="kq kr ks kt gt mg mh mi mj aw mk bi"><span id="0b60" class="ml lc it mh b gy mm mn l mo mp">+--------------------------------------------------------------+<br/>| text                                                         |<br/>|--------------------------------------------------------------|<br/>| ....                                                         |<br/>| ....                                                         |<br/>| Statement Date: 10/11/2018                                   |<br/>| Your Account Summary                                         |<br/>| ....                                                         |<br/>| Total Amount Due:                                            |<br/>| $157.57                                                      |<br/>| Amount Enclosed:                                             |<br/>| ...                                                          |<br/>+--------------------------------------------------------------+</span></pre><p id="9d43" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">合并来自多个 pdf 的数据</strong></p><p id="1d13" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在 Rockset 中获取并索引了我 9 个月的电费账单后，我可以对这段时间内的使用情况做一些简单的分析。我们可以运行 SQL 查询来选择<code class="fe mq mr ms mh b">text</code>中的月/年和账单金额。</p><pre class="kq kr ks kt gt mg mh mi mj aw mk bi"><span id="0612" class="ml lc it mh b gy mm mn l mo mp">&gt; with details as (<br/>    select tokenize(REGEXP_EXTRACT(text, 'Statement Date: .*'))[3] as month,<br/>    tokenize(REGEXP_EXTRACT(text, 'Statement Date: .*'))[5] as year,<br/>    cast(tokenize(REGEXP_EXTRACT(text, 'Total Amount Due:\n.*\nAmount Enclosed'))[4] as float) as amount<br/>    from "elec-bills"<br/>) <br/>select concat(month, '/', year) as billing_period, amount<br/>from details<br/>order by year asc, month;<br/><br/>+----------+------------------+<br/>| amount   | billing_period   |<br/>|----------+------------------|<br/>| 47.55    | 04/2018          |<br/>| 76.5     | 05/2018          |<br/>| 52.28    | 06/2018          |<br/>| 50.58    | 07/2018          |<br/>| 47.62    | 08/2018          |<br/>| 39.7     | 09/2018          |<br/>| &lt;null&gt;   | 10/2018          |<br/>| 72.93    | 11/2018          |<br/>| 157.57   | 12/2018          |<br/>+----------+------------------+</span></pre><p id="20d2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">并将结果绘制在<a class="ae ko" href="https://docs.rockset.com/apache-superset/" rel="noopener ugc nofollow" target="_blank">超集</a>中。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi mt"><img src="../Images/7ea9422c2bfbb6f561653e6e38dfbc6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*OaB5q8YaeCHWGMZd.png"/></div></div></figure><p id="a812" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">我 10 月份的账单出人意料地为零。账单金额提取不正确吗？我回去查了一下，结果是我在 10 月份收到了一份加州气候信用，这使我的账单归零了，所以摄取和查询 pdf 就像它应该的那样工作了！</p></div><div class="ab cl mu mv hx mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="im in io ip iq"><p id="3f94" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><em class="nb">最初发表于</em><a class="ae ko" href="https://rockset.com/blog/how-to-run-sql-on-pdf-files/" rel="noopener ugc nofollow" target="_blank"><em class="nb">【rockset.com】</em></a><em class="nb">。</em></p></div></div>    
</body>
</html>