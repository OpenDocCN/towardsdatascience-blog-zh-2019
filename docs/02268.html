<html>
<head>
<title>Interactive Data Visualization with Vega</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 Vega 实现交互式数据可视化</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/interactive-data-visualization-with-vega-ab09e2843d54?source=collection_archive---------9-----------------------#2019-04-15">https://towardsdatascience.com/interactive-data-visualization-with-vega-ab09e2843d54?source=collection_archive---------9-----------------------#2019-04-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="bad6" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">什么是 Vega 以及如何使用它来构建 web 可视化</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/82b2533be7c253bf2f988732f6041ba7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EwU1RnookEMFSfaCX-CQdA.png"/></div></div></figure><p id="5649" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我一直在学习新的可视化工具，因为这有助于我为手头的任务找到合适的工具。谈到数据可视化，d3 通常是首选，但最近我一直在玩<a class="ae ln" href="https://vega.github.io/vega/" rel="noopener ugc nofollow" target="_blank"> <strong class="kt ir">织女星</strong> </a>，我很喜欢它。</p><p id="9b57" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Vega 引入了一个<strong class="kt ir">可视化语法</strong>。语法基本上是一套规定如何使用语言的规则，因此我们可以将 Vega 视为一种工具，它定义了一套如何构建和操作视觉元素的规则。</p><p id="0790" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">随着我在数据可视化方面的经验增长，我越来越发现<strong class="kt ir">约束是一件好事</strong>。通过引入可视化语法，Vega 为我们提供了一些约束条件。最棒的是，这些约束可以让用户在构建数据可视化时感到非常有效率。</p><p id="a79f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">还有<strong class="kt ir"> Vega-Lite </strong>，一种专注于快速创建<a class="ae ln" href="https://vega.github.io/vega-lite/" rel="noopener ugc nofollow" target="_blank">通用统计图形</a>的高级语法，但今天我们将坚持使用<strong class="kt ir"> Vega </strong>，它是一种更通用的工具。</p><p id="6f61" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">好了，介绍够了，让我们来了解一下织女星是如何工作的。</p><h1 id="443d" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">Vega 概述</h1><p id="02e9" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">我们可以<a class="ae ln" href="https://vega.github.io/vega/usage/" rel="noopener ugc nofollow" target="_blank">在 web 上部署 Vega</a>，但是在本教程中，我们将简单地使用<a class="ae ln" href="https://vega.github.io/editor/#/custom/vega" rel="noopener ugc nofollow" target="_blank"> Vega 编辑器</a>(这是关于 Vega 的另一件大事)。</p><p id="bb36" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在使用 Vega 时，我们在一个<strong class="kt ir"> JSON 对象</strong>中定义可视化。让我们开始构建一个条形图。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/3e3002a927e5715935c106ee0c20191e.png" data-original-src="https://miro.medium.com/v2/resize:fit:886/format:webp/1*A3q5jfv9fzJlKylfibGRxQ.png"/></div><figcaption class="mm mn gj gh gi mo mp bd b be z dk">A bar chart built with Vega</figcaption></figure><p id="e4b3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">如果我们分解这个图表，我们有:</p><ul class=""><li id="25ca" class="mq mr iq kt b ku kv kx ky la ms le mt li mu lm mv mw mx my bi translated">🗂数据(每个数据点的类别和数量)</li><li id="8ace" class="mq mr iq kt b ku mz kx na la nb le nc li nd lm mv mw mx my bi translated">📊x 轴，表示每个类别的位置(我们需要一个<em class="ne">标尺</em>来表示每个类别应该放在哪里)</li><li id="91a7" class="mq mr iq kt b ku mz kx na la nb le nc li nd lm mv mw mx my bi translated">📊y 轴，显示每个数据点的数量(我们需要一个<em class="ne">刻度</em>来表示每个数量应该放在哪里)</li><li id="498a" class="mq mr iq kt b ku mz kx na la nb le nc li nd lm mv mw mx my bi translated">✍🏾长方形</li></ul><p id="b32a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这就是我们使用 Vega 定义上述内容的方式:</p><pre class="kg kh ki kj gt nf ng nh ni aw nj bi"><span id="cd58" class="nk lp iq ng b gy nl nm l nn no">{<br/>  "$schema": "<a class="ae ln" href="https://vega.github.io/schema/vega/v5.json" rel="noopener ugc nofollow" target="_blank">https://vega.github.io/schema/vega/v5.json</a>",<br/>  "width": 400,<br/>  "height": 200,<br/>  "padding": 5,<br/>  <strong class="ng ir">"data"</strong>: [<br/>    {<br/>      "name": "our_data",<br/>      <strong class="ng ir">"values"</strong>: [<br/>        {<br/>          "category": "A",<br/>          "amount": 28<br/>        },<br/>        {<br/>          "category": "B",<br/>          "amount": 55<br/>        },<br/>        {<br/>          "category": "C",<br/>          "amount": 43<br/>        }<br/>      ]<br/>    }<br/>  ],<br/>  <strong class="ng ir">"scales"</strong>: [<br/>    {<br/>      "name": "xscale",<br/>      "type": "band",<br/>      "domain": {<br/>        "data": "our_data",<br/>        "field": "category"<br/>      },<br/>      "range": "width",<br/>      "padding": 0.05<br/>    },<br/>    {<br/>      "name": "yscale",<br/>      "domain": {<br/>        "data": "our_data",<br/>        "field": "amount"<br/>      },<br/>      "range": "height"<br/>    }<br/>  ],<br/>  <strong class="ng ir">"axes"</strong>: [<br/>    {<br/>      "orient": "bottom",<br/>      "scale": "xscale"<br/>    },<br/>    {<br/>      "orient": "left",<br/>      "scale": "yscale"<br/>    }<br/>  ],<br/>  <strong class="ng ir">"marks"</strong>: [<br/>    {<br/>      "type": "rect",<br/>      "from": {<br/>        "data": "our_data"<br/>      },<br/>      "encode": {<br/>        "enter": {<br/>          "x": {<br/>            "scale": "xscale",<br/>            "field": "category"<br/>          },<br/>          "width": {<br/>            "scale": "xscale",<br/>            "band": 1<br/>          },<br/>          "y": {<br/>            "scale": "yscale",<br/>            "field": "amount"<br/>          },<br/>          "y2": {<br/>            "scale": "yscale",<br/>            "value": 0<br/>          },<br/>          "fill": {<br/>            "value": "steelblue"<br/>          }<br/>        }<br/>      }<br/>    }<br/>  ]<br/>}</span></pre><p id="c302" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这里可以现场试一下<a class="ae ln" href="https://vega.github.io/editor/#/url/vega/N4KABGBEAkDODGALApgWwIaQFxUQFzwAdYsB6UgN2QHN0A6agSz0QFcAjOxge1IRQyUa6SgFY6AK1jcAdpAA04KAHdGAExbYwAFgAMuxREgpG1fFoBM+w1ELo1axjOpbRipZDXo8mHAG0lCFAIEKgZdFRkLUgfdgAbKJtQyAp0ONZkWC0A0NDgSHhvGm4AJwBPaIBBBSgI7lYZPEsADgBfJNz8wrxi8uiAIRrIOoamnFFRdsDOgqLqUoqcSABhIZHGrW0AZlbpiABdad2D9yMENMzs6eDcyHDI6IAPc4SFPag8MsIopfZ0GTUb1yUDU3AwTi0+S8PmisVe8igADNGMg4oClt1ehUpsDICV-tQfip1JoOkY7A4nC4cLo6LpREcOjdkvciZAyi9Eu9PGD0BCcFDvL4Puh4okkSi0dF1k0cbd8c42SYzE0jkp9qdao9Lv5rlBSiiNr9uAQwUNOU8LWA5UF9SVDWMoAlEU0EZALUsOYVXtb1ZrIBgSgBrLK6vLcz7faIlZDwV3cxElM0CzxC7AxUWvG0hSDIGTwbhqInM255nolSHvZKPSHu71s571obI1HoqCY+Z9bO41QaRC1j1QRsXIZ-AFaACM3duizA+UH7ItbpbUqWMsg0+SZQsA6bnqXUFS6SJuk3OeRcTitaPGWisB6qPit+OwN9wJfEBfh1aQA" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="e7b4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">让我们来看一下这些定义。我将在这里简要地解释它们，但是我们可以使用更多的属性来定制东西(在使用它们的时候检查一下<a class="ae ln" href="https://vega.github.io/vega/docs/" rel="noopener ugc nofollow" target="_blank">文档</a>是一个好主意)。</p><h2 id="21e6" class="nk lp iq bd lq np nq dn lu nr ns dp ly la nt nu ma le nv nw mc li nx ny me nz bi translated">🗂“数据”:[]</h2><p id="1f48" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">我们可以直接在规范中定义数据(就像我们使用<code class="fe oa ob oc ng b">"values"</code>属性一样),或者使用<code class="fe oa ob oc ng b">"url"</code>属性从外部文件(例如<em class="ne"> json </em>或<em class="ne"> csv </em>)加载数据。</p><h2 id="a279" class="nk lp iq bd lq np nq dn lu nr ns dp ly la nt nu ma le nv nw mc li nx ny me nz bi translated">📈"秤":[]</h2><p id="68b8" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">织女星音阶由<em class="ne"> d3 音阶</em>库提供。我们用<code class="fe oa ob oc ng b">"type"</code>关键字指定缩放的类型(默认为线性)。可以通过多种方式指定比例域:</p><ul class=""><li id="55a7" class="mq mr iq kt b ku kv kx ky la ms le mt li mu lm mv mw mx my bi translated">一个<a class="ae ln" href="https://vega.github.io/vega/docs/scales/#dataref" rel="noopener ugc nofollow" target="_blank">数据引用</a>对象，它指定一个或多个数据集中的字段值，就像我们对<code class="fe oa ob oc ng b">{"data": "our_data", "field": "amount"}</code>所做的那样。Vega 从数据集中计算出<code class="fe oa ob oc ng b">amount</code>键的<em class="ne">【min，max】</em>数组</li><li id="ca71" class="mq mr iq kt b ku mz kx na la nb le nc li nd lm mv mw mx my bi translated">作为字面<a class="ae ln" href="https://vega.github.io/vega/docs/types/#Array" rel="noopener ugc nofollow" target="_blank">数组</a>的域值</li><li id="e470" class="mq mr iq kt b ku mz kx na la nb le nc li nd lm mv mw mx my bi translated">解析为域值数组的<a class="ae ln" href="https://vega.github.io/vega/docs/types/#Signal" rel="noopener ugc nofollow" target="_blank">信号参考</a>。比如<code class="fe oa ob oc ng b">{"signal": "myDomain"}</code>(别急，后面我再讲信号)</li></ul><h2 id="aacf" class="nk lp iq bd lq np nq dn lu nr ns dp ly la nt nu ma le nv nw mc li nx ny me nz bi translated">📊"轴":[]</h2><p id="b09a" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">这里，我们需要指定用于创建轴的方向和<em class="ne">比例</em>。我们可以使用许多<a class="ae ln" href="https://vega.github.io/vega/docs/axes/" rel="noopener ugc nofollow" target="_blank">属性</a>来定制它们。</p><h2 id="1b42" class="nk lp iq bd lq np nq dn lu nr ns dp ly la nt nu ma le nv nw mc li nx ny me nz bi translated">✍🏾"标记":[]</h2><p id="3272" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">我们使用标记通过几何图元(矩形、圆形、直线等)对数据进行编码。在这个条形图中，我们使用了矩形标记。他们需要给定的<em class="ne">位置</em>、<em class="ne">宽度</em>和<em class="ne">高度</em>。我们还需要指定应该使用什么数据来构建标记(<code class="fe oa ob oc ng b">"from"</code>属性)。</p><pre class="kg kh ki kj gt nf ng nh ni aw nj bi"><span id="aace" class="nk lp iq ng b gy nl nm l nn no">"from": {"data":"our_data"}</span></pre><p id="c009" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">所有关于<code class="fe oa ob oc ng b">"x"</code>、<code class="fe oa ob oc ng b">"y"</code>和<code class="fe oa ob oc ng b">"width"</code>的定义都将来自这个数据集。织女星<a class="ae ln" href="https://vega.github.io/vega/docs/types/" rel="noopener ugc nofollow" target="_blank">类型</a>一开始可能看起来有点混乱，所以让我们来看看我们在这里使用的类型:</p><pre class="kg kh ki kj gt nf ng nh ni aw nj bi"><span id="55de" class="nk lp iq ng b gy nl nm l nn no">"x": {"scale": "xscale", "field": "category"}</span></pre><p id="ff27" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">rects 的<code class="fe oa ob oc ng b">"x"</code>属性将通过从<code class="fe oa ob oc ng b">"category"</code>字段向<code class="fe oa ob oc ng b">"xscale"</code>传递值来设置。</p><pre class="kg kh ki kj gt nf ng nh ni aw nj bi"><span id="480e" class="nk lp iq ng b gy nl nm l nn no">"y": {"scale": "xscale", "band": 1}</span></pre><p id="f9d1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">每个矩形的<code class="fe oa ob oc ng b">"y"</code>属性将是带刻度<code class="fe oa ob oc ng b">xscale</code>的范围带宽。</p><pre class="kg kh ki kj gt nf ng nh ni aw nj bi"><span id="fd1a" class="nk lp iq ng b gy nl nm l nn no">"fill": {"value": "steelblue"}</span></pre><p id="f3ad" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">矩形的<code class="fe oa ob oc ng b">"fill"</code>颜色将是钢蓝色。为了定义常量值，我们使用了<code class="fe oa ob oc ng b">"value"</code>属性。</p><p id="9470" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Vega 使用与 d3 相同的<em class="ne">进入、更新、退出</em>模式:</p><blockquote class="od oe of"><p id="9b68" class="kr ks ne kt b ku kv jr kw kx ky ju kz og lb lc ld oh lf lg lh oi lj lk ll lm ij bi translated">当数据第一次被处理并且一个标记实例被新添加到一个场景中时,<em class="iq">输入</em>属性被评估。对所有现有的(不存在的)标记实例评估<em class="iq">更新</em>属性。当支持标记的数据被移除时，评估<em class="iq">退出</em>属性，因此标记离开可视场景。”— <a class="ae ln" href="https://vega.github.io/vega/docs/marks/" rel="noopener ugc nofollow" target="_blank">维加文档</a></p></blockquote><p id="5170" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们在<code class="fe oa ob oc ng b">"encode"</code>属性中使用该模式。在这个条形图中，我们在处理数据时放置元素:</p><pre class="kg kh ki kj gt nf ng nh ni aw nj bi"><span id="801d" class="nk lp iq ng b gy nl nm l nn no"><strong class="ng ir">"encode"</strong>: {<br/>    <strong class="ng ir">"enter"</strong>: {<br/>        "x": {"scale": "xscale", "field": "category"},<br/>        "width": {"scale": "xscale", "band": 1},<br/>        "y": {"scale": "yscale", "field": "amount"},<br/>        "y2": {"scale": "yscale", "value": 0},<br/>        "fill": {"value": "steelblue"}<br/>     }<br/>}</span></pre><p id="105f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这就是织女星 101 之旅！为了更好地了解织女星的能力，让我们建立一个时间表。</p></div><div class="ab cl oj ok hu ol" role="separator"><span class="om bw bk on oo op"/><span class="om bw bk on oo op"/><span class="om bw bk on oo"/></div><div class="ij ik il im in"><h1 id="28f9" class="lo lp iq bd lq lr oq lt lu lv or lx ly jw os jx ma jz ot ka mc kc ou kd me mf bi translated">用织女星构建时间线</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ov"><img src="../Images/f07fc415cb66d095dae5ae6dc8e11b2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/format:webp/1*6RG5wACmTCBrv4vJX7lrig.png"/></div><figcaption class="mm mn gj gh gi mo mp bd b be z dk">A timeline built with Vega</figcaption></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ow"><img src="../Images/a6cbe900a794618d55d2c0adb65bebe8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*4ZaRokmm0GkNQVPuTNlHQA.png"/></div><figcaption class="mm mn gj gh gi mo mp bd b be z dk">Some Vega properties we'll use to build the timeline</figcaption></figure><h2 id="5749" class="nk lp iq bd lq np nq dn lu nr ns dp ly la nt nu ma le nv nw mc li nx ny me nz bi translated">1 — 🗂“数据”:[]</h2><p id="e90f" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">除了加载数据，我们还可以使用 Vega <a class="ae ln" href="https://vega.github.io/vega/docs/transforms/" rel="noopener ugc nofollow" target="_blank">转换</a>来过滤、计算新字段或导出新数据流。我们可以使用<a class="ae ln" href="https://vega.github.io/vega/docs/transforms/collect/" rel="noopener ugc nofollow" target="_blank"> collect </a>转换按名称对项目进行排序:</p><pre class="kg kh ki kj gt nf ng nh ni aw nj bi"><span id="fdb2" class="nk lp iq ng b gy nl nm l nn no">"data": [<br/>    {<br/>      "name": "libraries",<br/>      "format": {<br/>        "type": "json",<br/>        "parse": {<br/>          "release": "date:'%Y'"<br/>        }<br/>      },<br/>      "values": [<br/>        {<br/>          "name": "vega",<br/>          "release": "2013",<br/>          "license": "BSD 3-Clause",<br/>          "description": "Vega is a visualization grammar, a declarative language for creating, saving, and sharing interactive visualization designs"<br/>        },<br/>        {<br/>          "name": "d3",<br/>          "release": "2011",<br/>          "license": "BSD 3-Clause",<br/>          "description": "D3 (Data-Driven Documents or D3.js) is a JavaScript library for visualizing data using web standards"<br/>        },<br/>        {<br/>          "name": "plotly",<br/>          "release": "2012",<br/>          "license": "MIT",<br/>          "description": "Plotly.js is an open source JavaScript library for creating graphs and dashboards"<br/>        }<br/>      ],<br/>      <strong class="ng ir">"transform": [<br/>        {<br/>          "type": "collect",<br/>          "sort": {<br/>            "field": "name"<br/>          }<br/>        }<br/>      ]</strong><br/>    }<br/>  ]</span></pre><p id="aa0d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Vega 的另一个优点是它可以检查我们用来构建可视化的所有数据的内容:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ox"><img src="../Images/010159ca3d948aac10e925295e41dd9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pjb2-7kWQb42W0qmpWNp2A.png"/></div></div><figcaption class="mm mn gj gh gi mo mp bd b be z dk">The dataset sorted by name</figcaption></figure><h2 id="e603" class="nk lp iq bd lq np nq dn lu nr ns dp ly la nt nu ma le nv nw mc li nx ny me nz bi translated">2—📈"秤":[]</h2><p id="cad1" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">我们需要一个用于 x 轴的<strong class="kt ir">时间刻度</strong>和一个<strong class="kt ir">顺序刻度</strong>来给矩形上色:</p><pre class="kg kh ki kj gt nf ng nh ni aw nj bi"><span id="18e6" class="nk lp iq ng b gy nl nm l nn no">"scales": [<br/>    {<br/>      "name": "xScale",<br/>      <strong class="ng ir">"type": "time"</strong>,<br/>      <strong class="ng ir">"domain": {<br/>        "data": "libraries",<br/>        "field": "release"<br/>      }</strong>,<br/>      "range": "width",<br/>      "nice": "year"<br/>    },<br/>    {<br/>      "name": "colorScale",<br/>      "<strong class="ng ir">type": "ordinal",</strong><br/>      <strong class="ng ir">"domain": {<br/>        "data": "libraries",<br/>        "field": "license"<br/>      }</strong>,<br/>      "range": {<br/>        "scheme": "dark2"<br/>      }<br/>    }<br/>  ]</span></pre><h2 id="e65f" class="nk lp iq bd lq np nq dn lu nr ns dp ly la nt nu ma le nv nw mc li nx ny me nz bi translated">3 —📊"轴":[]</h2><p id="d4a1" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">让我们在底部放置一个轴，并在标签中显示年份:</p><pre class="kg kh ki kj gt nf ng nh ni aw nj bi"><span id="e159" class="nk lp iq ng b gy nl nm l nn no">"axes": [<br/>    {<br/>      "scale": "xScale",<br/>      <strong class="ng ir">"orient": "bottom",<br/>      "format": "%Y"</strong><br/>    }<br/>  ]</span></pre><h2 id="7b41" class="nk lp iq bd lq np nq dn lu nr ns dp ly la nt nu ma le nv nw mc li nx ny me nz bi translated">4 — ✍🏾"标记":[]</h2><p id="d7ae" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">有三个标记:矩形、矩形内的文本和从每个矩形到轴的线。我们将使用<code class="fe oa ob oc ng b">"rect"</code>、<code class="fe oa ob oc ng b">"text"</code>和<code class="fe oa ob oc ng b">"rule"</code>标记来定义它们。</p><p id="ead5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">但首先让我们介绍一个重要的织女星属性:<a class="ae ln" href="https://vega.github.io/vega/docs/signals/" rel="noopener ugc nofollow" target="_blank">信号</a>。</p><h2 id="b7fe" class="nk lp iq bd lq np nq dn lu nr ns dp ly la nt nu ma le nv nw mc li nx ny me nz bi translated">❗️Signals</h2><p id="107d" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">信号是动态变量。正如文档所说，信号值是<em class="ne">反应性的</em>:它们可以响应输入事件流、外部 API 调用或上游信号的变化而更新。这里我们将使用它们的初始值，但是它们的强大之处在于能够更新它们(我们将在下一次看到如何更新)。</p><pre class="kg kh ki kj gt nf ng nh ni aw nj bi"><span id="281a" class="nk lp iq ng b gy nl nm l nn no"><strong class="ng ir">"signals"</strong>: [<br/>    {<br/>      "name": "rectWidth",<br/>      "value": 50<br/>    },<br/>    {<br/>      "name": "rectHeight",<br/>      "value": 40<br/>    },<br/>    {<br/>      "name": "rectY",<br/>      "value": 85<br/>    },<br/>    {<br/>      "name": "rectCenter",<br/>      "init": "[rectWidth/2,rectY+rectHeight/2]"<br/>    }<br/>  ]</span></pre><p id="d3c4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">现在我们有了信号，就可以用它们来做标记了。信号也可以持有织女星<a class="ae ln" href="https://vega.github.io/vega/docs/expressions/" rel="noopener ugc nofollow" target="_blank">表情</a>。一个非常常用的是<a class="ae ln" href="https://vega.github.io/vega/docs/expressions/#scale" rel="noopener ugc nofollow" target="_blank">秤</a>:</p><blockquote class="od oe of"><p id="9eae" class="kr ks ne kt b ku kv jr kw kx ky ju kz og lb lc ld oh lf lg lh oi lj lk ll lm ij bi translated"><strong class="kt ir">缩放</strong> ( <em class="iq">名称</em>，<em class="iq">值</em> [，<em class="iq">组</em>)<br/>将命名的缩放变换(或投影)应用到指定的<em class="iq">值</em>。可选的<em class="iq">组</em>参数采用一个场景图组标记项来指示查找比例或投影的具体范围。</p></blockquote><p id="41c2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">在本例中，我们将使用一个表达式将矩形放置在每年的中间，表达式如下:</p><pre class="kg kh ki kj gt nf ng nh ni aw nj bi"><span id="a1f9" class="nk lp iq ng b gy nl nm l nn no">"signal":<strong class="ng ir"> "scale('xScale',datum.release)</strong>-rectWidth/2"<br/>         //<em class="ne">scale</em>(name, value<em class="ne">[</em>,group<em class="ne">]</em></span></pre><p id="72aa" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">正如我们前面看到的，我们需要指定应该使用什么数据来构建带有<code class="fe oa ob oc ng b">"from"</code>属性的标记。织女星是如此之大，以至于我们可以指定来自<strong class="kt ir">另一个标记本身的数据</strong>！在这种情况下，我们将使用来自 rect 标记的数据，这样我们就可以获得每个矩形的中心，并将文本放在中间。为了访问数据点，我们在表达式中使用了<code class="fe oa ob oc ng b">"datum"</code>。</p><pre class="kg kh ki kj gt nf ng nh ni aw nj bi"><span id="b61b" class="nk lp iq ng b gy nl nm l nn no">"marks": [<br/>    {<br/>      <strong class="ng ir">"type": "rect"</strong>,<br/>      "name": "rectangles",<br/>      "from": {<br/>        "data": "libraries"<br/>      },<br/>      "encode": {<br/>        "enter": {<br/>          "width": {<br/>            <strong class="ng ir">"signal": "rectWidth"</strong><br/>          },<br/>          "height": {<br/>            <strong class="ng ir">"signal": "rectHeight"</strong><br/>          },<br/>          "x": {<br/>            <strong class="ng ir">"signal": "scale('xScale',datum.release)-rectWidth/2"</strong><br/>          },<br/>          "y": {<br/>            <strong class="ng ir">"signal": "rectY"</strong><br/>          },<br/>          "fill": {<br/>            <strong class="ng ir">"signal": "scale('colorScale', datum.license)"</strong><br/>          },<br/>          "tooltip": {<br/>            <strong class="ng ir">"signal": "{'Description': datum.description}"</strong><br/>          }<br/>        },<br/>        "update": {<br/>          "fillOpacity": {<br/>            "value": 1<br/>          }<br/>        },<br/>        "hover": {<br/>          "fillOpacity": {<br/>            "value": 0.5<br/>          }<br/>        }<br/>      }<br/>    },<br/>    {<br/>      "type": "text",<br/>      "name": "labels",<br/>      <strong class="ng ir">"from": {<br/>        "data": "rectangles" // ⬅️cool<br/>      }</strong>,<br/>      "encode": {<br/>        "enter": {<br/>          "text": {<br/>            <strong class="ng ir">"signal": "datum.datum.name"</strong><br/>          },<br/>          "x": {<br/>            <strong class="ng ir">"signal": "datum.x+rectCenter[0]" </strong>//datum.x is from rect<br/>          },<br/>          "y": {<br/>            <strong class="ng ir">"signal": "rectCenter[1]"</strong><br/>          },<br/>          "align": {<br/>            "value": "center"<br/>          },<br/>          "baseline": {<br/>            "value": "middle"<br/>          },<br/>          "fontWeight": {<br/>            "value": "bold"<br/>          },<br/>          "fill": {<br/>            "value": "black"<br/>          }<br/>        }<br/>      },<br/>      "interactive": false<br/>    },<br/>    {<br/>      "type": "rule",<br/>      <strong class="ng ir">"from": {<br/>        "data": "labels" // ⬅️cool<br/>      }</strong>,<br/>      "encode": {<br/>        "enter": {<br/>          "x": {<br/>            <strong class="ng ir">"signal": "datum.x"</strong><br/>          },<br/>          "x2": {<br/>            <strong class="ng ir">"signal": "datum.x"</strong><br/>          },<br/>          "y": {<br/>            <strong class="ng ir">"signal": "datum.y+rectCenter[0]-5"</strong><br/>          },<br/>          "y2": {<br/>            <strong class="ng ir">"signal": "height"</strong><br/>          },<br/>          "strokeWidth": {<br/>            "value": 2<br/>          }<br/>        }<br/>      }<br/>    }<br/>  ]</span></pre><h2 id="bc35" class="nk lp iq bd lq np nq dn lu nr ns dp ly la nt nu ma le nv nw mc li nx ny me nz bi translated">5 — 💬"传奇":[]</h2><p id="c53c" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">图例定义类似于标记定义。要自定义的可寻址元素有:</p><ul class=""><li id="759f" class="mq mr iq kt b ku kv kx ky la ms le mt li mu lm mv mw mx my bi translated"><code class="fe oa ob oc ng b">legend</code>为图例<a class="ae ln" href="https://vega.github.io/vega/docs/marks/group" rel="noopener ugc nofollow" target="_blank">组</a>标记，</li><li id="4cb3" class="mq mr iq kt b ku mz kx na la nb le nc li nd lm mv mw mx my bi translated"><code class="fe oa ob oc ng b">title</code>为标题<a class="ae ln" href="https://vega.github.io/vega/docs/marks/text" rel="noopener ugc nofollow" target="_blank">正文</a>标注，</li><li id="326a" class="mq mr iq kt b ku mz kx na la nb le nc li nd lm mv mw mx my bi translated"><code class="fe oa ob oc ng b">labels</code>为标签<a class="ae ln" href="https://vega.github.io/vega/docs/marks/text" rel="noopener ugc nofollow" target="_blank">文字</a>标记，</li><li id="06a6" class="mq mr iq kt b ku mz kx na la nb le nc li nd lm mv mw mx my bi translated"><code class="fe oa ob oc ng b">symbols</code>为图例<a class="ae ln" href="https://vega.github.io/vega/docs/marks/symbol" rel="noopener ugc nofollow" target="_blank">符号</a>标志，</li><li id="10bf" class="mq mr iq kt b ku mz kx na la nb le nc li nd lm mv mw mx my bi translated"><code class="fe oa ob oc ng b">entries</code>用于符号图例<a class="ae ln" href="https://vega.github.io/vega/docs/marks/group" rel="noopener ugc nofollow" target="_blank">组</a>包含符号/标签对的标记，以及</li><li id="1692" class="mq mr iq kt b ku mz kx na la nb le nc li nd lm mv mw mx my bi translated"><code class="fe oa ob oc ng b">gradient</code>对于渐变<a class="ae ln" href="https://vega.github.io/vega/docs/marks/rect" rel="noopener ugc nofollow" target="_blank">矩形</a>标记:一个带有渐变填充的矩形用于连续渐变图例，多个带有实心填充的矩形标记用于离散渐变图例。</li></ul><p id="59f3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">这里我们将只为图例(整个组)设置<code class="fe oa ob oc ng b">"x"</code>位置，并为标题和标签设置字体大小。</p><pre class="kg kh ki kj gt nf ng nh ni aw nj bi"><span id="360f" class="nk lp iq ng b gy nl nm l nn no">"legends": [<br/>    {<br/>      "title": "License",<br/>      "fill": "colorScale",<br/>      "orient": "none",<br/>      "encode": {<br/>        <strong class="ng ir">"title"</strong>: {<br/>          "update": {<br/>            "fontSize": {<br/>              "value": 15<br/>            }<br/>          }<br/>        },<br/>        <strong class="ng ir">"labels"</strong>: {<br/>          "update": {<br/>            "fontSize": {<br/>              "value": 12<br/>            }<br/>          }<br/>        },<br/>        <strong class="ng ir">"legend"</strong>: {<br/>          "update": {<br/>            "x": {<br/>              "value": 500<br/>            }<br/>          }<br/>        }<br/>      }<br/>    }<br/>  ]</span></pre><h2 id="fe97" class="nk lp iq bd lq np nq dn lu nr ns dp ly la nt nu ma le nv nw mc li nx ny me nz bi translated">6 — ⚙️“配置”和“标题”:[]</h2><p id="0975" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated"><strong class="kt ir"> config </strong>对象定义默认的可视化值来设置可视化的主题。这里我们为图表的文本设置字体。<strong class="kt ir"> title </strong>指令向图表添加描述性标题。</p><pre class="kg kh ki kj gt nf ng nh ni aw nj bi"><span id="32ca" class="nk lp iq ng b gy nl nm l nn no"><strong class="ng ir">"config"</strong>: {<br/>    "text": {<br/>      "font": "Ideal Sans, Avenir Next, Helvetica"<br/>    },<br/>    "title": {<br/>      "font": "Ideal Sans, Avenir Next, Helvetica",<br/>      "fontWeight": 500,<br/>      "fontSize": 17,<br/>      "limit": -1<br/>    },<br/>    "axis": {<br/>      "labelFont": "Ideal Sans, Avenir Next, Helvetica",<br/>      "labelFontSize": 12<br/>    }<br/>  },<br/><strong class="ng ir">"title"</strong>: {<br/>    "text": "Data visualization tools release dates",<br/>    "orient": "top",<br/>    "anchor": "start",<br/>    "frame": "group",<br/>    "encode": {<br/>      "update": {<br/>        "dx": {<br/>          "value": -1<br/>        }<br/>      }<br/>    }<br/>  }</span></pre><p id="fd04" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">我们完了。你可以在这里看到代码<a class="ae ln" href="https://github.com/dmesquita/vega-timeline-tutorial" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="1a4c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">还有一些我们在本教程中没有看到的其他很酷的 Vega 特性:</p><ul class=""><li id="5125" class="mq mr iq kt b ku kv kx ky la ms le mt li mu lm mv mw mx my bi translated"><a class="ae ln" href="https://vega.github.io/vega/docs/triggers" rel="noopener ugc nofollow" target="_blank">触发</a>:根据信号值修改数据集或标记属性</li><li id="b698" class="mq mr iq kt b ku mz kx na la nb le nc li nd lm mv mw mx my bi translated"><a class="ae ln" href="https://vega.github.io/vega/docs/projections" rel="noopener ugc nofollow" target="_blank">投影</a>:地图(经度、纬度)数据的制图投影</li><li id="c4af" class="mq mr iq kt b ku mz kx na la nb le nc li nd lm mv mw mx my bi translated"><a class="ae ln" href="https://vega.github.io/vega/docs/event-streams" rel="noopener ugc nofollow" target="_blank">事件流</a>:定义输入事件流来指定交互</li><li id="3796" class="mq mr iq kt b ku mz kx na la nb le nc li nd lm mv mw mx my bi translated"><a class="ae ln" href="https://vega.github.io/vega/docs/layout" rel="noopener ugc nofollow" target="_blank">布局</a>:对一组标记进行网格布局</li></ul><h1 id="583c" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">结束语</h1><p id="b998" class="pw-post-body-paragraph kr ks iq kt b ku mg jr kw kx mh ju kz la mi lc ld le mj lg lh li mk lk ll lm ij bi translated">今天，我在工作流程中使用 Vega 来构建原型，并测试关于数据可视化选择的假设。如果在那之后，我发现我需要一些更加定制的东西，那么我会改变方式，使用 d3。</p><p id="2e21" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">你可以在这里查看更多织女星的例子:<a class="ae ln" href="https://vega.github.io/vega/examples/" rel="noopener ugc nofollow" target="_blank">https://vega.github.io/vega/examples/</a>。我们可以在在线 Vega 编辑器中查看所有示例，这太棒了。</p><p id="2bd4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">就是这样！感谢阅读！😄</p></div></div>    
</body>
</html>