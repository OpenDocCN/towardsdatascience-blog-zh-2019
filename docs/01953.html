<html>
<head>
<title>Graphing Brexit: Clustering Edition</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">绘制英国退出欧盟:聚类版</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/graphing-brexit-clustering-edition-3b966694e723?source=collection_archive---------18-----------------------#2019-03-31">https://towardsdatascience.com/graphing-brexit-clustering-edition-3b966694e723?source=collection_archive---------18-----------------------#2019-03-31</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="fc26" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这是展示如何用图表分析英国退出欧盟系列文章的第二篇。在本帖中，我们根据投票记录对议员进行分类。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/d84bf0ee6f4490fd9ae9f56ec32bd794.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l70Uez32Rmy1rFfgF14qNw.jpeg"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk">Brexit — EU (<a class="ae lb" href="https://unsplash.com/photos/yxDhneWz3vk" rel="noopener ugc nofollow" target="_blank">https://unsplash.com/photos/yxDhneWz3vk</a>)</figcaption></figure><p id="9fd2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">上周五，我写了一篇博文，展示了如何使用 Neo4j 对英国退出欧盟的数据进行<a class="ae lb" rel="noopener" target="_blank" href="/graphing-brexit-bbe4314cf70">图形分析，在第一篇博文的末尾，我展示了如何根据议员们对不同动议的立场，计算他们与 Boris Johnson 的相似度。</a></p><p id="e637" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在做这个分析的时候，我注意到<strong class="jp ir">有很多人对每个动议都以同样的方式</strong>投票，所以我想进一步探究这个问题。</p><p id="965b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">罗宾·布拉姆雷还指引我去了<a class="ae lb" href="https://commonsvotes.digiminster.com/?page=1" rel="noopener ugc nofollow" target="_blank"> CommonsVotes 网站</a>，那里有 CSV 格式的投票记录。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="lc ld l"/></div></figure><p id="b2fb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这将有助于未来的英国退出欧盟分析，所以让我们快速了解如何从那里导入数据到 Neo4j。</p><h1 id="70c8" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">导入常用选项数据</h1><p id="97d5" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">我已经下载了所有指示性投票的数据，并把文件放到了<a class="ae lb" href="https://github.com/mneedham/graphing-brexit" rel="noopener ugc nofollow" target="_blank">图形-英国退出欧盟</a> GitHub 库的<a class="ae lb" href="https://github.com/mneedham/graphing-brexit/tree/master/data/commonsvotes" rel="noopener ugc nofollow" target="_blank"><em class="mh">data/commons votes</em></a>目录下。</p><p id="e722" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以使用下面的 Cypher 查询导入所有指示性动作的数据:</p><pre class="km kn ko kp gt mi mj mk ml aw mm bi"><span id="8ff8" class="mn lf iq mj b gy mo mp l mq mr">UNWIND [655,656,657,658,659,660,661,662] AS division<br/>LOAD CSV FROM "<a class="ae lb" href="https://github.com/mneedham/graphing-brexit/raw/master/data/commonsvotes/Division" rel="noopener ugc nofollow" target="_blank">https://github.com/mneedham/graphing-brexit/raw/master/data/commonsvotes/Division</a>" + division + ".csv" AS row</span><span id="1a42" class="mn lf iq mj b gy ms mp l mq mr">// Create motion nodes<br/>WITH division, collect(row) AS rows<br/>MERGE (motion:Motion {division: trim(split(rows[0][0], ":")[1]) })<br/>SET motion.name = rows[2][0]</span><span id="d68f" class="mn lf iq mj b gy ms mp l mq mr">// Skip the first 6 rows as they have metadata we don't need<br/>WITH motion, rows<br/>UNWIND rows[7..] AS row</span><span id="7002" class="mn lf iq mj b gy ms mp l mq mr">// Create person, party, constituency, and corresponding rels<br/>MERGE (person:Person {name: row[0]})<br/>MERGE (party:Party {name: row[1]})<br/>MERGE (constituency:Constituency {name: row[2]})<br/>MERGE (person)-[:MEMBER_OF]-&gt;(party)<br/>MERGE (person)-[:REPRESENTS]-&gt;(constituency)<br/>WITH person, motion,  <br/>     CASE WHEN row[3] = "Aye" THEN "FOR" <br/>          WHEN row[3] = "No" THEN "AGAINST" <br/>          ELSE "DID_NOT_VOTE" END AS vote<br/>CALL apoc.merge.relationship(person, vote, {}, {}, motion)<br/>YIELD rel<br/>RETURN count(*)</span></pre><h1 id="77c3" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">相同的选民</h1><p id="e146" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">现在我们已经加载了数据，我们将探究那些相同的投票者。我尝试了几种不同的方法，最终决定采用以下方法:</p><ol class=""><li id="6838" class="mt mu iq jp b jq jr ju jv jy mv kc mw kg mx kk my mz na nb bi translated">基于以<strong class="jp ir">相同方式</strong>投票的人，创建<strong class="jp ir">相似度图</strong></li><li id="8004" class="mt mu iq jp b jq nc ju nd jy ne kc nf kg ng kk my mz na nb bi translated">在相似性图上运行<strong class="jp ir">连通分量算法</strong>来找到人群的聚类</li></ol><p id="cd9f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我们完成这两个步骤之后，我们希望有一个<strong class="jp ir">节点来代表我们找到的每个社区或集群</strong>，以及从每个人到他们的社区的关系。</p><p id="a550" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们开始吧！</p><h1 id="002f" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">相似图</h1><p id="3002" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">我们将创建一个议员相似度图，这是一种奇特的说法，即我们将<strong class="jp ir">在以相同方式</strong>投票的成对议员之间创建关系。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nh"><img src="../Images/aa47e1ecbaa27b2f79918b4171b330bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YUDIRmkbkugQAJvQYPe_pw.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk">Cosine Similarity</figcaption></figure><p id="a759" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">正如在第一篇文章中，我们将使用来自<a class="ae lb" href="https://neo4j.com/docs/graph-algorithms/current/" rel="noopener ugc nofollow" target="_blank"> Neo4j 图形算法库</a>的<a class="ae lb" href="https://neo4j.com/docs/graph-algorithms/current/algorithms/similarity-cosine/" rel="noopener ugc nofollow" target="_blank">余弦相似度</a>算法来做这件事。在我们的数据库中创建任何关系之前，我们将使用<code class="fe ni nj nk mj b">write: false</code>和<code class="fe ni nj nk mj b">similarityCutoff: 1.0</code>运行该过程的非流版本(即它们的行为相同)，以查看在不写入数据库的情况下我们有多少对相同的投票者。</p><p id="976f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面的 Cypher 查询可以做到这一点:</p><pre class="km kn ko kp gt mi mj mk ml aw mm bi"><span id="1dad" class="mn lf iq mj b gy mo mp l mq mr">MATCH (p:Person), (c:Motion)<br/>OPTIONAL MATCH (p)-[vote]-&gt;(c)<br/>WITH p, c,<br/>     CASE WHEN type(vote) = "FOR" THEN 1<br/>          WHEN type(vote) = "DID_NOT_VOTE" THEN 0.5<br/>          ELSE 0 END AS score<br/>WITH {item:id(p), weights: collect(score)} as userData<br/>WITH collect(userData) as data<br/>CALL algo.similarity.cosine(data, {<br/>  similarityCutoff: 1.0, write: false<br/>})<br/>YIELD nodes, similarityPairs, writeRelationshipType, writeProperty<br/>RETURN nodes, similarityPairs, writeRelationshipType, writeProperty</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nl"><img src="../Images/29b004db0217063ea5bfd441e9ee1443.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q33rS2raBOsaD1iuQahfhA.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk">How many identical votes do we have?</figcaption></figure><p id="9594" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们的 649 个议员有超过 10，000 个相似性对！这应该是一个有趣的图表。</p><p id="1a6c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们现在将使用<code class="fe ni nj nk mj b">write:true</code>运行这个过程，以便在相似度为 1.0 的节点之间创建<code class="fe ni nj nk mj b">SIMILAR</code>关系。下面是创建的图表示例:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nm"><img src="../Images/1a615403ae542bb9dd53409cbcfdfdfb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RDvo4wXJWfdE_IHNU7DLzA.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk">Similarity Graph</figcaption></figure><h1 id="78f6" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">查找具有连通分量的聚类</h1><p id="8fdd" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">现在我们将在这个相似度图上运行<a class="ae lb" href="https://neo4j.com/docs/graph-algorithms/current/algorithms/connected-components/" rel="noopener ugc nofollow" target="_blank">连通分量算法</a>。但是这个算法是做什么的呢？</p><p id="aa0b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在文档页面中:</p><blockquote class="nn no np"><p id="0ff1" class="jn jo mh jp b jq jr js jt ju jv jw jx nq jz ka kb nr kd ke kf ns kh ki kj kk ij bi translated">连通分量或<code class="fe ni nj nk mj b">Union Find</code>算法在无向图中寻找连通节点集，其中<strong class="jp ir">每个节点都可以从同一集合中的任何其他节点到达</strong>。</p></blockquote><p id="ed86" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">通过执行以下查询，我们可以在相似度图上运行该算法的流版本:</p><pre class="km kn ko kp gt mi mj mk ml aw mm bi"><span id="db27" class="mn lf iq mj b gy mo mp l mq mr">// Run the algorithm for:<br/>// nodes with 'Person' label, based on the 'SIMILAR' rel type<br/>CALL algo.unionFind.stream('Person', 'SIMILAR', {direction: "BOTH"})<br/>YIELD nodeId,setId</span><span id="f0c6" class="mn lf iq mj b gy ms mp l mq mr">// Grouping by setId, create a 'Community' node for each community<br/>WITH setId, collect(algo.getNodeById(nodeId)) AS nodes<br/>MERGE (community:Community {<br/>  id: setId, type: "Connected Components"<br/>})</span><span id="bc92" class="mn lf iq mj b gy ms mp l mq mr">// Create 'IN_COMMUNITY' rel from each node to its community<br/>WITH community, nodes<br/>UNWIND nodes AS node<br/>MERGE (node)-[:IN_COMMUNITY]-&gt;(community);</span></pre><p id="20cf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这个查询返回一串<code class="fe ni nj nk mj b">setId, nodeId</code>对。然后，我们为每个<code class="fe ni nj nk mj b">setId</code>创建一个标签为<code class="fe ni nj nk mj b">Community</code>的节点，并创建一个从每个节点到其对应社区的关系。我们可以运行以下查询来可视化这些社区:</p><pre class="km kn ko kp gt mi mj mk ml aw mm bi"><span id="9bb0" class="mn lf iq mj b gy mo mp l mq mr">MATCH (c:Community)<br/>WHERE size((c)&lt;-[:IN_COMMUNITY]-()) &gt; 10<br/>MATCH path = (c)&lt;-[comm:IN_COMMUNITY]-(person)<br/>RETURN path<br/>LIMIT 200</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nt"><img src="../Images/14004e30808a8292b4fcdc47845f388b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vRuBCkp3qN19NyKBe5dpHQ.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk">Communities of MPs based on how they voted</figcaption></figure><p id="c371" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">那么…这些社区的人们是如何投票的呢？通过运行以下 Cypher 查询，我们可以创建一个可视化的社区投票方式:</p><pre class="km kn ko kp gt mi mj mk ml aw mm bi"><span id="6afa" class="mn lf iq mj b gy mo mp l mq mr">// Find communities with more than 10 people<br/>MATCH (c:Community)<br/>WITH c, size((c)&lt;-[:IN_COMMUNITY]-()) AS size<br/>WHERE size &gt; 10</span><span id="29d2" class="mn lf iq mj b gy ms mp l mq mr">// Take one person to act as a representative of each community<br/>MATCH (c)&lt;-[rel:IN_COMMUNITY]-(person)<br/>WITH c, collect(person)[0] AS person</span><span id="bf05" class="mn lf iq mj b gy ms mp l mq mr">// Check which motions that person voted for<br/>WITH c, [(person)-[:FOR]-&gt;(motion:Motion) | motion] AS votes</span><span id="cea2" class="mn lf iq mj b gy ms mp l mq mr">// Create a virtual relationship from each community to the motion<br/>UNWIND votes AS vote       <br/>CALL apoc.create.vRelationship(c,"FOR",{},vote) yield rel<br/>RETURN *</span></pre><p id="f4fd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这个查询中，我们选择一个人作为他们社区的代表。然后我们检查他们是如何投票的，最后从每个社区创建一个虚拟关系(使用<a class="ae lb" href="https://neo4j.com/developer/neo4j-apoc/" rel="noopener ugc nofollow" target="_blank"> APOC </a>库)到投票赞成的动议。这导致以下可视化:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nu"><img src="../Images/66a141cafa229457e08264d20ef8b5eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7PBATXK0kgAu9rRPRa-QCw.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk">How did each community vote?</figcaption></figure><p id="cd19" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">黄色节点代表社区，数字表示该社区的议员人数。我们可以看到右边有一个很大的社区，里面有 106 个人，他们投票反对任何交易，并希望获得可能的优先安排。我们会假设这些集群中的人大多属于保守党。</p><p id="86ee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">另一方面，我们有较小的集团投票赞成其他动议，包括杰里米·科尔宾的替代计划、撤销第 50 条和确认性公众投票。</p><h1 id="b79f" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">在每个集群中寻找有影响力的成员</h1><p id="669e" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">当我向迈克尔展示这一可视化效果时，他建议我们应该找出每个集群中最有影响力的人，我认为一个简单的方法就是统计他们在维基百科页面上的浏览量。</p><p id="6f13" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我编写了一个脚本，将这些计数提取到一个 CSV 文件中，然后将它们导入 Neo4j:</p><pre class="km kn ko kp gt mi mj mk ml aw mm bi"><span id="4398" class="mn lf iq mj b gy mo mp l mq mr">load csv with headers from "https://github.com/mneedham/graphing-brexit/raw/master/data/pageviews.csv" AS row<br/>MATCH (p:Person {name: row.person})<br/>SET p.pageviews = toInteger(row.pageviews);</span></pre><p id="b01d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">迈克尔还建议给每个议员添加<strong class="jp ir">党派标签，这样我们就可以在可视化上用他们的党派颜色给他们</strong>上色。以下查询可以做到这一点:</p><pre class="km kn ko kp gt mi mj mk ml aw mm bi"><span id="554e" class="mn lf iq mj b gy mo mp l mq mr">match (p:Person)-[:MEMBER_OF]-&gt;(pa:Party)<br/>CALL apoc.create.addLabels(p, [apoc.text.replace(pa.name, " ", "")]) YIELD node<br/>RETURN count(*)</span></pre><p id="0dcf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们已经完成了，我们可以将我们的查询更新为<strong class="jp ir">将每个聚类中最有影响力的前 3 个人</strong>添加到我们的可视化中:</p><pre class="km kn ko kp gt mi mj mk ml aw mm bi"><span id="14ec" class="mn lf iq mj b gy mo mp l mq mr">// Find communities with more than 10 people<br/>MATCH (c:Community)<br/>WHERE size((c)&lt;-[:IN_COMMUNITY]-()) &gt; 10</span><span id="54d1" class="mn lf iq mj b gy ms mp l mq mr">// Find the top 3 most influential people per community<br/>MATCH (c)&lt;-[rel:IN_COMMUNITY]-(person)<br/>WITH c, rel, size, person<br/>ORDER BY person.pageviews DESC<br/>WITH c, collect({person: person, rel:rel })[..3] AS topPeople</span><span id="e80b" class="mn lf iq mj b gy ms mp l mq mr">// Select the first of those people to represent the cluster<br/>WITH c, topPeople, topPeople[0].person AS person</span><span id="0d90" class="mn lf iq mj b gy ms mp l mq mr">// Check how that person voted<br/>WITH c, topPeople, <br/>     [(person)-[:FOR]-&gt;(motion:Motion) | motion] AS votes</span><span id="d8b1" class="mn lf iq mj b gy ms mp l mq mr">// Create a virtual relationship from each community to the motion     <br/>UNWIND votes AS vote       <br/>CALL apoc.create.vRelationship(c,"FOR",{},vote) <br/>yield rel<br/>RETURN *</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nv"><img src="../Images/dfd4fa54ecaab7a745596b28b8c333d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*54UegXt_Kxw8oXpqUIvhnQ.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk">Communities, their most famous MPs, and how they voted</figcaption></figure><p id="4543" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在我们可以清楚地看到右手边的保守星团。最大的一个包含鲍里斯·约翰逊，雅各布·里斯-莫格和普里蒂·帕特尔，而另一个包含一些不太知名的党员。</p><p id="4ddd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">左边的苏格兰民族党是黄色的，他们赞成进行公众投票，废除第 50 条。独立党派也投票赞成这两项动议。这两个社区分开的原因是因为我们在构建我们的相似度图时考虑到了<em class="mh">反对</em>和<em class="mh">没有投票</em>的关系，他们在那里的投票肯定是不同的</p><p id="7eab" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">最后工党成员分裂成几个群体，尽管他们都投票支持杰里米·科尔宾的动议。与 SNP 和独立聚类一样，如果我们只基于关系的<em class="mh">构建相似性图，我们最终会得到数量更少的聚类。</em></p><p id="f03c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们已经做了大部分的基础工作，所以让我们看看如果我们只考虑人们投票赞成的动议会发生什么。</p><h1 id="7bd4" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">基于投票赞成的动议的分组</h1><p id="1033" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">我们将使用类似的方法来构建我们的相似性图，但是这一次因为我们只关心一种关系类型，所以我们可以使用 Jaccard 相似性算法来计算节点之间的相似性。</p><p id="c1b8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们希望在以相同方式投票支持动议的人们之间建立一种<code class="fe ni nj nk mj b">SIMILAR_FOR</code>关系。下面的 Cypher 查询将完成这项工作:</p><pre class="km kn ko kp gt mi mj mk ml aw mm bi"><span id="0628" class="mn lf iq mj b gy mo mp l mq mr">MATCH (p:Person)-[:FOR]-&gt;(motion:Motion)<br/>WITH {item:id(p), categories: collect(id(motion))} as userData<br/>WITH collect(userData) as data<br/>CALL algo.similarity.jaccard(data, {<br/>  similarityCutoff: 1.0,<br/>  write:true,<br/>  writeRelationshipType: "SIMILAR_FOR"<br/>})<br/>YIELD nodes, similarityPairs, writeRelationshipType, writeProperty<br/>RETURN nodes, similarityPairs, writeRelationshipType, writeProperty;</span></pre><p id="9c7c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在，我们将在此图表上运行连接组件算法，与之前一样，我们将把人们与社区节点联系起来:</p><pre class="km kn ko kp gt mi mj mk ml aw mm bi"><span id="2872" class="mn lf iq mj b gy mo mp l mq mr">// Run the algorithm for:<br/>// nodes with 'Person' label, based on the 'SIMILAR_FOR' rel type<br/>CALL algo.unionFind.stream('Person', 'SIMILAR_FOR', {<br/>  direction: "BOTH"<br/>})<br/>YIELD nodeId,setId</span><span id="7e59" class="mn lf iq mj b gy ms mp l mq mr">// Grouping by setId, create a 'Community' node for each community<br/>WITH setId, collect(algo.getNodeById(nodeId)) AS nodes<br/>MERGE (community:Community {<br/>  id: setId, type: "Connected Components FOR"<br/>})<br/>WITH community, nodes</span><span id="a241" class="mn lf iq mj b gy ms mp l mq mr">// Create 'IN_COMMUNITY' rel from each node to its community<br/>UNWIND nodes AS node<br/>MERGE (node)-[:IN_COMMUNITY]-&gt;(community);</span></pre><p id="770c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一旦我们做到了这一点，我们可以重新运行查询，找到集群，运动，每个集群最有名的人。我们根据维基百科页面的浏览量来确定最著名的人。</p><pre class="km kn ko kp gt mi mj mk ml aw mm bi"><span id="b3bc" class="mn lf iq mj b gy mo mp l mq mr">MATCH (c:Community {type: "Connected Components FOR"})<br/>WITH c, size((c)&lt;-[:IN_COMMUNITY]-()) AS size<br/>WHERE size &gt; 10</span><span id="6b19" class="mn lf iq mj b gy ms mp l mq mr">MATCH (c)&lt;-[rel:IN_COMMUNITY]-(person)<br/>WITH c, rel, size, person<br/>ORDER BY person.pageviews DESC</span><span id="fc68" class="mn lf iq mj b gy ms mp l mq mr">WITH c, collect({person: person, rel:rel })[..3] AS topPeople, size<br/>WITH c, topPeople, topPeople[0].person AS person, size<br/>WITH c, topPeople, size, [(person)-[:FOR]-&gt;(motion:Motion) | motion] AS votes<br/>       <br/>UNWIND votes AS vote       <br/>CALL apoc.create.vRelationship(c,"FOR",{},vote) yield rel<br/>RETURN *;</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nw"><img src="../Images/b9f1156e0d0aced1b341fbe560f4e551.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U963xyoMx2HbkcA8mQ-N7g.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk">Communities, their most famous MPs, and how they voted</figcaption></figure><p id="92ee" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们现在在右边有三个集群。保守派集群仍然存在，但我们现在也有一个集群包含民主统一党成员，他们只投票赞成或有优惠安排。</p><p id="fe08" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在左边，我们现在有一个包含保守党、独立党和自由民主党成员的集群。该集群投票赞成撤销，以避免无交易和确认性公众投票。</p><p id="c338" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然后有一堆不同的劳工团体投票支持其他 6 项动议的某个子集。</p><p id="35bf" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在第一篇文章之后，克里斯·艾尔问了以下问题:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="lc ld l"/></div></figure><p id="b10d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">看起来确实有一些基于这些集群的政治团体:</p><ul class=""><li id="73ba" class="mt mu iq jp b jq jr ju jv jy mv kc mw kg mx kk nx mz na nb bi translated">保守党有强硬的英国退出欧盟一面，比我想象的要大得多。</li><li id="6064" class="mt mu iq jp b jq nc ju nd jy ne kc nf kg ng kk nx mz na nb bi translated">独立党的一些成员似乎与一些保守派和自由民主党人有相似的观点</li></ul><h1 id="b8bc" class="le lf iq bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">接下来呢？</h1><p id="48c8" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">在我写完第一篇文章后，我在 twitter 上列出了人们建议的其他类型的分析。</p><p id="4e00" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Jo Stichbury 建议我研究一下议员们的投票是否符合他们选区的要求:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="lc ld l"/></div></figure><p id="ce93" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">作为这篇文章的一部分，我已经加载了选区和投票离开的人的百分比，现在我可以尝试回答这个问题了。</p><p id="5712" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">如果你对数据的图形分析感兴趣，你可能会喜欢我和艾米·霍德勒在过去 9 个月里一直在研究的《奥莱利图形算法》一书。我们正处于最后的审查阶段，它应该在未来几周内可用。</p><p id="2ca7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">你可以从 Neo4j 网站注册获得免费的电子版，网址:【neo4j.com/graph-algorithms-book】T2。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/be89f2dbd51a46d7b3d24829b894d859.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*eDvf9cjqXYTjhRbDnIxjWQ.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk">O’Reilly Graph Algorithms Book</figcaption></figure></div></div>    
</body>
</html>