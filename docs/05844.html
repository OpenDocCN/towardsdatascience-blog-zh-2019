<html>
<head>
<title>Real-time Twitter Sentiment Analysis for Brand Improvement and Topic Tracking (Chapter 1/3)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用于品牌提升和话题跟踪的实时 Twitter 情感分析(第 1/3 章)</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/real-time-twitter-sentiment-analysis-for-brand-improvement-and-topic-tracking-chapter-1-3-e02f7652d8ff?source=collection_archive---------5-----------------------#2019-08-26">https://towardsdatascience.com/real-time-twitter-sentiment-analysis-for-brand-improvement-and-topic-tracking-chapter-1-3-e02f7652d8ff?source=collection_archive---------5-----------------------#2019-08-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="dad4" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">行业中的数据科学</h2><div class=""/><div class=""><h2 id="545c" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">通过 Tweepy、MySQL 和 Python 使用流 Twitter API 收集 Twitter 数据</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/345a2abd9bc803aca2d354e01a7fdfad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Sy7368dP6wHP0rmw"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk">Photo by <a class="ae lh" href="https://unsplash.com/@riccardoch?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Riccardo Chiarini</a> on <a class="ae lh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="f337" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这是一个全面的分步教程，教你如何建立一个端到端的实时 Twitter 监控系统，通过识别情绪波动，分析趋势话题和地理细分，检测丑闻的异常，跟踪客户对品牌的行为，并考虑提高品牌的客户参与度和保留率。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi me"><img src="../Images/31b488cada146cc088031ad457da5918.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*mPZ0eqG1LYCRl5m0sm75tQ.gif"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk"><a class="ae lh" href="https://twitter-analysis-web-app.herokuapp.com" rel="noopener ugc nofollow" target="_blank">https://twitter-analysis-web-app.herokuapp.com</a></figcaption></figure><p id="2763" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">你可以试试这个很棒的<a class="ae lh" href="https://twitter-analysis-web-app.herokuapp.com" rel="noopener ugc nofollow" target="_blank">网络应用</a>并找到<a class="ae lh" href="https://github.com/Chulong-Li/Real-time-Sentiment-Tracking-on-Twitter-for-Brand-Improvement-and-Trend-Recognition" rel="noopener ugc nofollow" target="_blank">的完整代码</a>！</p><p id="5497" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">技术栈:</strong> Python，Tweepy，Numpy，Pandas，Seaborn，Plotly，Dash，Scala Kafka，Spark，MySQL，RE，TextBlob，NLTK，HTML，CSS，Flask，JavaScript，React.js 和 Git</p><p id="9f50" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">由于这是一个全面的端到端 Twitter 监控系统，我将把它分成 3 章来解释引擎盖下的细节和行动背后的直觉。</p><ul class=""><li id="c78d" class="mf mg it lk b ll lm lo lp lr mh lv mi lz mj md mk ml mm mn bi translated"><strong class="lk jd">第 1 章(你来了！):</strong>通过 Tweepy、MySQL、&amp; Python 使用流 Twitter API 收集 Twitter 数据</li><li id="3f05" class="mf mg it lk b ll mo lo mp lr mq lv mr lz ms md mk ml mm mn bi translated"><a class="ae lh" href="http://bit.ly/2PzXG5M" rel="noopener ugc nofollow" target="_blank"> <strong class="lk jd">第二章</strong> </a> <strong class="lk jd"> : </strong>使用 RE、TextBlob、NLTK 和 Plotly 的 Twitter 情感分析和交互式数据可视化</li><li id="9cab" class="mf mg it lk b ll mo lo mp lr mq lv mr lz ms md mk ml mm mn bi translated"><a class="ae lh" href="http://bit.ly/2msOUbR" rel="noopener ugc nofollow" target="_blank"> <strong class="lk jd">第三章</strong> </a> <strong class="lk jd"> : </strong>使用 Python 中的 Dash &amp; Plotly 在 Heroku 上部署一个实时的 Twitter 分析 Web App</li><li id="fd23" class="mf mg it lk b ll mo lo mp lr mq lv mr lz ms md mk ml mm mn bi translated"><strong class="lk jd">第 4 章</strong>(可选)<strong class="lk jd"> : </strong>使用 Scala、Kafka 和 Spark 流媒体实现流媒体 Twitter 情感分析的并行化</li></ul></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><p id="d929" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi na translated">这个系统是什么？这个实时的端到端 Twitter 监控系统是为企业设计的，用于评估 Twitter 数据，为商业决策提供信息。正如我们所知，twitter 是一个实时高通量数据源的好地方，平均每秒 6000 条推文，我们可以用它来发现突发新闻故事，识别行业趋势，并及时采取行动。在实践中，实时跟踪关于某个品牌的所有相关 Twitter 内容，随着话题或问题的出现进行分析，并通过警报检测异常情况。通过监控 Twitter 上的品牌提及，品牌可以通知执行机构，并为全球客户提供更好的体验。</p></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><h2 id="3d75" class="nj nk it bd nl nm nn dn no np nq dp nr lr ns nt nu lv nv nw nx lz ny nz oa iz bi translated">访问 Twitter API——成为一名出色的 Twitter 开发者</h2><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ob"><img src="../Images/745bdaf5c3fd94b343dc9dbaa12263af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JBYRahStQIc5ZFUJdaM5fw.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk">Apply for a developer account</figcaption></figure><p id="3a32" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">为了开始使用 Twitter APIs，我们需要先<a class="ae lh" href="https://developer.twitter.com/en/apply-for-access" rel="noopener ugc nofollow" target="_blank">申请一个开发者账户</a>。它允许你访问 Twitter APIs 和其他工具。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oc"><img src="../Images/4c6ce240123bb2e32cf754e33937d3c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IJTXRKjDIySaImJRZkMtBw.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk">Create an app</figcaption></figure><p id="f4e8" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然后我们<a class="ae lh" href="https://developer.twitter.com/en/apps" rel="noopener ugc nofollow" target="_blank">创建一个应用</a>来生成两个 API 密匙和两个访问令牌。这是调用 Twitter APIs 最重要的部分。整个过程可能需要几分钟，但应该很容易完成。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi od"><img src="../Images/205679f437fe42b31775b0ee8c50894a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HeRv_pVw0TXg_AMfOyiAYQ.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk">Consumer API keys and Access token &amp; access token secret</figcaption></figure><p id="9487" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在，在右上角您的 Twitter 名称下的<strong class="lk jd">应用程序</strong>中，点击您的应用程序右侧的<strong class="lk jd">详细信息</strong>按钮(这不是仪表板按钮)。然后点击副标题中的<strong class="lk jd">键和令牌</strong>。创建一个名为<em class="oe"> credentials.py </em>的文件，并将&amp;粘贴到该文件中。</p><pre class="ks kt ku kv gt of og oh oi aw oj bi"><span id="80ae" class="nj nk it og b gy ok ol l om on">#credentials.py<br/>API_KEY = 'XXXXXXXXXX'<br/>API_SECRET_KEY = 'XXXXXXXXXXXXXXXXXXXX'</span><span id="6b5c" class="nj nk it og b gy oo ol l om on">ACCESS_TOKEN = 'XXXXXXXXXXXXXXXXXXXXXXX'<br/>ACCESS_TOKEN_SECRET = 'XXXXXXXXXXXXXXXXXXX'</span></pre></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi op"><img src="../Images/8548c21709c19a40166a4a279ee58ee3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Q4LIiJ6Fc9h-OSUN"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk">Photo by <a class="ae lh" href="https://unsplash.com/@sebastianb?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Sebastian B</a> on <a class="ae lh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h2 id="191d" class="nj nk it bd nl nm nn dn no np nq dp nr lr ns nt nu lv nv nw nx lz ny nz oa iz bi translated">使用 Tweepy、MySQL 和 Python 流式传输 Twitter 数据</h2><p id="60fd" class="pw-post-body-paragraph li lj it lk b ll oq kd ln lo or kg lq lr os lt lu lv ot lx ly lz ou mb mc md im bi translated">我们将使用一个名为<a class="ae lh" href="https://github.com/tweepy/tweepy" rel="noopener ugc nofollow" target="_blank"> <strong class="lk jd"> Tweepy </strong> </a>的 python 库来监听流 Twitter 数据。创建一个名为<em class="oe"> Main.ipynb </em>的新文件，让我们开始吧。注:我用 Jupyter 笔记本是为了更好的开发探索，你也可以用。改为 py。如果你感兴趣，你可以通过 Tweepy 的 Tweepy 在线文档来查看这个<a class="ae lh" href="http://docs.tweepy.org/en/latest/streaming_how_to.html" rel="noopener ugc nofollow" target="_blank">流。你可以在这里查看我的<strong class="lk jd">全代码版本</strong></a><a class="ae lh" href="https://github.com/Chulong-Li/Real-time-Sentiment-Tracking-on-Twitter-for-Brand-Improvement-and-Trend-Recognition/blob/master/Main.ipynb" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="5564" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">首先，我们需要创建一个 Tweepy 的<strong class="lk jd"> StreamListener </strong>，它具有用于接收 tweets 的<strong class="lk jd"> on_status </strong>方法和用于由于速率限制而停止抓取数据的<strong class="lk jd"> on_error </strong>方法。推文被称为“状态更新”。因此<br/> Tweepy 中的<strong class="lk jd">状态</strong>类具有描述 tweet 的属性。</p><pre class="ks kt ku kv gt of og oh oi aw oj bi"><span id="f2f4" class="nj nk it og b gy ok ol l om on"># Part of <strong class="og jd">MyStreamListener</strong> in <em class="oe">Main.ipynb</em><br/><em class="oe"># Streaming With Tweepy </em><br/><em class="oe"># Override tweepy.StreamListener to add logic to on_status</em><br/><strong class="og jd">class</strong> <strong class="og jd">MyStreamListener</strong>(tweepy.StreamListener):<br/><br/>    <strong class="og jd">def</strong> on_status(self, status):<br/><em class="oe">        # Extract info from tweets</em><br/>        id_str = status.id_str<br/>        created_at = status.created_at<br/>        user_created_at = status.user.created_at<br/>        # ...... and more! <br/>        # I'll talk about it below! (Or check full-code link above)</span><span id="0c86" class="nj nk it og b gy oo ol l om on">    <strong class="og jd">def</strong> on_error(self, status_code):<br/>        <em class="oe">'''</em><br/><em class="oe">        Since Twitter API has rate limits, <br/>        stop srcraping data as it exceed to the thresold.</em><br/><em class="oe">        '''</em><br/>        <strong class="og jd">if</strong> status_code == 420:<br/>            <em class="oe"># return False to disconnect the stream</em><br/>            <strong class="og jd">return</strong> <strong class="og jd">False</strong></span></pre><p id="a698" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然后，使用 Tweepy 中的<a class="ae lh" href="http://docs.tweepy.org/en/latest/auth_tutorial.html#auth-tutorial" rel="noopener ugc nofollow" target="_blank"> Oauth 进行认证，向 Twitter 注册我们的应用程序。</a></p><pre class="ks kt ku kv gt of og oh oi aw oj bi"><span id="e0e5" class="nj nk it og b gy ok ol l om on"># <strong class="og jd">Oauth</strong> part in <em class="oe">Main.ipynb<br/></em># <em class="oe">Import api/access_token keys from </em>credentials.py<em class="oe"><br/></em>import credentials.py<br/>auth  = tweepy.OAuthHandler(credentials.API_KEY, \<br/>                            credentials.API_SECRET_KEY)<br/>auth.set_access_token(credentials.ACCESS_TOEKN,  \<br/>                      credentials.ACCESS_TOKEN_SECRET)<br/>api = tweepy.API(auth)</span></pre><p id="fd82" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在，用 Oauth 启动<strong class="lk jd">流线型监听器</strong>。在<strong class="lk jd">过滤器</strong>方法中，设置推文语言偏好和<strong class="lk jd">跟踪单词</strong>，后者是一个单词列表(例如[‘脸书’])。目前，我们使用 Twitter 的免费标准流。查看<a class="ae lh" href="https://developer.twitter.com/en/docs/tweets/filter-realtime/overview" rel="noopener ugc nofollow" target="_blank"> Twitter 流 API 文档</a>以了解不同的流具有不同的功能和限制。</p><pre class="ks kt ku kv gt of og oh oi aw oj bi"><span id="b0b2" class="nj nk it og b gy ok ol l om on">myStreamListener = MyStreamListener()<br/>myStream = tweepy.Stream(auth = api.auth, listener = myStreamListener)<br/>myStream.filter(languages=["en"], track = settings.TRACK_WORDS)</span><span id="9359" class="nj nk it og b gy oo ol l om on"><em class="oe"># However, this part won't be reached as the stream listener won't stop automatically. Press STOP button to finish the process.</em></span></pre><p id="0f4b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然后，创建并连接<strong class="lk jd"> MySQL </strong>本地数据库，以便进一步分析和存储。你可以在这里下载最新版本的<a class="ae lh" href="https://dev.mysql.com/downloads/mysql/" rel="noopener ugc nofollow" target="_blank">。我们用的版本是 MySQL 社区版，非常流行的开源数据库。根据内置指南设置 MySQL 数据库，数据库信息如下。</a></p><pre class="ks kt ku kv gt of og oh oi aw oj bi"><span id="1202" class="nj nk it og b gy ok ol l om on">mydb = mysql.connector.connect(<br/>    host="localhost",<br/>    user="root",<br/>    passwd="password",<br/>    database="TwitterDB",<br/>    charset = 'utf8'<br/>)</span></pre><p id="f1f5" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果表不存在，我们需要创建一个新表。当然第一次的时候应该是不存在的。所以我们用下面的自动检查代码创建它。</p><pre class="ks kt ku kv gt of og oh oi aw oj bi"><span id="96a2" class="nj nk it og b gy ok ol l om on"><strong class="og jd">if</strong> mydb.is_connected():<br/>    mycursor = mydb.cursor()<br/>    mycursor.execute("""<br/>        SELECT COUNT(*)<br/>        FROM information_schema.tables<br/>        WHERE table_name = '<strong class="og jd">{0}</strong>'<br/>        """.format(TABLE_NAME))<br/>    <strong class="og jd">if</strong> mycursor.fetchone()[0] != 1:<br/>        mycursor.execute("CREATE TABLE <strong class="og jd">{}</strong> (<strong class="og jd">{}</strong>)" \<br/>            .format(TABLE_NAME, TABLE_ATTRIBUTES))<br/>        mydb.commit()<br/>    mycursor.close()</span></pre><p id="9f54" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在<strong class="lk jd"> on_status </strong>方法中指定接收和预处理 Twitter 数据的细节。<strong class="lk jd">状态</strong>中的属性与<a class="ae lh" href="https://developer.twitter.com/en/docs/tweets/data-dictionary/overview/tweet-object" rel="noopener ugc nofollow" target="_blank">推文对象</a>中的属性相同。</p><ul class=""><li id="d454" class="mf mg it lk b ll lm lo lp lr mh lv mi lz mj md mk ml mm mn bi translated"><em class="oe"> id_str </em>是 Tweets Id 的字符串格式</li><li id="4f37" class="mf mg it lk b ll mo lo mp lr mq lv mr lz ms md mk ml mm mn bi translated"><em class="oe"> created_at </em>是创建推文的时间</li><li id="493e" class="mf mg it lk b ll mo lo mp lr mq lv mr lz ms md mk ml mm mn bi translated"><em class="oe">文字</em>是推文的内容</li><li id="7488" class="mf mg it lk b ll mo lo mp lr mq lv mr lz ms md mk ml mm mn bi translated"><em class="oe">极性&amp;主观性</em>是使用<strong class="lk jd"> TextBlob </strong> NLP 库进行核心情感分析的情感值</li></ul><p id="c096" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">像<em class="oe"> user_created_at </em>、<em class="oe"> user_location </em>、<em class="oe"> user_description </em>和<em class="oe"> user_followers_count </em>这样的属性在<a class="ae lh" href="https://developer.twitter.com/en/docs/tweets/data-dictionary/overview/user-object" rel="noopener ugc nofollow" target="_blank">用户对象</a>中，它是 Tweet 对象的一部分。此外，c <em class="oe">坐标</em>包括<em class="oe">经度</em>和<em class="oe">纬度</em>是 JSON 格式的另一个对象<a class="ae lh" href="https://developer.twitter.com/en/docs/tweets/data-dictionary/overview/geo-objects" rel="noopener ugc nofollow" target="_blank"> Geo 对象</a>。</p><pre class="ks kt ku kv gt of og oh oi aw oj bi"><span id="04a4" class="nj nk it og b gy ok ol l om on"><em class="oe"># Extract info from tweets<br/></em><strong class="og jd">def</strong> on_status(self, status):<br/>    <strong class="og jd">if</strong> status.retweeted:<br/>        <em class="oe"># Avoid retweeted info, and only original tweets will <br/>        # be received</em><br/>        <strong class="og jd">return</strong> <strong class="og jd">True</strong><br/>    <em class="oe"># Extract attributes from each tweet</em><br/>    id_str = status.id_str<br/>    created_at = status.created_at<br/>    text = deEmojify(status.text)    <em class="oe"># Pre-processing the text  </em><br/>    sentiment = TextBlob(text).sentiment<br/>    polarity = sentiment.polarity<br/>    subjectivity = sentiment.subjectivity<br/>        <br/>    user_created_at = status.user.created_at<br/>    user_location = deEmojify(status.user.location)<br/>    user_description = deEmojify(status.user.description)<br/>    user_followers_count =status.user.followers_count<br/>    longitude = <strong class="og jd">None</strong><br/>    latitude = <strong class="og jd">None</strong><br/>    <strong class="og jd">if</strong> status.coordinates:<br/>        longitude = status.coordinates['coordinates'][0]<br/>        latitude = status.coordinates['coordinates'][1]<br/>            <br/>     retweet_count = status.retweet_count<br/>     favorite_count = status.favorite_count</span><span id="82b4" class="nj nk it og b gy oo ol l om on">     # Quick check contents in tweets<br/>     print(status.text)<br/>     print("Long: <strong class="og jd">{}</strong>, Lati: <strong class="og jd">{}</strong>".format(longitude, latitude))<br/>        <br/>     <em class="oe"># Store all data in MySQL</em><br/>     <strong class="og jd">if</strong> mydb.is_connected():<br/>         mycursor = mydb.cursor()<br/>         sql = "INSERT INTO <strong class="og jd">{}</strong> (id_str,created_at,text,polarity,\<br/>            subjectivity, user_created_at, user_location,\<br/>            user_description, user_followers_count, longitude,\<br/>            latitude, retweet_count, favorite_count) VALUES \<br/>            (<strong class="og jd">%s</strong>, <strong class="og jd">%s</strong>, <strong class="og jd">%s</strong>, <strong class="og jd">%s</strong>, <strong class="og jd">%s</strong>, <strong class="og jd">%s</strong>, <strong class="og jd">%s</strong>, <strong class="og jd">%s</strong>, <strong class="og jd">%s</strong>, <strong class="og jd">%s</strong>, <strong class="og jd">%s</strong>, <strong class="og jd">%s</strong>, <strong class="og jd">%s</strong>)" \ <br/>            .format(TABLE_NAME)<br/>          val = (id_str, created_at, text, polarity, subjectivity,\<br/>             user_created_at, user_location, user_description,\ <br/>             user_followers_count, longitude, latitude,\ <br/>             retweet_count, favorite_count)<br/>          mycursor.execute(sql, val)<br/>          mydb.commit()<br/>          mycursor.close()</span></pre><p id="3422" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">最后，为了允许 tweet 文本存储在 MySQL 中，我们需要做一点处理，通过剥离所有非 ASCII 字符来删除<strong class="lk jd">表情符号</strong>，即使数据库的字符集是 utf8。</p><pre class="ks kt ku kv gt of og oh oi aw oj bi"><span id="bf9c" class="nj nk it og b gy ok ol l om on"><strong class="og jd">def</strong> deEmojify(text):<br/>    <strong class="og jd">if</strong> text:<br/>        <strong class="og jd">return</strong> text.encode('ascii', 'ignore').decode('ascii')<br/>    <strong class="og jd">else</strong>:<br/>        <strong class="og jd">return</strong> <strong class="og jd">None</strong></span></pre></div><div class="ab cl mt mu hx mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="im in io ip iq"><p id="b27d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这是我的第一篇技术文章，我感谢任何反馈！</p></div></div>    
</body>
</html>