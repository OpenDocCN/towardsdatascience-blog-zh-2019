<html>
<head>
<title>Building a Custom Search Relevance Training Set</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建自定义搜索相关性训练集</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/building-a-custom-search-relevance-training-set-38a4fb90044f?source=collection_archive---------40-----------------------#2019-12-03">https://towardsdatascience.com/building-a-custom-search-relevance-training-set-38a4fb90044f?source=collection_archive---------40-----------------------#2019-12-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="c35b" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用 bing 数据和文本分类器生成搜索引擎训练/评估集</h2></div><p id="6980" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">由<a class="ae lb" href="https://medium.com/@colethienes" rel="noopener">科尔·塞恩斯</a>合著，看看我们的<a class="ae lb" href="https://github.com/koursaros-ai/nboost" rel="noopener ugc nofollow" target="_blank"> Github </a></p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi lc"><img src="../Images/a8771c16d4649ef32822f1f1057d6f1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3zmmVcj7dua0i1rR"/></div></div><figcaption class="lo lp gj gh gi lq lr bd b be z dk">Photo by <a class="ae lb" href="https://unsplash.com/@markuswinkler?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Markus Winkler</a> on <a class="ae lb" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="0cc4" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在构建可训练的语义搜索平台<a class="ae lb" href="https:/github.com/koursaros-ai/nboost" rel="noopener ugc nofollow" target="_blank"> NBoost </a>的过程中，我意识到缺乏大规模、易于使用、带标签的数据集来评估特定领域的搜索引擎，例如生物医学信息的定制搜索。</p><p id="9f09" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">本文包括生成搜索查询和段落的代码，这些查询和段落被标记为与特定领域或知识领域相关。</strong>我们通过选择微软流行的 MS Marco 数据集的子集来实现这一点。微软发布的完整标签集太大了，无法完整使用。</p><p id="f7b1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">为健康/生物学生成的子集中的查询和相关段落的示例:</p><blockquote class="ls lt lu"><p id="aff5" class="kf kg lv kh b ki kj jr kk kl km ju kn lw kp kq kr lx kt ku kv ly kx ky kz la ij bi translated"><strong class="kh ir"> <em class="iq">查询:</em> </strong>按年龄划分正常血压是多少？</p><p id="2d53" class="kf kg lv kh b ki kj jr kk kl km ju kn lw kp kq kr lx kt ku kv ly kx ky kz la ij bi translated"><strong class="kh ir"> <em class="iq">相关段落:</em></strong><em class="iq">……对于 25-29 岁的成年人来说，正常的血压读数是 120/80 毫米汞柱……</em></p></blockquote></div><div class="ab cl lz ma hu mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="ij ik il im in"><h1 id="f797" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated">用谷歌自然语言 API 标注 10k 段落</h1><p id="29cf" class="pw-post-body-paragraph kf kg iq kh b ki my jr kk kl mz ju kn ko na kq kr ks nb ku kv kw nc ky kz la ij bi translated">使用<a class="ae lb" href="https://cloud.google.com/natural-language/" rel="noopener ugc nofollow" target="_blank">谷歌的语言 API </a>，高达 30k/月的文档分类是<strong class="kh ir">免费的</strong>。它可以用来将段落分为 700+个类别，还可以报告置信度得分。</p><p id="2337" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir">您需要先</strong> <a class="ae lb" href="https://cloud.google.com/natural-language/docs/reference/libraries" rel="noopener ugc nofollow" target="_blank"> <strong class="kh ir">注册 Google Cloud 并认证您的客户端</strong> </a> <strong class="kh ir">，参见。</strong>然后运行:</p><figure class="ld le lf lg gt lh"><div class="bz fp l di"><div class="nd ne l"/></div></figure><h1 id="0797" class="mg mh iq bd mi mj nf ml mm mn ng mp mq jw nh jx ms jz ni ka mu kc nj kd mw mx bi translated">为集合的其余部分创建文本分类器</h1><p id="e072" class="pw-post-body-paragraph kf kg iq kh b ki my jr kk kl mz ju kn ko na kq kr ks nb ku kv kw nc ky kz la ij bi translated">我们使用<a class="ae lb" href="https://github.com/VowpalWabbit/vowpal_wabbit" rel="noopener ugc nofollow" target="_blank"> vowpal-wabbit </a> (VW)来构建一个二进制文本分类器，它可以非常快速且免费地对集合的其余部分进行分类。请确保它已安装。(在 bash 上键入<code class="fe nk nl nm nn b">vw --help</code>)。</p><p id="b2e6" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">定义一个从 Google NLP 类别中提取二进制标签的函数。在我们的案例中，我们使用健康/科学:</p><figure class="ld le lf lg gt lh"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="b506" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后用它来建立一个大众培训集:</p><figure class="ld le lf lg gt lh"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="c363" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后使用此数据训练分类器，并将其保存为 bio_model:</p><p id="c530" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe nk nl nm nn b">vw input.vw -f bio_model</code></p><h1 id="8d56" class="mg mh iq bd mi mj nf ml mm mn ng mp mq jw nh jx ms jz ni ka mu kc nj kd mw mx bi translated">分类 MSMarco</h1><ul class=""><li id="c35d" class="no np iq kh b ki my kl mz ko nq ks nr kw ns la nt nu nv nw bi translated">下载 MsMarco 收藏+查询:<code class="fe nk nl nm nn b">wget <a class="ae lb" href="https://msmarco.blob.core.windows.net/msmarcoranking/collectionandqueries.tar.gz" rel="noopener ugc nofollow" target="_blank">https://msmarco.blob.core.windows.net/msmarcoranking/collectionandqueries.tar.gz</a></code></li><li id="8b62" class="no np iq kh b ki nx kl ny ko nz ks oa kw ob la nt nu nv nw bi translated">摘录:<code class="fe nk nl nm nn b">tar -xvzf collectionandqueries.tar.gz</code></li><li id="b104" class="no np iq kh b ki nx kl ny ko nz ks oa kw ob la nt nu nv nw bi translated">从这个 repo 构建 porter stmr cli，并确保它在您的路径中。</li><li id="1c9d" class="no np iq kh b ki nx kl ny ko nz ks oa kw ob la nt nu nv nw bi translated">将你提取 collectionsandqueries.tar.gz 的目录设置为:马可女士的<br/> <code class="fe nk nl nm nn b">export DATA_DIR=./collectionandqueries</code></li><li id="d8eb" class="no np iq kh b ki nx kl ny ko nz ks oa kw ob la nt nu nv nw bi translated">运行以下代码，生成{passage_id} {score}格式的文件<code class="fe nk nl nm nn b">preds</code>。分数越高，越有可能与特定领域相关:</li></ul><blockquote class="ls lt lu"><p id="37e2" class="kf kg lv kh b ki kj jr kk kl km ju kn lw kp kq kr lx kt ku kv ly kx ky kz la ij bi translated">⚠️如果你把这个复制粘贴到终端中，第一个<strong class="kh ir"> sed </strong> <em class="iq"> </em>命令<em class="iq"> </em>中的<strong class="kh ir">标签</strong> <em class="iq"> </em>可能会变成一个空格。手动删除并按下<em class="iq"> ctrl-v </em>然后 tab。</p></blockquote><figure class="ld le lf lg gt lh"><div class="bz fp l di"><div class="nd ne l"/></div></figure><h1 id="5bf3" class="mg mh iq bd mi mj nf ml mm mn ng mp mq jw nh jx ms jz ni ka mu kc nj kd mw mx bi translated">为子集构建段落和查询</h1><p id="444c" class="pw-post-body-paragraph kf kg iq kh b ki my jr kk kl mz ju kn ko na kq kr ks nb ku kv kw nc ky kz la ij bi translated">从 MSMarco 加载集合和查询然后对它们进行分类的代码稍微复杂一些，所以我在这里就不赘述了。</p><p id="8628" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">如果您想要生产该集合，克隆<a class="ae lb" href="https://github.com/koursaros-ai/MSMarco-bio" rel="noopener ugc nofollow" target="_blank">这个</a>回购并运行 python 脚本:</p><p id="c7b3" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><code class="fe nk nl nm nn b">python3 build_dataset.py --data_dir &lt;path to collectionsandqueries dir&gt; --out_dir &lt;bio-collectionsandqueries&gt;</code></p><p id="db72" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">输出文件夹应包含:</p><ul class=""><li id="f739" class="no np iq kh b ki kj kl km ko oc ks od kw oe la nt nu nv nw bi translated"><code class="fe nk nl nm nn b">collection.tsv</code></li><li id="6ffd" class="no np iq kh b ki nx kl ny ko nz ks oa kw ob la nt nu nv nw bi translated"><code class="fe nk nl nm nn b">qrels.dev.small.tsv</code></li><li id="cd77" class="no np iq kh b ki nx kl ny ko nz ks oa kw ob la nt nu nv nw bi translated"><code class="fe nk nl nm nn b">qrels.train.tsv</code></li><li id="6ca0" class="no np iq kh b ki nx kl ny ko nz ks oa kw ob la nt nu nv nw bi translated"><code class="fe nk nl nm nn b">queries.dev.small.tsv</code></li><li id="eb12" class="no np iq kh b ki nx kl ny ko nz ks oa kw ob la nt nu nv nw bi translated"><code class="fe nk nl nm nn b">queries.train.tsv</code></li></ul><p id="10a5" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">有关这些文件格式的更多细节，请参见此处的。</p><h1 id="3056" class="mg mh iq bd mi mj nf ml mm mn ng mp mq jw nh jx ms jz ni ka mu kc nj kd mw mx bi translated">生物子集的评估结果</h1><p id="e3cf" class="pw-post-body-paragraph kf kg iq kh b ki my jr kk kl mz ju kn ko na kq kr ks nb ku kv kw nc ky kz la ij bi translated">我使用了在<a class="ae lb" href="https:/github.com/koursaros-ai/nboost" rel="noopener ugc nofollow" target="_blank"> NBoost </a> repo 上提供的预先训练的搜索相关性模型来对我为健康/生物学生成的数据集进行基准测试。</p><figure class="ld le lf lg gt lh gh gi paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="gh gi of"><img src="../Images/eeaf6a0f975b41c1d386f9a2743f21ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nxHGwS01C88TARWtYt8tKg.png"/></div></div></figure><p id="653f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在此下载数据集<a class="ae lb" href="https://storage.googleapis.com/koursaros/bio-collectionandqueries.tar.gz" rel="noopener ugc nofollow" target="_blank">或按照下面的指南构建数据集。查看</a><a class="ae lb" href="https://github.com/microsoft/MSMARCO-Passage-Ranking" rel="noopener ugc nofollow" target="_blank">此处</a>了解更多关于文件格式的细节。</p><p id="ba31" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">查看我们的主要项目<a class="ae lb" href="https://github.com/koursaros-ai/nboost" rel="noopener ugc nofollow" target="_blank"> NBoost </a>下载并使用 ElasticSearch 部署模型。</p><p id="4055" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><strong class="kh ir"> [1] </strong>对 BM25 的前 50 名结果进行重新排序</p></div><div class="ab cl lz ma hu mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="ij ik il im in"><p id="5c55" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated"><em class="lv">原载于 2019 年 12 月 3 日</em><a class="ae lb" href="https://koursaros-ai.github.io/Custom-Search/" rel="noopener ugc nofollow" target="_blank"><em class="lv">https://koursaros-ai . github . io</em></a><em class="lv">。</em></p></div></div>    
</body>
</html>