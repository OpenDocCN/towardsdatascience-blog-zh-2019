<html>
<head>
<title>How to use Python features in your data analytics project</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在数据分析项目中使用 Python 特性</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-use-python-features-in-your-data-analytics-project-e8032374d6fc?source=collection_archive---------11-----------------------#2019-04-25">https://towardsdatascience.com/how-to-use-python-features-in-your-data-analytics-project-e8032374d6fc?source=collection_archive---------11-----------------------#2019-04-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="68e9" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用 OO，NumPy，pandas，SQL，PySpark 的 Python 教程</h2></div><h1 id="3fe9" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">1.介绍</h1><p id="dd7e" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">许多公司正在向云迁移，并考虑应该使用什么工具进行数据分析。在内部，公司大多使用专有软件进行高级分析、商业智能和报告。然而，这种工具在云环境中可能不是最合理的选择。原因可能是 1)缺乏与云提供商的集成，2)缺乏<a class="ae lt" href="https://en.wikipedia.org/wiki/Big_data#Characteristics" rel="noopener ugc nofollow" target="_blank">大数据</a>支持，或者 3)缺乏对机器学习和深度学习等新用例的支持。</p><p id="d399" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi translated">Python 是一种通用编程语言，广泛用于数据分析。几乎所有的云数据平台都提供 Python 支持，并且通常新特性首先在 Python 中可用。在这方面，Python 可以被视为数据分析的瑞士军刀。</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi lz"><img src="../Images/a02c7ea184d7d845da4f664e702cb786.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BJb6LxJH4F5SWIwpXN98VQ.png"/></div></div><figcaption class="ml mm gj gh gi mn mo bd b be z dk">1. Python as Swiss Army knife for data analytics</figcaption></figure><h1 id="2824" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">2.目标</h1><p id="fabe" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">在本教程中，创建了两个考虑到 Python 重要特性的项目。项目描述如下:</p><ul class=""><li id="c931" class="mp mq iq kz b la lu ld lv lg mr lk ms lo mt ls mu mv mw mx bi translated">在第一个项目中，在 Azure 中的数据科学虚拟机(DSVM)上执行 Jupyter 笔记本。面向对象(OO)类是使用数据的继承、重载和封装创建的。随后，NumPy 和 pandas 用于数据分析。最后，数据存储在 DSVM 上的数据库中。</li><li id="3b6c" class="mp mq iq kz b la my ld mz lg na lk nb lo nc ls mu mv mw mx bi translated">在第二个项目中，Databricks 笔记本在具有多个虚拟机的 Spark 集群上执行。PySpark 用于创建机器学习模型。</li></ul><p id="9c51" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi translated">因此，将执行以下步骤:</p><ul class=""><li id="953b" class="mp mq iq kz b la lu ld lv lg mr lk ms lo mt ls mu mv mw mx bi translated">3.先决条件</li><li id="8a2c" class="mp mq iq kz b la my ld mz lg na lk nb lo nc ls mu mv mw mx bi translated">4.DSVM 上带有 Jupyter 的 OO、NumPy、pandas 和 SQL</li><li id="0c15" class="mp mq iq kz b la my ld mz lg na lk nb lo nc ls mu mv mw mx bi translated">5.Spark 集群上带有 Azure 数据块的 PySpark</li><li id="b9e3" class="mp mq iq kz b la my ld mz lg na lk nb lo nc ls mu mv mw mx bi translated">6.结论</li></ul><p id="c155" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi translated">这是一个独立的教程，重点是学习 Python 的不同方面。重点不在于“深入”各个方面。如果你对深度学习更感兴趣，请参见<a class="ae lt" rel="noopener" target="_blank" href="/how-to-create-your-own-deep-learning-project-in-azure-509660d8297">这里</a>或在 devops for AI，参考我以前的博客，<a class="ae lt" rel="noopener" target="_blank" href="/how-to-bring-your-data-science-project-in-production-b36ae4c02b46">这里</a>和关注安全，请参见<a class="ae lt" rel="noopener" target="_blank" href="/how-to-embed-security-in-your-azure-data-science-project-55ef3f2ab47">这里</a>。</p><h1 id="7b84" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">3.先决条件</h1><p id="72ee" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">需要创建以下资源:</p><ul class=""><li id="c49a" class="mp mq iq kz b la lu ld lv lg mr lk ms lo mt ls mu mv mw mx bi translated"><a class="ae lt" href="https://docs.microsoft.com/en-us/azure/machine-learning/data-science-virtual-machine/provision-vm#create-your-dsvm" rel="noopener ugc nofollow" target="_blank">数据科学虚拟机</a>(第四部分)</li><li id="2a20" class="mp mq iq kz b la my ld mz lg na lk nb lo nc ls mu mv mw mx bi translated"><a class="ae lt" href="https://docs.azuredatabricks.net/getting-started/try-databricks.html#step-2-create-a-databricks-workspace" rel="noopener ugc nofollow" target="_blank"> Azure Databricks 工作区</a>(第五部分)</li></ul><h1 id="ff1d" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">4.DSVM 上带有 Jupyter 的 OO、NumPy、pandas 和 sql</h1><p id="373d" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">在这一部分中，一个包含三个类的示例 Python 项目。使用这些类，足球运动员的数据被登记。执行以下步骤:</p><ul class=""><li id="86d0" class="mp mq iq kz b la lu ld lv lg mr lk ms lo mt ls mu mv mw mx bi translated">4a。开始</li><li id="bfa9" class="mp mq iq kz b la my ld mz lg na lk nb lo nc ls mu mv mw mx bi translated">4b。面向对象编程</li><li id="13da" class="mp mq iq kz b la my ld mz lg na lk nb lo nc ls mu mv mw mx bi translated">4c。使用 NumPy 的矩阵分析</li><li id="cce3" class="mp mq iq kz b la my ld mz lg na lk nb lo nc ls mu mv mw mx bi translated">4d。使用熊猫进行统计分析</li><li id="175e" class="mp mq iq kz b la my ld mz lg na lk nb lo nc ls mu mv mw mx bi translated">4e。读取/写入数据库</li></ul><h2 id="0aaa" class="nd kg iq bd kh ne nf dn kl ng nh dp kp lg ni nj kr lk nk nl kt lo nm nn kv no bi translated">4a。开始</h2><p id="6002" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">登录到您的 Windows 数据科学虚拟机(DSVM)。在桌面上，可以找到预装组件图标的概述。点击 Jupyter 快捷方式开始 Jupyter 会话。</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi np"><img src="../Images/82efc3563b74a708d8d6518cc850fa37.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P1p82ZdjXtmHmrlYCH18HA.png"/></div></div><figcaption class="ml mm gj gh gi mn mo bd b be z dk">4a1. preinstalled components on DSVM needed in this tutorial</figcaption></figure><p id="cdfb" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi translated">随后，打开可以在任务栏中找到的 Jupyter 命令行会话。复制 URL 并在 Firefox 会话中打开它。</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi nq"><img src="../Images/a8c22c0a06055d2520db6d889aca5315.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_RbIoHJ4xCvjG-oit-g8uQ.png"/></div></div><figcaption class="ml mm gj gh gi mn mo bd b be z dk">4a2. Localhost URL to be openen in Firefox</figcaption></figure><p id="8a5b" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi translated">然后将以下笔记本下载到 DSVM 的桌面上:</p><pre class="ma mb mc md gt nr ns nt nu aw nv bi"><span id="3745" class="nd kg iq ns b gy nw nx l ny nz"><a class="ae lt" href="https://raw.githubusercontent.com/rebremer/python_swiss_army_knife/master/SwissArmyKnifePython.ipynb" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/rebremer/python_swiss_army_knife/master/SwissArmyKnifePython.ipynb</a></span></pre><p id="0e9c" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi translated">最后，选择在 jupyter 会话中上传笔记本。然后点击菜单中的运行按钮，运行单元格中的代码。笔记本最重要的部分也将在本章的剩余部分讨论。</p><h2 id="0ea1" class="nd kg iq bd kh ne nf dn kl ng nh dp kp lg ni nj kr lk nk nl kt lo nm nn kv no bi translated">4b。面向对象编程</h2><p id="1d81" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">这部分教程的灵感来自 Theophano Mitsa 的<a class="ae lt" rel="noopener" target="_blank" href="/a-data-scientist-should-know-at-least-this-much-python-oop-d63f37eaac4d">教程</a>。在这一部分中，创建了三个类来跟踪足球运动员的数据。一级球员的片段可以在下面找到:</p><pre class="ma mb mc md gt nr ns nt nu aw nv bi"><span id="7572" class="nd kg iq ns b gy nw nx l ny nz"># Class 1: Player<br/>class Player(object):<br/>    _posList = {'goalkeeper', 'defender', 'midfielder', 'striker'}<br/>    <br/>    def __init__(self,name):<br/>        self._playerName=name<br/>        self._trainingList=[]<br/>        self._rawData = np.empty((0,3), int)<br/>        <br/>    def setPosition(self, pos):<br/>        if pos in self._posList:<br/>            self._position=pos<br/>            print(self._playerName + " is " + pos)<br/>        else:<br/>            raise ValueError("Value {} not in list.".format(pos))        <br/><br/>    def setTraining(self, t, rawData):<br/>        self._trainingList.append(t)<br/>        self._rawData = np.append(self._rawData, rawData, axis=0)</span><span id="6591" class="nd kg iq ns b gy oa nx l ny nz">    def getTrainingRawData(self):<br/>        return self._rawData</span><span id="ab0c" class="nd kg iq ns b gy oa nx l ny nz">    #def getTrainingFilter(self, stage, tt, date):<br/>    # see github project for rest of code</span></pre><p id="c611" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi translated">在这个类中可以看到以下内容:</p><ul class=""><li id="f502" class="mp mq iq kz b la lu ld lv lg mr lk ms lo mt ls mu mv mw mx bi translated">一个 _rawData 属性在新玩家被实例化时被创建。该属性用于<strong class="kz ir">用 setTraining 方法封装</strong>训练数据</li><li id="7293" class="mp mq iq kz b la my ld mz lg na lk nb lo nc ls mu mv mw mx bi translated">_rawData 被创建为受<strong class="kz ir">保护的</strong>变量。这告诉程序员应该使用 get 和 set 方法来处理 _rawData</li></ul><p id="f30e" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi translated">随后，可以在下面找到 FirstTeamPlayer 类:</p><pre class="ma mb mc md gt nr ns nt nu aw nv bi"><span id="7d65" class="nd kg iq ns b gy nw nx l ny nz"># Class 2: FirstTeamPlayer<br/>class FirstTeamPlayer(Player):<br/>    def __init__(self,ftp):<br/>        Player.__init__(self, ftp)<br/><br/>    def setPosition(self,pos1, pos2):<br/>        if pos1 in self._posList and pos2 in self._posList:<br/>            self._posComp=pos1<br/>            self._posCL=pos2<br/>            print(self._playerName + " is " + pos1)<br/>            print(self._playerName + " is " + pos2 + " in the CL")<br/>        else:<br/>            raise ValueError("Pos {},{} unknown".format(pos1, pos2))   <br/><br/>    def setNumber(self,number):<br/>        self._number=number<br/>        print(self._playerName + " has number " + str(number))</span></pre><p id="108e" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi translated">在这个类中可以看到以下内容:</p><ul class=""><li id="e2a3" class="mp mq iq kz b la lu ld lv lg mr lk ms lo mt ls mu mv mw mx bi translated">FirstTeamPlayer <strong class="kz ir">从 Player 类继承了</strong>，这意味着 Player 类的所有属性/方法也可以在 FirstTeamPlayer 中使用</li><li id="6b69" class="mp mq iq kz b la my ld mz lg na lk nb lo nc ls mu mv mw mx bi translated">方法 setPosition 在 FirstPlayerClass 中被<strong class="kz ir">重载</strong>，并有了新的定义。方法 setNumber 仅在 FirstPlayerClass 中可用</li></ul><p id="6865" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi translated">最后，可以在下面找到培训课程的一个片段:</p><pre class="ma mb mc md gt nr ns nt nu aw nv bi"><span id="0346" class="nd kg iq ns b gy nw nx l ny nz"># Class 3: Training<br/>class Training(object):<br/>    _stageList = {'ArenA', 'Toekomst', 'Pool', 'Gym'}<br/>    _trainingTypeList = {'strength', 'technique', 'friendly game'}<br/><br/>    def __init__(self, stage, tt, date):<br/>        if stage in self._stageList:<br/>            self._stage = stage<br/>        else:<br/>            raise ValueError("Value {} not in list.".format(stage))<br/>        if tt in self._trainingTypeList:<br/>            self._trainingType = tt<br/>        else:<br/>            raise ValueError("Value {} not in list.".format(tt))<br/><br/>        #todo: Valid date test (no static type checking in Python)<br/>        self._date = date<br/><br/>    def getStage(self):<br/>        return self._stage<br/><br/>    def getTrainingType(self):<br/>        return self._trainingType<br/><br/>    def getDate(self):<br/>        return self._date</span></pre><p id="986c" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi translated">在这个类中可以看到以下内容:</p><ul class=""><li id="23d1" class="mp mq iq kz b la lu ld lv lg mr lk ms lo mt ls mu mv mw mx bi translated">Python 中没有静态类型检查<strong class="kz ir">。例如，日期属性不能声明为日期，必须创建一个附加检查</strong></li></ul><p id="442e" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi translated">这三个类是如何实例化和使用的示例可以在下面的最终代码片段中找到:</p><pre class="ma mb mc md gt nr ns nt nu aw nv bi"><span id="44ad" class="nd kg iq ns b gy nw nx l ny nz"># Construct two players, FirstTeamPlayer class inherits from Player<br/>player1 = Player("Janssen")<br/>player2 = FirstTeamPlayer("Tadic")</span><span id="45b3" class="nd kg iq ns b gy oa nx l ny nz"># SetPosition of player, method is overloaded in FirsTeamPlayer<br/>player1.setPosition("goalkeeper")<br/>player2.setPosition("midfielder", "striker")</span><span id="56e8" class="nd kg iq ns b gy oa nx l ny nz"># Create new traning object and add traningsdata to player object. <br/>training1=Training('Toekomst', 'strength', date(2019,4,19))<br/>player1.setTraining(training1, rawData=np.random.rand(1,3))<br/>player2.setTraining(training1, rawData=np.random.rand(1,3))</span><span id="6616" class="nd kg iq ns b gy oa nx l ny nz"># Add another object<br/>training2=Training('ArenA', 'friendly game', date(2019,4,20))<br/>player1.setTraining(training2, rawData=np.random.rand(1,3))<br/>player2.setTraining(training2, rawData=np.random.rand(1,3))</span></pre><h2 id="3bcc" class="nd kg iq bd kh ne nf dn kl ng nh dp kp lg ni nj kr lk nk nl kt lo nm nn kv no bi translated">4c。使用 NumPy 的矩阵分析</h2><p id="afc1" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">NumPy 是使用 Python 进行科学计算的基础包。在本教程中，它将被用来做矩阵分析。请注意，attribute _rawData 已经作为 NumPy 数组封装在 Player 类中。NumPy 通常与 Matplotlib 一起使用来可视化数据。在下面的代码片段中，数据取自玩家类，然后进行一些矩阵运算，从基础到更高级。完整的例子可以在 github 项目中找到。</p><pre class="ma mb mc md gt nr ns nt nu aw nv bi"><span id="a796" class="nd kg iq ns b gy nw nx l ny nz"># Take the matrix data from player objecs that were created earlier<br/>m1=player1.getTrainingRawData()<br/>m2=player2.getTrainingRawData()</span><span id="e6d1" class="nd kg iq ns b gy oa nx l ny nz"># print some values<br/>print(m1[0][1])<br/>print(m1[:,0])<br/>print(m1[1:3,1:3])</span><span id="e9e4" class="nd kg iq ns b gy oa nx l ny nz"># arithmetic<br/>tmp3=m1*m2 # [m2_11*m1_11,  ..,  m1_33*m2_33]<br/>print(tmp3)</span><span id="5fe3" class="nd kg iq ns b gy oa nx l ny nz"># matrix multiplication<br/>tmp1 = m1.dot(m2) # [m1_11 * m2_11 + m1_23 * m2_32 +  m1_13 * m2_31, <br/>                  #   ..., <br/>                  # m1_31 * m2_13 + m1_23 * m2_32 +  m1_33 * m2_33]<br/>print(tmp1)</span><span id="7da4" class="nd kg iq ns b gy oa nx l ny nz"># inverse matrix<br/>m1_inv = np.linalg.inv(m1)<br/>print("inverse matrix")<br/>print(m1_inv)<br/>print(m1.dot(m1_inv))</span><span id="7e21" class="nd kg iq ns b gy oa nx l ny nz"># singular value decomposition<br/>u, s, vh = np.linalg.svd(m1, full_matrices=True)<br/>print("singular value decomposition")<br/>print(u)<br/>print(s)<br/>print(vh)</span></pre><h2 id="a0ec" class="nd kg iq bd kh ne nf dn kl ng nh dp kp lg ni nj kr lk nk nl kt lo nm nn kv no bi translated">4d。使用熊猫进行统计分析</h2><p id="814d" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">Pandas 是 Python 中高性能、易于使用的数据结构和数据分析工具的包。在幕后，pandas 使用 NumPy 作为它的数组结构。在本教程中，它将用于计算一些基本的统计数据。在下面的代码片段中，数据取自 player 类，然后进行一些统计操作。完整的例子可以在 github 项目中找到。</p><pre class="ma mb mc md gt nr ns nt nu aw nv bi"><span id="0c62" class="nd kg iq ns b gy nw nx l ny nz"># Create the same matrices as earlier<br/>m1=player1.getTrainingRawData()<br/>m2=player2.getTrainingRawData()</span><span id="c3c6" class="nd kg iq ns b gy oa nx l ny nz"># create column names to be added to pandas dataframe<br/>columns = np.array(['col1', 'col2', 'col3'])<br/><br/># Create pandas dataframe<br/>df_1=pd.DataFrame(data=m1, columns=columns)<br/>df_2=pd.DataFrame(data=m2, columns=columns)</span><span id="a0d4" class="nd kg iq ns b gy oa nx l ny nz"># calculate basic statistics col1<br/>print(df_1['col1'].sum())<br/>print(df_1['col1'].mean())<br/>print(df_1['col1'].median())<br/>print(df_1['col1'].std())<br/>print(df_1['col1'].describe())</span><span id="5d46" class="nd kg iq ns b gy oa nx l ny nz"># calculate correlation and covariance of dataframe<br/>tmp1=df_1.cov()<br/>tmp2=df_1.corr()<br/><br/>print("correlation:\n " + str(tmp1))<br/>print("\n")<br/>print("covariance:\n " + str(tmp2))</span></pre><h2 id="4e1c" class="nd kg iq bd kh ne nf dn kl ng nh dp kp lg ni nj kr lk nk nl kt lo nm nn kv no bi translated">4e。读取/写入数据库</h2><p id="79b3" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">最后，数据将被写入 SQL 数据库。在本教程中，使用了作为 DSVM 一部分的 MSSQL 数据库。在任务栏中查找 Microsoft SQL Server Management Studio(SSMS)图标，并启动一个新会话。使用 Windows 身份验证登录，另请参见下文。</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi ob"><img src="../Images/014b79676bd2e1f2055865e4b19fd87a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lOhgjJEm_yhfmech8ofuBA.png"/></div></div><figcaption class="ml mm gj gh gi mn mo bd b be z dk">4e1. SSMS session using Windows Authentication</figcaption></figure><p id="5def" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi translated">在菜单中查找“新查询”并开始新的查询会话。然后执行以下脚本:</p><pre class="ma mb mc md gt nr ns nt nu aw nv bi"><span id="bf7f" class="nd kg iq ns b gy nw nx l ny nz">USE [Master]<br/>GO<br/><br/>CREATE DATABASE pythontest<br/>GO<br/><br/>USE [pythontest]<br/><br/>CREATE TABLE [dbo].[trainingsdata]<br/>(  <br/> [col1] [float] NOT NULL,<br/> [col2] [float] NOT NULL,<br/> [col3] [float] NOT NULL<br/>)<br/>GO</span></pre><p id="3284" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi translated">最后，可以将数据写入数据库和从数据库中读取数据。熊猫数据帧将用于此，也见下面的片段。</p><pre class="ma mb mc md gt nr ns nt nu aw nv bi"><span id="1e12" class="nd kg iq ns b gy nw nx l ny nz"># import library<br/>import pyodbc</span><span id="af8b" class="nd kg iq ns b gy oa nx l ny nz"># set connection variables<br/>server  = '&lt;&lt;your vm name, which name of SQL server instance &gt;&gt;'<br/>database = 'pythontest'<br/>driver= '{ODBC Driver 17 for SQL Server}'</span><span id="0168" class="nd kg iq ns b gy oa nx l ny nz"># Make connection to database<br/>cnxn = pyodbc.connect('DRIVER='+driver+';SERVER='+server+';PORT=1433;DATABASE='+database + ';Trusted_Connection=yes;')<br/>cursor = cnxn.cursor()</span><span id="7db4" class="nd kg iq ns b gy oa nx l ny nz">#Write results, use pandas dataframe<br/>for index,row in df_1.iterrows():<br/>    cursor.execute("INSERT INTO dbo.trainingsdata([col1],[col2],[col3]) VALUES (?,?,?)", row['col1'], row['col2'], row['col3'])<br/>    cnxn.commit()</span><span id="eb7e" class="nd kg iq ns b gy oa nx l ny nz">#Read results, use pandas dataframe<br/>sql = "SELECT [col1], [col2], [col3] FROM dbo.trainingsdata"<br/>df_1read = pd.read_sql(sql,cnxn)<br/>print(df_1read)<br/>cursor.close()</span></pre><h1 id="ac69" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">5.Spark 集群上带有 Azure 数据块的 PySpark</h1><p id="e89f" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">在前一章中，所有的代码都在一台机器上运行。如果产生更多的数据或需要进行更高级的计算(例如深度学习)，唯一的可能是采用更重的机器，从而将<strong class="kz ir">放大</strong>以执行代码。也就是说，计算不能分配给其他虚拟机。</p><p id="4b02" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi translated">Spark 是一个分析框架，可以将计算分配给其他虚拟机，因此可以通过添加更多虚拟机来<strong class="kz ir">横向扩展</strong>。这比让一台“超级计算机”做所有的工作要高效得多。Python 可以在 Spark 中使用，通常被称为 PySpark。在本教程中，将使用 Azure Databricks，这是一个针对 Azure 优化的基于 Apache Spark 的分析平台。在这种情况下，执行以下步骤。</p><ul class=""><li id="c1b5" class="mp mq iq kz b la lu ld lv lg mr lk ms lo mt ls mu mv mw mx bi translated">5a。开始</li><li id="05c7" class="mp mq iq kz b la my ld mz lg na lk nb lo nc ls mu mv mw mx bi translated">5b。项目设置</li></ul><h2 id="34e5" class="nd kg iq bd kh ne nf dn kl ng nh dp kp lg ni nj kr lk nk nl kt lo nm nn kv no bi translated">5a。开始</h2><p id="df21" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">启动 Azure Databricks 工作区并转到群集。使用以下设置创建新群集:</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi oc"><img src="../Images/6976e6157c8c74e39a495a49b902ba44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EjtRhCH6SUA6Wuus-j-pDA.png"/></div></div><figcaption class="ml mm gj gh gi mn mo bd b be z dk">5a1. Create cluster</figcaption></figure><p id="ada3" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi translated">接下来，选择工作区，右键单击，然后选择导入。在单选按钮中，选择使用 URL 导入以下笔记本:</p><pre class="ma mb mc md gt nr ns nt nu aw nv bi"><span id="bae4" class="nd kg iq ns b gy nw nx l ny nz"><a class="ae lt" href="https://raw.githubusercontent.com/rebremer/devopsai_databricks/master/project/modelling/1_IncomeNotebookExploration.py" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/rebremer/devopsai_databricks/master/project/modelling/1_IncomeNotebookExploration.py</a></span></pre><p id="4d24" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi translated">另请参见下图:</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi od"><img src="../Images/0df07fccbc090bc305313069b0d64f21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P-jdfwh_MxqeMz9oaN6yBA.png"/></div></div><figcaption class="ml mm gj gh gi mn mo bd b be z dk">5a2. Import notebook</figcaption></figure><p id="e5c1" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi translated">选择您在 4b 中导入的笔记本，并将该笔记本连接到您在 4a 中创建的集群。确保集群正在运行，否则启动它。使用快捷键 SHIFT+ENTER 逐个单元格地浏览笔记本。</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi oe"><img src="../Images/f9403abaa5e7518af7c4057ee5bd5be3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9lC44iMXrszFpqjCijujcw.png"/></div></div><figcaption class="ml mm gj gh gi mn mo bd b be z dk">5a3. Run notebook</figcaption></figure><p id="2e75" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi translated">最后，如果你想跟踪模型，创建模型的 HTTP 端点和/或创建项目的 DevOps 管道，请参见我的高级 DevOps for AI 教程<a class="ae lt" rel="noopener" target="_blank" href="/how-to-bring-your-data-science-project-in-production-b36ae4c02b46">这里</a>，关于安全性，请参见<a class="ae lt" rel="noopener" target="_blank" href="/how-to-embed-security-in-your-azure-data-science-project-55ef3f2ab47">这里</a>。</p><h2 id="1a1f" class="nd kg iq bd kh ne nf dn kl ng nh dp kp lg ni nj kr lk nk nl kt lo nm nn kv no bi translated">5b。项目的设置</h2><p id="cb2d" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">在这个项目中，创建了一个机器学习模型，该模型使用年龄、每周工作时间、教育程度等特征来预测一个人的收入阶层。在这种情况下，执行以下步骤:</p><ul class=""><li id="ebf0" class="mp mq iq kz b la lu ld lv lg mr lk ms lo mt ls mu mv mw mx bi translated">以 Spark 数据框架的形式接收、探索和准备数据</li><li id="c9c5" class="mp mq iq kz b la my ld mz lg na lk nb lo nc ls mu mv mw mx bi translated">逻辑回归-使用一周工作时间的 1 个特征</li><li id="e477" class="mp mq iq kz b la my ld mz lg na lk nb lo nc ls mu mv mw mx bi translated">逻辑回归—所有特征(工作时间、年龄、状态等)</li><li id="7574" class="mp mq iq kz b la my ld mz lg na lk nb lo nc ls mu mv mw mx bi translated">逻辑回归—防止过度拟合(正则化)</li><li id="54a8" class="mp mq iq kz b la my ld mz lg na lk nb lo nc ls mu mv mw mx bi translated">决策树—不同的算法，找出性能最好的算法</li></ul><p id="ffe7" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi translated">请注意，pyspark.ml 库用于构建模型。也可以在 Azure Databricks 中运行 scikit-learn 库，但是，工作只能由驱动程序(主)节点完成，计算不是分布式的。请看下面使用 pyspark 包的片段。</p><pre class="ma mb mc md gt nr ns nt nu aw nv bi"><span id="1d5b" class="nd kg iq ns b gy nw nx l ny nz">from pyspark.ml import Pipeline, PipelineModel<br/>from pyspark.ml.classification import LogisticRegression<br/>from pyspark.ml.classification import DecisionTreeClassifier<br/>#...</span></pre><h1 id="891f" class="kf kg iq bd kh ki kj kk kl km kn ko kp jw kq jx kr jz ks ka kt kc ku kd kv kw bi translated">6.结论</h1><p id="2a52" class="pw-post-body-paragraph kx ky iq kz b la lb jr lc ld le ju lf lg lh li lj lk ll lm ln lo lp lq lr ls ij bi translated">在本教程中，创建了两个 Python 项目，如下所示:</p><ul class=""><li id="d124" class="mp mq iq kz b la lu ld lv lg mr lk ms lo mt ls mu mv mw mx bi translated">Jupyter 笔记本在数据科学虚拟机上使用面向对象编程、NumPy、pandas 进行数据分析，并使用 SQL 存储数据</li><li id="2b98" class="mp mq iq kz b la my ld mz lg na lk nb lo nc ls mu mv mw mx bi translated">分布式 Spark 集群上的 Databricks 笔记本，具有多个使用 PySpark 构建机器学习模型的虚拟机</li></ul><p id="88d0" class="pw-post-body-paragraph kx ky iq kz b la lu jr lc ld lv ju lf lg lw li lj lk lx lm ln lo ly lq lr ls ij bi translated">许多公司考虑在云中使用什么工具进行数据分析。在这方面，几乎所有的云数据分析平台都支持 Python，因此，Python 可以被视为数据分析的瑞士军刀。本教程可能会帮助你探索 Python 的可能性。</p><figure class="ma mb mc md gt me gh gi paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="gh gi lz"><img src="../Images/a02c7ea184d7d845da4f664e702cb786.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BJb6LxJH4F5SWIwpXN98VQ.png"/></div></div><figcaption class="ml mm gj gh gi mn mo bd b be z dk">6. Python as Swiss Army knife for data analytics</figcaption></figure></div></div>    
</body>
</html>