<html>
<head>
<title>Running Jupyter Notebooks on Remote Servers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在远程服务器上运行 Jupyter 笔记本电脑</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/running-jupyter-notebooks-on-remote-servers-603fbcc256b3?source=collection_archive---------4-----------------------#2019-03-04">https://towardsdatascience.com/running-jupyter-notebooks-on-remote-servers-603fbcc256b3?source=collection_archive---------4-----------------------#2019-03-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/901fe21e82adda2762addd20ea2464b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rhhk7heUKv1KA8p50I-ElA.jpeg"/></div></div></figure><p id="cb93" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><a class="ae kw" href="https://jupyter.org/" rel="noopener ugc nofollow" target="_blank"> Jupyter 笔记本</a>是许多数据科学家工具箱中的必备工具。作为一个工具，Jupyter Notebook 可以通过以交互方式更容易地执行数据分析、模型原型制作和实验来提高生产力，从而缩短从编码到看到结果的反馈循环。</p><p id="40f9" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在许多情况下，在笔记本电脑或工作站上运行 Jupyter 笔记本就足够了。然而，如果您正在处理大型数据集，进行计算成本高昂的数据处理，或者学习复杂的模型，您可能需要比笔记本电脑更强大的功能。也许你正在大型图上运行<a class="ae kw" rel="noopener" target="_blank" href="/how-to-do-deep-learning-on-graphs-with-graph-convolutional-networks-7d2250723780">图卷积网络</a>，或者在大型文本语料库上使用递归神经网络进行<a class="ae kw" href="https://medium.com/@umerfarooq_26378/neural-machine-translation-with-code-68c425044bbd" rel="noopener">机器翻译，并且需要更多的 CPU 内核、RAM 或几个 GPU。幸运的是，您可能在远程服务器上拥有这些资源！</a></p><p id="78e1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">如果您的远程服务器有图形用户界面(GUI ),那么您很幸运。您可以使用<a class="ae kw" href="https://en.wikipedia.org/wiki/Remote_desktop_software" rel="noopener ugc nofollow" target="_blank">远程桌面软件</a>访问远程服务器，或者像在笔记本电脑上一样使用 Jupyter Notebook。</p><p id="0015" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然而，许多服务器没有 GUI。如果您处于这种情况，您可以通过在您的笔记本电脑上编写 Python 脚本来设置您的实验，在您的一小部分数据上运行它以验证它可以运行，将它复制到远程服务器，并从命令行执行它。您甚至可以在笔记本中设置实验，并使用<code class="fe kx ky kz la b">jupyter nbconvert --to script your_notebook.ipynb</code>将笔记本导出到脚本中。尽管这种工作流确实允许您在远程服务器上运行代码，但是您不能再使用 Jupyter Notebook 来进行交互操作，例如，试验您的模型和可视化您的结果。太可惜了！</p><p id="6c03" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在这篇文章中，我将向你展示如何在远程服务器上运行 Jupyter 笔记本，以及如何在你的笔记本上访问它。我还将展示如何设置两个<code class="fe kx ky kz la b">bash</code>命令来简化整个过程。</p><h1 id="862b" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">启动远程笔记本服务器</h1><p id="a375" class="pw-post-body-paragraph jy jz iq ka b kb lz kd ke kf ma kh ki kj mb kl km kn mc kp kq kr md kt ku kv ij bi translated">我们将使用<a class="ae kw" href="https://en.wikipedia.org/wiki/Secure_Shell" rel="noopener ugc nofollow" target="_blank">安全 Shell 协议</a> (SSH)在远程服务器上启动 Jupyter 笔记本服务器。SSH 允许我们向远程服务器发送命令。基本语法如下:</p><pre class="me mf mg mh gt mi la mj mk aw ml bi"><span id="56ff" class="mm lc iq la b gy mn mo l mp mq">ssh username:password@remote_server_ip command</span></pre><p id="4c77" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">您应该发送的确切命令在一定程度上取决于您的上下文。在我的例子中，我与其他人共享一个远程服务器，因此没有在共享环境中安装 Jupyter。因此，我的第一步是转到我的项目文件夹，激活虚拟环境，并启动笔记本服务器。特别是，我想在远程服务器上执行以下三个<code class="fe kx ky kz la b">bash</code>命令:</p><pre class="me mf mg mh gt mi la mj mk aw ml bi"><span id="0056" class="mm lc iq la b gy mn mo l mp mq">cd project_folder<br/>. virtual_environment/bin/activate<br/>jupyter notebook --no-browser --port=8889</span></pre><p id="f7e7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我执行带有<code class="fe kx ky kz la b">--no-browser</code>标志的<code class="fe kx ky kz la b">jupyter notebook</code>命令来启动 Jupyter 笔记本，启动一个浏览器，因为远程服务器如果没有 GUI 就不能显示浏览器。我还使用<code class="fe kx ky kz la b">--port=8889</code>标志将端口从默认端口 8888 更改为端口 8889。这是个人喜好；将本地和远程笔记本放在不同的端口上，以便更容易看到我的代码在哪里运行。</p><p id="996f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了在远程服务器上执行命令，我们运行组合命令</p><pre class="me mf mg mh gt mi la mj mk aw ml bi"><span id="2df4" class="mm lc iq la b gy mn mo l mp mq">nohup ssh -f username:password@remote_server_ip "cd project_folder; . virtual_environment/bin/activate; jupyter notebook --no-browser --port=8889"</span></pre><p id="c625" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">请注意，我将这三个命令排成一行，并用<code class="fe kx ky kz la b">;</code>代替换行符将它们分开。执行此命令将在端口 8889 上启动 Jupyter 笔记本服务器，并让它在后台运行。最后，我在<code class="fe kx ky kz la b">ssh</code>命令中添加了<code class="fe kx ky kz la b">-f</code>标志，将进程推到后台，并在前面添加了<code class="fe kx ky kz la b">nohup</code>命令，使进程的所有输出静音，这样您就可以继续使用终端窗口。你可以在这里阅读更多关于<code class="fe kx ky kz la b">nohup</code>命令<a class="ae kw" href="https://www.computerhope.com/unix/unohup.htm" rel="noopener ugc nofollow" target="_blank">的内容。</a></p><h1 id="98bd" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">访问您的笔记本</h1><p id="41b4" class="pw-post-body-paragraph jy jz iq ka b kb lz kd ke kf ma kh ki kj mb kl km kn mc kp kq kr md kt ku kv ij bi translated">您现在可以通过输入 url 来访问笔记本</p><pre class="me mf mg mh gt mi la mj mk aw ml bi"><span id="3a14" class="mm lc iq la b gy mn mo l mp mq">remote_server_ip:8889</span></pre><p id="b6b3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">该命令要求您记忆 IP 地址或标记网页。然而，我们可以通过使用<a class="ae kw" href="https://en.wikipedia.org/wiki/Port_forwarding" rel="noopener ugc nofollow" target="_blank">端口转发</a>让访问远程笔记本就像访问本地笔记本一样简单:</p><pre class="me mf mg mh gt mi la mj mk aw ml bi"><span id="7ca5" class="mm lc iq la b gy mn mo l mp mq">nohup ssh -N -f -L localhost:8889:localhost:8889 username:password@remote_server_ip</span></pre><p id="44fd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><code class="fe kx ky kz la b">-N</code>标志告诉<code class="fe kx ky kz la b">ssh</code>不会执行任何远程命令。此时，我们不需要执行任何远程命令。如前所述，<code class="fe kx ky kz la b">-f</code>标志将<code class="fe kx ky kz la b">ssh</code>进程推到后台。最后，<code class="fe kx ky kz la b">-L</code>标志使用语法<code class="fe kx ky kz la b">local_server:local_port:remote_server:remote_port</code>指定端口转发配置。该配置指定所有发送到本地机器上端口<code class="fe kx ky kz la b">8889</code>的请求，例如，您的笔记本电脑，发送到远程机器上<code class="fe kx ky kz la b">username:password@remote_server_ip</code>的端口<code class="fe kx ky kz la b">8889</code>。如前所述，<code class="fe kx ky kz la b">nohup</code>命令被添加到前面，以使输出静音。</p><p id="f746" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">上述命令的效果是，您现在可以在浏览器中访问远程 Jupyter 笔记本服务器</p><pre class="me mf mg mh gt mi la mj mk aw ml bi"><span id="f745" class="mm lc iq la b gy mn mo l mp mq">localhost:8889</span></pre><p id="8346" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">就像您在本地运行笔记本一样。</p><h1 id="de5e" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">停止远程笔记本服务器</h1><p id="197e" class="pw-post-body-paragraph jy jz iq ka b kb lz kd ke kf ma kh ki kj mb kl km kn mc kp kq kr md kt ku kv ij bi translated">原则上，您可以让笔记本服务器在远程服务器上无限期运行(除非重启或崩溃)，但是您可能需要停止服务器，例如升级您的<code class="fe kx ky kz la b">jupyter</code>版本。如果你需要停止它有两种方法:通过浏览器或命令行。</p><h2 id="dcf1" class="mm lc iq bd ld mr ms dn lh mt mu dp ll kj mv mw lp kn mx my lt kr mz na lx nb bi translated">通过浏览器窗口</h2><p id="2960" class="pw-post-body-paragraph jy jz iq ka b kb lz kd ke kf ma kh ki kj mb kl km kn mc kp kq kr md kt ku kv ij bi translated">在 Jupyter 笔记本的最新版本中，您可以在浏览器窗口的右上角找到一个退出按钮，如下图中的箭头所示。如果您按下它，您将不得不使用我们之前看到的启动命令重新启动服务器。</p><figure class="me mf mg mh gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi nc"><img src="../Images/2281d6d614a0b71d7fcc694becedbf3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-_e16uYLCzydswb1COVosA.png"/></div></div><figcaption class="nd ne gj gh gi nf ng bd b be z dk">The Quit Button</figcaption></figure><h2 id="024c" class="mm lc iq bd ld mr ms dn lh mt mu dp ll kj mv mw lp kn mx my lt kr mz na lx nb bi translated">通过命令行</h2><p id="973d" class="pw-post-body-paragraph jy jz iq ka b kb lz kd ke kf ma kh ki kj mb kl km kn mc kp kq kr md kt ku kv ij bi translated">如果您无法升级到具有 Quit 按钮的较新版本的 Jupyter，或者只是喜欢通过终端工作，您也可以从命令行停止服务器。Jupyter 有一个停止笔记本的 shell 命令:</p><pre class="me mf mg mh gt mi la mj mk aw ml bi"><span id="e864" class="mm lc iq la b gy mn mo l mp mq">jupyter notebook stop 8889</span></pre><p id="2d66" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">其中<code class="fe kx ky kz la b">8889</code>是端口号。您可以使用命令在远程服务器上执行它</p><pre class="me mf mg mh gt mi la mj mk aw ml bi"><span id="a81d" class="mm lc iq la b gy mn mo l mp mq">ssh username:password@remote_server_ip "<!-- -->jupyter notebook stop 8889"</span></pre><p id="2d16" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">不幸的是，<a class="ae kw" href="https://github.com/jupyter/notebook/issues/2844#issuecomment-371220536" rel="noopener ugc nofollow" target="_blank">这个命令目前正在被调试</a>，但是我已经把它包含在这里，希望它在将来能够工作。但是，作为一种变通方法，您可以使用以下命令终止<code class="fe kx ky kz la b">jupyter</code>进程:</p><pre class="me mf mg mh gt mi la mj mk aw ml bi"><span id="0d7a" class="mm lc iq la b gy mn mo l mp mq">ssh username:password@remote_server_ip "pkill -u username jupyter<!-- -->"</span></pre><p id="96eb" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">其中<code class="fe kx ky kz la b">-u username</code>表示只有由<code class="fe kx ky kz la b">username</code>启动的<code class="fe kx ky kz la b">jupyter</code>进程应该被终止。这样做的缺点是，如果您同时运行多个笔记本服务器，您将关闭所有的笔记本服务器。最后，您当然可以通过登录到远程服务器、启动笔记本服务器并保持终端窗口打开来手动管理服务器。这允许您使用常用的<code class="fe kx ky kz la b">CTRL+C</code>键盘命令关闭笔记本服务器。</p><h1 id="11e8" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">简化您的工作流程</h1><p id="a134" class="pw-post-body-paragraph jy jz iq ka b kb lz kd ke kf ma kh ki kj mb kl km kn mc kp kq kr md kt ku kv ij bi translated">记住所有这些命令可能相当麻烦。幸运的是，我们可以通过为每个命令创建 bash 别名来简化工作。将下面几行添加到您的<code class="fe kx ky kz la b">~/.bashrc</code>文件中:</p><figure class="me mf mg mh gt jr"><div class="bz fp l di"><div class="nh ni l"/></div></figure><p id="8c6f" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">通过在终端中键入<code class="fe kx ky kz la b">source .bashrc</code>来加载命令。现在，您可以在终端中使用命令<code class="fe kx ky kz la b">remote_notebook_start</code>和<code class="fe kx ky kz la b">remote_notebook_stop</code>分别启动远程笔记本服务器(并设置端口转发)和关闭它。</p><h1 id="940a" class="lb lc iq bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">总结</h1><p id="37f9" class="pw-post-body-paragraph jy jz iq ka b kb lz kd ke kf ma kh ki kj mb kl km kn mc kp kq kr md kt ku kv ij bi translated">在这篇文章中，我向您展示了如何使用 bash 命令在远程服务器上启动、访问和停止 Jupyter 笔记本，并展示了如何创建 bash 别名来简化这些操作。</p><p id="41a5" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">我希望这些命令可以提高您的数据科学生产力，几乎无缝地允许您获得 Jupyter 笔记本和远程服务器上可用的任何计算资源的好处。</p></div><div class="ab cl nj nk hu nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="ij ik il im in"><p id="f125" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="nq">喜欢你读的书吗？考虑在</em><a class="ae kw" href="https://twitter.com/TobiasSJepsen" rel="noopener ugc nofollow" target="_blank"><em class="nq">Twitter</em></a><em class="nq">上关注我，在那里，除了我自己的帖子之外，我还分享与数据科学和机器学习的实践、理论和伦理相关的论文、视频和文章。</em></p><p id="524c" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><em class="nq">如需专业咨询，请在</em><a class="ae kw" href="https://www.linkedin.com/in/tobias-skovgaard-jepsen/" rel="noopener ugc nofollow" target="_blank"><em class="nq">LinkedIn</em></a><em class="nq">上联系我，或在</em><a class="ae kw" href="https://twitter.com/TobiasSJepsen" rel="noopener ugc nofollow" target="_blank"><em class="nq">Twitter</em></a><em class="nq">上直接留言。</em></p></div></div>    
</body>
</html>