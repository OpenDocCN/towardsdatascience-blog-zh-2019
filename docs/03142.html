<html>
<head>
<title>Parsing Structured Documents with Custom Entity Extraction</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用自定义实体提取解析结构化文档</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/custom-entity-extraction-e966e00f6f47?source=collection_archive---------3-----------------------#2019-05-20">https://towardsdatascience.com/custom-entity-extraction-e966e00f6f47?source=collection_archive---------3-----------------------#2019-05-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/da54632ba241c3f44e39d7a89190821c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ft2gFJl7YXh-1Nrzscdk2g.jpeg"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Let’s talk about parsing structured documents with entity extraction!</figcaption></figure><div class=""/><p id="4f55" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">网上有很多很棒的教程,解释如何用机器学习对大量文本进行分类。但是，如果不仅仅是<em class="lb">对</em>文本进行分类，而是想要对单个单词进行分类，比如:</p><figure class="ld le lf lg gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi lc"><img src="../Images/c934fdbdb3e5cd68707ec9d345185dcc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UWUmnw8LwihxrS5AXmzRqQ.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">You can’t make me apologize for loving Comic Sans.</figcaption></figure><p id="9be5" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这被称为<a class="ae la" href="https://en.wikipedia.org/wiki/Named-entity_recognition" rel="noopener ugc nofollow" target="_blank">实体提取</a>(或命名实体识别)，它非常有用。例如，您可以使用这种技术来挑选新闻文章中提到的所有人和地点，并将它们用作文章标签(新闻编辑室有时会这样做)。</p><p id="3237" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">实体提取(EE)对于解析结构化文档也很有用，比如表单、w4、收据、名片和餐馆菜单(这就是我们今天要用的)。</p><p id="5f25" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">对于今年的 Google I/O，我想建立一个应用程序，它可以拍摄餐厅菜单的照片并自动解析它——提取所有的食物、它们的价格等等。(你可以在这里看到我在舞台<a class="ae la" href="https://www.youtube.com/watch?v=OxJ-zBjVhIM&amp;t=726s" rel="noopener ugc nofollow" target="_blank">上演示。)</a></p><p id="2472" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我希望能够上传一张这样的菜单图片:</p><figure class="ld le lf lg gt is gh gi paragraph-image"><div class="gh gi lh"><img src="../Images/5d6fc96c703332d6cc0343b7e10b86b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:480/format:webp/1*m_JHj66IaF_IFYHj99VxEg.png"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Step one: upload a photo of a menu</figcaption></figure><p id="4b31" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">然后使用机器学习从菜单中神奇地提取实体，如餐厅的地址、电话号码、所有的食物标题(“沙拉”、“主菜”)、所有的食物、它们的价格和它们的描述(即“在椒盐卷饼上”)。</p><p id="0c65" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这个想法是，如果你是一家想要在像 Seamless 或 Grubhub 这样的应用程序上上市的餐馆，你可以输入你的菜单，而不必手动输入整个菜单。</p><figure class="ld le lf lg gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi li"><img src="../Images/220865a1ae9e59fe4f58b8f93f2f6500.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uU12jBCu7c6BMLAbdQ0lPw.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Step two: identify all the foods, plus the food headings (“Salads,” “Mains”) and their descriptions (“On a pretzel bun”).</figcaption></figure><p id="3695" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">那么它是如何工作的呢？</p><p id="a118" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">首先，我使用<a class="ae la" href="https://cloud.google.com/vision/#benefits" rel="noopener ugc nofollow" target="_blank"> Google Cloud Vision API </a>的文本检测功能将我的菜单图片转换成原始文本。</p><p id="fab9" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">一旦我有了文本格式的菜单，我就使用实体提取来解析它。我用两种技术做到了这一点:</p><ol class=""><li id="2469" class="lj lk jf ke b kf kg kj kk kn ll kr lm kv ln kz lo lp lq lr bi translated">我使用<a class="ae la" href="https://cloud.google.com/natural-language/" rel="noopener ugc nofollow" target="_blank"> Google Cloud 自然语言 API </a>提取了餐馆的地址、电话号码和所有列出的价格。</li><li id="e63c" class="lj lk jf ke b kf ls kj lt kn lu kr lv kv lw kz lo lp lq lr bi translated">为了识别食物项目、标题和食物描述，我必须建立一个定制的机器学习模型(稍后会详细介绍)。</li></ol><p id="7052" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">自然语言 API 能够自动检测常见的实体。例如，如果我向它发送字符串:</p><blockquote class="lx ly lz"><p id="42be" class="kc kd lb ke b kf kg kh ki kj kk kl km ma ko kp kq mb ks kt ku mc kw kx ky kz ij bi translated">戴尔想从加利福尼亚州山景城 ampi theatre Pkwy 1600 号的咖啡店购买一个 3.50 美元的羊角面包，该咖啡店的电话号码是(650)253–0000。</p></blockquote><figure class="ld le lf lg gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi md"><img src="../Images/0f577c12388db528cf1bd1aa5fad8525.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*grNL3a3mujCUIk1qnMAfSA.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">The NL API recognizes entities like people, consumer goods, addresses, price, phone numbers, and more.</figcaption></figure><p id="4e7c" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">接下来，我添加了一张餐馆照片、星级评定和一张地图，让我的应用程序变得更加时尚。这些信息都没有直接印在菜单上，但餐馆的电话号码是。使用这个电话号码，我可以查询<a class="ae la" href="https://developers.google.com/places/web-service/search" rel="noopener ugc nofollow" target="_blank"> Google Places API </a>来获取照片、星级等。</p><figure class="ld le lf lg gt is gh gi paragraph-image"><div class="gh gi me"><img src="../Images/dd98f0a1bfee07e3ad56dc6ec0b7d748.png" data-original-src="https://miro.medium.com/v2/resize:fit:576/format:webp/1*IvuXVs5oaXcCjeQBjjrAIQ.png"/></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">The restaurant’s star rating, photo, and GPS location come from the Places API.</figcaption></figure><h1 id="ddcc" class="mf mg jf bd mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc bi translated">构建自定义实体提取模型</h1><p id="9fa9" class="pw-post-body-paragraph kc kd jf ke b kf nd kh ki kj ne kl km kn nf kp kq kr ng kt ku kv nh kx ky kz ij bi translated">好的，但是现在是困难的(也是最关键的)部分:我们如何提取菜单上的所有食物？我们如何区分什么是食物(“素食汉堡”)，什么是食物标题(“主菜”)，什么是食物描述(“在椒盐卷饼上”)？</p><p id="3a64" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这些<em class="lb">实体</em>完全是<strong class="ke jg">特定领域的</strong>。在我们的例子中，我们希望认识到“主菜”是一个食物标题。但是如果我们转而解析报纸，我们可能想要识别标题和文章正文之间的区别。或者，如果我们在分析简历，我们会想确定“高级软件工程师”是一个职位，而“Python”是一种编程语言。</p><p id="c268" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">虽然我之前提到的自然语言 API 可以识别电话号码和地址等等，但是它没有经过训练来识别这些特定于领域的实体。</p><p id="1d3a" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">为此，我们必须构建一个定制的实体提取模型。有很多方法可以做到这一点，但是我将向你展示一个我认为最简单的方法(代码最少)，使用 Google AutoML 自然语言。我们将使用它来训练自定义实体提取模型。</p><p id="3bce" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">它是这样工作的:</p><ol class=""><li id="93f2" class="lj lk jf ke b kf kg kj kk kn ll kr lm kv ln kz lo lp lq lr bi translated">上传带标签的菜单数据集</li><li id="3578" class="lj lk jf ke b kf ls kj lt kn lu kr lv kv lw kz lo lp lq lr bi translated">训练模特</li><li id="f5e7" class="lj lk jf ke b kf ls kj lt kn lu kr lv kv lw kz lo lp lq lr bi translated">使用您的模型通过 REST API 识别定制实体</li></ol><h1 id="66f6" class="mf mg jf bd mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc bi translated">标签数据</h1><p id="6b28" class="pw-post-body-paragraph kc kd jf ke b kf nd kh ki kj ne kl km kn nf kp kq kr ng kt ku kv nh kx ky kz ij bi translated">但是在哪里可以找到一个标签菜单的数据集呢？</p><p id="2bd6" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">方便的是，我找到了<a class="ae la" href="http://menus.nypl.org/" rel="noopener ugc nofollow" target="_blank">这个由</a>托管的菜单扫描的数据集(并贴上了标签！)由纽约公共图书馆提供。太棒了。</p><p id="3576" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">首先，我再次使用 Vision API 将数据集中的所有菜单转换为文本。</p><p id="28c3" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">为了训练一个定制的实体提取模型，我必须将我的数据及其标签转换成 jsonl 格式(<a class="ae la" href="https://cloud.google.com/natural-language/automl/entity-analysis/docs/prepare" rel="noopener ugc nofollow" target="_blank">AutoML 期望的格式</a>)。看起来是这样的:</p><figure class="ld le lf lg gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ni"><img src="../Images/f36d9027baf580a9ac3535d58570a94b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lV3T1BFiovJFVGXSoKXP8A.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">jsonl file format</figcaption></figure><p id="1ac0" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我要诚实地警告你，实际上给这些菜单贴标签是一件痛苦的事情。我使用一些粗糙的 Python 脚本将数据集的标签与 OCR 提取的菜单文本配对，但它们经常不对齐。我不得不进入 AutoML 用户界面，手工标记这些菜单，就像这样:</p><figure class="ld le lf lg gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nj"><img src="../Images/8ff3325cb4f34a8f94ef41012523c0da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Djx3WkASNhBBfmjSjem2cg.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Hand-labeling menus using the AutoML editor.</figcaption></figure><p id="4169" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">回想起来，我可能应该使用一个<a class="ae la" href="https://cloud.google.com/vision/automl/docs/human-labeling" rel="noopener ugc nofollow" target="_blank">数据标签服务</a>，这样我就不必浪费时间给自己(或者实习生，也许？).</p><p id="68f1" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我还抓取了维基百科的<a class="ae la" href="https://en.wikipedia.org/wiki/List_of_Italian_dishes" rel="noopener ugc nofollow" target="_blank">美食页面</a>，生成了一些假菜单来帮助扩充我的数据集。</p><h1 id="0c7e" class="mf mg jf bd mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc bi translated">训练模型</h1><p id="ae1b" class="pw-post-body-paragraph kc kd jf ke b kf nd kh ki kj ne kl km kn nf kp kq kr ng kt ku kv nh kx ky kz ij bi translated">使用 Google AutoML，构建模型最困难的部分是构建带标签的数据集。实际上<em class="lb">训练</em>一个有这些数据的模型非常简单——只要跳到“训练”标签，然后点击“开始训练”建立一个定制模型大约需要 4 个小时。</p><figure class="ld le lf lg gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nk"><img src="../Images/48ca271b8c0476faab0b67e09fe2f683.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dBXA5hQd_kWB9uA88pHkEA.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">Behind the scenes, Google trains a neural network to extract your custom entities.</figcaption></figure><h1 id="48f6" class="mf mg jf bd mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc bi translated">做预测</h1><p id="0deb" class="pw-post-body-paragraph kc kd jf ke b kf nd kh ki kj ne kl km kn nf kp kq kr ng kt ku kv nh kx ky kz ij bi translated">当我们的实体提取模型完成训练后，我们可以在 AutoML UI 中测试它:</p><figure class="ld le lf lg gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nl"><img src="../Images/1f05c1d2de1d0c864162c0fefaf55131.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GEhYh3uYZ2dEYQT_gLyZrw.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk">The model tagged most of the entities, but missed “Potato Chips” and “Fish and Chips.”</figcaption></figure><p id="77d7" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如你所见，它并不完美。</p><p id="668e" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">但是你想要什么？！那就是机器学习。不是<em class="lb">完美</em>。</p><p id="66fe" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">也就是说，考虑到我的数据集很小(不到 150 个菜单)，这还不错。我也没有考虑到文本的大小或它在页面上的位置(标题通常比菜名大，菜名比它们的描述大)。</p><p id="74f5" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">但是，如果我是一家餐馆，我可以使用这个工具来导入我的菜单，而不是手动输入每一种食物，我会节省很多时间(尽管我可能需要做一些编辑)。此外，越多假设的餐厅使用我的应用程序，我就能获得越多假设的数据点来改进我的模型。</p><p id="0183" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">与此同时，谷歌咖啡馆的午餐来电。再见。</p><p id="6785" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">P.S .如果训练自己的实体提取模型，在评论里说说或者<a class="ae la" href="https://twitter.com/dalequark" rel="noopener ugc nofollow" target="_blank"> @dalequark </a>。</p><p id="a3c3" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">快乐造型！</p></div><div class="ab cl nm nn hu no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="ij ik il im in"><p id="ae19" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">想要更多这样的故事吗？更多阅读请点击<a class="ae la" href="https://daleonai.com" rel="noopener ugc nofollow" target="_blank"><em class="lb"/></a><em class="lb">。</em></p></div></div>    
</body>
</html>