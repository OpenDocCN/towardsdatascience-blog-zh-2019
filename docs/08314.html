<html>
<head>
<title>Time Series Forecasting For Road Accidents in UK</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">英国道路交通事故的时间序列预测</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/time-series-forecasting-for-road-accidents-in-uk-f940e5970988?source=collection_archive---------28-----------------------#2019-11-12">https://towardsdatascience.com/time-series-forecasting-for-road-accidents-in-uk-f940e5970988?source=collection_archive---------28-----------------------#2019-11-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="d0a3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这篇文章中，我们旨在预测英国未来的交通事故数量。使用的数据来自交通部(GB) [1]。该数据提供了 2014 年至 2017 年英国人身伤害道路事故情况的详细道路安全信息。我们将使用 ARIMA 和 Prophet 实现时间序列预测，以找出未来道路交通事故的数量。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/29188702191c41afd137c94a09a86d51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*vnTQnnrPZvi2U0tg"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk">Photo by <a class="ae lb" href="https://unsplash.com/@srd844?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Stephen Dawson</a> on <a class="ae lb" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h2 id="33b6" class="lc ld iq bd le lf lg dn lh li lj dp lk jy ll lm ln kc lo lp lq kg lr ls lt lu bi translated">什么是时间序列？</h2><p id="e875" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">时间序列是变量在不同时间取值的一组观察值。例如销售趋势、股票市场价格、天气预报等。时间序列是用来根据以前的观察值预测未来值的。</p><h2 id="f794" class="lc ld iq bd le lf lg dn lh li lj dp lk jy ll lm ln kc lo lp lq kg lr ls lt lu bi translated">时间序列的成分</h2><ul class=""><li id="2769" class="ma mb iq jp b jq lv ju lw jy mc kc md kg me kk mf mg mh mi bi translated">趋势:趋势可以显示一个时间序列在很长一段时间内的增长或下降。这种趋势将持续很长一段时间。例如，价格和进出口数据反映出明显的增长趋势。</li><li id="706d" class="ma mb iq jp b jq mj ju mk jy ml kc mm kg mn kk mf mg mh mi bi translated">季节性:这些是由于季节性因素而在数据中出现的短期变动。短期通常被认为是随着天气或节日的变化，时间序列发生变化的时期</li><li id="24ed" class="ma mb iq jp b jq mj ju mk jy ml kc mm kg mn kk mf mg mh mi bi translated">不规则性:这些是在时间序列中发生的不太可能重复的突然变化。它们是时间序列的组成部分，无法用趋势、季节或周期运动来解释。这些变化有时被称为残差或随机分量。</li><li id="437c" class="ma mb iq jp b jq mj ju mk jy ml kc mm kg mn kk mf mg mh mi bi translated">周期性的:这些是发生在时间序列中的长期振荡。这些振荡大多在经济数据中观察到，并且这种振荡的周期通常从五年延长到十二年或更长。这些波动与众所周知的商业周期有关。[2]</li></ul></div><div class="ab cl mo mp hu mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="ij ik il im in"><h2 id="1255" class="lc ld iq bd le lf lg dn lh li lj dp lk jy ll lm ln kc lo lp lq kg lr ls lt lu bi translated">什么是 ARIMA 模式？</h2><p id="edf7" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">ARIMA 代表自回归综合移动平均线。有季节性和非季节性 ARIMA 模型可用于预测。ARIMA 模型的特征在于 3 项:p，d，q，其中 p 是 AR 项的阶，q 是 MA 项的阶，d 是使时间序列稳定所需的差的数量。如果一个时间序列有季节模式，那么你需要添加季节项，它就变成了萨里玛，是“季节性 ARIMA”的缩写。等我们结束 ARIMA 后会有更多的报道。[3]</p><p id="dcb2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们用所需的库准备好我们的环境，然后导入数据！</p><pre class="km kn ko kp gt mv mw mx my aw mz bi"><span id="2741" class="lc ld iq mw b gy na nb l nc nd">import numpy as np<br/>import pandas as pd<br/>import matplotlib.pyplot as plt<br/>import seaborn as sns<br/>%matplotlib inline<br/>import matplotlib<br/>plt.style.use('ggplot')<br/>import warnings<br/>import itertools<br/>matplotlib.rcParams['axes.labelsize'] = 14<br/>matplotlib.rcParams['xtick.labelsize'] = 12<br/>matplotlib.rcParams['ytick.labelsize'] = 12<br/>matplotlib.rcParams['text.color'] = 'k'</span></pre><p id="2b66" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">检查数据</p><pre class="km kn ko kp gt mv mw mx my aw mz bi"><span id="d52f" class="lc ld iq mw b gy na nb l nc nd">df = pd.read_csv('~/accident_UK.csv')<br/>df.head()</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/e535b647b30364ff0cdac712aa0a3196.png" data-original-src="https://miro.medium.com/v2/resize:fit:408/format:webp/1*YYNZd3SsUmIBuG2OO0JtXQ.png"/></div></figure><pre class="km kn ko kp gt mv mw mx my aw mz bi"><span id="a396" class="lc ld iq mw b gy na nb l nc nd">df.info()</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/eef617372767efe97bae844be7edf553.png" data-original-src="https://miro.medium.com/v2/resize:fit:784/format:webp/1*uMEkNSISPDOPJUmgCHEv2A.png"/></div></figure><p id="2d30" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将日期列转换为日期类型</p><pre class="km kn ko kp gt mv mw mx my aw mz bi"><span id="e33c" class="lc ld iq mw b gy na nb l nc nd">df['Date'] = pd.to_datetime(df['Date'])<br/>df.head()</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/a649ffb14ffeb9a93de6c48903c0a747.png" data-original-src="https://miro.medium.com/v2/resize:fit:396/format:webp/1*EGH3D8NvR2mY9OY0xzWuwQ.png"/></div></figure><p id="3230" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">按日期对数据进行排序</p><pre class="km kn ko kp gt mv mw mx my aw mz bi"><span id="88ab" class="lc ld iq mw b gy na nb l nc nd">df = df.sort_values(by=['Date'])<br/>df.head()</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/ed0ee8cd57a61b619892075680241113.png" data-original-src="https://miro.medium.com/v2/resize:fit:418/format:webp/1*8LrhuF2aiBnHcMBkJplvGw.png"/></div></figure><p id="805d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">设置索引的日期</p><pre class="km kn ko kp gt mv mw mx my aw mz bi"><span id="dd18" class="lc ld iq mw b gy na nb l nc nd">accident = df.set_index('Date')<br/>accident.index</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/f0fbdf13f0543df099156fd98ea20a79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1266/format:webp/1*oiTsGqS-1QU9fVUOKt5Jow.png"/></div></figure><p id="4d3c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们来提取一下每个月的平均事故次数。</p><pre class="km kn ko kp gt mv mw mx my aw mz bi"><span id="45e6" class="lc ld iq mw b gy na nb l nc nd">y = accident['Total_Accident'].resample('MS').mean()<br/>y.head()</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nj"><img src="../Images/7c77a3c810896102b36ec9d2813d9643.png" data-original-src="https://miro.medium.com/v2/resize:fit:814/format:webp/1*gkQB5Hkn4Q0gvbS-LSFIXQ.png"/></div></div></figure><p id="c68a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们看一下每个月平均事故的数量。</p><pre class="km kn ko kp gt mv mw mx my aw mz bi"><span id="cc78" class="lc ld iq mw b gy na nb l nc nd">y.plot(figsize=(15, 6))<br/>plt.show()</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nk"><img src="../Images/fdb8939770cfcaacb604d377f1e7eafa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3WJSImhxaTmYM9OWYeqtiA.png"/></div></div></figure><p id="24d1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们使用时间序列分解来可视化数据，这允许我们将时间序列分解为三个不同的部分:趋势、季节性和噪声。</p><pre class="km kn ko kp gt mv mw mx my aw mz bi"><span id="2b3a" class="lc ld iq mw b gy na nb l nc nd">from pylab import rcParams<br/>import statsmodels.api as sm<br/>rcParams['figure.figsize'] = 16, 10<br/>decomposition = sm.tsa.seasonal_decompose(y, model='additive')<br/>fig = decomposition.plot()<br/>plt.show()</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nl"><img src="../Images/ecda23a9f8cc89489cf771425606c40d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SOkKE0_waXdrT1L_3qcWWQ.png"/></div></div></figure><p id="a66e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">季节性 ARIMA 的参数组合示例</p><pre class="km kn ko kp gt mv mw mx my aw mz bi"><span id="5684" class="lc ld iq mw b gy na nb l nc nd">p = d = q = range(0, 2)<br/>pdq = list(itertools.product(p, d, q))<br/>seasonal_pdq = [(x[0], x[1], x[2], 12) for x in list(itertools.product(p, d, q))]<br/>print('Examples of parameter combinations for Seasonal ARIMA...')<br/>print('SARIMAX: {} x {}'.format(pdq[1], seasonal_pdq[1]))<br/>print('SARIMAX: {} x {}'.format(pdq[1], seasonal_pdq[2]))<br/>print('SARIMAX: {} x {}'.format(pdq[2], seasonal_pdq[3]))<br/>print('SARIMAX: {} x {}'.format(pdq[2], seasonal_pdq[4]))</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/302042809cee8ee984e632b617bd30c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*2YoJz1ul8BA7VXmtp240Ng.png"/></div></figure><p id="bcbb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这一步是为我们的 ARIMA 时间序列模型选择参数。我们在这里的目标是使用“网格搜索”来找到为我们的模型产生最佳性能的最佳参数集。</p><pre class="km kn ko kp gt mv mw mx my aw mz bi"><span id="293a" class="lc ld iq mw b gy na nb l nc nd">for param in pdq:<br/>    for param_seasonal in seasonal_pdq:<br/>        try:<br/>            mod = sm.tsa.statespace.SARIMAX(y,<br/>                                            order=param,<br/>                                            seasonal_order=param_seasonal,<br/>                                            enforce_stationarity=False,<br/>                                            enforce_invertibility=False)<br/><br/>            results = mod.fit()<br/>            <br/>            print('ARIMA{}x{}12 - AIC:{}'.format(param, param_seasonal, results.aic))<br/>        except:<br/>            continue</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/38420f4ba855f11810893e80d837f150.png" data-original-src="https://miro.medium.com/v2/resize:fit:968/format:webp/1*xMdS1hR1UpjoDy5FmC07CA.png"/></div></figure><p id="298c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">上述输出表明，SARIMAX (1，1，1)x(1，1，0，12)产生的 AIC 值最低，为 186.26。因此，我们应该认为这是一个最佳选择。</p><h2 id="f6fc" class="lc ld iq bd le lf lg dn lh li lj dp lk jy ll lm ln kc lo lp lq kg lr ls lt lu bi translated">拟合 ARIMA 模型</h2><pre class="km kn ko kp gt mv mw mx my aw mz bi"><span id="e0d7" class="lc ld iq mw b gy na nb l nc nd">mod = sm.tsa.statespace.SARIMAX(y,<br/>                                order=(1, 1, 1),<br/>                                seasonal_order=(1, 1, 0, 12),<br/>                                enforce_stationarity=False,<br/>                                enforce_invertibility=False)<br/>results = mod.fit()<br/>print(results.summary().tables[1])</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi no"><img src="../Images/0f31f6756b429f0a0e3f35e084902f63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1358/format:webp/1*_gDSY35M5p2z-M6C12HqMA.png"/></div></figure><p id="7a34" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们需要始终运行模型诊断来调查任何不寻常的行为。</p><pre class="km kn ko kp gt mv mw mx my aw mz bi"><span id="76de" class="lc ld iq mw b gy na nb l nc nd">results.plot_diagnostics(figsize=(16, 8))<br/>plt.show()</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi np"><img src="../Images/07ae0ff391f9bf4711440bea288bde57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mXjz5oRSdfubYW0GNr1pBw.png"/></div></div></figure><h2 id="801a" class="lc ld iq bd le lf lg dn lh li lj dp lk jy ll lm ln kc lo lp lq kg lr ls lt lu bi translated">预测评估</h2><p id="2316" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">为了了解我们预测的准确性，我们将预测的事故数量与时间序列的实际事故数量进行比较，我们将预测从 2017 年 1 月 1 日开始到数据结束。</p><pre class="km kn ko kp gt mv mw mx my aw mz bi"><span id="10a9" class="lc ld iq mw b gy na nb l nc nd">pred = results.get_prediction(start=pd.to_datetime('2017-01-01'), dynamic=False)<br/>pred_ci = pred.conf_int()<br/>ax = y['2014':].plot(label='observed')<br/>pred.predicted_mean.plot(ax=ax, label='One-step ahead Forecast', alpha=.7, figsize=(14, 7))<br/>ax.fill_between(pred_ci.index,<br/>                pred_ci.iloc[:, 0],<br/>                pred_ci.iloc[:, 1], color='k', alpha=.2)<br/>ax.set_xlabel('Date')<br/>ax.set_ylabel('Furniture Sales')<br/>plt.legend()<br/>plt.show()</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nq"><img src="../Images/2f7328817cae7c1c76a056be6cc76ff4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eKb6GfgSdpLDXYFksoFV8g.png"/></div></div></figure><p id="a5e6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们找出 MSE 来看看我们模型的准确性。均方误差(MSE)主要用作确定算法性能的度量。此外，MSE 是一个变量的观察值和预测值之差的平方的平均值。</p><pre class="km kn ko kp gt mv mw mx my aw mz bi"><span id="27e4" class="lc ld iq mw b gy na nb l nc nd">y_forecasted = pred.predicted_mean<br/>y_truth = y['2017-01-01':]<br/>mse = ((y_forecasted - y_truth) ** 2).mean()<br/>print('The Mean Squared Error of our forecasts is {}'.format(round(mse, 2)))</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/5e0ee5bce3901379214d62182c034789.png" data-original-src="https://miro.medium.com/v2/resize:fit:836/format:webp/1*nj9t-VqGcNfRoZOrpV2rZg.png"/></div></figure><h2 id="a186" class="lc ld iq bd le lf lg dn lh li lj dp lk jy ll lm ln kc lo lp lq kg lr ls lt lu bi translated">可视化预测</h2><p id="aa5a" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">正如我们在下面的图表中所看到的，英国的交通事故数量在未来几年将会下降。</p><pre class="km kn ko kp gt mv mw mx my aw mz bi"><span id="84d9" class="lc ld iq mw b gy na nb l nc nd">pred_uc = results.get_forecast(steps=100)<br/>pred_ci = pred_uc.conf_int()<br/>ax = y.plot(label='observed', figsize=(14, 7))<br/>pred_uc.predicted_mean.plot(ax=ax, label='Forecast')<br/>ax.fill_between(pred_ci.index,<br/>                pred_ci.iloc[:, 0],<br/>                pred_ci.iloc[:, 1], color='k', alpha=.25)<br/>ax.set_xlabel('Date')<br/>ax.set_ylabel('Furniture Sales')<br/>plt.legend()<br/>plt.show()</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nq"><img src="../Images/fc54d6ea2047ce6d8aa5318890bf5e72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9d7nz5fsqgx9QORmBZMDlA.png"/></div></div></figure></div><div class="ab cl mo mp hu mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="ij ik il im in"><h2 id="e00c" class="lc ld iq bd le lf lg dn lh li lj dp lk jy ll lm ln kc lo lp lq kg lr ls lt lu bi translated">什么是先知模型？</h2><p id="b40b" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">Prophet 是一个来自脸书的开源时间序列预测算法，它的设计是为了在没有时间序列预测或统计方面的专家知识的情况下易于使用。时间序列预测通过寻找最佳平滑线来建立模型，该最佳平滑线可以表示为以下分量的总和:</p><ul class=""><li id="2b9b" class="ma mb iq jp b jq jr ju jv jy ns kc nt kg nu kk mf mg mh mi bi translated">总体增长趋势</li><li id="2ab5" class="ma mb iq jp b jq mj ju mk jy ml kc mm kg mn kk mf mg mh mi bi translated">早期季节性</li><li id="8301" class="ma mb iq jp b jq mj ju mk jy ml kc mm kg mn kk mf mg mh mi bi translated">每周季节性</li><li id="fa20" class="ma mb iq jp b jq mj ju mk jy ml kc mm kg mn kk mf mg mh mi bi translated">节日影响</li></ul><p id="c740" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">先知方法的好处:</p><ul class=""><li id="53b9" class="ma mb iq jp b jq jr ju jv jy ns kc nt kg nu kk mf mg mh mi bi translated">数据之间不均匀的时间间隔不是问题</li><li id="de59" class="ma mb iq jp b jq mj ju mk jy ml kc mm kg mn kk mf mg mh mi bi translated">天娜不是问题</li><li id="ac0a" class="ma mb iq jp b jq mj ju mk jy ml kc mm kg mn kk mf mg mh mi bi translated">默认情况下，会处理多个期间(周和年)的季节性</li><li id="0aeb" class="ma mb iq jp b jq mj ju mk jy ml kc mm kg mn kk mf mg mh mi bi translated">默认设置下工作良好，参数易于解释</li></ul><p id="2ebb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们按日期对值进行排序</p><pre class="km kn ko kp gt mv mw mx my aw mz bi"><span id="6e5f" class="lc ld iq mw b gy na nb l nc nd">df = df.sort_values(by=['Date'])<br/>df.head()</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/7974ac79587074d7a1e74dbdacc07120.png" data-original-src="https://miro.medium.com/v2/resize:fit:440/format:webp/1*i0lliv0Iiw_mF0hnDd9uPw.png"/></div></figure><p id="d471" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Prophet 要求时间序列中的变量名为:</p><ul class=""><li id="4fab" class="ma mb iq jp b jq jr ju jv jy ns kc nt kg nu kk mf mg mh mi bi translated">y-目标</li><li id="1f99" class="ma mb iq jp b jq mj ju mk jy ml kc mm kg mn kk mf mg mh mi bi translated">ds —日期时间</li></ul><p id="7329" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，下一步是根据上述规范转换数据帧</p><pre class="km kn ko kp gt mv mw mx my aw mz bi"><span id="1878" class="lc ld iq mw b gy na nb l nc nd">df = df.rename(columns={'Date': 'ds',<br/>                        'Total_Accident': 'y'})<br/>df.head()</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/c4e20897a10dd56623532c79c0a7c394.png" data-original-src="https://miro.medium.com/v2/resize:fit:318/format:webp/1*HItzrokRhhSnT_uEj3X2FA.png"/></div></figure><p id="a32b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们想象一下每天的交通事故数量</p><pre class="km kn ko kp gt mv mw mx my aw mz bi"><span id="218d" class="lc ld iq mw b gy na nb l nc nd">ax = df.set_index('ds').plot(figsize=(15, 8))<br/>ax.set_ylabel('Total Accident')<br/>ax.set_xlabel('Date')<br/><br/>plt.show()</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nx"><img src="../Images/0a7c4ff2377f0bbbf45c95c36b6d7727.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tJqgv9BmdQ0TqkOMJ82aUg.png"/></div></div></figure><h2 id="3b0b" class="lc ld iq bd le lf lg dn lh li lj dp lk jy ll lm ln kc lo lp lq kg lr ls lt lu bi translated">拟合先知模型</h2><p id="96c8" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">将不确定性区间设置为 95%(Prophet 默认为 80%)</p><pre class="km kn ko kp gt mv mw mx my aw mz bi"><span id="1d75" class="lc ld iq mw b gy na nb l nc nd">from fbprophet import Prophet<br/>my_model = Prophet(interval_width=0.95)<br/>my_model.fit(df)</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/cd29be07f215bc8dc0c973ec41674431.png" data-original-src="https://miro.medium.com/v2/resize:fit:794/format:webp/1*me-iT9r0DJaRI-8yp3MUYg.png"/></div></figure><p id="6d24" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要使用我们的模型创建预测，我们需要创建一些未来日期。Prophet 为我们提供了一个辅助函数，叫做 make_future_dataframe。我们传入未来周期的数量和频率。以上是我们对未来 36 个月或 3 年的预测。</p><pre class="km kn ko kp gt mv mw mx my aw mz bi"><span id="9054" class="lc ld iq mw b gy na nb l nc nd">future_dates = my_model.make_future_dataframe(periods=36, freq='MS')<br/>future_dates.tail()</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/bcd40d3c2b30616058b493442b0f5dc2.png" data-original-src="https://miro.medium.com/v2/resize:fit:236/format:webp/1*aA-V4ZxsKbvco31Zmtx1GA.png"/></div></figure><p id="3a96" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">正如我们在下表中看到的，yhat 是我们的预测值。</p><pre class="km kn ko kp gt mv mw mx my aw mz bi"><span id="f138" class="lc ld iq mw b gy na nb l nc nd">forecast = my_model.predict(future_dates)<br/>forecast[['ds', 'yhat', 'yhat_lower', 'yhat_upper']].tail()</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/fc0190c0d90f7581e06ef19805f9b312.png" data-original-src="https://miro.medium.com/v2/resize:fit:720/format:webp/1*TizUbjvjPicmHuBzbk3bMw.png"/></div></figure><p id="3b5c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">让我们创建一个实际值和预测值的图表</p><pre class="km kn ko kp gt mv mw mx my aw mz bi"><span id="ba93" class="lc ld iq mw b gy na nb l nc nd">plt.figure(figsize=(10,8))<br/>my_model.plot(forecast,<br/>              uncertainty=True)</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ob"><img src="../Images/7fabd72e594a264cdf4a09a3634a6ab0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i6VSrdaxPLGHo_dtu9wQwQ.png"/></div></div></figure><p id="5e1f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">plot_components 为我们提供了趋势和季节性的图表</p><pre class="km kn ko kp gt mv mw mx my aw mz bi"><span id="efe0" class="lc ld iq mw b gy na nb l nc nd">my_model.plot_components(forecast)</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/2af5001cdb77d7e3f780f6246bd4090f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1264/format:webp/1*ZOO4q-BGiGiEKWZzwFZoTg.png"/></div></figure><h2 id="18e1" class="lc ld iq bd le lf lg dn lh li lj dp lk jy ll lm ln kc lo lp lq kg lr ls lt lu bi translated">模型评估</h2><pre class="km kn ko kp gt mv mw mx my aw mz bi"><span id="73aa" class="lc ld iq mw b gy na nb l nc nd">from fbprophet.diagnostics import cross_validation<br/>df_cv = cross_validation(my_model, initial='730 days', period='180 days', horizon = '365 days')<br/>df_cv.head()</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi od"><img src="../Images/4d5fb87d9049b0b76fc86e801c3d33bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:884/format:webp/1*QU3-dUKh8kPlrzE5XvY7uw.png"/></div></figure><pre class="km kn ko kp gt mv mw mx my aw mz bi"><span id="4bb7" class="lc ld iq mw b gy na nb l nc nd">from fbprophet.diagnostics import performance_metrics<br/>df_p = performance_metrics(df_cv)<br/>df_p.head()</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/0f0f241b5db80369bfd33c9557b7de80.png" data-original-src="https://miro.medium.com/v2/resize:fit:890/format:webp/1*vhWmKVBJdSxfdO7ACGJHvA.png"/></div></figure></div><div class="ab cl mo mp hu mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="ij ik il im in"><p id="2237" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">非常感谢你阅读我的文章！！！</p><h2 id="cc9f" class="lc ld iq bd le lf lg dn lh li lj dp lk jy ll lm ln kc lo lp lq kg lr ls lt lu bi translated">参考资料:</h2><p id="2b7f" class="pw-post-body-paragraph jn jo iq jp b jq lv js jt ju lw jw jx jy lx ka kb kc ly ke kf kg lz ki kj kk ij bi translated">[1].<a class="ae lb" href="https://data.gov.uk/dataset/cb7ae6f0-4be6-4935-9277-47e5ce24a11f/road-safety-data" rel="noopener ugc nofollow" target="_blank">https://data . gov . uk/dataset/CB 7 AE 6 f 0-4be 6-4935-9277-47 E5 ce 24 a 11 f/road-safety-data</a></p><p id="dd7f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">[2].克利夫兰，R. B .，克利夫兰，W. S .，麦克雷，J. E .，&amp;特彭宁，国际法院(1990)。STL:基于黄土的季节趋势分解过程。<em class="of">官方统计杂志</em>，<em class="of"> 6 </em> (1)，3–33。</p><p id="1dcd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">[3].Hyndman，R. J .，&amp; Khandakar，Y. (2008 年)。自动时间序列预测:R. <em class="of">统计软件学报</em>，<em class="of"> 27 </em> (1)，1–22 的预测包。</p><p id="b519" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">[4].<a class="ae lb" href="https://www.analyticsvidhya.com/blog/2018/05/generate-accurate-forecasts-facebook-prophet-python-r/" rel="noopener ugc nofollow" target="_blank">https://www . analyticsvidhya . com/blog/2018/05/generate-accurate-forecasts-Facebook-prophet-python-r/</a></p></div></div>    
</body>
</html>