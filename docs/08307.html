<html>
<head>
<title>The Art of Data Visualization — Weather Data Visualization Using Matplotlib and Ggplot2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">数据可视化的艺术——使用 Matplotlib 和 Ggplot2 实现天气数据可视化</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/the-art-of-data-visualization-weather-data-visualization-using-matplotlib-and-ggplot2-4d4b48b5b7c4?source=collection_archive---------21-----------------------#2019-11-12">https://towardsdatascience.com/the-art-of-data-visualization-weather-data-visualization-using-matplotlib-and-ggplot2-4d4b48b5b7c4?source=collection_archive---------21-----------------------#2019-11-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/018d5154ad9fb4571a989ab05480219d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iWFo62svhhuAZfnsxJ4vng.png"/></div></div></figure><p id="fad3" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">数据可视化与其说是<strong class="kd iu">科学</strong>，不如说是一门<strong class="kd iu">艺术</strong>。为了产生良好的可视化效果，您需要将几段代码放在一起，以获得出色的最终结果。本教程演示了如何通过分析天气数据产生良好的数据可视化。</p><p id="b95e" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在第一节的<strong class="kd iu">中，我们使用 matplotlib 包制作了一个可视化。在<strong class="kd iu">第二节</strong>中，我们尝试使用 ggplot2 再现可视化。</strong></p><p id="ab9b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在深入研究数据可视化艺术之前，让我们首先讨论一个好的数据可视化的基本组件。</p><h1 id="9ab6" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">良好的数据可视化的组成部分</h1><p id="5c96" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">一个好的数据可视化由几个组件组成，这些组件必须组合在一起才能产生最终产品:</p><p id="6073" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">a) <strong class="kd iu">数据组件</strong>:决定如何可视化数据的第一个重要步骤是了解数据的类型，例如分类数据、离散数据、连续数据、时间序列数据等。</p><p id="2361" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">b) <strong class="kd iu">几何组件:</strong>您可以在这里决定哪种可视化适合您的数据，例如散点图、线形图、条形图、直方图、QQ 图、平滑密度、箱线图、对线图、热图等。</p><p id="ea86" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">c) <strong class="kd iu">映射组件:</strong>这里你需要决定用什么变量作为你的 x 变量，用什么变量作为你的 y 变量。这一点非常重要，尤其是当数据集是包含多个要素的多维数据集时。</p><p id="68e2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">d) <strong class="kd iu">秤组件:</strong>在这里您可以决定使用哪种秤，例如线性秤、对数秤等。</p><p id="3493" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">e) <strong class="kd iu">标签组件:</strong>这包括轴标签、标题、图例、使用的字体大小等。</p><p id="22db" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">伦理成分:在这里，你要确保你的视觉化图像讲述的是真实的故事。在清理、总结、操作和制作数据可视化时，你需要意识到你的行为，并确保你没有利用你的可视化来误导或操纵你的观众。</p><p id="3c0a" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">本文将比较<strong class="kd iu"> Python 的 Matplotlib </strong>和<strong class="kd iu"> R 的 ggplot2 </strong>包在分析和可视化天气数据方面的优势。</p><p id="7a64" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">该代码将执行以下数据可视化任务:</p><ol class=""><li id="a61c" class="mc md it kd b ke kf ki kj km me kq mf ku mg ky mh mi mj mk bi translated">它返回了 2005 年至 2014 年期间一年中每天的最高纪录和最低纪录的折线图。一年中每一天的最高温度和最低温度之间的区域用阴影表示。</li><li id="503c" class="mc md it kd b ke ml ki mm km mn kq mo ku mp ky mh mi mj mk bi translated">覆盖 2015 年打破十年记录(2005-2014 年)最高或最低记录的任何点(最高和最低)的 2015 年数据散点。</li></ol><p id="3f64" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">数据集</strong>:本项目使用的 NOAA 数据集存储在文件<a class="ae mq" href="https://github.com/bot13956/weather_pattern/blob/master/weather_data.csv" rel="noopener ugc nofollow" target="_blank"> weather_data.csv </a>中。这些数据来自国家环境信息中心(NCEI)每日全球历史气候网络(GHCN-Daily)的一个子集。GHCN-Daily 由来自全球数千个地面站的每日气候记录组成。这些数据是从美国密歇根州安阿伯市<strong class="kd iu">附近的数据站</strong>收集的。</p><p id="d9d7" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">本文的完整代码可以从这个资源库下载:<a class="ae mq" href="https://github.com/bot13956/weather_pattern" rel="noopener ugc nofollow" target="_blank"><strong class="kd iu">https://github.com/bot13956/weather_pattern</strong></a>。</p><h1 id="b776" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">I .使用 Python 的 Matplotlib 包进行气象数据分析和可视化</h1><h1 id="b93b" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">1.导入必要的库和数据集</h1><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="de97" class="na la it mw b gy nb nc l nd ne"><strong class="mw iu">import</strong> <strong class="mw iu">matplotlib.pyplot</strong> <strong class="mw iu">as</strong> <strong class="mw iu">plt</strong><br/><strong class="mw iu">import</strong> <strong class="mw iu">pandas</strong> <strong class="mw iu">as</strong> <strong class="mw iu">pd</strong><br/><strong class="mw iu">import</strong> <strong class="mw iu">numpy</strong> <strong class="mw iu">as</strong> <strong class="mw iu">np</strong><br/>df=pd.read_csv('weather_data.csv')<br/>df.head()</span></pre><h1 id="6c33" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">2.数据准备和分析</h1><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="a0b0" class="na la it mw b gy nb nc l nd ne">#convert temperature from tenths of degree C to degree C<br/>df['Data_Value']=0.1*df.Data_Value</span><span id="fb57" class="na la it mw b gy nf nc l nd ne">days=list(map(<strong class="mw iu">lambda</strong> x: x.split('-')[-2]+'-'+x.split('-')[-1], df.Date))</span><span id="272a" class="na la it mw b gy nf nc l nd ne">years=list(map(<strong class="mw iu">lambda</strong> x: x.split('-')[0], df.Date))</span><span id="0a26" class="na la it mw b gy nf nc l nd ne">df['Days']=days <br/>df['Years']=years</span><span id="59b6" class="na la it mw b gy nf nc l nd ne">df_2005_to_2014=df[(df.Days!='02-29')&amp;(df.Years!='2015')]<br/>df_2015=df[(df.Days!='02-29')&amp;(df.Years=='2015')]</span><span id="d259" class="na la it mw b gy nf nc l nd ne">df_max=df_2005_to_2014.groupby(['Element','Days']).max()<br/>df_min = df_2005_to_2014.groupby(['Element','Days']).min()<br/>df_2015_max=df_2015.groupby(['Element','Days']).max()<br/>df_2015_min = df_2015.groupby(['Element','Days']).min()</span><span id="a670" class="na la it mw b gy nf nc l nd ne"><br/>record_max=df_max.loc['TMAX'].Data_Value<br/>record_min=df_min.loc['TMIN'].Data_Value<br/>record_2015_max=df_2015_max.loc['TMAX'].Data_Value<br/>record_2015_min=df_2015_min.loc['TMIN'].Data_Value</span></pre><h1 id="4d74" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">3.生成数据可视化</h1><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="9232" class="na la it mw b gy nb nc l nd ne">plt.figure(figsize=(10,7))</span><span id="34c3" class="na la it mw b gy nf nc l nd ne">plt.plot(np.arange(len(record_max)),record_max, '--k', label="record high")</span><span id="e2ed" class="na la it mw b gy nf nc l nd ne">plt.plot(np.arange(len(record_max)),record_min, '-k',label="record low")</span><span id="e9c9" class="na la it mw b gy nf nc l nd ne">plt.scatter(np.where(record_2015_min &lt; record_min.values),<br/>            record_2015_min[record_2015_min &lt; <br/>            record_min].values,c='b',label='2015 break low')</span><span id="3e13" class="na la it mw b gy nf nc l nd ne">plt.scatter(np.where(record_2015_max &gt; record_max.values),<br/>            record_2015_max[record_2015_max &gt;      <br/>            record_max].values,c='r',label='2015 break high')</span><span id="3885" class="na la it mw b gy nf nc l nd ne">plt.xlabel('month',size=14)</span><span id="655a" class="na la it mw b gy nf nc l nd ne">plt.ylabel('temperature($^\circ C$ )',size=14)</span><span id="6217" class="na la it mw b gy nf nc l nd ne">plt.xticks(np.arange(0,365,31),<br/>          ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug',   <br/>           'Sep','Oct','Nov','Dec'])</span><span id="e9b2" class="na la it mw b gy nf nc l nd ne">ax=plt.gca()</span><span id="30de" class="na la it mw b gy nf nc l nd ne">ax.axis([0,365,-40,40])</span><span id="3849" class="na la it mw b gy nf nc l nd ne">plt.gca().fill_between(np.arange(0,365), <br/>                       record_min, record_max, <br/>                       facecolor='blue', <br/>                       alpha=0.25)</span><span id="fbbb" class="na la it mw b gy nf nc l nd ne">plt.title('Record temperatures for different months between 2005-2014',size=14)</span><span id="f270" class="na la it mw b gy nf nc l nd ne">plt.legend(loc=0)<br/><br/>plt.show()</span></pre><figure class="mr ms mt mu gt ju gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/8dbf5772663b6aa202a4211d61678385.png" data-original-src="https://miro.medium.com/v2/resize:fit:1250/format:webp/0*9BY5ByDUCAH93XoC.png"/></div><figcaption class="nh ni gj gh gi nj nk bd b be z dk"><strong class="bd nl">Weather data visualization using matplotlib.</strong></figcaption></figure><h1 id="f4ba" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">二。使用 R 的 Ggplot2 软件包进行天气数据分析和可视化</h1><p id="e34f" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">我在想，我能不能用 R 的 ggplot2 包制作一个类似的上图？</p><p id="3380" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">因此，我决定进行类似的分析，看看我能与 ggplot2 接近到什么程度。</p><h1 id="c9ed" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">1.导入必要的库和数据集</h1><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="416b" class="na la it mw b gy nb nc l nd ne">library(tidyverse)<br/>library(readr)<br/>df&lt;-read.csv("weather_data.csv")</span></pre><h1 id="8363" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">2.数据准备和分析</h1><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="0ea6" class="na la it mw b gy nb nc l nd ne"><strong class="mw iu">#convert temperature from tenths of degree C to degree C</strong></span><span id="6388" class="na la it mw b gy nf nc l nd ne">df$Data_Value = 0.1*df$Data_Value </span><span id="92ef" class="na la it mw b gy nf nc l nd ne"><strong class="mw iu">#functions to split date </strong></span><span id="e241" class="na la it mw b gy nf nc l nd ne">split_function&lt;-function(x)unlist(strsplit(x,'-'))</span><span id="c0cf" class="na la it mw b gy nf nc l nd ne">year_function&lt;-function(x)split_function(x)[1]<br/>day_function&lt;-function(x)paste(split_function(x[2],<br/>                               split_function(x)[3],sep='-') </span><span id="b13e" class="na la it mw b gy nf nc l nd ne"><strong class="mw iu">#create Day and Year columns</strong> </span><span id="01f6" class="na la it mw b gy nf nc l nd ne">day&lt;-sapply(as.vector(df$Date),day_function)<br/>year&lt;-sapply(as.vector(df$Date),year_function)<br/>df&lt;-df%&gt;%mutate(Day=day,Year=year ) </span><span id="4cfc" class="na la it mw b gy nf nc l nd ne"><strong class="mw iu">#filter leap year and select 10 year observation period: 2005-2014</strong> </span><span id="12b6" class="na la it mw b gy nf nc l nd ne">df_2005_to_2014&lt;-df%&gt;%filter((df$Day!='02-29') (df$Year!='2015'))</span><span id="8684" class="na la it mw b gy nf nc l nd ne">df_2015&lt;-df%&gt;%filter((df$Day!='02-29')&amp;(df$Year=='2015')) </span><span id="3103" class="na la it mw b gy nf nc l nd ne"><strong class="mw iu">#record min and max for each day of the year for the 2005-2014 period </strong></span><span id="7bcb" class="na la it mw b gy nf nc l nd ne">record_max&lt;-df_2005_to_2014%&gt;%group_by(Day)%&gt;%summarize(Max = max(Data_Value),Min=min(Data_Value))%&gt;%.$Max</span><span id="fac3" class="na la it mw b gy nf nc l nd ne">record_min&lt;-df_2005_to_2014%&gt;%group_by(Day)%&gt;%summarize(Max = max(Data_Value),Min=min(Data_Value))%&gt;%.$Min </span><span id="d754" class="na la it mw b gy nf nc l nd ne"><strong class="mw iu">#record min and max for each day of the year for 2015</strong> </span><span id="e065" class="na la it mw b gy nf nc l nd ne">record_2015_max&lt;-df_2015%&gt;%group_by(Day)%&gt;%summarize(Max = max(Data_Value),Min=min(Data_Value))%&gt;%.$Max</span><span id="41d3" class="na la it mw b gy nf nc l nd ne">record_2015_min&lt;-df_2015%&gt;%group_by(Day)%&gt;%summarize(Max = max(Data_Value),Min=min(Data_Value))%&gt;%.$Min</span></pre><h1 id="9324" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">3.为可视化准备数据</h1><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="4236" class="na la it mw b gy nb nc l nd ne"><strong class="mw iu">#data frame for the 2005-2014 temperatures </strong></span><span id="d525" class="na la it mw b gy nf nc l nd ne">y&lt;-c(seq(1,1,length=365),seq(2,2,length=365))<br/>y&lt;-replace(replace(y, seq(1,365),'max'),seq(366,730),'min')<br/>values&lt;-data.frame(day=c(seq(1,365), seq(1,365)),element=sort(y),Temp=c(record_max,record_min))<br/>q&lt;-values%&gt;%mutate(element=factor(element))</span><span id="f3bf" class="na la it mw b gy nf nc l nd ne"><strong class="mw iu">#data frame for the 2015 temperatures </strong></span><span id="31af" class="na la it mw b gy nf nc l nd ne">max_index&lt;-which(record_2015_max&gt;record_max)<br/>min_index&lt;-which(record_2015_min &lt; record_min)</span><span id="c197" class="na la it mw b gy nf nc l nd ne">dat15_max&lt;data.frame(max_index=max_index,<br/>                     Tmax=record_2015_max[max_index])</span><span id="3f55" class="na la it mw b gy nf nc l nd ne">dat15_min&lt;-data.frame(min_ndex=min_index,  <br/>                      Tmin=record_2015_min[min_index])</span></pre><h1 id="4a36" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">4.生成可视化</h1><pre class="mr ms mt mu gt mv mw mx my aw mz bi"><span id="4281" class="na la it mw b gy nb nc l nd ne">q%&gt;%ggplot(aes(day,Temp,color=element))+<br/>    geom_line(size=1,show.legend = TRUE)+<br/>    geom_point(data=dat15_max,<br/>               aes(max_index,Tmax,color='max_index'),<br/>               size=2,show.legend = TRUE)+        <br/>    geom_point(data=dat15_min,<br/>               aes(min_index,Tmin,color='min_index'),<br/>               size=2,show.legend = TRUE)+  <br/>    scale_colour_manual(labels=c("record high","2015 break  <br/>               high","record low","2015 break low"),<br/>               values=c('red','purple','blue','green'))+    <br/>    xlab('Month')+ <br/>    ylab('Temperature (C)')+  <br/>    scale_x_continuous(breaks = as.integer(seq(1,335,length=12)), <br/>           labels=c('Jan','Feb','Mar','Apr','May','Jun','Jul','Aug',<br/>             'Sep','Oct','Nov','Dec'))+ <br/>    ggtitle("Record temperatures between 2005-2014")+  <br/>    theme(    <br/>    plot.title = element_text(color="black", size=12, hjust=0.5,       <br/>                              face="bold"),    <br/>    axis.title.x = element_text(color="black", size=12,   <br/>                                face="bold"),     <br/>    axis.title.y = element_text(color="black", size=12,   <br/>                                face="bold"),    <br/>    legend.title = element_blank())</span></pre><p id="824b" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">以下是使用 R 的 ggplot2 的输出:</p><figure class="mr ms mt mu gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nm"><img src="../Images/2933f2c9b1e1b3fa9cb5690f7664822c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JAT_sUx49ERQpcBu8L83wg.png"/></div></div></figure><h1 id="4afa" class="kz la it bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">观察</h1><p id="d74d" class="pw-post-body-paragraph kb kc it kd b ke lx kg kh ki ly kk kl km lz ko kp kq ma ks kt ku mb kw kx ky im bi translated">我尽力用 R 的 ggplot2 包制作了一个可视化效果，它与用 Python 的 Matplotlib 制作的非常相似。</p><p id="60db" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在我看来，对于这个特定的项目，与 R 的 ggplot2 包相比，Matplotlib 产生了更好、更漂亮的可视化效果。与 ggplot2 相比，使用 matplotlib 生成可视化效果所需的工作量(代码行)更少。</p><p id="b3c2" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果您有兴趣下载 Matplotlib 和 ggplot2 执行的源代码，请访问下面的 Github 资源库:<a class="ae mq" href="https://github.com/bot13956/weather_pattern" rel="noopener ugc nofollow" target="_blank"><strong class="kd iu">https://github.com/bot13956/weather_pattern</strong></a><strong class="kd iu">。</strong></p><p id="89f4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">请留下关于如何改进 ggplot2 可视化的建议的反馈意见。我很肯定质量可以提高。</p></div></div>    
</body>
</html>