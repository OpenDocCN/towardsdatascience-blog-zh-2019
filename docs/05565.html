<html>
<head>
<title>Why I used an embedded ETL tool for my B2B App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为什么我为我的 B2B 应用程序使用嵌入式 ETL 工具</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/why-i-used-an-embedded-etl-tool-for-my-b2b-app-56d0b3d8ac6?source=collection_archive---------28-----------------------#2019-08-15">https://towardsdatascience.com/why-i-used-an-embedded-etl-tool-for-my-b2b-app-56d0b3d8ac6?source=collection_archive---------28-----------------------#2019-08-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="93a4" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">为 B2B SaaS 公司提供更好的 ETL 解决方案</h2></div><h2 id="d1ad" class="ki kj it bd kk kl km dn kn ko kp dp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated"><strong class="ak">TL；博士</strong></h2><ul class=""><li id="7557" class="le lf it lg b lh li lj lk kr ll kv lm kz ln lo lp lq lr ls bi translated"><strong class="lg iu">企业 ETL 工具使得集成过于昂贵</strong>对于小公司来说不可行，需要不同的 ETL 方法</li><li id="1fca" class="le lf it lg b lh lt lj lu kr lv kv lw kz lx lo lp lq lr ls bi translated"><strong class="lg iu">嵌入式 ETL </strong> <strong class="lg iu">工具不是将<a class="ae ly" href="https://en.wikipedia.org/wiki/Data_integration" rel="noopener ugc nofollow" target="_blank">数据集成</a>的任务完全留给客户，而是让软件供应商</strong>负责提供 ETL，同时让客户控制整个过程——使集成成本更低，并更快地接纳新客户。</li></ul></div><div class="ab cl lz ma hx mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="im in io ip iq"><p id="b6e9" class="pw-post-body-paragraph mg mh it lg b lh mi ju mj lj mk jx ml kr mm mn mo kv mp mq mr kz ms mt mu lo im bi translated">获取数据是我们最大的挑战。</p><p id="b05f" class="pw-post-body-paragraph mg mh it lg b lh mi ju mj lj mk jx ml kr mm mn mo kv mp mq mr kz ms mt mu lo im bi translated">我在一家名为 RevLock 的 B2B 初创公司担任软件开发人员，该公司提供会计软件。像大多数 B2B SaaS 公司一样，要开始使用我们的软件，客户必须以我们应用程序的标准格式输入数据。</p><p id="539a" class="pw-post-body-paragraph mg mh it lg b lh mi ju mj lj mk jx ml kr mm mn mo kv mp mq mr kz ms mt mu lo im bi translated">问题是我们不能使用一个标准集成，因为每个客户在 Salesforce 的自定义对象中都有数据。此外，使用像 Informatica 这样成熟的 ETL 工具会使集成过于昂贵。</p><p id="3193" class="pw-post-body-paragraph mg mh it lg b lh mi ju mj lj mk jx ml kr mm mn mo kv mp mq mr kz ms mt mu lo im bi translated">因此，我们被迫提供更好的解决方案，否则就有可能失去我们的客户。</p><figure class="mw mx my mz gt na gh gi paragraph-image"><div role="button" tabindex="0" class="nb nc di nd bf ne"><div class="gh gi mv"><img src="../Images/4a27f44b069e564942530cf22b005c29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g8695Ij2tpq5Xr4SizOLuw.png"/></div></div><figcaption class="nh ni gj gh gi nj nk bd b be z dk">Source: <a class="ae ly" href="https://www.diyotta.com/what-is-etl" rel="noopener ugc nofollow" target="_blank">Diyotta</a></figcaption></figure><p id="bec8" class="pw-post-body-paragraph mg mh it lg b lh mi ju mj lj mk jx ml kr mm mn mo kv mp mq mr kz ms mt mu lo im bi translated">我们需要提供的高级 ETL 流程如下:</p><ol class=""><li id="c931" class="le lf it lg b lh mi lj mk kr nl kv nm kz nn lo no lq lr ls bi translated">客户将 CSV 文件从 Salesforce 上传到我们的 S3 存储桶</li><li id="6b67" class="le lf it lg b lh lt lj lu kr lv kv lw kz lx lo no lq lr ls bi translated">我们将其转换成应用程序的标准格式</li><li id="1a24" class="le lf it lg b lh lt lj lu kr lv kv lw kz lx lo no lq lr ls bi translated">对数据进行一些基本的推理</li></ol><h1 id="8bd7" class="np kj it bd kk nq nr ns kn nt nu nv kq jz nw ka ku kc nx kd ky kf ny kg lc nz bi translated">最初的解决方案</h1><p id="9efb" class="pw-post-body-paragraph mg mh it lg b lh li ju mj lj lk jx ml kr oa mn mo kv ob mq mr kz oc mt mu lo im bi translated">由于来自 Salesforce 的文件通常较小且易于管理，我们认为为每个客户转换产品内部的文件是可行的。</p><p id="5a67" class="pw-post-body-paragraph mg mh it lg b lh mi ju mj lj mk jx ml kr mm mn mo kv mp mq mr kz ms mt mu lo im bi translated">我们决定用 JavaScript 为每个客户编写单独的转换脚本，并在短短 6 周内成功地接纳了我们的第一个客户。万岁！我们用自己的内部解决方案解决了将数据输入系统的问题。</p><p id="7ce3" class="pw-post-body-paragraph mg mh it lg b lh mi ju mj lj mk jx ml kr mm mn mo kv mp mq mr kz ms mt mu lo im bi translated">然而，我们很快遇到了问题——客户在输入数据中发现了 10 多个没有讨论的场景，要求我们的开发团队修改我们编写的 ETL 代码，作为他们初始集成的一部分。</p><p id="befd" class="pw-post-body-paragraph mg mh it lg b lh mi ju mj lj mk jx ml kr mm mn mo kv mp mq mr kz ms mt mu lo im bi translated">我们意识到，在我们的应用程序中转换 Salesforce 数据变得越来越复杂，耗费了我们团队本应用于开发新功能的时间。是采取新方法的时候了。</p><h1 id="2b11" class="np kj it bd kk nq nr ns kn nt nu nv kq jz nw ka ku kc nx kd ky kf ny kg lc nz bi translated">嵌入式解决方案</h1><p id="a2d8" class="pw-post-body-paragraph mg mh it lg b lh li ju mj lj lk jx ml kr oa mn mo kv ob mq mr kz oc mt mu lo im bi translated">很明显，我们需要使用 ETL 工具，将流程向上游移动，在我们的产品之外。</p><p id="cd40" class="pw-post-body-paragraph mg mh it lg b lh mi ju mj lj mk jx ml kr mm mn mo kv mp mq mr kz ms mt mu lo im bi translated">然而，仅仅将流程从产品中移除并不能解决我们的主要问题——我们需要将管理实际转换的任务交给客户，这样他们就可以在不咨询我们的情况下处理任何问题。</p><p id="5722" class="pw-post-body-paragraph mg mh it lg b lh mi ju mj lj mk jx ml kr mm mn mo kv mp mq mr kz ms mt mu lo im bi translated">因此 ETL 工具必须嵌入到我们的产品中，为客户提供一种修改<em class="od">转换脚本</em>的方法，同时允许我们的产品管理<em class="od">运行</em>ETL<em class="od">。</em></p><p id="f44d" class="pw-post-body-paragraph mg mh it lg b lh mi ju mj lj mk jx ml kr mm mn mo kv mp mq mr kz ms mt mu lo im bi translated">我们在网上寻找这样一个“嵌入式 ETL”工具，其要求如下:</p><ol class=""><li id="f4bb" class="le lf it lg b lh mi lj mk kr nl kv nm kz nn lo no lq lr ls bi translated"><strong class="lg iu">简约</strong>。我们需要脚本易于理解，并具有良好的支持范式，因此客户可以通过使用自己的资源或外包来维护它们。</li><li id="053e" class="le lf it lg b lh lt lj lu kr lv kv lw kz lx lo no lq lr ls bi translated"><strong class="lg iu">承受能力</strong>。作为一家初创公司，我们不想超过每月 50 美元的运营成本。</li><li id="3432" class="le lf it lg b lh lt lj lu kr lv kv lw kz lx lo no lq lr ls bi translated"><strong class="lg iu">轻松集成</strong>到我们的应用程序中。我们不想花费数周时间来集成 ETL 工具——我们需要轻量级的东西。</li></ol><figure class="mw mx my mz gt na gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/27c745ad63e6ca0e9bea7514142282af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1202/format:webp/1*PPIp7twJJUknfohZqtL8pQ.png"/></div></figure><p id="e257" class="pw-post-body-paragraph mg mh it lg b lh mi ju mj lj mk jx ml kr mm mn mo kv mp mq mr kz ms mt mu lo im bi translated">为了保证简单，我研究了流行的数据转换框架，并决定使用 Python，因为所有的数据转换工具都可用。</p><p id="eab3" class="pw-post-body-paragraph mg mh it lg b lh mi ju mj lj mk jx ml kr mm mn mo kv mp mq mr kz ms mt mu lo im bi translated">使用这个标准，我们找到了一个基于云的工具，叫做<a class="ae ly" href="https://hotglue.xyz/" rel="noopener ugc nofollow" target="_blank"><strong class="lg iu">hot glue</strong></a><strong class="lg iu"/>，它运行在 AWS 上。</p><p id="8ee6" class="pw-post-body-paragraph mg mh it lg b lh mi ju mj lj mk jx ml kr mm mn mo kv mp mq mr kz ms mt mu lo im bi translated">我们使用 Pandas 编写转换脚本来处理 CSV 文件的转换，并将一般功能放入我们自己的 Python 模块中，使最终的脚本对我们的客户来说直观且易于阅读。</p><p id="12fb" class="pw-post-body-paragraph mg mh it lg b lh mi ju mj lj mk jx ml kr mm mn mo kv mp mq mr kz ms mt mu lo im bi translated">为了让你有个概念，这是我们为一个客户写的:</p><figure class="mw mx my mz gt na"><div class="bz fp l di"><div class="of og l"/></div></figure><p id="2850" class="pw-post-body-paragraph mg mh it lg b lh mi ju mj lj mk jx ml kr mm mn mo kv mp mq mr kz ms mt mu lo im bi translated">如您所见，编辑脚本非常容易——满足我们的简单性需求。</p><p id="3b21" class="pw-post-body-paragraph mg mh it lg b lh mi ju mj lj mk jx ml kr mm mn mo kv mp mq mr kz ms mt mu lo im bi translated">要为客户实际运行 ETL，我们只需使用下面的 REST 调用:</p><pre class="mw mx my mz gt oh oi oj ok aw ol bi"><span id="b551" class="ki kj it oi b gy om on l oo op">curl -X POST<br/>-H "X-Api-Key: ..."<br/>-H "Content-Type: application/json"<br/>-d '<!-- -->{<br/> "user_id": "...",<br/> "remote_input_dir": "...",<br/> "remote_output_dir": "..."<br/>}<!-- -->'<br/>https://api-endpoint.com/etl/invoke</span></pre><p id="0bee" class="pw-post-body-paragraph mg mh it lg b lh mi ju mj lj mk jx ml kr mm mn mo kv mp mq mr kz ms mt mu lo im bi translated">当 ETL 完成时，一个<code class="fe oq or os oi b">status.txt</code>和<code class="fe oq or os oi b">errors.txt</code>被上传到我们的 S3 桶中的<code class="fe oq or os oi b">remote_output_dir</code>，指示 ETL 是否失败以及发生了什么错误(如果有的话)。</p><p id="7a94" class="pw-post-body-paragraph mg mh it lg b lh mi ju mj lj mk jx ml kr mm mn mo kv mp mq mr kz ms mt mu lo im bi translated">在我们自己的 AWS 环境中运行 ETL 的好处是，我们只为我们使用的东西付费，使我们的成本非常小——满足我们的<strong class="lg iu">可负担性</strong>要求。</p><figure class="mw mx my mz gt na gh gi paragraph-image"><div role="button" tabindex="0" class="nb nc di nd bf ne"><div class="gh gi ot"><img src="../Images/4d314e83cecf07568feec914d215c043.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3Fm1Va6Py9GIcNXIMeqp_g.png"/></div></div><figcaption class="nh ni gj gh gi nj nk bd b be z dk">Source: <a class="ae ly" href="https://jupyter.org/" rel="noopener ugc nofollow" target="_blank">Jupyter</a></figcaption></figure><p id="1acd" class="pw-post-body-paragraph mg mh it lg b lh mi ju mj lj mk jx ml kr mm mn mo kv mp mq mr kz ms mt mu lo im bi translated">为了允许我们的客户编辑转换，hotglue 提供了一个小部件，它启动一个安全的 Jupyter 实例，其中加载了客户的 Python 脚本和数据。在 Jupyter 中，客户可以轻松地测试他们的修改，并将他们的脚本重新部署到生产中。</p><p id="e0e0" class="pw-post-body-paragraph mg mh it lg b lh mi ju mj lj mk jx ml kr mm mn mo kv mp mq mr kz ms mt mu lo im bi translated">将小部件嵌入到我们的 webapp 中非常简单，只需将以下内容添加到我们的<code class="fe oq or os oi b">index.html</code>中:</p><pre class="mw mx my mz gt oh oi oj ok aw ol bi"><span id="964f" class="ki kj it oi b gy om on l oo op">&lt;script src="http://cdn.example.com/widget.js"&gt;&lt;/script&gt;<br/>&lt;script&gt;<br/>  HotGlue.mount(...);<br/>&lt;/script&gt;</span></pre><p id="b19d" class="pw-post-body-paragraph mg mh it lg b lh mi ju mj lj mk jx ml kr mm mn mo kv mp mq mr kz ms mt mu lo im bi translated">切换我们称之为:</p><pre class="mw mx my mz gt oh oi oj ok aw ol bi"><span id="152f" class="ki kj it oi b gy om on l oo op">HotGlue.show()</span></pre><p id="2901" class="pw-post-body-paragraph mg mh it lg b lh mi ju mj lj mk jx ml kr mm mn mo kv mp mq mr kz ms mt mu lo im bi translated">这就勾掉了最后一个方框，<strong class="lg iu">易集成</strong>。</p><p id="c123" class="pw-post-body-paragraph mg mh it lg b lh mi ju mj lj mk jx ml kr mm mn mo kv mp mq mr kz ms mt mu lo im bi translated">下面是一个小部件运行时的快速视频:</p><figure class="mw mx my mz gt na"><div class="bz fp l di"><div class="ou og l"/></div></figure><h1 id="f0b7" class="np kj it bd kk nq nr ns kn nt nu nv kq jz nw ka ku kc nx kd ky kf ny kg lc nz bi translated">结论</h1><p id="2f48" class="pw-post-body-paragraph mg mh it lg b lh li ju mj lj lk jx ml kr oa mn mo kv ob mq mr kz oc mt mu lo im bi translated">我们非常满意为我们的应用程序使用嵌入式 ETL 工具。我们的集成成本降低了，我们可以更快地接纳客户，我们的开发团队也不会因为集成问题而停滞不前。</p><p id="fe82" class="pw-post-body-paragraph mg mh it lg b lh mi ju mj lj mk jx ml kr mm mn mo kv mp mq mr kz ms mt mu lo im bi translated">显然，嵌入式 ETL 解决方案是昂贵的企业 ETL 工具和内部构建定制 ETL 解决方案的绝佳替代方案。</p><p id="79a6" class="pw-post-body-paragraph mg mh it lg b lh mi ju mj lj mk jx ml kr mm mn mo kv mp mq mr kz ms mt mu lo im bi translated">感谢阅读！</p></div></div>    
</body>
</html>