<html>
<head>
<title>Colorizing Old B&amp;W Photos and Videos With the Help of AI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在人工智能的帮助下给老 B&amp;W 的照片和视频上色</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/colorizing-old-b-w-photos-and-videos-with-the-help-of-ai-76ba086f15ec?source=collection_archive---------2-----------------------#2019-03-22">https://towardsdatascience.com/colorizing-old-b-w-photos-and-videos-with-the-help-of-ai-76ba086f15ec?source=collection_archive---------2-----------------------#2019-03-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/3023aa9d63ad6dc1eea0412dcf368204.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TXtrtPNUiWqoJ53ahJ8-5w.png"/></div></div></figure><div class=""/><p id="a127" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">该项目基于加州大学伯克利分校张曦轲、菲利普·伊索拉和阿列克谢·埃夫罗斯的研究工作。<a class="ae kz" href="https://arxiv.org/pdf/1603.08511.pdf" rel="noopener ugc nofollow" target="_blank">彩色图像彩色化</a>。</p><p id="32af" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">本教程背后的想法是开发一个全自动的方法，将产生真实的黑白(B&amp;W)照片和视频的彩色化。正如在原始论文中解释的那样，作者通过在训练时使用类别再平衡来增加结果中颜色的多样性，将问题作为一个分类任务，从而接受了潜在的不确定性。人工智能(AI)方法在测试时被实现为 CNN(“<a class="ae kz" href="https://en.wikipedia.org/wiki/Convolutional_neural_network" rel="noopener ugc nofollow" target="_blank">卷积神经网络</a>”)中的前馈通道，并在超过一百万幅彩色图像上进行训练。</p><p id="6d39" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这张照片拍摄于 1906 年，展示了桑托斯·杜蒙的飞机“14-bis”在巴黎的首次测试:</p><figure class="lb lc ld le gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi la"><img src="../Images/526b6375357615d6249e0199fb8d8696.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Q6-VP2cah4U0v7kL"/></div></div></figure><p id="b415" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">和它的彩色版本使用这些人工智能技术开发的模型:</p><figure class="lb lc ld le gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi la"><img src="../Images/d2d533ae96a78b9800755752ce83d258.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*YipcgWgAWCNfPNd5"/></div></div></figure><p id="ba2d" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">同样的技术也可以应用于老视频。这是 1932 年 B&amp;W 拍摄的巴西里约热内卢的镜头:</p><figure class="lb lc ld le gt iv"><div class="bz fp l di"><div class="lf lg l"/></div></figure><p id="6745" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">彩色版本:</p><figure class="lb lc ld le gt iv"><div class="bz fp l di"><div class="lh lg l"/></div></figure><h1 id="7319" class="li lj je bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">1.Lab 颜色空间</h1><p id="09c7" class="pw-post-body-paragraph kb kc je kd b ke mg kg kh ki mh kk kl km mi ko kp kq mj ks kt ku mk kw kx ky im bi translated">通常，我们习惯于使用<a class="ae kz" href="https://en.wikipedia.org/wiki/RGB_color_model" rel="noopener ugc nofollow" target="_blank"> RGB 模型</a>对彩色照片进行编码。RGB 颜色模型是一种加色模型，其中红色、绿色和蓝色光以各种方式相加在一起，以再现各种颜色。该型号的名称来自三种加色原色的首字母，即红、绿和蓝。</p><figure class="lb lc ld le gt iv gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/d228687c219ad5077098e85bada7e676.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/0*2a8ELa7sb6cHiggc"/></div></figure><p id="e8df" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">但是，这个项目将使用的模型是“实验室”。</p><p id="8398" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><a class="ae kz" href="https://en.wikipedia.org/wiki/CIELAB_color_space" rel="noopener ugc nofollow" target="_blank"> CIELAB </a>色彩空间(也称为 CIE L*a*b*或有时简称为“LAB”色彩空间)是由国际照明委员会(CIE)在 1976 年定义的色彩空间。它将颜色表示为三个数值，L*表示亮度，a*和 b*表示绿-红和蓝-黄颜色分量。</p><p id="4e1a" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">颜色空间 L * a * b *是在对立颜色理论之后创建的，其中两种颜色不能同时是绿色和红色，或者同时是黄色和蓝色。CIELAB 被设计为在人类色觉上是一致的，这意味着这些值的相同数量的数值变化对应于大约相同数量的视觉感知变化。</p><p id="8c69" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">与 RGB 颜色模型不同，Lab 颜色旨在近似人类视觉。它渴望感知一致性，其 L 分量与人类对亮度的感知非常匹配。L 分量正是用作人工智能模型的输入，它被训练来估计剩余的分量“a”和“b”。</p><h1 id="9337" class="li lj je bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">2.人工智能(深度学习)过程</h1><p id="5e5c" class="pw-post-body-paragraph kb kc je kd b ke mg kg kh ki mh kk kl km mi ko kp kq mj ks kt ku mk kw kx ky im bi translated">正如引言中所评论的，人工智能(AI)方法在测试时作为 CNN(“卷积神经网络”)中的前馈传递来实现，并在超过一百万幅彩色图像上进行训练。换句话说，使用 Lab 模型分解了数百万张彩色照片，并将其用作输入特征(“L”)和分类标签(“a”和“b”)。为简单起见，让我们分成两部分:“L”和“a+b”，如框图所示:</p><figure class="lb lc ld le gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi la"><img src="../Images/05aae934c6ff18f7efa122deaa824fc4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9GEVUdnoC00XnKir"/></div></div></figure><p id="1687" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">有了训练好的模型(可以公开获得)，我们可以用它来给一张新的 B&amp;W 照片着色，这张照片将作为模型或组件“L”的输入。模型的输出将是其他组件“a”和“b ”,一旦添加到原始的“L ”,将返回一张完整的彩色照片，如下所示:</p><figure class="lb lc ld le gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi la"><img src="../Images/3a330bf80e98bdeecac4ed31e9872490.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*zXJuYutObGDSqx2e"/></div></div></figure><p id="62c7" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">简而言之，使用来自 ImageNet 的 130 万张照片的一组广泛而多样的对象和场景数据集，并应用深度学习算法(前馈 CNN)，生成了最终模型，可在以下位置获得:</p><p id="d12e" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><a class="ae kz" href="https://github.com/richzhang/colorization/blob/master/models/fetch_release_models.sh" rel="noopener ugc nofollow" target="_blank">张等—彩色图像彩色化—模型</a></p><h1 id="cde3" class="li lj je bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">3.工作环境</h1><figure class="lb lc ld le gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi la"><img src="../Images/1e769d0ab2e9e4826a846fc59f5a05e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*c5FC_1iP-Tlt6opj"/></div></div></figure><p id="f21f" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">首先要做的是组织一个我们将要工作的环境。让我们创建一个文件夹并命名为:</p><ul class=""><li id="259f" class="mm mn je kd b ke kf ki kj km mo kq mp ku mq ky mr ms mt mu bi translated">照片 _ 视频 _ 彩色化</li></ul><p id="2fea" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在这个创建的主目录下，让我们创建子文件夹:</p><ul class=""><li id="33e6" class="mm mn je kd b ke kf ki kj km mo kq mp ku mq ky mr ms mt mu bi translated">模型</li><li id="52ae" class="mm mn je kd b ke mv ki mw km mx kq my ku mz ky mr ms mt mu bi translated">输入 _ 图像</li><li id="d3b2" class="mm mn je kd b ke mv ki mw km mx kq my ku mz ky mr ms mt mu bi translated">输入 _ 视频</li><li id="2bd7" class="mm mn je kd b ke mv ki mw km mx kq my ku mz ky mr ms mt mu bi translated">彩色图像</li><li id="437d" class="mm mn je kd b ke mv ki mw km mx kq my ku mz ky mr ms mt mu bi translated">彩色 _ 框架</li><li id="484c" class="mm mn je kd b ke mv ki mw km mx kq my ku mz ky mr ms mt mu bi translated">彩色 _ 视频</li></ul><p id="22e6" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">进入<a class="ae kz" href="https://github.com/richzhang/colorization/blob/master/models/fetch_release_models.sh" rel="noopener ugc nofollow" target="_blank">张等人-彩色图像着色-模型</a>下载 3 个文件并加载到创建的子文件夹“/model”下。这些文件是:</p><ul class=""><li id="98b1" class="mm mn je kd b ke kf ki kj km mo kq mp ku mq ky mr ms mt mu bi translated">colorization _ release _ v2 . caffemodel</li><li id="1320" class="mm mn je kd b ke mv ki mw km mx kq my ku mz ky mr ms mt mu bi translated">colorization _ release _ v2 _ nore bal . caffe model</li><li id="8e0a" class="mm mn je kd b ke mv ki mw km mx kq my ku mz ky mr ms mt mu bi translated">colorization _ release _ v1 . caffemodel</li></ul><p id="9d66" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我假设您的机器上安装了 Python(3.6 版)和 OpenCV (4.0 版)。我们将使用 Jupyter 笔记本一步一步地描述着色的所有过程。我建议您遵循我的解释，但是如果您愿意，您可以从我的 GitHub 下载笔记本和测试照片:</p><p id="0be7" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><a class="ae kz" href="https://github.com/Mjrovai/Python4DS/tree/master/Photo_Video_Colorization" rel="noopener ugc nofollow" target="_blank">照片 _ 视频 _ 彩色化</a></p><p id="cc88" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我还建议您阅读 Adrian Rosebrok 博士的伟大教程“<a class="ae kz" href="https://www.pyimagesearch.com/2019/02/25/black-and-white-image-colorization-with-opencv-and-deep-learning/" rel="noopener ugc nofollow" target="_blank">OpenCV 和深度学习的黑白图像着色</a>”，这是这个项目的灵感和指南。</p><h1 id="f719" class="li lj je bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">4.黑白照片彩色化</h1><figure class="lb lc ld le gt iv gh gi paragraph-image"><div class="gh gi na"><img src="../Images/64b60174589a89012a1abadd46a2b0b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1054/0*Nu3s_MQpZZDdtdew"/></div></figure><p id="3ec5" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">让我们按照以下步骤给 BT&amp;W 照片上色:</p><p id="3eb4" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd jf">导入重要库:</strong></p><pre class="lb lc ld le gt nb nc nd ne aw nf bi"><span id="0eaf" class="ng lj je nc b gy nh ni l nj nk">import numpy as np<br/>import matplotlib.pyplot as plt<br/>import cv2</span></pre><p id="eec9" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd jf">定义要着色的图像:</strong></p><pre class="lb lc ld le gt nb nc nd ne aw nf bi"><span id="542a" class="ng lj je nc b gy nh ni l nj nk">IMAGE = "soldiers_1941"</span></pre><p id="a9cc" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">注意:你可以在这里使用任何照片。在这个例子中，我使用了一张 1941 年 B&amp;W 二战士兵的照片。我的 GitHub 上有这张照片。</p><p id="3328" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd jf">定义模型路径:</strong></p><pre class="lb lc ld le gt nb nc nd ne aw nf bi"><span id="0d49" class="ng lj je nc b gy nh ni l nj nk">prototxt = "./model/colorization_deploy_v2.prototxt"<br/>model = "./model/colorization_release_v2.caffemodel"<br/>points = "./model/pts_in_hull.npy"<br/>image =  "./input_images/"+IMAGE</span></pre><p id="8f7a" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd jf">加载序列化的黑白彩色模型和集群:</strong></p><pre class="lb lc ld le gt nb nc nd ne aw nf bi"><span id="f32b" class="ng lj je nc b gy nh ni l nj nk">net = cv2.dnn.readNetFromCaffe(prototxt, model)<br/>pts = np.load(points)</span></pre><p id="de6c" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd jf">将聚类中心作为 1x1 卷积添加到模型:</strong></p><pre class="lb lc ld le gt nb nc nd ne aw nf bi"><span id="78b7" class="ng lj je nc b gy nh ni l nj nk">class8 = net.getLayerId("class8_ab")<br/>conv8 = net.getLayerId("conv8_313_rh")<br/>pts = pts.transpose().reshape(2, 313, 1, 1)<br/>net.getLayer(class8).blobs = [pts.astype("float32")]<br/>net.getLayer(conv8).blobs = [np.full([1, 313], 2.606, dtype="float32")]</span></pre><p id="8ebc" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd jf">加载输入图像，缩放并转换到 Lab: </strong></p><p id="cbd0" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">请注意，我们首先将图像转换为灰度。这一步并不是真的必要，但我意识到一些 B&amp;W 的照片，尤其是旧的，可能会在岁月中有一些处理，所以，最好清理一下。</p><pre class="lb lc ld le gt nb nc nd ne aw nf bi"><span id="9f2f" class="ng lj je nc b gy nh ni l nj nk">image = cv2.imread(image)<br/>image = cv2.cvtColor(image, cv2.COLOR_BGR2GRAY)<br/>image = cv2.cvtColor(image, cv2.COLOR_GRAY2RGB)</span></pre><p id="078f" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">此时，我们有了原始图像，但是为了在 Jupyter 单元格上直接显示它，我们应该使用 pyplot 库:</p><pre class="lb lc ld le gt nb nc nd ne aw nf bi"><span id="a38f" class="ng lj je nc b gy nh ni l nj nk">plt.imshow(image)<br/>plt.axis('off');</span></pre><figure class="lb lc ld le gt iv gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/e3c1450d84cb4c95c40390a8201f961d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1108/0*7zssTMXuO9Yi6YP3"/></div></figure><p id="3520" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd jf">提取“L”:</strong></p><p id="d9b4" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在，让我们的“图像”继续进行着色过程，首先应该重新缩放，转换到 Lab，以提取组件“L”并使其居中:</p><pre class="lb lc ld le gt nb nc nd ne aw nf bi"><span id="fa85" class="ng lj je nc b gy nh ni l nj nk">scaled = image.astype("float32") / 255.0<br/>lab = cv2.cvtColor(scaled, cv2.COLOR_RGB2LAB)<br/>resized = cv2.resize(lab, (224, 224))<br/>L = cv2.split(resized)[0]<br/>L -= 50</span></pre><p id="dac6" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd jf">预测“a”和“b”:</strong></p><pre class="lb lc ld le gt nb nc nd ne aw nf bi"><span id="c657" class="ng lj je nc b gy nh ni l nj nk">net.setInput(cv2.dnn.blobFromImage(L))<br/>ab = net.forward()[0, :, :, :].transpose((1, 2, 0))<br/>ab = cv2.resize(ab, (image.shape[1], image.shape[0]))</span></pre><p id="e36e" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd jf">创建彩色实验室照片(L + a + b): </strong></p><pre class="lb lc ld le gt nb nc nd ne aw nf bi"><span id="38b0" class="ng lj je nc b gy nh ni l nj nk">L = cv2.split(lab)[0]<br/>colorized = np.concatenate((L[:, :, np.newaxis], ab), axis=2)</span></pre><p id="e7d6" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">和我们处理灰度图像一样，让我们看看彩色图像是什么样子的:</p><pre class="lb lc ld le gt nb nc nd ne aw nf bi"><span id="4e0e" class="ng lj je nc b gy nh ni l nj nk">plt.imshow(colorized)<br/>plt.axis('off');<br/>plt.title('colorized LAB image');</span></pre><figure class="lb lc ld le gt iv gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/7f4119f16288e57c498563dfe54a3a83.png" data-original-src="https://miro.medium.com/v2/resize:fit:514/0*n402YUIug-sDQRHj"/></div></figure><p id="d0f1" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">Ops，似乎实验室图像不能告诉我们太多，让我们将其转换为 RGB，看看结果:</p><p id="34ac" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd jf">转换为 RGB: </strong></p><pre class="lb lc ld le gt nb nc nd ne aw nf bi"><span id="8cdd" class="ng lj je nc b gy nh ni l nj nk">colorized = cv2.cvtColor(colorized, cv2.COLOR_LAB2RGB)<br/>colorized = np.clip(colorized, 0, 1)<br/>colorized = (255 * colorized).astype("uint8")<br/>plt.imshow(colorized)<br/>plt.axis('off');</span></pre><figure class="lb lc ld le gt iv gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/1e205e4cf9209ab31c6eb440176919ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1108/0*3BqExNAFpIO0bAVu"/></div></figure><p id="17ee" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">Uau！相当惊人！！！！！这是一张 1941 年的照片，看起来真的是全彩拍摄的！还是省省吧:</p><p id="15af" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd jf">保存最终的 RGB 照片:</strong></p><pre class="lb lc ld le gt nb nc nd ne aw nf bi"><span id="e450" class="ng lj je nc b gy nh ni l nj nk">cv2.imwrite("./colorized_images/Color_"+IMAGE, cv2.cvtColor(colorized, cv2.COLOR_RGB2BGR))</span></pre><p id="36de" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">再来一个:查尔斯·达尔文 1832 年访问巴西里约热内卢:</p><figure class="lb lc ld le gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi la"><img src="../Images/7ac251cd89b0fa687fcaa69379e549e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*k7xmkER0hfobGv_V"/></div></div></figure><p id="e86b" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">太好了！！！！试试其他 B&amp;W 的照片，看看人工智能有多神奇！</p><h1 id="8207" class="li lj je bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">5.给视频着色</h1><p id="76ef" class="pw-post-body-paragraph kb kc je kd b ke mg kg kh ki mh kk kl km mi ko kp kq mj ks kt ku mk kw kx ky im bi translated">一旦我们给照片上色，给视频上色就不是一件复杂的事情了。我们必须遵循以下一般步骤:</p><ul class=""><li id="11e1" class="mm mn je kd b ke kf ki kj km mo kq mp ku mq ky mr ms mt mu bi translated">获取 B&amp;W 素材并加载到<strong class="kd jf"> input_video </strong>子目录中</li><li id="878b" class="mm mn je kd b ke mv ki mw km mx kq my ku mz ky mr ms mt mu bi translated">阅读视频，一次一帧</li><li id="5c62" class="mm mn je kd b ke mv ki mw km mx kq my ku mz ky mr ms mt mu bi translated">有一个单一的框架，适用于我们所做的照片</li><li id="da5d" class="mm mn je kd b ke mv ki mw km mx kq my ku mz ky mr ms mt mu bi translated">有了彩色帧后，保存到另一个子文件夹:<strong class="kd jf"> colorized_video_frames </strong></li><li id="4982" class="mm mn je kd b ke mv ki mw km mx kq my ku mz ky mr ms mt mu bi translated">关闭 OpenCv 窗口。</li></ul><p id="018c" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我们来做一个真实的案例:</p><p id="8139" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">可以从我的 GitHub 下载笔记本<a class="ae kz" href="https://github.com/Mjrovai/Python4DS/blob/master/Photo_Video_Colorization/B_W_Video_Colorization.ipynb" rel="noopener ugc nofollow" target="_blank">B _ W _ Video _ colorization . ipynb</a>，或者按照步骤操作。</p><p id="05fa" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我做的第一件事，是从 YouTube 上下载一部 B&amp;W 的电影，在这个例子中:</p><figure class="lb lc ld le gt iv"><div class="bz fp l di"><div class="lf lg l"/></div></figure><p id="1415" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">为此，我使用了一个免费工具:<a class="ae kz" href="https://www.vidpaw.com/" rel="noopener ugc nofollow" target="_blank"> VidPaw </a>来下载它。我给它命名为:“rio_32.mp4”，保存在<strong class="kd jf"> input_video </strong>子文件夹。</p><p id="bde2" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">应用上面描述的步骤，最后我们将所有彩色帧存储在子文件夹<strong class="kd jf">的彩色视频帧</strong>中。让我们开始吧:</p><p id="14e4" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">1.开始定义应该着色的文件:</p><pre class="lb lc ld le gt nb nc nd ne aw nf bi"><span id="0c85" class="ng lj je nc b gy nh ni l nj nk">VIDEO = "rio_32.mp4"</span></pre><p id="d85f" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">2.定义路径、常量和视频变量:</p><pre class="lb lc ld le gt nb nc nd ne aw nf bi"><span id="252b" class="ng lj je nc b gy nh ni l nj nk">prototxt = "./model/colorization_deploy_v2.prototxt"<br/>model = "./model/colorization_release_v2.caffemodel"<br/>points = "./model/pts_in_hull.npy"<br/>video =  "./input_video/"+VIDEO<br/>width = 500<br/>vs = cv2.VideoCapture(video)</span></pre><p id="1786" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">3.加载和准备模型:</p><pre class="lb lc ld le gt nb nc nd ne aw nf bi"><span id="9b48" class="ng lj je nc b gy nh ni l nj nk">net = cv2.dnn.readNetFromCaffe(prototxt,model)<br/>pts = np.load(points)<br/>class8 = net.getLayerId("class8_ab")<br/>conv8 = net.getLayerId("conv8_313_rh")<br/>pts = pts.transpose().reshape(2, 313, 1, 1)<br/>net.getLayer(class8).blobs = [pts.astype("float32")]<br/>net.getLayer(conv8).blobs = [np.full([1, 313], 2.606, dtype="float32")]</span></pre><p id="4e97" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">4.逐帧分割视频并应用模型:</p><pre class="lb lc ld le gt nb nc nd ne aw nf bi"><span id="c1cd" class="ng lj je nc b gy nh ni l nj nk">count = 0<br/>success = True<br/>while success:<br/>    success, frame = vs.read()<br/>    if frame is None:<br/>        break<br/>    frame = imutils.resize(frame, 500)<br/>    frame = cv2.cvtColor(frame, cv2.COLOR_BGR2GRAY)<br/>    frame = cv2.cvtColor(frame, cv2.COLOR_GRAY2RGB)<br/>    scaled = frame.astype("float32") / 255.0<br/>    lab = cv2.cvtColor(scaled, cv2.COLOR_RGB2LAB)</span><span id="a403" class="ng lj je nc b gy nn ni l nj nk">    resized = cv2.resize(lab, (224, 224))<br/>    L = cv2.split(resized)[0]<br/>    L -= 50<br/>    <br/>    net.setInput(cv2.dnn.blobFromImage(L))<br/>    ab = net.forward()[0, :, :, :].transpose((1, 2, 0))</span><span id="03de" class="ng lj je nc b gy nn ni l nj nk">    ab = cv2.resize(ab, (frame.shape[1], frame.shape[0]))<br/>    L = cv2.split(lab)[0]<br/>    colorized = np.concatenate((L[:, :, np.newaxis], ab), axis=2)</span><span id="df7f" class="ng lj je nc b gy nn ni l nj nk">    colorized = cv2.cvtColor(colorized, cv2.COLOR_LAB2BGR)<br/>    colorized = np.clip(colorized, 0, 1)<br/>    colorized = (255 * colorized).astype("uint8")</span><span id="1f75" class="ng lj je nc b gy nn ni l nj nk">    cv2.imshow("Original", frame)<br/>    cv2.imshow("Colorized", colorized)<br/>    <br/>    cv2.imwrite("./colorized_video_frames/frame%d.jpg" % count, colorized)<br/>    count += 1<br/>    key = cv2.waitKey(1) &amp; 0xFF</span><span id="7064" class="ng lj je nc b gy nn ni l nj nk">    if key == ord("q"):<br/>        break</span><span id="e03a" class="ng lj je nc b gy nn ni l nj nk">vs.release()<br/>cv2.destroyAllWindows()</span></pre><p id="efc3" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">上述循环过程，通常需要一段时间。例如，这个视频的彩色化过程(8 分钟)有大约 14，000 帧，我在 MacBook Pro 上花了大约 3 个小时——2.9 GHz Core i7，16GB 2133 MHz RAM。</p><p id="2b3d" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">5.一旦你有了包含帧的文件，你必须“重新组合”它来创建一个视频。下面的函数可以做到这一点:</p><pre class="lb lc ld le gt nb nc nd ne aw nf bi"><span id="9894" class="ng lj je nc b gy nh ni l nj nk"><strong class="nc jf">def</strong> convert_frames_to_video(pathIn, pathOut, fps):<br/>    frame_array = []<br/>    files = [f <strong class="nc jf">for</strong> f <strong class="nc jf">in</strong> os.listdir(pathIn) <strong class="nc jf">if</strong> isfile(join(pathIn, f))]<br/> <br/>    <em class="no">#for sorting the file names properly</em><br/>    files.sort(key = <strong class="nc jf">lambda</strong> x: int(x[5:-4]))<br/> <br/>    <strong class="nc jf">for</strong> i <strong class="nc jf">in</strong> range(len(files)):<br/>        filename=pathIn + files[i]<br/>        <em class="no">#reading each files</em><br/>        img = cv2.imread(filename)<br/>        height, width, layers = img.shape<br/>        size = (width,height)<br/>        print(filename)<br/>        <em class="no">#inserting the frames into an image array</em><br/>        frame_array.append(img)<br/> <br/>    out = cv2.VideoWriter(pathOut,cv2.VideoWriter_fourcc(*'MJPG'), fps, size)<br/> <br/>    <strong class="nc jf">for</strong> i <strong class="nc jf">in</strong> range(len(frame_array)):<br/>        <em class="no"># writing to a image array</em><br/>        out.write(frame_array[i])<br/>    out.release()</span></pre><p id="2c1a" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">请注意，根据您在计算机上安装的视频控制器，编解码器(*'MJPG ')应该更改。请查阅 OpenCV 文档。最终将会是一次“试错”的经历。</p><p id="eff0" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">现在，您应该在彩色帧上应用上面的函数:</p><pre class="lb lc ld le gt nb nc nd ne aw nf bi"><span id="b2e3" class="ng lj je nc b gy nh ni l nj nk">pathIn= './colorized_video_frames/'<br/>pathOut = './colorized_videos/video.avi'<br/>fps = 30.0<br/>convert_frames_to_video(pathIn, pathOut, fps)</span></pre><p id="4023" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">由此产生的“原始”视频可以在这里看到:</p><figure class="lb lc ld le gt iv"><div class="bz fp l di"><div class="lf lg l"/></div></figure><p id="1dd5" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">注意，视频明显没有声音。我所做的是用 iMovie 从 B&amp;W 电影中剥离原始声音，并将其添加到彩色声音中。最后的结果在这里:</p><figure class="lb lc ld le gt iv"><div class="bz fp l di"><div class="lh lg l"/></div></figure><p id="d5b4" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">很酷，不是吗？；-)</p><h1 id="fcda" class="li lj je bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">6.向桑托斯·杜蒙致敬</h1><figure class="lb lc ld le gt iv gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/bbc0f8911308a431b29852d303789268.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*4P3JPwgWpENG5kT5u2fsHQ.jpeg"/></div></figure><p id="95f1" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">借着给旧照片和视频上色的机会，我决定向上世纪最伟大的发明家之一阿尔贝托·桑托斯-杜蒙特致敬。</p><p id="1e19" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">桑托斯-杜蒙(1873-1932)是巴西发明家和航空先驱，是为数不多的对轻于空气和重于空气的飞机的发展做出重大贡献的人之一。</p><p id="d33b" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">桑托斯-杜蒙是一个富裕的咖啡生产商家族的继承人，他在巴黎致力于航空研究和实验，并在那里度过了他的大部分成年时光。在他早期的职业生涯中，他设计、制造并驾驶热气球和早期飞船，并于 1901 年 10 月 19 日因环绕埃菲尔铁塔的飞行而获得了德意志奖。然后，他转向了重于空气的机器，1906 年 10 月 23 日，他的 14-is 成为欧洲第一架动力重于空气的飞机，获得了法国航空俱乐部和国际航空联合会的认证。他坚信航空将开创一个世界和平与繁荣的时代，这让他自由地发表自己的设计，并放弃了各种创新的专利。</p><p id="441b" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">桑托斯-杜蒙确实是开放科学的早期专家，他的目标是为人类造福。一个例子是，他的<em class="no"> Demoiselle </em>飞机的所有计划都公开发表在 1909 年 12 月版的《大众力学》杂志上，其中写道:<em class="no">为了鼓励航空业，任何人都可以利用他的计划建造类似的机器。</em></p><figure class="lb lc ld le gt iv gh gi paragraph-image"><div class="gh gi np"><img src="../Images/9090a605fb4257a40d2061b0f6cbc2ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1036/format:webp/1*a0tNPlglOneeRoRJ0hwKFQ.png"/></div></figure><p id="475e" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">这项工作的所有照片都是从第一个十年的 XX 世纪，并完全彩色的电脑，使用技术描述在这篇文章中，包括下面的视频。我希望你能欣赏它。</p><figure class="lb lc ld le gt iv"><div class="bz fp l di"><div class="lh lg l"/></div></figure><h1 id="51f3" class="li lj je bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">7.结论</h1><p id="8b58" class="pw-post-body-paragraph kb kc je kd b ke mg kg kh ki mh kk kl km mi ko kp kq mj ks kt ku mk kw kx ky im bi translated">一如既往，我希望这个项目可以帮助其他人找到进入令人兴奋的数据科学世界的方法！</p><p id="cfec" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">详情和最终代码请访问我的 GitHub 资源库:<a class="ae kz" href="https://github.com/Mjrovai/Python4DS/tree/master/Photo_Video_Colorization" rel="noopener ugc nofollow" target="_blank"><em class="no">mj robot-python 4 ds</em></a></p><p id="5ea8" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">来自世界南部的 Saludos！</p><p id="2de5" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">我的下一篇文章再见！</p><p id="3225" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">谢谢你，</p><p id="617a" class="pw-post-body-paragraph kb kc je kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">马塞洛</p></div></div>    
</body>
</html>