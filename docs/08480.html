<html>
<head>
<title>Question Answering with BERT, XLNET, XLM, and DistilBERT using Simple Transformers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">伯特、XLNET、XLM 和迪沃伯特使用简单变压器回答问题</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/question-answering-with-bert-xlnet-xlm-and-distilbert-using-simple-transformers-4d8785ee762a?source=collection_archive---------7-----------------------#2019-11-17">https://towardsdatascience.com/question-answering-with-bert-xlnet-xlm-and-distilbert-using-simple-transformers-4d8785ee762a?source=collection_archive---------7-----------------------#2019-11-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="77c2" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">问题:如何使用变形金刚进行问答？回答:简单的变形金刚，咄！(看到我在那里做了什么吗？)</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/4770949eeebdc954d653ef57b1288d28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*HX5XUB7OIs9SQFd1"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk">Photo by <a class="ae ky" href="https://unsplash.com/@camylla93?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Camylla Battani</a> on <a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="abaa" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">自然语言处理中的问题回答</h1><blockquote class="lr ls lt"><p id="e660" class="lu lv lw lx b ly lz ju ma mb mc jx md me mf mg mh mi mj mk ml mm mn mo mp mq im bi translated">背景:问答(QA)是信息检索和自然语言处理(NLP)领域中的一门计算机科学学科，它涉及到构建自动回答人类用自然语言提出的问题的系统。</p><p id="ae02" class="lu lv lw lx b ly lz ju ma mb mc jx md me mf mg mh mi mj mk ml mm mn mo mp mq im bi translated"><strong class="lx iu">人类</strong>:什么是问答系统？<br/> <strong class="lx iu">系统</strong>:自动回答人类用自然语言提出的问题的系统</p></blockquote><p id="90a4" class="pw-post-body-paragraph lu lv it lx b ly lz ju ma mb mc jx md mr mf mg mh ms mj mk ml mt mn mo mp mq im bi translated">QA 在大量的任务中有应用，包括信息检索、实体提取、聊天机器人和对话系统等等。虽然回答问题可以有多种方式，但最常见的问答方式可能是从给定的上下文中选择答案。换句话说，系统将从正确回答问题的上下文中挑选一个<em class="lw">范围</em>的文本。如果无法从上下文中找到正确答案，系统将只返回一个空字符串。</p><p id="96b5" class="pw-post-body-paragraph lu lv it lx b ly lz ju ma mb mc jx md mr mf mg mh ms mj mk ml mt mn mo mp mq im bi translated">使用预先训练的 Transformer 模型进行迁移学习在 NLP 问题中已经变得无处不在，问答也不例外。考虑到这一点，我们将使用 BERT 来处理问答任务！</p><p id="bdb9" class="pw-post-body-paragraph lu lv it lx b ly lz ju ma mb mc jx md mr mf mg mh ms mj mk ml mt mn mo mp mq im bi translated">我们将使用<a class="ae ky" href="https://github.com/ThilinaRajapakse/simpletransformers" rel="noopener ugc nofollow" target="_blank">简单变形金刚</a>库来轻松处理变形金刚模型。</p><div class="mu mv gp gr mw mx"><a href="https://github.com/ThilinaRajapakse/simpletransformers" rel="noopener  ugc nofollow" target="_blank"><div class="my ab fo"><div class="mz ab na cl cj nb"><h2 class="bd iu gy z fp nc fr fs nd fu fw is bi translated">ThilinaRajapakse/简单变压器</h2><div class="ne l"><h3 class="bd b gy z fp nc fr fs nd fu fw dk translated">这个库是基于 HuggingFace 的变形金刚库。简单的变形金刚让你快速训练和…</h3></div><div class="nf l"><p class="bd b dl z fp nc fr fs nd fu fw dk translated">github.com</p></div></div><div class="ng l"><div class="nh l ni nj nk ng nl ks mx"/></div></div></a></div><p id="b866" class="pw-post-body-paragraph lu lv it lx b ly lz ju ma mb mc jx md mr mf mg mh ms mj mk ml mt mn mo mp mq im bi translated">简单的变形金刚是建立在高超的<a class="ae ky" href="https://github.com/huggingface/transformers" rel="noopener ugc nofollow" target="_blank">拥抱脸变形金刚</a>库之上的。</p><h1 id="02e6" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">设置</h1><ol class=""><li id="45be" class="nm nn it lx b ly no mb np mr nq ms nr mt ns mq nt nu nv nw bi translated">从<a class="ae ky" href="https://www.anaconda.com/distribution/" rel="noopener ugc nofollow" target="_blank">这里</a>安装 Anaconda 或 Miniconda 包管理器。</li><li id="09e9" class="nm nn it lx b ly nx mb ny mr nz ms oa mt ob mq nt nu nv nw bi translated">创建新的虚拟环境并安装软件包。<br/> <code class="fe oc od oe of b">conda create -n simpletransformers python pandas tqdm</code> <br/> <code class="fe oc od oe of b">conda activate simpletransformers</code> <br/>如果使用 cuda: <br/> <code class="fe oc od oe of b">conda install pytorch cudatoolkit=10.0 -c pytorch</code> <br/>其他:<br/><code class="fe oc od oe of b">conda install pytorch cpuonly -c pytorch</code><br/><code class="fe oc od oe of b">conda install -c anaconda scipy</code><br/><code class="fe oc od oe of b">conda install -c anaconda scikit-learn</code><br/><code class="fe oc od oe of b">pip install transformers</code><br/><code class="fe oc od oe of b">pip install seqeval</code><br/><code class="fe oc od oe of b">pip install tensorboardx</code></li><li id="d146" class="nm nn it lx b ly nx mb ny mr nz ms oa mt ob mq nt nu nv nw bi translated">如果您使用 fp16 培训，请安装 Apex。请遵循此处的说明<a class="ae ky" href="https://github.com/NVIDIA/apex" rel="noopener ugc nofollow" target="_blank">。(从 pip 安装 Apex 给一些人带来了问题。)</a></li><li id="3e1d" class="nm nn it lx b ly nx mb ny mr nz ms oa mt ob mq nt nu nv nw bi translated">安装简单变压器。<br/> <code class="fe oc od oe of b">pip install simpletransformers</code></li></ol><h1 id="6777" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">数据集</h1><p id="682c" class="pw-post-body-paragraph lu lv it lx b ly no ju ma mb np jx md mr og mg mh ms oh mk ml mt oi mo mp mq im bi translated">我们将使用<a class="ae ky" href="https://rajpurkar.github.io/SQuAD-explorer/" rel="noopener ugc nofollow" target="_blank">斯坦福问答数据集(SQuAD 2.0) </a>来训练和评估我们的模型。SQuAD 是一个阅读理解数据集，也是 QA 模型的标准基准。该数据集在网站上公开提供。</p><p id="bd2f" class="pw-post-body-paragraph lu lv it lx b ly lz ju ma mb mc jx md mr mf mg mh ms mj mk ml mt mn mo mp mq im bi translated">下载数据集并将文件(train-v2.0.json，dev-v2.0.json)放在<code class="fe oc od oe of b">data/</code>目录中。</p><h1 id="2cf7" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">数据准备</h1><p id="f3cd" class="pw-post-body-paragraph lu lv it lx b ly no ju ma mb np jx md mr og mg mh ms oh mk ml mt oi mo mp mq im bi translated">为了在简单的转换器中执行 QA，数据必须以正确的格式保存在 JSON 文件或 Python 字典列表中。</p><p id="f562" class="pw-post-body-paragraph lu lv it lx b ly lz ju ma mb mc jx md mr mf mg mh ms mj mk ml mt mn mo mp mq im bi translated">如果使用 JSON 文件，这些文件应该包含一个字典列表。字典代表一个上下文及其相关的问题。</p><p id="4035" class="pw-post-body-paragraph lu lv it lx b ly lz ju ma mb mc jx md mr mf mg mh ms mj mk ml mt mn mo mp mq im bi translated">每个这样的字典包含两个属性，<code class="fe oc od oe of b">"context"</code>和<code class="fe oc od oe of b">"qas"</code>。</p><ul class=""><li id="ae2c" class="nm nn it lx b ly lz mb mc mr oj ms ok mt ol mq om nu nv nw bi translated"><code class="fe oc od oe of b">context</code>:提问的段落或文本。</li><li id="b159" class="nm nn it lx b ly nx mb ny mr nz ms oa mt ob mq om nu nv nw bi translated"><code class="fe oc od oe of b">qas</code>:问答列表。</li></ul><p id="1d42" class="pw-post-body-paragraph lu lv it lx b ly lz ju ma mb mc jx md mr mf mg mh ms mj mk ml mt mn mo mp mq im bi translated">问题和答案被表示为字典。<code class="fe oc od oe of b">qas</code>中的每个字典都有以下格式。</p><ul class=""><li id="6919" class="nm nn it lx b ly lz mb mc mr oj ms ok mt ol mq om nu nv nw bi translated"><code class="fe oc od oe of b">id</code> : (string)问题的唯一 ID。在整个数据集中应该是唯一的。</li><li id="5770" class="nm nn it lx b ly nx mb ny mr nz ms oa mt ob mq om nu nv nw bi translated"><code class="fe oc od oe of b">question</code>:(字符串)一个问题。</li><li id="5943" class="nm nn it lx b ly nx mb ny mr nz ms oa mt ob mq om nu nv nw bi translated"><code class="fe oc od oe of b">is_impossible</code> : (bool)表示是否能从上下文中正确回答问题。</li><li id="87c9" class="nm nn it lx b ly nx mb ny mr nz ms oa mt ob mq om nu nv nw bi translated"><code class="fe oc od oe of b">answers</code>:(列表)问题正确答案列表。</li></ul><p id="85c3" class="pw-post-body-paragraph lu lv it lx b ly lz ju ma mb mc jx md mr mf mg mh ms mj mk ml mt mn mo mp mq im bi translated">单个答案由具有以下属性的字典表示。</p><ul class=""><li id="64ec" class="nm nn it lx b ly lz mb mc mr oj ms ok mt ol mq om nu nv nw bi translated"><code class="fe oc od oe of b">answer</code>:(字符串)问题的答案。必须是上下文的子字符串。</li><li id="2e46" class="nm nn it lx b ly nx mb ny mr nz ms oa mt ob mq om nu nv nw bi translated"><code class="fe oc od oe of b">answer_start</code> : (int)上下文中答案的起始索引。</li></ul><p id="f677" class="pw-post-body-paragraph lu lv it lx b ly lz ju ma mb mc jx md mr mf mg mh ms mj mk ml mt mn mo mp mq im bi translated">我们可以很容易地将球队数据转换成这种格式。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="on oo l"/></div></figure><h1 id="3e90" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">问答模型</h1><p id="2dc8" class="pw-post-body-paragraph lu lv it lx b ly no ju ma mb np jx md mr og mg mh ms oh mk ml mt oi mo mp mq im bi translated">Simple Transformers 有一个类，可以用于每个受支持的 NLP 任务。这个类的对象用于执行训练、评估(当基本事实已知时)和预测(当基本事实未知时)。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="on oo l"/></div></figure><p id="1ee8" class="pw-post-body-paragraph lu lv it lx b ly lz ju ma mb mc jx md mr mf mg mh ms mj mk ml mt mn mo mp mq im bi translated">这里，我们创建一个<code class="fe oc od oe of b">QuestionAnsweringModel</code>对象，并设置超参数来微调模型。第一个参数是<em class="lw">型号类型</em>，第二个是<em class="lw">型号名称。</em></p><p id="78c2" class="pw-post-body-paragraph lu lv it lx b ly lz ju ma mb mc jx md mr mf mg mh ms mj mk ml mt mn mo mp mq im bi translated"><code class="fe oc od oe of b">args</code>参数接受一个可选的 Python 字典，其中包含超参数值和配置选项。我强烈推荐在这里查看所有选项<a class="ae ky" href="https://github.com/ThilinaRajapakse/simpletransformers/blob/master/README.md#default-settings" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="ea7c" class="pw-post-body-paragraph lu lv it lx b ly lz ju ma mb mc jx md mr mf mg mh ms mj mk ml mt mn mo mp mq im bi translated">默认值如下所示。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="on oo l"/></div></figure><p id="26ec" class="pw-post-body-paragraph lu lv it lx b ly lz ju ma mb mc jx md mr mf mg mh ms mj mk ml mt mn mo mp mq im bi translated">要加载一个先前保存的模型而不是默认模型，您可以将<em class="lw"> model_name </em>更改为包含已保存模型的<strong class="lx iu">目录</strong>的路径。</p><pre class="kj kk kl km gt op of oq or aw os bi"><span id="b21c" class="ot la it of b gy ou ov l ow ox">model = <!-- -->QuestionAnsweringModel<!-- -->('bert', 'path_to_model/')</span></pre><h1 id="f1b1" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">培养</h1><p id="ec27" class="pw-post-body-paragraph lu lv it lx b ly no ju ma mb np jx md mr og mg mh ms oh mk ml mt oi mo mp mq im bi translated">训练模型是一行程序！只需将<code class="fe oc od oe of b">train_data</code>传递给<code class="fe oc od oe of b">train_model</code>函数。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="on oo l"/></div></figure><p id="bdc7" class="pw-post-body-paragraph lu lv it lx b ly lz ju ma mb mc jx md mr mf mg mh ms mj mk ml mt mn mo mp mq im bi translated">您还可以通过向<code class="fe oc od oe of b">train_model</code>方法传递一个包含相关属性的<code class="fe oc od oe of b">dict</code>来更改超参数。注意，这些修改<strong class="lx iu">将持续</strong>甚至在训练完成后。</p><p id="47c6" class="pw-post-body-paragraph lu lv it lx b ly lz ju ma mb mc jx md mr mf mg mh ms mj mk ml mt mn mo mp mq im bi translated"><code class="fe oc od oe of b">train_model</code>方法将在每<em class="lw"> n </em>步创建一个模型的检查点(保存)，其中<em class="lw"> n </em>为<code class="fe oc od oe of b">self.args['save_steps']</code>。训练完成后，最终模型将保存到<code class="fe oc od oe of b">self.args['output_dir']</code>。</p><h1 id="1e70" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">估价</h1><p id="d8c0" class="pw-post-body-paragraph lu lv it lx b ly no ju ma mb np jx md mr og mg mh ms oh mk ml mt oi mo mp mq im bi translated">dev 数据的正确答案没有在小队数据集中提供，但是我们可以将我们的预测上传到<a class="ae ky" href="https://rajpurkar.github.io/SQuAD-explorer/" rel="noopener ugc nofollow" target="_blank">小队</a>网站进行评估。或者，您可以将训练数据分成训练和验证数据集，并使用<code class="fe oc od oe of b">model.eval_model()</code>方法在本地验证模型。</p><p id="b5fd" class="pw-post-body-paragraph lu lv it lx b ly lz ju ma mb mc jx md mr mf mg mh ms mj mk ml mt mn mo mp mq im bi translated">对于本指南，我将简单地把预测上传到小队。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="on oo l"/></div></figure><p id="62b0" class="pw-post-body-paragraph lu lv it lx b ly lz ju ma mb mc jx md mr mf mg mh ms mj mk ml mt mn mo mp mq im bi translated">分解这些代码，我们读入开发数据，将其转换成正确的格式，获得模型预测，最后以所需的提交格式写入 JSON 文件。</p><h1 id="5188" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">结果</h1><p id="2120" class="pw-post-body-paragraph lu lv it lx b ly no ju ma mb np jx md mr og mg mh ms oh mk ml mt oi mo mp mq im bi translated">使用这些超参数获得的结果如下所示。</p><pre class="kj kk kl km gt op of oq or aw os bi"><span id="ce15" class="ot la it of b gy ou ov l ow ox">"exact": 67.24500968584182, <br/>"f1": 70.47401515405956, <br/>"total": 11873, <br/>"HasAns_exact": 64.1025641025641, <br/>"HasAns_f1": 70.56983500744732, <br/>"HasAns_total": 5928, <br/>"NoAns_exact": 70.3784693019344, <br/>"NoAns_f1": 70.3784693019344, <br/>"NoAns_total": 5945</span></pre><p id="a3d9" class="pw-post-body-paragraph lu lv it lx b ly lz ju ma mb mc jx md mr mf mg mh ms mj mk ml mt mn mo mp mq im bi translated">小队 2.0 是一个具有挑战性的基准，这反映在这些结果中。一些超参数调整应该会提高这些分数。同样，使用一个<code class="fe oc od oe of b">large</code>模型而不是<code class="fe oc od oe of b">base</code>模型也会显著提高结果。</p></div></div>    
</body>
</html>