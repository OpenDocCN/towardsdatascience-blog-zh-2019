<html>
<head>
<title>Feature selection in Python using the Filter method</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用过滤器方法在 Python 中选择要素</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/feature-selection-in-python-using-filter-method-7ae5cbc4ee05?source=collection_archive---------3-----------------------#2019-10-24">https://towardsdatascience.com/feature-selection-in-python-using-filter-method-7ae5cbc4ee05?source=collection_archive---------3-----------------------#2019-10-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9215" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated"><strong class="ak"> <em class="ki">在本文中，我们将使用 Pythons 中的过滤方法实现特征选择。这里我们将探讨包括相关性、互信息</em>和</strong>的过滤方法</h2></div><p id="72b2" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">先决条件:<a class="ae lf" href="https://medium.com/datadriveninvestor/feature-selection-identifying-the-best-input-features-2ba9c95b5cab" rel="noopener">功能选择理解</a></p><figure class="lh li lj lk gt ll gh gi paragraph-image"><div class="gh gi lg"><img src="../Images/5162c043daf944049ace8355f42b86c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1124/format:webp/1*0ddXtFfuLH7uQstkrLwaIQ.png"/></div></figure><h1 id="d4fa" class="lo lp it bd lq lr ls lt lu lv lw lx ly jz lz ka ma kc mb kd mc kf md kg me mf bi translated">特征选择的过滤方法</h1><p id="3ce4" class="pw-post-body-paragraph kj kk it kl b km mg ju ko kp mh jx kr ks mi ku kv kw mj ky kz la mk lc ld le im bi translated">过滤方法基于一些单变量度量对每个特征进行排名，然后选择排名最高的特征。一些单变量指标是</p><ul class=""><li id="d933" class="ml mm it kl b km kn kp kq ks mn kw mo la mp le mq mr ms mt bi translated"><strong class="kl iu">方差:</strong>去除常数和准常数特征</li><li id="a5c4" class="ml mm it kl b km mu kp mv ks mw kw mx la my le mq mr ms mt bi translated"><strong class="kl iu">卡方:</strong>用于分类。这是一种独立性的统计测试，用于确定两个变量的相关性。</li><li id="9eb3" class="ml mm it kl b km mu kp mv ks mw kw mx la my le mq mr ms mt bi translated"><strong class="kl iu">相关系数:</strong>删除重复特征</li><li id="bf37" class="ml mm it kl b km mu kp mv ks mw kw mx la my le mq mr ms mt bi translated"><strong class="kl iu">信息增益或互信息</strong>:评估自变量在预测目标变量时的相关性。换句话说，它决定了独立特征预测目标变量的能力</li></ul><h2 id="3961" class="mz lp it bd lq na nb dn lu nc nd dp ly ks ne nf ma kw ng nh mc la ni nj me nk bi translated">过滤方法的优势</h2><ul class=""><li id="11f9" class="ml mm it kl b km mg kp mh ks nl kw nm la nn le mq mr ms mt bi translated">过滤方法是模型不可知的</li><li id="bbe9" class="ml mm it kl b km mu kp mv ks mw kw mx la my le mq mr ms mt bi translated">完全依赖数据集中的特征</li><li id="e7e3" class="ml mm it kl b km mu kp mv ks mw kw mx la my le mq mr ms mt bi translated">计算速度非常快</li><li id="f3b8" class="ml mm it kl b km mu kp mv ks mw kw mx la my le mq mr ms mt bi translated">基于不同的统计方法</li></ul><h2 id="6f6a" class="mz lp it bd lq na nb dn lu nc nd dp ly ks ne nf ma kw ng nh mc la ni nj me nk bi translated">过滤方法的缺点</h2><ul class=""><li id="ce18" class="ml mm it kl b km mg kp mh ks nl kw nm la nn le mq mr ms mt bi translated">过滤方法着眼于单个特征，以确定其相对重要性。一个特性本身可能没什么用，但是当它与其他特性结合起来时，可能是一个重要的影响因素。过滤方法可能会遗漏这些特征。</li></ul><h2 id="c1b9" class="mz lp it bd lq na nb dn lu nc nd dp ly ks ne nf ma kw ng nh mc la ni nj me nk bi translated">选择最佳特征的过滤标准</h2><p id="9b4e" class="pw-post-body-paragraph kj kk it kl b km mg ju ko kp mh jx kr ks mi ku kv kw mj ky kz la mk lc ld le im bi translated">使用选择独立特征</p><ul class=""><li id="bc39" class="ml mm it kl b km kn kp kq ks mn kw mo la mp le mq mr ms mt bi translated">与目标变量高度相关</li><li id="37a2" class="ml mm it kl b km mu kp mv ks mw kw mx la my le mq mr ms mt bi translated">与另一个独立变量相关性低</li><li id="414e" class="ml mm it kl b km mu kp mv ks mw kw mx la my le mq mr ms mt bi translated">自变量的较高信息增益或互信息</li></ul><p id="e385" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">此处有可用的数据集<a class="ae lf" href="https://archive.ics.uci.edu/ml/datasets/Auto+MPG" rel="noopener ugc nofollow" target="_blank"/></p><p id="f419" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">导入所需的库</p><pre class="lh li lj lk gt no np nq nr aw ns bi"><span id="87f5" class="mz lp it np b gy nt nu l nv nw">import numpy as np<br/>import pandas as pd<br/>import matplotlib.pyplot as plt<br/>import seaborn as sns<br/>%matplotlib inline<br/>from sklearn.model_selection import train_test_split<br/><strong class="np iu">from sklearn.feature_selection import mutual_info_regression, mutual_info_classif</strong></span></pre><p id="55ca" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">读取数据集中的数据</p><pre class="lh li lj lk gt no np nq nr aw ns bi"><span id="9da6" class="mz lp it np b gy nt nu l nv nw">dataset= pd.read_csv(‘c:\\data\\auto-mpg.csv’)<br/>dataset.head(2)</span></pre><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="ny nz di oa bf ob"><div class="gh gi nx"><img src="../Images/e7059c7dd61d272921fdb593c74712e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8g_ThinSoFUxGGkbxHIFJw.png"/></div></div></figure><pre class="lh li lj lk gt no np nq nr aw ns bi"><span id="095c" class="mz lp it np b gy nt nu l nv nw">dataset.info()</span></pre><figure class="lh li lj lk gt ll gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/17157efb0db51bc7ad922f6d83cbb705.png" data-original-src="https://miro.medium.com/v2/resize:fit:872/format:webp/1*9IWYL616e-cOhzqy5-OIAg.png"/></div></figure><p id="4346" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">我们看到马力不是浮动的，但是上面的数据显示马力是数字的。</p><p id="6506" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">检查分类特征的存在</p><pre class="lh li lj lk gt no np nq nr aw ns bi"><span id="918b" class="mz lp it np b gy nt nu l nv nw">dataset.describe(include=’O’)</span></pre><figure class="lh li lj lk gt ll gh gi paragraph-image"><div class="gh gi od"><img src="../Images/15f411944faaa705c5942b533cc53643.png" data-original-src="https://miro.medium.com/v2/resize:fit:552/format:webp/1*cV9hSxI6dCCVqbGHuYXRsQ.png"/></div></figure><p id="6da1" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">将马力特性更新为 int 并用 0 填充所有空值</p><pre class="lh li lj lk gt no np nq nr aw ns bi"><span id="fc5d" class="mz lp it np b gy nt nu l nv nw">dataset[‘horsepower’] = pd.to_numeric(dataset[‘horsepower’], errors=’coerce’).fillna(0).astype(int)</span></pre><p id="3971" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">我们现在再次检查分类变量的存在</p><pre class="lh li lj lk gt no np nq nr aw ns bi"><span id="9f5d" class="mz lp it np b gy nt nu l nv nw">dataset.describe(include=’O’)</span></pre><figure class="lh li lj lk gt ll gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/c809233d8c0f366d1c9cb6e8471a72e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:330/format:webp/1*sqQtiYd77f4tJvLcC7m1SA.png"/></div></figure><p id="9883" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">我们看到马力不再是一个分类变量，汽车名称是唯一的分类变量。</p><p id="245a" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">为汽车名称创建一个 labelEncoder，用 0 和 n_classes-1 之间的值对汽车名称进行编码。在我们的例子中，汽车名称的 n _ classes 是 305</p><pre class="lh li lj lk gt no np nq nr aw ns bi"><span id="b55f" class="mz lp it np b gy nt nu l nv nw"><strong class="np iu">from sklearn.preprocessing import LabelEncoder</strong><br/>labelencoder = LabelEncoder()<br/><strong class="np iu">X_en= dataset.iloc[:, 8].values<br/>X_en = labelencoder.fit_transform(X_en)</strong></span></pre><p id="fa7b" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">创建输入要素 X 和目标变量 y</p><pre class="lh li lj lk gt no np nq nr aw ns bi"><span id="a8e7" class="mz lp it np b gy nt nu l nv nw">X= dataset.iloc[:,1:7]<br/>X[‘Car’] = X_en<br/>y= dataset.iloc[:,0].values</span></pre><p id="d929" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">在将所有输入要素转换为数字(包括目标变量)后，创建一个包含所有输入要素的数据集</p><pre class="lh li lj lk gt no np nq nr aw ns bi"><span id="352a" class="mz lp it np b gy nt nu l nv nw">full_data= X.copy()<br/>full_data[‘mpg’]= y<br/>full_data.head(2)</span></pre><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="ny nz di oa bf ob"><div class="gh gi of"><img src="../Images/e2bd20f9affc3ff0cf416756b314a78e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ye6CUqj09RCVVhg9E8Lk1w.png"/></div></div></figure><h2 id="5c5f" class="mz lp it bd lq na nb dn lu nc nd dp ly ks ne nf ma kw ng nh mc la ni nj me nk bi translated"><strong class="ak">应用过滤方法的步骤 1</strong></h2><p id="7ec5" class="pw-post-body-paragraph kj kk it kl b km mg ju ko kp mh jx kr ks mi ku kv kw mj ky kz la mk lc ld le im bi translated"><strong class="kl iu">识别与目标变量高度相关的输入特征。</strong></p><p id="3482" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">这里我们打印每个输入特征与目标变量的相关性</p><pre class="lh li lj lk gt no np nq nr aw ns bi"><span id="9770" class="mz lp it np b gy nt nu l nv nw"><strong class="np iu">importances = full_data.drop(“mpg”, axis=1).apply(lambda x: x.corr(full_data.mpg))</strong><br/>indices = np.argsort(importances)<br/>print(importances[indices])</span></pre><figure class="lh li lj lk gt ll gh gi paragraph-image"><div class="gh gi og"><img src="../Images/3cc085ce44629c05f930665f5da3e316.png" data-original-src="https://miro.medium.com/v2/resize:fit:536/format:webp/1*TgMWmiTyTFSLLI0xIbNR3Q.png"/></div></figure><p id="6ae2" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">绘制这些数据以便可视化</p><pre class="lh li lj lk gt no np nq nr aw ns bi"><span id="ef0c" class="mz lp it np b gy nt nu l nv nw"><strong class="np iu">names=['cylinders','displacement','horsepower','weight','acceleration','model year', 'car']<br/></strong>plt.title('Miles Per Gallon')<br/><strong class="np iu">plt.barh(range(len(indices)), importances[indices], color='g', align='center')</strong><br/>plt.yticks(range(len(indices)), [names[i] for i in indices])<br/>plt.xlabel('Relative Importance')<br/>plt.show()</span></pre><figure class="lh li lj lk gt ll gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/b87e54c15e8eb08e9209ebd61da88183.png" data-original-src="https://miro.medium.com/v2/resize:fit:1180/format:webp/1*oEJRhu1TiTj1npZbB0Q39Q.png"/></div></figure><p id="31d6" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">我们希望保留仅与目标变量高度相关的特征。这意味着输入特征对预测目标变量有很大的影响。</p><p id="6634" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">我们将阈值设置为绝对值 0.4。只有当输入特征与目标变量的相关性大于 0.4 时，我们才保留输入特征</p><pre class="lh li lj lk gt no np nq nr aw ns bi"><span id="2838" class="mz lp it np b gy nt nu l nv nw">for i in range(0, len(indices)):<br/>   <strong class="np iu"> if np.abs(importances[i])&gt;0.4:</strong><br/>        print(names[i])</span></pre><figure class="lh li lj lk gt ll gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/3db8e023d4841eb5915400d07c6c93da.png" data-original-src="https://miro.medium.com/v2/resize:fit:296/format:webp/1*UWdAYO_5jD7FErEeejCydQ.png"/></div><figcaption class="oj ok gj gh gi ol om bd b be z dk">Features with correlation &gt;0.4 with target variable</figcaption></figure><pre class="lh li lj lk gt no np nq nr aw ns bi"><span id="9d60" class="mz lp it np b gy nt nu l nv nw">X= dataset[ [‘cylinders’, ‘displacement’, ‘horsepower’, ‘weight’, ‘acceleration’, ‘model year’]]</span></pre><p id="9a3e" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">我们现在已经将输入特征从 7 个减少到 6 个。汽车名称被删除，因为它与 mpg(每加仑英里数)的相关性不高</p><h2 id="8733" class="mz lp it bd lq na nb dn lu nc nd dp ly ks ne nf ma kw ng nh mc la ni nj me nk bi translated">应用过滤方法的步骤 2</h2><p id="c7b6" class="pw-post-body-paragraph kj kk it kl b km mg ju ko kp mh jx kr ks mi ku kv kw mj ky kz la mk lc ld le im bi translated">识别与其他独立变量相关性较低的输入特征。</p><p id="d7d9" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">根据步骤 1 遍历所有过滤后的输入要素，并检查每个输入要素与所有其他输入要素的相关性。</p><p id="150a" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">我们将保留与其他输入要素不高度相关的输入要素</p><pre class="lh li lj lk gt no np nq nr aw ns bi"><span id="720a" class="mz lp it np b gy nt nu l nv nw">for i in range(0,len(X.columns)):<br/>    for j in  range(0,len(X.columns)):<br/>        if i!=j:<br/>            corr_1=np.abs(X[X.columns[i]].corr(X[X.columns[j]]))<br/>            <strong class="np iu">if corr_1 &lt;0.3:<br/>                print( X.columns[i] , " is not correlated  with ", X.columns[j])</strong><br/>            <strong class="np iu">elif corr_1&gt;0.75:<br/>                print( X.columns[i] , " is highly  correlated  with ", X.columns[j])</strong></span></pre><figure class="lh li lj lk gt ll gh gi paragraph-image"><div class="gh gi on"><img src="../Images/780c79ad7a0fc387993a37cb4763bd49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1206/format:webp/1*5-RdXuC3EGcHMpQgMeN6DQ.png"/></div></figure><p id="95ae" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">排量，马力，气缸，重量高度相关。我们将只保留其中的一个。</p><p id="0ae5" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">基于上述结果，我们保留气缸、加速度和车型年，并删除马力、排量和重量</p><pre class="lh li lj lk gt no np nq nr aw ns bi"><span id="4eda" class="mz lp it np b gy nt nu l nv nw">X= dataset[ [‘cylinders’, ‘acceleration’, ‘model year’]]</span></pre><h2 id="4275" class="mz lp it bd lq na nb dn lu nc nd dp ly ks ne nf ma kw ng nh mc la ni nj me nk bi translated">应用过滤方法的步骤 3</h2><p id="2430" class="pw-post-body-paragraph kj kk it kl b km mg ju ko kp mh jx kr ks mi ku kv kw mj ky kz la mk lc ld le im bi translated"><strong class="kl iu">求自变量相对于目标变量的信息增益或互信息</strong></p><pre class="lh li lj lk gt no np nq nr aw ns bi"><span id="83ea" class="mz lp it np b gy nt nu l nv nw">mi = mutual_info_regression(X, y)</span></pre><p id="1697" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">绘制交互信息</p><pre class="lh li lj lk gt no np nq nr aw ns bi"><span id="5481" class="mz lp it np b gy nt nu l nv nw">mi = pd.Series(mi)<br/>mi.index = X.columns<br/>mi.sort_values(ascending=False)<br/>mi.sort_values(ascending=False).plot.bar(figsize=(10, 4))</span></pre><figure class="lh li lj lk gt ll gh gi paragraph-image"><div role="button" tabindex="0" class="ny nz di oa bf ob"><div class="gh gi oo"><img src="../Images/46b5f7d6dce114c4f22c450d280d2a18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dwpOc6B_Tz-2Pvg8FQyx5w.png"/></div></div></figure><p id="df44" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">我们现在有了预测每加仑英里数的特征重要性。每加仑行驶的英里数可以根据汽车的汽缸数量、汽车制造年份和加速度来预测。</p><p id="d37c" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated"><strong class="kl iu">用于特征选择的过滤方法因此是模型不可知的，简单且易于解释</strong></p><p id="c0ee" class="pw-post-body-paragraph kj kk it kl b km kn ju ko kp kq jx kr ks kt ku kv kw kx ky kz la lb lc ld le im bi translated">代码可用<a class="ae lf" href="https://github.com/arshren/Feature-Selection/blob/master/Feature_Selection.ipynb" rel="noopener ugc nofollow" target="_blank">此处</a></p></div></div>    
</body>
</html>