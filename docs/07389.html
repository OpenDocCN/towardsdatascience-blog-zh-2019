<html>
<head>
<title>How to Create Multiple Worksheets From a List of Column Values and Delete Any Empty Columns Automatically Using R and VBA</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何从列值列表中创建多个工作表，并使用 R 和 VBA 自动删除任何空列</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/how-to-create-multiple-worksheets-from-a-list-of-column-values-and-delete-any-empty-columns-4b121b659164?source=collection_archive---------22-----------------------#2019-10-16">https://towardsdatascience.com/how-to-create-multiple-worksheets-from-a-list-of-column-values-and-delete-any-empty-columns-4b121b659164?source=collection_archive---------22-----------------------#2019-10-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/d85d706051791346862df9f621469d88.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q6guVMfyCOA0DQfmLjj-og.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">Photo by <a class="ae kf" href="https://unsplash.com/@zanilic?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Zan</a> on <a class="ae kf" href="https://unsplash.com/s/photos/software?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="1013" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">有时候，我们会面临一些我们认为非常容易解决的问题，但实际上在现实生活中并不那么容易。两个很好的例子是根据单元格值将一个大的工作表拆分成多个工作表，并为每个工作表删除大量的空列。让我更详细地解释给你听。</p></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><h1 id="2336" class="ll lm it bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated"><strong class="ak">有哪些问题？</strong></h1><figure class="mk ml mm mn gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mj"><img src="../Images/163fb4d235554779011d474188fab2bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9boRY7yesfjiVIobwKt1CA.png"/></div></div></figure><p id="8596" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">假设我们收到了一个这样的文件，并希望基于系列值创建多个工作表。共有 189 种不同的家庭价值观。手动执行这项任务或使用数据透视表效率不高，可能会导致一些内存问题。为此，我们将使用 R 和 VBA。</p><p id="80a7" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">此外，在分割工作表后，我们将通过删除任何空列来清理每个工作表。该文件有 1，044 列，有些工作表有超过 100 个不连续的空列。</p></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><h1 id="e2e4" class="ll lm it bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated"><strong class="ak"> 1。根据列值将一个大工作表拆分成多个工作表</strong></h1><p id="32dd" class="pw-post-body-paragraph kg kh it ki b kj mo kl km kn mp kp kq kr mq kt ku kv mr kx ky kz ms lb lc ld im bi translated">首先，我们导入数据并安装软件包。之后，我们检查 family 列中唯一值的数量，并设置工作目录，这样我们的文件就可以保存在一个地方。</p><pre class="mk ml mm mn gt mt mu mv mw aw mx bi"><span id="1e0d" class="my lm it mu b gy mz na l nb nc">install.packages('dplyr')<br/>library(dplyr)</span><span id="3007" class="my lm it mu b gy nd na l nb nc">#importing the file<br/>demo &lt;- read.csv("C:/Users/kewon-de/Desktop/tbd/demo.csv.txt", sep=";")</span><span id="2faf" class="my lm it mu b gy nd na l nb nc">#checking the # of values in the family column<br/>length(unique(demo[["family"]])) #189</span><span id="3f19" class="my lm it mu b gy nd na l nb nc"># setting the working directory<br/>setwd("C:/Users/kewon-de/Desktop/tbd")</span></pre><p id="e97a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">使用下面的 R 代码，我们可以根据列值快速创建多个工作表。该程序循环遍历列值(=族)列表，并创建多个数据框。这些数据框以后会变成工作表。</p><pre class="mk ml mm mn gt mt mu mv mw aw mx bi"><span id="4c64" class="my lm it mu b gy mz na l nb nc">for(i in (demo$family)) {<br/>  name &lt;- paste("demo", i, sep = ".")<br/>  assign(name, demo[demo$family==i,])<br/>}</span></pre><figure class="mk ml mm mn gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ne"><img src="../Images/1205a09a081d22bf4aa523a9a5fd8b9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WZys_TMeWEyYy-O_utc46A.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">data frames with empty columns</figcaption></figure></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><h1 id="6091" class="ll lm it bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated"><strong class="ak"> 2。删除任何空列</strong></h1><p id="f988" class="pw-post-body-paragraph kg kh it ki b kj mo kl km kn mp kp kq kr mq kt ku kv mr kx ky kz ms lb lc ld im bi translated">创建数据框后，我们现在可以检查是否有任何空列。首先，我们应该将所有数据帧放入一个列表中，这样我们就可以对列表应用一个函数(一次对所有数据帧应用函数)。下面的函数将去掉只有 na、null、无信息和 0 的列。在此之后，我们可以解压缩数据帧并验证列的数量——空列是否被正确删除。</p><pre class="mk ml mm mn gt mt mu mv mw aw mx bi"><span id="28b0" class="my lm it mu b gy mz na l nb nc">lst&lt;- <!-- -->mget(ls(pattern='^demo')) # putting 'demo' dataframes into a list</span><span id="60a6" class="my lm it mu b gy nd na l nb nc">output &lt;- lapply(lst, function(df) Filter(function(x)!all(is.na(x) || is.null(x) || x == "" || x == 0),df))</span><span id="83da" class="my lm it mu b gy nd na l nb nc">list2env(output,envir=.GlobalEnv)#unzipping the list</span></pre><p id="8e48" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在清理空列之前，有 1044 列。</p><figure class="mk ml mm mn gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nf"><img src="../Images/6312c1808477939e672a6220f071e9cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VinD25XKgAhwjbgsswBwKA.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">list of data frames before cleaning the empty columns</figcaption></figure><p id="0adf" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">清理后，数据帧的数量变为 13 至 19 列。</p><figure class="mk ml mm mn gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ng"><img src="../Images/3f1c53e41ec76f919adebe5dc8fb81ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vjjAUQwUhMwBdOvYi-hqhQ.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">list of data frames after cleaning the empty columns</figcaption></figure><figure class="mk ml mm mn gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nh"><img src="../Images/6afb9a77ad760995535ad6a87f90d829.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dLo7u-ay-F7rgEjBPma8Ng.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">clean data frames with no empty columns</figcaption></figure><p id="0df6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">解压缩列表时，干净的数据帧会替换旧的数据帧，如上所示。</p><ul class=""><li id="191f" class="ni nj it ki b kj kk kn ko kr nk kv nl kz nm ld nn no np nq bi translated">如果只想移除几个数据框的空列，可以使用此代码手动完成。</li></ul><pre class="mk ml mm mn gt mt mu mv mw aw mx bi"><span id="f1cb" class="my lm it mu b gy mz na l nb nc">demo.acc_consoles &lt;- Filter(function(x)!all(is.na(x) || is.null(x) || x == "" || x == 0), demo.acc_consoles)</span></pre></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><h1 id="33d5" class="ll lm it bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">3.将干净的数据帧导出为 CSV 格式</h1><p id="11c5" class="pw-post-body-paragraph kg kh it ki b kj mo kl km kn mp kp kq kr mq kt ku kv mr kx ky kz ms lb lc ld im bi translated">既然所有的数据帧都是干净的，我们可以使用下面的代码将它们导出为 CSV 文件。</p><pre class="mk ml mm mn gt mt mu mv mw aw mx bi"><span id="1032" class="my lm it mu b gy mz na l nb nc">install.packages("xlsx")<br/>library(xlsx)<br/>for(i in names(output)){<br/>  write.xlsx(output[[i]], paste0(i,".xlsx"),sheetName = i)<br/>}</span></pre><p id="fb86" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下面是在 r 中曾经是数据帧的 CSV 文件。</p><figure class="mk ml mm mn gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nr"><img src="../Images/9d3db1519f726229a1316a5ba2d97f54.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9tevNxMZTwLXxeq9lwd-Lw.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">data frames in CSV</figcaption></figure></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><h1 id="3ee4" class="ll lm it bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated">4.将 Excel 文件合并成一个文件</h1><p id="90ad" class="pw-post-body-paragraph kg kh it ki b kj mo kl km kn mp kp kq kr mq kt ku kv mr kx ky kz ms lb lc ld im bi translated">文件夹里有多个 excel 文件就没那么方便了；我们不能浏览产品。让我们用 VBA 把所有的 excel 文件合并成一个，这样我们就不用一次又一次地打开文件了。</p><p id="d9c7" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在 excel 中，进入<strong class="ki iu">文件</strong>，点击<strong class="ki iu">选项</strong>，添加<strong class="ki iu">开发者。</strong></p><figure class="mk ml mm mn gt ju gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/b20be333e66b57b08de8633bda714993.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/0*nzFYmOUWb1Ik6K40.gif"/></div></figure><p id="1fda" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当 VBA 屏幕弹出时，右击<strong class="ki iu"> Sheet1 </strong>并插入<strong class="ki iu">模块。</strong></p><figure class="mk ml mm mn gt ju gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/39beb937371a6e22b0052bd2f48e7f03.png" data-original-src="https://miro.medium.com/v2/resize:fit:896/format:webp/0*v5xiMpmKRaSFCUNx.png"/></div></figure><p id="d486" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当模块弹出时，在屏幕上插入以下代码，并单击绿色箭头按钮运行代码。不要忘记添加您自己的 excel 文件所在的路径。</p><pre class="mk ml mm mn gt mt mu mv mw aw mx bi"><span id="d693" class="my lm it mu b gy mz na l nb nc">Sub GetSheets()<br/>Path = "insert your own path here"<br/>Filename = Dir(Path &amp; "*.xls")<br/>Do While Filename &lt;&gt; ""<br/>Workbooks.Open Filename:=Path &amp; Filename, ReadOnly:=True<br/>For Each Sheet In ActiveWorkbook.Sheets<br/>Sheet.Copy After:=ThisWorkbook.Sheets(1)<br/>Next Sheet<br/>Workbooks(Filename).Close<br/>Filename = Dir()<br/>Loop<br/>End Sub</span></pre><figure class="mk ml mm mn gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nu"><img src="../Images/fc9983cb9282f0725d32225d39bb8bcd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uNjhXTh7fmXKVLOI3uI-RA.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">module</figcaption></figure><p id="8028" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">运行代码时，文件夹中的 excel 文件会自动合并成一个。</p><figure class="mk ml mm mn gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nv"><img src="../Images/16135c1f47dc2f5c08c7ef20db2bc583.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KzhAWI7Gzi6te_YJHnBqBA.png"/></div></div></figure><p id="aa67" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最后，我们有一个包含 189 个工作表的 excel 文件，中间没有空列。</p></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><p id="b51f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">本文分为两个部分:1)如何基于列值创建多个工作表 2)如何删除不连续的空列。您可以根据自己的需要简单地选择一个部分。</p></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><p id="9d28" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">谢谢你看我的文章！如果你喜欢我所做的，不要犹豫，在<a class="ae kf" href="https://github.com/dkewon" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上关注我，在<a class="ae kf" href="https://www.linkedin.com/in/deborah-kewon/" rel="noopener ugc nofollow" target="_blank"> Linkedin </a>上与我联系。</p><p id="fe4e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">另外，请随意查看我的其他文章:</p><p id="9dad" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae kf" rel="noopener" target="_blank" href="/how-to-get-twitter-notifications-on-currency-exchange-rate-web-scraping-and-automation-94a7eb240d60">如何获得关于货币汇率的 Twitter 通知:网络抓取和自动化</a></p><p id="e4d6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae kf" rel="noopener" target="_blank" href="/databricks-how-to-save-files-in-csv-on-your-local-computer-3d0c70e6a9ab">数据块:如何在本地计算机上将数据帧保存为 CSV 文件</a></p><p id="7618" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae kf" href="https://medium.com/@deborahkewon/extracting-information-from-a-text-in-5-minutes-using-r-regex-520a859590de" rel="noopener">使用 R Regex (Easy)从文本中提取关键字</a></p></div></div>    
</body>
</html>