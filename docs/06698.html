<html>
<head>
<title>Use Apache Drill with Spring Boot or Java to query data using SQL queries</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过 Spring Boot 或 Java 使用 Apache Drill，使用 SQL 查询来查询数据</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/use-apache-drill-with-spring-boot-or-java-to-query-data-using-sql-queries-f6e186a5f31?source=collection_archive---------32-----------------------#2019-09-24">https://towardsdatascience.com/use-apache-drill-with-spring-boot-or-java-to-query-data-using-sql-queries-f6e186a5f31?source=collection_archive---------32-----------------------#2019-09-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><blockquote class="jn jo jp"><p id="cbd8" class="jq jr js jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ij bi translated">原文发布于此:<a class="ae kp" href="https://blog.contactsunny.com/tech/use-apache-drill-with-spring-boot-or-java-to-query-data-using-sql-queries" rel="noopener ugc nofollow" target="_blank">https://blog . contact sunny . com/tech/use-Apache-drill-with-spring-boot-or-Java-to-query-data-using-SQL-queries</a></p></blockquote><p id="84e4" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">在过去的几篇文章中，我们看到了如何将 Apache <a class="ae kp" href="https://blog.contactsunny.com/tech/getting-started-with-apache-drill-and-mongodb" rel="noopener ugc nofollow" target="_blank"> Drill 与 MongoDB </a>连接起来，以及如何将<a class="ae kp" href="https://blog.contactsunny.com/tech/analyse-kafka-messages-with-sql-queries-using-apache-drill" rel="noopener ugc nofollow" target="_blank">与 Kafka </a>连接起来，使用简单的 SQL 查询来查询数据。但是，当您想将它应用到实际的项目中时，您不能整天坐在那里从终端查询数据。你想写一段代码来替你做脏活。但是如何在代码中使用 Apache Drill 呢？今天，我们将看看如何用 Spring Boot 或几乎任何其他 Java 程序来实现这一点。</p><figure class="ku kv kw kx gt ky gh gi paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="gh gi kt"><img src="../Images/1cfbec7fd14daf6a7e5d1fc9e83c74b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6beeUrjFo9s4GZcOVHGvhw.png"/></div></div></figure></div><div class="ab cl lf lg hu lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="ij ik il im in"><h1 id="981c" class="lm ln iq bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">依赖关系</h1><p id="40a3" class="pw-post-body-paragraph jq jr iq jt b ju mk jw jx jy ml ka kb kq mm ke kf kr mn ki kj ks mo km kn ko ij bi translated">对于这个概念验证，我将编写一个简单的 Spring Boot CommandLineRunner 程序。但是您可以使用几乎任何其他 Java 框架或普通的 Java 代码来实现这一点。如果你有一个依赖管理工具，比如 Maven 或者 Gradle，你可以在项目中添加依赖，然后继续编码。否则，可以添加所需的<em class="js">。jar </em>文件到类路径，这样应该就可以了。所有需要的<em class="js">。jar </em>文件随 Apache Drill 的发行版一起提供。</p><p id="a113" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">这个项目我们会和 Maven 一起去。在项目的<em class="js"> pom.xml </em>文件的<em class="js">依赖项</em>部分中添加以下 Drill 依赖项。</p><pre class="ku kv kw kx gt mp mq mr ms aw mt bi"><span id="fa5b" class="mu ln iq mq b gy mv mw l mx my">&lt;dependency&gt;<br/>	&lt;groupId&gt;org.apache.drill.exec&lt;/groupId&gt;<br/>	&lt;artifactId&gt;drill-jdbc-all&lt;/artifactId&gt;<br/>	&lt;version&gt;1.16.0&lt;/version&gt;<br/>&lt;/dependency&gt;</span></pre><p id="6cbd" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">这种依赖性在 Maven 中央存储库中是可用的，因此您不需要添加任何额外的存储库。</p></div><div class="ab cl lf lg hu lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="ij ik il im in"><h1 id="c19f" class="lm ln iq bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">代码</h1><p id="b3b4" class="pw-post-body-paragraph jq jr iq jt b ju mk jw jx jy ml ka kb kq mm ke kf kr mn ki kj ks mo km kn ko ij bi translated">现在让我们开始有趣的部分。首先，我们需要在 Java 代码中加载 Drill JDBC 驱动程序。为此，我们将使用<em class="js"> Class.forName() </em>方法:</p><pre class="ku kv kw kx gt mp mq mr ms aw mt bi"><span id="a4a8" class="mu ln iq mq b gy mv mw l mx my">Class.forName("org.apache.drill.jdbc.Driver");</span></pre><p id="15a2" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">接下来，我们需要使用 DriverManager 和 Drill JDBC 连接字符串创建一个连接。如果您使用 Apache Drill 的独立本地实例，则需要使用以下连接字符串:</p><pre class="ku kv kw kx gt mp mq mr ms aw mt bi"><span id="cc2d" class="mu ln iq mq b gy mv mw l mx my">jdbc:drill:drillbit=localhost</span></pre><p id="701d" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">如果您将 Drill 与 Zookeeper 一起使用，则必须使用以下连接字符串:</p><pre class="ku kv kw kx gt mp mq mr ms aw mt bi"><span id="18b1" class="mu ln iq mq b gy mv mw l mx my"><em class="js">jdbc:drill:zk=local</em></span></pre><p id="1810" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">因为我使用的是本地实例，所以我将创建一个连接来进行如下钻取:</p><pre class="ku kv kw kx gt mp mq mr ms aw mt bi"><span id="1e12" class="mu ln iq mq b gy mv mw l mx my">Connection connection = DriverManager.getConnection("jdbc:drill:drillbit=localhost");</span></pre><p id="ff28" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">接下来，我们需要创建一个<em class="js">语句</em>对象，使用它我们将运行实际的查询。一旦我们有了对象，我们将使用<em class="js">。executeQuery() </em>方法在对象上得到我们的<em class="js"> ResultSet </em>:</p><pre class="ku kv kw kx gt mp mq mr ms aw mt bi"><span id="80bc" class="mu ln iq mq b gy mv mw l mx my">Statement statement = connection.createStatement();<br/>ResultSet resultSet = statement.executeQuery("select * from kafka.`drill` limit 10");</span></pre><p id="aa8a" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">我使用了与前面的 MongoDB 和 Kafka 示例相同的数据集和示例。</p><p id="f194" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">从上面的例子可以看出，我们从 Kafka 主题<em class="js"> drill 中获取数据。</em>让我们看看如何访问数据:</p><pre class="ku kv kw kx gt mp mq mr ms aw mt bi"><span id="297f" class="mu ln iq mq b gy mv mw l mx my">while(resultSet.next()){<br/>    logger.info("ID: " + resultSet.getString(1));<br/>    logger.info("First Name: " + resultSet.getString(2));<br/>    logger.info("Last Name: " + resultSet.getString(3));<br/>    logger.info("Email: " + resultSet.getString(4));<br/>    logger.info("Gender: " + resultSet.getString(5));<br/>    logger.info("IP Address: " + resultSet.getString(6));<br/>    logger.info("----------------------------------");<br/>}</span></pre><p id="705c" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">接下来，让我们查询一个 MongoDB 数据库并从中获取一些数据:</p><pre class="ku kv kw kx gt mp mq mr ms aw mt bi"><span id="26e2" class="mu ln iq mq b gy mv mw l mx my">resultSet = statement.executeQuery("select * from mongo.drill.sampleData limit 10");</span></pre><p id="189d" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">我们可以使用上面相同的<em class="js"> while() </em>循环来打印数据。</p><p id="fcca" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">差不多就是这样。我们现在能够在 Java 程序中使用 Apache Drill 作为简单的 JDBC 源，从 Drill 支持的任何源获取数据。您可以对复杂的 SQL 查询进行同样的尝试，看看 Drill 是如何工作的。</p><p id="bc76" class="pw-post-body-paragraph jq jr iq jt b ju jv jw jx jy jz ka kb kq kd ke kf kr kh ki kj ks kl km kn ko ij bi translated">如果你对这个例子中完整的 Spring Boot 项目感兴趣，你可以在<a class="ae kp" href="https://github.com/contactsunny/ApacheDrillSpringBootPOC" rel="noopener ugc nofollow" target="_blank">我的 GitHub 简介</a>上查看。</p></div></div>    
</body>
</html>