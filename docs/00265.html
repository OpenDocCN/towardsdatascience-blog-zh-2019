<html>
<head>
<title>Building a Conversational Chatbot for Slack using Rasa and Python -Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Rasa 和 Python 为 Slack 构建对话聊天机器人——第 2 部分</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/building-a-conversational-chatbot-for-slack-using-rasa-and-python-part-2-ce7233f2e9e7?source=collection_archive---------2-----------------------#2019-01-12">https://towardsdatascience.com/building-a-conversational-chatbot-for-slack-using-rasa-and-python-part-2-ce7233f2e9e7?source=collection_archive---------2-----------------------#2019-01-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5494" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">在 Slack 上部署 Rasa 聊天机器人的指南</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/6042de93d3ba4a0c991a69a4e10e8bed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4AhYkUirnkFeawmeQ4g54Q.jpeg"/></div></div></figure><blockquote class="ku kv kw"><p id="239d" class="kx ky kz la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu"> <em class="it">注意:这篇文章是很久以前写的，RASA 可能会有变化，但这些变化并没有纳入本文。建议访问他们的官方文档网站，了解最新的详细信息。</em>T3】</strong></p></blockquote><blockquote class="lu"><p id="934a" class="lv lw it bd lx ly lz ma mb mc md lt dk translated">"松弛度又下降了，所以同事们不得不互相交谈"。</p></blockquote><p id="75d2" class="pw-post-body-paragraph kx ky it la b lb me ju ld le mf jx lg mg mh lj lk mi mj ln lo mk ml lr ls lt im bi translated"><em class="kz">当 slack 在 2018 年年中暂时关闭时，整个科技世界陷入了混乱和混乱。互联网上充斥着关于 slack 的讨论，Twitter 上也出现了 Slack #的流行趋势。嗯，slack 已经成为许多公司不可或缺的一部分，人们经常用它来交流和讨论事情。一些远程工作的公司一直使用 slack 进行实时通信。</em></p></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h1 id="c6b6" class="mt mu it bd mv mw mx my mz na nb nc nd jz ne ka nf kc ng kd nh kf ni kg nj nk bi translated">我们离开的地方</h1><p id="d495" class="pw-post-body-paragraph kx ky it la b lb nl ju ld le nm jx lg mg nn lj lk mi no ln lo mk np lr ls lt im bi translated">这是文章的结论部分:<a class="ae nq" rel="noopener" target="_blank" href="/building-a-conversational-chatbot-for-slack-using-rasa-and-python-part-1-bca5cc75d32f"> <strong class="la iu">使用 Rasa 和 Python 为 Slack 构建对话聊天机器人——第 1 部分</strong> </a> <strong class="la iu">。</strong>在第一部分中，我们详细讨论了关于<strong class="la iu"> Rasa Stack </strong>:一个开源的机器学习工具包，它让开发人员可以扩展机器人，而不仅仅是回答简单的问题。然后，我们使用 Rasa 的两个模块，即<strong class="la iu"> Rasa NLU </strong>和<strong class="la iu"> Rasa Cor </strong> e，构建了一个功能齐全的聊天机器人，能够检查人们的情绪，并采取必要的行动让他们振作起来。这些动作包括根据用户的选择向用户展示狗、猫或鸟的图像。</p></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h1 id="8eff" class="mt mu it bd mv mw mx my mz na nb nc nd jz ne ka nf kc ng kd nh kf ni kg nj nk bi translated">目标</h1><p id="4d83" class="pw-post-body-paragraph kx ky it la b lb nl ju ld le nm jx lg mg nn lj lk mi no ln lo mk np lr ls lt im bi translated">在本文中，我们将利用所有生成的文件在 slack 上部署 Bot。我强烈建议你在尝试<strong class="la iu">第二部分</strong>之前，先阅读<strong class="la iu">第一部分</strong>。</p></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h1 id="e5eb" class="mt mu it bd mv mw mx my mz na nb nc nd jz ne ka nf kc ng kd nh kf ni kg nj nk bi translated">Rasa 装置</h1><ul class=""><li id="98f8" class="nr ns it la b lb nl le nm mg nt mi nu mk nv lt nw nx ny nz bi translated">与前一部分不同，我们将不得不安装最新版本的 Rasa 核心。强烈建议您创建一个虚拟环境，然后继续安装</li></ul><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="1628" class="of mu it ob b gy og oh l oi oj">#<strong class="ob iu">creating a virtual environment</strong><br/>conda create --name bot python=3.6</span><span id="7fb5" class="of mu it ob b gy ok oh l oi oj"><strong class="ob iu">#Activate the new environment to use it</strong></span><span id="2f55" class="of mu it ob b gy ok oh l oi oj">WINDOWS: activate bot<br/>LINUX, macOS: source activate bot</span><span id="277e" class="of mu it ob b gy ok oh l oi oj">#<strong class="ob iu">Install latest Rasa stack</strong><br/><strong class="ob iu">#Rasa NLU</strong><br/>python -m pip install rasa_nlu[spacy] (<a class="ae nq" href="https://rasa.com/docs/nlu/installation/" rel="noopener ugc nofollow" target="_blank">https://rasa.com/docs/nlu/installation/</a>)</span><span id="ea99" class="of mu it ob b gy ok oh l oi oj"><strong class="ob iu">#Rasa Core</strong><br/>python -m pip install -U rasa_core <br/>(<a class="ae nq" href="https://rasa.com/docs/core/installation/" rel="noopener ugc nofollow" target="_blank">https://rasa.com/docs/core/installation/</a>)</span><span id="01e2" class="of mu it ob b gy ok oh l oi oj"><strong class="ob iu">#Language Model</strong></span><span id="7ff5" class="of mu it ob b gy ok oh l oi oj">python -m spacy download en_core_web_md<br/>python -m spacy link en_core_web_md en --force;</span></pre><ul class=""><li id="63b2" class="nr ns it la b lb lc le lf mg ol mi om mk on lt nw nx ny nz bi translated">克隆我的<a class="ae nq" href="https://github.com/parulnith/Building-a-Conversational-Chatbot-for-Slack-using-Rasa-and-Python" rel="noopener ugc nofollow" target="_blank"> GitHub 库</a>。</li></ul><p id="0afe" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg mg li lj lk mi lm ln lo mk lq lr ls lt im bi translated">存储库包含第 1 部分中生成的文件。但是，由于 Rasa API w.r.t 版本的一些变化，函数和命令也有一些变化。</p><h1 id="001a" class="mt mu it bd mv mw oo my mz na op nc nd jz oq ka nf kc or kd nh kf os kg nj nk bi translated">设置</h1><p id="deeb" class="pw-post-body-paragraph kx ky it la b lb nl ju ld le nm jx lg mg nn lj lk mi no ln lo mk np lr ls lt im bi translated">让我们通过创建一个 slack 应用程序来创建一个 slack 集成。让我们来看看创建一个 Slack 应用程序的过程。</p><ul class=""><li id="585f" class="nr ns it la b lb lc le lf mg ol mi om mk on lt nw nx ny nz bi translated">创建一个呆滞账户并转到<a class="ae nq" href="https://api.slack.com/" rel="noopener ugc nofollow" target="_blank"><strong class="la iu">https://api.slack.com/</strong></a>。现在选择一个现有的开发松弛工作空间(如果你有)或者创建一个新的。将其命名为<strong class="la iu"> DemoWorkplace </strong>或者任何你喜欢的名字。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ot"><img src="../Images/a483a575e3ff0a43905412650ed02ff1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*nNCR8wmXVkQOAZJ7BTEspg.gif"/></div></div><figcaption class="ou ov gj gh gi ow ox bd b be z dk">DemoWorkplace creation</figcaption></figure><ul class=""><li id="3a06" class="nr ns it la b lb lc le lf mg ol mi om mk on lt nw nx ny nz bi translated">现在在<strong class="la iu"> DemoWorkplace </strong>中创建一个 Slack 应用，并给它命名。我们把自己的 app 叫做<strong class="la iu"> Robo </strong>。</li><li id="f859" class="nr ns it la b lb oy le oz mg pa mi pb mk pc lt nw nx ny nz bi translated">开始向应用程序添加特性和功能。我们将首先在<code class="fe pd pe pf ob b"> <strong class="la iu">Bots Tab</strong></code>下创建一个<code class="fe pd pe pf ob b"><strong class="la iu">bot</strong> <strong class="la iu">user</strong></code>，并将其集成到应用程序中。这将使应用程序对话。由于这个机器人将被创建为用户，我们可以选择让它一直在线。保存所做的所有更改。</li><li id="2a60" class="nr ns it la b lb oy le oz mg pa mi pb mk pc lt nw nx ny nz bi translated">为了确保机器人已经被集成，导航到<code class="fe pd pe pf ob b">Basic Information Tab</code>下的<code class="fe pd pe pf ob b"> Add Features and Functionality</code>，并确保<code class="fe pd pe pf ob b">Bots</code>和<code class="fe pd pe pf ob b">Permissions</code>选项卡处于活动状态。我们的机器人已经集成到应用程序中。</li><li id="ff9a" class="nr ns it la b lb oy le oz mg pa mi pb mk pc lt nw nx ny nz bi translated">接下来，我们可以添加一些关于我们机器人的信息，包括图片，描述和背景颜色。滚动到<code class="fe pd pe pf ob b">Display Information</code>并添加信息。</li><li id="dfcf" class="nr ns it la b lb oy le oz mg pa mi pb mk pc lt nw nx ny nz bi translated">保存您进行的所有更改。</li><li id="b572" class="nr ns it la b lb oy le oz mg pa mi pb mk pc lt nw nx ny nz bi translated">最后，我们需要<strong class="la iu">将这个应用程序安装到我们之前定义的工作场所</strong>中。授权它，我们已经准备好我们的应用程序，并集成到工作场所。</li></ul><p id="f1df" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg mg li lj lk mi lm ln lo mk lq lr ls lt im bi translated">这个过程总结在下面的 gif 中。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pg"><img src="../Images/e44824a6fbe94a8512f1837ba3c36d64.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*1rt-S7oYGltwv4ST3Z6QDw.gif"/></div></div><figcaption class="ou ov gj gh gi ow ox bd b be z dk">Adding Robo App to the DemoWorkplace</figcaption></figure><h2 id="a94a" class="of mu it bd mv ph pi dn mz pj pk dp nd mg pl pm nf mi pn po nh mk pp pq nj pr bi translated">Ngrok</h2><p id="6aa6" class="pw-post-body-paragraph kx ky it la b lb nl ju ld le nm jx lg mg nn lj lk mi no ln lo mk np lr ls lt im bi translated">Ngrok 是一种多平台隧道、反向代理软件，可建立从公共端点(如互联网)到本地运行的网络服务的安全隧道。简而言之，这意味着，它可以从互联网上访问您的本地应用程序。</p><ul class=""><li id="812e" class="nr ns it la b lb lc le lf mg ol mi om mk on lt nw nx ny nz bi translated">从<a class="ae nq" href="https://dashboard.ngrok.com/get-started" rel="noopener ugc nofollow" target="_blank">这里</a>下载 ngrok。确保您首先登录。</li><li id="b7d8" class="nr ns it la b lb oy le oz mg pa mi pb mk pc lt nw nx ny nz bi translated">通过<code class="fe pd pe pf ob b">$ unzip /path/to/ngrok.zip</code>解压安装</li><li id="3299" class="nr ns it la b lb oy le oz mg pa mi pb mk pc lt nw nx ny nz bi translated">通过<code class="fe pd pe pf ob b">$ ./ngrok &lt;authtoken&gt;</code>连接您的账户</li></ul><p id="70cb" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg mg li lj lk mi lm ln lo mk lq lr ls lt im bi translated">导航到解压 ngrok 的目录，并在控制台中键入<code class="fe pd pe pf ob b">$ ngrok &lt;authtoken&gt; </code>。令牌可以从这里的<a class="ae nq" href="https://dashboard.ngrok.com/auth" rel="noopener ugc nofollow" target="_blank">访问</a>。</p><ul class=""><li id="5fcd" class="nr ns it la b lb lc le lf mg ol mi om mk on lt nw nx ny nz bi translated">点燃它。</li></ul><p id="fb98" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg mg li lj lk mi lm ln lo mk lq lr ls lt im bi translated">首先告诉它我们想要向公共互联网公开哪个端口:<code class="fe pd pe pf ob b">./ngrok http 5004</code></p><p id="1919" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg mg li lj lk mi lm ln lo mk lq lr ls lt im bi translated">如果一切顺利，您应该会看到以下屏幕:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ps"><img src="../Images/121da084fe8be41236f7ab590f1d8df7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bT9JXaKSwG-iP0qhhh3qNw.png"/></div></div></figure><p id="0d11" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg mg li lj lk mi lm ln lo mk lq lr ls lt im bi translated"><strong class="la iu">这里的</strong><a class="ae nq" href="http://-------.ngrok.io" rel="noopener ugc nofollow" target="_blank"><strong class="la iu">http://-. ngrok . io</strong></a><strong class="la iu">是 ngrok 的网址。</strong></p></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><h1 id="0219" class="mt mu it bd mv mw mx my mz na nb nc nd jz ne ka nf kc ng kd nh kf ni kg nj nk bi translated">在空闲时部署机器人</h1><ul class=""><li id="3599" class="nr ns it la b lb nl le nm mg nt mi nu mk nv lt nw nx ny nz bi translated"><strong class="la iu">创建一个 Python 脚本</strong></li></ul><p id="71d8" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg mg li lj lk mi lm ln lo mk lq lr ls lt im bi translated">既然我们已经完成了所有的需求，是时候部署我们的机器人了。为此，我们将需要编写一个名为<code class="fe pd pe pf ob b"><strong class="la iu">run_app.py</strong></code>的 Python 脚本，它将把我们的聊天机器人与我们上面创建的 slack 应用程序集成在一起。我们将首先为我们的 Rasa 聊天机器人创建一个 slack 连接器。我们将使用 RasaNLU 解释器直接从 python 脚本加载 NLU 模型。</p><p id="3cb9" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg mg li lj lk mi lm ln lo mk lq lr ls lt im bi translated">我们将再次训练我们的模型，以确保一切正常运行。</p><h2 id="77a2" class="of mu it bd mv ph pi dn mz pj pk dp nd mg pl pm nf mi pn po nh mk pp pq nj pr bi translated">培训 NLU 模型</h2><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="7482" class="of mu it ob b gy og oh l oi oj">python nlu_model.py</span></pre><h2 id="a401" class="of mu it bd mv ph pi dn mz pj pk dp nd mg pl pm nf mi pn po nh mk pp pq nj pr bi translated">培训 Rasa 核心模型</h2><p id="aeeb" class="pw-post-body-paragraph kx ky it la b lb nl ju ld le nm jx lg mg nn lj lk mi no ln lo mk np lr ls lt im bi translated">我们在第 1 部分中创建的 actions 文件现在需要在单独的服务器上运行。这是 Rasa Core 最新版本的一个变化。有关更多详细信息，请阅读文档。</p><ul class=""><li id="d3ac" class="nr ns it la b lb lc le lf mg ol mi om mk on lt nw nx ny nz bi translated">启动自定义操作服务器</li></ul><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="4745" class="of mu it ob b gy og oh l oi oj">python -m rasa_core_sdk.endpoint --actions actions</span></pre><ul class=""><li id="e632" class="nr ns it la b lb lc le lf mg ol mi om mk on lt nw nx ny nz bi translated">打开一个新的终端并训练 Rasa 核心模型</li></ul><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="85de" class="of mu it ob b gy og oh l oi oj">python dialogue_management_model.py</span></pre><ul class=""><li id="1736" class="nr ns it la b lb lc le lf mg ol mi om mk on lt nw nx ny nz bi translated">通过运行<code class="fe pd pe pf ob b"><strong class="la iu">run_app.py</strong></code>文件启动代理。确保在脚本中提供松弛令牌。可以如下获得松弛令牌。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pt"><img src="../Images/a48a7820170e1630acec7ad365b3eabf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uk7yMSxZF4rh5EtJ6t5v-A.png"/></div></div></figure><ul class=""><li id="362d" class="nr ns it la b lb lc le lf mg ol mi om mk on lt nw nx ny nz bi translated">在端口 5004 上启动 ngrok 并获取您的 ngrok_url。</li><li id="6ee4" class="nr ns it la b lb oy le oz mg pa mi pb mk pc lt nw nx ny nz bi translated">将 URL:<a class="ae nq" href="https://your_ngrok_url/webhooks/slack/webhook" rel="noopener ugc nofollow" target="_blank">https://&lt;your _ ngrok _ URL&gt;/web hooks/slack/web hook</a>提供给 Slack 配置的“事件订阅”页面。等待验证。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pu"><img src="../Images/9305c64bb0ca60c8219e36f2333205ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ydEFYvryqh6jtKdKRQPmKQ.png"/></div></div></figure><ul class=""><li id="f2ba" class="nr ns it la b lb lc le lf mg ol mi om mk on lt nw nx ny nz bi translated">最后，<code class="fe pd pe pf ob b"><strong class="la iu">subscribe to some Workplace event</strong>s</code>喜欢:</li></ul><p id="122e" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg mg li lj lk mi lm ln lo mk lq lr ls lt im bi translated">当有人提到它的名字时，我们的机器人会做出反应</p><p id="d186" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg mg li lj lk mi lm ln lo mk lq lr ls lt im bi translated"><strong class="la iu"> message_im </strong>允许用户直接向机器人发送消息。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pv"><img src="../Images/ba54c52f10a81e6622aa56b3fe18e7fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kEz2c8NUgdkG6WqVQKMpyg.png"/></div></div></figure><ul class=""><li id="924e" class="nr ns it la b lb lc le lf mg ol mi om mk on lt nw nx ny nz bi translated">请确保保存您进行的所有更改</li></ul><h1 id="63f9" class="mt mu it bd mv mw oo my mz na op nc nd jz oq ka nf kc or kd nh kf os kg nj nk bi translated">我们谈谈吧</h1><pre class="kj kk kl km gt oa ob oc od aw oe bi"><span id="f908" class="of mu it ob b gy og oh l oi oj">Ensure the custom actions server is running</span><span id="7db0" class="of mu it ob b gy ok oh l oi oj">Ensure ngrok is running on port 5004</span><span id="bf8b" class="of mu it ob b gy ok oh l oi oj">Navigate to Slack interface and talk to your bot</span></pre><p id="8671" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg mg li lj lk mi lm ln lo mk lq lr ls lt im bi translated">这听起来可能是一项艰巨的任务，但如果你一步一步地遵循它，你最终将能够立即创建一个名为 Robo 的工作 slackbot。你可以和你的机器人聊天，就像我一样:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pw"><img src="../Images/780599cc2efcea2fd6224564d3984088.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*qC3XZjVuG3LI4ZejaW98Ew.gif"/></div></div></figure><h1 id="ae1e" class="mt mu it bd mv mw oo my mz na op nc nd jz oq ka nf kc or kd nh kf os kg nj nk bi translated">结论</h1><p id="2dda" class="pw-post-body-paragraph kx ky it la b lb nl ju ld le nm jx lg mg nn lj lk mi no ln lo mk np lr ls lt im bi translated">这是一个相当全面的教程，但事实上，我们能够建立一个全功能的 Slackbot 使得所有的努力都是值得的。Rasa 是一个非常有用的库，你可以试验和修改它来创建一些真正有用的聊天机器人。</p></div><div class="ab cl mm mn hx mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="im in io ip iq"><p id="f228" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg mg li lj lk mi lm ln lo mk lq lr ls lt im bi translated">在此阅读第 1 部分<a class="ae nq" rel="noopener" target="_blank" href="/building-a-conversational-chatbot-for-slack-using-rasa-and-python-part-1-bca5cc75d32f">的</a></p><p id="1044" class="pw-post-body-paragraph kx ky it la b lb lc ju ld le lf jx lg mg li lj lk mi lm ln lo mk lq lr ls lt im bi translated"><a class="ae nq" href="https://github.com/parulnith/Building-a-Conversational-Chatbot-for-Slack-using-Rasa-and-Python" rel="noopener ugc nofollow" target="_blank">Github 知识库链接</a></p></div></div>    
</body>
</html>