# 检查分析的实验室数据是否有错误

> 原文：<https://towardsdatascience.com/checking-analyzed-laboratory-data-for-errors-4bd63bcc554d?source=collection_archive---------37----------------------->

## 教程:自动分析实验室数据以创建性能图

## 如何确保实验室数据集中没有错误

![](img/75a75371495c8dc829adcedc1f929d7c.png)

科学家发现自己拥有大型数据集是很常见的。有时，它以单个文件中数千兆字节数据的形式出现。有时是数百个文件，每个文件包含少量数据。无论哪种方式，都很难管理。很难理解。你的电脑很难处理。您需要一种方法来简化这一过程，使数据集更易于管理，并帮助您跟踪一切。

这就是本教程的内容。我们正在编写 Python 脚本，它将自动为您分析所有数据，并以有意义、直观的文件名存储数据。同时使用来自实际研究的例子，这样你就知道你正在发展的技能是实用和有用的。

本教程的第一篇文章介绍了本教程的概念。如果“热泵热水器”、“性能系数(COP)”和“性能图”这些术语对你来说毫无意义，[你可能想读一下](/tutorial-automatically-creating-a-performance-map-of-a-heat-pump-water-heater-7035c7f208b0)。

第二篇文章介绍了[的配套数据集](https://peter-grant.my-online.store/HPWH_Performance_Map_Tutorial_Data_Set/p6635995_20036443.aspx),[将数据集分割成多个文件](/splitting-data-sets-cac104a05386)，并使用用户友好的名称。

伴随数据集是教程过程中有价值的一部分，因为它允许您跟随。您可以编写与我将要展示的完全相同的代码，运行代码，查看结果，并与我展示的结果进行比较。这样，你就能确保你做得对。

在教程的第三部分[中，我们创建了一个脚本来分析每个单独的数据文件。在这个过程中，我们 1)过滤数据以仅检查相关部分，2)识别数据中的时间步长，3)计算每个时间步长期间水箱中存储的能量的变化，4)计算每个时间步长下热泵的 COP，5)生成将 COP 表示为每个测试中水温的函数的回归，以及 6)保存结果以供将来使用。](/automatically-analyzing-laboratory-test-data-32c27e4e3075)

在这个过程的最后，我们留下了这个过程中最重要的问题之一。到目前为止，该流程运行正常吗？可能会出现许多问题。实验人员可能在进行测试时犯了错误，导致错误的数据。传感器可能已经损坏，导致数据丢失。即使输入数据是正确的，数据处理代码中也可能存在错误，从而导致奇怪的结果。

这篇文章将向你展示如何手动检查数据错误。这一步很重要，因为它教会了你错误检查中涉及的所有概念，比如如何思考测试中什么是重要的，以及如何检查数据以确保一切正常工作。这将为教程的下一阶段做好准备，下一阶段的重点是自动完成这项工作。

本教程这一阶段的起点将与上次的程序相同。我们将在 for 循环中添加新的代码来分析数据，并利用我们已经导入 bokeh 用于绘图的事实。

第一步是考虑什么可能出错，以及我们需要检查哪些潜在的错误。

## 我应该寻找哪些错误？

为了识别重要的错误检查，我们需要考虑测试的哪些部分是重要的。对于这些测试，我确定了以下几点:

*   **初始水温**:初始水温必须高于规定的初始水温。如果不是，那么数据集将不会覆盖整个测试范围，测试必须重新进行。
*   **最终水温**:同样，最终水温必须高于规定的最终水温。如果不是，那么数据集会过早截止，不能提供所需的全测试范围。
*   **环境温度**:测试过程中的平均环境温度必须接近规定的环境温度。由于每个测试都提供了热泵在指定环境温度下的 COP，因此不正确的环境温度会导致不正确的性能图。
*   **回归质量**:这项工作的重点是建立一个预测热泵 COP 的回归模型。这意味着我们需要确保:a)计算的 COP 始终在 2–8 范围内，预计会超过该范围；b)我们在上一篇文章中创建的 COP 回归能够准确预测该测试中的 COP。

为了手动检查所有这些项目，我们需要绘制曲线图，显示测试过程中的水温、环境温度和耗电量。

## 我如何创造必要的情节？

要为每个测试创建必要的绘图，我们必须添加代码来绘制 for 循环中的每个项目。这样，为单个测试创建每个图，然后程序继续进行下一个测试，并为该测试创建图。

幸运的是，我们在上一篇文章中导入了必要的散景函数，这次不需要担心这个问题。这意味着我们可以通过编写一行代码来创建第一个显示水箱水温的绘图对象。这是用下面一行代码完成的。

```
p1 = figure(width=800, height=400, x_axis_label='Time (min)', y_axis_label = 'Water Temperature (deg F)')
```

这一行引用散景函数“figure”来创建一个图形对象。它被分配给变量“p1 ”,因此我们可以在将来通过引用 p1 来编辑该图形。在该函数中，它将绘图的宽度设置为 800 像素，高度设置为 400 像素，x 轴标签设置为“时间(分钟)”，y 轴标签设置为“水温(华氏度)”。我们现在有了一个图的结构，可以根据需要添加数据。

通过编辑图来添加新的数据系列来添加数据。添加的每个数据系列使用一个新行，可以通过引用数据分析中使用的数据框来添加数据。为了将水温数据添加到绘图中，我们使用以下代码:

```
p1.circle(Data['Time Since Test Start (min)'], Data['T1 (deg F)'],   legend='Temperature 1', color = 'skyblue')p1.circle(Data['Time Since Test Start (min)'], Data['T2 (deg F)'], legend='Temperature 2', color = 'powderblue')p1.circle(Data['Time Since Test Start (min)'], Data['T3 (deg F)'], legend='Temperature 3', color = 'lightskyblue')p1.circle(Data['Time Since Test Start (min)'], Data['T4 (deg F)'], legend='Temperature 4', color = 'lightblue')p1.circle(Data['Time Since Test Start (min)'], Data['T5 (deg F)'], legend='Temperature 5', color = 'cornflowerblue')p1.circle(Data['Time Since Test Start (min)'], Data['T6 (deg F)'], legend='Temperature 6', color = 'royalblue')p1.circle(Data['Time Since Test Start (min)'], Data['T7 (deg F)'], legend='Temperature 7', color = 'blue')p1.circle(Data['Time Since Test Start (min)'], Data['T8 (deg F)'], legend='Temperature 8', color = 'mediumblue')p1.circle(Data['Time Since Test Start (min)'], Data['Average Tank Temperature (deg F)'], legend='Average', color = 'darkblue')
```

上述代码的每一行都向绘图中添加了一个新的数据系列。这些行调用 p1.circle 函数，说明新的数据系列将在图上表示为圆形。在函数调用中，第一项是 x 数据，第二项是 y 数据。您可以看到，每个数据系列都将测试开始后的时间(以分钟为单位)作为 x 数据，并将不同的水温作为 y 数据。共有九个数据系列，前八个代表从数据中直接测量的水温，第九个代表计算的平均水温。每个数据系列的图例说明说明了数据系列在图例中的表示方式，颜色指定了绘图中圆圈所用的颜色。圆圈的颜色选择在坦克的顶部使用浅蓝色，在底部使用深蓝色。

最后，我们要指定图例的位置。如果不是这样，图例可能会覆盖数据集的一部分，掩盖我们需要看到的信息。我们可以在图的右下方添加一行:

```
p1.legend.location = "bottom_right"
```

这就完成了第一个图，所以我们可以转到代表环境温度的第二个图。这与创建 plot 对象并向其添加数据系列的过程相同。因为您已经看到了这个过程，所以这里的细节和讨论较少。

```
p2 = figure(width=800, height=400, x_axis_label='Time (min)', y_axis_label = 'Ambient Temperature (deg F)')
p2.circle(Data['Time Since Test Start (min)'], Data['T_Amb (deg F)'], color = 'red')
```

这创建了一个类似的图，但它只有一个数据系列，显示数据框中的“T_Amb(华氏度)”列。请注意，y 轴标签也发生了变化，以显示数据集中的变化。

我们需要的第三个图显示了测试过程中的警察。与环境温度类似，由于您已经熟悉了这一过程，因此对该图的讨论较少。第三个图是用以下代码创建的:

```
p3 = figure(width=800, height=400, x_axis_label=’Average Tank Temperature (deg F)’, y_axis_label = ‘Coefficient of Performance (-)’)
p3.circle(Data[‘Average Tank Temperature (deg F)’], Data[‘COP (-)’], legend = ‘Measurement’, color = ‘red’)
p3.line(np.arange(72, 140.1, 0.1), Regression(np.arange(72, 140, 0.1)), legend = ‘Regression’, color = ‘black’)
```

这段代码的新内容是增加了一行，显示使用上一篇文章中的回归计算出的器件 COP。这是使用 p3.line 函数调用的。传统上，线用于模拟数据。然后，使用范围从 72 到 140.1、步长为 0.1 的 numpy 数组创建该行的 x 数据。注意，由于 Python 不包括数组中的最后一个条目，这实际上创建了从 72 到 140 的数据点。y 数据使用与我们的 COP 回归输入相同的范围，然后绘制计算的 COP 值。图例和颜色条目与之前图中的相同。

这段代码创建了三个图，但实际上并没有保存它们。散景将图作为用户定义的数组保存在. html 文件中。为了保存绘图，我们需要指定数组和。html 文件，然后保存数据。我们可以用下面的代码做到这一点:

```
p = gridplot([[p1], [p2], [p3]])
output_file(Filename_Test[:-4] + '.html', title = Filename_Test[146:-4])
save(p)
```

第一行创建一个由三个列表组成的 gridplot 对象。在这种格式中，每个列表代表要放入每行的图。由于数据是作为三个单独的列表输入的，每个列表包含一个图，所以这些图将显示在。html 文件。如果我们想要多列，我们可以在列表中添加多个条目。

函数的作用是:指定文件的名字和标题。html 文件。在这种情况下，我们使用动态命名赋予绘图与数据文件相同的名称，但以. html 结尾而不是. csv。“csv”来自文件名。当指定文件名时，我们添加。以确保它保存为. html 文件。当指定标题时，我们不需要包含扩展名。最后，我们保存。包含绘图的 html 文件保存到计算机(p)。

## 我如何使用这些图来检查结果？

我们可以通过检查图来检查数据和分析的质量，以确保它们显示了我们需要看到的内容。让我们通过检查我们刚刚为 55 华氏度环境温度测试创建的三个曲线图来讨论这个问题。

第一个图显示了测试过程中水箱中每个深度的水温。下面介绍一下。

![](img/888def17560a755ccb959e88993bf6ed.png)

在这个测试中，我们可以看到每个测量都是从 72 华氏度开始的。这正是我们所期望看到的。此外，每次测量报告的最终温度为 140 华氏度。同样，这正是我们期望看到的。最后，我们看到每次测量中的温度逐渐升高，正如我们预期的那样，当它被热泵缓慢加热时。该图显示数据符合我们对该数据集的预期。

请记住，这是捏造的数据，而不是实际的测试测量。我在创建数据时没有添加任何随机化，这就是为什么这个数据集非常平滑的原因。在处理真实数据时，永远不要期望事情会如此顺利。

我们讨论的第二个图是环境温度。这一点可以从下面的剧情中看出。

![](img/b6df51729b957e604b3b9e94d91a3f02.png)

注意这个数据比水温更随机一些。它没有直接放置在测试中指定的 55 华氏度，而是从 54 华氏度反弹到 56 华氏度。这是因为我在配套数据集中对环境温度添加了少量随机化。这是为了让你更好地理解真实数据中的内容。当环境温度不在设定点时，如何检查以确保环境温度足够接近指定的 55 华氏度？

在这种情况下，可以肯定地说，测试被设置为 55 华氏度。我这样说是因为数据的平均值明显接近数据。我也认为可以说设备得到了很好的控制。我这样说是因为温度总是接近设定温度；虽然它的温度从华氏 54 度到 56 度不等，但它绝对不会在华氏 45 度或华氏 70 度时移动。

最终曲线图显示了热泵的计算和回归 COP 作为水温的函数。如下图所示。

![](img/d96a1c0774dcfb6c0c6f6609f74d36ce.png)

在这种情况下，我们可以看到热泵的实测 COP 从 72°f 逐渐降低到 140。这是意料之中的，因为水温的升高使水更难从制冷剂转移到水中。与 COP 的突然或急剧变化相反，COP 的逐渐下降也是可以预期的。我们还可以看到，COP 落在预期的 2–9 范围内。

总的来说，这三幅图都表明数据符合我们的规格，并表明测试和计算是正确进行的。

## 包装它

在本文中，我们介绍了如何添加代码以在分析数据集时自动绘制数据集，如何考虑检查数据，以及如何检查图形以手动验证实验和计算。这是重要的一步，因为基于错误数据或错误计算的项目结果是没有价值的。

然而，这不是执行这种错误检查的最佳方式。如果您执行具有成百上千个测试的项目，手动检查每个测试的图会很耗时，这意味着既昂贵又乏味。最好在程序中添加一个新的部分，自动比较来自实验和计算的值与用户指定的阈值。通过这种方式，我们的代码可以自动识别不符合预期的测试或计算，标记潜在的错误，并向用户报告这些潜在的错误。我们将在下一篇文章中讨论这个主题。

# 教程目录

这是一系列文章的一部分，教你自动分析实验室数据和绘制热泵热水器性能图所需的所有技巧。本系列的其他文章可以通过以下链接找到:

[简介](/tutorial-automatically-creating-a-performance-map-of-a-heat-pump-water-heater-7035c7f208b0)

[分割数据集](/splitting-data-sets-cac104a05386)

[自动分析实验室测试数据](/automatically-analyzing-laboratory-test-data-32c27e4e3075)

[如何编写检查数据质量的脚本](https://medium.com/zero-equals-false/how-to-write-scripts-that-check-data-quality-for-you-d8762dab34ca)

[如何在 Python 中自动生成回归](https://medium.com/zero-equals-false/how-to-perform-multivariate-multidimensional-regression-in-python-df986c35b377)