<html>
<head>
<title>Run Deep Learning Containers on AWS with One Command</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用一个命令在 AWS 上运行深度学习容器</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/run-deep-learning-containers-on-aws-with-one-command-114898e1eb5?source=collection_archive---------24-----------------------#2019-05-13">https://towardsdatascience.com/run-deep-learning-containers-on-aws-with-one-command-114898e1eb5?source=collection_archive---------24-----------------------#2019-05-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/99ca38f0982b698d1a1009d3dd139599.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MJSQha5UQ-coYhM3TanE6g.jpeg"/></div></div></figure><p id="b1b4" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">有许多公开可用的 Docker 图像，如<a class="ae kz" href="https://hub.docker.com/r/tensorflow/tensorflow" rel="noopener ugc nofollow" target="_blank"> TensorFlow </a>、<a class="ae kz" href="https://hub.docker.com/r/pytorch/pytorch/tags" rel="noopener ugc nofollow" target="_blank"> PyTorch </a>、<a class="ae kz" href="https://jupyter-docker-stacks.readthedocs.io/en/latest/using/selecting.html" rel="noopener ugc nofollow" target="_blank"> Jupyter Docker Stacks </a>或<a class="ae kz" href="https://docs.aws.amazon.com/dlami/latest/devguide/deep-learning-containers-images.html" rel="noopener ugc nofollow" target="_blank"> AWS 深度学习容器</a>，可用于训练深度学习模型。</p><p id="86ba" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">有了<a class="ae kz" href="https://github.com/apls777/spotty" rel="noopener ugc nofollow" target="_blank"> Spotty </a>你只需要一个命令就可以在 AWS 上运行 Docker 容器。Spotty 为您管理所有必要的 AWS 资源，包括卷、快照和 SSH 密钥，将本地项目与实例同步，并使用<a class="ae kz" href="https://github.com/tmux/tmux" rel="noopener ugc nofollow" target="_blank"> tmux </a>将远程进程从其终端分离。</p><p id="7aa8" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">你所需要的只是在你的项目的根目录下有一个名为</strong> <code class="fe la lb lc ld b"><strong class="kd iu">spotty.yaml</strong></code> <strong class="kd iu">的配置文件。</strong></p><h1 id="a914" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">装置</h1><p id="7e9f" class="pw-post-body-paragraph kb kc it kd b ke mc kg kh ki md kk kl km me ko kp kq mf ks kt ku mg kw kx ky im bi translated">要求:</p><ul class=""><li id="fc87" class="mh mi it kd b ke kf ki kj km mj kq mk ku ml ky mm mn mo mp bi translated">Python ≥3.5</li><li id="b40b" class="mh mi it kd b ke mq ki mr km ms kq mt ku mu ky mm mn mo mp bi translated"><a class="ae kz" href="https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-install.html" rel="noopener ugc nofollow" target="_blank">安装</a>和<a class="ae kz" href="https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-configure.html#cli-quick-configuration" rel="noopener ugc nofollow" target="_blank">配置</a> AWS CLI</li></ul><p id="f102" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">使用<a class="ae kz" href="http://www.pip-installer.org/en/latest/" rel="noopener ugc nofollow" target="_blank"> pip </a>安装或升级 Spotty:</p><pre class="mv mw mx my gt mz ld na nb aw nc bi"><span id="1011" class="nd lf it ld b gy ne nf l ng nh">pip install -U spotty</span></pre><h1 id="ee47" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">配置文件</h1><p id="b5f2" class="pw-post-body-paragraph kb kc it kd b ke mc kg kh ki md kk kl km me ko kp kq mf ks kt ku mg kw kx ky im bi translated">一个配置文件描述了 EC2 实例的参数和 Docker 容器的参数，这些参数将被用作项目的环境。这里有一个例子:</p><figure class="mv mw mx my gt ju"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="1967" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">有了上面的配置，Spotty 将在<strong class="kd iu"> us-east-2 </strong>(俄亥俄州)地区运行一个<strong class="kd iu">按需</strong> <strong class="kd iu"> p2.xlarge </strong>实例。随意更改这个配置:例如，您可以将参数<code class="fe la lb lc ld b">image</code>更改为<code class="fe la lb lc ld b">pytorch/pytorch:latest</code>来运行 PyTorch 容器。</p><p id="1114" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果您想启动一个 Spot 实例，而不是一个按需实例，请删除<code class="fe la lb lc ld b">onDemandInstance</code>参数。要找到所选实例类型的最低价格区域，使用<code class="fe la lb lc ld b">spotty aws spot-prices -i &lt;INSTANCE_TYPE&gt;</code>命令。</p><p id="a015" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">在<a class="ae kz" href="https://apls777.github.io/spotty/docs/configuration/" rel="noopener ugc nofollow" target="_blank">文档</a>中阅读更多关于配置的信息。</p><h1 id="980e" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">启动容器</h1><p id="74c4" class="pw-post-body-paragraph kb kc it kd b ke mc kg kh ki md kk kl km me ko kp kq mf ks kt ku mg kw kx ky im bi translated">一旦项目目录中有了一个<code class="fe la lb lc ld b">spotty.yaml</code>文件，就可以使用下面的命令启动容器:</p><pre class="mv mw mx my gt mz ld na nb aw nc bi"><span id="84cc" class="nd lf it ld b gy ne nf l ng nh">spotty start</span></pre><p id="77be" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">该命令将启动一个 EC2 实例，将本地项目与该实例同步，并运行容器。</p><figure class="mv mw mx my gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nk"><img src="../Images/e8276a64ce733a2a54149d61d9ea61d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nMPZp9GXKRtGD6JcHdVazA.png"/></div></div></figure><p id="ca5f" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">使用<code class="fe la lb lc ld b">spotty ssh</code>命令连接到容器。</p><p id="d948" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">不要忘记稍后使用</strong> <code class="fe la lb lc ld b"><strong class="kd iu">spotty stop</strong></code> <strong class="kd iu">命令停止实例！</strong></p><h1 id="5c02" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">AWS 深度学习容器</h1><p id="9c9e" class="pw-post-body-paragraph kb kc it kd b ke mc kg kh ki md kk kl km me ko kp kq mf ks kt ku mg kw kx ky im bi translated"><a class="ae kz" href="https://aws.amazon.com/machine-learning/containers/" rel="noopener ugc nofollow" target="_blank"> AWS 深度学习容器</a>是预装深度学习框架的 Docker 映像，针对最高性能进行了优化:</p><blockquote class="nl nm nn"><p id="70af" class="kb kc no kd b ke kf kg kh ki kj kk kl np kn ko kp nq kr ks kt nr kv kw kx ky im bi translated"><em class="it"> AWS DL 容器包括对流行框架(如 TensorFlow 和 Apache MXNet)的最新版本的 AWS 优化和改进，以及为云中的训练和推理提供最高性能的库。例如，AWS TensorFlow 优化通过显著改进的 GPU 扩展使模型的训练速度提高了一倍。</em></p></blockquote><p id="cc48" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">Docker 图片在亚马逊 ECR 有售。<a class="ae kz" href="https://docs.aws.amazon.com/dlami/latest/devguide/deep-learning-containers-images.html" rel="noopener ugc nofollow" target="_blank">在这里</a>你可以找到一个图像 URL 列表，可以在一个不稳定的配置文件中使用。</p><p id="09c8" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">要运行 AWS DL 容器，实例应该能够访问 Amazon ECR:</p><ol class=""><li id="cad6" class="mh mi it kd b ke kf ki kj km mj kq mk ku ml ky ns mn mo mp bi translated">使用<code class="fe la lb lc ld b">managedPolicyArns</code>参数将<code class="fe la lb lc ld b">arn:aws:iam::aws:policy/AmazonEC2ContainerRegistryFullAccess</code>策略附加到实例角色。</li><li id="4d07" class="mh mi it kd b ke mq ki mr km ms kq mt ku mu ky ns mn mo mp bi translated">在容器运行之前使用<code class="fe la lb lc ld b">commands</code>参数登录 Amazon ECR:<code class="fe la lb lc ld b">$(aws ecr get-login --no-include-email --region us-east-2 --registry-ids 763104351884)</code>。</li></ol><figure class="mv mw mx my gt ju"><div class="bz fp l di"><div class="ni nj l"/></div></figure><p id="b862" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated"><strong class="kd iu">确保图像名称中的区域和登录命令中的区域与</strong> <code class="fe la lb lc ld b"><strong class="kd iu">region</strong></code> <strong class="kd iu">参数匹配。</strong></p><h1 id="c277" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">结论</h1><p id="9982" class="pw-post-body-paragraph kb kc it kd b ke mc kg kh ki md kk kl km me ko kp kq mf ks kt ku mg kw kx ky im bi translated">Spotty 是一种使用 Docker 容器在 AWS 上训练深度学习模型的快速简便的方法。它将节省您管理 AWS 资源的时间，并通过将项目与实例同步、运行自定义远程脚本和使用 tmux 分离远程进程来帮助工作流。</p><p id="8c62" class="pw-post-body-paragraph kb kc it kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky im bi translated">如果你喜欢这篇文章，请在 GitHub   <strong class="kd iu">上启动</strong> <a class="ae kz" href="https://github.com/apls777/spotty" rel="noopener ugc nofollow" target="_blank"> <strong class="kd iu">项目，并与你的朋友分享这篇文章。</strong></a></p></div></div>    
</body>
</html>