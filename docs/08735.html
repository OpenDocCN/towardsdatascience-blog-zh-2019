<html>
<head>
<title>Using machine learning to predict sport scores — a Rugby World Cup example</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用机器学习预测体育比分——以橄榄球世界杯为例</h1>
<blockquote>原文：<a href="https://towardsdatascience.com/using-machine-learning-to-predict-sport-scores-a-rugby-world-cup-example-f699fd552673?source=collection_archive---------17-----------------------#2019-11-23">https://towardsdatascience.com/using-machine-learning-to-predict-sport-scores-a-rugby-world-cup-example-f699fd552673?source=collection_archive---------17-----------------------#2019-11-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/58e89a3231f582a538d7c513dcc0f645.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J3ZtVjLR2QPWikLIhHWAgw.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">Photo by <a class="ae kf" href="https://unsplash.com/@jesus?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Thomas Serer</a> on <a class="ae kf" href="https://unsplash.com/s/photos/rugby?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="2803" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">扩展你的编码技能的最好方法之一是坚持做一个你感兴趣的项目。就在 9 月份 2019 年橄榄球世界杯开始之前，我决定尝试预测锦标赛的结果。</p><p id="a8d1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下面，我将介绍我尝试预测橄榄球世界杯小组赛的获胜者和分数的高级流程。希望它能鼓励你在你最喜欢的运动中尝试一下！</p><p id="a2c0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了这个项目，我使用了<a class="ae kf" href="https://www.python.org/" rel="noopener ugc nofollow" target="_blank"> Python </a>、<a class="ae kf" href="https://jupyter.org/" rel="noopener ugc nofollow" target="_blank"> Jupyter 笔记本</a>、<a class="ae kf" href="https://www.jetbrains.com/pycharm/" rel="noopener ugc nofollow" target="_blank"> PyCharm </a>和<a class="ae kf" href="https://powerbi.microsoft.com/" rel="noopener ugc nofollow" target="_blank"> Power BI </a>(用于快速数据识别)。</p><h1 id="ae8c" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">第一步:获取数据</h1><p id="0038" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">ESPN Scrum 有一个庞大的国际橄榄球比赛数据库。我想从 2003 年开始参加所有的国际橄榄球比赛。我选择这个日期是因为世界橄榄球排名是在 2003 年世界杯之前推出的(更多信息请见专题部分)。</p><figure class="mi mj mk ml gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mh"><img src="../Images/f3356149053fd77222c146e356d13c3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vRbKm6Kn89ysf3PUSKAfpw.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">ESPN Scrum match result database</figcaption></figure><p id="b8d4" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="mm">但是</em>这些数据被分割成 175 页——复制/粘贴不是一个实用的解决方案。<a class="ae kf" href="https://www.crummy.com/software/BeautifulSoup/bs4/doc/" rel="noopener ugc nofollow" target="_blank">美丽之声</a>来救援。BeautifulSoup 是一个从 HTML 和 XML 文件中提取数据的库。下面你可以看到包含 2019 年 9 月 7 日威尔士比赛信息的原始数据:</p><figure class="mi mj mk ml gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mn"><img src="../Images/07a559d81761ff249b7573bba4001be0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y3UQlnzOtXXPK7cFfzkE2w.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">Result of BeautifulSoup scraping for match results</figcaption></figure><p id="ea01" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我注意到 ESPN 的 URL 引用了<em class="mm">页面和</em>页面，所以我遍历了每个页面并存储了结果。</p><figure class="mi mj mk ml gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mo"><img src="../Images/a3bc71eae9f3596cb6341321d0b37930.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gybq_YZBseG427cGV7GqQg.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">DataFrame of match results</figcaption></figure><p id="fc0c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我还添加了世界橄榄球排名作为一个特色。</p><figure class="mi mj mk ml gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mp"><img src="../Images/66d1ef98ccb53f24ed7e579f59272001.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*db9vP82voHCxI3R78ghqkg.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">World Rugby Rankings</figcaption></figure><h1 id="5d82" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">第二步:数据准备</h1><p id="6ca5" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">显然，收集到的数据并没有达到机器学习的完美状态，所以我需要清理一些小问题，例如删除反对派名称字段中的<em class="mm">‘v’</em>,并确保团队和反对派字段中的国家名称相同(我注意到一个字段中的美国是<em class="mm">美国</em>,另一个字段中的美国是<em class="mm">美国</em>。Pandas 让这变得相对简单——例如，参见<a class="ae kf" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.apply.html" rel="noopener ugc nofollow" target="_blank"> <em class="mm">应用</em> </a>和<a class="ae kf" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.map.html" rel="noopener ugc nofollow" target="_blank"> <em class="mm">贴图</em> </a>。我执行了一些其他的准备步骤，比如计算原始数据中的错误/空白，以及正确地格式化日期。</p><h1 id="3435" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">第三步:特征</h1><p id="2ee3" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">世界橄榄球排名被合并到主数据集上，以便对每支球队应用最接近每场比赛日期的排名。</p><p id="64e9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">虽然我有世界橄榄球排名，但我仍然想为每支球队计算一个单独的、更简单的技能得分。我使用<a class="ae kf" href="https://en.wikipedia.org/wiki/Elo_rating_system" rel="noopener ugc nofollow" target="_blank"> Elo 评级系统</a>的概括来计算相对技能。在这个系统中，玩家的等级根据比赛结果和两个队之间的相对等级差异而变化。在一个简单的例子中，如果排名第 10 的球队击败排名第 2 的球队，排名第 10 的球队将比排名第 15(较弱)的球队获得更多的评分。类似地，输了的排名第二的队伍会因为输给一个弱对手而比输给排名第一的队伍失去更多的评分。因此，该算法可以自我修正，并随着时间的推移“学习”每个团队的技能。</p><p id="0780" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">世界橄榄球排名考虑了各种比赛特征，如比赛状态(世界杯决赛得分更多)、主场优势和比赛得分。计算出的技能分数忽略了所有这些，而只是简单地看比赛结果和比赛时两队之间的相对技能。</p><p id="808b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们来看看这些排名在一段时间内的对比情况:</p><figure class="mi mj mk ml gt ju gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/adebe89c7b75c26a6c4b8fd976cfd5fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:866/format:webp/1*_wlqNMPG41sLkwOqeNoojQ.jpeg"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">Official World Rugby rankings (23rd September) versus the calculated rankings</figcaption></figure><p id="59ef" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这里有一些有趣的结果——澳大利亚的排名高于预期，而爱尔兰和威尔士低于真实排名。我怀疑澳大利亚的高排名很大程度上受到他们最初高起点的影响(他们在 2003 年是世界排名第三的球队)。下面你可以看到随着算法的学习，一些团队的技能分数是如何随着时间而变化的。请注意，大约从 2014 年开始，英格兰、爱尔兰和威尔士的排名稳步上升。</p><figure class="mi mj mk ml gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mr"><img src="../Images/19d4d4d34bfd780d3aeeef7cafbf1c72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Njt81Lx4Xkui4oJOagaROA.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">Relative team skill score over time</figcaption></figure><p id="8622" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">总之，每场历史比赛的数据包括:比赛日期、比赛结果、得分、比分、两队的世界橄榄球排名以及两队的相对技能得分。</p><h1 id="af77" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">第四步:培训和测试</h1><p id="6784" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">对于分数预测，我使用了<a class="ae kf" href="https://keras.io/" rel="noopener ugc nofollow" target="_blank"> Keras，</a>一个高级神经网络 API。Keras 中最简单的模型是顺序模型。</p><p id="c278" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我进行了超参数调整(点击这里查看杰森·布朗利的伟大教程<a class="ae kf" href="https://machinelearningmastery.com/grid-search-hyperparameters-deep-learning-models-python-keras/" rel="noopener ugc nofollow" target="_blank"/>，并对宽(一层有很多神经元)和深(更多层，但每层神经元更少)网络进行了实验。我最终使用了第一层的 15 个神经元和第二层的 8 个神经元，都带有整流线性激活单元(ReLU)。我们没有为输出层使用激活函数，因为我们不想转换输出值。</p><figure class="mi mj mk ml gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mo"><img src="../Images/f6aa004f37cc39b7de4d228ec3dbb0dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cLjQr1nJ1aA8tW-9kyjiQw.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">Neural network topology</figcaption></figure><p id="38c5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下面你可以看到一个损失(均方误差)的曲线图。</p><figure class="mi mj mk ml gt ju gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/caca4caa0be34e6f560e0d126bed888a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*hfXlwUR3B-QudFwu7HCILw.jpeg"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">Neural network model loss against number of epochs</figcaption></figure><p id="6bf8" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我也尝试了粉丝最喜欢的<a class="ae kf" href="https://xgboost.readthedocs.io/en/latest/#" rel="noopener ugc nofollow" target="_blank"> XGBoost，</a>，但是用神经网络得到了稍微好一点的结果，代价是训练时间更长。</p><h1 id="c090" class="le lf it bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">第五步:预测！</h1><p id="5009" class="pw-post-body-paragraph kg kh it ki b kj mc kl km kn md kp kq kr me kt ku kv mf kx ky kz mg lb lc ld im bi translated">作为模型输入，我创建了一个即将到来的世界杯小组赛的数据集，并给每支球队分配了他们最新的技能得分和排名。</p><p id="3f49" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">那么预测的表现如何呢？比我预想的好多了(至少前 15 场)！在它预测的 30 场比赛中，它正确预测了其中 27 场比赛的冠军(预测日本对爱尔兰的比赛会令人震惊)。</p><p id="70df" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">该模型在前 15 场比赛中表现特别好，其中 10 场比赛的实际得分差异不到 5 分。</p><figure class="mi mj mk ml gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mt"><img src="../Images/f8a18c40233af82c0b004fa6a55ad5b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PYbfz-Bg4AKOOO3RWfiSUQ.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk">Model prediction results versus actual results</figcaption></figure><p id="18ab" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">请注意，我没有在小组赛阶段重新训练模型，上面的结果是在世界杯开始时获得的。有趣的是，一旦大多数球队至少打了一场比赛，预测似乎会变得更糟。这是有意义的，因为相对排名和技能分数会发生变化，所以人们可以假设，如果我在第一轮游戏后更新这些功能并重新训练模型，预测会有所改善(我没有这样做，因为我太专注于观看实际的游戏了！).</p><p id="0b74" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">无论哪种方式，对于几个晚上的工作来说都是不错的结果！机器学习是一个迷人的领域，如果你决定亲自尝试，请告诉我，还有很多需要改进的地方和可以添加的有趣功能。希望你喜欢这个演示！</p><p id="8b54" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">这里有一些有用的资源可以帮助你开始:</strong></p><p id="e523" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">用 BeautifulSoup 刮网</strong></p><div class="mu mv gp gr mw mx"><a href="https://news.codecademy.com/web-scraping-python-beautiful-soup-mlb-stats/" rel="noopener  ugc nofollow" target="_blank"><div class="my ab fo"><div class="mz ab na cl cj nb"><h2 class="bd iu gy z fp nc fr fs nd fu fw is bi translated">网刮 MLB 统计与 Python 和美丽的汤</h2><div class="ne l"><h3 class="bd b gy z fp nc fr fs nd fu fw dk translated">Codecademy 练习已经很好地打包了数据供我们使用。然而，会有很多场合当我们…</h3></div><div class="nf l"><p class="bd b dl z fp nc fr fs nd fu fw dk translated">news.codecademy.com</p></div></div><div class="ng l"><div class="nh l ni nj nk ng nl jz mx"/></div></div></a></div><div class="mu mv gp gr mw mx"><a href="https://www.freecodecamp.org/news/how-to-scrape-websites-with-python-and-beautifulsoup-5946935d93fe/" rel="noopener  ugc nofollow" target="_blank"><div class="my ab fo"><div class="mz ab na cl cj nb"><h2 class="bd iu gy z fp nc fr fs nd fu fw is bi translated">如何用 Python 和 BeautifulSoup 刮网站</h2><div class="ne l"><h3 class="bd b gy z fp nc fr fs nd fu fw dk translated">如何用 Python 和 BeautifulSoup 抓取网站互联网上的信息比任何…</h3></div><div class="nf l"><p class="bd b dl z fp nc fr fs nd fu fw dk translated">www.freecodecamp.org</p></div></div><div class="ng l"><div class="nm l ni nj nk ng nl jz mx"/></div></div></a></div><p id="350a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">用熊猫操纵数据</strong></p><div class="mu mv gp gr mw mx"><a href="https://www.datacamp.com/community/tutorials/pandas-tutorial-dataframe-python" rel="noopener  ugc nofollow" target="_blank"><div class="my ab fo"><div class="mz ab na cl cj nb"><h2 class="bd iu gy z fp nc fr fs nd fu fw is bi translated">熊猫教程:Python 中的数据帧</h2><div class="ne l"><h3 class="bd b gy z fp nc fr fs nd fu fw dk translated">使用 Python 探索数据分析。熊猫数据框使你的数据操作简单，从选择或替换…</h3></div><div class="nf l"><p class="bd b dl z fp nc fr fs nd fu fw dk translated">www.datacamp.com</p></div></div><div class="ng l"><div class="nn l ni nj nk ng nl jz mx"/></div></div></a></div><p id="ff17" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">数据科学</strong></p><p id="6f9a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我强烈推荐 Jake VanderPlas 的优秀 Python 数据科学手册(包括示例笔记本)</p><div class="mu mv gp gr mw mx"><a href="https://jakevdp.github.io/PythonDataScienceHandbook/" rel="noopener  ugc nofollow" target="_blank"><div class="my ab fo"><div class="mz ab na cl cj nb"><h2 class="bd iu gy z fp nc fr fs nd fu fw is bi translated">Python 数据科学手册</h2><div class="ne l"><h3 class="bd b gy z fp nc fr fs nd fu fw dk translated">该网站包含 Jake VanderPlas 的 Python 数据科学手册的全文；该内容可在…上获得</h3></div><div class="nf l"><p class="bd b dl z fp nc fr fs nd fu fw dk translated">jakevdp.github.io</p></div></div></div></a></div><p id="60e0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">【Keras 和神经网络入门</p><div class="mu mv gp gr mw mx"><a href="https://machinelearningmastery.com/tutorial-first-neural-network-python-keras/" rel="noopener  ugc nofollow" target="_blank"><div class="my ab fo"><div class="mz ab na cl cj nb"><h2 class="bd iu gy z fp nc fr fs nd fu fw is bi translated">你的第一个深度学习项目是用 Python 和 Keras 一步一步完成的</h2><div class="ne l"><h3 class="bd b gy z fp nc fr fs nd fu fw dk translated">Keras 上一次更新是一个强大且易于使用的免费开源 Python 库，用于开发和评估深度…</h3></div><div class="nf l"><p class="bd b dl z fp nc fr fs nd fu fw dk translated">machinelearningmastery.com</p></div></div><div class="ng l"><div class="no l ni nj nk ng nl jz mx"/></div></div></a></div></div></div>    
</body>
</html>